var semver;!function(r,e){function t(r,e){if(r instanceof n)return r;if("string"!=typeof r)return null;if(r.length>V)return null;if(!(e?N[J]:N[U]).test(r))return null;try{return new n(r,e)}catch(r){return null}}function n(r,e){if(r instanceof n){if(r.loose===e)return r;r=r.version}else if("string"!=typeof r)throw new TypeError("Invalid Version: "+r);if(r.length>V)throw new TypeError("version is longer than "+V+" characters");if(!(this instanceof n))return new n(r,e);T("SemVer",r,e),this.loose=e;var t=r.trim().match(e?N[J]:N[U]);if(!t)throw new TypeError("Invalid Version: "+r);if(this.raw=r,this.major=+t[1],this.minor=+t[2],this.patch=+t[3],this.major>A||this.major<0)throw new TypeError("Invalid major version");if(this.minor>A||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>A||this.patch<0)throw new TypeError("Invalid patch version");t[4]?this.prerelease=t[4].split(".").map(function(r){if(/^[0-9]+$/.test(r)){var e=+r;if(e>=0&&e<A)return e}return r}):this.prerelease=[],this.build=t[5]?t[5].split("."):[],this.format()}function i(r,e){var t=yr.test(r),n=yr.test(e);return t&&n&&(r=+r,e=+e),t&&!n?-1:n&&!t?1:r<e?-1:r>e?1:0}function s(r,e,t){return new n(r,t).compare(e)}function o(r,e,t){return s(e,r,t)}function a(r,e,t){return s(r,e,t)>0}function c(r,e,t){return s(r,e,t)<0}function u(r,e,t){return 0===s(r,e,t)}function p(r,e,t){return 0!==s(r,e,t)}function h(r,e,t){return s(r,e,t)>=0}function l(r,e,t){return s(r,e,t)<=0}function f(r,e,t,n){var i;switch(e){case"===":"object"==typeof r&&(r=r.version),"object"==typeof t&&(t=t.version),i=r===t;break;case"!==":"object"==typeof r&&(r=r.version),"object"==typeof t&&(t=t.version),i=r!==t;break;case"":case"=":case"==":i=u(r,t,n);break;case"!=":i=p(r,t,n);break;case">":i=a(r,t,n);break;case">=":i=h(r,t,n);break;case"<":i=c(r,t,n);break;case"<=":i=l(r,t,n);break;default:throw new TypeError("Invalid operator: "+e)}return i}function v(r,e){if(r instanceof v){if(r.loose===e)return r;r=r.value}if(!(this instanceof v))return new v(r,e);T("comparator",r,e),this.loose=e,this.parse(r),this.semver===dr?this.value="":this.value=this.operator+this.semver.version,T("comp",this)}function m(r,e){if(r instanceof m&&r.loose===e)return r;if(!(this instanceof m))return new m(r,e);if(this.loose=e,this.raw=r,this.set=r.split(/\s*\|\|\s*/).map(function(r){return this.parseRange(r.trim())},this).filter(function(r){return r.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+r);this.format()}function g(r,e){return T("comp",r),r=j(r,e),T("caret",r),r=y(r,e),T("tildes",r),r=b(r,e),T("xrange",r),r=k(r,e),T("stars",r),r}function w(r){return!r||"x"===r.toLowerCase()||"*"===r}function y(r,e){return r.trim().split(/\s+/).map(function(r){return d(r,e)}).join(" ")}function d(r,e){var t=e?N[or]:N[sr];return r.replace(t,function(e,t,n,i,s){T("tilde",r,e,t,n,i,s);var o;return w(t)?o="":w(n)?o=">="+t+".0.0 <"+(+t+1)+".0.0":w(i)?o=">="+t+"."+n+".0 <"+t+"."+(+n+1)+".0":s?(T("replaceTilde pr",s),"-"!==s.charAt(0)&&(s="-"+s),o=">="+t+"."+n+"."+i+s+" <"+t+"."+(+n+1)+".0"):o=">="+t+"."+n+"."+i+" <"+t+"."+(+n+1)+".0",T("tilde return",o),o})}function j(r,e){return r.trim().split(/\s+/).map(function(r){return E(r,e)}).join(" ")}function E(r,e){T("caret",r,e);var t=e?N[pr]:N[ur];return r.replace(t,function(e,t,n,i,s){T("caret",r,e,t,n,i,s);var o;return w(t)?o="":w(n)?o=">="+t+".0.0 <"+(+t+1)+".0.0":w(i)?o="0"===t?">="+t+"."+n+".0 <"+t+"."+(+n+1)+".0":">="+t+"."+n+".0 <"+(+t+1)+".0.0":s?(T("replaceCaret pr",s),"-"!==s.charAt(0)&&(s="-"+s),o="0"===t?"0"===n?">="+t+"."+n+"."+i+s+" <"+t+"."+n+"."+(+i+1):">="+t+"."+n+"."+i+s+" <"+t+"."+(+n+1)+".0":">="+t+"."+n+"."+i+s+" <"+(+t+1)+".0.0"):(T("no pr"),o="0"===t?"0"===n?">="+t+"."+n+"."+i+" <"+t+"."+n+"."+(+i+1):">="+t+"."+n+"."+i+" <"+t+"."+(+n+1)+".0":">="+t+"."+n+"."+i+" <"+(+t+1)+".0.0"),T("caret return",o),o})}function b(r,e){return T("replaceXRanges",r,e),r.split(/\s+/).map(function(r){return $(r,e)}).join(" ")}function $(r,e){r=r.trim();var t=e?N[tr]:N[er];return r.replace(t,function(e,t,n,i,s,o){T("xRange",r,e,t,n,i,s,o);var a=w(n),c=a||w(i),u=c||w(s),p=u;return"="===t&&p&&(t=""),a?e=">"===t||"<"===t?"<0.0.0":"*":t&&p?(c&&(i=0),u&&(s=0),">"===t?(t=">=",c?(n=+n+1,i=0,s=0):u&&(i=+i+1,s=0)):"<="===t&&(t="<",c?n=+n+1:i=+i+1),e=t+n+"."+i+"."+s):c?e=">="+n+".0.0 <"+(+n+1)+".0.0":u&&(e=">="+n+"."+i+".0 <"+n+"."+(+i+1)+".0"),T("xRange return",e),e})}function k(r,e){return T("replaceStars",r,e),r.trim().replace(N[gr],"")}function R(r,e,t,n,i,s,o,a,c,u,p,h,l){return e=w(t)?"":w(n)?">="+t+".0.0":w(i)?">="+t+"."+n+".0":">="+e,a=w(c)?"":w(u)?"<"+(+c+1)+".0.0":w(p)?"<"+c+"."+(+u+1)+".0":h?"<="+c+"."+u+"."+p+"-"+h:"<="+a,(e+" "+a).trim()}function S(r,e){for(t=0;t<r.length;t++)if(!r[t].test(e))return!1;if(e.prerelease.length){for(var t=0;t<r.length;t++)if(T(r[t].semver),r[t].semver!==dr&&r[t].semver.prerelease.length>0){var n=r[t].semver;if(n.major===e.major&&n.minor===e.minor&&n.patch===e.patch)return!0}return!1}return!0}function x(r,e,t){try{e=new m(e,t)}catch(r){return!1}return e.test(r)}function I(r,e,t,i){r=new n(r,i),e=new m(e,i);var s,o,u,p,f;switch(t){case">":s=a,o=l,u=c,p=">",f=">=";break;case"<":s=c,o=h,u=a,p="<",f="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(x(r,e,i))return!1;for(var g=0;g<e.set.length;++g){var w=null,y=null;if(e.set[g].forEach(function(r){r.semver===dr&&(r=new v(">=0.0.0")),w=w||r,y=y||r,s(r.semver,w.semver,i)?w=r:u(r.semver,y.semver,i)&&(y=r)}),w.operator===p||w.operator===f)return!1;if((!y.operator||y.operator===p)&&o(r,y.semver))return!1;if(y.operator===f&&u(r,y.semver))return!1}return!0}r={}.exports=n;var T;T="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var r=Array.prototype.slice.call(arguments,0);r.unshift("SEMVER"),console.log.apply(console,r)}:function(){},r.SEMVER_SPEC_VERSION="2.0.0";var V=256,A=Number.MAX_SAFE_INTEGER||9007199254740991,N=r.re=[],C=r.src=[],M=0,_=M++;C[_]="0|[1-9]\\d*";var D=M++;C[D]="[0-9]+";var X=M++;C[X]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var z=M++;C[z]="("+C[_]+")\\.("+C[_]+")\\.("+C[_]+")";var G=M++;C[G]="("+C[D]+")\\.("+C[D]+")\\.("+C[D]+")";var O=M++;C[O]="(?:"+C[_]+"|"+C[X]+")";var P=M++;C[P]="(?:"+C[D]+"|"+C[X]+")";var Z=M++;C[Z]="(?:-("+C[O]+"(?:\\."+C[O]+")*))";var q=M++;C[q]="(?:-?("+C[P]+"(?:\\."+C[P]+")*))";var B=M++;C[B]="[0-9A-Za-z-]+";var L=M++;C[L]="(?:\\+("+C[B]+"(?:\\."+C[B]+")*))";var U=M++,F="v?"+C[z]+C[Z]+"?"+C[L]+"?";C[U]="^"+F+"$";var H="[v=\\s]*"+C[G]+C[q]+"?"+C[L]+"?",J=M++;C[J]="^"+H+"$";var K=M++;C[K]="((?:<|>)?=?)";var Q=M++;C[Q]=C[D]+"|x|X|\\*";var W=M++;C[W]=C[_]+"|x|X|\\*";var Y=M++;C[Y]="[v=\\s]*("+C[W]+")(?:\\.("+C[W]+")(?:\\.("+C[W]+")(?:"+C[Z]+")?"+C[L]+"?)?)?";var rr=M++;C[rr]="[v=\\s]*("+C[Q]+")(?:\\.("+C[Q]+")(?:\\.("+C[Q]+")(?:"+C[q]+")?"+C[L]+"?)?)?";var er=M++;C[er]="^"+C[K]+"\\s*"+C[Y]+"$";var tr=M++;C[tr]="^"+C[K]+"\\s*"+C[rr]+"$";var nr=M++;C[nr]="(?:~>?)";var ir=M++;C[ir]="(\\s*)"+C[nr]+"\\s+",N[ir]=new RegExp(C[ir],"g");var sr=M++;C[sr]="^"+C[nr]+C[Y]+"$";var or=M++;C[or]="^"+C[nr]+C[rr]+"$";var ar=M++;C[ar]="(?:\\^)";var cr=M++;C[cr]="(\\s*)"+C[ar]+"\\s+",N[cr]=new RegExp(C[cr],"g");var ur=M++;C[ur]="^"+C[ar]+C[Y]+"$";var pr=M++;C[pr]="^"+C[ar]+C[rr]+"$";var hr=M++;C[hr]="^"+C[K]+"\\s*("+H+")$|^$";var lr=M++;C[lr]="^"+C[K]+"\\s*("+F+")$|^$";var fr=M++;C[fr]="(\\s*)"+C[K]+"\\s*("+H+"|"+C[Y]+")",N[fr]=new RegExp(C[fr],"g");var vr=M++;C[vr]="^\\s*("+C[Y]+")\\s+-\\s+("+C[Y]+")\\s*$";var mr=M++;C[mr]="^\\s*("+C[rr]+")\\s+-\\s+("+C[rr]+")\\s*$";var gr=M++;C[gr]="(<|>)?=?\\s*\\*";for(var wr=0;wr<M;wr++)T(wr,C[wr]),N[wr]||(N[wr]=new RegExp(C[wr]));r.parse=t,r.valid=function(r,e){var n=t(r,e);return n?n.version:null},r.clean=function(r,e){var n=t(r.trim().replace(/^[=v]+/,""),e);return n?n.version:null},r.SemVer=n,n.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},n.prototype.toString=function(){return this.version},n.prototype.compare=function(r){return T("SemVer.compare",this.version,this.loose,r),r instanceof n||(r=new n(r,this.loose)),this.compareMain(r)||this.comparePre(r)},n.prototype.compareMain=function(r){return r instanceof n||(r=new n(r,this.loose)),i(this.major,r.major)||i(this.minor,r.minor)||i(this.patch,r.patch)},n.prototype.comparePre=function(r){if(r instanceof n||(r=new n(r,this.loose)),this.prerelease.length&&!r.prerelease.length)return-1;if(!this.prerelease.length&&r.prerelease.length)return 1;if(!this.prerelease.length&&!r.prerelease.length)return 0;var e=0;do{var t=this.prerelease[e],s=r.prerelease[e];if(T("prerelease compare",e,t,s),void 0===t&&void 0===s)return 0;if(void 0===s)return 1;if(void 0===t)return-1;if(t!==s)return i(t,s)}while(++e)},n.prototype.inc=function(r,e){switch(r){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",e),this.inc("pre",e);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var t=this.prerelease.length;--t>=0;)"number"==typeof this.prerelease[t]&&(this.prerelease[t]++,t=-2);-1===t&&this.prerelease.push(0)}e&&(this.prerelease[0]===e?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error("invalid increment argument: "+r)}return this.format(),this.raw=this.version,this},r.inc=function(r,e,t,i){"string"==typeof t&&(i=t,t=void 0);try{return new n(r,t).inc(e,i).version}catch(r){return null}},r.diff=function(r,e){if(u(r,e))return null;var n=t(r),i=t(e);if(n.prerelease.length||i.prerelease.length){for(var s in n)if(("major"===s||"minor"===s||"patch"===s)&&n[s]!==i[s])return"pre"+s;return"prerelease"}for(var s in n)if(("major"===s||"minor"===s||"patch"===s)&&n[s]!==i[s])return s},r.compareIdentifiers=i;var yr=/^[0-9]+$/;r.rcompareIdentifiers=function(r,e){return i(e,r)},r.major=function(r,e){return new n(r,e).major},r.minor=function(r,e){return new n(r,e).minor},r.patch=function(r,e){return new n(r,e).patch},r.compare=s,r.compareLoose=function(r,e){return s(r,e,!0)},r.rcompare=o,r.sort=function(e,t){return e.sort(function(e,n){return r.compare(e,n,t)})},r.rsort=function(e,t){return e.sort(function(e,n){return r.rcompare(e,n,t)})},r.gt=a,r.lt=c,r.eq=u,r.neq=p,r.gte=h,r.lte=l,r.cmp=f,r.Comparator=v;var dr={};v.prototype.parse=function(r){var e=this.loose?N[hr]:N[lr],t=r.match(e);if(!t)throw new TypeError("Invalid comparator: "+r);this.operator=t[1],"="===this.operator&&(this.operator=""),t[2]?this.semver=new n(t[2],this.loose):this.semver=dr},v.prototype.toString=function(){return this.value},v.prototype.test=function(r){return T("Comparator.test",r,this.loose),this.semver===dr||("string"==typeof r&&(r=new n(r,this.loose)),f(r,this.operator,this.semver,this.loose))},r.Range=m,m.prototype.format=function(){return this.range=this.set.map(function(r){return r.join(" ").trim()}).join("||").trim(),this.range},m.prototype.toString=function(){return this.range},m.prototype.parseRange=function(r){var e=this.loose;r=r.trim(),T("range",r,e);var t=e?N[mr]:N[vr];r=r.replace(t,R),T("hyphen replace",r),r=r.replace(N[fr],"$1$2$3"),T("comparator trim",r,N[fr]),r=(r=(r=r.replace(N[ir],"$1~")).replace(N[cr],"$1^")).split(/\s+/).join(" ");var n=e?N[hr]:N[lr],i=r.split(" ").map(function(r){return g(r,e)}).join(" ").split(/\s+/);return this.loose&&(i=i.filter(function(r){return!!r.match(n)})),i=i.map(function(r){return new v(r,e)})},r.toComparators=function(r,e){return new m(r,e).set.map(function(r){return r.map(function(r){return r.value}).join(" ").trim().split(" ")})},m.prototype.test=function(r){if(!r)return!1;"string"==typeof r&&(r=new n(r,this.loose));for(var e=0;e<this.set.length;e++)if(S(this.set[e],r))return!0;return!1},r.satisfies=x,r.maxSatisfying=function(r,e,t){return r.filter(function(r){return x(r,e,t)}).sort(function(r,e){return o(r,e,t)})[0]||null},r.validRange=function(r,e){try{return new m(r,e).range||"*"}catch(r){return null}},r.ltr=function(r,e,t){return I(r,e,"<",t)},r.gtr=function(r,e,t){return I(r,e,">",t)},r.outside=I,semver=r}({});
(function runtimeDefinition(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;"object"!=typeof e.lively&&(e.lively={});var t={},r={};if(e.lively.FreezerRuntime){let[r,i,l]=(void 0).split(".").map(Number),[s,n,o]=e.lively.FreezerRuntime.version.split(".").map(Number),u=!1;if((isNaN(s)||!isNaN(r)&&r>s)&&(u=!0),!u&&(isNaN(n)||!isNaN(i)&&i>n)&&(u=!0),!u&&(isNaN(o)||!isNaN(l)&&l>o)&&(u=!0),!u)return;t=e.lively.FreezerRuntime.registry}r["@lively-env"]={executed:!0,options:{},moduleEnv(e){const t=System.get(e)||System.fetchStandaloneFor(e);return{recorder:t.recorder||t.exports}}},r["@system-env"]={executed:!0,browser:!0},e.lively.FreezerRuntime={global:window,version:void 0,registry:t,globalModules:r,get(e){return e&&e.startsWith("@")?this.globalModules[e]:this.registry[e]},set(e,t){return this.registry[e]=t},add(e,t=[],r={},i=!1){let l={id:e,dependencies:t,executed:i,exports:r,execute:function(){},setters:[]};return this.set(e,l),l},decanonicalize(t){if(e.lively.FreezerRuntime.globalModules[t])return t;let r=t.replace("lively-object-modules/","").replace(e.System.baseURL,"");if(!(r=r.includes("local://")?r:"local://"+r).match(/\@\S*\//)){let[t,...i]=r.replace("local://","").split("/"),l=Object.keys(e.lively.FreezerRuntime.registry).find(e=>e.replace("local://","").split("@")[0]==t),s=l&&l.match(/\@[\d|\.|\-|\~]*\//)[0];r="local://"+t+s+i}return r},loadObjectFromPartsbinFolder:t=>e.lively.morphic.MorphicDB.default.fetchSnapshot("part",t).then(t=>e.lively.morphic.loadMorphFromSnapshot(t,{onDeserializationStart:!1,migrations:[]})),fetchStandaloneFor(e){for(let t in this.globalModules)if(e.match(t.replace("local://","").replace(/\@.*\//,"/").replace("/index.js","")))return this.globalModules[t]},resolveSync(t,r){let i=this.get(t);if(i)return i;if(!t.includes("/")){let r=t.split("."),i=e;for(;i&&r.length;)i=i[r.shift()];if(i)return{executed:!0,exports:i,dependencies:[]}}let l=this.get(this.decanonicalize(t,r));if(l)return{executed:!0,exports:l,dependencies:[]};if(i=this.fetchStandaloneFor(t))return i;throw new Error(`Module ${t} cannot be found in lively.freezer bundle!`)},register(e,t,r){let i=this.add(e,t),l=r((e,t)=>{if("string"==typeof e)i.exports[e]=t;else for(let t in e)i.exports[t]=e[t]});return i.execute=l.execute,i.setters=l.setters,i},updateImports(e){if(e.dependencies)for(let t=0;t<e.dependencies.length;t++){let r=e.dependencies[t],i="@empty"!=r&&this.resolveSync(r,e.id);i&&e.setters[t](i.exports)}},updateDependent(e,t){for(let r=0;r<t.dependencies.length;r++){let i=t.dependencies[r];"@empty"!=i&&e==this.resolveSync(i,t.id)&&t.setters[r](e.exports)}},computeUniqDepGraphs(e){var t=[],r={},i={"@empty":[]},l={"@empty":[]};if(!e){let t={},r=lively.FreezerRuntime.registry;for(let e in r)t[e]=r[e].dependencies;e=t}for(let o in e){r.hasOwnProperty(o)||(r[o]=!0,t.push(o));var s=e[o],n={};if(s){i[o]=[];for(let e of s){if(n.hasOwnProperty(e)||o===e)continue;let s=l[e]||(l[e]=[]);s.includes(o)||s.push(o),n[e]=!0,i[o].push(e),r.hasOwnProperty(e)||(r[e]=!0,t.push(e))}}}return{uniqDepGraph:i,inverseDepGraph:l,dependencies:t}},sortForLoad(e){function t(e){return e.split("/")[0]}function r(e){return(u[n]||[]).filter(e=>!i(e)).map(e=>t(e))}function i(e){return"@empty"==e||!!lively.FreezerRuntime.globalModules[e]}function l(e,t,r=new Set){return e==t||!!u[e]&&(u[e].includes(t)||u[e].some(e=>!r.has(e)&&l(e,t,new Set([...r,...u[e]]))))}function s(e,...t){return e.filter(e=>"@empty"!=e&&!e.includes("/index.js")).every(e=>t.some(t=>t.includes(e)))}var n,{dependencies:o,uniqDepGraph:u,inverseDepGraph:p}=this.computeUniqDepGraphs(),a=[],d={};for(let e=o.length;e--;){if(n=o[e],i(n))a.push(n);else{let e=t(n);if(!l(e+"/index.js",n))continue;d[e]?(d[e].modules.push(n),d[e].deps.push(...r())):d[e]={modules:[n],deps:r()}}o.splice(e,1)}let c=o;for(var h in d)d[h].deps=new Set(d[h].deps.filter(e=>e!=h));o=Object.keys(d);let f=[];for(;o.length;){for(var g=1/0,m=[],y=[],v=[],x=0;x<o.length;x++){let e=[...d[F=o[x]].deps];e.length>g||(e.length===g&&s(e,f,m)?(m.push(F),y.push(x)):(g=e.length,s(e,f,m)&&(m=[F],y=[x])))}if(0==m.length)break;for(x=y.length;x--;){F=o[y[x]];o.splice(y[x],1)}f.push(...m)}let b=o;var S;for(var z of f){for(S=d[z].modules;S.length;){for(var g=1/0,m=[],y=[],v=[],x=0;x<S.length;x++){F=S[x];let e=u[F]||[];e.length>g||(e.length===g&&s(e,a,m)?(m.push(F),y.push(x),v.push(...p[F]||[])):(g=e.length,s(e,a,m)&&(m=[F],y=[x],v=(p[F]||[]).slice())))}if(0==m.length)break;for(x=y.length;x--;)p[F=S[y[x]]]=[],S.splice(y[x],1);for(var F of v)u[F]=u[F].filter(e=>!m.includes(e));a.push(...m)}a.push(...S)}o=c;for(var z of b)o.push(...d[z].modules);for(;o.length;){for(var g=1/0,m=[],y=[],v=[],x=0;x<o.length;x++){F=o[x];let e=u[F]||[];e.length>g||(e.length===g&&s(e,a,m)?(m.push(F),y.push(x),v.push(...p[F]||[])):(g=e.length,s(e,a,m)&&(m=[F],y=[x],v=(p[F]||[]).slice())))}if(0==m.length)break;for(x=y.length;x--;)p[F=o[y[x]]]=[],o.splice(y[x],1);for(var F of v)u[F]=u[F].filter(e=>!m.includes(e));a.push(...m)}let w=[];for(let e in a)(u[e]||[]).length&&w.push(e);return console.log("async modules due to preserved module structures: ",[...w,...o]),[a,o]},initializeClass(t,r,i=[],l=[],s={},n,o){if(void 0===r)throw Error("Superclass can not be undefined!");return e.System.initializeClass._get=e.lively.classes.runtime.initializeClass._get,e.System.initializeClass._set=e.lively.classes.runtime.initializeClass._set,lively.classes.runtime.initializeClass(t,r,i,l,s,n,o)},load(e){let[t,r]=this.sortForLoad(e),{inverseDepGraph:i}=this.computeUniqDepGraphs(),l=[...t,...r],s=e=>{(i[e.id]||[]).forEach(t=>{let r=this.get(t);try{this.updateDependent(e,r)}catch(t){e.executed=!1}})};for(let e=0;l.some(e=>this.get(e)&&!this.get(e).executed)&&e<5;e++)(e=>{for(let t of e){let e=this.get(t);if(e&&!e.executed){e.executed=!0;try{this.updateImports(e),e.execute()}catch(t){console.error(t),e.executed=!1}s(e)}}})(l);return this.get(e).exports}},e.System=e.lively.FreezerRuntime})()
!function(t){"use strict";function r(t,r,e,o){var i=Object.create((r||n).prototype),a=new h(o||[]);return i._invoke=f(t,e,a),i}function e(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(t){return{type:"throw",arg:t}}}function n(){}function o(){}function i(){}function a(t){["next","throw","return"].forEach(function(r){t[r]=function(t){return this._invoke(r,t)}})}function c(t){this.arg=t}function u(t){function r(r,e){var i=t[r](e),a=i.value;return a instanceof c?Promise.resolve(a.arg).then(n,o):Promise.resolve(a).then(function(t){return i.value=t,i})}"object"==typeof process&&process.domain&&(r=process.domain.bind(r));var e,n=r.bind(t,"next"),o=r.bind(t,"throw");r.bind(t,"return");this._invoke=function(t,n){function o(){return r(t,n)}return e=e?e.then(o,o):new Promise(function(t){t(o())})}}function f(t,r,n){var o=L;return function(i,a){if(o===b)throw new Error("Generator is already running");if(o===E){if("throw"===i)throw a;return y()}for(;;){var c=n.delegate;if(c){if("return"===i||"throw"===i&&c.iterator[i]===v){n.delegate=null;var u=c.iterator.return;if(u&&"throw"===(f=e(u,c.iterator,a)).type){i="throw",a=f.arg;continue}if("return"===i)continue}if("throw"===(f=e(c.iterator[i],c.iterator,a)).type){n.delegate=null,i="throw",a=f.arg;continue}if(i="next",a=v,!(l=f.arg).done)return o=x,l;n[c.resultName]=l.value,n.next=c.nextLoc,n.delegate=null}if("next"===i)n._sent=a,n.sent=o===x?a:v;else if("throw"===i){if(o===L)throw o=E,a;n.dispatchException(a)&&(i="next",a=v)}else"return"===i&&n.abrupt("return",a);o=b;var f=e(t,r,n);if("normal"===f.type){o=n.done?E:x;var l={value:f.arg,done:n.done};if(f.arg!==j)return l;n.delegate&&"next"===i&&(a=v)}else"throw"===f.type&&(o=E,i="throw",a=f.arg)}}}function l(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function s(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function h(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(l,this),this.reset(!0)}function p(t){if(t){var r=t[g];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var e=-1,n=function r(){for(;++e<t.length;)if(d.call(t,e))return r.value=t[e],r.done=!1,r;return r.value=v,r.done=!0,r};return n.next=n}}return{next:y}}function y(){return{value:v,done:!0}}var v,d=Object.prototype.hasOwnProperty,g="function"==typeof Symbol&&Symbol.iterator||"@@iterator",w="object"==typeof module,m=t.regeneratorRuntime;if(m)w&&(module.exports=m);else{(m=t.regeneratorRuntime=w?module.exports:{}).wrap=r;var L="suspendedStart",x="suspendedYield",b="executing",E="completed",j={},k=i.prototype=n.prototype;o.prototype=k.constructor=i,i.constructor=o,o.displayName="GeneratorFunction",m.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===o||"GeneratorFunction"===(r.displayName||r.name))},m.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i,t.prototype=Object.create(k),t},m.awrap=function(t){return new c(t)},a(u.prototype),m.async=function(t,e,n,o){var i=new u(r(t,e,n,o));return m.isGeneratorFunction(e)?i:i.next().then(function(t){return t.done?t.value:i.next()})},a(k),k[g]=function(){return this},k.toString=function(){return"[object Generator]"},m.keys=function(t){var r=[];for(var e in t)r.push(e);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},m.values=p,h.prototype={constructor:h,reset:function(t){if(this.prev=0,this.next=0,this.sent=v,this.done=!1,this.delegate=null,this.tryEntries.forEach(s),!t)for(var r in this)"t"===r.charAt(0)&&d.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=v)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){function r(r,n){return i.type="throw",i.arg=t,e.next=r,!!n}if(this.done)throw t;for(var e=this,n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var a=d.call(o,"catchLoc"),c=d.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,r){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc<=this.prev&&d.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=r&&r<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=r,o?this.next=o.finallyLoc:this.complete(i),j},complete:function(t,r){if("throw"===t.type)throw t.arg;"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=t.arg,this.next="end"):"normal"===t.type&&r&&(this.next=r)},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),s(e),j}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;s(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,e){return this.delegate={iterator:p(t),resultName:r,nextLoc:e},j}}}}("object"==typeof global?global:"object"==typeof window?window:"object"==typeof self?self:this);
//LIVELY.LANG
!function(){var GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;"undefined"==typeof GLOBAL.lively&&(GLOBAL.lively={}),function(){this.lively=this.lively||{},function(exports){"use strict";function Empty(){return function(){}}function K(){return function(e){return e}}function Null(){return function(){return null}}function False(){return function(){return!1}}function True(){return function(){return!0}}function notYetImplemented(){return function(){throw new Error("Not yet implemented")}}function all(e){var r=[];for(var n in e)e.__lookupGetter__(n)||"function"!=typeof e[n]||r.push(n);return r}function own(e){var r=[];for(var n in e)!e.__lookupGetter__(n)&&e.hasOwnProperty(n)&&"function"==typeof e[n]&&r.push(n);return r}function argumentNames(e){if(e.superclass)return[];var r=e.toString(),n="",t=r.match(/(?:\(([^\)]*)\)|([^\(\)-+!]+))\s*=>/);if(t)n=t[1]||t[2]||"";else{var o=r.match(/^[\s\(]*function[^(]*\(([^)]*)\)/);o&&o[1]&&(n=o[1])}return n.replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",").map(function(e){return e.trim()}).filter(function(e){return!!e})}function qualifiedMethodName(e){var r="";return e.declaredClass?r+=e.declaredClass+">>":e.declaredObject&&(r+=e.declaredObject+"."),r+(e.methodName||e.displayName||e.name||"anonymous")}function extractBody(e){for(var r=String(e).replace(/^function[^\{]+\{\s*/,"").replace(/\}$/,"").trim(),n=r.split(/\n|\r/),t=void 0,o=0;o<n.length;o++){var i=n[o].match(/^(\s+)[^\s]/);i&&(void 0===t||i[1].length<t.length)&&(t=i[1])}return t?r.replace(new RegExp("^"+t,"gm"),""):r}function timeToRun(e){var r=Date.now();return e(),Date.now()-r}function timeToRunN$1(e,r){for(var n=Date.now(),t=0;t<r;t++)e();return(Date.now()-n)/r}function delay(e,r){var n=Array.prototype.slice.call(arguments),t=n.shift(),r=1e3*n.shift();return setTimeout(function(){return t.apply(t,n)},r)}function throttle(e,r){var n,t,o,i,a,u,c=debounce(r,function(){a=i=!1});return function(){n=this,t=arguments;var s=function(){o=null,a&&e.apply(n,t),c()};return o||(o=setTimeout(s,r)),i?a=!0:u=e.apply(n,t),c(),i=!0,u}}function debounce(e,r,n){var t;return function(){var o=this,i=arguments,a=function(){t=null,n||r.apply(o,i)};n&&!t&&r.apply(o,i),clearTimeout(t),t=setTimeout(a,e)}}function throttleNamed(e,r,n){function t(){debounceNamed(e,r,function(){delete o[e]})(),n.apply(this,arguments)}var o=_throttledByName;return o[e]?o[e]:o[e]=throttle(t,r)}function debounceNamed(e,r,n,t){function o(){delete i[e],n.apply(this,arguments)}var i=_debouncedByName;return i[e]?i[e]:i[e]=debounce(r,o,t)}function createQueue(e,r){var n=_queues,t=n[e]||(n[e]={_workerActive:!1,worker:r,tasks:[],drain:null,push:function(e){t.tasks.push(e),t.activateWorker()},pushAll:function(e){e.forEach(function(e){t.tasks.push(e)}),t.activateWorker()},pushNoActivate:function(e){t.tasks.push(e)},handleError:function(e){e&&console.error("Error in queue: "+e)},activateWorker:function(){function r(e){t.handleError(e),t.activateWorker()}var o=t.tasks,i=t._workerActive;if(0===o.length)i&&(t._workerActive=!1,"function"==typeof t.drain&&t.drain()),delete n[e];else{i||(t._workerActive=!0);try{t.worker(o.shift(),r)}catch(e){r(e)}}}});return t}function workerWithCallbackQueue(e,r,n){function t(){l&&clearTimeout(l),c=!0,delete i[e]}function o(r){c||(t(),a.callbacks.forEach(function(n){try{n.apply(null,r)}catch(r){console.error("Error when invoking callbacks in queueUntil ["+e+"]:\n"+String(r.stack||r))}}))}var i=_queueUntilCallbacks,a=i[e],u=!!a;if(u)return a;var c=!1,s=!1;if(n)var l=setTimeout(function(){c||o([new Error("timeout")])},n);return a=i[e]={callbacks:[],cancel:function(){s=!0,t()},whenDone:function(e){return a.callbacks.push(e),a}},setTimeout(function(){if(!s)try{r(function(){o(arguments)})}catch(e){o([e])}},0),a}function _composeAsyncDefaultEndCallback(e,r){e&&console.error("lively.lang.composeAsync error",e)}function composeAsync(){var e,r,n=Array.prototype.slice,t=n.call(arguments),o=_composeAsyncDefaultEndCallback,i=o,a=new Promise(function(n,t){e=n,r=t});return t.reverse().reduce(function(e,u,c){var s=!1;return function(){function l(){s=!0;var t=n.call(arguments),o=t.shift();o?(i(o),r(o)):e.apply(null,t)}var f=n.call(arguments);if(i===o&&c===t.length-1){for(;f.length&&"function"!=typeof f[f.length-1];)f.pop();"function"==typeof f[f.length-1]&&(i=f.pop())}if("function"==typeof u)try{var p=u.apply(this,f.concat([l]));p&&"function"==typeof p.then&&"function"==typeof p.catch&&p.then(function(e){return l(null,e)}).catch(function(e){return l(e)})}catch(e){console.error("composeAsync: ",e.stack||e),s||(i(e),r(e))}else if(u&&"function"==typeof u.then&&"function"==typeof u.catch)u.then(function(e){l(null,e)}).catch(function(e){l(e)});else{var h=new Error("Invalid argument to composeAsync: "+u);i(h),r(h)}return a}},function(){var r=n.call(arguments);i.apply(null,[null].concat(r)),e(r[0])})}function compose(){var e=Array.prototype.slice.call(arguments);return e.reverse().reduce(function(e,r){return function(){return e(r.apply(this,arguments))}},function(e){return e})}function flip(e){return function(){var r=Array.prototype.slice.call(arguments),n=[r[1],r[0]].concat(r.slice(2));return e.apply(null,n)}}function withNull(e){return e=e||function(){},function(){var r=lively.lang.arr.from(arguments);e.apply(null,[null].concat(r))}}function waitFor(e,r,n){var t=Date.now(),o=50;n||(n=r,r=e,e=void 0),function i(){if(r())return n();if(e){var a=Date.now()-t,u=e-a;if(u<=0)return n(new Error("timeout"));u<o&&(o=u)}setTimeout(i,o)}()}function waitForAll(e,r,n){function t(e,r,t,a){if(i.length){var u=null,c=i.indexOf(e);c>-1&&i.splice(c,1),t?(i.length=0,u=new Error("in waitForAll at"+("number"==typeof r?" "+r:"")+": \n"+(t.stack||String(t)))):a&&(o[r]=a),i.length||setTimeout(function(){n(u,o)},0)}}n||(n=r,r=e,e=null),e=e||{};var o=r.map(function(){return null});if(!r.length)return void n(null,o);var i=Array.prototype.slice.call(r);r.forEach(function(e,r){try{e(function(){var n=Array.prototype.slice.call(arguments),o=n.shift();t(e,r,o,n)})}catch(n){t(e,r,n,null)}}),e.timeout&&setTimeout(function(){if(i.length){var e=o.map(function(e,r){return null===e&&r}).filter(function(e){return"number"==typeof e}).join(", "),r=new Error("waitForAll timed out, functions at "+e+" not done");t(null,null,r,null)}},e.timeout)}function curry(e,r,n,t){function o(){return e.apply(this,i.concat(Array.prototype.slice.call(arguments)))}if(arguments.length<=1)return arguments[0];var i=Array.prototype.slice.call(arguments),e=i.shift();return o.isWrapper=!0,o.originalFunction=e,o}function wrap(e,r){var n=e,t=function(){var e=Array.prototype.slice.call(arguments),t=r.isWrapper?e:[n.bind(this)].concat(e);return r.apply(this,t)};return t.isWrapper=!0,t.originalFunction=n,t}function getOriginal(e){for(;e.originalFunction;)e=e.originalFunction;return e}function wrapperChain(e){var r=[];do r.push(e),e=e.originalFunction;while(e);return r}function replaceMethodForOneCall(e,r,n){n.originalFunction=e[r];var t=e.hasOwnProperty(r);return e[r]=function(){return t?e[r]=n.originalFunction:delete e[r],n.apply(this,arguments)},e}function once(e){if(e){if("function"!=typeof e)throw new Error("once() expecting a function");var r,n=!1;return function(){return n?r:(n=!0,r=e.apply(this,arguments))}}}function either(){var e=Array.prototype.slice.call(arguments),r=!1;return e.map(function(e){return function(){if(!r)return r=!0,e.apply(this,arguments)}})}function eitherNamed(e,r){var n=Array.prototype.slice.call(arguments),t=_eitherNameRegistry,e=n.shift(),o=t[e]||(t[e]={wasCalled:!1,callsLeft:0});return o.callsLeft++,function(){if(o.callsLeft--,o.callsLeft<=0&&delete t[e],!o.wasCalled)return o.wasCalled=!0,r.apply(this,arguments)}}function evalJS(src){return eval(src)}function fromString(e){return evalJS("("+e.toString()+");")}function asScript(e,r){return Closure.fromFunction(e,r).recreateFunc()}function asScriptOf(e,r,n,t){var o=n||e.name;if(!o)throw Error("Function that wants to be a script needs a name: "+this);var i=Object.getPrototypeOf(r),a={this:r};if(t&&(a=merge([a,t])),i&&i[o]){var u=function(){try{return Object.getPrototypeOf(r)[o].apply(r,arguments)}catch(e){return"undefined"!=typeof $world?$world.logError(e,"Error in $super call"):console.error("Error in $super call: "+e+"\n"+e.stack),null}};a.$super=Closure.fromFunction(u,{obj:r,name:o}).recreateFunc()}return addToObject(asScript(e,a),r,o)}function addToObject(e,r,n){e.displayName=n;var t=r.attributeConnections?r.attributeConnections.filter(function(e){return"update"===e.getSourceAttrName()}):[];return t&&t.forEach(function(e){e.disconnect()}),r[n]=e,("undefined"==typeof r?"undefined":_typeof(r))&&(e.declaredObject=safeToString(r)),"undefined"!=typeof lively&&r&&lively.Tracing&&lively.Tracing.stackTracingEnabled&&lively.Tracing.instrumentMethod(r,n,{declaredObject:safeToString(r)}),t&&t.forEach(function(e){e.connect()}),e}function binds(e,r){return Closure.fromFunction(e,r||{}).recreateFunc()}function setLocalVarValue(e,r,n){e.hasLivelyClosure&&(e.livelyClosure.funcProperties[r]=n)}function getVarMapping(e){return e.hasLivelyClosure?e.livelyClosure.varMapping:e.isWrapper?e.originalFunction.varMapping:e.varMapping?e.varMapping:{}}function setProperty(e,r,n){e[r]=n,e.hasLivelyClosure&&(e.livelyClosure.funcProperties[r]=n)}function functionNames(e){for(var r=[],n=e.prototype;n;)r=Object.keys(n).reduce(function(e,r){return"function"==typeof n[r]&&e.indexOf(r)===-1&&e.push(r),e},r),n=Object.getPrototypeOf(n);return r}function localFunctionNames(e){return Object.keys(e.prototype).filter(function(r){return"function"==typeof e.prototype[r]})}function logErrors(e,r){var n=function(n){var t=Array.prototype.slice.call(arguments);t.shift();try{return n.apply(e,t)}catch(n){if("undefined"!=typeof lively&&lively.morphic&&lively.morphic.World&&lively.morphic.World.current())throw lively.morphic.World.current().logError(n),n;throw r?console.warn("ERROR: %s.%s(%s): err: %s %s",e,r,t,n,n.stack||""):console.warn("ERROR: %s %s",n,n.stack||""),n}};n.methodName="$logErrorsAdvice";var t=wrap(e,n);return t.originalFunction=e,t.methodName="$logErrorsWrapper",t}function logCompletion(e,r){var n=function(n){var t=Array.prototype.slice.call(arguments);t.shift();try{var o=n.apply(e,t)}catch(e){throw console.warn("failed to load "+r+": "+e),"undefined"!=typeof lively&&lively.lang.Execution&&lively.lang.Execution.showStack(),e}return console.log("completed "+r),o};n.methodName="$logCompletionAdvice::"+r;var t=wrap(e,n);return t.methodName="$logCompletionWrapper::"+r,t.originalFunction=e,t}function logCalls(e,r){var n=e,t=function(t){var i=Array.prototype.slice.call(arguments);return i.shift(),o=t.apply(e,i),r?console.warn("%s(%s) -> %s",qualifiedMethodName(n),i,o):console.log("%s(%s) -> %s",qualifiedMethodName(n),i,o),o};t.methodName="$logCallsAdvice::"+qualifiedMethodName(e);var o=wrap(e,t);return o.originalFunction=e,o.methodName="$logCallsWrapper::"+qualifiedMethodName(e),o}function traceCalls(e,r){var n=function(n){var t=Array.prototype.slice.call(arguments);t.shift(),r.push(t);var o=n.apply(e,t);return r.pop(),o};return wrap(e,n)}function webkitStack(){try{throw new Error}catch(e){return String(e.stack).split(/\n/).slice(2).map(function(e){return e.replace(/^\s*at\s*([^\s]+).*/,"$1")}).join("\n")}}function range(e,r,n){n=n||0;var t=[];if(e<=r){n<=0&&(n=-n||1);for(var o=e;o<=r;o+=n)t.push(o)}else{n>=0&&(n=-n||-1);for(var o=e;o>=r;o+=n)t.push(o)}return t}function withN(e,r){for(var n=new Array(e);e>0;)n[--e]=r;return n}function genN(e,r){for(var n=new Array(e);e>0;)n[--e]=r(e);return n}function filter(e,r,n){return e.filter(r,n)}function findAndGet(e,r){var n;return e.find(function(e,t){return n=r(e,t)}),n}function filterByKey(e,r){return e.filter(function(e){return!!e[r]})}function grep(e,r,n){return"string"==typeof r&&(r=new RegExp(r,"i")),e.filter(r.test.bind(r))}function mask(e,r){return e.filter(function(e,n){return!!r[n]})}function reject(e,r,n){function t(e,t){return!r.call(n,e,t)}return e.filter(t)}function rejectByKey(e,r){return e.filter(function(e){return!e[r]})}function without(e,r){return e.filter(function(e){return e!==r})}function withoutAll(e,r){return e.filter(function(e){return r.indexOf(e)===-1})}function uniq(e,r){if(!e.length)return e;var n=[e[0]];if(r)for(var t=1;t<e.length;t++){var o=e[t];o!==n[n.length]&&n.push(o)}else for(var i=1;i<e.length;i++){var a=e[i];n.indexOf(a)===-1&&n.push(a)}return n}function uniqBy(e,r,n){for(var t=e.slice(),o=t.length;o--;)for(var i=e[o],a=o+1;a<t.length;a++)r.call(n,i,t[a])&&t.splice(a--,1);return t}function uniqByKey(e,r){for(var n={},t=[],o=0;o<e.length;o++){var i=e[o];n[i[r]]||(n[i[r]]=!0,t.push(i))}return t}function compact(e){return e.filter(Boolean)}function mutableCompact(e){for(var r=0,n=0,t=e.length;r<t;)e.hasOwnProperty(r)&&(e[n++]=e[r]),r++;for(;n++<t;)e.pop();return e}function forEach$1(e,r,n){return e.forEach(r,n)}function zip(){var e=Array.from(arguments),r=e.shift(),n="function"==typeof last(e)?e.pop():function(e){return e},t=[r].concat(e).map(function(e){return Array.from(e)});return r.map(function(e,r){return n(pluck(t,r),r)})}function flatten(e,r){if("number"==typeof r){if(r<=0)return e;r--}return e.reduce(function(e,n){return e.concat(Array.isArray(n)?flatten(n,r):[n])},[])}function flatmap(e,r,n){for(var t=[],o=0;o<e.length;o++)t.push.apply(t,r.call(n,e[o],o));return t}function interpose(e,r){return e.reduce(function(e,n){return e.length>0&&e.push(r),e.push(n),e},[])}function delimWith(e,r){return interpose(e,r)}function map$1(e,r,n){return e.map(r,n)}function invoke(e,r,n,t,o,i,a,u){return e.map(function(e){return e[r](n,t,o,i,a,u)})}function pluck(e,r){return e.map(function(e){return e[r]})}function reduce(e,r,n,t){return e.reduce(r,n,t)}function reduceRight(e,r,n,t){return e.reduceRight(r,n,t)}function some(e,r,n){return e.some(r,n)}function every(e,r,n){return e.every(r,n)}function equals$2(e,r){var n=e.length;if(!r||n!==r.length)return!1;for(var t=0;t<n;t++){if(e[t]&&r[t]&&e[t].equals&&r[t].equals){if(e[t].equals(r[t]))continue;return!1}if(e[t]!=r[t])return!1}return!0}function deepEquals(e,r){var n=e.length;if(!r||n!==r.length)return!1;for(var t=0;t<n;t++)if(!equals$1(e[t],r[t]))return!1;return!0}function isSorted(e,r){if(r){for(var n=1;n<e.length;n++)if(e[n-1]<e[n])return!1}else for(var n=1;n<e.length;n++)if(e[n-1]>e[n])return!1;return!0}function sort(e,r){return e.sort(r)}function sortBy(e,r,n){return pluck(e.map(function(e,t){return{value:e,criteria:r.call(n,e,t)}}).sort(function(e,r){var n=e.criteria,t=r.criteria;return n<t?-1:n>t?1:0}),"value")}function sortByKey(e,r){return sortBy(e,function(e){return e[r]})}function reverse(e){return e.reverse()}function reversed(e){return e.slice().reverse()}function reMatches$1(e,r,n){return n=n||String,e.map(function(e){return n(e).match(r)})}function first(e){return e[0]}function last(e){return e[e.length-1]}function intersect(e,r){return uniq(e).filter(function(e){return r.indexOf(e)>-1})}function union(e,r){for(var n=e.slice(),t=0;t<r.length;t++){var o=r[t];n.indexOf(o)===-1&&n.push(o)}return n}function pushAt(e,r,n){e.splice(n,0,r)}function removeAt(e,r){e.splice(r,1)}function remove(e,r){var n=e.indexOf(r);return n>=0&&removeAt(e,n),r}function pushAll$1(e,r){return e.push.apply(e,r),e}function pushAllAt(e,r,n){e.splice.apply(e,[n,0].concat(r))}function pushIfNotIncluded(e,r){e.includes(r)||e.push(r)}function replaceAt(e,r,n){e.splice(n,1,r)}function clear(e){return e.length=0,e}function isSubset(e,r){for(var n=0;n<e.length;n++)if(!r.includes(e[n]))return!1;return!0}function doAndContinue(e,r,n,t){return n=n||Null,t=t||GLOBAL$1,r=r||function(e,r,n){r.call(t,e,n)},e.reduceRight(function(e,n,o){return function(){r.call(t,e,n,o)}},n)()}function nestedDelay(e,r,n,t,o,i){return t=t||function(){},e.clone().reverse().reduce(function(e,t,a){return function(){r.call(o||GLOBAL$1,t,a),i&&a%i!==0?e():e.delay(n)}},t)()}function forEachShowingProgress(){var e,r,n,t,o,i=Array.from(arguments),a=i.shift(),u=a.length,c=!1;if(1===i.length?(e=i[0].progressBar,r=i[0].iterator,n=i[0].labelFunction,t=i[0].whenDone,o=i[0].context):(e=i[0],r=i[1],n=i[2],t=i[3],o=i[4]),o||(o="undefined"!=typeof window?window:global),n||(n=function(e){return e}),!e){c=!0;var s="undefined"!=typeof window?window:global,l=s.lively&&lively.morphic&&lively.morphic.World.current();e=l?l.addProgressBar():{setValue:function(e){},setLabel:function(){},remove:function(){}}}return e.setValue(0),a.reduceRight(function(t,i,a){return function(){try{e.setValue(a/u),n&&e.setLabel(n.call(o,i,a)),r.call(o,i,a)}catch(e){console.error("Error in forEachShowingProgress at %s (%s)\n%s\n%s",a,i,e,e.stack)}t.delay(0)}},function(){e.setValue(1),c&&function(){e.remove()}.delay(0),t&&t.call(o)})(),a}function swap(e,r,n){r<0&&(r=e.length+r),n<0&&(n=e.length+n);var t=e[r];return e[r]=e[n],e[n]=t,e}function rotate(e,r){return r=r||1,e.slice(r).concat(e.slice(0,r))}function groupBy(e,r,n){return Group.fromArray(e,r,n)}function groupByKey(e,r){return groupBy(e,function(e){return e[r]})}function partition(e,r,n){r=r||function(e){return e};var t=[],o=[];return e.forEach(function(e,i){(r.call(n,e,i)?t:o).push(e)}),[t,o]}function batchify(e,r,n){function t(e,o){if(!o.length)return[e,[]];var i=o[0],a=o.slice(1),u=e.concat([i]);if(r.call(n,u))return t(u,a);var c=t(e,a);return[c[0],[i].concat(c[1])]}function o(e,r){if(!r.length)return e;var n=t([],r);if(!n[0].length)throw new Error("Batchify constrained does not ensure consumption of at least one item per batch!");return o(e.concat([n[0]]),n[1])}return o([],e)}function toTuples(e,r){return r=r||1,range(0,Math.ceil(e.length/r)-1).map(function(n){return e.slice(n*r,n*r+r)},e)}function combinationsPick(e,r){for(var n=e.map(function(e,n){return e[r[n]]}),t=r.slice(),o=e.length;o--;o>=0){var i=e[o],a=t[o]+1;if(i[a]){t[o]=a;break}if(0===o){t=void 0;break}t[o]=0}return[n,t]}function combinations(e){for(var r=e.reduce(function(e,r){return e*r.length},1),n=e.map(function(e){return 0}),t=new Array(r),o=0;o<r;o++){var i=combinationsPick(e,n);t[o]=i[0],n=i[1]}return t}function take(e,r){return e.slice(0,r)}function drop(e,r){return e.slice(r)}function takeWhile(e,r,n){for(var t=0;t<e.length&&r.call(n,e[t],t);t++);return e.slice(0,t)}function dropWhile(e,r,n){for(var t=0;t<e.length&&r.call(n,e[t],t);t++);return e.slice(t)}function shuffle(e){for(var r=range(0,e.length-1),n=Array(e.length),t=0;t<e.length;t++){var o=r.splice(Math.round(Math.random()*(r.length-1)),1);n[o]=e[t]}return n}function max(e,r,n){r=r||function(e){return e};var t;return e.reduce(function(e,o,i){var a=r.call(n,o,i);return"number"!=typeof a||a<=e?e:(t=o,a)},-(1/0)),t}function min(e,r,n){return r=r||function(e){return e},max(e,function(e,t){return-r.call(n,e,t)})}function sum(e){for(var r=0,n=0;n<e.length;n++)r+=e[n];return r}function count$1(e,r){return e.reduce(function(e,n){return n===r?e+1:e},0)}function size$1(e){return e.length}function histogram(e,r){if("undefined"==typeof r||"number"==typeof r){var n=r||function(){return Math.ceil(Math.log(e.length)/Math.log(2)+1)}(e),t=Math.ceil(Math.round(e.length/n));return range(0,n-1).map(function(r){return e.slice(r*t,(r+1)*t)})}if(r instanceof Array){var o=r;return e.reduce(function(e,r){if(r<o[1])return e[0].push(r),e;for(var n=1;n<o.length;n++)if(r>=o[n]&&(!o[n+1]||r<=o[n+1]))return e[n].push(r),e;throw new Error("Histogram creation: Cannot group data "+r+" into thresholds "+o)},range(1,o.length).map(function(){return[]}))}}function clone$1(e){return[].concat(e)}function toArray$3(e){return from(e)}function each(e,r,n){return e.forEach(r,n)}function all$1(e,r,n){return e.every(r,n)}function any(e,r,n){return e.some(r,n)}function collect(e,r,n){return e.map(r,n)}function findAll(e,r,n){return e.filter(r,n)}function inject(e,r,n,t){return t&&(n=n.bind(t)),e.reduce(n,r)}function mapAsyncSeries(e,r,n){function t(e,r){if(!i&&(e||r)){i=!0;try{n(e,o)}catch(e){console.error("Error in mapAsyncSeries - callback invocation error:\n"+(e.stack||e))}}}var o=[],i=!1;return e.reduceRight(function(e,n,a){if(!i)return function(i,u){if(i)return t(i);a>0&&o.push(u);try{r(n,a,once(e))}catch(e){t(e)}}},function(e,r){o.push(r),t(e,!0)})()}function mapAsync(e,r,n,t){function o(){for(;l<r.parallel&&s<e.length;)f[s++]()}function i(r,n){if(!(u.indexOf(r)>-1||(u.push(r),l--,c))){if(!n&&u.length<e.length)return void o();c=!0;try{t&&t(n,a)}catch(e){console.error("Error in mapAsync - main callback invocation error:\n"+(e.stack||e))}}}if("function"==typeof r&&(t=n,n=r,r=null),r=r||{},!e.length)return t&&t(null,[]);r.parallel||(r.parallel=1/0);var a=[],u=[],c=!1,s=0,l=0,f=e.map(function(e,r){return function(){l++;try{n(e,r,once(function(e,n){a[r]=e||n,i(r,e)}))}catch(e){i(r,e)}}});return o()}function print$1(e){if(e&&Array.isArray(e))return"["+e.map(print$1)+"]";if("string"!=typeof e)return String(e);var r=String(e);return r=r.replace(/\n/g,"\\n\\\n"),r=r.replace(/(")/g,"\\$1"),r='"'+r+'"'}function indent$1(e,r,n){if(!n||n<=0)return e;for(;n>0;)n--,e=r+e;return e}function isArray$$1(e){return Array.isArray(e)}function isElement(e){return e&&1==e.nodeType}function isFunction(e){return e instanceof Function}function isBoolean(e){return"boolean"==typeof e}function isString(e){return"string"==typeof e}function isNumber(e){return"number"==typeof e}function isUndefined(e){return"undefined"==typeof e}function isRegExp(e){return e instanceof RegExp}function isObject(e){return"object"==("undefined"==typeof e?"undefined":_typeof(e))}function isPrimitive(e){if(!e)return!0;switch("undefined"==typeof e?"undefined":_typeof(e)){case"string":case"number":case"boolean":return!0}return!1}function isEmpty(e){for(var r in e)if(e.hasOwnProperty(r))return!1;return!0}function equals$1(e,r){if(e===r)return!0;if(!e||!r)return e==r;if(Array.isArray(e))return deepEquals(e,r);switch(e.constructor){case String:case Date:case Boolean:case Number:return e==r}if("function"==typeof e.isEqualNode)return e.isEqualNode(r);if("function"==typeof e.equals)return e.equals(r);var n=[];for(var t in e)if(n.push(t),"function"!=typeof e[t]&&!equals$1(e[t],r[t]))return!1;for(var t in r)if(n.indexOf(t)===-1&&"function"!=typeof r[t]&&!equals$1(r[t],e[t]))return!1;return!0}function values(e){return e?Object.keys(e).map(function(r){return e[r]}):[]}function select(e,r){for(var n={},t=0;t<r.length;t++)n[r[t]]=e[r[t]];return n}function dissoc(e,r){e=e||{};for(var n=getOwnPropertyDescriptors(e),t=0;t<r.length;t++)r[t]in n&&delete n[r[t]];return Object.defineProperties({},n)}function addScript(e,r,n,t){var o=fromString(r);return asScriptOf(o,e,n,t)}function extend(e,r){for(var n=null,t=1;t<arguments.length;t++)if("string"!=typeof arguments[t]){var r=arguments[t];for(var o in r){var i=r.__lookupGetter__(o),a=r.__lookupSetter__(o);if(i&&e.__defineGetter__(o,i),a&&e.__defineSetter__(o,a),!i&&!a){var u=r[o];e[o]=u,n&&n.push(o),"function"==typeof u&&(u.displayName||(u.displayName=o),"undefined"!=typeof lively&&lively.Module&&lively.Module.current&&(u.sourceModule=lively.Module.current()))}}}else{var c=arguments[t];e.categories||(e.categories={}),e.categories[c]||(e.categories[c]=[]),n=e.categories[c]}return e}function clone$$1(e){if(isPrimitive(e))return e;if(Array.isArray(e))return Array.prototype.slice.call(e);var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return r}function extract(e,r,n){for(var t={},o=0;o<r.length;o++)r[o]in e&&(t[r[o]]=n?n(r[o],e[r[o]]):e[r[o]]);return t}function inspect(e,r,n){if(r=r||{},n=n||0,r.customPrinter){var t=r._ignoreSignal||(r._ignoreSignal={}),o=function(e){return inspect(e,r,n+1)},i=r.customPrinter(e,t,o);if(i!==t)return i}if(!e)return print$1(e);if("function"==typeof e)return r.printFunctionSource?String(e):"function"+(e.name?" "+e.name:"")+"("+argumentNames(e).join(",")+") {/*...*/}";switch(e.constructor){case String:case Boolean:case RegExp:case Number:return print$1(e)}if("function"==typeof e.serializeExpr)return e.serializeExpr();var a=e&&Array.isArray(e),u=a?"[":"{",c=a?"]":"}";if(r.maxDepth&&n>=r.maxDepth)return u+"/*...*/"+c;var s=[];if(a)s=e.map(function(e){return inspect(e,r,n+1)});else for(var l=Object.keys(e).sort(function(r,n){var t="function"==typeof e[r],o="function"==typeof e[n];return t===o?r<n?-1:r>n?1:0:t?1:-1}),f=0;f<l.length;f++){if(f>(r.maxNumberOfKeys||1/0)){var p=l.length-f;s.push("..."+p+" hidden "+(p>1?"entries":"entry")+"...");break}var h=l[f];a&&inspect(e[h],r,n+1);var d=inspect(e[h],r,n+1);s.push(r.escapeKeys?JSON.stringify(h):h+": "+d)}if(0===s.length)return u+c;var g=s.join(", "),y=(!a||r.newLineInArrays)&&(!r.minLengthForNewLine||g.length>=r.minLengthForNewLine),m=indent$1("",r.indent||"  ",n),v=indent$1("",r.indent||"  ",n+1),w=y&&!a?"\n"+v:"",b=y?"\n"+v:"",k=y&&!a?"\n"+m:"";return y&&(g=s.join(","+b)),u+w+g+k+c}function merge(e){return arguments.length>1?merge(Array.prototype.slice.call(arguments)):Array.isArray(e[0])?Array.prototype.concat.apply([],e):e.reduce(function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n]);return e},{})}function deepMerge(e,r){if(!e)return r;if(!r)return e;if(Array.isArray(e)){if(!Array.isArray(r))return r;var n=e.map(function(e,n){return deepMerge(e,r[n])});return r.length>e.length&&(n=n.concat(r.slice(e.length))),n}return"object"!==("undefined"==typeof e?"undefined":_typeof(e))||"object"!==("undefined"==typeof r?"undefined":_typeof(r))?r:Object.keys(e).concat(Object.keys(r)).reduce(function(n,t){return e[t]?r[t]?"object"!==_typeof(e[t])||"object"!==_typeof(r[t])?n[t]=r[t]:n[t]=deepMerge(e[t],r[t]):n[t]=e[t]:n[t]=r[t],n},{})}function sortKeysWithBeforeAndAfterConstraints(e){var r=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],[]),n=[],t=[];for(var o in e){var i=e[o],a=i.hasOwnProperty("before")?i.before:i.before=[],u=i.hasOwnProperty("after")?i.after:i.after=[];r.push(o),n.push(i);for(var c=a.length;c--;){var s=a[c],l=e[s];l?(l.hasOwnProperty("after")||(l.after=[]),l.after.push(o)):(console.warn("[initializeProperties] "+this+" sortProperties: "+("Property "+o+" requires to be initialized before "+s+" ")+"but that property cannot be found."),a.splice(c,1))}for(var f=u.length;f--;){var p=u[f],h=e[p];h||(console.warn("[initializeProperties] "+this+" sortProperties: "+("Property "+o+" requires to be initialized after "+p+" ")+"but that property cannot be found."),u.splice(f,1))}t.push(o)}for(var d=[],g=[],y=t.length+1;t.length;){if(y===t.length)throw new Error("Circular dependencies in handler order, could not resolve properties "+t.map(function(r){var n=e[r].before,t=e[r].after;if(!(n&&n.length||t&&t.length))return"";var o=r+"\n";return n&&n.length&&(o+="  - before "+n.join(",")+"\n"),t&&t.length&&(o+="  - after "+t.join(",")+"\n"),o}).join(""));y=t.length;for(var m=[],v=t.length;v--;){var w=t[v];isSubset(e[w].after,g)&&(t.splice(v,1),g.push(w),m.push(w))}d.push(m)}return flatten(d,1)}function inherit(e){return Object.create(e)}function valuesInPropertyHierarchy(e,r){for(var n=[],t=e;t;)t.hasOwnProperty(r)&&n.unshift(t[r]),t=Object.getPrototypeOf(t);return n}function mergePropertyInHierarchy(e,r){return merge(valuesInPropertyHierarchy(e,r))}function deepCopy(e){if(!e||"object"!==("undefined"==typeof e?"undefined":_typeof(e))||e instanceof RegExp)return e;var r=Array.isArray(e)?Array(e.length):{};for(var n in e)e.hasOwnProperty(n)&&(r[n]=deepCopy(e[n]));return r}function typeStringOf(e){return null===e?"null":"undefined"==typeof e?"undefined":e.constructor.name}function shortPrintStringOf(e){function r(e,r,t,o){e.constructor.name===r&&(n+=t,(e.length||Object.keys(e).length)&&(n+="..."),n+=o)}if(!isMutableType(e))return safeToString(e);if("Object"!==e.constructor.name&&!Array.isArray(e)&&e.constructor.name)return e.constructor.name?e.constructor.name:Object.prototype.toString.call(e).split(" ")[1].split("]")[0];var n="";return r(e,"Object","{","}"),r(e,"Array","[","]"),n}function isMutableType(e){var r=["null","undefined","Boolean","Number","String"];return r.indexOf(typeStringOf(e))===-1}function safeToString(e){try{return(e?e.toString():String(e)).replace("\n","")}catch(e){return"<error printing object>"}}function asObject(e){switch("undefined"==typeof e?"undefined":_typeof(e)){case"string":return new String(e);case"boolean":return new Boolean(e);case"number":return new Number(e);default:return e}}function newKeyIn(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"_",t=1;do r=n+"-"+t++;while(r in e);return r}function format(){return formatFromArray(Array.prototype.slice.call(arguments))}function formatFromArray(e){function r(e,r){return""+e}function n(e,r){return e.toString()}function t(e,r,n){return n>-1?e.toFixed(n):e.toString()}function o(e,r){return inspect(e)}function i(e){for(var r=[],n=c.exec(e);n;n=c.exec(e)){var t=n[8]||n[5],i=t in u?u[t]:o,a=n[3]?parseInt(n[3]):"."==n[4]?-1:0;r.push(e.substr(0,"%"==n[0][0]?n.index:n.index+1)),r.push({appender:i,precision:a}),e=e.substr(n.index+n[0].length)}return e&&r.push(e.toString()),r}var a=e.shift();a||console.log("Error in Strings>>formatFromArray, first arg is undefined");for(var u={s:r,d:n,i:n,f:t,o:o},c=/((^%|[^\\]%)(\d+)?(\.)([a-zA-Z]))|((^%|[^\\]%)([a-zA-Z]))/,s=i(a),l="",f=0,p=0;p<s.length;++p){var h=s[p];if(h&&"object"==("undefined"==typeof h?"undefined":_typeof(h))){var d=e[f++];l+=(h.appender||r)(d,l,h.precision)}else l+=r(h,l)}return l}function indent(e,r,n){if(!n||n<=0)return e;for(var t="";n>0;)n--,t+=r;return lines(e).map(function(e){return t+e}).join("\n")}function minIndent(e,r){r||(r="  ");var n=new RegExp("^("+r+")*","gm");return min(e.match(n).map(function(e){return Math.floor(e.length/r.length)}))}function changeIndent(e,r,n){r||(r="  "),n||(n=0);var t=minIndent(e,r);if(t===n)return e;if(t<n)return indent(e,r,n-t);var o=r.repeat(t-n);return lines(e).map(function(e){return e.slice(o.length)}).join("\n")}function quote(e){return'"'+e.replace(/"/g,'\\"')+'"'}function print(e){if(e&&Array.isArray(e))return"["+e.map(print)+"]";if("string"!=typeof e)return String(e);var r=String(e);return r=r.replace(/\n/g,"\\n\\\n"),r=r.replace(/(")/g,"\\$1"),r='"'+r+'"'}function printNested(e,r){return r=r||0,e.reduce(function(e,n){return e+=Array.isArray(n)?printNested(n,r+1):indent(n+"\n","  ",r)},"")}function pad(e,r,n){return n?" ".repeat(r)+e:e+" ".repeat(r)}function printTable(e,r){function n(e){return!i&&(!!a||r&&Array.isArray(r.align)&&"right"===r.align[e])}var t=[],o=r&&r.separator||" ",i=!r||!r.align||"left"===r.align,a=r&&"right"===r.align;return e.forEach(function(e){e.forEach(function(e,r){void 0===t[r]&&(t[r]=0),t[r]=Math.max(t[r],String(e).length)})}),e.map(function(e){return e.map(function(e,r){var o=String(e);return pad(o,t[r]-o.length,n(r))}).join(o)}).join("\n")}function printTree(e,r,n,t){function o(e,a,u){i[a]=t.repeat(e)+r(u,e);var c=n(u,e),s=a+1;if(!c||!c.length)return s;var l=s,f=c.length-1;return c.forEach(function(r,n){s=o(e+1,s,r);for(var a=f===n,u=i[l].split(""),c=e*t.length+1,p=e*t.length+t.length,n=c;n<p;n++)u[n]="-";a&&(u[e*t.length]="\\"),i[l]=u.join(""),a||i.slice(l,s).forEach(function(r,n){var o=r.split("");o[e*t.length]="|",i[l+n]=o.join("")}),l=s}),s}var i=[];return t=t||"  ",o(0,0,e),i.join("\n")}function toArray$1(e){return e.split("")}function lines(e){return e.split(/\n\r?/)}function paragraphs(e,r){function n(e){return/^\s*$/.test(e)}var t=r?r.sep:"\n\n";return r&&r.keepEmptyLines?e.split("\n").concat("").reduce(function(e,r){var t=e[0],o=e[1];return n(o)===n(r)?o+="\n"+r:(o.length&&t.push(o),o=r),[t,o]},[[],""])[0]:e.split(new RegExp(t+"+"))}function nonEmptyLines(e){return lines(e).compact()}function tokens(e,r){return e.split(r||/\s+/).filter(function(e){return!/^\s*$/.test(e)})}function tableize(e,r){r=r||{};for(var n=r.cellSplitter||/\s+/,t=/^\s*$/,o=!r.hasOwnProperty("convertTypes")||!!r.convertTypes,i=lines(e),a=[],u=0;u<i.length;u++){var c=tokens(i[u],n);o&&(c=c.map(function(e){if(e.match(t))return e;var r=Number(e);if(!isNaN(r))return r;var n=new Date(e);return isNaN(+n)?e.trim():n})),c.length>0&&a.push(c)}return a}function unescapeCharacterEntities(e){
if("undefined"==typeof document)throw new Error("Cannot unescapeCharacterEntities");var r=document.createElement("div");return r.innerHTML=e,r.textContent}function toQueryParams(e,r){var n=e.trim().match(/([^?#]*)(#.*)?$/);if(!n)return{};var t=n[1].split(r||"&").inject({},function(e,r){if((r=r.split("="))[0]){var n=decodeURIComponent(r.shift()),t=r.length>1?r.join("="):r[0];void 0!=t&&(t=decodeURIComponent(t)),n in e?(Array.isArray(e[n])||(e[n]=[e[n]]),e[n].push(t)):e[n]=t}return e});return t}function normalizePath$1(e){var r=e.match(urlStartRe),n=r?r[0]:null,t=n?e.slice(n.length):e;do e=t,t=e.replace(pathDoubleDotRe,"");while(t!=e);return t=t.replace(pathDoubleSlashRe,"$1/"),t=t.replace(pathDotRe,"/"),n&&(t=n+t),t}function joinPath(){return normalizePath$1(Array.prototype.slice.call(arguments).reduce(function(e,r){return"string"==typeof r?e.replace(/\/*$/,"")+"/"+r.replace(/^\/*/,""):e}))}function newUUID(){return newUUIDTemplate.replace(newUUIDRe,newUUIDReplacer).toUpperCase()}function createDataURI(e,r){return r=r||"text/plain","data:"+r+";base64,"+btoa(e)}function hashCode(e){var r=0,n=e.length;if(0==n)return r;for(var t=0;t<n;t++){var o=e.charCodeAt(t);r=(r<<5)-r+o,r&=r}return r}function md5(e){function r(e,r,n,t,o,i){return r=f(f(r,e),f(t,i)),f(r<<o|r>>>32-o,n)}function n(e,n,t,o,i,a,u){return r(n&t|~n&o,e,n,i,a,u)}function t(e,n,t,o,i,a,u){return r(n&o|t&~o,e,n,i,a,u)}function o(e,n,t,o,i,a,u){return r(n^t^o,e,n,i,a,u)}function i(e,n,t,o,i,a,u){return r(t^(n|~o),e,n,i,a,u)}function a(e,r){var a=e[0],u=e[1],c=e[2],s=e[3];a=n(a,u,c,s,r[0],7,-680876936),s=n(s,a,u,c,r[1],12,-389564586),c=n(c,s,a,u,r[2],17,606105819),u=n(u,c,s,a,r[3],22,-1044525330),a=n(a,u,c,s,r[4],7,-176418897),s=n(s,a,u,c,r[5],12,1200080426),c=n(c,s,a,u,r[6],17,-1473231341),u=n(u,c,s,a,r[7],22,-45705983),a=n(a,u,c,s,r[8],7,1770035416),s=n(s,a,u,c,r[9],12,-1958414417),c=n(c,s,a,u,r[10],17,-42063),u=n(u,c,s,a,r[11],22,-1990404162),a=n(a,u,c,s,r[12],7,1804603682),s=n(s,a,u,c,r[13],12,-40341101),c=n(c,s,a,u,r[14],17,-1502002290),u=n(u,c,s,a,r[15],22,1236535329),a=t(a,u,c,s,r[1],5,-165796510),s=t(s,a,u,c,r[6],9,-1069501632),c=t(c,s,a,u,r[11],14,643717713),u=t(u,c,s,a,r[0],20,-373897302),a=t(a,u,c,s,r[5],5,-701558691),s=t(s,a,u,c,r[10],9,38016083),c=t(c,s,a,u,r[15],14,-660478335),u=t(u,c,s,a,r[4],20,-405537848),a=t(a,u,c,s,r[9],5,568446438),s=t(s,a,u,c,r[14],9,-1019803690),c=t(c,s,a,u,r[3],14,-187363961),u=t(u,c,s,a,r[8],20,1163531501),a=t(a,u,c,s,r[13],5,-1444681467),s=t(s,a,u,c,r[2],9,-51403784),c=t(c,s,a,u,r[7],14,1735328473),u=t(u,c,s,a,r[12],20,-1926607734),a=o(a,u,c,s,r[5],4,-378558),s=o(s,a,u,c,r[8],11,-2022574463),c=o(c,s,a,u,r[11],16,1839030562),u=o(u,c,s,a,r[14],23,-35309556),a=o(a,u,c,s,r[1],4,-1530992060),s=o(s,a,u,c,r[4],11,1272893353),c=o(c,s,a,u,r[7],16,-155497632),u=o(u,c,s,a,r[10],23,-1094730640),a=o(a,u,c,s,r[13],4,681279174),s=o(s,a,u,c,r[0],11,-358537222),c=o(c,s,a,u,r[3],16,-722521979),u=o(u,c,s,a,r[6],23,76029189),a=o(a,u,c,s,r[9],4,-640364487),s=o(s,a,u,c,r[12],11,-421815835),c=o(c,s,a,u,r[15],16,530742520),u=o(u,c,s,a,r[2],23,-995338651),a=i(a,u,c,s,r[0],6,-198630844),s=i(s,a,u,c,r[7],10,1126891415),c=i(c,s,a,u,r[14],15,-1416354905),u=i(u,c,s,a,r[5],21,-57434055),a=i(a,u,c,s,r[12],6,1700485571),s=i(s,a,u,c,r[3],10,-1894986606),c=i(c,s,a,u,r[10],15,-1051523),u=i(u,c,s,a,r[1],21,-2054922799),a=i(a,u,c,s,r[8],6,1873313359),s=i(s,a,u,c,r[15],10,-30611744),c=i(c,s,a,u,r[6],15,-1560198380),u=i(u,c,s,a,r[13],21,1309151649),a=i(a,u,c,s,r[4],6,-145523070),s=i(s,a,u,c,r[11],10,-1120210379),c=i(c,s,a,u,r[2],15,718787259),u=i(u,c,s,a,r[9],21,-343485551),e[0]=f(a,e[0]),e[1]=f(u,e[1]),e[2]=f(c,e[2]),e[3]=f(s,e[3])}function u(e){var r,n=e.length,t=[1732584193,-271733879,-1732584194,271733878];for(r=64;r<=n;r+=64)a(t,c(e.substring(r-64,r)));e=e.substring(r-64);var o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=e.length;for(r=0;r<i;r++)o[r>>2]|=e.charCodeAt(r)<<(r%4<<3);if(o[r>>2]|=128<<(r%4<<3),r>55)for(a(t,o),r=16;r--;)o[r]=0;return o[14]=8*n,a(t,o),t}function c(e){var r,n=[];for(r=0;r<64;r+=4)n[r>>2]=e.charCodeAt(r)+(e.charCodeAt(r+1)<<8)+(e.charCodeAt(r+2)<<16)+(e.charCodeAt(r+3)<<24);return n}function s(e){for(var r="",n=0;n<4;n++)r+=p[e>>8*n+4&15]+p[e>>8*n&15];return r}function l(e){for(var r=e.length,n=0;n<r;n++)e[n]=s(e[n]);return e.join("")}var f=function(e,r){var n=(65535&e)+(65535&r),t=(e>>16)+(r>>16)+(n>>16);return t<<16|65535&n},p="0123456789abcdef".split("");return l(u(e))}function reMatches$$1(e,r){var n=[];return e.replace(r,function(e,r){n.push({match:e,start:r,end:r+e.length})}),n}function stringMatch(e,r,n){function t(e,r,n,t,o){return t=t||0,o=o||0,[e.slice(0,r),e.slice(r+t,n-o),e.slice(n)]}function o(e,r){if(r.constructor!==RegExp){var n=e.indexOf(r);if(0===n)return{match:r,rest:e.slice(r.length)};for(var t=0;t<r.length;t++)if(r[t]!=e[t])return{match:null,pos:t};return{match:null}}var o=reMatches$$1(e,r);return o&&o.length&&0===o[0].start?{match:o[0].match,rest:e.slice(o[0].end)}:{match:null}}function i(e,r){for(var n=0,t=0;t<r.length;t++){var i=r[t],a=o(e,i);if(!a.match)return{matched:!1,pos:n+(a.pos||0),pattern:i};n+=a.match.length,e=a.rest}return e.length?{matched:!1,pos:n}:{matched:!0}}function a(e){var r=reMatches$$1(e,/__\//g),n=reMatches$$1(e,/\/__/g);if(r.length!==n.length)throw new Error("pattern invalid: "+e+" cannot be split into __/.../__ embedded RegExps\nstarts: "+JSON.stringify(r)+"\nvs ends:\n"+JSON.stringify(n));var o=0;return r.reduce(function(e,r,i){var a=n[i],u=e.pop(),c=t(u,r.start-o,a.end-o,3,3);c[0].length&&(e.push(c[0]),o+=c[0].length);try{c[1].length&&(e.push(new RegExp(c[1])),o+=c[1].length+3+3)}catch(e){throw new Error("Cannot create pattern re from: "+inspect(c))}return c[2].length&&e.push(c[2]),e},[e])}function u(e,r){var n=a(r),t=i(e,n);return t.matched?t:(t.error=e.slice(0,t.pos)+"<--UNMATCHED-->"+e.slice(t.pos),t)}return n=n||{},n.normalizeWhiteSpace&&(e=e.replace(/\s+/g," ")),n.ignoreIndent&&(e=e.replace(/^\s+/gm,""),r=r.replace(/^\s+/gm,"")),e==r?{matched:!0}:u(e,r)}function peekRight(e,r,n){if(e=e.slice(r),"string"==typeof n){var t=e.indexOf(n);return t===-1?null:t+r}if(n.constructor===RegExp){var o=reMatches$$1(e,n);return o[0]?o[0].start:null}return null}function peekLeft(e,r,n){if(e=e.slice(0,r),"string"==typeof n){var t=e.lastIndexOf(n);return t===-1?null:t}if(n.constructor===RegExp){var o=reMatches$$1(e,n);return last(o)?last(o).start:null}return null}function lineIndexComputer(e){var r=lineRanges(e);return function(e){for(var n=0;n<r.length;n++){var t=r[n];if(e>=t[0]&&e<t[1])return n}return-1}}function lineNumberToIndexesComputer(e){return function(r){return lineRanges(e)[r]}}function lineRanges(e){for(var r=0,n=0,t=lines(e),o=[],i=0;i<t.length;i++){var a=t[i];n=r+a.length+1,o.push([r,n]),r=n}return o}function findLineWithIndexInLineRanges(e,r){var n=e.length;if(0===n)return-1;for(var t=0,o=n;;){var i=t+Math.floor((o-t)/2),a=slicedToArray(e[i],2),u=a[0],c=a[1];if(r<u){if(0===i)return-1;o=i}else{if(!(r>c))return i;t=i}}return-1}function regexIndexOf(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=this.substring(n||0).search(r);return t>=0?t+(n||0):t}function regexLastIndexOf(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length;r=r.global?r:new RegExp(r.source,"g"+(r.ignoreCase?"i":"")+(r.multiLine?"m":""));for(var t,o=this.substring(0,n+1),i=-1,a=0;null!=(t=r.exec(o));)i=t.index,r.lastIndex=++a;return i}function diff(e,r){return"undefined"==typeof JsDiff?"diff not supported":JsDiff.convertChangesToXML(JsDiff.diffWordsWithSpace(e,r))}function empty(e){return""==e}function startsWithVowel(e){var r=e[0];return"A"===r||"E"===r||"I"===r||"O"===r||"U"===r||"a"===r||"e"===r||"i"===r||"o"===r||"u"===r||!1}function withDecimalPrecision(e,r){var n=parseFloat(e);return isNaN(n)?e:n.toFixed(r)}function capitalize(e){return e.length?e.charAt(0).toUpperCase()+e.slice(1):e}function camelCaseString(e){return e.split(" ").map(capitalize).join("")}function camelize(e){var r=e.split("-"),n=r.length;if(1==n)return r[0];for(var t="-"==e.charAt(0)?r[0].charAt(0).toUpperCase()+r[0].substring(1):r[0],o=1;o<n;o++)t+=r[o].charAt(0).toUpperCase()+r[o].substring(1);return t}function truncate(e,r,n){return r=r||30,n=void 0===n?"...":n,e.length>r?e.slice(0,r-n.length)+n:String(e)}function truncateLeft(e,r,n){return r=r||30,n=void 0===n?"...":n,e.length>r?n+e.slice(-r):String(e)}function regExpEscape(e){return e.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")}function succ(e){return e.slice(0,e.length-1)+String.fromCharCode(e.charCodeAt(e.length-1)+1)}function digitValue(e){return e.charCodeAt(0)-"0".charCodeAt(0)}function longestCommonSubstring(e,r){for(var n=[],t=0;t<e.length;t++){n[t]=[];for(var o=0;o<r.length;o++)n[t][o]=0}for(var i=0;i<e.length;i++)n[i][0]=0;for(var a=1;a<e.length;a++)for(var u=1;u<r.length;u++)n[a][u]=e[a-1]==r[u-1]?n[a-1][u-1]+1:0;for(var c=-1,s=-1,l=-1,f=0;f<e.length;f++)for(var p=0;p<r.length;p++){var h=n[f][p];c<h&&(c=h,s=f-h,l=p-h)}return{length:c,indexA:s,indexB:l,string:c>0?e.slice(s,s+c):""}}function applyChange(e,r){return"insert"===r.action?e.slice(0,r.start)+r.lines.join("\n")+e.slice(r.start):"remove"===r.action?e.slice(0,r.start)+e.slice(r.end):e}function applyChanges(e,r){return r.reduce(function(r,n){return applyChange(e,n)},e)}function levenshtein(e,r){if(0===e.length)return r.length;if(0===r.length)return e.length;var n,t,o,i,a,u;for(e.length>r.length&&(n=e,e=r,r=n),u=Array(e.length+1),t=0;t<=e.length;t++)u[t]=t;for(t=1;t<=r.length;t++){for(i=t,o=1;o<=e.length;o++)a=r[t-1]===e[o-1]?u[o-1]:Math.min(u[o-1]+1,Math.min(i+1,u[o]+1)),u[o-1]=i,i=a;u[e.length]=i}return u[e.length]}function random(e,r){return e=e||0,r=r||100,Math.round(Math.random()*(r-e)+e)}function randomSmallerInteger(e){return Math.floor(Math.random()*e)}function humanReadableByteSize(e){function r(e){return Math.round(100*e)/100}return e<1e3?String(r(e))+"B":(e/=1024,e<1e3?String(r(e))+"KB":(e/=1024,String(r(e))+"MB"))}function average(e){return e.reduce(function(e,r){return e+r},0)/e.length}function averageInc(e,r,n){return(e-r)/n+r}function median(e){var r=e.sort(function(e,r){return r-e}),n=e.length;return n%2===0?.5*(r[n/2-1]+r[n/2]):r[(n-1)/2]}function between(e,r,n,t){t=t||0;var o,i;return r<n?(o=r,i=n):(i=r,o=n),i-e+t>=0&&o-e-t<=0}function sort$1(e){return e.sort(function(e,r){return e-r})}function parseLength(e,r){r=r||"px";var n=e.match(/([0-9\.]+)\s*(.*)/);if(n&&n[1]){var t=parseFloat(n[1]),o=n[2];return convertLength(t,o,r)}}function roundTo(e,r){return r=1/r,Math.round(e*r)/r}function detent(e,r,n,t){var o=roundTo(e,n);if(Math.abs(e-o)<r/2)return o;if(t)return e;var i=e<o?o-r/2:o+r/2;return o+(e-i)*n/(n-r)}function toDegrees(e){return 180*e/Math.PI%360}function toRadians(e){return e/180*Math.PI}function backoff(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4,t=Math.min(n,r*Math.pow(2,e)),o=t/2+Math.round(Math.random()*(t/2));return Math.min(n,r+Math.random()*(3*o-r))}function all$2(e,r){var n=[];for(var t in e)!e.__lookupGetter__(t)&&"function"==typeof e[t]||r&&!r(t,e)||n.push(t);return n}function allOwnPropertiesOrFunctions(e,r){return Object.getOwnPropertyNames(e).reduce(function(n,t){return r&&!r(e,t)||n.push(t),n},[])}function own$1(e){var r=[];for(var n in e)e.hasOwnProperty(n)&&(e.__lookupGetter__(n)||"function"!==e[n])&&r.push(n);return r}function forEachOwn(e,r,n){var t=[];for(var o in e)if(e.hasOwnProperty(o)){var i=e[o];"function"!==i&&t.push(r.call(n||this,o,i))}return t}function nameFor(e,r){for(var n in e)if(e[n]===r)return n}function values$1(e){var r=[];for(var n in e)r.push(e[n]);return r}function ownValues(e){var r=[];for(var n in e)e.hasOwnProperty(n)&&r.push(e[n]);return r}function any$1(e,r){for(var n in e)if(r(e,n))return!0;return!1}function allProperties(e,r){var n=[];for(var t in e)r&&!r(e,t)||n.push(t);return n}function hash(e){return Object.keys(e).sort().join("").hashCode()}function format$1(e,r,n){return dateFormat(e,r,n)}function equals$3(e,r){return r&&r instanceof Date&&r.getTime()===e.getTime()}function relativeTo(e,r){if(!(r instanceof Date))return"";if(r<e)return"";if(r===e)return"now";var n="min",t="sec",o="hour",i="day",a=r-e,u=Math.round(a/1e3),c=u%60,s=Math.floor(u/60)%60,l=Math.floor(u/60/60)%24,f=Math.floor(u/60/60/24),p=[];return f>0&&(p.push(f),f>1&&(i+="s"),p.push(i)),l>0&&f<2&&(p.push(l),l>1&&(o+="s"),p.push(o)),s>0&&l<3&&0===f&&(p.push(s),s>1&&(n+="s"),p.push(n)),c>0&&s<3&&0===l&&0===f&&(p.push(c),c>1&&(t+="s"),p.push(t)),p.join(" ")}function promise(e){return"function"==typeof e?promise.convertCallbackFun(e):Promise.resolve(e)}function delay$1(e,r){return new Promise(function(n){return setTimeout(n,e,r)})}function delayReject(e,r){return new Promise(function(n,t){return setTimeout(t,e,r)})}function timeout(e,r){return new Promise(function(n,t){var o=!1;setTimeout(function(){return!o&&(o=!0)&&t(new Error("Promise timed out"))},e),r.then(function(e){return!o&&(o=!0)&&n(e)},function(e){return!o&&(o=!0)&&t(e)})})}function waitFor$1(e,r,n){return"function"==typeof e&&(r=e,e=void 0),new Promise(function(t,o){var i=!1,a=!1,u=void 0,c=void 0,s=setInterval(function(){if(i)return clearInterval(s);try{c=r()}catch(e){u=e}if(c||u||a)return i=!0,clearInterval(s),u?o(u):a?"undefined"==typeof n?o(new Error("timeout")):t(n):t(c)},10);"number"==typeof e&&setTimeout(function(){return a=!0},e)})}function deferred(){var e,r,n=new Promise(function(n,t){e=n,r=t});return{resolve:e,reject:r,promise:n}}function convertCallbackFun(e){return function(){var r=Array.from(arguments),n=this;return new Promise(function(t,o){r.push(function(e,r){return e?o(e):t(r)}),e.apply(n,r)})}}function convertCallbackFunWithManyArgs(e){return function(){var r=Array.from(arguments),n=this;return new Promise(function(t,o){r.push(function(){var e=Array.from(arguments),r=e.shift();return r?o(r):t(e)}),e.apply(n,r)})}}function _chainResolveNext(e,r,n,t,o){var i=e.shift();if(i)try{Promise.resolve(i(r,n)).then(function(r){return _chainResolveNext(e,r,n,t,o)}).catch(function(e){o(e)})}catch(e){o(e)}else t(r)}function chain$1(e){return new Promise(function(r,n){return _chainResolveNext(e.slice(),void 0,{},r,n)})}function promise_finally(e,r){return Promise.resolve(e).then(function(e){try{r()}catch(e){console.error("Error in promise finally: "+e.stack||e)}return e}).catch(function(e){try{r()}catch(e){console.error("Error in promise finally: "+e.stack||e)}throw e})}function parallel(e){function r(){t--;try{!function(){var r=a++,i=e[r]();i.then(function(e){t++,o[r]=e,0===--u?c():n()}).catch(function(e){return s(e)})}()}catch(e){s(e)}}function n(){for(;!i&&u>0&&a<e.length&&t>0;)r()}var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;if(!e.length)return Promise.resolve([]);var o=[],i=null,a=0,u=e.length,c=void 0,s=void 0;return new Promise(function(e,r){c=function(){return e(o)},s=function(e){return r(i=e)},n()})}function Path(e,r){return e instanceof Path?e:this instanceof Path?(this.setSplitter(r||"."),void this.fromPath(e)):new Path(e,r)}function clone$2(e){var r={};for(var n in e)r[n]=e[n].slice();return r}function without$1(e,r){var n={};for(var t in e)if(!r.includes(t)){n[t]=[];for(var o=e[t],i=0;i<o.length;i++){var a=o[i];r.includes(a)||n[t].push(a)}}return n}function hull(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;if(!Array.isArray(e[r]))return[];for(var o=[],i={},a={},u=0;u<n.length;u++)a[n[u]]=!0;for(var c=e[r].slice(),s={},l=c.length;l--;){var f=c[l];f in a?c.splice(l,1):s[f]=1}if(n)for(;;){if(0===c.length)break;for(var p=0;p<c.length;p++){var h=c.shift();if(!(h in i||h in a)){var d=s[h]||0;if(!(d>t)){o.push(h),i[h]=!0;var g=e[h];if(g)for(var y=0;y<g.length;y++){var m=g[y];m in i||m in s||(s[m]=d+1,c.push(m))}}}}}return o}function subgraphReachableBy(e,r,n){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;n&&(e=without$1(e,n));for(var o=[r],i=0,a={};o.length&&i++<t;){var u=o.shift();if(!a[u]){var c=e[u]||[];a[u]=c,o.push.apply(o,toConsumableArray(c))}}return a}function invert(e){var r={};for(var n in e)for(var t=e[n],o=0;o<t.length;o++){var i=t[o];r[i]?r[i].push(n):r[i]=[n]}return r}function sortByReference(e,r){var n=[],t={},o={},i={};for(var a in e){t.hasOwnProperty(a)||(t[a]=!0,n.push(a));var u=e[a],c={};if(u){o[a]=[];var s=!0,l=!1,f=void 0;try{for(var p,h=u[Symbol.iterator]();!(s=(p=h.next()).done);s=!0){var d=p.value;if(!c.hasOwnProperty(d)&&a!==d){var g=i[d]||(i[d]=[]);g.includes(a)||g.push(a),c[d]=!0,o[a].push(d),t.hasOwnProperty(d)||(t[d]=!0,n.push(d))}}}catch(e){l=!0,f=e}finally{try{!s&&h.return&&h.return()}finally{if(l)throw f}}}}for(var y=[];n.length;){for(var m=1/0,v=[],w=[],b=[],k=0;k<n.length;k++){var O=n[k],A=o[O]||[];if(!(A.length>m))if(A.length!==m||A.some(function(e){return v.includes(e)}))m=A.length,v=[O],w=[k],b=(i[O]||[]).slice();else{var S;v.push(O),w.push(k),(S=b).push.apply(S,toConsumableArray(i[O]||[]))}}for(var k=w.length;k--;){var O=n[w[k]];i[O]=[],n.splice(w[k],1)}var C=!0,j=!1,E=void 0;try{for(var P,x=b[Symbol.iterator]();!(C=(P=x.next()).done);C=!0){var O=P.value;o[O]=o[O].filter(function(e){return!v.includes(e)})}}catch(e){j=!0,E=e}finally{try{!C&&x.return&&x.return()}finally{if(j)throw E}}y.push(v)}return y}function reduce$1(e,r,n,t,o,i){function a(n){if(!(u.indexOf(n)>-1)){t=e.call(i,t,n,c++),u=u.concat([n]);var o=withoutAll(r[n]||[],u);o.forEach(function(e){return a(e)})}}var u=o||[],c=0;return a(n),t}function random$1(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,r={},n=range(1,e).map(String),t=0;t<n.length;t++){var o=Math.floor(Math.random()*e);r[n[t]]=shuffle(n).slice(0,o)}return r}function isInterval(e){return Array.isArray(e)&&e.length>=2&&e[0]<=e[1]}function sort$2(e){return e.sort(compare)}function compare(e,r){return e[0]<r[0]?e[1]<r[0]?-3:e[1]===r[0]?-2:-1:e[0]===r[0]?e[1]===r[1]?0:e[1]<r[1]?-1:1:-1*compare(r,e)}function coalesce(e,r,n){var t=this.compare(e,r);switch(t){case-3:case 3:return null;case 0:return n&&n(e,r,e),e;case 2:case 1:var o=e;e=r,r=o;case-2:case-1:var i=[e[0],Math.max(e[1],r[1])];return n&&n(e,r,i),i;default:throw new Error("Interval compare failed")}}function coalesceOverlapping(e,r){for(var n=[],t=e.length;t>0;){var o=e.shift();t--;for(var i=0;i<t;i++){var a=e[i],u=coalesce(o,a,r);u&&(o=u,e.splice(i,1),t--,i--)}n.push(o)}return this.sort(n)}function mergeOverlapping(e,r,n){for(var t=[];e.length>0;){var o=e.shift(),i=r.map(function(e){var r=compare(o,e);return r===-1||0===r||1===r});t.push(n(o,i[0])),t.push(o)}return t}function intervalsInRangeDo(e,r,n,t,o,i){i=i||GLOBAL$2,n=this.sort(n);for(var a,u=[];a=n.shift();)if(!(a[1]<e)){a[0]<e&&(a=Array.prototype.slice.call(a),a[0]=e);var c=r<a[0]?r:a[0];if(e<c&&u.push(t.call(i,[e,c],!0)),r<a[1]&&(a=Array.prototype.slice.call(a),a[1]=r),a[0]===a[1]){var s;o&&(s=u.slice(-1)[0])&&o.call(i,s,a,s)}else u.push(t.call(i,a,!1));if(e=a[1],e>=r)break}return e<r&&u.push(t.call(i,[e,r],!0)),u}function intervalsInbetween(e,r,n){return intervalsInRangeDo(e,r,coalesceOverlapping(Array.prototype.slice.call(n)),function(e,r){return r?e:null}).filter(Boolean)}function mapToMatchingIndexes(e,r){var n,t,o=0;return r.map(function(r){for(;(t=e[o])&&t[0]<r[0];)o++;if(t&&t[0]===r[0]){for(n=o;(t=e[n])&&t[1]<r[1];)n++;if(t&&t[1]===r[1])return range(o,n)}return[]})}function create(e,r,n){var t=n||0;return t+r>e.length&&(t-=t+r-e.length),{array:e,from:t,to:t+r}}function toArray$4(e){return e.array.slice(e.from,e.to)}function originalToProjectedIndex(e,r){return r<e.from||r>=e.to?null:r-e.from}function projectedToOriginalIndex(e,r){return r<0||r>e.to-e.from?null:e.from+r}function transformToIncludeIndex(e,r){if(!(r in e.array))return null;var n=0;return r<e.from&&(n=-e.from+r),r>=e.to&&(n=r-e.to+1),0===n?e:create(e.array,e.to-e.from,e.from+n)}function get$2(e,r,n){var t=e[r];return t?t[n]:void 0}function set$2(e,r,n,t){var o=e[r];return o&&(o[n]=t),t}function getRow(e,r){return e[r]}function setRow(e,r,n){return e[r]=n}function getCol(e,r){return e.reduce(function(e,n){return e.push(n[r]),e},[])}function setCol(e,r,n){return e.map(function(e,t){return e[r]?e[r]=n[t]:void 0})}function create$1(e,r,n){for(var t=new Array(e);e>0;)t[--e]=withN(r,n);return t}function mapCreate(e,r,n,t){for(var o=new Array(e),i=0;i<e;i++){o[i]=new Array(r);for(var a=0;a<r;a++)o[i][a]=n.call(t||this,i,a)}return o}function forEach$2(e,r,n){e.forEach(function(e,t){e.forEach(function(e,o){r.call(n||this,e,t,o)})})}function map$2(e,r,n){var t=new Array(e.length);return e.forEach(function(e,o){t[o]=new Array(e.length),e.forEach(function(e,i){t[o][i]=r.call(n||this,e,o,i)})}),t}function toObjects(e){for(var r=e[0],n=new Array(e.length-1),t=1;t<e.length;t++)for(var o=n[t-1]={},i=0;i<r.length;i++)o[r[i]]=e[t][i];return n}function tableFromObjects(e,r){Array.isArray(e)||(e=[e]);var n=[[]],t=n[0],o=e.reduce(function(e,r){return e.concat([Object.keys(r).reduce(function(e,n){var o=t.indexOf(n);return o===-1&&(o=t.length,t.push(n)),e[o]=r[n],e},[])])},[]);return r=1===arguments.length?null:r,o.forEach(function(e){for(var n=0;n<t.length;n++)e[n]||(e[n]=r)}),n.concat(o)}function prewalk(e,r,n){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{i:0},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=t.i++;r(e,i,o),(n(e,i,o)||[]).forEach(function(e){return prewalk(e,r,n,t,o+1)})}function postwalk(e,r,n){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{i:0},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=t.i++;(n(e,i,o)||[]).forEach(function(e){return postwalk(e,r,n,t,o)}),r(e,i,o)}function find(e,r,n){if(r(e))return e;var t=n(e);if(t&&t.length)for(var o=0;o<t.length;o++){var i=find(t[o],r,n);if(i)return i}}function filter$1(e,r,n){var t=[];return r(e)&&t.push(e),t.concat(flatten((n(e)||[]).map(function(e){return filter$1(e,r,n)})))}function map$3(e,r,n){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return[r(e,t)].concat(flatten((n(e)||[]).map(function(e){return map$3(e,r,n,t+1)})))}function mapTree(e,r,n){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=(n(e)||[]).map(function(e){return mapTree(e,r,n,t+1)});return r(e,o,t)}function create$2(e){var r=[{name:"send",args:["msg","callback"]},{name:"listen",args:["messenger","callback"]},{name:"close",args:["messenger","callback"]},{name:"isOnline",args:[]}],n=r.map(function(e){return e.name}).concat(["id","sendHeartbeat","heartbeatInterval","ignoreUnknownMessages","allowConcurrentSends","sendTimeout","services"]);r.forEach(function(r){if(!e[r.name]){var n="message implementation needs function "+r.name+"("+r.args.join(",")+")";throw new Error(n)}});var t=e.sendHeartbeat&&(e.heartbeatInterval||1e3),o=!!e.hasOwnProperty("ignoreUnknownMessages")&&e.ignoreUnknownMessages,i={_outgoing:[],_inflight:[],_id:e.id||newUUID(),_ignoreUnknownMessages:o,_services:{},_messageCounter:0,_messageResponseCallbacks:{},_whenOnlineCallbacks:[],_statusWatcherProc:null,_startHeartbeatProcessProc:null,_listenInProgress:null,_heartbeatInterval:t,_status:OFFLINE,_runWhenOnlineCallbacks:function(){var e=i._whenOnlineCallbacks.slice();i._whenOnlineCallbacks=[],e.forEach(function(e){try{e.call(null,null,i)}catch(e){console.error("error in _runWhenOnlineCallbacks: %s",e)}})},_ensureStatusWatcher:function(){i._statusWatcherProc||(i._statusWatcherProc=setInterval(function(){i.isOnline()&&i._whenOnlineCallbacks.length&&i._runWhenOnlineCallbacks();var e=i._status;i._status=i.isOnline()?ONLINE:OFFLINE,i._status!==ONLINE&&i._statusWatcherProc&&i.reconnect(),i._status!==e&&i.onStatusChange&&i.onStatusChange()},20))},_addMissingData:function(e){if(!e.target)throw new Error("Message needs target!");if(!e.action)throw new Error("Message needs action!");return e.data||(e.data=null),e.messageId||(e.messageId=newUUID()),e.sender=i.id(),e.messageIndex=i._messageCounter++,e},_queueSend:function(e,r){if(r&&"function"!=typeof r)throw new Error("Expecing a when send callback, got: "+r);i._outgoing.push([e,r])},_deliverMessageQueue:function(){function r(r){if(i._inflight.indexOf(r)!==-1){var n=r[0],o=r[1];o&&(i._messageResponseCallbacks[n.messageId]=o),e.send.call(i,n,function(e){remove(i._inflight,r),e&&t(e,r),i._deliverMessageQueue()})}}function n(r){"number"==typeof e.sendTimeout&&setTimeout(function(){i._inflight.indexOf(r)!==-1&&(remove(i._inflight,r),t(new Error("Timeout sending message"),r),i._deliverMessageQueue())},e.sendTimeout)}function t(e,r){var n=r[0],t=r[1];delete i._messageResponseCallbacks[n.messageId],console.error(e),t&&t(e)}if(e.allowConcurrentSends||!i._inflight.length){var o=i._outgoing.shift();o&&(i._inflight.push(o),i.isOnline()?r(o):i.whenOnline(function(){r(o)}),n(o),e.allowConcurrentSends&&i._outgoing.length&&i._deliverMessageQueue())}},_startHeartbeatProcess:function(){i._startHeartbeatProcessProc||(i._startHeartbeatProcessProc=setTimeout(function(){e.sendHeartbeat.call(i,function(e,r){i._startHeartbeatProcessProc=null,i._startHeartbeatProcess()})},i._heartbeatInterval))},id:function(){return i._id},isOnline:function(){return e.isOnline.call(i)},heartbeatEnabled:function(){return"number"==typeof i._heartbeatInterval},listen:function(r){if(!i._listenInProgress)return i._listenInProgress=!0,i._ensureStatusWatcher(),e.listen.call(i,function(e){i._listenInProgress=null,r&&r(e),i.heartbeatEnabled()&&i._startHeartbeatProcess()})},reconnect:function(){if(i._status!==ONLINE)return i.listen(),i},send:function(e,r){return i._addMissingData(e),i._queueSend(e,r),i._deliverMessageQueue(),e},sendTo:function(e,r,n,t){var o={target:e,action:r,data:n};return i.send(o,t)},onMessage:function(e){if(i.emit("message",e),e.inResponseTo){var r=i._messageResponseCallbacks[e.inResponseTo];r&&!e.expectMoreResponses&&delete i._messageResponseCallbacks[e.inResponseTo],r&&r(null,e)}else{var n=i._services[e.action];if(n)try{n.call(null,e,i)}catch(r){var t=String(r.stack||r);console.error("Error invoking service: "+t),i.answer(e,{error:t})}else if(!i._ignoreUnknownMessages){var o=new Error("messageNotUnderstood: "+e.action);i.answer(e,{error:String(o)})}}},answer:function e(r,n,t,o){"function"==typeof t&&(o=t,t=!1);var e={target:r.sender,action:r.action+"Result",inResponseTo:r.messageId,data:n};return t&&(e.expectMoreResponses=!0),i.send(e,o)},close:function(r){return clearInterval(i._statusWatcherProc),i._statusWatcherProc=null,e.close.call(i,function(e){i._status=OFFLINE,r&&r(e)}),i},whenOnline:function(e){return i._whenOnlineCallbacks.push(e),i.isOnline()&&i._runWhenOnlineCallbacks(),i},outgoingMessages:function(){return pluck(i._inflight.concat(i._outgoing),0)},addServices:function(e){return Object.assign(i._services,e),i}};e.services&&i.addServices(e.services),makeEmitter(i);for(var a in e)n.indexOf(a)===-1&&e.hasOwnProperty(a)&&(i[a]=e[a]);return i}function fork(e,r,n){n||(n=r,r=e,e=null),e=e||{};var t=e.args||[],o=create$3(e);return o.run.apply(o,[r].concat(t).concat(n)),o}function create$3(e){e=e||{},e.useMessenger=!0;var r=e.workerId||newUUID(),n=create$2({sendTimeout:5e3,send:function(e,r){n.worker.postMessage(e),r()},listen:function(r){var t=n.worker=isNodejs?NodejsWorker.create(e):BrowserWorker.create(e);t.on("message",function(e){n.onMessage(e)}),t.on("ready",function(){NodejsWorker.debug&&console.log("WORKER READY!!!")}),t.on("close",function(){NodejsWorker.debug&&console.log("WORKER CLOSED...!!!")}),t.once("ready",r)},close:function(e){return n.worker.ready?n.sendTo(r,"close",{},function(r,t){if(r=r||t.data.error,r&&console.error("Error in worker messenger close: "+r.stack||r),r)e(r);else{var o=!1;n.worker.once("close",function(){o=!0}),waitFor(1e3,function(){return!!o},e)}}):e(null)},isOnline:function(){return n.worker&&n.worker.ready}});return Object.assign(n,{eval:function(e,t){n.sendTo(r,"remoteEval",{expr:e},function(e,r){t(e,r?r.data.result:null)})},run:function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),o=e.pop();if("function"!=typeof t)throw new Error("run: no function that should run in worker passed");if("function"!=typeof o)throw new Error("run: no callback passed");return n.sendTo(r,"run",{func:String(t),args:e},function(e,r){o(e||r.data.error,r?r.data.result:null)})}}),n.listen(),n}function createLivelyLangObject(){return{chain:chain$$1,noConflict:noConflict,installGlobals:installGlobals,uninstallGlobals:uninstallGlobals,globalInterfaceSpec:globalInterfaceSpec,toString:function(){return"[object lively.lang]"}}}function chain$$1(e){if(!e)return e;if(Array.isArray(e))return createChain(arr,e);if("Date"===e.constructor.name)return createChain(date,e);switch("undefined"==typeof e?"undefined":_typeof(e)){case"string":return createChain(string,e);case"object":return createChain(obj,e);case"function":return createChain(fun,e);case"number":return createChain(num,e)}throw new Error("Chain for object "+e+" ("+e.constructor.name+") no supported")}function createChain(e,r){return Object.keys(e).reduce(function(n,t){return n[t]=function(){var n=Array.prototype.slice.call(arguments),o=e[t].apply(null,[r].concat(n));return chain$$1(o)},n},{value:function(){return r}})}function noConflict(){if(!isNode){var e=livelyLang._prevLivelyGlobal;e?delete GLOBAL.lively.lang:delete GLOBAL.lively}return livelyLang}function installGlobals(){Object.assign(livelyLang,{worker:worker,messenger:messenger,events:events,tree:tree,grid:grid,arrayProjection:arrayProjection,interval:interval,graph:graph,date:date,properties:properties,obj:obj,arr:arr,fun:fun,num:num,string:string,Closure:Closure,promise:promise,Path:Path,Group:Group}),globalInterfaceSpec.forEach(function(e){if("installMethods"===e.action){var r=Path(e.target);r.isIn(GLOBAL)||r.set(GLOBAL,{},!0);var n=Path(e.sources[0]);e.methods.forEach(function(e){installProperty(n.concat([e]),r.concat([e]))}),e.alias&&e.alias.forEach(function(e){installProperty(n.concat([e[1]]),r.concat([e[0]]))})}else{if("installObject"!==e.action)throw new Error("Cannot deal with global setup action: "+e.action);var r=Path(e.target),t=Path(e.source).get(livelyLang);r.set(GLOBAL,t,!0)}})}function installProperty(e,r){if(!e.isIn(livelyLang)){var n=new Error("property not provided by lively.lang: "+e);throw console.error(n.stack||n),n}var t=e.get(livelyLang);if("function"==typeof t&&"prototype"===r.slice(-2,-1).toString()){var o=t;t=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this),o.apply(null,e)},t.toString=function(){return o.toString()}}r.set(GLOBAL,t,!0)}function uninstallGlobals(){globalInterfaceSpec.forEach(function(e){if("installMethods"===e.action){var r=Path(e.target),n=Path(e.source).get(livelyLang),t=r.get(GLOBAL);if(!t)return;e.methods.filter(function(e){return n===t[e]}).forEach(function(e){delete t[e]}),e.alias&&e.alias.filter(function(e){return n===t[e]}).forEach(function(e){delete t[e[0]]})}else{if("installObject"!==e.action)throw new Error("Cannot deal with global setup action: "+e.action);var r=Path(e.target);r.del(GLOBAL)}})}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},asyncGenerator=function(){function e(e){this.value=e}function r(r){function n(e,r){return new Promise(function(n,o){var u={key:e,arg:r,resolve:n,reject:o,next:null};a?a=a.next=u:(i=a=u,t(e,r))})}function t(n,i){try{var a=r[n](i),u=a.value;u instanceof e?Promise.resolve(u.value).then(function(e){t("next",e)},function(e){t("throw",e)}):o(a.done?"return":"normal",a.value)}catch(e){o("throw",e)}}function o(e,r){switch(e){case"return":i.resolve({value:r,done:!0});break;case"throw":i.reject(r);break;default:i.resolve({value:r,done:!1})}i=i.next,i?t(i.key,i.arg):a=null}var i,a;this._invoke=n,"function"!=typeof r.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(r.prototype[Symbol.asyncIterator]=function(){return this}),r.prototype.next=function(e){
return this._invoke("next",e)},r.prototype.throw=function(e){return this._invoke("throw",e)},r.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new r(e.apply(this,arguments))}},await:function(r){return new e(r)}}}(),classCallCheck=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}(),get$1=function e(r,n,t){null===r&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,n);if(void 0===o){var i=Object.getPrototypeOf(r);return null===i?void 0:e(i,n,t)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(t)},set$1=function e(r,n,t,o){var i=Object.getOwnPropertyDescriptor(r,n);if(void 0===i){var a=Object.getPrototypeOf(r);null!==a&&e(a,n,t,o)}else if("value"in i&&i.writable)i.value=t;else{var u=i.set;void 0!==u&&u.call(o,t)}return t},slicedToArray=function(){function e(e,r){var n=[],t=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(t=(a=u.next()).done)&&(n.push(a.value),!r||n.length!==r);t=!0);}catch(e){o=!0,i=e}finally{try{!t&&u.return&&u.return()}finally{if(o)throw i}}return n}return function(r,n){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),toConsumableArray=function(e){if(Array.isArray(e)){for(var r=0,n=Array(e.length);r<e.length;r++)n[r]=e[r];return n}return Array.from(e)},parameterRegex=/function[^\(]*\(([^\)]*)\)|\(?([^\)=]*)\)?\s*=>/,Closure=function(){function e(r,n,t,o){classCallCheck(this,e),this.originalFunc=r,this.varMapping=n||{},this.setFuncSource(t||r),this.setFuncProperties(r||o)}return createClass(e,null,[{key:"fromFunction",value:function(e,r){return new this(e,r||{})}},{key:"fromSource",value:function(e,r){return new this(null,r||{},e)}}]),createClass(e,[{key:"setFuncSource",value:function(e){return e="undefined"!=typeof lively&&lively.sourceTransform&&"function"==typeof lively.sourceTransform.stringifyFunctionWithoutToplevelRecorder?lively.sourceTransform.stringifyFunctionWithoutToplevelRecorder(e):String(e),this.source=e}},{key:"getFuncSource",value:function(){return this.source||this.setFuncSource(this.originalFunc)}},{key:"hasFuncSource",value:function(){return this.source&&!0}},{key:"getFunc",value:function(){return this.originalFunc||this.recreateFunc()}},{key:"getFuncProperties",value:function(){return this.funcProperties||(this.funcProperties={})}},{key:"setFuncProperties",value:function(e){var r=this.getFuncProperties();for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n])}},{key:"lookup",value:function(e){return this.varMapping[e]}},{key:"parameterNames",value:function(e){if("undefined"!=typeof lively&&lively.ast)return(lively.ast.parseFunction(e).params||[]).map(function(e){return"Identifier"===e.type?e.name:e.left&&"Identifier"===e.left.type?e.left.name:null}).filter(Boolean);var r=parameterRegex.exec(e);if(!r)return[];var n=r[1]||r[2]||"";return n.split(",").map(function(e){return e.trim()})}},{key:"firstParameter",value:function(e){return this.parameterNames(e)[0]||null}},{key:"recreateFunc",value:function(){return this.recreateFuncFromSource(this.getFuncSource(),this.originalFunc)}},{key:"recreateFuncFromSource",value:function(e,r){var n=[],t=!1,o="$super"===this.firstParameter(e);for(var i in this.varMapping)this.varMapping.hasOwnProperty(i)&&("this"!=i?n.push("var "+i+" = this.varMapping."+i+";\n"):t=!0);var a="";n.length>0&&(a+=n.join("\n")),o&&(a+="(function superWrapperForClosure() { return "),a+="("+e+")",o&&(a+=".apply(this, [$super.bind(this)].concat(Array.from(arguments))) })");try{var u=evalJS.call(this,a)||this.couldNotCreateFunc(a);return this.addFuncProperties(u),this.originalFunc=u,u}catch(e){var c="Cannot create function "+e+" src: "+a;throw console.error(c),new Error(c)}}},{key:"addFuncProperties",value:function(e){var r=this.getFuncProperties();for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n]);this.addClosureInformation(e)}},{key:"couldNotCreateFunc",value:function(e){var r="Could not recreate closure from source: \n"+e;return console.error(r),function(){throw new Error(r)}}},{key:"asFunction",value:function(){return this.recreateFunc()}},{key:"addClosureInformation",value:function(e){return e.hasLivelyClosure=!0,e.livelyClosure=this,e}},{key:"isLivelyClosure",get:function(){return!0}},{key:"doNotSerialize",get:function(){return["originalFunc"]}}]),e}(),_throttledByName={},_debouncedByName={},_queues={},_queueUntilCallbacks={},_eitherNameRegistry={},fun=Object.freeze({Empty:Empty,K:K,Null:Null,False:False,True:True,notYetImplemented:notYetImplemented,withNull:withNull,all:all,own:own,argumentNames:argumentNames,qualifiedMethodName:qualifiedMethodName,extractBody:extractBody,timeToRun:timeToRun,timeToRunN:timeToRunN$1,delay:delay,throttle:throttle,debounce:debounce,throttleNamed:throttleNamed,debounceNamed:debounceNamed,createQueue:createQueue,workerWithCallbackQueue:workerWithCallbackQueue,composeAsync:composeAsync,compose:compose,waitFor:waitFor,waitForAll:waitForAll,flip:flip,curry:curry,wrap:wrap,binds:binds,getOriginal:getOriginal,wrapperChain:wrapperChain,replaceMethodForOneCall:replaceMethodForOneCall,once:once,either:either,eitherNamed:eitherNamed,evalJS:evalJS,fromString:fromString,asScript:asScript,asScriptOf:asScriptOf,addToObject:addToObject,setLocalVarValue:setLocalVarValue,getVarMapping:getVarMapping,setProperty:setProperty,functionNames:functionNames,localFunctionNames:localFunctionNames,logErrors:logErrors,logCompletion:logCompletion,logCalls:logCalls,traceCalls:traceCalls,webkitStack:webkitStack}),Group=function(){function e(){classCallCheck(this,e)}return createClass(e,[{key:"toArray",value:function(){return this.reduceGroups(function(e,r,n){return e.concat([n])},[])}},{key:"forEach",value:function(e,r){var n=this;return Object.keys(n).forEach(function(t){n[t].forEach(e.bind(r,t))}),n}},{key:"forEachGroup",value:function(e,r){var n=this;return Object.keys(n).forEach(function(t){e.call(r,t,n[t])}),n}},{key:"map",value:function(r,n){var t=new e;return this.forEachGroup(function(e,o){t[e]=o.map(r.bind(n,e))}),t}},{key:"mapGroups",value:function(r,n){var t=new e;return this.forEachGroup(function(e,o){t[e]=r.call(n,e,o)}),t}},{key:"keys",value:function(){return Object.keys(this)}},{key:"reduceGroups",value:function(e,r,n){return this.forEachGroup(function(t,o){r=e.call(n,r,t,o)}),r}},{key:"count",value:function(){return this.reduceGroups(function(e,r,n){return e[r]=n.length,e},{})}}],[{key:"fromArray",value:function(r,n,t){for(var o=new e,i=0,a=r.length;i<a;i++){var u=n.call(t,r[i],i);o[u]||(o[u]=[]),o[u].push(r[i])}return o}},{key:"by",get:function(){return groupBy}}]),e}(),GLOBAL$1="undefined"!=typeof System?System.global:"undefined"!=typeof window?window:global,features$1={from:!!Array.from,filter:!!Array.prototype.filter,find:!!Array.prototype.find,findIndex:!!Array.prototype.findIndex,includes:!!Array.prototype.includes},from=features$1.from?Array.from:function(e){if(!e)return[];if(Array.isArray(e))return e;if(e.toArray)return e.toArray();for(var r=e.length,n=new Array(r);r--;)n[r]=e[r];return n},detect=features$1.find?function(e,r,n){return e.find(r,n)}:function(e,r,n){for(var t,o=0,i=e.length;o<i;o++)if(t=e[o],r.call(n,t,o))return t},findIndex=features$1.findIndex?function(e,r,n){return e.findIndex(r,n)}:function(e,r,n){var t=-1;return e.find(function(e,o){return t=o,r.call(e,n)})?t:-1},isArray$1=Array.isArray,includes$1=features$1.includes?function(e,r){return e.includes(r)}:function(e,r){return e.indexOf(r)!==-1},include$1=includes$1,permutations=function(){function e(r,n){return r.length?flatmap(r,function(t,o){return e(r.slice(0,o).concat(r.slice(o+1)),n.concat([t]))}):[n]}return function(r){return e(r,[])}}();features$1.from||(Array.from=from),features$1.filter||(Array.prototype.filter=function(e,r){return filter(this,e,r)}),features$1.find||(Array.prototype.find=function(e,r){return detect(this,e,r)}),features$1.findIndex||(Array.prototype.findIndex=function(e,r){return findIndex(this,e,r)}),features$1.includes||(Array.prototype.includes=function(e){return includes$1(this,e)});var arr=Object.freeze({range:range,from:from,withN:withN,genN:genN,filter:filter,detect:detect,findIndex:findIndex,findAndGet:findAndGet,filterByKey:filterByKey,grep:grep,mask:mask,reject:reject,rejectByKey:rejectByKey,without:without,withoutAll:withoutAll,uniq:uniq,uniqBy:uniqBy,uniqByKey:uniqByKey,compact:compact,mutableCompact:mutableCompact,forEach:forEach$1,zip:zip,flatten:flatten,flatmap:flatmap,interpose:interpose,delimWith:delimWith,map:map$1,invoke:invoke,pluck:pluck,reduce:reduce,reduceRight:reduceRight,isArray:isArray$1,includes:includes$1,include:include$1,some:some,every:every,equals:equals$2,deepEquals:deepEquals,isSorted:isSorted,sort:sort,sortBy:sortBy,sortByKey:sortByKey,reverse:reverse,reversed:reversed,reMatches:reMatches$1,first:first,last:last,intersect:intersect,union:union,pushAt:pushAt,removeAt:removeAt,remove:remove,pushAll:pushAll$1,pushAllAt:pushAllAt,pushIfNotIncluded:pushIfNotIncluded,replaceAt:replaceAt,clear:clear,isSubset:isSubset,doAndContinue:doAndContinue,nestedDelay:nestedDelay,forEachShowingProgress:forEachShowingProgress,swap:swap,rotate:rotate,groupBy:groupBy,groupByKey:groupByKey,partition:partition,batchify:batchify,toTuples:toTuples,permutations:permutations,combinationsPick:combinationsPick,combinations:combinations,take:take,drop:drop,takeWhile:takeWhile,dropWhile:dropWhile,shuffle:shuffle,max:max,min:min,sum:sum,count:count$1,size:size$1,histogram:histogram,clone:clone$1,toArray:toArray$3,each:each,all:all$1,any:any,collect:collect,findAll:findAll,inject:inject,mapAsyncSeries:mapAsyncSeries,mapAsync:mapAsync}),getOwnPropertyDescriptors="function"==typeof Object.prototype.getOwnPropertyDescriptors?Object.prototype.getOwnPropertyDescriptors:function(e){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&Object.defineProperty(r,n,{configurable:!0,enumerable:!0,writable:!0,value:Object.getOwnPropertyDescriptor(e,n)});return r},keys$1=Object.keys,obj=Object.freeze({isArray:isArray$$1,isElement:isElement,isFunction:isFunction,isBoolean:isBoolean,isString:isString,isNumber:isNumber,isUndefined:isUndefined,isRegExp:isRegExp,isObject:isObject,isPrimitive:isPrimitive,isEmpty:isEmpty,equals:equals$1,keys:keys$1,values:values,select:select,dissoc:dissoc,addScript:addScript,extend:extend,clone:clone$$1,extract:extract,inspect:inspect,merge:merge,deepMerge:deepMerge,inherit:inherit,valuesInPropertyHierarchy:valuesInPropertyHierarchy,mergePropertyInHierarchy:mergePropertyInHierarchy,sortKeysWithBeforeAndAfterConstraints:sortKeysWithBeforeAndAfterConstraints,deepCopy:deepCopy,typeStringOf:typeStringOf,shortPrintStringOf:shortPrintStringOf,isMutableType:isMutableType,safeToString:safeToString,asObject:asObject,newKeyIn:newKeyIn}),features={repeat:!!String.prototype.repeat,includes:!!String.prototype.includes,startsWith:!!String.prototype.startsWith,endsWith:!!String.prototype.endsWith},pathDotRe=/\/\.\//g,pathDoubleDotRe=/\/[^\/]+\/\.\./,pathDoubleSlashRe=/(^|[^:])[\/]+/g,urlStartRe=/^[a-z0-9-_\.]+:\/\//,newUUIDTemplate="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",newUUIDRe=/[xy]/g,newUUIDReplacer=function(e){var r=16*Math.random()|0,n="x"==e?r:3&r|8;return n.toString(16)},includes$$1=features.includes?function(e,r){return e.includes(r)}:function(e,r){return e.indexOf(r)>-1},include$$1=includes$$1,startsWith=features.startsWith?function(e,r){return e.startsWith(r)}:function(e,r){return 0===e.indexOf(r)},endsWith=features.endsWith?function(e,r){return e.endsWith(r)}:function(e,r){var n=e.length-r.length;return n>=0&&e.lastIndexOf(r)===n},times=features.repeat?function(e,r){return e.repeat(r)}:function(e,r){return r<1?"":new Array(r+1).join(e)},string=Object.freeze({format:format,formatFromArray:formatFromArray,indent:indent,minIndent:minIndent,changeIndent:changeIndent,quote:quote,print:print,printNested:printNested,pad:pad,printTable:printTable,printTree:printTree,toArray:toArray$1,lines:lines,paragraphs:paragraphs,nonEmptyLines:nonEmptyLines,tokens:tokens,tableize:tableize,unescapeCharacterEntities:unescapeCharacterEntities,toQueryParams:toQueryParams,normalizePath:normalizePath$1,joinPath:joinPath,newUUID:newUUID,createDataURI:createDataURI,hashCode:hashCode,md5:md5,reMatches:reMatches$$1,stringMatch:stringMatch,peekRight:peekRight,peekLeft:peekLeft,lineIndexComputer:lineIndexComputer,lineNumberToIndexesComputer:lineNumberToIndexesComputer,findLineWithIndexInLineRanges:findLineWithIndexInLineRanges,regexIndexOf:regexIndexOf,regexLastIndexOf:regexLastIndexOf,lineRanges:lineRanges,diff:diff,empty:empty,includes:includes$$1,include:include$$1,startsWith:startsWith,startsWithVowel:startsWithVowel,endsWith:endsWith,withDecimalPrecision:withDecimalPrecision,capitalize:capitalize,camelCaseString:camelCaseString,camelize:camelize,truncate:truncate,truncateLeft:truncateLeft,regExpEscape:regExpEscape,succ:succ,digitValue:digitValue,times:times,longestCommonSubstring:longestCommonSubstring,applyChange:applyChange,applyChanges:applyChanges,levenshtein:levenshtein}),normalRandom=function(e,r){var n,t=!1;return function(e,r){if(t)return t=!1,n*r+e;var o,i,a;do o=2*Math.random()-1,i=2*Math.random()-1,a=o*o+i*i;while(a>=1||0==a);var u=Math.sqrt(-2*Math.log(a)/a);return n=i*u,t=!0,e+r*o*u}}(),convertLength=function(){function e(r,n){return"cm"===n?r:"mm"===n?.1*r:"in"===n?2.54*r:"px"===n?r*e(1/96,"in"):"pt"===n?r*e(1/72,"in"):"pc"===n?r*e(12,"pt"):void 0}return function r(n,t,o){return t===o?n:"cm"===o?e(n,t):"cm"===t?n/e(1,o):r(r(n,t,"cm"),"cm",o)}}(),num=Object.freeze({random:random,normalRandom:normalRandom,randomSmallerInteger:randomSmallerInteger,humanReadableByteSize:humanReadableByteSize,average:average,averageInc:averageInc,median:median,between:between,sort:sort$1,parseLength:parseLength,convertLength:convertLength,roundTo:roundTo,detent:detent,toDegrees:toDegrees,toRadians:toRadians,backoff:backoff}),properties=Object.freeze({all:all$2,allOwnPropertiesOrFunctions:allOwnPropertiesOrFunctions,own:own$1,forEachOwn:forEachOwn,nameFor:nameFor,values:values$1,ownValues:ownValues,any:any$1,allProperties:allProperties,hash:hash}),dateFormat=function(){var e=function(){var r=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,n=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,t=/[^-+\dA-Z]/g,o=function(e,r){for(e=String(e),r=r||2;e.length<r;)e="0"+e;return e};return function(i,a,u){var c=e;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(i)||/\d/.test(i)||(a=i,i=void 0),i=i?new Date(i):new Date,isNaN(i))throw SyntaxError("invalid date");a=String(c.masks[a]||a||c.masks.default),"UTC:"==a.slice(0,4)&&(a=a.slice(4),u=!0);var s=u?"getUTC":"get",l=i[s+"Date"](),f=i[s+"Day"](),p=i[s+"Month"](),h=i[s+"FullYear"](),d=i[s+"Hours"](),g=i[s+"Minutes"](),y=i[s+"Seconds"](),m=i[s+"Milliseconds"](),v=u?0:i.getTimezoneOffset(),w={d:l,dd:o(l),ddd:c.i18n.dayNames[f],dddd:c.i18n.dayNames[f+7],m:p+1,mm:o(p+1),mmm:c.i18n.monthNames[p],mmmm:c.i18n.monthNames[p+12],yy:String(h).slice(2),yyyy:h,h:d%12||12,hh:o(d%12||12),H:d,HH:o(d),M:g,MM:o(g),s:y,ss:o(y),l:o(m,3),L:o(m>99?Math.round(m/10):m),t:d<12?"a":"p",tt:d<12?"am":"pm",T:d<12?"A":"P",TT:d<12?"AM":"PM",Z:u?"UTC":(String(i).match(n)||[""]).pop().replace(t,""),o:(v>0?"-":"+")+o(100*Math.floor(Math.abs(v)/60)+Math.abs(v)%60,4),S:["th","st","nd","rd"][l%10>3?0:(l%100-l%10!=10)*l%10]};return a.replace(r,function(e){return e in w?w[e]:e.slice(1,e.length-1)})}}();return e.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},e.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},e}(),date=Object.freeze({format:format$1,equals:equals$3,relativeTo:relativeTo});Object.assign(promise,{delay:delay$1,delayReject:delayReject,timeout:timeout,waitFor:waitFor$1,deferred:deferred,convertCallbackFun:convertCallbackFun,convertCallbackFunWithManyArgs:convertCallbackFunWithManyArgs,chain:chain$1,finally:promise_finally,parallel:parallel}),Object.assign(Path.prototype,{get isPathAccessor(){return!0},fromPath:function(e){return"string"==typeof e&&""!==e&&e!==this.splitter?(this._parts=e.split(this.splitter),this._path=e):Array.isArray(e)?(this._parts=[].concat(e),this._path=e.join(this.splitter)):(this._parts=[],this._path=""),this},setSplitter:function(e){return e&&(this.splitter=e),this},parts:function(){return this._parts},size:function(){return this._parts.length},slice:function(e,r){return Path(this.parts().slice(e,r))},normalizePath:function(){return this._path},isRoot:function(e){return 0===this._parts.length},isIn:function(e){if(this.isRoot())return!0;var r=this.get(e,-1);return r&&r.hasOwnProperty(this._parts[this._parts.length-1])},equals:function(e){return e&&e.isPathAccessor&&this.parts().equals(e.parts())},isParentPathOf:function(e){e=e&&e.isPathAccessor?e:Path(e);for(var r=this.parts(),n=e.parts(),t=0;t<r.length;t++)if(r[t]!=n[t])return!1;return!0},relativePathTo:function(e){return e=Path(e),this.isParentPathOf(e)?e.slice(this.size(),e.size()):void 0},del:function(e){if(this.isRoot())return!1;for(var r=e,n=0;n<this._parts.length-1;n++){var t=this._parts[n];if(!r.hasOwnProperty(t))return!1;r=r[t]}return delete r[this._parts[this._parts.length-1]]},withParentAndKeyDo:function(e,r,n){if(this.isRoot())return n(null,null);for(var t=e,o=0;o<this._parts.length-1;o++){var i=this._parts[o];if(!t.hasOwnProperty(i)||"object"!==_typeof(t[i])&&"function"!=typeof t[i]){if(!r)return n(null,i);t=t[i]={}}else t=t[i]}return n(t,this._parts[this._parts.length-1])},set:function(e,r,n){return this.withParentAndKeyDo(e,n,function(e,n){return e?e[n]=r:void 0})},defineProperty:function(e,r,n){return this.withParentAndKeyDo(e,n,function(e,n){return e?Object.defineProperty(e,n,r):void 0})},get:function(e,r){var n=r?this._parts.slice(0,r):this._parts;return n.reduce(function(e,r){return e?e[r]:e},e)},concat:function(e,r){return Path(this.parts().concat(Path(e,r).parts()))},toString:function(){return this.normalizePath()},serializeExpr:function(){return"lively.lang.Path("+inspect(this.parts())+")"},watch:function(e){if(e&&!this.isRoot()){var r=e.target,n=this.get(r,-1),t=this.parts().slice(-1)[0],o="propertyWatcher$"+t,i=n&&n.hasOwnProperty(o),a=e.uninstall,u=(e.haltWhenChanged,e.showStack),c=n.__lookupGetter__(t),s=n.__lookupSetter__(t);if(r&&t&&n){if(a){if(!i)return;delete n[t],n[t]=n[o],delete n[o];var l="Watcher for "+n+"."+t+" uninstalled";return void show(l)}if(i){var l="Watcher for "+n+"."+t+" already installed";return void show(l)}if(c||s){var l=n+'["'+t+'"] is a getter/setter, watching not support';return console.log(l),void("undefined"==typeof show&&show(l))}n[o]=n[t],n.__defineSetter__(t,function(r){var i=n[o];e.onSet&&e.onSet(r,i);var a=n+"."+t+" changed: "+i+" -> "+r;return u&&(a+="\n"+("undefined"!=typeof lively?lively.printStack():console.trace())),e.verbose&&(console.log(a),"undefined"!=typeof show&&show(a)),n[o]=r}),n.__defineGetter__(t,function(){return e.onGet&&e.onGet(n[o]),n[o]});var l="Watcher for "+n+"."+t+" installed";console.log(l),"undefined"!=typeof show&&show(l)}}},debugFunctionWrapper:function(e){var r=e.target,n=this.get(r,-1),t=this.parts().slice(-1)[0],o=e.uninstall,i=(void 0===e.haltWhenChanged||e.haltWhenChanged,e.showStack),a=n&&t&&n[t],u=a&&a.isDebugFunctionWrapper;if(r&&t&&a&&n){if(o){if(!u)return;n[t]=n[t].debugTargetFunction;var c="Uninstalled debugFunctionWrapper for "+n+"."+t;return console.log(c),"undefined"!=typeof show&&show(c),void show(c)}if(u){var c="debugFunctionWrapper for "+n+"."+t+" already installed";return console.log(c),void("undefined"!=typeof show&&show(c))}var s=n[t]=a.wrap(function(r){var o=Array.from(arguments);return i&&show(lively.printStack()),e.verbose&&show(t+" called"),o.shift().apply(n,o)});s.isDebugFunctionWrapper=!0,s.debugTargetFunction=a;var c="debugFunctionWrapper for "+n+"."+t+" installed";console.log(c),"undefined"!=typeof show&&show(c)}}});var graph=Object.freeze({clone:clone$2,without:without$1,hull:hull,subgraphReachableBy:subgraphReachableBy,invert:invert,sortByReference:sortByReference,reduce:reduce$1,random:random$1}),GLOBAL$2="undefined"!=typeof System?System.global:"undefined"!=typeof window?window:global,interval=Object.freeze({isInterval:isInterval,sort:sort$2,compare:compare,coalesce:coalesce,coalesceOverlapping:coalesceOverlapping,mergeOverlapping:mergeOverlapping,intervalsInRangeDo:intervalsInRangeDo,intervalsInbetween:intervalsInbetween,mapToMatchingIndexes:mapToMatchingIndexes}),arrayProjection=Object.freeze({create:create,toArray:toArray$4,originalToProjectedIndex:originalToProjectedIndex,projectedToOriginalIndex:projectedToOriginalIndex,transformToIncludeIndex:transformToIncludeIndex}),grid=Object.freeze({get:get$2,set:set$2,getRow:getRow,setRow:setRow,getCol:getCol,setCol:setCol,create:create$1,mapCreate:mapCreate,forEach:forEach$2,map:map$2,toObjects:toObjects,tableFromObjects:tableFromObjects}),detect$1=find,tree=Object.freeze({prewalk:prewalk,postwalk:postwalk,find:find,detect:detect$1,filter:filter$1,map:map$3,mapTree:mapTree}),isNode$1="undefined"!=typeof process&&process.versions&&process.versions.node,makeEmitter=isNode$1?function(e,r){if(e.on&&e.removeListener)return e;var n="undefined"!=typeof System?System._nodeRequire("events"):require("events");return Object.assign(e,n.EventEmitter.prototype),n.EventEmitter.call(e),r&&r.maxListenerLimit&&e.setMaxListeners(r.maxListenerLimit),e}:function(e){return e.on&&e.removeListener?e:(e.listeners={},e.on=function(r,n){n&&(e.listeners[r]||(e.listeners[r]=[]),e.listeners[r].push(n))},e.once=function(r,n){function t(){e.removeListener(r,t),n.apply(this,arguments)}n&&e.on(r,t)},e.removeListener=function(r,n){e.listeners[r]&&(e.listeners[r]=e.listeners[r].filter(function(e){return e!==n}))},e.removeAllListeners=function(r){e.listeners[r]&&(e.listeners[r]=[])},e.emit=function(){var r=Array.prototype.slice.call(arguments),n=r.shift(),t=e.listeners[n];t&&t.length&&t.forEach(function(e){try{e.apply(null,r)}catch(e){console.error("Error in event handler: %s",e.stack||String(e))}})},e)},events=Object.freeze({makeEmitter:makeEmitter}),OFFLINE="offline",ONLINE="online",messenger=Object.freeze({create:create$2}),isNodejs="undefined"!=typeof require&&"undefined"!=typeof process,WorkerSetup={loadDependenciesBrowser:function(e){var r="undefined"!=typeof self?self:this;importScripts.apply(r,e.scriptsToLoad||[])},loadDependenciesNodejs:function(e){var r=global.lively||(global.lively={});r.lang=require(require("path").join(e.libLocation,"index"))},initBrowserGlobals:function(e){remoteWorker.send=function(e){postMessage(e)};var r="undefined"!=typeof self?self:this,n=r.Global=r;n.window=n,n.console=n.console||function(){var e={};return["log","error","warn"].forEach(function(r){e[r]=function(){for(var e=arguments[0],n=1;n<arguments.length;n++)e=e.replace("%s",arguments[n]);remoteWorker.send({type:r,message:["[",r.toUpperCase(),"] ",e].join("")})}}),e}()},initOnMessageHandler:function(e){function r(e){if(e=e.data.data?e.data:e,remoteWorker.messenger)remoteWorker.messenger.onMessage(e);else if("close"==e.action)return remoteWorker.send({type:"closed",workerReady:!1}),void remoteWorker.close()}remoteWorker.on?remoteWorker.on("message",r):remoteWorker.onmessage=r},initWorkerInterface:function initWorkerInterface(options){remoteWorker.callStringifiedFunction=function(stringifiedFunc,args,thenDo){var func;try{func=eval("("+stringifiedFunc+")")}catch(e){return void thenDo(new Error("Cannot create function from string: "+e.stack||e))}var usesCallback=func.length===args.length+1,whenDone=lively.lang.fun.once(function(e,r){remoteWorker.isBusy=!1,thenDo(e,r)});remoteWorker.isBusy=!0,usesCallback&&args.push(whenDone);try{var result=func.apply(remoteWorker,args.concat([whenDone]))}catch(e){return void whenDone(e,null)}usesCallback||whenDone(null,result)},remoteWorker.httpRequest=function(e){function r(){4===n.readyState&&e.done&&e.done(n)}if(!e.url)return void console.log("Error, httpRequest needs url");var n=new XMLHttpRequest,t=e.method||"GET";n.onreadystatechange=r,n.open(t,e.url),n.send()},remoteWorker.terminateIfNotBusyIn=function(e){setTimeout(function(){return remoteWorker.isBusy?void remoteWorker.terminateIfNotBusyIn(e):(remoteWorker.send({type:"closed",workerReady:!1}),void remoteWorker.close())},e)}},initWorkerMessenger:function initWorkerMessenger(options){if(!options.useMessenger)return null;if(!lively.lang.messenger)throw new Error("worker.create requires messenger.js to be loaded!");if(!lively.lang.events)throw new Error("worker.create requires events.js to be loaded!");return remoteWorker.messenger=lively.lang.messenger.create({services:{remoteEval:function remoteEval(msg,messenger){var result;try{result=eval(msg.data.expr)}catch(e){result=e.stack||e}messenger.answer(msg,{result:String(result)})},run:function(e,r){var n=e.data.func,t=e.data.args;return n?void remoteWorker.callStringifiedFunction(n,t,function(n,t){r.answer(e,{error:n?String(n):null,result:t})}):void r.answer(e,{error:"no funcString"})},close:function(e,r){r.answer(e,{status:"OK"}),remoteWorker.send({type:"closed",workerReady:!1}),remoteWorker.close()}},isOnline:function(){return!0},send:function(e,r){remoteWorker.send(e),r()},listen:function(e){e()},close:function(e){remoteWorker.send({type:"closed",workerReady:!1}),remoteWorker.close()}})}},BrowserWorker={create:function(e){function r(e,r){makeEmitter(r),e.scriptsToLoad||(e.scriptsToLoad=["base.js","events.js","object.js","collection.js","function.js","string.js","number.js","date.js","messenger.js","worker.js"].map(function(r){return e.libLocation+r}));var n=Object.keys(e).reduce(function(r,n){return"function"!=typeof e[n]&&(r[n]=e[n]),r},{});r.onmessage=function(e){void 0!==e.data.workerReady?(r.ready=!!e.data.workerReady,r.ready?r.emit("ready"):r.emit("close")):r.emit("message",e.data)},r.errors=[],r.onerror=function(e){console.error(e),r.errors.push(e),r.emit("error",e)},r.postMessage({action:"setup",options:n})}function n(){var e=self;e.onmessage=function(e){if("setup"!==e.data.action)throw new Error("expected setup to be first message but got "+JSON.stringify(e.data));var r=e.data.options||{};initBrowserGlobals(r),loadDependenciesBrowser(r),initOnMessageHandler(r),initWorkerInterface(r),initWorkerMessenger(r),postMessage({workerReady:!0})},__FUNCTIONDECLARATIONS__}function t(e){var r;try{r=new Blob([e],{type:"text/javascript"})}catch(n){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,r=new BlobBuilder,r.append(e),r=r.getBlob()}var n="undefined"!=typeof webkitURL?webkitURL:URL;return n.createObjectURL(r)}if(e=e||{},!e.libLocation&&!e.scriptsToLoad){var o=document.querySelector('script[src$="worker.js"]');if(!o)throw new Error('Cannot find library path to start worker. Use worker.create({libLocation: "..."}) to explicitly define the path!');e.libLocation=o.src.replace(/worker.js$/,"")}var i=String(n).replace("__FUNCTIONDECLARATIONS__",[WorkerSetup.initBrowserGlobals,WorkerSetup.loadDependenciesBrowser,WorkerSetup.initOnMessageHandler,WorkerSetup.initWorkerInterface,WorkerSetup.initWorkerMessenger].join("\n")).split("__lvVarRecorder.").join(""),a="("+i+")();",u=new Worker(t(a));return r(e,u),u}},NodejsWorker={debug:!1,initCodeFileCreated:!1,create:function(e){e=e||{};var r,n=makeEmitter({ready:!1,errors:[],postMessage:function(e){return r?n.ready?void r.send(e):void n.emit("error",new Error("nodejs worker process not ready or already closed")):void n.emit("error",new Error("nodejs worker process not yet created"))}});return NodejsWorker.startWorker(e,function(e,t){return e?(n.ready=!1,void n.emit("error",e)):(r=t,r.on("message",function(e){NodejsWorker.debug&&console.log("[WORKER PARENT] got message:",e),n.emit("message",e)}),r.on("close",function(){console.log("[WORKER PARENT] worker closed"),n.emit("close")}),r.on("error",function(e){console.log("[WORKER PARENT] error ",e),n.errors.push(e),n.emit("error",e)}),n.ready=!0,void n.emit("ready"))}),n},workerSetupFunction:function(){var e=process,r=!0;r&&console.log("[WORKER] Starting init"),e.on("message",function(n){if("setup"!==n.action)throw new Error("expected setup to be first message but got "+JSON.stringify(n.data));e.removeAllListeners("message");var t=n.data.options||{};r&&console.log("[WORKER] running setup with options",t),loadDependenciesNodejs(t),initOnMessageHandler(t),initWorkerInterface(t),initWorkerMessenger(t),e.send({workerReady:!0})}),__FUNCTIONDECLARATIONS__},ensureInitCodeFile:function(e,r,n){var t=require("path"),o=require("os"),i=require("fs"),a=t.join(o.tmpDir(),"lively-nodejs-workers/"),u=t.join(a,"nodejs-worker-init.js");NodejsWorker.initCodeFileCreated?i.exists(u,function(t){t?n(null,u):NodejsWorker.createWorkerCodeFile(e,u,r,n)}):NodejsWorker.createWorkerCodeFile(e,u,r,n)},createWorkerCodeFile:function(e,r,n,t){var o=require("path"),i=require("fs"),a=require("child_process").exec;a("mkdir -p "+o.dirname(r),function(e,o,a){return e?void t(new Error(["[WORKER PARENT] Could not create worker temp dir:",o,a].join("\n"))):void i.writeFile(r,n,function(e){NodejsWorker.debug&&console.log("worker code file %s created",r),NodejsWorker.initCodeFileCreated=!0,t(e,r)})})},startWorker:function(e,r){var n=require("util"),t=require("child_process").fork,o=String(NodejsWorker.workerSetupFunction).replace("__FUNCTIONDECLARATIONS__",[WorkerSetup.loadDependenciesNodejs,WorkerSetup.initOnMessageHandler,WorkerSetup.initWorkerInterface,WorkerSetup.initWorkerMessenger].join("\n")),i=n.format("(%s)();\n",o);NodejsWorker.ensureInitCodeFile(e,i,function(n,o){if(n)return r(n);var i=t(o,{});NodejsWorker.debug&&console.log("worker forked"),i.on("message",function(e){"pong"===e.action?console.log("[WORKER pong] ",e):"log"===e.action&&console.log("[Message from WORKER] ",e.data)}),i.once("message",function(e){NodejsWorker.debug&&console.log("worker setup done"),r(null,i,e)}),i.on("close",function(){NodejsWorker.debug&&console.log("[WORKER PARENT] worker closed")}),i.send({action:"setup",data:{options:e}}),global.WORKER=i})}},worker=Object.freeze({fork:fork,create:create$3}),GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:void 0,isNode="undefined"!=typeof process&&process.env&&"function"==typeof process.exit,globalInterfaceSpec=[{action:"installMethods",target:"Array",sources:["arr"],methods:["from","genN","range","withN"]},{action:"installMethods",target:"Array.prototype",sources:["arr"],methods:["all","any","batchify","clear","clone","collect","compact","delimWith","detect","doAndContinue","each","equals","filterByKey","findAll","first","flatten","forEachShowingProgress","grep","groupBy","groupByKey","histogram","include","inject","intersect","invoke","last","mapAsync","mapAsyncSeries","mask","max","min","mutableCompact","nestedDelay","partition","pluck","pushAll","pushAllAt","pushAt","pushIfNotIncluded","reMatches","reject","rejectByKey","remove","removeAt","replaceAt","rotate","shuffle","size","sortBy","sortByKey","sum","swap","toArray","toTuples","union","uniq","uniqBy","without","withoutAll","zip"],
alias:[["select","filter"]]},{action:"installMethods",target:"Date",sources:["date"],methods:[]},{action:"installMethods",target:"Date.prototype",sources:["date"],methods:["equals","format","relativeTo"]},{action:"installMethods",target:"Function",sources:["fun"],methods:["fromString"]},{action:"installMethods",target:"Function.prototype",sources:["fun"],methods:["addToObject","argumentNames","asScript","asScriptOf","binds","curry","delay","functionNames","localFunctionNames","getOriginal","getVarMapping","logCalls","logCompletion","logErrors","qualifiedMethodName","setProperty","traceCalls","wrap"]},{action:"installMethods",target:"Number",sources:["num"],methods:[]},{action:"installMethods",target:"Number.prototype",sources:["num"],methods:["detent","randomSmallerInteger","roundTo","toDegrees","toRadians"]},{action:"installMethods",target:"Object",sources:["obj"],methods:["addScript","clone","deepCopy","extend","inherit","isArray","isBoolean","isElement","isEmpty","isFunction","isNumber","isObject","isRegExp","isString","isUndefined","merge","mergePropertyInHierarchy","values","valuesInPropertyHierarchy"]},{action:"installMethods",target:"Object.prototype",sources:["obj"],methods:[]},{action:"installMethods",target:"String.prototype",sources:["string"],methods:["camelize","capitalize","digitValue","empty","hashCode","include","pad","regExpEscape","startsWithVowel","succ","times","toArray","toQueryParams","truncate"]},{action:"installObject",target:"Numbers",source:"num",methods:["average","between","convertLength","humanReadableByteSize","median","normalRandom","parseLength","random","sort"]},{action:"installObject",target:"Properties",source:"properties",methods:["all","allOwnPropertiesOrFunctions","allProperties","any","forEachOwn","hash","nameFor","own","ownValues","values"]},{action:"installObject",target:"Strings",source:"string",methods:["camelCaseString","createDataURI","diff","format","formatFromArray","indent","lineIndexComputer","lines","md5","newUUID","nonEmptyLines","pad","paragraphs","peekLeft","peekRight","print","printNested","printTable","printTree","quote","reMatches","stringMatch","tableize","tokens","unescapeCharacterEntities","withDecimalPrecision"]},{action:"installObject",target:"Objects",source:"obj",methods:["asObject","equals","inspect","isMutableType","safeToString","shortPrintStringOf","typeStringOf"]},{action:"installObject",target:"Functions",source:"fun",methods:["all","compose","composeAsync","createQueue","debounce","debounceNamed","either","extractBody","flip","notYetImplemented","once","own","throttle","throttleNamed","timeToRun","timeToRunN","waitFor","workerWithCallbackQueue","wrapperChain"]},{action:"installObject",target:"Grid",source:"grid"},{action:"installObject",target:"Interval",source:"interval"},{action:"installObject",target:"lively.ArrayProjection",source:"arrayProjection"},{action:"installObject",target:"lively.Closure",source:"Closure"},{action:"installObject",target:"lively.Grouping",source:"Group"},{action:"installObject",target:"lively.PropertyPath",source:"Path"},{action:"installObject",target:"lively.Worker",source:"worker"},{action:"installObject",target:"lively.Class",source:"classHelper"}],livelyLang=createLivelyLangObject();exports.worker=worker,exports.messenger=messenger,exports.events=events,exports.tree=tree,exports.grid=grid,exports.arrayProjection=arrayProjection,exports.interval=interval,exports.graph=graph,exports.date=date,exports.properties=properties,exports.obj=obj,exports.arr=arr,exports.fun=fun,exports.num=num,exports.string=string,exports.Closure=Closure,exports.promise=promise,exports.Path=Path,exports.Group=Group,exports.livelyLang=livelyLang,exports.chain=chain$$1,exports.noConflict=noConflict,exports.installGlobals=installGlobals,exports.uninstallGlobals=uninstallGlobals}(this.lively.lang=this.lively.lang||{})}.call(GLOBAL),"undefined"!=typeof module&&module.exports&&(module.exports=GLOBAL.lively.lang)}();
//LIVELY.NOTIFICATIONS
!function(){var i="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(i,t){"use strict";function e(i){if(void 0===i){if("undefined"==typeof System)return void 0!==r?r:r||(r={emitter:t.events.makeEmitter({},{maxListenerLimit:1e4}),notifications:[]});i=System}var e=i.get("@lively-env");e||i.set("@lively-env",i.newModule({options:{}}));var n=e.options;if(!n)throw new Error("@lively-env registered read-only");return n.emitter||Object.assign(n,{emitter:i["__lively.notifications_emitter"]||(i["__lively.notifications_emitter"]=t.events.makeEmitter({},{maxListenerLimit:1e4})),notifications:i["__lively.notifications_notifications"]||(i["__lively.notifications_notifications"]=[])}),{emitter:n.emitter,notifications:n.notifications}}function n(i,t){i.push(t),i.limit&&i.splice(0,i.length-i.limit)}function o(i){var e=i.type+" ".repeat(Math.max(0,32-i.type.length));console.log(e+" "+t.obj.inspect(i,{maxDepth:2}))}var r=null;i.subscribe=function(i,t,n){return e(n).emitter.on(i,t),t},i.subscribeOnce=function(i,t,n){return e(n).emitter.once(i,t),t},i.emit=function(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),s=arguments[3],l=Object.assign({type:i,time:r},t),c=e(s),f=c.emitter,a=c.notifications;return f.emit(i,l),f.isLogging&&o(l),f.isRecording&&n(a,l),l},i.unsubscribe=function(i,t,n){return e(n).emitter.removeListener(i,t),t},i.unsubscribeAll=function(i,t){e(t).emitter.removeAllListeners(i)},i.startRecording=function(i){e(i).emitter.isRecording=!0},i.stopRecording=function(i){e(i).emitter.isRecording=!1},i.clearRecord=function(i){var t=e(i).notifications;t.splice(0,t.length)},i.getRecord=function(i){return e(i).notifications},i.startLogging=function(i){e(i).emitter.isLogging=!0},i.stopLogging=function(i){e(i).emitter.isLogging=!1}}(this.lively.notifications=this.lively.notifications||{},lively.lang),"undefined"!=typeof module&&module.exports&&(module.exports=i.lively.notifications)}();
//LIVELY.AST
!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;if(e.define){var t=e;delete e.define}!function(){var e=void 0;!function(){var e=void 0;(function(t,n){"function"==typeof e&&e.amd?e(["exports"],n):n(t.acorn=t.acorn||{})})(this,function(e){"use strict";function t(e,t){for(var n=65536,r=0;r<t.length;r+=2){if((n+=t[r])>e)return!1;if((n+=t[r+1])>=e)return!0}}function n(e,n){return e<65?36===e:e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&x.test(String.fromCharCode(e)):!1!==n&&t(e,b)))}function r(e,n){return e<48?36===e:e<58||!(e<65)&&(e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&E.test(String.fromCharCode(e)):!1!==n&&(t(e,b)||t(e,C)))))}function i(e,t){return new F(e,{beforeExpr:!0,binop:t})}function s(e,t){return void 0===t&&(t={}),t.keyword=e,B[e]=new F(e,t)}function u(e){return 10===e||13===e||8232===e||8233===e}function a(e,t){return L.call(e,t)}function o(e,t){for(var n=1,r=0;;){T.lastIndex=r;var i=T.exec(e);if(!(i&&i.index<t))return new M(n,t-r);++n,r=i.index+i[0].length}}function c(e){var t={};for(var n in V)t[n]=e&&a(e,n)?e[n]:V[n];if(t.ecmaVersion>=2015&&(t.ecmaVersion-=2009),null==t.allowReserved&&(t.allowReserved=t.ecmaVersion<5),O(t.onToken)){var r=t.onToken;t.onToken=function(e){return r.push(e)}}return O(t.onComment)&&(t.onComment=p(t,t.onComment)),t}function p(e,t){return function(n,r,i,s,u,a){var o={type:n?"Block":"Line",value:r,start:i,end:s};e.locations&&(o.loc=new R(this,u,a)),e.ranges&&(o.range=[i,s]),t.push(o)}}function l(e){return new RegExp("^(?:"+e.replace(/ /g,"|")+")$")}function h(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=-1}function d(e,t,n,r){return e.type=t,e.end=n,this.options.locations&&(e.loc.end=r),this.options.ranges&&(e.range[1]=n),e}function f(e,t,n,r){try{return new RegExp(e,t)}catch(e){if(void 0!==n)throw e instanceof SyntaxError&&r.raise(n,"Error parsing regular expression: "+e.message),e}}function m(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}var y={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},g="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",v={5:g,6:g+" const class extends export import super"},A="-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",D="-------------------------------------------------------------------------------------------------------------------------------------------------",x=new RegExp("["+A+"]"),E=new RegExp("["+A+D+"]");A=D=null;var b=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,17,26,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,26,45,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,785,52,76,44,33,24,27,35,42,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,54,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,86,25,391,63,32,0,449,56,264,8,2,36,18,0,50,29,881,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,881,68,12,0,67,12,65,0,32,6124,20,754,9486,1,3071,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,4149,196,60,67,1213,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42710,42,4148,12,221,3,5761,10591,541],C=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,1306,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,52,0,13,2,49,13,10,2,4,9,83,11,7,0,161,11,6,9,7,3,57,0,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,87,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,423,9,838,7,2,7,17,9,57,21,2,13,19882,9,135,4,60,6,26,9,1016,45,17,3,19723,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,2214,6,110,6,6,9,792487,239],F=function(e,t){void 0===t&&(t={}),this.label=e,this.keyword=t.keyword,this.beforeExpr=!!t.beforeExpr,this.startsExpr=!!t.startsExpr,this.isLoop=!!t.isLoop,this.isAssign=!!t.isAssign,this.prefix=!!t.prefix,this.postfix=!!t.postfix,this.binop=t.binop||null,this.updateContext=null},S={beforeExpr:!0},k={startsExpr:!0},B={},_={num:new F("num",k),regexp:new F("regexp",k),string:new F("string",k),name:new F("name",k),eof:new F("eof"),bracketL:new F("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new F("]"),braceL:new F("{",{beforeExpr:!0,startsExpr:!0}),braceR:new F("}"),parenL:new F("(",{beforeExpr:!0,startsExpr:!0}),parenR:new F(")"),comma:new F(",",S),semi:new F(";",S),colon:new F(":",S),dot:new F("."),question:new F("?",S),arrow:new F("=>",S),template:new F("template"),invalidTemplate:new F("invalidTemplate"),ellipsis:new F("...",S),backQuote:new F("`",k),dollarBraceL:new F("${",{beforeExpr:!0,startsExpr:!0}),eq:new F("=",{beforeExpr:!0,isAssign:!0}),assign:new F("_=",{beforeExpr:!0,isAssign:!0}),incDec:new F("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new F("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:i("||",1),logicalAND:i("&&",2),bitwiseOR:i("|",3),bitwiseXOR:i("^",4),bitwiseAND:i("&",5),equality:i("==/!=/===/!==",6),relational:i("</>/<=/>=",7),bitShift:i("<</>>/>>>",8),plusMin:new F("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:i("%",10),star:i("*",10),slash:i("/",10),starstar:new F("**",{beforeExpr:!0}),_break:s("break"),_case:s("case",S),_catch:s("catch"),_continue:s("continue"),_debugger:s("debugger"),_default:s("default",S),_do:s("do",{isLoop:!0,beforeExpr:!0}),_else:s("else",S),_finally:s("finally"),_for:s("for",{isLoop:!0}),_function:s("function",k),_if:s("if"),_return:s("return",S),_switch:s("switch"),_throw:s("throw",S),_try:s("try"),_var:s("var"),_const:s("const"),_while:s("while",{isLoop:!0}),_with:s("with"),_new:s("new",{beforeExpr:!0,startsExpr:!0}),_this:s("this",k),_super:s("super",k),_class:s("class",k),_extends:s("extends",S),_export:s("export"),_import:s("import"),_null:s("null",k),_true:s("true",k),_false:s("false",k),_in:s("in",{beforeExpr:!0,binop:7}),_instanceof:s("instanceof",{beforeExpr:!0,binop:7}),_typeof:s("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:s("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:s("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},w=/\r\n?|\n|\u2028|\u2029/,T=new RegExp(w.source,"g"),I=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,P=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,N=Object.prototype,L=N.hasOwnProperty,j=N.toString,O=Array.isArray||function(e){return"[object Array]"===j.call(e)},M=function(e,t){this.line=e,this.column=t};M.prototype.offset=function(e){return new M(this.line,this.column+e)};var R=function(e,t,n){this.start=t,this.end=n,null!==e.sourceFile&&(this.source=e.sourceFile)},V={ecmaVersion:7,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1,plugins:{}},q={},W=function(e,t,n){this.options=e=c(e),this.sourceFile=e.sourceFile,this.keywords=l(v[e.ecmaVersion>=6?6:5]);var r="";if(!e.allowReserved){for(var i=e.ecmaVersion;!(r=y[i]);i--);"module"==e.sourceType&&(r+=" await")}this.reservedWords=l(r);var s=(r?r+" ":"")+y.strict;this.reservedWordsStrict=l(s),this.reservedWordsStrictBind=l(s+" "+y.strictBind),this.input=String(t),this.containsEsc=!1,this.loadPlugins(e.plugins),n?(this.pos=n,this.lineStart=this.input.lastIndexOf("\n",n-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(w).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=_.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===e.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.inFunction=this.inGenerator=this.inAsync=!1,this.yieldPos=this.awaitPos=0,this.labels=[],0===this.pos&&e.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterFunctionScope()};W.prototype.isKeyword=function(e){return this.keywords.test(e)},W.prototype.isReservedWord=function(e){return this.reservedWords.test(e)},W.prototype.extend=function(e,t){this[e]=t(this[e])},W.prototype.loadPlugins=function(e){var t=this;for(var n in e){var r=q[n];if(!r)throw new Error("Plugin '"+n+"' not found");r(t,e[n])}},W.prototype.parse=function(){var e=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(e)};var U=W.prototype,J=/^(?:'((?:\\.|[^'])*?)'|"((?:\\.|[^"])*?)"|;)/;U.strictDirective=function(e){for(var t=this;;){P.lastIndex=e,e+=P.exec(t.input)[0].length;var n=J.exec(t.input.slice(e));if(!n)return!1;if("use strict"==(n[1]||n[2]))return!0;e+=n[0].length}},U.eat=function(e){return this.type===e&&(this.next(),!0)},U.isContextual=function(e){return this.type===_.name&&this.value===e},U.eatContextual=function(e){return this.value===e&&this.eat(_.name)},U.expectContextual=function(e){this.eatContextual(e)||this.unexpected()},U.canInsertSemicolon=function(){return this.type===_.eof||this.type===_.braceR||w.test(this.input.slice(this.lastTokEnd,this.start))},U.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},U.semicolon=function(){this.eat(_.semi)||this.insertSemicolon()||this.unexpected()},U.afterTrailingComma=function(e,t){if(this.type==e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),t||this.next(),!0},U.expect=function(e){this.eat(e)||this.unexpected()},U.unexpected=function(e){this.raise(null!=e?e:this.start,"Unexpected token")},U.checkPatternErrors=function(e,t){if(e){e.trailingComma>-1&&this.raiseRecoverable(e.trailingComma,"Comma is not permitted after the rest element");var n=t?e.parenthesizedAssign:e.parenthesizedBind;n>-1&&this.raiseRecoverable(n,"Parenthesized pattern")}},U.checkExpressionErrors=function(e,t){var n=e?e.shorthandAssign:-1;if(!t)return n>=0;n>-1&&this.raise(n,"Shorthand property assignments are valid only in destructuring patterns")},U.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},U.isSimpleAssignTarget=function(e){return"ParenthesizedExpression"===e.type?this.isSimpleAssignTarget(e.expression):"Identifier"===e.type||"MemberExpression"===e.type};var X=W.prototype;X.parseTopLevel=function(e){var t=this,n={};for(e.body||(e.body=[]);this.type!==_.eof;){var r=t.parseStatement(!0,!0,n);e.body.push(r)}return this.adaptDirectivePrologue(e.body),this.next(),this.options.ecmaVersion>=6&&(e.sourceType=this.options.sourceType),this.finishNode(e,"Program")};var z={kind:"loop"},G={kind:"switch"};X.isLet=function(){if(this.type!==_.name||this.options.ecmaVersion<6||"let"!=this.value)return!1;P.lastIndex=this.pos;var e=P.exec(this.input),t=this.pos+e[0].length,i=this.input.charCodeAt(t);if(91===i||123==i)return!0;if(n(i,!0)){for(var s=t+1;r(this.input.charCodeAt(s),!0);)++s;var u=this.input.slice(t,s);if(!this.isKeyword(u))return!0}return!1},X.isAsyncFunction=function(){if(this.type!==_.name||this.options.ecmaVersion<8||"async"!=this.value)return!1;P.lastIndex=this.pos;var e=P.exec(this.input),t=this.pos+e[0].length;return!(w.test(this.input.slice(this.pos,t))||"function"!==this.input.slice(t,t+8)||t+8!=this.input.length&&r(this.input.charAt(t+8)))},X.parseStatement=function(e,t,n){var r,i=this.type,s=this.startNode();switch(this.isLet()&&(i=_._var,r="let"),i){case _._break:case _._continue:return this.parseBreakContinueStatement(s,i.keyword);case _._debugger:return this.parseDebuggerStatement(s);case _._do:return this.parseDoStatement(s);case _._for:return this.parseForStatement(s);case _._function:return!e&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(s,!1);case _._class:return e||this.unexpected(),this.parseClass(s,!0);case _._if:return this.parseIfStatement(s);case _._return:return this.parseReturnStatement(s);case _._switch:return this.parseSwitchStatement(s);case _._throw:return this.parseThrowStatement(s);case _._try:return this.parseTryStatement(s);case _._const:case _._var:return r=r||this.value,e||"var"==r||this.unexpected(),this.parseVarStatement(s,r);case _._while:return this.parseWhileStatement(s);case _._with:return this.parseWithStatement(s);case _.braceL:return this.parseBlock();case _.semi:return this.parseEmptyStatement(s);case _._export:case _._import:return this.options.allowImportExportEverywhere||(t||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===_._import?this.parseImport(s):this.parseExport(s,n);default:if(this.isAsyncFunction()&&e)return this.next(),this.parseFunctionStatement(s,!0);var u=this.value,a=this.parseExpression();return i===_.name&&"Identifier"===a.type&&this.eat(_.colon)?this.parseLabeledStatement(s,u,a):this.parseExpressionStatement(s,a)}},X.parseBreakContinueStatement=function(e,t){var n=this,r="break"==t;this.next(),this.eat(_.semi)||this.insertSemicolon()?e.label=null:this.type!==_.name?this.unexpected():(e.label=this.parseIdent(),this.semicolon());for(var i=0;i<this.labels.length;++i){var s=n.labels[i];if(null==e.label||s.name===e.label.name){if(null!=s.kind&&(r||"loop"===s.kind))break;if(e.label&&r)break}}return i===this.labels.length&&this.raise(e.start,"Unsyntactic "+t),this.finishNode(e,r?"BreakStatement":"ContinueStatement")},X.parseDebuggerStatement=function(e){return this.next(),this.semicolon(),this.finishNode(e,"DebuggerStatement")},X.parseDoStatement=function(e){return this.next(),this.labels.push(z),e.body=this.parseStatement(!1),this.labels.pop(),this.expect(_._while),e.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(_.semi):this.semicolon(),this.finishNode(e,"DoWhileStatement")},X.parseForStatement=function(e){if(this.next(),this.labels.push(z),this.enterLexicalScope(),this.expect(_.parenL),this.type===_.semi)return this.parseFor(e,null);var t=this.isLet();if(this.type===_._var||this.type===_._const||t){var n=this.startNode(),r=t?"let":this.value;return this.next(),this.parseVar(n,!0,r),this.finishNode(n,"VariableDeclaration"),!(this.type===_._in||this.options.ecmaVersion>=6&&this.isContextual("of"))||1!==n.declarations.length||"var"!==r&&n.declarations[0].init?this.parseFor(e,n):this.parseForIn(e,n)}var i=new h,s=this.parseExpression(!0,i);return this.type===_._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.toAssignable(s),this.checkLVal(s),this.checkPatternErrors(i,!0),this.parseForIn(e,s)):(this.checkExpressionErrors(i,!0),this.parseFor(e,s))},X.parseFunctionStatement=function(e,t){return this.next(),this.parseFunction(e,!0,!1,t)},X.isFunction=function(){return this.type===_._function||this.isAsyncFunction()},X.parseIfStatement=function(e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement(!this.strict&&this.isFunction()),e.alternate=this.eat(_._else)?this.parseStatement(!this.strict&&this.isFunction()):null,this.finishNode(e,"IfStatement")},X.parseReturnStatement=function(e){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(_.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,"ReturnStatement")},X.parseSwitchStatement=function(e){var t=this;this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(_.braceL),this.labels.push(G),this.enterLexicalScope();for(var n,r=!1;this.type!=_.braceR;)if(t.type===_._case||t.type===_._default){var i=t.type===_._case;n&&t.finishNode(n,"SwitchCase"),e.cases.push(n=t.startNode()),n.consequent=[],t.next(),i?n.test=t.parseExpression():(r&&t.raiseRecoverable(t.lastTokStart,"Multiple default clauses"),r=!0,n.test=null),t.expect(_.colon)}else n||t.unexpected(),n.consequent.push(t.parseStatement(!0));return this.exitLexicalScope(),n&&this.finishNode(n,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(e,"SwitchStatement")},X.parseThrowStatement=function(e){return this.next(),w.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,"ThrowStatement")};var $=[];X.parseTryStatement=function(e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===_._catch){var t=this.startNode();this.next(),this.expect(_.parenL),t.param=this.parseBindingAtom(),this.enterLexicalScope(),this.checkLVal(t.param,"let"),this.expect(_.parenR),t.body=this.parseBlock(!1),this.exitLexicalScope(),e.handler=this.finishNode(t,"CatchClause")}return e.finalizer=this.eat(_._finally)?this.parseBlock():null,e.handler||e.finalizer||this.raise(e.start,"Missing catch or finally clause"),this.finishNode(e,"TryStatement")},X.parseVarStatement=function(e,t){return this.next(),this.parseVar(e,!1,t),this.semicolon(),this.finishNode(e,"VariableDeclaration")},X.parseWhileStatement=function(e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(z),e.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(e,"WhileStatement")},X.parseWithStatement=function(e){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement(!1),this.finishNode(e,"WithStatement")},X.parseEmptyStatement=function(e){return this.next(),this.finishNode(e,"EmptyStatement")},X.parseLabeledStatement=function(e,t,n){for(var r=this,i=0,s=r.labels;i<s.length;i+=1)s[i].name===t&&r.raise(n.start,"Label '"+t+"' is already declared");for(var u=this.type.isLoop?"loop":this.type===_._switch?"switch":null,a=this.labels.length-1;a>=0;a--){var o=r.labels[a];if(o.statementStart!=e.start)break;o.statementStart=r.start,o.kind=u}return this.labels.push({name:t,kind:u,statementStart:this.start}),e.body=this.parseStatement(!0),("ClassDeclaration"==e.body.type||"VariableDeclaration"==e.body.type&&"var"!=e.body.kind||"FunctionDeclaration"==e.body.type&&(this.strict||e.body.generator))&&this.raiseRecoverable(e.body.start,"Invalid labeled declaration"),this.labels.pop(),e.label=n,this.finishNode(e,"LabeledStatement")},X.parseExpressionStatement=function(e,t){return e.expression=t,this.semicolon(),this.finishNode(e,"ExpressionStatement")},X.parseBlock=function(e){var t=this;void 0===e&&(e=!0);var n=this.startNode();for(n.body=[],this.expect(_.braceL),e&&this.enterLexicalScope();!this.eat(_.braceR);){var r=t.parseStatement(!0);n.body.push(r)}return e&&this.exitLexicalScope(),this.finishNode(n,"BlockStatement")},X.parseFor=function(e,t){return e.init=t,this.expect(_.semi),e.test=this.type===_.semi?null:this.parseExpression(),this.expect(_.semi),e.update=this.type===_.parenR?null:this.parseExpression(),this.expect(_.parenR),this.exitLexicalScope(),e.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(e,"ForStatement")},X.parseForIn=function(e,t){var n=this.type===_._in?"ForInStatement":"ForOfStatement";return this.next(),e.left=t,e.right=this.parseExpression(),this.expect(_.parenR),this.exitLexicalScope(),e.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(e,n)},X.parseVar=function(e,t,n){var r=this;for(e.declarations=[],e.kind=n;;){var i=r.startNode();if(r.parseVarId(i,n),r.eat(_.eq)?i.init=r.parseMaybeAssign(t):"const"!==n||r.type===_._in||r.options.ecmaVersion>=6&&r.isContextual("of")?"Identifier"==i.id.type||t&&(r.type===_._in||r.isContextual("of"))?i.init=null:r.raise(r.lastTokEnd,"Complex binding patterns require an initialization value"):r.unexpected(),e.declarations.push(r.finishNode(i,"VariableDeclarator")),!r.eat(_.comma))break}return e},X.parseVarId=function(e,t){e.id=this.parseBindingAtom(t),this.checkLVal(e.id,t,!1)},X.parseFunction=function(e,t,n,r){this.initFunction(e),this.options.ecmaVersion>=6&&!r&&(e.generator=this.eat(_.star)),this.options.ecmaVersion>=8&&(e.async=!!r),t&&(e.id="nullableID"===t&&this.type!=_.name?null:this.parseIdent(),e.id&&this.checkLVal(e.id,"var"));var i=this.inGenerator,s=this.inAsync,u=this.yieldPos,a=this.awaitPos,o=this.inFunction;return this.inGenerator=e.generator,this.inAsync=e.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,this.enterFunctionScope(),t||(e.id=this.type==_.name?this.parseIdent():null),this.parseFunctionParams(e),this.parseFunctionBody(e,n),this.inGenerator=i,this.inAsync=s,this.yieldPos=u,this.awaitPos=a,this.inFunction=o,this.finishNode(e,t?"FunctionDeclaration":"FunctionExpression")},X.parseFunctionParams=function(e){this.expect(_.parenL),e.params=this.parseBindingList(_.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},X.parseClass=function(e,t){var n=this;this.next(),this.parseClassId(e,t),this.parseClassSuper(e);var r=this.startNode(),i=!1;for(r.body=[],this.expect(_.braceL);!this.eat(_.braceR);)if(!n.eat(_.semi)){var s=n.startNode(),u=n.eat(_.star),a=!1,o=n.type===_.name&&"static"===n.value;n.parsePropertyName(s),s.static=o&&n.type!==_.parenL,s.static&&(u&&n.unexpected(),u=n.eat(_.star),n.parsePropertyName(s)),n.options.ecmaVersion>=8&&!u&&!s.computed&&"Identifier"===s.key.type&&"async"===s.key.name&&n.type!==_.parenL&&!n.canInsertSemicolon()&&(a=!0,n.parsePropertyName(s)),s.kind="method";var c=!1;if(!s.computed){var p=s.key;u||a||"Identifier"!==p.type||n.type===_.parenL||"get"!==p.name&&"set"!==p.name||(c=!0,s.kind=p.name,p=n.parsePropertyName(s)),!s.static&&("Identifier"===p.type&&"constructor"===p.name||"Literal"===p.type&&"constructor"===p.value)&&(i&&n.raise(p.start,"Duplicate constructor in the same class"),c&&n.raise(p.start,"Constructor can't have get/set modifier"),u&&n.raise(p.start,"Constructor can't be a generator"),a&&n.raise(p.start,"Constructor can't be an async method"),s.kind="constructor",i=!0)}if(n.parseClassMethod(r,s,u,a),c){var l="get"===s.kind?0:1;if(s.value.params.length!==l){var h=s.value.start;"get"===s.kind?n.raiseRecoverable(h,"getter should have no params"):n.raiseRecoverable(h,"setter should have exactly one param")}else"set"===s.kind&&"RestElement"===s.value.params[0].type&&n.raiseRecoverable(s.value.params[0].start,"Setter cannot use rest params")}}return e.body=this.finishNode(r,"ClassBody"),this.finishNode(e,t?"ClassDeclaration":"ClassExpression")},X.parseClassMethod=function(e,t,n,r){t.value=this.parseMethod(n,r),e.body.push(this.finishNode(t,"MethodDefinition"))},X.parseClassId=function(e,t){e.id=this.type===_.name?this.parseIdent():!0===t?this.unexpected():null},X.parseClassSuper=function(e){e.superClass=this.eat(_._extends)?this.parseExprSubscripts():null},X.parseExport=function(e,t){var n=this;if(this.next(),this.eat(_.star))return this.expectContextual("from"),e.source=this.type===_.string?this.parseExprAtom():this.unexpected(),this.semicolon(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(_._default)){this.checkExport(t,"default",this.lastTokStart);var r;if(this.type===_._function||(r=this.isAsyncFunction())){var i=this.startNode();this.next(),r&&this.next(),e.declaration=this.parseFunction(i,"nullableID",!1,r)}else if(this.type===_._class){var s=this.startNode();e.declaration=this.parseClass(s,"nullableID")}else e.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(e,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())e.declaration=this.parseStatement(!0),"VariableDeclaration"===e.declaration.type?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id.name,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual("from"))e.source=this.type===_.string?this.parseExprAtom():this.unexpected();else{for(var u=0,a=e.specifiers;u<a.length;u+=1){var o=a[u];n.checkUnreserved(o.local)}e.source=null}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")},X.checkExport=function(e,t,n){e&&(a(e,t)&&this.raiseRecoverable(n,"Duplicate export '"+t+"'"),e[t]=!0)},X.checkPatternExport=function(e,t){var n=this,r=t.type;if("Identifier"==r)this.checkExport(e,t.name,t.start);else if("ObjectPattern"==r)for(var i=0,s=t.properties;i<s.length;i+=1){var u=s[i];n.checkPatternExport(e,u.value)}else if("ArrayPattern"==r)for(var a=0,o=t.elements;a<o.length;a+=1){var c=o[a];c&&n.checkPatternExport(e,c)}else"AssignmentPattern"==r?this.checkPatternExport(e,t.left):"ParenthesizedExpression"==r&&this.checkPatternExport(e,t.expression)},X.checkVariableExport=function(e,t){var n=this;if(e)for(var r=0,i=t;r<i.length;r+=1){var s=i[r];n.checkPatternExport(e,s.id)}},X.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},X.parseExportSpecifiers=function(e){var t=this,n=[],r=!0;for(this.expect(_.braceL);!this.eat(_.braceR);){if(r)r=!1;else if(t.expect(_.comma),t.afterTrailingComma(_.braceR))break;var i=t.startNode();i.local=t.parseIdent(!0),i.exported=t.eatContextual("as")?t.parseIdent(!0):i.local,t.checkExport(e,i.exported.name,i.exported.start),n.push(t.finishNode(i,"ExportSpecifier"))}return n},X.parseImport=function(e){return this.next(),this.type===_.string?(e.specifiers=$,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===_.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(e,"ImportDeclaration")},X.parseImportSpecifiers=function(){var e=this,t=[],n=!0;if(this.type===_.name){var r=this.startNode();if(r.local=this.parseIdent(),this.checkLVal(r.local,"let"),t.push(this.finishNode(r,"ImportDefaultSpecifier")),!this.eat(_.comma))return t}if(this.type===_.star){var i=this.startNode();return this.next(),this.expectContextual("as"),i.local=this.parseIdent(),this.checkLVal(i.local,"let"),t.push(this.finishNode(i,"ImportNamespaceSpecifier")),t}for(this.expect(_.braceL);!this.eat(_.braceR);){if(n)n=!1;else if(e.expect(_.comma),e.afterTrailingComma(_.braceR))break;var s=e.startNode();s.imported=e.parseIdent(!0),e.eatContextual("as")?s.local=e.parseIdent():(e.checkUnreserved(s.imported),s.local=s.imported),e.checkLVal(s.local,"let"),t.push(e.finishNode(s,"ImportSpecifier"))}return t},X.adaptDirectivePrologue=function(e){for(var t=0;t<e.length&&this.isDirectiveCandidate(e[t]);++t)e[t].directive=e[t].expression.raw.slice(1,-1)},X.isDirectiveCandidate=function(e){return"ExpressionStatement"===e.type&&"Literal"===e.expression.type&&"string"==typeof e.expression.value&&('"'===this.input[e.start]||"'"===this.input[e.start])};var Y=W.prototype;Y.toAssignable=function(e,t){var n=this;if(this.options.ecmaVersion>=6&&e)switch(e.type){case"Identifier":this.inAsync&&"await"===e.name&&this.raise(e.start,"Can not use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":break;case"ObjectExpression":e.type="ObjectPattern";for(var r=0,i=e.properties;r<i.length;r+=1){var s=i[r];"init"!==s.kind&&n.raise(s.key.start,"Object pattern can't contain getter or setter"),n.toAssignable(s.value,t)}break;case"ArrayExpression":e.type="ArrayPattern",this.toAssignableList(e.elements,t);break;case"AssignmentExpression":if("="!==e.operator){this.raise(e.left.end,"Only '=' operator can be used for specifying default value.");break}e.type="AssignmentPattern",delete e.operator,this.toAssignable(e.left,t);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(e.expression,t);break;case"MemberExpression":if(!t)break;default:this.raise(e.start,"Assigning to rvalue")}return e},Y.toAssignableList=function(e,t){var n=this,r=e.length;if(r){var i=e[r-1];if(i&&"RestElement"==i.type)--r;else if(i&&"SpreadElement"==i.type){i.type="RestElement";var s=i.argument;this.toAssignable(s,t),--r}6===this.options.ecmaVersion&&t&&i&&"RestElement"===i.type&&"Identifier"!==i.argument.type&&this.unexpected(i.argument.start)}for(var u=0;u<r;u++){var a=e[u];a&&n.toAssignable(a,t)}return e},Y.parseSpread=function(e){var t=this.startNode();return this.next(),t.argument=this.parseMaybeAssign(!1,e),this.finishNode(t,"SpreadElement")},Y.parseRestBinding=function(){var e=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==_.name&&this.unexpected(),e.argument=this.parseBindingAtom(),this.finishNode(e,"RestElement")},Y.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case _.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(_.bracketR,!0,!0),this.finishNode(e,"ArrayPattern");case _.braceL:return this.parseObj(!0)}return this.parseIdent()},Y.parseBindingList=function(e,t,n){for(var r=this,i=[],s=!0;!this.eat(e);)if(s?s=!1:r.expect(_.comma),t&&r.type===_.comma)i.push(null);else{if(n&&r.afterTrailingComma(e))break;if(r.type===_.ellipsis){var u=r.parseRestBinding();r.parseBindingListItem(u),i.push(u),r.type===_.comma&&r.raise(r.start,"Comma is not permitted after the rest element"),r.expect(e);break}var a=r.parseMaybeDefault(r.start,r.startLoc);r.parseBindingListItem(a),i.push(a)}return i},Y.parseBindingListItem=function(e){return e},Y.parseMaybeDefault=function(e,t,n){if(n=n||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(_.eq))return n;var r=this.startNodeAt(e,t);return r.left=n,r.right=this.parseMaybeAssign(),this.finishNode(r,"AssignmentPattern")},Y.checkLVal=function(e,t,n){var r=this;switch(e.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(t?"Binding ":"Assigning to ")+e.name+" in strict mode"),n&&(a(n,e.name)&&this.raiseRecoverable(e.start,"Argument name clash"),n[e.name]=!0),t&&"none"!==t&&(("var"===t&&!this.canDeclareVarName(e.name)||"var"!==t&&!this.canDeclareLexicalName(e.name))&&this.raiseRecoverable(e.start,"Identifier '"+e.name+"' has already been declared"),"var"===t?this.declareVarName(e.name):this.declareLexicalName(e.name));break;case"MemberExpression":t&&this.raiseRecoverable(e.start,(t?"Binding":"Assigning to")+" member expression");break;case"ObjectPattern":for(var i=0,s=e.properties;i<s.length;i+=1){var u=s[i];r.checkLVal(u.value,t,n)}break;case"ArrayPattern":for(var o=0,c=e.elements;o<c.length;o+=1){var p=c[o];p&&r.checkLVal(p,t,n)}break;case"AssignmentPattern":this.checkLVal(e.left,t,n);break;case"RestElement":this.checkLVal(e.argument,t,n);break;case"ParenthesizedExpression":this.checkLVal(e.expression,t,n);break;default:this.raise(e.start,(t?"Binding":"Assigning to")+" rvalue")}};var H=W.prototype;H.checkPropClash=function(e,t){if(!(this.options.ecmaVersion>=6&&(e.computed||e.method||e.shorthand))){var n,r=e.key;switch(r.type){case"Identifier":n=r.name;break;case"Literal":n=String(r.value);break;default:return}var i=e.kind;if(this.options.ecmaVersion>=6)"__proto__"===n&&"init"===i&&(t.proto&&this.raiseRecoverable(r.start,"Redefinition of __proto__ property"),t.proto=!0);else{var s=t[n="$"+n];if(s){("init"===i?this.strict&&s.init||s.get||s.set:s.init||s[i])&&this.raiseRecoverable(r.start,"Redefinition of property")}else s=t[n]={init:!1,get:!1,set:!1};s[i]=!0}}},H.parseExpression=function(e,t){var n=this,r=this.start,i=this.startLoc,s=this.parseMaybeAssign(e,t);if(this.type===_.comma){var u=this.startNodeAt(r,i);for(u.expressions=[s];this.eat(_.comma);)u.expressions.push(n.parseMaybeAssign(e,t));return this.finishNode(u,"SequenceExpression")}return s},H.parseMaybeAssign=function(e,t,n){if(this.inGenerator&&this.isContextual("yield"))return this.parseYield();var r=!1,i=-1,s=-1;t?(i=t.parenthesizedAssign,s=t.trailingComma,t.parenthesizedAssign=t.trailingComma=-1):(t=new h,r=!0);var u=this.start,a=this.startLoc;this.type!=_.parenL&&this.type!=_.name||(this.potentialArrowAt=this.start);var o=this.parseMaybeConditional(e,t);if(n&&(o=n.call(this,o,u,a)),this.type.isAssign){this.checkPatternErrors(t,!0),r||h.call(t);var c=this.startNodeAt(u,a);return c.operator=this.value,c.left=this.type===_.eq?this.toAssignable(o):o,t.shorthandAssign=-1,this.checkLVal(o),this.next(),c.right=this.parseMaybeAssign(e),this.finishNode(c,"AssignmentExpression")}return r&&this.checkExpressionErrors(t,!0),i>-1&&(t.parenthesizedAssign=i),s>-1&&(t.trailingComma=s),o},H.parseMaybeConditional=function(e,t){var n=this.start,r=this.startLoc,i=this.parseExprOps(e,t);if(this.checkExpressionErrors(t))return i;if(this.eat(_.question)){var s=this.startNodeAt(n,r);return s.test=i,s.consequent=this.parseMaybeAssign(),this.expect(_.colon),s.alternate=this.parseMaybeAssign(e),this.finishNode(s,"ConditionalExpression")}return i},H.parseExprOps=function(e,t){var n=this.start,r=this.startLoc,i=this.parseMaybeUnary(t,!1);return this.checkExpressionErrors(t)?i:i.start==n&&"ArrowFunctionExpression"===i.type?i:this.parseExprOp(i,n,r,-1,e)},H.parseExprOp=function(e,t,n,r,i){var s=this.type.binop;if(null!=s&&(!i||this.type!==_._in)&&s>r){var u=this.type===_.logicalOR||this.type===_.logicalAND,a=this.value;this.next();var o=this.start,c=this.startLoc,p=this.parseExprOp(this.parseMaybeUnary(null,!1),o,c,s,i),l=this.buildBinary(t,n,e,p,a,u);return this.parseExprOp(l,t,n,r,i)}return e},H.buildBinary=function(e,t,n,r,i,s){var u=this.startNodeAt(e,t);return u.left=n,u.operator=i,u.right=r,this.finishNode(u,s?"LogicalExpression":"BinaryExpression")},H.parseMaybeUnary=function(e,t){var n,r=this,i=this.start,s=this.startLoc;if(this.inAsync&&this.isContextual("await"))n=this.parseAwait(),t=!0;else if(this.type.prefix){var u=this.startNode(),a=this.type===_.incDec;u.operator=this.value,u.prefix=!0,this.next(),u.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(e,!0),a?this.checkLVal(u.argument):this.strict&&"delete"===u.operator&&"Identifier"===u.argument.type?this.raiseRecoverable(u.start,"Deleting local variable in strict mode"):t=!0,n=this.finishNode(u,a?"UpdateExpression":"UnaryExpression")}else{if(n=this.parseExprSubscripts(e),this.checkExpressionErrors(e))return n;for(;this.type.postfix&&!this.canInsertSemicolon();){var o=r.startNodeAt(i,s);o.operator=r.value,o.prefix=!1,o.argument=n,r.checkLVal(n),r.next(),n=r.finishNode(o,"UpdateExpression")}}return!t&&this.eat(_.starstar)?this.buildBinary(i,s,n,this.parseMaybeUnary(null,!1),"**",!1):n},H.parseExprSubscripts=function(e){var t=this.start,n=this.startLoc,r=this.parseExprAtom(e),i="ArrowFunctionExpression"===r.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd);if(this.checkExpressionErrors(e)||i)return r;var s=this.parseSubscripts(r,t,n);return e&&"MemberExpression"===s.type&&(e.parenthesizedAssign>=s.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=s.start&&(e.parenthesizedBind=-1)),s},H.parseSubscripts=function(e,t,n,r){for(var i=this,s=this.options.ecmaVersion>=8&&"Identifier"===e.type&&"async"===e.name&&this.lastTokEnd==e.end&&!this.canInsertSemicolon(),u=void 0;;)if((u=i.eat(_.bracketL))||i.eat(_.dot)){var a=i.startNodeAt(t,n);a.object=e,a.property=u?i.parseExpression():i.parseIdent(!0),a.computed=!!u,u&&i.expect(_.bracketR),e=i.finishNode(a,"MemberExpression")}else if(!r&&i.eat(_.parenL)){var o=new h,c=i.yieldPos,p=i.awaitPos;i.yieldPos=0,i.awaitPos=0;var l=i.parseExprList(_.parenR,i.options.ecmaVersion>=8,!1,o);if(s&&!i.canInsertSemicolon()&&i.eat(_.arrow))return i.checkPatternErrors(o,!1),i.checkYieldAwaitInDefaultParams(),i.yieldPos=c,i.awaitPos=p,i.parseArrowExpression(i.startNodeAt(t,n),l,!0);i.checkExpressionErrors(o,!0),i.yieldPos=c||i.yieldPos,i.awaitPos=p||i.awaitPos;var d=i.startNodeAt(t,n);d.callee=e,d.arguments=l,e=i.finishNode(d,"CallExpression")}else{if(i.type!==_.backQuote)return e;var f=i.startNodeAt(t,n);f.tag=e,f.quasi=i.parseTemplate({isTagged:!0}),e=i.finishNode(f,"TaggedTemplateExpression")}},H.parseExprAtom=function(e){var t,n=this.potentialArrowAt==this.start;switch(this.type){case _._super:return this.inFunction||this.raise(this.start,"'super' outside of function or class"),t=this.startNode(),this.next(),this.type!==_.dot&&this.type!==_.bracketL&&this.type!==_.parenL&&this.unexpected(),this.finishNode(t,"Super");case _._this:return t=this.startNode(),this.next(),this.finishNode(t,"ThisExpression");case _.name:var r=this.start,i=this.startLoc,s=this.parseIdent(this.type!==_.name);if(this.options.ecmaVersion>=8&&"async"===s.name&&!this.canInsertSemicolon()&&this.eat(_._function))return this.parseFunction(this.startNodeAt(r,i),!1,!1,!0);if(n&&!this.canInsertSemicolon()){if(this.eat(_.arrow))return this.parseArrowExpression(this.startNodeAt(r,i),[s],!1);if(this.options.ecmaVersion>=8&&"async"===s.name&&this.type===_.name)return s=this.parseIdent(),!this.canInsertSemicolon()&&this.eat(_.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(r,i),[s],!0)}return s;case _.regexp:var u=this.value;return t=this.parseLiteral(u.value),t.regex={pattern:u.pattern,flags:u.flags},t;case _.num:case _.string:return this.parseLiteral(this.value);case _._null:case _._true:case _._false:return t=this.startNode(),t.value=this.type===_._null?null:this.type===_._true,t.raw=this.type.keyword,this.next(),this.finishNode(t,"Literal");case _.parenL:var a=this.start,o=this.parseParenAndDistinguishExpression(n);return e&&(e.parenthesizedAssign<0&&!this.isSimpleAssignTarget(o)&&(e.parenthesizedAssign=a),e.parenthesizedBind<0&&(e.parenthesizedBind=a)),o;case _.bracketL:return t=this.startNode(),this.next(),t.elements=this.parseExprList(_.bracketR,!0,!0,e),this.finishNode(t,"ArrayExpression");case _.braceL:return this.parseObj(!1,e);case _._function:return t=this.startNode(),this.next(),this.parseFunction(t,!1);case _._class:return this.parseClass(this.startNode(),!1);case _._new:return this.parseNew();case _.backQuote:return this.parseTemplate();default:this.unexpected()}},H.parseLiteral=function(e){var t=this.startNode();return t.value=e,t.raw=this.input.slice(this.start,this.end),this.next(),this.finishNode(t,"Literal")},H.parseParenExpression=function(){this.expect(_.parenL);var e=this.parseExpression();return this.expect(_.parenR),e},H.parseParenAndDistinguishExpression=function(e){var t,n=this,r=this.start,i=this.startLoc,s=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var u,a,o=this.start,c=this.startLoc,p=[],l=!0,d=!1,f=new h,m=this.yieldPos,y=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==_.parenR;){if(l?l=!1:n.expect(_.comma),s&&n.afterTrailingComma(_.parenR,!0)){d=!0;break}if(n.type===_.ellipsis){u=n.start,p.push(n.parseParenItem(n.parseRestBinding())),n.type===_.comma&&n.raise(n.start,"Comma is not permitted after the rest element");break}n.type!==_.parenL||a||(a=n.start),p.push(n.parseMaybeAssign(!1,f,n.parseParenItem))}var g=this.start,v=this.startLoc;if(this.expect(_.parenR),e&&!this.canInsertSemicolon()&&this.eat(_.arrow))return this.checkPatternErrors(f,!1),this.checkYieldAwaitInDefaultParams(),a&&this.unexpected(a),this.yieldPos=m,this.awaitPos=y,this.parseParenArrowList(r,i,p);p.length&&!d||this.unexpected(this.lastTokStart),u&&this.unexpected(u),this.checkExpressionErrors(f,!0),this.yieldPos=m||this.yieldPos,this.awaitPos=y||this.awaitPos,p.length>1?((t=this.startNodeAt(o,c)).expressions=p,this.finishNodeAt(t,"SequenceExpression",g,v)):t=p[0]}else t=this.parseParenExpression();if(this.options.preserveParens){var A=this.startNodeAt(r,i);return A.expression=t,this.finishNode(A,"ParenthesizedExpression")}return t},H.parseParenItem=function(e){return e},H.parseParenArrowList=function(e,t,n){return this.parseArrowExpression(this.startNodeAt(e,t),n)};var K=[];H.parseNew=function(){var e=this.startNode(),t=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(_.dot))return e.meta=t,e.property=this.parseIdent(!0),"target"!==e.property.name&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is new.target"),this.inFunction||this.raiseRecoverable(e.start,"new.target can only be used in functions"),this.finishNode(e,"MetaProperty");var n=this.start,r=this.startLoc;return e.callee=this.parseSubscripts(this.parseExprAtom(),n,r,!0),this.eat(_.parenL)?e.arguments=this.parseExprList(_.parenR,this.options.ecmaVersion>=8,!1):e.arguments=K,this.finishNode(e,"NewExpression")},H.parseTemplateElement=function(e){var t=e.isTagged,n=this.startNode();return this.type===_.invalidTemplate?(t||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),n.value={raw:this.value,cooked:null}):n.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),n.tail=this.type===_.backQuote,this.finishNode(n,"TemplateElement")},H.parseTemplate=function(e){var t=this;void 0===e&&(e={});var n=e.isTagged;void 0===n&&(n=!1);var r=this.startNode();this.next(),r.expressions=[];var i=this.parseTemplateElement({isTagged:n});for(r.quasis=[i];!i.tail;)t.expect(_.dollarBraceL),r.expressions.push(t.parseExpression()),t.expect(_.braceR),r.quasis.push(i=t.parseTemplateElement({isTagged:n}));return this.next(),this.finishNode(r,"TemplateLiteral")},H.isAsyncProp=function(e){return!e.computed&&"Identifier"===e.key.type&&"async"===e.key.name&&(this.type===_.name||this.type===_.num||this.type===_.string||this.type===_.bracketL||this.type.keyword)&&!w.test(this.input.slice(this.lastTokEnd,this.start))},H.parseObj=function(e,t){var n=this,r=this.startNode(),i=!0,s={};for(r.properties=[],this.next();!this.eat(_.braceR);){if(i)i=!1;else if(n.expect(_.comma),n.afterTrailingComma(_.braceR))break;var u=n.parseProperty(e,t);n.checkPropClash(u,s),r.properties.push(u)}return this.finishNode(r,e?"ObjectPattern":"ObjectExpression")},H.parseProperty=function(e,t){var n,r,i,s,u=this.startNode();return this.options.ecmaVersion>=6&&(u.method=!1,u.shorthand=!1,(e||t)&&(i=this.start,s=this.startLoc),e||(n=this.eat(_.star))),this.parsePropertyName(u),!e&&this.options.ecmaVersion>=8&&!n&&this.isAsyncProp(u)?(r=!0,this.parsePropertyName(u,t)):r=!1,this.parsePropertyValue(u,e,n,r,i,s,t),this.finishNode(u,"Property")},H.parsePropertyValue=function(e,t,n,r,i,s,u){if((n||r)&&this.type===_.colon&&this.unexpected(),this.eat(_.colon))e.value=t?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,u),e.kind="init";else if(this.options.ecmaVersion>=6&&this.type===_.parenL)t&&this.unexpected(),e.kind="init",e.method=!0,e.value=this.parseMethod(n,r);else if(t||!(this.options.ecmaVersion>=5)||e.computed||"Identifier"!==e.key.type||"get"!==e.key.name&&"set"!==e.key.name||this.type==_.comma||this.type==_.braceR)this.options.ecmaVersion>=6&&!e.computed&&"Identifier"===e.key.type?(this.checkUnreserved(e.key),e.kind="init",t?e.value=this.parseMaybeDefault(i,s,e.key):this.type===_.eq&&u?(u.shorthandAssign<0&&(u.shorthandAssign=this.start),e.value=this.parseMaybeDefault(i,s,e.key)):e.value=e.key,e.shorthand=!0):this.unexpected();else{(n||r)&&this.unexpected(),e.kind=e.key.name,this.parsePropertyName(e),e.value=this.parseMethod(!1);var a="get"===e.kind?0:1;if(e.value.params.length!==a){var o=e.value.start;"get"===e.kind?this.raiseRecoverable(o,"getter should have no params"):this.raiseRecoverable(o,"setter should have exactly one param")}else"set"===e.kind&&"RestElement"===e.value.params[0].type&&this.raiseRecoverable(e.value.params[0].start,"Setter cannot use rest params")}},H.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(_.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(_.bracketR),e.key;e.computed=!1}return e.key=this.type===_.num||this.type===_.string?this.parseExprAtom():this.parseIdent(!0)},H.initFunction=function(e){e.id=null,this.options.ecmaVersion>=6&&(e.generator=!1,e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)},H.parseMethod=function(e,t){var n=this.startNode(),r=this.inGenerator,i=this.inAsync,s=this.yieldPos,u=this.awaitPos,a=this.inFunction;return this.initFunction(n),this.options.ecmaVersion>=6&&(n.generator=e),this.options.ecmaVersion>=8&&(n.async=!!t),this.inGenerator=n.generator,this.inAsync=n.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,this.enterFunctionScope(),this.expect(_.parenL),n.params=this.parseBindingList(_.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(n,!1),this.inGenerator=r,this.inAsync=i,this.yieldPos=s,this.awaitPos=u,this.inFunction=a,this.finishNode(n,"FunctionExpression")},H.parseArrowExpression=function(e,t,n){var r=this.inGenerator,i=this.inAsync,s=this.yieldPos,u=this.awaitPos,a=this.inFunction;return this.enterFunctionScope(),this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!n),this.inGenerator=!1,this.inAsync=e.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,e.params=this.toAssignableList(t,!0),this.parseFunctionBody(e,!0),this.inGenerator=r,this.inAsync=i,this.yieldPos=s,this.awaitPos=u,this.inFunction=a,this.finishNode(e,"ArrowFunctionExpression")},H.parseFunctionBody=function(e,t){var n=t&&this.type!==_.braceL,r=this.strict,i=!1;if(n)e.body=this.parseMaybeAssign(),e.expression=!0,this.checkParams(e,!1);else{var s=this.options.ecmaVersion>=7&&!this.isSimpleParamList(e.params);r&&!s||(i=this.strictDirective(this.end))&&s&&this.raiseRecoverable(e.start,"Illegal 'use strict' directive in function with non-simple parameter list");var u=this.labels;this.labels=[],i&&(this.strict=!0),this.checkParams(e,!r&&!i&&!t&&this.isSimpleParamList(e.params)),e.body=this.parseBlock(!1),e.expression=!1,this.adaptDirectivePrologue(e.body.body),this.labels=u}this.exitFunctionScope(),this.strict&&e.id&&this.checkLVal(e.id,"none"),this.strict=r},H.isSimpleParamList=function(e){for(var t=0,n=e;t<n.length;t+=1)if("Identifier"!==n[t].type)return!1;return!0},H.checkParams=function(e,t){for(var n=this,r={},i=0,s=e.params;i<s.length;i+=1){var u=s[i];n.checkLVal(u,"var",t?null:r)}},H.parseExprList=function(e,t,n,r){for(var i=this,s=[],u=!0;!this.eat(e);){if(u)u=!1;else if(i.expect(_.comma),t&&i.afterTrailingComma(e))break;var a=void 0;n&&i.type===_.comma?a=null:i.type===_.ellipsis?(a=i.parseSpread(r),r&&i.type===_.comma&&r.trailingComma<0&&(r.trailingComma=i.start)):a=i.parseMaybeAssign(!1,r),s.push(a)}return s},H.checkUnreserved=function(e){var t=e.start,n=e.end,r=e.name;this.inGenerator&&"yield"===r&&this.raiseRecoverable(t,"Can not use 'yield' as identifier inside a generator"),this.inAsync&&"await"===r&&this.raiseRecoverable(t,"Can not use 'await' as identifier inside an async function"),this.isKeyword(r)&&this.raise(t,"Unexpected keyword '"+r+"'"),this.options.ecmaVersion<6&&-1!=this.input.slice(t,n).indexOf("\\")||(this.strict?this.reservedWordsStrict:this.reservedWords).test(r)&&this.raiseRecoverable(t,"The keyword '"+r+"' is reserved")},H.parseIdent=function(e,t){var n=this.startNode();return e&&"never"==this.options.allowReserved&&(e=!1),this.type===_.name?n.name=this.value:this.type.keyword?(n.name=this.type.keyword,"class"!==n.name&&"function"!==n.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop()):this.unexpected(),this.next(),this.finishNode(n,"Identifier"),e||this.checkUnreserved(n),n},H.parseYield=function(){this.yieldPos||(this.yieldPos=this.start);var e=this.startNode();return this.next(),this.type==_.semi||this.canInsertSemicolon()||this.type!=_.star&&!this.type.startsExpr?(e.delegate=!1,e.argument=null):(e.delegate=this.eat(_.star),e.argument=this.parseMaybeAssign()),this.finishNode(e,"YieldExpression")},H.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!0),this.finishNode(e,"AwaitExpression")};var Q=W.prototype;Q.raise=function(e,t){var n=o(this.input,e);t+=" ("+n.line+":"+n.column+")";var r=new SyntaxError(t);throw r.pos=e,r.loc=n,r.raisedAt=this.pos,r},Q.raiseRecoverable=Q.raise,Q.curPosition=function(){if(this.options.locations)return new M(this.curLine,this.pos-this.lineStart)};var Z=W.prototype,ee=Object.assign||function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];for(var r=0,i=t;r<i.length;r+=1){var s=i[r];for(var u in s)a(s,u)&&(e[u]=s[u])}return e};Z.enterFunctionScope=function(){this.scopeStack.push({var:{},lexical:{},childVar:{},parentLexical:{}})},Z.exitFunctionScope=function(){this.scopeStack.pop()},Z.enterLexicalScope=function(){var e=this.scopeStack[this.scopeStack.length-1],t={var:{},lexical:{},childVar:{},parentLexical:{}};this.scopeStack.push(t),ee(t.parentLexical,e.lexical,e.parentLexical)},Z.exitLexicalScope=function(){var e=this.scopeStack.pop(),t=this.scopeStack[this.scopeStack.length-1];ee(t.childVar,e.var,e.childVar)},Z.canDeclareVarName=function(e){var t=this.scopeStack[this.scopeStack.length-1];return!a(t.lexical,e)&&!a(t.parentLexical,e)},Z.canDeclareLexicalName=function(e){var t=this.scopeStack[this.scopeStack.length-1];return!a(t.lexical,e)&&!a(t.var,e)&&!a(t.childVar,e)},Z.declareVarName=function(e){this.scopeStack[this.scopeStack.length-1].var[e]=!0},Z.declareLexicalName=function(e){this.scopeStack[this.scopeStack.length-1].lexical[e]=!0};var te=function(e,t,n){this.type="",this.start=t,this.end=0,e.options.locations&&(this.loc=new R(e,n)),e.options.directSourceFile&&(this.sourceFile=e.options.directSourceFile),e.options.ranges&&(this.range=[t,0])},ne=W.prototype;ne.startNode=function(){return new te(this,this.start,this.startLoc)},ne.startNodeAt=function(e,t){return new te(this,e,t)},ne.finishNode=function(e,t){return d.call(this,e,t,this.lastTokEnd,this.lastTokEndLoc)},ne.finishNodeAt=function(e,t,n,r){return d.call(this,e,t,n,r)};var re=function(e,t,n,r,i){this.token=e,this.isExpr=!!t,this.preserveSpace=!!n,this.override=r,this.generator=!!i},ie={b_stat:new re("{",!1),b_expr:new re("{",!0),b_tmpl:new re("${",!1),p_stat:new re("(",!1),p_expr:new re("(",!0),q_tmpl:new re("`",!0,!0,function(e){return e.tryReadTemplateToken()}),f_stat:new re("function",!1),f_expr:new re("function",!0),f_expr_gen:new re("function",!0,!1,null,!0),f_gen:new re("function",!1,!1,null,!0)},se=W.prototype;se.initialContext=function(){return[ie.b_stat]},se.braceIsBlock=function(e){var t=this.curContext();return t===ie.f_expr||t===ie.f_stat||(e!==_.colon||t!==ie.b_stat&&t!==ie.b_expr?e===_._return||e==_.name&&this.exprAllowed?w.test(this.input.slice(this.lastTokEnd,this.start)):e===_._else||e===_.semi||e===_.eof||e===_.parenR||e==_.arrow||(e==_.braceL?t===ie.b_stat:e!=_._var&&e!=_.name&&!this.exprAllowed):!t.isExpr)},se.inGeneratorContext=function(){for(var e=this,t=this.context.length-1;t>=1;t--){var n=e.context[t];if("function"===n.token)return n.generator}return!1},se.updateContext=function(e){var t,n=this.type;n.keyword&&e==_.dot?this.exprAllowed=!1:(t=n.updateContext)?t.call(this,e):this.exprAllowed=n.beforeExpr},_.parenR.updateContext=_.braceR.updateContext=function(){if(1!=this.context.length){var e=this.context.pop();e===ie.b_stat&&"function"===this.curContext().token&&(e=this.context.pop()),this.exprAllowed=!e.isExpr}else this.exprAllowed=!0},_.braceL.updateContext=function(e){this.context.push(this.braceIsBlock(e)?ie.b_stat:ie.b_expr),this.exprAllowed=!0},_.dollarBraceL.updateContext=function(){this.context.push(ie.b_tmpl),this.exprAllowed=!0},_.parenL.updateContext=function(e){var t=e===_._if||e===_._for||e===_._with||e===_._while;this.context.push(t?ie.p_stat:ie.p_expr),this.exprAllowed=!0},_.incDec.updateContext=function(){},_._function.updateContext=_._class.updateContext=function(e){e.beforeExpr&&e!==_.semi&&e!==_._else&&(e!==_.colon&&e!==_.braceL||this.curContext()!==ie.b_stat)?this.context.push(ie.f_expr):this.context.push(ie.f_stat),this.exprAllowed=!1},_.backQuote.updateContext=function(){this.curContext()===ie.q_tmpl?this.context.pop():this.context.push(ie.q_tmpl),this.exprAllowed=!1},_.star.updateContext=function(e){if(e==_._function){var t=this.context.length-1;this.context[t]===ie.f_expr?this.context[t]=ie.f_expr_gen:this.context[t]=ie.f_gen}this.exprAllowed=!0},_.name.updateContext=function(e){var t=!1;this.options.ecmaVersion>=6&&("of"==this.value&&!this.exprAllowed||"yield"==this.value&&this.inGeneratorContext())&&(t=!0),this.exprAllowed=t};var ue=function(e){this.type=e.type,this.value=e.value,this.start=e.start,this.end=e.end,e.options.locations&&(this.loc=new R(e,e.startLoc,e.endLoc)),e.options.ranges&&(this.range=[e.start,e.end])},ae=W.prototype,oe="object"==typeof Packages&&"[object JavaPackage]"==Object.prototype.toString.call(Packages);ae.next=function(){this.options.onToken&&this.options.onToken(new ue(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},ae.getToken=function(){return this.next(),new ue(this)},"undefined"!=typeof Symbol&&(ae[Symbol.iterator]=function(){var e=this;return{next:function(){var t=e.getToken();return{done:t.type===_.eof,value:t}}}}),ae.curContext=function(){return this.context[this.context.length-1]},ae.nextToken=function(){var e=this.curContext();return e&&e.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(_.eof):e.override?e.override(this):void this.readToken(this.fullCharCodeAtPos())},ae.readToken=function(e){return n(e,this.options.ecmaVersion>=6)||92===e?this.readWord():this.getTokenFromCode(e)},ae.fullCharCodeAtPos=function(){var e=this.input.charCodeAt(this.pos);return e<=55295||e>=57344?e:(e<<10)+this.input.charCodeAt(this.pos+1)-56613888},ae.skipBlockComment=function(){var e=this,t=this.options.onComment&&this.curPosition(),n=this.pos,r=this.input.indexOf("*/",this.pos+=2);if(-1===r&&this.raise(this.pos-2,"Unterminated comment"),this.pos=r+2,this.options.locations){T.lastIndex=n;for(var i;(i=T.exec(this.input))&&i.index<this.pos;)++e.curLine,e.lineStart=i.index+i[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(n+2,r),n,this.pos,t,this.curPosition())},ae.skipLineComment=function(e){for(var t=this,n=this.pos,r=this.options.onComment&&this.curPosition(),i=this.input.charCodeAt(this.pos+=e);this.pos<this.input.length&&!u(i);)i=t.input.charCodeAt(++t.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(n+e,this.pos),n,this.pos,r,this.curPosition())},ae.skipSpace=function(){var e=this;e:for(;this.pos<this.input.length;){var t=e.input.charCodeAt(e.pos);switch(t){case 32:case 160:++e.pos;break;case 13:10===e.input.charCodeAt(e.pos+1)&&++e.pos;case 10:case 8232:case 8233:++e.pos,e.options.locations&&(++e.curLine,e.lineStart=e.pos);break;case 47:switch(e.input.charCodeAt(e.pos+1)){case 42:e.skipBlockComment();break;case 47:e.skipLineComment(2);break;default:break e}break;default:if(!(t>8&&t<14||t>=5760&&I.test(String.fromCharCode(t))))break e;++e.pos}}},ae.finishToken=function(e,t){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var n=this.type;this.type=e,this.value=t,this.updateContext(n)},ae.readToken_dot=function(){var e=this.input.charCodeAt(this.pos+1);if(e>=48&&e<=57)return this.readNumber(!0);var t=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===e&&46===t?(this.pos+=3,this.finishToken(_.ellipsis)):(++this.pos,this.finishToken(_.dot))},ae.readToken_slash=function(){var e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===e?this.finishOp(_.assign,2):this.finishOp(_.slash,1)},ae.readToken_mult_modulo_exp=function(e){var t=this.input.charCodeAt(this.pos+1),n=1,r=42===e?_.star:_.modulo;return this.options.ecmaVersion>=7&&42==e&&42===t&&(++n,r=_.starstar,t=this.input.charCodeAt(this.pos+2)),61===t?this.finishOp(_.assign,n+1):this.finishOp(r,n)},ae.readToken_pipe_amp=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?this.finishOp(124===e?_.logicalOR:_.logicalAND,2):61===t?this.finishOp(_.assign,2):this.finishOp(124===e?_.bitwiseOR:_.bitwiseAND,1)},ae.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(_.assign,2):this.finishOp(_.bitwiseXOR,1)},ae.readToken_plus_min=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?45!=t||this.inModule||62!=this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!w.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(_.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===t?this.finishOp(_.assign,2):this.finishOp(_.plusMin,1)},ae.readToken_lt_gt=function(e){var t=this.input.charCodeAt(this.pos+1),n=1;return t===e?(n=62===e&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+n)?this.finishOp(_.assign,n+1):this.finishOp(_.bitShift,n)):33!=t||60!=e||this.inModule||45!=this.input.charCodeAt(this.pos+2)||45!=this.input.charCodeAt(this.pos+3)?(61===t&&(n=2),this.finishOp(_.relational,n)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},ae.readToken_eq_excl=function(e){var t=this.input.charCodeAt(this.pos+1);return 61===t?this.finishOp(_.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===e&&62===t&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(_.arrow)):this.finishOp(61===e?_.eq:_.prefix,1)},ae.getTokenFromCode=function(e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(_.parenL);case 41:return++this.pos,this.finishToken(_.parenR);case 59:return++this.pos,this.finishToken(_.semi);case 44:return++this.pos,this.finishToken(_.comma);case 91:return++this.pos,this.finishToken(_.bracketL);case 93:return++this.pos,this.finishToken(_.bracketR);case 123:return++this.pos,this.finishToken(_.braceL);case 125:return++this.pos,this.finishToken(_.braceR);case 58:return++this.pos,this.finishToken(_.colon);case 63:return++this.pos,this.finishToken(_.question);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(_.backQuote);case 48:var t=this.input.charCodeAt(this.pos+1);if(120===t||88===t)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===t||79===t)return this.readRadixNumber(8);if(98===t||66===t)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 126:return this.finishOp(_.prefix,1)}this.raise(this.pos,"Unexpected character '"+m(e)+"'")},ae.finishOp=function(e,t){var n=this.input.slice(this.pos,this.pos+t);return this.pos+=t,this.finishToken(e,n)};var ce=!!f("","u");ae.readRegexp=function(){for(var e,t,n=this,r=this.pos;;){n.pos>=n.input.length&&n.raise(r,"Unterminated regular expression");var i=n.input.charAt(n.pos);if(w.test(i)&&n.raise(r,"Unterminated regular expression"),e)e=!1;else{if("["===i)t=!0;else if("]"===i&&t)t=!1;else if("/"===i&&!t)break;e="\\"===i}++n.pos}var s=this.input.slice(r,this.pos);++this.pos;var u=this.readWord1(),a=s,o="";if(u){var c=/^[gim]*$/;this.options.ecmaVersion>=6&&(c=/^[gimuy]*$/),c.test(u)||this.raise(r,"Invalid regular expression flag"),u.indexOf("u")>=0&&(ce?o="u":(a=(a=a.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(e,t,i){return(t=Number("0x"+t))>1114111&&n.raise(r+i+3,"Code point out of bounds"),"x"})).replace(/\\u([a-fA-F0-9]{4})|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"),o=o.replace("u","")))}var p=null;return oe||(f(a,o,r,this),p=f(s,u)),this.finishToken(_.regexp,{pattern:s,flags:u,value:p})},ae.readInt=function(e,t){for(var n=this,r=this.pos,i=0,s=0,u=null==t?1/0:t;s<u;++s){var a=n.input.charCodeAt(n.pos),o=void 0;if((o=a>=97?a-97+10:a>=65?a-65+10:a>=48&&a<=57?a-48:1/0)>=e)break;++n.pos,i=i*e+o}return this.pos===r||null!=t&&this.pos-r!==t?null:i},ae.readRadixNumber=function(e){this.pos+=2;var t=this.readInt(e);return null==t&&this.raise(this.start+2,"Expected number in radix "+e),n(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(_.num,t)},ae.readNumber=function(e){var t=this.pos,r=!1,i=48===this.input.charCodeAt(this.pos);e||null!==this.readInt(10)||this.raise(t,"Invalid number"),i&&this.pos==t+1&&(i=!1);var s=this.input.charCodeAt(this.pos);46!==s||i||(++this.pos,this.readInt(10),r=!0,s=this.input.charCodeAt(this.pos)),69!==s&&101!==s||i||(43!==(s=this.input.charCodeAt(++this.pos))&&45!==s||++this.pos,null===this.readInt(10)&&this.raise(t,"Invalid number"),r=!0),n(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var u,a=this.input.slice(t,this.pos);return r?u=parseFloat(a):i&&1!==a.length?this.strict?this.raise(t,"Invalid number"):u=/[89]/.test(a)?parseInt(a,10):parseInt(a,8):u=parseInt(a,10),this.finishToken(_.num,u)},ae.readCodePoint=function(){var e;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var t=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,e>1114111&&this.invalidStringToken(t,"Code point out of bounds")}else e=this.readHexChar(4);return e},ae.readString=function(e){for(var t=this,n="",r=++this.pos;;){t.pos>=t.input.length&&t.raise(t.start,"Unterminated string constant");var i=t.input.charCodeAt(t.pos);if(i===e)break;92===i?(n+=t.input.slice(r,t.pos),n+=t.readEscapedChar(!1),r=t.pos):(u(i)&&t.raise(t.start,"Unterminated string constant"),++t.pos)}return n+=this.input.slice(r,this.pos++),this.finishToken(_.string,n)};var pe={};ae.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(e){if(e!==pe)throw e;this.readInvalidTemplateToken()}this.inTemplateElement=!1},ae.invalidStringToken=function(e,t){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw pe;this.raise(e,t)},ae.readTmplToken=function(){for(var e=this,t="",n=this.pos;;){e.pos>=e.input.length&&e.raise(e.start,"Unterminated template");var r=e.input.charCodeAt(e.pos);if(96===r||36===r&&123===e.input.charCodeAt(e.pos+1))return e.pos!==e.start||e.type!==_.template&&e.type!==_.invalidTemplate?(t+=e.input.slice(n,e.pos),e.finishToken(_.template,t)):36===r?(e.pos+=2,e.finishToken(_.dollarBraceL)):(++e.pos,e.finishToken(_.backQuote));if(92===r)t+=e.input.slice(n,e.pos),t+=e.readEscapedChar(!0),n=e.pos;else if(u(r)){switch(t+=e.input.slice(n,e.pos),++e.pos,r){case 13:10===e.input.charCodeAt(e.pos)&&++e.pos;case 10:t+="\n";break;default:t+=String.fromCharCode(r)}e.options.locations&&(++e.curLine,e.lineStart=e.pos),n=e.pos}else++e.pos}},ae.readInvalidTemplateToken=function(){for(var e=this;this.pos<this.input.length;this.pos++)switch(e.input[e.pos]){case"\\":++e.pos;break;case"$":if("{"!==e.input[e.pos+1])break;case"`":return e.finishToken(_.invalidTemplate,e.input.slice(e.start,e.pos))}this.raise(this.start,"Unterminated template")},ae.readEscapedChar=function(e){var t=this.input.charCodeAt(++this.pos);switch(++this.pos,t){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return m(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";default:if(t>=48&&t<=55){var n=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],r=parseInt(n,8);return r>255&&(n=n.slice(0,-1),r=parseInt(n,8)),"0"!==n&&(this.strict||e)&&this.invalidStringToken(this.pos-2,"Octal literal in strict mode"),this.pos+=n.length-1,String.fromCharCode(r)}return String.fromCharCode(t)}},ae.readHexChar=function(e){var t=this.pos,n=this.readInt(16,e);return null===n&&this.invalidStringToken(t,"Bad character escape sequence"),n},ae.readWord1=function(){var e=this;this.containsEsc=!1;for(var t="",i=!0,s=this.pos,u=this.options.ecmaVersion>=6;this.pos<this.input.length;){var a=e.fullCharCodeAtPos();if(r(a,u))e.pos+=a<=65535?1:2;else{if(92!==a)break;e.containsEsc=!0,t+=e.input.slice(s,e.pos);var o=e.pos;117!=e.input.charCodeAt(++e.pos)&&e.invalidStringToken(e.pos,"Expecting Unicode escape sequence \\uXXXX"),++e.pos;var c=e.readCodePoint();(i?n:r)(c,u)||e.invalidStringToken(o,"Invalid Unicode escape"),t+=m(c),s=e.pos}i=!1}return t+this.input.slice(s,this.pos)},ae.readWord=function(){var e=this.readWord1(),t=_.name;return this.keywords.test(e)&&(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+e),t=B[e]),this.finishToken(t,e)};e.version="5.2.1",e.parse=function(e,t){return new W(t,e).parse()},e.parseExpressionAt=function(e,t,n){var r=new W(n,e,t);return r.nextToken(),r.parseExpression()},e.tokenizer=function(e,t){return new W(t,e)},e.addLooseExports=function(t,n,r){e.parse_dammit=t,e.LooseParser=n,e.pluginsLoose=r},e.Parser=W,e.plugins=q,e.defaultOptions=V,e.Position=M,e.SourceLocation=R,e.getLineInfo=o,e.Node=te,e.TokenType=F,e.tokTypes=_,e.keywordTypes=B,e.TokContext=re,e.tokContexts=ie,e.isIdentifierChar=r,e.isIdentifierStart=n,e.Token=ue,e.isNewLine=u,e.lineBreak=w,e.lineBreakG=T,e.nonASCIIwhitespace=I,Object.defineProperty(e,"__esModule",{value:!0})}),function(t,n){"function"==typeof e&&e.amd?e(["exports"],n):n((t.acorn=t.acorn||{},t.acorn.walk=t.acorn.walk||{}))}(this,function(e){"use strict";function t(e){return"string"==typeof e?function(t){return t==e}:e||function(){return!0}}function n(e,t,n){n(e,t)}function r(e,t,n){}var i=function(e,t){this.node=e,this.state=t},s=Object.create||function(e){function t(){}return t.prototype=e,new t},u={};u.Program=u.BlockStatement=function(e,t,n){for(var r=0,i=e.body;r<i.length;r+=1)n(i[r],t,"Statement")},u.Statement=n,u.EmptyStatement=r,u.ExpressionStatement=u.ParenthesizedExpression=function(e,t,n){return n(e.expression,t,"Expression")},u.IfStatement=function(e,t,n){n(e.test,t,"Expression"),n(e.consequent,t,"Statement"),e.alternate&&n(e.alternate,t,"Statement")},u.LabeledStatement=function(e,t,n){return n(e.body,t,"Statement")},u.BreakStatement=u.ContinueStatement=r,u.WithStatement=function(e,t,n){n(e.object,t,"Expression"),n(e.body,t,"Statement")},u.SwitchStatement=function(e,t,n){n(e.discriminant,t,"Expression");for(var r=0,i=e.cases;r<i.length;r+=1){var s=i[r];s.test&&n(s.test,t,"Expression");for(var u=0,a=s.consequent;u<a.length;u+=1)n(a[u],t,"Statement")}},u.ReturnStatement=u.YieldExpression=u.AwaitExpression=function(e,t,n){e.argument&&n(e.argument,t,"Expression")},u.ThrowStatement=u.SpreadElement=function(e,t,n){return n(e.argument,t,"Expression")},u.TryStatement=function(e,t,n){n(e.block,t,"Statement"),e.handler&&n(e.handler,t),e.finalizer&&n(e.finalizer,t,"Statement")},u.CatchClause=function(e,t,n){n(e.param,t,"Pattern"),n(e.body,t,"ScopeBody")},u.WhileStatement=u.DoWhileStatement=function(e,t,n){n(e.test,t,"Expression"),n(e.body,t,"Statement")},u.ForStatement=function(e,t,n){e.init&&n(e.init,t,"ForInit"),e.test&&n(e.test,t,"Expression"),e.update&&n(e.update,t,"Expression"),n(e.body,t,"Statement")},u.ForInStatement=u.ForOfStatement=function(e,t,n){n(e.left,t,"ForInit"),n(e.right,t,"Expression"),n(e.body,t,"Statement")},u.ForInit=function(e,t,n){"VariableDeclaration"==e.type?n(e,t):n(e,t,"Expression")},u.DebuggerStatement=r,u.FunctionDeclaration=function(e,t,n){return n(e,t,"Function")},u.VariableDeclaration=function(e,t,n){for(var r=0,i=e.declarations;r<i.length;r+=1)n(i[r],t)},u.VariableDeclarator=function(e,t,n){n(e.id,t,"Pattern"),e.init&&n(e.init,t,"Expression")},u.Function=function(e,t,n){e.id&&n(e.id,t,"Pattern");for(var r=0,i=e.params;r<i.length;r+=1)n(i[r],t,"Pattern");n(e.body,t,e.expression?"ScopeExpression":"ScopeBody")},u.ScopeBody=function(e,t,n){return n(e,t,"Statement")},u.ScopeExpression=function(e,t,n){return n(e,t,"Expression")},u.Pattern=function(e,t,n){"Identifier"==e.type?n(e,t,"VariablePattern"):"MemberExpression"==e.type?n(e,t,"MemberPattern"):n(e,t)},u.VariablePattern=r,u.MemberPattern=n,u.RestElement=function(e,t,n){return n(e.argument,t,"Pattern")},u.ArrayPattern=function(e,t,n){for(var r=0,i=e.elements;r<i.length;r+=1){var s=i[r];s&&n(s,t,"Pattern")}},u.ObjectPattern=function(e,t,n){for(var r=0,i=e.properties;r<i.length;r+=1)n(i[r].value,t,"Pattern")},u.Expression=n,u.ThisExpression=u.Super=u.MetaProperty=r,u.ArrayExpression=function(e,t,n){for(var r=0,i=e.elements;r<i.length;r+=1){var s=i[r];s&&n(s,t,"Expression")}},u.ObjectExpression=function(e,t,n){for(var r=0,i=e.properties;r<i.length;r+=1)n(i[r],t)},u.FunctionExpression=u.ArrowFunctionExpression=u.FunctionDeclaration,u.SequenceExpression=u.TemplateLiteral=function(e,t,n){for(var r=0,i=e.expressions;r<i.length;r+=1)n(i[r],t,"Expression")},u.UnaryExpression=u.UpdateExpression=function(e,t,n){n(e.argument,t,"Expression")},u.BinaryExpression=u.LogicalExpression=function(e,t,n){n(e.left,t,"Expression"),n(e.right,t,"Expression")},u.AssignmentExpression=u.AssignmentPattern=function(e,t,n){n(e.left,t,"Pattern"),n(e.right,t,"Expression")},u.ConditionalExpression=function(e,t,n){n(e.test,t,"Expression"),n(e.consequent,t,"Expression"),n(e.alternate,t,"Expression")},u.NewExpression=u.CallExpression=function(e,t,n){if(n(e.callee,t,"Expression"),e.arguments)for(var r=0,i=e.arguments;r<i.length;r+=1)n(i[r],t,"Expression")},u.MemberExpression=function(e,t,n){n(e.object,t,"Expression"),e.computed&&n(e.property,t,"Expression")},u.ExportNamedDeclaration=u.ExportDefaultDeclaration=function(e,t,n){e.declaration&&n(e.declaration,t,"ExportNamedDeclaration"==e.type||e.declaration.id?"Statement":"Expression"),e.source&&n(e.source,t,"Expression")},u.ExportAllDeclaration=function(e,t,n){n(e.source,t,"Expression")},u.ImportDeclaration=function(e,t,n){for(var r=0,i=e.specifiers;r<i.length;r+=1)n(i[r],t);n(e.source,t,"Expression")},u.ImportSpecifier=u.ImportDefaultSpecifier=u.ImportNamespaceSpecifier=u.Identifier=u.Literal=r,u.TaggedTemplateExpression=function(e,t,n){n(e.tag,t,"Expression"),n(e.quasi,t)},u.ClassDeclaration=u.ClassExpression=function(e,t,n){return n(e,t,"Class")},u.Class=function(e,t,n){e.id&&n(e.id,t,"Pattern"),e.superClass&&n(e.superClass,t,"Expression");for(var r=0,i=e.body.body;r<i.length;r+=1)n(i[r],t)},u.MethodDefinition=u.Property=function(e,t,n){e.computed&&n(e.key,t,"Expression"),n(e.value,t,"Expression")},e.simple=function(t,n,r,i,s){r||(r=e.base),function e(t,i,s){var u=s||t.type,a=n[u];r[u](t,i,e),a&&a(t,i)}(t,i,s)},e.ancestor=function(t,n,r,i){r||(r=e.base);var s=[];!function e(t,i,u){var a=u||t.type,o=n[a],c=t!=s[s.length-1];c&&s.push(t),r[a](t,i,e),o&&o(t,i||s,s),c&&s.pop()}(t,i)},e.recursive=function(t,n,r,i,s){var u=r?e.make(r,i):i;!function e(t,n,r){u[r||t.type](t,n,e)}(t,n,s)},e.full=function(t,n,r,i,s){r||(r=e.base),function e(t,i,s){var u=s||t.type;r[u](t,i,e),s||n(t,i,u)}(t,i,s)},e.fullAncestor=function(t,n,r,i){r||(r=e.base);var s=[];!function e(t,i,u){var a=u||t.type,o=t!=s[s.length-1];o&&s.push(t),r[a](t,i,e),u||n(t,i||s,s,a),o&&s.pop()}(t,i)},e.findNodeAt=function(n,r,s,u,a,o){u=t(u),a||(a=e.base);try{!function e(t,n,o){var c=o||t.type;if((null==r||t.start<=r)&&(null==s||t.end>=s)&&a[c](t,n,e),(null==r||t.start==r)&&(null==s||t.end==s)&&u(c,t))throw new i(t,n)}(n,o)}catch(e){if(e instanceof i)return e;throw e}},e.findNodeAround=function(n,r,s,u,a){s=t(s),u||(u=e.base);try{!function e(t,n,a){var o=a||t.type;if(!(t.start>r||t.end<r)&&(u[o](t,n,e),s(o,t)))throw new i(t,n)}(n,a)}catch(e){if(e instanceof i)return e;throw e}},e.findNodeAfter=function(n,r,s,u,a){s=t(s),u||(u=e.base);try{!function e(t,n,a){if(!(t.end<r)){var o=a||t.type;if(t.start>=r&&s(o,t))throw new i(t,n);u[o](t,n,e)}}(n,a)}catch(e){if(e instanceof i)return e;throw e}},e.findNodeBefore=function(n,r,s,u,a){s=t(s),u||(u=e.base);var o;return function e(t,n,a){if(!(t.start>r)){var c=a||t.type;t.end<=r&&(!o||o.node.end<t.end)&&s(c,t)&&(o=new i(t,n)),u[c](t,n,e)}}(n,a),o},e.make=function(t,n){n||(n=e.base);var r=s(n);for(var i in t)r[i]=t[i];return r},e.base=u,Object.defineProperty(e,"__esModule",{value:!0})}),function(t,n){"function"==typeof e&&e.amd?e(["exports","./acorn"],n):n((t.acorn=t.acorn||{},t.acorn.loose=t.acorn.loose||{}),t.acorn)}(this,function(e,t){"use strict";function n(e){return e<14&&e>8||32===e||160===e||t.isNewLine(e)}function r(e){return""==e.name}function i(e,t){return new u(e,t).parse()}var s={},u=function(e,n){if(void 0===n&&(n={}),this.toks=t.tokenizer(e,n),this.options=this.toks.options,this.input=this.toks.input,this.tok=this.last={type:t.tokTypes.eof,start:0,end:0},this.options.locations){var r=this.toks.curPosition();this.tok.loc=new t.SourceLocation(this.toks,r,r)}this.ahead=[],this.context=[],this.curIndent=0,this.curLineStart=0,this.nextLineStart=this.lineEnd(this.curLineStart)+1,this.inAsync=!1,this.options.pluginsLoose=n.pluginsLoose||{},this.loadPlugins(this.options.pluginsLoose)};u.prototype.startNode=function(){return new t.Node(this.toks,this.tok.start,this.options.locations?this.tok.loc.start:null)},u.prototype.storeCurrentPos=function(){return this.options.locations?[this.tok.start,this.tok.loc.start]:this.tok.start},u.prototype.startNodeAt=function(e){return this.options.locations?new t.Node(this.toks,e[0],e[1]):new t.Node(this.toks,e)},u.prototype.finishNode=function(e,t){return e.type=t,e.end=this.last.end,this.options.locations&&(e.loc.end=this.last.loc.end),this.options.ranges&&(e.range[1]=this.last.end),e},u.prototype.dummyNode=function(e){var n=this.startNode();return n.type=e,n.end=n.start,this.options.locations&&(n.loc.end=n.loc.start),this.options.ranges&&(n.range[1]=n.start),this.last={type:t.tokTypes.name,start:n.start,end:n.start,loc:n.loc},n},u.prototype.dummyIdent=function(){var e=this.dummyNode("Identifier");return e.name="",e},u.prototype.dummyString=function(){var e=this.dummyNode("Literal");return e.value=e.raw="",e},u.prototype.eat=function(e){return this.tok.type===e&&(this.next(),!0)},u.prototype.isContextual=function(e){return this.tok.type===t.tokTypes.name&&this.tok.value===e},u.prototype.eatContextual=function(e){return this.tok.value===e&&this.eat(t.tokTypes.name)},u.prototype.canInsertSemicolon=function(){return this.tok.type===t.tokTypes.eof||this.tok.type===t.tokTypes.braceR||t.lineBreak.test(this.input.slice(this.last.end,this.tok.start))},u.prototype.semicolon=function(){return this.eat(t.tokTypes.semi)},u.prototype.expect=function(e){var t=this;if(this.eat(e))return!0;for(var n=1;n<=2;n++)if(t.lookAhead(n).type==e){for(var r=0;r<n;r++)t.next();return!0}},u.prototype.pushCx=function(){this.context.push(this.curIndent)},u.prototype.popCx=function(){this.curIndent=this.context.pop()},u.prototype.lineEnd=function(e){for(;e<this.input.length&&!t.isNewLine(this.input.charCodeAt(e));)++e;return e},u.prototype.indentationAfter=function(e){for(var t=this,n=0;;++e){var r=t.input.charCodeAt(e);if(32===r)++n;else{if(9!==r)return n;n+=t.options.tabSize}}},u.prototype.closes=function(e,n,r,i){return this.tok.type===e||this.tok.type===t.tokTypes.eof||r!=this.curLineStart&&this.curIndent<n&&this.tokenStartsLine()&&(!i||this.nextLineStart>=this.input.length||this.indentationAfter(this.nextLineStart)<n)},u.prototype.tokenStartsLine=function(){for(var e=this,t=this.tok.start-1;t>=this.curLineStart;--t){var n=e.input.charCodeAt(t);if(9!==n&&32!==n)return!1}return!0},u.prototype.extend=function(e,t){this[e]=t(this[e])},u.prototype.loadPlugins=function(e){var t=this;for(var n in e){var r=s[n];if(!r)throw new Error("Plugin '"+n+"' not found");r(t,e[n])}},u.prototype.parse=function(){return this.next(),this.parseTopLevel()};var a=u.prototype;a.next=function(){var e=this;if(this.last=this.tok,this.ahead.length?this.tok=this.ahead.shift():this.tok=this.readToken(),this.tok.start>=this.nextLineStart){for(;this.tok.start>=this.nextLineStart;)e.curLineStart=e.nextLineStart,e.nextLineStart=e.lineEnd(e.curLineStart)+1;this.curIndent=this.indentationAfter(this.curLineStart)}},a.readToken=function(){for(var e=this;;)try{return e.toks.next(),e.toks.type===t.tokTypes.dot&&"."===e.input.substr(e.toks.end,1)&&e.options.ecmaVersion>=6&&(e.toks.end++,e.toks.type=t.tokTypes.ellipsis),new t.Token(e.toks)}catch(o){if(!(o instanceof SyntaxError))throw o;var r=o.message,i=o.raisedAt,s=!0;if(/unterminated/i.test(r))if(i=e.lineEnd(o.pos+1),/string/.test(r))s={start:o.pos,end:i,type:t.tokTypes.string,value:e.input.slice(o.pos+1,i)};else if(/regular expr/i.test(r)){var u=e.input.slice(o.pos,i);try{u=new RegExp(u)}catch(e){}s={start:o.pos,end:i,type:t.tokTypes.regexp,value:u}}else s=!!/template/.test(r)&&{start:o.pos,end:i,type:t.tokTypes.template,value:e.input.slice(o.pos,i)};else if(/invalid (unicode|regexp|number)|expecting unicode|octal literal|is reserved|directly after number|expected number in radix/i.test(r))for(;i<this.input.length&&!n(this.input.charCodeAt(i));)++i;else if(/character escape|expected hexadecimal/i.test(r))for(;i<this.input.length;){var a=e.input.charCodeAt(i++);if(34===a||39===a||t.isNewLine(a))break}else if(/unexpected character/i.test(r))i++,s=!1;else{if(!/regular expression/i.test(r))throw o;s=!0}if(e.resetTo(i),!0===s&&(s={start:i,end:i,type:t.tokTypes.name,value:""}),s)return e.options.locations&&(s.loc=new t.SourceLocation(e.toks,t.getLineInfo(e.input,s.start),t.getLineInfo(e.input,s.end))),s}},a.resetTo=function(e){var n=this;this.toks.pos=e;var r=this.input.charAt(e-1);if(this.toks.exprAllowed=!r||/[[{(,;:?/*=+\-~!|&%^<>]/.test(r)||/[enwfd]/.test(r)&&/\b(keywords|case|else|return|throw|new|in|(instance|type)of|delete|void)$/.test(this.input.slice(e-10,e)),this.options.locations){this.toks.curLine=1,this.toks.lineStart=t.lineBreakG.lastIndex=0;for(var i;(i=t.lineBreakG.exec(this.input))&&i.index<e;)++n.toks.curLine,n.toks.lineStart=i.index+i[0].length}},a.lookAhead=function(e){for(var t=this;e>this.ahead.length;)t.ahead.push(t.readToken());return this.ahead[e-1]};var o=u.prototype;o.parseTopLevel=function(){var e=this,n=this.startNodeAt(this.options.locations?[0,t.getLineInfo(this.input,0)]:0);for(n.body=[];this.tok.type!==t.tokTypes.eof;)n.body.push(e.parseStatement());return this.toks.adaptDirectivePrologue(n.body),this.last=this.tok,this.options.ecmaVersion>=6&&(n.sourceType=this.options.sourceType),this.finishNode(n,"Program")},o.parseStatement=function(){var e,n=this,i=this.tok.type,s=this.startNode();switch(this.toks.isLet()&&(i=t.tokTypes._var,e="let"),i){case t.tokTypes._break:case t.tokTypes._continue:this.next();var u=i===t.tokTypes._break;return this.semicolon()||this.canInsertSemicolon()?s.label=null:(s.label=this.tok.type===t.tokTypes.name?this.parseIdent():null,this.semicolon()),this.finishNode(s,u?"BreakStatement":"ContinueStatement");case t.tokTypes._debugger:return this.next(),this.semicolon(),this.finishNode(s,"DebuggerStatement");case t.tokTypes._do:return this.next(),s.body=this.parseStatement(),s.test=this.eat(t.tokTypes._while)?this.parseParenExpression():this.dummyIdent(),this.semicolon(),this.finishNode(s,"DoWhileStatement");case t.tokTypes._for:if(this.next(),this.pushCx(),this.expect(t.tokTypes.parenL),this.tok.type===t.tokTypes.semi)return this.parseFor(s,null);var a=this.toks.isLet();if(a||this.tok.type===t.tokTypes._var||this.tok.type===t.tokTypes._const){var o=this.parseVar(!0,a?"let":this.tok.value);return 1!==o.declarations.length||this.tok.type!==t.tokTypes._in&&!this.isContextual("of")?this.parseFor(s,o):this.parseForIn(s,o)}var c=this.parseExpression(!0);return this.tok.type===t.tokTypes._in||this.isContextual("of")?this.parseForIn(s,this.toAssignable(c)):this.parseFor(s,c);case t.tokTypes._function:return this.next(),this.parseFunction(s,!0);case t.tokTypes._if:return this.next(),s.test=this.parseParenExpression(),s.consequent=this.parseStatement(),s.alternate=this.eat(t.tokTypes._else)?this.parseStatement():null,this.finishNode(s,"IfStatement");case t.tokTypes._return:return this.next(),this.eat(t.tokTypes.semi)||this.canInsertSemicolon()?s.argument=null:(s.argument=this.parseExpression(),this.semicolon()),this.finishNode(s,"ReturnStatement");case t.tokTypes._switch:var p=this.curIndent,l=this.curLineStart;this.next(),s.discriminant=this.parseParenExpression(),s.cases=[],this.pushCx(),this.expect(t.tokTypes.braceL);for(var h;!this.closes(t.tokTypes.braceR,p,l,!0);)if(n.tok.type===t.tokTypes._case||n.tok.type===t.tokTypes._default){var d=n.tok.type===t.tokTypes._case;h&&n.finishNode(h,"SwitchCase"),s.cases.push(h=n.startNode()),h.consequent=[],n.next(),h.test=d?n.parseExpression():null,n.expect(t.tokTypes.colon)}else h||(s.cases.push(h=n.startNode()),h.consequent=[],h.test=null),h.consequent.push(n.parseStatement());return h&&this.finishNode(h,"SwitchCase"),this.popCx(),this.eat(t.tokTypes.braceR),this.finishNode(s,"SwitchStatement");case t.tokTypes._throw:return this.next(),s.argument=this.parseExpression(),this.semicolon(),this.finishNode(s,"ThrowStatement");case t.tokTypes._try:if(this.next(),s.block=this.parseBlock(),s.handler=null,this.tok.type===t.tokTypes._catch){var f=this.startNode();this.next(),this.expect(t.tokTypes.parenL),f.param=this.toAssignable(this.parseExprAtom(),!0),this.expect(t.tokTypes.parenR),f.body=this.parseBlock(),s.handler=this.finishNode(f,"CatchClause")}return s.finalizer=this.eat(t.tokTypes._finally)?this.parseBlock():null,s.handler||s.finalizer?this.finishNode(s,"TryStatement"):s.block;case t.tokTypes._var:case t.tokTypes._const:return this.parseVar(!1,e||this.tok.value);case t.tokTypes._while:return this.next(),s.test=this.parseParenExpression(),s.body=this.parseStatement(),this.finishNode(s,"WhileStatement");case t.tokTypes._with:return this.next(),s.object=this.parseParenExpression(),s.body=this.parseStatement(),this.finishNode(s,"WithStatement");case t.tokTypes.braceL:return this.parseBlock();case t.tokTypes.semi:return this.next(),this.finishNode(s,"EmptyStatement");case t.tokTypes._class:return this.parseClass(!0);case t.tokTypes._import:return this.parseImport();case t.tokTypes._export:return this.parseExport();default:if(this.toks.isAsyncFunction())return this.next(),this.next(),this.parseFunction(s,!0,!0);var m=this.parseExpression();return r(m)?(this.next(),this.tok.type===t.tokTypes.eof?this.finishNode(s,"EmptyStatement"):this.parseStatement()):i===t.tokTypes.name&&"Identifier"===m.type&&this.eat(t.tokTypes.colon)?(s.body=this.parseStatement(),s.label=m,this.finishNode(s,"LabeledStatement")):(s.expression=m,this.semicolon(),this.finishNode(s,"ExpressionStatement"))}},o.parseBlock=function(){var e=this,n=this.startNode();this.pushCx(),this.expect(t.tokTypes.braceL);var r=this.curIndent,i=this.curLineStart;for(n.body=[];!this.closes(t.tokTypes.braceR,r,i,!0);)n.body.push(e.parseStatement());return this.popCx(),this.eat(t.tokTypes.braceR),this.finishNode(n,"BlockStatement")},o.parseFor=function(e,n){return e.init=n,e.test=e.update=null,this.eat(t.tokTypes.semi)&&this.tok.type!==t.tokTypes.semi&&(e.test=this.parseExpression()),this.eat(t.tokTypes.semi)&&this.tok.type!==t.tokTypes.parenR&&(e.update=this.parseExpression()),this.popCx(),this.expect(t.tokTypes.parenR),e.body=this.parseStatement(),this.finishNode(e,"ForStatement")},o.parseForIn=function(e,n){var r=this.tok.type===t.tokTypes._in?"ForInStatement":"ForOfStatement";return this.next(),e.left=n,e.right=this.parseExpression(),this.popCx(),this.expect(t.tokTypes.parenR),e.body=this.parseStatement(),this.finishNode(e,r)},o.parseVar=function(e,n){var r=this,i=this.startNode();i.kind=n,this.next(),i.declarations=[];do{var s=r.startNode();s.id=r.options.ecmaVersion>=6?r.toAssignable(r.parseExprAtom(),!0):r.parseIdent(),s.init=r.eat(t.tokTypes.eq)?r.parseMaybeAssign(e):null,i.declarations.push(r.finishNode(s,"VariableDeclarator"))}while(this.eat(t.tokTypes.comma));if(!i.declarations.length){var u=this.startNode();u.id=this.dummyIdent(),i.declarations.push(this.finishNode(u,"VariableDeclarator"))}return e||this.semicolon(),this.finishNode(i,"VariableDeclaration")},o.parseClass=function(e){var n=this,i=this.startNode();this.next(),this.tok.type===t.tokTypes.name?i.id=this.parseIdent():i.id=!0===e?this.dummyIdent():null,i.superClass=this.eat(t.tokTypes._extends)?this.parseExpression():null,i.body=this.startNode(),i.body.body=[],this.pushCx();var s=this.curIndent+1,u=this.curLineStart;for(this.eat(t.tokTypes.braceL),this.curIndent+1<s&&(s=this.curIndent,u=this.curLineStart);!this.closes(t.tokTypes.braceR,s,u);)if(!n.semicolon()){var a=n.startNode(),o=void 0,c=void 0;n.options.ecmaVersion>=6&&(a.static=!1,o=n.eat(t.tokTypes.star)),n.parsePropertyName(a),r(a.key)?(r(n.parseMaybeAssign())&&n.next(),n.eat(t.tokTypes.comma)):("Identifier"!==a.key.type||a.computed||"static"!==a.key.name||n.tok.type==t.tokTypes.parenL||n.tok.type==t.tokTypes.braceL?a.static=!1:(a.static=!0,o=n.eat(t.tokTypes.star),n.parsePropertyName(a)),a.computed||"Identifier"!==a.key.type||"async"!==a.key.name||n.tok.type===t.tokTypes.parenL||n.canInsertSemicolon()?c=!1:(n.parsePropertyName(a),c=!0),n.options.ecmaVersion>=5&&"Identifier"===a.key.type&&!a.computed&&("get"===a.key.name||"set"===a.key.name)&&n.tok.type!==t.tokTypes.parenL&&n.tok.type!==t.tokTypes.braceL?(a.kind=a.key.name,n.parsePropertyName(a),a.value=n.parseMethod(!1)):(a.computed||a.static||o||c||!("Identifier"===a.key.type&&"constructor"===a.key.name||"Literal"===a.key.type&&"constructor"===a.key.value)?a.kind="method":a.kind="constructor",a.value=n.parseMethod(o,c)),i.body.body.push(n.finishNode(a,"MethodDefinition")))}return this.popCx(),this.eat(t.tokTypes.braceR)||(this.last.end=this.tok.start,this.options.locations&&(this.last.loc.end=this.tok.loc.start)),this.semicolon(),this.finishNode(i.body,"ClassBody"),this.finishNode(i,e?"ClassDeclaration":"ClassExpression")},o.parseFunction=function(e,n,r){var i=this.inAsync;return this.initFunction(e),this.options.ecmaVersion>=6&&(e.generator=this.eat(t.tokTypes.star)),this.options.ecmaVersion>=8&&(e.async=!!r),this.tok.type===t.tokTypes.name?e.id=this.parseIdent():!0===n&&(e.id=this.dummyIdent()),this.inAsync=e.async,e.params=this.parseFunctionParams(),e.body=this.parseBlock(),this.toks.adaptDirectivePrologue(e.body.body),this.inAsync=i,this.finishNode(e,n?"FunctionDeclaration":"FunctionExpression")},o.parseExport=function(){var e=this.startNode();if(this.next(),this.eat(t.tokTypes.star))return e.source=this.eatContextual("from")?this.parseExprAtom():this.dummyString(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(t.tokTypes._default)){var n;if(this.tok.type===t.tokTypes._function||(n=this.toks.isAsyncFunction())){var r=this.startNode();this.next(),n&&this.next(),e.declaration=this.parseFunction(r,"nullableID",n)}else this.tok.type===t.tokTypes._class?e.declaration=this.parseClass("nullableID"):(e.declaration=this.parseMaybeAssign(),this.semicolon());return this.finishNode(e,"ExportDefaultDeclaration")}return this.tok.type.keyword||this.toks.isLet()||this.toks.isAsyncFunction()?(e.declaration=this.parseStatement(),e.specifiers=[],e.source=null):(e.declaration=null,e.specifiers=this.parseExportSpecifierList(),e.source=this.eatContextual("from")?this.parseExprAtom():null,this.semicolon()),this.finishNode(e,"ExportNamedDeclaration")},o.parseImport=function(){var e=this.startNode();if(this.next(),this.tok.type===t.tokTypes.string)e.specifiers=[],e.source=this.parseExprAtom();else{var n;this.tok.type===t.tokTypes.name&&"from"!==this.tok.value&&((n=this.startNode()).local=this.parseIdent(),this.finishNode(n,"ImportDefaultSpecifier"),this.eat(t.tokTypes.comma)),e.specifiers=this.parseImportSpecifierList(),e.source=this.eatContextual("from")&&this.tok.type==t.tokTypes.string?this.parseExprAtom():this.dummyString(),n&&e.specifiers.unshift(n)}return this.semicolon(),this.finishNode(e,"ImportDeclaration")},o.parseImportSpecifierList=function(){var e=this,n=[];if(this.tok.type===t.tokTypes.star){var i=this.startNode();this.next(),i.local=this.eatContextual("as")?this.parseIdent():this.dummyIdent(),n.push(this.finishNode(i,"ImportNamespaceSpecifier"))}else{var s=this.curIndent,u=this.curLineStart,a=this.nextLineStart;for(this.pushCx(),this.eat(t.tokTypes.braceL),this.curLineStart>a&&(a=this.curLineStart);!this.closes(t.tokTypes.braceR,s+(this.curLineStart<=a?1:0),u);){var o=e.startNode();if(e.eat(t.tokTypes.star))o.local=e.eatContextual("as")?e.parseIdent():e.dummyIdent(),e.finishNode(o,"ImportNamespaceSpecifier");else{if(e.isContextual("from"))break;if(o.imported=e.parseIdent(),r(o.imported))break;o.local=e.eatContextual("as")?e.parseIdent():o.imported,e.finishNode(o,"ImportSpecifier")}n.push(o),e.eat(t.tokTypes.comma)}this.eat(t.tokTypes.braceR),this.popCx()}return n},o.parseExportSpecifierList=function(){var e=this,n=[],i=this.curIndent,s=this.curLineStart,u=this.nextLineStart;for(this.pushCx(),this.eat(t.tokTypes.braceL),this.curLineStart>u&&(u=this.curLineStart);!this.closes(t.tokTypes.braceR,i+(this.curLineStart<=u?1:0),s)&&!e.isContextual("from");){var a=e.startNode();if(a.local=e.parseIdent(),r(a.local))break;a.exported=e.eatContextual("as")?e.parseIdent():a.local,e.finishNode(a,"ExportSpecifier"),n.push(a),e.eat(t.tokTypes.comma)}return this.eat(t.tokTypes.braceR),this.popCx(),n};var c=u.prototype;c.checkLVal=function(e){if(!e)return e;switch(e.type){case"Identifier":case"MemberExpression":return e;case"ParenthesizedExpression":return e.expression=this.checkLVal(e.expression),e;default:return this.dummyIdent()}},c.parseExpression=function(e){var n=this,r=this.storeCurrentPos(),i=this.parseMaybeAssign(e);if(this.tok.type===t.tokTypes.comma){var s=this.startNodeAt(r);for(s.expressions=[i];this.eat(t.tokTypes.comma);)s.expressions.push(n.parseMaybeAssign(e));return this.finishNode(s,"SequenceExpression")}return i},c.parseParenExpression=function(){this.pushCx(),this.expect(t.tokTypes.parenL);var e=this.parseExpression();return this.popCx(),this.expect(t.tokTypes.parenR),e},c.parseMaybeAssign=function(e){if(this.toks.isContextual("yield")){var n=this.startNode();return this.next(),this.semicolon()||this.canInsertSemicolon()||this.tok.type!=t.tokTypes.star&&!this.tok.type.startsExpr?(n.delegate=!1,n.argument=null):(n.delegate=this.eat(t.tokTypes.star),n.argument=this.parseMaybeAssign()),this.finishNode(n,"YieldExpression")}var r=this.storeCurrentPos(),i=this.parseMaybeConditional(e);if(this.tok.type.isAssign){var s=this.startNodeAt(r);return s.operator=this.tok.value,s.left=this.tok.type===t.tokTypes.eq?this.toAssignable(i):this.checkLVal(i),this.next(),s.right=this.parseMaybeAssign(e),this.finishNode(s,"AssignmentExpression")}return i},c.parseMaybeConditional=function(e){var n=this.storeCurrentPos(),r=this.parseExprOps(e);if(this.eat(t.tokTypes.question)){var i=this.startNodeAt(n);return i.test=r,i.consequent=this.parseMaybeAssign(),i.alternate=this.expect(t.tokTypes.colon)?this.parseMaybeAssign(e):this.dummyIdent(),this.finishNode(i,"ConditionalExpression")}return r},c.parseExprOps=function(e){var t=this.storeCurrentPos(),n=this.curIndent,r=this.curLineStart;return this.parseExprOp(this.parseMaybeUnary(!1),t,-1,e,n,r)},c.parseExprOp=function(e,n,r,i,s,u){if(this.curLineStart!=u&&this.curIndent<s&&this.tokenStartsLine())return e;var a=this.tok.type.binop;if(null!=a&&(!i||this.tok.type!==t.tokTypes._in)&&a>r){var o=this.startNodeAt(n);if(o.left=e,o.operator=this.tok.value,this.next(),this.curLineStart!=u&&this.curIndent<s&&this.tokenStartsLine())o.right=this.dummyIdent();else{var c=this.storeCurrentPos();o.right=this.parseExprOp(this.parseMaybeUnary(!1),c,a,i,s,u)}return this.finishNode(o,/&&|\|\|/.test(o.operator)?"LogicalExpression":"BinaryExpression"),this.parseExprOp(o,n,r,i,s,u)}return e},c.parseMaybeUnary=function(e){var n,r=this,i=this.storeCurrentPos();if(this.options.ecmaVersion>=8&&this.inAsync&&this.toks.isContextual("await"))n=this.parseAwait(),e=!0;else if(this.tok.type.prefix){var s=this.startNode(),u=this.tok.type===t.tokTypes.incDec;u||(e=!0),s.operator=this.tok.value,s.prefix=!0,this.next(),s.argument=this.parseMaybeUnary(!0),u&&(s.argument=this.checkLVal(s.argument)),n=this.finishNode(s,u?"UpdateExpression":"UnaryExpression")}else if(this.tok.type===t.tokTypes.ellipsis){var a=this.startNode();this.next(),a.argument=this.parseMaybeUnary(e),n=this.finishNode(a,"SpreadElement")}else for(n=this.parseExprSubscripts();this.tok.type.postfix&&!this.canInsertSemicolon();){var o=r.startNodeAt(i);o.operator=r.tok.value,o.prefix=!1,o.argument=r.checkLVal(n),r.next(),n=r.finishNode(o,"UpdateExpression")}if(!e&&this.eat(t.tokTypes.starstar)){var c=this.startNodeAt(i);return c.operator="**",c.left=n,c.right=this.parseMaybeUnary(!1),this.finishNode(c,"BinaryExpression")}return n},c.parseExprSubscripts=function(){var e=this.storeCurrentPos();return this.parseSubscripts(this.parseExprAtom(),e,!1,this.curIndent,this.curLineStart)},c.parseSubscripts=function(e,n,r,i,s){for(var u=this;;){if(u.curLineStart!=s&&u.curIndent<=i&&u.tokenStartsLine()){if(u.tok.type!=t.tokTypes.dot||u.curIndent!=i)return e;--i}var a="Identifier"===e.type&&"async"===e.name&&!u.canInsertSemicolon();if(u.eat(t.tokTypes.dot)){var o=u.startNodeAt(n);o.object=e,u.curLineStart!=s&&u.curIndent<=i&&u.tokenStartsLine()?o.property=u.dummyIdent():o.property=u.parsePropertyAccessor()||u.dummyIdent(),o.computed=!1,e=u.finishNode(o,"MemberExpression")}else if(u.tok.type==t.tokTypes.bracketL){u.pushCx(),u.next();var c=u.startNodeAt(n);c.object=e,c.property=u.parseExpression(),c.computed=!0,u.popCx(),u.expect(t.tokTypes.bracketR),e=u.finishNode(c,"MemberExpression")}else if(r||u.tok.type!=t.tokTypes.parenL){if(u.tok.type!=t.tokTypes.backQuote)return e;var p=u.startNodeAt(n);p.tag=e,p.quasi=u.parseTemplate(),e=u.finishNode(p,"TaggedTemplateExpression")}else{var l=u.parseExprList(t.tokTypes.parenR);if(a&&u.eat(t.tokTypes.arrow))return u.parseArrowExpression(u.startNodeAt(n),l,!0);var h=u.startNodeAt(n);h.callee=e,h.arguments=l,e=u.finishNode(h,"CallExpression")}}},c.parseExprAtom=function(){var e;switch(this.tok.type){case t.tokTypes._this:case t.tokTypes._super:var n=this.tok.type===t.tokTypes._this?"ThisExpression":"Super";return e=this.startNode(),this.next(),this.finishNode(e,n);case t.tokTypes.name:var i=this.storeCurrentPos(),s=this.parseIdent(),u=!1;if("async"===s.name&&!this.canInsertSemicolon()){if(this.eat(t.tokTypes._function))return this.parseFunction(this.startNodeAt(i),!1,!0);this.tok.type===t.tokTypes.name&&(s=this.parseIdent(),u=!0)}return this.eat(t.tokTypes.arrow)?this.parseArrowExpression(this.startNodeAt(i),[s],u):s;case t.tokTypes.regexp:e=this.startNode();var a=this.tok.value;return e.regex={pattern:a.pattern,flags:a.flags},e.value=a.value,e.raw=this.input.slice(this.tok.start,this.tok.end),this.next(),this.finishNode(e,"Literal");case t.tokTypes.num:case t.tokTypes.string:return e=this.startNode(),e.value=this.tok.value,e.raw=this.input.slice(this.tok.start,this.tok.end),this.next(),this.finishNode(e,"Literal");case t.tokTypes._null:case t.tokTypes._true:case t.tokTypes._false:return e=this.startNode(),e.value=this.tok.type===t.tokTypes._null?null:this.tok.type===t.tokTypes._true,e.raw=this.tok.type.keyword,this.next(),this.finishNode(e,"Literal");case t.tokTypes.parenL:var o=this.storeCurrentPos();this.next();var c=this.parseExpression();if(this.expect(t.tokTypes.parenR),this.eat(t.tokTypes.arrow)){var p=c.expressions||[c];return p.length&&r(p[p.length-1])&&p.pop(),this.parseArrowExpression(this.startNodeAt(o),p)}if(this.options.preserveParens){var l=this.startNodeAt(o);l.expression=c,c=this.finishNode(l,"ParenthesizedExpression")}return c;case t.tokTypes.bracketL:return e=this.startNode(),e.elements=this.parseExprList(t.tokTypes.bracketR,!0),this.finishNode(e,"ArrayExpression");case t.tokTypes.braceL:return this.parseObj();case t.tokTypes._class:return this.parseClass(!1);case t.tokTypes._function:return e=this.startNode(),this.next(),this.parseFunction(e,!1);case t.tokTypes._new:return this.parseNew();case t.tokTypes.backQuote:return this.parseTemplate();default:return this.dummyIdent()}},c.parseNew=function(){var e=this.startNode(),n=this.curIndent,r=this.curLineStart,i=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(t.tokTypes.dot))return e.meta=i,e.property=this.parseIdent(!0),this.finishNode(e,"MetaProperty");var s=this.storeCurrentPos();return e.callee=this.parseSubscripts(this.parseExprAtom(),s,!0,n,r),this.tok.type==t.tokTypes.parenL?e.arguments=this.parseExprList(t.tokTypes.parenR):e.arguments=[],this.finishNode(e,"NewExpression")},c.parseTemplateElement=function(){var e=this.startNode();return this.tok.type===t.tokTypes.invalidTemplate?e.value={raw:this.tok.value,cooked:null}:e.value={raw:this.input.slice(this.tok.start,this.tok.end).replace(/\r\n?/g,"\n"),cooked:this.tok.value},this.next(),e.tail=this.tok.type===t.tokTypes.backQuote,this.finishNode(e,"TemplateElement")},c.parseTemplate=function(){var e=this,n=this.startNode();this.next(),n.expressions=[];var r=this.parseTemplateElement();for(n.quasis=[r];!r.tail;)e.next(),n.expressions.push(e.parseExpression()),e.expect(t.tokTypes.braceR)?r=e.parseTemplateElement():((r=e.startNode()).value={cooked:"",raw:""},r.tail=!0,e.finishNode(r,"TemplateElement")),n.quasis.push(r);return this.expect(t.tokTypes.backQuote),this.finishNode(n,"TemplateLiteral")},c.parseObj=function(){var e=this,n=this.startNode();n.properties=[],this.pushCx();var i=this.curIndent+1,s=this.curLineStart;for(this.eat(t.tokTypes.braceL),this.curIndent+1<i&&(i=this.curIndent,s=this.curLineStart);!this.closes(t.tokTypes.braceR,i,s);){var u=e.startNode(),a=void 0,o=void 0,c=void 0;if(e.options.ecmaVersion>=6&&(c=e.storeCurrentPos(),u.method=!1,u.shorthand=!1,a=e.eat(t.tokTypes.star)),e.parsePropertyName(u),e.toks.isAsyncProp(u)?(e.parsePropertyName(u),o=!0):o=!1,r(u.key))r(e.parseMaybeAssign())&&e.next(),e.eat(t.tokTypes.comma);else{if(e.eat(t.tokTypes.colon))u.kind="init",u.value=e.parseMaybeAssign();else if(e.options.ecmaVersion>=6&&(e.tok.type===t.tokTypes.parenL||e.tok.type===t.tokTypes.braceL))u.kind="init",u.method=!0,u.value=e.parseMethod(a,o);else if(e.options.ecmaVersion>=5&&"Identifier"===u.key.type&&!u.computed&&("get"===u.key.name||"set"===u.key.name)&&e.tok.type!=t.tokTypes.comma&&e.tok.type!=t.tokTypes.braceR&&e.tok.type!=t.tokTypes.eq)u.kind=u.key.name,e.parsePropertyName(u),u.value=e.parseMethod(!1);else{if(u.kind="init",e.options.ecmaVersion>=6)if(e.eat(t.tokTypes.eq)){var p=e.startNodeAt(c);p.operator="=",p.left=u.key,p.right=e.parseMaybeAssign(),u.value=e.finishNode(p,"AssignmentExpression")}else u.value=u.key;else u.value=e.dummyIdent();u.shorthand=!0}n.properties.push(e.finishNode(u,"Property")),e.eat(t.tokTypes.comma)}}return this.popCx(),this.eat(t.tokTypes.braceR)||(this.last.end=this.tok.start,this.options.locations&&(this.last.loc.end=this.tok.loc.start)),this.finishNode(n,"ObjectExpression")},c.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(t.tokTypes.bracketL))return e.computed=!0,e.key=this.parseExpression(),void this.expect(t.tokTypes.bracketR);e.computed=!1}var n=this.tok.type===t.tokTypes.num||this.tok.type===t.tokTypes.string?this.parseExprAtom():this.parseIdent();e.key=n||this.dummyIdent()},c.parsePropertyAccessor=function(){if(this.tok.type===t.tokTypes.name||this.tok.type.keyword)return this.parseIdent()},c.parseIdent=function(){var e=this.tok.type===t.tokTypes.name?this.tok.value:this.tok.type.keyword;if(!e)return this.dummyIdent();var n=this.startNode();return this.next(),n.name=e,this.finishNode(n,"Identifier")},c.initFunction=function(e){e.id=null,e.params=[],this.options.ecmaVersion>=6&&(e.generator=!1,e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)},c.toAssignable=function(e,t){var n=this;if(!e||"Identifier"==e.type||"MemberExpression"==e.type&&!t);else if("ParenthesizedExpression"==e.type)this.toAssignable(e.expression,t);else{if(this.options.ecmaVersion<6)return this.dummyIdent();if("ObjectExpression"==e.type){e.type="ObjectPattern";for(var r=0,i=e.properties;r<i.length;r+=1){var s=i[r];n.toAssignable(s.value,t)}}else if("ArrayExpression"==e.type)e.type="ArrayPattern",this.toAssignableList(e.elements,t);else if("SpreadElement"==e.type)e.type="RestElement",this.toAssignable(e.argument,t);else{if("AssignmentExpression"!=e.type)return this.dummyIdent();e.type="AssignmentPattern",delete e.operator}}return e},c.toAssignableList=function(e,t){for(var n=this,r=0,i=e;r<i.length;r+=1){var s=i[r];n.toAssignable(s,t)}return e},c.parseFunctionParams=function(e){return e=this.parseExprList(t.tokTypes.parenR),this.toAssignableList(e,!0)},c.parseMethod=function(e,t){var n=this.startNode(),r=this.inAsync;return this.initFunction(n),this.options.ecmaVersion>=6&&(n.generator=!!e),this.options.ecmaVersion>=8&&(n.async=!!t),this.inAsync=n.async,n.params=this.parseFunctionParams(),n.body=this.parseBlock(),this.toks.adaptDirectivePrologue(n.body.body),this.inAsync=r,this.finishNode(n,"FunctionExpression")},c.parseArrowExpression=function(e,n,r){var i=this.inAsync;return this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!r),this.inAsync=e.async,e.params=this.toAssignableList(n,!0),e.expression=this.tok.type!==t.tokTypes.braceL,e.expression?e.body=this.parseMaybeAssign():(e.body=this.parseBlock(),this.toks.adaptDirectivePrologue(e.body.body)),this.inAsync=i,this.finishNode(e,"ArrowFunctionExpression")},c.parseExprList=function(e,n){var i=this;this.pushCx();var s=this.curIndent,u=this.curLineStart,a=[];for(this.next();!this.closes(e,s+1,u);)if(i.eat(t.tokTypes.comma))a.push(n?null:i.dummyIdent());else{var o=i.parseMaybeAssign();if(r(o)){if(i.closes(e,s,u))break;i.next()}else a.push(o);i.eat(t.tokTypes.comma)}return this.popCx(),this.eat(e)||(this.last.end=this.tok.start,this.options.locations&&(this.last.loc.end=this.tok.loc.start)),a},c.parseAwait=function(){var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(),this.finishNode(e,"AwaitExpression")},t.defaultOptions.tabSize=4,t.addLooseExports(i,u,s),e.parse_dammit=i,e.LooseParser=u,e.pluginsLoose=s,Object.defineProperty(e,"__esModule",{value:!0})}),function(e){function t(e,t){return e.lineStart>=t}function n(e,t,n){var r=t.input.slice(t.start);return n&&(r=r.replace(a,"$1 $3")),e.test(r)}function r(e,t,n){var r=new e.constructor(e.options,e.input,t);if(n)for(var i in n)r[i]=n[i];var s=e,u=r;return["inFunction","inAsync","inGenerator","inModule"].forEach(function(e){e in s&&(u[e]=s[e])}),r.nextToken(),r}var i={exports:{}},s=/^async[\t ]+(return|throw)/,u=/^\s*[):;]/,a=/([^\n])\/\*(\*(?!\/)|[^\n*])*\*\/([^\n])/g;i.exports=function(e,i){i&&"object"==typeof i||(i={}),e.extend("parse",function(t){return function(){return this.inAsync=i.inAsyncFunction,i.awaitAnywhere&&i.inAsyncFunction&&e.raise(node.start,"The options awaitAnywhere and inAsyncFunction are mutually exclusive"),t.apply(this,arguments)}}),e.extend("parseStatement",function(e){return function(t,r){var u=this.start,a=this.startLoc;if("name"===this.type.label&&i.asyncExits&&n(s,this)){this.next();var o=this.parseStatement(t,r);return o.async=!0,o.start=u,o.loc&&(o.loc.start=a),o.range&&(o.range[0]=u),o}return e.apply(this,arguments)}}),e.extend("parseIdent",function(e){return function(t){return"module"===this.options.sourceType&&this.options.ecmaVersion>=8&&i.awaitAnywhere?e.call(this,!0):e.apply(this,arguments)}}),e.extend("parseExprAtom",function(e){var t={};return function(n){var s,u=this.start,a=(this.startLoc,e.apply(this,arguments));if("Identifier"===a.type&&"await"===a.name&&!this.inAsync&&i.awaitAnywhere){var o=this.startNodeAt(a.start,a.loc&&a.loc.start);u=this.start;var c={raise:function(){try{return pp.raise.apply(this,arguments)}catch(e){throw t}}};try{if((s=r(this,u-4,c).parseExprSubscripts()).end<=u)return s=r(this,u,c).parseExprSubscripts(),o.argument=s,o=this.finishNodeAt(o,"AwaitExpression",s.end,s.loc&&s.loc.end),this.pos=s.end,this.end=s.end,this.endLoc=s.endLoc,this.next(),o}catch(e){if(e===t)return a;throw e}}return a}});var a={undefined:!0,get:!0,set:!0,static:!0,async:!0,constructor:!0};e.extend("parsePropertyName",function(e){return function(n){var r=n.key&&n.key.name,i=e.apply(this,arguments);return"get"===this.value&&(n.__maybeStaticAsyncGetter=!0),a[this.value]?i:("Identifier"!==i.type||"async"!==i.name&&"async"!==r||t(this,i.end)||this.input.slice(i.end).match(u)?delete n.__maybeStaticAsyncGetter:"set"===n.kind||"set"===i.name?this.raise(i.start,"'set <member>(value)' cannot be be async"):(this.__isAsyncProp=!0,"Identifier"===(i=e.apply(this,arguments)).type&&"set"===i.name&&this.raise(i.start,"'set <member>(value)' cannot be be async")),i)}}),e.extend("parseClassMethod",function(e){return function(t,n,r){var i=e.apply(this,arguments);return n.__maybeStaticAsyncGetter&&(delete n.__maybeStaticAsyncGetter,"get"!==n.key.name&&(n.kind="get")),i}}),e.extend("parseFunctionBody",function(e){return function(t,n){var r=this.inAsync;this.__isAsyncProp&&(t.async=!0,this.inAsync=!0,delete this.__isAsyncProp);var i=e.apply(this,arguments);return this.inAsync=r,i}})},e.plugins.asyncawait=i.exports}(this.acorn),function(e){var t={exports:{}};t.exports=function(e){function t(e,t){var r=this.startNode(),i=!0,s={};for(r.properties=[],this.next();!this.eat(n.braceR);){if(i)i=!1;else if(this.expect(n.comma),this.afterTrailingComma(n.braceR))break;var u,a,o,c,p=this.startNode();if(this.options.ecmaVersion>=6){if(this.type===n.ellipsis){e?(this.next(),p.argument=this.parseIdent(),this.finishNode(p,"RestElement")):p=this.parseSpread(t),r.properties.push(p),this.type===n.comma&&(e?this.raise(this.start,"Comma is not permitted after the rest element"):t&&t.trailingComma<0&&(t.trailingComma=this.start));continue}p.method=!1,p.shorthand=!1,(e||t)&&(o=this.start,c=this.startLoc),e||(u=this.eat(n.star))}this.parsePropertyName(p),!e&&this.options.ecmaVersion>=8&&!u&&this.isAsyncProp(p)?(a=!0,this.parsePropertyName(p,t)):a=!1,this.parsePropertyValue(p,e,u,a,o,c,t),e||this.checkPropClash(p,s),r.properties.push(this.finishNode(p,"Property"))}return this.finishNode(r,e?"ObjectPattern":"ObjectExpression")}if("5"!==e.version.substr(0,1))throw new Error("Unsupported acorn version "+e.version+", please use acorn 5");var n=e.tokTypes,r=e.Parser.prototype;const i=e=>(function(t,n,r){if("ObjectPattern"!=t.type)return"Property"===t.type?this.checkLVal(t.value,n,r):e.apply(this,arguments);for(var i of t.properties)this.checkLVal(i,n,r)});return e.plugins.objectSpread=function(e){r.parseObj=t,e.extend("checkLVal",i),e.extend("toAssignable",e=>(function(t,n){if(this.options.ecmaVersion>=6&&t){if("ObjectExpression"==t.type){t.type="ObjectPattern";for(var r of t.properties)this.toAssignable(r,n);return t}if("Property"===t.type)return"init"!==t.kind&&this.raise(t.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(t.value,n);if("SpreadElement"===t.type)return t.type="RestElement",this.toAssignable(t.argument,n)}return e.apply(this,arguments)})),e.extend("checkPatternExport",e=>(function(t,n){if("ObjectPattern"!=n.type)return"Property"===n.type?this.checkPatternExport(t,n.value):"RestElement"===n.type?this.checkPatternExport(t,n.argument):void e.apply(this,arguments);for(var r of n.properties)this.checkPatternExport(t,r)}))},e},t.exports(e)}(this.acorn),function(e){var t={exports:{}},n={quot:'"',amp:"&",apos:"'",lt:"<",gt:">",nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",fnof:"",circ:"",tilde:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",bull:"",hellip:"",permil:"",prime:"",Prime:"",lsaquo:"",rsaquo:"",oline:"",frasl:"",euro:"",image:"",weierp:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",lang:"",rang:"",loz:"",spades:"",clubs:"",hearts:"",diams:""},r=/^[\da-fA-F]+$/,i=/^\d+$/;t.exports=function(e){function t(e){return e?"JSXIdentifier"===e.type?e.name:"JSXNamespacedName"===e.type?e.namespace.name+":"+e.name.name:"JSXMemberExpression"===e.type?t(e.object)+"."+t(e.property):void 0:e}var s=e.tokTypes,u=e.tokContexts;u.j_oTag=new e.TokContext("<tag",!1),u.j_cTag=new e.TokContext("</tag",!1),u.j_expr=new e.TokContext("<tag>...</tag>",!0,!0),s.jsxName=new e.TokenType("jsxName"),s.jsxText=new e.TokenType("jsxText",{beforeExpr:!0}),s.jsxTagStart=new e.TokenType("jsxTagStart"),s.jsxTagEnd=new e.TokenType("jsxTagEnd"),s.jsxTagStart.updateContext=function(){this.context.push(u.j_expr),this.context.push(u.j_oTag),this.exprAllowed=!1},s.jsxTagEnd.updateContext=function(e){var t=this.context.pop();t===u.j_oTag&&e===s.slash||t===u.j_cTag?(this.context.pop(),this.exprAllowed=this.curContext()===u.j_expr):this.exprAllowed=!0};var a=e.Parser.prototype;return a.jsx_readToken=function(){for(var t="",n=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated JSX contents");var r=this.input.charCodeAt(this.pos);switch(r){case 60:case 123:return this.pos===this.start?60===r&&this.exprAllowed?(++this.pos,this.finishToken(s.jsxTagStart)):this.getTokenFromCode(r):(t+=this.input.slice(n,this.pos),this.finishToken(s.jsxText,t));case 38:t+=this.input.slice(n,this.pos),t+=this.jsx_readEntity(),n=this.pos;break;default:e.isNewLine(r)?(t+=this.input.slice(n,this.pos),t+=this.jsx_readNewLine(!0),n=this.pos):++this.pos}}},a.jsx_readNewLine=function(e){var t,n=this.input.charCodeAt(this.pos);return++this.pos,13===n&&10===this.input.charCodeAt(this.pos)?(++this.pos,t=e?"\n":"\r\n"):t=String.fromCharCode(n),this.options.locations&&(++this.curLine,this.lineStart=this.pos),t},a.jsx_readString=function(t){for(var n="",r=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var i=this.input.charCodeAt(this.pos);if(i===t)break;38===i?(n+=this.input.slice(r,this.pos),n+=this.jsx_readEntity(),r=this.pos):e.isNewLine(i)?(n+=this.input.slice(r,this.pos),n+=this.jsx_readNewLine(!1),r=this.pos):++this.pos}return n+=this.input.slice(r,this.pos++),this.finishToken(s.string,n)},a.jsx_readEntity=function(){var e,t="",s=0,u=this.input[this.pos];"&"!==u&&this.raise(this.pos,"Entity must start with an ampersand");for(var a=++this.pos;this.pos<this.input.length&&s++<10;){if(";"===(u=this.input[this.pos++])){"#"===t[0]?"x"===t[1]?(t=t.substr(2),r.test(t)&&(e=String.fromCharCode(parseInt(t,16)))):(t=t.substr(1),i.test(t)&&(e=String.fromCharCode(parseInt(t,10)))):e=n[t];break}t+=u}return e||(this.pos=a,"&")},a.jsx_readWord=function(){var t,n=this.pos;do{t=this.input.charCodeAt(++this.pos)}while(e.isIdentifierChar(t)||45===t);return this.finishToken(s.jsxName,this.input.slice(n,this.pos))},a.jsx_parseIdentifier=function(){var e=this.startNode();return this.type===s.jsxName?e.name=this.value:this.type.keyword?e.name=this.type.keyword:this.unexpected(),this.next(),this.finishNode(e,"JSXIdentifier")},a.jsx_parseNamespacedName=function(){var e=this.start,t=this.startLoc,n=this.jsx_parseIdentifier();if(!this.options.plugins.jsx.allowNamespaces||!this.eat(s.colon))return n;var r=this.startNodeAt(e,t);return r.namespace=n,r.name=this.jsx_parseIdentifier(),this.finishNode(r,"JSXNamespacedName")},a.jsx_parseElementName=function(){if(this.type===s.jsxTagEnd)return"";var e=this.start,t=this.startLoc,n=this.jsx_parseNamespacedName();for(this.type!==s.dot||"JSXNamespacedName"!==n.type||this.options.plugins.jsx.allowNamespacedObjects||this.unexpected();this.eat(s.dot);){var r=this.startNodeAt(e,t);r.object=n,r.property=this.jsx_parseIdentifier(),n=this.finishNode(r,"JSXMemberExpression")}return n},a.jsx_parseAttributeValue=function(){switch(this.type){case s.braceL:var e=this.jsx_parseExpressionContainer();return"JSXEmptyExpression"===e.expression.type&&this.raise(e.start,"JSX attributes must only be assigned a non-empty expression"),e;case s.jsxTagStart:case s.string:return this.parseExprAtom();default:this.raise(this.start,"JSX value should be either an expression or a quoted JSX text")}},a.jsx_parseEmptyExpression=function(){var e=this.startNodeAt(this.lastTokEnd,this.lastTokEndLoc);return this.finishNodeAt(e,"JSXEmptyExpression",this.start,this.startLoc)},a.jsx_parseExpressionContainer=function(){var e=this.startNode();return this.next(),e.expression=this.type===s.braceR?this.jsx_parseEmptyExpression():this.parseExpression(),this.expect(s.braceR),this.finishNode(e,"JSXExpressionContainer")},a.jsx_parseAttribute=function(){var e=this.startNode();return this.eat(s.braceL)?(this.expect(s.ellipsis),e.argument=this.parseMaybeAssign(),this.expect(s.braceR),this.finishNode(e,"JSXSpreadAttribute")):(e.name=this.jsx_parseNamespacedName(),e.value=this.eat(s.eq)?this.jsx_parseAttributeValue():null,this.finishNode(e,"JSXAttribute"))},a.jsx_parseOpeningElementAt=function(e,t){var n=this.startNodeAt(e,t);for(n.attributes=[],n.name=this.jsx_parseElementName();this.type!==s.slash&&this.type!==s.jsxTagEnd;)n.attributes.push(this.jsx_parseAttribute());return n.selfClosing=this.eat(s.slash),this.expect(s.jsxTagEnd),this.finishNode(n,"JSXOpeningElement")},a.jsx_parseClosingElementAt=function(e,t){var n=this.startNodeAt(e,t);return n.name=this.jsx_parseElementName(),this.expect(s.jsxTagEnd),this.finishNode(n,"JSXClosingElement")},a.jsx_parseElementAt=function(e,n){var r=this.startNodeAt(e,n),i=[],u=this.jsx_parseOpeningElementAt(e,n),a=null;if(!u.selfClosing){e:for(;;)switch(this.type){case s.jsxTagStart:if(e=this.start,n=this.startLoc,this.next(),this.eat(s.slash)){a=this.jsx_parseClosingElementAt(e,n);break e}i.push(this.jsx_parseElementAt(e,n));break;case s.jsxText:i.push(this.parseExprAtom());break;case s.braceL:i.push(this.jsx_parseExpressionContainer());break;default:this.unexpected()}t(a.name)!==t(u.name)&&this.raise(a.start,"Expected corresponding JSX closing tag for <"+t(u.name)+">")}return r.openingElement=u,r.closingElement=a,r.children=i,this.type===s.relational&&"<"===this.value&&this.raise(this.start,"Adjacent JSX elements must be wrapped in an enclosing tag"),this.finishNode(r,u.name?"JSXElement":"JSXFragment")},a.jsx_parseText=function(e){var t=this.parseLiteral(e);return t.type="JSXText",t},a.jsx_parseElement=function(){var e=this.start,t=this.startLoc;return this.next(),this.jsx_parseElementAt(e,t)},e.plugins.jsx=function(t,n){n&&("object"!=typeof n&&(n={}),t.options.plugins.jsx={allowNamespaces:!1!==n.allowNamespaces,allowNamespacedObjects:!!n.allowNamespacedObjects},t.extend("parseExprAtom",function(e){return function(t){return this.type===s.jsxText?this.jsx_parseText(this.value):this.type===s.jsxTagStart?this.jsx_parseElement():e.call(this,t)}}),t.extend("readToken",function(t){return function(n){var r=this.curContext();if(r===u.j_expr)return this.jsx_readToken();if(r===u.j_oTag||r===u.j_cTag){if(e.isIdentifierStart(n))return this.jsx_readWord();if(62==n)return++this.pos,this.finishToken(s.jsxTagEnd);if((34===n||39===n)&&r==u.j_oTag)return this.jsx_readString(n)}return 60===n&&this.exprAllowed&&33!==this.input.charCodeAt(this.pos+1)?(++this.pos,this.finishToken(s.jsxTagStart)):t.call(this,n)}}),t.extend("updateContext",function(e){return function(t){if(this.type==s.braceL){var n=this.curContext();n==u.j_oTag?this.context.push(u.b_expr):n==u.j_expr?this.context.push(u.b_tmpl):e.call(this,t),this.exprAllowed=!0}else{if(this.type!==s.slash||t!==s.jsxTagStart)return e.call(this,t);this.context.length-=2,this.context.push(u.j_cTag),this.exprAllowed=!1}}}))},e},t.exports(e)}(this.acorn),this.acorn}(),function(t){(function(n){function r(e,t){if({}.hasOwnProperty.call(r.cache,e))return r.cache[e];var n=r.resolve(e);if(!n)throw new Error("Failed to resolve module "+e);var i={id:e,require:r,filename:e,exports:{},loaded:!1,parent:t,children:[]};t&&t.children.push(i);var s=e.slice(0,e.lastIndexOf("/")+1);return r.cache[e]=i.exports,n.call(i.exports,i,i.exports,s,e),i.loaded=!0,r.cache[e]=i.exports}r.modules={},r.cache={},r.resolve=function(e){return{}.hasOwnProperty.call(r.modules,e)?r.modules[e]:void 0},r.define=function(e,t){r.modules[e]=t};var i=function(){var e="/";return{title:"browser",version:"v8.9.3",browser:!0,env:{},argv:[],nextTick:n.setImmediate||function(e){setTimeout(e,0)},cwd:function(){return e},chdir:function(t){e=t}}}();r.define("/tools/entry-point.js",function(e,i,s,u){!function(){"use strict";n.escodegen=r("/escodegen.js",e),t.escodegen.browser=!0}()}),r.define("/escodegen.js",function(e,t,i,s){!function(){"use strict";function i(e){return P.Expression.hasOwnProperty(e.type)}function s(e){return P.Statement.hasOwnProperty(e.type)}function u(){return{indent:null,base:null,parse:null,comment:!1,format:{indent:{style:"    ",base:0,adjustMultilineComment:!1},newline:"\n",space:" ",json:!1,renumber:!1,hexadecimal:!1,quotes:"single",escapeless:!1,compact:!1,parentheses:!0,semicolons:!0,safeConcatenation:!1,preserveBlankLines:!1},moz:{comprehensionExpressionStartsWithAssignment:!1,starlessGenerator:!1},sourceMap:null,sourceMapRoot:null,sourceMapWithCode:!1,directive:!1,raw:!0,verbatim:null,sourceCode:null}}function a(e,t){var n="";for(t|=0;t>0;t>>>=1,e+=e)1&t&&(n+=e);return n}function o(e){return/[\r\n]/g.test(e)}function c(e){var t=e.length;return t&&X.code.isLineTerminator(e.charCodeAt(t-1))}function p(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function l(e,t){function n(e){return"object"==typeof e&&e instanceof Object&&!(e instanceof RegExp)}var r,i;for(r in t)t.hasOwnProperty(r)&&(n(i=t[r])?n(e[r])?l(e[r],i):e[r]=l({},i):e[r]=i);return e}function h(e){var t,n,r,i,s;if(e!==e)throw new Error("Numeric literal whose value is NaN");if(e<0||0===e&&1/e<0)throw new Error("Numeric literal whose value is negative");if(e===1/0)return Y?"null":H?"1e400":"1e+400";if(t=""+e,!H||t.length<3)return t;for(n=t.indexOf("."),Y||48!==t.charCodeAt(0)||1!==n||(n=0,t=t.slice(1)),r=t,t=t.replace("e+","e"),i=0,(s=r.indexOf("e"))>0&&(i=+r.slice(s+1),r=r.slice(0,s)),n>=0&&(i-=r.length-n-1,r=+(r.slice(0,n)+r.slice(n+1))+""),s=0;48===r.charCodeAt(r.length+s-1);)--s;return 0!==s&&(i-=s,r=r.slice(0,s)),0!==i&&(r+="e"+i),(r.length<t.length||K&&e>1e12&&Math.floor(e)===e&&(r="0x"+e.toString(16)).length<t.length)&&+r===e&&(t=r),t}function d(e,t){return 8232==(-2&e)?(t?"u":"\\u")+(8232===e?"2028":"2029"):10===e||13===e?(t?"":"\\")+(10===e?"n":"r"):String.fromCharCode(e)}function f(e){var t,n,r,i,s,u,a,o;if(n=e.toString(),e.source){if(!(t=n.match(/\/([^\/]*)$/)))return n;for(r=t[1],n="",a=!1,o=!1,i=0,s=e.source.length;i<s;++i)u=e.source.charCodeAt(i),o?(n+=d(u,o),o=!1):(a?93===u&&(a=!1):47===u?n+="\\":91===u&&(a=!0),n+=d(u,o),o=92===u);return"/"+n+"/"+r}return n}function m(e,t){var n;return 8===e?"\\b":12===e?"\\f":9===e?"\\t":(n=e.toString(16).toUpperCase(),Y||e>255?"\\u"+"0000".slice(n.length)+n:0!==e||X.code.isDecimalDigit(t)?11===e?"\\x0B":"\\x"+"00".slice(n.length)+n:"\\0")}function y(e){if(92===e)return"\\\\";if(10===e)return"\\n";if(13===e)return"\\r";if(8232===e)return"\\u2028";if(8233===e)return"\\u2029";throw new Error("Incorrectly classified character")}function g(e){var t,n,r,i;for(i="double"===Q?'"':"'",t=0,n=e.length;t<n;++t){if(39===(r=e.charCodeAt(t))){i='"';break}if(34===r){i="'";break}92===r&&++t}return i+e+i}function v(e){var t,n,r,i,s,u="",a=0,o=0;for(t=0,n=e.length;t<n;++t){if(39===(r=e.charCodeAt(t)))++a;else if(34===r)++o;else if(47===r&&Y)u+="\\";else{if(X.code.isLineTerminator(r)||92===r){u+=y(r);continue}if(!X.code.isIdentifierPartES5(r)&&(Y&&r<32||!Y&&!Z&&(r<32||r>126))){u+=m(r,e.charCodeAt(t+1));continue}}u+=String.fromCharCode(r)}if(i=!("double"===Q||"auto"===Q&&o<a),s=i?"'":'"',!(i?a:o))return s+u+s;for(e=u,u=s,t=0,n=e.length;t<n;++t)(39===(r=e.charCodeAt(t))&&i||34===r&&!i)&&(u+="\\"),u+=String.fromCharCode(r);return u+s}function A(e){var t,n,r,i="";for(t=0,n=e.length;t<n;++t)r=e[t],i+=z(r)?A(r):r;return i}function D(e,t){if(!oe)return z(e)?A(e):e;if(null==t){if(e instanceof U)return e;t={}}return null==t.loc?new U(null,null,oe,e,t.name||null):new U(t.loc.start.line,t.loc.start.column,!0===oe?t.loc.source||null:oe,e,t.name||null)}function x(){return te||" "}function E(e,t){var n,r,i,s;return 0===(n=D(e).toString()).length?[t]:0===(r=D(t).toString()).length?[e]:(i=n.charCodeAt(n.length-1),s=r.charCodeAt(0),(43===i||45===i)&&i===s||X.code.isIdentifierPartES5(i)&&X.code.isIdentifierPartES5(s)||47===i&&105===s?[e,x(),t]:X.code.isWhiteSpace(i)||X.code.isLineTerminator(i)||X.code.isWhiteSpace(s)||X.code.isLineTerminator(s)?[e,t]:[e,te,t])}function b(e){return[G,e]}function C(e){var t;t=G,e(G+=$),G=t}function F(e){var t;for(t=e.length-1;t>=0&&!X.code.isLineTerminator(e.charCodeAt(t));--t);return e.length-1-t}function S(e,t){var n,r,i,s,u,a,o,c;for(n=e.split(/\r\n|[\r\n]/),a=Number.MAX_VALUE,r=1,i=n.length;r<i;++r){for(s=n[r],u=0;u<s.length&&X.code.isWhiteSpace(s.charCodeAt(u));)++u;a>u&&(a=u)}for(void 0!==t?(o=G,"*"===n[1][a]&&(t+=" "),G=t):(1&a&&--a,o=G),r=1,i=n.length;r<i;++r)c=D(b(n[r].slice(a))),n[r]=oe?c.join(""):c;return G=o,n.join("\n")}function k(e,t){if("Line"===e.type){if(c(e.value))return"//"+e.value;var n="//"+e.value;return pe||(n+="\n"),n}return ue.format.indent.adjustMultilineComment&&/[\n\r]/.test(e.value)?S("/*"+e.value+"*/",t):"/*"+e.value+"*/"}function B(e,t){var n,r,i,s,u,o,p,l,h,d,f,m;if(e.leadingComments&&e.leadingComments.length>0){if(s=t,pe){for(t=[],l=(i=e.leadingComments[0]).extendedRange,h=i.range,(m=((f=ce.substring(l[0],h[0])).match(/\n/g)||[]).length)>0?(t.push(a("\n",m)),t.push(b(k(i)))):(t.push(f),t.push(k(i))),d=h,n=1,r=e.leadingComments.length;n<r;n++)h=(i=e.leadingComments[n]).range,m=(ce.substring(d[1],h[0]).match(/\n/g)||[]).length,t.push(a("\n",m)),t.push(b(k(i))),d=h;m=(ce.substring(h[1],l[1]).match(/\n/g)||[]).length,t.push(a("\n",m))}else for(i=e.leadingComments[0],t=[],ie&&e.type===V.Program&&0===e.body.length&&t.push("\n"),t.push(k(i)),c(D(t).toString())||t.push("\n"),n=1,r=e.leadingComments.length;n<r;++n)c(D(p=[k(i=e.leadingComments[n])]).toString())||p.push("\n"),t.push(b(p));t.push(b(s))}if(e.trailingComments)if(pe)l=(i=e.trailingComments[0]).extendedRange,h=i.range,(m=((f=ce.substring(l[0],h[0])).match(/\n/g)||[]).length)>0?(t.push(a("\n",m)),t.push(b(k(i)))):(t.push(f),t.push(k(i)));else for(u=!c(D(t).toString()),o=a(" ",F(D([G,t,$]).toString())),n=0,r=e.trailingComments.length;n<r;++n)i=e.trailingComments[n],u?(t=0===n?[t,$]:[t,o]).push(k(i,o)):t=[t,b(k(i))],n===r-1||c(D(t).toString())||(t=[t,"\n"]);return t}function _(e,t,n){var r,i=0;for(r=e;r<t;r++)"\n"===ce[r]&&i++;for(r=1;r<i;r++)n.push(ee)}function w(e,t,n){return t<n?["(",e,")"]:e}function T(e){var t,n,r;for(t=1,n=(r=e.split(/\r\n|\n/)).length;t<n;t++)r[t]=ee+G+r[t];return r}function I(e,t){var n,r;return n=e[ue.verbatim],r="string"==typeof n?w(T(n),q.Sequence,t):w(r=T(n.content),null!=n.precedence?n.precedence:q.Sequence,t),D(r,e)}function P(){}function N(e){return D(e.name,e)}function L(e,t){return e.async?"async"+(t?x():te):""}function j(e){return e.generator&&!ue.moz.starlessGenerator?"*"+te:""}function O(e){var t=e.value;return t.async?L(t,!e.computed):j(t)?"*":""}function M(e){var t;if(t=new P,s(e))return t.generateStatement(e,fe);if(i(e))return t.generateExpression(e,q.Sequence,de);throw new Error("Unknown node type: "+e.type)}function R(e,t){return e.indexOf('"')>=0||e.indexOf("'")>=0?t:"double"===Q?'"'+e+'"':"'"+e+"'"}var V,q,W,U,J,X,z,G,$,Y,H,K,Q,Z,ee,te,ne,re,ie,se,ue,ae,oe,ce,pe,le,he;J=r("/node_modules/estraverse/estraverse.js",e),X=r("/node_modules/esutils/lib/utils.js",e),V=J.Syntax,W={"||":(q={Sequence:0,Yield:1,Await:1,Assignment:1,Conditional:2,ArrowFunction:2,LogicalOR:3,LogicalAND:4,BitwiseOR:5,BitwiseXOR:6,BitwiseAND:7,Equality:8,Relational:9,BitwiseSHIFT:10,Additive:11,Multiplicative:12,Exponentiation:13,Unary:14,Postfix:15,Call:16,New:17,TaggedTemplate:18,Member:19,Primary:20}).LogicalOR,"&&":q.LogicalAND,"|":q.BitwiseOR,"^":q.BitwiseXOR,"&":q.BitwiseAND,"==":q.Equality,"!=":q.Equality,"===":q.Equality,"!==":q.Equality,is:q.Equality,isnt:q.Equality,"<":q.Relational,">":q.Relational,"<=":q.Relational,">=":q.Relational,in:q.Relational,instanceof:q.Relational,"<<":q.BitwiseSHIFT,">>":q.BitwiseSHIFT,">>>":q.BitwiseSHIFT,"+":q.Additive,"-":q.Additive,"*":q.Multiplicative,"%":q.Multiplicative,"/":q.Multiplicative,"**":q.Exponentiation};var de=7,fe=1;(z=Array.isArray)||(z=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),P.prototype.maybeBlock=function(e,t){var n,r,i=this;return r=!ue.comment||!e.leadingComments,e.type===V.BlockStatement&&r?[te,this.generateStatement(e,t)]:e.type===V.EmptyStatement&&r?";":(C(function(){n=[ee,b(i.generateStatement(e,t))]}),n)},P.prototype.maybeBlockSuffix=function(e,t){var n=c(D(t).toString());return e.type!==V.BlockStatement||ue.comment&&e.leadingComments||n?n?[t,G]:[t,ee,G]:[t,te]},P.prototype.generatePattern=function(e,t,n){return e.type===V.Identifier?N(e):this.generateExpression(e,t,n)},P.prototype.generateFunctionParams=function(e){var t,n,r,i;if(i=!1,e.type!==V.ArrowFunctionExpression||e.rest||e.defaults&&0!==e.defaults.length||1!==e.params.length||e.params[0].type!==V.Identifier){for((r=e.type===V.ArrowFunctionExpression?[L(e,!1)]:[]).push("("),e.defaults&&(i=!0),t=0,n=e.params.length;t<n;++t)i&&e.defaults[t]?r.push(this.generateAssignment(e.params[t],e.defaults[t],"=",q.Assignment,de)):r.push(this.generatePattern(e.params[t],q.Assignment,de)),t+1<n&&r.push(","+te);e.rest&&(e.params.length&&r.push(","+te),r.push("..."),r.push(N(e.rest))),r.push(")")}else r=[L(e,!0),N(e.params[0])];return r},P.prototype.generateFunctionBody=function(e){var t,n;return t=this.generateFunctionParams(e),e.type===V.ArrowFunctionExpression&&(t.push(te),t.push("=>")),e.expression?(t.push(te),"{"===(n=this.generateExpression(e.body,q.Assignment,de)).toString().charAt(0)&&(n=["(",n,")"]),t.push(n)):t.push(this.maybeBlock(e.body,9)),t},P.prototype.generateIterationForStatement=function(e,t,n){var r=["for"+te+"("],i=this;return C(function(){t.left.type===V.VariableDeclaration?C(function(){r.push(t.left.kind+x()),r.push(i.generateStatement(t.left.declarations[0],0))}):r.push(i.generateExpression(t.left,q.Call,de)),r=E(r,e),r=[E(r,i.generateExpression(t.right,q.Sequence+("of"===e?1:0),de)),")"]}),r.push(this.maybeBlock(t.body,n)),r},P.prototype.generatePropertyKey=function(e,t){var n=[];return t&&n.push("["),n.push(this.generateExpression(e,q.Sequence,de)),t&&n.push("]"),n},P.prototype.generateAssignment=function(e,t,n,r,i){return q.Assignment<r&&(i|=1),w([this.generateExpression(e,q.Call,i),te+n+te,this.generateExpression(t,q.Assignment,i)],q.Assignment,r)},P.prototype.semicolon=function(e){return!re&&32&e?"":";"},P.Statement={BlockStatement:function(e,t){var n,r,i=["{",ee],s=this;return C(function(){0===e.body.length&&pe&&(n=e.range)[1]-n[0]>2&&("\n"===(r=ce.substring(n[0]+1,n[1]-1))[0]&&(i=["{"]),i.push(r));var u,a,o,p;for(p=fe,8&t&&(p|=16),u=0,a=e.body.length;u<a;++u)pe&&(0===u&&(e.body[0].leadingComments&&(n=e.body[0].leadingComments[0].extendedRange,"\n"===(r=ce.substring(n[0],n[1]))[0]&&(i=["{"])),e.body[0].leadingComments||_(e.range[0],e.body[0].range[0],i)),u>0&&(e.body[u-1].trailingComments||e.body[u].leadingComments||_(e.body[u-1].range[1],e.body[u].range[0],i))),u===a-1&&(p|=32),o=e.body[u].leadingComments&&pe?s.generateStatement(e.body[u],p):b(s.generateStatement(e.body[u],p)),i.push(o),c(D(o).toString())||(pe&&u<a-1?e.body[u+1].leadingComments||i.push(ee):i.push(ee)),pe&&u===a-1&&(e.body[u].trailingComments||_(e.body[u].range[1],e.range[1],i))}),i.push(b("}")),i},BreakStatement:function(e,t){return e.label?"break "+e.label.name+this.semicolon(t):"break"+this.semicolon(t)},ContinueStatement:function(e,t){return e.label?"continue "+e.label.name+this.semicolon(t):"continue"+this.semicolon(t)},ClassBody:function(e,t){var n=["{",ee],r=this;return C(function(t){var i,s;for(i=0,s=e.body.length;i<s;++i)n.push(t),n.push(r.generateExpression(e.body[i],q.Sequence,de)),i+1<s&&n.push(ee)}),c(D(n).toString())||n.push(ee),n.push(G),n.push("}"),n},ClassDeclaration:function(e,t){var n;return n=["class"],e.id&&(n=E(n,this.generateExpression(e.id,q.Sequence,de))),e.superClass&&(n=E(n,E("extends",this.generateExpression(e.superClass,q.Assignment,de)))),n.push(te),n.push(this.generateStatement(e.body,33)),n},DirectiveStatement:function(e,t){return ue.raw&&e.raw?e.raw+this.semicolon(t):g(e.directive)+this.semicolon(t)},DoWhileStatement:function(e,t){var n=E("do",this.maybeBlock(e.body,fe));return n=this.maybeBlockSuffix(e.body,n),E(n,["while"+te+"(",this.generateExpression(e.test,q.Sequence,de),")"+this.semicolon(t)])},CatchClause:function(e,t){var n,r=this;return C(function(){var t;n=["catch"+te+"(",r.generateExpression(e.param,q.Sequence,de),")"],e.guard&&(t=r.generateExpression(e.guard,q.Sequence,de),n.splice(2,0," if ",t))}),n.push(this.maybeBlock(e.body,fe)),n},DebuggerStatement:function(e,t){return"debugger"+this.semicolon(t)},EmptyStatement:function(e,t){return";"},ExportDefaultDeclaration:function(e,t){var n,r=["export"];return n=32&t?33:fe,r=E(r,"default"),r=s(e.declaration)?E(r,this.generateStatement(e.declaration,n)):E(r,this.generateExpression(e.declaration,q.Assignment,de)+this.semicolon(t))},ExportNamedDeclaration:function(e,t){var n,r=["export"],i=this;return n=32&t?33:fe,e.declaration?E(r,this.generateStatement(e.declaration,n)):(e.specifiers&&(0===e.specifiers.length?r=E(r,"{"+te+"}"):e.specifiers[0].type===V.ExportBatchSpecifier?r=E(r,this.generateExpression(e.specifiers[0],q.Sequence,de)):(r=E(r,"{"),C(function(t){var n,s;for(r.push(ee),n=0,s=e.specifiers.length;n<s;++n)r.push(t),r.push(i.generateExpression(e.specifiers[n],q.Sequence,de)),n+1<s&&r.push(","+ee)}),c(D(r).toString())||r.push(ee),r.push(G+"}")),e.source?r=E(r,["from"+te,this.generateExpression(e.source,q.Sequence,de),this.semicolon(t)]):r.push(this.semicolon(t))),r)},ExportAllDeclaration:function(e,t){return["export"+te,"*"+te,"from"+te,this.generateExpression(e.source,q.Sequence,de),this.semicolon(t)]},ExpressionStatement:function(e,t){var n,r;return n=[this.generateExpression(e.expression,q.Sequence,256|de)],123===(r=D(n).toString()).charCodeAt(0)||function(e){var t;return"class"===e.slice(0,5)&&(123===(t=e.charCodeAt(5))||X.code.isWhiteSpace(t)||X.code.isLineTerminator(t))}(r)||function(e){var t;return"function"===e.slice(0,8)&&(40===(t=e.charCodeAt(8))||X.code.isWhiteSpace(t)||42===t||X.code.isLineTerminator(t))}(r)||function(e){var t,n,r;if("async"!==e.slice(0,5))return!1;if(!X.code.isWhiteSpace(e.charCodeAt(5)))return!1;for(n=6,r=e.length;n<r&&X.code.isWhiteSpace(e.charCodeAt(n));++n);return n!==r&&"function"===e.slice(n,n+8)&&(40===(t=e.charCodeAt(n+8))||X.code.isWhiteSpace(t)||42===t||X.code.isLineTerminator(t))}(r)||se&&16&t&&e.expression.type===V.Literal&&"string"==typeof e.expression.value?n=["(",n,")"+this.semicolon(t)]:n.push(this.semicolon(t)),n},ImportDeclaration:function(e,t){var n,r,i=this;return 0===e.specifiers.length?["import",te,this.generateExpression(e.source,q.Sequence,de),this.semicolon(t)]:(n=["import"],r=0,e.specifiers[r].type===V.ImportDefaultSpecifier&&(n=E(n,[this.generateExpression(e.specifiers[r],q.Sequence,de)]),++r),e.specifiers[r]&&(0!==r&&n.push(","),e.specifiers[r].type===V.ImportNamespaceSpecifier?n=E(n,[te,this.generateExpression(e.specifiers[r],q.Sequence,de)]):(n.push(te+"{"),e.specifiers.length-r==1?(n.push(te),n.push(this.generateExpression(e.specifiers[r],q.Sequence,de)),n.push(te+"}"+te)):(C(function(t){var s,u;for(n.push(ee),s=r,u=e.specifiers.length;s<u;++s)n.push(t),n.push(i.generateExpression(e.specifiers[s],q.Sequence,de)),s+1<u&&n.push(","+ee)}),c(D(n).toString())||n.push(ee),n.push(G+"}"+te)))),n=E(n,["from"+te,this.generateExpression(e.source,q.Sequence,de),this.semicolon(t)]))},VariableDeclarator:function(e,t){var n=1&t?de:6;return e.init?[this.generateExpression(e.id,q.Assignment,n),te,"=",te,this.generateExpression(e.init,q.Assignment,n)]:this.generatePattern(e.id,q.Assignment,n)},VariableDeclaration:function(e,t){function n(){for(u=e.declarations[0],ue.comment&&u.leadingComments?(r.push("\n"),r.push(b(o.generateStatement(u,a)))):(r.push(x()),r.push(o.generateStatement(u,a))),i=1,s=e.declarations.length;i<s;++i)u=e.declarations[i],ue.comment&&u.leadingComments?(r.push(","+ee),r.push(b(o.generateStatement(u,a)))):(r.push(","+te),r.push(o.generateStatement(u,a)))}var r,i,s,u,a,o=this;return r=[e.kind],a=1&t?fe:0,e.declarations.length>1?C(n):n(),r.push(this.semicolon(t)),r},ThrowStatement:function(e,t){return[E("throw",this.generateExpression(e.argument,q.Sequence,de)),this.semicolon(t)]},TryStatement:function(e,t){var n,r,i,s;if(n=["try",this.maybeBlock(e.block,fe)],n=this.maybeBlockSuffix(e.block,n),e.handlers)for(r=0,i=e.handlers.length;r<i;++r)n=E(n,this.generateStatement(e.handlers[r],fe)),(e.finalizer||r+1!==i)&&(n=this.maybeBlockSuffix(e.handlers[r].body,n));else{for(r=0,i=(s=e.guardedHandlers||[]).length;r<i;++r)n=E(n,this.generateStatement(s[r],fe)),(e.finalizer||r+1!==i)&&(n=this.maybeBlockSuffix(s[r].body,n));if(e.handler)if(z(e.handler))for(r=0,i=e.handler.length;r<i;++r)n=E(n,this.generateStatement(e.handler[r],fe)),(e.finalizer||r+1!==i)&&(n=this.maybeBlockSuffix(e.handler[r].body,n));else n=E(n,this.generateStatement(e.handler,fe)),e.finalizer&&(n=this.maybeBlockSuffix(e.handler.body,n))}return e.finalizer&&(n=E(n,["finally",this.maybeBlock(e.finalizer,fe)])),n},SwitchStatement:function(e,t){var n,r,i,s,u,a=this;if(C(function(){n=["switch"+te+"(",a.generateExpression(e.discriminant,q.Sequence,de),")"+te+"{"+ee]}),e.cases)for(u=fe,i=0,s=e.cases.length;i<s;++i)i===s-1&&(u|=32),r=b(this.generateStatement(e.cases[i],u)),n.push(r),c(D(r).toString())||n.push(ee);return n.push(b("}")),n},SwitchCase:function(e,t){var n,r,i,s,u,a=this;return C(function(){for(n=e.test?[E("case",a.generateExpression(e.test,q.Sequence,de)),":"]:["default:"],i=0,(s=e.consequent.length)&&e.consequent[0].type===V.BlockStatement&&(r=a.maybeBlock(e.consequent[0],fe),n.push(r),i=1),i===s||c(D(n).toString())||n.push(ee),u=fe;i<s;++i)i===s-1&&32&t&&(u|=32),r=b(a.generateStatement(e.consequent[i],u)),n.push(r),i+1===s||c(D(r).toString())||n.push(ee)}),n},IfStatement:function(e,t){var n,r,i,s=this;return C(function(){n=["if"+te+"(",s.generateExpression(e.test,q.Sequence,de),")"]}),i=32&t,r=fe,i&&(r|=32),e.alternate?(n.push(this.maybeBlock(e.consequent,fe)),n=this.maybeBlockSuffix(e.consequent,n),n=e.alternate.type===V.IfStatement?E(n,["else ",this.generateStatement(e.alternate,r)]):E(n,E("else",this.maybeBlock(e.alternate,r)))):n.push(this.maybeBlock(e.consequent,r)),n},ForStatement:function(e,t){var n,r=this;return C(function(){n=["for"+te+"("],e.init?e.init.type===V.VariableDeclaration?n.push(r.generateStatement(e.init,0)):(n.push(r.generateExpression(e.init,q.Sequence,6)),n.push(";")):n.push(";"),e.test?(n.push(te),n.push(r.generateExpression(e.test,q.Sequence,de)),n.push(";")):n.push(";"),e.update?(n.push(te),n.push(r.generateExpression(e.update,q.Sequence,de)),n.push(")")):n.push(")")}),n.push(this.maybeBlock(e.body,32&t?33:fe)),n},ForInStatement:function(e,t){return this.generateIterationForStatement("in",e,32&t?33:fe)},ForOfStatement:function(e,t){return this.generateIterationForStatement("of",e,32&t?33:fe)},LabeledStatement:function(e,t){return[e.label.name+":",this.maybeBlock(e.body,32&t?33:fe)]},Program:function(e,t){var n,r,i,s,u;for(s=e.body.length,n=[ie&&s>0?"\n":""],u=17,i=0;i<s;++i)ie||i!==s-1||(u|=32),pe&&(0===i&&(e.body[0].leadingComments||_(e.range[0],e.body[i].range[0],n)),i>0&&(e.body[i-1].trailingComments||e.body[i].leadingComments||_(e.body[i-1].range[1],e.body[i].range[0],n))),r=b(this.generateStatement(e.body[i],u)),n.push(r),i+1<s&&!c(D(r).toString())&&(pe?e.body[i+1].leadingComments||n.push(ee):n.push(ee)),pe&&i===s-1&&(e.body[i].trailingComments||_(e.body[i].range[1],e.range[1],n));return n},FunctionDeclaration:function(e,t){return[L(e,!0),"function",j(e)||x(),e.id?N(e.id):"",this.generateFunctionBody(e)]},ReturnStatement:function(e,t){return e.argument?[E("return",this.generateExpression(e.argument,q.Sequence,de)),this.semicolon(t)]:["return"+this.semicolon(t)]},WhileStatement:function(e,t){var n,r=this;return C(function(){n=["while"+te+"(",r.generateExpression(e.test,q.Sequence,de),")"]}),n.push(this.maybeBlock(e.body,32&t?33:fe)),n},WithStatement:function(e,t){var n,r=this;return C(function(){n=["with"+te+"(",r.generateExpression(e.object,q.Sequence,de),")"]}),n.push(this.maybeBlock(e.body,32&t?33:fe)),n}},p(P.prototype,P.Statement),P.Expression={SequenceExpression:function(e,t,n){var r,i,s;for(q.Sequence<t&&(n|=1),r=[],i=0,s=e.expressions.length;i<s;++i)r.push(this.generateExpression(e.expressions[i],q.Assignment,n)),i+1<s&&r.push(","+te);return w(r,q.Sequence,t)},AssignmentExpression:function(e,t,n){return this.generateAssignment(e.left,e.right,e.operator,t,n)},ArrowFunctionExpression:function(e,t,n){return w(this.generateFunctionBody(e),q.ArrowFunction,t)},ConditionalExpression:function(e,t,n){return q.Conditional<t&&(n|=1),w([this.generateExpression(e.test,q.LogicalOR,n),te+"?"+te,this.generateExpression(e.consequent,q.Assignment,n),te+":"+te,this.generateExpression(e.alternate,q.Assignment,n)],q.Conditional,t)},LogicalExpression:function(e,t,n){return this.BinaryExpression(e,t,n)},BinaryExpression:function(e,t,n){var r,i,s,u;return(i=W[e.operator])<t&&(n|=1),s=this.generateExpression(e.left,i,n),u=s.toString(),r=47===u.charCodeAt(u.length-1)&&X.code.isIdentifierPartES5(e.operator.charCodeAt(0))?[s,x(),e.operator]:E(s,e.operator),s=this.generateExpression(e.right,i+1,n),"/"===e.operator&&"/"===s.toString().charAt(0)||"<"===e.operator.slice(-1)&&"!--"===s.toString().slice(0,3)?(r.push(x()),r.push(s)):r=E(r,s),"in"!==e.operator||1&n?w(r,i,t):["(",r,")"]},CallExpression:function(e,t,n){var r,i,s;for((r=[this.generateExpression(e.callee,q.Call,3)]).push("("),i=0,s=e.arguments.length;i<s;++i)r.push(this.generateExpression(e.arguments[i],q.Assignment,512|de)),i+1<s&&r.push(","+te);return r.push(")"),2&n?w(r,q.Call,t):["(",r,")"]},NewExpression:function(e,t,n){var r,i,s,u,a;if(i=e.arguments.length,a=4&n&&!ne&&0===i?5:1,r=E("new",this.generateExpression(e.callee,q.New,a)),!(4&n)||ne||i>0){for(r.push("("),s=0,u=i;s<u;++s)r.push(this.generateExpression(e.arguments[s],q.Assignment,de)),s+1<u&&r.push(","+te);r.push(")")}return w(r,q.New,t)},MemberExpression:function(e,t,n){var r,i;return r=[this.generateExpression(e.object,q.Call,2&n?3:1)],e.computed?(r.push("["),r.push(this.generateExpression(e.property,q.Sequence,2&n?de:5)),r.push("]")):(e.object.type===V.Literal&&"number"==typeof e.object.value&&(i=D(r).toString()).indexOf(".")<0&&!/[eExX]/.test(i)&&X.code.isDecimalDigit(i.charCodeAt(i.length-1))&&!(i.length>=2&&48===i.charCodeAt(0))&&r.push("."),r.push("."),r.push(N(e.property))),w(r,q.Member,t)},MetaProperty:function(e,t,n){var r,i,s;return i=e.meta&&"string"==typeof e.meta.type&&e.meta.type===V.Identifier?e.meta.name:e.meta,s=e.property&&"string"==typeof e.property.type&&e.property.type===V.Identifier?e.property.name:e.property,r=[i,".",s],w(r,q.Member,t)},UnaryExpression:function(e,t,n){var r,i,s,u,a;return i=this.generateExpression(e.argument,q.Unary,de),""===te?r=E(e.operator,i):(r=[e.operator],e.operator.length>2?r=E(r,i):(a=(u=D(r).toString()).charCodeAt(u.length-1),s=i.toString().charCodeAt(0),(43===a||45===a)&&a===s||X.code.isIdentifierPartES5(a)&&X.code.isIdentifierPartES5(s)?(r.push(x()),r.push(i)):r.push(i))),w(r,q.Unary,t)},YieldExpression:function(e,t,n){var r;return r=e.delegate?"yield*":"yield",e.argument&&(r=E(r,this.generateExpression(e.argument,q.Yield,de))),w(r,q.Yield,t)},AwaitExpression:function(e,t,n){return w(E(e.all?"await*":"await",this.generateExpression(e.argument,q.Await,de)),q.Await,t)},UpdateExpression:function(e,t,n){return e.prefix?w([e.operator,this.generateExpression(e.argument,q.Unary,de)],q.Unary,t):w([this.generateExpression(e.argument,q.Postfix,de),e.operator],q.Postfix,t)},FunctionExpression:function(e,t,n){var r=[L(e,!0),"function"];return e.id?(r.push(j(e)||x()),r.push(N(e.id))):r.push(j(e)||te),r.push(this.generateFunctionBody(e)),r},ArrayPattern:function(e,t,n){return this.ArrayExpression(e,t,n,!0)},ArrayExpression:function(e,t,n,r){var i,s,u=this;return e.elements.length?(s=!r&&e.elements.length>1,i=["[",s?ee:""],C(function(t){var n,r;for(n=0,r=e.elements.length;n<r;++n)e.elements[n]?(i.push(s?t:""),i.push(u.generateExpression(e.elements[n],q.Assignment,768|de))):(s&&i.push(t),n+1===r&&i.push(",")),n+1<r&&i.push(","+(s?ee:te))}),s&&!c(D(i).toString())&&i.push(ee),i.push(s?G:""),i.push("]"),i):"[]"},ClassExpression:function(e,t,n){var r;return r=["class"],e.id&&(r=E(r,this.generateExpression(e.id,q.Sequence,de))),e.superClass&&(r=E(r,E("extends",this.generateExpression(e.superClass,q.Assignment,de)))),r.push(te),r.push(this.generateStatement(e.body,33)),r},MethodDefinition:function(e,t,n){var r,i;return r=e.static?["static"+te]:[],i="get"===e.kind||"set"===e.kind?[E(e.kind,this.generatePropertyKey(e.key,e.computed)),this.generateFunctionBody(e.value)]:[O(e),this.generatePropertyKey(e.key,e.computed),this.generateFunctionBody(e.value)],E(r,i)},Property:function(e,t,n){return"get"===e.kind||"set"===e.kind?[e.kind,x(),this.generatePropertyKey(e.key,e.computed),this.generateFunctionBody(e.value)]:"init"===e.kind&&!e.method&&e.shorthand?this.generatePattern(e.value,q.Assignment,de):e.shorthand?this.generatePropertyKey(e.key,e.computed):e.method?[O(e),this.generatePropertyKey(e.key,e.computed),this.generateFunctionBody(e.value)]:[this.generatePropertyKey(e.key,e.computed),":"+te,this.generateExpression(e.value,q.Assignment,de)]},ObjectExpression:function(e,t,n){var r,i,s,u=this;return e.properties.length?(r=e.properties.length>1,C(function(){s=u.generateExpression(e.properties[0],q.Sequence,de)}),r||o(D(s).toString())?(C(function(t){var n,a;if(i=["{",ee,t,s],r)for(i.push(","+ee),n=1,a=e.properties.length;n<a;++n)i.push(t),i.push(u.generateExpression(e.properties[n],q.Sequence,de)),n+1<a&&i.push(","+ee)}),c(D(i).toString())||i.push(ee),i.push(G),i.push("}"),i):["{",te,s,te,"}"]):"{}"},AssignmentPattern:function(e,t,n){return this.generateAssignment(e.left,e.right,"=",t,n)},ObjectPattern:function(e,t,n){var r,i,s,u,a,o=this;if(!e.properties.length)return"{}";if(u=!1,1===e.properties.length)(a=e.properties[0]).value&&a.value.type!==V.Identifier&&(u=!0);else for(i=0,s=e.properties.length;i<s;++i)if(!(a=e.properties[i]).shorthand){u=!0;break}return r=["{",u?ee:""],C(function(t){var n,i;for(n=0,i=e.properties.length;n<i;++n)r.push(u?t:""),r.push(o.generateExpression(e.properties[n],q.Sequence,de)),n+1<i&&r.push(","+(u?ee:te))}),u&&!c(D(r).toString())&&r.push(ee),r.push(u?G:""),r.push("}"),r},ThisExpression:function(e,t,n){return"this"},Super:function(e,t,n){return"super"},Identifier:function(e,t,n){return N(e)},Import:function(e,t,n){return"import"},ImportDefaultSpecifier:function(e,t,n){return N(e.id||e.local)},ImportNamespaceSpecifier:function(e,t,n){var r=["*"],i=e.id||e.local;return i&&r.push(te+"as"+x()+N(i)),r},ImportSpecifier:function(e,t,n){var r=e.imported,i=[r.name],s=e.local;return s&&s.name!==r.name&&i.push(x()+"as"+x()+N(s)),i},ExportSpecifier:function(e,t,n){var r=e.local,i=[r.name],s=e.exported;return s&&s.name!==r.name&&i.push(x()+"as"+x()+N(s)),i},Literal:function(e,t,n){var r;if(e.hasOwnProperty("raw")&&ae&&ue.raw)try{if((r=ae(e.raw).body[0].expression).type===V.Literal&&r.value===e.value)return e.raw}catch(e){}return null===e.value?"null":"string"==typeof e.value?v(e.value):"number"==typeof e.value?h(e.value):"boolean"==typeof e.value?e.value?"true":"false":f(e.value)},GeneratorExpression:function(e,t,n){return this.ComprehensionExpression(e,t,n)},ComprehensionExpression:function(e,t,n){var r,i,s,u,a=this;return r=e.type===V.GeneratorExpression?["("]:["["],ue.moz.comprehensionExpressionStartsWithAssignment&&(u=this.generateExpression(e.body,q.Assignment,de),r.push(u)),e.blocks&&C(function(){for(i=0,s=e.blocks.length;i<s;++i)u=a.generateExpression(e.blocks[i],q.Sequence,de),i>0||ue.moz.comprehensionExpressionStartsWithAssignment?r=E(r,u):r.push(u)}),e.filter&&(r=E(r,"if"+te),u=this.generateExpression(e.filter,q.Sequence,de),r=E(r,["(",u,")"])),ue.moz.comprehensionExpressionStartsWithAssignment||(u=this.generateExpression(e.body,q.Assignment,de),r=E(r,u)),r.push(e.type===V.GeneratorExpression?")":"]"),r},ComprehensionBlock:function(e,t,n){var r;return r=e.left.type===V.VariableDeclaration?[e.left.kind,x(),this.generateStatement(e.left.declarations[0],0)]:this.generateExpression(e.left,q.Call,de),r=E(r,e.of?"of":"in"),r=E(r,this.generateExpression(e.right,q.Sequence,de)),["for"+te+"(",r,")"]},SpreadElement:function(e,t,n){return["...",this.generateExpression(e.argument,q.Assignment,de)]},RestElement:function(e,t,n){return["...",this.generatePattern(e.argument,q.Assignment,de)]},SpreadProperty:function(e,t,n){return["...",this.generateExpression(e.argument,q.Assignment,de)]},RestProperty:function(e,t,n){return["...",this.generatePattern(e.argument,q.Assignment,de)]},TaggedTemplateExpression:function(e,t,n){var r=3;return 2&n||(r=1),w([this.generateExpression(e.tag,q.Call,r),this.generateExpression(e.quasi,q.Primary,4)],q.TaggedTemplate,t)},TemplateElement:function(e,t,n){return e.value.raw},TemplateLiteral:function(e,t,n){var r,i,s;for(r=["`"],i=0,s=e.quasis.length;i<s;++i)r.push(this.generateExpression(e.quasis[i],q.Primary,de)),i+1<s&&(r.push("${"+te),r.push(this.generateExpression(e.expressions[i],q.Sequence,de)),r.push(te+"}"));return r.push("`"),r},ModuleSpecifier:function(e,t,n){return this.Literal(e,t,n)},JSXText:function(e,t,n){return e.hasOwnProperty("raw")?e.raw:String(e.value)},JSXAttribute:function(e,t,n){var r=[],i=this.generateExpression(e.name,q.Sequence,{allowIn:!0,allowCall:!0});return r.push(i),e.value&&(r.push("="),i=e.value.type===V.Literal?R(e.value.value,e.value.raw):this.generateExpression(e.value,q.Sequence,{allowIn:!0,allowCall:!0}),r.push(i)),r},JSXClosingElement:function(e,t,n){return["</",this.generateExpression(e.name,q.Sequence,0),">"]},JSXElement:function(e,t,n){var r=[],i=this;256&n||(G+=$);var s=this.generateExpression(e.openingElement,q.JSXElement,{allowIn:!0,allowCall:!0});r.push(s);var u,a,c=[];return C(function(t){for(u=0,a=e.children.length;u<a;++u)e.children[u].type!==V.Literal?(s=i.generateExpression(e.children[u],q.JSXElement,259),c.push(s)):(s=e.children[u].raw)&&c.push(s);for(u=0,a=c.length;u<a;++u)r.push(c[u])}),e.closingElement&&(s=i.generateExpression(e.closingElement,q.JSXElement,0),r.push(s)),256&n||(G=G.slice(0,G.length-$.length),o(D(r).toString())&&(r=512&n?[ee+G+$,r]:["("+ee+G+$,r,ee+G+")"])),r},JSXExpressionContainer:function(e,t,n){return["{",this.generateExpression(e.expression,q.Sequence,3),"}"]},JSXIdentifier:function(e,t,n){return e.name},JSXMemberExpression:function(e,t,n){return[this.generateExpression(e.object,q.Sequence,1),".",this.generateExpression(e.property,q.Sequence,0)]},JSXNamespacedName:function(e,t,n){return[this.generateExpression(e.namespace,q.Sequence,0),":",this.generateExpression(e.name,q.Sequence,0)]},JSXOpeningElement:function(e,t,n){var r=["<"],i=this,s=this.generateExpression(e.name,q.Sequence,0);r.push(s);for(var u=[],a=0,c=e.attributes.length;a<c;++a)s=i.generateExpression(e.attributes[a],q.Sequence,3),u.push({expr:e.attributes[a],name:e.attributes[a].name&&e.attributes[a].name.name,fragment:s,multiline:o(D(s).toString())}),e.attributes.length>3&&e.attributes[a].value&&e.attributes[a].value.type!==V.Literal&&(u[u.length-1].multiline=!0);return C(function(e){for(var t=0,n=u.length;t<n;++t)t>0&&t%3==0||u[t].multiline?r.push(ee+e):r.push(" "),r.push(i.generateExpression(u[t].expr,q.Sequence,3))}),r.push(e.selfClosing?"/>":">"),r},JSXSpreadAttribute:function(e,t,n){return["{...",this.generateExpression(e.argument,q.Sequence,{allowIn:!0,allowCall:!0}),"}"]}},p(P.prototype,P.Expression),P.prototype.generateExpression=function(e,t,n){var r,i;return i=e.type||V.Property,ue.verbatim&&e.hasOwnProperty(ue.verbatim)?I(e,t):(r=this[i](e,t,n),ue.comment&&(r=B(e,r)),D(r,e))},P.prototype.generateStatement=function(e,t){var n,r;return n=this[e.type](e,t),ue.comment&&(n=B(e,n)),r=D(n).toString(),e.type!==V.Program||ie||""!==ee||"\n"!==r.charAt(r.length-1)||(n=oe?D(n).replaceRight(/\s+$/,""):r.replace(/\s+$/,"")),D(n,e)},le={indent:{style:"",base:0},renumber:!0,hexadecimal:!0,quotes:"auto",escapeless:!0,compact:!0,parentheses:!1,semicolons:!1},he=u().format,t.version=r("/package.json",e).version,t.generate=function(i,s){var o,c,p=u();return null!=s?("string"==typeof s.indent&&(p.format.indent.style=s.indent),"number"==typeof s.base&&(p.format.indent.base=s.base),s=l(p,s),$=s.format.indent.style,G="string"==typeof s.base?s.base:a($,s.format.indent.base)):($=(s=p).format.indent.style,G=a($,s.format.indent.base)),Y=s.format.json,H=s.format.renumber,K=!Y&&s.format.hexadecimal,Q=Y?"double":s.format.quotes,Z=s.format.escapeless,ee=s.format.newline,te=s.format.space,s.format.compact&&(ee=te=$=G=""),ne=s.format.parentheses,re=s.format.semicolons,ie=s.format.safeConcatenation,se=s.directive,ae=Y?null:s.parse,oe=s.sourceMap,ce=s.sourceCode,pe=s.format.preserveBlankLines&&null!==ce,ue=s,oe&&(U=t.browser?n.sourceMap.SourceNode:r("/node_modules/source-map/lib/source-map.js",e).SourceNode),o=M(i),oe?(c=o.toStringWithSourceMap({file:s.file,sourceRoot:s.sourceMapRoot}),s.sourceContent&&c.map.setSourceContent(s.sourceMap,s.sourceContent),s.sourceMapWithCode?c:c.map.toString()):(c={code:o.toString(),map:null},s.sourceMapWithCode?c:c.code)},t.attachComments=J.attachComments,t.Precedence=l({},q),t.browser=!1,t.FORMAT_MINIFY=le,t.FORMAT_DEFAULTS=he}()}),r.define("/package.json",function(e,t,n,r){e.exports={name:"escodegen-wallaby",description:"ECMAScript code generator with JSX support",homepage:"http://github.com/wallabyjs/escodegen",main:"escodegen.js",bin:{esgenerate:"./bin/esgenerate.js",escodegen:"./bin/escodegen.js"},files:["LICENSE.BSD","LICENSE.source-map","README.md","bin","escodegen.js","package.json"],version:"1.6.12",engines:{node:">=0.10.0"},maintainers:[{name:"Artem Govorov",email:"artem.govorov@gmail.com",web:"http://dm.gl"}],repository:{type:"git",url:"http://github.com/wallabyjs/escodegen.git"},dependencies:{estraverse:"^1.9.1",esutils:"^2.0.2",esprima:"^2.7.1",optionator:"^0.8.1"},optionalDependencies:{"source-map":"~0.2.0"},devDependencies:{acorn:"^2.7.0","acorn-babel":"^0.11.1-38",bluebird:"^2.3.11","bower-registry-client":"^0.2.1",chai:"^1.10.0","commonjs-everywhere":"^0.9.7",gulp:"^3.8.10","gulp-eslint":"^0.2.0","gulp-mocha":"^2.0.0",semver:"^5.1.0"},licenses:[{type:"BSD",url:"http://github.com/wallabyjs/escodegen/raw/master/LICENSE.BSD"}],scripts:{test:"gulp travis","unit-test":"gulp test",lint:"gulp lint",release:"node tools/release.js","build-min":"./node_modules/.bin/cjsify -ma path: tools/entry-point.js > escodegen.browser.min.js",build:"./node_modules/.bin/cjsify -a path: tools/entry-point.js > escodegen.browser.js"}}}),r.define("/node_modules/source-map/lib/source-map.js",function(e,t,n,i){t.SourceMapGenerator=r("/node_modules/source-map/lib/source-map/source-map-generator.js",e).SourceMapGenerator,t.SourceMapConsumer=r("/node_modules/source-map/lib/source-map/source-map-consumer.js",e).SourceMapConsumer,t.SourceNode=r("/node_modules/source-map/lib/source-map/source-node.js",e).SourceNode}),r.define("/node_modules/source-map/lib/source-map/source-node.js",function(e,t,n,i){if("function"!=typeof s)var s=r("/node_modules/amdefine/amdefine.js",e)(e,r);s(function(e,t,n){function r(e,t,n,r,i){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==n?null:n,this.name=null==i?null:i,this[a]=!0,null!=r&&this.add(r)}var i=e("/node_modules/source-map/lib/source-map/source-map-generator.js",n).SourceMapGenerator,s=e("/node_modules/source-map/lib/source-map/util.js",n),u=/(\r?\n)/,a="$$$isSourceNode$$$";r.fromStringWithSourceMap=function(e,t,n){function i(e,t){if(null===e||void 0===e.source)a.add(t);else{var i=n?s.join(n,e.source):e.source;a.add(new r(e.originalLine,e.originalColumn,i,t,e.name))}}var a=new r,o=e.split(u),c=function(){return o.shift()+(o.shift()||"")},p=1,l=0,h=null;return t.eachMapping(function(e){if(null!==h){if(!(p<e.generatedLine)){t=(n=o[0]).substr(0,e.generatedColumn-l);return o[0]=n.substr(e.generatedColumn-l),l=e.generatedColumn,i(h,t),void(h=e)}var t="";i(h,c()),p++,l=0}for(;p<e.generatedLine;)a.add(c()),p++;if(l<e.generatedColumn){var n=o[0];a.add(n.substr(0,e.generatedColumn)),o[0]=n.substr(e.generatedColumn),l=e.generatedColumn}h=e},this),o.length>0&&(h&&i(h,c()),a.add(o.join(""))),t.sources.forEach(function(e){var r=t.sourceContentFor(e);null!=r&&(null!=n&&(e=s.join(n,e)),a.setSourceContent(e,r))}),a},r.prototype.add=function(e){if(Array.isArray(e))e.forEach(function(e){this.add(e)},this);else{if(!e[a]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this},r.prototype.prepend=function(e){if(Array.isArray(e))for(var t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[a]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this},r.prototype.walk=function(e){for(var t,n=0,r=this.children.length;n<r;n++)(t=this.children[n])[a]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})},r.prototype.join=function(e){var t,n,r=this.children.length;if(r>0){for(t=[],n=0;n<r-1;n++)t.push(this.children[n]),t.push(e);t.push(this.children[n]),this.children=t}return this},r.prototype.replaceRight=function(e,t){var n=this.children[this.children.length-1];return n[a]?n.replaceRight(e,t):"string"==typeof n?this.children[this.children.length-1]=n.replace(e,t):this.children.push("".replace(e,t)),this},r.prototype.setSourceContent=function(e,t){this.sourceContents[s.toSetString(e)]=t},r.prototype.walkSourceContents=function(e){for(var t=0,n=this.children.length;t<n;t++)this.children[t][a]&&this.children[t].walkSourceContents(e);for(var r=Object.keys(this.sourceContents),t=0,n=r.length;t<n;t++)e(s.fromSetString(r[t]),this.sourceContents[r[t]])},r.prototype.toString=function(){var e="";return this.walk(function(t){e+=t}),e},r.prototype.toStringWithSourceMap=function(e){var t={code:"",line:1,column:0},n=new i(e),r=!1,s=null,u=null,a=null,o=null;return this.walk(function(e,i){t.code+=e,null!==i.source&&null!==i.line&&null!==i.column?(s===i.source&&u===i.line&&a===i.column&&o===i.name||n.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:t.line,column:t.column},name:i.name}),s=i.source,u=i.line,a=i.column,o=i.name,r=!0):r&&(n.addMapping({generated:{line:t.line,column:t.column}}),s=null,r=!1);for(var c=0,p=e.length;c<p;c++)10===e.charCodeAt(c)?(t.line++,t.column=0,c+1===p?(s=null,r=!1):r&&n.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:t.line,column:t.column},name:i.name})):t.column++}),this.walkSourceContents(function(e,t){n.setSourceContent(e,t)}),{code:t.code,map:n}},t.SourceNode=r})}),r.define("/node_modules/source-map/lib/source-map/util.js",function(e,t,n,i){if("function"!=typeof s)var s=r("/node_modules/amdefine/amdefine.js",e)(e,r);s(function(e,t,n){function r(e){var t=e.match(a);return t?{scheme:t[1],auth:t[2],host:t[3],port:t[4],path:t[5]}:null}function i(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function s(e){var t=e,n=r(e);if(n){if(!n.path)return e;t=n.path}for(var s,u="/"===t.charAt(0),a=t.split(/\/+/),o=0,c=a.length-1;c>=0;c--)"."===(s=a[c])?a.splice(c,1):".."===s?o++:o>0&&(""===s?(a.splice(c+1,o),o=0):(a.splice(c,2),o--));return""===(t=a.join("/"))&&(t=u?"/":"."),n?(n.path=t,i(n)):t}function u(e,t){var n=e||"",r=t||"";return(n>r)-(n<r)}t.getArg=function(e,t,n){if(t in e)return e[t];if(3===arguments.length)return n;throw new Error('"'+t+'" is a required argument.')};var a=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/,o=/^data:.+\,.+$/;t.urlParse=r,t.urlGenerate=i,t.normalize=s,t.join=function(e,t){""===e&&(e="."),""===t&&(t=".");var n=r(t),u=r(e);if(u&&(e=u.path||"/"),n&&!n.scheme)return u&&(n.scheme=u.scheme),i(n);if(n||t.match(o))return t;if(u&&!u.host&&!u.path)return u.host=t,i(u);var a="/"===t.charAt(0)?t:s(e.replace(/\/+$/,"")+"/"+t);return u?(u.path=a,i(u)):a},t.relative=function(e,t){""===e&&(e=".");var n=r(e=e.replace(/\/$/,""));return"/"==t.charAt(0)&&n&&"/"==n.path?t.slice(1):0===t.indexOf(e+"/")?t.substr(e.length+1):t},t.toSetString=function(e){return"$"+e},t.fromSetString=function(e){return e.substr(1)},t.compareByOriginalPositions=function(e,t,n){var r;return(r=u(e.source,t.source))?r:(r=e.originalLine-t.originalLine)?r:(r=e.originalColumn-t.originalColumn)||n?r:(r=u(e.name,t.name))?r:(r=e.generatedLine-t.generatedLine)||e.generatedColumn-t.generatedColumn},t.compareByGeneratedPositions=function(e,t,n){var r;return(r=e.generatedLine-t.generatedLine)?r:(r=e.generatedColumn-t.generatedColumn)||n?r:(r=u(e.source,t.source))?r:(r=e.originalLine-t.originalLine)?r:(r=e.originalColumn-t.originalColumn)||u(e.name,t.name)}})}),r.define("/node_modules/amdefine/amdefine.js",function(e,t,n,s){"use strict";e.exports=function(e,t){function n(e){var t,n;for(t=0;e[t];t+=1)if("."===(n=e[t]))e.splice(t,1),t-=1;else if(".."===n){if(1===t&&(".."===e[2]||".."===e[0]))break;t>0&&(e.splice(t-1,2),t-=2)}}function u(e,t){var r;return e&&"."===e.charAt(0)&&t&&(n(r=(r=(r=t.split("/")).slice(0,r.length-1)).concat(e.split("/"))),e=r.join("/")),e}function a(e){return function(t){return u(t,e)}}function o(e){function t(t){f[e]=t}return t.fromText=function(e,t){throw new Error("amdefine does not implement load.fromText")},t}function c(n,r,i){var u,a,o,c;if(n)a=f[n]={},u=l(t,a,o={id:n,uri:s,exports:a},n);else{if(m)throw new Error("amdefine with no module ID cannot be called more than once per file.");m=!0,a=e.exports,u=l(t,a,o=e,e.id)}r&&(r=r.map(function(e){return u(e)})),void 0!==(c="function"==typeof i?i.apply(o.exports,r):i)&&(o.exports=c,n&&(f[n]=o.exports))}function p(e,t,n){Array.isArray(e)?(n=t,t=e,e=void 0):"string"!=typeof e&&(n=e,e=t=void 0),t&&!Array.isArray(t)&&(n=t,t=void 0),t||(t=["require","exports","module"]),e?d[e]=[e,t,n]:c(e,t,n)}var l,h,d={},f={},m=!1,y=r("path",e);return l=function(e,t,n,r){function s(s,u){if("string"==typeof s)return h(e,t,n,s,r);s=s.map(function(i){return h(e,t,n,i,r)}),u&&i.nextTick(function(){u.apply(null,s)})}return s.toUrl=function(e){return 0===e.indexOf(".")?u(e,y.dirname(n.filename)):e},s},t=t||function(){return e.require.apply(e,arguments)},h=function(e,t,n,r,i){var s,p,m=r.indexOf("!"),y=r;if(-1===m){if("require"===(r=u(r,i)))return l(e,t,n,i);if("exports"===r)return t;if("module"===r)return n;if(f.hasOwnProperty(r))return f[r];if(d[r])return c.apply(null,d[r]),f[r];if(e)return e(y);throw new Error("No module with ID: "+r)}return s=r.substring(0,m),r=r.substring(m+1,r.length),p=h(e,t,n,s,i),r=p.normalize?p.normalize(r,a(i)):u(r,i),f[r]?f[r]:(p.load(r,l(e,t,n,i),o(r),{}),f[r])},p.require=function(e){return f[e]?f[e]:d[e]?(c.apply(null,d[e]),f[e]):void 0},p.amd={},p}}),r.define("/node_modules/source-map/lib/source-map/source-map-generator.js",function(e,t,n,i){if("function"!=typeof s)var s=r("/node_modules/amdefine/amdefine.js",e)(e,r);s(function(e,t,n){function r(e){e||(e={}),this._file=s.getArg(e,"file",null),this._sourceRoot=s.getArg(e,"sourceRoot",null),this._skipValidation=s.getArg(e,"skipValidation",!1),this._sources=new u,this._names=new u,this._mappings=new a,this._sourcesContents=null}var i=e("/node_modules/source-map/lib/source-map/base64-vlq.js",n),s=e("/node_modules/source-map/lib/source-map/util.js",n),u=e("/node_modules/source-map/lib/source-map/array-set.js",n).ArraySet,a=e("/node_modules/source-map/lib/source-map/mapping-list.js",n).MappingList;r.prototype._version=3,r.fromSourceMap=function(e){var t=e.sourceRoot,n=new r({file:e.file,sourceRoot:t});return e.eachMapping(function(e){var r={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(r.source=e.source,null!=t&&(r.source=s.relative(t,r.source)),r.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(r.name=e.name)),n.addMapping(r)}),e.sources.forEach(function(t){var r=e.sourceContentFor(t);null!=r&&n.setSourceContent(t,r)}),n},r.prototype.addMapping=function(e){var t=s.getArg(e,"generated"),n=s.getArg(e,"original",null),r=s.getArg(e,"source",null),i=s.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,n,r,i),null==r||this._sources.has(r)||this._sources.add(r),null==i||this._names.has(i)||this._names.add(i),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:null!=n&&n.line,originalColumn:null!=n&&n.column,source:r,name:i})},r.prototype.setSourceContent=function(e,t){var n=e;null!=this._sourceRoot&&(n=s.relative(this._sourceRoot,n)),null!=t?(this._sourcesContents||(this._sourcesContents={}),this._sourcesContents[s.toSetString(n)]=t):this._sourcesContents&&(delete this._sourcesContents[s.toSetString(n)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},r.prototype.applySourceMap=function(e,t,n){var r=t;if(null==t){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');r=e.file}var i=this._sourceRoot;null!=i&&(r=s.relative(i,r));var a=new u,o=new u;this._mappings.unsortedForEach(function(t){if(t.source===r&&null!=t.originalLine){var u=e.originalPositionFor({line:t.originalLine,column:t.originalColumn});null!=u.source&&(t.source=u.source,null!=n&&(t.source=s.join(n,t.source)),null!=i&&(t.source=s.relative(i,t.source)),t.originalLine=u.line,t.originalColumn=u.column,null!=u.name&&(t.name=u.name))}var c=t.source;null==c||a.has(c)||a.add(c);var p=t.name;null==p||o.has(p)||o.add(p)},this),this._sources=a,this._names=o,e.sources.forEach(function(t){var r=e.sourceContentFor(t);null!=r&&(null!=n&&(t=s.join(n,t)),null!=i&&(t=s.relative(i,t)),this.setSourceContent(t,r))},this)},r.prototype._validateMapping=function(e,t,n,r){if((!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0)||t||n||r)&&!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&n))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:n,original:t,name:r}))},r.prototype._serializeMappings=function(){for(var e,t=0,n=1,r=0,u=0,a=0,o=0,c="",p=this._mappings.toArray(),l=0,h=p.length;l<h;l++){if((e=p[l]).generatedLine!==n)for(t=0;e.generatedLine!==n;)c+=";",n++;else if(l>0){if(!s.compareByGeneratedPositions(e,p[l-1]))continue;c+=","}c+=i.encode(e.generatedColumn-t),t=e.generatedColumn,null!=e.source&&(c+=i.encode(this._sources.indexOf(e.source)-o),o=this._sources.indexOf(e.source),c+=i.encode(e.originalLine-1-u),u=e.originalLine-1,c+=i.encode(e.originalColumn-r),r=e.originalColumn,null!=e.name&&(c+=i.encode(this._names.indexOf(e.name)-a),a=this._names.indexOf(e.name)))}return c},r.prototype._generateSourcesContent=function(e,t){return e.map(function(e){if(!this._sourcesContents)return null;null!=t&&(e=s.relative(t,e));var n=s.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,n)?this._sourcesContents[n]:null},this)},r.prototype.toJSON=function(){var e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e},r.prototype.toString=function(){return JSON.stringify(this)},t.SourceMapGenerator=r})}),r.define("/node_modules/source-map/lib/source-map/mapping-list.js",function(e,t,n,i){if("function"!=typeof s)var s=r("/node_modules/amdefine/amdefine.js",e)(e,r);s(function(e,t,n){function r(e,t){var n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,u=t.generatedColumn;return r>n||r==n&&u>=i||s.compareByGeneratedPositions(e,t)<=0}function i(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}var s=e("/node_modules/source-map/lib/source-map/util.js",n);i.prototype.unsortedForEach=function(e,t){this._array.forEach(e,t)},i.prototype.add=function(e){r(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))},i.prototype.toArray=function(){return this._sorted||(this._array.sort(s.compareByGeneratedPositions),this._sorted=!0),this._array},t.MappingList=i})}),r.define("/node_modules/source-map/lib/source-map/array-set.js",function(e,t,n,i){if("function"!=typeof s)var s=r("/node_modules/amdefine/amdefine.js",e)(e,r);s(function(e,t,n){function r(){this._array=[],this._set={}}var i=e("/node_modules/source-map/lib/source-map/util.js",n);r.fromArray=function(e,t){for(var n=new r,i=0,s=e.length;i<s;i++)n.add(e[i],t);return n},r.prototype.add=function(e,t){var n=this.has(e),r=this._array.length;n&&!t||this._array.push(e),n||(this._set[i.toSetString(e)]=r)},r.prototype.has=function(e){return Object.prototype.hasOwnProperty.call(this._set,i.toSetString(e))},r.prototype.indexOf=function(e){if(this.has(e))return this._set[i.toSetString(e)];throw new Error('"'+e+'" is not in the set.')},r.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},r.prototype.toArray=function(){return this._array.slice()},t.ArraySet=r})}),r.define("/node_modules/source-map/lib/source-map/base64-vlq.js",function(e,t,n,i){if("function"!=typeof s)var s=r("/node_modules/amdefine/amdefine.js",e)(e,r);s(function(e,t,n){function r(e){return e<0?1+(-e<<1):0+(e<<1)}function i(e){var t=e>>1;return 1==(1&e)?-t:t}var s=e("/node_modules/source-map/lib/source-map/base64.js",n);t.encode=function(e){var t,n="",i=r(e);do{t=31&i,(i>>>=5)>0&&(t|=32),n+=s.encode(t)}while(i>0);return n},t.decode=function(e,t){var n,r,u=0,a=e.length,o=0,c=0;do{if(u>=a)throw new Error("Expected more digits in base 64 VLQ value.");n=!!(32&(r=s.decode(e.charAt(u++)))),o+=(r&=31)<<c,c+=5}while(n);t.value=i(o),t.rest=e.slice(u)}})}),r.define("/node_modules/source-map/lib/source-map/base64.js",function(e,t,n,i){if("function"!=typeof s)var s=r("/node_modules/amdefine/amdefine.js",e)(e,r);s(function(e,t,n){var r={},i={};"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("").forEach(function(e,t){r[e]=t,i[t]=e}),t.encode=function(e){if(e in i)return i[e];throw new TypeError("Must be between 0 and 63: "+e)},t.decode=function(e){if(e in r)return r[e];throw new TypeError("Not a valid base 64 digit: "+e)}})}),r.define("/node_modules/source-map/lib/source-map/source-map-consumer.js",function(e,t,n,i){if("function"!=typeof s)var s=r("/node_modules/amdefine/amdefine.js",e)(e,r);s(function(e,t,n){function r(t){var r=t;return"string"==typeof t&&(r=JSON.parse(t.replace(/^\)\]\}'/,""))),null!=r.sections?new(e("/node_modules/source-map/lib/source-map/indexed-source-map-consumer.js",n).IndexedSourceMapConsumer)(r):new(e("/node_modules/source-map/lib/source-map/basic-source-map-consumer.js",n).BasicSourceMapConsumer)(r)}var i=e("/node_modules/source-map/lib/source-map/util.js",n);r.fromSourceMap=function(t){return e("/node_modules/source-map/lib/source-map/basic-source-map-consumer.js",n).BasicSourceMapConsumer.fromSourceMap(t)},r.prototype._version=3,r.prototype.__generatedMappings=null,Object.defineProperty(r.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||(this.__generatedMappings=[],this.__originalMappings=[],this._parseMappings(this._mappings,this.sourceRoot)),this.__generatedMappings}}),r.prototype.__originalMappings=null,Object.defineProperty(r.prototype,"_originalMappings",{get:function(){return this.__originalMappings||(this.__generatedMappings=[],this.__originalMappings=[],this._parseMappings(this._mappings,this.sourceRoot)),this.__originalMappings}}),r.prototype._nextCharIsMappingSeparator=function(e){var t=e.charAt(0);return";"===t||","===t},r.prototype._parseMappings=function(e,t){throw new Error("Subclasses must implement _parseMappings")},r.GENERATED_ORDER=1,r.ORIGINAL_ORDER=2,r.prototype.eachMapping=function(e,t,n){var s,u=t||null;switch(n||r.GENERATED_ORDER){case r.GENERATED_ORDER:s=this._generatedMappings;break;case r.ORIGINAL_ORDER:s=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var a=this.sourceRoot;s.map(function(e){var t=e.source;return null!=t&&null!=a&&(t=i.join(a,t)),{source:t,generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:e.name}}).forEach(e,u)},r.prototype.allGeneratedPositionsFor=function(e){var t={source:i.getArg(e,"source"),originalLine:i.getArg(e,"line"),originalColumn:1/0};null!=this.sourceRoot&&(t.source=i.relative(this.sourceRoot,t.source));var n=[],r=this._findMapping(t,this._originalMappings,"originalLine","originalColumn",i.compareByOriginalPositions);if(r>=0)for(var s=this._originalMappings[r];s&&s.originalLine===t.originalLine;)n.push({line:i.getArg(s,"generatedLine",null),column:i.getArg(s,"generatedColumn",null),lastColumn:i.getArg(s,"lastGeneratedColumn",null)}),s=this._originalMappings[--r];return n.reverse()},t.SourceMapConsumer=r})}),r.define("/node_modules/source-map/lib/source-map/basic-source-map-consumer.js",function(e,t,n,i){if("function"!=typeof s)var s=r("/node_modules/amdefine/amdefine.js",e)(e,r);s(function(e,t,n){function r(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var n=i.getArg(t,"version"),r=i.getArg(t,"sources"),s=i.getArg(t,"names",[]),a=i.getArg(t,"sourceRoot",null),o=i.getArg(t,"sourcesContent",null),c=i.getArg(t,"mappings"),p=i.getArg(t,"file",null);if(n!=this._version)throw new Error("Unsupported version: "+n);r=r.map(i.normalize),this._names=u.fromArray(s,!0),this._sources=u.fromArray(r,!0),this.sourceRoot=a,this.sourcesContent=o,this._mappings=c,this.file=p}var i=e("/node_modules/source-map/lib/source-map/util.js",n),s=e("/node_modules/source-map/lib/source-map/binary-search.js",n),u=e("/node_modules/source-map/lib/source-map/array-set.js",n).ArraySet,a=e("/node_modules/source-map/lib/source-map/base64-vlq.js",n),o=e("/node_modules/source-map/lib/source-map/source-map-consumer.js",n).SourceMapConsumer;(r.prototype=Object.create(o.prototype)).consumer=o,r.fromSourceMap=function(e){var t=Object.create(r.prototype);return t._names=u.fromArray(e._names.toArray(),!0),t._sources=u.fromArray(e._sources.toArray(),!0),t.sourceRoot=e._sourceRoot,t.sourcesContent=e._generateSourcesContent(t._sources.toArray(),t.sourceRoot),t.file=e._file,t.__generatedMappings=e._mappings.toArray().slice(),t.__originalMappings=e._mappings.toArray().slice().sort(i.compareByOriginalPositions),t},r.prototype._version=3,Object.defineProperty(r.prototype,"sources",{get:function(){return this._sources.toArray().map(function(e){return null!=this.sourceRoot?i.join(this.sourceRoot,e):e},this)}}),r.prototype._parseMappings=function(e,t){for(var n,r=1,s=0,u=0,o=0,c=0,p=0,l=e,h={};l.length>0;)if(";"===l.charAt(0))r++,l=l.slice(1),s=0;else if(","===l.charAt(0))l=l.slice(1);else{if(n={},n.generatedLine=r,a.decode(l,h),n.generatedColumn=s+h.value,s=n.generatedColumn,(l=h.rest).length>0&&!this._nextCharIsMappingSeparator(l)){if(a.decode(l,h),n.source=this._sources.at(c+h.value),c+=h.value,0===(l=h.rest).length||this._nextCharIsMappingSeparator(l))throw new Error("Found a source, but no line and column");if(a.decode(l,h),n.originalLine=u+h.value,u=n.originalLine,n.originalLine+=1,0===(l=h.rest).length||this._nextCharIsMappingSeparator(l))throw new Error("Found a source and line, but no column");a.decode(l,h),n.originalColumn=o+h.value,o=n.originalColumn,(l=h.rest).length>0&&!this._nextCharIsMappingSeparator(l)&&(a.decode(l,h),n.name=this._names.at(p+h.value),p+=h.value,l=h.rest)}this.__generatedMappings.push(n),"number"==typeof n.originalLine&&this.__originalMappings.push(n)}this.__generatedMappings.sort(i.compareByGeneratedPositions),this.__originalMappings.sort(i.compareByOriginalPositions)},r.prototype._findMapping=function(e,t,n,r,i){if(e[n]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[n]);if(e[r]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[r]);return s.search(e,t,i)},r.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var n=this._generatedMappings[e+1];if(t.generatedLine===n.generatedLine){t.lastGeneratedColumn=n.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},r.prototype.originalPositionFor=function(e){var t={generatedLine:i.getArg(e,"line"),generatedColumn:i.getArg(e,"column")},n=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",i.compareByGeneratedPositions);if(n>=0){var r=this._generatedMappings[n];if(r.generatedLine===t.generatedLine){var s=i.getArg(r,"source",null);return null!=s&&null!=this.sourceRoot&&(s=i.join(this.sourceRoot,s)),{source:s,line:i.getArg(r,"originalLine",null),column:i.getArg(r,"originalColumn",null),name:i.getArg(r,"name",null)}}}return{source:null,line:null,column:null,name:null}},r.prototype.sourceContentFor=function(e,t){if(!this.sourcesContent)return null;if(null!=this.sourceRoot&&(e=i.relative(this.sourceRoot,e)),this._sources.has(e))return this.sourcesContent[this._sources.indexOf(e)];var n;if(null!=this.sourceRoot&&(n=i.urlParse(this.sourceRoot))){var r=e.replace(/^file:\/\//,"");if("file"==n.scheme&&this._sources.has(r))return this.sourcesContent[this._sources.indexOf(r)];if((!n.path||"/"==n.path)&&this._sources.has("/"+e))return this.sourcesContent[this._sources.indexOf("/"+e)]}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},r.prototype.generatedPositionFor=function(e){var t={source:i.getArg(e,"source"),originalLine:i.getArg(e,"line"),originalColumn:i.getArg(e,"column")};null!=this.sourceRoot&&(t.source=i.relative(this.sourceRoot,t.source));var n=this._findMapping(t,this._originalMappings,"originalLine","originalColumn",i.compareByOriginalPositions);if(n>=0){var r=this._originalMappings[n];return{line:i.getArg(r,"generatedLine",null),column:i.getArg(r,"generatedColumn",null),lastColumn:i.getArg(r,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},t.BasicSourceMapConsumer=r})}),r.define("/node_modules/source-map/lib/source-map/binary-search.js",function(e,t,n,i){if("function"!=typeof s)var s=r("/node_modules/amdefine/amdefine.js",e)(e,r);s(function(e,t,n){function r(e,t,n,i,s){var u=Math.floor((t-e)/2)+e,a=s(n,i[u],!0);return 0===a?u:a>0?t-u>1?r(u,t,n,i,s):u:u-e>1?r(e,u,n,i,s):e<0?-1:e}t.search=function(e,t,n){return 0===t.length?-1:r(-1,t.length,e,t,n)}})}),r.define("/node_modules/source-map/lib/source-map/indexed-source-map-consumer.js",function(e,t,n,i){if("function"!=typeof s)var s=r("/node_modules/amdefine/amdefine.js",e)(e,r);s(function(e,t,n){function r(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var n=i.getArg(t,"version"),r=i.getArg(t,"sections");if(n!=this._version)throw new Error("Unsupported version: "+n);var s={line:-1,column:0};this._sections=r.map(function(e){if(e.url)throw new Error("Support for url field in sections not implemented.");var t=i.getArg(e,"offset"),n=i.getArg(t,"line"),r=i.getArg(t,"column");if(n<s.line||n===s.line&&r<s.column)throw new Error("Section offsets must be ordered and non-overlapping.");return s=t,{generatedOffset:{generatedLine:n+1,generatedColumn:r+1},consumer:new u(i.getArg(e,"map"))}})}var i=e("/node_modules/source-map/lib/source-map/util.js",n),s=e("/node_modules/source-map/lib/source-map/binary-search.js",n),u=e("/node_modules/source-map/lib/source-map/source-map-consumer.js",n).SourceMapConsumer;e("/node_modules/source-map/lib/source-map/basic-source-map-consumer.js",n).BasicSourceMapConsumer;(r.prototype=Object.create(u.prototype)).constructor=u,r.prototype._version=3,Object.defineProperty(r.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var n=0;n<this._sections[t].consumer.sources.length;n++)e.push(this._sections[t].consumer.sources[n]);return e}}),r.prototype.originalPositionFor=function(e){var t={generatedLine:i.getArg(e,"line"),generatedColumn:i.getArg(e,"column")},n=s.search(t,this._sections,function(e,t){var n=e.generatedLine-t.generatedOffset.generatedLine;return n||e.generatedColumn-t.generatedOffset.generatedColumn}),r=this._sections[n];return r?r.consumer.originalPositionFor({line:t.generatedLine-(r.generatedOffset.generatedLine-1),column:t.generatedColumn-(r.generatedOffset.generatedLine===t.generatedLine?r.generatedOffset.generatedColumn-1:0)}):{source:null,line:null,column:null,name:null}},r.prototype.sourceContentFor=function(e,t){for(var n=0;n<this._sections.length;n++){var r=this._sections[n].consumer.sourceContentFor(e,!0);if(r)return r}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},r.prototype.generatedPositionFor=function(e){for(var t=0;t<this._sections.length;t++){var n=this._sections[t];if(-1!==n.consumer.sources.indexOf(i.getArg(e,"source"))){var r=n.consumer.generatedPositionFor(e);if(r)return{line:r.line+(n.generatedOffset.generatedLine-1),column:r.column+(n.generatedOffset.generatedLine===r.line?n.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},r.prototype._parseMappings=function(e,t){this.__generatedMappings=[],this.__originalMappings=[];for(var n=0;n<this._sections.length;n++)for(var r=this._sections[n],s=r.consumer._generatedMappings,u=0;u<s.length;u++){var a=s[n],o=a.source,c=r.consumer.sourceRoot;null!=o&&null!=c&&(o=i.join(c,o));var p={source:o,generatedLine:a.generatedLine+(r.generatedOffset.generatedLine-1),generatedColumn:a.column+(r.generatedOffset.generatedLine===a.generatedLine)?r.generatedOffset.generatedColumn-1:0,originalLine:a.originalLine,originalColumn:a.originalColumn,name:a.name};this.__generatedMappings.push(p),"number"==typeof p.originalLine&&this.__originalMappings.push(p)}this.__generatedMappings.sort(i.compareByGeneratedPositions),this.__originalMappings.sort(i.compareByOriginalPositions)},t.IndexedSourceMapConsumer=r})}),r.define("/node_modules/esutils/lib/utils.js",function(e,t,n,i){!function(){"use strict";t.ast=r("/node_modules/esutils/lib/ast.js",e),t.code=r("/node_modules/esutils/lib/code.js",e),t.keyword=r("/node_modules/esutils/lib/keyword.js",e)}()}),r.define("/node_modules/esutils/lib/keyword.js",function(e,t,n,i){!function(){"use strict";function t(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"let":return!0;default:return!1}}function n(e,t){return!(!t&&"yield"===e)&&i(e,t)}function i(e,n){if(n&&t(e))return!0;switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}}function s(e,t){return"null"===e||"true"===e||"false"===e||n(e,t)}function u(e,t){return"null"===e||"true"===e||"false"===e||i(e,t)}function a(e){var t,n,r;if(0===e.length)return!1;if(r=e.charCodeAt(0),!p.isIdentifierStartES5(r))return!1;for(t=1,n=e.length;t<n;++t)if(r=e.charCodeAt(t),!p.isIdentifierPartES5(r))return!1;return!0}function o(e,t){return 1024*(e-55296)+(t-56320)+65536}function c(e){var t,n,r,i,s;if(0===e.length)return!1;for(s=p.isIdentifierStartES6,t=0,n=e.length;t<n;++t){if(55296<=(r=e.charCodeAt(t))&&r<=56319){if(++t>=n)return!1;if(!(56320<=(i=e.charCodeAt(t))&&i<=57343))return!1;r=o(r,i)}if(!s(r))return!1;s=p.isIdentifierPartES6}return!0}var p=r("/node_modules/esutils/lib/code.js",e);e.exports={isKeywordES5:n,isKeywordES6:i,isReservedWordES5:s,isReservedWordES6:u,isRestrictedWord:function(e){return"eval"===e||"arguments"===e},isIdentifierNameES5:a,isIdentifierNameES6:c,isIdentifierES5:function(e,t){return a(e)&&!s(e,t)},isIdentifierES6:function(e,t){return c(e)&&!u(e,t)}}}()}),r.define("/node_modules/esutils/lib/code.js",function(e,t,n,r){!function(){"use strict";function t(e){return e<=65535?String.fromCharCode(e):String.fromCharCode(Math.floor((e-65536)/1024)+55296)+String.fromCharCode((e-65536)%1024+56320)}var n,r,i,s,u,a;for(r={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,NonAsciiIdentifierPart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/},n={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDE00-\uDE11\uDE13-\uDE2B\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDE00-\uDE2F\uDE44\uDE80-\uDEAA]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDD0-\uDDDA\uDE00-\uDE11\uDE13-\uDE37\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF01-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/},i=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279],s=new Array(128),a=0;a<128;++a)s[a]=a>=97&&a<=122||a>=65&&a<=90||36===a||95===a;for(u=new Array(128),a=0;a<128;++a)u[a]=a>=97&&a<=122||a>=65&&a<=90||a>=48&&a<=57||36===a||95===a;e.exports={isDecimalDigit:function(e){return 48<=e&&e<=57},isHexDigit:function(e){return 48<=e&&e<=57||97<=e&&e<=102||65<=e&&e<=70},isOctalDigit:function(e){return e>=48&&e<=55},isWhiteSpace:function(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&i.indexOf(e)>=0},isLineTerminator:function(e){return 10===e||13===e||8232===e||8233===e},isIdentifierStartES5:function(e){return e<128?s[e]:r.NonAsciiIdentifierStart.test(t(e))},isIdentifierPartES5:function(e){return e<128?u[e]:r.NonAsciiIdentifierPart.test(t(e))},isIdentifierStartES6:function(e){return e<128?s[e]:n.NonAsciiIdentifierStart.test(t(e))},isIdentifierPartES6:function(e){return e<128?u[e]:n.NonAsciiIdentifierPart.test(t(e))}}}()}),r.define("/node_modules/esutils/lib/ast.js",function(e,t,n,r){!function(){"use strict";function t(e){if(null==e)return!1;switch(e.type){case"BlockStatement":case"BreakStatement":case"ContinueStatement":case"DebuggerStatement":case"DoWhileStatement":case"EmptyStatement":case"ExpressionStatement":case"ForInStatement":case"ForStatement":case"IfStatement":case"LabeledStatement":case"ReturnStatement":case"SwitchStatement":case"ThrowStatement":case"TryStatement":case"VariableDeclaration":case"WhileStatement":case"WithStatement":return!0}return!1}function n(e){switch(e.type){case"IfStatement":return null!=e.alternate?e.alternate:e.consequent;case"LabeledStatement":case"ForStatement":case"ForInStatement":case"WhileStatement":case"WithStatement":return e.body}return null}e.exports={isExpression:function(e){if(null==e)return!1;switch(e.type){case"ArrayExpression":case"AssignmentExpression":case"BinaryExpression":case"CallExpression":case"ConditionalExpression":case"FunctionExpression":case"Identifier":case"Literal":case"LogicalExpression":case"MemberExpression":case"NewExpression":case"ObjectExpression":case"SequenceExpression":case"ThisExpression":case"UnaryExpression":case"UpdateExpression":return!0}return!1},isStatement:t,isIterationStatement:function(e){if(null==e)return!1;switch(e.type){case"DoWhileStatement":case"ForInStatement":case"ForStatement":case"WhileStatement":return!0}return!1},isSourceElement:function(e){return t(e)||null!=e&&"FunctionDeclaration"===e.type},isProblematicIfStatement:function(e){var t;if("IfStatement"!==e.type)return!1;if(null==e.alternate)return!1;t=e.consequent;do{if("IfStatement"===t.type&&null==t.alternate)return!0;t=n(t)}while(t);return!1},trailingStatement:n}}()}),r.define("/node_modules/estraverse/estraverse.js",function(t,n,r,i){!function(t,r){"use strict";"function"==typeof e&&e.amd?e(["exports"],r):r(void 0!==n?n:t.estraverse={})}(this,function e(t){"use strict";function n(){}function r(e){var t,n,i={};for(t in e)e.hasOwnProperty(t)&&(n=e[t],i[t]="object"==typeof n&&null!==n?r(n):n);return i}function i(e,t){var n,r,i,s;for(r=e.length,i=0;r;)t(e[s=i+(n=r>>>1)])?r=n:(i=s+1,r-=n+1);return i}function s(e,t){var n,r,i,s=v(t);for(r=0,i=s.length;r<i;r+=1)e[n=s[r]]=t[n];return e}function u(e,t){this.parent=e,this.key=t}function a(e,t,n,r){this.node=e,this.path=t,this.wrap=n,this.ref=r}function o(){}function c(e){return null!=e&&("object"==typeof e&&"string"==typeof e.type)}function p(e,t){return(e===d.ObjectExpression||e===d.ObjectPattern)&&"properties"===t}function l(e,t){return(new o).traverse(e,t)}function h(e,t){var n;return n=i(t,function(t){return t.range[0]>e.range[0]}),e.extendedRange=[e.range[0],e.range[1]],n!==t.length&&(e.extendedRange[1]=t[n].range[0]),(n-=1)>=0&&(e.extendedRange[0]=t[n].range[1]),e}var d,f,m,y,g,v,A,D,x;return(f=Array.isArray)||(f=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),n(),n(),g=Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}(),v=Object.keys||function(e){var t,n=[];for(t in e)n.push(t);return n},d={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportBatchSpecifier:"ExportBatchSpecifier",ExportDeclaration:"ExportDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",GeneratorExpression:"GeneratorExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MethodDefinition:"MethodDefinition",ModuleSpecifier:"ModuleSpecifier",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"},y={AssignmentExpression:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","defaults","rest","body"],AwaitExpression:["argument"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ClassBody:["body"],ClassDeclaration:["id","body","superClass"],ClassExpression:["id","body","superClass"],ComprehensionBlock:["left","right"],ComprehensionExpression:["blocks","filter","body"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExportBatchSpecifier:[],ExportDeclaration:["declaration","specifiers","source"],ExportSpecifier:["id","name"],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","defaults","rest","body"],FunctionExpression:["id","params","defaults","rest","body"],GeneratorExpression:["blocks","filter","body"],Identifier:[],IfStatement:["test","consequent","alternate"],ImportDeclaration:["specifiers","source"],ImportDefaultSpecifier:["id"],ImportNamespaceSpecifier:["id"],ImportSpecifier:["id","name"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MethodDefinition:["key","value"],ModuleSpecifier:[],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],Program:["body"],Property:["key","value"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SpreadElement:["argument"],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],TaggedTemplateExpression:["tag","quasi"],TemplateElement:[],TemplateLiteral:["quasis","expressions"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handlers","handler","guardedHandlers","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]},A={},D={},x={},m={Break:A,Skip:D,Remove:x},u.prototype.replace=function(e){this.parent[this.key]=e},u.prototype.remove=function(){return f(this.parent)?(this.parent.splice(this.key,1),!0):(this.replace(null),!1)},o.prototype.path=function(){function e(e,t){if(f(t))for(r=0,i=t.length;r<i;++r)e.push(t[r]);else e.push(t)}var t,n,r,i,s;if(!this.__current.path)return null;for(s=[],t=2,n=this.__leavelist.length;t<n;++t)e(s,this.__leavelist[t].path);return e(s,this.__current.path),s},o.prototype.type=function(){return this.current().type||this.__current.wrap},o.prototype.parents=function(){var e,t,n;for(n=[],e=1,t=this.__leavelist.length;e<t;++e)n.push(this.__leavelist[e].node);return n},o.prototype.current=function(){return this.__current.node},o.prototype.__execute=function(e,t){var n,r;return r=void 0,n=this.__current,this.__current=t,this.__state=null,e&&(r=e.call(this,t.node,this.__leavelist[this.__leavelist.length-1].node)),this.__current=n,r},o.prototype.notify=function(e){this.__state=e},o.prototype.skip=function(){this.notify(D)},o.prototype.break=function(){this.notify(A)},o.prototype.remove=function(){this.notify(x)},o.prototype.__initialize=function(e,t){this.visitor=t,this.root=e,this.__worklist=[],this.__leavelist=[],this.__current=null,this.__state=null,this.__fallback="iteration"===t.fallback,this.__keys=y,t.keys&&(this.__keys=s(g(this.__keys),t.keys))},o.prototype.traverse=function(e,t){var n,r,i,s,u,o,l,h,d,m,y,g;for(this.__initialize(e,t),g={},n=this.__worklist,r=this.__leavelist,n.push(new a(e,null,null,null)),r.push(new a(null,null,null,null));n.length;)if((i=n.pop())!==g){if(i.node){if(o=this.__execute(t.enter,i),this.__state===A||o===A)return;if(n.push(g),r.push(i),this.__state===D||o===D)continue;if(s=i.node,u=i.wrap||s.type,!(m=this.__keys[u])){if(!this.__fallback)throw new Error("Unknown node type "+u+".");m=v(s)}for(h=m.length;(h-=1)>=0;)if(l=m[h],y=s[l])if(f(y)){for(d=y.length;(d-=1)>=0;)if(y[d]){if(p(u,m[h]))i=new a(y[d],[l,d],"Property",null);else{if(!c(y[d]))continue;i=new a(y[d],[l,d],null,null)}n.push(i)}}else c(y)&&n.push(new a(y,l,null,null))}}else if(i=r.pop(),o=this.__execute(t.leave,i),this.__state===A||o===A)return},o.prototype.replace=function(e,t){function n(e){var t,n,i,s;if(e.ref.remove())for(n=e.ref.key,s=e.ref.parent,t=r.length;t--;)if((i=r[t]).ref&&i.ref.parent===s){if(i.ref.key<n)break;--i.ref.key}}var r,i,s,o,l,h,d,m,y,g,E,b,C;for(this.__initialize(e,t),E={},r=this.__worklist,i=this.__leavelist,h=new a(e,null,null,new u(b={root:e},"root")),r.push(h),i.push(h);r.length;)if((h=r.pop())!==E){if(void 0!==(l=this.__execute(t.enter,h))&&l!==A&&l!==D&&l!==x&&(h.ref.replace(l),h.node=l),this.__state!==x&&l!==x||(n(h),h.node=null),this.__state===A||l===A)return b.root;if((s=h.node)&&(r.push(E),i.push(h),this.__state!==D&&l!==D)){if(o=h.wrap||s.type,!(y=this.__keys[o])){if(!this.__fallback)throw new Error("Unknown node type "+o+".");y=v(s)}for(d=y.length;(d-=1)>=0;)if(C=y[d],g=s[C])if(f(g)){for(m=g.length;(m-=1)>=0;)if(g[m]){if(p(o,y[d]))h=new a(g[m],[C,m],"Property",new u(g,m));else{if(!c(g[m]))continue;h=new a(g[m],[C,m],null,new u(g,m))}r.push(h)}}else c(g)&&r.push(new a(g,C,null,new u(s,C)))}}else if(h=i.pop(),void 0!==(l=this.__execute(t.leave,h))&&l!==A&&l!==D&&l!==x&&h.ref.replace(l),this.__state!==x&&l!==x||n(h),this.__state===A||l===A)return b.root;return b.root},t.version="1.8.1-dev",t.Syntax=d,t.traverse=l,t.replace=function(e,t){return(new o).replace(e,t)},t.attachComments=function(e,t,n){var i,s,u,a,o=[];if(!e.range)throw new Error("attachComments needs range information");if(!n.length){if(t.length){for(u=0,s=t.length;u<s;u+=1)(i=r(t[u])).extendedRange=[0,e.range[0]],o.push(i);e.leadingComments=o}return e}for(u=0,s=t.length;u<s;u+=1)o.push(h(r(t[u]),n));return a=0,l(e,{enter:function(e){for(var t;a<o.length&&!((t=o[a]).extendedRange[1]>e.range[0]);)t.extendedRange[1]===e.range[0]?(e.leadingComments||(e.leadingComments=[]),e.leadingComments.push(t),o.splice(a,1)):a+=1;return a===o.length?m.Break:o[a].extendedRange[0]>e.range[1]?m.Skip:void 0}}),a=0,l(e,{leave:function(e){for(var t;a<o.length&&(t=o[a],!(e.range[1]<t.extendedRange[0]));)e.range[1]===t.extendedRange[0]?(e.trailingComments||(e.trailingComments=[]),e.trailingComments.push(t),o.splice(a,1)):a+=1;return a===o.length?m.Break:o[a].extendedRange[0]>e.range[1]?m.Skip:void 0}}),e},t.VisitorKeys=y,t.VisitorOption=m,t.Controller=o,t.cloneEnvironment=function(){return e({})},t})}),r("/tools/entry-point.js")}).call(t,t)}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this)}(),function(){this.lively=this.lively||{},function(e,t,n,r){"use strict";function i(){}function s(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={style:"  ",base:0,adjustMultilineComment:!1,optsIndent:n&&n.format&&n.format.indent||{}},i=n&&n.format||{},s=le({indent:r,quotes:"double"},t.obj.dissoc(i,["indent"]));return n=le({format:s,comment:!1},t.obj.dissoc(n,["format"])),xe.generate(e,n)}function u(e,n,r,i){var s=(i=i||{}).traversal||"preorder",u=t.obj.clone(i.visitors?i.visitors:Ee.make(Ee.visitors.withMemberExpression)),a="preorder"===s?function(e,t,i,s,u){return n(i,r,s,t),e(i,s+1,u)}:function(e,t,i,s,u){var a=e(i,s+1,u);return n(i,r,s,t),a};return Object.keys(u).forEach(function(e){var t=u[e];u[e]=function(n,r,i){return a(t,e,n,r,i)}}),Ee.recursive(e,0,null,u),e}function a(e,n,r,i){var s=[];return i=i||Ee.make(Ee.visitors.withMemberExpression),Object.keys(Ee.base).forEach(function(e){var n=i[e];i[e]=function(e,r,i){return t.arr.pushIfNotIncluded(s,e),n(e,r,i)}}),i.Property=function(e,n,r){t.arr.pushIfNotIncluded(s,e),r(e.key,n,"Expression"),r(e.value,n,"Expression")},i.LabeledStatement=function(e,t,n){e.label&&n(e.label,t,"Expression"),n(e.body,t,"Statement")},Ee.findNodeAround(e,n,r,i),s}function o(e){return we(e,{index:0},function(e,t,n){e(),t.astIndex=n.index++}),e}function c(e){if(Array.isArray(e.body))for(var t=e.body.length-1;t>=0;t--){var n=e.body[t];"BlockStatement"===n.type&&n[Se]&&e.body.splice.apply(e.body,[t,1].concat(n.body))}return e}function p(e,t){return"string"==typeof e&&(t=e,e=d(e)),t&&Ce.run(e,function(e,n,r){return!e.source&&(e.source=t.slice(e.start,e.end))}),e}function l(e,t){return t="string"==typeof t?this.parse(t):t,a(t,e)}function h(e,t){(t=t||{}).ecmaVersion=t.ecmaVersion||8,t.sourceType=t.sourceType||"module",t.plugins=t.plugins||{},t.plugins.jsx=!t.plugins.hasOwnProperty("jsx")||t.plugins.jsx,t.plugins.asyncawait=t.plugins.hasOwnProperty("asyncawait")?t.plugins.asyncawait:{inAsyncFunction:!0},t.plugins.objectSpread=!t.plugins.hasOwnProperty("objectSpread")||t.plugins.objectSpread;var n,r,i;"LabeledStatement"===t.type&&(r="$={"+e+"}");try{n=d(r||e,t),r?n=null:t.addSource&&p(n,e)}catch(e){i=e}if(i&&void 0!==i.raisedAt){r&&(i.pos-=3,i.raisedAt-=3,i.loc.column-=3);var s="";s+=e.slice(i.raisedAt-20,i.raisedAt),s+="<-error->",s+=e.slice(i.raisedAt,i.raisedAt+20),t.verbose&&show("parse error: "+s),i.parseErrorSource=s}else i&&t.verbose&&show(""+i+i.stack);return n||(n=be.parse_dammit(e,t),t.addSource&&p(n,e),n.isFuzzy=!0,n.parseError=i),n}function d(e,n){function r(e){return s.forEach(function(n){var r=t.arr.detect(l(n.start,u).reverse(),function(e){return"BlockStatement"===e.type||"Program"===e.type});r||(r=u),r.comments||(r.comments=[]),r.comments.push(n),e.nodesWithComments.push(r)}),e}function i(n){return n.nodesWithComments.forEach(function(r){t.arr.clone(r.comments).reduce(function(i,s){if(s.isBlock)return i.lastComment=null,i;if(!i.lastComment)return i.lastComment=s,i;var u=i.lastComment;if(t.arr.detect(r.body,function(e){return e.start>=u.end&&e.end<=s.start}))return i.lastComment=s,i;var a=e.slice(u.end,s.start);return/[\n\r][\n\r]+/.test(a)?(i.lastComment=s,i):(u.text+="\n"+s.text,u.end=s.end,t.arr.remove(r.comments,s),t.arr.remove(n.comments,s),i)},{lastComment:null})}),n}if(n=n||{},n.ecmaVersion=n.ecmaVersion||8,n.sourceType=n.sourceType||"module",n.hasOwnProperty("allowImportExportEverywhere")||(n.allowImportExportEverywhere=!0),n.plugins=n.plugins||{},n.plugins.jsx=!n.plugins.hasOwnProperty("jsx")||n.plugins.jsx,n.plugins.asyncawait=n.plugins.hasOwnProperty("asyncawait")?n.plugins.asyncawait:{inAsyncFunction:!0},n.plugins.objectSpread=!n.plugins.hasOwnProperty("objectSpread")||n.plugins.objectSpread,n.withComments){delete n.withComments;var s=[];n.onComment=function(e,t,n,r,i,u){s.push({isBlock:e,text:t,node:null,start:n,end:r,line:i,column:u})}}try{var u=acorn.parse(e,n)}catch(t){if("undefined"!=typeof SyntaxError&&t instanceof SyntaxError&&t.loc){var a=e.split("\n"),c=t.message,h=t.loc,d=h.line,f=h.column,m=t.pos,y=a[d-1],g="Syntax error at line "+d+" column "+f+" (index "+m+') "'+c+'"\nsource: '+y.slice(0,f)+"<--SyntaxError--\x3e"+y.slice(f),v=new SyntaxError(g);throw v.loc={line:d,column:f},v.pos=m,v}throw t}return n.addSource&&p(u,e),n.addAstIndex&&!u.hasOwnProperty("astIndex")&&o(u),u&&s&&function(e){e=i(r(e)),u.allComments=e.comments}({ast:u,comments:s,nodesWithComments:[]}),u}function f(e){return Le.test(e)&&-1===e.indexOf("-")}function m(e){return"this"===e?{type:"ThisExpression"}:{name:String(e),type:"Identifier"}}function y(e){return{type:"Literal",value:e}}function g(e){return{type:"ExpressionStatement",expression:e}}function v(e){return{type:"ReturnStatement",argument:e}}function A(e){for(var t=arguments.length,n=Array(t>2?t-2:0),r=2;r<t;r++)n[r-2]=arguments[r];var i=e.arrow,s=e.id,u=e.expression,a=e.generator,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return o=o.map(function(e){return"string"==typeof e?m(e):e}),{type:(i?"Arrow":"")+"FunctionExpression",id:s?"string"==typeof s?m(s):s:void 0,params:o,body:u&&1===n.length?n[0]:{body:n,type:"BlockStatement"},expression:u||!1,generator:a||!1}}function D(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return"string"==typeof e&&(e=m(e)),{type:"CallExpression",callee:e,arguments:n}}function x(e,t,n){return"string"==typeof e&&(e={name:e,type:"Identifier"}),{type:"VariableDeclaration",kind:n||"var",declarations:[{type:"VariableDeclarator",id:e,init:t}]}}function E(e,t,n){return"string"==typeof e&&(e=m(e)),"string"==typeof t?(n||f(t)||(n=!0),t=n?y(t):m(t)):"number"==typeof t?(t=y(t),n=!0):"Literal"===t.type&&(n=!0),{type:"MemberExpression",computed:!!n,object:e,property:t}}function b(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce(function(e,t){return E(e,t)},"object"===(void 0===e?"undefined":oe(e))?e:m(e))}function C(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{body:Array.isArray(t[0])?t[0]:t,type:"BlockStatement"}}function F(){return Object.assign(C.apply(void 0,arguments),{sourceType:"module",type:"Program"})}function S(e,t,n){for(var r=arguments.length,i=Array(r>3?r-3:0),s=3;s<r;s++)i[s-3]=arguments[s];return Array.isArray(n)||(i.unshift(n),n=null),{block:C(i),finalizer:n?C(n):null,handler:{body:C(t),param:m(e),type:"CatchClause"},type:"TryStatement"}}function k(e,t){return{type:"Property",key:e,computed:"Identifier"!==e.type,shorthand:!1,value:t}}function B(e){var t=new De,n=t.newScope(e,null);return t.accept(e,n,[]),n}function _(e,n){return t.tree.filter(B(e),function(e){var t=e.node,r=t.start,i=t.end;return"FunctionDeclaration"===t.type&&(r=t.params.length?t.params[0].start:t.body.start,i=t.body.end),r<=n&&n<=i},function(e){return e.subScopes})}function w(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];t&&e.node.id&&e.node.id.name&&n.push(e.node.id),Oe.declIds(e.params,n);for(r=0;r<e.funcDecls.length;r++)(i=e.funcDecls[r].id)&&n.push(i);Oe.varDeclIds(e,n),n.push.apply(n,ge(e.catches));for(var r=0;r<e.classDecls.length;r++){var i=e.classDecls[r].id;i&&n.push(i)}return n.push.apply(n,ge(e.importSpecifiers)),n}function T(e){var t=Oe.declIds(e.params).concat(e.catches),n=(e.node.id&&e.node.id.name?[e.node]:[]).concat(e.funcDecls.filter(function(e){return e.id})).concat(e.classDecls.filter(function(e){return e.id}));return t.map(function(e){return[e,e]}).concat(n.map(function(e){return[e,e.id]})).concat(Oe.varDecls(e)).concat(e.importSpecifiers.map(function(t){return[q(e.node,t),t]}))}function I(e,t){var n=[],r=!0,i=!1,s=void 0;try{for(var u,a=w(e,!0)[Symbol.iterator]();!(r=(u=a.next()).done);r=!0){var o=u.value;n.push(o.name)}}catch(e){i=!0,s=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw s}}return t&&P("Program"===e.node.type?e.node:e.node.body,n),n}function P(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e||!e.comments)return t;var n=!0,r=!1,i=void 0;try{for(var s,u=e.comments[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var a=s.value.text.trim();if(a.startsWith("global")){var o=!0,c=!1,p=void 0;try{for(var l,h=a.replace(Re,"").split(",")[Symbol.iterator]();!(o=(l=h.next()).done);o=!0){var d=l.value;t.push(d.trim())}}catch(e){c=!0,p=e}finally{try{!o&&h.return&&h.return()}finally{if(c)throw p}}}}}catch(e){r=!0,i=e}finally{try{!n&&u.return&&u.return()}finally{if(r)throw i}}return t}function N(e){return Fe.run(e)}function L(e,t){if(0==t.length)return[null,null];var n=ye(t),r=n[0],i=n.slice(1),s=r.decls||T(r);return r.decls=s,s.find(function(t){var n=me(t,2);n[0];return n[1].name==e})||L(e,i)}function j(e){function t(e,r){var i=[e].concat(r);e.refs.forEach(function(e){var t=L(e.name,i),r=me(t,2),s=r[0],u=r[1];n.set(e,{decl:s,declId:u,ref:e})}),e.subScopes.forEach(function(e){return t(e,i)})}if(e.referencesResolvedSafely)return e;var n=e.resolvedRefMap||(e.resolvedRefMap=new Map);return t(e,[]),e.referencesResolvedSafely=!0,e}function O(e,n){function r(e){var t=I(e,s);return e.subScopes.map(r).reduce(function(e,t){return e.concat(t)},e.refs).filter(function(e){return-1===t.indexOf(e.name)})}(n=n||{}).withComments=!0,"string"==typeof e&&(e=d(e,n));var i=B(e),s=!!n.jslintGlobalComment,u=I(i,s),a=i.refs.concat(t.arr.flatten(i.subScopes.map(r))),o=t.arr.withoutAll(a.map(function(e){return e.name}),u);return{scope:i,varDecls:i.varDecls,funcDecls:i.funcDecls.filter(function(e){return e.id}),classDecls:i.classDecls.filter(function(e){return e.id}),declaredNames:u,undeclaredNames:o,refs:a,thisRefs:i.thisRefs}}function M(e,t){var n=[],r=!0,i=!1,s=void 0;try{for(var u,a=e.params[Symbol.iterator]();!(r=(u=a.next()).done);r=!0)(B=u.value).name===t&&n.push(B)}catch(e){i=!0,s=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw s}}var o=!0,c=!1,p=void 0;try{for(var l,h=e.funcDecls[Symbol.iterator]();!(o=(l=h.next()).done);o=!0)(B=l.value).id&&B.id.name===t&&n.push(B.id)}catch(e){c=!0,p=e}finally{try{!o&&h.return&&h.return()}finally{if(c)throw p}}var d=!0,f=!1,m=void 0;try{for(var y,g=e.classDecls[Symbol.iterator]();!(d=(y=g.next()).done);d=!0)(B=y.value).id&&B.id.name===t&&n.push(B.id)}catch(e){f=!0,m=e}finally{try{!d&&g.return&&g.return()}finally{if(f)throw m}}var v=!0,A=!1,D=void 0;try{for(var x,E=e.importSpecifiers[Symbol.iterator]();!(v=(x=E.next()).done);v=!0)(B=x.value).name===t&&n.push(B)}catch(e){A=!0,D=e}finally{try{!v&&E.return&&E.return()}finally{if(A)throw D}}var b=!0,C=!1,F=void 0;try{for(var S,k=Oe.varDeclIds(e)[Symbol.iterator]();!(b=(S=k.next()).done);b=!0){var B=S.value;B.name===t&&n.push(B)}}catch(e){C=!0,F=e}finally{try{!b&&k.return&&k.return()}finally{if(C)throw F}}return n}function R(e,t){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{refs:[],decls:[]};if("this"===t){var s;return(s=i.refs).push.apply(s,ge(e.thisRefs)),i}var u=M(e,t);if(!r&&u.length)return i;var a=!0,o=!1,c=void 0;try{for(var p,l=e.refs[Symbol.iterator]();!(a=(p=l.next()).done);a=!0){var h=p.value;h.name===t&&i.refs.push(h)}}catch(e){o=!0,c=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw c}}(n=i.decls).push.apply(n,ge(u));var d=!0,f=!1,m=void 0;try{for(var y,g=e.subScopes[Symbol.iterator]();!(d=(y=g.next()).done);d=!0)R(y.value,t,!1,i)}catch(e){f=!0,m=e}finally{try{!d&&g.return&&g.return()}finally{if(f)throw m}}return i}function V(e,t){return t="string"==typeof t?d(t):t,acorn.walk.findNodesIncluding(t,e)}function q(e,n,r){var s=V(n.start,e).reverse().find(function(e){return t.arr.include(Ve,e.type)});if(r&&r.asPath){var u=new i,a=void 0;u.accept=t.fun.wrap(u.accept,function(e,t,n,r){if(t===s)throw a=r,new Error("stop search");return e(t,n,r)});try{u.accept(e,{},[])}catch(e){}return a}return s}function W(e){return e.source||s(e)}function U(e,n){var r=t.string.peekLeft(e,n,/\s+$/),i="number"==typeof r?e.slice(r,n):"";return"\n"===i[0]&&(i=i.slice(1)),i}function J(e,n){for(var r=0;r<e.length;r++){var i=e[r];if("del"===i.type)n=n.slice(0,i.pos)+n.slice(i.pos+i.length);else{if("add"!==i.type)throw new Error("Unexpected change "+t.obj.inspect(i));n=n.slice(0,i.pos)+i.string+n.slice(i.pos)}}return n}function X(e,t){if(e.start===t.start&&e.end===t.end)return 0;if(e.end<=t.start)return-1;if(e.start>=t.end)return 1;if(e.start<=t.start&&e.end>=t.end)return 1;if(t.start<=e.start&&t.end>=e.end)return-1;throw new Error("Comparing nodes")}function z(e,n,r){var i="object"===(void 0===r?"undefined":oe(r))?r:{changes:[],source:r},s=!1,u=i.changes.reduce(function(e,n){if(e.end<n.pos)return e;var r=n.pos<e.start;if(s=s||n.pos>=e.start&&n.pos<=e.end,"add"===n.type)return{start:r?e.start+n.string.length:e.start,end:e.end+n.string.length};if("del"===n.type)return{start:r?e.start-n.length:e.start,end:e.end-n.length};throw new Error("Cannot deal with change "+t.obj.inspect(n))},{start:e.start,end:e.end}),a=i.source,o=n(e,a.slice(u.start,u.end),s),c="string"==typeof o?o:Array.isArray(o)?o.map(W).join("\n"+U(a,u.start)):c=W(o),p=[{type:"del",pos:u.start,length:u.end-u.start},{type:"add",pos:u.start,string:c}];return{changes:i.changes.concat(p),source:J(p,a)}}function G(e,t){for(var n=e.sort(function(e,t){return X(e.target,t.target)}),r="object"===(void 0===t?"undefined":oe(t))?t:{changes:[],source:t},i=0;i<n.length;i++){var s=n[i];r=z(s.target,s.replacementFunc,r)}return r}function $(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];t.push.apply(t,ge(e.varDecls));var n=!0,r=!1,i=void 0;try{for(var s,u=e.subScopes[Symbol.iterator]();!(n=(s=u.next()).done);n=!0)$(s.value,t)}catch(e){r=!0,i=e}finally{try{!n&&u.return&&u.return()}finally{if(r)throw i}}return t}function Y(e,n){var r=d(e,n=n||{}),i=t.arr.last(r.body);return"ExpressionStatement"!==i.type?n.asAST?r:e:(r.body.splice(r.body.length-1,1,v(i.expression)),n.asAST?r:s(r))}function H(e,n){function r(e){return t.arr.detect(e.node.body,function(t){return t.start>e.comment.end})}function u(e){return{type:"unknown",comment:e.comment.text}}function a(e){var n=t.Path(e.path.slice(0,-1)).get(D);return n&&"FunctionDeclaration"===n.type}function o(e){var n=t.Path(e.path.slice(0,-1)).get(D);return{name:n.id?n.id.name:"<error: no name for function>",args:t.arr.pluck(n.params,"name")}}function c(e){return t.arr.equals(e.path.slice(-2),["value","body"])}function p(e){return t.arr.equals(e.path.slice(-2),["right","body"])}function l(e){for(var n=t.Path(e.path.slice(0,-2)).get(D),r=n.key?n.key.name:"<error: no name for method>",i=e.path.slice(),s="<error: no object found for method>";i.length&&"init"!==t.arr.last(i);)i.pop();if(i.length&&(s=t.Path(i.slice(0,-1).concat(["id","name"])).get(D)),t.string.startsWith(s,"<error")){for(i=e.path.slice();i.length&&"right"!==t.arr.last(i);)i.pop();if(i.length){var u=t.Path(i.slice(0,-1).concat(["left"])).get(D);s=x.slice(u.start,u.end)}}if(t.string.startsWith(s,"<error")){i=e.path.slice();var a=t.Path(i.slice(0,-6)).get(D),o=a&&"CallExpression"===a.type&&a.arguments[0];o&&(s=x.slice(o.start,o.end))}return{name:r,args:t.arr.pluck(n.value.params,"name"),objectName:s}}function h(e){var n=t.Path(e.path.slice(0,-1)).get(D);if("FunctionExpression"!==n.type&&"FunctionDeclaration"!==n.type)return{};var r=q(D,n);if("ExpressionStatement"!==r.type||"AssignmentExpression"!==r.expression.type)return{};var i=x.slice(r.expression.left.object.start,r.expression.left.object.end);return{name:x.slice(r.expression.left.property.start,r.expression.left.property.end),objectName:i,args:t.arr.pluck(n.params,"name")}}function f(e){var n=e.path.slice(-5);return t.arr.removeAt(n,1),t.arr.equals(n,["properties","value","callee","body"])}function m(e){var n,r,i;i=e.path.slice(0,-3);var s=t.Path(i).get(D);s&&"Property"===s.type&&(r=t.arr.pluck(s.value.callee.params,"name"),n=s.key?s.key.name:"<error: no name for method>"),n||(i=e.path.slice(0,-2),(s=t.Path(i).get(D))&&"Property"===s.type&&(r=t.arr.pluck(s.value.params,"name"),n=s.key?s.key.name:"<error: no name for method>")),n||(n="<error: no name for method>",r=[],i=e.path);for(var u=t.arr.clone(i),a="<error: no object found for method>";u.length&&"init"!==t.arr.last(u);)u.pop();if(u.length&&(a=t.Path(u.slice(0,-1).concat(["id","name"])).get(D)),t.string.startsWith(a,"<error")){for(u=t.arr.clone(i);u.length&&"right"!==t.arr.last(u);)u.pop();if(u.length){var o=t.Path(u.slice(0,-1).concat(["left"])).get(D);a=x.slice(o.start,o.end)}}if(t.string.startsWith(a,"<error")){var u=t.arr.clone(i),c=t.Path(u.slice(0,-4)).get(D),p=c&&"CallExpression"===c.type&&c.arguments[0];p&&(a=x.slice(p.start,p.end))}return{name:n,args:r,objectName:a}}function y(e){return g(e)&&("ObjectExpression"===e.declarations[0].init.type||A(e.declarations[0].init))}function g(e){return e&&"VariableDeclaration"===e.type&&1===e.declarations.length}function v(e){return{name:e.declarations[0].id.name}}function A(e){return"AssignmentExpression"===e.type&&("ObjectExpression"===e.right.type||"AssignmentExpression"===e.right.type&&A(e.right))}var D="string"==typeof e?d(e,{withComments:!0}):e,x=n||("string"==typeof e?e:s(e)),E=t.arr.sortBy(function(e){var n=[],r=new i;return r.accept=t.fun.wrap(r.accept,function(e,r,i,s){return r.comments&&t.arr.pushAll(n,r.comments.map(function(e){return{path:s,comment:e,node:r}})),e(r,i,s)}),r.accept(e,n,[]),n}(D),function(e){return e.comment.start});return E.map(function(e,n){if(c(e))return t.obj.merge([e,e.comment,{type:"method",comment:e.comment.text},l(e)]);if(f(e))return t.obj.merge([e,e.comment,{type:"method",comment:e.comment.text},m(e)]);if(a(e))return t.obj.merge([e,e.comment,{type:"function",comment:e.comment.text},o(e)]);if(p(e))return t.obj.merge([e,e.comment,{type:"method",comment:e.comment.text},h(e)]);var i=r(e);if(!i)return t.obj.merge([e,e.comment,{followingNode:i},u(e)]);var s=E[n+1];return s&&s.comment.start<=i.start?t.obj.merge([e,e.comment,{followingNode:i},u(e)]):y(i)?t.obj.merge([e,e.comment,{followingNode:i},{type:"object",comment:e.comment.text},v(i)]):g(i)?t.obj.merge([e,e.comment,{followingNode:i},{type:"var",comment:e.comment.text},v(i)]):t.obj.merge([e,e.comment,{followingNode:i},u(e)])})}function K(e,n){n=n||t.obj.merge({hideOneLiners:!1},n),"string"==typeof e&&(e=d(e,{addSource:!0}));var r="Program"===e.type?e.body:e.body.body,i=[],s=(n.hideOneLiners&&e.source,!0),u=!1,a=void 0;try{for(var o,c=r[Symbol.iterator]();!(s=(o=c.next()).done);s=!0){var p=o.value,l=re(p=ie(p),n)||ee(p)||te(p)||Q(p)||ne(p);if(l){if(n.hideOneLiners)if(e.loc)l=l.filter(function(e){return!e.node.loc||e.node.loc.start.line!==e.node.loc.end.line});else if(e.source){var h=[],f=!0,m=!1,y=void 0;try{for(var g,v=l[Symbol.iterator]();!(f=(g=v.next()).done);f=!0){var A=g.value;(A.parent&&h.includes(A.parent)||(A.node.source||"").includes("\n"))&&h.push(A)}}catch(e){m=!0,y=e}finally{try{!f&&v.return&&v.return()}finally{if(m)throw y}}l=h}i.push.apply(i,ge(l))}}}catch(e){u=!0,a=e}finally{try{!s&&c.return&&c.return()}finally{if(u)throw a}}return i}function Q(e){var t;if("ClassDeclaration"!==e.type)return null;var n={type:"class-decl",name:e.id.name,node:e,children:[]};return(t=n.children).push.apply(t,ge(e.body.body.map(function(e,t){return Z(e,n,t)}).filter(Boolean))),[n].concat(ge(n.children))}function Z(e,t,n){if("MethodDefinition"!==e.type)return null;var r;return"constructor"===e.kind?r="class-constructor":"method"===e.kind?r=e.static?"class-class-method":"class-instance-method":"get"===e.kind?r=e.static?"class-class-getter":"class-instance-getter":"set"===e.kind&&(r=e.static?"class-class-setter":"class-instance-setter"),r?{type:r,parent:t,node:e,name:e.key.name}:null}function ee(e){if("VariableDeclaration"!==e.type)return null;var t=[],n=!0,r=!1,i=void 0;try{for(var s,u=function(){var e=s.value,n=e.id,r=e.node,i={name:n.name,node:r,type:"var-decl"};if(t.push(i),!i.node.init)return"continue";for(var u=i.node.init;"AssignmentExpression"===u.type;)u=u.right;if("ObjectExpression"===u.type)return i.type="object-decl",i.children=se(u).map(function(e){return le({},e,{type:"object-"+e.type,parent:i})}),t.push.apply(t,ge(i.children)),"continue";(o=ne(u,i))&&(i.children=o.map(function(e){return le({},e,{parent:i})}),t.push.apply(t,ge(i.children)))},a=ae(e)[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var o;u()}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return t}function te(e){return"FunctionStatement"!==e.type&&"FunctionDeclaration"!==e.type?null:e.id?[{name:e.id.name,node:e,type:"function-decl"}]:null}function ne(e,t){if("ExpressionStatement"===e.type&&(e=e.expression),"CallExpression"!==e.type)return null;var n=e.arguments.find(function(e){return"ObjectExpression"===e.type});return n?se(n,t):null}function re(e,n){if(!ue(e))return null;var r,i=t.Path("expression.arguments.0").get(e);r=i&&"FunctionExpression"===i.type&&t.string.lines(i.source||"").length>5?K(i,n):K(t.Path("expression.callee").get(e),n);var s={node:e,name:t.Path("expression.callee.id.name").get(e)};return r.forEach(function(e){return e.parent||(e.parent=s)}),r}function ie(e){return"ExportNamedDeclaration"!==e.type&&"ExportDefaultDeclaration"!==e.type||!e.declaration?e:e.declaration}function se(e,t){return e.properties.map(function(e){return{name:e.key.name||e.key.value,type:"FunctionExpression"===e.value.type?"method":"property",node:e,parent:t}})}function ue(e){return"CallExpression"===t.Path("expression.type").get(e)&&"FunctionExpression"===t.Path("expression.callee.type").get(e)}function ae(e){return e.declarations.map(function(e){return!e.source&&e.init&&(e.source=e.id.name+" = "+e.init.source),{node:e,id:e.id}})}i.prototype.accept=function(e,t,n){if(!e)throw new Error("Undefined AST node in Visitor.accept:\n  "+n.join(".")+"\n  "+e);if(!e.type)throw new Error("Strangee AST node without type in Visitor.accept:\n  "+n.join(".")+"\n  "+JSON.stringify(e));switch(e.type){case"Node":return this.visitNode(e,t,n);case"SourceLocation":return this.visitSourceLocation(e,t,n);case"Position":return this.visitPosition(e,t,n);case"Program":return this.visitProgram(e,t,n);case"Function":return this.visitFunction(e,t,n);case"Statement":return this.visitStatement(e,t,n);case"Directive":return this.visitDirective(e,t,n);case"SwitchCase":return this.visitSwitchCase(e,t,n);case"CatchClause":return this.visitCatchClause(e,t,n);case"VariableDeclarator":return this.visitVariableDeclarator(e,t,n);case"Expression":return this.visitExpression(e,t,n);case"Property":return this.visitProperty(e,t,n);case"Pattern":return this.visitPattern(e,t,n);case"Super":return this.visitSuper(e,t,n);case"SpreadElement":return this.visitSpreadElement(e,t,n);case"TemplateElement":return this.visitTemplateElement(e,t,n);case"Class":return this.visitClass(e,t,n);case"ClassBody":return this.visitClassBody(e,t,n);case"MethodDefinition":return this.visitMethodDefinition(e,t,n);case"ModuleDeclaration":return this.visitModuleDeclaration(e,t,n);case"ModuleSpecifier":return this.visitModuleSpecifier(e,t,n);case"JSXEmptyExpression":return this.visitJSXEmptyExpression(e,t,n);case"JSXExpressionContainer":return this.visitJSXExpressionContainer(e,t,n);case"JSXSpreadChild":return this.visitJSXSpreadChild(e,t,n);case"JSXBoundaryElement":return this.visitJSXBoundaryElement(e,t,n);case"JSXAttribute":return this.visitJSXAttribute(e,t,n);case"JSXText":return this.visitJSXText(e,t,n);case"JSXOpeningFragment":return this.visitJSXOpeningFragment(e,t,n);case"JSXClosingFragment":return this.visitJSXClosingFragment(e,t,n);case"Identifier":return this.visitIdentifier(e,t,n);case"Literal":return this.visitLiteral(e,t,n);case"ExpressionStatement":return this.visitExpressionStatement(e,t,n);case"BlockStatement":return this.visitBlockStatement(e,t,n);case"EmptyStatement":return this.visitEmptyStatement(e,t,n);case"DebuggerStatement":return this.visitDebuggerStatement(e,t,n);case"WithStatement":return this.visitWithStatement(e,t,n);case"ReturnStatement":return this.visitReturnStatement(e,t,n);case"LabeledStatement":return this.visitLabeledStatement(e,t,n);case"BreakStatement":return this.visitBreakStatement(e,t,n);case"ContinueStatement":return this.visitContinueStatement(e,t,n);case"IfStatement":return this.visitIfStatement(e,t,n);case"SwitchStatement":return this.visitSwitchStatement(e,t,n);case"ThrowStatement":return this.visitThrowStatement(e,t,n);case"TryStatement":return this.visitTryStatement(e,t,n);case"WhileStatement":return this.visitWhileStatement(e,t,n);case"DoWhileStatement":return this.visitDoWhileStatement(e,t,n);case"ForStatement":return this.visitForStatement(e,t,n);case"ForInStatement":return this.visitForInStatement(e,t,n);case"Declaration":return this.visitDeclaration(e,t,n);case"ThisExpression":return this.visitThisExpression(e,t,n);case"ArrayExpression":return this.visitArrayExpression(e,t,n);case"ObjectExpression":return this.visitObjectExpression(e,t,n);case"FunctionExpression":return this.visitFunctionExpression(e,t,n);case"UnaryExpression":return this.visitUnaryExpression(e,t,n);case"UpdateExpression":return this.visitUpdateExpression(e,t,n);case"BinaryExpression":return this.visitBinaryExpression(e,t,n);case"AssignmentExpression":return this.visitAssignmentExpression(e,t,n);case"LogicalExpression":return this.visitLogicalExpression(e,t,n);case"MemberExpression":return this.visitMemberExpression(e,t,n);case"ConditionalExpression":return this.visitConditionalExpression(e,t,n);case"CallExpression":return this.visitCallExpression(e,t,n);case"NewExpression":return this.visitNewExpression(e,t,n);case"SequenceExpression":return this.visitSequenceExpression(e,t,n);case"ArrowFunctionExpression":return this.visitArrowFunctionExpression(e,t,n);case"YieldExpression":return this.visitYieldExpression(e,t,n);case"TemplateLiteral":return this.visitTemplateLiteral(e,t,n);case"TaggedTemplateExpression":return this.visitTaggedTemplateExpression(e,t,n);case"AssignmentProperty":return this.visitAssignmentProperty(e,t,n);case"ObjectPattern":return this.visitObjectPattern(e,t,n);case"ArrayPattern":return this.visitArrayPattern(e,t,n);case"RestElement":return this.visitRestElement(e,t,n);case"AssignmentPattern":return this.visitAssignmentPattern(e,t,n);case"ClassExpression":return this.visitClassExpression(e,t,n);case"MetaProperty":return this.visitMetaProperty(e,t,n);case"ImportDeclaration":return this.visitImportDeclaration(e,t,n);case"ImportSpecifier":return this.visitImportSpecifier(e,t,n);case"ImportDefaultSpecifier":return this.visitImportDefaultSpecifier(e,t,n);case"ImportNamespaceSpecifier":return this.visitImportNamespaceSpecifier(e,t,n);case"ExportNamedDeclaration":return this.visitExportNamedDeclaration(e,t,n);case"ExportSpecifier":return this.visitExportSpecifier(e,t,n);case"ExportDefaultDeclaration":return this.visitExportDefaultDeclaration(e,t,n);case"ExportAllDeclaration":return this.visitExportAllDeclaration(e,t,n);case"AwaitExpression":return this.visitAwaitExpression(e,t,n);case"JSXMemberExpression":return this.visitJSXMemberExpression(e,t,n);case"JSXNamespacedName":return this.visitJSXNamespacedName(e,t,n);case"JSXOpeningElement":return this.visitJSXOpeningElement(e,t,n);case"JSXClosingElement":return this.visitJSXClosingElement(e,t,n);case"JSXSpreadAttribute":return this.visitJSXSpreadAttribute(e,t,n);case"JSXElement":return this.visitJSXElement(e,t,n);case"JSXFragment":return this.visitJSXFragment(e,t,n);case"RegExpLiteral":return this.visitRegExpLiteral(e,t,n);case"FunctionBody":return this.visitFunctionBody(e,t,n);case"FunctionDeclaration":return this.visitFunctionDeclaration(e,t,n);case"VariableDeclaration":return this.visitVariableDeclaration(e,t,n);case"ForOfStatement":return this.visitForOfStatement(e,t,n);case"ClassDeclaration":return this.visitClassDeclaration(e,t,n);case"JSXIdentifier":return this.visitJSXIdentifier(e,t,n)}throw new Error("No visit function in AST visitor Visitor for:\n  "+n.join(".")+"\n  "+JSON.stringify(e))},i.prototype.visitNode=function(e,t,n){return e},i.prototype.visitSourceLocation=function(e,t,n){var r=this;return e.start=r.accept(e.start,t,n.concat(["start"])),e.end=r.accept(e.end,t,n.concat(["end"])),e},i.prototype.visitPosition=function(e,t,n){return e},i.prototype.visitProgram=function(e,t,n){for(var r=this,i=[],s=0;s<e.body.length;s++){var u=e.body[s],a=u?r.accept(u,t,n.concat(["body",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.body=i,e},i.prototype.visitFunction=function(e,t,n){var r=this;e.id&&(e.id=r.accept(e.id,t,n.concat(["id"])));for(var i=[],s=0;s<e.params.length;s++){var u=e.params[s],a=u?r.accept(u,t,n.concat(["params",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.params=i,e.body=r.accept(e.body,t,n.concat(["body"])),e},i.prototype.visitStatement=function(e,t,n){return e},i.prototype.visitDirective=function(e,t,n){var r=this;return e.expression=r.accept(e.expression,t,n.concat(["expression"])),e},i.prototype.visitSwitchCase=function(e,t,n){var r=this;e.test&&(e.test=r.accept(e.test,t,n.concat(["test"])));for(var i=[],s=0;s<e.consequent.length;s++){var u=e.consequent[s],a=u?r.accept(u,t,n.concat(["consequent",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.consequent=i,e},i.prototype.visitCatchClause=function(e,t,n){var r=this;return e.param=r.accept(e.param,t,n.concat(["param"])),e.body=r.accept(e.body,t,n.concat(["body"])),e},i.prototype.visitVariableDeclarator=function(e,t,n){var r=this;return e.id=r.accept(e.id,t,n.concat(["id"])),e.init&&(e.init=r.accept(e.init,t,n.concat(["init"]))),e},i.prototype.visitExpression=function(e,t,n){return e},i.prototype.visitProperty=function(e,t,n){var r=this;return e.key=r.accept(e.key,t,n.concat(["key"])),e.value=r.accept(e.value,t,n.concat(["value"])),e},i.prototype.visitPattern=function(e,t,n){return e},i.prototype.visitSuper=function(e,t,n){return e},i.prototype.visitSpreadElement=function(e,t,n){var r=this;return e.argument=r.accept(e.argument,t,n.concat(["argument"])),e},i.prototype.visitTemplateElement=function(e,t,n){return e},i.prototype.visitClass=function(e,t,n){var r=this;return e.id&&(e.id=r.accept(e.id,t,n.concat(["id"]))),e.superClass&&(e.superClass=r.accept(e.superClass,t,n.concat(["superClass"]))),e.body=r.accept(e.body,t,n.concat(["body"])),e},i.prototype.visitClassBody=function(e,t,n){for(var r=this,i=[],s=0;s<e.body.length;s++){var u=e.body[s],a=u?r.accept(u,t,n.concat(["body",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.body=i,e},i.prototype.visitMethodDefinition=function(e,t,n){var r=this;return e.key=r.accept(e.key,t,n.concat(["key"])),e.value=r.accept(e.value,t,n.concat(["value"])),e},i.prototype.visitModuleDeclaration=function(e,t,n){return e},i.prototype.visitModuleSpecifier=function(e,t,n){var r=this;return e.local=r.accept(e.local,t,n.concat(["local"])),e},i.prototype.visitJSXEmptyExpression=function(e,t,n){return e},i.prototype.visitJSXExpressionContainer=function(e,t,n){var r=this;return e.expression=r.accept(e.expression,t,n.concat(["expression"])),e},i.prototype.visitJSXSpreadChild=function(e,t,n){var r=this;return e.expression=r.accept(e.expression,t,n.concat(["expression"])),e},i.prototype.visitJSXBoundaryElement=function(e,t,n){var r=this;return e.name=r.accept(e.name,t,n.concat(["name"])),e},i.prototype.visitJSXAttribute=function(e,t,n){var r=this;return e.name=r.accept(e.name,t,n.concat(["name"])),e.value&&(e.value=r.accept(e.value,t,n.concat(["value"]))),e},i.prototype.visitJSXText=function(e,t,n){return e},i.prototype.visitJSXOpeningFragment=function(e,t,n){return e},i.prototype.visitJSXClosingFragment=function(e,t,n){return e},i.prototype.visitIdentifier=function(e,t,n){return e},i.prototype.visitLiteral=function(e,t,n){return e},i.prototype.visitExpressionStatement=function(e,t,n){var r=this;return e.expression=r.accept(e.expression,t,n.concat(["expression"])),e},i.prototype.visitBlockStatement=function(e,t,n){for(var r=this,i=[],s=0;s<e.body.length;s++){var u=e.body[s],a=u?r.accept(u,t,n.concat(["body",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.body=i,e},i.prototype.visitEmptyStatement=function(e,t,n){return e},i.prototype.visitDebuggerStatement=function(e,t,n){return e},i.prototype.visitWithStatement=function(e,t,n){var r=this;return e.object=r.accept(e.object,t,n.concat(["object"])),e.body=r.accept(e.body,t,n.concat(["body"])),e},i.prototype.visitReturnStatement=function(e,t,n){var r=this;return e.argument&&(e.argument=r.accept(e.argument,t,n.concat(["argument"]))),e},i.prototype.visitLabeledStatement=function(e,t,n){var r=this;return e.label=r.accept(e.label,t,n.concat(["label"])),e.body=r.accept(e.body,t,n.concat(["body"])),e},i.prototype.visitBreakStatement=function(e,t,n){var r=this;return e.label&&(e.label=r.accept(e.label,t,n.concat(["label"]))),e},i.prototype.visitContinueStatement=function(e,t,n){var r=this;return e.label&&(e.label=r.accept(e.label,t,n.concat(["label"]))),e},i.prototype.visitIfStatement=function(e,t,n){var r=this;return e.test=r.accept(e.test,t,n.concat(["test"])),e.consequent=r.accept(e.consequent,t,n.concat(["consequent"])),e.alternate&&(e.alternate=r.accept(e.alternate,t,n.concat(["alternate"]))),e},i.prototype.visitSwitchStatement=function(e,t,n){var r=this;e.discriminant=r.accept(e.discriminant,t,n.concat(["discriminant"]));for(var i=[],s=0;s<e.cases.length;s++){var u=e.cases[s],a=u?r.accept(u,t,n.concat(["cases",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.cases=i,e},i.prototype.visitThrowStatement=function(e,t,n){var r=this;return e.argument=r.accept(e.argument,t,n.concat(["argument"])),e},i.prototype.visitTryStatement=function(e,t,n){var r=this;return e.block=r.accept(e.block,t,n.concat(["block"])),e.handler&&(e.handler=r.accept(e.handler,t,n.concat(["handler"]))),e.finalizer&&(e.finalizer=r.accept(e.finalizer,t,n.concat(["finalizer"]))),e},i.prototype.visitWhileStatement=function(e,t,n){var r=this;return e.test=r.accept(e.test,t,n.concat(["test"])),e.body=r.accept(e.body,t,n.concat(["body"])),e},i.prototype.visitDoWhileStatement=function(e,t,n){var r=this;return e.body=r.accept(e.body,t,n.concat(["body"])),e.test=r.accept(e.test,t,n.concat(["test"])),e},i.prototype.visitForStatement=function(e,t,n){var r=this;return e.init&&(e.init=r.accept(e.init,t,n.concat(["init"]))),e.test&&(e.test=r.accept(e.test,t,n.concat(["test"]))),e.update&&(e.update=r.accept(e.update,t,n.concat(["update"]))),e.body=r.accept(e.body,t,n.concat(["body"])),e},i.prototype.visitForInStatement=function(e,t,n){var r=this;return e.left=r.accept(e.left,t,n.concat(["left"])),e.right=r.accept(e.right,t,n.concat(["right"])),e.body=r.accept(e.body,t,n.concat(["body"])),e},i.prototype.visitDeclaration=function(e,t,n){return e},i.prototype.visitThisExpression=function(e,t,n){return e},i.prototype.visitArrayExpression=function(e,t,n){var r=this;if(e.elements){for(var i=[],s=0;s<e.elements.length;s++){var u=e.elements[s],a=u?r.accept(u,t,n.concat(["elements",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}e.elements=i}return e},i.prototype.visitObjectExpression=function(e,t,n){for(var r=this,i=[],s=0;s<e.properties.length;s++){var u=e.properties[s],a=u?r.accept(u,t,n.concat(["properties",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.properties=i,e},i.prototype.visitFunctionExpression=function(e,t,n){var r=this;e.id&&(e.id=r.accept(e.id,t,n.concat(["id"])));for(var i=[],s=0;s<e.params.length;s++){var u=e.params[s],a=u?r.accept(u,t,n.concat(["params",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.params=i,e.body=r.accept(e.body,t,n.concat(["body"])),e},i.prototype.visitUnaryExpression=function(e,t,n){var r=this;return e.argument=r.accept(e.argument,t,n.concat(["argument"])),e},i.prototype.visitUpdateExpression=function(e,t,n){var r=this;return e.argument=r.accept(e.argument,t,n.concat(["argument"])),e},i.prototype.visitBinaryExpression=function(e,t,n){var r=this;return e.left=r.accept(e.left,t,n.concat(["left"])),e.right=r.accept(e.right,t,n.concat(["right"])),e},i.prototype.visitAssignmentExpression=function(e,t,n){var r=this;return e.left=r.accept(e.left,t,n.concat(["left"])),e.right=r.accept(e.right,t,n.concat(["right"])),e},i.prototype.visitLogicalExpression=function(e,t,n){var r=this;return e.left=r.accept(e.left,t,n.concat(["left"])),e.right=r.accept(e.right,t,n.concat(["right"])),e},i.prototype.visitMemberExpression=function(e,t,n){var r=this;return e.object=r.accept(e.object,t,n.concat(["object"])),e.property=r.accept(e.property,t,n.concat(["property"])),e},i.prototype.visitConditionalExpression=function(e,t,n){var r=this;return e.test=r.accept(e.test,t,n.concat(["test"])),e.alternate=r.accept(e.alternate,t,n.concat(["alternate"])),e.consequent=r.accept(e.consequent,t,n.concat(["consequent"])),e},i.prototype.visitCallExpression=function(e,t,n){var r=this;e.callee=r.accept(e.callee,t,n.concat(["callee"]));for(var i=[],s=0;s<e.arguments.length;s++){var u=e.arguments[s],a=u?r.accept(u,t,n.concat(["arguments",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.arguments=i,e},i.prototype.visitNewExpression=function(e,t,n){var r=this;e.callee=r.accept(e.callee,t,n.concat(["callee"]));for(var i=[],s=0;s<e.arguments.length;s++){var u=e.arguments[s],a=u?r.accept(u,t,n.concat(["arguments",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.arguments=i,e},i.prototype.visitSequenceExpression=function(e,t,n){for(var r=this,i=[],s=0;s<e.expressions.length;s++){var u=e.expressions[s],a=u?r.accept(u,t,n.concat(["expressions",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.expressions=i,e},i.prototype.visitArrowFunctionExpression=function(e,t,n){var r=this;e.body=r.accept(e.body,t,n.concat(["body"])),e.id&&(e.id=r.accept(e.id,t,n.concat(["id"])));for(var i=[],s=0;s<e.params.length;s++){var u=e.params[s],a=u?r.accept(u,t,n.concat(["params",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.params=i,e},i.prototype.visitYieldExpression=function(e,t,n){var r=this;return e.argument&&(e.argument=r.accept(e.argument,t,n.concat(["argument"]))),e},i.prototype.visitTemplateLiteral=function(e,t,n){for(var r=this,i=[],s=0;s<e.quasis.length;s++){a=(u=e.quasis[s])?r.accept(u,t,n.concat(["quasis",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}e.quasis=i;for(var i=[],s=0;s<e.expressions.length;s++){var u=e.expressions[s],a=u?r.accept(u,t,n.concat(["expressions",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.expressions=i,e},i.prototype.visitTaggedTemplateExpression=function(e,t,n){var r=this;return e.tag=r.accept(e.tag,t,n.concat(["tag"])),e.quasi=r.accept(e.quasi,t,n.concat(["quasi"])),e},i.prototype.visitAssignmentProperty=function(e,t,n){var r=this;return e.value=r.accept(e.value,t,n.concat(["value"])),e.key=r.accept(e.key,t,n.concat(["key"])),e},i.prototype.visitObjectPattern=function(e,t,n){for(var r=this,i=[],s=0;s<e.properties.length;s++){var u=e.properties[s],a=u?r.accept(u,t,n.concat(["properties",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.properties=i,e},i.prototype.visitArrayPattern=function(e,t,n){var r=this;if(e.elements){for(var i=[],s=0;s<e.elements.length;s++){var u=e.elements[s],a=u?r.accept(u,t,n.concat(["elements",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}e.elements=i}return e},i.prototype.visitRestElement=function(e,t,n){var r=this;return e.argument=r.accept(e.argument,t,n.concat(["argument"])),e},i.prototype.visitAssignmentPattern=function(e,t,n){var r=this;return e.left=r.accept(e.left,t,n.concat(["left"])),e.right=r.accept(e.right,t,n.concat(["right"])),e},i.prototype.visitClassExpression=function(e,t,n){var r=this;return e.id&&(e.id=r.accept(e.id,t,n.concat(["id"]))),e.superClass&&(e.superClass=r.accept(e.superClass,t,n.concat(["superClass"]))),e.body=r.accept(e.body,t,n.concat(["body"])),e},i.prototype.visitMetaProperty=function(e,t,n){var r=this;return e.meta=r.accept(e.meta,t,n.concat(["meta"])),e.property=r.accept(e.property,t,n.concat(["property"])),e},i.prototype.visitImportDeclaration=function(e,t,n){for(var r=this,i=[],s=0;s<e.specifiers.length;s++){var u=e.specifiers[s],a=u?r.accept(u,t,n.concat(["specifiers",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.specifiers=i,e.source=r.accept(e.source,t,n.concat(["source"])),e},i.prototype.visitImportSpecifier=function(e,t,n){var r=this;return e.imported=r.accept(e.imported,t,n.concat(["imported"])),e.local=r.accept(e.local,t,n.concat(["local"])),e},i.prototype.visitImportDefaultSpecifier=function(e,t,n){var r=this;return e.local=r.accept(e.local,t,n.concat(["local"])),e},i.prototype.visitImportNamespaceSpecifier=function(e,t,n){var r=this;return e.local=r.accept(e.local,t,n.concat(["local"])),e},i.prototype.visitExportNamedDeclaration=function(e,t,n){var r=this;e.declaration&&(e.declaration=r.accept(e.declaration,t,n.concat(["declaration"])));for(var i=[],s=0;s<e.specifiers.length;s++){var u=e.specifiers[s],a=u?r.accept(u,t,n.concat(["specifiers",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.specifiers=i,e.source&&(e.source=r.accept(e.source,t,n.concat(["source"]))),e},i.prototype.visitExportSpecifier=function(e,t,n){var r=this;return e.exported=r.accept(e.exported,t,n.concat(["exported"])),e.local=r.accept(e.local,t,n.concat(["local"])),e},i.prototype.visitExportDefaultDeclaration=function(e,t,n){var r=this;return e.declaration=r.accept(e.declaration,t,n.concat(["declaration"])),e},i.prototype.visitExportAllDeclaration=function(e,t,n){var r=this;return e.source=r.accept(e.source,t,n.concat(["source"])),e},i.prototype.visitAwaitExpression=function(e,t,n){var r=this;return e.argument=r.accept(e.argument,t,n.concat(["argument"])),e},i.prototype.visitJSXMemberExpression=function(e,t,n){var r=this;return e.object=r.accept(e.object,t,n.concat(["object"])),e.property=r.accept(e.property,t,n.concat(["property"])),e},i.prototype.visitJSXNamespacedName=function(e,t,n){var r=this;return e.namespace=r.accept(e.namespace,t,n.concat(["namespace"])),e.name=r.accept(e.name,t,n.concat(["name"])),e},i.prototype.visitJSXOpeningElement=function(e,t,n){for(var r=this,i=[],s=0;s<e.attributes.length;s++){var u=e.attributes[s],a=u?r.accept(u,t,n.concat(["attributes",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.attributes=i,e.name=r.accept(e.name,t,n.concat(["name"])),e},i.prototype.visitJSXClosingElement=function(e,t,n){var r=this;return e.name=r.accept(e.name,t,n.concat(["name"])),e},i.prototype.visitJSXSpreadAttribute=function(e,t,n){var r=this;return e.argument=r.accept(e.argument,t,n.concat(["argument"])),e},i.prototype.visitJSXElement=function(e,t,n){var r=this;e.openingElement=r.accept(e.openingElement,t,n.concat(["openingElement"]));for(var i=[],s=0;s<e.children.length;s++){var u=e.children[s],a=u?r.accept(u,t,n.concat(["children",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.children=i,e.closingElement&&(e.closingElement=r.accept(e.closingElement,t,n.concat(["closingElement"]))),e},i.prototype.visitJSXFragment=function(e,t,n){var r=this;e.openingFragment=r.accept(e.openingFragment,t,n.concat(["openingFragment"]));for(var i=[],s=0;s<e.children.length;s++){var u=e.children[s],a=u?r.accept(u,t,n.concat(["children",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.children=i,e.closingFragment=r.accept(e.closingFragment,t,n.concat(["closingFragment"])),e},i.prototype.visitRegExpLiteral=function(e,t,n){return e},i.prototype.visitFunctionBody=function(e,t,n){for(var r=this,i=[],s=0;s<e.body.length;s++){var u=e.body[s],a=u?r.accept(u,t,n.concat(["body",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.body=i,e},i.prototype.visitFunctionDeclaration=function(e,t,n){var r=this;e.id&&(e.id=r.accept(e.id,t,n.concat(["id"])));for(var i=[],s=0;s<e.params.length;s++){var u=e.params[s],a=u?r.accept(u,t,n.concat(["params",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.params=i,e.body=r.accept(e.body,t,n.concat(["body"])),e},i.prototype.visitVariableDeclaration=function(e,t,n){for(var r=this,i=[],s=0;s<e.declarations.length;s++){var u=e.declarations[s],a=u?r.accept(u,t,n.concat(["declarations",s])):u;Array.isArray(a)?i.push.apply(i,a):i.push(a)}return e.declarations=i,e},i.prototype.visitForOfStatement=function(e,t,n){var r=this;return e.left=r.accept(e.left,t,n.concat(["left"])),e.right=r.accept(e.right,t,n.concat(["right"])),e.body=r.accept(e.body,t,n.concat(["body"])),e},i.prototype.visitClassDeclaration=function(e,t,n){var r=this;return e.id&&(e.id=r.accept(e.id,t,n.concat(["id"]))),e.superClass&&(e.superClass=r.accept(e.superClass,t,n.concat(["superClass"]))),e.body=r.accept(e.body,t,n.concat(["body"])),e},i.prototype.visitJSXIdentifier=function(e,t,n){return e};var oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ce=(function(){function e(e){this.value=e}function t(t){function n(i,s){try{var u=t[i](s),a=u.value;a instanceof e?Promise.resolve(a.value).then(function(e){n("next",e)},function(e){n("throw",e)}):r(u.done?"return":"normal",u.value)}catch(e){r("throw",e)}}function r(e,t){switch(e){case"return":i.resolve({value:t,done:!0});break;case"throw":i.reject(t);break;default:i.resolve({value:t,done:!1})}(i=i.next)?n(i.key,i.arg):s=null}var i,s;this._invoke=function(e,t){return new Promise(function(r,u){var a={key:e,arg:t,resolve:r,reject:u,next:null};s?s=s.next=a:(i=s=a,n(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),pe=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),le=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},he=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,n,r)}if("value"in i)return i.value;var u=i.get;if(void 0!==u)return u.call(r)},de=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},fe=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},me=function(){function e(e,t){var n=[],r=!0,i=!1,s=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){i=!0,s=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw s}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),ye=function(e){return Array.isArray(e)?e:Array.from(e)},ge=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},ve=function(e){function t(){return ce(this,t),fe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return de(t,i),pe(t,[{key:"accept",value:function(e,n,r){var i=r.map(function(e){return"string"==typeof e?"."+e:"["+e+"]"}).join(""),s=[],u=he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,{index:n.index,tree:s},r);return n.tree.push({node:e,path:i,index:n.index++,children:s}),u}}]),t}(),Ae=function(e){function t(){return ce(this,t),fe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return de(t,i),pe(t,[{key:"recordNotEqual",value:function(e,t,n,r){n.comparisons.errors.push({node1:e,node2:t,path:n.completePath,msg:r})}},{key:"compareType",value:function(e,t,n){return this.compareField("type",e,t,n)}},{key:"compareField",value:function(e,t,n,r){if(n=lively.lang.Path(r.completePath.join(".")).get(n),t&&n&&t[e]===n[e])return!0;if(t&&"*"===t[e]||n&&"*"===n[e])return!0;var i,s=r.completePath.join(".")+"."+e;return i=t?n?s+" is not equal: "+t[e]+" vs. "+n[e]:"node2 not defined but node1 ("+s+") is: "+t[e]:"node1 on "+s+" not defined",this.recordNotEqual(t,n,r,i),!1}},{key:"accept",value:function(e,t,n,r){var i=lively.lang.Path(r.join(".")).get(t);if("*"!==e&&"*"!==i){var s={completePath:r,comparisons:n.comparisons};this.compareType(e,t,s)&&this["visit"+e.type](e,t,s,r)}}},{key:"visitFunction",value:function(e,n,r,i){return e.generator&&this.compareField("generator",e,n,r),e.expression&&this.compareField("expression",e,n,r),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitFunction",this).call(this,e,n,r,i)}},{key:"visitSwitchStatement",value:function(e,n,r,i){return e.lexical&&this.compareField("lexical",e,n,r),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitSwitchStatement",this).call(this,e,n,r,i)}},{key:"visitForInStatement",value:function(e,n,r,i){return e.each&&this.compareField("each",e,n,r),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitForInStatement",this).call(this,e,n,r,i)}},{key:"visitFunctionDeclaration",value:function(e,n,r,i){return e.generator&&this.compareField("generator",e,n,r),e.expression&&this.compareField("expression",e,n,r),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitFunctionDeclaration",this).call(this,e,n,r,i)}},{key:"visitVariableDeclaration",value:function(e,n,r,i){return this.compareField("kind",e,n,r),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitVariableDeclaration",this).call(this,e,n,r,i)}},{key:"visitUnaryExpression",value:function(e,n,r,i){return this.compareField("operator",e,n,r),e.prefix&&this.compareField("prefix",e,n,r),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitUnaryExpression",this).call(this,e,n,r,i)}},{key:"visitBinaryExpression",value:function(e,n,r,i){return this.compareField("operator",e,n,r),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitBinaryExpression",this).call(this,e,n,r,i)}},{key:"visitAssignmentExpression",value:function(e,n,r,i){return this.compareField("operator",e,n,r),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitAssignmentExpression",this).call(this,e,n,r,i)}},{key:"visitUpdateExpression",value:function(e,n,r,i){return this.compareField("operator",e,n,r),e.prefix&&this.compareField("prefix",e,n,r),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitUpdateExpression",this).call(this,e,n,r,i)}},{key:"visitLogicalExpression",value:function(e,n,r,i){return this.compareField("operator",e,n,r),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitLogicalExpression",this).call(this,e,n,r,i)}},{key:"visitMemberExpression",value:function(e,n,r,i){return e.computed&&this.compareField("computed",e,n,r),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitMemberExpression",this).call(this,e,n,r,i)}},{key:"visitComprehensionBlock",value:function(e,n,r,i){return e.each&&this.compareField("each",e,n,r),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitComprehensionBlock",this).call(this,e,n,r,i)}},{key:"visitIdentifier",value:function(e,n,r,i){return this.compareField("name",e,n,r),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitIdentifier",this).call(this,e,n,r,i)}},{key:"visitLiteral",value:function(e,n,r,i){return this.compareField("value",e,n,r),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitLiteral",this).call(this,e,n,r,i)}},{key:"visitClassDeclaration",value:function(e,n,r,i){return this.compareField("id",e,n,r),e.superClass&&this.compareField("superClass",e,n,r),this.compareField("body",e,n,r),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitClassDeclaration",this).call(this,e,n,r,i)}},{key:"visitClassBody",value:function(e,n,r,i){return this.compareField("body",e,n,r),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitClassBody",this).call(this,e,n,r,i)}},{key:"visitMethodDefinition",value:function(e,n,r,i){return this.compareField("static",e,n,r),this.compareField("computed",e,n,r),this.compareField("kind",e,n,r),this.compareField("key",e,n,r),this.compareField("value",e,n,r),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitMethodDefinition",this).call(this,e,n,r,i)}}]),t}(),De=function(e){function t(){return ce(this,t),fe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return de(t,i),pe(t,[{key:"newScope",value:function(e,t){var n={node:e,varDecls:[],varDeclPaths:[],funcDecls:[],funcDeclPaths:[],classDecls:[],classDeclPaths:[],classExprs:[],classExprPaths:[],methodDecls:[],methodDeclPaths:[],importSpecifiers:[],importSpecifierPaths:[],exportDecls:[],exportDeclPaths:[],refs:[],thisRefs:[],params:[],catches:[],subScopes:[],resolvedRefMap:new Map};return t&&t.subScopes.push(n),n}},{key:"visitVariableDeclaration",value:function(e,n,r){return n.varDecls.push(e),n.varDeclPaths.push(r),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitVariableDeclaration",this).call(this,e,n,r)}},{key:"visitVariableDeclarator",value:function(e,t,n){var r=this;return e.init&&(e.init=r.accept(e.init,t,n.concat(["init"]))),e}},{key:"visitFunction",value:function(e,t,n){var r=this,i=this.newScope(e,t);return e.params.forEach(function(e,t){"AssignmentPattern"===e.type&&r.accept(e.right,i,n.concat("params",t,"right"))}),i.params=Array.prototype.slice.call(e.params),i}},{key:"visitFunctionDeclaration",value:function(e,t,n){var r=this.visitFunction(e,t,n);t.funcDecls.push(e),t.funcDeclPaths.push(n);var i=this;return e.defaults&&(e.defaults=e.defaults.reduce(function(e,t,s){var u=i.accept(t,r,n.concat(["defaults",s]));return Array.isArray(u)?e.push.apply(e,u):e.push(u),e},[])),e.rest&&(e.rest=i.accept(e.rest,r,n.concat(["rest"]))),e.body=i.accept(e.body,r,n.concat(["body"])),e.loc&&(e.loc=i.accept(e.loc,r,n.concat(["loc"]))),e}},{key:"visitFunctionExpression",value:function(e,t,n){var r=this.visitFunction(e,t,n),i=this;return e.defaults&&(e.defaults=e.defaults.reduce(function(e,t,s){var u=i.accept(t,r,n.concat(["defaults",s]));return Array.isArray(u)?e.push.apply(e,u):e.push(u),e},[])),e.rest&&(e.rest=i.accept(e.rest,r,n.concat(["rest"]))),e.body=i.accept(e.body,r,n.concat(["body"])),e.loc&&(e.loc=i.accept(e.loc,r,n.concat(["loc"]))),e}},{key:"visitArrowFunctionExpression",value:function(e,t,n){var r=this.visitFunction(e,t,n),i=this;return e.defaults&&(e.defaults=e.defaults.reduce(function(e,t,s){var u=i.accept(t,r,n.concat(["defaults",s]));return Array.isArray(u)?e.push.apply(e,u):e.push(u),e},[])),e.rest&&(e.rest=i.accept(e.rest,r,n.concat(["rest"]))),e.body=i.accept(e.body,r,n.concat(["body"])),e.loc&&(e.loc=i.accept(e.loc,r,n.concat(["loc"]))),e.generator,e.expression,e}},{key:"visitIdentifier",value:function(e,n,r){return n.refs.push(e),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitIdentifier",this).call(this,e,n,r)}},{key:"visitMemberExpression",value:function(e,t,n){var r=this;return e.object=r.accept(e.object,t,n.concat(["object"])),e.computed&&(e.property=r.accept(e.property,t,n.concat(["property"]))),e}},{key:"visitProperty",value:function(e,t,n){var r=this;return e.computed&&(e.key=r.accept(e.key,t,n.concat(["key"]))),e.value=r.accept(e.value,t,n.concat(["value"])),e}},{key:"visitThisExpression",value:function(e,n,r){return n.thisRefs.push(e),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitThisExpression",this).call(this,e,n,r)}},{key:"visitTryStatement",value:function(e,t,n){var r=this;return e.block=r.accept(e.block,t,n.concat(["block"])),e.handler&&(e.handler=r.accept(e.handler,t,n.concat(["handler"])),t.catches.push(e.handler.param)),e.finalizer&&(e.finalizer=r.accept(e.finalizer,t,n.concat(["finalizer"]))),e}},{key:"visitLabeledStatement",value:function(e,t,n){var r=this;return e.body=r.accept(e.body,t,n.concat(["body"])),e}},{key:"visitClassDeclaration",value:function(e,t,n){t.classDecls.push(e),t.classDeclPaths.push(n);var r=this;return e.superClass&&(e.superClass=r.accept(e.superClass,t,n.concat(["superClass"]))),e.body=r.accept(e.body,t,n.concat(["body"])),e}},{key:"visitClassExpression",value:function(e,t,n){e.id&&(t.classExprs.push(e),t.classExprPaths.push(n));var r=this;return e.superClass&&(e.superClass=r.accept(e.superClass,t,n.concat(["superClass"]))),e.body=r.accept(e.body,t,n.concat(["body"])),e}},{key:"visitMethodDefinition",value:function(e,t,n){var r=this;return e.value=r.accept(e.value,t,n.concat(["value"])),e}},{key:"visitMetaProperty",value:function(e,t,n){return e}},{key:"visitBreakStatement",value:function(e,t,n){return e}},{key:"visitContinueStatement",value:function(e,t,n){return e}},{key:"visitImportSpecifier",value:function(e,t,n){t.importSpecifiers.push(e.local),t.importSpecifierPaths.push(n);return e}},{key:"visitImportDefaultSpecifier",value:function(e,t,n){t.importSpecifiers.push(e.local),t.importSpecifierPaths.push(n);return e}},{key:"visitImportNamespaceSpecifier",value:function(e,t,n){t.importSpecifiers.push(e.local),t.importSpecifierPaths.push(n);return e}},{key:"visitExportSpecifier",value:function(e,t,n){var r=this;return e.local=r.accept(e.local,t,n.concat(["local"])),e}},{key:"visitExportNamedDeclaration",value:function(e,n,r){return n.exportDecls.push(e),n.exportDeclPaths.push(r),e.source||he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitExportNamedDeclaration",this).call(this,e,n,r),e}},{key:"visitExportDefaultDeclaration",value:function(e,n,r){return n.exportDecls.push(e),n.exportDeclPaths.push(r),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitExportDefaultDeclaration",this).call(this,e,n,r)}},{key:"visitExportAllDeclaration",value:function(e,n,r){return n.exportDecls.push(e),n.exportDeclPaths.push(r),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitExportAllDeclaration",this).call(this,e,n,r)}}]),t}(),xe=n.escodegen||n,Ee=acorn.walk,be=acorn.loose;Ee.base.AwaitExpression||(Ee.base.AwaitExpression=function(e,t,n){e.argument&&n(e.argument,t,"Expression")}),Ee.forEachNode=u,Ee.matchNodes=function(e,t,n,r){return u(e,function(e,n,r,i){t[e.type]&&t[e.type](e,n,r,i)},n,r)},Ee.findNodesIncluding=a,Ee.withParentInfo=function(e,n,r){function i(e){var n={id:t.string.newUUID(),parentScope:e,containingScopes:[]};return e&&e.containingScopes.push(n),n}r=r||{};var s,a=Ee.make({Function:function(e,t,n){t&&t.scope&&(t.scope=i(t.scope)),n(e.body,t,"ScopeBody")},VariableDeclarator:function(e,t,n){e.init&&n(e.init,t,"Expression")},VariableDeclaration:function(e,t,n){for(var r=0;r<e.declarations.length;++r){var i=e.declarations[r];i&&n(i,t,"VariableDeclarator")}},ObjectExpression:function(e,t,n){for(var r=0;r<e.properties.length;++r){var i=e.properties[r];n(i.key,t,"Expression"),n(i.value,t,"Expression")}},MemberExpression:function(e,t,n){n(e.object,t,"Expression"),n(e.property,t,"Expression")}},Ee.base),o=[];u(e,function(e){t.arr.withoutAll(Object.keys(e),["end","start","type","source","raw"]).forEach(function(t){if(!e.__lookupGetter__(t)){var n=e[t];e.__defineGetter__(t,function(){return s=t,n}),o.push([e,t,e[t]])}})},null,{visitors:a});var c=[];return Object.keys(a).forEach(function(e){var t=a[e];a[e]=function(i,u,a){return e===i.type||r.visitAllNodes?(c.push(n.call(null,i,{scope:u.scope,depth:u.depth,parent:u.parent,type:e,propertyInParent:s})),t(i,{scope:u.scope,parent:i,depth:u.depth+1},a)):t(i,u,a)}}),Ee.recursive(e,{scope:i(),parent:null,propertyInParent:"",depth:0},null,a),o.forEach(function(e){delete e[0][e[1]],e[0][e[1]]=e[2]}),c},Ee.copy=function(e,n){function r(e){return null===e?null:i[e.type](e,r)}var i=t.obj.extend({Program:function(e,t){return{start:e.start,end:e.end,type:"Program",body:e.body.map(t),source:e.source,astIndex:e.astIndex}},FunctionDeclaration:function(e,t){return{start:e.start,end:e.end,type:"FunctionDeclaration",id:t(e.id),params:e.params.map(t),body:t(e.body),source:e.source,astIndex:e.astIndex}},BlockStatement:function(e,t){return{start:e.start,end:e.end,type:"BlockStatement",body:e.body.map(t),source:e.source,astIndex:e.astIndex}},ExpressionStatement:function(e,t){return{start:e.start,end:e.end,type:"ExpressionStatement",expression:t(e.expression),source:e.source,astIndex:e.astIndex}},CallExpression:function(e,t){return{start:e.start,end:e.end,type:"CallExpression",callee:t(e.callee),arguments:e.arguments.map(t),source:e.source,astIndex:e.astIndex}},MemberExpression:function(e,t){return{start:e.start,end:e.end,type:"MemberExpression",object:t(e.object),property:t(e.property),computed:e.computed,source:e.source,astIndex:e.astIndex}},NewExpression:function(e,t){return{start:e.start,end:e.end,type:"NewExpression",callee:t(e.callee),arguments:e.arguments.map(t),source:e.source,astIndex:e.astIndex}},VariableDeclaration:function(e,t){return{start:e.start,end:e.end,type:"VariableDeclaration",declarations:e.declarations.map(t),kind:e.kind,source:e.source,astIndex:e.astIndex}},VariableDeclarator:function(e,t){return{start:e.start,end:e.end,type:"VariableDeclarator",id:t(e.id),init:t(e.init),source:e.source,astIndex:e.astIndex}},FunctionExpression:function(e,t){return{start:e.start,end:e.end,type:"FunctionExpression",id:t(e.id),params:e.params.map(t),body:t(e.body),source:e.source,astIndex:e.astIndex}},IfStatement:function(e,t){return{start:e.start,end:e.end,type:"IfStatement",test:t(e.test),consequent:t(e.consequent),alternate:t(e.alternate),source:e.source,astIndex:e.astIndex}},ConditionalExpression:function(e,t){return{start:e.start,end:e.end,type:"ConditionalExpression",test:t(e.test),consequent:t(e.consequent),alternate:t(e.alternate),source:e.source,astIndex:e.astIndex}},SwitchStatement:function(e,t){return{start:e.start,end:e.end,type:"SwitchStatement",discriminant:t(e.discriminant),cases:e.cases.map(t),source:e.source,astIndex:e.astIndex}},SwitchCase:function(e,t){return{start:e.start,end:e.end,type:"SwitchCase",test:t(e.test),consequent:e.consequent.map(t),source:e.source,astIndex:e.astIndex}},BreakStatement:function(e,t){return{start:e.start,end:e.end,type:"BreakStatement",label:e.label,source:e.source,astIndex:e.astIndex}},ContinueStatement:function(e,t){return{start:e.start,end:e.end,type:"ContinueStatement",label:e.label,source:e.source,astIndex:e.astIndex}},TryStatement:function(e,t){return{start:e.start,end:e.end,type:"TryStatement",block:t(e.block),handler:t(e.handler),finalizer:t(e.finalizer),guardedHandlers:e.guardedHandlers.map(t),source:e.source,astIndex:e.astIndex}},CatchClause:function(e,t){return{start:e.start,end:e.end,type:"CatchClause",param:t(e.param),guard:t(e.guard),body:t(e.body),source:e.source,astIndex:e.astIndex}},ThrowStatement:function(e,t){return{start:e.start,end:e.end,type:"ThrowStatement",argument:t(e.argument),source:e.source,astIndex:e.astIndex}},ForStatement:function(e,t){return{start:e.start,end:e.end,type:"ForStatement",init:t(e.init),test:t(e.test),update:t(e.update),body:t(e.body),source:e.source,astIndex:e.astIndex}},ForInStatement:function(e,t){return{start:e.start,end:e.end,type:"ForInStatement",left:t(e.left),right:t(e.right),body:t(e.body),source:e.source,astIndex:e.astIndex}},WhileStatement:function(e,t){return{start:e.start,end:e.end,type:"WhileStatement",test:t(e.test),body:t(e.body),source:e.source,astIndex:e.astIndex}},DoWhileStatement:function(e,t){return{start:e.start,end:e.end,type:"DoWhileStatement",test:t(e.test),body:t(e.body),source:e.source,astIndex:e.astIndex}},WithStatement:function(e,t){return{start:e.start,end:e.end,type:"WithStatement",object:t(e.object),body:t(e.body),source:e.source,astIndex:e.astIndex}},UnaryExpression:function(e,t){return{start:e.start,end:e.end,type:"UnaryExpression",argument:t(e.argument),operator:e.operator,prefix:e.prefix,source:e.source,astIndex:e.astIndex}},BinaryExpression:function(e,t){return{start:e.start,end:e.end,type:"BinaryExpression",left:t(e.left),operator:e.operator,right:t(e.right),source:e.source,astIndex:e.astIndex}},LogicalExpression:function(e,t){return{start:e.start,end:e.end,type:"LogicalExpression",left:t(e.left),operator:e.operator,right:t(e.right),source:e.source,astIndex:e.astIndex}},AssignmentExpression:function(e,t){return{start:e.start,end:e.end,type:"AssignmentExpression",left:t(e.left),operator:e.operator,right:t(e.right),source:e.source,astIndex:e.astIndex}},UpdateExpression:function(e,t){return{start:e.start,end:e.end,type:"UpdateExpression",argument:t(e.argument),operator:e.operator,prefix:e.prefix,source:e.source,astIndex:e.astIndex}},ReturnStatement:function(e,t){return{start:e.start,end:e.end,type:"ReturnStatement",argument:t(e.argument),source:e.source,astIndex:e.astIndex}},Identifier:function(e,t){return{start:e.start,end:e.end,type:"Identifier",name:e.name,source:e.source,astIndex:e.astIndex}},Literal:function(e,t){return{start:e.start,end:e.end,type:"Literal",value:e.value,raw:e.raw,source:e.source,astIndex:e.astIndex}},ObjectExpression:function(e,t){return{start:e.start,end:e.end,type:"ObjectExpression",properties:e.properties.map(function(e){return{key:t(e.key),value:t(e.value),kind:e.kind}}),source:e.source,astIndex:e.astIndex}},ArrayExpression:function(e,t){return{start:e.start,end:e.end,type:"ArrayExpression",elements:e.elements.map(t),source:e.source,astIndex:e.astIndex}},SequenceExpression:function(e,t){return{start:e.start,end:e.end,type:"SequenceExpression",expressions:e.expressions.map(t),source:e.source,astIndex:e.astIndex}},EmptyStatement:function(e,t){return{start:e.start,end:e.end,type:"EmptyStatement",source:e.source,astIndex:e.astIndex}},ThisExpression:function(e,t){return{start:e.start,end:e.end,type:"ThisExpression",source:e.source,astIndex:e.astIndex}},DebuggerStatement:function(e,t){return{start:e.start,end:e.end,type:"DebuggerStatement",source:e.source,astIndex:e.astIndex}},LabeledStatement:function(e,t){return{start:e.start,end:e.end,type:"LabeledStatement",label:e.label,body:t(e.body),source:e.source,astIndex:e.astIndex}}},n||{});return r(e)},Ee.findSiblings=function(e,n,r){if(!n)return[];var i=a(e,n.start),s=i.indexOf(n),u=i.slice(0,s),o=t.arr.detect(u.reverse(),function(e){return Array.isArray(e.body)}).body;if(!r)return t.arr.without(o,n);var c=o.indexOf(n);return"before"===r?o.slice(0,c):o.slice(c+1)},Ee.findNodeByAstIndex=function(e,t,n){n=null==n||!!n,!e.astIndex&&n&&o(e);var r=null;return we(e,null,function(e,n,i){r||n.astIndex<t||(n.astIndex!==t?e():r=n)}),r},Ee.findStatementOfNode=function(e,n,r){r||(r=n,n=e,e=null),e||(e={}),n.astIndex||o(n);var i,s=!1,u=["EmptyStatement","BlockStatement","ExpressionStatement","IfStatement","LabeledStatement","BreakStatement","ContinueStatement","WithStatement","SwitchStatement","ReturnStatement","ThrowStatement","TryStatement","WhileStatement","DoWhileStatement","ForStatement","ForInStatement","DebuggerStatement","FunctionDeclaration","VariableDeclaration","ClassDeclaration"];return we(n,{},function(a,o,c,p){if(!(s||o.astIndex<r.astIndex)){if(o===r||o.astIndex===r.astIndex)if(s=!0,e.asPath)i=p;else{var l=t.Path(p);do{i=l.get(n),l=l.slice(0,l.size()-1)}while(-1==u.indexOf(i.type)&&l.size()>0)}!s&&a()}}),i},Ee.addAstIndex=o,Ee.visitors={stopAtFunctions:Ee.make({Function:function(){}},Ee.base),withMemberExpression:Ee.make({MemberExpression:function(e,t,n){n(e.object,t,"Expression"),n(e.property,t,"Expression")}},Ee.base)};var Ce=function(e){function t(){return ce(this,t),fe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return de(t,i),pe(t,[{key:"accept",value:function(e,n,r){return this.doFunc(e,n,r),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,n,r)}}],[{key:"run",value:function(e,t,n){var r=new this;return r.doFunc=t,r.accept(e,n,[]),n}}]),t}(),Fe=function(e){function t(){return ce(this,t),fe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return de(t,i),pe(t,[{key:"accept",value:function(e,n,r){switch(e.type){case"ArrowFunctionExpression":case"FunctionExpression":return e;case"FunctionDeclaration":return n.unshift({node:e,path:r}),e;default:return he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,n,r)}}}],[{key:"run",value:function(e){var t=[];return(new this).accept(e,t,[]),t}}]),t}(),Se=Symbol("canBeInlined"),ke=function(e){function t(){return ce(this,t),fe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return de(t,i),pe(t,[{key:"accept",value:function(e,n,r){return this.replacer(he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,n,r))}},{key:"visitBlockStatement",value:function(e,n,r){return c(he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitBlockStatement",this).call(this,e,n,r))}},{key:"visitProgram",value:function(e,n,r){return c(he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitProgram",this).call(this,e,n,r))}}],[{key:"run",value:function(e,t){var n=new this;return n.replacer=t,n.accept(e,null,[])}}]),t}(),Be=function(e){function t(){return ce(this,t),fe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return de(t,i),pe(t,[{key:"accept",value:function(e,n,r){return this.replacer(he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,n,r),r)}}],[{key:"run",value:function(e,t){var n=new this;return n.replacer=t,n.accept(e,null,[])}}]),t}();acorn.walk.addSource=p;var _e={withMozillaAstDo:function(e,t,n){var r=new i,s=r.accept;return r.accept=function(e,i,u){return t=n(function(){s.call(r,e,i,u)},e,i,u),e},r.accept(e,t,[]),t},printAst:function(e,n){var r,i,u=(n=n||{}).printSource||!1,a=n.printPositions||!1,o=n.printIndex||!1,c=[];return"string"==typeof e?(r=e,i=d(e)):(i=e,r=n.source||i.source),u&&!i.source&&(r||(i=d(r=s(i))),p(i,r)),(new ve).accept(i,{index:0,tree:c},[]),t.string.printTree(c[0],function(e){var n=e.path+":"+e.node.type,i=[];if(o&&i.push(e.index),a&&i.push(e.node.start+"-"+e.node.end),u){var s=e.node.source||r.slice(e.node.start,e.node.end),c=t.string.print(s.truncate(60).replace(/\n/g,"").replace(/\s+/g," "));i.push(c)}return i.length&&(n+="("+i.join(",")+")"),n},function(e){return e.children},"  ")},compareAst:function(e,t){if(!e||!t)throw new Error("node"+(e?"1":"2")+" not defined");var n={completePath:[],comparisons:{errors:[]}};return(new Ae).accept(e,t,n,[]),n.comparisons.errors.length?n.comparisons.errors.pluck("msg"):null},pathToNode:function(e,t,n){n=n||{},e.astIndex||o(e);var r=new i,s=null;return(r.accept=function(e,n,r,i){if(!s){var u=n.concat(i);if(e.astIndex===t){var a=u.map(function(e){return"string"==typeof e?"."+e:"["+e+"]"}).join("");s={pathString:a,path:u,node:e}}return this["visit"+e.type](e,u,r,i)}}).call(r,e,[],{},[]),s},rematchAstWithSource:function(e,n,r,s){var u=d(n,(r=!!r)?{locations:!0}:void 0),a=new i;s&&(u=t.Path(s).get(u)),a.accept=function(t,n,i){var s=(i=i||[]).reduce(function(e,t){return e[t]},e);return s.start=t.start,s.end=t.end,r&&(s.loc=t.loc),this["visit"+t.type](t,n,i)},a.accept(u)}},we=_e.withMozillaAstDo,Te=_e.printAst,Ie=_e.compareAst,Pe=_e.pathToNode,Ne=_e.rematchAstWithSource,Le=/[_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*$/,je=Object.freeze({isIdentifier:f,id:m,literal:y,objectLiteral:function(e){for(var t=[],n=0;n<e.length;n+=2){var r=e[n];"string"==typeof r&&(r=m(r)),t.push(k(r,e[n+1]))}return{properties:t,type:"ObjectExpression"}},prop:k,exprStmt:g,returnStmt:v,empty:function(){return{type:"EmptyStatement"}},binaryExpr:function(e,t,n){return{left:e,right:n,operator:t,type:"BinaryExpression"}},funcExpr:A,funcCall:D,varDecl:x,member:E,memberChain:b,assign:function(e,t){return{type:"AssignmentExpression",operator:"=",right:t?"string"==typeof t?m(t):t:m("undefined"),left:"string"==typeof e?m(e):e}},block:C,program:F,tryStmt:S,ifStmt:function(e){return{consequent:arguments.length>1&&void 0!==arguments[1]?arguments[1]:C(),alternate:arguments.length>2&&void 0!==arguments[2]?arguments[2]:C(),test:e,type:"IfStatement"}},forIn:function(e,t,n){return{type:"ForInStatement",left:"string"==typeof e?x(e):e,right:"string"==typeof t?m(t):t,body:n}},conditional:function(e){return{consequent:arguments.length>1&&void 0!==arguments[1]?arguments[1]:m("undefined"),alternate:arguments.length>2&&void 0!==arguments[2]?arguments[2]:m("undefined"),test:e,type:"ConditionalExpression"}},logical:function(e,t,n){return{operator:e,left:t,right:n,type:"LogicalExpression"}}}),Oe={declIds:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=0;n<e.length;n++){var r=e[n];if(r)if("Identifier"===r.type)t.push(r);else if("RestElement"===r.type)t.push(r.argument);else if("AssignmentPattern"===r.type)Oe.declIds([r.left],t);else if("ObjectPattern"===r.type)for(var i=0;i<r.properties.length;i++){var s=r.properties[i];Oe.declIds([s.value||s],t)}else"ArrayPattern"===r.type&&Oe.declIds(r.elements,t)}return t},varDecls:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=!0,r=!1,i=void 0;try{for(var s,u=e.varDecls[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var a=s.value,o=!0,c=!1,p=void 0;try{for(var l,h=a.declarations[Symbol.iterator]();!(o=(l=h.next()).done);o=!0){var d=l.value,f=!0,m=!1,y=void 0;try{for(var g,v=Oe.declIds([d.id])[Symbol.iterator]();!(f=(g=v.next()).done);f=!0){var A=g.value;t.push([d,A])}}catch(e){m=!0,y=e}finally{try{!f&&v.return&&v.return()}finally{if(m)throw y}}}}catch(e){c=!0,p=e}finally{try{!o&&h.return&&h.return()}finally{if(c)throw p}}}}catch(e){r=!0,i=e}finally{try{!n&&u.return&&u.return()}finally{if(r)throw i}}return t},varDeclIds:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=!0,r=!1,i=void 0;try{for(var s,u=e.varDecls[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var a=s.value,o=!0,c=!1,p=void 0;try{for(var l,h=a.declarations[Symbol.iterator]();!(o=(l=h.next()).done);o=!0){var d=l.value;Oe.declIds([d.id],t)}}catch(e){c=!0,p=e}finally{try{!o&&h.return&&h.return()}finally{if(c)throw p}}}}catch(e){r=!0,i=e}finally{try{!n&&u.return&&u.return()}finally{if(r)throw i}}return t},objPropertiesAsList:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=!0,s=!1,u=void 0;try{for(var a,o=e.properties[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){var c=a.value,p=c.key.name,l={key:t.concat([p]),value:c.value};switch(c.value.type){case"ArrayExpression":case"ArrayPattern":n||r.push(l);for(var h=0;h<c.value.elements.length;h++){var d=c.value.elements[h];Oe.objPropertiesAsList(d,t.concat([p,h]),n,r)}break;case"ObjectExpression":case"ObjectPattern":n||r.push(l),Oe.objPropertiesAsList(c.value,t.concat([p]),n,r);break;case"AssignmentPattern":n||r.push(l),Oe.objPropertiesAsList(c.left,t.concat([p]),n,r);break;default:r.push(l)}}}catch(e){s=!0,u=e}finally{try{!i&&o.return&&o.return()}finally{if(s)throw u}}return r},isDeclaration:function(e){return"FunctionDeclaration"===e.type||"VariableDeclaration"===e.type||"ClassDeclaration"===e.type}},Me=["true","false","null","undefined","arguments","Object","Function","Array","Number","parseFloat","parseInt","Infinity","NaN","Boolean","String","Symbol","Date","Promise","RegExp","Error","EvalError","RangeError","ReferenceError","SyntaxError","TypeError","URIError","JSON","Math","console","ArrayBuffer","Uint8Array","Int8Array","Uint16Array","Int16Array","Uint32Array","Int32Array","Float32Array","Float64Array","Uint8ClampedArray","DataView","Map","Set","WeakMap","WeakSet","Proxy","Reflect","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","unescape","eval","isFinite","isNaN","Intl","navigator","window","document","Blob","setTimeout","clearTimeout","setInterval","clearInterval","requestAnimationFrame","cancelAnimationFrame","btoa","atob","sessionStorage","localStorage","$world","lively"],Re=/^\s*global\s*/,Ve=["EmptyStatement","BlockStatement","ExpressionStatement","IfStatement","BreakStatement","ContinueStatement","WithStatement","ReturnStatement","ThrowStatement","TryStatement","WhileStatement","DoWhileStatement","ForStatement","ForInStatement","ForOfStatement","DebuggerStatement","FunctionDeclaration","VariableDeclaration","ClassDeclaration","ImportDeclaration","ImportDeclaration","ExportNamedDeclaration","ExportDefaultDeclaration","ExportAllDeclaration"],qe=Object.freeze({helpers:Oe,knownGlobals:Me,scopes:B,nodesAtIndex:function(e,t){return we(e,[],function(e,n,r){return n.start<=t&&t<=n.end&&(r.push(n),e()),r})},scopesAtIndex:_,scopeAtIndex:function(e,n){return t.arr.last(_(e,n))},scopesAtPos:function(e,t){return V(e,t).filter(function(e){return"Program"===e.type||"FunctionDeclaration"===e.type||"FunctionExpression"===e.type})},nodesInScopeOf:function(e){return we(e,{root:e,result:[]},function(e,t,n){return n.result.push(t),t===n.root||"Program"!==t.type&&"FunctionDeclaration"!==t.type&&"FunctionExpression"!==t.type?(e(),n):n}).result},declarationsOfScope:w,_declaredVarNames:I,_findJsLintGlobalDeclarations:P,topLevelDeclsAndRefs:O,topLevelFuncDecls:N,findGlobalVarRefs:function(e,t){var n=O(e,t),r=n.declaredNames.concat(Me);return n.refs.filter(function(e){return-1===r.indexOf(e.name)})},findNodesIncludingLines:function(e,n,r,i){if(!n&&!e)throw new Error("Need at least ast or code");return n=n||s(e),e=e&&e.loc?e:d(n,{locations:!0}),we(e,[],function(e,n,i){return r.every(function(e){return t.num.between(e,n.loc.start.line,n.loc.end.line)})&&(t.arr.pushIfNotIncluded(i,n),e()),i})},findReferencesAndDeclsInScope:R,findDeclarationClosestToIndex:function(e,n,r){var i=null;return t.arr.detect(_(e,r).reverse(),function(e){var r=w(e,!0),s=t.arr.pluck(r,"name").indexOf(n);return-1!==s&&(i=r[s],!0)}),i},nodesAt:V,statementOf:q,resolveReferences:j,refWithDeclAt:function(e,t){var n=!0,r=!1,i=void 0;try{for(var s,u=t.resolvedRefMap.values()[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var a=s.value,o=a.ref,c=o.start,p=o.end;if(c<=e&&e<=p)return a}}catch(e){r=!0,i=e}finally{try{!n&&u.return&&u.return()}finally{if(r)throw i}}},imports:function(e){for(var t=[],n=e.node.body||[],r=0;r<n.length;r++){var i=n[r];if("ImportDeclaration"===i.type)if(0!==i.specifiers.length){var s=i.source?i.source.value:"unknown module";t.push.apply(t,ge(i.specifiers.map(function(e){var t;return t="ImportNamespaceSpecifier"===e.type?"*":"ImportDefaultSpecifier"===e.type?"default":"ImportSpecifier"===e.type?e.imported.name:null,{local:e.local?e.local.name:null,imported:t,fromModule:s,node:i}})))}else t.push({local:null,imported:null,fromModule:i.source.value,node:i})}return t},exports:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&j(e);var n=[],r=!0,i=!1,s=void 0;try{for(var u,a=function(){var t=u.value;if(!(c=q(e.node,t)))return"continue";if(p=c.source?c.source.value:null,"ExportAllDeclaration"===c.type)return n.push({local:null,exported:"*",imported:"*",fromModule:p,node:t,type:"all"}),"continue";if("ExportDefaultDeclaration"===c.type){if(Oe.isDeclaration(c.declaration))return n.push({local:c.declaration.id?c.declaration.id.name:null,exported:"default",type:"FunctionDeclaration"===c.declaration.type?"function":"ClassDeclaration"===c.declaration.type?"class":null,fromModule:null,node:t,decl:c.declaration,declId:c.declaration.id}),"continue";if("Identifier"===c.declaration.type){var r=e.resolvedRefMap.get(c.declaration)||{};return l=r.decl,h=r.declId,n.push({local:c.declaration.name,exported:"default",fromModule:null,node:t,type:"id",decl:l,declId:h}),"continue"}return n.push({local:null,exported:"default",fromModule:null,node:t,type:"expr",decl:c.declaration,declId:c.declaration}),"continue"}return c.specifiers&&c.specifiers.length?(n.push.apply(n,ge(c.specifiers.map(function(n){var r,i;if(p)r=t,i=n.exported;else if(n.local){var s=e.resolvedRefMap.get(n.local);r=s?s.decl:null,i=s?s.declId:null}return{local:!p&&n.local?n.local.name:null,exported:n.exported?n.exported.name:null,imported:p&&n.local?n.local.name:null,fromModule:p||null,type:"id",node:t,decl:r,declId:i}}))),"continue"):c.declaration&&c.declaration.declarations?(n.push.apply(n,ge(c.declaration.declarations.map(function(e){return{local:e.id?e.id.name:"default",exported:e.id?e.id.name:"default",type:c.declaration.kind,fromModule:null,node:t,decl:e,declId:e.id}}))),"continue"):c.declaration?(n.push({local:c.declaration.id?c.declaration.id.name:"default",exported:c.declaration.id?c.declaration.id.name:"default",type:"FunctionDeclaration"===c.declaration.type?"function":"ClassDeclaration"===c.declaration.type?"class":null,fromModule:null,node:t,decl:c.declaration,declId:c.declaration.id}),"continue"):void 0},o=e.exportDecls[Symbol.iterator]();!(r=(u=o.next()).done);r=!0){var c,p,l,h;a()}}catch(e){i=!0,s=e}finally{try{!r&&o.return&&o.return()}finally{if(i)throw s}}return t.arr.uniqBy(n,function(e,t){return e.local==t.local&&e.exported==t.exported&&e.fromModule==t.fromModule})}}),We=function(e){function t(){return ce(this,t),fe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return de(t,i),pe(t,[{key:"accept",value:function(e,n,r){return"ObjectExpression"===e.type&&(e=this.transformSpreadElement(e)),he(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,n,r)}},{key:"transformSpreadElement",value:function(e){var t=[],n=[t];return e.properties.forEach(function(e){"SpreadElement"!==e.type?t.push(e):(n.push(e),t=[],n.push(t))}),1===n.length?e:(t.length||n.pop(),D.apply(void 0,[E("Object","assign")].concat(ge(n.map(function(e){return"SpreadElement"===e.type?e.argument:{properties:e,type:"ObjectExpression"}})))))}}]),t}(),Ue=/^\s*(\{|function\s*\()/,Je=Object.freeze({replaceNode:z,replaceNodes:G,replace:function(e,t,n,r){var i="object"===(void 0===e?"undefined":oe(e))?e:null;return z(t,n,"string"==typeof e?e:i.source||W(i))},_compareNodesForReplacement:X,oneDeclaratorPerVarDecl:function(e){var t="object"===(void 0===e?"undefined":oe(e))?e:d(e),n="string"==typeof e?e:t.source||W(t),r=$(B(t)),i=[],s=!0,u=!1,a=void 0;try{for(var o,c=r[Symbol.iterator]();!(s=(o=c.next()).done);s=!0){var p=o.value;i.push({target:p,replacementFunc:function(e,t,n){return n&&(e=d(t).body[0]),e.declarations.map(function(e){return{type:"VariableDeclaration",kind:"var",declarations:[e]}})}})}}catch(e){u=!0,a=e}finally{try{!s&&c.return&&c.return()}finally{if(u)throw a}}return G(i,n)},oneDeclaratorForVarsInDestructoring:function(e){var t="object"===(void 0===e?"undefined":oe(e))?e:d(e),n="string"==typeof e?e:t.source||W(t),r=$(B(t)),i=[],s=!0,u=!1,a=void 0;try{for(var o,c=r[Symbol.iterator]();!(s=(o=c.next()).done);s=!0){var p=o.value;i.push({target:p,replacementFunc:function(e,t,n){n&&(e=d(t).body[0]);var r=[],i=!0,s=!1,u=void 0;try{for(var a,o=e.declarations[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){var c=a.value,p={type:"Identifier",name:"__temp"},l={type:"VariableDeclaration",kind:"var",declarations:[{type:"VariableDeclarator",id:p,init:c.init}]};r.push(l);var h=!0,f=!1,m=void 0;try{for(var y,g=Oe.objPropertiesAsList(c.id,[],!1)[Symbol.iterator]();!(h=(y=g.next()).done);h=!0){var v=y.value.key;r.push(x(v[v.length-2],b.apply(void 0,[p.name].concat(ge(v))),"var"))}}catch(e){f=!0,m=e}finally{try{!h&&g.return&&g.return()}finally{if(f)throw m}}}}catch(e){s=!0,u=e}finally{try{!i&&o.return&&o.return()}finally{if(s)throw u}}return r}})}}catch(e){u=!0,a=e}finally{try{!s&&c.return&&c.return()}finally{if(u)throw a}}return G(i,n)},returnLastStatement:Y,wrapInFunction:function(e,t){var n=Y(e,t=t||{});return t.asAST?F(A.apply(void 0,[{id:t.id||void 0},[]].concat(ge(n.body)))):"function"+(t.id?" "+t.id:"")+"() {\n"+n+"\n}"},wrapInStartEndCall:function(e,n){"string"==typeof e&&(e=d(e)),n=n||{};var r="Program"===e.type,i=n.startFuncNode||m("__start_execution"),s=n.endFuncNode||m("__end_execution"),u=N(e),a=e.body,o=[];u.forEach(function(n){var r=n.node,i=n.path;t.Path(i).set(e,g(r.id)),o.push(r)}),a.unshift(g(D(i)));var c=t.arr.last(a);return"ExpressionStatement"===c.type?(a.pop(),a.push(g(D(s,m("null"),c.expression)))):"VariableDeclaration"===c.type&&"Identifier"===t.arr.last(c.declarations).id.type?a.push(g(D(s,m("null"),t.arr.last(c.declarations).id))):a.push(g(D(s,m("null"),m("undefined")))),o.push(S.apply(void 0,["err",[g(D(s,m("err"),m("undefined")))]].concat(ge(a)))),r?F.apply(void 0,o):C.apply(void 0,o)},transformSingleExpression:function(e){if(!Ue.test(e)||e.split("\n").length>30)return e;try{var t=h(e);1===t.body.length&&("FunctionDeclaration"===t.body[0].type||"BlockStatement"===t.body[0].type&&"LabeledStatement"===t.body[0].body[0].type)&&(e="("+e.replace(/;\s*$/,"")+")")}catch(e){"undefined"!=typeof $world?$world.logError(e):console.error("Eval preprocess error: %s",e.stack||e)}return e},objectSpreadTransform:function(e){return(new We).accept(e,{},[])}}),Xe=Object.freeze({getCommentPrecedingNode:function(e,n){var r=q(e,n,{asPath:!0}).slice(0,-2),i=t.Path(r).get(e);return i.comments&&i.comments.length?t.chain(H(e)).reversed().detect(function(e){return e.followingNode===n}).value():null},extractComments:H}),ze=Object.freeze({findDecls:K}),Ge=/^(?!(?:do|if|in|for|let|new|try|var|case|default|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc][$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc0-9\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u0669\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u06f0-\u06f9\u0711\u0730-\u074a\u07a6-\u07b0\u07c0-\u07c9\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09cb-\u09cd\u09d7\u09e2\u09e3\u09e6-\u09ef\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d3e-\u0d44\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0d62\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0e50-\u0e59\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102b-\u103e\u1040-\u1049\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4-\u17d3\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u18a9\u1920-\u192b\u1930-\u193b\u1946-\u194f\u19b0-\u19c0\u19c8\u19c9\u19d0-\u19d9\u1a17-\u1a1b\u1a55-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b00-\u1b04\u1b34-\u1b44\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1b82\u1ba1-\u1bad\u1bb0-\u1bb9\u1be6-\u1bf3\u1c24-\u1c37\u1c40-\u1c49\u1c50-\u1c59\u1cd0-\u1cd2\u1cd4-\u1ce8\u1ced\u1cf2-\u1cf4\u1dc0-\u1de6\u1dfc-\u1dff\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua620-\ua629\ua66f\ua674-\ua67d\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua823-\ua827\ua880\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f1\ua900-\ua909\ua926-\ua92d\ua947-\ua953\ua980-\ua983\ua9b3-\ua9c0\ua9d0-\ua9d9\uaa29-\uaa36\uaa43\uaa4c\uaa4d\uaa50-\uaa59\uaa7b\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaeb-\uaaef\uaaf5\uaaf6\uabe3-\uabea\uabec\uabed\uabf0-\uabf9\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f]*$/,$e=d("").constructor;Object.defineProperty($e.prototype,"__serialize__",{configurable:!0,value:function(){return{__expr__:"("+JSON.stringify(this)+")"}}}),e.escodegen=xe,e.acorn=acorn,e.query=qe,e.transform=Je,e.comments=Xe,e.categorizer=ze,e.stringify=s,e.nodes=je,e.isValidIdentifier=function(e){return Ge.test(e)},e.BaseVisitor=i,e.withMozillaAstDo=we,e.printAst=Te,e.compareAst=Ie,e.pathToNode=Pe,e.rematchAstWithSource=Ne,e.ReplaceManyVisitor=ke,e.ReplaceVisitor=Be,e.parse=d,e.parseFunction=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=d("("+e+")",t);return Ce.run(n,function(n,r,i){n._positionFixed||(n._positionFixed=!0,(n.start||0===n.start)&&(n.start+=-1,n.end+=-1),t.addSource&&!n.source&&(n.source=e.slice(n.start,n.end)))}),n.body[0].expression},e.fuzzyParse=h}(this.lively.ast=this.lively.ast||{},lively.lang,e.escodegen,acorn)}.call(e),"undefined"!=typeof module&&module.exports&&(module.exports=e.lively.ast),t&&(e.define=t)}();
//LIVELY.CLASSES
!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;void 0===lively.lang&&(e.livey.lang={})}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(e,t,r){"use strict";function n(e){return e.hasOwnProperty(I)}function o(e){if(n(e)){var t=l(e),r=t.properties,o=t.propertySettings;e[M]={properties:r,propertySettings:o,classHierarchy:c(e)},r&&"object"===(void 0===r?"undefined":x(r))?i(e,o,r):console.warn("Class "+e.name+" indicates it has managed properties but its properties accessor ("+I+") does not return a valid property descriptor map")}}function i(e,t,r){a(e);var n=t.valueStoreProperty,o=t.defaultGetter,i=t.defaultSetter,l=e.prototype;Object.keys(r).forEach(function(e){var t=r[e],a=l.hasOwnProperty(e)&&l.__lookupGetter__(e);if(!a||a._wasGenerated){var s=t.get||"function"==typeof o&&function(){return o.call(this,e)}||function(){return this[n][e]};s._wasGenerated=!0,l.__defineGetter__(e,s)}var c=l.hasOwnProperty(e)&&l.__lookupSetter__(e);if((!c||c._wasGenerated)&&(t.hasOwnProperty("set")||!t.readOnly)){var u=t.set||"function"==typeof i&&function(t){i.call(this,e,t)}||function(t){this[n][e]=t};u._wasGenerated=!0,l.__defineSetter__(e,u)}})}function a(e){Object.defineProperty(e.prototype,"propertiesAndPropertySettings",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.constructor,t=e[M];if(t){if(t.classHierarchy==c(e))return t;var r=l(e),n=r.properties,o=r.propertySettings;e[M]={properties:n,propertySettings:o,classHierarchy:c(e)},i(e,o,n)}return e[M]||l(e)}}),Object.defineProperty(e.prototype,"initializeProperties",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.propertiesAndPropertySettings(),r=t.properties;return s(this,t.propertySettings,r,e),this}})}function l(e){for(var r=z({},F),n={},o=t.obj.valuesInPropertyHierarchy(e,"propertySettings"),i=t.obj.valuesInPropertyHierarchy(e,"properties"),a=0;a<o.length;a++){var l=o[a];l&&"object"===(void 0===l?"undefined":x(l))&&Object.assign(r,l)}for(a=0;a<i.length;a++){var s=i[a];if("object"===(void 0===s?"undefined":x(s)))for(var c in s)n.hasOwnProperty(c)?Object.assign(n[c],s[c]):n[c]=s[c];else console.error("[initializeProperties] "+e+" encountered property declaration that is not a JS object: "+s)}return{properties:n,propertySettings:r}}function s(e,r,n,o){var i=r.valueStoreProperty,a=t.obj.sortKeysWithBeforeAndAfterConstraints(n),l=[],s={};e.hasOwnProperty(i)||(e[i]={});for(v=0;v<a.length;v++){var c=a[v],u=n[c],p=u.derived,y=!!u.foldable,f=u.hasOwnProperty("defaultValue")?u.defaultValue:void 0;Array.isArray(f)&&(f=f.slice()),p||y||(e[i][c]=f);var d=void 0;u.hasOwnProperty("initialize")?(d=s[c]={initialize:f},l.push(c)):p&&void 0!==f?(d=s[c]={derived:f},l.push(c)):y&&void 0!==f&&(d=s[c]={folded:f},l.push(c)),o&&c in o&&(u.readOnly?console.warn("Trying to initialize read-only property "+c+" in "+e+", skipping setting value"):(d||(d=s[c]={},l.push(c)),d.value=o[c]))}for(var v=0;v<l.length;v++){var b=l[v],h=s[b],g=h.hasOwnProperty("value");if(h.hasOwnProperty("initialize")){var m=g?h.value:h.initialize;n[b].initialize.call(e,m),g&&(e[b]=h.value)}else h.hasOwnProperty("derived")?e[b]=g?h.value:h.derived:h.hasOwnProperty("folded")?e[b]=g?h.value:h.folded:g&&(e[b]=h.value)}}function c(e){var t=e,r=[];do{r.push(t),t=t[q]}while(t&&t.name);return r.map(function(e){return e.name}).join("->")}function u(e,t){var r=t?"function"==typeof t?t:t.value?t.value:Object:Object,n=e&&e[q];return n&&n===r||(d(r),e[q]=r,K(e.prototype,r.prototype),r!==Object&&K(e,r)),r}function p(e,t,r){if(r=Object.assign(r,U),r.value.displayName=r.key,r.needsDeclaringClass){var n=r.value.originalFunction||r.value;r.value=Object.assign(function(){return n.call.apply(n,[this,t].concat(Array.prototype.slice.call(arguments)))},{originalFunction:n,toString:function(){return n.toString()},displayName:r.key})}Object.defineProperty(e,r.key,r)}function y(e,t){t=Object.assign(t,L),Object.defineProperty(e,t.key,t)}function f(e,t,r){r&&r.forEach(function(t){t.value?p(e,e,t):y(e,t)}),t&&t.forEach(function(t){t.value?p(e.prototype,e,t):y(e.prototype,t)}),e.prototype[G]?Object.getOwnPropertySymbols(e.prototype).includes(G)&&e.prototype[G].isDefaultInitializer&&e[q].prototype[G]&&delete e.prototype[G]:(Object.defineProperty(e.prototype,G,{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),e.prototype[G].isDefaultInitializer=!0,e.prototype[G].displayName="lively-initialize");for(var n=t.map(function(e){return e.key}).concat(["constructor","arguments","caller"]),o=Object.getOwnPropertyNames(e.prototype),i=0;i<o.length;i++){var a=o[i];n.includes(a)||delete e.prototype[a]}for(var l=r.map(function(e){return e.key}).concat(["length","name","prototype","arguments","caller"]),s=Object.getOwnPropertyNames(e),c=0;c<s.length;c++){var u=s[c];l.includes(u)||delete e[u]}}function d(e){e===Object||e.prototype[G]||(Object.defineProperty(e.prototype,G,{enumerable:!1,configurable:!0,writable:!0,value:function(){e.apply(this,arguments)}}),e.prototype[G].displayName="lively-initialize-stub")}function v(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments[5],l=arguments[6],s=e.name,c=s&&i.hasOwnProperty(s)&&i[s],p=c&&c[q];c&&"function"==typeof c&&p||(c=e);u(c,t);if(f(c,r,n),c[V]=l,a){var y=a.package(),d=c[J],v=Date.now();c[J]={package:y?{name:y.name,version:y.version}:{},pathInPackage:y?a.pathInPackage():a.id,lastChange:d&&d.lastChange&&v<=d.lastChange?d.lastChange+1:v,lastSuperclassChange:0},t&&t.referencedAs&&(c.hasOwnProperty(W)&&a.unsubscribeFromToplevelDefinitionChanges(c[W]),c[W]=a.subscribeToToplevelDefinitionChanges(function(e,i){if(e===t.referencedAs){var a=i&&i[J],l=c[J];if(a){if(a.lastChange===l.lastSuperclassChange)return;l.lastSuperclassChange=a.lastChange}u(c,i),f(c,r,n),o(c)}}))}return c.toString=function(){var e=String(this.prototype[G]).match(B),t=this.name,r=this[q];return"class "+t+" "+(r?"extends "+r.name:"")+" {\n  constructor"+(e?e[0]:"()")+" { /*...*/ }\n}"},o(c),c}function b(e){return"ArrowFunctionExpression"===e.type||"FunctionExpression"===e.type||"FunctionDeclaration"===e.type}function h(e){return e.replace(ce,"_").replace(ue,"_")}function g(e){return oe({id:e?Z(e):null},["__first_arg__"],le(ae(Z("__first_arg__"),"&&",Y("__first_arg__",ee(Y("Symbol","for"),te("lively-instance-restorer")),!0)),se(),se($(ee(Y(Y("this",ee(Y("Symbol","for"),te("lively-instance-initialize")),!0),"apply"),Z("this"),Z("arguments"))))))}function m(e,t,n,o){console.assert("Super"===e.type);var i=t.currentMethod;i||console.warn("[lively.classes] Trying to transform es6 class but got super call outside a method! "+r.stringify(e)+" in "+n.join("."));var a=n.slice(-2),l=H(a,2),s=l[0],c=l[1];return"callee"===s&&"object"===c||"callee"===c?e:i&&"static"===i[ye]?ee(Y("Object","getPrototypeOf"),Z(fe)):ee(Y("Object","getPrototypeOf"),Y(Z(fe),"prototype"))}function _(e,t,r,n){return console.assert("CallExpression"===e.type),console.assert("Super"===e.callee.object.type),ee.apply(void 0,[Y(ee(Y(n.functionNode,"_get"),m(e.callee.object,t,r.concat(["callee","object"]),n),te(e.callee.property.value||e.callee.property.name),Z("this")),"call"),Z("this")].concat(N(e.arguments)))}function O(e,t,r,n){return console.assert("CallExpression"===e.type),console.assert("Super"===e.callee.type),ee.apply(void 0,[Y(ee(Y(n.functionNode,"_get"),m(e.callee,t,r.concat(["callee"]),n),ee(Y("Symbol","for"),te("lively-instance-initialize")),Z("this")),"call"),Z("this")].concat(N(e.arguments)))}function j(e,t,r,n){return console.assert("MemberExpression"===e.type),console.assert("Super"===e.object.type),ee(Y(n.functionNode,"_get"),m(e.object,t,r.concat(["object"]),n),te(e.property.value||e.property.name),Z("this"))}function S(e,t,r,n){return console.assert("AssignmentExpression"===e.type),console.assert("Super"===e.left.object.type),ee(Y(n.functionNode,"_set"),m(e.left.object,t,r.concat(["left","object"]),n),te(e.left.property.value||e.left.property.name),e.right,Z("this"))}function w(e,t,n,o){console.assert("ClassDeclaration"===e.type||"ClassExpression"===e.type);var i=e.body.body,a=e.superClass,l=e.id,s=e.type,c=e.start,u=e.end,p=Z("undefined"),y=Z("undefined"),f=l?l.name:"anonymous_class",d=o.evalId,v=o.sourceAccessorName,b=e["x-lively-object-meta"]||{start:c,end:u};if(i.length){var m=i.reduce(function(e,t){var r,n=t.key,o=t.kind,i=t.value,a=t.static;if("Literal"!==n.type&&"Identifier"!==n.type&&console.warn("Unexpected key in classToFunctionTransform! "+JSON.stringify(n)),"method"===o){var l=Z(f+"_"+h(n.name||n.value)+"_"),s=["key",te(n.name||n.value),"value",z({},i,E({id:l},ye,a?"static":"proto"))];r=re(s)}else if("get"===o||"set"===o)r=re(["key",te(n.name||n.value),o,Object.assign({},i,E({id:Z(o)},ye,a?"static":"proto"))]);else if("constructor"===o){var c=["key",ee(Y("Symbol","for"),te("lively-instance-initialize")),"value",z({},i,E({id:Z(f+"_initialize_")},ye,"proto"))];r=re(c)}else console.warn("[lively.classes] classToFunctionTransform encountered unknown class property with kind "+o+", ignoring it, "+JSON.stringify(t));return(a?e.clazz:e.inst).push(r),e},{inst:[],clazz:[]}),_=m.inst,O=m.clazz;_.length&&(p={type:"ArrayExpression",elements:_}),O.length&&(y={type:"ArrayExpression",elements:O})}var j,S,w=o.scope;if(a&&o.currentModuleAccessor)if(o.classHolder===a.object)S=a,j=a.property.name;else{var P=w&&w.resolvedRefMap&&w.resolvedRefMap.get(a);P&&P.decl&&w.decls&&w.decls.find(function(e){return H(e,1)[0]===P.decl})&&(S=a,j=a.name)}var x=S?re(["referencedAs",te(j),"value",S]):a||Z("undefined"),k=l&&"ClassDeclaration"===s,C=["start",te(b.start),"end",te(b.end)];void 0!==d&&C.push("evalId",te(d)),v&&C.push("moduleSource",r.nodes.id(v));var A=re(C),D=ee(oe({},["superclass"],ne(de,t.classHolder),ne(fe,k?{type:"ConditionalExpression",test:ae(ee(Y(de,"hasOwnProperty"),te(l.name)),"&&",ae({argument:Y(de,l),operator:"typeof",prefix:!0,type:"UnaryExpression"},"===",te("function"))),consequent:Y(de,l),alternate:X(Y(de,l),g(l.name))}:g(l?l.name:null)),ie(ee(o.functionNode,Z(fe),Z("superclass"),p,y,Z(de),o.currentModuleAccessor||Z("undefined"),A))),x);if("ClassExpression"===s)return D;var T=D;return o.declarationWrapper&&t.classHolder===o.classHolder&&(T=ee(o.declarationWrapper,te(l.name),te("class"),T,o.classHolder,A)),T=ne(l,T,"var"),T[pe]=!0,T}function P(e,t,r,n){return e.declaration&&e.declaration[pe]?[e.declaration,{declaration:e.declaration.declarations[0].id,type:"ExportDefaultDeclaration"}]:e}var x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k=(function(){function e(e){this.value=e}function t(t){function r(o,i){try{var a=t[o](i),l=a.value;l instanceof e?Promise.resolve(l.value).then(function(e){r("next",e)},function(e){r("throw",e)}):n(a.done?"return":"normal",a.value)}catch(e){n("throw",e)}}function n(e,t){switch(e){case"return":o.resolve({value:t,done:!0});break;case"throw":o.reject(t);break;default:o.resolve({value:t,done:!1})}(o=o.next)?r(o.key,o.arg):i=null}var o,i;this._invoke=function(e,t){return new Promise(function(n,a){var l={key:e,arg:t,resolve:n,reject:a,next:null};i?i=i.next=l:(o=i=l,r(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),C=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),E=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},A=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(n)},D=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},T=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},H=function(){function e(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,l=e[Symbol.iterator]();!(n=(a=l.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&l.return&&l.return()}finally{if(o)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),N=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},I="properties",M=Symbol.for("lively.classes-properties-and-settings"),F={defaultSetter:null,defaultGetter:null,valueStoreProperty:"_state"},G=Symbol.for("lively-instance-initialize"),R=Symbol.for("lively-instance-restorer"),q=Symbol.for("lively-instance-superclass"),J=Symbol.for("lively-module-meta"),V=Symbol.for("lively-object-meta"),W=Symbol.for("lively-klass-changes-subscriber"),B=/\([^\\)]*\)/,L={enumerable:!1,configurable:!0},U={enumerable:!1,configurable:!0,writable:!0},K="function"==typeof Object.setPrototypeOf?function(e,t){return Object.setPrototypeOf(e,t)}:function(e,t){return e.__proto__=t};v._get=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0===a?void 0:a.call(n)},v._set=function e(t,r,n,o){var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,o)}else if("value"in i&&i.writable)i.value=n;else{var l=i.set;void 0!==l&&l.call(o,n)}return n};var Q=Object.freeze({initializeSymbol:G,instanceRestorerSymbol:R,superclassSymbol:q,moduleMetaSymbol:J,objMetaSymbol:V,moduleSubscribeToToplevelChangesSym:W,getClassHierarchy:c,setPrototypeOf:K,adoptObject:function(e,t){t!==e.constructor&&(e.constructor=t,K(e,t.prototype))},setSuperclass:u,initializeClass:v}),X=r.nodes.assign,Y=r.nodes.member,Z=r.nodes.id,$=r.nodes.exprStmt,ee=r.nodes.funcCall,te=r.nodes.literal,re=r.nodes.objectLiteral,ne=r.nodes.varDecl,oe=r.nodes.funcExpr,ie=r.nodes.returnStmt,ae=r.nodes.binaryExpr,le=r.nodes.ifStmt,se=r.nodes.block,ce=/^[^_a-z]/i,ue=/[^_a-z0-9]/gi,pe=Symbol(),ye=Symbol(),fe="__lively_class__",de="__lively_classholder__",ve=function(e){function t(){return k(this,t),T(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return D(t,e),C(t,[{key:"accept",value:function(e,r,n){return b(e)&&(r=z({},r,{classHolder:re([]),currentMethod:e[ye]?e:r.currentMethod})),"ClassExpression"!==e.type&&"ClassDeclaration"!==e.type||(e=w(e,r,0,r.options)),"Super"===e.type&&(e=m(e,r,n,r.options)),"MemberExpression"===e.type&&e.object&&"Super"===e.object.type&&(e=j(e,r,n,r.options)),"AssignmentExpression"===e.type&&"MemberExpression"===e.left.type&&"Super"===e.left.object.type&&(e=S(e,r,n,r.options)),"CallExpression"===e.type&&"Super"===e.callee.type&&(e=O(e,r,n,r.options)),"CallExpression"===e.type&&e.callee.object&&"Super"===e.callee.object.type&&(e=_(e,r,n,r.options)),"ExportDefaultDeclaration"===(e=A(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,r,n)).type?P(e,0,0,r.options):e}}],[{key:"run",value:function(e,t){var r=new this,n=t.classHolder||re([]);return r.accept(e,{options:t,classHolder:n},[])}}]),t}(r.BaseVisitor);e.runtime=Q,e.classToFunctionTransform=function(e,t){var n="string"==typeof e?r.parse(e):e;return t.scope=r.query.resolveReferences(r.query.scopes(n)),ve.run(n,t)}}(this.lively.classes=this.lively.classes||{},lively.lang,lively.ast),"undefined"!=typeof module&&module.exports&&(module.exports=e.lively.classes)}();
//LIVELY.SOURCE-TRANSFORM
!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;void 0===lively.lang&&(e.livey.lang={})}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(e,r,t,n){"use strict";function a(e,r){var t=B(e),a=t.refs.filter(function(e){return u(e,t,r)}),o=[],i=n.ReplaceVisitor.run(e,function(e,t){if("Property"===e.type&&a.includes(e.key)&&e.shorthand)return P(C(e.key.name),e.value);if("ExportNamedDeclaration"===e.type){var n=e.declaration,i=e.specifiers;return n&&(n.id?o.push(n.id):n.declarations&&o.push.apply(o,_(n.declarations.map(function(e){return e.id})))),i&&i.forEach(function(e){var r=e.local;return o.push(r)}),e}return"AssignmentExpression"===e.type&&a.includes(e.left)&&r.declarationWrapper?A({},e,{right:N(r.declarationWrapper,null,L(e.left.name),L("assignment"),e.right,r.captureObj,r)}):e});return n.ReplaceVisitor.run(i,function(e,t,n){return a.includes(e)&&!o.includes(e)?T(r.captureObj,e):e})}function o(e,r){var t=B(e);return n.ReplaceManyVisitor.run(e,function(e){if(!t.varDecls.includes(e)||e.declarations.every(function(e){return!s(e,r)}))return e;for(var n=[],a=0;a<e.declarations.length;a++){var o=e.declarations[a];if(s(o,r)){var c=o.init||{operator:"||",type:"LogicalExpression",left:{computed:!1,object:r.captureObj,property:o.id,type:"MemberExpression"},right:{name:"undefined",type:"Identifier"}},l=r.declarationWrapper&&o.id.name?N(r.declarationWrapper,o,L(o.id.name),L(e.kind),c,r.captureObj,r):c;if(o.id.type.includes("Pattern")){var u=i(t.declaredNames,"destructured_1"),d={type:"Identifier",name:u},p={parent:d,declaredNames:t.declaredNames},f=g(o.id,p).map(function(t){return t[H]&&t[H].capture?O(r.captureObj,t.declarations[0].id,r.declarationWrapper?N(r.declarationWrapper,null,L(t.declarations[0].id.name),L(e.kind),t.declarations[0].init,r.captureObj,r):t.declarations[0].init,!1):t});t.declaredNames.push(u),n.push.apply(n,_([W(d,l,e.kind)].concat(f)))}else n.push(O(r.captureObj,o.id,l,!1)),r.keepTopLevelVarDecls&&n.push(W(o.id,T(r.captureObj,o.id)))}else n.push({type:"VariableDeclaration",kind:e.kind||"var",declarations:[o]})}return n})}function i(e,r){for(var t=r,n=1;e.indexOf(t)>-1;){if(n>1e3)throw new Error("Endless loop searching for unique variable "+t);t=t.replace(/_[0-9]+$|$/,"_"+ ++n)}return t}function c(e,t){for(var n=B(e),a=[],o=0;o<n.scope.varDecls.length;o++){var i=n.scope.varDecls[o],c=r.Path(n.scope.varDeclPaths[o]).slice(0,-1).get(e);"ForStatement"!==c.type&&"ForInStatement"!==c.type&&"ForOfStatement"!==c.type&&"ExportNamedDeclaration"!==c.type||a.push.apply(a,_(i.declarations))}return n.scope.catches.map(function(e){return e.name}).concat(a.map(function(e){return e.id.name}))}function l(e,t){for(var n=B(e),a=[],o=0;o<n.scope.varDecls.length;o++){var i=n.scope.varDecls[o],c=r.Path(n.scope.varDeclPaths[o]).slice(0,-1).get(e);"ForStatement"!==c.type&&"ForInStatement"!==c.type&&"ForOfStatement"!==c.type||a.push.apply(a,_(i.declarations))}return n.scope.catches.map(function(e){return e.name}).concat(z.declIds(a.map(function(e){return e.id})).map(function(e){return e.name}))}function s(e,r){return-1===r.excludeDecls.indexOf(e.id.name)&&(!r.includeDecls||r.includeDecls.indexOf(e.id.name)>-1)}function u(e,r,t){if(r.scope.importSpecifiers.includes(e))return!1;for(var n=0;n<r.scope.exportDecls.length;n++){var a=r.scope.exportDecls[n];if(a.declarations&&a.declarations.includes(e))return!1;if(a.declaration===e)return!1}return!t.excludeRefs.includes(e.name)&&!(t.includeRefs&&!t.includeRefs.includes(e.name))}function d(e,r){if(r.classToFunction)return t.classToFunctionTransform(e,r.classToFunction);var n=B(e);if(!n.classDecls.length)return e;for(var a=e.body.length-1;a>=0;a--){var o=e.body[a];o.id&&n.classDecls.includes(o)&&e.body.splice(a+1,0,O(r.captureObj,o.id,o.id,!1))}return e}function p(e,r){for(var t=e.body,n=e.body=[],a=0;a<t.length;a++){var o=t[a];if("ExportNamedDeclaration"!==o.type||!o.declaration||"VariableDeclaration"!==o.declaration.type||o.declaration.declarations.length<=1)n.push(o);else for(var i=o.declaration.declarations,c=0;c<i.length;c++)n.push({type:"ExportNamedDeclaration",specifiers:[],declaration:W(i[c].id,i[c].init,o.declaration.kind)})}return e}function f(e,t){for(var n=[],a=0;a<e.body.length;a++){var o=e.body[a];if(n.push(o),"ExportNamedDeclaration"!==o.type&&"ExportDefaultDeclaration"!==o.type||!o.declaration);else if("ExportDefaultDeclaration"===o.type&&"Literal"===o.declaration.type){var c=o.declaration,l=(c.raw,i(B(e).declaredNames,"$"+c.raw.split('"').join("")));o.declaration=C(l),r.arr.pushAt(n,O(t.captureObj,l,c.raw,!1),n.indexOf(o))}else o.declaration.declarations?n.push.apply(n,_(o.declaration.declarations.map(function(e){var r=e.id;return t.declarationWrapper&&(e.init.callee&&e.init.callee.name===t.declarationWrapper.name||(r=N(t.declarationWrapper,e,L(e.id.name),L("assignment"),e.id,t.captureObj,t))),O(t.captureObj,e.id,r,!1)}))):"FunctionDeclaration"===o.declaration.type||"ClassDeclaration"===o.declaration.type&&n.push(O(t.captureObj,o.declaration.id,o.declaration.id,!1))}return e.body=n,e}function m(e,r){return e.body=e.body.reduce(function(e,t){return e.concat("ImportDeclaration"===t.type&&t.specifiers.length?[t].concat(t.specifiers.map(function(e){return O(r.captureObj,e.local,e.local,!1)})):[t])},[]),e}function y(e,r){for(var t=B(e),n=[],a=0;a<e.body.length;a++){var o=e.body[a];"ExportDefaultDeclaration"!==o.type||!o.declaration||o.declaration.type.includes("Declaration")||"Identifier"!==o.declaration.type&&!o.declaration.id?"ExportNamedDeclaration"!==o.type||!o.specifiers.length||o.source?n.push(o):n=n.concat(o.specifiers.map(function(n){return t.declaredNames.includes(n.local.name)?null:I(e,{type:"VariableDeclarator",id:n.local,init:T(r.captureObj,n.local)})}).filter(Boolean)).concat(o):n=n.concat([I(e,{type:"VariableDeclarator",id:o.declaration,init:T(r.captureObj,o.declaration)}),o])}return e.body=n,e}function v(e,r){for(var t=[],n=0;n<e.body.length;n++){var a=e.body[n];"ExportDefaultDeclaration"===a.type&&"FunctionDeclaration"===a.declaration.type&&a.declaration.id&&a.declaration.async&&(t.push(a.declaration),a.declaration={type:"Identifier",name:a.declaration.id.name}),t.push(a)}return e.body=t,e}function h(e,r){return e.body=e.body.reduce(function(t,n){var a;if("ExportNamedDeclaration"===n.type)if(n.source){i=c=n.source;a=n.specifiers.map(function(e){return{type:"ExpressionStatement",expression:j({type:"Literal",value:e.exported.name},{type:"Literal",value:e.local.name},c,r.moduleExportFunc,r.moduleImportFunc)}})}else if(n.declaration){var o=n.declaration.declarations;a=o?o.map(function(e){return r.excludeDecls.push(e.id),W(e.id,O(r.captureObj,e.id,r.declarationWrapper?N(r.declarationWrapper,null,L(e.id.name),L(n.declaration.kind),e,r.captureObj,r):e.init,!1),n.declaration.kind)}).concat(o.map(function(e){return R(r.moduleExportFunc,e.id.name,e.id)})):[n.declaration].concat(R(r.moduleExportFunc,n.declaration.id.name,n.declaration.id))}else a=n.specifiers.map(function(e){return R(r.moduleExportFunc,e.exported.name,s({id:e.local},r)?T(r.captureObj,e.local):e.local)});else if("ExportDefaultDeclaration"===n.type)a=n.declaration&&n.declaration.id?[n.declaration].concat(R(r.moduleExportFunc,"default",n.declaration.id)):[R(r.moduleExportFunc,"default",n.declaration)];else if("ExportAllDeclaration"===n.type){var i={name:r.es6ExportFuncId+"__iterator__",type:"Identifier"},c=n.source;a=[{type:"ForInStatement",body:{type:"ExpressionStatement",expression:j(i,i,c,r.moduleExportFunc,r.moduleImportFunc)},left:{type:"VariableDeclaration",kind:"var",declarations:[{type:"VariableDeclarator",id:i,init:null}]},right:S(null,c,r.moduleImportFunc)}],r.excludeRefs.push(i.name),r.excludeDecls.push(i.name)}else a="ImportDeclaration"===n.type?n.specifiers.length?n.specifiers.map(function(t){var a=t.local,o="ImportSpecifier"===t.type&&t.imported.name||"ImportDefaultSpecifier"===t.type&&"default"||null;return w(e,a,o||null,n.source,r.moduleImportFunc)}):F(null,n.source,r.moduleImportFunc):[n];return t.concat(a)},[]),e}function b(e,t){var n=B(e).scope,a=n.funcDecls;if(!a.length)return e;for(var o=[],i=a.length;i--;){var c=a[i];if(c.id&&s(c,t)){var l=n.funcDeclPaths[i].slice(0,-1),u=r.Path(l).get(n.node),d={type:"Identifier",name:c.id.name},p=t.declarationWrapper?N(t.declarationWrapper,c,L(d.name),L("function"),d,t.captureObj,t):d,f=A({},c);if(Array.isArray(u))u.splice(u.indexOf(c),1,M(c.id));else if("ExportNamedDeclaration"===u.type){var m=n.node.body.indexOf(u);m>-1&&n.node.body.splice(m,1,{type:"ExportNamedDeclaration",specifiers:[{type:"ExportSpecifier",exported:c.id,local:c.id}]})}else"ExportDefaultDeclaration"===u.type&&(u.declaration=c.id);o.unshift(O(t.captureObj,d,p,!1)),o.unshift(f)}}return e.body=o.concat(e.body),e}function x(e,t){var n=B(e);return r.chain(n.scope.varDecls).pluck("declarations").flatten().value().concat(n.scope.funcDecls.filter(function(e){return e.id})).reduce(function(e,r){return e[r.id.name]||(e[r.id.name]=[]),e[r.id.name].push({type:r.type,start:r.start,end:r.end}),e},{})}function g(e,r){return"ArrayPattern"===e.type?D(e,r):"ObjectPattern"===e.type?E(e,r):[]}function D(e,r){for(var t=r.declaredNames,n=H,a=[],o=0;o<e.elements.length;o++){var c=e.elements[o];if("Identifier"===c.type)(l=W(c,T(r.parent,C(o),!0)))[n]={capture:!0},a.push(l);else if("RestElement"===c.type)(l=W(c.argument,{type:"CallExpression",arguments:[{type:"Literal",value:o}],callee:T(r.parent,C("slice"),!1)}))[n]={capture:!0},a.push(l);else if("AssignmentPattern"==c.type){var l=W(c.left,$(U(T(r.parent,C(o),!0),"===",C("undefined")),c.right,T(r.parent,C(o),!0)));l[n]={capture:!0},a.push(l)}else{var s=C(i(t,r.parent.name+"$"+o)),u=W(s,T(r.parent,o));t.push(s.name),a.push(u),a.push.apply(a,_(g(c,{parent:s,declaredNames:t})))}}return a}function E(e,r){for(var t=r.declaredNames,a=H,o=[],c=0;c<e.properties.length;c++){var l=e.properties[c];if("RestElement"==l.type){var s=e.properties.map(function(e){return e.key&&e.key.name}).filter(Boolean),u=n.nodes.varDecl(l.argument.name,n.nodes.objectLiteral([])),d=n.nodes.varDecl(l.argument.name,C(l.argument.name)),p=n.nodes.exprStmt(n.nodes.funcCall(n.nodes.funcExpr({},[],n.nodes.forIn("__key",r.parent,n.nodes.block.apply(n.nodes,_(s.length?s.map(function(e){return n.nodes.ifStmt(n.nodes.binaryExpr(n.nodes.id("__key"),"===",n.nodes.literal(e)),{type:"ContinueStatement",label:null},null)}):[]).concat([n.nodes.exprStmt(n.nodes.assign(n.nodes.member(l.argument.name,n.nodes.id("__key"),!0),n.nodes.member(r.parent,n.nodes.id("__key"),!0)))]))))));d[a]={capture:!0},o.push(u,d,p)}else if("Identifier"==l.value.type)(u=W(l.value,T(r.parent,l.key)))[a]={capture:!0},o.push(u);else if("AssignmentPattern"==l.value.type)(u=W(l.value.left,$(U(T(r.parent,l.key),"===",C("undefined")),l.value.right,T(r.parent,l.key))))[a]={capture:!0},o.push(u);else{var f=C(i(t,r.parent.name+"$"+l.key.name)),m=W(f,T(r.parent,l.key));m[a]={capture:!1},t.push(f.name),o.push.apply(o,_([m].concat(g(l.value,{parent:f,declaredNames:t}))))}}return o}function I(e,r,t){var n=B(e),a=r.id.name;return n.declaredNames.indexOf(a)>-1?M(V(r.id,r.init)):{declarations:[r],kind:t||"var",type:"VariableDeclaration"}}function O(e,r,t,n){return M(V(T(e,r,n),t||C("undefined")))}function j(e,r,t,n,a){return k(n,e,S(r,t,a))}function w(e,r,t,n,a){return W(r,S(t,n,a))}function S(e,r,t){return"string"==typeof e&&(e=L(e)),{arguments:[r].concat(e||[]),callee:t,type:"CallExpression"}}function F(e,r,t){return M(S(e,r,t))}function k(e,t,n){return"string"==typeof t&&(t=L(t)),n=r.obj.deepCopy(n),q(e,t,n)}function R(e,r,t){return M(k(e,r,t))}function N(e,r,t,a,o,i,c){if(r){var l=[],s=!1;if(r["x-lively-object-meta"]){var u=r["x-lively-object-meta"],d=u.start,p=u.end,f=u.evalId,m=u.sourceAccessorName;s=!0,l.push("start",n.nodes.literal(d),"end",n.nodes.literal(p))}if(void 0===f&&c.hasOwnProperty("evalId")&&(f=c.evalId,s=!0),void 0===m&&c.hasOwnProperty("sourceAccessorName")&&(m=c.sourceAccessorName,s=!0),void 0!==f&&l.push("evalId",n.nodes.literal(f)),m&&l.push("moduleSource",n.nodes.id(m)),s)return q(e,t,a,o,i,n.nodes.objectLiteral(l))}return q(e,t,a,o,i)}!function(){function e(e){this.value=e}function r(r){function t(a,o){try{var i=r[a](o),c=i.value;c instanceof e?Promise.resolve(c.value).then(function(e){t("next",e)},function(e){t("throw",e)}):n(i.done?"return":"normal",i.value)}catch(e){n("throw",e)}}function n(e,r){switch(e){case"return":a.resolve({value:r,done:!0});break;case"throw":a.reject(r);break;default:a.resolve({value:r,done:!1})}(a=a.next)?t(a.key,a.arg):o=null}var a,o;this._invoke=function(e,r){return new Promise(function(n,i){var c={key:e,arg:r,resolve:n,reject:i,next:null};o?o=o.next=c:(a=o=c,t(e,r))})},"function"!=typeof r.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(r.prototype[Symbol.asyncIterator]=function(){return this}),r.prototype.next=function(e){return this._invoke("next",e)},r.prototype.throw=function(e){return this._invoke("throw",e)},r.prototype.return=function(e){return this._invoke("return",e)}}();var A=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},_=function(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)},T=n.nodes.member,P=n.nodes.prop,W=n.nodes.varDecl,V=n.nodes.assign,C=n.nodes.id,L=n.nodes.literal,M=n.nodes.exprStmt,$=n.nodes.conditional,U=n.nodes.binaryExpr,q=n.nodes.funcCall,B=n.query.topLevelDeclsAndRefs,z=n.query.helpers,H=Symbol("lively.ast-destructuring-transform"),G=Object.freeze({rewriteToCaptureTopLevelVariables:function(e,t,n){t||(t={type:"Identifier",name:"__rec"});var i=e;if((n=A({ignoreUndeclaredExcept:null,includeRefs:null,excludeRefs:n&&n.exclude||[],includeDecls:null,excludeDecls:n&&n.exclude||[],recordDefRanges:!1,es6ExportFuncId:null,es6ImportFuncId:null,captureObj:t,moduleExportFunc:{name:n&&n.es6ExportFuncId||"_moduleExport",type:"Identifier"},moduleImportFunc:{name:n&&n.es6ImportFuncId||"_moduleImport",type:"Identifier"},declarationWrapper:void 0,classToFunction:n&&n.hasOwnProperty("classToFunction")?n.classToFunction:{classHolder:t,functionNode:{type:"Identifier",name:"_createOrExtendClass"},declarationWrapper:n&&n.declarationWrapper,evalId:n&&n.evalId,sourceAccessorName:n&&n.sourceAccessorName}},n)).ignoreUndeclaredExcept){var s=B(e);n.excludeRefs=r.arr.withoutAll(s.undeclaredNames,n.ignoreUndeclaredExcept).concat(n.excludeRefs),n.excludeDecls=r.arr.withoutAll(s.undeclaredNames,n.ignoreUndeclaredExcept).concat(n.excludeDecls)}n.excludeRefs=n.excludeRefs.concat(n.captureObj.name),n.excludeDecls=n.excludeDecls.concat(n.captureObj.name);n.recordDefRanges&&x(i);return n.excludeRefs=n.excludeRefs.concat(l(e)),n.excludeDecls=n.excludeDecls.concat(c(e)),i=v(i),n.es6ExportFuncId&&(n.excludeRefs.push(n.es6ExportFuncId),n.excludeRefs.push(n.es6ImportFuncId),i=h(i,n)),i=a(i,n),i=o(i,n),i=d(i,n),i=p(i),i=f(i,n),i=m(i,n),i=y(i,n),i=b(i,n)},rewriteToRegisterModuleToCaptureSetters:function(e,t,a){a=A({captureObj:t||{type:"Identifier",name:"__rec"},exclude:[],declarationWrapper:void 0},a);var o=r.Path("body.0.expression").get(e);if("System"!==o.callee.object.name)throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call: "+n.stringify(e).slice(0,300)+"...");if("register"!==o.callee.property.name)throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call: "+n.stringify(e).slice(0,300)+"...");var i=r.Path("arguments.1.body.body").get(o),c=r.arr.last(i);if("ReturnStatement"!==c.type)throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call, at return statement: "+n.stringify(e).slice(0,300)+"...");var l=c.argument.properties.find(function(e){return"setters"===e.key.name});if(!l)throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call, at finding setters: "+n.stringify(e).slice(0,300)+"...");var s=c.argument.properties.find(function(e){return"execute"===e.key.name});if(!s)throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call, at finding execute: "+n.stringify(e).slice(0,300)+"...");l.value.elements.forEach(function(e){return e.body.body=e.body.body.map(function(e){if("ExpressionStatement"!==e.type||"AssignmentExpression"!==e.expression.type||"Identifier"!==e.expression.left.type||r.arr.include(a.exclude,e.expression.left.name))return e;var t=e.expression.left,n=a.declarationWrapper?N(a.declarationWrapper,null,L(t.name),L("var"),e.expression,a.captureObj,a):e.expression;return M(V(T(a.captureObj,t),n))})});var u=s.value.body.body.find(function(e){return"ExpressionStatement"===e.type&&"AssignmentExpression"==e.expression.type&&e.expression.left.name===a.captureObj.name});if(u||(u=s.value.body.body.find(function(e){return"VariableDeclaration"===e.type&&e.declarations[0].id&&e.declarations[0].id.name===a.captureObj.name})),u&&(r.arr.remove(s.value.body.body,u),r.arr.pushAt(i,u,i.length-1)),a.sourceAccessorName){var d=s.value.body.body.find(function(e){return"ExpressionStatement"===e.type&&"AssignmentExpression"==e.expression.type&&e.expression.left.name===a.sourceAccessorName});d||(d=s.value.body.body.find(function(e){return"VariableDeclaration"===e.type&&e.declarations[0].id&&e.declarations[0].id.name===a.sourceAccessorName})),d&&(r.arr.remove(s.value.body.body,d),r.arr.pushAt(i,d,i.length-1))}return e}});e.capturing=G,e.stringifyFunctionWithoutToplevelRecorder=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"__lvVarRecorder";"function"==typeof e&&(e=String(e));var t="string"==typeof e?n.parseFunction(e):e,a=n.ReplaceVisitor.run(t,function(e){return"MemberExpression"===e.type&&"Identifier"===e.object.type&&e.object.name===r?e.property:e});return n.stringify(a)}}(this.lively.sourceTransform=this.lively.sourceTransform||{},lively.lang,lively.classes,lively.ast),"undefined"!=typeof module&&module.exports&&(module.exports=e.lively.sourceTransform)}();
//LIVELY.VM
!function(){var GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(exports,lively_lang,lively_ast,lively_sourceTransform,lively_classes,lively_notifications){"use strict";function getGlobal(){return"undefined"!=typeof System?System.global:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof Global?Global:"undefined"!=typeof self?self:function(){return this}()}function signatureOf(e,t){var r=String(t).match(/function\s*[a-zA-Z0-9_$]*\s*\(([^\)]*)\)/);return e+"("+(r&&r[1]||"")+")"}function pluck(e,t){return e.map(function(e){return e[t]})}function printSymbol(e){if(Symbol.keyFor(e))return'Symbol.for("'+Symbol.keyFor(e)+'")';if(knownSymbols.get(e))return knownSymbols.get(e);String(e).match(symMatcher);return String(e)}function safeToString(e){if(!e)return String(e);if(Array.isArray(e))return"["+e.map(safeToString).join(",")+"]";if("symbol"===(void 0===e?"undefined":_typeof(e)))return printSymbol(e);try{return String(e)}catch(e){throw new Error("Cannot print object: "+e.stack)}}function printEvalResult(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.value,n=e.isError,o=e.isPromise,a=e.promisedValue,i=e.promiseStatus;if(n||r instanceof Error){var l=r,s=String(l),u=l.stack||"";return u&&l.message!==l.stack&&(0===(u=String(u)).indexOf(s)&&(u=u.slice(s.length)),s+="\n"+u),s}if(o){var c=lively_lang.string.print(i),p="pending"===i?void 0:printEvalResult({value:a},t);return"Promise({status: "+c+", "+(void 0===r?"":"value: "+p)+"})"}return r instanceof Promise?'Promise({status: "unknown"})':t.inspect?printInspectEvalValue(r,t.inspectDepth||2):String(r)}function getObjectForCompletion(e,t){var r="";return Promise.resolve().then(function(){var n=t.lastIndexOf(".");return n>=0?(r=t.slice(n+1),t=t.slice(0,n)):(r=t,t='(typeof window === "undefined" ? global : window)'),e(t)}).then(function(e){return{evalResult:e,startLetters:r,code:t}})}function propertyExtract(e,t,r){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t).map(printSymbol)).filter(function(t){return-1===e.indexOf(t)}).map(r).filter(function(e){return!!e}).sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})}function getMethodsOf(e,t){return propertyExtract(e,t,function(e){return t.__lookupGetter__&&t.__lookupGetter__(e)||"function"!=typeof t[e]?null:{name:e,completion:signatureOf(e,t[e])}})}function getAttributesOf(e,t){return propertyExtract(e,t,function(e){return t.__lookupGetter__&&!t.__lookupGetter__(e)&&"function"==typeof t[e]?null:{name:e,completion:e}})}function getProtoChain(e){for(var t=[];e;)t.push(e),e=e.__proto__;return t}function getDescriptorOf(e,t){function r(e,t){return e.length>t&&(e=e.slice(0,t)+"..."),e.replace(/\n/g,"").replace(/\s+/g," ")}if(e===t){if("function"!=typeof e)return r(safeToString(e),50);var n=e.toString(),o=r(n.slice(n.indexOf("{")+1,n.lastIndexOf("}")),50);return signatureOf(e.displayName||e.name||"function",e)+" {"+o+"}"}var a=t.hasOwnProperty("constructor")&&t.constructor;return a?"string"==typeof a.type&&a.type.length?r(a.type,50):"string"==typeof a.name&&a.name.length?r(a.name,50):"anonymous class":"prototype"}function descriptorsOfObjAndProtoProperties(e){var t=[];return getProtoChain(e).map(function(r){var n=getDescriptorOf(e,r),o=getMethodsOf(t,r).concat(getAttributesOf(t,r));return t=t.concat(pluck(o,"name")),[n,pluck(o,"completion")]})}function getCompletions(e,t,r){var n=getObjectForCompletion(e,t).then(function(e){var t=e.evalResult,r={completions:descriptorsOfObjAndProtoProperties(t&&t.isEvalResult?t.value:t),startLetters:e.startLetters,code:e.code};return t&&t.isPromise&&("fulfilled"===t.promiseStatus?r.promiseResolvedCompletions=descriptorsOfObjAndProtoProperties(t.promisedValue):"rejected"===t.promiseStatus&&(r.promiseRejectedCompletions=descriptorsOfObjAndProtoProperties(t.promisedValue))),r});return"function"==typeof r&&n.then(function(e){return r(null,e)}).catch(function(e){return r(e)}),n}function processInlineCodeTransformOptions(parsed,options){if(!parsed.comments)return options;var livelyComment=parsed.comments.find(function(e){return e.text.startsWith("lively.vm ")});if(!livelyComment)return options;try{var inlineOptions=eval("inlineOptions = {"+livelyComment.text.slice("lively.vm ".length)+"};");return Object.assign(options,inlineOptions)}catch(e){return options}}function evalCodeTransform(e,t){e=lively_ast.transform.transformSingleExpression(e);var r=lively_ast.parse(e,{withComments:!0});t=processInlineCodeTransformOptions(r,t);var n=lively_ast.query.topLevelDeclsAndRefs(r),o=n.classDecls,a=n.funcDecls,i=n.varDecls,l={};if(t.hasOwnProperty("evalId")&&(l.evalId=t.evalId),t.sourceAccessorName&&(l.sourceAccessorName=t.sourceAccessorName),[].concat(toConsumableArray(o),toConsumableArray(a)).forEach(function(e){return e["x-lively-object-meta"]=_extends({},l,{start:e.start,end:e.end})}),i.forEach(function(e){return e.declarations.forEach(function(e){return e["x-lively-object-meta"]=_extends({},l,{start:e.start,end:e.end})})}),r=lively_ast.transform.objectSpreadTransform(r),!t.topLevelVarRecorder&&t.topLevelVarRecorderName){var s=getGlobal();"GLOBAL"===t.topLevelVarRecorderName?t.topLevelVarRecorder=getGlobal():t.topLevelVarRecorder=lively_lang.Path(t.topLevelVarRecorderName).get(s)}if(t.topLevelVarRecorder){var u=(t.dontTransform||[]).concat(["arguments"]),c=t.recordGlobals?null:lively_lang.arr.withoutAll(Object.keys(t.topLevelVarRecorder),u),p=id(t.varRecorderName||"__lvVarRecorder"),f=void 0;if(t.declarationWrapperName||"function"==typeof t.declarationCallback){var v=t.declarationWrapperName||defaultDeclarationWrapperName;t.declarationWrapper=member(id(t.varRecorderName||"__lvVarRecorder"),literal(v),!0),t.declarationCallback&&(t.topLevelVarRecorder[v]=t.declarationCallback)}(!t.hasOwnProperty("transformES6Classes")||t.transformES6Classes)&&(defaultClassToFunctionConverterName in t.topLevelVarRecorder||(t.topLevelVarRecorder[defaultClassToFunctionConverterName]=lively_classes.runtime.initializeClass),f={currentModuleAccessor:t.currentModuleAccessor,classHolder:p,functionNode:member(p,defaultClassToFunctionConverterName),declarationWrapper:t.declarationWrapper,evalId:t.evalId,sourceAccessorName:t.sourceAccessorName}),r=lively_sourceTransform.capturing.rewriteToCaptureTopLevelVariables(r,p,{es6ImportFuncId:t.es6ImportFuncId,es6ExportFuncId:t.es6ExportFuncId,ignoreUndeclaredExcept:c,exclude:u,declarationWrapper:t.declarationWrapper||void 0,classToFunction:f,evalId:t.evalId,sourceAccessorName:t.sourceAccessorName,keepTopLevelVarDecls:t.keepTopLevelVarDecls})}t.wrapInStartEndCall&&(r=lively_ast.transform.wrapInStartEndCall(r,{startFuncNode:t.startFuncNode,endFuncNode:t.endFuncNode}));var m=lively_ast.stringify(r);return t.sourceURL&&(m+="\n//# sourceURL="+t.sourceURL.replace(/\s/g,"_")),m}function evalCodeTransformOfSystemRegisterSetters(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t.topLevelVarRecorder)return e;if("function"==typeof t.declarationCallback||t.declarationWrapperName){var r=t.declarationWrapperName||defaultDeclarationWrapperName;t.declarationWrapper=member(id(t.varRecorderName),literal(r),!0),t.declarationCallback&&(t.topLevelVarRecorder[r]=t.declarationCallback)}var n=lively_ast.parse(e),o=(t.dontTransform||[]).concat(["arguments"]),a=(t.recordGlobals||lively_lang.arr.withoutAll(Object.keys(t.topLevelVarRecorder),o),lively_sourceTransform.capturing.rewriteToRegisterModuleToCaptureSetters(n,id(t.varRecorderName||"__lvVarRecorder"),_extends({exclude:o},t)));return lively_ast.stringify(a)}function _normalizeEvalOptions(e){if(e||(e={}),(e=_extends({targetModule:null,sourceURL:e.targetModule,runtime:null,context:getGlobal(),varRecorderName:defaultTopLevelVarRecorderName,dontTransform:[],recordGlobals:null,returnPromise:!0,promiseTimeout:200,waitForPromise:!0,wrapInStartEndCall:!1,onStartEval:null,onEndEval:null},e)).targetModule){var t=e.runtime&&e.runtime.modules&&e.runtime.modules[e.targetModule];t&&(e=Object.assign(e,t))}return e.wrapInStartEndCall&&(e.startFuncNode={type:"MemberExpression",object:{type:"Identifier",name:e.varRecorderName},property:{type:"Literal",value:startEvalFunctionName},computed:!0},e.endFuncNode={type:"MemberExpression",object:{type:"Identifier",name:e.varRecorderName},property:{type:"Literal",value:endEvalFunctionName},computed:!0}),e}function _eval(__lvEvalStatement,__lvVarRecorder,__lvOriginalCode){return eval(__lvEvalStatement)}function runEval$1(e,t,r){"function"==typeof t&&2===arguments.length&&(r=t,t=null);var n,o,a=new EvalResult,i=!1,l=!1;t=_normalizeEvalOptions(t);var s=lively_lang.promise.deferred(),u=t.topLevelVarRecorder||getGlobal(),c=e;t.wrapInStartEndCall&&(u[startEvalFunctionName]&&console.warn(a.addWarning("startEvalFunctionName "+startEvalFunctionName+" already exists in recorder!")),u[endEvalFunctionName]&&console.warn(a.addWarning("endEvalFunctionName "+endEvalFunctionName+" already exists in recorder!")),u[startEvalFunctionName]=function(){i?console.warn(a.addWarning("onEvalStartCalled multiple times!")):(i=!0,"function"==typeof t.onStartEval&&t.onStartEval())},u[endEvalFunctionName]=function(e,n){l?console.warn(a.addWarning("onEvalEndCalled multiple times!")):(l=!0,finishEval(e,n,a,t,u,s,r))});try{e=evalCodeTransform(e,t),t.header&&(e=t.header+e),t.footer&&(e+=t.footer),t.transpiler&&(e=t.transpiler(e,t.transpilerOptions))}catch(e){console.warn(a.addWarning("lively.vm evalCodeTransform not working: "+e))}try{"undefined"!=typeof $world&&$world.get("log")&&($world.get("log").textString=e),o=_eval.call(t.context,e,t.topLevelVarRecorder,t.originalSource||c)}catch(e){n=e}return t.wrapInStartEndCall?n&&!l&&u[endEvalFunctionName](n,void 0):finishEval(n,n||o,a,t,u,s,r),t.sync?a:s.promise}function finishEval(e,t,r,n,o,a,i){n.wrapInStartEndCall&&(delete o[startEvalFunctionName],delete o[endEvalFunctionName]),e?(r.isError=!0,r.value=e):r.value=t,r.value instanceof Promise&&(r.isPromise=!0),n.sync?(r.processSync(n),"function"==typeof n.onEndEval&&n.onEndEval(e,t)):r.process(n).then(function(){return"function"==typeof i&&i(null,r),"function"==typeof n.onEndEval&&n.onEndEval(e,t),r},function(e){return"function"==typeof i&&i(e,void 0),"function"==typeof n.onEndEval&&n.onEndEval(e,void 0),r}).then(a.resolve,a.reject)}function syncEval$1(e,t){return t=Object.assign(t||{},{sync:!0}),runEval$1(e,t)}function tryToWaitForPromise(e,t){console.assert(e.isPromise,"no promise in tryToWaitForPromise???");var r={},n=new Promise(function(e){return setTimeout(e,t,r)});return Promise.race([n,e.value]).then(function(t){return Object.assign(e,t!==r?{promiseStatus:"fulfilled",promisedValue:t}:{promiseStatus:"pending"})}).catch(function(t){return Object.assign(e,{promiseStatus:"rejected",promisedValue:t})})}function ensureImportsAreImported(e,t,r){var n=lively_ast.parse(t).body.filter(function(e){return"ImportDeclaration"===e.type});return Promise.all(n.map(function(t){return e.normalize(t.source.value,r).then(function(t){return e.get(t)||e.import(t)})})).catch(function(e){throw console.error("Error ensuring imports: "+e.message),e})}function hasUnimportedImports(e,t,r){var n=lively.ast.parse(t).body.filter(function(e){return"ImportDeclaration"===e.type});return lively_lang.arr.uniq(n.map(function(e){return e.source.value})).filter(Boolean).filter(function(t){return!e.get(e.decanonicalize(t,r))}).length>0}function babelTranspilerForAsyncAwaitCode(e,t,r,n){return function(e,n){n=Object.assign({sourceMap:void 0,inputSourceMap:void 0,filename:r,code:!0,ast:!1},n);var o="(async function(__rec) {\n"+e+"\n}).call(this);",a=t.transform(o,n).code;return a=a.replace(/\}\)\.call\(undefined\);$/,"}).call(this)")}}function babelPluginTranspilerForAsyncAwaitCode(e,t,r,n){return function(n,o){var a=e.babelOptions||{},i=[];i.push(t.presetES2015),a.stage3&&i.push({plugins:t.pluginsStage3}),a.stage2&&i.push({plugins:t.pluginsStage2}),a.stage1&&i.push({plugins:t.pluginsStage1}),o=Object.assign({sourceMap:void 0,inputSourceMap:void 0,filename:r,babelrc:!1,presets:i,moduleIds:!1,code:!0,ast:!1},o);var l="(async function(__rec) {\n"+n+"\n}).call(this);",s=t.babel.transform(l,o).code;return s=s.replace(/\}\)\.call\(undefined\);$/,"}).call(this)")}}function getEs6Transpiler(e,t,r){if(t.transpiler)return t.transpiler;if(!t.es6Transpile)return null;if("babel"===e.transpiler){var n=e.global[e.transpiler]||e.get(e.decanonicalize(e.transpiler));return n?babelTranspilerForAsyncAwaitCode(e,n,t.targetModule,r):e.import(e.transpiler).then(function(n){return babelTranspilerForAsyncAwaitCode(e,n,t.targetModule,r)})}if("plugin-babel"===e.transpiler){var o=e.decanonicalize("plugin-babel").split("/").slice(0,-1).concat("systemjs-babel-browser.js").join("/"),a=e.get(o);return a?babelPluginTranspilerForAsyncAwaitCode(e,a,t.targetModule,r):e.import(o).then(function(n){return babelPluginTranspilerForAsyncAwaitCode(e,n,t.targetModule,r)})}if("lively.transpiler"===e.transpiler){var i=new(0,e.get(e.decanonicalize("lively.transpiler")).default)(e,t.targetModule,r);return function(e,t){return i.transpileDoit(e,t)}}throw new Error("Sorry, currently only babel is supported as es6 transpiler for runEval!")}function runEval$2(e,t,r){r=_extends({targetModule:null,parentModule:null,es6Transpile:!0,transpiler:null,transpilerOptions:null,format:"esm"},r);var n=t;e.debug&&console.log("[lively.module] runEval: "+t.slice(0,100).replace(/\n/gm," ")+"...");var o=r,a=o.format,i=o.targetModule,l=o.parentModule;if(i=e.decanonicalize(i||"*scratch*",l),r.targetModule=i,a){var s=e.getConfig().meta[i];s||(s={}),s[i]||(s[i]={}),s[i].format||(s[i].format=a,e.config(s))}var u=e.get("@lively-env").moduleEnv(i),c=u.recorder,p=u.recorderName,f=u.dontTransform,v=getEs6Transpiler(e,r,u),m="var _moduleExport = "+p+"._moduleExport,\n    _moduleImport = "+p+"._moduleImport;\n";if(!(r=_extends({waitForPromise:!0,sync:!1,evalId:r.evalId||u.nextEvalId(),sourceAccessorName:!r.hasOwnProperty("embedOriginalCode")||r.embedOriginalCode?"__lvOriginalCode":void 0,originalSource:n},r,{header:m,recordGlobals:!0,dontTransform:f,varRecorderName:p,topLevelVarRecorder:c,sourceURL:r.sourceURL||r.targetModule,context:r.context||c,wrapInStartEndCall:!0,es6ExportFuncId:"_moduleExport",es6ImportFuncId:"_moduleImport",transpiler:v,declarationWrapperName:u.varDefinitionCallbackName,currentModuleAccessor:funcCall(member$1(funcCall(member$1(member$1("__lvVarRecorder","System"),"get"),literal$1("@lively-env")),"moduleEnv"),literal$1(r.targetModule))})).sync&&!r.importsEnsured&&hasUnimportedImports(e,t,i))return ensureImportsAreImported(e,t,i).then(function(){return runEval$2(e,n,_extends({},r,{importsEnsured:!0}))});if(!u.record()){if(!r.sync&&!r._moduleImported)return e.import(i).catch(function(e){return null}).then(function(){return runEval$2(e,n,_extends({},r,{_moduleImported:!0}))});u.ensureRecord()}if(r.es6Transpile&&r.transpiler instanceof Promise){if(!r.sync&&!r._transpilerLoaded)return r.transpiler.catch(function(e){return console.error(e)}).then(function(t){return runEval$2(e,n,_extends({},r,{transpiler:t,_transpilerLoaded:!0}))});console.warn("[lively.vm] sync eval requested but transpiler is not yet loaded, will continue without transpilation!"),r.transpiler=null}e.debug&&console.log("[lively.module] runEval in module "+i+" started"),lively_notifications.emit("lively.vm/doitrequest",{code:n,waitForPromise:r.waitForPromise,targetModule:r.targetModule},Date.now(),e),e.get("@lively-env").evaluationStart(i);var d=runEval$1(t,r);return r.sync?evalEnd(e,n,r,d):Promise.resolve(d).then(function(t){return evalEnd(e,n,r,t)})}function evalEnd(e,t,r,n){return e.get("@lively-env").evaluationEnd(r.targetModule),e.debug&&console.log("[lively.module] runEval in module "+r.targetModule+" done"),lively_notifications.emit("lively.vm/doitresult",{code:t,result:n,waitForPromise:r.waitForPromise,targetModule:r.targetModule},Date.now(),e),n}function runEval$$1(e,t){var r=t=_extends({format:"esm",System:null,targetModule:null},t),n=r.format,o=r.System,a=r.targetModule;return o||"undefined"==typeof System||(o=System),!o&&a?Promise.reject(new Error("options to runEval have targetModule but cannot find system loader!")):a&&["esm","es6","register"].includes(n)?runEval$2(o,e,t):runEval$1(e,t)}function syncEval$$1(e,t){return syncEval$1(e,t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},asyncGenerator=function(){function e(e){this.value=e}function t(t){function r(o,a){try{var i=t[o](a),l=i.value;l instanceof e?Promise.resolve(l.value).then(function(e){r("next",e)},function(e){r("throw",e)}):n(i.done?"return":"normal",i.value)}catch(e){n("throw",e)}}function n(e,t){switch(e){case"return":o.resolve({value:t,done:!0});break;case"throw":o.reject(t);break;default:o.resolve({value:t,done:!1})}(o=o.next)?r(o.key,o.arg):a=null}var o,a;this._invoke=function(e,t){return new Promise(function(n,i){var l={key:e,arg:t,resolve:n,reject:i,next:null};a?a=a.next=l:(o=a=l,r(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),asyncToGenerator=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(o,a){try{var i=t[o](a),l=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(l).then(function(e){n("next",e)},function(e){n("throw",e)});e(l)}return n("next")})}},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),defineProperty=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},get$1=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in o)return o.value;var i=o.get;if(void 0!==i)return i.call(n)},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},set=function e(t,r,n,o){var a=Object.getOwnPropertyDescriptor(t,r);if(void 0===a){var i=Object.getPrototypeOf(t);null!==i&&e(i,r,n,o)}else if("value"in a&&a.writable)a.value=n;else{var l=a.set;void 0!==l&&l.call(o,n)}return n},slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&l.return&&l.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},knownSymbols=Object.getOwnPropertyNames(Symbol).filter(function(e){return"symbol"===_typeof(Symbol[e])}).reduce(function(e,t){return e.set(Symbol[t],"Symbol."+t)},new Map),symMatcher=/^Symbol\((.*)\)$/,printInspectEvalValue=function(){function e(e,t){if("object"===(void 0===t?"undefined":_typeof(t))&&(t=t.maxDepth||2),!e)return String(e);if("string"==typeof e){var n=e.includes("\n")?"`":'"';return e=e.split("\n").slice(0,l).join("\n"),n+e+n}if(e instanceof Error)return e.stack||safeToString(e);if(!lively_lang.obj.isObject(e))return safeToString(e);try{var o=lively_lang.obj.inspect(e,{customPrinter:r,maxNumberOfKeys:i,maxDepth:t,printFunctionSource:!0})}catch(e){}return"{}"===o?safeToString(e):o}function t(t,r){if(!("string"!=typeof t&&!Array.isArray(t)&&n&&"function"==typeof t[n]))return r;for(var a,i="function"==typeof t.entries,l=i?t.entries():t[n](),s=[],u=i?"{":"[",c=i?"}":"]",p=t.constructor&&t.constructor.name||"Iterable",f=0;f<o&&!(a=l.next()).done;f++)s.push(a.value);return p+"("+u+s.map(function(t){return i?String(t[0])+": "+String(t[1]):e(t,2)}).join(", ")+c+")"}function r(e,r,n){if(!e)return r;if("symbol"===(void 0===e?"undefined":_typeof(e)))return printSymbol(e);if("string"==typeof e)return lively_lang.string.print(lively_lang.string.truncate(e,a));if(e.isMorph)return safeToString(e);if(e instanceof Promise)return"Promise()";if("undefined"!=typeof Node&&e instanceof Node)return safeToString(e);if("undefined"!=typeof ImageData&&e instanceof ImageData)return safeToString(e);var i=e.length||e.byteLength;if(void 0!==i&&i>o&&e.slice)return"["+("string"==typeof e||e.byteLength?safeToString(e.slice(0,o)):e.slice(0,o).map(n))+",...]";var l=t(e,r);return l!==r?l:r}var n="undefined"!=typeof Symbol&&Symbol.iterator,o=10,a=100,i=100,l=1e3;return e}(),completions=Object.freeze({getObjectForCompletion:getObjectForCompletion,getCompletions:getCompletions}),id=lively_ast.nodes.id,literal=lively_ast.nodes.literal,member=lively_ast.nodes.member,defaultDeclarationWrapperName="lively.capturing-declaration-wrapper",defaultClassToFunctionConverterName="initializeES6ClassForLively",defaultTopLevelVarRecorderName="__lvVarRecorder",startEvalFunctionName="lively.vm-on-eval-start",endEvalFunctionName="lively.vm-on-eval-end",EvalResult=function(){function e(){classCallCheck(this,e),this.isEvalResult=!0,this.value=void 0,this.warnings=[],this.isError=!1,this.isPromise=!1,this.promisedValue=void 0,this.promiseStatus="unknown"}return createClass(e,[{key:"addWarning",value:function(e){return this.warnings.push(e),e}},{key:"printed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.value=printEvalResult(this,e)}},{key:"processSync",value:function(e){return(e.inspect||e.asString)&&(this.value=this.print(this.value,e)),this}},{key:"process",value:function(e){var t=this;return t.isPromise&&e.waitForPromise?tryToWaitForPromise(t,e.promiseTimeout).then(function(){return(e.inspect||e.asString)&&t.printed(e),t}):((e.inspect||e.asString)&&t.printed(e),Promise.resolve(t))}}]),e}(),funcCall=lively_ast.nodes.funcCall,member$1=lively_ast.nodes.member,literal$1=lively_ast.nodes.literal,EvalStrategy=function(){function e(){classCallCheck(this,e)}return createClass(e,[{key:"runEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.reject("runEval(source, options) not yet implemented for "+this.constructor.name));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"keysOfObject",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.reject("keysOfObject(prefix, options) not yet implemented for "+this.constructor.name));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}(),SimpleEvalStrategy=function(_EvalStrategy){function SimpleEvalStrategy(){return classCallCheck(this,SimpleEvalStrategy),possibleConstructorReturn(this,(SimpleEvalStrategy.__proto__||Object.getPrototypeOf(SimpleEvalStrategy)).apply(this,arguments))}return inherits(SimpleEvalStrategy,_EvalStrategy),createClass(SimpleEvalStrategy,[{key:"runEval",value:function(){function runEval(e,t){return _ref3.apply(this,arguments)}var _ref3=asyncToGenerator(regeneratorRuntime.mark(function _callee3(source,options){return regeneratorRuntime.wrap(function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.abrupt("return",Promise.resolve().then(function(){try{return Promise.resolve({value:eval(source)})}catch(e){return{isError:!0,value:e}}}));case 1:case"end":return _context3.stop()}},_callee3,this)}));return runEval}()},{key:"keysOfObject",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lively.vm.completions.getCompletions(function(e){return o.runEval(e,r)},t);case 2:return n=e.sent,e.abrupt("return",{completions:n.completions,prefix:n.startLetters});case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),SimpleEvalStrategy}(EvalStrategy),LivelyVmEvalStrategy=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,EvalStrategy),createClass(t,[{key:"normalizeOptions",value:function(e){if(!e.targetModule)throw new Error("runEval called but options.targetModule not specified!");return Object.assign({sourceURL:e.targetModule+"_doit_"+Date.now()},e)}},{key:"runEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.normalizeOptions(r),(n=r.System||lively.modules.System).config({meta:defineProperty({},r.targetModule,{format:"esm"})}),e.abrupt("return",lively.vm.runEval(t,r));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"keysOfObject",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lively.vm.completions.getCompletions(function(e){return lively.vm.runEval(e,r)},t);case 2:return n=e.sent,e.abrupt("return",{completions:n.completions,prefix:n.startLetters});case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(),RemoteEvalStrategy=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,LivelyVmEvalStrategy),createClass(t,[{key:"sourceForRemote",value:function(e,t,r){var n=!!lively_lang.obj.isString(r.context)&&r.context;return r=lively_lang.obj.dissoc(r,["systemInterface","System","context"]),"\n(function() {\n  var arg = "+JSON.stringify(t)+",\n      options = "+JSON.stringify(r)+';\n  if (typeof lively === "undefined" || !lively.vm) {\n    return Promise.resolve({\n      isEvalResult: true,\n      isError: true,\n      value: \'lively.vm not available!\'\n    });\n  }\n  var hasSystem = typeof System !== "undefined"\n  options.context = '+n+'\n  if (!options.context) {\n    options.context = hasSystem\n      ? System.global\n      : typeof window !== "undefined"\n          ? window\n          : typeof global !== "undefined"\n              ? global\n              : typeof self !== "undefined" ? self : this;\n  }\n  function evalFunction(source, options) {\n    if (hasSystem) {\n      var conf = {meta: {}}; conf.meta[options.targetModule] = {format: "esm"};\n      System.config(conf);\n    } else {\n      options = Object.assign({topLevelVarRecorderName: "GLOBAL"}, options);\n      delete options.targetModule;\n    }\n    return lively.vm.runEval(source, options);\n  }\n  function keysOfObjectFunction(prefix, options) {\n    return lively.vm.completions.getCompletions(code => evalFunction(code, options), prefix)\n      .then(result => ({isEvalResult: true, completions: result.completions, prefix: result.startLetters}));\n  }\n  return '+("eval"===e?"evalFunction":"keysOfObjectFunction")+"(arg, options)\n    .catch(err => ({isEvalResult: true, isError: true, value: String(err.stack || err)}));\n})();\n"}},{key:"runEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.remoteEval(this.sourceForRemote("eval",t,r),r));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"keysOfObject",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.remoteEval(this.sourceForRemote("keysOfObject",t,r),r));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"remoteEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.basicRemoteEval(t,r);case 3:return n=e.sent,e.abrupt("return","string"==typeof n?JSON.parse(n):n);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{isError:!0,value:"Remote eval failed: "+(n||e.t0)});case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"basicRemoteEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Not yet implemented");case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(),HttpEvalStrategy=function(e){function t(e){classCallCheck(this,t);var r=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.url=e||r.constructor.defaultURL,r}return inherits(t,RemoteEvalStrategy),createClass(t,null,[{key:"defaultURL",get:function(){return"http://localhost:3000/lively"}}]),createClass(t,[{key:"normalizeOptions",value:function(e){return e=get$1(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"normalizeOptions",this).call(this,e),Object.assign({serverEvalURL:this.url},e,{context:null})}},{key:"basicRemoteEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.normalizeOptions(r),n="basicRemoteEval_"+(System.get("@system-env").node?"node":"web"),e.next=4,this[n]({method:"POST",body:t},r.serverEvalURL);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"basicRemoteEval_web",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,o,a,i,l,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.match(/[^:]+:\/\/[^\/]+/)||[r],o=slicedToArray(n,1),a=o[0],i=void 0,l=void 0,i=System.get("@system-env").worker?window.location:document.location,(l=i.origin!==a)&&(t.headers=_extends({},t.headers,{pragma:"no-cache","cache-control":"no-cache","x-lively-proxy-request":r}),r=i.origin),e.prev=8,e.next=11,window.fetch(r,t);case 11:s=e.sent,e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(8),new Error("Cannot reach server at "+r+": "+e.t0.message);case 17:if(s.ok){e.next=19;break}throw new Error("Server at "+r+": "+s.statusText);case 19:return e.abrupt("return",s.text());case 20:case"end":return e.stop()}},e,this,[[8,14]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"basicRemoteEval_node",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=System._nodeRequire("url").parse,o=System._nodeRequire(r.startsWith("https:")?"https":"http"),a=Object.assign({method:t.method||"GET"},n(r)),e.abrupt("return",new Promise(function(e,r){var n=o.request(a,function(t){t.setEncoding("utf8");var n="";t.on("data",function(e){return n+=e}),t.on("end",function(){return e(n)}),t.on("error",function(e){return r(e)})});n.on("error",function(e){return r(e)}),n.end(t.body)}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(),L2LEvalStrategy=function(e){function t(e,r){classCallCheck(this,t);var n=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.l2lClient=e,n.targetId=r,n}return inherits(t,RemoteEvalStrategy),createClass(t,[{key:"basicRemoteEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,o,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.l2lClient,o=this.targetId,e.next=4,new Promise(function(e,r){return n.sendTo(o,"remote-eval",{source:t},e)});case 4:return a=e.sent,(i=a.data)&&i.value&&i.value.isEvalResult&&(i=i.value),e.abrupt("return",i);case 8:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(),evalStrategies=Object.freeze({RemoteEvalStrategy:RemoteEvalStrategy,EvalStrategy:EvalStrategy,SimpleEvalStrategy:SimpleEvalStrategy,LivelyVmEvalStrategy:LivelyVmEvalStrategy,HttpEvalStrategy:HttpEvalStrategy,L2LEvalStrategy:L2LEvalStrategy});exports.completions=completions,exports.runEval=runEval$$1,exports.syncEval=syncEval$$1,exports.evalStrategies=evalStrategies,exports.defaultTopLevelVarRecorderName=defaultTopLevelVarRecorderName,exports.defaultClassToFunctionConverterName=defaultClassToFunctionConverterName,exports.evalCodeTransform=evalCodeTransform,exports.evalCodeTransformOfSystemRegisterSetters=evalCodeTransformOfSystemRegisterSetters}(this.lively.vm=this.lively.vm||{},lively.lang,lively.ast,lively.sourceTransform,lively.classes,lively.notifications),"undefined"!=typeof module&&module.exports&&(module.exports=GLOBAL.lively.vm)}();
//LIVELY.RESOURCES
!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(e,t){"use strict";function r(e,t){return Array.isArray(e)?e.reduce(function(e,t){return r(t,e)},t):"string"==typeof e?t.filter(function(t){return t.path()!==e&&t.name()!==e}):e instanceof RegExp?t.filter(function(t){return!e.test(t.path())&&!e.test(t.name())}):"function"==typeof e?t.filter(function(t){return!e(t)}):t}function n(e){var t=(e=e).split("?"),r=_(t,2),n=(r[0],r[1]),i={};if(!n)return i;var s=n.split("&");if(s)for(var a=0;a<s.length;a++){var o=s[a].split("="),u=o[0],c=!0;if(o.length>1)if("undefined"===(c=decodeURIComponent(o.slice(1).join("="))))c=void 0;else if(c.match(/^(true|false|null|[0-9"[{].*)$/))try{c=JSON.parse(c)}catch(e){"["===c[0]&&(c=c.slice(1,-1).split(","))}i[u]=c}return i}function i(e){var t=e,r=t;do{r=(t=r).replace(E,"")}while(r!=t);return r=r.replace(O,"$1/"),r=r.replace(T,"/")}function s(e,t){e.startsWith("/")&&(e=e.slice(1)),t.startsWith("/")&&(t=t.slice(1));for(var r=e.split("/"),n=t.split("/"),i=0;i<n.length&&(r[i]&&r[i]==n[i]);i++);return"../".repeat(Math.max(0,n.length-i-1))+r.splice(i,r.length).join("/")}function a(e,t){var r=e.match(S),n=t.match(S),a=void 0,o=void 0,u=void 0,c=void 0,h=!0;if((r&&!n||!r&&n)&&(h=!1),r&&n&&(a=r[1],o=r[2],u=n[1],c=n[2],a!==u?h=!1:o!==c?h=!1:(e=r[3],t=n[3])),!h)throw new Error("[relativePathBetween] incompatible paths: "+e+" vs. "+t);if(e=i(e),t=i(t),e==t)return"";var f=s(t,e);if(!f)throw new Error("pathname differs in relativePathFrom "+e+" vs "+t);return f}function o(e,t){throw new Error(t+" for "+e.constructor.name+" not yet implemented")}function u(e){var t=e.match(/\/([a-z]+?):multistatus/i);return t?t[1]:"d"}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.tagName.replace(/[^:]+:/,""),n=N[r],i=e.textContent;switch(n){case"lastModified":case"created":i=new Date(i);break;case"size":i=Number(i)}return t[n]=i,t}function h(e){var t=(new DOMParser).parseFromString(e,"text/xml"),r=u(e),n=new L("/"+r+":multistatus/"+r+":response").findAll(t.documentElement),i=new L(r+":href"),s=new L(r+":propstat/"+r+":prop");return n.map(function(e){var t=s.findFirst(e),r=Array.from(t.childNodes).reduce(function(e,t){return c(t,e)},{}),n=i.findFirst(e);return r.url=n.textContent||n.text,r})}function f(){return document.location.origin}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",r=arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=e.url,s=e.useCors,a=e.useProxy,o=e.headers,s=void 0===s||s,u={method:t};return(a=void 0===a||a)&&(Object.assign(n,{pragma:"no-cache","cache-control":"no-cache","x-lively-proxy-request":i}),i=e.proxyDomain||f()),s&&(u.mode="cors"),r&&(u.body=r),u.redirect="follow",u.headers=b({},n,o),fetch(i,u)}function p(e){return function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return new Promise(function(t,n){return e.apply(null,r.concat(function(e,r){return e?n(e):t(r)}))})}}function v(e,t){return!t||("string"==typeof t?!e.url.includes(t):"function"==typeof t?!t(e):!(t instanceof RegExp)||!t.test(e.url))}function y(e,t){if(!e)throw new Error("lively.resource resource constructor: expects url but got "+e);if(e.isResource)return e;e=String(e);for(var r=0;r<Z.length;r++)if(Z[r].matches(e))return new Z[r].resourceClass(e,t);throw new Error("Cannot find resource type for url "+e)}function m(e){var t=e.name;Z=Z.filter(function(e){return e.name!==t}).concat(e)}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x=(function(){function e(e){this.value=e}function t(t){function r(i,s){try{var a=t[i](s),o=a.value;o instanceof e?Promise.resolve(o.value).then(function(e){r("next",e)},function(e){r("throw",e)}):n(a.done?"return":"normal",a.value)}catch(e){n("throw",e)}}function n(e,t){switch(e){case"return":i.resolve({value:t,done:!0});break;case"throw":i.reject(t);break;default:i.resolve({value:t,done:!1})}(i=i.next)?r(i.key,i.arg):s=null}var i,s;this._invoke=function(e,t){return new Promise(function(n,a){var o={key:e,arg:t,resolve:n,reject:a,next:null};s?s=s.next=o:(i=s=o,r(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,s){try{var a=t[i](s),o=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(o).then(function(e){n("next",e)},function(e){n("throw",e)});e(o)}return n("next")})}}),k=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},w=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},g=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,r,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},R=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},P=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},_=function(){function e(e,t){var r=[],n=!0,i=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw s}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),S=/^([^:\/]+):\/\/([^\/]*)(.*)/,T=/\/\.\//g,E=/\/[^\/]+\/\.\./,O=/(^|[^:])[\/]+/g,j=/\/+$/,C=/^\/+/,D=/^[a-z0-9-_\.]+:/,F=/^\/\/[^\/]+/,z=function(){function e(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(k(this,e),!t)throw new Error("Cannot create resource without url");this.url=String(t),this.binary=!1,this.lastModified=void 0,this.created=void 0,this.etag=void 0,this.size=void 0,this.type=void 0,this.contentType=void 0,this.user=void 0,this.group=void 0,this.mode=void 0,this._isDirectory=void 0,this._isLink=void 0,this.linkCount=void 0}return w(e,null,[{key:"fromProps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new this(e.url).assignProperties(e)}}]),w(e,[{key:"equals",value:function(e){if(!e||this.constructor!==e.constructor)return!1;var t=this.url,r=e.url;return"/"===t[t.length-1]&&(t=t.slice(0,-1)),"/"===r[r.length-1]&&(r=r.slice(0,-1)),t===r}},{key:"toString",value:function(){return this.constructor.name+'("'+this.url+'")'}},{key:"newResource",value:function(e){return y(e)}},{key:"path",value:function(){var e=this.url.replace(D,"").replace(F,"");return""===e?"/":e}},{key:"pathWithoutQuery",value:function(){return this.path().split("?")[0]}},{key:"name",value:function(){var e=this.path(),t=e.lastIndexOf("?");t>-1&&(e=e.slice(0,t)),e.endsWith("/")&&(e=e.slice(0,-1));var r=e.split("/"),n=r[r.length-1];return decodeURIComponent(n)}},{key:"ext",value:function(){var e=this.url;if(e.endsWith("/"))return"";var t=e.match(/\.([^\/\.]+$)/)||["",""],r=_(t,2),n=(r[0],r[1]);return n.toLowerCase()}},{key:"nameWithoutExt",value:function(){var e=this.name(),t=e.lastIndexOf(".");return t>0&&(e=e.slice(0,t)),e}},{key:"scheme",value:function(){return this.url.split(":")[0]}},{key:"host",value:function(){var e=this.url.indexOf("://");if(-1===e)return null;var t=this.url.slice(e+3),r=t.indexOf("/");return t.slice(0,r>-1?r:t.length)}},{key:"schemeAndHost",value:function(){return this.isRoot()?this.asFile().url:this.url.slice(0,this.url.length-this.path().length)}},{key:"parent",value:function(){return this.isRoot()?null:this.newResource(this.url.replace(j,"").split("/").slice(0,-1).join("/")+"/")}},{key:"parents",value:function(){for(var e=[],t=this.parent();t;)e.unshift(t),t=t.parent();return e}},{key:"isParentOf",value:function(e){var t=this;return e.schemeAndHost()===this.schemeAndHost()&&e.parents().some(function(e){return e.equals(t)})}},{key:"query",value:function(){return n(this.url)}},{key:"withQuery",value:function(e){var t=b({},this.query(),e),r=this.url.split("?"),n=_(r,1)[0],i=Object.keys(t).map(function(e){return e+"="+encodeURIComponent(String(t[e]))}).join("&");return this.newResource(n+"?"+i)}},{key:"commonDirectory",value:function(e){if(e.schemeAndHost()!==this.schemeAndHost())return null;if(this.isDirectory()&&this.equals(e))return this;if(this.isRoot())return this.asDirectory();if(e.isRoot())return e.asDirectory();for(var t=e.parents(),r=this.parents(),n=this.root(),i=0;i<r.length;i++){var s=r[i],a=t[i];if(!a||!s.equals(a))return n;n=s}return n}},{key:"withRelativePartsResolved",value:function(){var e=this.path(),t=i(e);return t===e?this:(t.startsWith("/")&&(t=t.slice(1)),this.newResource(this.root().url+t))}},{key:"relativePathFrom",value:function(e){return a(e.url,this.url)}},{key:"withPath",value:function(e){return(this.isRoot()?this:this.root()).join(e)}},{key:"join",value:function(e){return this.newResource(this.url.replace(j,"")+"/"+e.replace(C,""))}},{key:"isRoot",value:function(){return"/"===this.path()}},{key:"isFile",value:function(){return!this.isRoot()&&!this.url.match(j)}},{key:"isDirectory",value:function(){return!this.isFile()}},{key:"asDirectory",value:function(){return this.url.endsWith("/")?this:this.newResource(this.url.replace(j,"")+"/")}},{key:"root",value:function(){if(this.isRoot())return this;var e=this.url.slice(0,-this.path().length);return this.newResource(e+"/")}},{key:"asFile",value:function(){return this.url.endsWith("/")?this.newResource(this.url.replace(j,"")):this}},{key:"assignProperties",value:function(e){for(var t in e)if("url"!==t){var r=t;"isLink"!==t&&"isDirectory"!==t||(r="_"+t),this[r]=e[t]}return this}},{key:"ensureExistance",value:function(){var e=x(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.exists();case 2:if(!e.sent){e.next=4;break}return e.abrupt("return",this);case 4:return e.next=6,this.parent().ensureExistance();case 6:if(!this.isFile()){e.next=11;break}return e.next=9,this.write(t||"");case 9:e.next=13;break;case 11:return e.next=13,this.mkdir();case 13:return e.abrupt("return",this);case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"copyTo",value:function(){var e=x(regeneratorRuntime.mark(function e(t){var r,n,i,s=this,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFile()){e.next=13;break}if(r=t.isFile()?t:t.join(this.name()),!a){e.next=5;break}return e.next=5,r.parent().ensureExistance();case 5:return e.t0=r,e.next=8,this.read();case 8:return e.t1=e.sent,e.next=11,e.t0.write.call(e.t0,e.t1);case 11:e.next=25;break;case 13:if(t.isDirectory()){e.next=15;break}throw new Error("Cannot copy a directory to a file!");case 15:return e.next=17,this.dirList("infinity");case 17:return n=e.sent,i=n.map(function(e){return t.join(e.relativePathFrom(s))}),e.next=21,t.ensureExistance();case 21:return e.next=23,n.reduceRight(function(e,t,r){return function(){return Promise.resolve(t.isDirectory()&&i[r].ensureExistance()).then(e)}},function(){return Promise.resolve()})();case 23:return e.next=25,n.reduceRight(function(e,t,r){return function(){return Promise.resolve(t.isFile()&&t.copyTo(i[r],!1)).then(e)}},function(){return Promise.resolve()})();case 25:return e.abrupt("return",this);case 26:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"rename",value:function(){var e=x(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.copyTo(t);case 2:return this.remove(),e.abrupt("return",t);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"beBinary",value:function(e){return this.setBinary(!0)}},{key:"setBinary",value:function(e){return this.binary=e,this}},{key:"read",value:function(){var e=x(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o(this,"read");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"write",value:function(){var e=x(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o(this,"write");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"mkdir",value:function(){var e=x(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o(this,"mkdir");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"exists",value:function(){var e=x(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o(this,"exists");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=x(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o(this,"remove");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"dirList",value:function(){var e=x(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o(this,"dirList");case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"readProperties",value:function(){var e=x(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o(this,"readProperties");case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"writeJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.write(t?JSON.stringify(e,null,2):JSON.stringify(e))}},{key:"readJson",value:function(){var e=x(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,this.read();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"__serialize__",value:function(){return{__expr__:'var r = null; try { r = resource("'+this.url+'");} catch (err) {}; r',bindings:{"lively.resources":["resource"]}}}},{key:"isResource",get:function(){return!0}},{key:"canDealWithJSON",get:function(){return!1}}]),e}(),L=function(){function e(t){k(this,e),this.expression=t,this.contextNode=null,this.xpe=new XPathEvaluator}return w(e,[{key:"establishContext",value:function(e){if(!this.nsResolver){var t=e.ownerDocument?e.ownerDocument.documentElement:e.documentElement;t!==this.contextNode&&(this.contextNode=t,this.nsResolver=this.xpe.createNSResolver(t))}}},{key:"manualNSLookup",value:function(){return this.nsResolver=function(e){return Namespace[e.toUpperCase()]||null},this}},{key:"findAll",value:function(e,t){this.establishContext(e);for(var r=this.xpe.evaluate(this.expression,e,this.nsResolver,XPathResult.ANY_TYPE,null),n=[],i=null;i=r.iterateNext();)n.push(i);return n.length>0||void 0===t?n:t}},{key:"findFirst",value:function(e){return this.establishContext(e),this.xpe.evaluate(this.expression,e,this.nsResolver,XPathResult.ANY_TYPE,null).iterateNext()}}]),e}(),N={getlastmodified:"lastModified",creationDate:"created",getetag:"etag",getcontentlength:"size",resourcetype:"type",getcontenttype:"contentType"},H=["3ds","3g2","3gp","7z","a","aac","adp","ai","aif","aiff","alz","ape","apk","ar","arj","asf","au","avi","bak","bh","bin","bk","bmp","btif","bz2","bzip2","cab","caf","cgm","class","cmx","cpio","cr2","csv","cur","dat","deb","dex","djvu","dll","dmg","dng","doc","docm","docx","dot","dotm","dra","DS_Store","dsk","dts","dtshd","dvb","dwg","dxf","ecelp4800","ecelp7470","ecelp9600","egg","eol","eot","epub","exe","f4v","fbs","fh","fla","flac","fli","flv","fpx","fst","fvt","g3","gif","graffle","gz","gzip","h261","h263","h264","icns","ico","ief","img","ipa","iso","jar","jpeg","jpg","jpgv","jpm","jxr","key","ktx","lha","lvp","lz","lzh","lzma","lzo","m3u","m4a","m4v","mar","mdi","mht","mid","midi","mj2","mka","mkv","mmr","mng","mobi","mov","movie","mp3","mp4","mp4a","mpeg","mpg","mpga","mxu","nef","npx","numbers","o","oga","ogg","ogv","otf","pages","pbm","pcx","pdf","pea","pgm","pic","png","pnm","pot","potm","potx","ppa","ppam","ppm","pps","ppsm","ppsx","ppt","pptm","pptx","psd","pya","pyc","pyo","pyv","qt","rar","ras","raw","rgb","rip","rlc","rmf","rmvb","rtf","rz","s3m","s7z","scpt","sgi","shar","sil","sketch","slk","smv","so","sub","swf","tar","tbz","tbz2","tga","tgz","thmx","tif","tiff","tlz","ttc","ttf","txz","udf","uvh","uvi","uvm","uvp","uvs","uvu","viv","vob","war","wav","wax","wbmp","wdp","weba","webm","webp","whl","wim","wm","wma","wmv","wmx","woff","woff2","wvx","xbm","xif","xla","xlam","xls","xlsb","xlsm","xlsx","xlt","xltm","xltx","xm","xmind","xpi","xpm","xwd","xz","z","zip","zipx"],A="undefined"!=typeof System?System.get("@system-env").node:"undefined"!=typeof global&&"undefined"!=typeof process,W={name:"http-webdav-resource",matches:function(e){return e.startsWith("http:")||e.startsWith("https:")},resourceClass:function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};k(this,t);var n=P(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return n.useProxy=!!r.hasOwnProperty("useProxy")&&r.useProxy,n.proxyDomain=r.proxyDomain||void 0,n.useCors=!!r.hasOwnProperty("useCors")&&r.useCors,n.headers=r.headers||{},n.binary=!!n.isFile()&&H.includes(n.ext()),n.errorOnHTTPStatusCodes=!r.hasOwnProperty("errorOnHTTPStatusCodes")||r.errorOnHTTPStatusCodes,n}return R(t,z),w(t,[{key:"join",value:function(e){return Object.assign(g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"join",this).call(this,e),{headers:this.headers,useCors:this.useCors,useProxy:this.useProxy,proxyDomain:this.proxyDomain})}},{key:"makeProxied",value:function(e){return void 0!==e&&(this.proxyDomain=e),this.useProxy?this:new this.constructor(this.url,{headers:this.headers,useCors:this.useCors,useProxy:!0,proxyDomain:this.proxyDomain})}},{key:"noErrorOnHTTPStatusCodes",value:function(){return this.errorOnHTTPStatusCodes=!1,this}},{key:"read",value:function(){var e=x(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l(this);case 2:if((t=e.sent).ok||!this.errorOnHTTPStatusCodes){e.next=5;break}throw new Error("Cannot read "+this.url+": "+t.statusText+" "+t.status);case 5:if(this.binary){e.next=7;break}return e.abrupt("return",t.text());case 7:if("blob"!==this.binary){e.next=9;break}return e.abrupt("return",t.blob());case 9:if("function"!=typeof t.arrayBuffer){e.next=11;break}return e.abrupt("return",t.arrayBuffer());case 11:if("function"!=typeof t.buffer){e.next=13;break}return e.abrupt("return",t.buffer());case 13:throw new Error("Don't now how to read binary resource "+this+"'");case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"write",value:function(){var e=x(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isFile()){e.next=2;break}throw new Error("Cannot write a non-file: "+this.url);case 2:return e.next=4,l(this,"PUT",t);case 4:if((r=e.sent).ok||!this.errorOnHTTPStatusCodes){e.next=7;break}throw new Error("Cannot write "+this.url+": "+r.statusText+" "+r.status);case 7:return e.abrupt("return",this);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"mkdir",value:function(){var e=x(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFile()){e.next=2;break}throw new Error("Cannot mkdir on a file: "+this.url);case 2:return e.next=4,l(this,"MKCOL");case 4:if((t=e.sent).ok||!this.errorOnHTTPStatusCodes){e.next=7;break}throw new Error("Cannot create directory "+this.url+": "+t.statusText+" "+t.status);case 7:return e.abrupt("return",this);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"exists",value:function(){var e=x(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isRoot()){e.next=4;break}e.t0=!0,e.next=7;break;case 4:return e.next=6,l(this,"HEAD");case 6:e.t0=!!e.sent.ok;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=x(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l(this,"DELETE");case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_propfind",value:function(){var e=x(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l(this,"PROPFIND",null,{"Content-Type":"text/xml"});case 2:if((t=e.sent).ok||!this.errorOnHTTPStatusCodes){e.next=5;break}throw new Error("Error in dirList for "+this.url+": "+t.statusText);case 5:return e.next=7,t.text();case 7:return r=e.sent,n=this.root(),e.abrupt("return",h(r).map(function(e){return n.join(e.url).assignProperties(e)}));case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"dirList",value:function(){var e=x(regeneratorRuntime.mark(function e(){var t,n,i,s,a=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("number"==typeof o||"infinity"===o){e.next=2;break}throw new Error("dirList  invalid depth argument: "+o);case 2:if(t=u.exclude,o<=0&&(o=1),1!==o){e.next=13;break}return e.next=7,this._propfind();case 7:return n=e.sent,i=n.shift(),t&&(n=r(t,n)),e.abrupt("return",n);case 13:return e.delegateYield(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dirList(1,u);case 2:return t=e.sent,r=t.filter(function(e){return e.isDirectory()}),e.abrupt("return",{v:Promise.all(r.map(function(e){return e.dirList("number"==typeof o?o-1:o,u)})).then(function(e){return e.reduce(function(e,t){return e.concat(t)},t)})});case 5:case"end":return e.stop()}},e,a)})(),"t0",14);case 14:if("object"!==(void 0===(s=e.t0)?"undefined":d(s))){e.next=17;break}return e.abrupt("return",s.v);case 17:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"readProperties",value:function(){var e=x(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._propfind();case 2:return r=e.sent[0],e.abrupt("return",this.assignProperties(r));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"post",value:function(){var e=x(regeneratorRuntime.mark(function e(){var t,r,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"string"!=typeof i&&(i=JSON.stringify(i)),e.next=3,l(this,"POST",i,{});case 3:return t=e.sent,r=void 0,n=void 0,e.prev=6,e.next=9,t.text();case 9:r=e.sent,e.next=14;break;case 12:e.prev=12,e.t0=e.catch(6);case 14:if(r&&"application/json"===t.headers.get("content-type"))try{n=JSON.parse(r)}catch(e){}if(t.ok||!this.errorOnHTTPStatusCodes){e.next=19;break}throw new Error("Error in POST "+this.url+": "+(r||t.statusText));case 19:return e.abrupt("return",n||r);case 20:case"end":return e.stop()}},e,this,[[6,12]])}));return function(t){return e.apply(this,arguments)}}()},{key:"copyTo",value:function(){var e=x(regeneratorRuntime.mark(function e(r){var n,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFile()){e.next=7;break}if(n=r.isFile()?r:r.join(this.name()),!A){e.next=7;break}if(!n.isHTTPResource){e.next=5;break}return e.abrupt("return",this._copyTo_file_nodejs_http(n,i));case 5:if(!n.isNodeJSFileResource){e.next=7;break}return e.abrupt("return",this._copyTo_file_nodejs_fs(n,i));case 7:return e.abrupt("return",g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"copyTo",this).call(this,r,i));case 8:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"_copyFrom_file_nodejs_fs",value:function(){var e=x(regeneratorRuntime.mark(function e(t){var r,n,i,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!s){e.next=3;break}return e.next=3,this.parent().ensureExistance();case 3:return r=void 0,(n=t._createReadStream()).on("error",function(e){return r=e}),e.next=8,l(this,"PUT",n);case 8:if(i=e.sent,!r){e.next=11;break}throw r;case 11:if(i.ok||!this.errorOnHTTPStatusCodes){e.next=13;break}throw new Error("copyTo: Cannot GET: "+i.statusText+" "+i.status);case 13:return e.abrupt("return",this);case 14:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"_copyTo_file_nodejs_fs",value:function(){var e=x(regeneratorRuntime.mark(function e(t){var r,n,i=this,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!s){e.next=3;break}return e.next=3,t.parent().ensureExistance();case 3:return e.next=5,l(this,"GET");case 5:if((r=e.sent).ok||!this.errorOnHTTPStatusCodes){e.next=8;break}throw new Error("copyTo: Cannot GET: "+r.statusText+" "+r.status);case 8:return n=void 0,e.abrupt("return",new Promise(function(e,s){return r.body.pipe(t._createWriteStream()).on("error",function(e){return n=e}).on("finish",function(){return n?s(n):e(i)})}));case 10:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"_copyTo_file_nodejs_http",value:function(){var e=x(regeneratorRuntime.mark(function e(t){var r,n,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!i){e.next=3;break}return e.next=3,t.parent().ensureExistance();case 3:return e.next=5,l(this,"GET");case 5:if((r=e.sent).ok||!this.errorOnHTTPStatusCodes){e.next=8;break}throw new Error("copyTo: Cannot GET: "+r.statusText+" "+r.status);case 8:return e.next=10,l(t,"PUT",r.body);case 10:if(n=e.sent,r.ok||!this.errorOnHTTPStatusCodes){e.next=13;break}throw new Error("copyTo: Cannot PUT: "+n.statusText+" "+n.status);case 13:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"isHTTPResource",get:function(){return!0}}]),t}()},B=p(t.readFile),q=p(t.writeFile),I=function(e){return new Promise(function(r,n){return t.exists(e,function(e){return r(!!e)})})},J=p(t.readdir),M=p(t.mkdir),U=p(t.rmdir),G=p(t.unlink),Y=p(t.lstat),$=p(t.rename),Q={name:"nodejs-file-resource",matches:function(e){return e.startsWith("file:")},resourceClass:function(e){function n(){return k(this,n),P(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return R(n,z),w(n,[{key:"path",value:function(){return this.url.replace("file://","")}},{key:"stat",value:function(){var e=x(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Y(this.path()));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"read",value:function(){var e=x(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=B(this.path()),e.abrupt("return",this.binary?t:t.then(String));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"write",value:function(){var e=x(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isDirectory()){e.next=2;break}throw new Error("Cannot write into a directory: "+this.path());case 2:return e.next=4,q(this.path(),t);case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"mkdir",value:function(){var e=x(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFile()){e.next=2;break}throw new Error("Cannot mkdir on a file: "+this.path());case 2:return e.next=4,M(this.path());case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"exists",value:function(){var e=x(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!!this.isRoot()||I(this.path()));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"dirList",value:function(){var e=x(regeneratorRuntime.mark(function e(){var t,n,i,s,a,o,u,c,h,f,l,p,v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("number"==typeof v||"infinity"===v){e.next=2;break}throw new Error("dirList  invalid depth argument: "+v);case 2:if(t=y.exclude,v<=0&&(v=1),1!==v){e.next=42;break}return n=[],i=!0,s=!1,a=void 0,e.prev=9,e.next=12,J(this.path());case 12:e.t0=Symbol.iterator,o=e.sent[e.t0]();case 14:if(i=(u=o.next()).done){e.next=26;break}return c=u.value,h=this.join(c),e.next=19,h.stat();case 19:f=e.sent,(h=f.isDirectory()?h.asDirectory():h)._assignPropsFromStat(f),n.push(h);case 23:i=!0,e.next=14;break;case 26:e.next=32;break;case 28:e.prev=28,e.t1=e.catch(9),s=!0,a=e.t1;case 32:e.prev=32,e.prev=33,!i&&o.return&&o.return();case 35:if(e.prev=35,!s){e.next=38;break}throw a;case 38:return e.finish(35);case 39:return e.finish(32);case 40:return t&&(n=r(t,n)),e.abrupt("return",n);case 42:return e.next=44,this.dirList(1,y);case 44:return l=e.sent,p=l.filter(function(e){return e.isDirectory()}),e.abrupt("return",Promise.all(p.map(function(e){return e.dirList("number"==typeof v?v-1:v,y)})).then(function(e){return e.reduce(function(e,t){return e.concat(t)},l)}));case 47:case"end":return e.stop()}},e,this,[[9,28,32,40],[33,,35,39]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"isEmptyDirectory",value:function(){var e=x(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dirList();case 2:return e.t0=e.sent.length,e.abrupt("return",0===e.t0);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"rename",value:function(){var e=x(regeneratorRuntime.mark(function e(t){var r,i,s,a,o,u,c,h,f,l,p,v,y,m,d,x,k,w,b,R;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof this.constructor){e.next=2;break}return e.abrupt("return",g(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"rename",this).call(this,t));case 2:if(!this.isFile()){e.next=7;break}t=t.asFile(),$(this.path(),t.path()),e.next=93;break;case 7:return t=t.asDirectory(),e.next=10,t.ensureExistance();case 10:return r=[],i=[],s=!0,a=!1,o=void 0,e.prev=14,e.next=17,this.dirList("infinity");case 17:e.t0=Symbol.iterator,u=e.sent[e.t0]();case 19:if(s=(c=u.next()).done){e.next=25;break}(h=c.value).isDirectory()?i.push(h):r.push(h);case 22:s=!0,e.next=19;break;case 25:e.next=31;break;case 27:e.prev=27,e.t1=e.catch(14),a=!0,o=e.t1;case 31:e.prev=31,e.prev=32,!s&&u.return&&u.return();case 34:if(e.prev=34,!a){e.next=37;break}throw o;case 37:return e.finish(34);case 38:return e.finish(31);case 39:f=!0,l=!1,p=void 0,e.prev=42,v=i[Symbol.iterator]();case 44:if(f=(y=v.next()).done){e.next=51;break}return m=y.value,e.next=48,t.join(m.relativePathFrom(this)).ensureExistance();case 48:f=!0,e.next=44;break;case 51:e.next=57;break;case 53:e.prev=53,e.t2=e.catch(42),l=!0,p=e.t2;case 57:e.prev=57,e.prev=58,!f&&v.return&&v.return();case 60:if(e.prev=60,!l){e.next=63;break}throw p;case 63:return e.finish(60);case 64:return e.finish(57);case 65:d=!0,x=!1,k=void 0,e.prev=68,w=r[Symbol.iterator]();case 70:if(d=(b=w.next()).done){e.next=77;break}return R=b.value,e.next=74,R.rename(t.join(R.relativePathFrom(this)));case 74:d=!0,e.next=70;break;case 77:e.next=83;break;case 79:e.prev=79,e.t3=e.catch(68),x=!0,k=e.t3;case 83:e.prev=83,e.prev=84,!d&&w.return&&w.return();case 86:if(e.prev=86,!x){e.next=89;break}throw k;case 89:return e.finish(86);case 90:return e.finish(83);case 91:return e.next=93,this.remove();case 93:return e.abrupt("return",t);case 94:case"end":return e.stop()}},e,this,[[14,27,31,39],[32,,34,38],[42,53,57,65],[58,,60,64],[68,79,83,91],[84,,86,90]])}));return function(t){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=x(regeneratorRuntime.mark(function e(){var t,r,n,i,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.exists();case 2:if(e.sent){e.next=5;break}e.next=41;break;case 5:if(!this.isDirectory()){e.next=39;break}return t=!0,r=!1,n=void 0,e.prev=9,e.next=12,this.dirList();case 12:e.t0=Symbol.iterator,i=e.sent[e.t0]();case 14:if(t=(s=i.next()).done){e.next=21;break}return a=s.value,e.next=18,a.remove();case 18:t=!0,e.next=14;break;case 21:e.next=27;break;case 23:e.prev=23,e.t1=e.catch(9),r=!0,n=e.t1;case 27:e.prev=27,e.prev=28,!t&&i.return&&i.return();case 30:if(e.prev=30,!r){e.next=33;break}throw n;case 33:return e.finish(30);case 34:return e.finish(27);case 35:return e.next=37,U(this.path());case 37:e.next=41;break;case 39:return e.next=41,G(this.path());case 41:return e.abrupt("return",this);case 42:case"end":return e.stop()}},e,this,[[9,23,27,35],[28,,30,34]])}));return function(){return e.apply(this,arguments)}}()},{key:"readProperties",value:function(){var e=x(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this.stat();case 3:return e.t1=e.sent,e.abrupt("return",e.t0._assignPropsFromStat.call(e.t0,e.t1));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"copyTo",value:function(){var e=x(regeneratorRuntime.mark(function e(t){var r,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFile()){e.next=4;break}if(!(r=t.isFile()?t:t.join(this.name())).isHTTPResource){e.next=4;break}return e.abrupt("return",r._copyFrom_file_nodejs_fs(this,i=!0));case 4:return e.abrupt("return",g(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"copyTo",this).call(this,t,i));case 5:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"_assignPropsFromStat",value:function(e){return this.assignProperties({lastModified:e.mtime,created:e.ctime,size:e.size,type:e.isDirectory()?"directory":"file",isLink:e.isSymbolicLink()})}},{key:"_createWriteStream",value:function(){return t.createWriteStream(this.path())}},{key:"_createReadStream",value:function(){return t.createReadStream(this.path())}},{key:"isNodeJSFileResource",get:function(){return!0}}]),n}()},X=/\//g,K=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(k(this,e),!t||"string"!=typeof t)throw new Error("LocalResourceInMemoryBackend needs name!");this.name=t,this._filespec=r}return w(e,null,[{key:"removeHost",value:function(e){delete this.hosts[e]}},{key:"ensure",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.named(r.host);return Promise.resolve().then(function(){return e?ee("local://"+n.name,e):null}).then(function(){return t})}},{key:"named",value:function(e){return e||(e="default"),this.hosts[e]||(this.hosts[e]=new this(e))}},{key:"hosts",get:function(){return this._hosts||(this._hosts={})}}]),w(e,[{key:"get",value:function(e){return this._filespec[e]}},{key:"set",value:function(e,t){this._filespec[e]=t}},{key:"write",value:function(e,t){var r=this._filespec[e];r||(r=this._filespec[e]={created:new Date}),r.content=t,r.isDirectory=!1,r.lastModified=new Date}},{key:"read",value:function(e){var t=this._filespec[e];return t&&t.content?t.content:""}},{key:"mkdir",value:function(e){var t=this._filespec[e];t&&t.isDirectory||(t||(t=this._filespec[e]={created:new Date}),t.content&&delete t.content,t.isDirectory=!0,t.lastModified=new Date)}},{key:"partialFilespec",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,r={},n=this.filespec,i=Object.keys(n),s=0;s<i.length;s++){var a=i[s];if(a.startsWith(e)&&e!==a){var o=a.slice(e.length);(o.includes("/")?o.match(X).length+1:1)>t||(r[a]=n[a])}}return r}},{key:"filespec",get:function(){return this._filespec},set:function(e){this._filespec=e}}]),e}(),V={name:"local-resource",matches:function(e){return e.startsWith("local:")},resourceClass:function(e){function t(){return k(this,t),P(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return R(t,z),w(t,[{key:"read",value:function(){return Promise.resolve(this.localBackend.read(this.path()))}},{key:"write",value:function(e){if(this.isDirectory())throw new Error("Cannot write into a directory! ("+this.url+")");var t=this.localBackend.get(this.path());if(t&&t.isDirectory)throw new Error(this.url+" already exists and is a directory (cannot write into it!)");return this.localBackend.write(this.path(),e),Promise.resolve(this)}},{key:"mkdir",value:function(){if(!this.isDirectory())throw new Error("Cannot mkdir a file! ("+this.url+")");var e=this.localBackend.get(this.path());if(e&&e.isDirectory)return Promise.resolve(this);if(e&&!e.isDirectory)throw new Error(this.url+" already exists and is a file (cannot mkdir it!)");return this.localBackend.mkdir(this.path()),Promise.resolve(this)}},{key:"exists",value:function(){return Promise.resolve(this.isRoot()||this.path()in this.localBackend.filespec)}},{key:"remove",value:function(){var e=this,t=this.path();return Object.keys(this.localBackend.filespec).forEach(function(r){return r.startsWith(t)&&delete e.localBackend.filespec[r]}),Promise.resolve(this)}},{key:"readProperties",value:function(){throw new Error("not yet implemented")}},{key:"dirList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isDirectory())return this.asDirectory().dirList(t,r);var n=r.exclude,i=this.path(),s=[],a=Object.keys(this.localBackend.filespec);"infinity"===t&&(t=1/0);for(var o=0;o<a.length;o++){var u=a[o];if(u.startsWith(i)&&i!==u){var c=u.slice(i.length);if(!((c.includes("/")?c.match(X).length+1:1)>t&&"continue"===function(){var r=e.join(c.split("/").slice(0,t).join("/")+"/");return s.some(function(e){return e.equals(r)})||s.push(r),"continue"}())){var h=this.join(c);n&&!v(h,n)||s.push(h)}}}return Promise.resolve(s)}},{key:"localBackend",get:function(){return K.named(this.host())}}]),t}()},Z=Z||[];m(V),m(W),m(Q);var ee=function(){var e=x(regeneratorRuntime.mark(function e(t,r,n){var i,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=y(t,n).asDirectory(),e.next=3,i.ensureExistance();case 3:e.t0=regeneratorRuntime.keys(r);case 4:if((e.t1=e.t0()).done){e.next=18;break}if(s=e.t1.value,r.hasOwnProperty(s)){e.next=8;break}return e.abrupt("continue",4);case 8:if(a=i.join(s),"object"!==d(r[s])){e.next=14;break}return e.next=12,ee(a,r[s],n);case 12:e.next=16;break;case 14:return e.next=16,a.write(r[s]);case 16:e.next=4;break;case 18:return e.abrupt("return",i);case 19:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),te=function(){var e=x(regeneratorRuntime.mark(function e(t){var r,n,i,s,a,o,u,c,h,f,l,p,v,y,m,d,x,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"infinity",w=arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.dirList(k,w);case 2:r=e.sent,n={},i=!0,s=!1,a=void 0,e.prev=7,o=r[Symbol.iterator]();case 9:if(i=(u=o.next()).done){e.next=44;break}if(!(c=u.value).isDirectory()){e.next=15;break}e.t0={},e.next=18;break;case 15:return e.next=17,c.read();case 17:e.t0=e.sent;case 18:for(h=e.t0,f=c.asFile().relativePathFrom(t).split("/"),l=n,p=!0,v=!1,y=void 0,e.prev=24,m=f.slice(0,-1)[Symbol.iterator]();!(p=(d=m.next()).done);p=!0)x=d.value,l[x]||(l[x]={}),l=l[x];e.next=32;break;case 28:e.prev=28,e.t1=e.catch(24),v=!0,y=e.t1;case 32:e.prev=32,e.prev=33,!p&&m.return&&m.return();case 35:if(e.prev=35,!v){e.next=38;break}throw y;case 38:return e.finish(35);case 39:return e.finish(32);case 40:l[f[f.length-1]]=h;case 41:i=!0,e.next=9;break;case 44:e.next=50;break;case 46:e.prev=46,e.t2=e.catch(7),s=!0,a=e.t2;case 50:e.prev=50,e.prev=51,!i&&o.return&&o.return();case 53:if(e.prev=53,!s){e.next=56;break}throw a;case 56:return e.finish(53);case 57:return e.finish(50);case 58:return e.abrupt("return",n);case 59:case"end":return e.stop()}},e,this,[[7,46,50,58],[24,28,32,40],[33,,35,39],[51,,53,57]])}));return function(t,r,n){return e.apply(this,arguments)}}(),re=function(){var e=x(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!("fetch"in System.global&&"Headers"in System.global)){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:if(t=System.decanonicalize("lively.resources"),!System.get("@system-env").node){e.next=16;break}e.prev=4,r=System._nodeRequire("fetch-ponyfill"),e.next=14;break;case 8:return e.prev=8,e.t0=e.catch(4),e.next=12,System.normalize("fetch-ponyfill",t);case 12:n=e.sent.replace("file://",""),r=System._nodeRequire(n);case 14:e.next=19;break;case 16:return e.next=18,System.import("fetch-ponyfill",t);case 18:r=e.sent;case 19:Object.assign(System.global,r());case 20:case"end":return e.stop()}},e,this,[[4,8]])}));return function(){return e.apply(this,arguments)}}();e.resource=y,e.createFiles=ee,e.createFileSpec=te,e.loadViaScript=function(e,t){var r=document.head,n=r.namespaceURI;return new Promise(function(t,i){var s=document.createElementNS(n,"script");s.setAttribute("type","text/ecmascript"),r.appendChild(s),s.setAttributeNS(null,"id",e),"http://www.w3.org/2000/svg"===s.namespaceURI?s.setAttributeNS("http://www.w3.org/1999/xlink","href",e):s.setAttribute("src",e),s.onload=t,s.onerror=i,s.setAttributeNS(null,"async",!0)})},e.ensureFetch=re,e.registerExtension=m,e.unregisterExtension=function(e){var t="string"==typeof e?e:e.name;Z=Z.filter(function(e){return e.name!==t})},e.Resource=z,e.parseQuery=n}(this.lively.resources=this.lively.resources||{},"undefined"!=typeof module&&"function"==typeof module.require?module.require("fs"):{readFile:function(){throw new Error("fs module not available")}}),"undefined"!=typeof module&&module.exports&&(module.exports=e.lively.resources)}();
//LIVELY.STORAGE
!function(){var PouchDB=function(){var e={},t={exports:e};return function(r){if("object"==typeof e&&void 0!==t)t.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).PouchDB=r()}}(function(){return function e(t,r,n){function i(s,a){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var f=r[s]={exports:{}};t[s][0].call(f.exports,function(e){var r=t[s][1][e];return i(r||e)},f,f.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){"use strict";t.exports=function(e){return function(){var t=arguments.length;if(t){for(var r=[],n=-1;++n<t;)r[n]=arguments[n];return e.call(this,r)}return e.call(this,[])}}},{}],2:[function(e,t,r){(function(n){function i(){try{return r.storage.debug}catch(e){}if(void 0!==n&&"env"in n)return n.env.DEBUG}(r=t.exports=e(3)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},r.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+r.humanize(this.diff),!t)return;var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(o=++i)}),e.splice(o,0,n)},r.save=function(e){try{null==e?r.storage.removeItem("debug"):r.storage.debug=e}catch(e){}},r.load=i,r.useColors=function(){if("undefined"!=typeof window&&window&&void 0!==window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document&&"WebkitAppearance"in document.documentElement.style||"undefined"!=typeof window&&window&&window.console&&(console.firebug||console.exception&&console.table)||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},r.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),r.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],r.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},r.enable(i())}).call(this,e(9))},{3:3,9:9}],3:[function(e,t,r){var n;function i(e){function t(){if(t.enabled){var e=t,i=+new Date,o=i-(n||i);e.diff=o,e.prev=n,e.curr=i,n=i;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=r.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var u=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(t,n){if("%%"===t)return t;u++;var i=r.formatters[n];if("function"==typeof i){var o=s[u];t=i.call(e,o),s.splice(u,1),u--}return t}),r.formatArgs.call(e,s),(t.log||r.log||console.log.bind(console)).apply(e,s)}}return t.namespace=e,t.enabled=r.enabled(e),t.useColors=r.useColors(),t.color=function(e){var t,n=0;for(t in e)n=(n<<5)-n+e.charCodeAt(t),n|=0;return r.colors[Math.abs(n)%r.colors.length]}(e),"function"==typeof r.init&&r.init(t),t}(r=t.exports=i.debug=i.default=i).coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){r.enable("")},r.enable=function(e){r.save(e);for(var t=(e||"").split(/[\s,]+/),n=t.length,i=0;i<n;i++)t[i]&&("-"===(e=t[i].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")))},r.enabled=function(e){var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=e(8),r.names=[],r.skips=[],r.formatters={}},{8:8}],4:[function(e,t,r){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,r,n,a,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var f=new Error('Uncaught, unspecified "error" event. ('+t+")");throw f.context=t,f}if(s(r=this._events[e]))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),r.apply(this,a)}else if(o(r))for(a=Array.prototype.slice.call(arguments,1),n=(c=r.slice()).length,u=0;u<n;u++)c[u].apply(this,a);return!0},n.prototype.addListener=function(e,t){var r;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(r=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var r=!1;function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var r,n,s,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=(r=this._events[e]).length,n=-1,r===t||i(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(r)){for(a=s;a-- >0;)if(r[a]===t||r[a].listener&&r[a].listener===t){n=a;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],5:[function(e,t,r){(function(e){"use strict";var r,n,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,s=new i(f),a=e.document.createTextNode("");s.observe(a,{characterData:!0}),r=function(){a.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){f(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(f,0)};else{var u=new e.MessageChannel;u.port1.onmessage=f,r=function(){u.port2.postMessage(0)}}var c=[];function f(){var e,t;n=!0;for(var r=c.length;r;){for(t=c,c=[],e=-1;++e<r;)t[e]();r=c.length}n=!1}t.exports=function(e){1!==c.push(e)||n||r()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],7:[function(e,t,r){"use strict";var n=e(5);function i(){}var o={},s=["REJECTED"],a=["FULFILLED"],u=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,e!==i&&d(this,e)}function f(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function l(e,t,r){n(function(){var n;try{n=t(r)}catch(t){return o.reject(e,t)}n===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,n)})}function h(e){var t=e&&e.then;if(e&&"object"==typeof e&&"function"==typeof t)return function(){t.apply(e,arguments)}}function d(e,t){var r=!1;function n(t){r||(r=!0,o.reject(e,t))}function i(t){r||(r=!0,o.resolve(e,t))}var s=p(function(){t(i,n)});"error"===s.status&&n(s.value)}function p(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}t.exports=c,c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===s)return this;var r=new this.constructor(i);this.state!==u?l(r,this.state===a?e:t,this.outcome):this.queue.push(new f(r,e,t));return r},f.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},f.prototype.otherCallFulfilled=function(e){l(this.promise,this.onFulfilled,e)},f.prototype.callRejected=function(e){o.reject(this.promise,e)},f.prototype.otherCallRejected=function(e){l(this.promise,this.onRejected,e)},o.resolve=function(e,t){var r=p(h,t);if("error"===r.status)return o.reject(e,r.value);var n=r.value;if(n)d(e,n);else{e.state=a,e.outcome=t;for(var i=-1,s=e.queue.length;++i<s;)e.queue[i].callFulfilled(t)}return e},o.reject=function(e,t){e.state=s,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},c.resolve=function(e){if(e instanceof this)return e;return o.resolve(new this(i),e)},c.reject=function(e){var t=new this(i);return o.reject(t,e)},c.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);var s=new Array(r),a=0,u=-1,c=new this(i);for(;++u<r;)f(e[u],u);return c;function f(e,i){t.resolve(e).then(function(e){s[i]=e,++a!==r||n||(n=!0,o.resolve(c,s))},function(e){n||(n=!0,o.reject(c,e))})}},c.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);var s=-1,a=new this(i);for(;++s<r;)u=e[s],t.resolve(u).then(function(e){n||(n=!0,o.resolve(a,e))},function(e){n||(n=!0,o.reject(a,e))});var u;return a}},{5:5}],8:[function(e,t,r){var n=1e3,i=60*n,o=60*i,s=24*o,a=365.25*s;function u(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}t.exports=function(e,t){t=t||{};var r,c=typeof e;if("string"===c&&e.length>0)return function(e){if((e=String(e)).length>1e4)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*a;case"days":case"day":case"d":return r*s;case"hours":case"hour":case"hrs":case"hr":case"h":return r*o;case"minutes":case"minute":case"mins":case"min":case"m":return r*i;case"seconds":case"second":case"secs":case"sec":case"s":return r*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}(e);if("number"===c&&!1===isNaN(e))return t.long?u(r=e,s,"day")||u(r,o,"hour")||u(r,i,"minute")||u(r,n,"second")||r+" ms":function(e){if(e>=s)return Math.round(e/s)+"d";if(e>=o)return Math.round(e/o)+"h";if(e>=i)return Math.round(e/i)+"m";if(e>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],9:[function(e,t,r){var n,i,o=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function u(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var c,f=[],l=!1,h=-1;function d(){l&&c&&(l=!1,c.length?f=c.concat(f):h=-1,f.length&&p())}function p(){if(!l){var e=u(d);l=!0;for(var t=f.length;t;){for(c=f,f=[];++h<t;)c&&c[h].run();h=-1,t=f.length}c=null,l=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function v(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];f.push(new v(e,t)),1!==f.length||l||u(p)},v.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],10:[function(e,t,r){(function(){var e={}.hasOwnProperty,r=[].slice;t.exports=function(t,n){var i,o,s,a;for(i in o=[],a=[],n)e.call(n,i)&&(s=n[i],"this"!==i&&(o.push(i),a.push(s)));return Function.apply(null,r.call(o).concat([t])).apply(n.this,a)}}).call(this)},{}],11:[function(e,t,r){!function(e){if("object"==typeof r)t.exports=e();else{var n;try{n=window}catch(e){n=self}n.SparkMD5=e()}}(function(e){"use strict";var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function r(e,t){var r=e[0],n=e[1],i=e[2],o=e[3];n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&i)+t[1]-389564586|0)<<12|o>>>20)+r|0)&r|~o&n)+t[2]+606105819|0)<<17|i>>>15)+o|0)&o|~i&r)+t[3]-1044525330|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&i)+t[5]+1200080426|0)<<12|o>>>20)+r|0)&r|~o&n)+t[6]-1473231341|0)<<17|i>>>15)+o|0)&o|~i&r)+t[7]-45705983|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&i)+t[9]-1958414417|0)<<12|o>>>20)+r|0)&r|~o&n)+t[10]-42063|0)<<17|i>>>15)+o|0)&o|~i&r)+t[11]-1990404162|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&i)+t[13]-40341101|0)<<12|o>>>20)+r|0)&r|~o&n)+t[14]-1502002290|0)<<17|i>>>15)+o|0)&o|~i&r)+t[15]+1236535329|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[1]-165796510|0)<<5|r>>>27)+n|0)&i|n&~i)+t[6]-1069501632|0)<<9|o>>>23)+r|0)&n|r&~n)+t[11]+643717713|0)<<14|i>>>18)+o|0)&r|o&~r)+t[0]-373897302|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[5]-701558691|0)<<5|r>>>27)+n|0)&i|n&~i)+t[10]+38016083|0)<<9|o>>>23)+r|0)&n|r&~n)+t[15]-660478335|0)<<14|i>>>18)+o|0)&r|o&~r)+t[4]-405537848|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[9]+568446438|0)<<5|r>>>27)+n|0)&i|n&~i)+t[14]-1019803690|0)<<9|o>>>23)+r|0)&n|r&~n)+t[3]-187363961|0)<<14|i>>>18)+o|0)&r|o&~r)+t[8]+1163531501|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[13]-1444681467|0)<<5|r>>>27)+n|0)&i|n&~i)+t[2]-51403784|0)<<9|o>>>23)+r|0)&n|r&~n)+t[7]+1735328473|0)<<14|i>>>18)+o|0)&r|o&~r)+t[12]-1926607734|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[5]-378558|0)<<4|r>>>28)+n|0)^n^i)+t[8]-2022574463|0)<<11|o>>>21)+r|0)^r^n)+t[11]+1839030562|0)<<16|i>>>16)+o|0)^o^r)+t[14]-35309556|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[1]-1530992060|0)<<4|r>>>28)+n|0)^n^i)+t[4]+1272893353|0)<<11|o>>>21)+r|0)^r^n)+t[7]-155497632|0)<<16|i>>>16)+o|0)^o^r)+t[10]-1094730640|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[13]+681279174|0)<<4|r>>>28)+n|0)^n^i)+t[0]-358537222|0)<<11|o>>>21)+r|0)^r^n)+t[3]-722521979|0)<<16|i>>>16)+o|0)^o^r)+t[6]+76029189|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[9]-640364487|0)<<4|r>>>28)+n|0)^n^i)+t[12]-421815835|0)<<11|o>>>21)+r|0)^r^n)+t[15]+530742520|0)<<16|i>>>16)+o|0)^o^r)+t[2]-995338651|0)<<23|n>>>9)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[0]-198630844|0)<<6|r>>>26)+n|0)|~i))+t[7]+1126891415|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[14]-1416354905|0)<<15|i>>>17)+o|0)|~r))+t[5]-57434055|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[12]+1700485571|0)<<6|r>>>26)+n|0)|~i))+t[3]-1894986606|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[10]-1051523|0)<<15|i>>>17)+o|0)|~r))+t[1]-2054922799|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[8]+1873313359|0)<<6|r>>>26)+n|0)|~i))+t[15]-30611744|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[6]-1560198380|0)<<15|i>>>17)+o|0)|~r))+t[13]+1309151649|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[4]-145523070|0)<<6|r>>>26)+n|0)|~i))+t[11]-1120210379|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[2]+718787259|0)<<15|i>>>17)+o|0)|~r))+t[9]-343485551|0)<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0}function n(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function i(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function o(e){var t,i,o,s,a,u,c=e.length,f=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)r(f,n(e.substring(t-64,t)));for(i=(e=e.substring(t-64)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<i;t+=1)o[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(r(f,o),t=0;t<16;t+=1)o[t]=0;return s=(s=8*c).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),u=parseInt(s[1],16)||0,o[14]=a,o[15]=u,r(f,o),f}function s(e){var r,n="";for(r=0;r<4;r+=1)n+=t[e>>8*r+4&15]+t[e>>8*r&15];return n}function a(e){var t;for(t=0;t<e.length;t+=1)e[t]=s(e[t]);return e.join("")}function u(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function c(e){var t,r=[],n=e.length;for(t=0;t<n-1;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function f(){this.reset()}return"5d41402abc4b2a76b9719d911017c592"!==a(o("hello"))&&function(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r},"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,n){var i,o,s,a,u=this.byteLength,c=t(r,u),f=u;return n!==e&&(f=t(n,u)),c>f?new ArrayBuffer(0):(i=f-c,o=new ArrayBuffer(i),s=new Uint8Array(o),a=new Uint8Array(this,c,i),s.set(a),o)}}(),f.prototype.append=function(e){return this.appendBinary(u(e)),this},f.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,i=this._buff.length;for(t=64;t<=i;t+=64)r(this._hash,n(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},f.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(o,i),r=a(this._hash),e&&(r=c(r)),this.reset(),r},f.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},f.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},f.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},f.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},f.prototype._finish=function(e,t){var n,i,o,s=t;if(e[s>>2]|=128<<(s%4<<3),s>55)for(r(this._hash,e),s=0;s<16;s+=1)e[s]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),o=parseInt(n[1],16)||0,e[14]=i,e[15]=o,r(this._hash,e)},f.hash=function(e,t){return f.hashBinary(u(e),t)},f.hashBinary=function(e,t){var r=a(o(e));return t?c(r):r},f.ArrayBuffer=function(){this.reset()},f.ArrayBuffer.prototype.append=function(e){var t,n,o,s,a,u=(n=this._buff.buffer,o=e,s=!0,(a=new Uint8Array(n.byteLength+o.byteLength)).set(new Uint8Array(n)),a.set(new Uint8Array(o),n.byteLength),s?a:a.buffer),c=u.length;for(this._length+=e.byteLength,t=64;t<=c;t+=64)r(this._hash,i(u.subarray(t-64,t)));return this._buff=t-64<c?new Uint8Array(u.buffer.slice(t-64)):new Uint8Array(0),this},f.ArrayBuffer.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n[t]<<(t%4<<3);return this._finish(o,i),r=a(this._hash),e&&(r=c(r)),this.reset(),r},f.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},f.ArrayBuffer.prototype.getState=function(){var e,t=f.prototype.getState.call(this);return t.buff=(e=t.buff,String.fromCharCode.apply(null,new Uint8Array(e))),t},f.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var r,n=e.length,i=new ArrayBuffer(n),o=new Uint8Array(i);for(r=0;r<n;r+=1)o[r]=e.charCodeAt(r);return t?o:i}(e.buff,!0),f.prototype.setState.call(this,e)},f.ArrayBuffer.prototype.destroy=f.prototype.destroy,f.ArrayBuffer.prototype._finish=f.prototype._finish,f.ArrayBuffer.hash=function(e,t){var n=a(function(e){var t,n,o,s,a,u,c=e.length,f=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)r(f,i(e.subarray(t-64,t)));for(n=(e=t-64<c?e.subarray(t-64):new Uint8Array(0)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)o[t>>2]|=e[t]<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(r(f,o),t=0;t<16;t+=1)o[t]=0;return s=(s=8*c).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),u=parseInt(s[1],16)||0,o[14]=a,o[15]=u,r(f,o),f}(new Uint8Array(e)));return t?c(n):n},f})},{}],12:[function(e,t,r){"use strict";function n(e,t,r){var n=r[r.length-1];e===n.element&&(r.pop(),n=r[r.length-1]);var i=n.element,o=n.index;if(Array.isArray(i))i.push(e);else if(o===t.length-2){i[t.pop()]=e}else t.push(e)}r.stringify=function(e){var t=[];t.push({obj:e});for(var r,n,i,o,s,a,u,c,f,l,h="";r=t.pop();)if(n=r.obj,h+=r.prefix||"",i=r.val||"")h+=i;else if("object"!=typeof n)h+=void 0===n?null:JSON.stringify(n);else if(null===n)h+="null";else if(Array.isArray(n)){for(t.push({val:"]"}),o=n.length-1;o>=0;o--)s=0===o?"":",",t.push({obj:n[o],prefix:s});t.push({val:"["})}else{for(u in a=[],n)n.hasOwnProperty(u)&&a.push(u);for(t.push({val:"}"}),o=a.length-1;o>=0;o--)f=n[c=a[o]],l=o>0?",":"",l+=JSON.stringify(c)+":",t.push({obj:f,prefix:l});t.push({val:"{"})}return h},r.parse=function(e){for(var t,r,i,o,s,a,u,c,f,l=[],h=[],d=0;;)if("}"!==(t=e[d++])&&"]"!==t&&void 0!==t)switch(t){case" ":case"\t":case"\n":case":":case",":break;case"n":d+=3,n(null,l,h);break;case"t":d+=3,n(!0,l,h);break;case"f":d+=4,n(!1,l,h);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(r="",d--;;){if(i=e[d++],!/[\d\.\-e\+]/.test(i)){d--;break}r+=i}n(parseFloat(r),l,h);break;case'"':for(o="",s=void 0,a=0;'"'!==(u=e[d++])||"\\"===s&&a%2==1;)o+=u,"\\"===(s=u)?a++:a=0;n(JSON.parse('"'+o+'"'),l,h);break;case"[":c={element:[],index:l.length},l.push(c.element),h.push(c);break;case"{":f={element:{},index:l.length},l.push(f.element),h.push(f);break;default:throw new Error("unexpectedly reached end of input: "+t)}else{if(1===l.length)return l.pop();n(l.pop(),l,h)}}},{}],13:[function(e,t,r){(function(r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var i=n(e(7)),o=n(e(1)),s=n(e(2)),a=e(4),u=n(e(6)),c=n(e(5)),f=n(e(10)),l=n(e(11)),h=n(e(12)),d="function"==typeof Promise?Promise:i;function p(e){if(e instanceof ArrayBuffer)return function(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),r=new Uint8Array(t),n=new Uint8Array(e);return r.set(n),t}(e);var t=e.size,r=e.type;return"function"==typeof e.slice?e.slice(0,t,r):e.webkitSlice(0,t,r)}var v=Function.prototype.toString,m=v.call(Object);function g(e){var t,r,n;if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(t=[],r=0,n=e.length;r<n;r++)t[r]=g(e[r]);return t}if(e instanceof Date)return e.toISOString();if(function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer||"undefined"!=typeof Blob&&e instanceof Blob}(e))return p(e);if(!function(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var r=t.constructor;return"function"==typeof r&&r instanceof r&&v.call(r)==m}(e))return e;for(r in t={},e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=g(e[r]);void 0!==i&&(t[r]=i)}return t}function y(e){var t=!1;return o(function(r){if(t)throw new Error("once called more than once");t=!0,e.apply(this,r)})}function _(e){return o(function(t){var r=this,n="function"==typeof(t=g(t))[t.length-1]&&t.pop(),i=new d(function(n,i){var o;try{var s=y(function(e,t){e?i(e):n(t)});t.push(s),(o=e.apply(r,t))&&"function"==typeof o.then&&n(o)}catch(e){i(e)}});return n&&i.then(function(e){n(null,e)},n),i})}var b,w,k=s("pouchdb:api");function x(e,t){return _(o(function(r){if(this._closed)return d.reject(new Error("database is closed"));if(this._destroyed)return d.reject(new Error("database is destroyed"));var n=this;return function(e,t,r){if(k.enabled){for(var n=[e.name,t],i=0;i<r.length-1;i++)n.push(r[i]);k.apply(null,n);var o=r[r.length-1];r[r.length-1]=function(r,n){var i=[e.name,t];i=i.concat(r?["error",r]:["success",n]),k.apply(null,i),o(r,n)}}}(n,e,r),this.taskqueue.isReady?t.apply(this,r):new d(function(t,i){n.taskqueue.addTask(function(o){o?i(o):t(n[e].apply(n,r))})})}))}function E(e){return"$"+e}function S(e){return e.substring(1)}function R(){this._store={}}function j(e){if(this._store=new R,e&&Array.isArray(e))for(var t=0,r=e.length;t<r;t++)this.add(e[t])}function T(e,t){for(var r={},n=0,i=t.length;n<i;n++){var o=t[n];o in e&&(r[o]=e[o])}return r}R.prototype.get=function(e){var t=E(e);return this._store[t]},R.prototype.set=function(e,t){var r=E(e);return this._store[r]=t,!0},R.prototype.has=function(e){return E(e)in this._store},R.prototype.delete=function(e){var t=E(e),r=t in this._store;return delete this._store[t],r},R.prototype.forEach=function(e){for(var t=Object.keys(this._store),r=0,n=t.length;r<n;r++){var i=t[r];e(this._store[i],i=S(i))}},Object.defineProperty(R.prototype,"size",{get:function(){return Object.keys(this._store).length}}),j.prototype.add=function(e){return this._store.set(e,!0)},j.prototype.has=function(e){return this._store.has(e)},j.prototype.forEach=function(e){this._store.forEach(function(t,r){e(r)})},Object.defineProperty(j.prototype,"size",{get:function(){return this._store.size}}),!function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}()?(b=j,w=R):(b=Set,w=Map);var D,O=6;function A(e){return e}function B(e){return[{ok:e}]}function C(e,t,r){var n=t.docs,i=new w;n.forEach(function(e){i.has(e.id)?i.get(e.id).push(e):i.set(e.id,[e])});var o=i.size,s=0,a=new Array(o);function u(){var e;++s===o&&(e=[],a.forEach(function(t){t.docs.forEach(function(r){e.push({id:t.id,docs:[r]})})}),r(null,{results:e}))}var c=[];i.forEach(function(e,t){c.push(t)});var f=0;function l(){if(!(f>=c.length)){var r=Math.min(f+O,c.length),n=c.slice(f,r);!function(r,n){r.forEach(function(r,o){var s=n+o,c=i.get(r),f=T(c[0],["atts_since","attachments"]);f.open_revs=c.map(function(e){return e.rev}),f.open_revs=f.open_revs.filter(A);var h=A;0===f.open_revs.length&&(delete f.open_revs,h=B),["revs","attachments","binary","ajax","latest"].forEach(function(e){e in t&&(f[e]=t[e])}),e.get(r,f,function(e,t){var n,i,o;n=e?[{error:e}]:h(t),i=r,o=n,a[s]={id:i,docs:o},u(),l()})})}(n,f),f+=n.length}}l()}function L(){return"undefined"!=typeof chrome&&void 0!==chrome.storage&&void 0!==chrome.storage.local}if(L())D=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),D=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){D=!1}function I(){return D}function q(){var e;a.EventEmitter.call(this),this._listeners={},e=this,L()?chrome.storage.onChanged.addListener(function(t){null!=t.db_name&&e.emit(t.dbName.newValue)}):I()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(t){e.emit(t.key)}):window.attachEvent("storage",function(t){e.emit(t.key)}))}function N(e){if("undefined"!==console&&e in console){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function M(e){var t=0;return e||(t=2e3),function(e,t){return e=parseInt(e,10)||0,(t=parseInt(t,10))!=t||t<=e?t=(e||1)<<1:t+=1,t>6e5&&(e=3e5,t=6e5),~~((t-e)*Math.random()+e)}(e,t)}function P(e,t){N("info","The above "+e+" is totally normal. "+t)}u(q,a.EventEmitter),q.prototype.addListener=function(e,t,r,n){if(!this._listeners[t]){var i=this,o=!1;this._listeners[t]=s,this.on(e,s)}function s(){if(i._listeners[t])if(o)o="waiting";else{o=!0;var e=T(n,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);r.changes(e).on("change",function(e){e.seq>n.since&&!n.cancelled&&(n.since=e.seq,n.onChange(e))}).on("complete",function(){"waiting"===o&&c(s),o=!1}).on("error",function(){o=!1})}}},q.prototype.removeListener=function(e,t){t in this._listeners&&(a.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},q.prototype.notifyLocalWindows=function(e){L()?chrome.storage.local.set({dbName:e}):I()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},q.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var F="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t};function U(e,t,r){Error.call(this,r),this.status=e,this.name=t,this.message=r,this.error=!0}u(U,Error),U.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};new U(401,"unauthorized","Name or password is incorrect.");var G=new U(400,"bad_request","Missing JSON list of 'docs'"),W=new U(404,"not_found","missing"),z=new U(409,"conflict","Document update conflict"),H=new U(400,"bad_request","_id field must contain a string"),K=new U(412,"missing_id","_id is required for puts"),J=new U(400,"bad_request","Only reserved document ids may start with underscore."),V=(new U(412,"precondition_failed","Database not open"),new U(500,"unknown_error","Database encountered an unknown error")),$=new U(500,"badarg","Some query argument is invalid"),Q=(new U(400,"invalid_request","Request was invalid"),new U(400,"query_parse_error","Some query parameter is invalid")),X=new U(500,"doc_validation","Bad special document member"),Y=new U(400,"bad_request","Something wrong with the request"),Z=new U(400,"bad_request","Document must be a JSON object"),ee=(new U(404,"not_found","Database not found"),new U(500,"indexed_db_went_bad","unknown")),te=new U(500,"web_sql_went_bad","unknown"),re=(new U(500,"levelDB_went_went_bad","unknown"),new U(403,"forbidden","Forbidden by design doc validate_doc_update function"),new U(400,"bad_request","Invalid rev format")),ne=(new U(412,"file_exists","The database could not be created, the file already exists."),new U(412,"missing_stub","A pre-existing attachment stub wasn't found"));new U(413,"invalid_url","Provided URL is invalid");function ie(e,t){function r(t){for(var r in e)"function"!=typeof e[r]&&(this[r]=e[r]);void 0!==t&&(this.reason=t)}return r.prototype=U.prototype,new r(t)}function oe(e){if("object"!=typeof e){var t=e;(e=V).data=t}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}function se(e){var t={},r=e.filter&&"function"==typeof e.filter;return t.query=e.query_params,function(n){n.doc||(n.doc={});var i=r&&function(e,t,r){try{return!e(t,r)}catch(e){var n="Filter function threw: "+e.toString();return ie(Y,n)}}(e.filter,n.doc,t);if("object"==typeof i)return i;if(i)return!1;if(e.include_docs){if(!e.attachments)for(var o in n.doc._attachments)n.doc._attachments.hasOwnProperty(o)&&(n.doc._attachments[o].stub=!0)}else delete n.doc;return!0}}function ae(e){for(var t=[],r=0,n=e.length;r<n;r++)t=t.concat(e[r]);return t}function ue(e){var t;if(e?"string"!=typeof e?t=ie(H):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=ie(J)):t=ie(K),t)throw t}function ce(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}function fe(e){var t=ce(e);return t?t.join("/"):null}var le=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],he="queryKey",de=/(?:^|&)([^&=]*)=?([^&]*)/g,pe=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function ve(e){for(var t=pe.exec(e),r={},n=14;n--;){var i=le[n],o=t[n]||"",s=-1!==["user","password"].indexOf(i);r[i]=s?decodeURIComponent(o):o}return r[he]={},r[le[12]].replace(de,function(e,t,n){t&&(r[he][t]=n)}),r}function me(e,t,r){return new d(function(n,i){e.get(t,function(o,s){if(o){if(404!==o.status)return i(o);s={}}var a=s._rev,u=r(s);if(!u)return n({updated:!1,rev:a});u._id=t,u._rev=a,n(function(e,t,r){return e.put(t).then(function(e){return{updated:!0,rev:e.rev}},function(n){if(409!==n.status)throw n;return me(e,t._id,r)})}(e,u,r))})})}var ge="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");function ye(e){return 0|Math.random()*e}function _e(e,t){t=t||ge.length;var r="",n=-1;if(e){for(;++n<e;)r+=ge[ye(t)];return r}for(;++n<36;)switch(n){case 8:case 13:case 18:case 23:r+="-";break;case 19:r+=ge[3&ye(16)|8];break;default:r+=ge[ye(16)]}return r}function be(e){for(var t,r,n,i,o=e.rev_tree.slice();i=o.pop();){var s=i.ids,a=s[2],u=i.pos;if(a.length)for(var c=0,f=a.length;c<f;c++)o.push({pos:u+1,ids:a[c]});else{var l=!!s[1].deleted,h=s[0];t&&!(n!==l?n:r!==u?r<u:t<h)||(t=h,r=u,n=l)}}return r+"-"+t}function we(e,t){for(var r,n=e.slice();r=n.pop();)for(var i=r.pos,o=r.ids,s=o[2],a=t(0===s.length,i,o[0],r.ctx,o[1]),u=0,c=s.length;u<c;u++)n.push({pos:i+1,ids:s[u],ctx:a})}function ke(e,t){return e.pos-t.pos}function xe(e){var t=[];we(e,function(e,r,n,i,o){e&&t.push({rev:r+"-"+n,pos:r,opts:o})}),t.sort(ke).reverse();for(var r=0,n=t.length;r<n;r++)delete t[r].pos;return t}function Ee(e){for(var t=be(e),r=xe(e.rev_tree),n=[],i=0,o=r.length;i<o;i++){var s=r[i];s.rev===t||s.opts.deleted||n.push(s.rev)}return n}function Se(e){var t=[];return we(e.rev_tree,function(e,r,n,i,o){"available"!==o.status||e||(t.push(r+"-"+n),o.status="missing")}),t}function Re(e){for(var t,r=[],n=e.slice();t=n.pop();){var i=t.pos,o=t.ids,s=o[0],a=o[1],u=o[2],c=0===u.length,f=t.history?t.history.slice():[];f.push({id:s,opts:a}),c&&r.push({pos:i+1-f.length,ids:f});for(var l=0,h=u.length;l<h;l++)n.push({pos:i+1,ids:u[l],history:f})}return r.reverse()}function je(e,t){return e.pos-t.pos}function Te(e,t,r){var n=function(e,t,r){for(var n,i=0,o=e.length;i<o;)r(e[n=i+o>>>1],t)<0?i=n+1:o=n;return i}(e,t,r);e.splice(n,0,t)}function De(e,t){for(var r,n,i=t,o=e.length;i<o;i++){var s=e[i],a=[s.id,s.opts,[]];n?(n[2].push(a),n=a):r=n=a}return r}function Oe(e,t){return e[0]<t[0]?-1:1}function Ae(e,t){for(var r=[{tree1:e,tree2:t}],n=!1;r.length>0;){var i=r.pop(),o=i.tree1,s=i.tree2;(o[1].status||s[1].status)&&(o[1].status="available"===o[1].status||"available"===s[1].status?"available":"missing");for(var a=0;a<s[2].length;a++)if(o[2][0]){for(var u=!1,c=0;c<o[2].length;c++)o[2][c][0]===s[2][a][0]&&(r.push({tree1:o[2][c],tree2:s[2][a]}),u=!0);u||(n="new_branch",Te(o[2],s[2][a],Oe))}else n="new_leaf",o[2][0]=s[2][a]}return{conflicts:n,tree:e}}function Be(e,t,r){var n,i=[],o=!1,s=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var a=0,u=e.length;a<u;a++){var c=e[a];if(c.pos===t.pos&&c.ids[0]===t.ids[0])n=Ae(c.ids,t.ids),i.push({pos:c.pos,ids:n.tree}),o=o||n.conflicts,s=!0;else if(!0!==r){var f=c.pos<t.pos?c:t,l=c.pos<t.pos?t:c,h=l.pos-f.pos,d=[],p=[];for(p.push({ids:f.ids,diff:h,parent:null,parentIdx:null});p.length>0;){var v=p.pop();if(0!==v.diff)for(var m=v.ids[2],g=0,y=m.length;g<y;g++)p.push({ids:m[g],diff:v.diff-1,parent:v.ids,parentIdx:g});else v.ids[0]===l.ids[0]&&d.push(v)}var _=d[0];_?(n=Ae(_.ids,l.ids),_.parent[2][_.parentIdx]=n.tree,i.push({pos:f.pos,ids:f.ids}),o=o||n.conflicts,s=!0):i.push(c)}else i.push(c)}return s||i.push(t),i.sort(je),{tree:i,conflicts:o||"internal_node"}}function Ce(e,t,r){var n=Be(e,t),i=function(e,t){for(var r,n,i=Re(e),o=0,s=i.length;o<s;o++){var a,u=i[o],c=u.ids;if(c.length>t){r||(r={});var f=c.length-t;a={pos:u.pos+f,ids:De(c,f)};for(var l=0;l<f;l++){var h=u.pos+l+"-"+c[l].id;r[h]=!0}}else a={pos:u.pos,ids:De(c,0)};n=n?Be(n,a,!0).tree:[a]}return r&&we(n,function(e,t,n){delete r[t+"-"+n]}),{tree:n,revs:r?Object.keys(r):[]}}(n.tree,r);return{tree:i.tree,stemmedRevs:i.revs,conflicts:n.conflicts}}function Le(e){return e.ids}function Ie(e,t){t||(t=be(e));for(var r,n=t.substring(t.indexOf("-")+1),i=e.rev_tree.map(Le);r=i.pop();){if(r[0]===n)return!!r[1].deleted;i=i.concat(r[2])}}function qe(e){return/^_local/.test(e)}function Ne(e,t){for(var r,n=t.rev_tree.slice();r=n.pop();){var i=r.pos,o=r.ids,s=o[0],a=o[1],u=o[2],c=0===u.length,f=r.history?r.history.slice():[];if(f.push({id:s,pos:i,opts:a}),c)for(var l=0,h=f.length;l<h;l++){var d=f[l];if(d.pos+"-"+d.id===e)return i+"-"+s}for(var p=0,v=u.length;p<v;p++)n.push({pos:i+1,ids:u[p],history:f})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}function Me(e,t,r){a.EventEmitter.call(this);var n=this;this.db=e;var i=(t=t?g(t):{}).complete=y(function(t,r){var i,s;t?(s="error",("listenerCount"in(i=n)?i.listenerCount(s):a.EventEmitter.listenerCount(i,s))>0&&n.emit("error",t)):n.emit("complete",r),n.removeAllListeners(),e.removeListener("destroyed",o)});function o(){n.cancel()}r&&(n.on("complete",function(e){r(null,e)}),n.on("error",r)),e.once("destroyed",o),t.onChange=function(e){n.isCancelled||function(e,t){try{e.emit("change",t)}catch(e){N("error",'Error in .on("change", function):',e)}}(n,e)};var s=new d(function(e,r){t.complete=function(t,n){t?r(t):e(n)}});n.once("cancel",function(){e.removeListener("destroyed",o),t.complete(null,{status:"cancelled"})}),this.then=s.then.bind(s),this.catch=s.catch.bind(s),this.then(function(e){i(null,e)},i),e.taskqueue.isReady?n.doChanges(t):e.taskqueue.addTask(function(e){e?t.complete(e):n.isCancelled?n.emit("cancel"):n.doChanges(t)})}function Pe(e,t,r){var n=[{rev:e._rev}];"all_docs"===r.style&&(n=xe(t.rev_tree).map(function(e){return{rev:e.rev}}));var i={id:t.id,changes:n,doc:e};return Ie(t,e._rev)&&(i.deleted=!0),r.conflicts&&(i.doc._conflicts=Ee(t),i.doc._conflicts.length||delete i.doc._conflicts),i}function Fe(e,t){return e<t?-1:e>t?1:0}function Ue(e){return function(t,r){t||r[0]&&r[0].error?e(t||r[0]):e(null,r.length?r[0]:r)}}function Ge(e,t){var r=Fe(e._id,t._id);return 0!==r?r:Fe(e._revisions?e._revisions.start:0,t._revisions?t._revisions.start:0)}function We(){a.EventEmitter.call(this)}function ze(){this.isReady=!1,this.failed=!1,this.queue=[]}function He(e,t){if(!(this instanceof He))return new He(e,t);var r=this;if(t=t||{},e&&"object"==typeof e&&(e=(t=e).name,delete t.name),this.__opts=t=g(t),r.auto_compaction=t.auto_compaction,r.prefix=He.prefix,"string"!=typeof e)throw new Error("Missing/invalid DB name");var n=function(e,t){var r=e.match(/([a-z\-]*):\/\/(.*)/);if(r)return{name:/https?/.test(r[1])?r[1]+"://"+r[2]:r[2],adapter:r[1]};var n=He.adapters,i=He.preferredAdapters,o=He.prefix,s=t.adapter;if(!s)for(var a=0;a<i.length&&"idb"===(s=i[a])&&"websql"in n&&I()&&localStorage["_pouch__websqldb_"+o+e];++a)N("log",'PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');var u=n[s];return{name:u&&"use_prefix"in u&&!u.use_prefix?e:o+e,adapter:s}}((t.prefix||"")+e,t);if(t.name=n.name,t.adapter=t.adapter||n.adapter,r.name=e,r._adapter=t.adapter,s("pouchdb:adapter")("Picked adapter: "+t.adapter),!He.adapters[t.adapter]||!He.adapters[t.adapter].valid())throw new Error("Invalid Adapter: "+t.adapter);We.call(r),r.taskqueue=new ze,r.adapter=t.adapter,He.adapters[t.adapter].call(r,t,function(e){if(e)return r.taskqueue.fail(e);!function(e){var t=e.constructor._destructionListeners;function r(){e.removeListener("closed",n),e.constructor.emit("destroyed",e.name)}function n(){e.removeListener("destroyed",r),t.delete(e.name)}e.once("destroyed",r),e.once("closed",n),t.has(e.name)||t.set(e.name,[]),t.get(e.name).push(function(){e.removeListener("destroyed",r),e.removeListener("closed",n),e.emit("destroyed")})}(r),r.emit("created",r),He.emit("created",r.name),r.taskqueue.ready(r)})}u(Me,a.EventEmitter),Me.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},Me.prototype.doChanges=function(e){var t=this,r=e.complete;if("live"in(e=g(e))&&!("continuous"in e)&&(e.continuous=e.live),e.processChange=Pe,"latest"===e.since&&(e.since="now"),e.since||(e.since=0),"now"!==e.since){if(e.view&&!e.filter&&(e.filter="_view"),e.filter&&"string"==typeof e.filter&&("_view"===e.filter?e.view=fe(e.view):e.filter=fe(e.filter),"http"!==this.db.type()&&!e.doc_ids))return this.filterChanges(e);"descending"in e||(e.descending=!1),e.limit=0===e.limit?1:e.limit,e.complete=r;var n=this.db._changes(e);if(n&&"function"==typeof n.cancel){var i=t.cancel;t.cancel=o(function(e){n.cancel(),i.apply(this,e)})}}else this.db.info().then(function(n){t.isCancelled?r(null,{status:"cancelled"}):(e.since=n.update_seq,t.doChanges(e))},r)},Me.prototype.filterChanges=function(e){var t=this,r=e.complete;if("_view"===e.filter){if(!e.view||"string"!=typeof e.view){var n=ie(Y,"`view` filter parameter not found or invalid.");return r(n)}var i=ce(e.view);this.db.get("_design/"+i[0],function(n,o){if(t.isCancelled)return r(null,{status:"cancelled"});if(n)return r(oe(n));var s,a=o&&o.views&&o.views[i[1]]&&o.views[i[1]].map;if(!a)return r(ie(W,o.views?"missing json key: "+i[1]:"missing json key: views"));e.filter=(s=["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+a+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n"),f(s,{})),t.doChanges(e)})}else{var o=ce(e.filter);if(!o)return t.doChanges(e);this.db.get("_design/"+o[0],function(n,i){if(t.isCancelled)return r(null,{status:"cancelled"});if(n)return r(oe(n));var s=i&&i.filters&&i.filters[o[1]];if(!s)return r(ie(W,i&&i.filters?"missing json key: "+o[1]:"missing json key: filters"));e.filter=f('"use strict";\nreturn '+s+";",{}),t.doChanges(e)})}},u(We,a.EventEmitter),We.prototype.post=x("post",function(e,t,r){if("function"==typeof t&&(r=t,t={}),"object"!=typeof e||Array.isArray(e))return r(ie(Z));this.bulkDocs({docs:[e]},t,Ue(r))}),We.prototype.put=x("put",function(e,t,r){return"function"==typeof t&&(r=t,t={}),"object"!=typeof e||Array.isArray(e)?r(ie(Z)):(ue(e._id),qe(e._id)&&"function"==typeof this._putLocal?e._deleted?this._removeLocal(e,r):this._putLocal(e,r):void("function"==typeof this._put&&!1!==t.new_edits?this._put(e,t,r):this.bulkDocs({docs:[e]},t,Ue(r))))}),We.prototype.putAttachment=x("putAttachment",function(e,t,r,n,i){var o=this;function s(e){var r="_rev"in e?parseInt(e._rev,10):0;return e._attachments=e._attachments||{},e._attachments[t]={content_type:i,data:n,revpos:++r},o.put(e)}return"function"==typeof i&&(i=n,n=r,r=null),void 0===i&&(i=n,n=r,r=null),i||N("warn","Attachment",t,"on document",e,"is missing content_type"),o.get(e).then(function(e){if(e._rev!==r)throw ie(z);return s(e)},function(t){if(t.reason===W.message)return s({_id:e});throw t})}),We.prototype.removeAttachment=x("removeAttachment",function(e,t,r,n){var i=this;i.get(e,function(e,o){if(e)n(e);else if(o._rev===r){if(!o._attachments)return n();delete o._attachments[t],0===Object.keys(o._attachments).length&&delete o._attachments,i.put(o,n)}else n(ie(z))})}),We.prototype.remove=x("remove",function(e,t,r,n){var i;"string"==typeof t?(i={_id:e,_rev:t},"function"==typeof r&&(n=r,r={})):(i=e,"function"==typeof t?(n=t,r={}):(n=r,r=t)),(r=r||{}).was_delete=!0;var o={_id:i._id,_rev:i._rev||r.rev,_deleted:!0};if(qe(o._id)&&"function"==typeof this._removeLocal)return this._removeLocal(i,n);this.bulkDocs({docs:[o]},r,Ue(n))}),We.prototype.revsDiff=x("revsDiff",function(e,t,r){"function"==typeof t&&(r=t,t={});var n=Object.keys(e);if(!n.length)return r(null,{});var i=0,o=new w;function s(e,t){o.has(e)||o.set(e,{missing:[]}),o.get(e).missing.push(t)}n.map(function(t){this._getRevisionTree(t,function(a,u){if(a&&404===a.status&&"missing"===a.message)o.set(t,{missing:e[t]});else{if(a)return r(a);!function(t,r){var n=e[t].slice(0);we(r,function(e,r,i,o,a){var u=r+"-"+i,c=n.indexOf(u);-1!==c&&(n.splice(c,1),"available"!==a.status&&s(t,u))}),n.forEach(function(e){s(t,e)})}(t,u)}if(++i===n.length){var c={};return o.forEach(function(e,t){c[t]=e}),r(null,c)}})},this)}),We.prototype.bulkGet=x("bulkGet",function(e,t){C(this,e,t)}),We.prototype.compactDocument=x("compactDocument",function(e,t,r){var n=this;this._getRevisionTree(e,function(i,o){if(i)return r(i);var s=function(e){var t={},r=[];return we(e,function(e,n,i,o){var s=n+"-"+i;return e&&(t[s]=0),void 0!==o&&r.push({from:o,to:s}),s}),r.reverse(),r.forEach(function(e){void 0===t[e.from]?t[e.from]=1+t[e.to]:t[e.from]=Math.min(t[e.from],1+t[e.to])}),t}(o),a=[],u=[];Object.keys(s).forEach(function(e){s[e]>t&&a.push(e)}),we(o,function(e,t,r,n,i){var o=t+"-"+r;"available"===i.status&&-1!==a.indexOf(o)&&u.push(o)}),n._doCompaction(e,u,r)})}),We.prototype.compact=x("compact",function(e,t){"function"==typeof e&&(t=e,e={});e=e||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:e,callback:t}),1===this._compactionQueue.length&&function e(t){var r=t._compactionQueue[0],n=r.opts,i=r.callback;t.get("_local/compaction").catch(function(){return!1}).then(function(r){r&&r.last_seq&&(n.last_seq=r.last_seq),t._compact(n,function(r,n){r?i(r):i(null,n),c(function(){t._compactionQueue.shift(),t._compactionQueue.length&&e(t)})})})}(this)}),We.prototype._compact=function(e,t){var r=this,n={return_docs:!1,last_seq:e.last_seq||0},i=[];r.changes(n).on("change",function(e){i.push(r.compactDocument(e.id,0))}).on("complete",function(e){var n=e.last_seq;d.all(i).then(function(){return me(r,"_local/compaction",function(e){return(!e.last_seq||e.last_seq<n)&&(e.last_seq=n,e)})}).then(function(){t(null,{ok:!0})}).catch(t)}).on("error",t)},We.prototype.get=x("get",function(e,t,r){if("function"==typeof t&&(r=t,t={}),"string"!=typeof e)return r(ie(H));if(qe(e)&&"function"==typeof this._getLocal)return this._getLocal(e,r);var n=[],i=this;function o(){var o=[],s=n.length;if(!s)return r(null,o);n.forEach(function(n){i.get(e,{rev:n,revs:t.revs,latest:t.latest,attachments:t.attachments},function(e,t){if(e)o.push({missing:n});else{for(var i,a=0,u=o.length;a<u;a++)if(o[a].ok&&o[a].ok._rev===t._rev){i=!0;break}i||o.push({ok:t})}--s||r(null,o)})})}if(!t.open_revs)return this._get(e,t,function(e,n){if(e)return r(e);var o=n.doc,s=n.metadata,a=n.ctx;if(t.conflicts){var u=Ee(s);u.length&&(o._conflicts=u)}if(Ie(s,o._rev)&&(o._deleted=!0),t.revs||t.revs_info){for(var c=o._rev.split("-"),f=parseInt(c[0],10),l=c[1],h=Re(s.rev_tree),d=null,p=0;p<h.length;p++){var v=h[p],m=v.ids.map(function(e){return e.id}).indexOf(l);(m===f-1||!d&&-1!==m)&&(d=v)}var g=d.ids.map(function(e){return e.id}).indexOf(o._rev.split("-")[1])+1,y=d.ids.length-g;if(d.ids.splice(g,y),d.ids.reverse(),t.revs&&(o._revisions={start:d.pos+d.ids.length-1,ids:d.ids.map(function(e){return e.id})}),t.revs_info){var _=d.pos+d.ids.length;o._revs_info=d.ids.map(function(e){return{rev:--_+"-"+e.id,status:e.opts.status}})}}if(t.attachments&&o._attachments){var b=o._attachments,w=Object.keys(b).length;if(0===w)return r(null,o);Object.keys(b).forEach(function(e){this._getAttachment(o._id,e,b[e],{rev:o._rev,binary:t.binary,ctx:a},function(t,n){var i=o._attachments[e];i.data=n,delete i.stub,delete i.length,--w||r(null,o)})},i)}else{if(o._attachments)for(var k in o._attachments)o._attachments.hasOwnProperty(k)&&(o._attachments[k].stub=!0);r(null,o)}});if("all"===t.open_revs)this._getRevisionTree(e,function(e,t){if(e)return r(e);n=xe(t).map(function(e){return e.rev}),o()});else{if(!Array.isArray(t.open_revs))return r(ie(V,"function_clause"));n=t.open_revs;for(var s=0;s<n.length;s++){var a=n[s];if("string"!=typeof a||!/^\d+-/.test(a))return r(ie(re))}o()}}),We.prototype.getAttachment=x("getAttachment",function(e,t,r,n){var i=this;r instanceof Function&&(n=r,r={}),this._get(e,r,function(o,s){return o?n(o):s.doc._attachments&&s.doc._attachments[t]?(r.ctx=s.ctx,r.binary=!0,void i._getAttachment(e,t,s.doc._attachments[t],r,n)):n(ie(W))})}),We.prototype.allDocs=x("allDocs",function(e,t){if("function"==typeof e&&(t=e,e={}),e.skip=void 0!==e.skip?e.skip:0,e.start_key&&(e.startkey=e.start_key),e.end_key&&(e.endkey=e.end_key),"keys"in e){if(!Array.isArray(e.keys))return t(new TypeError("options.keys must be an array"));var r=["startkey","endkey","key"].filter(function(t){return t in e})[0];if(r)return void t(ie(Q,"Query parameter `"+r+"` is not compatible with multi-get"));if("http"!==this.type())return function(e,t,r){var n="limit"in t?t.keys.slice(t.skip,t.limit+t.skip):t.skip>0?t.keys.slice(t.skip):t.keys;if(t.descending&&n.reverse(),!n.length)return e._allDocs({limit:0},r);var i={offset:t.skip};return d.all(n.map(function(r){var n=F({key:r,deleted:"ok"},t);return["limit","skip","keys"].forEach(function(e){delete n[e]}),new d(function(t,o){e._allDocs(n,function(e,n){if(e)return o(e);i.total_rows=n.total_rows,t(n.rows[0]||{key:r,error:"not_found"})})})})).then(function(e){return i.rows=e,i})}(this,e,t)}return this._allDocs(e,t)}),We.prototype.changes=function(e,t){return"function"==typeof e&&(t=e,e={}),new Me(this,e,t)},We.prototype.close=x("close",function(e){return this._closed=!0,this.emit("closed"),this._close(e)}),We.prototype.info=x("info",function(e){var t=this;this._info(function(r,n){if(r)return e(r);n.db_name=n.db_name||t.name,n.auto_compaction=!(!t.auto_compaction||"http"===t.type()),n.adapter=t.type(),e(null,n)})}),We.prototype.id=x("id",function(e){return this._id(e)}),We.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},We.prototype.bulkDocs=x("bulkDocs",function(e,t,r){if("function"==typeof t&&(r=t,t={}),t=t||{},Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return r(ie(G));for(var n=0;n<e.docs.length;++n)if("object"!=typeof e.docs[n]||Array.isArray(e.docs[n]))return r(ie(Z));var i;if(e.docs.forEach(function(e){e._attachments&&Object.keys(e._attachments).forEach(function(t){i=i||function(e){return"_"===e.charAt(0)&&e+" is not a valid attachment name, attachment names cannot start with '_'"}(t),e._attachments[t].content_type||N("warn","Attachment",t,"on document",e._id,"is missing content_type")})}),i)return r(ie(Y,i));"new_edits"in t||(t.new_edits=!("new_edits"in e)||e.new_edits);var o=this;t.new_edits||"http"===o.type()||e.docs.sort(Ge),function(e){for(var t=0;t<e.length;t++){var r=e[t];if(r._deleted)delete r._attachments;else if(r._attachments)for(var n=Object.keys(r._attachments),i=0;i<n.length;i++){var o=n[i];r._attachments[o]=T(r._attachments[o],["data","digest","content_type","length","revpos","stub"])}}}(e.docs);var s=e.docs.map(function(e){return e._id});return this._bulkDocs(e,t,function(e,n){if(e)return r(e);if(t.new_edits||(n=n.filter(function(e){return e.error})),"http"!==o.type())for(var i=0,a=n.length;i<a;i++)n[i].id=n[i].id||s[i];r(null,n)})}),We.prototype.registerDependentDatabase=x("registerDependentDatabase",function(e,t){var r=new this.constructor(e,this.__opts);me(this,"_local/_pouch_dependentDbs",function(t){return t.dependentDbs=t.dependentDbs||{},!t.dependentDbs[e]&&(t.dependentDbs[e]=!0,t)}).then(function(){t(null,{db:r})}).catch(t)}),We.prototype.destroy=x("destroy",function(e,t){"function"==typeof e&&(t=e,e={});var r=this,n=!("use_prefix"in r)||r.use_prefix;function i(){r._destroy(e,function(e,n){if(e)return t(e);r._destroyed=!0,r.emit("destroyed"),t(null,n||{ok:!0})})}if("http"===r.type())return i();r.get("_local/_pouch_dependentDbs",function(e,o){if(e)return 404!==e.status?t(e):i();var s=o.dependentDbs,a=r.constructor,u=Object.keys(s).map(function(e){var t=n?e.replace(new RegExp("^"+a.prefix),""):e;return new a(t,r.__opts).destroy()});d.all(u).then(i,t)})}),ze.prototype.execute=function(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()},ze.prototype.fail=function(e){this.failed=e,this.execute()},ze.prototype.ready=function(e){this.isReady=!0,this.db=e,this.execute()},ze.prototype.addTask=function(e){this.queue.push(e),this.failed&&this.execute()},u(He,We),He.debug=s,He.adapters={},He.preferredAdapters=[],He.prefix="_pouch_";var Ke=new a.EventEmitter;!function(e){Object.keys(a.EventEmitter.prototype).forEach(function(t){"function"==typeof a.EventEmitter.prototype[t]&&(e[t]=Ke[t].bind(Ke))});var t=e._destructionListeners=new w;e.on("destroyed",function(e){t.get(e).forEach(function(e){e()}),t.delete(e)})}(He),He.adapter=function(e,t,r){t.valid()&&(He.adapters[e]=t,r&&He.preferredAdapters.push(e))},He.plugin=function(e){if("function"==typeof e)e(He);else{if("object"!=typeof e||0===Object.keys(e).length)throw new Error('Invalid plugin: got "'+e+'", expected an object or a function');Object.keys(e).forEach(function(t){He.prototype[t]=e[t]})}return this.__defaults&&(He.__defaults=F({},this.__defaults)),He},He.defaults=function(e){function t(e,r){if(!(this instanceof t))return new t(e,r);r=r||{},e&&"object"==typeof e&&(e=(r=e).name,delete r.name),r=F({},t.__defaults,r),He.call(this,e,r)}return u(t,He),t.preferredAdapters=He.preferredAdapters.slice(),Object.keys(He).forEach(function(e){e in t||(t[e]=He[e])}),t.__defaults=F({},this.__defaults,e),t};function Je(e){return e.reduce(function(e,t){return e[t]=!0,e},{})}He.version="6.1.2";var Ve=Je(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),$e=Je(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function Qe(e){if(!/^\d+\-./.test(e))return ie(re);var t=e.indexOf("-"),r=e.substring(0,t),n=e.substring(t+1);return{prefix:parseInt(r,10),id:n}}function Xe(e,t){var r,n,i,o={status:"available"};if(e._deleted&&(o.deleted=!0),t)if(e._id||(e._id=_e()),n=_e(32,16).toLowerCase(),e._rev){if((i=Qe(e._rev)).error)return i;e._rev_tree=[{pos:i.prefix,ids:[i.id,{status:"missing"},[[n,o,[]]]]}],r=i.prefix+1}else e._rev_tree=[{pos:1,ids:[n,o,[]]}],r=1;else if(e._revisions&&(e._rev_tree=function(e,t){for(var r=e.start-e.ids.length+1,n=e.ids,i=[n[0],t,[]],o=1,s=n.length;o<s;o++)i=[n[o],{status:"missing"},[i]];return[{pos:r,ids:i}]}(e._revisions,o),r=e._revisions.start,n=e._revisions.ids[0]),!e._rev_tree){if((i=Qe(e._rev)).error)return i;r=i.prefix,n=i.id,e._rev_tree=[{pos:r,ids:[n,o,[]]}]}ue(e._id),e._rev=r+"-"+n;var s={metadata:{},data:{}};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var u="_"===a[0];if(u&&!Ve[a]){var c=ie(X,a);throw c.message=X.message+": "+a,c}u&&!$e[a]?s.metadata[a.slice(1)]=e[a]:s.data[a]=e[a]}return s}var Ye=function(e){return atob(e)},Ze=function(e){return btoa(e)};function et(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)r.append(e[n]);return r.getBlob(t.type)}}function tt(e,t){return et([function(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),i=0;i<t;i++)n[i]=e.charCodeAt(i);return r}(e)],{type:t})}function rt(e,t){return tt(Ye(e),t)}function nt(e){for(var t="",r=new Uint8Array(e),n=r.byteLength,i=0;i<n;i++)t+=String.fromCharCode(r[i]);return t}function it(e,t){if("undefined"==typeof FileReader)return t(nt((new FileReaderSync).readAsArrayBuffer(e)));var r=new FileReader,n="function"==typeof r.readAsBinaryString;r.onloadend=function(e){var r=e.target.result||"";if(n)return t(r);t(nt(r))},n?r.readAsBinaryString(e):r.readAsArrayBuffer(e)}function ot(e,t){it(e,function(e){t(e)})}function st(e,t){ot(e,function(e){t(Ze(e))})}function at(e,t){if("undefined"==typeof FileReader)return t((new FileReaderSync).readAsArrayBuffer(e));var r=new FileReader;r.onloadend=function(e){var r=e.target.result||new ArrayBuffer(0);t(r)},r.readAsArrayBuffer(e)}var ut=r.setImmediate||r.setTimeout,ct=32768;function ft(e,t,r,n,i){(r>0||n<t.size)&&(t=function(e,t,r){return e.webkitSlice?e.webkitSlice(t,r):e.slice(t,r)}(t,r,n)),at(t,function(t){e.append(t),i()})}function lt(e,t,r,n,i){(r>0||n<t.length)&&(t=t.substring(r,n)),e.appendBinary(t),i()}function ht(e,t){var r="string"==typeof e,n=r?e.length:e.size,i=Math.min(ct,n),o=Math.ceil(n/i),s=0,a=r?new l:new l.ArrayBuffer,u=r?lt:ft;function c(){ut(h)}function f(){var e=function(e){return Ze(e)}(a.end(!0));t(e),a.destroy()}function h(){var t=s*i,r=t+i;u(a,e,t,r,++s<o?c:f)}h()}function dt(e,t,r){var n=function(e){try{return Ye(e)}catch(e){return{error:ie($,"Attachment is not a valid base64 string")}}}(e.data);if(n.error)return r(n.error);e.length=n.length,e.data="blob"===t?tt(n,e.content_type):"base64"===t?Ze(n):n,ht(n,function(t){e.digest="md5-"+t,r()})}function pt(e,t,r){if(e.stub)return r();"string"==typeof e.data?dt(e,t,r):function(e,t,r){ht(e.data,function(n){e.digest="md5-"+n,e.length=e.data.size||e.data.length||0,"binary"===t?ot(e.data,function(t){e.data=t,r()}):"base64"===t?st(e.data,function(t){e.data=t,r()}):r()})}(e,t,r)}function vt(e,t,r){if(!e.length)return r();var n,i=0;function o(){i++,e.length===i&&(n?r(n):r())}e.forEach(function(e){var r=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],i=0;if(!r.length)return o();function s(e){n=e,++i===r.length&&o()}for(var a in e.data._attachments)e.data._attachments.hasOwnProperty(a)&&pt(e.data._attachments[a],t,s)})}function mt(e,t,r,n,i,o,s,a){if(function(e,t){for(var r,n=e.slice(),i=t.split("-"),o=parseInt(i[0],10),s=i[1];r=n.pop();){if(r.pos===o&&r.ids[0]===s)return!0;for(var a=r.ids[2],u=0,c=a.length;u<c;u++)n.push({pos:r.pos+1,ids:a[u]})}return!1}(t.rev_tree,r.metadata.rev))return n[i]=r,o();var u=t.winningRev||be(t),c="deleted"in t?t.deleted:Ie(t,u),f="deleted"in r.metadata?r.metadata.deleted:Ie(r.metadata),l=/^1-/.test(r.metadata.rev);if(c&&!f&&a&&l){var h=r.data;h._rev=u,h._id=r.metadata.id,r=Xe(h,a)}var d=Ce(t.rev_tree,r.metadata.rev_tree[0],e);if(a&&(c&&f&&"new_leaf"!==d.conflicts||!c&&"new_leaf"!==d.conflicts||c&&!f&&"new_branch"===d.conflicts)){var p=ie(z);return n[i]=p,o()}var v=r.metadata.rev;r.metadata.rev_tree=d.tree,r.stemmedRevs=d.stemmedRevs||[],t.rev_map&&(r.metadata.rev_map=t.rev_map);var m=be(r.metadata),g=Ie(r.metadata,m),y=c===g?0:c<g?-1:1;s(r,m,g,v===m?g:Ie(r.metadata,v),!0,y,i,o)}function gt(e,t,r,n,i,o,s,a,u){e=e||1e3;var c=a.new_edits,f=new w,l=0,h=t.length;function d(){++l===h&&u&&u()}t.forEach(function(e,t){if(e._id&&qe(e._id)){var n=e._deleted?"_removeLocal":"_putLocal";r[n](e,{ctx:i},function(e,r){o[t]=e||r,d()})}else{var s=e.metadata.id;f.has(s)?(h--,f.get(s).push([e,t])):f.set(s,[[e,t]])}}),f.forEach(function(t,r){var i=0;function u(){++i<t.length?f():d()}function f(){var f=t[i],l=f[0],h=f[1];if(n.has(r))mt(e,n.get(r),l,o,h,u,s,c);else{var d=Ce([],l.metadata.rev_tree[0],e);l.metadata.rev_tree=d.tree,l.stemmedRevs=d.stemmedRevs||[],function(e,t,r){var n=be(e.metadata),i=Ie(e.metadata,n);if("was_delete"in a&&i)return o[t]=ie(W,"deleted"),r();if(c&&function(e){return"missing"===e.metadata.rev_tree[0].ids[1].status}(e)){var u=ie(z);return o[t]=u,r()}s(e,n,i,i,!1,i?0:1,t,r)}(l,h,u)}}f()})}var yt=5,_t="document-store",bt="by-sequence",wt="attach-store",kt="attach-seq-store",xt="meta-store",Et="local-store",St="detect-blob-support";function Rt(e){try{return JSON.parse(e)}catch(t){return h.parse(e)}}function jt(e){try{return JSON.stringify(e)}catch(t){return h.stringify(e)}}function Tt(e){return function(t){var r="unknown_error";t.target&&t.target.error&&(r=t.target.error.name||t.target.error.message),e(ie(ee,r,t.type))}}function Dt(e,t,r){return{data:jt(e),winningRev:t,deletedOrLocal:r?"1":"0",seq:e.seq,id:e.id}}function Ot(e){if(!e)return null;var t=Rt(e.data);return t.winningRev=e.winningRev,t.deleted="1"===e.deletedOrLocal,t.seq=e.seq,t}function At(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function Bt(e,t,r,n){r?n(e?"string"!=typeof e?e:rt(e,t):et([""],{type:t})):e?"string"!=typeof e?it(e,function(e){n(Ze(e))}):n(e):n("")}function Ct(e,t,r,n){var i=Object.keys(e._attachments||{});if(!i.length)return n&&n();var o=0;function s(){++o===i.length&&n&&n()}i.forEach(function(n){t.attachments&&t.include_docs?function(e,t){var n=e._attachments[t],i=n.digest;r.objectStore(wt).get(i).onsuccess=function(e){n.body=e.target.result.body,s()}}(e,n):(e._attachments[n].stub=!0,s())})}function Lt(e,t){return d.all(e.map(function(e){if(e.doc&&e.doc._attachments){var r=Object.keys(e.doc._attachments);return d.all(r.map(function(r){var n=e.doc._attachments[r];if("body"in n){var i=n.body,o=n.content_type;return new d(function(s){Bt(i,o,t,function(t){e.doc._attachments[r]=F(T(n,["digest","content_type"]),{data:t}),s()})})}}))}}))}function It(e,t,r){var n=[],i=r.objectStore(bt),o=r.objectStore(wt),s=r.objectStore(kt),a=e.length;function u(){--a||function(){if(!n.length)return;n.forEach(function(e){var t=s.index("digestSeq").count(IDBKeyRange.bound(e+"::",e+"::",!1,!1));t.onsuccess=function(t){var r=t.target.result;r||o.delete(e)}})}()}e.forEach(function(e){var r=i.index("_doc_id_rev"),o=t+"::"+e;r.getKey(o).onsuccess=function(e){var t=e.target.result;if("number"!=typeof t)return u();i.delete(t),s.index("seq").openCursor(IDBKeyRange.only(t)).onsuccess=function(e){var t=e.target.result;if(t){var r=t.value.digestSeq.split("::")[0];n.push(r),s.delete(t.primaryKey),t.continue()}else u()}}})}function qt(e,t,r){try{return{txn:e.transaction(t,r)}}catch(e){return{error:e}}}var Nt=new q;function Mt(e,t,r,n,i,o){for(var s,a,u,c,f,l,h,d,p=t.docs,v=0,m=p.length;v<m;v++){var g=p[v];g._id&&qe(g._id)||(g=p[v]=Xe(g,r.new_edits)).error&&!h&&(h=g)}if(h)return o(h);var y=!1,_=0,b=new Array(p.length),k=new w,x=!1,E=n._meta.blobSupport?"blob":"base64";function S(){y=!0,R()}function R(){d&&y&&(d.docCount+=_,l.put(d))}function j(){x||(Nt.notify(n._meta.name),o(null,b))}function T(e,t,r,n,i,o,s,a){e.metadata.winningRev=t,e.metadata.deleted=r;var u=e.data;if(u._id=e.metadata.id,u._rev=e.metadata.rev,n&&(u._deleted=!0),u._attachments&&Object.keys(u._attachments).length)return function(e,t,r,n,i,o){var s=e.data,a=0,u=Object.keys(s._attachments);function f(){a===u.length&&D(e,t,r,n,i,o)}function l(){a++,f()}u.forEach(function(r){var n=e.data._attachments[r];if(n.stub)a++,f();else{var i=n.data;delete n.data,n.revpos=parseInt(t,10);var o=n.digest;!function(e,t,r){c.count(e).onsuccess=function(n){var i=n.target.result;if(i)return r();var o={digest:e,body:t},s=c.put(o);s.onsuccess=r}}(o,i,l)}})}(e,t,r,i,s,a);_+=o,R(),D(e,t,r,i,s,a)}function D(e,t,r,i,o,c){var l=e.data,h=e.metadata;function d(o){var u=e.stemmedRevs||[];i&&n.auto_compaction&&(u=u.concat(Se(e.metadata))),u&&u.length&&It(u,e.metadata.id,s),h.seq=o.target.result;var c=Dt(h,t,r);a.put(c).onsuccess=p}function p(){b[o]={ok:!0,id:h.id,rev:h.rev},k.set(e.metadata.id,e.metadata),function(e,t,r){var n=0,i=Object.keys(e.data._attachments||{});if(!i.length)return r();function o(){++n===i.length&&r()}function s(r){var n=e.data._attachments[r].digest,i=f.put({seq:t,digestSeq:n+"::"+t});i.onsuccess=o,i.onerror=function(e){e.preventDefault(),e.stopPropagation(),o()}}for(var a=0;a<i.length;a++)s(i[a])}(e,h.seq,c)}l._doc_id_rev=h.id+"::"+h.rev,delete l._id,delete l._rev;var v=u.put(l);v.onsuccess=d,v.onerror=function(e){e.preventDefault(),e.stopPropagation(),u.index("_doc_id_rev").getKey(l._doc_id_rev).onsuccess=function(e){u.put(l,e.target.result).onsuccess=d}}}vt(p,E,function(t){if(t)return o(t);!function(){var t=qt(i,[_t,bt,wt,Et,kt,xt],"readwrite");if(t.error)return o(t.error);(s=t.txn).onabort=Tt(o),s.ontimeout=Tt(o),s.oncomplete=j,a=s.objectStore(_t),u=s.objectStore(bt),c=s.objectStore(wt),f=s.objectStore(kt),(l=s.objectStore(xt)).get(xt).onsuccess=function(e){d=e.target.result,R()},function(e){var t=[];if(p.forEach(function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach(function(r){var n=e.data._attachments[r];n.stub&&t.push(n.digest)})}),!t.length)return e();var r,n=0;t.forEach(function(i){!function(e,t){c.get(e).onsuccess=function(r){if(r.target.result)t();else{var n=ie(ne,"unknown stub attachment with digest "+e);n.status=412,t(n)}}}(i,function(i){i&&!r&&(r=i),++n===t.length&&e(r)})})}(function(t){if(t)return x=!0,o(t);!function(){if(!p.length)return;var t=0;function i(){++t===p.length&&gt(e.revs_limit,p,n,k,s,b,T,r,S)}function o(e){var t=Ot(e.target.result);t&&k.set(t.id,t),i()}for(var u=0,c=p.length;u<c;u++){var f=p[u];if(f._id&&qe(f._id))i();else{var l=a.get(f.metadata.id);l.onsuccess=o}}}()})}()})}function Pt(e,t,r,n,i){var o,s,a;function u(e){s=e.target.result,o&&i(o,s,a)}function c(e){o=e.target.result,s&&i(o,s,a)}function f(e){var t=e.target.result;if(!t)return i();i([t.key],[t.value],t)}"function"==typeof e.getAll&&"function"==typeof e.getAllKeys&&n>1&&!r?(a={continue:function(){if(!o.length)return i();var r,a=o[o.length-1];if(t&&t.upper)try{r=IDBKeyRange.bound(a,t.upper,!0,t.upperOpen)}catch(e){if("DataError"===e.name&&0===e.code)return i()}else r=IDBKeyRange.lowerBound(a,!0);t=r,o=null,s=null,e.getAll(t,n).onsuccess=u,e.getAllKeys(t,n).onsuccess=c}},e.getAll(t,n).onsuccess=u,e.getAllKeys(t,n).onsuccess=c):r?e.openCursor(t,"prev").onsuccess=f:e.openCursor(t).onsuccess=f}function Ft(e,t,r){var n="startkey"in e&&e.startkey,i="endkey"in e&&e.endkey,o="key"in e&&e.key,s=e.skip||0,a="number"==typeof e.limit?e.limit:-1,u=function(e,t,r,n,i){try{if(e&&t)return i?IDBKeyRange.bound(t,e,!r,!1):IDBKeyRange.bound(e,t,!1,!r);if(e)return i?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return i?IDBKeyRange.lowerBound(t,!r):IDBKeyRange.upperBound(t,!r);if(n)return IDBKeyRange.only(n)}catch(e){return{error:e}}return null}(n,i,!1!==e.inclusive_end,o,e.descending),c=u&&u.error;if(c&&("DataError"!==c.name||0!==c.code))return r(ie(ee,c.name,c.message));var f=[_t,bt,xt];e.attachments&&f.push(wt);var l=qt(t,f,"readonly");if(l.error)return r(l.error);var h=l.txn;h.oncomplete=function(){e.attachments?Lt(y,e.binary).then(k):k()},h.onabort=Tt(r);var d,p=h.objectStore(_t),v=h.objectStore(bt),m=h.objectStore(xt),g=v.index("_doc_id_rev"),y=[];function _(t,r,n){var i=t.id+"::"+n;g.get(i).onsuccess=function(n){if(r.doc=At(n.target.result),e.conflicts){var i=Ee(t);i.length&&(r.doc._conflicts=i)}Ct(r.doc,e,h)}}function b(t,r){var n={id:r.id,key:r.id,value:{rev:t}},i=r.deleted;"ok"===e.deleted?(y.push(n),i?(n.value.deleted=!0,n.doc=null):e.include_docs&&_(r,n,t)):!i&&s--<=0&&(y.push(n),e.include_docs&&_(r,n,t))}function w(e){for(var t=0,r=e.length;t<r&&y.length!==a;t++){var n=Ot(e[t]);b(n.winningRev,n)}}function k(){r(null,{total_rows:d,offset:e.skip,rows:y})}return m.get(xt).onsuccess=function(e){d=e.target.result.docCount},c||0===a?void 0:-1===a?function(e,t,r){if("function"!=typeof e.getAll){var n=[];e.openCursor(t).onsuccess=function(e){var t=e.target.result;t?(n.push(t.value),t.continue()):r({target:{result:n}})}}else e.getAll(t).onsuccess=r}(p,u,function(t){var r=t.target.result;e.descending&&(r=r.reverse()),w(r)}):void Pt(p,u,e.descending,a+s,function(e,t,r){r&&(w(t),y.length<a&&r.continue())})}var Ut=!1,Gt=[];function Wt(){!Ut&&Gt.length&&(Ut=!0,Gt.shift()())}function zt(e,t,r,n){if((e=g(e)).continuous){var i=r+":"+_e();return Nt.addListener(r,i,t,e),Nt.notify(r),{cancel:function(){Nt.removeListener(r,i)}}}var o=e.doc_ids&&new b(e.doc_ids);e.since=e.since||0;var s,a=e.since,u="limit"in e?e.limit:-1;0===u&&(u=1),s="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var c,f,l,h,d=[],p=0,v=se(e),m=new w;function y(e,t,r,n){if(r.seq!==t)return n();if(r.winningRev===e._rev)return n(r,e);var i=e._id+"::"+r.winningRev;h.get(i).onsuccess=function(e){n(r,At(e.target.result))}}function _(){e.complete(null,{results:d,last_seq:a})}var k=[_t,bt];e.attachments&&k.push(wt);var x=qt(n,k,"readonly");if(x.error)return e.complete(x.error);(c=x.txn).onabort=Tt(e.complete),c.oncomplete=function(){!e.continuous&&e.attachments?Lt(d).then(_):_()},f=c.objectStore(bt),l=c.objectStore(_t),h=f.index("_doc_id_rev"),Pt(f,e.since&&!e.descending?IDBKeyRange.lowerBound(e.since,!0):null,e.descending,u,function(t,r,n){if(n&&t.length){var i=new Array(t.length),f=new Array(t.length),h=0;r.forEach(function(e,r){!function(e,t,r){if(o&&!o.has(e._id))return r();var n=m.get(e._id);if(n)return y(e,t,n,r);l.get(e._id).onsuccess=function(i){n=Ot(i.target.result),m.set(e._id,n),y(e,t,n,r)}}(At(e),t[r],function(e,o){f[r]=e,i[r]=o,++h===t.length&&function(){for(var e=0,t=i.length;e<t&&p!==u;e++){var r=i[e];r&&g(f[e],r)}p!==u&&n.continue()}()})})}function g(t,r){var n=e.processChange(r,t,e);a=n.seq=t.seq;var i=v(n);if("object"==typeof i)return e.complete(i);i&&(p++,s&&d.push(n),e.attachments&&e.include_docs?Ct(r,e,c,function(){Lt([n],e.binary).then(function(){e.onChange(n)})}):e.onChange(n))}})}var Ht,Kt=new w,Jt=new w;function Vt(e,t){var r=this;!function(e,t,r){Gt.push(function(){e(function(e,n){!function(e,t,r,n){try{e(t,r)}catch(t){n.emit("error",t)}}(t,e,n,r),Ut=!1,c(function(){Wt()})})}),Wt()}(function(t){!function(e,t,r){var n=t.name,i=null;function o(e,t){var r=e.objectStore(_t);r.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),r.openCursor().onsuccess=function(e){var n=e.target.result;if(n){var i=n.value,o=Ie(i);i.deletedOrLocal=o?"1":"0",r.put(i),n.continue()}else t()}}function s(e,t){var r=e.objectStore(Et),n=e.objectStore(_t),i=e.objectStore(bt),o=n.openCursor();o.onsuccess=function(e){var o=e.target.result;if(o){var s=o.value,a=s.id,u=qe(a),c=be(s);if(u){var f=a+"::"+c,l=a+"::",h=a+"::~",d=i.index("_doc_id_rev"),p=IDBKeyRange.bound(l,h,!1,!1),v=d.openCursor(p);v.onsuccess=function(e){if(v=e.target.result){var t=v.value;t._doc_id_rev===f&&r.put(t),i.delete(v.primaryKey),v.continue()}else n.delete(o.primaryKey),o.continue()}}else o.continue()}else t&&t()}}function a(e,t){var r=e.objectStore(bt),n=e.objectStore(wt),i=e.objectStore(kt),o=n.count();o.onsuccess=function(e){var n=e.target.result;if(!n)return t();r.openCursor().onsuccess=function(e){var r=e.target.result;if(!r)return t();for(var n=r.value,o=r.primaryKey,s=Object.keys(n._attachments||{}),a={},u=0;u<s.length;u++){var c=n._attachments[s[u]];a[c.digest]=!0}var f=Object.keys(a);for(u=0;u<f.length;u++){var l=f[u];i.put({seq:o,digestSeq:l+"::"+o})}r.continue()}}}function u(e){var t=e.objectStore(bt),r=e.objectStore(_t),n=r.openCursor();n.onsuccess=function(e){var n=e.target.result;if(n){var i,o,s,a=function(e){if(!e.data)return e.deleted="1"===e.deletedOrLocal,e;return Ot(e)}(n.value);if(a.winningRev=a.winningRev||be(a),a.seq)return u();i=a.id+"::",o=a.id+"::",s=0,t.index("_doc_id_rev").openCursor(IDBKeyRange.bound(i,o)).onsuccess=function(e){var t=e.target.result;if(!t)return a.seq=s,u();var r=t.primaryKey;r>s&&(s=r),t.continue()}}function u(){var e=Dt(a,a.winningRev,a.deleted),t=r.put(e);t.onsuccess=function(){n.continue()}}}}e._meta=null,e.type=function(){return"idb"},e._id=_(function(t){t(null,e._meta.instanceId)}),e._bulkDocs=function(r,n,o){Mt(t,r,n,e,i,o)},e._get=function(e,t,r){var n,o,s,a=t.ctx;if(!a){var u=qt(i,[_t,bt,wt],"readonly");if(u.error)return r(u.error);a=u.txn}function c(){r(s,{doc:n,metadata:o,ctx:a})}a.objectStore(_t).get(e).onsuccess=function(e){if(!(o=Ot(e.target.result)))return s=ie(W,"missing"),c();var r;if(t.rev)r=t.latest?Ne(t.rev,o):t.rev;else{r=o.winningRev;var i=Ie(o);if(i)return s=ie(W,"deleted"),c()}var u=a.objectStore(bt),f=o.id+"::"+r;u.index("_doc_id_rev").get(f).onsuccess=function(e){if((n=e.target.result)&&(n=At(n)),!n)return s=ie(W,"missing"),c();c()}}},e._getAttachment=function(e,t,r,n,o){var s;if(n.ctx)s=n.ctx;else{var a=qt(i,[_t,bt,wt],"readonly");if(a.error)return o(a.error);s=a.txn}var u=r.digest,c=r.content_type;s.objectStore(wt).get(u).onsuccess=function(e){var t=e.target.result.body;Bt(t,c,n.binary,function(e){o(null,e)})}},e._info=function(t){var r,n,o=qt(i,[xt,bt],"readonly");if(o.error)return t(o.error);var s=o.txn;s.objectStore(xt).get(xt).onsuccess=function(e){n=e.target.result.docCount},s.objectStore(bt).openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;r=t?t.key:0},s.oncomplete=function(){t(null,{doc_count:n,update_seq:r,idb_attachment_format:e._meta.blobSupport?"binary":"base64"})}},e._allDocs=function(e,t){Ft(e,i,t)},e._changes=function(t){zt(t,e,n,i)},e._close=function(e){i.close(),Kt.delete(n),e()},e._getRevisionTree=function(e,t){var r=qt(i,[_t],"readonly");if(r.error)return t(r.error);var n=r.txn,o=n.objectStore(_t).get(e);o.onsuccess=function(e){var r=Ot(e.target.result);r?t(null,r.rev_tree):t(ie(W))}},e._doCompaction=function(e,t,r){var n=[_t,bt,wt,kt],o=qt(i,n,"readwrite");if(o.error)return r(o.error);var s=o.txn,a=s.objectStore(_t);a.get(e).onsuccess=function(r){var n=Ot(r.target.result);we(n.rev_tree,function(e,r,n,i,o){var s=r+"-"+n;-1!==t.indexOf(s)&&(o.status="missing")}),It(t,e,s);var i=n.winningRev,o=n.deleted;s.objectStore(_t).put(Dt(n,i,o))},s.onabort=Tt(r),s.oncomplete=function(){r()}},e._getLocal=function(e,t){var r=qt(i,[Et],"readonly");if(r.error)return t(r.error);var n=r.txn,o=n.objectStore(Et).get(e);o.onerror=Tt(t),o.onsuccess=function(e){var r=e.target.result;r?(delete r._doc_id_rev,t(null,r)):t(ie(W))}},e._putLocal=function(e,t,r){"function"==typeof t&&(r=t,t={}),delete e._revisions;var n=e._rev,o=e._id;e._rev=n?"0-"+(parseInt(n.split("-")[1],10)+1):"0-1";var s,a=t.ctx;if(!a){var u=qt(i,[Et],"readwrite");if(u.error)return r(u.error);(a=u.txn).onerror=Tt(r),a.oncomplete=function(){s&&r(null,s)}}var c,f=a.objectStore(Et);n?(c=f.get(o)).onsuccess=function(i){var o=i.target.result;if(o&&o._rev===n){var a=f.put(e);a.onsuccess=function(){s={ok:!0,id:e._id,rev:e._rev},t.ctx&&r(null,s)}}else r(ie(z))}:((c=f.add(e)).onerror=function(e){r(ie(z)),e.preventDefault(),e.stopPropagation()},c.onsuccess=function(){s={ok:!0,id:e._id,rev:e._rev},t.ctx&&r(null,s)})},e._removeLocal=function(e,t,r){"function"==typeof t&&(r=t,t={});var n,o=t.ctx;if(!o){var s=qt(i,[Et],"readwrite");if(s.error)return r(s.error);(o=s.txn).oncomplete=function(){n&&r(null,n)}}var a=e._id,u=o.objectStore(Et),c=u.get(a);c.onerror=Tt(r),c.onsuccess=function(i){var o=i.target.result;o&&o._rev===e._rev?(u.delete(a),n={ok:!0,id:a,rev:"0-0"},t.ctx&&r(null,n)):r(ie(W))}},e._destroy=function(e,t){Nt.removeAllListeners(n);var r=Jt.get(n);r&&r.result&&(r.result.close(),Kt.delete(n));var i=indexedDB.deleteDatabase(n);i.onsuccess=function(){Jt.delete(n),I()&&n in localStorage&&delete localStorage[n],t(null,{ok:!0})},i.onerror=Tt(t)};var f,l=Kt.get(n);if(l)return i=l.idb,e._meta=l.global,c(function(){r(null,e)});f=t.storage?function(e,t){try{return indexedDB.open(e,{version:yt,storage:t})}catch(t){return indexedDB.open(e,yt)}}(n,t.storage):indexedDB.open(n,yt);Jt.set(n,f),f.onupgradeneeded=function(e){var t=e.target.result;if(e.oldVersion<1)return function(e){var t=e.createObjectStore(_t,{keyPath:"id"});e.createObjectStore(bt,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.createObjectStore(wt,{keyPath:"digest"}),e.createObjectStore(xt,{keyPath:"id",autoIncrement:!1}),e.createObjectStore(St),t.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),e.createObjectStore(Et,{keyPath:"_id"});var r=e.createObjectStore(kt,{autoIncrement:!0});r.createIndex("seq","seq"),r.createIndex("digestSeq","digestSeq",{unique:!0})}(t);var r=e.currentTarget.transaction;e.oldVersion<3&&function(e){e.createObjectStore(Et,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}(t),e.oldVersion<4&&function(e){var t=e.createObjectStore(kt,{autoIncrement:!0});t.createIndex("seq","seq"),t.createIndex("digestSeq","digestSeq",{unique:!0})}(t);var n=[o,s,a,u],i=e.oldVersion;!function e(){var t=n[i-1];i++;t&&t(r,e)}()},f.onsuccess=function(t){(i=t.target.result).onversionchange=function(){i.close(),Kt.delete(n)},i.onabort=function(e){N("error","Database has a global failure",e.target.error),i.close(),Kt.delete(n)};var o,s,a,u,c=i.transaction([xt,St,_t],"readwrite"),f=!1;function l(){void 0!==a&&f&&(e._meta={name:n,instanceId:u,blobSupport:a},Kt.set(n,{idb:i,global:e._meta}),r(null,e))}function h(){if(void 0!==s&&void 0!==o){var e=n+"_id";e in o?u=o[e]:o[e]=u=_e(),o.docCount=s,c.objectStore(xt).put(o)}}c.objectStore(xt).get(xt).onsuccess=function(e){o=e.target.result||{id:xt},h()},function(e,t){e.objectStore(_t).index("deletedOrLocal").count(IDBKeyRange.only("0")).onsuccess=function(e){t(e.target.result)}}(c,function(e){s=e,h()}),Ht||(Ht=function(e){return new d(function(t){var r=et([""]);e.objectStore(St).put(r,"key").onsuccess=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);t(r||!e||parseInt(e[1],10)>=43)},e.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)}}).catch(function(){return!1})}(c)),Ht.then(function(e){a=e,l()}),c.oncomplete=function(){f=!0,l()}},f.onerror=function(){var e="Failed to open indexedDB, are you in private browsing mode?";N("error",e),r(ie(ee,e))}}(r,e,t)},t,r.constructor)}Vt.valid=function(){return!("undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform))&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};function $t(e){return e<65?e-48:e-55}function Qt(e,t){return"UTF-8"===t?function(e){return decodeURIComponent(escape(e))}(function(e,t,r){for(var n="";t<r;)n+=String.fromCharCode($t(e.charCodeAt(t++))<<4|$t(e.charCodeAt(t++)));return n}(e,0,e.length)):function(e,t,r){for(var n="";t<r;)n+=String.fromCharCode($t(e.charCodeAt(t+2))<<12|$t(e.charCodeAt(t+3))<<8|$t(e.charCodeAt(t))<<4|$t(e.charCodeAt(t+1))),t+=4;return n}(e,0,e.length)}function Xt(e){return"'"+e+"'"}var Yt=7,Zt=Xt("document-store"),er=Xt("by-sequence"),tr=Xt("attach-store"),rr=Xt("local-store"),nr=Xt("metadata-store"),ir=Xt("attach-seq-store");function or(e){return delete e._id,delete e._rev,JSON.stringify(e)}function sr(e,t,r){return(e=JSON.parse(e))._id=t,e._rev=r,e}function ar(e){for(var t="(";e--;)t+="?",e&&(t+=",");return t+")"}function ur(e,t,r,n,i){return"SELECT "+e+" FROM "+("string"==typeof t?t:t.join(" JOIN "))+(r?" ON "+r:"")+(n?" WHERE "+("string"==typeof n?n:n.join(" AND ")):"")+(i?" ORDER BY "+i:"")}function cr(e,t,r){if(e.length){var n=0,i=[];e.forEach(function(e){var n="SELECT seq FROM "+er+" WHERE doc_id=? AND rev=?";r.executeSql(n,[t,e],function(e,t){if(!t.rows.length)return o();var r=t.rows.item(0).seq;i.push(r),e.executeSql("DELETE FROM "+er+" WHERE seq=?",[r],o)})})}function o(){++n===e.length&&function(){if(!i.length)return;var e="SELECT DISTINCT digest AS digest FROM "+ir+" WHERE seq IN "+ar(i.length);r.executeSql(e,i,function(e,t){for(var r=[],n=0;n<t.rows.length;n++)r.push(t.rows.item(n).digest);if(r.length){var o="DELETE FROM "+ir+" WHERE seq IN ("+i.map(function(){return"?"}).join(",")+")";e.executeSql(o,i,function(e){var t="SELECT digest FROM "+ir+" WHERE digest IN ("+r.map(function(){return"?"}).join(",")+")";e.executeSql(t,r,function(e,t){for(var n=new b,i=0;i<t.rows.length;i++)n.add(t.rows.item(i).digest);r.forEach(function(t){n.has(t)||(e.executeSql("DELETE FROM "+ir+" WHERE digest=?",[t]),e.executeSql("DELETE FROM "+tr+" WHERE digest=?",[t]))})})})}})}()}}function fr(e){return function(t){N("error","WebSQL threw an error",t);var r=t&&t.constructor.toString().match(/function ([^\(]+)/),n=(r&&r[1]||t.type,t.target||t.message);e(ie(te,n))}}function lr(e,t,r,n,i,o,s){var a,u=r.new_edits,c=t.docs.map(function(e){return e._id&&qe(e._id)?e:Xe(e,u)}),f=c.filter(function(e){return e.error});if(f.length)return s(f[0]);var l,h=new Array(c.length),d=new w;function p(){if(l)return s(l);o.notify(n._name),s(null,h)}function v(e){var t=[];if(c.forEach(function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach(function(r){var n=e.data._attachments[r];n.stub&&t.push(n.digest)})}),!t.length)return e();var r,n=0;t.forEach(function(i){!function(e,t){var r="SELECT count(*) as cnt FROM "+tr+" WHERE digest=?";a.executeSql(r,[e],function(r,n){if(0===n.rows.item(0).cnt){var i=ie(ne,"unknown stub attachment with digest "+e);t(i)}else t()})}(i,function(i){i&&!r&&(r=i),++n===t.length&&e(r)})})}function m(e,t,r,i,o,s,u,c){function f(){var t=e.data,r=i?1:0,n=t._id,o=t._rev,s=or(t),u="INSERT INTO "+er+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",c=[n,o,s,r];function f(e,r){var n,i,o,s=0,u=Object.keys(t._attachments||{});if(!u.length)return r();function c(){return++s===u.length&&r(),!1}for(var f=0;f<u.length;f++)n=u[f],void 0,void 0,i="INSERT INTO "+ir+" (digest, seq) VALUES (?,?)",o=[t._attachments[n].digest,e],a.executeSql(i,o,c,c)}a.executeSql(u,c,function(e,t){var r=t.insertId;f(r,function(){y(e,r)})},function(){var e=ur("seq",er,null,"doc_id=? AND rev=?");return a.executeSql(e,[n,o],function(e,t){var i=t.rows.item(0).seq,a="UPDATE "+er+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",u=[s,r,n,o];e.executeSql(a,u,function(e){f(i,function(){y(e,i)})})}),!1})}function l(e){p||(e?c(p=e):v===m.length&&f())}var p=null,v=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev;var m=Object.keys(e.data._attachments||{});function g(e){v++,l(e)}function y(r,i){var s=e.metadata.id,a=e.stemmedRevs||[];o&&n.auto_compaction&&(a=Se(e.metadata).concat(a)),a.length&&cr(a,s,r),e.metadata.seq=i;var f=e.metadata.rev;delete e.metadata.rev;var l=o?"UPDATE "+Zt+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+er+" WHERE doc_id="+Zt+".id AND rev=?) WHERE id=?":"INSERT INTO "+Zt+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",p=jt(e.metadata),v=o?[p,i,t,s]:[s,i,i,p];r.executeSql(l,v,function(){h[u]={ok:!0,id:e.metadata.id,rev:f},d.set(s,e.metadata),c()})}i&&(e.data._deleted=!0),m.forEach(function(r){var n=e.data._attachments[r];if(n.stub)v++,l();else{var i=n.data;delete n.data,n.revpos=parseInt(t,10),function(e,t,r){var n="SELECT digest FROM "+tr+" WHERE digest=?";a.executeSql(n,[e],function(i,o){if(o.rows.length)return r();var s;n="INSERT INTO "+tr+" (digest, body, escaped) VALUES (?,?,1)",i.executeSql(n,[e,(s=t,s.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,""))],function(){r()},function(){return r(),!1})})}(n.digest,i,g)}}),m.length||f()}function g(){gt(e.revs_limit,c,n,d,a,h,m,r)}vt(c,"binary",function(e){if(e)return s(e);i.transaction(function(e){a=e,v(function(e){e?l=e:function(e){if(!c.length)return e();var t=0;function r(){++t===c.length&&e()}c.forEach(function(e){if(e._id&&qe(e._id))return r();var t=e.metadata.id;a.executeSql("SELECT json FROM "+Zt+" WHERE id = ?",[t],function(e,n){if(n.rows.length){var i=Rt(n.rows.item(0).json);d.set(t,i)}r()})})}(g)})},fr(s),p)})}var hr=new w;var dr=new q;function pr(e,t,r,n,i){var o=Object.keys(e._attachments||{});if(!o.length)return i&&i();var s=0;function a(){++s===o.length&&i&&i()}o.forEach(function(i){t.attachments&&t.include_docs?function(e,i){var o=e._attachments[i],s={binary:t.binary,ctx:n};r._getAttachment(e._id,i,o,s,function(t,r){e._attachments[i]=F(T(o,["digest","content_type"]),{data:r}),a()})}(e,i):(e._attachments[i].stub=!0,a())})}var vr=1,mr="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+er+" (seq, deleted)",gr="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+er+" (doc_id, rev)",yr="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+Zt+" (winningseq)",_r="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+ir+" (seq)",br="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+ir+" (digest, seq)",wr=er+".seq = "+Zt+".winningseq",kr=er+".seq AS seq, "+er+".deleted AS deleted, "+er+".json AS data, "+er+".rev AS rev, "+Zt+".json AS metadata";function xr(e,t){var r,n=this,i=null,o=function(e){return"size"in e?1e6*e.size:"undefined"!=typeof navigator&&/Android/.test(navigator.userAgent)?5e6:1}(e),s=[];n._name=e.name;var a=function(e){var t=hr.get(e.name);return t||(t=function(e){try{return{db:function(e){return e.websql(e.name,e.version,e.description,e.size)}(e)}}catch(e){return{error:e}}}(e),hr.set(e.name,t)),t}(F({},e,{version:vr,description:e.name,size:o}));if(a.error)return fr(t)(a.error);var u=a.db;function c(){I()&&(window.localStorage["_pouch__websqldb_"+n._name]=!0),t(null,n)}function f(e,t){e.executeSql(yr),e.executeSql("ALTER TABLE "+er+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){e.executeSql(mr),e.executeSql("ALTER TABLE "+Zt+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){e.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+Zt+" (local, id)");var r="SELECT "+Zt+".winningseq AS seq, "+Zt+".json AS metadata FROM "+er+" JOIN "+Zt+" ON "+er+".seq = "+Zt+".winningseq";e.executeSql(r,[],function(e,r){for(var n=[],i=[],o=0;o<r.rows.length;o++){var s=r.rows.item(o),a=s.seq,u=JSON.parse(s.metadata);Ie(u)&&n.push(a),qe(u.id)&&i.push(u.id)}e.executeSql("UPDATE "+Zt+"SET local = 1 WHERE id IN "+ar(i.length),i,function(){e.executeSql("UPDATE "+er+" SET deleted = 1 WHERE seq IN "+ar(n.length),n,t)})})})})}function l(e,t){var r="CREATE TABLE IF NOT EXISTS "+rr+" (id UNIQUE, rev, json)";e.executeSql(r,[],function(){var r="SELECT "+Zt+".id AS id, "+er+".json AS data FROM "+er+" JOIN "+Zt+" ON "+er+".seq = "+Zt+".winningseq WHERE local = 1";e.executeSql(r,[],function(e,r){for(var n=[],i=0;i<r.rows.length;i++)n.push(r.rows.item(i));!function r(){if(!n.length)return t(e);var i=n.shift(),o=JSON.parse(i.data)._rev;e.executeSql("INSERT INTO "+rr+" (id, rev, json) VALUES (?,?,?)",[i.id,o,i.data],function(e){e.executeSql("DELETE FROM "+Zt+" WHERE id=?",[i.id],function(e){e.executeSql("DELETE FROM "+er+" WHERE seq=?",[i.seq],function(){r()})})})}()})})}function h(e,t){function n(n){!function i(){if(!n.length)return t(e);var o=Qt(n.shift().hex,r),s=o.lastIndexOf("::"),a=o.substring(0,s),u=o.substring(s+2),c="UPDATE "+er+" SET doc_id=?, rev=? WHERE doc_id_rev=?";e.executeSql(c,[a,u,o],function(){i()})}()}var i="ALTER TABLE "+er+" ADD COLUMN doc_id";e.executeSql(i,[],function(e){var t="ALTER TABLE "+er+" ADD COLUMN rev";e.executeSql(t,[],function(e){e.executeSql(gr,[],function(e){var t="SELECT hex(doc_id_rev) as hex FROM "+er;e.executeSql(t,[],function(e,t){for(var r=[],i=0;i<t.rows.length;i++)r.push(t.rows.item(i));n(r)})})})})}function d(e,t){function r(e){var r="SELECT COUNT(*) AS cnt FROM "+tr;e.executeSql(r,[],function(e,r){if(!r.rows.item(0).cnt)return t(e);var n=0,i=10;!function r(){var o=ur(kr+", "+Zt+".id AS id",[Zt,er],wr,null,Zt+".id ");o+=" LIMIT "+i+" OFFSET "+n,n+=i,e.executeSql(o,[],function(e,n){if(!n.rows.length)return t(e);for(var i,o,s,a={},u=0;u<n.rows.length;u++)for(var c=n.rows.item(u),f=sr(c.data,c.id,c.rev),l=Object.keys(f._attachments||{}),h=0;h<l.length;h++){var d=f._attachments[l[h]];i=d.digest,o=c.seq,s=void 0,-1===(s=a[i]=a[i]||[]).indexOf(o)&&s.push(o)}var p=[];if(Object.keys(a).forEach(function(e){a[e].forEach(function(t){p.push([e,t])})}),!p.length)return r();var v=0;p.forEach(function(t){var n="INSERT INTO "+ir+" (digest, seq) VALUES (?,?)";e.executeSql(n,t,function(){++v===p.length&&r()})})})}()})}var n="CREATE TABLE IF NOT EXISTS "+ir+" (digest, seq INTEGER)";e.executeSql(n,[],function(e){e.executeSql(br,[],function(e){e.executeSql(_r,[],r)})})}function p(e,t){var r="ALTER TABLE "+tr+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";e.executeSql(r,[],t)}function v(e,t){var r="ALTER TABLE "+Zt+" ADD COLUMN max_seq INTEGER";e.executeSql(r,[],function(e){var r="UPDATE "+Zt+" SET max_seq=(SELECT MAX(seq) FROM "+er+" WHERE doc_id=id)";e.executeSql(r,[],function(e){var r="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+Zt+" (max_seq)";e.executeSql(r,[],t)})})}function m(){for(;s.length>0;){s.pop()(null,i)}}function y(e,t){if(0===t){var r="CREATE TABLE IF NOT EXISTS "+nr+" (dbid, db_version INTEGER)",n="CREATE TABLE IF NOT EXISTS "+tr+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",o="CREATE TABLE IF NOT EXISTS "+ir+" (digest, seq INTEGER)",s="CREATE TABLE IF NOT EXISTS "+Zt+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",a="CREATE TABLE IF NOT EXISTS "+er+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",u="CREATE TABLE IF NOT EXISTS "+rr+" (id UNIQUE, rev, json)";e.executeSql(n),e.executeSql(u),e.executeSql(o,[],function(){e.executeSql(_r),e.executeSql(br)}),e.executeSql(s,[],function(){e.executeSql(yr),e.executeSql(a,[],function(){e.executeSql(mr),e.executeSql(gr),e.executeSql(r,[],function(){var t="INSERT INTO "+nr+" (db_version, dbid) VALUES (?,?)";i=_e();var r=[Yt,i];e.executeSql(t,r,function(){m()})})})})}else{var c=[f,l,h,d,p,v,function(){t<Yt&&e.executeSql("UPDATE "+nr+" SET db_version = "+Yt);var r="SELECT dbid FROM "+nr;e.executeSql(r,[],function(e,t){i=t.rows.item(0).dbid,m()})}],g=t,y=function(e){c[g-1](e,y),g++};y(e)}}function b(e,t){var r=ur("COUNT("+Zt+".id) AS 'num'",[Zt,er],wr,er+".deleted=0");e.executeSql(r,[],function(e,r){t(r.rows.item(0).num)})}"function"!=typeof u.readTransaction&&(u.readTransaction=u.transaction),u.transaction(function(e){!function(e,t){e.executeSql('SELECT HEX("a") AS hex',[],function(e,n){var i=n.rows.item(0).hex;r=2===i.length?"UTF-8":"UTF-16",t()})}(e,function(){!function(e){var t="SELECT sql FROM sqlite_master WHERE tbl_name = "+nr;e.executeSql(t,[],function(e,t){t.rows.length?/db_version/.test(t.rows.item(0).sql)?e.executeSql("SELECT db_version FROM "+nr,[],function(e,t){var r=t.rows.item(0).db_version;y(e,r)}):e.executeSql("ALTER TABLE "+nr+" ADD COLUMN db_version INTEGER",[],function(){y(e,1)}):y(e,0)})}(e)})},fr(t),c),n.type=function(){return"websql"},n._id=_(function(e){e(null,i)}),n._info=function(e){var t,n;u.readTransaction(function(e){!function(e,t){var r="SELECT MAX(seq) AS seq FROM "+er;e.executeSql(r,[],function(e,r){var n=r.rows.item(0).seq||0;t(n)})}(e,function(e){t=e}),b(e,function(e){n=e})},fr(e),function(){e(null,{doc_count:n,update_seq:t,websql_encoding:r})})},n._bulkDocs=function(t,r,i){lr(e,t,r,n,u,dr,i)},n._get=function(e,t,r){var i,o,s,a,c=t.ctx;if(!c)return u.readTransaction(function(i){n._get(e,F({ctx:i},t),r)});function f(e){r(e,{doc:i,metadata:o,ctx:c})}if(t.rev){if(t.latest)return void function(e,t,r,n,i){var o=ur(kr,[Zt,er],wr,Zt+".id=?"),s=[t];e.executeSql(o,s,function(e,t){if(!t.rows.length){var o=ie(W,"missing");return i(o)}var s=Rt(t.rows.item(0).metadata);n(Ne(r,s))})}(c,e,t.rev,function(i){t.latest=!1,t.rev=i,n._get(e,t,r)},f);s=ur(kr,[Zt,er],Zt+".id="+er+".doc_id",[er+".doc_id=?",er+".rev=?"]),a=[e,t.rev]}else s=ur(kr,[Zt,er],wr,Zt+".id=?"),a=[e];c.executeSql(s,a,function(e,r){if(!r.rows.length)return f(ie(W,"missing"));var n=r.rows.item(0);if(o=Rt(n.metadata),n.deleted&&!t.rev)return f(ie(W,"deleted"));i=sr(n.data,o.id,n.rev),f()})},n._allDocs=function(e,t){var r,i=[],o="startkey"in e&&e.startkey,s="endkey"in e&&e.endkey,a="key"in e&&e.key,c="descending"in e&&e.descending,f="limit"in e?e.limit:-1,l="skip"in e?e.skip:0,h=!1!==e.inclusive_end,d=[],p=[];if(!1!==a)p.push(Zt+".id = ?"),d.push(a);else if(!1!==o||!1!==s){if(!1!==o&&(p.push(Zt+".id "+(c?"<=":">=")+" ?"),d.push(o)),!1!==s){var v=c?">":"<";h&&(v+="="),p.push(Zt+".id "+v+" ?"),d.push(s)}!1!==a&&(p.push(Zt+".id = ?"),d.push(a))}"ok"!==e.deleted&&p.push(er+".deleted = 0"),u.readTransaction(function(t){if(b(t,function(e){r=e}),0!==f){var o=ur(kr,[Zt,er],wr,p,Zt+".id "+(c?"DESC":"ASC"));o+=" LIMIT "+f+" OFFSET "+l,t.executeSql(o,d,function(t,r){for(var o=0,s=r.rows.length;o<s;o++){var a=r.rows.item(o),u=Rt(a.metadata),c=u.id,f=sr(a.data,c,a.rev),l=f._rev,h={id:c,key:c,value:{rev:l}};if(e.include_docs){if(h.doc=f,h.doc._rev=l,e.conflicts){var d=Ee(u);d.length&&(h.doc._conflicts=d)}pr(h.doc,e,n,t)}if(a.deleted){if("ok"!==e.deleted)continue;h.value.deleted=!0,h.doc=null}i.push(h)}})}},fr(t),function(){t(null,{total_rows:r,offset:e.skip,rows:i})})},n._changes=function(e){if((e=g(e)).continuous){var t=n._name+":"+_e();return dr.addListener(n._name,t,n,e),dr.notify(n._name),{cancel:function(){dr.removeListener(n._name,t)}}}var r=e.descending;e.since=e.since&&!r?e.since:0;var i,o="limit"in e?e.limit:-1;0===o&&(o=1),i="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var s=[],a=0;!function(){var t=Zt+".json AS metadata, "+Zt+".max_seq AS maxSeq, "+er+".json AS winningDoc, "+er+".rev AS winningRev ",c=Zt+" JOIN "+er,f=Zt+".id="+er+".doc_id AND "+Zt+".winningseq="+er+".seq",l=["maxSeq > ?"],h=[e.since];e.doc_ids&&(l.push(Zt+".id IN "+ar(e.doc_ids.length)),h=h.concat(e.doc_ids));var d=ur(t,c,f,l,"maxSeq "+(r?"DESC":"ASC")),p=se(e);e.view||e.filter||(d+=" LIMIT "+o);var v=e.since||0;u.readTransaction(function(t){t.executeSql(d,h,function(t,r){function u(t){return function(){e.onChange(t)}}for(var c=0,f=r.rows.length;c<f;c++){var l=r.rows.item(c),h=Rt(l.metadata);v=l.maxSeq;var d=sr(l.winningDoc,h.id,l.winningRev),m=e.processChange(d,h,e);m.seq=l.maxSeq;var g=p(m);if("object"==typeof g)return e.complete(g);if(g&&(a++,i&&s.push(m),e.attachments&&e.include_docs?pr(d,e,n,t,u(m)):u(m)()),a===o)break}})},fr(e.complete),function(){e.continuous||e.complete(null,{results:s,last_seq:v})})}()},n._close=function(e){e()},n._getAttachment=function(e,t,n,i,o){var s,a=i.ctx,u=n.digest,c=n.content_type,f="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+tr+" WHERE digest=?";a.executeSql(f,[u],function(e,t){var n=t.rows.item(0),a=n.escaped?n.body.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""):Qt(n.body,r);s=i.binary?tt(a,c):Ze(a),o(null,s)})},n._getRevisionTree=function(e,t){u.readTransaction(function(r){var n="SELECT json AS metadata FROM "+Zt+" WHERE id = ?";r.executeSql(n,[e],function(e,r){if(r.rows.length){var n=Rt(r.rows.item(0).metadata);t(null,n.rev_tree)}else t(ie(W))})})},n._doCompaction=function(e,t,r){if(!t.length)return r();u.transaction(function(r){var n="SELECT json AS metadata FROM "+Zt+" WHERE id = ?";r.executeSql(n,[e],function(r,n){var i=Rt(n.rows.item(0).metadata);we(i.rev_tree,function(e,r,n,i,o){var s=r+"-"+n;-1!==t.indexOf(s)&&(o.status="missing")});var o="UPDATE "+Zt+" SET json = ? WHERE id = ?";r.executeSql(o,[jt(i),e])}),cr(t,e,r)},fr(r),function(){r()})},n._getLocal=function(e,t){u.readTransaction(function(r){var n="SELECT json, rev FROM "+rr+" WHERE id=?";r.executeSql(n,[e],function(r,n){if(n.rows.length){var i=n.rows.item(0),o=sr(i.json,e,i.rev);t(null,o)}else t(ie(W))})})},n._putLocal=function(e,t,r){"function"==typeof t&&(r=t,t={}),delete e._revisions;var n,i=e._rev,o=e._id;n=e._rev=i?"0-"+(parseInt(i.split("-")[1],10)+1):"0-1";var s,a=or(e);function c(e){var u,c;i?(u="UPDATE "+rr+" SET rev=?, json=? WHERE id=? AND rev=?",c=[n,a,o,i]):(u="INSERT INTO "+rr+" (id, rev, json) VALUES (?,?,?)",c=[o,n,a]),e.executeSql(u,c,function(e,i){i.rowsAffected?(s={ok:!0,id:o,rev:n},t.ctx&&r(null,s)):r(ie(z))},function(){return r(ie(z)),!1})}t.ctx?c(t.ctx):u.transaction(c,fr(r),function(){s&&r(null,s)})},n._removeLocal=function(e,t,r){var n;function i(i){var o="DELETE FROM "+rr+" WHERE id=? AND rev=?",s=[e._id,e._rev];i.executeSql(o,s,function(i,o){if(!o.rowsAffected)return r(ie(W));n={ok:!0,id:e._id,rev:"0-0"},t.ctx&&r(null,n)})}"function"==typeof t&&(r=t,t={}),t.ctx?i(t.ctx):u.transaction(i,fr(r),function(){n&&r(null,n)})},n._destroy=function(e,t){dr.removeAllListeners(n._name),u.transaction(function(e){[Zt,er,tr,nr,rr,ir].forEach(function(t){e.executeSql("DROP TABLE IF EXISTS "+t,[])})},fr(t),function(){I()&&(delete window.localStorage["_pouch__websqldb_"+n._name],delete window.localStorage[n._name]),t(null,{ok:!0})})}}function Er(){if("undefined"==typeof indexedDB||null===indexedDB||!/iP(hone|od|ad)/.test(navigator.userAgent))return!0;var e=I(),t="_pouch__websqldb_valid_"+navigator.userAgent;if(e&&localStorage[t])return"1"===localStorage[t];var r=function(){try{return openDatabase("_pouch_validate_websql",1,"",1),!0}catch(e){return!1}}();return e&&(localStorage[t]=r?"1":"0"),r}function Sr(e,t,r,n){return openDatabase(e,t,r,n)}function Rr(e,t){var r=F({websql:Sr},e);xr.call(this,r,t)}Rr.valid=function(){return"function"==typeof openDatabase&&Er()},Rr.use_prefix=!0;function jr(e,t){var r,n,i,o=new Headers,s={method:e.method,credentials:"include",headers:o};return e.json&&(o.set("Accept","application/json"),o.set("Content-Type",e.headers["Content-Type"]||"application/json")),e.body&&e.processData&&"string"!=typeof e.body?s.body=JSON.stringify(e.body):s.body="body"in e?e.body:null,Object.keys(e.headers).forEach(function(t){e.headers.hasOwnProperty(t)&&o.set(t,e.headers[t])}),r=function(){for(var e={},t=new d(function(t,r){e.resolve=t,e.reject=r}),r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.promise=t,d.resolve().then(function(){return fetch.apply(null,r)}).then(function(t){e.resolve(t)}).catch(function(t){e.reject(t)}),e}(e.url,s),e.timeout>0&&(n=setTimeout(function(){r.reject(new Error("Load timeout for resource: "+e.url))},e.timeout)),r.promise.then(function(t){return i={statusCode:t.status},e.timeout>0&&clearTimeout(n),i.statusCode>=200&&i.statusCode<300?e.binary?t.blob():t.text():t.json()}).then(function(e){i.statusCode>=200&&i.statusCode<300?t(null,i,e):(e.status=i.statusCode,t(e))}).catch(function(e){e||(e=new Error("canceled")),t(e)}),{abort:r.reject}}var Tr=function(){try{return new XMLHttpRequest,!0}catch(e){return!1}}();function Dr(e,t){return Tr||e.xhr?function(e,t){var r,n,i=!1,o=function(){i=!0,r.abort(),a()},s={abort:function(){r.abort(),a()}},a=function(){clearTimeout(n),s.abort=function(){},r&&(r.onprogress=void 0,r.upload&&(r.upload.onprogress=void 0),r.onreadystatechange=void 0,r=void 0)};r=e.xhr?new e.xhr:new XMLHttpRequest;try{r.open(e.method,e.url)}catch(e){return t(new Error(e.name||"Url is invalid"))}for(var u in r.withCredentials=!("withCredentials"in e)||e.withCredentials,"GET"===e.method?delete e.headers["Content-Type"]:e.json&&(e.headers.Accept="application/json",e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.body&&e.processData&&"string"!=typeof e.body&&(e.body=JSON.stringify(e.body))),e.binary&&(r.responseType="arraybuffer"),"body"in e||(e.body=null),e.headers)e.headers.hasOwnProperty(u)&&r.setRequestHeader(u,e.headers[u]);return e.timeout>0&&(n=setTimeout(o,e.timeout),r.onprogress=function(){clearTimeout(n),4!==r.readyState&&(n=setTimeout(o,e.timeout))},void 0!==r.upload&&(r.upload.onprogress=r.onprogress)),r.onreadystatechange=function(){if(4===r.readyState){var n={statusCode:r.status};if(r.status>=200&&r.status<300){var o;o=e.binary?et([r.response||""],{type:r.getResponseHeader("Content-Type")}):r.responseText,t(null,n,o)}else{var s={};if(i)(s=new Error("ETIMEDOUT")).code="ETIMEDOUT";else if("string"==typeof r.response)try{s=JSON.parse(r.response)}catch(e){}s.status=r.status,t(s)}a()}},e.body&&e.body instanceof Blob?at(e.body,function(e){r.send(e)}):r.send(e.body),s}(e,t):jr(e,t)}var Or=function(){};function Ar(e,t){e=g(e);return(e=F({method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1},e)).json&&(e.binary||(e.headers.Accept="application/json"),e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json"),e.binary&&(e.encoding=null,e.json=!1),e.processData||(e.json=!1),Dr(e,function(r,n,i){if(r)return t(oe(r));var o,s=n.headers&&n.headers["content-type"],a=i||"";if(!e.binary&&(e.json||!e.processData)&&"object"!=typeof a&&(/json/.test(s)||/^[\s]*\{/.test(a)&&/\}[\s]*$/.test(a)))try{a=JSON.parse(a.toString())}catch(e){}n.statusCode>=200&&n.statusCode<300?function(t,r,n){if(!e.binary&&e.json&&"string"==typeof t)try{t=JSON.parse(t)}catch(e){return n(e)}Array.isArray(t)&&(t=t.map(function(e){return e.error||e.missing?oe(e):e})),e.binary&&Or(t,r),n(null,t,r)}(a,n,t):((o=oe(a)).status=n.statusCode,t(o))})}function Br(e,t){var r=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n=-1!==r.indexOf("safari")&&-1===r.indexOf("chrome"),i=-1!==r.indexOf("msie"),o=-1!==r.indexOf("edge"),s=n||(i||o)&&"GET"===e.method,a=!("cache"in e)||e.cache;if(!/^blob:/.test(e.url)&&(s||!a)){var u=-1!==e.url.indexOf("?");e.url+=(u?"&":"?")+"_nonce="+Date.now()}return Ar(e,t)}var Cr=25,Lr=50,Ir={},qr=s("pouchdb:http");function Nr(e){var t=e.doc&&e.doc._attachments;t&&Object.keys(t).forEach(function(e){var r=t[e];r.data=rt(r.data,r.content_type)})}function Mr(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):/^_local/.test(e)?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function Pr(e){return e._attachments&&Object.keys(e._attachments)?d.all(Object.keys(e._attachments).map(function(t){var r=e._attachments[t];if(r.data&&"string"!=typeof r.data)return new d(function(e){st(r.data,e)}).then(function(e){r.data=e})})):d.resolve()}function Fr(e,t){if(function(e){if(!e.prefix)return!1;var t=ve(e.prefix).protocol;return"http"===t||"https"===t}(t)){var r=t.name.substr(t.prefix.length);e=t.prefix+encodeURIComponent(r)}var n=ve(e);(n.user||n.password)&&(n.auth={username:n.user,password:n.password});var i=n.path.replace(/(^\/|\/$)/g,"").split("/");return n.db=i.pop(),-1===n.db.indexOf("%")&&(n.db=encodeURIComponent(n.db)),n.path=i.join("/"),n}function Ur(e,t){return Gr(e,e.db+"/"+t)}function Gr(e,t){var r=e.path?"/":"";return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+r+t}function Wr(e){return"?"+Object.keys(e).map(function(t){return t+"="+encodeURIComponent(e[t])}).join("&")}function zr(e,t){var r,n=this,i=Fr(e.name,e),s=Ur(i,""),a=(e=g(e)).ajax||{};if(e.auth||i.auth){var u=e.auth||i.auth,f=u.username+":"+u.password,l=Ze(unescape(encodeURIComponent(f)));a.headers=a.headers||{},a.headers.Authorization="Basic "+l}function h(e,t,r){var i=e.ajax||{},o=F(g(a),i,t),s=g(a.headers||{});return o.headers=F(s,i.headers,t.headers||{}),qr(o.method+" "+o.url),n._ajax(o,r)}function p(e,t){return new d(function(r,n){h(e,t,function(e,t){if(e)return n(e);r(t)})})}function v(e,t){return x(e,o(function(e){m().then(function(){return t.apply(this,e)}).catch(function(t){e.pop()(t)})}))}function m(){return e.skipSetup||e.skip_setup?d.resolve():r||((r=p({},{method:"GET",url:s}).catch(function(e){return e&&e.status&&404===e.status?(P(404,"PouchDB is just detecting if the remote exists."),p({},{method:"PUT",url:s})):d.reject(e)}).catch(function(e){return!(!e||!e.status||412!==e.status)||d.reject(e)})).catch(function(){r=null}),r)}function y(e){return e.split("/").map(encodeURIComponent).join("/")}n._ajax=Br,c(function(){t(null,n)}),n.type=function(){return"http"},n.id=v("id",function(e){h({},{method:"GET",url:Gr(i,"")},function(t,r){var n=r&&r.uuid?r.uuid+i.db:Ur(i,"");e(null,n)})}),n.request=v("request",function(e,t){e.url=Ur(i,e.url),h({},e,t)}),n.compact=v("compact",function(e,t){"function"==typeof e&&(t=e,e={}),h(e=g(e),{url:Ur(i,"_compact"),method:"POST"},function(){!function r(){n.info(function(n,i){i&&!i.compact_running?t(null,{ok:!0}):setTimeout(r,e.interval||200)})}()})}),n.bulkGet=x("bulkGet",function(e,t){var r=this;function n(t){var r={};e.revs&&(r.revs=!0),e.attachments&&(r.attachments=!0),e.latest&&(r.latest=!0),h(e,{url:Ur(i,"_bulk_get"+Wr(r)),method:"POST",body:{docs:e.docs}},t)}function o(){var n=Lr,i=Math.ceil(e.docs.length/n),o=0,s=new Array(i);function u(e){return function(r,n){s[e]=n.results,++o===i&&t(null,{results:ae(s)})}}for(var c=0;c<i;c++){var f=T(e,["revs","attachments","latest"]);f.ajax=a,f.docs=e.docs.slice(c*n,Math.min(e.docs.length,(c+1)*n)),C(r,f,u(c))}}var s=Gr(i,""),u=Ir[s];"boolean"!=typeof u?n(function(e,r){e?(Ir[s]=!1,P(e.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),o()):(Ir[s]=!0,t(null,r))}):u?n(t):o()}),n._info=function(e){m().then(function(){h({},{method:"GET",url:Ur(i,"")},function(t,r){if(t)return e(t);r.host=Ur(i,""),e(null,r)})}).catch(e)},n.get=v("get",function(e,t,r){"function"==typeof t&&(r=t,t={});var n={};(t=g(t)).revs&&(n.revs=!0),t.revs_info&&(n.revs_info=!0),t.latest&&(n.latest=!0),t.open_revs&&("all"!==t.open_revs&&(t.open_revs=JSON.stringify(t.open_revs)),n.open_revs=t.open_revs),t.rev&&(n.rev=t.rev),t.conflicts&&(n.conflicts=t.conflicts),e=Mr(e);var o={method:"GET",url:Ur(i,e+Wr(n))};function s(e){var r=e._attachments,n=r&&Object.keys(r);if(r&&n.length)return function(e,t){return new d(function(r,n){var i,o=0,s=0,a=0,u=e.length;function c(){++a===u?i?n(i):r():h()}function f(){o--,c()}function l(e){o--,i=i||e,c()}function h(){for(;o<t&&s<u;)o++,e[s++]().then(f,l)}h()})}(n.map(function(n){return function(){return function(n){var o=r[n],s=Mr(e._id)+"/"+y(n)+"?rev="+e._rev;return p(t,{method:"GET",url:Ur(i,s),binary:!0}).then(function(e){return t.binary?e:new d(function(t){st(e,t)})}).then(function(e){delete o.stub,delete o.length,o.data=e})}(n)}}),5)}p(t,o).then(function(e){return d.resolve().then(function(){if(t.attachments)return r=e,Array.isArray(r)?d.all(r.map(function(e){if(e.ok)return s(e.ok)})):s(r);var r}).then(function(){r(null,e)})}).catch(r)}),n.remove=v("remove",function(e,t,r,n){var o;"string"==typeof t?(o={_id:e,_rev:t},"function"==typeof r&&(n=r,r={})):(o=e,"function"==typeof t?(n=t,r={}):(n=r,r=t));var s=o._rev||r.rev;h(r,{method:"DELETE",url:Ur(i,Mr(o._id))+"?rev="+s},n)}),n.getAttachment=v("getAttachment",function(e,t,r,n){"function"==typeof r&&(n=r,r={});var o=r.rev?"?rev="+r.rev:"";h(r,{method:"GET",url:Ur(i,Mr(e))+"/"+y(t)+o,binary:!0},n)}),n.removeAttachment=v("removeAttachment",function(e,t,r,n){h({},{method:"DELETE",url:Ur(i,Mr(e)+"/"+y(t))+"?rev="+r},n)}),n.putAttachment=v("putAttachment",function(e,t,r,n,o,s){"function"==typeof o&&(s=o,o=n,n=r,r=null);var u=Mr(e)+"/"+y(t),c=Ur(i,u);if(r&&(c+="?rev="+r),"string"==typeof n){var f;try{f=Ye(n)}catch(e){return s(ie($,"Attachment is not a valid base64 string"))}n=f?tt(f,o):""}h({},{headers:{"Content-Type":o},method:"PUT",url:c,processData:!1,body:n,timeout:a.timeout||6e4},s)}),n._bulkDocs=function(e,t,r){e.new_edits=t.new_edits,m().then(function(){return d.all(e.docs.map(Pr))}).then(function(){h(t,{method:"POST",url:Ur(i,"_bulk_docs"),timeout:t.timeout,body:e},function(e,t){if(e)return r(e);t.forEach(function(e){e.ok=!0}),r(null,t)})}).catch(r)},n._put=function(e,t,r){m().then(function(){return Pr(e)}).then(function(){h(t,{method:"PUT",url:Ur(i,Mr(e._id)),body:e},function(e,t){if(e)return r(e);r(null,t)})}).catch(r)},n.allDocs=v("allDocs",function(e,t){"function"==typeof e&&(t=e,e={});var r,n={},o="GET";(e=g(e)).conflicts&&(n.conflicts=!0),e.descending&&(n.descending=!0),e.include_docs&&(n.include_docs=!0),e.attachments&&(n.attachments=!0),e.key&&(n.key=JSON.stringify(e.key)),e.start_key&&(e.startkey=e.start_key),e.startkey&&(n.startkey=JSON.stringify(e.startkey)),e.end_key&&(e.endkey=e.end_key),e.endkey&&(n.endkey=JSON.stringify(e.endkey)),void 0!==e.inclusive_end&&(n.inclusive_end=!!e.inclusive_end),void 0!==e.limit&&(n.limit=e.limit),void 0!==e.skip&&(n.skip=e.skip);var s=Wr(n);void 0!==e.keys&&(o="POST",r={keys:e.keys}),p(e,{method:o,url:Ur(i,"_all_docs"+s),body:r}).then(function(r){e.include_docs&&e.attachments&&e.binary&&r.rows.forEach(Nr),t(null,r)}).catch(t)}),n._changes=function(e){var t="batch_size"in e?e.batch_size:Cr;(e=g(e)).timeout="timeout"in e?e.timeout:"timeout"in a?a.timeout:3e4;var r,n=e.timeout?{timeout:e.timeout-5e3}:{},o=void 0!==e.limit&&e.limit;r="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var s=o;if(e.style&&(n.style=e.style),(e.include_docs||e.filter&&"function"==typeof e.filter)&&(n.include_docs=!0),e.attachments&&(n.attachments=!0),e.continuous&&(n.feed="longpoll"),e.conflicts&&(n.conflicts=!0),e.descending&&(n.descending=!0),"heartbeat"in e?e.heartbeat&&(n.heartbeat=e.heartbeat):e.continuous&&(n.heartbeat=1e4),e.filter&&"string"==typeof e.filter&&(n.filter=e.filter),e.view&&"string"==typeof e.view&&(n.filter="_view",n.view=e.view),e.query_params&&"object"==typeof e.query_params)for(var u in e.query_params)e.query_params.hasOwnProperty(u)&&(n[u]=e.query_params[u]);var f,l,d,p="GET";e.doc_ids&&(n.filter="_doc_ids",p="POST",f={doc_ids:e.doc_ids});var v=function(r,a){if(!e.aborted){n.since=r,"object"==typeof n.since&&(n.since=JSON.stringify(n.since)),e.descending?o&&(n.limit=s):n.limit=!o||s>t?t:s;var u={method:p,url:Ur(i,"_changes"+Wr(n)),timeout:e.timeout,body:f};d=r,e.aborted||m().then(function(){l=h(e,u,a)}).catch(a)}},y={results:[]},_=function(n,i){if(!e.aborted){var a=0;if(i&&i.results){a=i.results.length,y.last_seq=i.last_seq;e.query_params,i.results=i.results.filter(function(t){s--;var n=se(e)(t);return n&&(e.include_docs&&e.attachments&&e.binary&&Nr(t),r&&y.results.push(t),e.onChange(t)),n})}else if(n)return e.aborted=!0,void e.complete(n);i&&i.last_seq&&(d=i.last_seq);var u=o&&s<=0||i&&a<t||e.descending;(!e.continuous||o&&s<=0)&&u?e.complete(null,y):c(function(){v(d,_)})}};return v(e.since||0,_),{cancel:function(){e.aborted=!0,l&&l.abort()}}},n.revsDiff=v("revsDiff",function(e,t,r){"function"==typeof t&&(r=t,t={}),h(t,{method:"POST",url:Ur(i,"_revs_diff"),body:e},r)}),n._close=function(e){e()},n._destroy=function(e,t){h(e,{url:Ur(i,""),method:"DELETE"},function(e,r){if(e&&e.status&&404!==e.status)return t(e);t(null,r)})}}zr.valid=function(){return!0};function Hr(e){this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Hr)}catch(e){}}function Kr(e){this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Kr)}catch(e){}}function Jr(e){this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Jr)}catch(e){}}function Vr(e,t){return t&&e.then(function(e){c(function(){t(null,e)})},function(e){c(function(){t(e)})}),e}function $r(e,t){return function(){var r=arguments,n=this;return e.add(function(){return t.apply(n,r)})}}function Qr(e){var t=new b(e),r=new Array(t.size),n=-1;return t.forEach(function(e){r[++n]=e}),r}function Xr(e){var t=new Array(e.size),r=-1;return e.forEach(function(e,n){t[++r]=n}),t}function Yr(e){return new Jr("builtin "+e+" function requires map values to be numbers or number arrays")}function Zr(e){for(var t=0,r=0,n=e.length;r<n;r++){var i=e[r];if("number"!=typeof i){if(!Array.isArray(i))throw Yr("_sum");t="number"==typeof t?[t]:t;for(var o=0,s=i.length;o<s;o++){var a=i[o];if("number"!=typeof a)throw Yr("_sum");void 0===t[o]?t.push(a):t[o]+=a}}else"number"==typeof t?t+=i:t[0]+=i}return t}u(Hr,Error),u(Kr,Error),u(Jr,Error);var en=N.bind(null,"log"),tn=Array.isArray,rn=JSON.parse;function nn(e,t){return f("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:Zr,log:en,isArray:tn,toJSON:rn})}var on=-324,sn=3,an="";function un(e,t){if(e===t)return 0;e=cn(e),t=cn(t);var r=pn(e),n=pn(t);if(r-n!=0)return r-n;switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return function(e,t){return e===t?0:e>t?1:-1}(e,t)}return Array.isArray(e)?function(e,t){for(var r=Math.min(e.length,t.length),n=0;n<r;n++){var i=un(e[n],t[n]);if(0!==i)return i}return e.length===t.length?0:e.length>t.length?1:-1}(e,t):function(e,t){for(var r=Object.keys(e),n=Object.keys(t),i=Math.min(r.length,n.length),o=0;o<i;o++){var s=un(r[o],n[o]);if(0!==s)return s;if(0!==(s=un(e[r[o]],t[n[o]])))return s}return r.length===n.length?0:r.length>n.length?1:-1}(e,t)}function cn(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var r=e.length;e=new Array(r);for(var n=0;n<r;n++)e[n]=cn(t[n])}else{if(e instanceof Date)return e.toJSON();if(null!==e)for(var i in e={},t)if(t.hasOwnProperty(i)){var o=t[i];void 0!==o&&(e[i]=cn(o))}}}return e}function fn(e){if(null!==e)switch(typeof e){case"boolean":return e?1:0;case"number":return function(e){if(0===e)return"1";var t=e.toExponential().split(/e\+?/),r=parseInt(t[1],10),n=e<0,i=n?"0":"2",o=(s=((n?-r:r)-on).toString(),a="0",u=sn,function(e,t,r){for(var n="",i=r-e.length;n.length<i;)n+=t;return n}(s,a,u)+s);var s,a,u;i+=an+o;var c=Math.abs(parseFloat(t[0]));n&&(c=10-c);var f=c.toFixed(20);return f=f.replace(/\.?0+$/,""),i+=an+f}(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),r=t?e:Object.keys(e),n=-1,i=r.length,o="";if(t)for(;++n<i;)o+=ln(r[n]);else for(;++n<i;){var s=r[n];o+=ln(s)+ln(e[s])}return o}return""}function ln(e){return pn(e=cn(e))+an+fn(e)+"\0"}function hn(e,t){var r,n=t;if("1"===e[t])r=0,t++;else{var i="0"===e[t];t++;var o="",s=e.substring(t,t+sn),a=parseInt(s,10)+on;for(i&&(a=-a),t+=sn;;){var u=e[t];if("\0"===u)break;o+=u,t++}r=1===(o=o.split(".")).length?parseInt(o,10):parseFloat(o[0]+"."+o[1]),i&&(r-=10),0!==a&&(r=parseFloat(r+"e"+a))}return{num:r,length:t-n}}function dn(e,t){var r=e.pop();if(t.length){var n=t[t.length-1];r===n.element&&(t.pop(),n=t[t.length-1]);var i=n.element,o=n.index;if(Array.isArray(i))i.push(r);else if(o===e.length-2){i[e.pop()]=r}else e.push(r)}}function pn(e){var t=["boolean","number","string","object"].indexOf(typeof e);return~t?null===e?1:Array.isArray(e)?5:t<3?t+2:t+3:Array.isArray(e)?5:void 0}function vn(){this.promise=new d(function(e){e()})}function mn(e,t,r,n,i,o){var s,a=r.toString()+(n&&n.toString())+"undefined";if(!i&&(s=e._cachedViews=e._cachedViews||{})[a])return s[a];var u=e.info().then(function(u){var c,f=u.db_name+"-mrview-"+(i?"temp":(c=a,l.hash(c)));return me(e,"_local/"+o,function(e){e.views=e.views||{};var r=t;-1===r.indexOf("/")&&(r=t+"/"+t);var n=e.views[r]=e.views[r]||{};if(!n[f])return n[f]=!0,e}).then(function(){return e.registerDependentDatabase(f).then(function(t){var i=t.db;i.auto_compaction=!0;var o={name:f,db:i,sourceDB:e,adapter:e.adapter,mapFun:r,reduceFun:n};return o.db.get("_local/lastSeq").catch(function(e){if(404!==e.status)throw e}).then(function(e){return o.seq=e?e.seq:0,s&&o.db.once("destroyed",function(){delete s[a]}),o})})})});return s&&(s[a]=u),u}vn.prototype.add=function(e){return this.promise=this.promise.catch(function(){}).then(function(){return e()}),this.promise},vn.prototype.finish=function(){return this.promise};var gn={},yn=new vn,_n=50;function bn(e){return-1===e.indexOf("/")?[e,e]:e.split("/")}function wn(e,t){try{e.emit("error",t)}catch(e){N("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),N("error",t)}}var kn={_sum:function(e,t){return Zr(t)},_count:function(e,t){return t.length},_stats:function(e,t){return{sum:Zr(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:function(e){for(var t=0,r=0,n=e.length;r<n;r++){var i=e[r];t+=i*i}return t}(t)}}};var xn=function(e,t,r,n){function i(e,t,r){try{t(r)}catch(t){wn(e,t)}}function s(e,t,r,n,i){try{return{output:t(r,n,i)}}catch(t){return wn(e,t),{error:t}}}function a(e,t){var r=un(e.key,t.key);return 0!==r?r:un(e.value,t.value)}function u(e){var t=e.value;return t&&"object"==typeof t&&t._id||e.id}function f(e){return function(t){return e.include_docs&&e.attachments&&e.binary&&function(e){e.rows.forEach(function(e){var t=e.doc&&e.doc._attachments;t&&Object.keys(t).forEach(function(e){var r=t[e];t[e].data=rt(r.data,r.content_type)})})}(t),t}}function l(e,t,r,n){var i=t[e];void 0!==i&&(n&&(i=encodeURIComponent(JSON.stringify(i))),r.push(e+"="+i))}function h(e){if(void 0!==e){var t=Number(e);return isNaN(t)||t!==parseInt(e,10)?e:t}}function p(e,t){var r=e.descending?"endkey":"startkey",n=e.descending?"startkey":"endkey";if(void 0!==e[r]&&void 0!==e[n]&&un(e[r],e[n])>0)throw new Hr("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(t.reduce&&!1!==e.reduce){if(e.include_docs)throw new Hr("{include_docs:true} is invalid for reduce");if(e.keys&&e.keys.length>1&&!e.group&&!e.group_level)throw new Hr("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(t){var r=function(e){if(e){if("number"!=typeof e)return new Hr('Invalid value for integer: "'+e+'"');if(e<0)return new Hr('Invalid value for positive integer: "'+e+'"')}}(e[t]);if(r)throw r})}function v(e){return function(t){if(404===t.status)return e;throw t}}function m(e,t,r){var n="_local/doc_"+e,i={_id:n,keys:[]},o=r.get(e),s=o[0];return(function(e){return 1===e.length&&/^1-/.test(e[0].rev)}(o[1])?d.resolve(i):t.db.get(n).catch(v(i))).then(function(e){return function(e){return e.keys.length?t.db.allDocs({keys:e.keys,include_docs:!0}):d.resolve({rows:[]})}(e).then(function(t){return function(e,t){for(var r=[],n=new b,i=0,o=t.rows.length;i<o;i++){var a=t.rows[i].doc;if(a&&(r.push(a),n.add(a._id),a._deleted=!s.has(a._id),!a._deleted)){var u=s.get(a._id);"value"in u&&(a.value=u.value)}}var c=Xr(s);return c.forEach(function(e){if(!n.has(e)){var t={_id:e},i=s.get(e);"value"in i&&(t.value=i.value),r.push(t)}}),e.keys=Qr(c.concat(e.keys)),r.push(e),r}(e,t)})})}function g(e){var t="string"==typeof e?e:e.name,r=gn[t];return r||(r=gn[t]=new vn),r}function y(e){return $r(g(e),function(){return function(e){var r,n,o=t(e.mapFun,function(e,t){var i={id:n._id,key:cn(e)};void 0!==t&&null!==t&&(i.value=cn(t)),r.push(i)}),s=e.seq||0;function u(t,r){return function(){return function(e,t,r){return e.db.get("_local/lastSeq").catch(v({_id:"_local/lastSeq",seq:0})).then(function(n){var i=Xr(t);return d.all(i.map(function(r){return m(r,e,t)})).then(function(t){var i=ae(t);return n.seq=r,i.push(n),e.db.bulkDocs({docs:i})})})}(e,t,r)}}var c=new vn;function f(){return e.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:s,limit:_n}).then(l)}function l(t){var l=t.results;if(l.length){var d=function(t){for(var u=new w,c=0,f=t.length;c<f;c++){var l=t[c];if("_"!==l.doc._id[0]){r=[],(n=l.doc)._deleted||i(e.sourceDB,o,n),r.sort(a);var d=h(r);u.set(l.doc._id,[d,l.changes])}s=l.seq}return u}(l);if(c.add(u(d,s)),!(l.length<_n))return f()}}function h(e){for(var t,r=new w,n=0,i=e.length;n<i;n++){var o=e[n],s=[o.key,o.id];n>0&&0===un(o.key,t)&&s.push(n),r.set(ln(s),o),t=o.key}return r}return f().then(function(){return c.finish()}).then(function(){e.seq=s})}(e)})()}function _(e,t){return $r(g(e),function(){return function(e,t){var n,i=e.reduceFun&&!1!==t.reduce,o=t.skip||0;function a(t){return t.include_docs=!0,e.db.allDocs(t).then(function(e){return n=e.total_rows,e.rows.map(function(e){if("value"in e.doc&&"object"==typeof e.doc.value&&null!==e.doc.value){var t=Object.keys(e.doc.value).sort(),r=["id","key","value"];if(!(t<r||t>r))return e.doc.value}var n=function(e){for(var t=[],r=[],n=0;;){var i=e[n++];if("\0"!==i)switch(i){case"1":t.push(null);break;case"2":t.push("1"===e[n]),n++;break;case"3":var o=hn(e,n);t.push(o.num),n+=o.length;break;case"4":for(var s="";;){var a=e[n];if("\0"===a)break;s+=a,n++}s=s.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),t.push(s);break;case"5":var u={element:[],index:t.length};t.push(u.element),r.push(u);break;case"6":var c={element:{},index:t.length};t.push(c.element),r.push(c);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}else{if(1===t.length)return t.pop();dn(t,r)}}}(e.doc._id);return{key:n[0],id:n[1],value:"value"in e.doc?e.doc.value:null}})})}function c(a){var c;if(c=i?function(e,t,n){0===n.group_level&&delete n.group_level;var i=n.group||n.group_level,o=r(e.reduceFun),a=[],u=isNaN(n.group_level)?Number.POSITIVE_INFINITY:n.group_level;t.forEach(function(e){var t=a[a.length-1],r=i?e.key:null;if(i&&Array.isArray(r)&&(r=r.slice(0,u)),t&&0===un(t.groupKey,r))return t.keys.push([e.key,e.id]),void t.values.push(e.value);a.push({keys:[[e.key,e.id]],values:[e.value],groupKey:r})}),t=[];for(var c=0,f=a.length;c<f;c++){var l=a[c],h=s(e.sourceDB,o,l.keys,l.values,!1);if(h.error&&h.error instanceof Jr)throw h.error;t.push({value:h.error?null:h.output,key:l.groupKey})}return{rows:function(e,t,r){return r=r||0,"number"==typeof t?e.slice(r,t+r):r>0?e.slice(r):e}(t,n.limit,n.skip)}}(e,a,t):{total_rows:n,offset:o,rows:a},t.include_docs){var f=Qr(a.map(u));return e.sourceDB.allDocs({keys:f,include_docs:!0,conflicts:t.conflicts,attachments:t.attachments,binary:t.binary}).then(function(e){var t=new w;return e.rows.forEach(function(e){t.set(e.id,e.doc)}),a.forEach(function(e){var r=u(e),n=t.get(r);n&&(e.doc=n)}),c})}return c}if(void 0===t.keys||t.keys.length||(t.limit=0,delete t.keys),void 0!==t.keys){var f=t.keys,l=f.map(function(e){var t={startkey:ln([e]),endkey:ln([e,{}])};return a(t)});return d.all(l).then(ae).then(c)}var h={descending:t.descending};if(t.start_key&&(t.startkey=t.start_key),t.end_key&&(t.endkey=t.end_key),void 0!==t.startkey&&(h.startkey=t.descending?ln([t.startkey,{}]):ln([t.startkey])),void 0!==t.endkey){var p=!1!==t.inclusive_end;t.descending&&(p=!p),h.endkey=ln(p?[t.endkey,{}]:[t.endkey])}if(void 0!==t.key){var v=ln([t.key]),m=ln([t.key,{}]);h.descending?(h.endkey=v,h.startkey=m):(h.startkey=v,h.endkey=m)}return i||("number"==typeof t.limit&&(h.limit=t.limit),h.skip=o),a(h).then(c)}(e,t)})()}function k(t,r,i){if("http"===t.type())return function(e,t,r){var n,i=[],o="GET";if(l("reduce",r,i),l("include_docs",r,i),l("attachments",r,i),l("limit",r,i),l("descending",r,i),l("group",r,i),l("group_level",r,i),l("skip",r,i),l("stale",r,i),l("conflicts",r,i),l("startkey",r,i,!0),l("start_key",r,i,!0),l("endkey",r,i,!0),l("end_key",r,i,!0),l("inclusive_end",r,i),l("key",r,i,!0),i=""===(i=i.join("&"))?"":"?"+i,void 0!==r.keys){var s="keys="+encodeURIComponent(JSON.stringify(r.keys));s.length+i.length+1<=2e3?i+=("?"===i[0]?"&":"?")+s:(o="POST","string"==typeof t?n={keys:r.keys}:t.keys=r.keys)}if("string"==typeof t){var a=bn(t);return e.request({method:o,url:"_design/"+a[0]+"/_view/"+a[1]+i,body:n}).then(f(r))}return n=n||{},Object.keys(t).forEach(function(e){Array.isArray(t[e])?n[e]=t[e]:n[e]=t[e].toString()}),e.request({method:"POST",url:"_temp_view"+i,body:n}).then(f(r))}(t,r,i);if("function"==typeof t._query)return function(e,t,r){return new d(function(n,i){e._query(t,r,function(e,t){if(e)return i(e);n(t)})})}(t,r,i);if("string"!=typeof r)return p(i,r),yn.add(function(){return mn(t,"temp_view/temp_view",r.map,r.reduce,!0,e).then(function(e){return t=y(e).then(function(){return _(e,i)}),r=function(){return e.db.destroy()},t.then(function(e){return r().then(function(){return e})},function(e){return r().then(function(){throw e})});var t,r})}),yn.finish();var o=r,s=bn(o),a=s[0],u=s[1];return t.get("_design/"+a).then(function(r){var s=r.views&&r.views[u];if(!s)throw new Kr("ddoc "+r._id+" has no view named "+u);return n(r,u),p(i,s),mn(t,o,s.map,s.reduce,!1,e).then(function(e){return"ok"===i.stale||"update_after"===i.stale?("update_after"===i.stale&&c(function(){y(e)}),_(e,i)):y(e).then(function(){return _(e,i)})})})}var x;return{query:function(e,t,r){var n=this;"function"==typeof t&&(r=t,t={}),t=t?function(e){return e.group_level=h(e.group_level),e.limit=h(e.limit),e.skip=h(e.skip),e}(t):{},"function"==typeof e&&(e={map:e});var i=d.resolve().then(function(){return k(n,e,t)});return Vr(i,r),i},viewCleanup:(x=function(){var t=this;return"http"===t.type()?function(e){return e.request({method:"POST",url:"_view_cleanup"})}(t):"function"==typeof t._viewCleanup?function(e){return new d(function(t,r){e._viewCleanup(function(e,n){if(e)return r(e);t(n)})})}(t):function(t){return t.get("_local/"+e).then(function(e){var r=new w;Object.keys(e.views).forEach(function(e){var t=bn(e),n="_design/"+t[0],i=t[1],o=r.get(n);o||(o=new b,r.set(n,o)),o.add(i)});var n={keys:Xr(r),include_docs:!0};return t.allDocs(n).then(function(n){var i={};n.rows.forEach(function(t){var n=t.key.substring(8);r.get(t.key).forEach(function(r){var o=n+"/"+r;e.views[o]||(o=r);var s=Object.keys(e.views[o]),a=t.doc&&t.doc.views&&t.doc.views[r];s.forEach(function(e){i[e]=i[e]||a})})});var o=Object.keys(i).filter(function(e){return!i[e]}).map(function(e){return $r(g(e),function(){return new t.constructor(e,t.__opts).destroy()})()});return d.all(o).then(function(){return{ok:!0}})})},v({ok:!0}))}(t)},o(function(e){var t=e.pop(),r=x.apply(this,e);return"function"==typeof t&&Vr(r,t),r}))}}("mrviews",function(e,t){if("function"==typeof e&&2===e.length){var r=e;return function(e){return r(e,t)}}return nn(e.toString(),t)},function(e){return kn[e]?kn[e]:nn(e.toString())},function(e,t){var r=e.views&&e.views[t];if("string"!=typeof r.map)throw new Kr("ddoc "+e._id+" has no string view named "+t+", instead found object of type: "+typeof r.map)});var En={query:function(e,t,r){return xn.query.call(this,e,t,r)},viewCleanup:function(e){return xn.viewCleanup.call(this,e)}};function Sn(e){return/^1-/.test(e)}function Rn(e,t){var r=Object.keys(t._attachments);return d.all(r.map(function(r){return e.getAttachment(t._id,r,{rev:t._rev})}))}function jn(e,t,r,n){r=g(r);var i=[],o=!0;function s(t){return e.allDocs({keys:t,include_docs:!0,conflicts:!0}).then(function(e){if(n.cancelled)throw new Error("cancelled");e.rows.forEach(function(e){var t;e.deleted||!e.doc||!Sn(e.value.rev)||(t=e.doc,t._attachments&&Object.keys(t._attachments).length>0)||function(e){return e._conflicts&&e._conflicts.length>0}(e.doc)||(e.doc._conflicts&&delete e.doc._conflicts,i.push(e.doc),delete r[e.id])})})}return d.resolve().then(function(){var e=Object.keys(r).filter(function(e){var t=r[e].missing;return 1===t.length&&Sn(t[0])});if(e.length>0)return s(e)}).then(function(){var s=function(e){var t=[];return Object.keys(e).forEach(function(r){e[r].missing.forEach(function(e){t.push({id:r,rev:e})})}),{docs:t,revs:!0,latest:!0}}(r);if(s.docs.length)return e.bulkGet(s).then(function(r){if(n.cancelled)throw new Error("cancelled");return d.all(r.results.map(function(r){return d.all(r.docs.map(function(r){var n=r.ok;return r.error&&(o=!1),n&&n._attachments?function(e,t,r){var n="http"===t.type()&&"http"!==e.type(),i=Object.keys(r._attachments);return n?e.get(r._id).then(function(n){return d.all(i.map(function(i){return function(e,t,r){return!e._attachments||!e._attachments[r]||e._attachments[r].digest!==t._attachments[r].digest}(n,r,i)?t.getAttachment(r._id,i):e.getAttachment(n._id,i)}))}).catch(function(e){if(404!==e.status)throw e;return Rn(t,r)}):Rn(t,r)}(t,e,n).then(function(e){var t=Object.keys(n._attachments);return e.forEach(function(e,r){var i=n._attachments[t[r]];delete i.stub,delete i.length,i.data=e}),n}):n}))})).then(function(e){i=i.concat(ae(e).filter(Boolean))})})}).then(function(){return{ok:o,docs:i}})}var Tn=1,Dn="pouchdb",On=5,An=0;function Bn(e,t,r,n,i){return e.get(t).catch(function(r){if(404===r.status)return"http"===e.type()&&P(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:n,_id:t,history:[],replicator:Dn,version:Tn};throw r}).then(function(o){if(!i.cancelled&&o.last_seq!==r)return o.history=(o.history||[]).filter(function(e){return e.session_id!==n}),o.history.unshift({last_seq:r,session_id:n}),o.history=o.history.slice(0,On),o.version=Tn,o.replicator=Dn,o.session_id=n,o.last_seq=r,e.put(o).catch(function(o){if(409===o.status)return Bn(e,t,r,n,i);throw o})})}function Cn(e,t,r,n){this.src=e,this.target=t,this.id=r,this.returnValue=n}Cn.prototype.writeCheckpoint=function(e,t){var r=this;return this.updateTarget(e,t).then(function(){return r.updateSource(e,t)})},Cn.prototype.updateTarget=function(e,t){return Bn(this.target,this.id,e,t,this.returnValue)},Cn.prototype.updateSource=function(e,t){var r=this;return this.readOnlySource?d.resolve(!0):Bn(this.src,this.id,e,t,this.returnValue).catch(function(e){if(qn(e))return r.readOnlySource=!0,!0;throw e})};var Ln={undefined:function(e,t){return 0===un(e.last_seq,t.last_seq)?t.last_seq:0},1:function(e,t){return function(e,t){if(e.session_id===t.session_id)return{last_seq:e.last_seq,history:e.history};return function e(t,r){var n=t[0];var i=t.slice(1);var o=r[0];var s=r.slice(1);if(!n||0===r.length)return{last_seq:An,history:[]};var a=n.session_id;if(In(a,r))return{last_seq:n.last_seq,history:t};var u=o.session_id;if(In(u,i))return{last_seq:o.last_seq,history:s};return e(i,s)}(e.history,t.history)}(t,e).last_seq}};function In(e,t){var r=t[0],n=t.slice(1);return!(!e||0===t.length)&&(e===r.session_id||In(e,n))}function qn(e){return"number"==typeof e.status&&4===Math.floor(e.status/100)}Cn.prototype.getCheckpoint=function(){var e=this;return e.target.get(e.id).then(function(t){return e.readOnlySource?d.resolve(t.last_seq):e.src.get(e.id).then(function(e){return t.version!==e.version?An:(r=t.version?t.version.toString():"undefined")in Ln?Ln[r](t,e):An;var r},function(r){if(404===r.status&&t.last_seq)return e.src.put({_id:e.id,last_seq:An}).then(function(){return An},function(r){return qn(r)?(e.readOnlySource=!0,t.last_seq):An});throw r})}).catch(function(e){if(404!==e.status)throw e;return An})};var Nn=0;function Mn(e,t,r){var n=r.doc_ids?r.doc_ids.sort(un):"",i=r.filter?r.filter.toString():"",o="",s="";return r.filter&&r.query_params&&(o=JSON.stringify(function(e){return Object.keys(e).sort(un).reduce(function(t,r){return t[r]=e[r],t},{})}(r.query_params))),r.filter&&"_view"===r.filter&&(s=r.view.toString()),d.all([e.id(),t.id()]).then(function(e){var t=e[0]+e[1]+i+s+o+n;return new d(function(e){ht(t,e)})}).then(function(e){return"_local/"+(e=e.replace(/\//g,".").replace(/\+/g,"_"))})}function Pn(e,t,r,n,i){var o,s,a=[],u={seq:0,changes:[],docs:[]},c=!1,f=!1,l=!1,h=0,p=r.continuous||r.live||!1,v=r.batch_size||100,m=r.batches_limit||10,y=!1,_=r.doc_ids,b=[],w=_e();i=i||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var k={};function x(){return s?d.resolve():Mn(e,t,r).then(function(r){s=new Cn(e,t,r,n)})}function E(){if(b=[],0!==o.docs.length){var e=o.docs,s={timeout:r.timeout};return t.bulkDocs({docs:e,new_edits:!1},s).then(function(t){if(n.cancelled)throw O(),new Error("cancelled");var r=Object.create(null);t.forEach(function(e){e.error&&(r[e.id]=e)});var o=Object.keys(r).length;i.doc_write_failures+=o,i.docs_written+=e.length-o,e.forEach(function(e){var t=r[e._id];if(t){if(i.errors.push(t),"unauthorized"!==t.name&&"forbidden"!==t.name)throw t;n.emit("denied",g(t))}else b.push(e)})},function(t){throw i.doc_write_failures+=e.length,t})}}function S(){if(o.error)throw new Error("There was a problem getting docs.");i.last_seq=h=o.seq;var e=g(i);return b.length&&(e.docs=b,n.emit("change",e)),c=!0,s.writeCheckpoint(o.seq,w).then(function(){if(c=!1,n.cancelled)throw O(),new Error("cancelled");o=void 0,L()}).catch(function(e){throw q(e),e})}function R(){return jn(e,t,o.diffs,n).then(function(e){o.error=!e.ok,e.docs.forEach(function(e){delete o.diffs[e._id],i.docs_read++,o.docs.push(e)})})}function j(){var e;n.cancelled||o||(0!==a.length?(o=a.shift(),(e={},o.changes.forEach(function(t){"_user/"!==t.id&&(e[t.id]=t.changes.map(function(e){return e.rev}))}),t.revsDiff(e).then(function(e){if(n.cancelled)throw O(),new Error("cancelled");o.diffs=e})).then(R).then(E).then(S).then(j).catch(function(e){D("batch processing terminated with error",e)})):T(!0))}function T(e){0!==u.changes.length?(e||f||u.changes.length>=v)&&(a.push(u),u={seq:0,changes:[],docs:[]},"pending"!==n.state&&"stopped"!==n.state||(n.state="active",n.emit("active")),j()):0!==a.length||o||((p&&k.live||f)&&(n.state="pending",n.emit("paused")),f&&O())}function D(e,t){l||(t.message||(t.message=e),i.ok=!1,i.status="aborting",a=[],u={seq:0,changes:[],docs:[]},O(t))}function O(o){l||n.cancelled&&(i.status="cancelled",c)||(i.status=i.status||"complete",i.end_time=new Date,i.last_seq=h,l=!0,o?(o.result=i,"unauthorized"===o.name||"forbidden"===o.name?(n.emit("error",o),n.removeAllListeners()):function(e,t,r,n){if(!1===e.retry)return t.emit("error",r),void t.removeAllListeners();if("function"!=typeof e.back_off_function&&(e.back_off_function=M),t.emit("requestError",r),"active"===t.state||"pending"===t.state){t.emit("paused",r),t.state="stopped";var i=function(){e.current_back_off=Nn};t.once("paused",function(){t.removeListener("active",i)}),t.once("active",i)}e.current_back_off=e.current_back_off||Nn,e.current_back_off=e.back_off_function(e.current_back_off),setTimeout(n,e.current_back_off)}(r,n,o,function(){Pn(e,t,r,n)})):(n.emit("complete",i),n.removeAllListeners()))}function A(e){if(n.cancelled)return O();se(r)(e)&&(u.seq=e.seq,u.changes.push(e),T(0===a.length&&k.live))}function B(e){if(y=!1,n.cancelled)return O();if(e.results.length>0)k.since=e.last_seq,L(),T(!0);else{var t=function(){p?(k.live=!0,L()):f=!0,T(!0)};o||0!==e.results.length?t():(c=!0,s.writeCheckpoint(e.last_seq,w).then(function(){c=!1,i.last_seq=h=e.last_seq,t()}).catch(q))}}function C(e){if(y=!1,n.cancelled)return O();D("changes rejected",e)}function L(){if(!y&&!f&&a.length<m){y=!0,n._changes&&(n.removeListener("cancel",n._abortChanges),n._changes.cancel()),n.once("cancel",i);var t=e.changes(k).on("change",A);t.then(o,o),t.then(B).catch(C),r.retry&&(n._changes=t,n._abortChanges=i)}function i(){t.cancel()}function o(){n.removeListener("cancel",i)}}function I(){x().then(function(){if(!n.cancelled)return s.getCheckpoint().then(function(e){k={since:h=e,limit:v,batch_size:v,style:"all_docs",doc_ids:_,return_docs:!0},r.filter&&("string"!=typeof r.filter?k.include_docs=!0:k.filter=r.filter),"heartbeat"in r&&(k.heartbeat=r.heartbeat),"timeout"in r&&(k.timeout=r.timeout),r.query_params&&(k.query_params=r.query_params),r.view&&(k.view=r.view),L()});O()}).catch(function(e){D("getCheckpoint rejected with ",e)})}function q(e){c=!1,D("writeCheckpoint completed with error",e)}n.ready(e,t),n.cancelled?O():(n._addedListeners||(n.once("cancel",O),"function"==typeof r.complete&&(n.once("error",r.complete),n.once("complete",function(e){r.complete(null,e)})),n._addedListeners=!0),void 0===r.since?I():x().then(function(){return c=!0,s.writeCheckpoint(r.since,w)}).then(function(){c=!1,n.cancelled?O():(h=r.since,I())}).catch(q))}function Fn(){a.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var e=this,t=new d(function(t,r){e.once("complete",t),e.once("error",r)});e.then=function(e,r){return t.then(e,r)},e.catch=function(e){return t.catch(e)},e.catch(function(){})}function Un(e,t){var r=t.PouchConstructor;return"string"==typeof e?new r(e,t):e}function Gn(e,t,r,n){if("function"==typeof r&&(n=r,r={}),void 0===r&&(r={}),r.doc_ids&&!Array.isArray(r.doc_ids))throw ie(Y,"`doc_ids` filter parameter is not a list.");r.complete=n,(r=g(r)).continuous=r.continuous||r.live,r.retry="retry"in r&&r.retry,r.PouchConstructor=r.PouchConstructor||this;var i=new Fn(r);return Pn(Un(e,r),Un(t,r),r,i),i}function Wn(e,t,r,n){return"function"==typeof r&&(n=r,r={}),void 0===r&&(r={}),(r=g(r)).PouchConstructor=r.PouchConstructor||this,new zn(e=Un(e,r),t=Un(t,r),r,n)}function zn(e,t,r,n){var i=this;this.canceled=!1;var o=r.push?F({},r,r.push):r,s=r.pull?F({},r,r.pull):r;function a(e){i.emit("change",{direction:"pull",change:e})}function u(e){i.emit("change",{direction:"push",change:e})}function c(e){i.emit("denied",{direction:"push",doc:e})}function f(e){i.emit("denied",{direction:"pull",doc:e})}function l(){i.pushPaused=!0,i.pullPaused&&i.emit("paused")}function h(){i.pullPaused=!0,i.pushPaused&&i.emit("paused")}function p(){i.pushPaused=!1,i.pullPaused&&i.emit("active",{direction:"push"})}function v(){i.pullPaused=!1,i.pushPaused&&i.emit("active",{direction:"pull"})}this.push=Gn(e,t,o),this.pull=Gn(t,e,s),this.pushPaused=!0,this.pullPaused=!0;var m={};function g(e){return function(t,r){("change"===t&&(r===a||r===u)||"denied"===t&&(r===f||r===c)||"paused"===t&&(r===h||r===l)||"active"===t&&(r===v||r===p))&&(t in m||(m[t]={}),m[t][e]=!0,2===Object.keys(m[t]).length&&i.removeAllListeners(t))}}function y(e,t,r){-1==e.listeners(t).indexOf(r)&&e.on(t,r)}r.live&&(this.push.on("complete",i.pull.cancel.bind(i.pull)),this.pull.on("complete",i.push.cancel.bind(i.push))),this.on("newListener",function(e){"change"===e?(y(i.pull,"change",a),y(i.push,"change",u)):"denied"===e?(y(i.pull,"denied",f),y(i.push,"denied",c)):"active"===e?(y(i.pull,"active",v),y(i.push,"active",p)):"paused"===e&&(y(i.pull,"paused",h),y(i.push,"paused",l))}),this.on("removeListener",function(e){"change"===e?(i.pull.removeListener("change",a),i.push.removeListener("change",u)):"denied"===e?(i.pull.removeListener("denied",f),i.push.removeListener("denied",c)):"active"===e?(i.pull.removeListener("active",v),i.push.removeListener("active",p)):"paused"===e&&(i.pull.removeListener("paused",h),i.push.removeListener("paused",l))}),this.pull.on("removeListener",g("pull")),this.push.on("removeListener",g("push"));var _=d.all([this.push,this.pull]).then(function(e){var t={push:e[0],pull:e[1]};return i.emit("complete",t),n&&n(null,t),i.removeAllListeners(),t},function(e){if(i.cancel(),n?n(e):i.emit("error",e),i.removeAllListeners(),n)throw e});this.then=function(e,t){return _.then(e,t)},this.catch=function(e){return _.catch(e)}}u(Fn,a.EventEmitter),Fn.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},Fn.prototype.ready=function(e,t){var r=this;function n(){r.cancel()}r._readyCalled||(r._readyCalled=!0,e.once("destroyed",n),t.once("destroyed",n),r.once("complete",function(){e.removeListener("destroyed",n),t.removeListener("destroyed",n)}))},u(zn,a.EventEmitter),zn.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},He.plugin(function(e){e.adapter("idb",Vt,!0)}).plugin(function(e){e.adapter("websql",Rr,!0)}).plugin(function(e){e.adapter("http",zr,!1),e.adapter("https",zr,!1)}).plugin(En).plugin(function(e){e.replicate=Gn,e.sync=Wn,Object.defineProperty(e.prototype,"replicate",{get:function(){var e=this;return{from:function(t,r,n){return e.constructor.replicate(t,e,r,n)},to:function(t,r,n){return e.constructor.replicate(e,t,r,n)}}}}),e.prototype.sync=function(e,t,r){return this.constructor.sync(this,e,t,r)}}),t.exports=He}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,11:11,12:12,2:2,4:4,5:5,6:6,7:7}]},{},[13])(13)}),t.exports}(),pouchdbAdapterMem=function(){var e={},t={exports:e};return function(r){if("object"==typeof e&&void 0!==t)t.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pouchdbAdapterMemory=r()}}(function(){return function e(t,r,n){function i(s,a){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var f=r[s]={exports:{}};t[s][0].call(f.exports,function(e){var r=t[s][1][e];return i(r||e)},f,f.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){(function(e){function r(e){this._db=e,this._operations=[],this._written=!1}r.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},r.prototype.put=function(e,t){this._checkWritten();var r=this._db._checkKey(e,"key",this._db._isBuffer);if(r)throw r;return this._db._isBuffer(e)||(e=String(e)),this._db._isBuffer(t)||(t=String(t)),"function"==typeof this._put?this._put(e,t):this._operations.push({type:"put",key:e,value:t}),this},r.prototype.del=function(e){this._checkWritten();var t=this._db._checkKey(e,"key",this._db._isBuffer);if(t)throw t;return this._db._isBuffer(e)||(e=String(e)),"function"==typeof this._del?this._del(e):this._operations.push({type:"del",key:e}),this},r.prototype.clear=function(){return this._checkWritten(),this._operations=[],"function"==typeof this._clear&&this._clear(),this},r.prototype.write=function(t,r){if(this._checkWritten(),"function"==typeof t&&(r=t),"function"!=typeof r)throw new Error("write() requires a callback argument");return"object"!=typeof t&&(t={}),this._written=!0,"function"==typeof this._write?this._write(r):"function"==typeof this._db._batch?this._db._batch(this._operations,t,r):void e.nextTick(r)},t.exports=r}).call(this,e("_process"))},{_process:43}],2:[function(e,t,r){(function(e){function r(e){this.db=e,this._ended=!1,this._nexting=!1}r.prototype.next=function(t){var r=this;if("function"!=typeof t)throw new Error("next() requires a callback argument");return r._ended?t(new Error("cannot call next() after end()")):r._nexting?t(new Error("cannot call next() before previous next() has completed")):(r._nexting=!0,"function"==typeof r._next?r._next(function(){r._nexting=!1,t.apply(null,arguments)}):void e.nextTick(function(){r._nexting=!1,t()}))},r.prototype.end=function(t){if("function"!=typeof t)throw new Error("end() requires a callback argument");return this._ended?t(new Error("end() already called on iterator")):(this._ended=!0,"function"==typeof this._end?this._end(t):void e.nextTick(t))},t.exports=r}).call(this,e("_process"))},{_process:43}],3:[function(e,t,r){(function(r,n){var i=e("xtend"),o=e("./abstract-iterator"),s=e("./abstract-chained-batch");function a(e){if(!arguments.length||void 0===e)throw new Error("constructor requires at least a location argument");if("string"!=typeof e)throw new Error("constructor requires a location string argument");this.location=e,this.status="new"}a.prototype.open=function(e,t){var r=this,i=this.status;if("function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("open() requires a callback argument");"object"!=typeof e&&(e={}),e.createIfMissing=0!=e.createIfMissing,e.errorIfExists=!!e.errorIfExists,"function"==typeof this._open?(this.status="opening",this._open(e,function(e){if(e)return r.status=i,t(e);r.status="open",t()})):(this.status="open",n.nextTick(t))},a.prototype.close=function(e){var t=this,r=this.status;if("function"!=typeof e)throw new Error("close() requires a callback argument");"function"==typeof this._close?(this.status="closing",this._close(function(n){if(n)return t.status=r,e(n);t.status="closed",e()})):(this.status="closed",n.nextTick(e))},a.prototype.get=function(e,t,r){var i;if("function"==typeof t&&(r=t),"function"!=typeof r)throw new Error("get() requires a callback argument");return(i=this._checkKey(e,"key",this._isBuffer))?r(i):(this._isBuffer(e)||(e=String(e)),"object"!=typeof t&&(t={}),t.asBuffer=0!=t.asBuffer,"function"==typeof this._get?this._get(e,t,r):void n.nextTick(function(){r(new Error("NotFound"))}))},a.prototype.put=function(e,t,r,i){var o;if("function"==typeof r&&(i=r),"function"!=typeof i)throw new Error("put() requires a callback argument");return(o=this._checkKey(e,"key",this._isBuffer))?i(o):(this._isBuffer(e)||(e=String(e)),null==t||this._isBuffer(t)||n.browser||(t=String(t)),"object"!=typeof r&&(r={}),"function"==typeof this._put?this._put(e,t,r,i):void n.nextTick(i))},a.prototype.del=function(e,t,r){var i;if("function"==typeof t&&(r=t),"function"!=typeof r)throw new Error("del() requires a callback argument");return(i=this._checkKey(e,"key",this._isBuffer))?r(i):(this._isBuffer(e)||(e=String(e)),"object"!=typeof t&&(t={}),"function"==typeof this._del?this._del(e,t,r):void n.nextTick(r))},a.prototype.batch=function(e,t,r){if(!arguments.length)return this._chainedBatch();if("function"==typeof t&&(r=t),"function"==typeof e&&(r=e),"function"!=typeof r)throw new Error("batch(array) requires a callback argument");if(!Array.isArray(e))return r(new Error("batch(array) requires an array argument"));t&&"object"==typeof t||(t={});for(var i,o,s=0,a=e.length;s<a;s++)if("object"==typeof(i=e[s])){if(o=this._checkKey(i.type,"type",this._isBuffer))return r(o);if(o=this._checkKey(i.key,"key",this._isBuffer))return r(o)}if("function"==typeof this._batch)return this._batch(e,t,r);n.nextTick(r)},a.prototype.approximateSize=function(e,t,r){if(null==e||null==t||"function"==typeof e||"function"==typeof t)throw new Error("approximateSize() requires valid `start`, `end` and `callback` arguments");if("function"!=typeof r)throw new Error("approximateSize() requires a callback argument");if(this._isBuffer(e)||(e=String(e)),this._isBuffer(t)||(t=String(t)),"function"==typeof this._approximateSize)return this._approximateSize(e,t,r);n.nextTick(function(){r(null,0)})},a.prototype._setupIteratorOptions=function(e){var t=this;return e=i(e),["start","end","gt","gte","lt","lte"].forEach(function(r){e[r]&&t._isBuffer(e[r])&&0===e[r].length&&delete e[r]}),e.reverse=!!e.reverse,e.keys=0!=e.keys,e.values=0!=e.values,e.limit="limit"in e?e.limit:-1,e.keyAsBuffer=0!=e.keyAsBuffer,e.valueAsBuffer=0!=e.valueAsBuffer,e},a.prototype.iterator=function(e){return"object"!=typeof e&&(e={}),e=this._setupIteratorOptions(e),"function"==typeof this._iterator?this._iterator(e):new o(this)},a.prototype._chainedBatch=function(){return new s(this)},a.prototype._isBuffer=function(e){return r.isBuffer(e)},a.prototype._checkKey=function(e,t){if(null===e||void 0===e)return new Error(t+" cannot be `null` or `undefined`");if(this._isBuffer(e)){if(0===e.length)return new Error(t+" cannot be an empty Buffer")}else if(""===String(e))return new Error(t+" cannot be an empty String")},t.exports=a}).call(this,{isBuffer:e("../../is-buffer/1.1.0/index.js")},e("_process"))},{"../../is-buffer/1.1.0/index.js":26,"./abstract-chained-batch":1,"./abstract-iterator":2,_process:43,xtend:142}],4:[function(e,t,r){r.AbstractLevelDOWN=e("./abstract-leveldown"),r.AbstractIterator=e("./abstract-iterator"),r.AbstractChainedBatch=e("./abstract-chained-batch"),r.isLevelDOWN=e("./is-leveldown")},{"./abstract-chained-batch":1,"./abstract-iterator":2,"./abstract-leveldown":3,"./is-leveldown":5}],5:[function(e,t,r){var n=e("./abstract-leveldown");t.exports=function(e){return!(!e||"object"!=typeof e)&&Object.keys(n.prototype).filter(function(e){return"_"!=e[0]&&"approximateSize"!=e}).every(function(t){return"function"==typeof e[t]})}},{"./abstract-leveldown":3}],6:[function(e,t,r){!function(e){"use strict";var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="undefined"!=typeof Uint8Array?Uint8Array:Array,n="+".charCodeAt(0),i="/".charCodeAt(0),o="0".charCodeAt(0),s="a".charCodeAt(0),a="A".charCodeAt(0),u="-".charCodeAt(0),c="_".charCodeAt(0);function f(e){var t=e.charCodeAt(0);return t===n||t===u?62:t===i||t===c?63:t<o?-1:t<o+10?t-o+26+26:t<a+26?t-a:t<s+26?t-s+26:void 0}e.toByteArray=function(e){var t,n,i,o,s,a;if(e.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var u=e.length;s="="===e.charAt(u-2)?2:"="===e.charAt(u-1)?1:0,a=new r(3*e.length/4-s),i=s>0?e.length-4:e.length;var c=0;function l(e){a[c++]=e}for(t=0,n=0;t<i;t+=4,n+=3)l((16711680&(o=f(e.charAt(t))<<18|f(e.charAt(t+1))<<12|f(e.charAt(t+2))<<6|f(e.charAt(t+3))))>>16),l((65280&o)>>8),l(255&o);return 2===s?l(255&(o=f(e.charAt(t))<<2|f(e.charAt(t+1))>>4)):1===s&&(l((o=f(e.charAt(t))<<10|f(e.charAt(t+1))<<4|f(e.charAt(t+2))>>2)>>8&255),l(255&o)),a},e.fromByteArray=function(e){var r,n,i,o,s=e.length%3,a="";function u(e){return t.charAt(e)}for(r=0,i=e.length-s;r<i;r+=3)n=(e[r]<<16)+(e[r+1]<<8)+e[r+2],a+=u((o=n)>>18&63)+u(o>>12&63)+u(o>>6&63)+u(63&o);switch(s){case 1:a+=u((n=e[e.length-1])>>2),a+=u(n<<4&63),a+="==";break;case 2:a+=u((n=(e[e.length-2]<<8)+e[e.length-1])>>10),a+=u(n>>4&63),a+=u(n<<2&63),a+="="}return a}}(void 0===r?this.base64js={}:r)},{}],7:[function(e,t,r){},{}],8:[function(e,t,r){"use strict";var n=e("base64-js"),i=e("ieee754");r.Buffer=a,r.SlowBuffer=function(e){+e!=e&&(e=0);return a.alloc(+e)},r.INSPECT_MAX_BYTES=50;var o=2147483647;function s(e){if(e>o)throw new RangeError("Invalid typed array length");var t=new Uint8Array(e);return t.__proto__=a.prototype,t}function a(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return f(e)}return u(e,t,r)}function u(e,t,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(e,t,r){if(e.byteLength,t<0||e.byteLength<t)throw new RangeError("'offset' is out of bounds");if(e.byteLength<t+(r||0))throw new RangeError("'length' is out of bounds");var n;n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r);return n.__proto__=a.prototype,n}(e,t,r):"string"==typeof e?function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!a.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');var r=0|d(e,t),n=s(r),i=n.write(e,t);i!==r&&(n=n.slice(0,i));return n}(e,t):function(e){if(a.isBuffer(e)){var t=0|h(e.length),r=s(t);return 0===r.length?r:(e.copy(r,0,0,t),r)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(n=e.length)!=n?s(0):l(e);if("Buffer"===e.type&&Array.isArray(e.data))return l(e.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function f(e){return c(e),s(e<0?0:0|h(e))}function l(e){for(var t=e.length<0?0:0|h(e.length),r=s(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function h(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function d(e,t){if(a.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return N(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return M(e).length;default:if(n)return N(e).length;t=(""+t).toLowerCase(),n=!0}}function p(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function v(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=a.from(t,n)),a.isBuffer(t))return 0===t.length?-1:m(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):m(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function m(e,t,r,n,i){var o,s=1,a=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,r/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var f=-1;for(o=r;o<a;o++)if(c(e,o)===c(t,-1===f?0:o-f)){if(-1===f&&(f=o),o-f+1===u)return f*s}else-1!==f&&(o-=o-f),f=-1}else for(r+u>a&&(r=a-u),o=r;o>=0;o--){for(var l=!0,h=0;h<u;h++)if(c(e,o+h)!==c(t,h)){l=!1;break}if(l)return o}return-1}function g(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[r+s]=a}return s}function y(e,t,r,n){return P(N(t,e.length-r),e,r,n)}function _(e,t,r,n){return P(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function b(e,t,r,n){return _(e,t,r,n)}function w(e,t,r,n){return P(M(t),e,r,n)}function k(e,t,r,n){return P(function(e,t){for(var r,n,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function x(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function E(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,s,a,u,c=e[i],f=null,l=c>239?4:c>223?3:c>191?2:1;if(i+l<=r)switch(l){case 1:c<128&&(f=c);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&c)<<6|63&o)>127&&(f=u);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(u=(15&c)<<12|(63&o)<<6|63&s)>2047&&(u<55296||u>57343)&&(f=u);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&u<1114112&&(f=u)}null===f?(f=65533,l=1):f>65535&&(f-=65536,n.push(f>>>10&1023|55296),f=56320|1023&f),n.push(f),i+=l}return function(e){var t=e.length;if(t<=S)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=S));return r}(n)}r.kMaxLength=o,a.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),a.TYPED_ARRAY_SUPPORT||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),"undefined"!=typeof Symbol&&Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),a.poolSize=8192,a.from=function(e,t,r){return u(e,t,r)},a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,a.alloc=function(e,t,r){return function(e,t,r){return c(e),e<=0?s(e):void 0!==t?"string"==typeof r?s(e).fill(t,r):s(e).fill(t):s(e)}(e,t,r)},a.allocUnsafe=function(e){return f(e)},a.allocUnsafeSlow=function(e){return f(e)},a.isBuffer=function(e){return!(null==e||!e._isBuffer)},a.compare=function(e,t){if(!a.isBuffer(e)||!a.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=a.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(!a.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},a.byteLength=d,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},a.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?E(this,0,e):function(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return T(this,t,r);case"utf8":case"utf-8":return E(this,t,r);case"ascii":return R(this,t,r);case"latin1":case"binary":return j(this,t,r);case"base64":return x(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},a.prototype.equals=function(e){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",t=r.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},a.prototype.compare=function(e,t,r,n,i){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var o=i-n,s=r-t,u=Math.min(o,s),c=this.slice(n,i),f=e.slice(t,r),l=0;l<u;++l)if(c[l]!==f[l]){o=c[l],s=f[l];break}return o<s?-1:s<o?1:0},a.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},a.prototype.indexOf=function(e,t,r){return v(this,e,t,r,!0)},a.prototype.lastIndexOf=function(e,t,r){return v(this,e,t,r,!1)},a.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return g(this,e,t,r);case"utf8":case"utf-8":return y(this,e,t,r);case"ascii":return _(this,e,t,r);case"latin1":case"binary":return b(this,e,t,r);case"base64":return w(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function R(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function j(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function T(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=q(e[o]);return i}function D(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function O(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function A(e,t,r,n,i,o){if(!a.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function B(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function C(e,t,r,n,o){return t=+t,r>>>=0,o||B(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function L(e,t,r,n,o){return t=+t,r>>>=0,o||B(e,0,r,8),i.write(e,t,r,n,52,8),r+8}a.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return n.__proto__=a.prototype,n},a.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},a.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},a.prototype.readUInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),this[e]},a.prototype.readUInt16LE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUInt16BE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},a.prototype.readUInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},a.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},a.prototype.readInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},a.prototype.readInt16LE=function(e,t){e>>>=0,t||O(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},a.prototype.readInt16BE=function(e,t){e>>>=0,t||O(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},a.prototype.readInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return e>>>=0,t||O(e,4,this.length),i.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return e>>>=0,t||O(e,4,this.length),i.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return e>>>=0,t||O(e,8,this.length),i.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return e>>>=0,t||O(e,8,this.length),i.read(this,e,!1,52,8)},a.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||A(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},a.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||A(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},a.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||A(this,e,t,1,255,0),this[t]=255&e,t+1},a.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||A(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||A(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||A(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},a.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||A(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);A(this,e,t,r,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<r&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},a.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);A(this,e,t,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},a.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||A(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||A(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||A(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||A(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},a.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||A(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeFloatLE=function(e,t,r){return C(this,e,t,!0,r)},a.prototype.writeFloatBE=function(e,t,r){return C(this,e,t,!1,r)},a.prototype.writeDoubleLE=function(e,t,r){return L(this,e,t,!0,r)},a.prototype.writeDoubleBE=function(e,t,r){return L(this,e,t,!1,r)},a.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,o=n-r;if(this===e&&r<t&&t<n)for(i=o-1;i>=0;--i)e[i+t]=this[i+r];else if(o<1e3)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},a.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!a.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var s=a.isBuffer(e)?e:new a(e,n),u=s.length;for(o=0;o<r-t;++o)this[o+t]=s[o%u]}return this};var I=/[^+/0-9A-Za-z-_]/g;function q(e){return e<16?"0"+e.toString(16):e.toString(16)}function N(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function M(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(I,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function P(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}},{"base64-js":6,ieee754:18}],9:[function(e,t,r){(function(r){var n=e("sha.js"),i=s(e("./md5")),o=s(e("ripemd160"));function s(e){return function(){var t=[];return{update:function(e,n){return r.isBuffer(e)||(e=new r(e,n)),t.push(e),this},digest:function(n){var i=r.concat(t),o=e(i);return t=null,n?o.toString(n):o}}}}t.exports=function(e){return"md5"===e?new i:"rmd160"===e?new o:n(e)}}).call(this,e("buffer").Buffer)},{"./md5":13,buffer:8,ripemd160:44,"sha.js":46}],10:[function(e,t,r){(function(r){var n=e("./create-hash"),i=64,o=new r(i);function s(e,t){if(!(this instanceof s))return new s(e,t);this._opad=u,this._alg=e,(t=this._key=r.isBuffer(t)?t:new r(t)).length>i?t=n(e).update(t).digest():t.length<i&&(t=r.concat([t,o],i));for(var a=this._ipad=new r(i),u=this._opad=new r(i),c=0;c<i;c++)a[c]=54^t[c],u[c]=92^t[c];this._hash=n(e).update(a)}o.fill(0),t.exports=s,s.prototype.update=function(e,t){return this._hash.update(e,t),this},s.prototype.digest=function(e){var t=this._hash.digest();return n(this._alg).update(this._opad).update(t).digest(e)}}).call(this,e("buffer").Buffer)},{"./create-hash":9,buffer:8}],11:[function(e,t,r){(function(e){var r=4,n=new e(r);n.fill(0);var i=8;t.exports={hash:function(t,o,s,a){return e.isBuffer(t)||(t=new e(t)),function(t,r,n){for(var i=new e(r),o=n?i.writeInt32BE:i.writeInt32LE,s=0;s<t.length;s++)o.call(i,t[s],4*s,!0);return i}(o(function(t,i){if(t.length%r!=0){var o=t.length+(r-t.length%r);t=e.concat([t,n],o)}for(var s=[],a=i?t.readInt32BE:t.readInt32LE,u=0;u<t.length;u+=r)s.push(a.call(t,u));return s}(t,a),t.length*i),s,a)}}}).call(this,e("buffer").Buffer)},{buffer:8}],12:[function(e,t,r){(function(t){var n=e("./rng");r.createHash=e("./create-hash"),r.createHmac=e("./create-hmac"),r.randomBytes=function(e,r){if(!r||!r.call)return new t(n(e));try{r.call(this,void 0,new t(n(e)))}catch(e){r(e)}},r.getHashes=function(){return["sha1","sha256","md5","rmd160"]};var i=e("./pbkdf2")(r.createHmac);r.pbkdf2=i.pbkdf2,r.pbkdf2Sync=i.pbkdf2Sync,function(e,t){for(var r in e)t(e[r],r)}(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman"],function(e){r[e]=function(){!function(){var e=[].slice.call(arguments).join(" ");throw new Error([e,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join("\n"))}("sorry,",e,"is not implemented yet")}})}).call(this,e("buffer").Buffer)},{"./create-hash":9,"./create-hmac":10,"./pbkdf2":14,"./rng":15,buffer:8}],13:[function(e,t,r){var n=e("./helpers");function i(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var r=1732584193,n=-271733879,i=-1732584194,o=271733878,l=0;l<e.length;l+=16){var h=r,d=n,p=i,v=o;n=c(n=c(n=c(n=c(n=u(n=u(n=u(n=u(n=a(n=a(n=a(n=a(n=s(n=s(n=s(n=s(n,i=s(i,o=s(o,r=s(r,n,i,o,e[l+0],7,-680876936),n,i,e[l+1],12,-389564586),r,n,e[l+2],17,606105819),o,r,e[l+3],22,-1044525330),i=s(i,o=s(o,r=s(r,n,i,o,e[l+4],7,-176418897),n,i,e[l+5],12,1200080426),r,n,e[l+6],17,-1473231341),o,r,e[l+7],22,-45705983),i=s(i,o=s(o,r=s(r,n,i,o,e[l+8],7,1770035416),n,i,e[l+9],12,-1958414417),r,n,e[l+10],17,-42063),o,r,e[l+11],22,-1990404162),i=s(i,o=s(o,r=s(r,n,i,o,e[l+12],7,1804603682),n,i,e[l+13],12,-40341101),r,n,e[l+14],17,-1502002290),o,r,e[l+15],22,1236535329),i=a(i,o=a(o,r=a(r,n,i,o,e[l+1],5,-165796510),n,i,e[l+6],9,-1069501632),r,n,e[l+11],14,643717713),o,r,e[l+0],20,-373897302),i=a(i,o=a(o,r=a(r,n,i,o,e[l+5],5,-701558691),n,i,e[l+10],9,38016083),r,n,e[l+15],14,-660478335),o,r,e[l+4],20,-405537848),i=a(i,o=a(o,r=a(r,n,i,o,e[l+9],5,568446438),n,i,e[l+14],9,-1019803690),r,n,e[l+3],14,-187363961),o,r,e[l+8],20,1163531501),i=a(i,o=a(o,r=a(r,n,i,o,e[l+13],5,-1444681467),n,i,e[l+2],9,-51403784),r,n,e[l+7],14,1735328473),o,r,e[l+12],20,-1926607734),i=u(i,o=u(o,r=u(r,n,i,o,e[l+5],4,-378558),n,i,e[l+8],11,-2022574463),r,n,e[l+11],16,1839030562),o,r,e[l+14],23,-35309556),i=u(i,o=u(o,r=u(r,n,i,o,e[l+1],4,-1530992060),n,i,e[l+4],11,1272893353),r,n,e[l+7],16,-155497632),o,r,e[l+10],23,-1094730640),i=u(i,o=u(o,r=u(r,n,i,o,e[l+13],4,681279174),n,i,e[l+0],11,-358537222),r,n,e[l+3],16,-722521979),o,r,e[l+6],23,76029189),i=u(i,o=u(o,r=u(r,n,i,o,e[l+9],4,-640364487),n,i,e[l+12],11,-421815835),r,n,e[l+15],16,530742520),o,r,e[l+2],23,-995338651),i=c(i,o=c(o,r=c(r,n,i,o,e[l+0],6,-198630844),n,i,e[l+7],10,1126891415),r,n,e[l+14],15,-1416354905),o,r,e[l+5],21,-57434055),i=c(i,o=c(o,r=c(r,n,i,o,e[l+12],6,1700485571),n,i,e[l+3],10,-1894986606),r,n,e[l+10],15,-1051523),o,r,e[l+1],21,-2054922799),i=c(i,o=c(o,r=c(r,n,i,o,e[l+8],6,1873313359),n,i,e[l+15],10,-30611744),r,n,e[l+6],15,-1560198380),o,r,e[l+13],21,1309151649),i=c(i,o=c(o,r=c(r,n,i,o,e[l+4],6,-145523070),n,i,e[l+11],10,-1120210379),r,n,e[l+2],15,718787259),o,r,e[l+9],21,-343485551),r=f(r,h),n=f(n,d),i=f(i,p),o=f(o,v)}return Array(r,n,i,o)}function o(e,t,r,n,i,o){return f((s=f(f(t,e),f(n,o)))<<(a=i)|s>>>32-a,r);var s,a}function s(e,t,r,n,i,s,a){return o(t&r|~t&n,e,t,i,s,a)}function a(e,t,r,n,i,s,a){return o(t&n|r&~n,e,t,i,s,a)}function u(e,t,r,n,i,s,a){return o(t^r^n,e,t,i,s,a)}function c(e,t,r,n,i,s,a){return o(r^(t|~n),e,t,i,s,a)}function f(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}t.exports=function(e){return n.hash(e,i,16)}},{"./helpers":11}],14:[function(e,t,r){(function(e){var r=new e(64);r.fill(0),t.exports=function(t,n){return(n=n||{}).pbkdf2=function(e,t,r,i,o){if("function"!=typeof o)throw new Error("No callback provided to pbkdf2");setTimeout(function(){o(null,n.pbkdf2Sync(e,t,r,i))})},n.pbkdf2Sync=function(n,i,o,s){if("number"!=typeof o)throw new TypeError("Iterations not a number");if(o<0)throw new TypeError("Bad iterations");if("number"!=typeof s)throw new TypeError("Key length not a number");if(s<0)throw new TypeError("Bad key length");var a;(n=e.isBuffer(n)?n:new e(n)).length>64?n=createHash(alg).update(n).digest():n.length<64&&(n=e.concat([n,r],64));var u,c,f=0,l=1,h=new e(4),d=new e(s);for(d.fill(0);s;){u=s>20?20:s,h[0]=l>>24&255,h[1]=l>>16&255,h[2]=l>>8&255,h[3]=255&l,(a=t("sha1",n)).update(i),a.update(h),(c=a.digest()).copy(d,f,0,u);for(var p=1;p<o;p++){(a=t("sha1",n)).update(c),c=a.digest();for(var v=0;v<u;v++)d[v]^=c[v]}s-=u,l++,f+=u}return d},n}}).call(this,e("buffer").Buffer)},{buffer:8}],15:[function(e,t,r){(function(e){t.exports=function(t){var r=new e(t);return crypto.getRandomValues(r),r}}).call(this,e("buffer").Buffer)},{buffer:8}],16:[function(e,t,r){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,r,n,a,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(s(r=this._events[e]))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),r.apply(this,a)}else if(o(r))for(a=Array.prototype.slice.call(arguments,1),n=(c=r.slice()).length,u=0;u<n;u++)c[u].apply(this,a);return!0},n.prototype.addListener=function(e,t){var r;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(r=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var r=!1;function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var r,n,s,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=(r=this._events[e]).length,n=-1,r===t||i(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(r)){for(a=s;a-- >0;)if(r[a]===t||r[a].listener&&r[a].listener===t){n=a;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],17:[function(e,t,r){"use strict";t.exports=function(e){return new c(e||p,null)};var n=0,i=1;function o(e,t,r,n,i,o){this._color=e,this.key=t,this.value=r,this.left=n,this.right=i,this._count=o}function s(e){return new o(e._color,e.key,e.value,e.left,e.right,e._count)}function a(e,t){return new o(e,t.key,t.value,t.left,t.right,t._count)}function u(e){e._count=1+(e.left?e.left._count:0)+(e.right?e.right._count:0)}function c(e,t){this._compare=e,this.root=t}var f=c.prototype;function l(e,t){this.tree=e,this._stack=t}Object.defineProperty(f,"keys",{get:function(){var e=[];return this.forEach(function(t,r){e.push(t)}),e}}),Object.defineProperty(f,"values",{get:function(){var e=[];return this.forEach(function(t,r){e.push(r)}),e}}),Object.defineProperty(f,"length",{get:function(){return this.root?this.root._count:0}}),f.insert=function(e,t){for(var r=this._compare,s=this.root,f=[],l=[];s;){var h=r(e,s.key);f.push(s),l.push(h),s=h<=0?s.left:s.right}f.push(new o(n,e,t,null,null,1));for(var d=f.length-2;d>=0;--d){s=f[d];l[d]<=0?f[d]=new o(s._color,s.key,s.value,f[d+1],s.right,s._count+1):f[d]=new o(s._color,s.key,s.value,s.left,f[d+1],s._count+1)}for(d=f.length-1;d>1;--d){var p=f[d-1];s=f[d];if(p._color===i||s._color===i)break;var v=f[d-2];if(v.left===p)if(p.left===s){if(!(m=v.right)||m._color!==n){if(v._color=n,v.left=p.right,p._color=i,p.right=v,f[d-2]=p,f[d-1]=s,u(v),u(p),d>=3)(g=f[d-3]).left===v?g.left=p:g.right=p;break}p._color=i,v.right=a(i,m),v._color=n,d-=1}else{if(!(m=v.right)||m._color!==n){if(p.right=s.left,v._color=n,v.left=s.right,s._color=i,s.left=p,s.right=v,f[d-2]=s,f[d-1]=p,u(v),u(p),u(s),d>=3)(g=f[d-3]).left===v?g.left=s:g.right=s;break}p._color=i,v.right=a(i,m),v._color=n,d-=1}else if(p.right===s){if(!(m=v.left)||m._color!==n){if(v._color=n,v.right=p.left,p._color=i,p.left=v,f[d-2]=p,f[d-1]=s,u(v),u(p),d>=3)(g=f[d-3]).right===v?g.right=p:g.left=p;break}p._color=i,v.left=a(i,m),v._color=n,d-=1}else{var m;if(!(m=v.left)||m._color!==n){var g;if(p.left=s.right,v._color=n,v.right=s.left,s._color=i,s.right=p,s.left=v,f[d-2]=s,f[d-1]=p,u(v),u(p),u(s),d>=3)(g=f[d-3]).right===v?g.right=s:g.left=s;break}p._color=i,v.left=a(i,m),v._color=n,d-=1}}return f[0]._color=i,new c(r,f[0])},f.forEach=function(e,t,r){if(this.root)switch(arguments.length){case 1:return function e(t,r){var n;if(r.left&&(n=e(t,r.left)))return n;return(n=t(r.key,r.value))||(r.right?e(t,r.right):void 0)}(e,this.root);case 2:return function e(t,r,n,i){if(r(t,i.key)<=0){var o;if(i.left&&(o=e(t,r,n,i.left)))return o;if(o=n(i.key,i.value))return o}if(i.right)return e(t,r,n,i.right)}(t,this._compare,e,this.root);case 3:if(this._compare(t,r)>=0)return;return function e(t,r,n,i,o){var s,a=n(t,o.key),u=n(r,o.key);if(a<=0){if(o.left&&(s=e(t,r,n,i,o.left)))return s;if(u>0&&(s=i(o.key,o.value)))return s}if(u>0&&o.right)return e(t,r,n,i,o.right)}(t,r,this._compare,e,this.root)}},Object.defineProperty(f,"begin",{get:function(){for(var e=[],t=this.root;t;)e.push(t),t=t.left;return new l(this,e)}}),Object.defineProperty(f,"end",{get:function(){for(var e=[],t=this.root;t;)e.push(t),t=t.right;return new l(this,e)}}),f.at=function(e){if(e<0)return new l(this,[]);for(var t=this.root,r=[];;){if(r.push(t),t.left){if(e<t.left._count){t=t.left;continue}e-=t.left._count}if(!e)return new l(this,r);if(e-=1,!t.right)break;if(e>=t.right._count)break;t=t.right}return new l(this,[])},f.ge=function(e){for(var t=this._compare,r=this.root,n=[],i=0;r;){var o=t(e,r.key);n.push(r),o<=0&&(i=n.length),r=o<=0?r.left:r.right}return n.length=i,new l(this,n)},f.gt=function(e){for(var t=this._compare,r=this.root,n=[],i=0;r;){var o=t(e,r.key);n.push(r),o<0&&(i=n.length),r=o<0?r.left:r.right}return n.length=i,new l(this,n)},f.lt=function(e){for(var t=this._compare,r=this.root,n=[],i=0;r;){var o=t(e,r.key);n.push(r),o>0&&(i=n.length),r=o<=0?r.left:r.right}return n.length=i,new l(this,n)},f.le=function(e){for(var t=this._compare,r=this.root,n=[],i=0;r;){var o=t(e,r.key);n.push(r),o>=0&&(i=n.length),r=o<0?r.left:r.right}return n.length=i,new l(this,n)},f.find=function(e){for(var t=this._compare,r=this.root,n=[];r;){var i=t(e,r.key);if(n.push(r),0===i)return new l(this,n);r=i<=0?r.left:r.right}return new l(this,[])},f.remove=function(e){var t=this.find(e);return t?t.remove():this},f.get=function(e){for(var t=this._compare,r=this.root;r;){var n=t(e,r.key);if(0===n)return r.value;r=n<=0?r.left:r.right}};var h=l.prototype;function d(e,t){e.key=t.key,e.value=t.value,e.left=t.left,e.right=t.right,e._color=t._color,e._count=t._count}function p(e,t){return e<t?-1:e>t?1:0}Object.defineProperty(h,"valid",{get:function(){return this._stack.length>0}}),Object.defineProperty(h,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0}),h.clone=function(){return new l(this.tree,this._stack.slice())},h.remove=function(){var e=this._stack;if(0===e.length)return this.tree;var t=new Array(e.length),r=e[e.length-1];t[t.length-1]=new o(r._color,r.key,r.value,r.left,r.right,r._count);for(var f=e.length-2;f>=0;--f){(r=e[f]).left===e[f+1]?t[f]=new o(r._color,r.key,r.value,t[f+1],r.right,r._count):t[f]=new o(r._color,r.key,r.value,r.left,t[f+1],r._count)}if((r=t[t.length-1]).left&&r.right){var l=t.length;for(r=r.left;r.right;)t.push(r),r=r.right;var h=t[l-1];t.push(new o(r._color,h.key,h.value,r.left,r.right,r._count)),t[l-1].key=r.key,t[l-1].value=r.value;for(f=t.length-2;f>=l;--f)r=t[f],t[f]=new o(r._color,r.key,r.value,r.left,t[f+1],r._count);t[l-1].left=t[l]}if((r=t[t.length-1])._color===n){var p=t[t.length-2];p.left===r?p.left=null:p.right===r&&(p.right=null),t.pop();for(f=0;f<t.length;++f)t[f]._count--;return new c(this.tree._compare,t[0])}if(r.left||r.right){r.left?d(r,r.left):r.right&&d(r,r.right),r._color=i;for(f=0;f<t.length-1;++f)t[f]._count--;return new c(this.tree._compare,t[0])}if(1===t.length)return new c(this.tree._compare,null);for(f=0;f<t.length;++f)t[f]._count--;var v=t[t.length-2];return function(e){for(var t,r,o,c,f=e.length-1;f>=0;--f){if(t=e[f],0===f)return void(t._color=i);if((r=e[f-1]).left===t){if((o=r.right).right&&o.right._color===n)return c=(o=r.right=s(o)).right=s(o.right),r.right=o.left,o.left=r,o.right=c,o._color=r._color,t._color=i,r._color=i,c._color=i,u(r),u(o),f>1&&((l=e[f-2]).left===r?l.left=o:l.right=o),void(e[f-1]=o);if(o.left&&o.left._color===n)return c=(o=r.right=s(o)).left=s(o.left),r.right=c.left,o.left=c.right,c.left=r,c.right=o,c._color=r._color,r._color=i,o._color=i,t._color=i,u(r),u(o),u(c),f>1&&((l=e[f-2]).left===r?l.left=c:l.right=c),void(e[f-1]=c);if(o._color===i){if(r._color===n)return r._color=i,void(r.right=a(n,o));r.right=a(n,o);continue}o=s(o),r.right=o.left,o.left=r,o._color=r._color,r._color=n,u(r),u(o),f>1&&((l=e[f-2]).left===r?l.left=o:l.right=o),e[f-1]=o,e[f]=r,f+1<e.length?e[f+1]=t:e.push(t),f+=2}else{if((o=r.left).left&&o.left._color===n)return c=(o=r.left=s(o)).left=s(o.left),r.left=o.right,o.right=r,o.left=c,o._color=r._color,t._color=i,r._color=i,c._color=i,u(r),u(o),f>1&&((l=e[f-2]).right===r?l.right=o:l.left=o),void(e[f-1]=o);if(o.right&&o.right._color===n)return c=(o=r.left=s(o)).right=s(o.right),r.left=c.right,o.right=c.left,c.right=r,c.left=o,c._color=r._color,r._color=i,o._color=i,t._color=i,u(r),u(o),u(c),f>1&&((l=e[f-2]).right===r?l.right=c:l.left=c),void(e[f-1]=c);if(o._color===i){if(r._color===n)return r._color=i,void(r.left=a(n,o));r.left=a(n,o);continue}var l;o=s(o),r.left=o.right,o.right=r,o._color=r._color,r._color=n,u(r),u(o),f>1&&((l=e[f-2]).right===r?l.right=o:l.left=o),e[f-1]=o,e[f]=r,f+1<e.length?e[f+1]=t:e.push(t),f+=2}}}(t),v.left===r?v.left=null:v.right=null,new c(this.tree._compare,t[0])},Object.defineProperty(h,"key",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].key},enumerable:!0}),Object.defineProperty(h,"value",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].value},enumerable:!0}),Object.defineProperty(h,"index",{get:function(){var e=0,t=this._stack;if(0===t.length){var r=this.tree.root;return r?r._count:0}t[t.length-1].left&&(e=t[t.length-1].left._count);for(var n=t.length-2;n>=0;--n)t[n+1]===t[n].right&&(++e,t[n].left&&(e+=t[n].left._count));return e},enumerable:!0}),h.next=function(){var e=this._stack;if(0!==e.length){var t=e[e.length-1];if(t.right)for(t=t.right;t;)e.push(t),t=t.left;else for(e.pop();e.length>0&&e[e.length-1].right===t;)t=e[e.length-1],e.pop()}},Object.defineProperty(h,"hasNext",{get:function(){var e=this._stack;if(0===e.length)return!1;if(e[e.length-1].right)return!0;for(var t=e.length-1;t>0;--t)if(e[t-1].left===e[t])return!0;return!1}}),h.update=function(e){var t=this._stack;if(0===t.length)throw new Error("Can't update empty node!");var r=new Array(t.length),n=t[t.length-1];r[r.length-1]=new o(n._color,n.key,e,n.left,n.right,n._count);for(var i=t.length-2;i>=0;--i)(n=t[i]).left===t[i+1]?r[i]=new o(n._color,n.key,n.value,r[i+1],n.right,n._count):r[i]=new o(n._color,n.key,n.value,n.left,r[i+1],n._count);return new c(this.tree._compare,r[0])},h.prev=function(){var e=this._stack;if(0!==e.length){var t=e[e.length-1];if(t.left)for(t=t.left;t;)e.push(t),t=t.right;else for(e.pop();e.length>0&&e[e.length-1].left===t;)t=e[e.length-1],e.pop()}},Object.defineProperty(h,"hasPrev",{get:function(){var e=this._stack;if(0===e.length)return!1;if(e[e.length-1].left)return!0;for(var t=e.length-1;t>0;--t)if(e[t-1].right===e[t])return!0;return!1}})},{}],18:[function(e,t,r){r.read=function(e,t,r,n,i){var o,s,a=8*i-n-1,u=(1<<a)-1,c=u>>1,f=-7,l=r?i-1:0,h=r?-1:1,d=e[t+l];for(l+=h,o=d&(1<<-f)-1,d>>=-f,f+=a;f>0;o=256*o+e[t+l],l+=h,f-=8);for(s=o&(1<<-f)-1,o>>=-f,f+=n;f>0;s=256*s+e[t+l],l+=h,f-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,n),o-=c}return(d?-1:1)*s*Math.pow(2,o-n)},r.write=function(e,t,r,n,i,o){var s,a,u,c=8*o-i-1,f=(1<<c)-1,l=f>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,p=n?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=f):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),(t+=s+l>=1?h/u:h*Math.pow(2,1-l))*u>=2&&(s++,u/=2),s+l>=f?(a=0,s=f):s+l>=1?(a=(t*u-1)*Math.pow(2,i),s+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,i),s=0));i>=8;e[r+d]=255&a,d+=p,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;e[r+d]=255&s,d+=p,s/=256,c-=8);e[r+d-p]|=128*v}},{}],19:[function(e,t,r){"use strict";var n,i,o,s=[e("./nextTick"),e("./mutation.js"),e("./messageChannel"),e("./stateChange"),e("./timeout")],a=-1,u=[],c=!1;function f(){n&&i&&(n=!1,i.length?u=i.concat(u):a=-1,u.length&&l())}function l(){if(!n){c=!1,n=!0;for(var e=u.length,t=setTimeout(f);e;){for(i=u,u=[];i&&++a<e;)i[a].run();a=-1,e=u.length}i=null,a=-1,n=!1,clearTimeout(t)}}for(var h=-1,d=s.length;++h<d;)if(s[h]&&s[h].test&&s[h].test()){o=s[h].install(l);break}function p(e,t){this.fun=e,this.array=t}p.prototype.run=function(){var e=this.fun,t=this.array;switch(t.length){case 0:return e();case 1:return e(t[0]);case 2:return e(t[0],t[1]);case 3:return e(t[0],t[1],t[2]);default:return e.apply(null,t)}},t.exports=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),c||n||(c=!0,o())}},{"./messageChannel":20,"./mutation.js":21,"./nextTick":22,"./stateChange":23,"./timeout":24}],20:[function(e,t,r){(function(e){"use strict";r.test=function(){return!e.setImmediate&&void 0!==e.MessageChannel},r.install=function(t){var r=new e.MessageChannel;return r.port1.onmessage=t,function(){r.port2.postMessage(0)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],21:[function(e,t,r){(function(e){"use strict";var t=e.MutationObserver||e.WebKitMutationObserver;r.test=function(){return t},r.install=function(r){var n=0,i=new t(r),o=e.document.createTextNode("");return i.observe(o,{characterData:!0}),function(){o.data=n=++n%2}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],22:[function(e,t,r){(function(e){"use strict";r.test=function(){return void 0!==e&&!e.browser},r.install=function(t){return function(){e.nextTick(t)}}}).call(this,e("_process"))},{_process:43}],23:[function(e,t,r){(function(e){"use strict";r.test=function(){return"document"in e&&"onreadystatechange"in e.document.createElement("script")},r.install=function(t){return function(){var r=e.document.createElement("script");return r.onreadystatechange=function(){t(),r.onreadystatechange=null,r.parentNode.removeChild(r),r=null},e.document.documentElement.appendChild(r),t}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],24:[function(e,t,r){"use strict";r.test=function(){return!0},r.install=function(e){return function(){setTimeout(e,0)}}},{}],25:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],26:[function(e,t,r){t.exports=function(e){return!(null==e||!(e._isBuffer||e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)))}},{}],27:[function(e,t,r){(function(e){function t(e,t){return Object.hasOwnProperty.call(e,t)}function n(e){return void 0!==e&&""!==e}function t(e,t){return Object.hasOwnProperty.call(e,t)}function i(e,t){return Object.hasOwnProperty.call(e,t)&&t}r.compare=function(t,r){if(e.isBuffer(t)){for(var n=Math.min(t.length,r.length),i=0;i<n;i++){var o=t[i]-r[i];if(o)return o}return t.length-r.length}return t<r?-1:t>r?1:0};var o=r.lowerBoundKey=function(e){return i(e,"gt")||i(e,"gte")||i(e,"min")||(e.reverse?i(e,"end"):i(e,"start"))||void 0},s=r.lowerBound=function(e){var t=o(e);return t&&e[t]},a=r.lowerBoundInclusive=function(e){return!t(e,"gt")},u=r.upperBoundInclusive=function(e){return!t(e,"lt")},c=r.lowerBoundExclusive=function(e){return!a(e)},f=r.upperBoundExclusive=function(e){return!u(e)},l=r.upperBoundKey=function(e){return i(e,"lt")||i(e,"lte")||i(e,"max")||(e.reverse?i(e,"start"):i(e,"end"))||void 0},h=r.upperBound=function(e){var t=l(e);return t&&e[t]};function d(e){return e}r.toLtgt=function(e,n,i,o,s){n=n||{},i=i||d;var a=arguments.length>3,u=r.lowerBoundKey(e),c=r.upperBoundKey(e);return u?"gt"===u?n.gt=i(e.gt,!1):n.gte=i(e[u],!1):a&&(n.gte=i(o,!1)),c?"lt"===c?n.lt=i(e.lt,!0):n.lte=i(e[c],!0):a&&(n.lte=i(s,!0)),null!=e.reverse&&(n.reverse=!!e.reverse),t(n,"max")&&delete n.max,t(n,"min")&&delete n.min,t(n,"start")&&delete n.start,t(n,"end")&&delete n.end,n},r.contains=function(e,t,i){i=i||r.compare;var o=s(e);if(n(o)&&((a=i(t,o))<0||0===a&&c(e)))return!1;var a,u=h(e);if(n(u)&&((a=i(t,u))>0||0===a&&f(e)))return!1;return!0},r.filter=function(e,t){return function(n){return r.contains(e,n,t)}}}).call(this,{isBuffer:e("../../is-buffer/1.1.0/index.js")})},{"../../is-buffer/1.1.0/index.js":26}],28:[function(e,t,r){t.exports=e("immediate")},{immediate:19}],29:[function(e,t,r){(function(r){var n=e("inherits"),i=e("abstract-leveldown").AbstractLevelDOWN,o=e("abstract-leveldown").AbstractIterator,s=e("ltgt"),a=e("functional-red-black-tree"),u={},c=e("./immediate");function f(e){return s.compare(e,this._end)>0}function l(e){return s.compare(e,this._end)>=0}function h(e){return s.compare(e,this._end)<0}function d(e){return s.compare(e,this._end)<=0}function p(e,t){o.call(this,e),this._limit=t.limit,-1===this._limit&&(this._limit=1/0);var r=e._store[e._location];this.keyAsBuffer=!1!==t.keyAsBuffer,this.valueAsBuffer=!1!==t.valueAsBuffer,this._reverse=t.reverse,this._options=t,this._done=0,this._reverse?(this._incr="prev",this._start=s.upperBound(t),this._end=s.lowerBound(t),void 0===this._start?this._tree=r.end:s.upperBoundInclusive(t)?this._tree=r.le(this._start):this._tree=r.lt(this._start),this._end&&(s.lowerBoundInclusive(t)?this._test=l:this._test=f)):(this._incr="next",this._start=s.lowerBound(t),this._end=s.upperBound(t),void 0===this._start?this._tree=r.begin:s.lowerBoundInclusive(t)?this._tree=r.ge(this._start):this._tree=r.gt(this._start),this._end&&(s.upperBoundInclusive(t)?this._test=d:this._test=h))}function v(e){if(!(this instanceof v))return new v(e);i.call(this,"string"==typeof e?e:""),this._location=this.location?"$"+this.location:"_tree",this._store=this.location?u:this,this._store[this._location]=this._store[this._location]||a(s.compare)}n(p,o),p.prototype._next=function(e){var t,n;return this._done++>=this._limit?c(e):this._tree.valid?(t=this._tree.key,n=this._tree.value,this._test(t)?(this.keyAsBuffer&&(t=new r(t)),this.valueAsBuffer&&(n=new r(n)),this._tree[this._incr](),void c(function(){e(null,t,n)})):c(e)):c(e)},p.prototype._test=function(){return!0},v.clearGlobalStore=function(e){e?Object.keys(u).forEach(function(e){delete u[e]}):u={}},n(v,i),v.prototype._open=function(e,t){var r=this;c(function(){t(null,r)})},v.prototype._put=function(e,t,r,n){void 0!==t&&null!==t||(t="");var i=this._store[this._location].find(e);i.valid?this._store[this._location]=i.update(t):this._store[this._location]=this._store[this._location].insert(e,t),c(n)},v.prototype._get=function(e,t,n){var i=this._store[this._location].get(e);if(void 0===i)return c(function(){n(new Error("NotFound"))});!1===t.asBuffer||this._isBuffer(i)||(i=new r(String(i))),c(function(){n(null,i)})},v.prototype._del=function(e,t,r){this._store[this._location]=this._store[this._location].remove(e),c(r)},v.prototype._batch=function(e,t,r){for(var n,i,o,s=-1,a=e.length,u=this._store[this._location];++s<a;)e[s]&&(n=this._isBuffer(e[s].key)?e[s].key:String(e[s].key),o=u.find(n),"put"===e[s].type?(i=this._isBuffer(e[s].value)?e[s].value:String(e[s].value),u=o.valid?o.update(i):u.insert(n,i)):u=o.remove());this._store[this._location]=u,c(r)},v.prototype._iterator=function(e){return new p(this,e)},v.prototype._isBuffer=function(e){return r.isBuffer(e)},v.destroy=function(e,t){var r="$"+e;r in u&&delete u[r],c(t)},t.exports=v}).call(this,e("buffer").Buffer)},{"./immediate":28,"abstract-leveldown":4,buffer:8,"functional-red-black-tree":17,inherits:84,ltgt:27}],30:[function(e,t,r){(function(e){function t(e,t){for(var r=0,n=e.length-1;n>=0;n--){var i=e[n];"."===i?e.splice(n,1):".."===i?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}var n=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,i=function(e){return n.exec(e).slice(1)};function o(e,t){if(e.filter)return e.filter(t);for(var r=[],n=0;n<e.length;n++)t(e[n],n,e)&&r.push(e[n]);return r}r.resolve=function(){for(var r="",n=!1,i=arguments.length-1;i>=-1&&!n;i--){var s=i>=0?arguments[i]:e.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(r=s+"/"+r,n="/"===s.charAt(0))}return r=t(o(r.split("/"),function(e){return!!e}),!n).join("/"),(n?"/":"")+r||"."},r.normalize=function(e){var n=r.isAbsolute(e),i="/"===s(e,-1);return(e=t(o(e.split("/"),function(e){return!!e}),!n).join("/"))||n||(e="."),e&&i&&(e+="/"),(n?"/":"")+e},r.isAbsolute=function(e){return"/"===e.charAt(0)},r.join=function(){var e=Array.prototype.slice.call(arguments,0);return r.normalize(o(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},r.relative=function(e,t){function n(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=r.resolve(e).substr(1),t=r.resolve(t).substr(1);for(var i=n(e.split("/")),o=n(t.split("/")),s=Math.min(i.length,o.length),a=s,u=0;u<s;u++)if(i[u]!==o[u]){a=u;break}var c=[];for(u=a;u<i.length;u++)c.push("..");return(c=c.concat(o.slice(a))).join("/")},r.sep="/",r.delimiter=":",r.dirname=function(e){var t=i(e),r=t[0],n=t[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},r.basename=function(e,t){var r=i(e)[2];return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},r.extname=function(e){return i(e)[3]};var s="b"==="ab".substr(-1)?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return t<0&&(t=e.length+t),e.substr(t,r)}}).call(this,e("_process"))},{_process:43}],31:[function(e,t,r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var i=e("pouchdb-collections"),o=n(e("pouchdb-promise")),s=n(e("levelup")),a=n(e("sublevel-pouchdb")),u=e("through2"),c=n(e("argsarray")),f=n(e("double-ended-queue")),l=n(e("buffer-from")),h=e("pouchdb-utils"),d=e("pouchdb-adapter-utils"),p=e("pouchdb-merge"),v=e("pouchdb-json"),m=e("pouchdb-md5"),g=e("pouchdb-binary-utils"),y=e("pouchdb-errors");function _(e,t){return e.type=t,e}function b(e,t){var r=t.prefix()[0],n=e._cache,o=n.get(r);return o||(o=new i.Map,n.set(r,o)),o}function w(){this._batch=[],this._cache=new i.Map}w.prototype.get=function(e,t,r){var n=b(this,e),i=n.get(t);return i?h.nextTick(function(){r(null,i)}):null===i?h.nextTick(function(){r({name:"NotFoundError"})}):void e.get(t,function(e,i){if(e)return"NotFoundError"===e.name&&n.set(t,null),r(e);n.set(t,i),r(null,i)})},w.prototype.batch=function(e){for(var t=0,r=e.length;t<r;t++){var n=e[t],i=b(this,n.prefix);"put"===n.type?i.set(n.key,n.value):i.set(n.key,null)}this._batch=this._batch.concat(e)},w.prototype.execute=function(e,t){for(var r=new i.Set,n=[],o=this._batch.length-1;o>=0;o--){var s=this._batch[o],a=s.prefix.prefix()[0]+""+s.key;r.has(a)||(r.add(a),n.push(s))}e.batch(n,t)};var k="document-store",x="by-sequence",E="attach-store",S="attach-binary-store",R="local-store",j="meta-store",T=new i.Map,D="_local_last_update_seq",O="_local_doc_count",A="_local_uuid",B="md5-",C={encode:v.safeJsonStringify,decode:v.safeJsonParse,buffer:!1,type:"cheap-json"},L=new h.changesHandler;function I(e){return"winningRev"in e?e.winningRev:p.winningRev(e)}function q(e,t){return"deleted"in e?e.deleted:d.isDeleted(e,t)}function N(e,t,r){var n=[];return e.forEach(function(e){e.doc&&e.doc._attachments&&Object.keys(e.doc._attachments).forEach(function(t){var r=e.doc._attachments[t];"data"in r||n.push(r)})}),o.all(n.map(function(e){return function(e,t,r){var n=e.content_type;return new o(function(i,o){t.binaryStore.get(e.digest,function(t,s){var a;if(t){if("NotFoundError"!==t.name)return o(t);a=r.binary?g.binaryStringToBlobOrBuffer("",n):""}else a=r.binary?_(s,n):s.toString("base64");delete e.stub,delete e.length,e.data=a,i()})})}(e,t,r)}))}t.exports=function(e,t){var r,n,v=this,b={},M=(e=h.clone(e)).revs_limit,P=e.name;void 0===e.createIfMissing&&(e.createIfMissing=!0);var F,U=e.db,G=h.functionName(U);function W(){b.docStore=n.sublevel(k,{valueEncoding:C}),b.bySeqStore=n.sublevel(x,{valueEncoding:"json"}),b.attachmentStore=n.sublevel(E,{valueEncoding:"json"}),b.binaryStore=n.sublevel(S,{valueEncoding:"binary"}),b.localStore=n.sublevel(R,{valueEncoding:"json"}),b.metaStore=n.sublevel(j,{valueEncoding:"json"}),"object"==typeof e.migrate?e.migrate.doMigrationTwo(n,b,z):z()}function z(){b.metaStore.get(D,function(e,i){void 0===n._updateSeq&&(n._updateSeq=i||0),b.metaStore.get(O,function(e,i){n._docCount=e?0:i,b.metaStore.get(A,function(e,n){r=e?h.uuid():n,b.metaStore.put(A,r,function(){h.nextTick(function(){t(null,v)})})})})})}function H(e,t){try{e.apply(null,t)}catch(e){t[t.length-1](e)}}function K(){var e=n._queue.peekFront();"read"===e.type?function(e){for(var t=[e],r=1,i=n._queue.get(r);void 0!==i&&"read"===i.type;)t.push(i),r++,i=n._queue.get(r);var o=0;t.forEach(function(e){var r=e.args,i=r[r.length-1];r[r.length-1]=c(function(e){i.apply(null,e),++o===t.length&&h.nextTick(function(){t.forEach(function(){n._queue.shift()}),n._queue.length&&K()})}),H(e.fun,r)})}(e):function(e){var t=e.args,r=t[t.length-1];t[t.length-1]=c(function(e){r.apply(null,e),h.nextTick(function(){n._queue.shift(),n._queue.length&&K()})}),H(e.fun,t)}(e)}function J(e){return c(function(t){n._queue.push({fun:e,args:t,type:"write"}),1===n._queue.length&&h.nextTick(K)})}function V(e){return c(function(t){n._queue.push({fun:e,args:t,type:"read"}),1===n._queue.length&&h.nextTick(K)})}function $(e){return("0000000000000000"+e).slice(-16)}function Q(e,t){U.destroy(e,t)}T.has(G)?F=T.get(G):(F=new i.Map,T.set(G,F)),F.has(P)?(n=F.get(P),W()):F.set(P,a(s(P,e,function(r){if(r)return F.delete(P),t(r);(n=F.get(P))._docCount=-1,n._queue=new f,"object"==typeof e.migrate?e.migrate.doMigrationOne(P,n,W):W()}))),v.type=function(){return"leveldb"},v._id=function(e){e(null,r)},v._info=function(e){var t={doc_count:n._docCount,update_seq:n._updateSeq,backend_adapter:h.functionName(U)};return h.nextTick(function(){e(null,t)})},v._get=V(function(e,t,r){t=h.clone(t),b.docStore.get(e,function(e,n){if(e||!n)return r(y.createError(y.MISSING_DOC,"missing"));var i;if(t.rev)i=t.latest?p.latest(t.rev,n):t.rev;else if(i=I(n),q(n,i))return r(y.createError(y.MISSING_DOC,"deleted"));var o=n.rev_map[i];b.bySeqStore.get($(o),function(e,t){if(!t)return r(y.createError(y.MISSING_DOC));if("_id"in t&&t._id!==n.id)return r(new Error("wrong doc returned"));if(t._id=n.id,"_rev"in t){if(t._rev!==i)return r(new Error("wrong doc returned"))}else t._rev=i;return r(null,{doc:t,metadata:n})})})}),v._getAttachment=function(e,t,r,n,i){var o=r.digest,s=r.content_type;b.binaryStore.get(o,function(e,t){if(e)return"NotFoundError"!==e.name?i(e):i(null,n.binary?function(e){return g.typedBuffer("","binary",e)}(s):"");n.binary?i(null,_(t,s)):i(null,t.toString("base64"))})},v._bulkDocs=J(function(e,t,r){var s=t.new_edits,a=new Array(e.docs.length),u=new i.Map,c=new i.Map,f=new w,_=0,k=n._updateSeq,x=e.docs,E=x.map(function(e){if(e._id&&d.isLocalId(e._id))return e;var t=d.parseDoc(e,s);return t.metadata&&!t.metadata.rev_map&&(t.metadata.rev_map={}),t}),S=E.filter(function(e){return e.error});if(S.length)return r(S[0]);function R(e,t){var r=o.resolve();e.forEach(function(e,t){r=r.then(function(){return new o(function(r,n){v._doCompactionNoLock(t,e,{ctx:f},function(e){if(e)return n(e);r()})})})}),r.then(function(){t()},t)}function j(){R(c,function(e){if(e&&I(e),v.auto_compaction)return t=I,r=new i.Map,u.forEach(function(e,t){r.set(t,p.compactTree(e))}),void R(r,t);var t,r;I()})}function T(e,t,n,i,o,s,h,d){_+=s;var p=null,v=0;e.metadata.winningRev=t,e.metadata.deleted=n,e.data._id=e.metadata.id,e.data._rev=e.metadata.rev,i&&(e.data._deleted=!0),e.stemmedRevs.length&&c.set(e.metadata.id,e.stemmedRevs);var w,x=e.data._attachments?Object.keys(e.data._attachments):[];function E(e){v++,p||(e?d(p=e):v===x.length&&A())}function S(e,t,r,n){return function(i){!function(e,t,r,n,i){var o=e.data._attachments[r];delete o.data,o.digest=t,o.length=n.length;var s=e.metadata.id,a=e.metadata.rev;o.revpos=parseInt(a,10),C(s,a,t,function(e,r){return e?i(e):0===n.length?i(e):r?(f.batch([{type:"put",prefix:b.binaryStore,key:t,value:l(n,"binary")}]),void i()):i(e)})}(e,B+i,t,r,n)}}function R(e,t,r){return function(n){m.binaryMd5(n,S(e,t,n,r))}}for(var j=0;j<x.length;j++){var T,D=x[j],O=e.data._attachments[D];if(O.stub)C(e.data._id,e.data._rev,O.digest,E);else if("string"==typeof O.data){try{T=g.atob(O.data)}catch(e){return void r(y.createError(y.BAD_ARG,"Attachment is not a valid base64 string"))}R(e,D,E)(T)}else w=O.data,R(e,D,E)(w)}function A(){var t=e.metadata.rev_map[e.metadata.rev];if(t)return d();t=++k,e.metadata.rev_map[e.metadata.rev]=e.metadata.seq=t;var r=[{key:$(t),value:e.data,prefix:b.bySeqStore,type:"put"},{key:e.metadata.id,value:e.metadata,prefix:b.docStore,type:"put"}];f.batch(r),a[h]={ok:!0,id:e.metadata.id,rev:e.metadata.rev},u.set(e.metadata.id,e.metadata),d()}x.length||A()}var A={};function C(e,t,r,n){function i(n){var i=[e,t].join("@"),s={};return n?n.refs&&(s.refs=n.refs,s.refs[i]=!0):(s.refs={},s.refs[i]=!0),new o(function(e){f.batch([{type:"put",prefix:b.attachmentStore,key:r,value:s}]),e(!n)})}var s=A[r]||o.resolve();A[r]=s.then(function(){return new o(function(e,t){f.get(b.attachmentStore,r,function(r,n){if(r&&"NotFoundError"!==r.name)return t(r);e(n)})}).then(i).then(function(e){n(null,e)},n)})}function I(e){if(e)return h.nextTick(function(){r(e)});f.batch([{prefix:b.metaStore,type:"put",key:D,value:k},{prefix:b.metaStore,type:"put",key:O,value:n._docCount+_}]),f.execute(n,function(e){if(e)return r(e);n._docCount+=_,n._updateSeq=k,L.notify(P),h.nextTick(function(){r(null,a)})})}if(!E.length)return r(null,[]);!function(e){var t=[];if(x.forEach(function(e){e&&e._attachments&&Object.keys(e._attachments).forEach(function(r){var n=e._attachments[r];n.stub&&t.push(n.digest)})}),!t.length)return e();var r,n=0;t.forEach(function(i){!function(e,t){f.get(b.attachmentStore,e,function(r){if(r){var n=y.createError(y.MISSING_STUB,"unknown stub attachment with digest "+e);t(n)}else t()})}(i,function(i){i&&!r&&(r=i),++n===t.length&&e(r)})})}(function(e){if(e)return r(e);!function(e){var t,r=0;function n(){if(++r===x.length)return e(t)}x.forEach(function(e){if(e._id&&d.isLocalId(e._id))return n();f.get(b.docStore,e._id,function(r,i){r?"NotFoundError"!==r.name&&(t=r):u.set(e._id,i),n()})})}(function(e){if(e)return r(e);d.processDocs(M,E,v,u,f,a,T,t,j)})})}),v._allDocs=V(function(e,t){e=h.clone(e),function(e){n.isClosed()?e(new Error("database is closed")):e(null,n._docCount)}(function(r,n){if(r)return t(r);var i,s={},a=e.skip||0;if(e.startkey&&(s.gte=e.startkey),e.endkey&&(s.lte=e.endkey),e.key&&(s.gte=s.lte=e.key),e.descending){s.reverse=!0;var c=s.lte;s.lte=s.gte,s.gte=c}if("number"==typeof e.limit&&(i=e.limit),0===i||"start"in s&&"end"in s&&s.start>s.end)return t(null,{total_rows:n,offset:e.skip,rows:[]});var f=[],l=b.docStore.readStream(s),h=u.obj(function(t,r,n){var o=t.value,s=I(o),u=q(o,s);if(u){if("ok"!==e.deleted)return void n()}else{if(a-- >0)return void n();if("number"==typeof i&&i--<=0)return l.unpipe(),l.destroy(),void n()}function c(t){var r={id:o.id,key:o.id,value:{rev:s}};if(e.include_docs){if(r.doc=t,r.doc._rev=r.value.rev,e.conflicts){var i=p.collectConflicts(o);i.length&&(r.doc._conflicts=i)}for(var a in r.doc._attachments)r.doc._attachments.hasOwnProperty(a)&&(r.doc._attachments[a].stub=!0)}if(!1===e.inclusive_end&&o.id===e.endkey)return n();if(u){if("ok"!==e.deleted)return n();r.value.deleted=!0,r.doc=null}f.push(r),n()}if(e.include_docs){var h=o.rev_map[s];b.bySeqStore.get($(h),function(e,t){c(t)})}else c()},function(r){o.resolve().then(function(){if(e.include_docs&&e.attachments)return N(f,b,e)}).then(function(){t(null,{total_rows:n,offset:e.skip,rows:f})},t),r()}).on("unpipe",function(){h.end()});l.on("error",t),l.pipe(h)})}),v._changes=function(e){if((e=h.clone(e)).continuous){var t=P+":"+h.uuid();return L.addListener(P,t,v,e),L.notify(P),{cancel:function(){L.removeListener(P,t)}}}var r,o=e.descending,s=[],a=e.since||0,c=0,f={reverse:o};"limit"in e&&e.limit>0&&(r=e.limit),f.reverse||(f.start=$(e.since||0));var l,p=e.doc_ids&&new i.Set(e.doc_ids),m=h.filterChange(e),g=new i.Map;function y(){e.done=!0,l&&e.limit&&e.limit<s.length&&(s.length=e.limit),_.unpipe(w),_.destroy(),e.continuous||e.cancelled||(e.include_docs&&e.attachments?N(s,b,e).then(function(){e.complete(null,{results:s,last_seq:a})}):e.complete(null,{results:s,last_seq:a}))}l="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var _=b.bySeqStore.readStream(f),w=u.obj(function(t,i,u){if(r&&c>=r)return y(),u();if(e.cancelled||e.done)return u();var f,h,v=(f=t.key,parseInt(f,10)),_=t.value;if(v===e.since&&!o)return u();if(p&&!p.has(_._id))return u();function w(t){var r=I(t);function n(r){var n=e.processChange(r,t,e);n.seq=t.seq;var i=m(n);if("object"==typeof i)return e.complete(i);i&&(c++,e.attachments&&e.include_docs?N([n],b,e).then(function(){e.onChange(n)}):e.onChange(n),l&&s.push(n)),u()}if(t.seq!==v)return u();if(a=v,r===_._rev)return n(_);var i=t.rev_map[r];b.bySeqStore.get($(i),function(e,t){n(t)})}if(h=g.get(_._id))return w(h);b.docStore.get(_._id,function(t,r){if(e.cancelled||e.done||n.isClosed()||d.isLocalId(r.id))return u();g.set(_._id,r),w(r)})},function(t){if(e.cancelled)return t();l&&e.limit&&e.limit<s.length&&(s.length=e.limit),t()}).on("unpipe",function(){w.end(),y()});return _.pipe(w),{cancel:function(){e.cancelled=!0,y()}}},v._close=function(e){if(n.isClosed())return e(y.createError(y.NOT_OPEN));n.close(function(t){t?e(t):(F.delete(P),e())})},v._getRevisionTree=function(e,t){b.docStore.get(e,function(e,r){e?t(y.createError(y.MISSING_DOC)):t(null,r.rev_tree)})},v._doCompaction=J(function(e,t,r,n){v._doCompactionNoLock(e,t,r,n)}),v._doCompactionNoLock=function(e,t,r,o){if("function"==typeof r&&(o=r,r={}),!t.length)return o();var s=r.ctx||new w;s.get(b.docStore,e,function(a,u){if(a)return o(a);var c=t.map(function(e){var t=u.rev_map[e];return delete u.rev_map[e],t});p.traverseRevTree(u.rev_tree,function(e,r,n,i,o){var s=r+"-"+n;-1!==t.indexOf(s)&&(o.status="missing")});var f=[];f.push({key:u.id,value:u,type:"put",prefix:b.docStore});var l,h={},d=0;function v(r){if(r&&(l=r),++d===t.length){if(l)return o(l);!function(){var r=Object.keys(h);if(!r.length)return m();var n,o=0;function a(e){e&&(n=e),++o===r.length&&m(n)}var u=new i.Map;t.forEach(function(t){u.set(e+"@"+t,!0)}),r.forEach(function(e){s.get(b.attachmentStore,e,function(t,r){if(t)return"NotFoundError"===t.name?a():a(t);var n=Object.keys(r.refs||{}).filter(function(e){return!u.has(e)}),i={};n.forEach(function(e){i[e]=!0}),n.length?f.push({key:e,type:"put",value:{refs:i},prefix:b.attachmentStore}):f=f.concat([{key:e,type:"del",prefix:b.attachmentStore},{key:e,type:"del",prefix:b.binaryStore}]),a()})})}()}}function m(e){return e?o(e):(s.batch(f),r.ctx?o():void s.execute(n,o))}c.forEach(function(e){f.push({key:$(e),type:"del",prefix:b.bySeqStore}),s.get(b.bySeqStore,$(e),function(e,t){if(e)return"NotFoundError"===e.name?v():v(e);Object.keys(t._attachments||{}).forEach(function(e){var r=t._attachments[e].digest;h[r]=!0}),v()})})})},v._getLocal=function(e,t){b.localStore.get(e,function(e,r){e?t(y.createError(y.MISSING_DOC)):t(null,r)})},v._putLocal=function(e,t,r){"function"==typeof t&&(r=t,t={}),t.ctx?v._putLocalNoLock(e,t,r):v._putLocalWithLock(e,t,r)},v._putLocalWithLock=J(function(e,t,r){v._putLocalNoLock(e,t,r)}),v._putLocalNoLock=function(e,t,r){delete e._revisions;var i=e._rev,o=e._id,s=t.ctx||new w;s.get(b.localStore,o,function(a,u){if(a&&i)return r(y.createError(y.REV_CONFLICT));if(u&&u._rev!==i)return r(y.createError(y.REV_CONFLICT));e._rev=i?"0-"+(parseInt(i.split("-")[1],10)+1):"0-1";var c=[{type:"put",prefix:b.localStore,key:o,value:e}];s.batch(c);var f={ok:!0,id:e._id,rev:e._rev};if(t.ctx)return r(null,f);s.execute(n,function(e){if(e)return r(e);r(null,f)})})},v._removeLocal=function(e,t,r){"function"==typeof t&&(r=t,t={}),t.ctx?v._removeLocalNoLock(e,t,r):v._removeLocalWithLock(e,t,r)},v._removeLocalWithLock=J(function(e,t,r){v._removeLocalNoLock(e,t,r)}),v._removeLocalNoLock=function(e,t,r){var i=t.ctx||new w;i.get(b.localStore,e._id,function(o,s){if(o)return"NotFoundError"!==o.name?r(o):r(y.createError(y.MISSING_DOC));if(s._rev!==e._rev)return r(y.createError(y.REV_CONFLICT));i.batch([{prefix:b.localStore,type:"del",key:e._id}]);var a={ok:!0,id:e._id,rev:"0-0"};if(t.ctx)return r(null,a);i.execute(n,function(e){if(e)return r(e);r(null,a)})})},v._destroy=function(e,t){var r,n=h.functionName(U);if(!T.has(n))return Q(P,t);(r=T.get(n)).has(P)?(L.removeAllListeners(P),r.get(P).close(function(){r.delete(P),Q(P,t)})):Q(P,t)}}},{argsarray:65,"buffer-from":67,"double-ended-queue":77,levelup:102,"pouchdb-adapter-utils":33,"pouchdb-binary-utils":34,"pouchdb-collections":35,"pouchdb-errors":36,"pouchdb-json":37,"pouchdb-md5":38,"pouchdb-merge":39,"pouchdb-promise":40,"pouchdb-utils":42,"sublevel-pouchdb":51,through2:137}],32:[function(e,t,r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var i=e("pouchdb-utils"),o=n(e("pouchdb-adapter-leveldb-core")),s=n(e("memdown"));function a(e,t){var r=i.assign({db:s},e);o.call(this,r,t)}a.valid=function(){return!0},a.use_prefix=!1;t.exports=function(e){e.adapter("memory",a,!0)}},{memdown:29,"pouchdb-adapter-leveldb-core":31,"pouchdb-utils":42}],33:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("pouchdb-utils"),i=e("pouchdb-errors"),o=e("pouchdb-merge"),s=e("pouchdb-binary-utils"),a=e("pouchdb-md5"),u=e("pouchdb-collections");function c(e){return e.reduce(function(e,t){return e[t]=!0,e},{})}var f=c(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),l=c(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function h(e){if(!/^\d+\-./.test(e))return i.createError(i.INVALID_REV);var t=e.indexOf("-"),r=e.substring(0,t),n=e.substring(t+1);return{prefix:parseInt(r,10),id:n}}function d(e,t){var r,o,s,a={status:"available"};if(e._deleted&&(a.deleted=!0),t)if(e._id||(e._id=n.uuid()),o=n.uuid(32,16).toLowerCase(),e._rev){if((s=h(e._rev)).error)return s;e._rev_tree=[{pos:s.prefix,ids:[s.id,{status:"missing"},[[o,a,[]]]]}],r=s.prefix+1}else e._rev_tree=[{pos:1,ids:[o,a,[]]}],r=1;else if(e._revisions&&(e._rev_tree=function(e,t){for(var r=e.start-e.ids.length+1,n=e.ids,i=[n[0],t,[]],o=1,s=n.length;o<s;o++)i=[n[o],{status:"missing"},[i]];return[{pos:r,ids:i}]}(e._revisions,a),r=e._revisions.start,o=e._revisions.ids[0]),!e._rev_tree){if((s=h(e._rev)).error)return s;r=s.prefix,o=s.id,e._rev_tree=[{pos:r,ids:[o,a,[]]}]}n.invalidIdError(e._id),e._rev=r+"-"+o;var u={metadata:{},data:{}};for(var c in e)if(Object.prototype.hasOwnProperty.call(e,c)){var d="_"===c[0];if(d&&!f[c]){var p=i.createError(i.DOC_VALIDATION,c);throw p.message=i.DOC_VALIDATION.message+": "+c,p}d&&!l[c]?u.metadata[c.slice(1)]=e[c]:u.data[c]=e[c]}return u}function p(e,t,r){var n=function(e){try{return s.atob(e)}catch(e){return{error:i.createError(i.BAD_ARG,"Attachment is not a valid base64 string")}}}(e.data);if(n.error)return r(n.error);e.length=n.length,e.data="blob"===t?s.binaryStringToBlobOrBuffer(n,e.content_type):"base64"===t?s.btoa(n):n,a.binaryMd5(n,function(t){e.digest="md5-"+t,r()})}function v(e,t,r){if(e.stub)return r();"string"==typeof e.data?p(e,t,r):function(e,t,r){a.binaryMd5(e.data,function(n){e.digest="md5-"+n,e.length=e.data.size||e.data.length||0,"binary"===t?s.blobOrBufferToBinaryString(e.data,function(t){e.data=t,r()}):"base64"===t?s.blobOrBufferToBase64(e.data,function(t){e.data=t,r()}):r()})}(e,t,r)}function m(e,t,r,n,s,a,u,c){if(o.revExists(t.rev_tree,r.metadata.rev))return n[s]=r,a();var f=t.winningRev||o.winningRev(t),l="deleted"in t?t.deleted:o.isDeleted(t,f),h="deleted"in r.metadata?r.metadata.deleted:o.isDeleted(r.metadata),p=/^1-/.test(r.metadata.rev);if(l&&!h&&c&&p){var v=r.data;v._rev=f,v._id=r.metadata.id,r=d(v,c)}var m=o.merge(t.rev_tree,r.metadata.rev_tree[0],e);if(c&&(l&&h&&"new_leaf"!==m.conflicts||!l&&"new_leaf"!==m.conflicts||l&&!h&&"new_branch"===m.conflicts)){var g=i.createError(i.REV_CONFLICT);return n[s]=g,a()}var y=r.metadata.rev;r.metadata.rev_tree=m.tree,r.stemmedRevs=m.stemmedRevs||[],t.rev_map&&(r.metadata.rev_map=t.rev_map);var _=o.winningRev(r.metadata),b=o.isDeleted(r.metadata,_),w=l===b?0:l<b?-1:1;u(r,_,b,y===_?b:o.isDeleted(r.metadata,y),!0,w,s,a)}r.invalidIdError=n.invalidIdError,r.isDeleted=o.isDeleted,r.isLocalId=o.isLocalId,r.normalizeDdocFunctionName=n.normalizeDdocFunctionName,r.parseDdocFunctionName=n.parseDdocFunctionName,r.parseDoc=d,r.preprocessAttachments=function(e,t,r){if(!e.length)return r();var n,i=0;function o(){i++,e.length===i&&(n?r(n):r())}e.forEach(function(e){var r=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],i=0;if(!r.length)return o();function s(e){n=e,++i===r.length&&o()}for(var a in e.data._attachments)e.data._attachments.hasOwnProperty(a)&&v(e.data._attachments[a],t,s)})},r.processDocs=function(e,t,r,n,s,a,c,f,l){e=e||1e3;var h=f.new_edits,d=new u.Map,p=0,v=t.length;function g(){++p===v&&l&&l()}t.forEach(function(e,t){if(e._id&&o.isLocalId(e._id)){var n=e._deleted?"_removeLocal":"_putLocal";r[n](e,{ctx:s},function(e,r){a[t]=e||r,g()})}else{var i=e.metadata.id;d.has(i)?(v--,d.get(i).push([e,t])):d.set(i,[[e,t]])}}),d.forEach(function(t,r){var s=0;function u(){++s<t.length?l():g()}function l(){var l=t[s],d=l[0],p=l[1];if(n.has(r))m(e,n.get(r),d,a,p,u,c,h);else{var v=o.merge([],d.metadata.rev_tree[0],e);d.metadata.rev_tree=v.tree,d.stemmedRevs=v.stemmedRevs||[],function(e,t,r){var n=o.winningRev(e.metadata),s=o.isDeleted(e.metadata,n);if("was_delete"in f&&s)return a[t]=i.createError(i.MISSING_DOC,"deleted"),r();if(h&&function(e){return"missing"===e.metadata.rev_tree[0].ids[1].status}(e)){var u=i.createError(i.REV_CONFLICT);return a[t]=u,r()}c(e,n,s,s,!1,s?0:1,t,r)}(d,p,u)}}l()})},r.updateDoc=m},{"pouchdb-binary-utils":34,"pouchdb-collections":35,"pouchdb-errors":36,"pouchdb-md5":38,"pouchdb-merge":39,"pouchdb-utils":42}],34:[function(e,t,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=(n=e("buffer-from"))&&"object"==typeof n&&"default"in n?n.default:n;function o(e,t,r){var n=i(e,t);return n.type=r,n}function s(e){for(var t="",r=new Uint8Array(e),n=r.byteLength,i=0;i<n;i++)t+=String.fromCharCode(r[i]);return t}r.atob=function(e){var r=new t(e,"base64");if(r.toString("base64")!==e)throw new Error("attachment is not a valid base64 string");return r.toString("binary")},r.btoa=function(e){return i(e,"binary").toString("base64")},r.base64StringToBlobOrBuffer=function(e,t){return o(e,"base64",t)},r.binaryStringToArrayBuffer=function(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),i=0;i<t;i++)n[i]=e.charCodeAt(i);return r},r.binaryStringToBlobOrBuffer=function(e,t){return o(e,"binary",t)},r.blob=function(){},r.blobOrBufferToBase64=function(e,t){t(e.toString("base64"))},r.blobOrBufferToBinaryString=function(e,t){t(e.toString("binary"))},r.readAsArrayBuffer=function(e,t){if("undefined"==typeof FileReader)return t((new FileReaderSync).readAsArrayBuffer(e));var r=new FileReader;r.onloadend=function(e){var r=e.target.result||new ArrayBuffer(0);t(r)},r.readAsArrayBuffer(e)},r.readAsBinaryString=function(e,t){if("undefined"==typeof FileReader)return t(s((new FileReaderSync).readAsArrayBuffer(e)));var r=new FileReader,n="function"==typeof r.readAsBinaryString;r.onloadend=function(e){var r=e.target.result||"";if(n)return t(r);t(s(r))},n?r.readAsBinaryString(e):r.readAsArrayBuffer(e)},r.typedBuffer=o}).call(this,e("buffer").Buffer)},{buffer:8,"buffer-from":67}],35:[function(e,t,r){"use strict";function n(e){return"$"+e}function i(e){return e.substring(1)}function o(){this._store={}}function s(e){if(this._store=new o,e&&Array.isArray(e))for(var t=0,r=e.length;t<r;t++)this.add(e[t])}Object.defineProperty(r,"__esModule",{value:!0}),o.prototype.get=function(e){var t=n(e);return this._store[t]},o.prototype.set=function(e,t){var r=n(e);return this._store[r]=t,!0},o.prototype.has=function(e){return n(e)in this._store},o.prototype.delete=function(e){var t=n(e),r=t in this._store;return delete this._store[t],r},o.prototype.forEach=function(e){for(var t=Object.keys(this._store),r=0,n=t.length;r<n;r++){var o=t[r];e(this._store[o],o=i(o))}},Object.defineProperty(o.prototype,"size",{get:function(){return Object.keys(this._store).length}}),s.prototype.add=function(e){return this._store.set(e,!0)},s.prototype.has=function(e){return this._store.has(e)},s.prototype.forEach=function(e){this._store.forEach(function(t,r){e(r)})},Object.defineProperty(s.prototype,"size",{get:function(){return this._store.size}}),!function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}()?(r.Set=s,r.Map=o):(r.Set=Set,r.Map=Map)},{}],36:[function(e,t,r){"use strict";var n;function i(e,t,r){Error.call(this,r),this.status=e,this.name=t,this.message=r,this.error=!0}Object.defineProperty(r,"__esModule",{value:!0}),((n=e("inherits"))&&"object"==typeof n&&"default"in n?n.default:n)(i,Error),i.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var o=new i(401,"unauthorized","Name or password is incorrect."),s=new i(400,"bad_request","Missing JSON list of 'docs'"),a=new i(404,"not_found","missing"),u=new i(409,"conflict","Document update conflict"),c=new i(400,"bad_request","_id field must contain a string"),f=new i(412,"missing_id","_id is required for puts"),l=new i(400,"bad_request","Only reserved document ids may start with underscore."),h=new i(412,"precondition_failed","Database not open"),d=new i(500,"unknown_error","Database encountered an unknown error"),p=new i(500,"badarg","Some query argument is invalid"),v=new i(400,"invalid_request","Request was invalid"),m=new i(400,"query_parse_error","Some query parameter is invalid"),g=new i(500,"doc_validation","Bad special document member"),y=new i(400,"bad_request","Something wrong with the request"),_=new i(400,"bad_request","Document must be a JSON object"),b=new i(404,"not_found","Database not found"),w=new i(500,"indexed_db_went_bad","unknown"),k=new i(500,"web_sql_went_bad","unknown"),x=new i(500,"levelDB_went_went_bad","unknown"),E=new i(403,"forbidden","Forbidden by design doc validate_doc_update function"),S=new i(400,"bad_request","Invalid rev format"),R=new i(412,"file_exists","The database could not be created, the file already exists."),j=new i(412,"missing_stub","A pre-existing attachment stub wasn't found"),T=new i(413,"invalid_url","Provided URL is invalid");r.UNAUTHORIZED=o,r.MISSING_BULK_DOCS=s,r.MISSING_DOC=a,r.REV_CONFLICT=u,r.INVALID_ID=c,r.MISSING_ID=f,r.RESERVED_ID=l,r.NOT_OPEN=h,r.UNKNOWN_ERROR=d,r.BAD_ARG=p,r.INVALID_REQUEST=v,r.QUERY_PARSE_ERROR=m,r.DOC_VALIDATION=g,r.BAD_REQUEST=y,r.NOT_AN_OBJECT=_,r.DB_MISSING=b,r.WSQ_ERROR=k,r.LDB_ERROR=x,r.FORBIDDEN=E,r.INVALID_REV=S,r.FILE_EXISTS=R,r.MISSING_STUB=j,r.IDB_ERROR=w,r.INVALID_URL=T,r.createError=function(e,t){function r(t){for(var r in e)"function"!=typeof e[r]&&(this[r]=e[r]);void 0!==t&&(this.reason=t)}return r.prototype=i.prototype,new r(t)},r.generateErrorFromResponse=function(e){if("object"!=typeof e){var t=e;(e=d).data=t}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}},{inherits:84}],37:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=(n=e("vuvuzela"))&&"object"==typeof n&&"default"in n?n.default:n;r.safeJsonParse=function(e){try{return JSON.parse(e)}catch(t){return i.parse(e)}},r.safeJsonStringify=function(e){try{return JSON.stringify(e)}catch(t){return i.stringify(e)}}},{vuvuzela:141}],38:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=(n=e("crypto"))&&"object"==typeof n&&"default"in n?n.default:n;r.binaryMd5=function(e,t){t(i.createHash("md5").update(e,"binary").digest("base64"))},r.stringMd5=function(e){return i.createHash("md5").update(e,"binary").digest("hex")}},{crypto:12}],39:[function(e,t,r){"use strict";function n(e){for(var t,r,n,i,o=e.rev_tree.slice();i=o.pop();){var s=i.ids,a=s[2],u=i.pos;if(a.length)for(var c=0,f=a.length;c<f;c++)o.push({pos:u+1,ids:a[c]});else{var l=!!s[1].deleted,h=s[0];t&&!(n!==l?n:r!==u?r<u:t<h)||(t=h,r=u,n=l)}}return r+"-"+t}function i(e,t){for(var r,n=e.slice();r=n.pop();)for(var i=r.pos,o=r.ids,s=o[2],a=t(0===s.length,i,o[0],r.ctx,o[1]),u=0,c=s.length;u<c;u++)n.push({pos:i+1,ids:s[u],ctx:a})}function o(e,t){return e.pos-t.pos}function s(e){var t=[];i(e,function(e,r,n,i,o){e&&t.push({rev:r+"-"+n,pos:r,opts:o})}),t.sort(o).reverse();for(var r=0,n=t.length;r<n;r++)delete t[r].pos;return t}function a(e){for(var t,r=[],n=e.slice();t=n.pop();){var i=t.pos,o=t.ids,s=o[0],a=o[1],u=o[2],c=0===u.length,f=t.history?t.history.slice():[];f.push({id:s,opts:a}),c&&r.push({pos:i+1-f.length,ids:f});for(var l=0,h=u.length;l<h;l++)n.push({pos:i+1,ids:u[l],history:f})}return r.reverse()}function u(e,t){return e.pos-t.pos}function c(e,t,r){var n=function(e,t,r){for(var n,i=0,o=e.length;i<o;)r(e[n=i+o>>>1],t)<0?i=n+1:o=n;return i}(e,t,r);e.splice(n,0,t)}function f(e,t){for(var r,n,i=t,o=e.length;i<o;i++){var s=e[i],a=[s.id,s.opts,[]];n?(n[2].push(a),n=a):r=n=a}return r}function l(e,t){return e[0]<t[0]?-1:1}function h(e,t){for(var r=[{tree1:e,tree2:t}],n=!1;r.length>0;){var i=r.pop(),o=i.tree1,s=i.tree2;(o[1].status||s[1].status)&&(o[1].status="available"===o[1].status||"available"===s[1].status?"available":"missing");for(var a=0;a<s[2].length;a++)if(o[2][0]){for(var u=!1,f=0;f<o[2].length;f++)o[2][f][0]===s[2][a][0]&&(r.push({tree1:o[2][f],tree2:s[2][a]}),u=!0);u||(n="new_branch",c(o[2],s[2][a],l))}else n="new_leaf",o[2][0]=s[2][a]}return{conflicts:n,tree:e}}function d(e,t,r){var n,i=[],o=!1,s=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var a=0,c=e.length;a<c;a++){var f=e[a];if(f.pos===t.pos&&f.ids[0]===t.ids[0])n=h(f.ids,t.ids),i.push({pos:f.pos,ids:n.tree}),o=o||n.conflicts,s=!0;else if(!0!==r){var l=f.pos<t.pos?f:t,d=f.pos<t.pos?t:f,p=d.pos-l.pos,v=[],m=[];for(m.push({ids:l.ids,diff:p,parent:null,parentIdx:null});m.length>0;){var g=m.pop();if(0!==g.diff)for(var y=g.ids[2],_=0,b=y.length;_<b;_++)m.push({ids:y[_],diff:g.diff-1,parent:g.ids,parentIdx:_});else g.ids[0]===d.ids[0]&&v.push(g)}var w=v[0];w?(n=h(w.ids,d.ids),w.parent[2][w.parentIdx]=n.tree,i.push({pos:l.pos,ids:l.ids}),o=o||n.conflicts,s=!0):i.push(f)}else i.push(f)}return s||i.push(t),i.sort(u),{tree:i,conflicts:o||"internal_node"}}function p(e){return e.ids}Object.defineProperty(r,"__esModule",{value:!0}),r.collectConflicts=function(e){for(var t=n(e),r=s(e.rev_tree),i=[],o=0,a=r.length;o<a;o++){var u=r[o];u.rev===t||u.opts.deleted||i.push(u.rev)}return i},r.collectLeaves=s,r.compactTree=function(e){var t=[];return i(e.rev_tree,function(e,r,n,i,o){"available"!==o.status||e||(t.push(r+"-"+n),o.status="missing")}),t},r.isDeleted=function(e,t){t||(t=n(e));for(var r,i=t.substring(t.indexOf("-")+1),o=e.rev_tree.map(p);r=o.pop();){if(r[0]===i)return!!r[1].deleted;o=o.concat(r[2])}},r.isLocalId=function(e){return/^_local/.test(e)},r.merge=function(e,t,r){var n=d(e,t),o=function(e,t){for(var r,n,o=a(e),s=0,u=o.length;s<u;s++){var c,l=o[s],h=l.ids;if(h.length>t){r||(r={});var p=h.length-t;c={pos:l.pos+p,ids:f(h,p)};for(var v=0;v<p;v++){var m=l.pos+v+"-"+h[v].id;r[m]=!0}}else c={pos:l.pos,ids:f(h,0)};n=n?d(n,c,!0).tree:[c]}return r&&i(n,function(e,t,n){delete r[t+"-"+n]}),{tree:n,revs:r?Object.keys(r):[]}}(n.tree,r);return{tree:o.tree,stemmedRevs:o.revs,conflicts:n.conflicts}},r.revExists=function(e,t){for(var r,n=e.slice(),i=t.split("-"),o=parseInt(i[0],10),s=i[1];r=n.pop();){if(r.pos===o&&r.ids[0]===s)return!0;for(var a=r.ids[2],u=0,c=a.length;u<c;u++)n.push({pos:r.pos+1,ids:a[u]})}return!1},r.rootToLeaf=a,r.traverseRevTree=i,r.winningRev=n,r.latest=function(e,t){for(var r,n=t.rev_tree.slice();r=n.pop();){var i=r.pos,o=r.ids,s=o[0],a=o[1],u=o[2],c=0===u.length,f=r.history?r.history.slice():[];if(f.push({id:s,pos:i,opts:a}),c)for(var l=0,h=f.length;l<h;l++){var d=f[l];if(d.pos+"-"+d.id===e)return i+"-"+s}for(var p=0,v=u.length;p<v;p++)n.push({pos:i+1,ids:u[p],history:f})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}},{}],40:[function(e,t,r){"use strict";var n,i=(n=e("lie"))&&"object"==typeof n&&"default"in n?n.default:n,o="function"==typeof Promise?Promise:i;t.exports=o},{lie:105}],41:[function(e,t,r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("pouchdb-promise")),o=n(e("argsarray")),s=n(e("debug")),a=e("pouchdb-collections"),u=e("events"),c=n(e("inherits")),f=e("pouchdb-utils"),l=e("pouchdb-errors"),h=n(e("immediate"));function d(e){if(e instanceof ArrayBuffer)return function(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),r=new Uint8Array(t),n=new Uint8Array(e);return r.set(n),t}(e);var t=e.size,r=e.type;return"function"==typeof e.slice?e.slice(0,t,r):e.webkitSlice(0,t,r)}var p=Function.prototype.toString,v=p.call(Object);function m(e){var t,r,n;if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(t=[],r=0,n=e.length;r<n;r++)t[r]=m(e[r]);return t}if(e instanceof Date)return e.toISOString();if(function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer||"undefined"!=typeof Blob&&e instanceof Blob}(e))return d(e);if(!function(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var r=t.constructor;return"function"==typeof r&&r instanceof r&&p.call(r)==v}(e))return e;for(r in t={},e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=m(e[r]);void 0!==i&&(t[r]=i)}return t}function g(e){var t=!1;return o(function(r){if(t)throw new Error("once called more than once");t=!0,e.apply(this,r)})}function y(e){return o(function(t){var r=this,n="function"==typeof(t=m(t))[t.length-1]&&t.pop(),o=new i(function(n,i){var o;try{var s=g(function(e,t){e?i(e):n(t)});t.push(s),(o=e.apply(r,t))&&"function"==typeof o.then&&n(o)}catch(e){i(e)}});return n&&o.then(function(e){n(null,e)},n),o})}var _=s("pouchdb:api");function b(e,t){for(var r={},n=0,i=t.length;n<i;n++){var o=t[n];o in e&&(r[o]=e[o])}return r}var w,k=6;function x(e){return e}function E(e){return[{ok:e}]}function S(){return"undefined"!=typeof chrome&&void 0!==chrome.storage&&void 0!==chrome.storage.local}if(S())w=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),w=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){w=!1}function R(){return w}function j(){var e;u.EventEmitter.call(this),this._listeners={},e=this,S()?chrome.storage.onChanged.addListener(function(t){null!=t.db_name&&e.emit(t.dbName.newValue)}):R()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(t){e.emit(t.key)}):window.attachEvent("storage",function(t){e.emit(t.key)}))}function T(e){if("undefined"!==console&&e in console){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}c(j,u.EventEmitter),j.prototype.addListener=function(e,t,r,n){if(!this._listeners[t]){var i=this,o=!1;this._listeners[t]=s,this.on(e,s)}function s(){if(i._listeners[t])if(o)o="waiting";else{o=!0;var e=b(n,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);r.changes(e).on("change",function(e){e.seq>n.since&&!n.cancelled&&(n.since=e.seq,n.onChange(e))}).on("complete",function(){"waiting"===o&&f.nextTick(s),o=!1}).on("error",function(){o=!1})}}},j.prototype.removeListener=function(e,t){t in this._listeners&&(u.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},j.prototype.notifyLocalWindows=function(e){S()?chrome.storage.local.set({dbName:e}):R()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},j.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var D="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t};var O=function(){}.name?function(e){return e.name}:function(e){return e.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]};function A(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}var B=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],C="queryKey",L=/(?:^|&)([^&=]*)=?([^&]*)/g,I=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function q(e,t,r){return new i(function(n,i){e.get(t,function(o,s){if(o){if(404!==o.status)return i(o);s={}}var a=s._rev,u=r(s);if(!u)return n({updated:!1,rev:a});u._id=t,u._rev=a,n(function(e,t,r){return e.put(t).then(function(e){return{updated:!0,rev:e.rev}},function(n){if(409!==n.status)throw n;return q(e,t._id,r)})}(e,u,r))})})}var N="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");function M(e){return 0|Math.random()*e}r.adapterFun=function(e,t){return y(o(function(r){if(this._closed)return i.reject(new Error("database is closed"));if(this._destroyed)return i.reject(new Error("database is destroyed"));var n=this;return function(e,t,r){if(_.enabled){for(var n=[e.name,t],i=0;i<r.length-1;i++)n.push(r[i]);_.apply(null,n);var o=r[r.length-1];r[r.length-1]=function(r,n){var i=[e.name,t];i=i.concat(r?["error",r]:["success",n]),_.apply(null,i),o(r,n)}}}(n,e,r),this.taskqueue.isReady?t.apply(this,r):new i(function(t,i){n.taskqueue.addTask(function(o){o?i(o):t(n[e].apply(n,r))})})}))},r.bulkGetShim=function(e,t,r){var n=t.docs,i=new a.Map;n.forEach(function(e){i.has(e.id)?i.get(e.id).push(e):i.set(e.id,[e])});var o=i.size,s=0,u=new Array(o);function c(){var e;++s===o&&(e=[],u.forEach(function(t){t.docs.forEach(function(r){e.push({id:t.id,docs:[r]})})}),r(null,{results:e}))}var f=[];i.forEach(function(e,t){f.push(t)});var l=0;function h(){if(!(l>=f.length)){var r=Math.min(l+k,f.length),n=f.slice(l,r);!function(r,n){r.forEach(function(r,o){var s=n+o,a=i.get(r),f=b(a[0],["atts_since","attachments"]);f.open_revs=a.map(function(e){return e.rev}),f.open_revs=f.open_revs.filter(x);var l=x;0===f.open_revs.length&&(delete f.open_revs,l=E),["revs","attachments","binary","ajax","latest"].forEach(function(e){e in t&&(f[e]=t[e])}),e.get(r,f,function(e,t){var n,i,o;n=e?[{error:e}]:l(t),i=r,o=n,u[s]={id:i,docs:o},c(),h()})})}(n,l),l+=n.length}}h()},r.changesHandler=j,r.clone=m,r.defaultBackOff=function(e){var t=0;return e||(t=2e3),function(e,t){return e=parseInt(e,10)||0,(t=parseInt(t,10))!=t||t<=e?t=(e||1)<<1:t+=1,t>6e5&&(e=3e5,t=6e5),~~((t-e)*Math.random()+e)}(e,t)},r.explainError=function(e,t){T("info","The above "+e+" is totally normal. "+t)},r.assign=D,r.filterChange=function(e){var t={},r=e.filter&&"function"==typeof e.filter;return t.query=e.query_params,function(n){n.doc||(n.doc={});var i=r&&function(e,t,r){try{return!e(t,r)}catch(e){var n="Filter function threw: "+e.toString();return l.createError(l.BAD_REQUEST,n)}}(e.filter,n.doc,t);if("object"==typeof i)return i;if(i)return!1;if(e.include_docs){if(!e.attachments)for(var o in n.doc._attachments)n.doc._attachments.hasOwnProperty(o)&&(n.doc._attachments[o].stub=!0)}else delete n.doc;return!0}},r.flatten=function(e){for(var t=[],r=0,n=e.length;r<n;r++)t=t.concat(e[r]);return t},r.functionName=O,r.guardedConsole=T,r.hasLocalStorage=R,r.invalidIdError=function(e){var t;if(e?"string"!=typeof e?t=l.createError(l.INVALID_ID):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=l.createError(l.RESERVED_ID)):t=l.createError(l.MISSING_ID),t)throw t},r.isChromeApp=S,r.isCordova=function(){return"undefined"!=typeof cordova||"undefined"!=typeof PhoneGap||"undefined"!=typeof phonegap},r.listenerCount=function(e,t){return"listenerCount"in e?e.listenerCount(t):u.EventEmitter.listenerCount(e,t)},r.nextTick=h,r.normalizeDdocFunctionName=function(e){var t=A(e);return t?t.join("/"):null},r.once=g,r.parseDdocFunctionName=A,r.parseUri=function(e){for(var t=I.exec(e),r={},n=14;n--;){var i=B[n],o=t[n]||"",s=-1!==["user","password"].indexOf(i);r[i]=s?decodeURIComponent(o):o}return r[C]={},r[B[12]].replace(L,function(e,t,n){t&&(r[C][t]=n)}),r},r.pick=b,r.toPromise=y,r.upsert=q,r.uuid=function(e,t){t=t||N.length;var r="",n=-1;if(e){for(;++n<e;)r+=N[M(t)];return r}for(;++n<36;)switch(n){case 8:case 13:case 18:case 23:r+="-";break;case 19:r+=N[3&M(16)|8];break;default:r+=N[M(16)]}return r}},{argsarray:65,debug:73,events:16,immediate:83,inherits:84,"pouchdb-collections":35,"pouchdb-errors":36,"pouchdb-promise":40,"pouchdb-utils":41}],42:[function(e,t,r){(function(t,n){"use strict";function i(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(r,"__esModule",{value:!0});var o=i(e("pouchdb-promise")),s=i(e("argsarray")),a=i(e("clone-buffer")),u=i(e("debug")),c=e("pouchdb-collections"),f=e("events"),l=i(e("inherits")),h=e("pouchdb-utils"),d=e("pouchdb-errors");var p=Function.prototype.toString,v=p.call(Object);function m(e){var t,r,i;if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(t=[],r=0,i=e.length;r<i;r++)t[r]=m(e[r]);return t}if(e instanceof Date)return e.toISOString();if(function(e){return e instanceof n}(e))return a(e);if(!function(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var r=t.constructor;return"function"==typeof r&&r instanceof r&&p.call(r)==v}(e))return e;for(r in t={},e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=m(e[r]);void 0!==o&&(t[r]=o)}return t}function g(e){var t=!1;return s(function(r){if(t)throw new Error("once called more than once");t=!0,e.apply(this,r)})}function y(e){return s(function(t){var r=this,n="function"==typeof(t=m(t))[t.length-1]&&t.pop(),i=new o(function(n,i){var o;try{var s=g(function(e,t){e?i(e):n(t)});t.push(s),(o=e.apply(r,t))&&"function"==typeof o.then&&n(o)}catch(e){i(e)}});return n&&i.then(function(e){n(null,e)},n),i})}var _=u("pouchdb:api");function b(e,t){for(var r={},n=0,i=t.length;n<i;n++){var o=t[n];o in e&&(r[o]=e[o])}return r}var w=6;function k(e){return e}function x(e){return[{ok:e}]}function E(){return!1}function S(){return!1}function R(){f.EventEmitter.call(this),this._listeners={}}l(R,f.EventEmitter),R.prototype.addListener=function(e,t,r,n){if(!this._listeners[t]){var i=this,o=!1;this._listeners[t]=s,this.on(e,s)}function s(){if(i._listeners[t])if(o)o="waiting";else{o=!0;var e=b(n,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);r.changes(e).on("change",function(e){e.seq>n.since&&!n.cancelled&&(n.since=e.seq,n.onChange(e))}).on("complete",function(){"waiting"===o&&h.nextTick(s),o=!1}).on("error",function(){o=!1})}}},R.prototype.removeListener=function(e,t){t in this._listeners&&(f.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},R.prototype.notifyLocalWindows=function(e){!1},R.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var j="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t};var T=function(){}.name?function(e){return e.name}:function(e){return e.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]};function D(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}var O=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],A="queryKey",B=/(?:^|&)([^&=]*)=?([^&]*)/g,C=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function L(e,t,r){return new o(function(n,i){e.get(t,function(o,s){if(o){if(404!==o.status)return i(o);s={}}var a=s._rev,u=r(s);if(!u)return n({updated:!1,rev:a});u._id=t,u._rev=a,n(function(e,t,r){return e.put(t).then(function(e){return{updated:!0,rev:e.rev}},function(n){if(409!==n.status)throw n;return L(e,t._id,r)})}(e,u,r))})})}var I="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");function q(e){return 0|Math.random()*e}r.adapterFun=function(e,t){return y(s(function(r){if(this._closed)return o.reject(new Error("database is closed"));if(this._destroyed)return o.reject(new Error("database is destroyed"));var n=this;return function(e,t,r){if(_.enabled){for(var n=[e.name,t],i=0;i<r.length-1;i++)n.push(r[i]);_.apply(null,n);var o=r[r.length-1];r[r.length-1]=function(r,n){var i=[e.name,t];i=i.concat(r?["error",r]:["success",n]),_.apply(null,i),o(r,n)}}}(n,e,r),this.taskqueue.isReady?t.apply(this,r):new o(function(t,i){n.taskqueue.addTask(function(o){o?i(o):t(n[e].apply(n,r))})})}))},r.bulkGetShim=function(e,t,r){var n=t.docs,i=new c.Map;n.forEach(function(e){i.has(e.id)?i.get(e.id).push(e):i.set(e.id,[e])});var o=i.size,s=0,a=new Array(o);function u(){var e;++s===o&&(e=[],a.forEach(function(t){t.docs.forEach(function(r){e.push({id:t.id,docs:[r]})})}),r(null,{results:e}))}var f=[];i.forEach(function(e,t){f.push(t)});var l=0;function h(){if(!(l>=f.length)){var r=Math.min(l+w,f.length),n=f.slice(l,r);!function(r,n){r.forEach(function(r,o){var s=n+o,c=i.get(r),f=b(c[0],["atts_since","attachments"]);f.open_revs=c.map(function(e){return e.rev}),f.open_revs=f.open_revs.filter(k);var l=k;0===f.open_revs.length&&(delete f.open_revs,l=x),["revs","attachments","binary","ajax","latest"].forEach(function(e){e in t&&(f[e]=t[e])}),e.get(r,f,function(e,t){var n,i,o;n=e?[{error:e}]:l(t),i=r,o=n,a[s]={id:i,docs:o},u(),h()})})}(n,l),l+=n.length}}h()},r.changesHandler=R,r.clone=m,r.defaultBackOff=function(e){var t=0;return e||(t=2e3),function(e,t){return e=parseInt(e,10)||0,(t=parseInt(t,10))!=t||t<=e?t=(e||1)<<1:t+=1,t>6e5&&(e=3e5,t=6e5),~~((t-e)*Math.random()+e)}(e,t)},r.explainError=function(){},r.assign=j,r.filterChange=function(e){var t={},r=e.filter&&"function"==typeof e.filter;return t.query=e.query_params,function(n){n.doc||(n.doc={});var i=r&&function(e,t,r){try{return!e(t,r)}catch(e){var n="Filter function threw: "+e.toString();return d.createError(d.BAD_REQUEST,n)}}(e.filter,n.doc,t);if("object"==typeof i)return i;if(i)return!1;if(e.include_docs){if(!e.attachments)for(var o in n.doc._attachments)n.doc._attachments.hasOwnProperty(o)&&(n.doc._attachments[o].stub=!0)}else delete n.doc;return!0}},r.flatten=function(e){for(var t=[],r=0,n=e.length;r<n;r++)t=t.concat(e[r]);return t},r.functionName=T,r.guardedConsole=function(e){if("undefined"!==console&&e in console){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}},r.hasLocalStorage=S,r.invalidIdError=function(e){var t;if(e?"string"!=typeof e?t=d.createError(d.INVALID_ID):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=d.createError(d.RESERVED_ID)):t=d.createError(d.MISSING_ID),t)throw t},r.isChromeApp=E,r.isCordova=function(){return"undefined"!=typeof cordova||"undefined"!=typeof PhoneGap||"undefined"!=typeof phonegap},r.listenerCount=function(e,t){return"listenerCount"in e?e.listenerCount(t):f.EventEmitter.listenerCount(e,t)},r.nextTick=function(e){t.nextTick(e)},r.normalizeDdocFunctionName=function(e){var t=D(e);return t?t.join("/"):null},r.once=g,r.parseDdocFunctionName=D,r.parseUri=function(e){for(var t=C.exec(e),r={},n=14;n--;){var i=O[n],o=t[n]||"",s=-1!==["user","password"].indexOf(i);r[i]=s?decodeURIComponent(o):o}return r[A]={},r[O[12]].replace(B,function(e,t,n){t&&(r[A][t]=n)}),r},r.pick=b,r.toPromise=y,r.upsert=L,r.uuid=function(e,t){t=t||I.length;var r="",n=-1;if(e){for(;++n<e;)r+=I[q(t)];return r}for(;++n<36;)switch(n){case 8:case 13:case 18:case 23:r+="-";break;case 19:r+=I[3&q(16)|8];break;default:r+=I[q(16)]}return r}}).call(this,e("_process"),e("buffer").Buffer)},{_process:43,argsarray:65,buffer:8,"clone-buffer":69,debug:73,events:16,inherits:84,"pouchdb-collections":35,"pouchdb-errors":36,"pouchdb-promise":40,"pouchdb-utils":41}],43:[function(e,t,r){var n,i=t.exports={},o=[],s=!1,a=-1;function u(){s=!1,n.length?o=n.concat(o):a=-1,o.length&&c()}function c(){if(!s){var e=setTimeout(u);s=!0;for(var t=o.length;t;){for(n=o,o=[];++a<t;)n[a].run();a=-1,t=o.length}n=null,s=!1,clearTimeout(e)}}function f(e,t){this.fun=e,this.array=t}function l(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];o.push(new f(e,t)),s||setTimeout(c,0)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=l,i.addListener=l,i.once=l,i.off=l,i.removeListener=l,i.removeAllListeners=l,i.emit=l,i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],44:[function(e,t,r){(function(e){t.exports=function(t){var r=[1732584193,4023233417,2562383102,271733878,3285377520];"string"==typeof t&&(t=new e(t,"utf8"));var n=u(t),i=8*t.length,o=8*t.length;n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8);for(var s=0;s<n.length;s+=16)f(r,n,s);for(var s=0;s<5;s++){var a=r[s];r[s]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}var l=c(r);return new e(l)};var r=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],n=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],i=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],o=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],s=[0,1518500249,1859775393,2400959708,2840853838],a=[1352829926,1548603684,1836072691,2053994217,0],u=function(e){for(var t=[],r=0,n=0;r<e.length;r++,n+=8)t[n>>>5]|=e[r]<<24-n%32;return t},c=function(e){for(var t=[],r=0;r<32*e.length;r+=8)t.push(e[r>>>5]>>>24-r%32&255);return t},f=function(e,t,u){for(var c=0;c<16;c++){var f=u+c,g=t[f];t[f]=16711935&(g<<8|g>>>24)|4278255360&(g<<24|g>>>8)}var y,_,b,w,k,x,E,S,R,j,T;x=y=e[0],E=_=e[1],S=b=e[2],R=w=e[3],j=k=e[4];for(c=0;c<80;c+=1)T=y+t[u+r[c]]|0,T+=c<16?l(_,b,w)+s[0]:c<32?h(_,b,w)+s[1]:c<48?d(_,b,w)+s[2]:c<64?p(_,b,w)+s[3]:v(_,b,w)+s[4],T=(T=m(T|=0,i[c]))+k|0,y=k,k=w,w=m(b,10),b=_,_=T,T=x+t[u+n[c]]|0,T+=c<16?v(E,S,R)+a[0]:c<32?p(E,S,R)+a[1]:c<48?d(E,S,R)+a[2]:c<64?h(E,S,R)+a[3]:l(E,S,R)+a[4],T=(T=m(T|=0,o[c]))+j|0,x=j,j=R,R=m(S,10),S=E,E=T;T=e[1]+b+R|0,e[1]=e[2]+w+j|0,e[2]=e[3]+k+x|0,e[3]=e[4]+y+E|0,e[4]=e[0]+_+S|0,e[0]=T};function l(e,t,r){return e^t^r}function h(e,t,r){return e&t|~e&r}function d(e,t,r){return(e|~t)^r}function p(e,t,r){return e&r|t&~r}function v(e,t,r){return e^(t|~r)}function m(e,t){return e<<t|e>>>32-t}}).call(this,e("buffer").Buffer)},{buffer:8}],45:[function(e,t,r){var n=e("./util"),i=n.write,o=n.zeroFill;t.exports=function(e){function t(t,r){this._block=new e(t),this._finalSize=r,this._blockSize=t,this._len=0,this._s=0}return t.prototype.init=function(){this._s=0,this._len=0},t.prototype.update=function(t,r){var n,o=this._blockSize;r||"string"!=typeof t||(r="utf8"),r?("utf-8"===r&&(r="utf8"),"base64"!==r&&"utf8"!==r||(t=new e(t,r),r=null),n=function(e,t){return null==t?e.byteLength||e.length:"ascii"==t||"binary"==t?e.length:"hex"==t?e.length/2:"base64"==t?e.length/3:void 0}(t,r)):n=t.byteLength||t.length;for(var s=this._len+=n,a=this._s=this._s||0,u=0,c=this._block;a<s;){var f=Math.min(n,u+o);i(c,t,r,a%o,u,f);var l=f-u;u+=l,(a+=l)%o||this._update(c)}return this._s=a,this},t.prototype.digest=function(e){var t=this._blockSize,r=this._finalSize,i=8*this._len,s=this._block,a=i%(8*t);s[this._len%t]=128,o(this._block,this._len%t+1),a>=8*r&&(this._update(this._block),n.zeroFill(this._block,0)),s.writeInt32BE(i,r+4);var u=this._update(this._block)||this._hash();return null==e?u:u.toString(e)},t.prototype._update=function(){throw new Error("_update must be implemented by subclass")},t}},{"./util":49}],46:[function(e,t,r){r=t.exports=function(e){var t=r[e];if(!t)throw new Error(e+" is not supported (we accept pull requests)");return new t};var n=e("buffer").Buffer,i=e("./hash")(n);r.sha=r.sha1=e("./sha1")(n,i),r.sha256=e("./sha256")(n,i)},{"./hash":45,"./sha1":47,"./sha256":48,buffer:8}],47:[function(e,t,r){t.exports=function(t,r){(0,e("util").inherits)(o,r);var n=new Int32Array(80),i=[];function o(){return i.length?i.pop().init():this instanceof o?(this._w=n,r.call(this,64,56),this._h=null,void this.init()):new o}o.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,r.prototype.init.call(this),this},o.prototype._POOL=i;new t(1),DataView;function s(e,t,r,n){return e<20?t&r|~t&n:e<40?t^r^n:e<60?t&r|t&n|r&n:t^r^n}function a(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function u(e,t){return e+t|0}function c(e,t){return e<<t|e>>>32-t}return o.prototype._update=function(e){var t,r,n,i,o,f,l,h,d,p,v=this._block;this._h;t=f=this._a,r=l=this._b,n=h=this._c,i=d=this._d,o=p=this._e;for(var m=this._w,g=0;g<80;g++){var y=m[g]=g<16?v.readInt32BE(4*g):c(m[g-3]^m[g-8]^m[g-14]^m[g-16],1),_=u(u(c(t,5),s(g,r,n,i)),u(u(o,y),a(g)));o=i,i=n,n=c(r,30),r=t,t=_}this._a=u(t,f),this._b=u(r,l),this._c=u(n,h),this._d=u(i,d),this._e=u(o,p)},o.prototype._hash=function(){i.length<100&&i.push(this);var e=new t(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},o}},{util:54}],48:[function(e,t,r){var n=e("util").inherits;e("./util");t.exports=function(e,t){var r=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];n(s,t);var i=new Array(64),o=[];function s(){o.length,this.init(),this._w=i,t.call(this,64,56)}s.prototype.init=function(){return this._a=1779033703,this._b=-1150833019,this._c=1013904242,this._d=-1521486534,this._e=1359893119,this._f=-1694144372,this._g=528734635,this._h=1541459225,this._len=this._s=0,this};function a(e,t){return e>>>t|e<<32-t}function u(e,t){return e>>>t}function c(e,t,r){return e&t^~e&r}function f(e,t,r){return e&t^e&r^t&r}function l(e){return a(e,2)^a(e,13)^a(e,22)}function h(e){return a(e,6)^a(e,11)^a(e,25)}function d(e){return a(e,7)^a(e,18)^u(e,3)}return s.prototype._update=function(e){var t,n,i,o,s,p,v,m,g,y,_,b=this._block,w=this._w;t=0|this._a,n=0|this._b,i=0|this._c,o=0|this._d,s=0|this._e,p=0|this._f,v=0|this._g,m=0|this._h;for(var k=0;k<64;k++){var x=w[k]=k<16?b.readInt32BE(4*k):(a(_=w[k-2],17)^a(_,19)^u(_,10))+w[k-7]+d(w[k-15])+w[k-16];g=m+h(s)+c(s,p,v)+r[k]+x,y=l(t)+f(t,n,i),m=v,v=p,p=s,s=o+g,o=i,i=n,n=t,t=g+y}this._a=t+this._a|0,this._b=n+this._b|0,this._c=i+this._c|0,this._d=o+this._d|0,this._e=s+this._e|0,this._f=p+this._f|0,this._g=v+this._g|0,this._h=m+this._h|0},s.prototype._hash=function(){o.length<10&&o.push(this);var t=new e(32);return t.writeInt32BE(this._a,0),t.writeInt32BE(this._b,4),t.writeInt32BE(this._c,8),t.writeInt32BE(this._d,12),t.writeInt32BE(this._e,16),t.writeInt32BE(this._f,20),t.writeInt32BE(this._g,24),t.writeInt32BE(this._h,28),t},s}},{"./util":49,util:54}],49:[function(e,t,r){r.write=function(e,t,r,n,i,o,s){var a=o-i;if("ascii"===r||"binary"===r)for(var u=0;u<a;u++)e[n+u]=t.charCodeAt(u+i);else if(null==r)for(var u=0;u<a;u++)e[n+u]=t[u+i];else{if("hex"!==r)throw"base64"===r?new Error("base64 encoding not yet supported"):new Error(r+" encoding not yet supported");for(var u=0;u<a;u++){var c=i+u;e[n+u]=parseInt(t[2*c]+t[2*c+1],16)}}},r.zeroFill=function(e,t){for(var r=t;r<e.length;r++)e[r]=0},r.toString=toString},{}],50:[function(e,t,r){t.exports=i;var n=e("events").EventEmitter;function i(){n.call(this)}e("inherits")(i,n),i.Readable=e("readable-stream/readable.js"),i.Writable=e("readable-stream/writable.js"),i.Duplex=e("readable-stream/duplex.js"),i.Transform=e("readable-stream/transform.js"),i.PassThrough=e("readable-stream/passthrough.js"),i.Stream=i,i.prototype.pipe=function(e,t){var r=this;function i(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function o(){r.readable&&r.resume&&r.resume()}r.on("data",i),e.on("drain",o),e._isStdio||t&&!1===t.end||(r.on("end",a),r.on("close",u));var s=!1;function a(){s||(s=!0,e.end())}function u(){s||(s=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(f(),0===n.listenerCount(this,"error"))throw e}function f(){r.removeListener("data",i),e.removeListener("drain",o),r.removeListener("end",a),r.removeListener("close",u),r.removeListener("error",c),e.removeListener("error",c),r.removeListener("end",f),r.removeListener("close",f),e.removeListener("close",f)}return r.on("error",c),e.on("error",c),r.on("end",f),r.on("close",f),e.on("close",f),e.emit("pipe",r),e}},{events:16,inherits:84,"readable-stream/duplex.js":124,"readable-stream/passthrough.js":131,"readable-stream/readable.js":132,"readable-stream/transform.js":133,"readable-stream/writable.js":134}],51:[function(e,t,r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var i=n(e("ltgt")),o=n(e("events")),s=n(e("inherits")),a=n(e("level-codec")),u=n(e("readable-stream"));function c(e){return"function"==typeof e.prefix?e.prefix():e}function f(){Error.call(this)}s(f,Error),f.prototype.name="NotFoundError";var l=o.EventEmitter,h=new f,d=function(e,t,r,n){var i=new l;function o(e){var t,r={};if(n)for(t in n)void 0!==n[t]&&(r[t]=n[t]);if(e)for(t in e)void 0!==e[t]&&(r[t]=e[t]);return r}return i.sublevels={},i.options=n,i.version="6.5.4",i.methods={},t=t||[],i.put=function(r,n,s,a){"function"==typeof s&&(a=s,s={}),e.apply([{key:r,value:n,prefix:t.slice(),type:"put"}],o(s),function(e){if(e)return a(e);i.emit("put",r,n),a(null)})},i.prefix=function(){return t.slice()},i.batch=function(r,n,s){"function"==typeof n&&(s=n,n={}),r=r.map(function(e){return{key:e.key,value:e.value,prefix:e.prefix||t,keyEncoding:e.keyEncoding,valueEncoding:e.valueEncoding,type:e.type}}),e.apply(r,o(n),function(e){if(e)return s(e);i.emit("batch",r),s(null)})},i.get=function(r,n,i){"function"==typeof n&&(i=n,n={}),e.get(r,t,o(n),function(e,t){e?i(h):i(null,t)})},i.sublevel=function(n,s){return i.sublevels[n]=i.sublevels[n]||d(e,t.concat(n),r,o(s))},i.readStream=i.createReadStream=function(n){var i;(n=o(n)).prefix=t;var s=e.iterator(n);return(i=r(n,e.createDecoder(n))).setIterator(s),i},i.close=function(t){e.close(t)},i.isOpen=e.isOpen,i.isClosed=e.isClosed,i},p=u.Readable;function v(e,t){if(!(this instanceof v))return new v(e,t);p.call(this,{objectMode:!0,highWaterMark:e.highWaterMark}),this._waiting=!1,this._options=e,this._makeData=t}s(v,p),v.prototype.setIterator=function(e){return this._iterator=e,this._destroyed?e.end(function(){}):this._waiting?(this._waiting=!1,this._read()):this},v.prototype._read=function(){var e=this;if(!e._destroyed)return e._iterator?void e._iterator.next(function(t,r,n){if(t||void 0===r&&void 0===n)return t||e._destroyed||e.push(null),e._cleanup(t);n=e._makeData(r,n),e._destroyed||e.push(n)}):this._waiting=!0},v.prototype._cleanup=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;e&&t.emit("error",e),t._iterator?t._iterator.end(function(){t._iterator=null,t.emit("close")}):t.emit("close")}},v.prototype.destroy=function(){this._cleanup()};var m={encode:function(e){return""+e[0]+""+e[1]},decode:function(e){var t=e.toString(),r=t.indexOf("",1);return[t.substring(1,r),t.substring(r+1)]},lowerBound:"\0",upperBound:""},g=new a;t.exports=function(e){return d(function(e,t,r){function n(e,n,i,o){return t.encode([e,r.encodeKey(n,i,o)])}function o(e,t){return t&&t.options&&(e.keyEncoding=e.keyEncoding||t.options.keyEncoding,e.valueEncoding=e.valueEncoding||t.options.valueEncoding),e}return e.open(function(){}),{apply:function(t,i,s){i=i||{};for(var a=[],u=-1,f=t.length;++u<f;){var l=t[u];o(l,l.prefix),l.prefix=c(l.prefix),a.push({key:n(l.prefix,l.key,i,l),value:"del"!==l.type&&r.encodeValue(l.value,i,l),type:l.type})}e.db.batch(a,i,s)},get:function(t,i,o,s){return o.asBuffer=r.valueAsBuffer(o),e.db.get(n(i,t,o),o,function(e,t){e?s(e):s(null,r.decodeValue(t,o))})},createDecoder:function(e){return function(n,i){return{key:r.decodeKey(t.decode(n)[1],e),value:r.decodeValue(i,e)}}},isClosed:function(){return e.isClosed()},close:function(t){return e.close(t)},iterator:function(o){var s,a=function(e){var t={};for(var r in e)t[r]=e[r];return t}(o||{}),u=o.prefix||[];return i.toLtgt(o,a,function(e){return n(u,e,a,{})},t.lowerBound,t.upperBound),a.prefix=null,a.keyAsBuffer=a.valueAsBuffer=!1,"number"!=typeof a.limit&&(a.limit=-1),a.keyAsBuffer=t.buffer,a.valueAsBuffer=r.valueAsBuffer(a),s=e.db.iterator(a),{next:function(e){return s.next(e)},end:function(e){s.end(e)}}}}}(e,m,g),[],v,e.options)}},{events:16,inherits:84,"level-codec":93,ltgt:107,"readable-stream":118}],52:[function(e,t,r){r.isatty=function(){return!1},r.ReadStream=function(){throw new Error("tty.ReadStream is not implemented")},r.WriteStream=function(){throw new Error("tty.ReadStream is not implemented")}},{}],53:[function(e,t,r){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.binarySlice}},{}],54:[function(e,t,r){(function(t,n){var i=/%[sdj%]/g;r.format=function(e){if(!g(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(a(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,o=n.length,s=String(e).replace(i,function(e){if("%%"===e)return"%";if(r>=o)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),u=n[r];r<o;u=n[++r])v(u)||!b(u)?s+=" "+u:s+=" "+a(u);return s},r.deprecate=function(e,i){if(y(n.process))return function(){return r.deprecate(e,i).apply(this,arguments)};if(!0===t.noDeprecation)return e;var o=!1;return function(){if(!o){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),o=!0}return e.apply(this,arguments)}};var o,s={};function a(e,t){var n={seen:[],stylize:c};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),p(t)?n.showHidden=t:t&&r._extend(n,t),y(n.showHidden)&&(n.showHidden=!1),y(n.depth)&&(n.depth=2),y(n.colors)&&(n.colors=!1),y(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=u),f(n,e,n.depth)}function u(e,t){var r=a.styles[t];return r?"["+a.colors[r][0]+"m"+e+"["+a.colors[r][1]+"m":e}function c(e,t){return e}function f(e,t,n){if(e.customInspect&&t&&x(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(n,e);return g(i)||(i=f(e,i,n)),i}var o=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(g(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(m(t))return e.stylize(""+t,"number");if(p(t))return e.stylize(""+t,"boolean");if(v(t))return e.stylize("null","null")}(e,t);if(o)return o;var s=Object.keys(t),a=function(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),0===s.length){if(x(t)){var u=t.name?": "+t.name:"";return e.stylize("[Function"+u+"]","special")}if(_(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(w(t))return e.stylize(Date.prototype.toString.call(t),"date");if(k(t))return l(t)}var c,b="",E=!1,S=["{","}"];(d(t)&&(E=!0,S=["[","]"]),x(t))&&(b=" [Function"+(t.name?": "+t.name:"")+"]");return _(t)&&(b=" "+RegExp.prototype.toString.call(t)),w(t)&&(b=" "+Date.prototype.toUTCString.call(t)),k(t)&&(b=" "+l(t)),0!==s.length||E&&0!=t.length?n<0?_(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),c=E?function(e,t,r,n,i){for(var o=[],s=0,a=t.length;s<a;++s)j(t,String(s))?o.push(h(e,t,r,n,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(h(e,t,r,n,i,!0))}),o}(e,t,n,a,s):s.map(function(r){return h(e,t,n,a,r,E)}),e.seen.pop(),function(e,t,r){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(c,b,S)):S[0]+b+S[1]}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,t,r,n,i,o){var s,a,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(a=e.stylize("[Setter]","special")),j(n,i)||(s="["+i+"]"),a||(e.seen.indexOf(u.value)<0?(a=v(r)?f(e,u.value,null):f(e,u.value,r-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),y(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function d(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function v(e){return null===e}function m(e){return"number"==typeof e}function g(e){return"string"==typeof e}function y(e){return void 0===e}function _(e){return b(e)&&"[object RegExp]"===E(e)}function b(e){return"object"==typeof e&&null!==e}function w(e){return b(e)&&"[object Date]"===E(e)}function k(e){return b(e)&&("[object Error]"===E(e)||e instanceof Error)}function x(e){return"function"==typeof e}function E(e){return Object.prototype.toString.call(e)}function S(e){return e<10?"0"+e.toString(10):e.toString(10)}r.debuglog=function(e){if(y(o)&&(o=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!s[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var n=t.pid;s[e]=function(){var t=r.format.apply(r,arguments);console.error("%s %d: %s",e,n,t)}}else s[e]=function(){};return s[e]},r.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=d,r.isBoolean=p,r.isNull=v,r.isNullOrUndefined=function(e){return null==e},r.isNumber=m,r.isString=g,r.isSymbol=function(e){return"symbol"==typeof e},r.isUndefined=y,r.isRegExp=_,r.isObject=b,r.isDate=w,r.isError=k,r.isFunction=x,r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},r.isBuffer=e("./support/isBuffer");var R=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function j(e,t){return Object.prototype.hasOwnProperty.call(e,t)}r.log=function(){var e,t;console.log("%s - %s",(e=new Date,t=[S(e.getHours()),S(e.getMinutes()),S(e.getSeconds())].join(":"),[e.getDate(),R[e.getMonth()],t].join(" ")),r.format.apply(r,arguments))},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!b(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":53,_process:43,inherits:25}],55:[function(e,t,r){arguments[4][1][0].apply(r,arguments)},{_process:43,dup:1}],56:[function(e,t,r){arguments[4][2][0].apply(r,arguments)},{_process:43,dup:2}],57:[function(e,t,r){(function(r,n){var i=e("xtend"),o=e("./abstract-iterator"),s=e("./abstract-chained-batch");function a(e){if(!arguments.length||void 0===e)throw new Error("constructor requires at least a location argument");if("string"!=typeof e)throw new Error("constructor requires a location string argument");this.location=e,this.status="new"}a.prototype.open=function(e,t){var r=this,i=this.status;if("function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("open() requires a callback argument");"object"!=typeof e&&(e={}),e.createIfMissing=0!=e.createIfMissing,e.errorIfExists=!!e.errorIfExists,"function"==typeof this._open?(this.status="opening",this._open(e,function(e){if(e)return r.status=i,t(e);r.status="open",t()})):(this.status="open",n.nextTick(t))},a.prototype.close=function(e){var t=this,r=this.status;if("function"!=typeof e)throw new Error("close() requires a callback argument");"function"==typeof this._close?(this.status="closing",this._close(function(n){if(n)return t.status=r,e(n);t.status="closed",e()})):(this.status="closed",n.nextTick(e))},a.prototype.get=function(e,t,r){var i;if("function"==typeof t&&(r=t),"function"!=typeof r)throw new Error("get() requires a callback argument");return(i=this._checkKey(e,"key",this._isBuffer))?r(i):(this._isBuffer(e)||(e=String(e)),"object"!=typeof t&&(t={}),t.asBuffer=0!=t.asBuffer,"function"==typeof this._get?this._get(e,t,r):void n.nextTick(function(){r(new Error("NotFound"))}))},a.prototype.put=function(e,t,r,i){var o;if("function"==typeof r&&(i=r),"function"!=typeof i)throw new Error("put() requires a callback argument");return(o=this._checkKey(e,"key",this._isBuffer))?i(o):(this._isBuffer(e)||(e=String(e)),null==t||this._isBuffer(t)||n.browser||(t=String(t)),"object"!=typeof r&&(r={}),"function"==typeof this._put?this._put(e,t,r,i):void n.nextTick(i))},a.prototype.del=function(e,t,r){var i;if("function"==typeof t&&(r=t),"function"!=typeof r)throw new Error("del() requires a callback argument");return(i=this._checkKey(e,"key",this._isBuffer))?r(i):(this._isBuffer(e)||(e=String(e)),"object"!=typeof t&&(t={}),"function"==typeof this._del?this._del(e,t,r):void n.nextTick(r))},a.prototype.batch=function(e,t,r){if(!arguments.length)return this._chainedBatch();if("function"==typeof t&&(r=t),"function"==typeof e&&(r=e),"function"!=typeof r)throw new Error("batch(array) requires a callback argument");if(!Array.isArray(e))return r(new Error("batch(array) requires an array argument"));t&&"object"==typeof t||(t={});for(var i,o,s=0,a=e.length;s<a;s++)if("object"==typeof(i=e[s])){if(o=this._checkKey(i.type,"type",this._isBuffer))return r(o);if(o=this._checkKey(i.key,"key",this._isBuffer))return r(o)}if("function"==typeof this._batch)return this._batch(e,t,r);n.nextTick(r)},a.prototype.approximateSize=function(e,t,r){if(null==e||null==t||"function"==typeof e||"function"==typeof t)throw new Error("approximateSize() requires valid `start`, `end` and `callback` arguments");if("function"!=typeof r)throw new Error("approximateSize() requires a callback argument");if(this._isBuffer(e)||(e=String(e)),this._isBuffer(t)||(t=String(t)),"function"==typeof this._approximateSize)return this._approximateSize(e,t,r);n.nextTick(function(){r(null,0)})},a.prototype._setupIteratorOptions=function(e){var t=this;return e=i(e),["start","end","gt","gte","lt","lte"].forEach(function(r){e[r]&&t._isBuffer(e[r])&&0===e[r].length&&delete e[r]}),e.reverse=!!e.reverse,e.keys=0!=e.keys,e.values=0!=e.values,e.limit="limit"in e?e.limit:-1,e.keyAsBuffer=0!=e.keyAsBuffer,e.valueAsBuffer=0!=e.valueAsBuffer,e},a.prototype.iterator=function(e){return"object"!=typeof e&&(e={}),e=this._setupIteratorOptions(e),"function"==typeof this._iterator?this._iterator(e):new o(this)},a.prototype._chainedBatch=function(){return new s(this)},a.prototype._isBuffer=function(e){return r.isBuffer(e)},a.prototype._checkKey=function(e,t){if(null===e||void 0===e)return new Error(t+" cannot be `null` or `undefined`");if(this._isBuffer(e)){if(0===e.length)return new Error(t+" cannot be an empty Buffer")}else if(""===String(e))return new Error(t+" cannot be an empty String")},t.exports=a}).call(this,{isBuffer:e("../../../dev-deps/is-buffer/1.1.0/index.js")},e("_process"))},{"../../../dev-deps/is-buffer/1.1.0/index.js":26,"./abstract-chained-batch":55,"./abstract-iterator":56,_process:43,xtend:142}],58:[function(e,t,r){arguments[4][4][0].apply(r,arguments)},{"./abstract-chained-batch":55,"./abstract-iterator":56,"./abstract-leveldown":57,"./is-leveldown":59,dup:4}],59:[function(e,t,r){const n=e("./abstract-leveldown");t.exports=function(e){return!(!e||"object"!=typeof e)&&Object.keys(n.prototype).filter(function(e){return"_"!=e[0]&&"approximateSize"!=e}).every(function(t){return"function"==typeof e[t]})}},{"./abstract-leveldown":57}],60:[function(e,t,r){(function(e){function r(e){this._db=e,this._operations=[],this._written=!1}r.prototype._serializeKey=function(e){return this._db._serializeKey(e)},r.prototype._serializeValue=function(e){return this._db._serializeValue(e)},r.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},r.prototype.put=function(e,t){this._checkWritten();var r=this._db._checkKey(e,"key",this._db._isBuffer);if(r)throw r;return e=this._serializeKey(e),t=this._serializeValue(t),"function"==typeof this._put?this._put(e,t):this._operations.push({type:"put",key:e,value:t}),this},r.prototype.del=function(e){this._checkWritten();var t=this._db._checkKey(e,"key",this._db._isBuffer);if(t)throw t;return e=this._serializeKey(e),"function"==typeof this._del?this._del(e):this._operations.push({type:"del",key:e}),this},r.prototype.clear=function(){return this._checkWritten(),this._operations=[],"function"==typeof this._clear&&this._clear(),this},r.prototype.write=function(t,r){if(this._checkWritten(),"function"==typeof t&&(r=t),"function"!=typeof r)throw new Error("write() requires a callback argument");return"object"!=typeof t&&(t={}),this._written=!0,"function"==typeof this._write?this._write(r):"function"==typeof this._db._batch?this._db._batch(this._operations,t,r):void e.nextTick(r)},t.exports=r}).call(this,e("_process"))},{_process:43}],61:[function(e,t,r){arguments[4][2][0].apply(r,arguments)},{_process:43,dup:2}],62:[function(e,t,r){(function(r,n){var i=e("xtend"),o=e("./abstract-iterator"),s=e("./abstract-chained-batch");function a(e){if(!arguments.length||void 0===e)throw new Error("constructor requires at least a location argument");if("string"!=typeof e)throw new Error("constructor requires a location string argument");this.location=e,this.status="new"}a.prototype.open=function(e,t){var r=this,i=this.status;if("function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("open() requires a callback argument");"object"!=typeof e&&(e={}),e.createIfMissing=0!=e.createIfMissing,e.errorIfExists=!!e.errorIfExists,"function"==typeof this._open?(this.status="opening",this._open(e,function(e){if(e)return r.status=i,t(e);r.status="open",t()})):(this.status="open",n.nextTick(t))},a.prototype.close=function(e){var t=this,r=this.status;if("function"!=typeof e)throw new Error("close() requires a callback argument");"function"==typeof this._close?(this.status="closing",this._close(function(n){if(n)return t.status=r,e(n);t.status="closed",e()})):(this.status="closed",n.nextTick(e))},a.prototype.get=function(e,t,r){var i;if("function"==typeof t&&(r=t),"function"!=typeof r)throw new Error("get() requires a callback argument");return(i=this._checkKey(e,"key"))?r(i):(e=this._serializeKey(e),"object"!=typeof t&&(t={}),t.asBuffer=0!=t.asBuffer,"function"==typeof this._get?this._get(e,t,r):void n.nextTick(function(){r(new Error("NotFound"))}))},a.prototype.put=function(e,t,r,i){var o;if("function"==typeof r&&(i=r),"function"!=typeof i)throw new Error("put() requires a callback argument");return(o=this._checkKey(e,"key"))?i(o):(e=this._serializeKey(e),t=this._serializeValue(t),"object"!=typeof r&&(r={}),"function"==typeof this._put?this._put(e,t,r,i):void n.nextTick(i))},a.prototype.del=function(e,t,r){var i;if("function"==typeof t&&(r=t),"function"!=typeof r)throw new Error("del() requires a callback argument");return(i=this._checkKey(e,"key"))?r(i):(e=this._serializeKey(e),"object"!=typeof t&&(t={}),"function"==typeof this._del?this._del(e,t,r):void n.nextTick(r))},a.prototype.batch=function(e,t,r){if(!arguments.length)return this._chainedBatch();if("function"==typeof t&&(r=t),"function"==typeof e&&(r=e),"function"!=typeof r)throw new Error("batch(array) requires a callback argument");if(!Array.isArray(e))return r(new Error("batch(array) requires an array argument"));t&&"object"==typeof t||(t={});for(var i,o,s=0,a=e.length;s<a;s++)if("object"==typeof(i=e[s])){if(o=this._checkKey(i.type,"type"))return r(o);if(o=this._checkKey(i.key,"key"))return r(o)}if("function"==typeof this._batch)return this._batch(e,t,r);n.nextTick(r)},a.prototype.approximateSize=function(e,t,r){if(null==e||null==t||"function"==typeof e||"function"==typeof t)throw new Error("approximateSize() requires valid `start`, `end` and `callback` arguments");if("function"!=typeof r)throw new Error("approximateSize() requires a callback argument");if(e=this._serializeKey(e),t=this._serializeKey(t),"function"==typeof this._approximateSize)return this._approximateSize(e,t,r);n.nextTick(function(){r(null,0)})},a.prototype._setupIteratorOptions=function(e){var t=this;return e=i(e),["start","end","gt","gte","lt","lte"].forEach(function(r){e[r]&&t._isBuffer(e[r])&&0===e[r].length&&delete e[r]}),e.reverse=!!e.reverse,e.keys=0!=e.keys,e.values=0!=e.values,e.limit="limit"in e?e.limit:-1,e.keyAsBuffer=0!=e.keyAsBuffer,e.valueAsBuffer=0!=e.valueAsBuffer,e},a.prototype.iterator=function(e){return"object"!=typeof e&&(e={}),e=this._setupIteratorOptions(e),"function"==typeof this._iterator?this._iterator(e):new o(this)},a.prototype._chainedBatch=function(){return new s(this)},a.prototype._isBuffer=function(e){return r.isBuffer(e)},a.prototype._serializeKey=function(e){return this._isBuffer(e)?e:String(e)},a.prototype._serializeValue=function(e){return this._isBuffer(e)||n.browser||null==e?e:String(e)},a.prototype._checkKey=function(e,t){return null===e||void 0===e?new Error(t+" cannot be `null` or `undefined`"):this._isBuffer(e)&&0===e.length?new Error(t+" cannot be an empty Buffer"):""===String(e)?new Error(t+" cannot be an empty String"):void 0},t.exports=a}).call(this,{isBuffer:e("../../../dev-deps/is-buffer/1.1.0/index.js")},e("_process"))},{"../../../dev-deps/is-buffer/1.1.0/index.js":26,"./abstract-chained-batch":60,"./abstract-iterator":61,_process:43,xtend:142}],63:[function(e,t,r){arguments[4][4][0].apply(r,arguments)},{"./abstract-chained-batch":60,"./abstract-iterator":61,"./abstract-leveldown":62,"./is-leveldown":64,dup:4}],64:[function(e,t,r){arguments[4][5][0].apply(r,arguments)},{"./abstract-leveldown":62,dup:5}],65:[function(e,t,r){"use strict";t.exports=function(e){return function(){var t=arguments.length;if(t){for(var r=[],n=-1;++n<t;)r[n]=arguments[n];return e.call(this,r)}return e.call(this,[])}}},{}],66:[function(e,t,r){(function(n,i){var o=e("fs"),s=e("path"),a=s.join,u=s.dirname,c=o.existsSync||s.existsSync,f={arrow:n.env.NODE_BINDINGS_ARROW||"  ",compiled:n.env.NODE_BINDINGS_COMPILED_DIR||"compiled",platform:n.platform,arch:n.arch,version:n.versions.node,bindings:"bindings.node",try:[["module_root","build","bindings"],["module_root","build","Debug","bindings"],["module_root","build","Release","bindings"],["module_root","out","Debug","bindings"],["module_root","Debug","bindings"],["module_root","out","Release","bindings"],["module_root","Release","bindings"],["module_root","build","default","bindings"],["module_root","compiled","version","platform","arch","bindings"]]};t.exports=r=function(t){"string"==typeof t?t={bindings:t}:t||(t={}),t.__proto__=f,t.module_root||(t.module_root=r.getRoot(r.getFileName())),".node"!=s.extname(t.bindings)&&(t.bindings+=".node");for(var n,i,o,u=[],c=0,l=t.try.length;c<l;c++){n=a.apply(null,t.try[c].map(function(e){return t[e]||e})),u.push(n);try{return i=t.path?e.resolve(n):e(n),t.path||(i.path=n),i}catch(e){if(!/not find/i.test(e.message))throw e}}throw(o=new Error("Could not locate the bindings file. Tried:\n"+u.map(function(e){return t.arrow+e}).join("\n"))).tries=u,o},r.getFileName=function(e){var t,r=Error.prepareStackTrace,n=Error.stackTraceLimit,o={};return Error.stackTraceLimit=10,Error.prepareStackTrace=function(r,n){for(var o=0,s=n.length;o<s;o++)if((t=n[o].getFileName())!==i){if(!e)return;if(t!==e)return}},Error.captureStackTrace(o),Error.prepareStackTrace=r,Error.stackTraceLimit=n,t},r.getRoot=function(e){for(var t,r=u(e);;){if("."===r&&(r=n.cwd()),c(a(r,"package.json"))||c(a(r,"node_modules")))return r;if(t===r)throw new Error('Could not find module root given file: "'+e+'". Do you have a `package.json` file? ');t=r,r=a(r,"..")}}}).call(this,e("_process"),"/../lively.next-node_modules/bindings/1.2.1/bindings.js")},{_process:43,fs:7,path:30}],67:[function(e,t,r){(function(r){var n=e("is-array-buffer-x"),i="function"==typeof r.alloc&&"function"==typeof r.allocUnsafe&&"function"==typeof r.from;t.exports=function(e,t,o){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return n(e)?function(e,t,n){t>>>=0;var o=e.byteLength-t;if(o<0)throw new RangeError("'offset' is out of bounds");if(void 0===n)n=o;else if((n>>>=0)>o)throw new RangeError("'length' is out of bounds");return i?r.from(e.slice(t,t+n)):new r(new Uint8Array(e.slice(t,t+n)))}(e,t,o):"string"==typeof e?function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!r.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');return i?r.from(e,t):new r(e,t)}(e,t):i?r.from(e):new r(e)}}).call(this,e("buffer").Buffer)},{buffer:8,"is-array-buffer-x":85}],68:[function(e,t,r){(function(t){"use strict";var n=e("buffer"),i=n.Buffer,o=n.SlowBuffer,s=n.kMaxLength||2147483647;r.alloc=function(e,t,r){if("function"==typeof i.alloc)return i.alloc(e,t,r);if("number"==typeof r)throw new TypeError("encoding must not be number");if("number"!=typeof e)throw new TypeError("size must be a number");if(e>s)throw new RangeError("size is too large");var n=r,o=t;void 0===o&&(n=void 0,o=0);var a=new i(e);if("string"==typeof o)for(var u=new i(o,n),c=u.length,f=-1;++f<e;)a[f]=u[f%c];else a.fill(o);return a},r.allocUnsafe=function(e){if("function"==typeof i.allocUnsafe)return i.allocUnsafe(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(e>s)throw new RangeError("size is too large");return new i(e)},r.from=function(e,r,n){if("function"==typeof i.from&&(!t.Uint8Array||Uint8Array.from!==i.from))return i.from(e,r,n);if("number"==typeof e)throw new TypeError('"value" argument must not be a number');if("string"==typeof e)return new i(e,r);if("undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer){var o=r;if(1===arguments.length)return new i(e);void 0===o&&(o=0);var s=n;if(void 0===s&&(s=e.byteLength-o),o>=e.byteLength)throw new RangeError("'offset' is out of bounds");if(s>e.byteLength-o)throw new RangeError("'length' is out of bounds");return new i(e.slice(o,o+s))}if(i.isBuffer(e)){var a=new i(e.length);return e.copy(a,0,0,e.length),a}if(e){if(Array.isArray(e)||"undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return new i(e);if("Buffer"===e.type&&Array.isArray(e.data))return new i(e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")},r.allocUnsafeSlow=function(e){if("function"==typeof i.allocUnsafeSlow)return i.allocUnsafeSlow(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(e>=s)throw new RangeError("size is too large");return new o(e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{buffer:8}],69:[function(e,t,r){"use strict";var n=e("buffer").Buffer;function i(){return n.hasOwnProperty("from")&&"function"==typeof n.from}function o(e){if(!n.isBuffer(e))throw new Error("Can only clone Buffer.");if(i())return n.from(e);var t=new n(e.length);return e.copy(t),t}o.hasFrom=i,t.exports=o},{buffer:8}],70:[function(e,t,r){(function(e){function t(e){return"object"==typeof e&&null!==e}function n(e){return Object.prototype.toString.call(e)}r.isArray=function(e){return Array.isArray(e)},r.isBoolean=function(e){return"boolean"==typeof e},r.isNull=function(e){return null===e},r.isNullOrUndefined=function(e){return null==e},r.isNumber=function(e){return"number"==typeof e},r.isString=function(e){return"string"==typeof e},r.isSymbol=function(e){return"symbol"==typeof e},r.isUndefined=function(e){return void 0===e},r.isRegExp=function(e){return t(e)&&"[object RegExp]"===n(e)},r.isObject=t,r.isDate=function(e){return t(e)&&"[object Date]"===n(e)},r.isError=function(e){return t(e)&&"[object Error]"===n(e)},r.isFunction=function(e){return"function"==typeof e},r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},r.isBuffer=function(t){return t instanceof e}}).call(this,e("buffer").Buffer)},{buffer:8}],71:[function(e,t,r){(function(n){function i(){try{return r.storage.debug}catch(e){}if(void 0!==n&&"env"in n)return n.env.DEBUG}(r=t.exports=e("./debug")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},r.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+r.humanize(this.diff),!t)return;var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(o=++i)}),e.splice(o,0,n)},r.save=function(e){try{null==e?r.storage.removeItem("debug"):r.storage.debug=e}catch(e){}},r.load=i,r.useColors=function(){if("undefined"!=typeof window&&window&&void 0!==window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document&&"WebkitAppearance"in document.documentElement.style||"undefined"!=typeof window&&window&&window.console&&(console.firebug||console.exception&&console.table)||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},r.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),r.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],r.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},r.enable(i())}).call(this,e("_process"))},{"./debug":72,_process:43}],72:[function(e,t,r){var n;function i(e){function t(){if(t.enabled){var e=t,i=+new Date,o=i-(n||i);e.diff=o,e.prev=n,e.curr=i,n=i;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=r.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var u=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(t,n){if("%%"===t)return t;u++;var i=r.formatters[n];if("function"==typeof i){var o=s[u];t=i.call(e,o),s.splice(u,1),u--}return t}),r.formatArgs.call(e,s),(t.log||r.log||console.log.bind(console)).apply(e,s)}}return t.namespace=e,t.enabled=r.enabled(e),t.useColors=r.useColors(),t.color=function(e){var t,n=0;for(t in e)n=(n<<5)-n+e.charCodeAt(t),n|=0;return r.colors[Math.abs(n)%r.colors.length]}(e),"function"==typeof r.init&&r.init(t),t}(r=t.exports=i.debug=i.default=i).coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){r.enable("")},r.enable=function(e){r.save(e);for(var t=(e||"").split(/[\s,]+/),n=t.length,i=0;i<n;i++)t[i]&&("-"===(e=t[i].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")))},r.enabled=function(e){var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=e("ms"),r.names=[],r.skips=[],r.formatters={}},{ms:108}],73:[function(e,t,r){(function(r){void 0!==r&&"renderer"===r.type?t.exports=e("./browser.js"):t.exports=e("./node.js")}).call(this,e("_process"))},{"./browser.js":71,"./node.js":74,_process:43}],74:[function(e,t,r){(function(n){var i=e("tty"),o=e("util");(r=t.exports=e("./debug")).init=function(e){e.inspectOpts=o._extend({},r.inspectOpts)},r.log=function(){return a.write(o.format.apply(o,arguments)+"\n")},r.formatArgs=function(e){var t=this.namespace;if(this.useColors){var n=this.color,i="  [3"+n+";1m"+t+" [0m";e[0]=i+e[0].split("\n").join("\n"+i),e.push("[3"+n+"m+"+r.humanize(this.diff)+"[0m")}else e[0]=(new Date).toUTCString()+" "+t+" "+e[0]},r.save=function(e){null==e?delete n.env.DEBUG:n.env.DEBUG=e},r.load=u,r.useColors=function(){return"colors"in r.inspectOpts?Boolean(r.inspectOpts.colors):i.isatty(s)},r.colors=[6,2,3,4,5,1],r.inspectOpts=Object.keys(n.env).filter(function(e){return/^debug_/i.test(e)}).reduce(function(e,t){var r=t.substring(6).toLowerCase().replace(/_([a-z])/,function(e,t){return t.toUpperCase()}),i=n.env[t];return i=!!/^(yes|on|true|enabled)$/i.test(i)||!/^(no|off|false|disabled)$/i.test(i)&&("null"===i?null:Number(i)),e[r]=i,e},{}),"DEBUG_FD"in n.env&&o.deprecate(function(){},"`DEBUG_FD` is deprecated. Override `debug.log` if you want to use a different log function (https://git.io/vMUyr)")();var s=parseInt(n.env.DEBUG_FD,10)||2,a=1===s?n.stdout:2===s?n.stderr:function(t){var r;switch(n.binding("tty_wrap").guessHandleType(t)){case"TTY":(r=new i.WriteStream(t))._type="tty",r._handle&&r._handle.unref&&r._handle.unref();break;case"FILE":var o=e("fs");(r=new o.SyncWriteStream(t,{autoClose:!1}))._type="fs";break;case"PIPE":case"TCP":var s=e("net");(r=new s.Socket({fd:t,readable:!1,writable:!0})).readable=!1,r.read=null,r._type="pipe",r._handle&&r._handle.unref&&r._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return r.fd=t,r._isStdio=!0,r}(s);function u(){return n.env.DEBUG}r.formatters.o=function(e){return this.inspectOpts.colors=this.useColors,o.inspect(e,this.inspectOpts).replace(/\s*\n\s*/g," ")},r.formatters.O=function(e){return this.inspectOpts.colors=this.useColors,o.inspect(e,this.inspectOpts)},r.enable(u())}).call(this,e("_process"))},{"./debug":72,_process:43,fs:7,net:7,tty:52,util:54}],75:[function(e,t,r){var n=e("util"),i=e("abstract-leveldown").AbstractIterator;function o(e){i.call(this,e),this._options=e,this._iterator=null,this._operations=[]}n.inherits(o,i),o.prototype.setDb=function(e){var t=this._iterator=e.iterator(this._options);this._operations.forEach(function(e){t[e.method].apply(t,e.args)})},o.prototype._operation=function(e,t){if(this._iterator)return this._iterator[e].apply(this._iterator,t);this._operations.push({method:e,args:t})},"next end".split(" ").forEach(function(e){o.prototype["_"+e]=function(){this._operation(e,arguments)}}),t.exports=o},{"abstract-leveldown":58,util:54}],76:[function(e,t,r){(function(r,n){var i=e("util"),o=e("abstract-leveldown").AbstractLevelDOWN,s=e("./deferred-iterator");function a(e){o.call(this,"string"==typeof e?e:""),this._db=void 0,this._operations=[],this._iterators=[]}i.inherits(a,o),a.prototype.setDb=function(e){this._db=e,this._operations.forEach(function(t){e[t.method].apply(e,t.args)}),this._iterators.forEach(function(t){t.setDb(e)})},a.prototype._open=function(e,t){return n.nextTick(t)},a.prototype._operation=function(e,t){if(this._db)return this._db[e].apply(this._db,t);this._operations.push({method:e,args:t})},"put get del batch approximateSize".split(" ").forEach(function(e){a.prototype["_"+e]=function(){this._operation(e,arguments)}}),a.prototype._isBuffer=function(e){return r.isBuffer(e)},a.prototype._iterator=function(e){if(this._db)return this._db.iterator.apply(this._db,arguments);var t=new s(e);return this._iterators.push(t),t},t.exports=a,t.exports.DeferredIterator=s}).call(this,{isBuffer:e("../../../dev-deps/is-buffer/1.1.0/index.js")},e("_process"))},{"../../../dev-deps/is-buffer/1.1.0/index.js":26,"./deferred-iterator":75,_process:43,"abstract-leveldown":58,util:54}],77:[function(e,t,r){"use strict";function n(e){if(this._capacity=o(e),this._length=0,this._front=0,i(e)){for(var t=e.length,r=0;r<t;++r)this[r]=e[r];this._length=t}}n.prototype.toArray=function(){for(var e=this._length,t=new Array(e),r=this._front,n=this._capacity,i=0;i<e;++i)t[i]=this[r+i&n-1];return t},n.prototype.push=function(e){var t=arguments.length,r=this._length;if(t>1){var n=this._capacity;if(r+t>n){for(var i=0;i<t;++i){this._checkCapacity(r+1),this[o=this._front+r&this._capacity-1]=arguments[i],r++,this._length=r}return r}for(var o=this._front,i=0;i<t;++i)this[o+r&n-1]=arguments[i],o++;return this._length=r+t,r+t}return 0===t?r:(this._checkCapacity(r+1),this[i=this._front+r&this._capacity-1]=e,this._length=r+1,r+1)},n.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,r=this[t];return this[t]=void 0,this._length=e-1,r}},n.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,r=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,r}},n.prototype.unshift=function(e){var t=this._length,r=arguments.length;if(r>1){if(t+r>(i=this._capacity)){for(var n=r-1;n>=0;n--){this._checkCapacity(t+1);var i=this._capacity;this[s=(this._front-1&i-1^i)-i]=arguments[n],t++,this._length=t,this._front=s}return t}var o=this._front;for(n=r-1;n>=0;n--){var s;this[s=(o-1&i-1^i)-i]=arguments[n],o=s}return this._front=o,this._length=t+r,t+r}if(0===r)return t;this._checkCapacity(t+1);i=this._capacity;return this[n=(this._front-1&i-1^i)-i]=e,this._length=t+1,this._front=n,t+1},n.prototype.peekBack=function(){var e=this._length;if(0!==e)return this[this._front+e-1&this._capacity-1]},n.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},n.prototype.get=function(e){var t=e;if(t===(0|t)){var r=this._length;if(t<0&&(t+=r),!(t<0||t>=r))return this[this._front+t&this._capacity-1]}},n.prototype.isEmpty=function(){return 0===this._length},n.prototype.clear=function(){for(var e=this._length,t=this._front,r=this._capacity,n=0;n<e;++n)this[t+n&r-1]=void 0;this._length=0,this._front=0},n.prototype.toString=function(){return this.toArray().toString()},n.prototype.valueOf=n.prototype.toString,n.prototype.removeFront=n.prototype.shift,n.prototype.removeBack=n.prototype.pop,n.prototype.insertFront=n.prototype.unshift,n.prototype.insertBack=n.prototype.push,n.prototype.enqueue=n.prototype.push,n.prototype.dequeue=n.prototype.shift,n.prototype.toJSON=n.prototype.toArray,Object.defineProperty(n.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),n.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(o(1.5*this._capacity+16))},n.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var r=this._front,n=this._length;r+n>t&&function(e,t,r,n,i){for(var o=0;o<i;++o)r[o+n]=e[o+t],e[o+t]=void 0}(this,0,this,t,r+n&t-1)};var i=Array.isArray;function o(e){if("number"!=typeof e){if(!i(e))return 16;e=e.length}return t=Math.min(Math.max(16,e),1073741824),t>>>=0,t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16);var t}t.exports=n},{}],78:[function(e,t,r){var n=e("prr");function i(e,t,r){n(this,{type:e,name:e,cause:"string"!=typeof t?t:r,message:t&&"string"!=typeof t?t.message:t},"ewr")}function o(e,t){Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,arguments.callee),i.call(this,"CustomError",e,t)}o.prototype=new Error,t.exports=function(e){var t=function(t,r){return function(e,t,r){var n=function(r,n){i.call(this,t,r,n),"FilesystemError"==t&&(this.code=this.cause.code,this.path=this.cause.path,this.errno=this.cause.errno,this.message=(e.errno[this.cause.errno]?e.errno[this.cause.errno].description:this.cause.message)+(this.cause.path?" ["+this.cause.path+"]":"")),Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,arguments.callee)};return n.prototype=r?new r:new o,n}(e,t,r)};return{CustomError:o,FilesystemError:t("FilesystemError"),createError:t}}},{prr:111}],79:[function(e,t,r){var n=t.exports.all=[{errno:-1,code:"UNKNOWN",description:"unknown error"},{errno:0,code:"OK",description:"success"},{errno:1,code:"EOF",description:"end of file"},{errno:2,code:"EADDRINFO",description:"getaddrinfo error"},{errno:3,code:"EACCES",description:"permission denied"},{errno:4,code:"EAGAIN",description:"resource temporarily unavailable"},{errno:5,code:"EADDRINUSE",description:"address already in use"},{errno:6,code:"EADDRNOTAVAIL",description:"address not available"},{errno:7,code:"EAFNOSUPPORT",description:"address family not supported"},{errno:8,code:"EALREADY",description:"connection already in progress"},{errno:9,code:"EBADF",description:"bad file descriptor"},{errno:10,code:"EBUSY",description:"resource busy or locked"},{errno:11,code:"ECONNABORTED",description:"software caused connection abort"},{errno:12,code:"ECONNREFUSED",description:"connection refused"},{errno:13,code:"ECONNRESET",description:"connection reset by peer"},{errno:14,code:"EDESTADDRREQ",description:"destination address required"},{errno:15,code:"EFAULT",description:"bad address in system call argument"},{errno:16,code:"EHOSTUNREACH",description:"host is unreachable"},{errno:17,code:"EINTR",description:"interrupted system call"},{errno:18,code:"EINVAL",description:"invalid argument"},{errno:19,code:"EISCONN",description:"socket is already connected"},{errno:20,code:"EMFILE",description:"too many open files"},{errno:21,code:"EMSGSIZE",description:"message too long"},{errno:22,code:"ENETDOWN",description:"network is down"},{errno:23,code:"ENETUNREACH",description:"network is unreachable"},{errno:24,code:"ENFILE",description:"file table overflow"},{errno:25,code:"ENOBUFS",description:"no buffer space available"},{errno:26,code:"ENOMEM",description:"not enough memory"},{errno:27,code:"ENOTDIR",description:"not a directory"},{errno:28,code:"EISDIR",description:"illegal operation on a directory"},{errno:29,code:"ENONET",description:"machine is not on the network"},{errno:31,code:"ENOTCONN",description:"socket is not connected"},{errno:32,code:"ENOTSOCK",description:"socket operation on non-socket"},{errno:33,code:"ENOTSUP",description:"operation not supported on socket"},{errno:34,code:"ENOENT",description:"no such file or directory"},{errno:35,code:"ENOSYS",description:"function not implemented"},{errno:36,code:"EPIPE",description:"broken pipe"},{errno:37,code:"EPROTO",description:"protocol error"},{errno:38,code:"EPROTONOSUPPORT",description:"protocol not supported"},{errno:39,code:"EPROTOTYPE",description:"protocol wrong type for socket"},{errno:40,code:"ETIMEDOUT",description:"connection timed out"},{errno:41,code:"ECHARSET",description:"invalid Unicode character"},{errno:42,code:"EAIFAMNOSUPPORT",description:"address family for hostname not supported"},{errno:44,code:"EAISERVICE",description:"servname not supported for ai_socktype"},{errno:45,code:"EAISOCKTYPE",description:"ai_socktype not supported"},{errno:46,code:"ESHUTDOWN",description:"cannot send after transport endpoint shutdown"},{errno:47,code:"EEXIST",description:"file already exists"},{errno:48,code:"ESRCH",description:"no such process"},{errno:49,code:"ENAMETOOLONG",description:"name too long"},{errno:50,code:"EPERM",description:"operation not permitted"},{errno:51,code:"ELOOP",description:"too many symbolic links encountered"},{errno:52,code:"EXDEV",description:"cross-device link not permitted"},{errno:53,code:"ENOTEMPTY",description:"directory not empty"},{errno:54,code:"ENOSPC",description:"no space left on device"},{errno:55,code:"EIO",description:"i/o error"},{errno:56,code:"EROFS",description:"read-only file system"},{errno:57,code:"ENODEV",description:"no such device"},{errno:58,code:"ESPIPE",description:"invalid seek"},{errno:59,code:"ECANCELED",description:"operation canceled"}];t.exports.errno={"-1":n[0],0:n[1],1:n[2],2:n[3],3:n[4],4:n[5],5:n[6],6:n[7],7:n[8],8:n[9],9:n[10],10:n[11],11:n[12],12:n[13],13:n[14],14:n[15],15:n[16],16:n[17],17:n[18],18:n[19],19:n[20],20:n[21],21:n[22],22:n[23],23:n[24],24:n[25],25:n[26],26:n[27],27:n[28],28:n[29],29:n[30],31:n[31],32:n[32],33:n[33],34:n[34],35:n[35],36:n[36],37:n[37],38:n[38],39:n[39],40:n[40],41:n[41],42:n[42],44:n[43],45:n[44],46:n[45],47:n[46],48:n[47],49:n[48],50:n[49],51:n[50],52:n[51],53:n[52],54:n[53],55:n[54],56:n[55],57:n[56],58:n[57],59:n[58]},t.exports.code={UNKNOWN:n[0],OK:n[1],EOF:n[2],EADDRINFO:n[3],EACCES:n[4],EAGAIN:n[5],EADDRINUSE:n[6],EADDRNOTAVAIL:n[7],EAFNOSUPPORT:n[8],EALREADY:n[9],EBADF:n[10],EBUSY:n[11],ECONNABORTED:n[12],ECONNREFUSED:n[13],ECONNRESET:n[14],EDESTADDRREQ:n[15],EFAULT:n[16],EHOSTUNREACH:n[17],EINTR:n[18],EINVAL:n[19],EISCONN:n[20],EMFILE:n[21],EMSGSIZE:n[22],ENETDOWN:n[23],ENETUNREACH:n[24],ENFILE:n[25],ENOBUFS:n[26],ENOMEM:n[27],ENOTDIR:n[28],EISDIR:n[29],ENONET:n[30],ENOTCONN:n[31],ENOTSOCK:n[32],ENOTSUP:n[33],ENOENT:n[34],ENOSYS:n[35],EPIPE:n[36],EPROTO:n[37],EPROTONOSUPPORT:n[38],EPROTOTYPE:n[39],ETIMEDOUT:n[40],ECHARSET:n[41],EAIFAMNOSUPPORT:n[42],EAISERVICE:n[43],EAISOCKTYPE:n[44],ESHUTDOWN:n[45],EEXIST:n[46],ESRCH:n[47],ENAMETOOLONG:n[48],EPERM:n[49],ELOOP:n[50],EXDEV:n[51],ENOTEMPTY:n[52],ENOSPC:n[53],EIO:n[54],EROFS:n[55],ENODEV:n[56],ESPIPE:n[57],ECANCELED:n[58]},t.exports.custom=e("./custom")(t.exports),t.exports.create=t.exports.custom.createError},{"./custom":78}],80:[function(e,t,r){(function(e,r){t.exports=r.setImmediate?function(){var t=0;return function(n){t===e.maxTickDepth?(r.setImmediate(n),t=0):e.nextTick(n),t++}}:function(){return e.nextTick}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:43}],81:[function(e,t,r){!function(){"use strict";t.exports="function"==typeof Symbol&&"symbol"==typeof Symbol()}()},{}],82:[function(e,t,r){!function(){"use strict";t.exports=e("has-symbol-support-x")&&"symbol"==typeof Symbol.toStringTag}()},{"has-symbol-support-x":81}],83:[function(e,t,r){(function(e,r){"use strict";var n,i,o=r.MutationObserver||r.WebKitMutationObserver;if(e.browser)if(o){var s=0,a=new o(l),u=r.document.createTextNode("");a.observe(u,{characterData:!0}),n=function(){u.data=s=++s%2}}else if(r.setImmediate||void 0===r.MessageChannel)n="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var e=r.document.createElement("script");e.onreadystatechange=function(){l(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},r.document.documentElement.appendChild(e)}:function(){setTimeout(l,0)};else{var c=new r.MessageChannel;c.port1.onmessage=l,n=function(){c.port2.postMessage(0)}}else n=function(){e.nextTick(l)};var f=[];function l(){var e,t;i=!0;for(var r=f.length;r;){for(t=f,f=[],e=-1;++e<r;)t[e]();r=f.length}i=!1}t.exports=function(e){1!==f.push(e)||i||n()}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:43}],84:[function(e,t,r){arguments[4][25][0].apply(r,arguments)},{dup:25}],85:[function(e,t,r){!function(){"use strict";var r,n,i,o=e("is-object-like-x"),s="function"==typeof ArrayBuffer;if(s){if(e("has-to-string-tag-x"))try{i="number"==typeof(i=Object.getOwnPropertyDescriptor(ArrayBuffer.prototype,"byteLength").get).call(new ArrayBuffer(4))&&i}catch(e){i=null}i||(r=e("to-string-tag-x"),n="[object ArrayBuffer]")}t.exports=function(e){if(!s||!o(e))return!1;if(!i)return r(e)===n;try{return"number"==typeof i.call(e)}catch(e){}return!1}}()},{"has-to-string-tag-x":82,"is-object-like-x":87,"to-string-tag-x":138}],86:[function(e,t,r){!function(){"use strict";var r=Function.prototype.toString,n=e("to-string-tag-x"),i=e("has-to-string-tag-x"),o=e("is-primitive");t.exports=function(e){if(o(e))return!1;if(i)return function(e){try{return r.call(e),!0}catch(e){}return!1}(e);var t=n(e);return"[object Function]"===t||"[object GeneratorFunction]"===t}}()},{"has-to-string-tag-x":82,"is-primitive":88,"to-string-tag-x":138}],87:[function(e,t,r){!function(){"use strict";var r=e("is-function-x"),n=e("is-primitive");t.exports=function(e){return!n(e)&&!r(e)}}()},{"is-function-x":86,"is-primitive":88}],88:[function(e,t,r){"use strict";t.exports=function(e){return null==e||"function"!=typeof e&&"object"!=typeof e}},{}],89:[function(e,t,r){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],90:[function(e,t,r){var n={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},{}],91:[function(e,t,r){var n=e("./lib/encodings");function i(e){this.opts=e||{},this.encodings=n}t.exports=i,i.prototype._encoding=function(e){return"string"==typeof e&&(e=n[e]),e||(e=n.id),e},i.prototype._keyEncoding=function(e,t){return this._encoding(t&&t.keyEncoding||e&&e.keyEncoding||this.opts.keyEncoding)},i.prototype._valueEncoding=function(e,t){return this._encoding(t&&(t.valueEncoding||t.encoding)||e&&(e.valueEncoding||e.encoding)||this.opts.valueEncoding||this.opts.encoding)},i.prototype.encodeKey=function(e,t,r){return this._keyEncoding(t,r).encode(e)},i.prototype.encodeValue=function(e,t,r){return this._valueEncoding(t,r).encode(e)},i.prototype.decodeKey=function(e,t){return this._keyEncoding(t).decode(e)},i.prototype.decodeValue=function(e,t){return this._valueEncoding(t).decode(e)},i.prototype.encodeBatch=function(e,t){var r=this;return e.map(function(e){var n={type:e.type,key:r.encodeKey(e.key,t,e)};return r.keyAsBuffer(t,e)&&(n.keyEncoding="binary"),e.prefix&&(n.prefix=e.prefix),"value"in e&&(n.value=r.encodeValue(e.value,t,e),r.valueAsBuffer(t,e)&&(n.valueEncoding="binary")),n})};var o=["lt","gt","lte","gte","start","end"];i.prototype.encodeLtgt=function(e){var t=this,r={};return Object.keys(e).forEach(function(n){r[n]=o.indexOf(n)>-1?t.encodeKey(e[n],e):e[n]}),r},i.prototype.createStreamDecoder=function(e){var t=this;return e.keys&&e.values?function(r,n){return{key:t.decodeKey(r,e),value:t.decodeValue(n,e)}}:e.keys?function(r){return t.decodeKey(r,e)}:e.values?function(r,n){return t.decodeValue(n,e)}:function(){}},i.prototype.keyAsBuffer=function(e){return this._keyEncoding(e).buffer},i.prototype.valueAsBuffer=function(e){return this._valueEncoding(e).buffer}},{"./lib/encodings":92}],92:[function(e,t,r){(function(e){r.utf8=r["utf-8"]={encode:function(e){return n(e)?e:String(e)},decode:t,buffer:!1,type:"utf8"},r.json={encode:JSON.stringify,decode:JSON.parse,buffer:!1,type:"json"},r.binary={encode:function(t){return n(t)?t:new e(t)},decode:t,buffer:!0,type:"binary"},r.id={encode:function(e){return e},decode:function(e){return e},buffer:!1,type:"id"};function t(e){return e}function n(t){return void 0===t||null===t||e.isBuffer(t)}["hex","ascii","base64","ucs2","ucs-2","utf16le","utf-16le"].forEach(function(t){r[t]={encode:function(r){return n(r)?r:new e(r,t)},decode:function(e){return e.toString(t)},buffer:!0,type:t}})}).call(this,e("buffer").Buffer)},{buffer:8}],93:[function(e,t,r){arguments[4][91][0].apply(r,arguments)},{"./lib/encodings":94,dup:91}],94:[function(e,t,r){(function(e){r.utf8=r["utf-8"]={encode:function(e){return t(e)?e:String(e)},decode:function(e){return"string"==typeof e?e:String(e)},buffer:!1,type:"utf8"},r.json={encode:JSON.stringify,decode:JSON.parse,buffer:!1,type:"json"},r.binary={encode:function(r){return t(r)?r:new e(r)},decode:function(e){return e},buffer:!0,type:"binary"},r.none={encode:function(e){return e},decode:function(e){return e},buffer:!1,type:"id"},r.id=r.none;function t(t){return void 0===t||null===t||e.isBuffer(t)}["hex","ascii","base64","ucs2","ucs-2","utf16le","utf-16le"].forEach(function(n){r[n]={encode:function(r){return t(r)?r:new e(r,n)},decode:function(e){return e.toString(n)},buffer:!0,type:n}})}).call(this,e("buffer").Buffer)},{buffer:8}],95:[function(e,t,r){var n=e("errno").create,i=n("LevelUPError"),o=n("NotFoundError",i);o.prototype.notFound=!0,o.prototype.status=404,t.exports={LevelUPError:i,InitializationError:n("InitializationError",i),OpenError:n("OpenError",i),ReadError:n("ReadError",i),WriteError:n("WriteError",i),NotFoundError:o,EncodingError:n("EncodingError",i)}},{errno:79}],96:[function(e,t,r){var n=e("inherits"),i=e("readable-stream").Readable,o=e("xtend"),s=e("level-errors").EncodingError;function a(e,t){if(!(this instanceof a))return new a(e,t);i.call(this,o(t,{objectMode:!0})),this._iterator=e,this._destroyed=!1,this._decoder=null,t&&t.decoder&&(this._decoder=t.decoder),this.on("end",this._cleanup.bind(this))}t.exports=a,n(a,i),a.prototype._read=function(){var e=this;this._destroyed||this._iterator.next(function(t,r,n){if(!e._destroyed){if(t)return e.emit("error",t);if(void 0===r&&void 0===n)e.push(null);else{if(!e._decoder)return e.push({key:r,value:n});try{n=e._decoder(r,n)}catch(t){return e.emit("error",new s(t)),void e.push(null)}e.push(n)}}})},a.prototype.destroy=a.prototype._cleanup=function(){var e=this;this._destroyed||(this._destroyed=!0,this._iterator.end(function(t){if(t)return e.emit("error",t);e.emit("close")}))}},{inherits:84,"level-errors":95,"readable-stream":118,xtend:142}],97:[function(e,t,r){const n=e("util"),i=e("abstract-leveldown").AbstractChainedBatch;function o(e){i.call(this,e),this.binding=e.binding.batch()}o.prototype._put=function(e,t){this.binding.put(e,t)},o.prototype._del=function(e){this.binding.del(e)},o.prototype._clear=function(e){this.binding.clear(e)},o.prototype._write=function(e,t){this.binding.write(e,t)},n.inherits(o,i),t.exports=o},{"abstract-leveldown":63,util:54}],98:[function(e,t,r){const n=e("util"),i=e("abstract-leveldown").AbstractIterator,o=e("fast-future");function s(e,t){i.call(this,e),this.binding=e.binding.iterator(t),this.cache=null,this.finished=!1,this.fastFuture=o()}n.inherits(s,i),s.prototype.seek=function(e){if("string"!=typeof e)throw new Error("seek requires a string key");this.cache=null,this.binding.seek(e)},s.prototype._next=function(e){var t,r,n=this;return this.cache&&this.cache.length?(t=this.cache.pop(),r=this.cache.pop(),this.fastFuture(function(){e(null,t,r)})):this.finished?this.fastFuture(function(){e()}):this.binding.next(function(t,r,i){if(t)return e(t);n.cache=r,n.finished=i,n._next(e)}),this},s.prototype._end=function(e){delete this.cache,this.binding.end(e)},t.exports=s},{"abstract-leveldown":63,"fast-future":80,util:54}],99:[function(e,t,r){const n=e("util"),i=e("abstract-leveldown").AbstractLevelDOWN,o=e("bindings")("leveldown").leveldown,s=e("./chained-batch"),a=e("./iterator");function u(e){if(!(this instanceof u))return new u(e);i.call(this,e),this.binding=o(e)}n.inherits(u,i),u.prototype._open=function(e,t){this.binding.open(e,t)},u.prototype._close=function(e){this.binding.close(e)},u.prototype._put=function(e,t,r,n){this.binding.put(e,t,r,n)},u.prototype._get=function(e,t,r){this.binding.get(e,t,r)},u.prototype._del=function(e,t,r){this.binding.del(e,t,r)},u.prototype._chainedBatch=function(){return new s(this)},u.prototype._batch=function(e,t,r){return this.binding.batch(e,t,r)},u.prototype._approximateSize=function(e,t,r){this.binding.approximateSize(e,t,r)},u.prototype.getProperty=function(e){if("string"!=typeof e)throw new Error("getProperty() requires a valid `property` argument");return this.binding.getProperty(e)},u.prototype._iterator=function(e){return new a(this,e)},u.destroy=function(e,t){if(arguments.length<2)throw new Error("destroy() requires `location` and `callback` arguments");if("string"!=typeof e)throw new Error("destroy() requires a location string argument");if("function"!=typeof t)throw new Error("destroy() requires a callback function argument");o.destroy(e,t)},u.repair=function(e,t){if(arguments.length<2)throw new Error("repair() requires `location` and `callback` arguments");if("string"!=typeof e)throw new Error("repair() requires a location string argument");if("function"!=typeof t)throw new Error("repair() requires a callback function argument");o.repair(e,t)},t.exports=u},{"./chained-batch":97,"./iterator":98,"abstract-leveldown":63,bindings:66,util:54}],100:[function(e,t,r){t.exports={_id:"leveldown@1.5.0",_from:"leveldown@1.5.0",name:"leveldown",description:"A Node.js LevelDB binding, primary backend for LevelUP",version:"1.5.0",contributors:["Rod Vagg <r@va.gg> (https://github.com/rvagg)","John Chesley <john@chesl.es> (https://github.com/chesles/)","Jake Verbaten <raynos2@gmail.com> (https://github.com/raynos)","Dominic Tarr <dominic.tarr@gmail.com> (https://github.com/dominictarr)","Max Ogden <max@maxogden.com> (https://github.com/maxogden)","Lars-Magnus Skog <ralphtheninja@riseup.net> (https://github.com/ralphtheninja)","David Bjrklund <david.bjorklund@gmail.com> (https://github.com/kesla)","Julian Gruber <julian@juliangruber.com> (https://github.com/juliangruber)","Paolo Fragomeni <paolo@async.ly> (https://github.com/hij1nx)","Anton Whalley <anton.whalley@nearform.com> (https://github.com/No9)","Matteo Collina <matteo.collina@gmail.com> (https://github.com/mcollina)","Pedro Teixeira <pedro.teixeira@gmail.com> (https://github.com/pgte)","James Halliday <mail@substack.net> (https://github.com/substack)"],repository:{type:"git",url:"https://github.com/level/leveldown.git"},homepage:"https://github.com/level/leveldown",keywords:["leveldb","level"],main:"leveldown.js",dependencies:{"abstract-leveldown":"~2.6.1",bindings:"~1.2.1","fast-future":"~1.0.0",nan:"~2.4.0",prebuild:"^4.1.1"},devDependencies:{async:"^2.0.1",delayed:"~1.0.1",du:"~0.1.0",faucet:"0.0.1",mkfiletree:"~1.0.1","monotonic-timestamp":"~0.0.8","node-uuid":"~1.4.3",optimist:"~0.6.1",readfiletree:"~0.0.1",rimraf:"~2.5.0",slump:"~2.0.0",tape:"^4.5.1"},scripts:{install:"prebuild --install",test:"tape test/*-test.js | faucet",rebuild:"prebuild --compile",prebuild:"prebuild --all --strip --verbose"},license:"MIT",gypfile:!0}},{}],101:[function(e,t,r){var n=e("./util"),i=e("level-errors").WriteError,o=n.getOptions,s=n.dispatchError;function a(e,t){this._levelup=e,this._codec=t,this.batch=e.db.batch(),this.ops=[],this.length=0}a.prototype.put=function(e,t,r){r=o(r);var n=this._codec.encodeKey(e,r),s=this._codec.encodeValue(t,r);try{this.batch.put(n,s)}catch(e){throw new i(e)}return this.ops.push({type:"put",key:n,value:s}),this.length++,this},a.prototype.del=function(e,t){t=o(t);var r=this._codec.encodeKey(e,t);try{this.batch.del(r)}catch(e){throw new i(e)}return this.ops.push({type:"del",key:r}),this.length++,this},a.prototype.clear=function(){try{this.batch.clear()}catch(e){throw new i(e)}return this.ops=[],this.length=0,this},a.prototype.write=function(e){var t=this._levelup,r=this.ops;try{this.batch.write(function(n){if(n)return s(t,new i(n),e);t.emit("batch",r),e&&e()})}catch(e){throw new i(e)}},t.exports=a},{"./util":103,"level-errors":95}],102:[function(e,t,r){(function(r){var n=e("events").EventEmitter,i=e("util").inherits,o=e("util").deprecate,s=e("xtend"),a=e("prr"),u=e("deferred-leveldown"),c=e("level-iterator-stream"),f=e("level-errors"),l=f.WriteError,h=f.ReadError,d=f.NotFoundError,p=f.OpenError,v=f.EncodingError,m=f.InitializationError,g=e("./util"),y=e("./batch"),_=e("level-codec"),b=g.getOptions,w=g.defaultOptions,k=g.getLevelDOWN,x=g.dispatchError;g.isDefined;function E(e,t){return"function"==typeof e?e:t}function S(e,t,i){if(!(this instanceof S))return new S(e,t,i);var o;if(n.call(this),this.setMaxListeners(1/0),"function"==typeof e?((t="object"==typeof t?t:{}).db=e,e=null):"object"==typeof e&&"function"==typeof e.db&&(t=e,e=null),"function"==typeof t&&(i=t,t={}),(!t||"function"!=typeof t.db)&&"string"!=typeof e){if(o=new m("Must provide a location for the database"),i)return r.nextTick(function(){i(o)});throw o}t=b(t),this.options=s(w,t),this._codec=new _(this.options),this._status="new",a(this,"location",e,"e"),this.open(i)}function R(e,t,r){if(!e._isOpening()&&!e.isOpen())return x(e,new h("Database is not open"),r),!0}function j(e,t,r){x(e,new l(t),r)}function T(e,t,r){x(e,new h(t),r)}function D(e){return function(t,r){k()[e](t,r||function(){})}}i(S,n),S.prototype.open=function(e){var t,n,i=this;return this.isOpen()?(e&&r.nextTick(function(){e(null,i)}),this):this._isOpening()?e&&this.once("open",function(){e(null,i)}):(this.emit("opening"),this._status="opening",this.db=new u(this.location),t=this.options.db||k(),void(n=t(this.location)).open(this.options,function(t){if(t)return x(i,new p(t),e);i.db.setDb(n),i.db=n,i._status="open",e&&e(null,i),i.emit("open"),i.emit("ready")}))},S.prototype.close=function(e){var t=this;if(this.isOpen())this._status="closing",this.db.close(function(){t._status="closed",t.emit("closed"),e&&e.apply(null,arguments)}),this.emit("closing"),this.db=new u(this.location);else{if("closed"==this._status&&e)return r.nextTick(e);"closing"==this._status&&e?this.once("closed",e):this._isOpening()&&this.once("open",function(){t.close(e)})}},S.prototype.isOpen=function(){return"open"==this._status},S.prototype._isOpening=function(){return"opening"==this._status},S.prototype.isClosed=function(){return/^clos/.test(this._status)},S.prototype.get=function(e,t,r){var n,i=this;if(!R(this,0,r=E(t,r))){if(null===e||void 0===e||"function"!=typeof r)return T(this,"get() requires key and callback arguments",r);t=g.getOptions(t),n=this._codec.encodeKey(e,t),t.asBuffer=this._codec.valueAsBuffer(t),this.db.get(n,t,function(n,o){if(n)return n=/notfound/i.test(n)||n.notFound?new d("Key not found in database ["+e+"]",n):new h(n),x(i,n,r);if(r){try{o=i._codec.decodeValue(o,t)}catch(e){return r(new v(e))}r(null,o)}})}},S.prototype.put=function(e,t,r,n){var i,o,s=this;if(n=E(r,n),null===e||void 0===e)return j(this,"put() requires a key argument",n);R(this,0,n)||(r=b(r),i=this._codec.encodeKey(e,r),o=this._codec.encodeValue(t,r),this.db.put(i,o,r,function(r){if(r)return x(s,new l(r),n);s.emit("put",e,t),n&&n()}))},S.prototype.del=function(e,t,r){var n,i=this;if(r=E(t,r),null===e||void 0===e)return j(this,"del() requires a key argument",r);R(this,0,r)||(t=b(t),n=this._codec.encodeKey(e,t),this.db.del(n,t,function(t){if(t)return x(i,new l(t),r);i.emit("del",e),r&&r()}))},S.prototype.batch=function(e,t,r){var n,i=this;return arguments.length?(r=E(t,r),Array.isArray(e)?void(R(this,0,r)||(t=b(t),n=(n=i._codec.encodeBatch(e,t)).map(function(e){return e.type||void 0===e.key||void 0===e.value||(e.type="put"),e}),this.db.batch(n,t,function(t){if(t)return x(i,new l(t),r);i.emit("batch",e),r&&r()}))):j(this,"batch() requires an array argument",r)):new y(this,this._codec)},S.prototype.approximateSize=o(function(e,t,r,n){var i,o,s=this;if(n=E(r,n),r=b(r),null===e||void 0===e||null===t||void 0===t||"function"!=typeof n)return T(this,"approximateSize() requires start, end and callback arguments",n);i=this._codec.encodeKey(e,r),o=this._codec.encodeKey(t,r),this.db.approximateSize(i,o,function(e,t){if(e)return x(s,new p(e),n);n&&n(null,t)})},"db.approximateSize() is deprecated. Use db.db.approximateSize() instead"),S.prototype.readStream=S.prototype.createReadStream=function(e){return(e=s({keys:!0,values:!0},this.options,e)).keyEncoding=e.keyEncoding,e.valueEncoding=e.valueEncoding,(e=this._codec.encodeLtgt(e)).keyAsBuffer=this._codec.keyAsBuffer(e),e.valueAsBuffer=this._codec.valueAsBuffer(e),"number"!=typeof e.limit&&(e.limit=-1),new c(this.db.iterator(e),s(e,{decoder:this._codec.createStreamDecoder(e)}))},S.prototype.keyStream=S.prototype.createKeyStream=function(e){return this.createReadStream(s(e,{keys:!0,values:!1}))},S.prototype.valueStream=S.prototype.createValueStream=function(e){return this.createReadStream(s(e,{keys:!1,values:!0}))},S.prototype.toString=function(){return"LevelUP"},t.exports=S,t.exports.errors=e("level-errors"),t.exports.destroy=o(D("destroy"),"levelup.destroy() is deprecated. Use leveldown.destroy() instead"),t.exports.repair=o(D("repair"),"levelup.repair() is deprecated. Use leveldown.repair() instead")}).call(this,e("_process"))},{"./batch":101,"./util":103,_process:43,"deferred-leveldown":76,events:16,"level-codec":91,"level-errors":95,"level-iterator-stream":96,prr:112,util:54,xtend:142}],103:[function(e,t,r){e("xtend");var n,i=e("level-errors").LevelUPError,o=e("util").format;function s(e){return new i(o("Failed to require LevelDOWN (%s). Try `npm install leveldown` if it's missing",e.message))}t.exports={defaultOptions:{createIfMissing:!0,errorIfExists:!1,keyEncoding:"utf8",valueEncoding:"utf8",compression:!0},getOptions:function(e){return"string"==typeof e&&(e={valueEncoding:e}),"object"!=typeof e&&(e={}),e},getLevelDOWN:function(){if(n)return n;var t,r=e("../package.json").devDependencies.leveldown;try{t=e("leveldown/package").version}catch(e){throw s(e)}if(!e("semver").satisfies(t,r))throw new i("Installed version of LevelDOWN ("+t+") does not match required version ("+r+")");try{return n=e("leveldown")}catch(e){throw s(e)}},dispatchError:function(e,t,r){"function"==typeof r?r(t):e.emit("error",t)},isDefined:function(e){return void 0!==e}}},{"../package.json":104,"level-errors":95,leveldown:99,"leveldown/package":100,semver:135,util:54,xtend:142}],104:[function(e,t,r){t.exports={_id:"levelup@1.3.3",_from:"levelup@1.3.3",name:"levelup",description:"Fast & simple storage - a Node.js-style LevelDB wrapper",version:"1.3.3",contributors:["Rod Vagg <r@va.gg> (https://github.com/rvagg)","John Chesley <john@chesl.es> (https://github.com/chesles/)","Jake Verbaten <raynos2@gmail.com> (https://github.com/raynos)","Dominic Tarr <dominic.tarr@gmail.com> (https://github.com/dominictarr)","Max Ogden <max@maxogden.com> (https://github.com/maxogden)","Lars-Magnus Skog <ralphtheninja@riseup.net> (https://github.com/ralphtheninja)","David Bjrklund <david.bjorklund@gmail.com> (https://github.com/kesla)","Julian Gruber <julian@juliangruber.com> (https://github.com/juliangruber)","Paolo Fragomeni <paolo@async.ly> (https://github.com/0x00a)","Anton Whalley <anton.whalley@nearform.com> (https://github.com/No9)","Matteo Collina <matteo.collina@gmail.com> (https://github.com/mcollina)","Pedro Teixeira <pedro.teixeira@gmail.com> (https://github.com/pgte)","James Halliday <mail@substack.net> (https://github.com/substack)","Jarrett Cruger <jcrugzz@gmail.com> (https://github.com/jcrugzz)"],repository:{type:"git",url:"https://github.com/level/levelup.git"},homepage:"https://github.com/level/levelup",keywords:["leveldb","stream","database","db","store","storage","json"],main:"lib/levelup.js",dependencies:{"deferred-leveldown":"~1.2.1","level-codec":"~6.1.0","level-errors":"~1.0.3","level-iterator-stream":"~1.3.0",prr:"~1.0.1",semver:"~5.1.0",xtend:"~4.0.0"},devDependencies:{async:"~1.5.0",bustermove:"~1.0.0",tap:"~2.3.1",delayed:"~1.0.1",faucet:"~0.0.1",leveldown:"^1.1.0",memdown:"~1.1.0","msgpack-js":"~0.3.0",referee:"~1.2.0",rimraf:"~2.4.3","slow-stream":"0.0.4",tape:"~4.2.1"},browser:{leveldown:!1,"leveldown/package":!1,semver:!1},scripts:{test:"tape test/*-test.js | faucet"},license:"MIT"}},{}],105:[function(e,t,r){(function(r){"use strict";var n=e("immediate");function i(){}var o={},s=["REJECTED"],a=["FULFILLED"],u=["PENDING"];if(!r.browser)var c=["UNHANDLED"];function f(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,r.browser||(this.handled=c),e!==i&&p(this,e)}function l(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function h(e,t,r){n(function(){var n;try{n=t(r)}catch(t){return o.reject(e,t)}n===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,n)})}function d(e){var t=e&&e.then;if(e&&"object"==typeof e&&"function"==typeof t)return function(){t.apply(e,arguments)}}function p(e,t){var r=!1;function n(t){r||(r=!0,o.reject(e,t))}function i(t){r||(r=!0,o.resolve(e,t))}var s=v(function(){t(i,n)});"error"===s.status&&n(s.value)}function v(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}t.exports=f,f.prototype.catch=function(e){return this.then(null,e)},f.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===s)return this;var n=new this.constructor(i);(r.browser||this.handled===c&&(this.handled=null),this.state!==u)?h(n,this.state===a?e:t,this.outcome):this.queue.push(new l(n,e,t));return n},l.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},l.prototype.otherCallFulfilled=function(e){h(this.promise,this.onFulfilled,e)},l.prototype.callRejected=function(e){o.reject(this.promise,e)},l.prototype.otherCallRejected=function(e){h(this.promise,this.onRejected,e)},o.resolve=function(e,t){var r=v(d,t);if("error"===r.status)return o.reject(e,r.value);var n=r.value;if(n)p(e,n);else{e.state=a,e.outcome=t;for(var i=-1,s=e.queue.length;++i<s;)e.queue[i].callFulfilled(t)}return e},o.reject=function(e,t){e.state=s,e.outcome=t,r.browser||e.handled===c&&n(function(){e.handled===c&&r.emit("unhandledRejection",t,e)});for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callRejected(t);return e},f.resolve=function(e){if(e instanceof this)return e;return o.resolve(new this(i),e)},f.reject=function(e){var t=new this(i);return o.reject(t,e)},f.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);var s=new Array(r),a=0,u=-1,c=new this(i);for(;++u<r;)f(e[u],u);return c;function f(e,i){t.resolve(e).then(function(e){s[i]=e,++a!==r||n||(n=!0,o.resolve(c,s))},function(e){n||(n=!0,o.reject(c,e))})}},f.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);var s=-1,a=new this(i);for(;++s<r;)u=e[s],t.resolve(u).then(function(e){n||(n=!0,o.resolve(a,e))},function(e){n||(n=!0,o.reject(a,e))});var u;return a}}).call(this,e("_process"))},{_process:43,immediate:83}],106:[function(e,t,r){t.exports=function(e){return null===e}},{}],107:[function(e,t,r){(function(e){function t(e,t){return Object.hasOwnProperty.call(e,t)}function n(e){return void 0!==e&&""!==e}function t(e,t){return Object.hasOwnProperty.call(e,t)}function i(e,t){return Object.hasOwnProperty.call(e,t)&&t}r.compare=function(t,r){if(e.isBuffer(t)){for(var n=Math.min(t.length,r.length),i=0;i<n;i++){var o=t[i]-r[i];if(o)return o}return t.length-r.length}return t<r?-1:t>r?1:0};var o=r.lowerBoundKey=function(e){return i(e,"gt")||i(e,"gte")||i(e,"min")||(e.reverse?i(e,"end"):i(e,"start"))||void 0},s=r.lowerBound=function(e){var t=o(e);return t&&e[t]};r.lowerBoundInclusive=function(e){return!t(e,"gt")},r.upperBoundInclusive=function(e){return!(t(e,"lt")||!e.minEx)};var a=r.lowerBoundExclusive=function(e){return!(!t(e,"gt")&&!e.minEx)},u=r.upperBoundExclusive=function(e){return!!t(e,"lt")},c=r.upperBoundKey=function(e){return i(e,"lt")||i(e,"lte")||i(e,"max")||(e.reverse?i(e,"start"):i(e,"end"))||void 0},f=r.upperBound=function(e){var t=c(e);return t&&e[t]};function l(e){return e}r.toLtgt=function(e,n,i,o,s){n=n||{},i=i||l;var a=arguments.length>3,u=r.lowerBoundKey(e),c=r.upperBoundKey(e);return u?"gt"===u?n.gt=i(e.gt,!1):n.gte=i(e[u],!1):a&&(n.gte=i(o,!1)),c?"lt"===c?n.lt=i(e.lt,!0):n.lte=i(e[c],!0):a&&(n.lte=i(s,!0)),null!=e.reverse&&(n.reverse=!!e.reverse),t(n,"max")&&delete n.max,t(n,"min")&&delete n.min,t(n,"start")&&delete n.start,t(n,"end")&&delete n.end,n},r.contains=function(e,t,i){i=i||r.compare;var o=s(e);if(n(o)&&((c=i(t,o))<0||0===c&&a(e)))return!1;var c,l=f(e);if(n(l)&&((c=i(t,l))>0||0===c&&u(e)))return!1;return!0},r.filter=function(e,t){return function(n){return r.contains(e,n,t)}}}).call(this,{isBuffer:e("../../../dev-deps/is-buffer/1.1.0/index.js")})},{"../../../dev-deps/is-buffer/1.1.0/index.js":26}],108:[function(e,t,r){var n=1e3,i=60*n,o=60*i,s=24*o,a=365.25*s;function u(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}t.exports=function(e,t){t=t||{};var r,c=typeof e;if("string"===c&&e.length>0)return function(e){if((e=String(e)).length>1e4)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*a;case"days":case"day":case"d":return r*s;case"hours":case"hour":case"hrs":case"hr":case"h":return r*o;case"minutes":case"minute":case"mins":case"min":case"m":return r*i;case"seconds":case"second":case"secs":case"sec":case"s":return r*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}(e);if("number"===c&&!1===isNaN(e))return t.long?u(r=e,s,"day")||u(r,o,"hour")||u(r,i,"minute")||u(r,n,"second")||r+" ms":function(e){if(e>=s)return Math.round(e/s)+"d";if(e>=o)return Math.round(e/o)+"h";if(e>=i)return Math.round(e/i)+"m";if(e>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],109:[function(e,t,r){(function(e){"use strict";t.exports=function(t){var r=new Array(arguments.length-1),n=0;for(;n<arguments.length;)r[n++]=arguments[n];e.nextTick(function(){t.apply(null,r)})}}).call(this,e("_process"))},{_process:43}],110:[function(e,t,r){(function(e){"use strict";!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports=function(t){var r=new Array(arguments.length-1),n=0;for(;n<r.length;)r[n++]=arguments[n];e.nextTick(function(){t.apply(null,r)})}:t.exports=e.nextTick}).call(this,e("_process"))},{_process:43}],111:[function(e,t,r){var n,i;n=this,i=function(){var e="function"==typeof Object.defineProperty?function(e,t,r){return Object.defineProperty(e,t,r),e}:function(e,t,r){return e[t]=r.value,e};return function(t,r,n,i){var o;if(i=function(e,t){var r="object"==typeof t,n=!r&&"string"==typeof t,i=function(e){return r?!!t[e]:!!n&&t.indexOf(e[0])>-1};return{enumerable:i("enumerable"),configurable:i("configurable"),writable:i("writable"),value:e}}(n,i),"object"==typeof r){for(o in r)Object.hasOwnProperty.call(r,o)&&(i.value=r[o],e(t,o,i));return t}return e(t,r,i)}},void 0!==t&&t.exports?t.exports=i():n.prr=i()},{}],112:[function(e,t,r){arguments[4][111][0].apply(r,arguments)},{dup:111}],113:[function(e,t,r){(function(r){t.exports=a;var n=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t},i=e("core-util-is");i.inherits=e("inherits");var o=e("./_stream_readable"),s=e("./_stream_writable");function a(e){if(!(this instanceof a))return new a(e);o.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",u)}function u(){this.allowHalfOpen||this._writableState.ended||r.nextTick(this.end.bind(this))}i.inherits(a,o),function(e,t){for(var r=0,n=e.length;r<n;r++)t(e[r],r)}(n(s.prototype),function(e){a.prototype[e]||(a.prototype[e]=s.prototype[e])})}).call(this,e("_process"))},{"./_stream_readable":115,"./_stream_writable":117,_process:43,"core-util-is":70,inherits:84}],114:[function(e,t,r){t.exports=o;var n=e("./_stream_transform"),i=e("core-util-is");function o(e){if(!(this instanceof o))return new o(e);n.call(this,e)}i.inherits=e("inherits"),i.inherits(o,n),o.prototype._transform=function(e,t,r){r(null,e)}},{"./_stream_transform":116,"core-util-is":70,inherits:84}],115:[function(e,t,r){(function(r){t.exports=f;var n=e("isarray"),i=e("buffer").Buffer;f.ReadableState=c;var o=e("events").EventEmitter;o.listenerCount||(o.listenerCount=function(e,t){return e.listeners(t).length});var s,a=e("stream"),u=e("core-util-is");function c(t,r){var n=(t=t||{}).highWaterMark;this.highWaterMark=n||0===n?n:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!t.objectMode,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(s||(s=e("string_decoder/").StringDecoder),this.decoder=new s(t.encoding),this.encoding=t.encoding)}function f(e){if(!(this instanceof f))return new f(e);this._readableState=new c(e,this),this.readable=!0,a.call(this)}function l(e,t,n,o,s){var a=function(e,t){var r=null;i.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));return r}(t,n);if(a)e.emit("error",a);else if(null===n||void 0===n)t.reading=!1,t.ended||function(e,t){if(t.decoder&&!t.ended){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.length>0?p(e):b(e)}(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!s){var u=new Error("stream.push() after EOF");e.emit("error",u)}else if(t.endEmitted&&s){u=new Error("stream.unshift() after end event");e.emit("error",u)}else!t.decoder||s||o||(n=t.decoder.write(n)),t.length+=t.objectMode?1:n.length,s?t.buffer.unshift(n):(t.reading=!1,t.buffer.push(n)),t.needReadable&&p(e),function(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(function(){!function(e,t){var r=t.length;for(;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}(e,t)}))}(e,t);else s||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}u.inherits=e("inherits"),u.inherits(f,a),f.prototype.push=function(e,t){var r=this._readableState;return"string"!=typeof e||r.objectMode||(t=t||r.defaultEncoding)!==r.encoding&&(e=new i(e,t),t=""),l(this,r,e,t,!1)},f.prototype.unshift=function(e){return l(this,this._readableState,e,"",!0)},f.prototype.setEncoding=function(t){s||(s=e("string_decoder/").StringDecoder),this._readableState.decoder=new s(t),this._readableState.encoding=t};var h=8388608;function d(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:null===e||isNaN(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:e<=0?0:(e>t.highWaterMark&&(t.highWaterMark=function(e){if(e>=h)e=h;else{e--;for(var t=1;t<32;t<<=1)e|=e>>t;e++}return e}(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function p(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,t.sync?r.nextTick(function(){v(e)}):v(e))}function v(e){e.emit("readable")}function m(e){var t,r=e._readableState;function n(e,n,i){!1===e.write(t)&&r.awaitDrain++}for(r.awaitDrain=0;r.pipesCount&&null!==(t=e.read());)if(1===r.pipesCount?n(r.pipes):w(r.pipes,n),e.emit("data",t),r.awaitDrain>0)return;if(0===r.pipesCount)return r.flowing=!1,void(o.listenerCount(e,"data")>0&&y(e));r.ranOut=!0}function g(){this._readableState.ranOut&&(this._readableState.ranOut=!1,m(this))}function y(e,t){if(e._readableState.flowing)throw new Error("Cannot switch to old mode now.");var n=t||!1,i=!1;e.readable=!0,e.pipe=a.prototype.pipe,e.on=e.addListener=a.prototype.on,e.on("readable",function(){var t;for(i=!0;!n&&null!==(t=e.read());)e.emit("data",t);null===t&&(i=!1,e._readableState.needReadable=!0)}),e.pause=function(){n=!0,this.emit("pause")},e.resume=function(){n=!1,i?r.nextTick(function(){e.emit("readable")}):this.read(0),this.emit("resume")},e.emit("readable")}function _(e,t){var r,n=t.buffer,o=t.length,s=!!t.decoder,a=!!t.objectMode;if(0===n.length)return null;if(0===o)r=null;else if(a)r=n.shift();else if(!e||e>=o)r=s?n.join(""):i.concat(n,o),n.length=0;else{if(e<n[0].length)r=(l=n[0]).slice(0,e),n[0]=l.slice(e);else if(e===n[0].length)r=n.shift();else{r=s?"":new i(e);for(var u=0,c=0,f=n.length;c<f&&u<e;c++){var l=n[0],h=Math.min(e-u,l.length);s?r+=l.slice(0,h):l.copy(r,u,0,h),h<l.length?n[0]=l.slice(h):n.shift(),u+=h}}}return r}function b(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");!t.endEmitted&&t.calledRead&&(t.ended=!0,r.nextTick(function(){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}))}function w(e,t){for(var r=0,n=e.length;r<n;r++)t(e[r],r)}f.prototype.read=function(e){var t=this._readableState;t.calledRead=!0;var r,n=e;if(("number"!=typeof e||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return p(this),null;if(0===(e=d(e,t))&&t.ended)return r=null,t.length>0&&t.decoder&&(r=_(e,t),t.length-=r.length),0===t.length&&b(this),r;var i=t.needReadable;return t.length-e<=t.highWaterMark&&(i=!0),(t.ended||t.reading)&&(i=!1),i&&(t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),i&&!t.reading&&(e=d(n,t)),null===(r=e>0?_(e,t):null)&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),t.ended&&!t.endEmitted&&0===t.length&&b(this),r},f.prototype._read=function(e){this.emit("error",new Error("not implemented"))},f.prototype.pipe=function(e,t){var i=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=e;break;case 1:s.pipes=[s.pipes,e];break;default:s.pipes.push(e)}s.pipesCount+=1;var a=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?c:l;function u(e){e===i&&l()}function c(){e.end()}s.endEmitted?r.nextTick(a):i.once("end",a),e.on("unpipe",u);var f=function(e){return function(){var t=e._readableState;t.awaitDrain--,0===t.awaitDrain&&m(e)}}(i);function l(){e.removeListener("close",d),e.removeListener("finish",p),e.removeListener("drain",f),e.removeListener("error",h),e.removeListener("unpipe",u),i.removeListener("end",c),i.removeListener("end",l),e._writableState&&!e._writableState.needDrain||f()}function h(t){v(),e.removeListener("error",h),0===o.listenerCount(e,"error")&&e.emit("error",t)}function d(){e.removeListener("finish",p),v()}function p(){e.removeListener("close",d),v()}function v(){i.unpipe(e)}return e.on("drain",f),e._events&&e._events.error?n(e._events.error)?e._events.error.unshift(h):e._events.error=[h,e._events.error]:e.on("error",h),e.once("close",d),e.once("finish",p),e.emit("pipe",i),s.flowing||(this.on("readable",g),s.flowing=!0,r.nextTick(function(){m(i)})),e},f.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,this.removeListener("readable",g),t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var r=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,this.removeListener("readable",g),t.flowing=!1;for(var i=0;i<n;i++)r[i].emit("unpipe",this);return this}return-1===(i=function(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}(t.pipes,e))?this:(t.pipes.splice(i,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},f.prototype.on=function(e,t){var r=a.prototype.on.call(this,e,t);if("data"!==e||this._readableState.flowing||y(this),"readable"===e&&this.readable){var n=this._readableState;n.readableListening||(n.readableListening=!0,n.emittedReadable=!1,n.needReadable=!0,n.reading?n.length&&p(this):this.read(0))}return r},f.prototype.addListener=f.prototype.on,f.prototype.resume=function(){y(this),this.read(0),this.emit("resume")},f.prototype.pause=function(){y(this,!0),this.emit("pause")},f.prototype.wrap=function(e){var t=this._readableState,r=!1,n=this;for(var i in e.on("end",function(){if(t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&n.push(e)}n.push(null)}),e.on("data",function(i){(t.decoder&&(i=t.decoder.write(i)),!t.objectMode||null!==i&&void 0!==i)&&((t.objectMode||i&&i.length)&&(n.push(i)||(r=!0,e.pause())))}),e)"function"==typeof e[i]&&void 0===this[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));return w(["error","close","destroy","pause","resume"],function(t){e.on(t,n.emit.bind(n,t))}),n._read=function(t){r&&(r=!1,e.resume())},n},f._fromList=_}).call(this,e("_process"))},{_process:43,buffer:8,"core-util-is":70,events:16,inherits:84,isarray:89,stream:50,"string_decoder/":136}],116:[function(e,t,r){t.exports=s;var n=e("./_stream_duplex"),i=e("core-util-is");function o(e,t){this.afterTransform=function(e,r){return function(e,t,r){var n=e._transformState;n.transforming=!1;var i=n.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));n.writechunk=null,n.writecb=null,null!==r&&void 0!==r&&e.push(r);i&&i(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}(t,e,r)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function s(e){if(!(this instanceof s))return new s(e);n.call(this,e);this._transformState=new o(e,this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",function(){"function"==typeof this._flush?this._flush(function(e){a(t,e)}):a(t)})}function a(e,t){if(t)return e.emit("error",t);var r=e._writableState,n=(e._readableState,e._transformState);if(r.length)throw new Error("calling transform done when ws.length != 0");if(n.transforming)throw new Error("calling transform done when still transforming");return e.push(null)}i.inherits=e("inherits"),i.inherits(s,n),s.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},s.prototype._transform=function(e,t,r){throw new Error("not implemented")},s.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},s.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},{"./_stream_duplex":113,"core-util-is":70,inherits:84}],117:[function(e,t,r){(function(r){t.exports=a;var n=e("buffer").Buffer;a.WritableState=s;var i=e("core-util-is");i.inherits=e("inherits");var o=e("stream");function s(e,t){var n=(e=e||{}).highWaterMark;this.highWaterMark=n||0===n?n:16384,this.objectMode=!!e.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var i=!1===e.decodeStrings;this.decodeStrings=!i,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,i=n.sync,o=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,i,o){n?r.nextTick(function(){o(i)}):o(i);e._writableState.errorEmitted=!0,e.emit("error",i)}(e,0,i,t,o);else{var s=f(e,n);s||n.bufferProcessing||!n.buffer.length||function(e,t){t.bufferProcessing=!0;for(var r=0;r<t.buffer.length;r++){var n=t.buffer[r],i=n.chunk,o=n.encoding,s=n.callback,a=t.objectMode?1:i.length;if(u(e,t,a,i,o,s),t.writing){r++;break}}t.bufferProcessing=!1,r<t.buffer.length?t.buffer=t.buffer.slice(r):t.buffer.length=0}(e,n),i?r.nextTick(function(){c(e,n,s,o)}):c(e,n,s,o)}}(t,e)},this.writecb=null,this.writelen=0,this.buffer=[],this.errorEmitted=!1}function a(t){var r=e("./_stream_duplex");if(!(this instanceof a||this instanceof r))return new a(t);this._writableState=new s(t,this),this.writable=!0,o.call(this)}function u(e,t,r,n,i,o){t.writelen=r,t.writecb=o,t.writing=!0,t.sync=!0,e._write(n,i,t.onwrite),t.sync=!1}function c(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),n(),r&&l(e,t)}function f(e,t){return t.ending&&0===t.length&&!t.finished&&!t.writing}function l(e,t){var r=f(0,t);return r&&(t.finished=!0,e.emit("finish")),r}i.inherits(a,o),a.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},a.prototype.write=function(e,t,i){var o=this._writableState,s=!1;return"function"==typeof t&&(i=t,t=null),n.isBuffer(e)?t="buffer":t||(t=o.defaultEncoding),"function"!=typeof i&&(i=function(){}),o.ended?function(e,t,n){var i=new Error("write after end");e.emit("error",i),r.nextTick(function(){n(i)})}(this,0,i):function(e,t,i,o){var s=!0;if(!n.isBuffer(i)&&"string"!=typeof i&&null!==i&&void 0!==i&&!t.objectMode){var a=new TypeError("Invalid non-string/buffer chunk");e.emit("error",a),r.nextTick(function(){o(a)}),s=!1}return s}(this,o,e,i)&&(s=function(e,t,r,i,o){r=function(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=new n(t,r)),t}(t,r,i),n.isBuffer(r)&&(i="buffer");var s=t.objectMode?1:r.length;t.length+=s;var a=t.length<t.highWaterMark;a||(t.needDrain=!0);t.writing?t.buffer.push(new function(e,t,r){this.chunk=e,this.encoding=t,this.callback=r}(r,i,o)):u(e,t,s,r,i,o);return a}(this,o,e,t,i)),s},a.prototype._write=function(e,t,r){r(new Error("not implemented"))},a.prototype.end=function(e,t,n){var i=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),void 0!==e&&null!==e&&this.write(e,t),i.ending||i.finished||function(e,t,n){t.ending=!0,l(e,t),n&&(t.finished?r.nextTick(n):e.once("finish",n));t.ended=!0}(this,i,n)}}).call(this,e("_process"))},{"./_stream_duplex":113,_process:43,buffer:8,"core-util-is":70,inherits:84,stream:50}],118:[function(e,t,r){var n=e("stream");(r=t.exports=e("./lib/_stream_readable.js")).Stream=n,r.Readable=r,r.Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":113,"./lib/_stream_passthrough.js":114,"./lib/_stream_readable.js":115,"./lib/_stream_transform.js":116,"./lib/_stream_writable.js":117,stream:50}],119:[function(e,t,r){"use strict";t.exports=l;var n=e("process-nextick-args"),i=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t},o=e("core-util-is");o.inherits=e("inherits");var s=e("./_stream_readable"),a=e("./_stream_writable");o.inherits(l,s);for(var u=i(a.prototype),c=0;c<u.length;c++){var f=u[c];l.prototype[f]||(l.prototype[f]=a.prototype[f])}function l(e){if(!(this instanceof l))return new l(e);s.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",h)}function h(){this.allowHalfOpen||this._writableState.ended||n(d,this)}function d(e){e.end()}},{"./_stream_readable":120,"./_stream_writable":122,"core-util-is":70,inherits:84,"process-nextick-args":109}],120:[function(e,t,r){(function(r){"use strict";t.exports=h;var n=e("process-nextick-args"),i=e("isarray"),o=e("buffer").Buffer;h.ReadableState=l;var s,a=e("events").EventEmitter;a.listenerCount||(a.listenerCount=function(e,t){return e.listeners(t).length}),function(){try{s=e("stream")}catch(t){s=e("events").EventEmitter}}();var u=e("core-util-is");u.inherits=e("inherits");var c,f=e("util");function l(t,r){var n=e("./_stream_duplex");t=t||{},this.objectMode=!!t.objectMode,r instanceof n&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var i=t.highWaterMark,o=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:o,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(c||(c=e("string_decoder/").StringDecoder),this.decoder=new c(t.encoding),this.encoding=t.encoding)}function h(t){e("./_stream_duplex");if(!(this instanceof h))return new h(t);this._readableState=new l(t,this),this.readable=!0,t&&"function"==typeof t.read&&(this._read=t.read),s.call(this)}function d(e,t,r,i,s){var a=function(e,t){var r=null;o.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));return r}(t,r);if(a)e.emit("error",a);else if(null===r)t.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,m(e)}(e,t);else if(t.objectMode||r&&r.length>0)if(t.ended&&!s){var u=new Error("stream.push() after EOF");e.emit("error",u)}else if(t.endEmitted&&s){u=new Error("stream.unshift() after end event");e.emit("error",u)}else!t.decoder||s||i||(r=t.decoder.write(r)),s||(t.reading=!1),t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,s?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&m(e)),function(e,t){t.readingMore||(t.readingMore=!0,n(y,e,t))}(e,t);else s||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}f=f&&f.debuglog?f.debuglog("stream"):function(){},u.inherits(h,s),h.prototype.push=function(e,t){var r=this._readableState;return r.objectMode||"string"!=typeof e||(t=t||r.defaultEncoding)!==r.encoding&&(e=new o(e,t),t=""),d(this,r,e,t,!1)},h.prototype.unshift=function(e){return d(this,this._readableState,e,"",!0)},h.prototype.isPaused=function(){return!1===this._readableState.flowing},h.prototype.setEncoding=function(t){return c||(c=e("string_decoder/").StringDecoder),this._readableState.decoder=new c(t),this._readableState.encoding=t,this};var p=8388608;function v(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:null===e||isNaN(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:e<=0?0:(e>t.highWaterMark&&(t.highWaterMark=function(e){if(e>=p)e=p;else{e--;for(var t=1;t<32;t<<=1)e|=e>>t;e++}return e}(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function m(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?n(g,e):g(e))}function g(e){f("emit readable"),e.emit("readable"),w(e)}function y(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(f("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function _(e){f("readable nexttick read 0"),e.read(0)}function b(e,t){t.reading||(f("resume read 0"),e.read(0)),t.resumeScheduled=!1,e.emit("resume"),w(e),t.flowing&&!t.reading&&e.read(0)}function w(e){var t=e._readableState;if(f("flow",t.flowing),t.flowing)do{var r=e.read()}while(null!==r&&t.flowing)}function k(e,t){var r,n=t.buffer,i=t.length,s=!!t.decoder,a=!!t.objectMode;if(0===n.length)return null;if(0===i)r=null;else if(a)r=n.shift();else if(!e||e>=i)r=s?n.join(""):o.concat(n,i),n.length=0;else{if(e<n[0].length)r=(l=n[0]).slice(0,e),n[0]=l.slice(e);else if(e===n[0].length)r=n.shift();else{r=s?"":new o(e);for(var u=0,c=0,f=n.length;c<f&&u<e;c++){var l=n[0],h=Math.min(e-u,l.length);s?r+=l.slice(0,h):l.copy(r,u,0,h),h<l.length?n[0]=l.slice(h):n.shift(),u+=h}}}return r}function x(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");t.endEmitted||(t.ended=!0,n(E,t,e))}function E(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}h.prototype.read=function(e){f("read",e);var t=this._readableState,r=e;if(("number"!=typeof e||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?x(this):m(this),null;if(0===(e=v(e,t))&&t.ended)return 0===t.length&&x(this),null;var n,i=t.needReadable;return f("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&f("length less than watermark",i=!0),(t.ended||t.reading)&&f("reading or ended",i=!1),i&&(f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),i&&!t.reading&&(e=v(r,t)),null===(n=e>0?k(e,t):null)&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),r!==e&&t.ended&&0===t.length&&x(this),null!==n&&this.emit("data",n),n},h.prototype._read=function(e){this.emit("error",new Error("not implemented"))},h.prototype.pipe=function(e,t){var o=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=e;break;case 1:s.pipes=[s.pipes,e];break;default:s.pipes.push(e)}s.pipesCount+=1,f("pipe count=%d opts=%j",s.pipesCount,t);var u=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?l:d;function c(e){f("onunpipe"),e===o&&d()}function l(){f("onend"),e.end()}s.endEmitted?n(u):o.once("end",u),e.on("unpipe",c);var h=function(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a.listenerCount(e,"data")&&(t.flowing=!0,w(e))}}(o);function d(){f("cleanup"),e.removeListener("close",m),e.removeListener("finish",g),e.removeListener("drain",h),e.removeListener("error",v),e.removeListener("unpipe",c),o.removeListener("end",l),o.removeListener("end",d),o.removeListener("data",p),!s.awaitDrain||e._writableState&&!e._writableState.needDrain||h()}function p(t){f("ondata"),!1===e.write(t)&&(f("false write response, pause",o._readableState.awaitDrain),o._readableState.awaitDrain++,o.pause())}function v(t){f("onerror",t),y(),e.removeListener("error",v),0===a.listenerCount(e,"error")&&e.emit("error",t)}function m(){e.removeListener("finish",g),y()}function g(){f("onfinish"),e.removeListener("close",m),y()}function y(){f("unpipe"),o.unpipe(e)}return e.on("drain",h),o.on("data",p),e._events&&e._events.error?i(e._events.error)?e._events.error.unshift(v):e._events.error=[v,e._events.error]:e.on("error",v),e.once("close",m),e.once("finish",g),e.emit("pipe",o),s.flowing||(f("pipe resume"),o.resume()),e},h.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var r=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<n;i++)r[i].emit("unpipe",this);return this}return-1===(i=function(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}(t.pipes,e))?this:(t.pipes.splice(i,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},h.prototype.on=function(e,t){var r=s.prototype.on.call(this,e,t);if("data"===e&&!1!==this._readableState.flowing&&this.resume(),"readable"===e&&this.readable){var i=this._readableState;i.readableListening||(i.readableListening=!0,i.emittedReadable=!1,i.needReadable=!0,i.reading?i.length&&m(this):n(_,this))}return r},h.prototype.addListener=h.prototype.on,h.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n(b,e,t))}(this,e)),this},h.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},h.prototype.wrap=function(e){var t=this._readableState,r=!1,n=this;for(var i in e.on("end",function(){if(f("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&n.push(e)}n.push(null)}),e.on("data",function(i){(f("wrapped data"),t.decoder&&(i=t.decoder.write(i)),!t.objectMode||null!==i&&void 0!==i)&&((t.objectMode||i&&i.length)&&(n.push(i)||(r=!0,e.pause())))}),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));return function(e,t){for(var r=0,n=e.length;r<n;r++)t(e[r],r)}(["error","close","destroy","pause","resume"],function(t){e.on(t,n.emit.bind(n,t))}),n._read=function(t){f("wrapped _read",t),r&&(r=!1,e.resume())},n},h._fromList=k}).call(this,e("_process"))},{"./_stream_duplex":119,_process:43,buffer:8,"core-util-is":70,events:16,inherits:84,isarray:89,"process-nextick-args":109,"string_decoder/":136,util:54}],121:[function(e,t,r){"use strict";t.exports=s;var n=e("./_stream_duplex"),i=e("core-util-is");function o(e){this.afterTransform=function(t,r){return function(e,t,r){var n=e._transformState;n.transforming=!1;var i=n.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));n.writechunk=null,n.writecb=null,null!==r&&void 0!==r&&e.push(r);i&&i(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}(e,t,r)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function s(e){if(!(this instanceof s))return new s(e);n.call(this,e),this._transformState=new o(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(e){a(t,e)}):a(t)})}function a(e,t){if(t)return e.emit("error",t);var r=e._writableState,n=e._transformState;if(r.length)throw new Error("calling transform done when ws.length != 0");if(n.transforming)throw new Error("calling transform done when still transforming");return e.push(null)}i.inherits=e("inherits"),i.inherits(s,n),s.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},s.prototype._transform=function(e,t,r){throw new Error("not implemented")},s.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},s.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},{"./_stream_duplex":119,"core-util-is":70,inherits:84}],122:[function(e,t,r){"use strict";t.exports=c;var n=e("process-nextick-args"),i=e("buffer").Buffer;c.WritableState=u;var o,s=e("core-util-is");function a(){}function u(t,r){var i=e("./_stream_duplex");t=t||{},this.objectMode=!!t.objectMode,r instanceof i&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var o=t.highWaterMark,s=this.objectMode?16:16384;this.highWaterMark=o||0===o?o:s,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var a=!1===t.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,i=r.sync,o=r.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,i,o){--t.pendingcb,r?n(o,i):o(i);e._writableState.errorEmitted=!0,e.emit("error",i)}(e,r,i,t,o);else{var s=d(r);s||r.corked||r.bufferProcessing||!r.bufferedRequest||h(e,r),i?n(l,e,r,s,o):l(e,r,s,o)}}(r,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1}function c(t){var r=e("./_stream_duplex");if(!(this instanceof c||this instanceof r))return new c(t);this._writableState=new u(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev)),o.call(this)}function f(e,t,r,n,i,o,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function l(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),v(e,t)}function h(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){for(var n=[],i=[];r;)i.push(r.callback),n.push(r),r=r.next;t.pendingcb++,t.lastBufferedRequest=null,f(e,t,!0,t.length,n,"",function(e){for(var r=0;r<i.length;r++)t.pendingcb--,i[r](e)})}else{for(;r;){var o=r.chunk,s=r.encoding,a=r.callback,u=t.objectMode?1:o.length;if(f(e,t,!1,u,o,s,a),r=r.next,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function d(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function p(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function v(e,t){var r=d(t);return r&&(0===t.pendingcb?(p(e,t),t.finished=!0,e.emit("finish")):p(e,t)),r}s.inherits=e("inherits"),function(){try{o=e("stream")}catch(t){o=e("events").EventEmitter}}(),s.inherits(c,o),u.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},Object.defineProperty(u.prototype,"buffer",{get:e("util-deprecate")(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer() instead.")}),c.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},c.prototype.write=function(e,t,r){var o=this._writableState,s=!1;return"function"==typeof t&&(r=t,t=null),e instanceof i?t="buffer":t||(t=o.defaultEncoding),"function"!=typeof r&&(r=a),o.ended?function(e,t){var r=new Error("write after end");e.emit("error",r),n(t,r)}(this,r):function(e,t,r,o){var s=!0;if(!i.isBuffer(r)&&"string"!=typeof r&&null!==r&&void 0!==r&&!t.objectMode){var a=new TypeError("Invalid non-string/buffer chunk");e.emit("error",a),n(o,a),s=!1}return s}(this,o,e,r)&&(o.pendingcb++,s=function(e,t,r,n,o){(r=function(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=new i(t,r)),t}(t,r,n))instanceof i&&(n="buffer");var s=t.objectMode?1:r.length;t.length+=s;var a=t.length<t.highWaterMark;a||(t.needDrain=!0);if(t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest=new function(e,t,r){this.chunk=e,this.encoding=t,this.callback=r,this.next=null}(r,n,o),u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest}else f(e,t,!1,s,r,n,o);return a}(this,o,e,t,r)),s},c.prototype.cork=function(){this._writableState.corked++},c.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||h(this,e))},c.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);this._writableState.defaultEncoding=e},c.prototype._write=function(e,t,r){r(new Error("not implemented"))},c.prototype._writev=null,c.prototype.end=function(e,t,r){var i=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!==e&&void 0!==e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||function(e,t,r){t.ending=!0,v(e,t),r&&(t.finished?n(r):e.once("finish",r));t.ended=!0}(this,i,r)}},{"./_stream_duplex":119,buffer:8,"core-util-is":70,events:16,inherits:84,"process-nextick-args":109,"util-deprecate":139}],123:[function(e,t,r){t.exports=e("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":121}],124:[function(e,t,r){t.exports=e("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":125}],125:[function(e,t,r){"use strict";var n=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};t.exports=l;var i=e("process-nextick-args"),o=e("core-util-is");o.inherits=e("inherits");var s=e("./_stream_readable"),a=e("./_stream_writable");o.inherits(l,s);for(var u=n(a.prototype),c=0;c<u.length;c++){var f=u[c];l.prototype[f]||(l.prototype[f]=a.prototype[f])}function l(e){if(!(this instanceof l))return new l(e);s.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",h)}function h(){this.allowHalfOpen||this._writableState.ended||i(d,this)}function d(e){e.end()}},{"./_stream_readable":127,"./_stream_writable":129,"core-util-is":70,inherits:84,"process-nextick-args":110}],126:[function(e,t,r){"use strict";t.exports=o;var n=e("./_stream_transform"),i=e("core-util-is");function o(e){if(!(this instanceof o))return new o(e);n.call(this,e)}i.inherits=e("inherits"),i.inherits(o,n),o.prototype._transform=function(e,t,r){r(null,e)}},{"./_stream_transform":128,"core-util-is":70,inherits:84}],127:[function(e,t,r){(function(r){"use strict";t.exports=m;var n,i=e("process-nextick-args"),o=e("isarray");m.ReadableState=v;e("events").EventEmitter;var s,a=function(e,t){return e.listeners(t).length};!function(){try{s=e("stream")}catch(e){}finally{s||(s=e("events").EventEmitter)}}();var u=e("buffer").Buffer,c=e("buffer-shims"),f=e("core-util-is");f.inherits=e("inherits");var l=e("util"),h=void 0;h=l&&l.debuglog?l.debuglog("stream"):function(){};var d,p=e("./internal/streams/BufferList");function v(t,r){n=n||e("./_stream_duplex"),t=t||{},this.objectMode=!!t.objectMode,r instanceof n&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var i=t.highWaterMark,o=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:o,this.highWaterMark=~~this.highWaterMark,this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(d||(d=e("string_decoder/").StringDecoder),this.decoder=new d(t.encoding),this.encoding=t.encoding)}function m(t){if(n=n||e("./_stream_duplex"),!(this instanceof m))return new m(t);this._readableState=new v(t,this),this.readable=!0,t&&"function"==typeof t.read&&(this._read=t.read),s.call(this)}function g(e,t,r,n,o){var s=function(e,t){var r=null;u.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));return r}(t,r);if(s)e.emit("error",s);else if(null===r)t.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,b(e)}(e,t);else if(t.objectMode||r&&r.length>0)if(t.ended&&!o){var a=new Error("stream.push() after EOF");e.emit("error",a)}else if(t.endEmitted&&o){var c=new Error("stream.unshift() after end event");e.emit("error",c)}else{var f;!t.decoder||o||n||(r=t.decoder.write(r),f=!t.objectMode&&0===r.length),o||(t.reading=!1),f||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,o?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&b(e))),function(e,t){t.readingMore||(t.readingMore=!0,i(k,e,t))}(e,t)}else o||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}f.inherits(m,s),m.prototype.push=function(e,t){var r=this._readableState;return r.objectMode||"string"!=typeof e||(t=t||r.defaultEncoding)!==r.encoding&&(e=c.from(e,t),t=""),g(this,r,e,t,!1)},m.prototype.unshift=function(e){return g(this,this._readableState,e,"",!0)},m.prototype.isPaused=function(){return!1===this._readableState.flowing},m.prototype.setEncoding=function(t){return d||(d=e("string_decoder/").StringDecoder),this._readableState.decoder=new d(t),this._readableState.encoding=t,this};var y=8388608;function _(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=y?e=y:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function b(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(h("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i(w,e):w(e))}function w(e){h("emit readable"),e.emit("readable"),S(e)}function k(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(h("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function x(e){h("readable nexttick read 0"),e.read(0)}function E(e,t){t.reading||(h("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),S(e),t.flowing&&!t.reading&&e.read(0)}function S(e){var t=e._readableState;for(h("flow",t.flowing);t.flowing&&null!==e.read(););}function R(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var n;e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?function(e,t){var r=t.head,n=1,i=r.data;e-=i.length;for(;r=r.next;){var o=r.data,s=e>o.length?o.length:e;if(s===o.length?i+=o:i+=o.slice(0,e),0===(e-=s)){s===o.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(s));break}++n}return t.length-=n,i}(e,t):function(e,t){var r=c.allocUnsafe(e),n=t.head,i=1;n.data.copy(r),e-=n.data.length;for(;n=n.next;){var o=n.data,s=e>o.length?o.length:e;if(o.copy(r,r.length-e,0,s),0===(e-=s)){s===o.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(s));break}++i}return t.length-=i,r}(e,t);return n}(e,t.buffer,t.decoder),r);var r}function j(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i(T,t,e))}function T(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function D(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}m.prototype.read=function(e){h("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return h("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?j(this):b(this),null;if(0===(e=_(e,t))&&t.ended)return 0===t.length&&j(this),null;var n,i=t.needReadable;return h("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&h("length less than watermark",i=!0),t.ended||t.reading?h("reading or ended",i=!1):i&&(h("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=_(r,t))),null===(n=e>0?R(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&j(this)),null!==n&&this.emit("data",n),n},m.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},m.prototype.pipe=function(e,t){var n=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=e;break;case 1:s.pipes=[s.pipes,e];break;default:s.pipes.push(e)}s.pipesCount+=1,h("pipe count=%d opts=%j",s.pipesCount,t);var u=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?f:p;function c(e){h("onunpipe"),e===n&&p()}function f(){h("onend"),e.end()}s.endEmitted?i(u):n.once("end",u),e.on("unpipe",c);var l=function(e){return function(){var t=e._readableState;h("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,S(e))}}(n);e.on("drain",l);var d=!1;function p(){h("cleanup"),e.removeListener("close",y),e.removeListener("finish",_),e.removeListener("drain",l),e.removeListener("error",g),e.removeListener("unpipe",c),n.removeListener("end",f),n.removeListener("end",p),n.removeListener("data",m),d=!0,!s.awaitDrain||e._writableState&&!e._writableState.needDrain||l()}var v=!1;function m(t){h("ondata"),v=!1,!1!==e.write(t)||v||((1===s.pipesCount&&s.pipes===e||s.pipesCount>1&&-1!==D(s.pipes,e))&&!d&&(h("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,v=!0),n.pause())}function g(t){h("onerror",t),b(),e.removeListener("error",g),0===a(e,"error")&&e.emit("error",t)}function y(){e.removeListener("finish",_),b()}function _(){h("onfinish"),e.removeListener("close",y),b()}function b(){h("unpipe"),n.unpipe(e)}return n.on("data",m),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?o(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",g),e.once("close",y),e.once("finish",_),e.emit("pipe",n),s.flowing||(h("pipe resume"),n.resume()),e},m.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var r=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<n;i++)r[i].emit("unpipe",this);return this}var o=D(t.pipes,e);return-1===o?this:(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},m.prototype.on=function(e,t){var r=s.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&b(this):i(x,this))}return r},m.prototype.addListener=m.prototype.on,m.prototype.resume=function(){var e=this._readableState;return e.flowing||(h("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i(E,e,t))}(this,e)),this},m.prototype.pause=function(){return h("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(h("pause"),this._readableState.flowing=!1,this.emit("pause")),this},m.prototype.wrap=function(e){var t=this._readableState,r=!1,n=this;for(var i in e.on("end",function(){if(h("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&n.push(e)}n.push(null)}),e.on("data",function(i){(h("wrapped data"),t.decoder&&(i=t.decoder.write(i)),!t.objectMode||null!==i&&void 0!==i)&&((t.objectMode||i&&i.length)&&(n.push(i)||(r=!0,e.pause())))}),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));return function(e,t){for(var r=0,n=e.length;r<n;r++)t(e[r],r)}(["error","close","destroy","pause","resume"],function(t){e.on(t,n.emit.bind(n,t))}),n._read=function(t){h("wrapped _read",t),r&&(r=!1,e.resume())},n},m._fromList=R}).call(this,e("_process"))},{"./_stream_duplex":125,"./internal/streams/BufferList":130,_process:43,buffer:8,"buffer-shims":68,"core-util-is":70,events:16,inherits:84,isarray:90,"process-nextick-args":110,"string_decoder/":136,util:54}],128:[function(e,t,r){"use strict";t.exports=s;var n=e("./_stream_duplex"),i=e("core-util-is");function o(e){this.afterTransform=function(t,r){return function(e,t,r){var n=e._transformState;n.transforming=!1;var i=n.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));n.writechunk=null,n.writecb=null,null!==r&&void 0!==r&&e.push(r);i(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}(e,t,r)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function s(e){if(!(this instanceof s))return new s(e);n.call(this,e),this._transformState=new o(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(e,r){a(t,e,r)}):a(t)})}function a(e,t,r){if(t)return e.emit("error",t);null!==r&&void 0!==r&&e.push(r);var n=e._writableState,i=e._transformState;if(n.length)throw new Error("Calling transform done when ws.length != 0");if(i.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=e("inherits"),i.inherits(s,n),s.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},s.prototype._transform=function(e,t,r){throw new Error("_transform() is not implemented")},s.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},s.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},{"./_stream_duplex":125,"core-util-is":70,inherits:84}],129:[function(e,t,r){(function(r){"use strict";t.exports=p;var n,i=e("process-nextick-args"),o=!r.browser&&["v0.10","v0.9."].indexOf(r.version.slice(0,5))>-1?setImmediate:i;p.WritableState=d;var s=e("core-util-is");s.inherits=e("inherits");var a,u={deprecate:e("util-deprecate")};!function(){try{a=e("stream")}catch(e){}finally{a||(a=e("events").EventEmitter)}}();var c,f=e("buffer").Buffer,l=e("buffer-shims");function h(){}function d(t,r){n=n||e("./_stream_duplex"),t=t||{},this.objectMode=!!t.objectMode,r instanceof n&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var s=t.highWaterMark,a=this.objectMode?16:16384;this.highWaterMark=s||0===s?s:a,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var u=!1===t.decodeStrings;this.decodeStrings=!u,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,s=r.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,n,o){--t.pendingcb,r?i(o,n):o(n);e._writableState.errorEmitted=!0,e.emit("error",n)}(e,r,n,t,s);else{var a=y(r);a||r.corked||r.bufferProcessing||!r.bufferedRequest||g(e,r),n?o(m,e,r,a,s):m(e,r,a,s)}}(r,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new w(this)}function p(t){if(n=n||e("./_stream_duplex"),!(c.call(p,this)||this instanceof n))return new p(t);this._writableState=new d(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev)),a.call(this)}function v(e,t,r,n,i,o,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function m(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),b(e,t)}function g(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),o=t.corkedRequestsFree;o.entry=r;for(var s=0;r;)i[s]=r,r=r.next,s+=1;v(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new w(t)}else{for(;r;){var a=r.chunk,u=r.encoding,c=r.callback;if(v(e,t,!1,t.objectMode?1:a.length,a,u,c),r=r.next,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=r,t.bufferProcessing=!1}function y(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function _(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function b(e,t){var r=y(t);return r&&(0===t.pendingcb?(_(e,t),t.finished=!0,e.emit("finish")):_(e,t)),r}function w(e){var t=this;this.next=null,this.entry=null,this.finish=function(r){var n=t.entry;for(t.entry=null;n;){var i=n.callback;e.pendingcb--,i(r),n=n.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}s.inherits(p,a),d.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(d.prototype,"buffer",{get:u.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(c=Function.prototype[Symbol.hasInstance],Object.defineProperty(p,Symbol.hasInstance,{value:function(e){return!!c.call(this,e)||e&&e._writableState instanceof d}})):c=function(e){return e instanceof this},p.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},p.prototype.write=function(e,t,r){var n=this._writableState,o=!1;return"function"==typeof t&&(r=t,t=null),f.isBuffer(e)?t="buffer":t||(t=n.defaultEncoding),"function"!=typeof r&&(r=h),n.ended?function(e,t){var r=new Error("write after end");e.emit("error",r),i(t,r)}(this,r):function(e,t,r,n){var o=!0,s=!1;return null===r?s=new TypeError("May not write null values to stream"):f.isBuffer(r)||"string"==typeof r||void 0===r||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),i(n,s),o=!1),o}(this,n,e,r)&&(n.pendingcb++,o=function(e,t,r,n,i){r=function(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=l.from(t,r)),t}(t,r,n),f.isBuffer(r)&&(n="buffer");var o=t.objectMode?1:r.length;t.length+=o;var s=t.length<t.highWaterMark;s||(t.needDrain=!0);if(t.writing||t.corked){var a=t.lastBufferedRequest;t.lastBufferedRequest=new function(e,t,r){this.chunk=e,this.encoding=t,this.callback=r,this.next=null}(r,n,i),a?a.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else v(e,t,!1,o,r,n,i);return s}(this,n,e,t,r)),o},p.prototype.cork=function(){this._writableState.corked++},p.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||g(this,e))},p.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},p.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},p.prototype._writev=null,p.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!==e&&void 0!==e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(e,t,r){t.ending=!0,b(e,t),r&&(t.finished?i(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,n,r)}}).call(this,e("_process"))},{"./_stream_duplex":125,_process:43,buffer:8,"buffer-shims":68,"core-util-is":70,events:16,inherits:84,"process-nextick-args":110,"util-deprecate":139}],130:[function(e,t,r){"use strict";e("buffer").Buffer;var n=e("buffer-shims");function i(){this.head=null,this.tail=null,this.length=0}t.exports=i,i.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},i.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},i.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},i.prototype.clear=function(){this.head=this.tail=null,this.length=0},i.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},i.prototype.concat=function(e){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var t=n.allocUnsafe(e>>>0),r=this.head,i=0;r;)r.data.copy(t,i),i+=r.data.length,r=r.next;return t}},{buffer:8,"buffer-shims":68}],131:[function(e,t,r){t.exports=e("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":126}],132:[function(e,t,r){(function(n){var i=function(){try{return e("stream")}catch(e){}}();(r=t.exports=e("./lib/_stream_readable.js")).Stream=i||r,r.Readable=r,r.Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js"),!n.browser&&"disable"===n.env.READABLE_STREAM&&i&&(t.exports=i)}).call(this,e("_process"))},{"./lib/_stream_duplex.js":125,"./lib/_stream_passthrough.js":126,"./lib/_stream_readable.js":127,"./lib/_stream_transform.js":128,"./lib/_stream_writable.js":129,_process:43}],133:[function(e,t,r){arguments[4][123][0].apply(r,arguments)},{"./lib/_stream_transform.js":128,dup:123}],134:[function(e,t,r){t.exports=e("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":129}],135:[function(e,t,r){(function(e){var n;r=t.exports=J,n="object"==typeof e&&e.env&&e.env.NODE_DEBUG&&/\bsemver\b/i.test(e.env.NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:function(){},r.SEMVER_SPEC_VERSION="2.0.0";var i=256,o=Number.MAX_SAFE_INTEGER||9007199254740991,s=r.re=[],a=r.src=[],u=0,c=u++;a[c]="0|[1-9]\\d*";var f=u++;a[f]="[0-9]+";var l=u++;a[l]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var h=u++;a[h]="("+a[c]+")\\.("+a[c]+")\\.("+a[c]+")";var d=u++;a[d]="("+a[f]+")\\.("+a[f]+")\\.("+a[f]+")";var p=u++;a[p]="(?:"+a[c]+"|"+a[l]+")";var v=u++;a[v]="(?:"+a[f]+"|"+a[l]+")";var m=u++;a[m]="(?:-("+a[p]+"(?:\\."+a[p]+")*))";var g=u++;a[g]="(?:-?("+a[v]+"(?:\\."+a[v]+")*))";var y=u++;a[y]="[0-9A-Za-z-]+";var _=u++;a[_]="(?:\\+("+a[y]+"(?:\\."+a[y]+")*))";var b=u++,w="v?"+a[h]+a[m]+"?"+a[_]+"?";a[b]="^"+w+"$";var k="[v=\\s]*"+a[d]+a[g]+"?"+a[_]+"?",x=u++;a[x]="^"+k+"$";var E=u++;a[E]="((?:<|>)?=?)";var S=u++;a[S]=a[f]+"|x|X|\\*";var R=u++;a[R]=a[c]+"|x|X|\\*";var j=u++;a[j]="[v=\\s]*("+a[R]+")(?:\\.("+a[R]+")(?:\\.("+a[R]+")(?:"+a[m]+")?"+a[_]+"?)?)?";var T=u++;a[T]="[v=\\s]*("+a[S]+")(?:\\.("+a[S]+")(?:\\.("+a[S]+")(?:"+a[g]+")?"+a[_]+"?)?)?";var D=u++;a[D]="^"+a[E]+"\\s*"+a[j]+"$";var O=u++;a[O]="^"+a[E]+"\\s*"+a[T]+"$";var A=u++;a[A]="(?:~>?)";var B=u++;a[B]="(\\s*)"+a[A]+"\\s+",s[B]=new RegExp(a[B],"g");var C=u++;a[C]="^"+a[A]+a[j]+"$";var L=u++;a[L]="^"+a[A]+a[T]+"$";var I=u++;a[I]="(?:\\^)";var q=u++;a[q]="(\\s*)"+a[I]+"\\s+",s[q]=new RegExp(a[q],"g");var N=u++;a[N]="^"+a[I]+a[j]+"$";var M=u++;a[M]="^"+a[I]+a[T]+"$";var P=u++;a[P]="^"+a[E]+"\\s*("+k+")$|^$";var F=u++;a[F]="^"+a[E]+"\\s*("+w+")$|^$";var U=u++;a[U]="(\\s*)"+a[E]+"\\s*("+k+"|"+a[j]+")",s[U]=new RegExp(a[U],"g");var G=u++;a[G]="^\\s*("+a[j]+")\\s+-\\s+("+a[j]+")\\s*$";var W=u++;a[W]="^\\s*("+a[T]+")\\s+-\\s+("+a[T]+")\\s*$";var z=u++;a[z]="(<|>)?=?\\s*\\*";for(var H=0;H<u;H++)n(H,a[H]),s[H]||(s[H]=new RegExp(a[H]));function K(e,t){if(e instanceof J)return e;if("string"!=typeof e)return null;if(e.length>i)return null;if(!(t?s[x]:s[b]).test(e))return null;try{return new J(e,t)}catch(e){return null}}function J(e,t){if(e instanceof J){if(e.loose===t)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>i)throw new TypeError("version is longer than "+i+" characters");if(!(this instanceof J))return new J(e,t);n("SemVer",e,t),this.loose=t;var r=e.trim().match(t?s[x]:s[b]);if(!r)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<o)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}r.parse=K,r.valid=function(e,t){var r=K(e,t);return r?r.version:null},r.clean=function(e,t){var r=K(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null},r.SemVer=J,J.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},J.prototype.toString=function(){return this.version},J.prototype.compare=function(e){return n("SemVer.compare",this.version,this.loose,e),e instanceof J||(e=new J(e,this.loose)),this.compareMain(e)||this.comparePre(e)},J.prototype.compareMain=function(e){return e instanceof J||(e=new J(e,this.loose)),$(this.major,e.major)||$(this.minor,e.minor)||$(this.patch,e.patch)},J.prototype.comparePre=function(e){if(e instanceof J||(e=new J(e,this.loose)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var r=this.prerelease[t],i=e.prerelease[t];if(n("prerelease compare",t,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return-1;if(r!==i)return $(r,i)}while(++t)},J.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var r=this.prerelease.length;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);-1===r&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},r.inc=function(e,t,r,n){"string"==typeof r&&(n=r,r=void 0);try{return new J(e,r).inc(t,n).version}catch(e){return null}},r.diff=function(e,t){if(ee(e,t))return null;var r=K(e),n=K(t);if(r.prerelease.length||n.prerelease.length){for(var i in r)if(("major"===i||"minor"===i||"patch"===i)&&r[i]!==n[i])return"pre"+i;return"prerelease"}for(var i in r)if(("major"===i||"minor"===i||"patch"===i)&&r[i]!==n[i])return i},r.compareIdentifiers=$;var V=/^[0-9]+$/;function $(e,t){var r=V.test(e),n=V.test(t);return r&&n&&(e=+e,t=+t),r&&!n?-1:n&&!r?1:e<t?-1:e>t?1:0}function Q(e,t,r){return new J(e,r).compare(t)}function X(e,t,r){return Q(t,e,r)}function Y(e,t,r){return Q(e,t,r)>0}function Z(e,t,r){return Q(e,t,r)<0}function ee(e,t,r){return 0===Q(e,t,r)}function te(e,t,r){return 0!==Q(e,t,r)}function re(e,t,r){return Q(e,t,r)>=0}function ne(e,t,r){return Q(e,t,r)<=0}function ie(e,t,r,n){var i;switch(t){case"===":"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),i=e===r;break;case"!==":"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),i=e!==r;break;case"":case"=":case"==":i=ee(e,r,n);break;case"!=":i=te(e,r,n);break;case">":i=Y(e,r,n);break;case">=":i=re(e,r,n);break;case"<":i=Z(e,r,n);break;case"<=":i=ne(e,r,n);break;default:throw new TypeError("Invalid operator: "+t)}return i}function oe(e,t){if(e instanceof oe){if(e.loose===t)return e;e=e.value}if(!(this instanceof oe))return new oe(e,t);n("comparator",e,t),this.loose=t,this.parse(e),this.semver===se?this.value="":this.value=this.operator+this.semver.version,n("comp",this)}r.rcompareIdentifiers=function(e,t){return $(t,e)},r.major=function(e,t){return new J(e,t).major},r.minor=function(e,t){return new J(e,t).minor},r.patch=function(e,t){return new J(e,t).patch},r.compare=Q,r.compareLoose=function(e,t){return Q(e,t,!0)},r.rcompare=X,r.sort=function(e,t){return e.sort(function(e,n){return r.compare(e,n,t)})},r.rsort=function(e,t){return e.sort(function(e,n){return r.rcompare(e,n,t)})},r.gt=Y,r.lt=Z,r.eq=ee,r.neq=te,r.gte=re,r.lte=ne,r.cmp=ie,r.Comparator=oe;var se={};function ae(e,t){if(e instanceof ae&&e.loose===t)return e;if(!(this instanceof ae))return new ae(e,t);if(this.loose=t,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(function(e){return this.parseRange(e.trim())},this).filter(function(e){return e.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function ue(e){return!e||"x"===e.toLowerCase()||"*"===e}function ce(e,t,r,n,i,o,s,a,u,c,f,l,h){return((t=ue(r)?"":ue(n)?">="+r+".0.0":ue(i)?">="+r+"."+n+".0":">="+t)+" "+(a=ue(u)?"":ue(c)?"<"+(+u+1)+".0.0":ue(f)?"<"+u+"."+(+c+1)+".0":l?"<="+u+"."+c+"."+f+"-"+l:"<="+a)).trim()}function fe(e,t){for(var r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length){for(r=0;r<e.length;r++)if(n(e[r].semver),e[r].semver!==se&&e[r].semver.prerelease.length>0){var i=e[r].semver;if(i.major===t.major&&i.minor===t.minor&&i.patch===t.patch)return!0}return!1}return!0}function le(e,t,r){try{t=new ae(t,r)}catch(e){return!1}return t.test(e)}function he(e,t,r,n){var i,o,s,a,u;switch(e=new J(e,n),t=new ae(t,n),r){case">":i=Y,o=ne,s=Z,a=">",u=">=";break;case"<":i=Z,o=re,s=Y,a="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(le(e,t,n))return!1;for(var c=0;c<t.set.length;++c){var f=null,l=null;if(t.set[c].forEach(function(e){e.semver===se&&(e=new oe(">=0.0.0")),f=f||e,l=l||e,i(e.semver,f.semver,n)?f=e:s(e.semver,l.semver,n)&&(l=e)}),f.operator===a||f.operator===u)return!1;if((!l.operator||l.operator===a)&&o(e,l.semver))return!1;if(l.operator===u&&s(e,l.semver))return!1}return!0}oe.prototype.parse=function(e){var t=this.loose?s[P]:s[F],r=e.match(t);if(!r)throw new TypeError("Invalid comparator: "+e);this.operator=r[1],"="===this.operator&&(this.operator=""),r[2]?this.semver=new J(r[2],this.loose):this.semver=se},oe.prototype.toString=function(){return this.value},oe.prototype.test=function(e){return n("Comparator.test",e,this.loose),this.semver===se||("string"==typeof e&&(e=new J(e,this.loose)),ie(e,this.operator,this.semver,this.loose))},r.Range=ae,ae.prototype.format=function(){return this.range=this.set.map(function(e){return e.join(" ").trim()}).join("||").trim(),this.range},ae.prototype.toString=function(){return this.range},ae.prototype.parseRange=function(e){var t=this.loose;e=e.trim(),n("range",e,t);var r=t?s[W]:s[G];e=e.replace(r,ce),n("hyphen replace",e),e=e.replace(s[U],"$1$2$3"),n("comparator trim",e,s[U]),e=(e=(e=e.replace(s[B],"$1~")).replace(s[q],"$1^")).split(/\s+/).join(" ");var i=t?s[P]:s[F],o=e.split(" ").map(function(e){return function(e,t){return n("comp",e),e=function(e,t){return e.trim().split(/\s+/).map(function(e){return function(e,t){n("caret",e,t);var r=t?s[M]:s[N];return e.replace(r,function(t,r,i,o,s){var a;return n("caret",e,t,r,i,o,s),ue(r)?a="":ue(i)?a=">="+r+".0.0 <"+(+r+1)+".0.0":ue(o)?a="0"===r?">="+r+"."+i+".0 <"+r+"."+(+i+1)+".0":">="+r+"."+i+".0 <"+(+r+1)+".0.0":s?(n("replaceCaret pr",s),"-"!==s.charAt(0)&&(s="-"+s),a="0"===r?"0"===i?">="+r+"."+i+"."+o+s+" <"+r+"."+i+"."+(+o+1):">="+r+"."+i+"."+o+s+" <"+r+"."+(+i+1)+".0":">="+r+"."+i+"."+o+s+" <"+(+r+1)+".0.0"):(n("no pr"),a="0"===r?"0"===i?">="+r+"."+i+"."+o+" <"+r+"."+i+"."+(+o+1):">="+r+"."+i+"."+o+" <"+r+"."+(+i+1)+".0":">="+r+"."+i+"."+o+" <"+(+r+1)+".0.0"),n("caret return",a),a})}(e,t)}).join(" ")}(e,t),n("caret",e),e=function(e,t){return e.trim().split(/\s+/).map(function(e){return function(e,t){var r=t?s[L]:s[C];return e.replace(r,function(t,r,i,o,s){var a;return n("tilde",e,t,r,i,o,s),ue(r)?a="":ue(i)?a=">="+r+".0.0 <"+(+r+1)+".0.0":ue(o)?a=">="+r+"."+i+".0 <"+r+"."+(+i+1)+".0":s?(n("replaceTilde pr",s),"-"!==s.charAt(0)&&(s="-"+s),a=">="+r+"."+i+"."+o+s+" <"+r+"."+(+i+1)+".0"):a=">="+r+"."+i+"."+o+" <"+r+"."+(+i+1)+".0",n("tilde return",a),a})}(e,t)}).join(" ")}(e,t),n("tildes",e),e=function(e,t){return n("replaceXRanges",e,t),e.split(/\s+/).map(function(e){return function(e,t){e=e.trim();var r=t?s[O]:s[D];return e.replace(r,function(t,r,i,o,s,a){n("xRange",e,t,r,i,o,s,a);var u=ue(i),c=u||ue(o),f=c||ue(s),l=f;return"="===r&&l&&(r=""),u?t=">"===r||"<"===r?"<0.0.0":"*":r&&l?(c&&(o=0),f&&(s=0),">"===r?(r=">=",c?(i=+i+1,o=0,s=0):f&&(o=+o+1,s=0)):"<="===r&&(r="<",c?i=+i+1:o=+o+1),t=r+i+"."+o+"."+s):c?t=">="+i+".0.0 <"+(+i+1)+".0.0":f&&(t=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0"),n("xRange return",t),t})}(e,t)}).join(" ")}(e,t),n("xrange",e),e=function(e,t){return n("replaceStars",e,t),e.trim().replace(s[z],"")}(e,t),n("stars",e),e}(e,t)}).join(" ").split(/\s+/);return this.loose&&(o=o.filter(function(e){return!!e.match(i)})),o=o.map(function(e){return new oe(e,t)})},r.toComparators=function(e,t){return new ae(e,t).set.map(function(e){return e.map(function(e){return e.value}).join(" ").trim().split(" ")})},ae.prototype.test=function(e){if(!e)return!1;"string"==typeof e&&(e=new J(e,this.loose));for(var t=0;t<this.set.length;t++)if(fe(this.set[t],e))return!0;return!1},r.satisfies=le,r.maxSatisfying=function(e,t,r){return e.filter(function(e){return le(e,t,r)}).sort(function(e,t){return X(e,t,r)})[0]||null},r.validRange=function(e,t){try{return new ae(e,t).range||"*"}catch(e){return null}},r.ltr=function(e,t,r){return he(e,t,"<",r)},r.gtr=function(e,t,r){return he(e,t,">",r)},r.outside=he}).call(this,e("_process"))},{_process:43}],136:[function(e,t,r){var n=e("buffer").Buffer;var i=r.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!n.isEncoding(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=s;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=a;break;default:return void(this.write=o)}this.charBuffer=new n(6),this.charReceived=0,this.charLength=0};function o(e){return e.toString(this.encoding)}function s(e){var t=this.charReceived=e.length%2;return this.charLength=t?2:0,t}function a(e){var t=this.charReceived=e.length%3;return this.charLength=t?3:0,t}i.prototype.write=function(e){for(var t="",r=0;this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,r,n),this.charReceived+=n-r,r=n,this.charReceived<this.charLength)return"";if(!((s=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&s<=56319)){if(this.charReceived=this.charLength=0,n==e.length)return t;e=e.slice(n,e.length);break}this.charLength+=this.surrogateSize,t=""}var i=this.detectIncompleteChar(e),o=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-i,o),this.charReceived=i,o-=i);var s;o=(t+=e.toString(this.encoding,0,o)).length-1;if((s=t.charCodeAt(o))>=55296&&s<=56319){var a=this.surrogateSize;return this.charLength+=a,this.charReceived+=a,this.charBuffer.copy(this.charBuffer,a,0,a),this.charBuffer.write(t.charAt(t.length-1),this.encoding),t.substring(0,o)}return t},i.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var r=e[e.length-t];if(1==t&&r>>5==6){this.charLength=2;break}if(t<=2&&r>>4==14){this.charLength=3;break}if(t<=3&&r>>3==30){this.charLength=4;break}}return t},i.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var r=this.charReceived,n=this.charBuffer,i=this.encoding;t+=n.slice(0,r).toString(i)}return t}},{buffer:8}],137:[function(e,t,r){(function(r){var n=e("readable-stream/transform"),i=e("util").inherits,o=e("xtend");function s(e){n.call(this,e),this._destroyed=!1}function a(e,t,r){r(null,e)}function u(e){return function(t,r,n){return"function"==typeof t&&(n=r,r=t,t={}),"function"!=typeof r&&(r=a),"function"!=typeof n&&(n=null),e(t,r,n)}}i(s,n),s.prototype.destroy=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;r.nextTick(function(){e&&t.emit("error",e),t.emit("close")})}},t.exports=u(function(e,t,r){var n=new s(e);return n._transform=t,r&&(n._flush=r),n}),t.exports.ctor=u(function(e,t,r){function n(t){if(!(this instanceof n))return new n(t);this.options=o(e,t),s.call(this,this.options)}return i(n,s),n.prototype._transform=t,r&&(n.prototype._flush=r),n}),t.exports.obj=u(function(e,t,r){var n=new s(o({objectMode:!0,highWaterMark:16},e));return n._transform=t,r&&(n._flush=r),n})}).call(this,e("_process"))},{_process:43,"readable-stream/transform":123,util:54,xtend:142}],138:[function(e,t,r){!function(){"use strict";var r=Object.prototype.toString,n=e("lodash.isnull"),i=e("validate.io-undefined");t.exports=function(e){return n(e)?"[object Null]":i(e)?"[object Undefined]":r.call(e)}}()},{"lodash.isnull":106,"validate.io-undefined":140}],139:[function(e,t,r){(function(e){function r(t){if(!e.localStorage)return!1;var r=e.localStorage[t];return null!=r&&"true"===String(r).toLowerCase()}t.exports=function(e,t){if(r("noDeprecation"))return e;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],140:[function(e,t,r){"use strict";t.exports=function(e){return void 0===e}},{}],141:[function(e,t,r){"use strict";function n(e,t,r){var n=r[r.length-1];e===n.element&&(r.pop(),n=r[r.length-1]);var i=n.element,o=n.index;if(Array.isArray(i))i.push(e);else if(o===t.length-2){i[t.pop()]=e}else t.push(e)}r.stringify=function(e){var t=[];t.push({obj:e});for(var r,n,i,o,s,a,u,c,f,l,h="";r=t.pop();)if(n=r.obj,h+=r.prefix||"",i=r.val||"")h+=i;else if("object"!=typeof n)h+=void 0===n?null:JSON.stringify(n);else if(null===n)h+="null";else if(Array.isArray(n)){for(t.push({val:"]"}),o=n.length-1;o>=0;o--)s=0===o?"":",",t.push({obj:n[o],prefix:s});t.push({val:"["})}else{for(u in a=[],n)n.hasOwnProperty(u)&&a.push(u);for(t.push({val:"}"}),o=a.length-1;o>=0;o--)f=n[c=a[o]],l=o>0?",":"",l+=JSON.stringify(c)+":",t.push({obj:f,prefix:l});t.push({val:"{"})}return h},r.parse=function(e){for(var t,r,i,o,s,a,u,c,f,l=[],h=[],d=0;;)if("}"!==(t=e[d++])&&"]"!==t&&void 0!==t)switch(t){case" ":case"\t":case"\n":case":":case",":break;case"n":d+=3,n(null,l,h);break;case"t":d+=3,n(!0,l,h);break;case"f":d+=4,n(!1,l,h);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(r="",d--;;){if(i=e[d++],!/[\d\.\-e\+]/.test(i)){d--;break}r+=i}n(parseFloat(r),l,h);break;case'"':for(o="",s=void 0,a=0;'"'!==(u=e[d++])||"\\"===s&&a%2==1;)o+=u,"\\"===(s=u)?a++:a=0;n(JSON.parse('"'+o+'"'),l,h);break;case"[":c={element:[],index:l.length},l.push(c.element),h.push(c);break;case"{":f={element:{},index:l.length},l.push(f.element),h.push(f);break;default:throw new Error("unexpectedly reached end of input: "+t)}else{if(1===l.length)return l.pop();n(l.pop(),l,h)}}},{}],142:[function(e,t,r){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}return e}},{}]},{},[32])(32)}),t.exports}();!function(){var GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;void 0===GLOBAL.lively&&(GLOBAL.lively={}),"undefined"==typeof btoa&&(GLOBAL.btoa=function(e){return new Buffer(e).toString("base64")}),"undefined"==typeof atob&&(GLOBAL.atob=function(e){return new Buffer(e,"base64").toString()}),function(){this.lively=this.lively||{},function(exports,_PouchDB,pouchdbAdapterMem,lively_lang,lively_resources){"use strict";_PouchDB="default"in _PouchDB?_PouchDB.default:_PouchDB,pouchdbAdapterMem="default"in pouchdbAdapterMem?pouchdbAdapterMem.default:pouchdbAdapterMem;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jsx=(REACT_ELEMENT_TYPE="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103,function(e,t,r,n){var i=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={}),t&&i)for(var s in i)void 0===t[s]&&(t[s]=i[s]);else t||(t=i||{});if(1===o)t.children=n;else if(o>1){for(var a=Array(o),u=0;u<o;u++)a[u]=arguments[u+3];t.children=a}return{$$typeof:REACT_ELEMENT_TYPE,type:e,key:void 0===r?null:""+r,ref:null,props:t,_owner:null}}),REACT_ELEMENT_TYPE,asyncIterator=function(e){if("function"==typeof Symbol){if(Symbol.asyncIterator){var t=e[Symbol.asyncIterator];if(null!=t)return t.call(e)}if(Symbol.iterator)return e[Symbol.iterator]()}throw new TypeError("Object is not async iterable")},asyncGenerator=function(){function e(e){this.value=e}function t(t){var r,n;function i(r,n){try{var s=t[r](n),a=s.value;a instanceof e?Promise.resolve(a.value).then(function(e){i("next",e)},function(e){i("throw",e)}):o(s.done?"return":"normal",s.value)}catch(e){o("throw",e)}}function o(e,t){switch(e){case"return":r.resolve({value:t,done:!0});break;case"throw":r.reject(t);break;default:r.resolve({value:t,done:!1})}(r=r.next)?i(r.key,r.arg):n=null}this._invoke=function(e,t){return new Promise(function(o,s){var a={key:e,arg:t,resolve:o,reject:s,next:null};n?n=n.next=a:(r=n=a,i(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),asyncGeneratorDelegate=function(e,t){var r={},n=!1;function i(r,i){return n=!0,i=new Promise(function(t){t(e[r](i))}),{done:!1,value:t(i)}}return"function"==typeof Symbol&&Symbol.iterator&&(r[Symbol.iterator]=function(){return this}),r.next=function(e){return n?(n=!1,e):i("next",e)},"function"==typeof e.throw&&(r.throw=function(e){if(n)throw n=!1,e;return i("throw",e)}),"function"==typeof e.return&&(r.return=function(e){return i("return",e)}),r},asyncToGenerator=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var s=t[i](o),a=s.value}catch(e){return void r(e)}if(!s.done)return Promise.resolve(a).then(function(e){n("next",e)},function(e){n("throw",e)});e(a)}("next")})}},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),defineEnumerableProperties=function(e,t){for(var r in t){var n=t[r];n.configurable=n.enumerable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,r,n)}return e},defaults=function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],o=Object.getOwnPropertyDescriptor(t,i);o&&o.configurable&&void 0===e[i]&&Object.defineProperty(e,i,o)}return e},defineProperty=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},get$1=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(n):void 0},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},_instanceof=function(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t},interopRequireDefault=function(e){return e&&e.__esModule?e:{default:e}},interopRequireWildcard=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},newArrowCheck=function(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")},objectDestructuringEmpty=function(e){if(null==e)throw new TypeError("Cannot destructure undefined")},objectWithoutProperties=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},selfGlobal="undefined"==typeof global?self:global,set$1=function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var s=Object.getPrototypeOf(t);null!==s&&e(s,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var a=o.set;void 0!==a&&a.call(i,n)}return n},slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),slicedToArrayLoose=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){for(var r,n=[],i=e[Symbol.iterator]();!(r=i.next()).done&&(n.push(r.value),!t||n.length!==t););return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},taggedTemplateLiteral=function(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))},taggedTemplateLiteralLoose=function(e,t){return e.raw=t,e},temporalRef=function(e,t,r){if(e===r)throw new ReferenceError(t+" is not defined - temporal dead zone");return e},temporalUndefined={},toArray=function(e){return Array.isArray(e)?e:Array.from(e)},toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},babelHelpers$1=Object.freeze({jsx:jsx,asyncIterator:asyncIterator,asyncGenerator:asyncGenerator,asyncGeneratorDelegate:asyncGeneratorDelegate,asyncToGenerator:asyncToGenerator,classCallCheck:classCallCheck,createClass:createClass,defineEnumerableProperties:defineEnumerableProperties,defaults:defaults,defineProperty:defineProperty,get:get$1,inherits:inherits,interopRequireDefault:interopRequireDefault,interopRequireWildcard:interopRequireWildcard,newArrowCheck:newArrowCheck,objectDestructuringEmpty:objectDestructuringEmpty,objectWithoutProperties:objectWithoutProperties,possibleConstructorReturn:possibleConstructorReturn,selfGlobal:selfGlobal,set:set$1,slicedToArray:slicedToArray,slicedToArrayLoose:slicedToArrayLoose,taggedTemplateLiteral:taggedTemplateLiteral,taggedTemplateLiteralLoose:taggedTemplateLiteralLoose,temporalRef:temporalRef,temporalUndefined:temporalUndefined,toArray:toArray,toConsumableArray:toConsumableArray,typeof:_typeof,extends:_extends,instanceof:_instanceof}),GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:void 0,isNode="undefined"!=typeof global&&"undefined"!=typeof process,PouchDB=_PouchDB;function nodejsRequire(e){if(!isNode)throw new Error("nodejsRequire can only be used in nodejs!");return"undefined"!=typeof System?System._nodeRequire(e):require("module")._load(e)}function nodejs_leveldbPath(e){if(e.startsWith("/"))return e;if(e.match(/[^\/]+:\/\//))return e.startsWith("file:")&&(e=e.replace(/^file:\/\//,"")),e;if(!isNode)throw new Error("nodejs_leveldbPath called under non-nodejs environment");var t="undefined"!=typeof System&&System.baseURL.startsWith("file://")?System.baseURL.replace("file://",""):GLOBAL.process.cwd(),r=nodejsRequire("path").join,n=nodejsRequire("fs"),i=n.mkdirSync,o=n.existsSync,s=(n.readdirSync,n.readFileSync);if(e.includes("/"))return r(t,e);try{var a=s(r(t,"../package.json")),u=JSON.parse(a);if("lively.web"===u.name||"lively.next"===u.name){var c=r(t,"../.livelydbs");return o(c)||i(c),r(c,e)}}catch(e){}var f=r(t,".livelydbs");return o(f)||i(f),r(f,e)}function nodejs_attemptToLoadProperPouchDB(){if(!isNode)throw new Error("nodejs_attemptToLoadProperPouchDB called under non-nodejs environment");if("undefined"!=typeof System){var e=System._nodeRequire("path").join,t=System.normalizeSync("lively.storage/index.js"),r=e(System.normalizeSync("pouchdb",t).replace(/file:\/\//,""),"../../lib/index.js");try{return(PouchDB=System._nodeRequire(r)).plugin(pouchdbAdapterMem),!0}catch(e){return!1}}try{return(PouchDB=require("pouchdb")).plugin(pouchdbAdapterMem),!0}catch(e){return!1}}PouchDB.plugin(pouchdbAdapterMem);var createPouchDB=isNode?(properLoadAttempted=!1,nodejsCouchDBLoaded=!1,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return properLoadAttempted||(properLoadAttempted=!0,nodejsCouchDBLoaded=nodejs_attemptToLoadProperPouchDB()),t.adapter||(t.adapter=e.startsWith("http")?"http":nodejsCouchDBLoaded?"leveldb":"memory"),"leveldb"==t.adapter&&(e=nodejs_leveldbPath(e)),t=_extends({},t,{name:e}),new PouchDB(t)}):function(e,t){return new PouchDB(_extends({name:e},t))},properLoadAttempted,nodejsCouchDBLoaded,Database=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};classCallCheck(this,e),this.name=t,this.options=r,this._pouchdb=null}return createClass(e,null,[{key:"findDB",value:function(e){return this.databases.get(e)}},{key:"ensureDB",value:function(e,t){var r=this.findDB(e);return r||(r=new this(e,t),this.databases.set(e,r),e.endsWith("lively.storage-meta")||this.createMetaEntryForDB(e,t),r)}},{key:"knownDBs",value:function(t,r){return e.ensureDB("lively.storage-meta").getAll().then(function(e){return e.map(function(e){return e._id})})}},{key:"createMetaEntryForDB",value:function(t,r){var n=e.ensureDB("lively.storage-meta");n.has(t).then(function(e){return!e&&n.set(t,{created:Date.now(),options:r})})}},{key:"knowsDB",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.ensureDB(t),e.next=3,r.docCount();case 3:if(!(e.sent>0)){e.next=6;break}return e.abrupt("return",!0);case 6:return e.next=8,r.destroy();case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"PouchDB",get:function(){return PouchDB},set:function(e){PouchDB=e}},{key:"databases",get:function(){return this._databases||(this._databases=new Map)}}]),createClass(e,[{key:"close",value:function(){this._pouchdb&&(this._pouchdb.close(),delete this._pouchdb)}},{key:"isDestroyed",value:function(){return!!this.pouchdb._destroyed}},{key:"destroy",value:function(e){return this.constructor.databases.delete(this.name),this.isDestroyed()?{ok:!0}:this.pouchdb.destroy(e)}},{key:"update",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var i,o,s,a,u,c,f,l,h,d,p,v,m,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=(i=n=n||{}).ensure,s=void 0===o||o,a=i.retryOnConflict,u=void 0===a||a,c=i.maxUpdateAttempts,f=void 0===c?10:c,l={latest:!0},h=this.pouchdb,d=void 0,p=void 0,e.prev=2,e.next=5,h.get(t,l);case 5:d=e.sent,e.next=12;break;case 8:if(e.prev=8,e.t0=e.catch(2),"not_found"===e.t0.name&&s){e.next=12;break}throw e.t0;case 12:return e.next=14,r(d);case 14:if((p=e.sent)&&"object"===(void 0===p?"undefined":_typeof(p))){e.next=17;break}return e.abrupt("return",null);case 17:return p._id!==t&&(p._id=t),d&&p._rev!==d._rev&&(p._rev=d._rev),e.prev=19,e.next=22,h.put(p);case 22:return v=e.sent,v.id,m=v.rev,e.abrupt("return",Object.assign(p,{_rev:m}));case 28:if(e.prev=28,e.t1=e.catch(19),!("conflict"===e.t1.name&&u&&g<f)){e.next=32;break}return e.abrupt("return",this.update(t,r,n,g+1));case 32:throw e.t1;case 33:case"end":return e.stop()}},e,this,[[2,8],[19,28]])}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"mixin",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.update(t,function(e){return Object.assign(e||{_id:t},r)},n));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"set",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.update(t,function(e){return r},n));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.pouchdb.get(t,r);case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),"not_found"!==e.t0.name){e.next=10;break}return e.abrupt("return",void 0);case 10:throw e.t0;case 11:case"end":return e.stop()}},e,this,[[0,6]])}));return function(t){return e.apply(this,arguments)}}()},{key:"has",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return e.abrupt("return",!!e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"add",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.pouchdb.post(t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"docList",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,i,o,s,a,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.allDocs(u);case 2:for(t=e.sent,r=t.rows,n=[],i=0;i<r.length;i++)o=r[i],s=o.id,a=o.value.rev,n.push({id:s,rev:a});return e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"docCount",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.allDocs();case 2:return t=e.sent,e.abrupt("return",t.rows.length);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"revList",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.get(t,{revs:!0});case 2:return r=e.sent,r._id,n=r._revisions,i=n.start,o=n.ids,e.abrupt("return",o.map(function(e){return i--+"-"+e}));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllRevisions",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.skip,n=void 0===r?0:r,i=u.limit,o=void 0===i?0:i,e.next=6,this.revList(t);case 6:return s=e.sent,n>0&&(s=s.slice(n)),o>0&&(s=s.slice(0,o)),a=s.map(function(e){return{rev:e,id:t}}),e.next=12,this.getDocuments(a);case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAll",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.allDocs(_extends({},n,{include_docs:!0}));case 2:return t=e.sent,r=t.rows,e.abrupt("return",r.map(function(e){return e.doc}));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setDocuments",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,s,a,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.bulkDocs(t,r);case 2:n=e.sent,i=0;case 4:if(!(i<n.length)){e.next=16;break}if(o=t[i],(s=n[i]).ok||"conflict"!==s.name||o._rev){e.next=13;break}return e.next=9,this.set(o._id,o);case 9:a=e.sent,u=a._id,c=a._rev,n[i]={ok:!0,id:u,rev:c};case 13:i++,e.next=4;break;case 16:return e.abrupt("return",n);case 17:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateDocuments",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var i,o,s,a,u,c,f,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.bulkDocs(t,n);case 2:i=e.sent,o=[],s={},a=0;case 6:if(!(a<i.length)){e.next=18;break}if(u=t[a],c=i[a],s[c._id||u._id]=c,c.ok||"conflict"!==c.name){e.next=15;break}return e.next=12,this.get(u._id);case 12:f=e.sent,(l=r(f,u))&&(l._id||(l._id=u._id),l._rev||(l._rev=f._rev),o.push(l));case 15:a++,e.next=6;break;case 18:if(!o.length){e.next=26;break}return e.t0=babelHelpers$1,e.t1={},e.t2=s,e.next=24,this.updateDocuments(o,r,n);case 24:e.t3=e.sent,s=e.t0.extends.call(e.t0,e.t1,e.t2,e.t3);case 26:return e.abrupt("return",s);case 27:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"getDocuments",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,f,l,h,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=d.ignoreErrors,n=void 0===r||r,e.next=4,this.pouchdb.bulkGet({docs:t});case 4:i=e.sent,o=i.results,s=[],a=0;case 8:if(!(a<o.length)){e.next=23;break}u=o[a],c=u.docs,f=u.id,console.assert(1===c.length,"getDocuments: expected only one doc for "+f),l=0;case 12:if(!(l<c.length)){e.next=20;break}if(h=c[l],!n||h.ok){e.next=16;break}return e.abrupt("continue",17);case 16:s.push(h.ok||h.error||h);case 17:l++,e.next=12;break;case 20:a++,e.next=8;break;case 23:return e.abrupt("return",s);case 24:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"query",value:function(e,t){return this.pouchdb.query(e,t)}},{key:"remove",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===r){e.next=4;break}e.t0={_id:t,_rev:r},e.next=7;break;case 4:return e.next=6,this.get(t);case 6:e.t0=e.sent;case 7:return i=e.t0,e.abrupt("return",i?this.pouchdb.remove(i):void 0);case 9:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"removeAll",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.pouchdb,e.next=3,t.allDocs();case 3:return r=e.sent,e.next=6,Promise.all(r.rows.map(function(e){return t.remove(e.id,e.value.rev)}));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"replicateTo",value:function(t,r){return t instanceof e&&(t=t.pouchdb),this.pouchdb.replicate.to(t,r)}},{key:"replicateFrom",value:function(t,r){return t instanceof e&&(t=t.pouchdb),this.pouchdb.replicate.from(t,r)}},{key:"sync",value:function(t,r){return t instanceof e&&(t=t.pouchdb),this.pouchdb.sync(t,r)}},{key:"getConflicts",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.query({map:"function(doc) { if (doc._conflicts) emit(doc._id); }"},_extends({reduce:!1,include_docs:!0,conflicts:!0},t));case 2:return r=e.sent,n=r.rows,e.abrupt("return",n.map(function(e){var t={id:e.id,rev:e.doc._rev,doc:e.doc};return e.doc._conflicts&&(t.conflicts=e.doc._conflicts,delete e.doc._conflicts),t}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"resolveConflicts",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,s,a,u,c,f,l,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.get(t,{conflicts:!0});case 2:return n=e.sent,i=n._conflicts.map(function(e){return{id:t,rev:e}}),e.next=6,this.getDocuments(i);case 6:o=e.sent,s=n,a=!0,u=!1,c=void 0,e.prev=11,f=o[Symbol.iterator]();case 13:if(a=(l=f.next()).done){e.next=28;break}return h=l.value,e.next=17,r(s,h);case 17:if(s=e.sent){e.next=20;break}return e.abrupt("return",null);case 20:return e.next=22,this.set(t,s);case 22:return s=e.sent,e.next=25,this.pouchdb.remove(h);case 25:a=!0,e.next=13;break;case 28:e.next=34;break;case 30:e.prev=30,e.t0=e.catch(11),u=!0,c=e.t0;case 34:e.prev=34,e.prev=35,!a&&f.return&&f.return();case 37:if(e.prev=37,!u){e.next=40;break}throw c;case 40:return e.finish(37);case 41:return e.finish(34);case 42:return e.abrupt("return",s);case 43:case"end":return e.stop()}},e,this,[[11,30,34,42],[35,,37,41]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"diffWith",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,f,l,h,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.docList();case 2:return r=e.sent,e.next=5,this.docList();case 5:for(c in n=e.sent,i=r.reduce(function(e,t){return Object.assign(e,defineProperty({},t.id,t.rev))},{}),o=n.reduce(function(e,t){return Object.assign(e,defineProperty({},t.id,t.rev))},{}),s=[],a=[],u=[],i)f=i[c],(l=o[c])?f!=l&&u.push({right:{id:c,rev:f},left:{id:c,rev:l}}):a.push({id:c,rev:f});for(h in o)d=o[h],i[h]||s.push({id:h,rev:d});return e.abrupt("return",{inLeft:s,inRight:a,changed:u});case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"dump",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,i,o,s,a,u,c,f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.filterFn,r=f.name,n=f.type,i=f.dbInfo,o=this.name,s=this.pouchdb,a=r||o,e.t0=a,e.t1=n||s.type(),e.t2=(new Date).toJSON(),e.t3=babelHelpers$1,e.t4={},e.next=14,s.info();case 14:return e.t5=e.sent,e.t6={db_name:a},e.t7=i,e.t8=e.t3.extends.call(e.t3,e.t4,e.t5,e.t6,e.t7),u={name:e.t0,db_type:e.t1,start_time:e.t2,db_info:e.t8},e.next=21,this.getAll({attachments:!0});case 21:return c=e.sent,"function"==typeof t&&(c=t(c,u)),e.abrupt("return",{header:u,docs:c});case 24:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"backup",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.name+"_backup_"+n,r=this.constructor.ensureDB(t),e.next=3,this.replicateTo(r);case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"migrate",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAll();case 2:r=e.sent,n=[],i=[],o=0;case 5:if(!(o<r.length)){e.next=16;break}if(s=r[o],a=t(s,o)){e.next=10;break}return i.push(s),e.abrupt("continue",13);case 10:a.hasOwnProperty("_id")||(a._id=s._id),a.hasOwnProperty("_rev")&&delete a._rev,n.push(a);case 13:o++,e.next=5;break;case 16:return e.next=18,this.setDocuments(n);case 18:return e.abrupt("return",{migrated:n.length,unchanged:i.length});case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createDesignDocs",value:function(e){return e.map(this.createDesignDoc)}},{key:"createDesignDoc",value:function(e){var t=e.name,r=e.mapFn,n=e.reduceFn,i=e.filterFn,o=e.version,s={_id:"_design/"+t,version:void 0===o?1:o};return i&&lively_lang.Path("filters."+t).set(s,i.toString(),!0),r&&lively_lang.Path("views."+t+".map").set(s,r.toString(),!0),n&&lively_lang.Path("views."+t+".reduce").set(s,n.toString(),!0),s}},{key:"addDesignDocs",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i=this,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createDesignDocs(t),e.next=3,this.updateDocuments(r,function(e,t){return e.hasOwnProperty("version")?t.hasOwnProperty("version")&&t.version>e.version?t:null:t});case 3:if(n=e.sent,!o){e.next=7;break}return e.next=7,Promise.all(r.map(function(e){return i.designDocDoQueryStale(e._id)}));case 7:return e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addDesignDoc",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i=t.name,o=t.mapFn,s=t.reduceFn,a=t.version,u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createDesignDoc({name:i,mapFn:o,reduceFn:s,version:a}),e.next=3,this.set(r._id,r);case 3:if(n=e.sent,!u){e.next=7;break}return e.next=7,this.designDocDoQueryStale(r._id);case 7:return e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"removeDesignDoc",value:function(e){return this.remove("_design/"+e)}},{key:"designDocDoQueryStale",value:function(e){var t=e.split("/"),r=slicedToArray(t,2),n=(r[0],r[1]);return this.query(n,{stale:"update_after"})}},{key:"pouchdb",get:function(){if(this._pouchdb)return this._pouchdb;var e=this.name,t=this.options;return this._pouchdb=createPouchDB(e,t)}}],[{key:"loadDump",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.header,n=t.docs,i=s.name||r.name,o=this.ensureDB(i),e.next=3,o.setDocuments(n,{new_edits:!1});case 3:return e.abrupt("return",o);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),sha1=function(){var e,t,r;return"object"==("undefined"==typeof process?"undefined":_typeof(process))&&"object"==_typeof(process.versions)&&process.versions.node&&"renderer"!==process.__atom_type?(r="undefined"!=typeof System?System._nodeRequire("crypto"):require("crypto"),t=function(){var e=r.createHash("sha1");return{update:function(t){return e.update(t)},digest:function(){return e.digest("hex")}}}):(e=new Uint32Array(80),t=function(t){function r(e){o[l]|=(255&e)<<h,h?h-=8:(l++,h=24),16===l&&n()}function n(){for(var e=16;e<80;e++){var t=o[e-3]^o[e-8]^o[e-14]^o[e-16];o[e]=t<<1|t>>>31}var r,n,i=s,h=a,d=u,p=c,v=f;for(e=0;e<80;e++){e<20?(r=p^h&(d^p),n=1518500249):e<40?(r=h^d^p,n=1859775393):e<60?(r=h&d|p&(h|d),n=2400959708):(r=h^d^p,n=3395469782);var m=(i<<5|i>>>27)+r+v+n+(0|o[e]);v=p,p=d,d=h<<30|h>>>2,h=i,i=m}for(s=s+i|0,a=a+h|0,u=u+d|0,c=c+p|0,f=f+v|0,l=0,e=0;e<16;e++)o[e]=0}function i(e){for(var t="",r=28;r>=0;r-=4)t+=(e>>r&15).toString(16);return t}var o,s=1732584193,a=4023233417,u=2562383102,c=271733878,f=3285377520,l=0,h=24,d=0;return o=t?e:new Uint32Array(80),{update:function(e){if("string"==typeof e)return function(e){var t=e.length;d+=8*t;for(var n=0;n<t;n++)r(e.charCodeAt(n))}(e);var t=e.length;d+=8*t;for(var n=0;n<t;n++)r(e[n])},digest:function(){r(128),(l>14||14===l&&h<24)&&n(),l=14,h=24,r(0),r(0),r(d>0xffffffffff?d/1099511627776:0),r(d>4294967295?d/4294967296:0);for(var e=24;e>=0;e-=8)r(d>>e);return i(s)+i(a)+i(u)+i(c)+i(f)}}}),function(e){if(void 0===e)return t(!1);var r=t(!0);return r.update(e),r.digest()}}(),hashRe=/^[0-9a-f]+$/i;function isHash(e){return"string"==typeof e&&40===e.length&&e.match(hashRe)}var objectDBs=objectDBs||new Map,ObjectDB=function(){function e(t,r){if(classCallCheck(this,e),this.name=t,!r.snapshotLocation||!r.snapshotLocation.isResource)throw new Error("ObjectDB needs snapshotLocation!");this.snapshotLocation=r.snapshotLocation,this.__commitDB=null,this.__versionDB=null}return createClass(e,null,[{key:"dbList",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Database.ensureDB("internal__objectdb-meta"),e.next=3,t.getAll();case 3:return e.t0=function(e){return e._id},e.abrupt("return",e.sent.map(e.t0));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=objectDBs.get(t))){e.next=3;break}return e.abrupt("return",r);case 3:return n=Database.ensureDB("internal__objectdb-meta"),e.next=6,n.get(t);case 6:if(i=e.sent){e.next=9;break}return e.abrupt("return");case 9:return e.abrupt("return",this.named(t,i));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"named",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=objectDBs.get(e);if(r)return r;if(!t||!t.snapshotLocation)throw new Error("need snapshotLocation");if("string"==typeof t.snapshotLocation)try{t.snapshotLocation=lively_resources.resource(t.snapshotLocation)}catch(e){t.snapshotLocation=lively_resources.resource(System.baseURL).join(t.snapshotLocation)}var n=new this(e,t);return objectDBs.set(e,n),Database.ensureDB("internal__objectdb-meta").set(e,_extends({},t,{snapshotLocation:t.snapshotLocation.url})).catch(function(e){return console.error("error writing objectdb meta:",e)}),n}}]),createClass(e,[{key:"destroy",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=Database.findDB(this.name+"-commits"))){e.next=4;break}return e.next=4,t.destroy();case 4:if(!(r=Database.findDB(this.name+"-version-graph"))){e.next=8;break}return e.next=8,r.destroy();case 8:return objectDBs.delete(this.name),n=Database.ensureDB("internal__objectdb-meta"),e.next=12,n.remove(this.name);case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"snapshotResourceFor",value:function(e){var t=e.content.slice(0,2),r=e.content.slice(2);return this.snapshotLocation.join(t+"/"+r+".json")}},{key:"snapshotObject",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n,i,o,s,a,u){var c,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=i||{},c=function(e){return e},e.next=4,c(n,i);case 4:return f=e.sent,e.abrupt("return",this.commit(t,r,f,o,s,a,u));case 6:case"end":return e.stop()}},e,this)}));return function(t,r,n,i,o,s,a,u){return e.apply(this,arguments)}}()},{key:"loadObject",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n,i,o){var s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=n||{},e.next=3,this.loadSnapshot(t,r,i,o);case 3:return s=e.sent,a=function(e){return e},e.abrupt("return",a(s,n));case 6:case"end":return e.stop()}},e,this)}));return function(t,r,n,i,o){return e.apply(this,arguments)}}()},{key:"has",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.objectStats(t,r);case 2:return e.abrupt("return",!!e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"objects",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.objectStats(t);case 2:if(r=e.sent,!t){e.next=5;break}return e.abrupt("return",Object.keys(r||{}));case 5:for(i in n={},r)n[i]=Object.keys(r[i]);return e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"objectStats",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,s,a,u,c,f,l,h,d,p,v,m,g,y,_,b,w,k;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n={},e.t0=this.__commitDB,e.t0){e.next=6;break}return e.next=5,this._commitDB();case 5:e.t0=e.sent;case 6:return i=e.t0,o={reduce:!0,group:!0},t&&r?o.key=t+"\0"+r:t&&(o.startkey=t+"\0",o.endkey=t+""),e.prev=9,e.next=12,i.pouchdb.query("nameWithMaxMinTimestamp_index",o);case 12:for(s=e.sent,a=s.rows,u=!0,c=!1,f=void 0,e.prev=17,l=a[Symbol.iterator]();!(u=(h=l.next()).done);u=!0)d=h.value,p=d.key,v=d.value,m=v.count,g=v.max,y=v.min,_=p.split("\0"),b=slicedToArray(_,2),w=b[0],k=b[1],(n[w]||(n[w]={}))[k]={count:m,newest:g,oldest:y};e.next=25;break;case 21:e.prev=21,e.t1=e.catch(17),c=!0,f=e.t1;case 25:e.prev=25,e.prev=26,!u&&l.return&&l.return();case 28:if(e.prev=28,!c){e.next=31;break}throw f;case 31:return e.finish(28);case 32:return e.finish(25);case 33:e.next=39;break;case 35:return e.prev=35,e.t2=e.catch(9),console.error(e.t2),e.abrupt("return",n);case 39:if(!t||!r){e.next=41;break}return e.abrupt("return",(n[t]||{})[r]);case 41:if(!t){e.next=43;break}return e.abrupt("return",n[t]);case 43:return e.abrupt("return",n);case 44:case"end":return e.stop()}},e,this,[[9,35],[17,21,25,33],[26,,28,32]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getCommits",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"HEAD",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._log(t,r,s,a);case 2:if((n=e.sent).length){e.next=5;break}return e.abrupt("return",[]);case 5:if(e.t0=this.__commitDB,e.t0){e.next=10;break}return e.next=9,this._commitDB();case 9:e.t0=e.sent;case 10:return i=e.t0,e.next=13,i.getDocuments(n.map(function(e){return{id:e}}));case 13:return o=e.sent,e.abrupt("return",o);case 15:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getCommit",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.__commitDB,e.t0){e.next=5;break}return e.next=4,this._commitDB();case 4:e.t0=e.sent;case 5:return r=e.t0,e.abrupt("return",r.get(t));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCommitsWithIds",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return",[]);case 2:if(e.t0=this.__commitDB,e.t0){e.next=7;break}return e.next=6,this._commitDB();case 6:e.t0=e.sent;case 7:return r=e.t0,e.abrupt("return",r.getDocuments(t.map(function(e){return{id:e}})));case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getLatestCommit",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,s,a,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"HEAD",c=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._log(t,r,u,1);case 2:if(n=e.sent,i=slicedToArray(n,1),o=i[0]){e.next=7;break}return e.abrupt("return",null);case 7:if(e.t0=this.__commitDB,e.t0){e.next=12;break}return e.next=11,this._commitDB();case 11:e.t0=e.sent;case 12:return s=e.t0,e.next=15,s.get(o);case 15:if(!(a=e.sent)||!a.deleted||c){e.next=18;break}return e.abrupt("return",null);case 18:return e.abrupt("return",a);case 19:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"commit",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n,i,o){var s,a,u,c,f,l,h,d,p,v,m,g,y,_,b,w,k,x,E,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"HEAD",R=arguments[6];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=i.author,a=i.description,u=void 0===a?"no description":a,c=i.tags,f=void 0===c?[]:c,l=i.timestamp,h=i.message,d=void 0===h?"":h,p=i.metadata,v=i.preview,t){e.next=3;break}throw new Error("object needs a type");case 3:if(r){e.next=5;break}throw new Error("object needs a name");case 5:if(s){e.next=7;break}throw new Error("Cannot commit "+t+"/"+r+" without user");case 7:if(e.t0=this.__versionDB,e.t0){e.next=12;break}return e.next=11,this._versionDB();case 11:e.t0=e.sent;case 12:return m=e.t0,e.next=15,this.versionGraph(t,r);case 15:if(g=e.sent,y=g?g.refs[S]:null,_=y?[y]:[],!R){e.next=23;break}if(g){e.next=21;break}throw new Error('Trying to store "'+t+"/"+r+'" on top of expected version '+R+" but no version entry exists!");case 21:if(y===R){e.next=23;break}throw new Error('Trying to store "'+t+"/"+r+'" on top of expected version '+R+" but ref "+S+" is of version "+y+"!");case 23:if(b=isHash(n),w=b?null:n?JSON.stringify(n):null,k=this._createCommit(t,r,u,f,p,s,l,d,_,b?null:n,w,o||v,b?n:null),!n||b){e.next=35;break}return x=this.snapshotResourceFor(k),e.next=28,x.parent().ensureExistance();case 28:if(!x.canDealWithJSON){e.next=33;break}return e.next=31,x.writeJson(n);case 31:e.next=35;break;case 33:return e.next=35,x.write(w);case 35:if(e.t1=this.__commitDB,e.t1){e.next=40;break}return e.next=39,this._commitDB();case 39:e.t1=e.sent;case 40:return E=e.t1,e.next=43,E.set(k._id,k);case 43:return k=e.sent,g||(g={refs:{},history:{}}),g.refs[S]=k._id,g.history[k._id]=_,e.next=49,m.set(t+"/"+r,g);case 49:return e.abrupt("return",k);case 50:case"end":return e.stop()}},e,this)}));return function(t,r,n,i,o){return e.apply(this,arguments)}}()},{key:"loadSnapshot",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var i,o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"HEAD";return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=void 0,!n||"string"==typeof n){e.next=5;break}i=n,e.next=20;break;case 5:if(!n){e.next=17;break}if(e.t0=this.__commitDB,e.t0){e.next=11;break}return e.next=10,this._commitDB();case 10:e.t0=e.sent;case 11:return o=e.t0,e.next=14,o.get(n);case 14:i=e.sent,e.next=20;break;case 17:return e.next=19,this.getLatestCommit(t,r,s);case 19:i=e.sent;case 20:if(i){e.next=22;break}throw new Error("Cannot find commit to loadSnapshot for "+t+"/"+r+" (using "+n+")");case 22:return e.abrupt("return",this.snapshotResourceFor(i).readJson());case 23:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"revert",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n,i){var o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.__versionDB,e.t0){e.next=5;break}return e.next=4,this._versionDB();case 4:e.t0=e.sent;case 5:return o=e.t0,e.next=8,o.get(t+"/"+r);case 8:return(s=e.sent).refs[n||"HEAD"]=i,delete s.deleted,e.next=13,o.set(t+"/"+r,s);case 13:return e.abrupt("return",s);case 14:case"end":return e.stop()}},e,this)}));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"_createCommit",value:function(e,t,r,n,i,o,s){var a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[],c=arguments[9],f=arguments[10],l=arguments[11],h=arguments[12];return!l&&c&&c.preview&&(l=c.preview),this._createCommitFromSpec({name:t,type:e,timestamp:s||Date.now(),author:{name:o.name,email:o.email,realm:o.realm},tags:n,description:r,preview:l,message:a,content:h||f&&sha1(f)||null,deleted:!h&&!c,metadata:i,ancestors:u},!0)}},{key:"_createCommitFromSpec",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.name)throw new Error("commit needs name");if(!e.type)throw new Error("commit needs type");if(!e.author)throw new Error("commit needs author");if(!e.author.name)throw new Error("commit needs author.name");e.timestamp||(e.timestamp=Date.now()),e.tags||(e.tags=[]),!t&&e.content&&((t=isHash(e.content))||(e.content=sha1(e.content)));var r=lively_lang.obj.dissoc(e,["preview"]),n=sha1(JSON.stringify(r));return Object.assign(e,{_id:n})}},{key:"_commitDB",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.__commitDB){e.next=2;break}return e.abrupt("return",this.__commitDB);case 2:if(t=this.name+"-commits",!(r=Database.findDB(t))){e.next=5;break}return e.abrupt("return",this.__commitDB=r);case 5:return r=Database.ensureDB(t),e.next=8,r.addDesignDocs(this._commitdb_indexes);case 8:return e.abrupt("return",this.__commitDB=r);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"close",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.__commitDB){e.next=4;break}return e.next=3,this.__commitDB.close();case 3:this.__commitDB=null;case 4:if(!this.__versionDB){e.next=8;break}return e.next=7,this.__versionDB.close();case 7:this.__versionDB=null;case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"versionGraph",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.__versionDB,e.t0){e.next=5;break}return e.next=4,this._versionDB();case 4:e.t0=e.sent;case 5:return n=e.t0,e.next=8,n.get(t+"/"+r);case 8:return i=e.sent,e.abrupt("return",!i||i.deleted||i._deleted?null:i);case 10:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"_log",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n,i,o,s,a,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.versionGraph(t,r);case 2:if((n=e.sent)&&!n.deleted&&!n._deleted){e.next=5;break}return e.abrupt("return",[]);case 5:i=n.refs.HEAD,o=[];case 6:if(!o.includes(i)){e.next=9;break}throw new Error("cyclic version graph???");case 9:if(o.push(i),s=n.history[i]||[],a=slicedToArray(s,1),(i=a[0])&&!(o.length>=u)){e.next=15;break}return e.abrupt("break",17);case 15:e.next=6;break;case 17:return e.abrupt("return",o);case 18:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"_findTimestampedVersionsOfObjectNamed",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,f,l,h,d,p,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=v.include_docs,n=void 0===r||r,i=v.descending,o=void 0===i||i,s=v.startTime,a=void 0===s?"0".repeat(13):s,u=v.endTime,c=void 0===u?"9".repeat(13):u,f=t+"\0"+(o?c:a),l=t+"\0"+(o?a:c),e.t0=this.__commitDB,e.t0){e.next=15;break}return e.next=14,this._commitDB();case 14:e.t0=e.sent;case 15:return h=e.t0,e.next=18,h.pouchdb.query("nameAndTimestamp_index",_extends({},v,{descending:o,include_docs:n,startkey:f,endkey:l}));case 18:return d=e.sent,p=d.rows,e.abrupt("return",n?p.map(function(e){return e.doc}):p.map(function(e){return e.id}));case 21:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_versionDB",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.__versionDB){e.next=2;break}return e.abrupt("return",this.__versionDB);case 2:if(t=this.name+"-version-graph",!(r=Database.findDB(t))){e.next=5;break}return e.abrupt("return",this.__versionDB=r);case 5:return r=Database.ensureDB(t),e.next=8,r.addDesignDocs(this._versiondb_indexes);case 8:return e.abrupt("return",this.__versionDB=r);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"exportToDir",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,s,a,u,c,f,l,h,d,p,v,m,g,y,_,b,w,k,x,E,S,R,j,T,D,O,A,B,C=this,L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],I=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t&&(t=lively_resources.resource(t)),e.t0=this.__commitDB,e.t0){e.next=6;break}return e.next=5,this._commitDB();case 5:e.t0=e.sent;case 6:if(e.t0,e.t1=this.__versionDB,e.t1){e.next=12;break}return e.next=11,this._versionDB();case 11:e.t1=e.sent;case 12:if(n=e.t1,i=[],r){e.next=58;break}return e.next=17,n.getAll();case 17:o=e.sent,s=!0,a=!1,u=void 0,e.prev=21,c=o[Symbol.iterator]();case 23:if(s=(f=c.next()).done){e.next=42;break}if(l=f.value,h=l.refs,d=l.history,!l._id.startsWith("_")){e.next=28;break}return e.abrupt("continue",39);case 28:return e.next=30,this.getCommit(h.HEAD||Object.keys(d)[0]);case 30:return p=e.sent,v=p.type,m=p.name,g=t.join(v).join(m).asDirectory(),y=Object.keys(d),e.next=37,this.getCommitsWithIds(y);case 37:_=e.sent,i.push({refs:h,history:d,currentExportDir:g,commits:_,name:m,type:v});case 39:s=!0,e.next=23;break;case 42:e.next=48;break;case 44:e.prev=44,e.t2=e.catch(21),a=!0,u=e.t2;case 48:e.prev=48,e.prev=49,!s&&c.return&&c.return();case 51:if(e.prev=51,!a){e.next=54;break}throw u;case 54:return e.finish(51);case 55:return e.finish(48);case 56:e.next=94;break;case 58:b=!0,w=!1,k=void 0,e.prev=61,x=r[Symbol.iterator]();case 63:if(b=(E=x.next()).done){e.next=80;break}return S=E.value,m=S.name,v=S.type,g=t.join(v).join(m).asDirectory(),e.next=69,this.versionGraph(v,m);case 69:return R=e.sent,h=R.refs,d=R.history,y=Object.keys(d),e.next=75,this.getCommitsWithIds(y);case 75:_=e.sent,i.push({refs:h,history:d,currentExportDir:g,commits:_,name:m,type:v});case 77:b=!0,e.next=63;break;case 80:e.next=86;break;case 82:e.prev=82,e.t3=e.catch(61),w=!0,k=e.t3;case 86:e.prev=86,e.prev=87,!b&&x.return&&x.return();case 89:if(e.prev=89,!w){e.next=92;break}throw k;case 92:return e.finish(89);case 93:return e.finish(86);case 94:j=!0,T=!1,D=void 0,e.prev=97,O=regeneratorRuntime.mark(function e(){var t,r,n,i,o,s,a,u,c,f,l,h,d,p,v,m;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=B.value,r=t.refs,n=t.history,i=t.currentExportDir,o=t.commits,s=t.name,a=t.type,I||(o=o.filter(function(e){return!e.deleted})),u=L?o.map(function(e){if(e.deleted||e._deleted||!e.content)return null;delete e._rev;var t=C.snapshotResourceFor(e);return{from:t,to:i.join(t.parent().name()+"/"+t.name())}}).filter(Boolean):[],L||o.forEach(function(e){delete e._rev}),e.next=7,i.ensureExistance();case 7:return e.next=9,i.join("index.json").writeJson({name:s,type:a});case 9:return e.next=11,i.join("commits.json").writeJson(o);case 11:return e.next=13,i.join("history.json").writeJson({refs:r,history:n});case 13:c=!0,f=!1,l=void 0,e.prev=16,h=u[Symbol.iterator]();case 18:if(c=(d=h.next()).done){e.next=26;break}return p=d.value,v=p.from,m=p.to,e.next=23,v.copyTo(m);case 23:c=!0,e.next=18;break;case 26:e.next=32;break;case 28:e.prev=28,e.t0=e.catch(16),f=!0,l=e.t0;case 32:e.prev=32,e.prev=33,!c&&h.return&&h.return();case 35:if(e.prev=35,!f){e.next=38;break}throw l;case 38:return e.finish(35);case 39:return e.finish(32);case 40:case"end":return e.stop()}},e,C,[[16,28,32,40],[33,,35,39]])}),A=i[Symbol.iterator]();case 100:if(j=(B=A.next()).done){e.next=105;break}return e.delegateYield(O(),"t4",102);case 102:j=!0,e.next=100;break;case 105:e.next=111;break;case 107:e.prev=107,e.t5=e.catch(97),T=!0,D=e.t5;case 111:e.prev=111,e.prev=112,!j&&A.return&&A.return();case 114:if(e.prev=114,!T){e.next=117;break}throw D;case 117:return e.finish(114);case 118:return e.finish(111);case 119:case"end":return e.stop()}},e,this,[[21,44,48,56],[49,,51,55],[61,82,86,94],[87,,89,93],[97,107,111,119],[112,,114,118]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"exportToSpecs",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,f,l,h,d,p,v,m,g,y,_=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],t){e.next=10;break}return t=[],e.next=5,this.objectStats();case 5:if(e.t0=e.sent,e.t0){e.next=8;break}e.t0={};case 8:for(i in n=e.t0)for(o in n[i])t.push({type:i,name:o});case 10:s=!0,a=!1,u=void 0,e.prev=13,c=t[Symbol.iterator]();case 15:if(s=(f=c.next()).done){e.next=33;break}return l=f.value,h=l.name,d=l.type,e.next=20,this.versionGraph(d,h);case 20:return p=e.sent,v=p.refs,m=p.history,g=Object.keys(m),e.next=26,this.getCommitsWithIds(g);case 26:y=e.sent,_||(y=y.filter(function(e){return!e.deleted})),y.forEach(function(e){delete e._rev}),r.push({type:d,name:h,commits:y,history:{refs:v,history:m}});case 30:s=!0,e.next=15;break;case 33:e.next=39;break;case 35:e.prev=35,e.t1=e.catch(13),a=!0,u=e.t1;case 39:e.prev=39,e.prev=40,!s&&c.return&&c.return();case 42:if(e.prev=42,!a){e.next=45;break}throw u;case 45:return e.finish(42);case 46:return e.finish(39);case 47:return e.abrupt("return",r);case 48:case"end":return e.stop()}},e,this,[[13,35,39,47],[40,,42,46]])}));return function(t){return e.apply(this,arguments)}}()},{key:"importFromDir",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,f,l,h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=(r=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([t.join("index.json").readJson(),t.join("commits.json").readJson(),t.join("history.json").readJson()]);case 2:if(r=e.sent,n=slicedToArray(r,3),i=n[0],o=i.type,s=i.name,a=n[1],u=n[2],!p){e.next=15;break}return e.next=12,t.dirList(1,{exclude:function(e){return!e.isDirectory()}});case 12:e.t0=e.sent,e.next=16;break;case 15:e.t0=[];case 16:return c=e.t0,e.abrupt("return",{dir:t,type:o,name:s,commits:a,history:u,snapshotDirs:c});case 18:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)}),p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.dirList(3,{exclude:function(e){return!e.isDirectory()&&"index.json"!==e.name()}});case 2:n=(n=e.sent).filter(function(e){return"index.json"===e.name()}),i=n.map(function(e){return e.parent()}),this.snapshotLocation,o=[],s=!0,a=!1,u=void 0,e.prev=9,c=i[Symbol.iterator]();case 11:if(s=(f=c.next()).done){e.next=21;break}return l=f.value,e.t0=o,e.next=16,d(l);case 16:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 18:s=!0,e.next=11;break;case 21:e.next=27;break;case 23:e.prev=23,e.t2=e.catch(9),a=!0,u=e.t2;case 27:e.prev=27,e.prev=28,!s&&c.return&&c.return();case 30:if(e.prev=30,!a){e.next=33;break}throw u;case 33:return e.finish(30);case 34:return e.finish(27);case 35:return e.abrupt("return",this.importFromSpecs(o,h,p));case 36:case"end":return e.stop()}},e,this,[[9,23,27,35],[28,,30,34]])}));return function(t){return e.apply(this,arguments)}}()},{key:"importFromSpecs",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,f,l,h,d,p,v,m,g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(g){e.next=36;break}if(e.t0=this.__versionDB,e.t0){e.next=6;break}return e.next=5,this._versionDB();case 5:e.t0=e.sent;case 6:r=e.t0,n=!0,i=!1,o=void 0,e.prev=10,s=t[Symbol.iterator]();case 12:if(n=(a=s.next()).done){e.next=22;break}return u=a.value,c=u.type,f=u.name,e.next=17,r.get(c+"/"+f);case 17:if(!e.sent){e.next=19;break}throw new Error("Import failed: object "+c+"/"+f+" already exists and overwrite is not allowed");case 19:n=!0,e.next=12;break;case 22:e.next=28;break;case 24:e.prev=24,e.t1=e.catch(10),i=!0,o=e.t1;case 28:e.prev=28,e.prev=29,!n&&s.return&&s.return();case 31:if(e.prev=31,!i){e.next=34;break}throw o;case 34:return e.finish(31);case 35:return e.finish(28);case 36:l=!0,h=!1,d=void 0,e.prev=39,p=t[Symbol.iterator]();case 41:if(l=(v=p.next()).done){e.next=48;break}return m=v.value,e.next=45,this.importFromSpec(m,!0,y);case 45:l=!0,e.next=41;break;case 48:e.next=54;break;case 50:e.prev=50,e.t2=e.catch(39),h=!0,d=e.t2;case 54:e.prev=54,e.prev=55,!l&&p.return&&p.return();case 57:if(e.prev=57,!h){e.next=60;break}throw d;case 60:return e.finish(57);case 61:return e.finish(54);case 62:return e.abrupt("return",t);case 63:case"end":return e.stop()}},e,this,[[10,24,28,36],[29,,31,35],[39,50,54,62],[55,,57,61]])}));return function(t){return e.apply(this,arguments)}}()},{key:"importFromSpec",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.__versionDB,e.t0){e.next=5;break}return e.next=4,this._versionDB();case 4:e.t0=e.sent;case 5:if(r=e.t0,e.t1=this.__commitDB,e.t1){e.next=11;break}return e.next=10,this._commitDB();case 10:e.t1=e.sent;case 11:if(n=e.t1,i=this.snapshotLocation,o=t.type,s=t.name,a=t.commits,u=t.history,c=t.snapshotDirs,e.t2=!f,!e.t2){e.next=23;break}return e.next=22,r.get(o+"/"+s);case 22:e.t2=e.sent;case 23:if(!e.t2){e.next=25;break}throw new Error("Import failed: object "+o+"/"+s+" already exists and overwrite is not allowed");case 25:return e.next=27,Promise.all([n.setDocuments(a),r.set(o+"/"+s,u)].concat(toConsumableArray(c&&l?c.map(function(e){return e.copyTo(i.join(e.name()).asDirectory())}):[])));case 27:return e.abrupt("return",t);case 28:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"importFromResource",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n,i){var o,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.readJson();case 2:if(o=e.sent,e.t0=s,!e.t0){e.next=8;break}return e.next=7,this.has(t,r);case 7:e.t0=e.sent;case 8:if(!e.t0){e.next=11;break}return e.next=11,this.delete(t,r,!1);case 11:return e.abrupt("return",this.commit(t,r,o,i));case 12:case"end":return e.stop()}},e,this)}));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"replicateTo",value:function(e,t,r,n){return new Synchronization(this,e,t,r,_extends({method:"replicateTo"},n)).start()}},{key:"replicateFrom",value:function(e,t,r,n){return new Synchronization(this,e,t,r,_extends({method:"replicateFrom"},n)).start()}},{key:"sync",value:function(e,t,r,n){return new Synchronization(this,e,t,r,_extends({method:"sync"},n)).start()}},{key:"getConflicts",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,s=(n=asyncToGenerator(regeneratorRuntime.mark(function e(n,i){var o,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getConflicts({include_docs:!0});case 2:return o=e.sent,e.next=5,Promise.all(o.map(function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(o){var a,u,c,f,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=o.id,u=o.rev,c=o.conflicts,f=o.doc,!r||!r[i]||r[i][a]){e.next=3;break}return e.abrupt("return",null);case 3:if(!t){e.next=8;break}return l=c.map(function(e){return{id:a,rev:e}}),e.next=7,n.getDocuments(l);case 7:c=e.sent;case 8:return t?lively_lang.obj.dissoc(f,["_conflicts"]):f=null,e.abrupt("return",{id:a,rev:u,conflicts:c,kind:i,doc:f});case 10:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}()));case 5:return e.t0=Boolean,e.abrupt("return",e.sent.filter(e.t0));case 7:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)});return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.__commitDB,e.t0){e.next=5;break}return e.next=4,this._commitDB();case 4:e.t0=e.sent;case 5:if(i=e.t0,e.t1=this.__versionDB,e.t1){e.next=11;break}return e.next=10,this._versionDB();case 10:e.t1=e.sent;case 11:return o=e.t1,e.next=14,s(o,"versions");case 14:return e.t2=e.sent,e.next=17,s(i,"commits");case 17:return e.next=19,e.sent;case 19:return e.t3=e.sent,e.abrupt("return",{versionConflicts:e.t2,commitConflicts:e.t3});case 21:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"resolveConflict",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.resolved,n=t.delete,i=t.kind,o=t.id,s=void 0,"versions"!==i){e.next=10;break}if(e.t0=this.__versionDB,e.t0){e.next=7;break}return e.next=6,this._versionDB();case 6:e.t0=e.sent;case 7:s=e.t0,e.next=20;break;case 10:if("commits"!==i){e.next=19;break}if(e.t1=this.__commitDB,e.t1){e.next=16;break}return e.next=15,this._commitDB();case 15:e.t1=e.sent;case 16:s=e.t1,e.next=20;break;case 19:throw new Error("Unknown conflict kind: "+i);case 20:return e.next=22,s.set(o,r);case 22:return e.next=24,Promise.all(n.map(function(e){return s.pouchdb.remove(o,e)}));case 24:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getDiff",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,s,a,u,c,f,l,h,d,p,v,m,g,y,_,b,w,k,x,E,S,R,j,T,D,O,A,B,C,L,I=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t,"string"==typeof t&&(n=Database.ensureDB(t+"-commits"),r=Database.ensureDB(t+"-version-graph")),e.t0=this.__commitDB,e.t0){e.next=7;break}return e.next=6,this._commitDB();case 6:e.t0=e.sent;case 7:if(i=e.t0,e.t1=this.__versionDB,e.t1){e.next=13;break}return e.next=12,this._versionDB();case 12:e.t1=e.sent;case 13:return o=e.t1,e.next=16,i.diffWith(n);case 16:return s=e.sent,e.next=19,o.diffWith(r);case 19:return a=e.sent,e.next=22,Promise.all(a.inLeft.map(function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.id,e.next=3,o.get(t.id);case 3:return e.t1=e.sent,e.abrupt("return",{id:e.t0,doc:e.t1});case 5:case"end":return e.stop()}},e,I)}));return function(t){return e.apply(this,arguments)}}()));case 22:return u=e.sent,e.next=25,Promise.all(a.inRight.map(function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.id,e.next=3,r.get(t.id);case 3:return e.t1=e.sent,e.abrupt("return",{id:e.t0,doc:e.t1});case 5:case"end":return e.stop()}},e,I)}));return function(t){return e.apply(this,arguments)}}()));case 25:return c=e.sent,e.next=28,Promise.all(a.changed.map(function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=babelHelpers$1,e.t1={},e.t2=t.left,e.next=5,o.get(t.left.id);case 5:return e.t3=e.sent,e.next=8,r.get(t.right.id);case 8:return e.t4=e.sent,e.t5={docA:e.t3,docB:e.t4},e.abrupt("return",e.t0.extends.call(e.t0,e.t1,e.t2,e.t5));case 11:case"end":return e.stop()}},e,I)}));return function(t){return e.apply(this,arguments)}}()));case 28:f=e.sent,l=[],h=[],d=[],p=!0,v=!1,m=void 0,e.prev=35,g=s.inLeft[Symbol.iterator]();case 37:if(p=(y=g.next()).done){e.next=47;break}return _=y.value,e.t2=l,e.next=42,i.get(_.id);case 42:e.t3=e.sent,e.t2.push.call(e.t2,e.t3);case 44:p=!0,e.next=37;break;case 47:e.next=53;break;case 49:e.prev=49,e.t4=e.catch(35),v=!0,m=e.t4;case 53:e.prev=53,e.prev=54,!p&&g.return&&g.return();case 56:if(e.prev=56,!v){e.next=59;break}throw m;case 59:return e.finish(56);case 60:return e.finish(53);case 61:b=!0,w=!1,k=void 0,e.prev=64,x=s.inRight[Symbol.iterator]();case 66:if(b=(E=x.next()).done){e.next=76;break}return S=E.value,e.t5=h,e.next=71,n.get(S.id);case 71:e.t6=e.sent,e.t5.push.call(e.t5,e.t6);case 73:b=!0,e.next=66;break;case 76:e.next=82;break;case 78:e.prev=78,e.t7=e.catch(64),w=!0,k=e.t7;case 82:e.prev=82,e.prev=83,!b&&x.return&&x.return();case 85:if(e.prev=85,!w){e.next=88;break}throw k;case 88:return e.finish(85);case 89:return e.finish(82);case 90:R=!0,j=!1,T=void 0,e.prev=93,D=s.changed[Symbol.iterator]();case 95:if(R=(O=D.next()).done){e.next=110;break}return A=O.value,e.t8=d,e.next=100,i.get(A.left.id);case 100:return e.t9=e.sent,e.t8.push.call(e.t8,e.t9),e.t10=d,e.next=105,n.get(A.right.id);case 105:e.t11=e.sent,e.t10.push.call(e.t10,e.t11);case 107:R=!0,e.next=95;break;case 110:e.next=116;break;case 112:e.prev=112,e.t12=e.catch(93),j=!0,T=e.t12;case 116:e.prev=116,e.prev=117,!R&&D.return&&D.return();case 119:if(e.prev=119,!j){e.next=122;break}throw T;case 122:return e.finish(119);case 123:return e.finish(116);case 124:return B=l.map(function(e){return lively_lang.obj.select(e,["_id","name","type"])}),C=h.map(function(e){return lively_lang.obj.select(e,["_id","name","type"])}),L=d.map(function(e){return lively_lang.obj.select(e,["_id","name","type"])}),e.abrupt("return",{changed:f,remote:c,local:u,changedCommitTypeAndNames:L,remoteCommitTypeAndNames:C,localCommitTypeAndNames:B});case 126:case"end":return e.stop()}},e,this,[[35,49,53,61],[54,,56,60],[64,78,82,90],[83,,85,89],[93,112,116,124],[117,,119,123]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,s,a,u,c,f,l,h,d,p,v,m,g,y,_,b,w=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],i=[],e.t0=this.__commitDB,e.t0){e.next=6;break}return e.next=5,this._commitDB();case 5:e.t0=e.sent;case 6:return o=e.t0,s={include_docs:!0,startkey:t+"\0"+r+"\0",endkey:t+"\0"+r+""},e.next=10,o.query("nameAndTimestamp_index",s);case 10:for(a=e.sent,u=a.rows,c=!0,f=!1,l=void 0,e.prev=15,h=u[Symbol.iterator]();!(c=(d=h.next()).done);c=!0)p=d.value,(v=p.doc).deleted||v._deleted||!v.content||n.push(this.snapshotResourceFor(v)),i.push(_extends({},v,{_deleted:!0}));e.next=23;break;case 19:e.prev=19,e.t1=e.catch(15),f=!0,l=e.t1;case 23:e.prev=23,e.prev=24,!c&&h.return&&h.return();case 26:if(e.prev=26,!f){e.next=29;break}throw l;case 29:return e.finish(26);case 30:return e.finish(23);case 31:if(e.t2=this.__versionDB,e.t2){e.next=36;break}return e.next=35,this._versionDB();case 35:e.t2=e.sent;case 36:return m=e.t2,e.next=39,m.get(t+"/"+r);case 39:if(g=e.sent,y=g._id,_=g._rev,b={_id:y,_rev:_,_deleted:!0},w){e.next=49;break}return e.next=46,o.setDocuments(i);case 46:return e.next=48,m.setDocuments([b]);case 48:Promise.all(n.map(function(e){return e.remove()}));case 49:return e.abrupt("return",{commits:i,history:b,resources:n});case 50:case"end":return e.stop()}},e,this,[[15,19,23,31],[24,,26,30]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"deleteCommit",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,f,l,h,d,p,v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"HEAD";return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=void 0,!t||"string"==typeof t){e.next=5;break}r=t,e.next=15;break;case 5:if(!t){e.next=15;break}if(e.t0=this.__commitDB,e.t0){e.next=11;break}return e.next=10,this._commitDB();case 10:e.t0=e.sent;case 11:return n=e.t0,e.next=14,n.get(t);case 14:r=e.sent;case 15:if(r){e.next=17;break}throw new Error("commit needed!");case 17:if(e.t1=this.__versionDB,e.t1){e.next=22;break}return e.next=21,this._versionDB();case 21:e.t1=e.sent;case 22:if(i=e.t1,e.t2=this.__commitDB,e.t2){e.next=28;break}return e.next=27,this._commitDB();case 27:e.t2=e.sent;case 28:return o=e.t2,a=(s=r).name,u=s.type,s._id,c=r.deleted||r._deleted||!r.content?[]:[this.snapshotResourceFor(r)],f=[_extends({},r,{_deleted:!0})],e.next=37,i.get(u+"/"+a);case 37:if(l=e.sent){e.next=40;break}throw new Error("No history for "+u+"/"+a+"@"+r._id);case 40:if(l.refs[m]){e.next=42;break}throw new Error("Cannot delete commit "+u+"/"+a+"@"+r._id+" b/c it is not where ref "+m+" is pointing!");case 42:if(h=l.history[r._id]||[],d=slicedToArray(h,1),(p=d[0])||!(Object.keys(l.history).length<=1)){e.next=47;break}l._deleted=!0,e.next=53;break;case 47:if(p){e.next=51;break}throw new Error("Cannot delete commit "+u+"/"+a+"@"+r._id+" b/c it has no ancestor but there are still other commits!");case 51:delete l.history[r._id],l.refs[m]=p;case 53:if(v){e.next=60;break}return e.next=56,i.set(u+"/"+a,l);case 56:return e.next=58,o.setDocuments(f);case 58:return e.next=60,Promise.all(c.map(function(e){return e.remove()}));case 60:return e.abrupt("return",{commits:f,history:l,resources:c});case 61:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_commitdb_indexes",get:function(){return[{name:"name_index",version:4,mapFn:'function (doc) { emit(doc.type + "\0" + doc.name); }'},{name:"nameAndTimestamp_index",version:3,mapFn:'function (doc) { emit(doc.type + "\0" + doc.name + "\0" + doc.timestamp + "\0" + doc._id); }'},{name:"nameWithMaxMinTimestamp_index",version:3,mapFn:'function(doc) { emit(doc.type + "\0" + doc.name, doc.timestamp); }',reduceFn:"_stats"},{name:"nameTypeFilter",version:7,filterFn:'function(doc, req) {\n          if (doc._id[0] === "_" || !req || !req.query) return true;\n          if (req.query.onlyIds) return !!req.query.onlyIds[doc._id];\n          if (req.query.onlyTypesAndNames)\n            return !!req.query.onlyTypesAndNames[doc.type + "/" + doc.name];\n          return true;\n        }'}]}},{key:"_versiondb_indexes",get:function(){return[{name:"nameTypeFilter",version:3,filterFn:'function(doc, req) {\n          if (doc._id[0] === "_" || !req || !req.query) return true;\n          if (req.query.onlyIds) return !!req.query.onlyIds[doc._id];\n          if (req.query.onlyTypesAndNames) return !!req.query.onlyTypesAndNames[doc._id];\n          return true;\n        }'}]}}]),e}(),Synchronization=function(){function Synchronization(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};classCallCheck(this,Synchronization),this.options=_extends({debug:!1,live:!1,method:"sync",replicationFilter:void 0},i),this.state="not started",this.method="",this.fromObjectDB=e,this.remoteCommitDB=t,this.remoteVersionDB=r,this.remoteLocation=n,this.deferred=lively_lang.promise.deferred(),this.conflicts=[],this.changes=[],this.errors=[]}return createClass(Synchronization,[{key:"whenPaused",value:function(){var e=this;return Promise.resolve().then(function(){return lively_lang.promise.waitFor(function(){return e.isPaused||e.isComplete})}).then(function(){return e})}},{key:"waitForIt",value:function(){return this.deferred.promise}},{key:"start",value:function(){return this.isSynchonizing||this._startReplicationAndCopy().catch(function(e){return console.error("Error starting synchronization: ",e)}),this}},{key:"_startReplicationAndCopy",value:function(){var _ref69=asyncToGenerator(regeneratorRuntime.mark(function _callee40(){var _this5=this,fromObjectDB,remoteCommitDB,remoteVersionDB,remoteLocation,_options,debug,_options$live,live,_options$retry,retry,method,replicationFilter,_options$pushDesignDo,pushDesignDocToRemote,versionDB,commitDB,_commitdb_indexes,_versiondb_indexes,fromSnapshotLocation,versionChangeListener,commitChangeListener,commitNameTypeFilter,versionNameTypeFilter,opts,commitOpts,versionOpts,commitReplication,versionReplication,snapshotReplication,commitReplicationState,versionReplicationState,updateState,tryToResolve,snapshotPathFor;return regeneratorRuntime.wrap(function _callee40$(_context41){for(;;)switch(_context41.prev=_context41.next){case 0:if(snapshotPathFor=function(e){return e.content?e.content.slice(0,2)+"/"+e.content.slice(2)+".json":null},tryToResolve=function(e,t){if(t.length||"complete"===commitReplicationState&&"complete"===versionReplicationState&&snapshotReplication.isComplete()){versionChangeListener.cancel();var r=void 0;t.length?(e.state="complete",e.errors=t,commitReplication.cancel(),versionReplication.cancel(),(r=new Error("Synchronization error:\n  "+t.join("\n  "))).errors=t,console.log(e+" errored")):console.log(e+" completed"),r?e.deferred.reject(r):e.deferred.resolve(e)}},updateState=function(e){return"paused"===versionReplicationState&&"paused"===commitReplicationState&&snapshotReplication.copyCalls<=0&&snapshotReplication.copyCallsWaiting<=0?e.state="paused":"complete"===versionReplicationState&&"complete"===commitReplicationState&&snapshotReplication.isComplete()?e.state="complete":e.state="running"},fromObjectDB=this.fromObjectDB,remoteCommitDB=this.remoteCommitDB,remoteVersionDB=this.remoteVersionDB,remoteLocation=this.remoteLocation,_options=this.options,debug=_options.debug,_options$live=_options.live,live=void 0!==_options$live&&_options$live,_options$retry=_options.retry,retry=void 0!==_options$retry&&_options$retry,method=_options.method,replicationFilter=_options.replicationFilter,_options$pushDesignDo=_options.pushDesignDocToRemote,pushDesignDocToRemote=void 0!==_options$pushDesignDo&&_options$pushDesignDo,_context41.t0=fromObjectDB.__versionDB,_context41.t0){_context41.next=22;break}return _context41.next=21,fromObjectDB._versionDB();case 21:_context41.t0=_context41.sent;case 22:if(versionDB=_context41.t0,_context41.t1=fromObjectDB.__commitDB,_context41.t1){_context41.next=28;break}return _context41.next=27,fromObjectDB._commitDB();case 27:_context41.t1=_context41.sent;case 28:if(commitDB=_context41.t1,_commitdb_indexes=fromObjectDB._commitdb_indexes,_versiondb_indexes=fromObjectDB._versiondb_indexes,fromSnapshotLocation=fromObjectDB.snapshotLocation,versionChangeListener=void 0,commitChangeListener=void 0,this.method=method,commitNameTypeFilter=_commitdb_indexes.find(function(e){return"nameTypeFilter"===e.name}),versionNameTypeFilter=_versiondb_indexes.find(function(e){return"nameTypeFilter"===e.name}),!pushDesignDocToRemote){_context41.next=43;break}return console.log("adding commitNameTypeFilter"),_context41.next=40,remoteCommitDB.addDesignDoc(commitNameTypeFilter);case 40:return console.log("adding versionNameTypeFilter"),_context41.next=43,remoteVersionDB.addDesignDoc(versionNameTypeFilter);case 43:return opts={live:live,retry:retry},commitOpts=_extends({},opts),versionOpts=_extends({},opts),replicationFilter&&(commitOpts.filter=eval("("+commitNameTypeFilter.filterFn+")"),commitOpts.query_params=replicationFilter,versionOpts.filter=eval("("+versionNameTypeFilter.filterFn+")"),versionOpts.query_params=replicationFilter),commitReplication=commitDB[method](remoteCommitDB,commitOpts),versionReplication=versionDB[method](remoteVersionDB,versionOpts),snapshotReplication={copyCalls:0,copyCallsWaiting:0,nFilesToCopy:0,nFilesCopied:0,stopped:!1,isComplete:function(){return this.stopped||this.copyCalls<=0&&this.copyCallsWaiting<=0}},commitReplicationState="not started",versionReplicationState="not started",this.versionReplication=versionReplication,this.commitReplication=commitReplication,this.snapshotReplication=snapshotReplication,commitChangeListener=remoteCommitDB.pouchdb.changes({include_docs:!0,live:!0,conflicts:!0}),versionChangeListener=remoteVersionDB.pouchdb.changes({include_docs:!0,live:!0,conflicts:!0}),commitChangeListener.on("change",function(e){var t=e.id,r=e.changes,n=e.doc._conflicts;debug&&console.log("commit changes "+t+":",r,n),n&&(console.log("commit conflict "+t+":",r,n),_this5.conflicts.push({db:"commits",id:t,changes:r,conflicts:n}))}),versionChangeListener.on("change",function(e){var t=e.id,r=e.changes,n=e.doc._conflicts;debug&&console.log("version changes "+t+":",r,n),n&&(console.log("version conflict "+t+":",r,n),_this5.conflicts.push({db:"versions",id:t,changes:r,conflicts:n}))}),commitReplication.on("change",function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,f,l,h,d,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:"replicateTo"===method?t={direction:"push",change:t}:"replicateFrom"===method&&(t={direction:"pull",change:t}),n=(r=t).direction,i=r.change,i.ok,o=i.docs,i.errors,console.log(_this5+" "+("push"===n?"send":"received")+" "+o.length+" commits"),e.prev=3,a=[],u=!0,c=!1,f=void 0,e.prev=8,l=o[Symbol.iterator]();case 10:if(u=(h=l.next()).done){e.next=20;break}if(!(d=h.value)._id.startsWith("_")){e.next=14;break}return e.abrupt("continue",17);case 14:_this5.changes.push({direction:n,kind:"commits",id:d._id,type:d.type,name:d.name}),(p=snapshotPathFor(d))&&a.push(p);case 17:u=!0,e.next=10;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(8),c=!0,f=e.t0;case 26:e.prev=26,e.prev=27,!u&&l.return&&l.return();case 29:if(e.prev=29,!c){e.next=32;break}throw f;case 32:return e.finish(29);case 33:return e.finish(26);case 34:if(snapshotReplication.nFilesToCopy+=a.length,!(snapshotReplication.copyCalls>0)){e.next=40;break}return snapshotReplication.copyCallsWaiting++,e.next=39,lively_lang.promise.waitFor(function(){return snapshotReplication.copyCalls<=0});case 39:snapshotReplication.copyCallsWaiting--;case 40:return snapshotReplication.copyCalls++,updateState(_this5),console.log(_this5+" copying "+a.length+" snapshots..."),e.next=45,lively_lang.promise.parallel(a.map(function(e){return function(){var t=("push"===n?fromSnapshotLocation:remoteLocation).join(e),r=("push"===n?remoteLocation:fromSnapshotLocation).join(e);return snapshotReplication.stopped?(console.warn(_this5+" Stopping copying resources b/c synchronization ended ("+snapshotReplication.copyCalls+", "+t.url+" => "+r.url+")"),Promise.resolve()):r.exists().then(function(e){return e?(debug&&console.log("Skip copying to "+r.url+", already exist"),Promise.resolve()):t.exists().then(function(e){return e?(debug&&console.log(_this5+" Copying "+t.url+" => "+r.url),function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t.copyTo(r).catch(function(t){if(n>=5)throw t;return e(n+1)})}(0).then(function(e){return snapshotReplication.nFilesCopied++,snapshotReplication.stopped||snapshotReplication.nFilesCopied%10!=0||console.log(_this5+" copied "+snapshotReplication.nFilesCopied+" of "+snapshotReplication.nFilesToCopy+" snapshots"),e})):(console.warn("Skip copying "+t.url+", does not exist"),Promise.resolve())})})}}),5);case 45:console.log(_this5+" sending files done"),e.next=53;break;case 48:throw e.prev=48,e.t1=e.catch(3),console.error("error in commitReplication onChange",e.t1),s=e.t1,e.t1;case 53:return e.prev=53,snapshotReplication.copyCalls--,updateState(_this5),tryToResolve(_this5,s?[s]:[]),e.finish(53);case 58:case"end":return e.stop()}},e,_this5,[[3,48,53,58],[8,22,26,34],[27,,29,33]])}));return function(t){return e.apply(this,arguments)}}()).on("paused",function(){commitReplicationState="paused",updateState(_this5),debug&&console.log(_this5+" commit replication paused")}).on("active",function(){commitReplicationState="active",updateState(_this5),debug&&console.log(_this5+" commit replication active")}).on("error",function(e){commitReplicationState="complete",updateState(_this5),console.error(_this5+" commit replication error",e),tryToResolve(_this5,[e])}).on("complete",function(e){commitReplicationState="complete",updateState(_this5);var t="sync"===method?e.push.errors.concat(e.pull.errors):e.errors;tryToResolve(_this5,t)}),versionReplication.on("change",function(e){"replicateTo"===method?e={direction:"push",change:e}:"replicateFrom"===method&&(e={direction:"pull",change:e});var t=e,r=t.direction,n=t.change,i=(n.ok,n.docs);n.errors;debug&&console.log(_this5+" "+("push"===r?"send":"received")+" "+i.length+" histories"),i.forEach(function(e){e._id.startsWith("_")||_this5.changes.push({direction:r,kind:"versions",id:e._id})})}).on("paused",function(){versionReplicationState="paused",updateState(_this5),debug&&console.log(_this5+" version replication paused")}).on("active",function(e){versionReplicationState="active",updateState(_this5),debug&&console.log(_this5+" version replication active",e)}).on("error",function(e){versionReplicationState="complete",updateState(_this5),console.error(_this5+" version replication error",e),tryToResolve(_this5,[e])}).on("complete",function(e){versionReplicationState="complete",updateState(_this5);var t="sync"===method?e.push.errors.concat(e.pull.errors):e.errors;tryToResolve(_this5,t)}),this.state="running",_context41.abrupt("return",this);case 57:case"end":return _context41.stop()}},_callee40,this)}));function _startReplicationAndCopy(){return _ref69.apply(this,arguments)}return _startReplicationAndCopy}()},{key:"safeStop",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("not started"!==this.state&&this.isSynchonizing){e.next=2;break}return e.abrupt("return",this);case 2:return e.next=4,this.whenPaused();case 4:return e.abrupt("return",this.stop());case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){return"not started"!==this.state&&this.isSynchonizing?(this.commitReplication.cancel(),this.versionReplication.cancel(),this.snapshotReplication.stopped=!0,this):this}},{key:"toString",value:function(){var e=this.method;return"Synchronization("+this.state+": "+this.fromObjectDB.name+" "+("sync"===e?"<=>":"replicateTo"===e?"=>":"replicateFrom"===e?"<=":"??")+")"}},{key:"isSynchonizing",get:function(){return this.isPaused||this.isRunning}},{key:"isComplete",get:function(){return"complete"===this.state}},{key:"isRunning",get:function(){return"running"===this.state}},{key:"isPaused",get:function(){return"paused"===this.state}},{key:"changesByTypeAndName",get:function(){var e={push:{},pull:{}};return this.changes.forEach(function(t){var r=t.direction,n=t.id,i=t.kind;if("_"!==n[0]){var o=void 0;if("versions"===i)o=e[r][n]||(e[r][n]=[]);else if("commits"===i){var s=t.type+"/"+t.name;o=e[r][s]||(e[r][s]=[])}o.push(t)}}),e}}]),Synchronization}();function checkArg(e,t,r){if(void 0===t&&"string"==typeof r&&!r.includes("undefined"))throw new Error("parameter "+e+" is undefined");if(null===t&&"string"==typeof r&&!r.includes("null"))throw new Error("parameter "+e+" is null");if("string"==typeof r&&function(){var n=void 0===t?"undefined":_typeof(t),i=t?t.constructor.name:"";if(!r.split("|").some(function(e){return n===e||i===e}))throw new Error('parameter "'+e+'" expected to be of type '+r+" but is "+(i||n))}(),"function"==typeof r){var n=r(t);if(n&&n.error)throw new Error('check of parameter "'+e+'" failed: '+n.error)}}function checkArgs(e,t,r){for(var n in t)checkArg(n,e[n],t[n]);if("function"==typeof r){var i=r(e);if(i&&i.error)throw new Error(i.error)}return e}var ObjectDBInterface={describe:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,s;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(s=function(e,t){var r=e.find(function(e){return e.name===t}).node.value.body,n=r.body||[],i=(r.comments||[]).find(function(e){return e.end<n[0].start}),o={name:t,parameters:[],sideEffect:!1,returns:null,description:""};if(i&&i.text.trim()){var s=lively.lang.string.changeIndent(i.text," ",0).split("\n"),a=!0,u=!1,c=void 0;try{for(var f,l=s[Symbol.iterator]();!(a=(f=l.next()).done);a=!0){var h=f.value;if(h.startsWith("ignore-in-doc")){o.description="";break}h.startsWith("side effect:")?o.sideEffect=JSON.parse(h.split(":")[1]):h.startsWith("returns:")?o.returns=h.split(":")[1].trim():o.description+=h+"\n"}}catch(e){u=!0,c=e}finally{try{!a&&l.return&&l.return()}finally{if(u)throw c}}}var d=!0,p=!1,v=void 0;try{for(var m,g=n[Symbol.iterator]();!(d=(m=g.next()).done);d=!0){var y=m.value;if("checkArgs"===lively.lang.Path("declarations.0.init.callee.name").get(y)){var _=lively.lang.Path("declarations.0.id.properties").get(y);_&&(o.parameters=_.map(function(e){return e.key.name}))}}}catch(e){p=!0,v=e}finally{try{!d&&g.return&&g.return()}finally{if(p)throw v}}return o},r.prev=1,t._methodSpecs){r.next=9;break}return r.next=5,lively.modules.module("lively.storage/objectdb.js").source();case 5:n=r.sent,i=lively.ast.parse(n,{withComments:!0}),o=lively.ast.categorizer.findDecls(i),t._methodSpecs=o.filter(function(e){return e.parent&&"ObjectDBInterface"===e.parent.name});case 9:return r.abrupt("return",e?s(t._methodSpecs,e):t._methodSpecs.map(function(e){return s(t._methodSpecs,e.name)}).filter(Boolean));case 12:return r.prev=12,r.t0=r.catch(1),r.abrupt("return","Error in describe "+r.t0);case 15:case"end":return r.stop()}},r,t,[[1,12]])}))()},ensureDB:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",snapshotLocation:"string|Resource"}),i=n.db,o=n.snapshotLocation,t.next=5,ObjectDB.find(i);case 5:if(!t.sent){t.next=8;break}return t.abrupt("return",!1);case 8:return ObjectDB.named(i,{snapshotLocation:o}),t.abrupt("return",!0);case 10:case"end":return t.stop()}},r,t)}))()},destroyDB:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string"}),i=n.db,t.next=4,ObjectDB.find(i);case 4:if(o=t.sent){t.next=7;break}return t.abrupt("return",!1);case 7:return t.next=9,o.destroy();case 9:return t.abrupt("return",!0);case 10:case"end":return t.stop()}},r,t)}))()},fetchCommits:function fetchCommits(args){var _this9=this;return asyncToGenerator(regeneratorRuntime.mark(function _callee45(){var _checkArgs3,dbName,ref,type,typesAndNames,knownCommitIds,includeDeleted,filterFn,db,commitDB,versionDB,versionQueryOpts,refsByTypeAndName,keys,_iteratorNormalCompletion17,_didIteratorError17,_iteratorError17,_iterator17,_step17,_ref73,_type2,name,_ref74,versions,commitIds,_iteratorNormalCompletion18,_didIteratorError18,_iteratorError18,_iterator18,_step18,version,_id,refs,commitId,commits,fn,filteredCommits;return regeneratorRuntime.wrap(function _callee45$(_context46){for(;;)switch(_context46.prev=_context46.next){case 0:return _checkArgs3=checkArgs(args,{db:"string",ref:"string|undefined",type:"string|undefined",typesAndNames:"Array|undefined",knownCommitIds:"object|undefined",includeDeleted:"boolean|undefined",filterFn:"string|undefined"}),dbName=_checkArgs3.db,ref=_checkArgs3.ref,type=_checkArgs3.type,typesAndNames=_checkArgs3.typesAndNames,knownCommitIds=_checkArgs3.knownCommitIds,includeDeleted=_checkArgs3.includeDeleted,filterFn=_checkArgs3.filterFn,_context46.next=10,ObjectDB.find(dbName);case 10:if(db=_context46.sent,ref||(ref="HEAD"),db){_context46.next=14;break}throw new Error("db "+dbName+" does not exist");case 14:if(_context46.t0=db.__commitDB,_context46.t0){_context46.next=19;break}return _context46.next=18,db._commitDB();case 18:_context46.t0=_context46.sent;case 19:if(commitDB=_context46.t0,_context46.t1=db.__versionDB,_context46.t1){_context46.next=25;break}return _context46.next=24,db._versionDB();case 24:_context46.t1=_context46.sent;case 25:if(versionDB=_context46.t1,versionQueryOpts={},refsByTypeAndName={},!typesAndNames){_context46.next=50;break}for(keys=versionQueryOpts.keys=[],_iteratorNormalCompletion17=!0,_didIteratorError17=!1,_iteratorError17=void 0,_context46.prev=32,_iterator17=typesAndNames[Symbol.iterator]();!(_iteratorNormalCompletion17=(_step17=_iterator17.next()).done);_iteratorNormalCompletion17=!0)_ref73=_step17.value,_type2=_ref73.type,name=_ref73.name,_ref74=_ref73.ref,keys.push(_type2+"/"+name),_ref74&&(refsByTypeAndName[_type2+"/"+name]=_ref74);_context46.next=40;break;case 36:_context46.prev=36,_context46.t2=_context46.catch(32),_didIteratorError17=!0,_iteratorError17=_context46.t2;case 40:_context46.prev=40,_context46.prev=41,!_iteratorNormalCompletion17&&_iterator17.return&&_iterator17.return();case 43:if(_context46.prev=43,!_didIteratorError17){_context46.next=46;break}throw _iteratorError17;case 46:return _context46.finish(43);case 47:return _context46.finish(40);case 48:_context46.next=51;break;case 50:type&&(versionQueryOpts.startkey=type+'/\0"',versionQueryOpts.endkey=type+'/"');case 51:return _context46.next=53,versionDB.getAll(versionQueryOpts);case 53:versions=_context46.sent,commitIds=[],_iteratorNormalCompletion18=!0,_didIteratorError18=!1,_iteratorError18=void 0,_context46.prev=58,_iterator18=versions[Symbol.iterator]();case 60:if(_iteratorNormalCompletion18=(_step18=_iterator18.next()).done){_context46.next=73;break}if(version=_step18.value,!version.deleted&&!version._deleted){_context46.next=64;break}return _context46.abrupt("continue",70);case 64:if(_id=version._id,refs=version.refs,!_id.startsWith("_")){_context46.next=67;break}return _context46.abrupt("continue",70);case 67:ref=refsByTypeAndName[_id]||ref,commitId=refs[ref],(commitId&&!knownCommitIds||!knownCommitIds.hasOwnProperty(commitId))&&commitIds.push(commitId);case 70:_iteratorNormalCompletion18=!0,_context46.next=60;break;case 73:_context46.next=79;break;case 75:_context46.prev=75,_context46.t3=_context46.catch(58),_didIteratorError18=!0,_iteratorError18=_context46.t3;case 79:_context46.prev=79,_context46.prev=80,!_iteratorNormalCompletion18&&_iterator18.return&&_iterator18.return();case 82:if(_context46.prev=82,!_didIteratorError18){_context46.next=85;break}throw _iteratorError18;case 85:return _context46.finish(82);case 86:return _context46.finish(79);case 87:return _context46.next=89,db.getCommitsWithIds(commitIds);case 89:if(commits=_context46.sent,includeDeleted||(commits=commits.filter(function(e){return!e.deleted})),!filterFn){_context46.next=107;break}if(_context46.prev=92,fn=eval("("+filterFn+")"),"function"==typeof fn){_context46.next=96;break}throw new Error(filterFn+" does not eval to a function!");case 96:if(filteredCommits=commits.filter(fn),Array.isArray(filteredCommits)){_context46.next=101;break}throw new Error(filterFn+" does not return an array!");case 101:commits=filteredCommits;case 102:_context46.next=107;break;case 104:_context46.prev=104,_context46.t4=_context46.catch(92),console.error("fetchCommits filterFn failed:",_context46.t4);case 107:return _context46.abrupt("return",commits);case 108:case"end":return _context46.stop()}},_callee45,_this9,[[32,36,40,48],[41,,43,47],[58,75,79,87],[80,,82,86],[92,104]])}))()},fetchVersionGraph:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,s,a,u,c,f;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",type:"string",name:"string"}),i=n.db,o=n.type,s=n.name,t.next=6,ObjectDB.find(i);case 6:if(a=t.sent){t.next=9;break}throw new Error("db "+i+" does not exist");case 9:return t.next=11,a.versionGraph(o,s);case 11:return u=t.sent,c=u.refs,f=u.history,t.abrupt("return",{refs:c,history:f});case 15:case"end":return t.stop()}},r,t)}))()},exists:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,s,a,u,c,f;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",type:"string",name:"string",ref:"string|undefined"}),i=n.db,o=n.type,s=n.name,a=n.ref,t.next=7,ObjectDB.find(i);case 7:return u=t.sent,t.next=10,u.versionGraph(o,s);case 10:if(c=t.sent){t.next=13;break}return t.abrupt("return",{exists:!1,commitId:void 0});case 13:if(a=a||"HEAD",f=c.refs[a]){t.next=17;break}return t.abrupt("return",{exists:!1,commitId:void 0});case 17:return t.abrupt("return",{exists:!0,commitId:f});case 18:case"end":return t.stop()}},r,t)}))()},fetchLog:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,s,a,u,c,f,l,h,d,p,v,m,g,y,_,b,w,k;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",type:"string|undefined",name:"string|undefined",ref:"string|undefined",commit:"string|undefined",limit:"number|undefined",includeCommits:"boolean|undefined",knownCommitIds:"object|undefined"},function(e){return e.type&&e.name||e.commit?null:{error:"Eiter .type + .name or .commit needed!"}}),i=n.db,o=n.type,s=n.name,a=n.ref,u=n.commit,c=n.limit,f=n.includeCommits,l=n.knownCommitIds,t.next=11,ObjectDB.find(i);case 11:if(h=t.sent,d=a||"HEAD",h){t.next=15;break}throw new Error("db "+i+" does not exist");case 15:if(c||(c=1/0),u||a||(a=d),p=void 0,!u){t.next=28;break}if(p=u,o&&s){t.next=28;break}return t.next=23,h.getCommit(u);case 23:if(v=t.sent){t.next=26;break}throw new Error("fetchLog: specified commit "+u+" but no commit with this id is in the database!");case 26:o=v.type,s=v.name;case 28:return t.next=30,h.versionGraph(o,s);case 30:if(m=t.sent){t.next=33;break}throw new Error("Unknown object "+o+"/"+s);case 33:g=m.refs,y=m.history,p||(p=g[a]),_=p,b=[];case 36:if(!(b.length<c)||b.includes(_)){t.next=45;break}if(b.push(_),(w=y[_])&&w.length){t.next=41;break}return t.abrupt("break",45);case 41:k=slicedToArray(w,1),_=k[0],t.next=36;break;case 45:if(!f){t.next=50;break}return l&&(b=b.filter(function(e){return!l.hasOwnProperty(e)})),t.next=49,h.getCommitsWithIds(b);case 49:b=t.sent;case 50:return t.abrupt("return",b);case 51:case"end":return t.stop()}},r,t)}))()},fetchSnapshot:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,s,a,u,c,f,l;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",type:"string|undefined",name:"string|undefined",ref:"string|undefined",commit:"string|undefined"},function(e){return e.type&&e.name||e.commit?null:{error:"Eiter .type + .name or .commit needed!"}}),i=n.db,o=n.type,s=n.name,a=n.ref,u=n.commit,t.next=8,ObjectDB.find(i);case 8:if(c=t.sent,a=a||"HEAD",c){t.next=13;break}throw new Error("db "+i+" does not exist");case 13:if(u){t.next=22;break}return t.next=16,c.versionGraph(o,s);case 16:if(f=t.sent){t.next=19;break}throw new Error("Unknown object "+o+"/"+s);case 19:if(u=f.refs[a]){t.next=22;break}throw new Error("Cannot find commit for ref "+a+" of "+o+"/"+s);case 22:return t.next=24,c.getCommit(u);case 24:if(l=t.sent){t.next=27;break}throw new Error("Cannot find commit "+u);case 27:return t.abrupt("return",c.loadSnapshot(void 0,void 0,l));case 28:case"end":return t.stop()}},r,t)}))()},revert:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,s,a,u,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",type:"string",name:"string",ref:"string|undefined",toCommitId:"string"}),i=n.db,o=n.type,s=n.name,a=n.ref,u=n.toCommitId,t.next=8,ObjectDB.find(i);case 8:return c=t.sent,a||(a="HEAD"),t.abrupt("return",c.revert(o,s,a,u));case 11:case"end":return t.stop()}},r,t)}))()},commit:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,s,a,u,c,f,l,h;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",type:"string",name:"string",ref:"string|undefined",snapshot:"object|string|undefined",preview:"string|undefined",commitSpec:"object",expectedParentCommit:"string|undefined"}),i=n.db,o=n.type,s=n.name,a=n.ref,u=n.expectedParentCommit,c=n.commitSpec,f=n.snapshot,l=n.preview,t.next=11,ObjectDB.find(i);case 11:return h=t.sent,a||(a="HEAD"),t.abrupt("return",h.commit(o,s,f,c,l,a,u));case 14:case"end":return t.stop()}},r,t)}))()},exportToSpecs:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",nameAndTypes:"Array|undefined",includeDeleted:"boolean|undefined"}),i=n.db,o=n.nameAndTypes,t.next=5,ObjectDB.find(i);case 5:if(s=t.sent){t.next=8;break}throw new Error("db "+i+" does not exist");case 8:return t.abrupt("return",s.exportToSpecs(o));case 9:case"end":return t.stop()}},r,t)}))()},exportToDir:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,s,a,u,c,f;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",url:"string",nameAndTypes:"Array|undefined",copyResources:"boolean|undefined",includeDeleted:"boolean|undefined"}),i=n.db,o=n.url,s=n.nameAndTypes,a=n.copyResources,u=n.includeDeleted,t.next=8,ObjectDB.find(i);case 8:if(c=t.sent,f=void 0,c){t.next=12;break}throw new Error("db "+i+" does not exist");case 12:try{f=lively_resources.resource(o)}catch(e){f=lively_resources.resource(System.baseURL).join(o)}return t.abrupt("return",c.exportToDir(f,s,a,u));case 14:case"end":return t.stop()}},r,t)}))()},importFromDir:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,s,a,u,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",url:"string",overwrite:"boolean|undefined",copyResources:"boolean|undefined"}),i=n.db,o=n.url,s=n.overwrite,a=n.copyResources,t.next=7,ObjectDB.find(i);case 7:if(u=t.sent,c=void 0,u){t.next=11;break}throw new Error("db "+i+" does not exist");case 11:try{c=lively_resources.resource(o)}catch(e){c=lively_resources.resource(System.baseURL).join(o)}return t.abrupt("return",u.importFromDir(c,s,a));case 13:case"end":return t.stop()}},r,t)}))()},importFromSpecs:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,s,a,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",specs:"object",overwrite:"boolean|undefined",copyResources:"boolean|undefined"}),i=n.db,o=n.specs,s=n.overwrite,a=n.copyResources,t.next=7,ObjectDB.find(i);case 7:if(u=t.sent){t.next=10;break}throw new Error("db "+i+" does not exist");case 10:return t.abrupt("return",u.importFromSpecs(o,s,a));case 11:case"end":return t.stop()}},r,t)}))()},importFromResource:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,s,a,u,c,f,l;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",type:"string",name:"string",url:"string",commitSpec:"object",purgeHistory:"boolean|undefined"}),i=n.db,o=n.type,s=n.name,a=n.url,u=n.commitSpec,c=n.purgeHistory,t.next=9,ObjectDB.find(i);case 9:if(f=t.sent,l=void 0,f){t.next=13;break}throw new Error("db "+i+" does not exist");case 13:try{l=lively_resources.resource(a)}catch(e){l=lively_resources.resource(System.baseURL).join(a)}return t.abrupt("return",f.importFromResource(o,s,l,u,c));case 15:case"end":return t.stop()}},r,t)}))()},delete:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,s,a,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",type:"string",name:"string",dryRun:"boolean|undefined"}),i=n.db,o=n.type,s=n.name,a=n.dryRun,t.next=7,ObjectDB.find(i);case 7:return u=t.sent,t.abrupt("return",u.delete(o,s,void 0===a||a));case 9:case"end":return t.stop()}},r,t)}))()},deleteCommit:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,s,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",commit:"string",dryRun:"boolean|undefined"}),i=n.db,o=n.commit,s=n.dryRun,t.next=6,ObjectDB.find(i);case 6:return a=t.sent,t.abrupt("return",a.deleteCommit(o,void 0===s||s));case 8:case"end":return t.stop()}},r,t)}))()},fetchConflicts:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,s,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",includeDocs:"boolean|undefined",only:"object|undefined"}),i=n.db,o=n.includeDocs,s=n.only,t.next=6,ObjectDB.find(i);case 6:return a=t.sent,t.abrupt("return",a.getConflicts(o,s));case 8:case"end":return t.stop()}},r,t)}))()},resolveConflict:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,s,a,u,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",id:"string",kind:"string",delete:"Array",resolved:"object"}),i=n.db,o=n.resolved,s=n.delete,a=n.kind,u=n.id,t.next=8,ObjectDB.find(i);case 8:return c=t.sent,t.abrupt("return",c.resolveConflict({resolved:o,delete:s,kind:a,id:u}));case 10:case"end":return t.stop()}},r,t)}))()},fetchDiff:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",otherDB:"string"}),i=n.db,o=n.otherDB,t.next=5,ObjectDB.find(i);case 5:return s=t.sent,t.abrupt("return",s.getDiff(o));case 7:case"end":return t.stop()}},r,t)}))()},synchronize:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,s,a,u,c,f,l,h,d,p,v;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",otherDB:"string",otherDBSnapshotLocation:"string|undefined",onlyTypesAndNames:"object|undefined",method:"string|undefined"}),i=n.db,o=n.otherDB,s=n.otherDBSnapshotLocation,a=n.onlyTypesAndNames,u=n.method,t.next=8,ObjectDB.find(i);case 8:return t.sent,s||(s=o.replace(/\/$/,"")+"/snapshots"),u||(u="replicateTo"),t.next=13,ObjectDB.find(i);case 13:return c=t.sent,t.next=16,ObjectDB.named(o,{snapshotLocation:s});case 16:return f=t.sent,t.next=19,f._commitDB();case 19:return l=t.sent,t.next=22,f._versionDB();case 22:return h=t.sent,d=f.snapshotLocation,p={replicationFilter:a?{onlyTypesAndNames:a}:void 0,retry:!0,live:!0},v=c[u](l,h,d,p),t.next=28,v.whenPaused();case 28:return t.next=30,v.safeStop();case 30:return t.next=32,v.waitForIt();case 32:return t.abrupt("return",lively_lang.obj.select(v,["state","method","conflicts","errors","changesByTypeAndName"]));case 33:case"end":return t.stop()}},r,t)}))()}},ObjectDBHTTPInterface=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.location.origin+"/objectdb/";classCallCheck(this,e),this.serverURL=t}return createClass(e,[{key:"_processResponse",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.headers.get("content-type"),e.next=3,t.text();case 3:if(n=e.sent,i=void 0,"application/json"===r)try{i=JSON.parse(n)}catch(e){}if(!(!t.ok||i&&i.error)){e.next=8;break}throw new Error(i&&i.error||n||t.statusText);case 8:return e.abrupt("return",i||n);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_GET",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object.keys(i).map(function(e){var t=i[e];return"object"===(void 0===t?"undefined":_typeof(t))&&(t=JSON.stringify(t)),e+"="+encodeURIComponent(t)}).join("&"),n=this.serverURL+t+"?"+r,e.t0=this,e.next=4,fetch(n);case 4:return e.t1=e.sent,e.abrupt("return",e.t0._processResponse.call(e.t0,e.t1));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_POST",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.serverURL+t,e.t0=this,e.next=4,fetch(r,{method:"POST",body:JSON.stringify(n),headers:{"content-type":"application/json"}});case 4:return e.t1=e.sent,e.abrupt("return",e.t0._processResponse.call(e.t0,e.t1));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"describe",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("describe",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"ensureDB",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("ensureDB",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"destroyDB",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("destroyDB",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fetchCommits",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("fetchCommits",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fetchVersionGraph",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("fetchVersionGraph",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"exists",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("exists",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fetchLog",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("fetchLog",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fetchSnapshot",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("fetchSnapshot",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"revert",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("revert",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"commit",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("commit",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"exportToSpecs",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("exportToSpecs",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"exportToDir",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("exportToDir",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"importFromDir",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("importFromDir",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"importFromSpecs",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("importFromSpecs",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"importFromResource",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("importFromResource",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("delete",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"deleteCommit",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("deleteCommit",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fetchConflicts",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("fetchConflicts",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"resolveConflict",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("resolveConflict",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fetchDiff",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("fetchDiff",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"synchronize",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("synchronize",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),debug=!1,slashRe=/\//g;function applyExclude(e,t){return!t||("string"==typeof t?!e.url.includes(t):"function"==typeof t?!t(e):!(t instanceof RegExp)||!t.test(e.url))}var StorageDatabase=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,Database),createClass(t,null,[{key:"ensureDB",value:function(e,r){return get$1(t.__proto__||Object.getPrototypeOf(t),"ensureDB",this).call(this,"lively.storage-"+e,r)}}]),t}(),LivelyStorageResource=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,e),createClass(t,[{key:"read",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return debug&&console.log("["+this+"] read"),e.next=3,this.db.get(this.pathWithoutQuery());case 3:return t=e.sent,r=t&&t.content,e.abrupt("return",r?"string"==typeof r?r:JSON.stringify(r):"");case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"readJson",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.read();case 2:return t=e.sent,e.abrupt("return","string"==typeof t?JSON.parse(t):t);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"write",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(debug&&console.log("["+this+"] write"),t||(t=""),!this.isDirectory()){e.next=4;break}throw new Error("Cannot write into a directory! ("+this.url+")");case 4:return e.next=6,this.db.update(this.pathWithoutQuery(),function(e){if(e&&e.isDirectory)throw new Error(r.url+" already exists and is a directory (cannot write into it!)");var n=Date.now();return e?_extends({},e,{lastModified:n,size:t.length,content:t}):{etag:void 0,type:void 0,contentType:void 0,user:void 0,group:void 0,mode:void 0,lastModified:n,created:n,size:"string"==typeof t?t.length:0,content:t}});case 6:return e.abrupt("return",this);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"writeJson",value:function(e){return this.write(e)}},{key:"mkdir",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(debug&&console.log("["+this+"] mkdir"),this.isDirectory()){e.next=3;break}throw new Error("Cannot mkdir a file! ("+this.url+")");case 3:return e.next=5,this.db.get(this.pathWithoutQuery());case 5:if(!(t=e.sent)){e.next=10;break}if(t.isDirectory){e.next=9;break}throw new Error(this.url+" already exists and is a file (cannot mkdir it!)");case 9:return e.abrupt("return",this);case 10:return r=Date.now(),e.next=13,this.db.set(this.pathWithoutQuery(),{etag:void 0,type:void 0,contentType:void 0,user:void 0,group:void 0,mode:void 0,lastModified:r,created:r,isDirectory:!0});case 13:return e.abrupt("return",this);case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"exists",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(debug&&console.log("["+this+"] exists"),e.t0=this.isRoot(),e.t0){e.next=6;break}return e.next=5,this.db.get(this.pathWithoutQuery());case 5:e.t0=!!e.sent;case 6:return e.abrupt("return",e.t0);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return debug&&console.log("["+this+"] remove"),t=this.pathWithoutQuery(),r=this.db,e.next=5,r.docList({startkey:t,endkey:t+""});case 5:return n=e.sent,e.next=8,r.setDocuments(n.map(function(e){return{_id:e.id,_rev:e.rev,_deleted:!0}}));case 8:return e.abrupt("return",this);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"readProperties",value:function(){return debug&&console.log("["+this+"] readProperties"),this.db.get(this.pathWithoutQuery())}},{key:"dirList",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,i,o,s,a,u,c,f,l,h=this,d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(debug&&console.log("["+this+"] dirList"),this.isDirectory()){e.next=3;break}return e.abrupt("return",this.asDirectory().dirList(d,p));case 3:return t=p.exclude,r=this.pathWithoutQuery(),n=[],e.next=8,this.db.getAll({startkey:r,endkey:r+""});case 8:i=e.sent,"infinity"===d&&(d=1/0),o=0;case 11:if(!(o<i.length)){e.next=29;break}if(s=i[o],a=s._id,s.isDirectory,a.startsWith(r)&&r!==a){e.next=15;break}return e.abrupt("continue",26);case 15:if(u=a.slice(r.length),!((u.includes("/")?u.match(slashRe).length+1:1)>d)){e.next=20;break}if("continue"!==function(){var e=h.join(u.split("/").slice(0,d).join("/")+"/");return n.some(function(t){return t.equals(e)})||n.push(e),"continue"}()){e.next=20;break}return e.abrupt("continue",26);case 20:if(c=this.join(u),!t||applyExclude(c,t)){e.next=23;break}return e.abrupt("continue",26);case 23:for(n.push(c),f=["created","lastModified","mode","group","user","contentType","type","etag","size"],{},l=0;l<f.length;l++)c[f[l]]=s[f[l]];case 26:o++,e.next=11;break;case 29:return e.abrupt("return",n);case 30:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"canDealWithJSON",get:function(){return!0}},{key:"db",get:function(){return this._db||(this._db=StorageDatabase.ensureDB(this.host()))}}]),t}(lively_resources.Resource),resourceExtension={name:"lively.storage",matches:function(e){return e.startsWith("lively.storage:")},resourceClass:LivelyStorageResource};lively_resources.registerExtension(resourceExtension),exports.Database=Database,exports.ObjectDB=ObjectDB,exports.ObjectDBInterface=ObjectDBInterface,exports.ObjectDBHTTPInterface=ObjectDBHTTPInterface}(this.lively.storage=this.lively.storage||{},PouchDB,pouchdbAdapterMem,lively.lang,lively.resources)}.call(GLOBAL),"undefined"!=typeof module&&module.exports&&(module.exports=GLOBAL.lively.storage)}()}();
//LIVELY.GRAPHICS
!function(){var GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;!function(){var GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;void 0===GLOBAL.lively&&(GLOBAL.lively={}),function(){this.lively=this.lively||{},function(exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},asyncGenerator=function(){function e(e){this.value=e}function t(t){var n,r;function i(n,r){try{var a=t[n](r),s=a.value;s instanceof e?Promise.resolve(s.value).then(function(e){i("next",e)},function(e){i("throw",e)}):o(a.done?"return":"normal",a.value)}catch(e){o("throw",e)}}function o(e,t){switch(e){case"return":n.resolve({value:t,done:!0});break;case"throw":n.reject(t);break;default:n.resolve({value:t,done:!1})}(n=n.next)?i(n.key,n.arg):r=null}this._invoke=function(e,t){return new Promise(function(o,a){var s={key:e,arg:t,resolve:o,reject:a,next:null};r?r=r.next=s:(n=r=s,i(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),get$1=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},set$1=function e(t,n,r,i){var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,n,r,i)}else if("value"in o&&o.writable)o.value=r;else{var s=o.set;void 0!==s&&s.call(i,r)}return r},slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},parameterRegex=/function[^\(]*\(([^\)]*)\)|\(?([^\)=]*)\)?\s*=>/,Closure=function(){function e(t,n,r,i){classCallCheck(this,e),this.originalFunc=t,this.varMapping=n||{},this.setFuncSource(r||t),this.setFuncProperties(t||i)}return createClass(e,null,[{key:"fromFunction",value:function(e,t){return new this(e,t||{})}},{key:"fromSource",value:function(e,t){return new this(null,t||{},e)}}]),createClass(e,[{key:"setFuncSource",value:function(e){return e="undefined"!=typeof lively&&lively.sourceTransform&&"function"==typeof lively.sourceTransform.stringifyFunctionWithoutToplevelRecorder?lively.sourceTransform.stringifyFunctionWithoutToplevelRecorder(e):String(e),this.source=e}},{key:"getFuncSource",value:function(){return this.source||this.setFuncSource(this.originalFunc)}},{key:"hasFuncSource",value:function(){return this.source&&!0}},{key:"getFunc",value:function(){return this.originalFunc||this.recreateFunc()}},{key:"getFuncProperties",value:function(){return this.funcProperties||(this.funcProperties={})}},{key:"setFuncProperties",value:function(e){var t=this.getFuncProperties();for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}},{key:"lookup",value:function(e){return this.varMapping[e]}},{key:"parameterNames",value:function(e){if("undefined"!=typeof lively&&lively.ast)return(lively.ast.parseFunction(e).params||[]).map(function(e){return"Identifier"===e.type?e.name:e.left&&"Identifier"===e.left.type?e.left.name:null}).filter(Boolean);var t=parameterRegex.exec(e);return t?(t[1]||t[2]||"").split(",").map(function(e){return e.trim()}):[]}},{key:"firstParameter",value:function(e){return this.parameterNames(e)[0]||null}},{key:"recreateFunc",value:function(){return this.recreateFuncFromSource(this.getFuncSource(),this.originalFunc)}},{key:"recreateFuncFromSource",value:function(e,t){var n=[],r="$super"===this.firstParameter(e);for(var i in this.varMapping)this.varMapping.hasOwnProperty(i)&&("this"!=i?n.push("var "+i+" = this.varMapping."+i+";\n"):!0);var o="";n.length>0&&(o+=n.join("\n")),r&&(o+="(function superWrapperForClosure() { return "),o+="("+e+")",r&&(o+=".apply(this, [$super.bind(this)].concat(Array.from(arguments))) })");try{var a=evalJS.call(this,o)||this.couldNotCreateFunc(o);return this.addFuncProperties(a),this.originalFunc=a,a}catch(e){var s="Cannot create function "+e+" src: "+o;throw console.error(s),new Error(s)}}},{key:"addFuncProperties",value:function(e){var t=this.getFuncProperties();for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);this.addClosureInformation(e)}},{key:"couldNotCreateFunc",value:function(e){var t="Could not recreate closure from source: \n"+e;return console.error(t),function(){throw new Error(t)}}},{key:"asFunction",value:function(){return this.recreateFunc()}},{key:"addClosureInformation",value:function(e){return e.hasLivelyClosure=!0,e.livelyClosure=this,e}},{key:"isLivelyClosure",get:function(){return!0}},{key:"doNotSerialize",get:function(){return["originalFunc"]}}]),e}();function Empty(){return function(){}}function K(){return function(e){return e}}function Null(){return function(){return null}}function False(){return function(){return!1}}function True(){return function(){return!0}}function notYetImplemented(){return function(){throw new Error("Not yet implemented")}}function all(e){var t=[];for(var n in e)e.__lookupGetter__(n)||"function"!=typeof e[n]||t.push(n);return t}function own(e){var t=[];for(var n in e)!e.__lookupGetter__(n)&&e.hasOwnProperty(n)&&"function"==typeof e[n]&&t.push(n);return t}function argumentNames(e){if(e.superclass)return[];var t=e.toString(),n="",r=t.match(/(?:\(([^\)]*)\)|([^\(\)-+!]+))\s*=>/);if(r)n=r[1]||r[2]||"";else{var i=t.match(/^[\s\(]*function[^(]*\(([^)]*)\)/);i&&i[1]&&(n=i[1])}return n.replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",").map(function(e){return e.trim()}).filter(function(e){return!!e})}function qualifiedMethodName(e){var t="";return e.declaredClass?t+=e.declaredClass+">>":e.declaredObject&&(t+=e.declaredObject+"."),t+(e.methodName||e.displayName||e.name||"anonymous")}function extractBody(e){for(var t=String(e).replace(/^function[^\{]+\{\s*/,"").replace(/\}$/,"").trim(),n=t.split(/\n|\r/),r=void 0,i=0;i<n.length;i++){var o=n[i].match(/^(\s+)[^\s]/);o&&(void 0===r||o[1].length<r.length)&&(r=o[1])}return r?t.replace(new RegExp("^"+r,"gm"),""):t}function timeToRun(e){var t=Date.now();return e(),Date.now()-t}function timeToRunN$1(e,t){for(var n=Date.now(),r=0;r<t;r++)e();return(Date.now()-n)/t}function delay(e,t){var n=Array.prototype.slice.call(arguments),r=n.shift();t=1e3*n.shift();return setTimeout(function(){return r.apply(r,n)},t)}function throttle(e,t){var n,r,i,o,a,s,u=debounce(t,function(){a=o=!1});return function(){n=this,r=arguments;return i||(i=setTimeout(function(){i=null,a&&e.apply(n,r),u()},t)),o?a=!0:s=e.apply(n,r),u(),o=!0,s}}function debounce(e,t,n){var r;return function(){var i=this,o=arguments;n&&!r&&t.apply(i,o),clearTimeout(r),r=setTimeout(function(){r=null,n||t.apply(i,o)},e)}}var _throttledByName={};function throttleNamed(e,t,n){var r=_throttledByName;if(r[e])return r[e];return r[e]=throttle(function(){debounceNamed(e,t,function(){delete r[e]})(),n.apply(this,arguments)},t)}var _debouncedByName={};function debounceNamed(e,t,n,r){var i=_debouncedByName;if(i[e])return i[e];return i[e]=debounce(t,function(){delete i[e],n.apply(this,arguments)},r)}var _queues={};function createQueue(e,t){var n=_queues,r=n[e]||(n[e]={_workerActive:!1,worker:t,tasks:[],drain:null,push:function(e){r.tasks.push(e),r.activateWorker()},pushAll:function(e){e.forEach(function(e){r.tasks.push(e)}),r.activateWorker()},pushNoActivate:function(e){r.tasks.push(e)},handleError:function(e){e&&console.error("Error in queue: "+e)},activateWorker:function(){function t(e){r.handleError(e),r.activateWorker()}var i=r.tasks,o=r._workerActive;if(0===i.length)o&&(r._workerActive=!1,"function"==typeof r.drain&&r.drain()),delete n[e];else{o||(r._workerActive=!0);try{r.worker(i.shift(),t)}catch(e){t(e)}}}});return r}var _queueUntilCallbacks={};function workerWithCallbackQueue(e,t,n){var r=_queueUntilCallbacks,i=r[e];if(!!i)return i;var o=!1,a=!1;function s(){c&&clearTimeout(c),o=!0,delete r[e]}function u(t){o||(s(),i.callbacks.forEach(function(n){try{n.apply(null,t)}catch(t){console.error("Error when invoking callbacks in queueUntil ["+e+"]:\n"+String(t.stack||t))}}))}if(n)var c=setTimeout(function(){o||u([new Error("timeout")])},n);return i=r[e]={callbacks:[],cancel:function(){a=!0,s()},whenDone:function(e){return i.callbacks.push(e),i}},setTimeout(function(){if(!a)try{t(function(){u(arguments)})}catch(e){u([e])}},0),i}function _composeAsyncDefaultEndCallback(e,t){e&&console.error("lively.lang.composeAsync error",e)}function composeAsync(){var e,t,n=Array.prototype.slice,r=n.call(arguments),i=_composeAsyncDefaultEndCallback,o=i,a=new Promise(function(n,r){e=n,t=r});return r.reverse().reduce(function(e,s,u){var c=!1;return function(){var l=n.call(arguments);if(o===i&&u===r.length-1){for(;l.length&&"function"!=typeof l[l.length-1];)l.pop();"function"==typeof l[l.length-1]&&(o=l.pop())}function f(){c=!0;var r=n.call(arguments),i=r.shift();i?(o(i),t(i)):e.apply(null,r)}if("function"==typeof s)try{var h=s.apply(this,l.concat([f]));h&&"function"==typeof h.then&&"function"==typeof h.catch&&h.then(function(e){return f(null,e)}).catch(function(e){return f(e)})}catch(e){console.error("composeAsync: ",e.stack||e),c||(o(e),t(e))}else if(s&&"function"==typeof s.then&&"function"==typeof s.catch)s.then(function(e){f(null,e)}).catch(function(e){f(e)});else{var p=new Error("Invalid argument to composeAsync: "+s);o(p),t(p)}return a}},function(){var t=n.call(arguments);o.apply(null,[null].concat(t)),e(t[0])})}function compose(){return Array.prototype.slice.call(arguments).reverse().reduce(function(e,t){return function(){return e(t.apply(this,arguments))}},function(e){return e})}function flip(e){return function(){var t=Array.prototype.slice.call(arguments),n=[t[1],t[0]].concat(t.slice(2));return e.apply(null,n)}}function withNull(e){return e=e||function(){},function(){var t=lively.lang.arr.from(arguments);e.apply(null,[null].concat(t))}}function waitFor(e,t,n){var r=Date.now(),i=50;n||(n=t,t=e,e=void 0),function o(){if(t())return n();if(e){var a=Date.now()-r,s=e-a;if(s<=0)return n(new Error("timeout"));s<i&&(i=s)}setTimeout(o,i)}()}function waitForAll(e,t,n){n||(n=t,t=e,e=null),e=e||{};var r=t.map(function(){return null});if(t.length){var i=Array.prototype.slice.call(t);t.forEach(function(e,t){try{e(function(){var n=Array.prototype.slice.call(arguments),r=n.shift();o(e,t,r,n)})}catch(n){o(e,t,n,null)}}),e.timeout&&setTimeout(function(){if(i.length){var e=r.map(function(e,t){return null===e&&t}).filter(function(e){return"number"==typeof e}).join(", ");o(null,null,new Error("waitForAll timed out, functions at "+e+" not done"),null)}},e.timeout)}else n(null,r);function o(e,t,o,a){if(i.length){var s=null,u=i.indexOf(e);u>-1&&i.splice(u,1),o?(i.length=0,s=new Error("in waitForAll at"+("number"==typeof t?" "+t:"")+": \n"+(o.stack||String(o)))):a&&(r[t]=a),i.length||setTimeout(function(){n(s,r)},0)}}}function curry(e,t,n,r){if(arguments.length<=1)return arguments[0];var i=Array.prototype.slice.call(arguments);e=i.shift();function o(){return e.apply(this,i.concat(Array.prototype.slice.call(arguments)))}return o.isWrapper=!0,o.originalFunction=e,o}function wrap(e,t){var n=e,r=function(){var e=Array.prototype.slice.call(arguments),r=t.isWrapper?e:[n.bind(this)].concat(e);return t.apply(this,r)};return r.isWrapper=!0,r.originalFunction=n,r}function getOriginal(e){for(;e.originalFunction;)e=e.originalFunction;return e}function wrapperChain(e){var t=[];do{t.push(e),e=e.originalFunction}while(e);return t}function replaceMethodForOneCall(e,t,n){n.originalFunction=e[t];var r=e.hasOwnProperty(t);return e[t]=function(){return r?e[t]=n.originalFunction:delete e[t],n.apply(this,arguments)},e}function once(e){if(e){if("function"!=typeof e)throw new Error("once() expecting a function");var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments))}}}function either(){var e=!1;return Array.prototype.slice.call(arguments).map(function(t){return function(){if(!e)return e=!0,t.apply(this,arguments)}})}var _eitherNameRegistry={};function eitherNamed(e,t){var n=Array.prototype.slice.call(arguments),r=_eitherNameRegistry,i=(e=n.shift(),r[e]||(r[e]={wasCalled:!1,callsLeft:0}));return i.callsLeft++,function(){if(i.callsLeft--,i.callsLeft<=0&&delete r[e],!i.wasCalled)return i.wasCalled=!0,t.apply(this,arguments)}}function evalJS(src){return eval(src)}function fromString(e){return evalJS("("+e.toString()+");")}function asScript(e,t){return Closure.fromFunction(e,t).recreateFunc()}function asScriptOf(e,t,n,r){var i=n||e.name;if(!i)throw Error("Function that wants to be a script needs a name: "+this);var o=Object.getPrototypeOf(t),a={this:t};if(r&&(a=merge([a,r])),o&&o[i]){a.$super=Closure.fromFunction(function(){try{return Object.getPrototypeOf(t)[i].apply(t,arguments)}catch(e){return"undefined"!=typeof $world?$world.logError(e,"Error in $super call"):console.error("Error in $super call: "+e+"\n"+e.stack),null}},{obj:t,name:i}).recreateFunc()}return addToObject(asScript(e,a),t,i)}function addToObject(e,t,n){e.displayName=n;var r=t.attributeConnections?t.attributeConnections.filter(function(e){return"update"===e.getSourceAttrName()}):[];return r&&r.forEach(function(e){e.disconnect()}),t[n]=e,(void 0===t||_typeof(t))&&(e.declaredObject=safeToString(t)),"undefined"!=typeof lively&&t&&lively.Tracing&&lively.Tracing.stackTracingEnabled&&lively.Tracing.instrumentMethod(t,n,{declaredObject:safeToString(t)}),r&&r.forEach(function(e){e.connect()}),e}function binds(e,t){return Closure.fromFunction(e,t||{}).recreateFunc()}function setLocalVarValue(e,t,n){e.hasLivelyClosure&&(e.livelyClosure.funcProperties[t]=n)}function getVarMapping(e){return e.hasLivelyClosure?e.livelyClosure.varMapping:e.isWrapper?e.originalFunction.varMapping:e.varMapping?e.varMapping:{}}function setProperty(e,t,n){e[t]=n,e.hasLivelyClosure&&(e.livelyClosure.funcProperties[t]=n)}function functionNames(e){for(var t=[],n=e.prototype;n;)t=Object.keys(n).reduce(function(e,t){return"function"==typeof n[t]&&-1===e.indexOf(t)&&e.push(t),e},t),n=Object.getPrototypeOf(n);return t}function localFunctionNames(e){return Object.keys(e.prototype).filter(function(t){return"function"==typeof e.prototype[t]})}function logErrors(e,t){var n=function(n){var r=Array.prototype.slice.call(arguments);r.shift();try{return n.apply(e,r)}catch(n){if("undefined"!=typeof lively&&lively.morphic&&lively.morphic.World&&lively.morphic.World.current())throw lively.morphic.World.current().logError(n),n;throw t?console.warn("ERROR: %s.%s(%s): err: %s %s",e,t,r,n,n.stack||""):console.warn("ERROR: %s %s",n,n.stack||""),n}};n.methodName="$logErrorsAdvice";var r=wrap(e,n);return r.originalFunction=e,r.methodName="$logErrorsWrapper",r}function logCompletion(e,t){var n=function(n){var r=Array.prototype.slice.call(arguments);r.shift();try{var i=n.apply(e,r)}catch(e){throw console.warn("failed to load "+t+": "+e),"undefined"!=typeof lively&&lively.lang.Execution&&lively.lang.Execution.showStack(),e}return console.log("completed "+t),i};n.methodName="$logCompletionAdvice::"+t;var r=wrap(e,n);return r.methodName="$logCompletionWrapper::"+t,r.originalFunction=e,r}function logCalls(e,t){var n=e,r=function(r){var o=Array.prototype.slice.call(arguments);return o.shift(),i=r.apply(e,o),t?console.warn("%s(%s) -> %s",qualifiedMethodName(n),o,i):console.log("%s(%s) -> %s",qualifiedMethodName(n),o,i),i};r.methodName="$logCallsAdvice::"+qualifiedMethodName(e);var i=wrap(e,r);return i.originalFunction=e,i.methodName="$logCallsWrapper::"+qualifiedMethodName(e),i}function traceCalls(e,t){return wrap(e,function(n){var r=Array.prototype.slice.call(arguments);r.shift(),t.push(r);var i=n.apply(e,r);return t.pop(),i})}function webkitStack(){try{throw new Error}catch(e){return String(e.stack).split(/\n/).slice(2).map(function(e){return e.replace(/^\s*at\s*([^\s]+).*/,"$1")}).join("\n")}}var fun=Object.freeze({Empty:Empty,K:K,Null:Null,False:False,True:True,notYetImplemented:notYetImplemented,withNull:withNull,all:all,own:own,argumentNames:argumentNames,qualifiedMethodName:qualifiedMethodName,extractBody:extractBody,timeToRun:timeToRun,timeToRunN:timeToRunN$1,delay:delay,throttle:throttle,debounce:debounce,throttleNamed:throttleNamed,debounceNamed:debounceNamed,createQueue:createQueue,workerWithCallbackQueue:workerWithCallbackQueue,composeAsync:composeAsync,compose:compose,waitFor:waitFor,waitForAll:waitForAll,flip:flip,curry:curry,wrap:wrap,binds:binds,getOriginal:getOriginal,wrapperChain:wrapperChain,replaceMethodForOneCall:replaceMethodForOneCall,once:once,either:either,eitherNamed:eitherNamed,evalJS:evalJS,fromString:fromString,asScript:asScript,asScriptOf:asScriptOf,addToObject:addToObject,setLocalVarValue:setLocalVarValue,getVarMapping:getVarMapping,setProperty:setProperty,functionNames:functionNames,localFunctionNames:localFunctionNames,logErrors:logErrors,logCompletion:logCompletion,logCalls:logCalls,traceCalls:traceCalls,webkitStack:webkitStack}),Group=function(){function e(){classCallCheck(this,e)}return createClass(e,[{key:"toArray",value:function(){return this.reduceGroups(function(e,t,n){return e.concat([n])},[])}},{key:"forEach",value:function(e,t){var n=this;return Object.keys(n).forEach(function(r){n[r].forEach(e.bind(t,r))}),n}},{key:"forEachGroup",value:function(e,t){var n=this;return Object.keys(n).forEach(function(r){e.call(t,r,n[r])}),n}},{key:"map",value:function(t,n){var r=new e;return this.forEachGroup(function(e,i){r[e]=i.map(t.bind(n,e))}),r}},{key:"mapGroups",value:function(t,n){var r=new e;return this.forEachGroup(function(e,i){r[e]=t.call(n,e,i)}),r}},{key:"keys",value:function(){return Object.keys(this)}},{key:"reduceGroups",value:function(e,t,n){return this.forEachGroup(function(r,i){t=e.call(n,t,r,i)}),t}},{key:"count",value:function(){return this.reduceGroups(function(e,t,n){return e[t]=n.length,e},{})}}],[{key:"fromArray",value:function(t,n,r){for(var i=new e,o=0,a=t.length;o<a;o++){var s=n.call(r,t[o],o);i[s]||(i[s]=[]),i[s].push(t[o])}return i}},{key:"by",get:function(){return groupBy}}]),e}(),GLOBAL$1="undefined"!=typeof System?System.global:"undefined"!=typeof window?window:global,features$1={from:!!Array.from,filter:!!Array.prototype.filter,find:!!Array.prototype.find,findIndex:!!Array.prototype.findIndex,includes:!!Array.prototype.includes};function range(e,t,n){n=n||0;var r=[];if(e<=t){n<=0&&(n=-n||1);for(var i=e;i<=t;i+=n)r.push(i)}else{n>=0&&(n=-n||-1);for(i=e;i>=t;i+=n)r.push(i)}return r}var from=features$1.from?Array.from:function(e){if(!e)return[];if(Array.isArray(e))return e;if(e.toArray)return e.toArray();for(var t=e.length,n=new Array(t);t--;)n[t]=e[t];return n};function withN(e,t){for(var n=new Array(e);e>0;)n[--e]=t;return n}function genN(e,t){for(var n=new Array(e);e>0;)n[--e]=t(e);return n}function filter(e,t,n){return e.filter(t,n)}var detect=features$1.find?function(e,t,n){return e.find(t,n)}:function(e,t,n){for(var r,i=0,o=e.length;i<o;i++)if(r=e[i],t.call(n,r,i))return r},findIndex=features$1.findIndex?function(e,t,n){return e.findIndex(t,n)}:function(e,t,n){var r=-1;return e.find(function(e,i){return r=i,t.call(e,n)})?r:-1};function findAndGet(e,t){var n;return e.find(function(e,r){return n=t(e,r)}),n}function filterByKey(e,t){return e.filter(function(e){return!!e[t]})}function grep(e,t,n){return"string"==typeof t&&(t=new RegExp(t,"i")),e.filter(t.test.bind(t))}function mask(e,t){return e.filter(function(e,n){return!!t[n]})}function reject(e,t,n){return e.filter(function(e,r){return!t.call(n,e,r)})}function rejectByKey(e,t){return e.filter(function(e){return!e[t]})}function without(e,t){return e.filter(function(e){return e!==t})}function withoutAll(e,t){return e.filter(function(e){return-1===t.indexOf(e)})}function uniq(e,t){if(!e.length)return e;var n=[e[0]];if(t)for(var r=1;r<e.length;r++){var i=e[r];i!==n[n.length]&&n.push(i)}else for(var o=1;o<e.length;o++){var a=e[o];-1===n.indexOf(a)&&n.push(a)}return n}function uniqBy(e,t,n){for(var r=e.slice(),i=r.length;i--;)for(var o=e[i],a=i+1;a<r.length;a++)t.call(n,o,r[a])&&r.splice(a--,1);return r}function uniqByKey(e,t){for(var n={},r=[],i=0;i<e.length;i++){var o=e[i];n[o[t]]||(n[o[t]]=!0,r.push(o))}return r}function compact(e){return e.filter(Boolean)}function mutableCompact(e){for(var t=0,n=0,r=e.length;t<r;)e.hasOwnProperty(t)&&(e[n++]=e[t]),t++;for(;n++<r;)e.pop();return e}function forEach$1(e,t,n){return e.forEach(t,n)}function zip(){var e=Array.from(arguments),t=e.shift(),n="function"==typeof last(e)?e.pop():function(e){return e},r=[t].concat(e).map(function(e){return Array.from(e)});return t.map(function(e,t){return n(pluck(r,t),t)})}function flatten(e,t){if("number"==typeof t){if(t<=0)return e;t--}return e.reduce(function(e,n){return e.concat(Array.isArray(n)?flatten(n,t):[n])},[])}function flatmap(e,t,n){for(var r=[],i=0;i<e.length;i++)r.push.apply(r,t.call(n,e[i],i));return r}function interpose(e,t){return e.reduce(function(e,n){return e.length>0&&e.push(t),e.push(n),e},[])}function delimWith(e,t){return interpose(e,t)}function map$1(e,t,n){return e.map(t,n)}function invoke(e,t,n,r,i,o,a,s){return e.map(function(e){return e[t](n,r,i,o,a,s)})}function pluck(e,t){return e.map(function(e){return e[t]})}function reduce(e,t,n,r){return e.reduce(t,n,r)}function reduceRight(e,t,n,r){return e.reduceRight(t,n,r)}var isArray$1=Array.isArray,includes$1=features$1.includes?function(e,t){return e.includes(t)}:function(e,t){return-1!==e.indexOf(t)},include$1=includes$1;function some(e,t,n){return e.some(t,n)}function every(e,t,n){return e.every(t,n)}function equals$2(e,t){var n=e.length;if(!t||n!==t.length)return!1;for(var r=0;r<n;r++){if(e[r]&&t[r]&&e[r].equals&&t[r].equals){if(e[r].equals(t[r]))continue;return!1}if(e[r]!=t[r])return!1}return!0}function deepEquals(e,t){var n=e.length;if(!t||n!==t.length)return!1;for(var r=0;r<n;r++)if(!equals$1(e[r],t[r]))return!1;return!0}function isSorted(e,t){if(t){for(var n=1;n<e.length;n++)if(e[n-1]<e[n])return!1}else for(n=1;n<e.length;n++)if(e[n-1]>e[n])return!1;return!0}function sort(e,t){return e.sort(t)}function sortBy(e,t,n){return pluck(e.map(function(e,r){return{value:e,criteria:t.call(n,e,r)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return n<r?-1:n>r?1:0}),"value")}function sortByKey(e,t){return sortBy(e,function(e){return e[t]})}function reverse(e){return e.reverse()}function reversed(e){return e.slice().reverse()}function reMatches$1(e,t,n){return n=n||String,e.map(function(e){return n(e).match(t)})}function first(e){return e[0]}function last(e){return e[e.length-1]}function intersect(e,t){return uniq(e).filter(function(e){return t.indexOf(e)>-1})}function union(e,t){for(var n=e.slice(),r=0;r<t.length;r++){var i=t[r];-1===n.indexOf(i)&&n.push(i)}return n}function pushAt(e,t,n){e.splice(n,0,t)}function removeAt(e,t){e.splice(t,1)}function remove(e,t){var n=e.indexOf(t);return n>=0&&removeAt(e,n),t}function pushAll$1(e,t){return e.push.apply(e,t),e}function pushAllAt(e,t,n){e.splice.apply(e,[n,0].concat(t))}function pushIfNotIncluded(e,t){e.includes(t)||e.push(t)}function replaceAt(e,t,n){e.splice(n,1,t)}function clear(e){return e.length=0,e}function isSubset(e,t){for(var n=0;n<e.length;n++)if(!t.includes(e[n]))return!1;return!0}function doAndContinue(e,t,n,r){return n=n||Null,r=r||GLOBAL$1,t=t||function(e,t,n){t.call(r,e,n)},e.reduceRight(function(e,n,i){return function(){t.call(r,e,n,i)}},n)()}function nestedDelay(e,t,n,r,i,o){return r=r||function(){},e.clone().reverse().reduce(function(e,r,a){return function(){t.call(i||GLOBAL$1,r,a),o&&a%o!=0?e():e.delay(n)}},r)()}function forEachShowingProgress(){var e,t,n,r,i,o=Array.from(arguments),a=o.shift(),s=a.length,u=!1;if(1===o.length?(e=o[0].progressBar,t=o[0].iterator,n=o[0].labelFunction,r=o[0].whenDone,i=o[0].context):(e=o[0],t=o[1],n=o[2],r=o[3],i=o[4]),i||(i="undefined"!=typeof window?window:global),n||(n=function(e){return e}),!e){u=!0;var c=("undefined"!=typeof window?window:global).lively&&lively.morphic&&lively.morphic.World.current();e=c?c.addProgressBar():{setValue:function(e){},setLabel:function(){},remove:function(){}}}return e.setValue(0),a.reduceRight(function(r,o,a){return function(){try{e.setValue(a/s),n&&e.setLabel(n.call(i,o,a)),t.call(i,o,a)}catch(e){console.error("Error in forEachShowingProgress at %s (%s)\n%s\n%s",a,o,e,e.stack)}r.delay(0)}},function(){e.setValue(1),u&&function(){e.remove()}.delay(0),r&&r.call(i)})(),a}function swap(e,t,n){t<0&&(t=e.length+t),n<0&&(n=e.length+n);var r=e[t];return e[t]=e[n],e[n]=r,e}function rotate(e,t){return t=t||1,e.slice(t).concat(e.slice(0,t))}function groupBy(e,t,n){return Group.fromArray(e,t,n)}function groupByKey(e,t){return groupBy(e,function(e){return e[t]})}function partition(e,t,n){t=t||function(e){return e};var r=[],i=[];return e.forEach(function(e,o){(t.call(n,e,o)?r:i).push(e)}),[r,i]}function batchify(e,t,n){return function e(r,i){if(!i.length)return r;var o=function e(r,i){if(!i.length)return[r,[]];var o=i[0],a=i.slice(1);var s=r.concat([o]);if(t.call(n,s))return e(s,a);var u=e(r,a);return[u[0],[o].concat(u[1])]}([],i);if(!o[0].length)throw new Error("Batchify constrained does not ensure consumption of at least one item per batch!");return e(r.concat([o[0]]),o[1])}([],e)}function toTuples(e,t){return t=t||1,range(0,Math.ceil(e.length/t)-1).map(function(n){return e.slice(n*t,n*t+t)},e)}var permutations=function(){return function(e){return function e(t,n){return t.length?flatmap(t,function(r,i){return e(t.slice(0,i).concat(t.slice(i+1)),n.concat([r]))}):[n]}(e,[])}}();function combinationsPick(e,t){for(var n=e.map(function(e,n){return e[t[n]]}),r=t.slice(),i=e.length;i--;i>=0){var o=e[i],a=r[i]+1;if(o[a]){r[i]=a;break}if(0===i){r=void 0;break}r[i]=0}return[n,r]}function combinations(e){for(var t=e.reduce(function(e,t){return e*t.length},1),n=e.map(function(e){return 0}),r=new Array(t),i=0;i<t;i++){var o=combinationsPick(e,n);r[i]=o[0],n=o[1]}return r}function take(e,t){return e.slice(0,t)}function drop(e,t){return e.slice(t)}function takeWhile(e,t,n){for(var r=0;r<e.length&&t.call(n,e[r],r);r++);return e.slice(0,r)}function dropWhile(e,t,n){for(var r=0;r<e.length&&t.call(n,e[r],r);r++);return e.slice(r)}function shuffle(e){for(var t=range(0,e.length-1),n=Array(e.length),r=0;r<e.length;r++){n[t.splice(Math.round(Math.random()*(t.length-1)),1)]=e[r]}return n}function max(e,t,n){var r;return t=t||function(e){return e},e.reduce(function(e,i,o){var a=t.call(n,i,o);return"number"!=typeof a||a<=e?e:(r=i,a)},-1/0),r}function min(e,t,n){return t=t||function(e){return e},max(e,function(e,r){return-t.call(n,e,r)})}function sum(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function count$1(e,t){return e.reduce(function(e,n){return n===t?e+1:e},0)}function size$1(e){return e.length}function histogram(e,t){if(void 0===t||"number"==typeof t){var n=t||Math.ceil(Math.log(e.length)/Math.log(2)+1),r=Math.ceil(Math.round(e.length/n));return range(0,n-1).map(function(t){return e.slice(t*r,(t+1)*r)})}if(t instanceof Array){var i=t;return e.reduce(function(e,t){if(t<i[1])return e[0].push(t),e;for(var n=1;n<i.length;n++)if(t>=i[n]&&(!i[n+1]||t<=i[n+1]))return e[n].push(t),e;throw new Error("Histogram creation: Cannot group data "+t+" into thresholds "+i)},range(1,i.length).map(function(){return[]}))}}function clone$1(e){return[].concat(e)}function toArray$3(e){return from(e)}function each(e,t,n){return e.forEach(t,n)}function all$1(e,t,n){return e.every(t,n)}function any(e,t,n){return e.some(t,n)}function collect(e,t,n){return e.map(t,n)}function findAll(e,t,n){return e.filter(t,n)}function inject(e,t,n,r){return r&&(n=n.bind(r)),e.reduce(n,t)}function mapAsyncSeries(e,t,n){var r=[],i=!1;return e.reduceRight(function(e,n,a){if(!i)return function(i,s){if(i)return o(i);a>0&&r.push(s);try{t(n,a,once(e))}catch(e){o(e)}}},function(e,t){r.push(t),o(e,!0)})();function o(e,t){if(!i&&(e||t)){i=!0;try{n(e,r)}catch(e){console.error("Error in mapAsyncSeries - callback invocation error:\n"+(e.stack||e))}}}}function mapAsync(e,t,n,r){if("function"==typeof t&&(r=n,n=t,t=null),t=t||{},!e.length)return r&&r(null,[]);t.parallel||(t.parallel=1/0);var i=[],o=[],a=!1,s=0,u=0,c=e.map(function(e,t){return function(){u++;try{n(e,t,once(function(e,n){i[t]=e||n,f(t,e)}))}catch(e){f(t,e)}}});return l();function l(){for(;u<t.parallel&&s<e.length;)c[s++]()}function f(t,n){if(!(o.indexOf(t)>-1||(o.push(t),u--,a)))if(!n&&o.length<e.length)l();else{a=!0;try{r&&r(n,i)}catch(e){console.error("Error in mapAsync - main callback invocation error:\n"+(e.stack||e))}}}}features$1.from||(Array.from=from),features$1.filter||(Array.prototype.filter=function(e,t){return filter(this,e,t)}),features$1.find||(Array.prototype.find=function(e,t){return detect(this,e,t)}),features$1.findIndex||(Array.prototype.findIndex=function(e,t){return findIndex(this,e,t)}),features$1.includes||(Array.prototype.includes=function(e){return includes$1(this,e)});var arr=Object.freeze({range:range,from:from,withN:withN,genN:genN,filter:filter,detect:detect,findIndex:findIndex,findAndGet:findAndGet,filterByKey:filterByKey,grep:grep,mask:mask,reject:reject,rejectByKey:rejectByKey,without:without,withoutAll:withoutAll,uniq:uniq,uniqBy:uniqBy,uniqByKey:uniqByKey,compact:compact,mutableCompact:mutableCompact,forEach:forEach$1,zip:zip,flatten:flatten,flatmap:flatmap,interpose:interpose,delimWith:delimWith,map:map$1,invoke:invoke,pluck:pluck,reduce:reduce,reduceRight:reduceRight,isArray:isArray$1,includes:includes$1,include:include$1,some:some,every:every,equals:equals$2,deepEquals:deepEquals,isSorted:isSorted,sort:sort,sortBy:sortBy,sortByKey:sortByKey,reverse:reverse,reversed:reversed,reMatches:reMatches$1,first:first,last:last,intersect:intersect,union:union,pushAt:pushAt,removeAt:removeAt,remove:remove,pushAll:pushAll$1,pushAllAt:pushAllAt,pushIfNotIncluded:pushIfNotIncluded,replaceAt:replaceAt,clear:clear,isSubset:isSubset,doAndContinue:doAndContinue,nestedDelay:nestedDelay,forEachShowingProgress:forEachShowingProgress,swap:swap,rotate:rotate,groupBy:groupBy,groupByKey:groupByKey,partition:partition,batchify:batchify,toTuples:toTuples,permutations:permutations,combinationsPick:combinationsPick,combinations:combinations,take:take,drop:drop,takeWhile:takeWhile,dropWhile:dropWhile,shuffle:shuffle,max:max,min:min,sum:sum,count:count$1,size:size$1,histogram:histogram,clone:clone$1,toArray:toArray$3,each:each,all:all$1,any:any,collect:collect,findAll:findAll,inject:inject,mapAsyncSeries:mapAsyncSeries,mapAsync:mapAsync});function print$1(e){if(e&&Array.isArray(e))return"["+e.map(print$1)+"]";if("string"!=typeof e)return String(e);var t=String(e);return t='"'+(t=(t=t.replace(/\n/g,"\\n\\\n")).replace(/(")/g,"\\$1"))+'"'}function indent$1(e,t,n){if(!n||n<=0)return e;for(;n>0;)n--,e=t+e;return e}var getOwnPropertyDescriptors="function"==typeof Object.prototype.getOwnPropertyDescriptors?Object.prototype.getOwnPropertyDescriptors:function(e){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&Object.defineProperty(t,n,{configurable:!0,enumerable:!0,writable:!0,value:Object.getOwnPropertyDescriptor(e,n)});return t};function isArray$$1(e){return Array.isArray(e)}function isElement(e){return e&&1==e.nodeType}function isFunction(e){return e instanceof Function}function isBoolean(e){return"boolean"==typeof e}function isString(e){return"string"==typeof e}function isNumber(e){return"number"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return e instanceof RegExp}function isObject(e){return"object"==(void 0===e?"undefined":_typeof(e))}function isPrimitive(e){if(!e)return!0;switch(void 0===e?"undefined":_typeof(e)){case"string":case"number":case"boolean":return!0}return!1}function isEmpty(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function equals$1(e,t){if(e===t)return!0;if(!e||!t)return e==t;if(Array.isArray(e))return deepEquals(e,t);switch(e.constructor){case String:case Date:case Boolean:case Number:return e==t}if("function"==typeof e.isEqualNode)return e.isEqualNode(t);if("function"==typeof e.equals)return e.equals(t);var n=[];for(var r in e)if(n.push(r),"function"!=typeof e[r]&&!equals$1(e[r],t[r]))return!1;for(var r in t)if(-1===n.indexOf(r)&&"function"!=typeof t[r]&&!equals$1(t[r],e[r]))return!1;return!0}var keys$1=Object.keys;function values(e){return e?Object.keys(e).map(function(t){return e[t]}):[]}function select(e,t){for(var n={},r=0;r<t.length;r++)n[t[r]]=e[t[r]];return n}function dissoc(e,t){for(var n=getOwnPropertyDescriptors(e=e||{}),r=0;r<t.length;r++)t[r]in n&&delete n[t[r]];return Object.defineProperties({},n)}function addScript(e,t,n,r){return asScriptOf(fromString(t),e,n,r)}function extend(e,t){for(var n=null,r=1;r<arguments.length;r++)if("string"!=typeof arguments[r]){t=arguments[r];for(var i in t){var o=t.__lookupGetter__(i),a=t.__lookupSetter__(i);if(o&&e.__defineGetter__(i,o),a&&e.__defineSetter__(i,a),!o&&!a){var s=t[i];e[i]=s,n&&n.push(i),"function"==typeof s&&(s.displayName||(s.displayName=i),"undefined"!=typeof lively&&lively.Module&&lively.Module.current&&(s.sourceModule=lively.Module.current()))}}}else{var u=arguments[r];e.categories||(e.categories={}),e.categories[u]||(e.categories[u]=[]),n=e.categories[u]}return e}function clone$$1(e){if(isPrimitive(e))return e;if(Array.isArray(e))return Array.prototype.slice.call(e);var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function extract(e,t,n){for(var r={},i=0;i<t.length;i++)t[i]in e&&(r[t[i]]=n?n(t[i],e[t[i]]):e[t[i]]);return r}function inspect(e,t,n){if(t=t||{},n=n||0,t.customPrinter){var r=t._ignoreSignal||(t._ignoreSignal={}),i=t.customPrinter(e,r,function(e){return inspect(e,t,n+1)});if(i!==r)return i}if(!e)return print$1(e);if("function"==typeof e)return t.printFunctionSource?String(e):"function"+(e.name?" "+e.name:"")+"("+argumentNames(e).join(",")+") {/*...*/}";switch(e.constructor){case String:case Boolean:case RegExp:case Number:return print$1(e)}if("function"==typeof e.serializeExpr)return e.serializeExpr();var o=e&&Array.isArray(e),a=o?"[":"{",s=o?"]":"}";if(t.maxDepth&&n>=t.maxDepth)return a+"/*...*/"+s;var u=[];if(o)u=e.map(function(e){return inspect(e,t,n+1)});else for(var c=Object.keys(e).sort(function(t,n){var r="function"==typeof e[t];return r===("function"==typeof e[n])?t<n?-1:t>n?1:0:r?1:-1}),l=0;l<c.length;l++){if(l>(t.maxNumberOfKeys||1/0)){var f=c.length-l;u.push("..."+f+" hidden "+(f>1?"entries":"entry")+"...");break}var h=c[l];o&&inspect(e[h],t,n+1);var p=inspect(e[h],t,n+1);u.push(t.escapeKeys?JSON.stringify(h):h+": "+p)}if(0===u.length)return a+s;var d=u.join(", "),y=(!o||t.newLineInArrays)&&(!t.minLengthForNewLine||d.length>=t.minLengthForNewLine),g=indent$1("",t.indent||"  ",n),v=indent$1("",t.indent||"  ",n+1),m=y&&!o?"\n"+v:"",b=y?"\n"+v:"",w=y&&!o?"\n"+g:"";return y&&(d=u.join(","+b)),a+m+d+w+s}function merge(e){return arguments.length>1?merge(Array.prototype.slice.call(arguments)):Array.isArray(e[0])?Array.prototype.concat.apply([],e):e.reduce(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},{})}function deepMerge(e,t){if(!e)return t;if(!t)return e;if(Array.isArray(e)){if(!Array.isArray(t))return t;var n=e.map(function(e,n){return deepMerge(e,t[n])});return t.length>e.length&&(n=n.concat(t.slice(e.length))),n}return"object"!==(void 0===e?"undefined":_typeof(e))||"object"!==(void 0===t?"undefined":_typeof(t))?t:Object.keys(e).concat(Object.keys(t)).reduce(function(n,r){return e[r]?t[r]?"object"!==_typeof(e[r])||"object"!==_typeof(t[r])?n[r]=t[r]:n[r]=deepMerge(e[r],t[r]):n[r]=e[r]:n[r]=t[r],n},{})}function sortKeysWithBeforeAndAfterConstraints(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=[],n=[],r=[];for(var i in e){var o=e[i],a=o.hasOwnProperty("before")?o.before:o.before=[],s=o.hasOwnProperty("after")?o.after:o.after=[];t.push(i),n.push(o);for(var u=a.length;u--;){var c=a[u],l=e[c];l?(l.hasOwnProperty("after")||(l.after=[]),l.after.push(i)):(console.warn("[initializeProperties] "+this+" sortProperties: Property "+i+" requires to be initialized before "+c+" but that property cannot be found."),a.splice(u,1))}for(var f=s.length;f--;){var h=s[f];e[h]||(console.warn("[initializeProperties] "+this+" sortProperties: Property "+i+" requires to be initialized after "+h+" but that property cannot be found."),s.splice(f,1))}r.push(i)}for(var p=[],d=[],y=r.length+1;r.length;){if(y===r.length)throw new Error("Circular dependencies in handler order, could not resolve properties "+r.map(function(t){var n=e[t].before,r=e[t].after;if(!(n&&n.length||r&&r.length))return"";var i=t+"\n";return n&&n.length&&(i+="  - before "+n.join(",")+"\n"),r&&r.length&&(i+="  - after "+r.join(",")+"\n"),i}).join(""));y=r.length;for(var g=[],v=r.length;v--;){var m=r[v];isSubset(e[m].after,d)&&(r.splice(v,1),d.push(m),g.push(m))}p.push(g)}return flatten(p,1)}function inherit(e){return Object.create(e)}function valuesInPropertyHierarchy(e,t){for(var n=[],r=e;r;)r.hasOwnProperty(t)&&n.unshift(r[t]),r=Object.getPrototypeOf(r);return n}function mergePropertyInHierarchy(e,t){return merge(valuesInPropertyHierarchy(e,t))}function deepCopy(e){if(!e||"object"!==(void 0===e?"undefined":_typeof(e))||e instanceof RegExp)return e;var t=Array.isArray(e)?Array(e.length):{};for(var n in e)e.hasOwnProperty(n)&&(t[n]=deepCopy(e[n]));return t}function typeStringOf(e){return null===e?"null":void 0===e?"undefined":e.constructor.name}function shortPrintStringOf(e){if(!isMutableType(e))return safeToString(e);if("Object"!==e.constructor.name&&!Array.isArray(e)&&e.constructor.name)return e.constructor.name?e.constructor.name:Object.prototype.toString.call(e).split(" ")[1].split("]")[0];var t="";function n(e,n,r,i){e.constructor.name===n&&(t+=r,(e.length||Object.keys(e).length)&&(t+="..."),t+=i)}return n(e,"Object","{","}"),n(e,"Array","[","]"),t}function isMutableType(e){return-1===["null","undefined","Boolean","Number","String"].indexOf(typeStringOf(e))}function safeToString(e){try{return(e?e.toString():String(e)).replace("\n","")}catch(e){return"<error printing object>"}}function asObject(e){switch(void 0===e?"undefined":_typeof(e)){case"string":return new String(e);case"boolean":return new Boolean(e);case"number":return new Number(e);default:return e}}function newKeyIn(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"_",r=1;do{t=n+"-"+r++}while(t in e);return t}var obj=Object.freeze({isArray:isArray$$1,isElement:isElement,isFunction:isFunction,isBoolean:isBoolean,isString:isString,isNumber:isNumber,isUndefined:isUndefined,isRegExp:isRegExp,isObject:isObject,isPrimitive:isPrimitive,isEmpty:isEmpty,equals:equals$1,keys:keys$1,values:values,select:select,dissoc:dissoc,addScript:addScript,extend:extend,clone:clone$$1,extract:extract,inspect:inspect,merge:merge,deepMerge:deepMerge,inherit:inherit,valuesInPropertyHierarchy:valuesInPropertyHierarchy,mergePropertyInHierarchy:mergePropertyInHierarchy,sortKeysWithBeforeAndAfterConstraints:sortKeysWithBeforeAndAfterConstraints,deepCopy:deepCopy,typeStringOf:typeStringOf,shortPrintStringOf:shortPrintStringOf,isMutableType:isMutableType,safeToString:safeToString,asObject:asObject,newKeyIn:newKeyIn}),features={repeat:!!String.prototype.repeat,includes:!!String.prototype.includes,startsWith:!!String.prototype.startsWith,endsWith:!!String.prototype.endsWith};function format(){return formatFromArray(Array.prototype.slice.call(arguments))}function formatFromArray(e){var t=e.shift();function n(e,t){return""+e}function r(e,t){return e.toString()}function i(e,t){return inspect(e)}t||console.log("Error in Strings>>formatFromArray, first arg is undefined");var o={s:n,d:r,i:r,f:function(e,t,n){return n>-1?e.toFixed(n):e.toString()},o:i},a=/((^%|[^\\]%)(\d+)?(\.)([a-zA-Z]))|((^%|[^\\]%)([a-zA-Z]))/;for(var s=function(e){for(var t=[],n=a.exec(e);n;n=a.exec(e)){var r=n[8]||n[5],s=r in o?o[r]:i,u=n[3]?parseInt(n[3]):"."==n[4]?-1:0;t.push(e.substr(0,"%"==n[0][0]?n.index:n.index+1)),t.push({appender:s,precision:u}),e=e.substr(n.index+n[0].length)}return e&&t.push(e.toString()),t}(t),u="",c=0,l=0;l<s.length;++l){var f=s[l];if(f&&"object"==(void 0===f?"undefined":_typeof(f))){var h=e[c++];u+=(f.appender||n)(h,u,f.precision)}else u+=n(f)}return u}function indent(e,t,n){if(!n||n<=0)return e;for(var r="";n>0;)n--,r+=t;return lines(e).map(function(e){return r+e}).join("\n")}function minIndent(e,t){t||(t="  ");var n=new RegExp("^("+t+")*","gm");return min(e.match(n).map(function(e){return Math.floor(e.length/t.length)}))}function changeIndent(e,t,n){t||(t="  "),n||(n=0);var r=minIndent(e,t);if(r===n)return e;if(r<n)return indent(e,t,n-r);var i=t.repeat(r-n);return lines(e).map(function(e){return e.slice(i.length)}).join("\n")}function quote(e){return'"'+e.replace(/"/g,'\\"')+'"'}function print(e){if(e&&Array.isArray(e))return"["+e.map(print)+"]";if("string"!=typeof e)return String(e);var t=String(e);return t='"'+(t=(t=t.replace(/\n/g,"\\n\\\n")).replace(/(")/g,"\\$1"))+'"'}function printNested(e,t){return t=t||0,e.reduce(function(e,n){return e+(Array.isArray(n)?printNested(n,t+1):indent(n+"\n","  ",t))},"")}function pad(e,t,n){return n?" ".repeat(t)+e:e+" ".repeat(t)}function printTable(e,t){var n=[],r=t&&t.separator||" ",i=!t||!t.align||"left"===t.align,o=t&&"right"===t.align;return e.forEach(function(e){e.forEach(function(e,t){void 0===n[t]&&(n[t]=0),n[t]=Math.max(n[t],String(e).length)})}),e.map(function(e){return e.map(function(e,r){var a,s=String(e);return pad(s,n[r]-s.length,(a=r,!i&&(!!o||t&&Array.isArray(t.align)&&"right"===t.align[a])))}).join(r)}).join("\n")}function printTree(e,t,n,r){var i=[];return r=r||"  ",function e(o,a,s){i[a]=r.repeat(o)+t(s,o);var u=n(s,o),c=a+1;if(!u||!u.length)return c;var l=c,f=u.length-1;u.forEach(function(t,n){c=e(o+1,c,t);for(var a=f===n,s=i[l].split(""),u=o*r.length+1,h=o*r.length+r.length,n=u;n<h;n++)s[n]="-";a&&(s[o*r.length]="\\"),i[l]=s.join(""),a||i.slice(l,c).forEach(function(e,t){var n=e.split("");n[o*r.length]="|",i[l+t]=n.join("")}),l=c});return c}(0,0,e),i.join("\n")}function toArray$1(e){return e.split("")}function lines(e){return e.split(/\n\r?/)}function paragraphs(e,t){var n=t?t.sep:"\n\n";if(!t||!t.keepEmptyLines)return e.split(new RegExp(n+"+"));function r(e){return/^\s*$/.test(e)}return e.split("\n").concat("").reduce(function(e,t){var n=e[0],i=e[1];return r(i)===r(t)?i+="\n"+t:(i.length&&n.push(i),i=t),[n,i]},[[],""])[0]}function nonEmptyLines(e){return lines(e).compact()}function tokens(e,t){return e.split(t||/\s+/).filter(function(e){return!/^\s*$/.test(e)})}function tableize(e,t){for(var n=(t=t||{}).cellSplitter||/\s+/,r=/^\s*$/,i=!t.hasOwnProperty("convertTypes")||!!t.convertTypes,o=lines(e),a=[],s=0;s<o.length;s++){var u=tokens(o[s],n);i&&(u=u.map(function(e){if(e.match(r))return e;var t=Number(e);if(!isNaN(t))return t;var n=new Date(e);return isNaN(+n)?e.trim():n})),u.length>0&&a.push(u)}return a}function unescapeCharacterEntities(e){if("undefined"==typeof document)throw new Error("Cannot unescapeCharacterEntities");var t=document.createElement("div");return t.innerHTML=e,t.textContent}function toQueryParams(e,t){var n=e.trim().match(/([^?#]*)(#.*)?$/);return n?n[1].split(t||"&").inject({},function(e,t){if((t=t.split("="))[0]){var n=decodeURIComponent(t.shift()),r=t.length>1?t.join("="):t[0];void 0!=r&&(r=decodeURIComponent(r)),n in e?(Array.isArray(e[n])||(e[n]=[e[n]]),e[n].push(r)):e[n]=r}return e}):{}}var pathDotRe=/\/\.\//g,pathDoubleDotRe=/\/[^\/]+\/\.\./,pathDoubleSlashRe=/(^|[^:])[\/]+/g,urlStartRe=/^[a-z0-9-_\.]+:\/\//;function normalizePath$1(e){var t=e.match(urlStartRe),n=t?t[0]:null,r=n?e.slice(n.length):e;do{r=(e=r).replace(pathDoubleDotRe,"")}while(r!=e);return r=(r=r.replace(pathDoubleSlashRe,"$1/")).replace(pathDotRe,"/"),n&&(r=n+r),r}function joinPath(){return normalizePath$1(Array.prototype.slice.call(arguments).reduce(function(e,t){return"string"==typeof t?e.replace(/\/*$/,"")+"/"+t.replace(/^\/*/,""):e}))}var newUUIDTemplate="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",newUUIDRe=/[xy]/g,newUUIDReplacer=function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)};function newUUID(){return newUUIDTemplate.replace(newUUIDRe,newUUIDReplacer).toUpperCase()}function createDataURI(e,t){return"data:"+(t=t||"text/plain")+";base64,"+btoa(e)}function hashCode(e){var t=0,n=e.length;if(0==n)return t;for(var r=0;r<n;r++){t=(t<<5)-t+e.charCodeAt(r),t&=t}return t}function md5(e){var t=function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n};function n(e,n,r,i,o,a){return n=t(t(n,e),t(i,a)),t(n<<o|n>>>32-o,r)}function r(e,t,r,i,o,a,s){return n(t&r|~t&i,e,t,o,a,s)}function i(e,t,r,i,o,a,s){return n(t&i|r&~i,e,t,o,a,s)}function o(e,t,r,i,o,a,s){return n(t^r^i,e,t,o,a,s)}function a(e,t,r,i,o,a,s){return n(r^(t|~i),e,t,o,a,s)}function s(e,n){var s=e[0],u=e[1],c=e[2],l=e[3];u=a(u=a(u=a(u=a(u=o(u=o(u=o(u=o(u=i(u=i(u=i(u=i(u=r(u=r(u=r(u=r(u,c=r(c,l=r(l,s=r(s,u,c,l,n[0],7,-680876936),u,c,n[1],12,-389564586),s,u,n[2],17,606105819),l,s,n[3],22,-1044525330),c=r(c,l=r(l,s=r(s,u,c,l,n[4],7,-176418897),u,c,n[5],12,1200080426),s,u,n[6],17,-1473231341),l,s,n[7],22,-45705983),c=r(c,l=r(l,s=r(s,u,c,l,n[8],7,1770035416),u,c,n[9],12,-1958414417),s,u,n[10],17,-42063),l,s,n[11],22,-1990404162),c=r(c,l=r(l,s=r(s,u,c,l,n[12],7,1804603682),u,c,n[13],12,-40341101),s,u,n[14],17,-1502002290),l,s,n[15],22,1236535329),c=i(c,l=i(l,s=i(s,u,c,l,n[1],5,-165796510),u,c,n[6],9,-1069501632),s,u,n[11],14,643717713),l,s,n[0],20,-373897302),c=i(c,l=i(l,s=i(s,u,c,l,n[5],5,-701558691),u,c,n[10],9,38016083),s,u,n[15],14,-660478335),l,s,n[4],20,-405537848),c=i(c,l=i(l,s=i(s,u,c,l,n[9],5,568446438),u,c,n[14],9,-1019803690),s,u,n[3],14,-187363961),l,s,n[8],20,1163531501),c=i(c,l=i(l,s=i(s,u,c,l,n[13],5,-1444681467),u,c,n[2],9,-51403784),s,u,n[7],14,1735328473),l,s,n[12],20,-1926607734),c=o(c,l=o(l,s=o(s,u,c,l,n[5],4,-378558),u,c,n[8],11,-2022574463),s,u,n[11],16,1839030562),l,s,n[14],23,-35309556),c=o(c,l=o(l,s=o(s,u,c,l,n[1],4,-1530992060),u,c,n[4],11,1272893353),s,u,n[7],16,-155497632),l,s,n[10],23,-1094730640),c=o(c,l=o(l,s=o(s,u,c,l,n[13],4,681279174),u,c,n[0],11,-358537222),s,u,n[3],16,-722521979),l,s,n[6],23,76029189),c=o(c,l=o(l,s=o(s,u,c,l,n[9],4,-640364487),u,c,n[12],11,-421815835),s,u,n[15],16,530742520),l,s,n[2],23,-995338651),c=a(c,l=a(l,s=a(s,u,c,l,n[0],6,-198630844),u,c,n[7],10,1126891415),s,u,n[14],15,-1416354905),l,s,n[5],21,-57434055),c=a(c,l=a(l,s=a(s,u,c,l,n[12],6,1700485571),u,c,n[3],10,-1894986606),s,u,n[10],15,-1051523),l,s,n[1],21,-2054922799),c=a(c,l=a(l,s=a(s,u,c,l,n[8],6,1873313359),u,c,n[15],10,-30611744),s,u,n[6],15,-1560198380),l,s,n[13],21,1309151649),c=a(c,l=a(l,s=a(s,u,c,l,n[4],6,-145523070),u,c,n[11],10,-1120210379),s,u,n[2],15,718787259),l,s,n[9],21,-343485551),e[0]=t(s,e[0]),e[1]=t(u,e[1]),e[2]=t(c,e[2]),e[3]=t(l,e[3])}function u(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}var c="0123456789abcdef".split("");function l(e){for(var t="",n=0;n<4;n++)t+=c[e>>8*n+4&15]+c[e>>8*n&15];return t}return function(e){for(var t=e.length,n=0;n<t;n++)e[n]=l(e[n]);return e.join("")}(function(e){var t,n=e.length,r=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=n;t+=64)s(r,u(e.substring(t-64,t)));var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=(e=e.substring(t-64)).length;for(t=0;t<o;t++)i[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(s(r,i),t=16;t--;)i[t]=0;return i[14]=8*n,s(r,i),r}(e))}function reMatches$$1(e,t){var n=[];return e.replace(t,function(e,t){n.push({match:e,start:t,end:t+e.length})}),n}function stringMatch(e,t,n){return(n=n||{}).normalizeWhiteSpace&&(e=e.replace(/\s+/g," ")),n.ignoreIndent&&(e=e.replace(/^\s+/gm,""),t=t.replace(/^\s+/gm,"")),e==t?{matched:!0}:function(e,t){var n=function(e){var t=reMatches$$1(e,/__\//g),n=reMatches$$1(e,/\/__/g);if(t.length!==n.length)throw new Error("pattern invalid: "+e+" cannot be split into __/.../__ embedded RegExps\nstarts: "+JSON.stringify(t)+"\nvs ends:\n"+JSON.stringify(n));var r=0;return t.reduce(function(e,t,i){var o=n[i],a=e.pop(),s=function(e,t,n,r,i){return r=r||0,i=i||0,[e.slice(0,t),e.slice(t+r,n-i),e.slice(n)]}(a,t.start-r,o.end-r,3,3);s[0].length&&(e.push(s[0]),r+=s[0].length);try{s[1].length&&(e.push(new RegExp(s[1])),r+=s[1].length+3+3)}catch(e){throw new Error("Cannot create pattern re from: "+inspect(s))}return s[2].length&&e.push(s[2]),e},[e])}(t),i=function(e,t){for(var n=0,i=0;i<t.length;i++){var o=t[i],a=r(e,o);if(!a.match)return{matched:!1,pos:n+(a.pos||0),pattern:o};n+=a.match.length,e=a.rest}return e.length?{matched:!1,pos:n}:{matched:!0}}(e,n);return i.matched?i:(i.error=e.slice(0,i.pos)+"<--UNMATCHED--\x3e"+e.slice(i.pos),i)}(e,t);function r(e,t){if(t.constructor!==RegExp){if(0===e.indexOf(t))return{match:t,rest:e.slice(t.length)};for(var n=0;n<t.length;n++)if(t[n]!=e[n])return{match:null,pos:n};return{match:null}}var r=reMatches$$1(e,t);return r&&r.length&&0===r[0].start?{match:r[0].match,rest:e.slice(r[0].end)}:{match:null}}}function peekRight(e,t,n){if(e=e.slice(t),"string"==typeof n){var r=e.indexOf(n);return-1===r?null:r+t}if(n.constructor===RegExp){var i=reMatches$$1(e,n);return i[0]?i[0].start:null}return null}function peekLeft(e,t,n){if(e=e.slice(0,t),"string"==typeof n){var r=e.lastIndexOf(n);return-1===r?null:r}if(n.constructor===RegExp){var i=reMatches$$1(e,n);return last(i)?last(i).start:null}return null}function lineIndexComputer(e){var t=lineRanges(e);return function(e){for(var n=0;n<t.length;n++){var r=t[n];if(e>=r[0]&&e<r[1])return n}return-1}}function lineNumberToIndexesComputer(e){return function(t){return lineRanges(e)[t]}}function lineRanges(e){for(var t=0,n=0,r=lines(e),i=[],o=0;o<r.length;o++){n=t+r[o].length+1,i.push([t,n]),t=n}return i}function findLineWithIndexInLineRanges(e,t){var n=e.length;if(0===n)return-1;for(var r=0,i=n;;){var o=r+Math.floor((i-r)/2),a=slicedToArray(e[o],2),s=a[0],u=a[1];if(t<s){if(0===o)return-1;i=o}else{if(!(t>u))return o;r=o}}return-1}function regexIndexOf(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.substring(n||0).search(t);return r>=0?r+(n||0):r}function regexLastIndexOf(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length;t=t.global?t:new RegExp(t.source,"g"+(t.ignoreCase?"i":"")+(t.multiLine?"m":""));for(var r,i=this.substring(0,n+1),o=-1,a=0;null!=(r=t.exec(i));)o=r.index,t.lastIndex=++a;return o}function diff(e,t){return"undefined"==typeof JsDiff?"diff not supported":JsDiff.convertChangesToXML(JsDiff.diffWordsWithSpace(e,t))}function empty(e){return""==e}var includes$$1=features.includes?function(e,t){return e.includes(t)}:function(e,t){return e.indexOf(t)>-1},include$$1=includes$$1,startsWith=features.startsWith?function(e,t){return e.startsWith(t)}:function(e,t){return 0===e.indexOf(t)};function startsWithVowel(e){var t=e[0];return"A"===t||"E"===t||"I"===t||"O"===t||"U"===t||"a"===t||"e"===t||"i"===t||"o"===t||"u"===t||!1}var endsWith=features.endsWith?function(e,t){return e.endsWith(t)}:function(e,t){var n=e.length-t.length;return n>=0&&e.lastIndexOf(t)===n};function withDecimalPrecision(e,t){var n=parseFloat(e);return isNaN(n)?e:n.toFixed(t)}function capitalize(e){return e.length?e.charAt(0).toUpperCase()+e.slice(1):e}function camelCaseString(e){return e.split(" ").map(capitalize).join("")}function camelize(e){var t=e.split("-"),n=t.length;if(1==n)return t[0];for(var r="-"==e.charAt(0)?t[0].charAt(0).toUpperCase()+t[0].substring(1):t[0],i=1;i<n;i++)r+=t[i].charAt(0).toUpperCase()+t[i].substring(1);return r}function truncate(e,t,n){return t=t||30,n=void 0===n?"...":n,e.length>t?e.slice(0,t-n.length)+n:String(e)}function truncateLeft(e,t,n){return t=t||30,n=void 0===n?"...":n,e.length>t?n+e.slice(-t):String(e)}function regExpEscape(e){return e.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")}function succ(e){return e.slice(0,e.length-1)+String.fromCharCode(e.charCodeAt(e.length-1)+1)}function digitValue(e){return e.charCodeAt(0)-"0".charCodeAt(0)}var times=features.repeat?function(e,t){return e.repeat(t)}:function(e,t){return t<1?"":new Array(t+1).join(e)};function longestCommonSubstring(e,t){for(var n=[],r=0;r<e.length;r++){n[r]=[];for(var i=0;i<t.length;i++)n[r][i]=0}for(var o=0;o<e.length;o++)n[o][0]=0;for(var a=1;a<e.length;a++)for(var s=1;s<t.length;s++)n[a][s]=e[a-1]==t[s-1]?n[a-1][s-1]+1:0;for(var u=-1,c=-1,l=-1,f=0;f<e.length;f++)for(var h=0;h<t.length;h++){var p=n[f][h];u<p&&(u=p,c=f-p,l=h-p)}return{length:u,indexA:c,indexB:l,string:u>0?e.slice(c,c+u):""}}function applyChange(e,t){return"insert"===t.action?e.slice(0,t.start)+t.lines.join("\n")+e.slice(t.start):"remove"===t.action?e.slice(0,t.start)+e.slice(t.end):e}function applyChanges(e,t){return t.reduce(function(t,n){return applyChange(e,n)},e)}function levenshtein(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;var n,r,i,o,a,s;for(e.length>t.length&&(n=e,e=t,t=n),s=Array(e.length+1),r=0;r<=e.length;r++)s[r]=r;for(r=1;r<=t.length;r++){for(o=r,i=1;i<=e.length;i++)a=t[r-1]===e[i-1]?s[i-1]:Math.min(s[i-1]+1,Math.min(o+1,s[i]+1)),s[i-1]=o,o=a;s[e.length]=o}return s[e.length]}var string=Object.freeze({format:format,formatFromArray:formatFromArray,indent:indent,minIndent:minIndent,changeIndent:changeIndent,quote:quote,print:print,printNested:printNested,pad:pad,printTable:printTable,printTree:printTree,toArray:toArray$1,lines:lines,paragraphs:paragraphs,nonEmptyLines:nonEmptyLines,tokens:tokens,tableize:tableize,unescapeCharacterEntities:unescapeCharacterEntities,toQueryParams:toQueryParams,normalizePath:normalizePath$1,joinPath:joinPath,newUUID:newUUID,createDataURI:createDataURI,hashCode:hashCode,md5:md5,reMatches:reMatches$$1,stringMatch:stringMatch,peekRight:peekRight,peekLeft:peekLeft,lineIndexComputer:lineIndexComputer,lineNumberToIndexesComputer:lineNumberToIndexesComputer,findLineWithIndexInLineRanges:findLineWithIndexInLineRanges,regexIndexOf:regexIndexOf,regexLastIndexOf:regexLastIndexOf,lineRanges:lineRanges,diff:diff,empty:empty,includes:includes$$1,include:include$$1,startsWith:startsWith,startsWithVowel:startsWithVowel,endsWith:endsWith,withDecimalPrecision:withDecimalPrecision,capitalize:capitalize,camelCaseString:camelCaseString,camelize:camelize,truncate:truncate,truncateLeft:truncateLeft,regExpEscape:regExpEscape,succ:succ,digitValue:digitValue,times:times,longestCommonSubstring:longestCommonSubstring,applyChange:applyChange,applyChanges:applyChanges,levenshtein:levenshtein});function random(e,t){return e=e||0,t=t||100,Math.round(Math.random()*(t-e)+e)}var normalRandom=(isSpareReady=!1,function(e,t){if(isSpareReady)return isSpareReady=!1,spare*t+e;var n,r,i;do{i=(n=2*Math.random()-1)*n+(r=2*Math.random()-1)*r}while(i>=1||0==i);var o=Math.sqrt(-2*Math.log(i)/i);return spare=r*o,isSpareReady=!0,e+t*n*o}),spare,isSpareReady;function randomSmallerInteger(e){return Math.floor(Math.random()*e)}function humanReadableByteSize(e){function t(e){return Math.round(100*e)/100}return e<1e3?String(t(e))+"B":(e/=1024)<1e3?String(t(e))+"KB":(e/=1024,String(t(e))+"MB")}function average(e){return e.reduce(function(e,t){return e+t},0)/e.length}function averageInc(e,t,n){return(e-t)/n+t}function median(e){var t=e.sort(function(e,t){return t-e}),n=e.length;return n%2==0?.5*(t[n/2-1]+t[n/2]):t[(n-1)/2]}function between(e,t,n,r){var i,o;return r=r||0,t<n?(i=t,o=n):(o=t,i=n),o-e+r>=0&&i-e-r<=0}function sort$1(e){return e.sort(function(e,t){return e-t})}function parseLength(e,t){t=t||"px";var n=e.match(/([0-9\.]+)\s*(.*)/);if(n&&n[1]){var r=parseFloat(n[1]),i=n[2];return convertLength(r,i,t)}}var convertLength=function(){function e(t,n){return"cm"===n?t:"mm"===n?.1*t:"in"===n?2.54*t:"px"===n?t*e(1/96,"in"):"pt"===n?t*e(1/72,"in"):"pc"===n?t*e(12,"pt"):void 0}return function t(n,r,i){return r===i?n:"cm"===i?e(n,r):"cm"===r?n/e(1,i):t(t(n,r,"cm"),"cm",i)}}();function roundTo(e,t){return t=1/t,Math.round(e*t)/t}function detent(e,t,n,r){var i=roundTo(e,n);return Math.abs(e-i)<t/2?i:r?e:i+(e-(e<i?i-t/2:i+t/2))*n/(n-t)}function toDegrees(e){return 180*e/Math.PI%360}function toRadians(e){return e/180*Math.PI}function backoff(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4,r=Math.min(n,t*Math.pow(2,e)),i=r/2+Math.round(Math.random()*(r/2));return Math.min(n,t+Math.random()*(3*i-t))}var num=Object.freeze({random:random,normalRandom:normalRandom,randomSmallerInteger:randomSmallerInteger,humanReadableByteSize:humanReadableByteSize,average:average,averageInc:averageInc,median:median,between:between,sort:sort$1,parseLength:parseLength,convertLength:convertLength,roundTo:roundTo,detent:detent,toDegrees:toDegrees,toRadians:toRadians,backoff:backoff});function all$2(e,t){var n=[];for(var r in e)!e.__lookupGetter__(r)&&"function"==typeof e[r]||t&&!t(r,e)||n.push(r);return n}function allOwnPropertiesOrFunctions(e,t){return Object.getOwnPropertyNames(e).reduce(function(n,r){return t&&!t(e,r)||n.push(r),n},[])}function own$1(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&(e.__lookupGetter__(n)||"function"!==e[n])&&t.push(n);return t}function forEachOwn(e,t,n){var r=[];for(var i in e)if(e.hasOwnProperty(i)){var o=e[i];"function"!==o&&r.push(t.call(n||this,i,o))}return r}function nameFor(e,t){for(var n in e)if(e[n]===t)return n}function values$1(e){var t=[];for(var n in e)t.push(e[n]);return t}function ownValues(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}function any$1(e,t){for(var n in e)if(t(e,n))return!0;return!1}function allProperties(e,t){var n=[];for(var r in e)t&&!t(e,r)||n.push(r);return n}function hash(e){return Object.keys(e).sort().join("").hashCode()}var properties=Object.freeze({all:all$2,allOwnPropertiesOrFunctions:allOwnPropertiesOrFunctions,own:own$1,forEachOwn:forEachOwn,nameFor:nameFor,values:values$1,ownValues:ownValues,any:any$1,allProperties:allProperties,hash:hash}),dateFormat=function(){var e,t,n,r,i=(e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,t=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,r=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e},function(o,a,s){var u=i;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(o)||/\d/.test(o)||(a=o,o=void 0),o=o?new Date(o):new Date,isNaN(o))throw SyntaxError("invalid date");"UTC:"==(a=String(u.masks[a]||a||u.masks.default)).slice(0,4)&&(a=a.slice(4),s=!0);var c=s?"getUTC":"get",l=o[c+"Date"](),f=o[c+"Day"](),h=o[c+"Month"](),p=o[c+"FullYear"](),d=o[c+"Hours"](),y=o[c+"Minutes"](),g=o[c+"Seconds"](),v=o[c+"Milliseconds"](),m=s?0:o.getTimezoneOffset(),b={d:l,dd:r(l),ddd:u.i18n.dayNames[f],dddd:u.i18n.dayNames[f+7],m:h+1,mm:r(h+1),mmm:u.i18n.monthNames[h],mmmm:u.i18n.monthNames[h+12],yy:String(p).slice(2),yyyy:p,h:d%12||12,hh:r(d%12||12),H:d,HH:r(d),M:y,MM:r(y),s:g,ss:r(g),l:r(v,3),L:r(v>99?Math.round(v/10):v),t:d<12?"a":"p",tt:d<12?"am":"pm",T:d<12?"A":"P",TT:d<12?"AM":"PM",Z:s?"UTC":(String(o).match(t)||[""]).pop().replace(n,""),o:(m>0?"-":"+")+r(100*Math.floor(Math.abs(m)/60)+Math.abs(m)%60,4),S:["th","st","nd","rd"][l%10>3?0:(l%100-l%10!=10)*l%10]};return a.replace(e,function(e){return e in b?b[e]:e.slice(1,e.length-1)})});return i.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},i.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},i}();function format$1(e,t,n){return dateFormat(e,t,n)}function equals$3(e,t){return t&&t instanceof Date&&t.getTime()===e.getTime()}function relativeTo(e,t){if(!(t instanceof Date))return"";if(t<e)return"";if(t===e)return"now";var n="min",r="sec",i="hour",o="day",a=t-e,s=Math.round(a/1e3),u=s%60,c=Math.floor(s/60)%60,l=Math.floor(s/60/60)%24,f=Math.floor(s/60/60/24),h=[];return f>0&&(h.push(f),f>1&&(o+="s"),h.push(o)),l>0&&f<2&&(h.push(l),l>1&&(i+="s"),h.push(i)),c>0&&l<3&&0===f&&(h.push(c),c>1&&(n+="s"),h.push(n)),u>0&&c<3&&0===l&&0===f&&(h.push(u),u>1&&(r+="s"),h.push(r)),h.join(" ")}var date=Object.freeze({format:format$1,equals:equals$3,relativeTo:relativeTo});function promise(e){return"function"==typeof e?promise.convertCallbackFun(e):Promise.resolve(e)}function delay$1(e,t){return new Promise(function(n){return setTimeout(n,e,t)})}function delayReject(e,t){return new Promise(function(n,r){return setTimeout(r,e,t)})}function timeout(e,t){return new Promise(function(n,r){var i=!1;setTimeout(function(){return!i&&(i=!0)&&r(new Error("Promise timed out"))},e),t.then(function(e){return!i&&(i=!0)&&n(e)},function(e){return!i&&(i=!0)&&r(e)})})}function waitFor$1(e,t,n){return"function"==typeof e&&(t=e,e=void 0),new Promise(function(r,i){var o=!1,a=!1,s=void 0,u=void 0,c=setInterval(function(){if(o)return clearInterval(c);try{u=t()}catch(e){s=e}return u||s||a?(o=!0,clearInterval(c),s?i(s):a?void 0===n?i(new Error("timeout")):r(n):r(u)):void 0},10);"number"==typeof e&&setTimeout(function(){return a=!0},e)})}function deferred(){var e,t,n=new Promise(function(n,r){e=n,t=r});return{resolve:e,reject:t,promise:n}}function convertCallbackFun(e){return function(){var t=Array.from(arguments),n=this;return new Promise(function(r,i){t.push(function(e,t){return e?i(e):r(t)}),e.apply(n,t)})}}function convertCallbackFunWithManyArgs(e){return function(){var t=Array.from(arguments),n=this;return new Promise(function(r,i){t.push(function(){var e=Array.from(arguments),t=e.shift();return t?i(t):r(e)}),e.apply(n,t)})}}function _chainResolveNext(e,t,n,r,i){var o=e.shift();if(o)try{Promise.resolve(o(t,n)).then(function(t){return _chainResolveNext(e,t,n,r,i)}).catch(function(e){i(e)})}catch(e){i(e)}else r(t)}function chain$1(e){return new Promise(function(t,n){return _chainResolveNext(e.slice(),void 0,{},t,n)})}function promise_finally(e,t){return Promise.resolve(e).then(function(e){try{t()}catch(e){console.error("Error in promise finally: "+e.stack||e)}return e}).catch(function(e){try{t()}catch(e){console.error("Error in promise finally: "+e.stack||e)}throw e})}function parallel(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;if(!e.length)return Promise.resolve([]);var n=[],r=null,i=0,o=e.length,a=void 0,s=void 0;return new Promise(function(e,t){a=function(){return e(n)},s=function(e){return t(r=e)},c()});function u(){t--;try{r=i++,e[r]().then(function(e){t++,n[r]=e,0==--o?a():c()}).catch(function(e){return s(e)})}catch(e){s(e)}var r}function c(){for(;!r&&o>0&&i<e.length&&t>0;)u()}}function Path(e,t){return e instanceof Path?e:this instanceof Path?(this.setSplitter(t||"."),void this.fromPath(e)):new Path(e,t)}function clone$2(e){var t={};for(var n in e)t[n]=e[n].slice();return t}function without$1(e,t){var n={};for(var r in e)if(!t.includes(r)){n[r]=[];for(var i=e[r],o=0;o<i.length;o++){var a=i[o];t.includes(a)||n[r].push(a)}}return n}function hull(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;if(!Array.isArray(e[t]))return[];for(var i=[],o={},a={},s=0;s<n.length;s++)a[n[s]]=!0;for(var u=e[t].slice(),c={},l=u.length;l--;){var f=u[l];f in a?u.splice(l,1):c[f]=1}if(n)for(;0!==u.length;)for(var h=0;h<u.length;h++){var p=u.shift();if(!(p in o||p in a)){var d=c[p]||0;if(!(d>r)){i.push(p),o[p]=!0;var y=e[p];if(y)for(var g=0;g<y.length;g++){var v=y[g];v in o||v in c||(c[v]=d+1,u.push(v))}}}}return i}function subgraphReachableBy(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;n&&(e=without$1(e,n));for(var i=[t],o=0,a={};i.length&&o++<r;){var s=i.shift();if(!a[s]){var u=e[s]||[];a[s]=u,i.push.apply(i,toConsumableArray(u))}}return a}function invert(e){var t={};for(var n in e)for(var r=e[n],i=0;i<r.length;i++){var o=r[i];t[o]?t[o].push(n):t[o]=[n]}return t}function sortByReference(e,t){var n=[],r={},i={},o={};for(var a in e){r.hasOwnProperty(a)||(r[a]=!0,n.push(a));var s=e[a],u={};if(s){i[a]=[];var c=!0,l=!1,f=void 0;try{for(var h,p=s[Symbol.iterator]();!(c=(h=p.next()).done);c=!0){var d=h.value;if(!u.hasOwnProperty(d)&&a!==d){var y=o[d]||(o[d]=[]);y.includes(a)||y.push(a),u[d]=!0,i[a].push(d),r.hasOwnProperty(d)||(r[d]=!0,n.push(d))}}}catch(e){l=!0,f=e}finally{try{!c&&p.return&&p.return()}finally{if(l)throw f}}}}for(var g=[];n.length;){for(var v=1/0,m=[],b=[],w=[],k=0;k<n.length;k++){var x,_=i[C=n[k]]||[];if(!(_.length>v))if(_.length!==v||_.some(function(e){return m.includes(e)}))v=_.length,m=[C],b=[k],w=(o[C]||[]).slice();else m.push(C),b.push(k),(x=w).push.apply(x,toConsumableArray(o[C]||[]))}for(k=b.length;k--;){o[C=n[b[k]]]=[],n.splice(b[k],1)}var A=!0,S=!1,F=void 0;try{for(var E,O=w[Symbol.iterator]();!(A=(E=O.next()).done);A=!0){var C;i[C=E.value]=i[C].filter(function(e){return!m.includes(e)})}}catch(e){S=!0,F=e}finally{try{!A&&O.return&&O.return()}finally{if(S)throw F}}g.push(m)}return g}function reduce$1(e,t,n,r,i,o){var a=i||[],s=0;return function n(i){if(a.indexOf(i)>-1)return;r=e.call(o,r,i,s++);a=a.concat([i]);var u=withoutAll(t[i]||[],a);u.forEach(function(e){return n(e)})}(n),r}function random$1(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t={},n=range(1,e).map(String),r=0;r<n.length;r++){var i=Math.floor(Math.random()*e);t[n[r]]=shuffle(n).slice(0,i)}return t}Object.assign(promise,{delay:delay$1,delayReject:delayReject,timeout:timeout,waitFor:waitFor$1,deferred:deferred,convertCallbackFun:convertCallbackFun,convertCallbackFunWithManyArgs:convertCallbackFunWithManyArgs,chain:chain$1,finally:promise_finally,parallel:parallel}),Object.assign(Path.prototype,{get isPathAccessor(){return!0},fromPath:function(e){return"string"==typeof e&&""!==e&&e!==this.splitter?(this._parts=e.split(this.splitter),this._path=e):Array.isArray(e)?(this._parts=[].concat(e),this._path=e.join(this.splitter)):(this._parts=[],this._path=""),this},setSplitter:function(e){return e&&(this.splitter=e),this},parts:function(){return this._parts},size:function(){return this._parts.length},slice:function(e,t){return Path(this.parts().slice(e,t))},normalizePath:function(){return this._path},isRoot:function(e){return 0===this._parts.length},isIn:function(e){if(this.isRoot())return!0;var t=this.get(e,-1);return t&&t.hasOwnProperty(this._parts[this._parts.length-1])},equals:function(e){return e&&e.isPathAccessor&&this.parts().equals(e.parts())},isParentPathOf:function(e){e=e&&e.isPathAccessor?e:Path(e);for(var t=this.parts(),n=e.parts(),r=0;r<t.length;r++)if(t[r]!=n[r])return!1;return!0},relativePathTo:function(e){return e=Path(e),this.isParentPathOf(e)?e.slice(this.size(),e.size()):void 0},del:function(e){if(this.isRoot())return!1;for(var t=e,n=0;n<this._parts.length-1;n++){var r=this._parts[n];if(!t.hasOwnProperty(r))return!1;t=t[r]}return delete t[this._parts[this._parts.length-1]]},withParentAndKeyDo:function(e,t,n){if(this.isRoot())return n(null,null);for(var r=e,i=0;i<this._parts.length-1;i++){var o=this._parts[i];if(!r.hasOwnProperty(o)||"object"!==_typeof(r[o])&&"function"!=typeof r[o]){if(!t)return n(null,o);r=r[o]={}}else r=r[o]}return n(r,this._parts[this._parts.length-1])},set:function(e,t,n){return this.withParentAndKeyDo(e,n,function(e,n){return e?e[n]=t:void 0})},defineProperty:function(e,t,n){return this.withParentAndKeyDo(e,n,function(e,n){return e?Object.defineProperty(e,n,t):void 0})},get:function(e,t){return(t?this._parts.slice(0,t):this._parts).reduce(function(e,t){return e?e[t]:e},e)},concat:function(e,t){return Path(this.parts().concat(Path(e,t).parts()))},toString:function(){return this.normalizePath()},serializeExpr:function(){return"lively.lang.Path("+inspect(this.parts())+")"},watch:function(e){if(e&&!this.isRoot()){var t=e.target,n=this.get(t,-1),r=this.parts().slice(-1)[0],i="propertyWatcher$"+r,o=n&&n.hasOwnProperty(i),a=e.uninstall,s=(e.haltWhenChanged,e.showStack),u=n.__lookupGetter__(r),c=n.__lookupSetter__(r);if(t&&r&&n)if(a){if(!o)return;delete n[r],n[r]=n[i],delete n[i];var l="Watcher for "+n+"."+r+" uninstalled";show(l)}else if(o){l="Watcher for "+n+"."+r+" already installed";show(l)}else{if(u||c){l=n+'["'+r+'"] is a getter/setter, watching not support';return console.log(l),void("undefined"==typeof show&&show(l))}n[i]=n[r],n.__defineSetter__(r,function(t){var o=n[i];e.onSet&&e.onSet(t,o);var a=n+"."+r+" changed: "+o+" -> "+t;return s&&(a+="\n"+("undefined"!=typeof lively?lively.printStack():console.trace())),e.verbose&&(console.log(a),"undefined"!=typeof show&&show(a)),n[i]=t}),n.__defineGetter__(r,function(){return e.onGet&&e.onGet(n[i]),n[i]});l="Watcher for "+n+"."+r+" installed";console.log(l),"undefined"!=typeof show&&show(l)}}},debugFunctionWrapper:function(e){var t=e.target,n=this.get(t,-1),r=this.parts().slice(-1)[0],i=e.uninstall,o=(void 0===e.haltWhenChanged||e.haltWhenChanged,e.showStack),a=n&&r&&n[r],s=a&&a.isDebugFunctionWrapper;if(t&&r&&a&&n){if(i){if(!s)return;n[r]=n[r].debugTargetFunction;var u="Uninstalled debugFunctionWrapper for "+n+"."+r;return console.log(u),"undefined"!=typeof show&&show(u),void show(u)}if(s){u="debugFunctionWrapper for "+n+"."+r+" already installed";return console.log(u),void("undefined"!=typeof show&&show(u))}var c=n[r]=a.wrap(function(t){var i=Array.from(arguments);return o&&show(lively.printStack()),e.verbose&&show(r+" called"),i.shift().apply(n,i)});c.isDebugFunctionWrapper=!0,c.debugTargetFunction=a;u="debugFunctionWrapper for "+n+"."+r+" installed";console.log(u),"undefined"!=typeof show&&show(u)}}});var graph=Object.freeze({clone:clone$2,without:without$1,hull:hull,subgraphReachableBy:subgraphReachableBy,invert:invert,sortByReference:sortByReference,reduce:reduce$1,random:random$1}),GLOBAL$2="undefined"!=typeof System?System.global:"undefined"!=typeof window?window:global;function isInterval(e){return Array.isArray(e)&&e.length>=2&&e[0]<=e[1]}function sort$2(e){return e.sort(compare)}function compare(e,t){return e[0]<t[0]?e[1]<t[0]?-3:e[1]===t[0]?-2:-1:e[0]===t[0]?e[1]===t[1]?0:e[1]<t[1]?-1:1:-1*compare(t,e)}function coalesce(e,t,n){switch(this.compare(e,t)){case-3:case 3:return null;case 0:return n&&n(e,t,e),e;case 2:case 1:var r=e;e=t,t=r;case-2:case-1:var i=[e[0],Math.max(e[1],t[1])];return n&&n(e,t,i),i;default:throw new Error("Interval compare failed")}}function coalesceOverlapping(e,t){for(var n=[],r=e.length;r>0;){var i=e.shift();r--;for(var o=0;o<r;o++){var a=coalesce(i,e[o],t);a&&(i=a,e.splice(o,1),r--,o--)}n.push(i)}return this.sort(n)}function mergeOverlapping(e,t,n){for(var r=[];e.length>0;){var i=e.shift(),o=t.map(function(e){var t=compare(i,e);return-1===t||0===t||1===t});r.push(n(i,o[0])),r.push(i)}return r}function intervalsInRangeDo(e,t,n,r,i,o){o=o||GLOBAL$2,n=this.sort(n);for(var a,s=[];a=n.shift();)if(!(a[1]<e)){a[0]<e&&((a=Array.prototype.slice.call(a))[0]=e);var u,c=t<a[0]?t:a[0];if(e<c&&s.push(r.call(o,[e,c],!0)),t<a[1]&&((a=Array.prototype.slice.call(a))[1]=t),a[0]===a[1])i&&(u=s.slice(-1)[0])&&i.call(o,u,a,u);else s.push(r.call(o,a,!1));if((e=a[1])>=t)break}return e<t&&s.push(r.call(o,[e,t],!0)),s}function intervalsInbetween(e,t,n){return intervalsInRangeDo(e,t,coalesceOverlapping(Array.prototype.slice.call(n)),function(e,t){return t?e:null}).filter(Boolean)}function mapToMatchingIndexes(e,t){var n,r,i=0;return t.map(function(t){for(;(r=e[i])&&r[0]<t[0];)i++;if(r&&r[0]===t[0]){for(n=i;(r=e[n])&&r[1]<t[1];)n++;if(r&&r[1]===t[1])return range(i,n)}return[]})}var interval=Object.freeze({isInterval:isInterval,sort:sort$2,compare:compare,coalesce:coalesce,coalesceOverlapping:coalesceOverlapping,mergeOverlapping:mergeOverlapping,intervalsInRangeDo:intervalsInRangeDo,intervalsInbetween:intervalsInbetween,mapToMatchingIndexes:mapToMatchingIndexes});function create(e,t,n){var r=n||0;return r+t>e.length&&(r-=r+t-e.length),{array:e,from:r,to:r+t}}function toArray$4(e){return e.array.slice(e.from,e.to)}function originalToProjectedIndex(e,t){return t<e.from||t>=e.to?null:t-e.from}function projectedToOriginalIndex(e,t){return t<0||t>e.to-e.from?null:e.from+t}function transformToIncludeIndex(e,t){if(!(t in e.array))return null;var n=0;return t<e.from&&(n=-e.from+t),t>=e.to&&(n=t-e.to+1),0===n?e:create(e.array,e.to-e.from,e.from+n)}var arrayProjection=Object.freeze({create:create,toArray:toArray$4,originalToProjectedIndex:originalToProjectedIndex,projectedToOriginalIndex:projectedToOriginalIndex,transformToIncludeIndex:transformToIncludeIndex});function get$2(e,t,n){var r=e[t];return r?r[n]:void 0}function set$2(e,t,n,r){var i=e[t];return i&&(i[n]=r),r}function getRow(e,t){return e[t]}function setRow(e,t,n){return e[t]=n}function getCol(e,t){return e.reduce(function(e,n){return e.push(n[t]),e},[])}function setCol(e,t,n){return e.map(function(e,r){return e[t]?e[t]=n[r]:void 0})}function create$1(e,t,n){for(var r=new Array(e);e>0;)r[--e]=withN(t,n);return r}function mapCreate(e,t,n,r){for(var i=new Array(e),o=0;o<e;o++){i[o]=new Array(t);for(var a=0;a<t;a++)i[o][a]=n.call(r||this,o,a)}return i}function forEach$2(e,t,n){e.forEach(function(e,r){e.forEach(function(e,i){t.call(n||this,e,r,i)})})}function map$2(e,t,n){var r=new Array(e.length);return e.forEach(function(e,i){r[i]=new Array(e.length),e.forEach(function(e,o){r[i][o]=t.call(n||this,e,i,o)})}),r}function toObjects(e){for(var t=e[0],n=new Array(e.length-1),r=1;r<e.length;r++)for(var i=n[r-1]={},o=0;o<t.length;o++)i[t[o]]=e[r][o];return n}function tableFromObjects(e,t){Array.isArray(e)||(e=[e]);var n=[[]],r=n[0],i=e.reduce(function(e,t){return e.concat([Object.keys(t).reduce(function(e,n){var i=r.indexOf(n);return-1===i&&(i=r.length,r.push(n)),e[i]=t[n],e},[])])},[]);return t=1===arguments.length?null:t,i.forEach(function(e){for(var n=0;n<r.length;n++)e[n]||(e[n]=t)}),n.concat(i)}var grid=Object.freeze({get:get$2,set:set$2,getRow:getRow,setRow:setRow,getCol:getCol,setCol:setCol,create:create$1,mapCreate:mapCreate,forEach:forEach$2,map:map$2,toObjects:toObjects,tableFromObjects:tableFromObjects});function prewalk(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{i:0},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=r.i++;t(e,o,i),(n(e,o,i)||[]).forEach(function(e){return prewalk(e,t,n,r,i+1)})}function postwalk(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{i:0},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=r.i++;(n(e,o,i)||[]).forEach(function(e){return postwalk(e,t,n,r,i)}),t(e,o,i)}function find(e,t,n){if(t(e))return e;var r=n(e);if(r&&r.length)for(var i=0;i<r.length;i++){var o=find(r[i],t,n);if(o)return o}}var detect$1=find;function filter$1(e,t,n){var r=[];return t(e)&&r.push(e),r.concat(flatten((n(e)||[]).map(function(e){return filter$1(e,t,n)})))}function map$3(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return[t(e,r)].concat(flatten((n(e)||[]).map(function(e){return map$3(e,t,n,r+1)})))}function mapTree(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=(n(e)||[]).map(function(e){return mapTree(e,t,n,r+1)});return t(e,i,r)}var tree=Object.freeze({prewalk:prewalk,postwalk:postwalk,find:find,detect:detect$1,filter:filter$1,map:map$3,mapTree:mapTree}),isNode$1="undefined"!=typeof process&&process.versions&&process.versions.node,makeEmitter=isNode$1?function(e,t){if(e.on&&e.removeListener)return e;var n="undefined"!=typeof System?System._nodeRequire("events"):require("events");return Object.assign(e,n.EventEmitter.prototype),n.EventEmitter.call(e),t&&t.maxListenerLimit&&e.setMaxListeners(t.maxListenerLimit),e}:function(e){return e.on&&e.removeListener?e:(e.listeners={},e.on=function(t,n){n&&(e.listeners[t]||(e.listeners[t]=[]),e.listeners[t].push(n))},e.once=function(t,n){n&&e.on(t,function r(){e.removeListener(t,r),n.apply(this,arguments)})},e.removeListener=function(t,n){e.listeners[t]&&(e.listeners[t]=e.listeners[t].filter(function(e){return e!==n}))},e.removeAllListeners=function(t){e.listeners[t]&&(e.listeners[t]=[])},e.emit=function(){var t=Array.prototype.slice.call(arguments),n=t.shift(),r=e.listeners[n];r&&r.length&&r.forEach(function(e){try{e.apply(null,t)}catch(e){console.error("Error in event handler: %s",e.stack||String(e))}})},e)},events=Object.freeze({makeEmitter:makeEmitter}),OFFLINE="offline",ONLINE="online";function create$2(e){var t=[{name:"send",args:["msg","callback"]},{name:"listen",args:["messenger","callback"]},{name:"close",args:["messenger","callback"]},{name:"isOnline",args:[]}],n=t.map(function(e){return e.name}).concat(["id","sendHeartbeat","heartbeatInterval","ignoreUnknownMessages","allowConcurrentSends","sendTimeout","services"]);t.forEach(function(t){if(!e[t.name]){var n="message implementation needs function "+t.name+"("+t.args.join(",")+")";throw new Error(n)}});var r=e.sendHeartbeat&&(e.heartbeatInterval||1e3),i=!!e.hasOwnProperty("ignoreUnknownMessages")&&e.ignoreUnknownMessages,o={_outgoing:[],_inflight:[],_id:e.id||newUUID(),_ignoreUnknownMessages:i,_services:{},_messageCounter:0,_messageResponseCallbacks:{},_whenOnlineCallbacks:[],_statusWatcherProc:null,_startHeartbeatProcessProc:null,_listenInProgress:null,_heartbeatInterval:r,_status:OFFLINE,_runWhenOnlineCallbacks:function(){var e=o._whenOnlineCallbacks.slice();o._whenOnlineCallbacks=[],e.forEach(function(e){try{e.call(null,null,o)}catch(e){console.error("error in _runWhenOnlineCallbacks: %s",e)}})},_ensureStatusWatcher:function(){o._statusWatcherProc||(o._statusWatcherProc=setInterval(function(){o.isOnline()&&o._whenOnlineCallbacks.length&&o._runWhenOnlineCallbacks();var e=o._status;o._status=o.isOnline()?ONLINE:OFFLINE,o._status!==ONLINE&&o._statusWatcherProc&&o.reconnect(),o._status!==e&&o.onStatusChange&&o.onStatusChange()},20))},_addMissingData:function(e){if(!e.target)throw new Error("Message needs target!");if(!e.action)throw new Error("Message needs action!");return e.data||(e.data=null),e.messageId||(e.messageId=newUUID()),e.sender=o.id(),e.messageIndex=o._messageCounter++,e},_queueSend:function(e,t){if(t&&"function"!=typeof t)throw new Error("Expecing a when send callback, got: "+t);o._outgoing.push([e,t])},_deliverMessageQueue:function(){if(e.allowConcurrentSends||!o._inflight.length){var t=o._outgoing.shift();t&&(o._inflight.push(t),o.isOnline()?n(t):o.whenOnline(function(){n(t)}),function(t){if("number"!=typeof e.sendTimeout)return;setTimeout(function(){-1!==o._inflight.indexOf(t)&&(remove(o._inflight,t),r(new Error("Timeout sending message"),t),o._deliverMessageQueue())},e.sendTimeout)}(t),e.allowConcurrentSends&&o._outgoing.length&&o._deliverMessageQueue())}function n(t){if(-1!==o._inflight.indexOf(t)){var n=t[0],i=t[1];i&&(o._messageResponseCallbacks[n.messageId]=i),e.send.call(o,n,function(e){remove(o._inflight,t),e&&r(e,t),o._deliverMessageQueue()})}}function r(e,t){var n=t[0],r=t[1];delete o._messageResponseCallbacks[n.messageId],console.error(e),r&&r(e)}},_startHeartbeatProcess:function(){o._startHeartbeatProcessProc||(o._startHeartbeatProcessProc=setTimeout(function(){e.sendHeartbeat.call(o,function(e,t){o._startHeartbeatProcessProc=null,o._startHeartbeatProcess()})},o._heartbeatInterval))},id:function(){return o._id},isOnline:function(){return e.isOnline.call(o)},heartbeatEnabled:function(){return"number"==typeof o._heartbeatInterval},listen:function(t){if(!o._listenInProgress)return o._listenInProgress=!0,o._ensureStatusWatcher(),e.listen.call(o,function(e){o._listenInProgress=null,t&&t(e),o.heartbeatEnabled()&&o._startHeartbeatProcess()})},reconnect:function(){if(o._status!==ONLINE)return o.listen(),o},send:function(e,t){return o._addMissingData(e),o._queueSend(e,t),o._deliverMessageQueue(),e},sendTo:function(e,t,n,r){var i={target:e,action:t,data:n};return o.send(i,r)},onMessage:function(e){if(o.emit("message",e),e.inResponseTo){var t=o._messageResponseCallbacks[e.inResponseTo];t&&!e.expectMoreResponses&&delete o._messageResponseCallbacks[e.inResponseTo],t&&t(null,e)}else{var n=o._services[e.action];if(n)try{n.call(null,e,o)}catch(t){var r=String(t.stack||t);console.error("Error invoking service: "+r),o.answer(e,{error:r})}else if(!o._ignoreUnknownMessages){var i=new Error("messageNotUnderstood: "+e.action);o.answer(e,{error:String(i)})}}},answer:function(e,t,n,r){"function"==typeof n&&(r=n,n=!1);var i={target:e.sender,action:e.action+"Result",inResponseTo:e.messageId,data:t};return n&&(i.expectMoreResponses=!0),o.send(i,r)},close:function(t){return clearInterval(o._statusWatcherProc),o._statusWatcherProc=null,e.close.call(o,function(e){o._status=OFFLINE,t&&t(e)}),o},whenOnline:function(e){return o._whenOnlineCallbacks.push(e),o.isOnline()&&o._runWhenOnlineCallbacks(),o},outgoingMessages:function(){return pluck(o._inflight.concat(o._outgoing),0)},addServices:function(e){return Object.assign(o._services,e),o}};for(var a in e.services&&o.addServices(e.services),makeEmitter(o),e)-1===n.indexOf(a)&&e.hasOwnProperty(a)&&(o[a]=e[a]);return o}var messenger=Object.freeze({create:create$2}),isNodejs="undefined"!=typeof require&&"undefined"!=typeof process,WorkerSetup={loadDependenciesBrowser:function(e){var t="undefined"!=typeof self?self:this;importScripts.apply(t,e.scriptsToLoad||[])},loadDependenciesNodejs:function(e){(global.lively||(global.lively={})).lang=require(require("path").join(e.libLocation,"index"))},initBrowserGlobals:function(e){remoteWorker.send=function(e){postMessage(e)};var t,n="undefined"!=typeof self?self:this,r=n.Global=n;r.window=r,r.console=r.console||(t={},["log","error","warn"].forEach(function(e){t[e]=function(){for(var t=arguments[0],n=1;n<arguments.length;n++)t=t.replace("%s",arguments[n]);remoteWorker.send({type:e,message:["[",e.toUpperCase(),"] ",t].join("")})}}),t)},initOnMessageHandler:function(e){function t(e){if(e=e.data.data?e.data:e,remoteWorker.messenger)remoteWorker.messenger.onMessage(e);else if("close"==e.action)return remoteWorker.send({type:"closed",workerReady:!1}),void remoteWorker.close()}remoteWorker.on?remoteWorker.on("message",t):remoteWorker.onmessage=t},initWorkerInterface:function initWorkerInterface(options){remoteWorker.callStringifiedFunction=function(stringifiedFunc,args,thenDo){var func;try{func=eval("("+stringifiedFunc+")")}catch(e){return void thenDo(new Error("Cannot create function from string: "+e.stack||e))}var usesCallback=func.length===args.length+1,whenDone=lively.lang.fun.once(function(e,t){remoteWorker.isBusy=!1,thenDo(e,t)});remoteWorker.isBusy=!0,usesCallback&&args.push(whenDone);try{var result=func.apply(remoteWorker,args.concat([whenDone]))}catch(e){return void whenDone(e,null)}usesCallback||whenDone(null,result)},remoteWorker.httpRequest=function(e){if(e.url){var t=new XMLHttpRequest,n=e.method||"GET";t.onreadystatechange=function(){4===t.readyState&&e.done&&e.done(t)},t.open(n,e.url),t.send()}else console.log("Error, httpRequest needs url")},remoteWorker.terminateIfNotBusyIn=function(e){setTimeout(function(){remoteWorker.isBusy?remoteWorker.terminateIfNotBusyIn(e):(remoteWorker.send({type:"closed",workerReady:!1}),remoteWorker.close())},e)}},initWorkerMessenger:function initWorkerMessenger(options){if(!options.useMessenger)return null;if(!lively.lang.messenger)throw new Error("worker.create requires messenger.js to be loaded!");if(!lively.lang.events)throw new Error("worker.create requires events.js to be loaded!");return remoteWorker.messenger=lively.lang.messenger.create({services:{remoteEval:function remoteEval(msg,messenger){var result;try{result=eval(msg.data.expr)}catch(e){result=e.stack||e}messenger.answer(msg,{result:String(result)})},run:function(e,t){var n=e.data.func,r=e.data.args;n?remoteWorker.callStringifiedFunction(n,r,function(n,r){t.answer(e,{error:n?String(n):null,result:r})}):t.answer(e,{error:"no funcString"})},close:function(e,t){t.answer(e,{status:"OK"}),remoteWorker.send({type:"closed",workerReady:!1}),remoteWorker.close()}},isOnline:function(){return!0},send:function(e,t){remoteWorker.send(e),t()},listen:function(e){e()},close:function(e){remoteWorker.send({type:"closed",workerReady:!1}),remoteWorker.close()}})}},BrowserWorker={create:function(e){if(!(e=e||{}).libLocation&&!e.scriptsToLoad){var t=document.querySelector('script[src$="worker.js"]');if(!t)throw new Error('Cannot find library path to start worker. Use worker.create({libLocation: "..."}) to explicitly define the path!');e.libLocation=t.src.replace(/worker.js$/,"")}var n=String(function(){self.onmessage=function(e){if("setup"!==e.data.action)throw new Error("expected setup to be first message but got "+JSON.stringify(e.data));var t=e.data.options||{};initBrowserGlobals(t),loadDependenciesBrowser(t),initOnMessageHandler(t),initWorkerInterface(t),initWorkerMessenger(t),postMessage({workerReady:!0})},__FUNCTIONDECLARATIONS__}).replace("__FUNCTIONDECLARATIONS__",[WorkerSetup.initBrowserGlobals,WorkerSetup.loadDependenciesBrowser,WorkerSetup.initOnMessageHandler,WorkerSetup.initWorkerInterface,WorkerSetup.initWorkerMessenger].join("\n")).split("__lvVarRecorder.").join(""),r=new Worker(function(e){var t;try{t=new Blob([e],{type:"text/javascript"})}catch(n){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,(t=new BlobBuilder).append(e),t=t.getBlob()}return("undefined"!=typeof webkitURL?webkitURL:URL).createObjectURL(t)}("("+n+")();"));return function(e,t){makeEmitter(t),e.scriptsToLoad||(e.scriptsToLoad=["base.js","events.js","object.js","collection.js","function.js","string.js","number.js","date.js","messenger.js","worker.js"].map(function(t){return e.libLocation+t}));var n=Object.keys(e).reduce(function(t,n){return"function"!=typeof e[n]&&(t[n]=e[n]),t},{});t.onmessage=function(e){void 0!==e.data.workerReady?(t.ready=!!e.data.workerReady,t.ready?t.emit("ready"):t.emit("close")):t.emit("message",e.data)},t.errors=[],t.onerror=function(e){console.error(e),t.errors.push(e),t.emit("error",e)},t.postMessage({action:"setup",options:n})}(e,r),r}},NodejsWorker={debug:!1,initCodeFileCreated:!1,create:function(e){var t;e=e||{};var n=makeEmitter({ready:!1,errors:[],postMessage:function(e){t?n.ready?t.send(e):n.emit("error",new Error("nodejs worker process not ready or already closed")):n.emit("error",new Error("nodejs worker process not yet created"))}});return NodejsWorker.startWorker(e,function(e,r){if(e)return n.ready=!1,void n.emit("error",e);(t=r).on("message",function(e){NodejsWorker.debug&&console.log("[WORKER PARENT] got message:",e),n.emit("message",e)}),t.on("close",function(){console.log("[WORKER PARENT] worker closed"),n.emit("close")}),t.on("error",function(e){console.log("[WORKER PARENT] error ",e),n.errors.push(e),n.emit("error",e)}),n.ready=!0,n.emit("ready")}),n},workerSetupFunction:function(){var e=process;console.log("[WORKER] Starting init"),e.on("message",function(t){if("setup"!==t.action)throw new Error("expected setup to be first message but got "+JSON.stringify(t.data));e.removeAllListeners("message");var n=t.data.options||{};console.log("[WORKER] running setup with options",n),loadDependenciesNodejs(n),initOnMessageHandler(n),initWorkerInterface(n),initWorkerMessenger(n),e.send({workerReady:!0})}),__FUNCTIONDECLARATIONS__},ensureInitCodeFile:function(e,t,n){var r=require("path"),i=require("os"),o=require("fs"),a=r.join(i.tmpDir(),"lively-nodejs-workers/"),s=r.join(a,"nodejs-worker-init.js");NodejsWorker.initCodeFileCreated?o.exists(s,function(r){r?n(null,s):NodejsWorker.createWorkerCodeFile(e,s,t,n)}):NodejsWorker.createWorkerCodeFile(e,s,t,n)},createWorkerCodeFile:function(e,t,n,r){var i=require("path"),o=require("fs");(0,require("child_process").exec)("mkdir -p "+i.dirname(t),function(e,i,a){e?r(new Error(["[WORKER PARENT] Could not create worker temp dir:",i,a].join("\n"))):o.writeFile(t,n,function(e){NodejsWorker.debug&&console.log("worker code file %s created",t),NodejsWorker.initCodeFileCreated=!0,r(e,t)})})},startWorker:function(e,t){var n=require("util"),r=require("child_process").fork,i=String(NodejsWorker.workerSetupFunction).replace("__FUNCTIONDECLARATIONS__",[WorkerSetup.loadDependenciesNodejs,WorkerSetup.initOnMessageHandler,WorkerSetup.initWorkerInterface,WorkerSetup.initWorkerMessenger].join("\n")),o=n.format("(%s)();\n",i);NodejsWorker.ensureInitCodeFile(e,o,function(n,i){if(n)return t(n);var o=r(i,{});NodejsWorker.debug&&console.log("worker forked"),o.on("message",function(e){"pong"===e.action?console.log("[WORKER pong] ",e):"log"===e.action&&console.log("[Message from WORKER] ",e.data)}),o.once("message",function(e){NodejsWorker.debug&&console.log("worker setup done"),t(null,o,e)}),o.on("close",function(){NodejsWorker.debug&&console.log("[WORKER PARENT] worker closed")}),o.send({action:"setup",data:{options:e}}),global.WORKER=o})}};function fork(e,t,n){n||(n=t,t=e,e=null);var r=(e=e||{}).args||[],i=create$3(e);return i.run.apply(i,[t].concat(r).concat(n)),i}function create$3(e){(e=e||{}).useMessenger=!0;var t=e.workerId||newUUID(),n=create$2({sendTimeout:5e3,send:function(e,t){n.worker.postMessage(e),t()},listen:function(t){var r=n.worker=isNodejs?NodejsWorker.create(e):BrowserWorker.create(e);r.on("message",function(e){n.onMessage(e)}),r.on("ready",function(){NodejsWorker.debug&&console.log("WORKER READY!!!")}),r.on("close",function(){NodejsWorker.debug&&console.log("WORKER CLOSED...!!!")}),r.once("ready",t)},close:function(e){return n.worker.ready?n.sendTo(t,"close",{},function(t,r){if((t=t||r.data.error)&&console.error("Error in worker messenger close: "+t.stack||t),t)e(t);else{var i=!1;n.worker.once("close",function(){i=!0}),waitFor(1e3,function(){return!!i},e)}}):e(null)},isOnline:function(){return n.worker&&n.worker.ready}});return Object.assign(n,{eval:function(e,r){n.sendTo(t,"remoteEval",{expr:e},function(e,t){r(e,t?t.data.result:null)})},run:function(){var e=Array.prototype.slice.call(arguments),r=e.shift(),i=e.pop();if("function"!=typeof r)throw new Error("run: no function that should run in worker passed");if("function"!=typeof i)throw new Error("run: no callback passed");return n.sendTo(t,"run",{func:String(r),args:e},function(e,t){i(e||t.data.error,t?t.data.result:null)})}}),n.listen(),n}var worker=Object.freeze({fork:fork,create:create$3}),GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:void 0,isNode="undefined"!=typeof process&&process.env&&"function"==typeof process.exit,globalInterfaceSpec=[{action:"installMethods",target:"Array",sources:["arr"],methods:["from","genN","range","withN"]},{action:"installMethods",target:"Array.prototype",sources:["arr"],methods:["all","any","batchify","clear","clone","collect","compact","delimWith","detect","doAndContinue","each","equals","filterByKey","findAll","first","flatten","forEachShowingProgress","grep","groupBy","groupByKey","histogram","include","inject","intersect","invoke","last","mapAsync","mapAsyncSeries","mask","max","min","mutableCompact","nestedDelay","partition","pluck","pushAll","pushAllAt","pushAt","pushIfNotIncluded","reMatches","reject","rejectByKey","remove","removeAt","replaceAt","rotate","shuffle","size","sortBy","sortByKey","sum","swap","toArray","toTuples","union","uniq","uniqBy","without","withoutAll","zip"],alias:[["select","filter"]]},{action:"installMethods",target:"Date",sources:["date"],methods:[]},{action:"installMethods",target:"Date.prototype",sources:["date"],methods:["equals","format","relativeTo"]},{action:"installMethods",target:"Function",sources:["fun"],methods:["fromString"]},{action:"installMethods",target:"Function.prototype",sources:["fun"],methods:["addToObject","argumentNames","asScript","asScriptOf","binds","curry","delay","functionNames","localFunctionNames","getOriginal","getVarMapping","logCalls","logCompletion","logErrors","qualifiedMethodName","setProperty","traceCalls","wrap"]},{action:"installMethods",target:"Number",sources:["num"],methods:[]},{action:"installMethods",target:"Number.prototype",sources:["num"],methods:["detent","randomSmallerInteger","roundTo","toDegrees","toRadians"]},{action:"installMethods",target:"Object",sources:["obj"],methods:["addScript","clone","deepCopy","extend","inherit","isArray","isBoolean","isElement","isEmpty","isFunction","isNumber","isObject","isRegExp","isString","isUndefined","merge","mergePropertyInHierarchy","values","valuesInPropertyHierarchy"]},{action:"installMethods",target:"Object.prototype",sources:["obj"],methods:[]},{action:"installMethods",target:"String.prototype",sources:["string"],methods:["camelize","capitalize","digitValue","empty","hashCode","include","pad","regExpEscape","startsWithVowel","succ","times","toArray","toQueryParams","truncate"]},{action:"installObject",target:"Numbers",source:"num",methods:["average","between","convertLength","humanReadableByteSize","median","normalRandom","parseLength","random","sort"]},{action:"installObject",target:"Properties",source:"properties",methods:["all","allOwnPropertiesOrFunctions","allProperties","any","forEachOwn","hash","nameFor","own","ownValues","values"]},{action:"installObject",target:"Strings",source:"string",methods:["camelCaseString","createDataURI","diff","format","formatFromArray","indent","lineIndexComputer","lines","md5","newUUID","nonEmptyLines","pad","paragraphs","peekLeft","peekRight","print","printNested","printTable","printTree","quote","reMatches","stringMatch","tableize","tokens","unescapeCharacterEntities","withDecimalPrecision"]},{action:"installObject",target:"Objects",source:"obj",methods:["asObject","equals","inspect","isMutableType","safeToString","shortPrintStringOf","typeStringOf"]},{action:"installObject",target:"Functions",source:"fun",methods:["all","compose","composeAsync","createQueue","debounce","debounceNamed","either","extractBody","flip","notYetImplemented","once","own","throttle","throttleNamed","timeToRun","timeToRunN","waitFor","workerWithCallbackQueue","wrapperChain"]},{action:"installObject",target:"Grid",source:"grid"},{action:"installObject",target:"Interval",source:"interval"},{action:"installObject",target:"lively.ArrayProjection",source:"arrayProjection"},{action:"installObject",target:"lively.Closure",source:"Closure"},{action:"installObject",target:"lively.Grouping",source:"Group"},{action:"installObject",target:"lively.PropertyPath",source:"Path"},{action:"installObject",target:"lively.Worker",source:"worker"},{action:"installObject",target:"lively.Class",source:"classHelper"}];function createLivelyLangObject(){return{chain:chain$$1,noConflict:noConflict,installGlobals:installGlobals,uninstallGlobals:uninstallGlobals,globalInterfaceSpec:globalInterfaceSpec,toString:function(){return"[object lively.lang]"}}}var livelyLang=createLivelyLangObject();function chain$$1(e){if(!e)return e;if(Array.isArray(e))return createChain(arr,e);if("Date"===e.constructor.name)return createChain(date,e);switch(void 0===e?"undefined":_typeof(e)){case"string":return createChain(string,e);case"object":return createChain(obj,e);case"function":return createChain(fun,e);case"number":return createChain(num,e)}throw new Error("Chain for object "+e+" ("+e.constructor.name+") no supported")}function createChain(e,t){return Object.keys(e).reduce(function(n,r){return n[r]=function(){var n=Array.prototype.slice.call(arguments);return chain$$1(e[r].apply(null,[t].concat(n)))},n},{value:function(){return t}})}function noConflict(){isNode||(livelyLang._prevLivelyGlobal?delete GLOBAL.lively.lang:delete GLOBAL.lively);return livelyLang}function installGlobals(){Object.assign(livelyLang,{worker:worker,messenger:messenger,events:events,tree:tree,grid:grid,arrayProjection:arrayProjection,interval:interval,graph:graph,date:date,properties:properties,obj:obj,arr:arr,fun:fun,num:num,string:string,Closure:Closure,promise:promise,Path:Path,Group:Group}),globalInterfaceSpec.forEach(function(e){if("installMethods"===e.action){(n=Path(e.target)).isIn(GLOBAL)||n.set(GLOBAL,{},!0);var t=Path(e.sources[0]);e.methods.forEach(function(e){installProperty(t.concat([e]),n.concat([e]))}),e.alias&&e.alias.forEach(function(e){installProperty(t.concat([e[1]]),n.concat([e[0]]))})}else{if("installObject"!==e.action)throw new Error("Cannot deal with global setup action: "+e.action);var n=Path(e.target),r=Path(e.source).get(livelyLang);n.set(GLOBAL,r,!0)}})}function installProperty(e,t){if(!e.isIn(livelyLang)){var n=new Error("property not provided by lively.lang: "+e);throw console.error(n.stack||n),n}var r=e.get(livelyLang);if("function"==typeof r&&"prototype"===t.slice(-2,-1).toString()){var i=r;(r=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this),i.apply(null,e)}).toString=function(){return i.toString()}}t.set(GLOBAL,r,!0)}function uninstallGlobals(){globalInterfaceSpec.forEach(function(e){if("installMethods"===e.action){var t=Path(e.target),n=Path(e.source).get(livelyLang),r=t.get(GLOBAL);if(!r)return;e.methods.filter(function(e){return n===r[e]}).forEach(function(e){delete r[e]}),e.alias&&e.alias.filter(function(e){return n===r[e]}).forEach(function(e){delete r[e[0]]})}else{if("installObject"!==e.action)throw new Error("Cannot deal with global setup action: "+e.action);(t=Path(e.target)).del(GLOBAL)}})}exports.worker=worker,exports.messenger=messenger,exports.events=events,exports.tree=tree,exports.grid=grid,exports.arrayProjection=arrayProjection,exports.interval=interval,exports.graph=graph,exports.date=date,exports.properties=properties,exports.obj=obj,exports.arr=arr,exports.fun=fun,exports.num=num,exports.string=string,exports.Closure=Closure,exports.promise=promise,exports.Path=Path,exports.Group=Group,exports.livelyLang=livelyLang,exports.chain=chain$$1,exports.noConflict=noConflict,exports.installGlobals=installGlobals,exports.uninstallGlobals=uninstallGlobals}(this.lively.lang=this.lively.lang||{})}.call(GLOBAL),"undefined"!=typeof module&&module.exports&&(module.exports=GLOBAL.lively.lang)}(),this.lively=this.lively||{},function(e,t){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=(function(){function e(e){this.value=e}function t(t){var n,r;function i(n,r){try{var a=t[n](r),s=a.value;s instanceof e?Promise.resolve(s.value).then(function(e){i("next",e)},function(e){i("throw",e)}):o(a.done?"return":"normal",a.value)}catch(e){o("throw",e)}}function o(e,t){switch(e){case"return":n.resolve({value:t,done:!0});break;case"throw":n.reject(t);break;default:n.resolve({value:t,done:!1})}(n=n.next)?i(n.key,n.arg):r=null}this._invoke=function(e,t){return new Promise(function(o,a){var s={key:e,arg:t,resolve:o,reject:a,next:null};r?r=r.next=s:(n=r=s,i(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t};var s={RGB_UPDATED:"RGBUpdated",HSL_UPDATED:"HSLUpdated",HSV_UPDATED:"HSVUpdated",HEX_UPDATED:"HexUpdated",INT_UPDATED:"IntUpdated",UPDATED:"updated"},u={transparent:"rgba(0, 0, 0, 0)",aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370D8",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#D87093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE"},c=function(e){return.5+e<<0},l=function(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e},f=function(e){return y.test(e)?c(2.55*parseInt(e)):e},h=/^#?([0-9a-f]{3}|[0-9a-f]{6})$/i,p=/^hsla?\((\d{1,3}?),\s*(\d{1,3}%),\s*(\d{1,3}%)(,\s*[01]?\.?\d*)?\)$/,d=/^rgba?\((\d{1,3}%?),\s*(\d{1,3}%?),\s*(\d{1,3}%?)(,\s*[01]?\.?\d*)?\)$/,y=/^\d+(\.\d+)*%$/,g=/([0-9a-f])/gi,v=/^#/,m=/^hsla?\((\d{1,3}),\s*(\d{1,3})%,\s*(\d{1,3})%(,\s*([01]?\.?\d*))?\)$/,b=/^rgba?\((\d{1,3}%?),\s*(\d{1,3}%?),\s*(\d{1,3}%?)(,\s*([01]?\.?\d*))?\)$/;function w(e){this._listeners={},this.subscribe(s.RGB_UPDATED,this._RGBUpdated),this.subscribe(s.HEX_UPDATED,this._HEXUpdated),this.subscribe(s.HSL_UPDATED,this._HSLUpdated),this.subscribe(s.HSV_UPDATED,this._HSVUpdated),this.subscribe(s.INT_UPDATED,this._INTUpdated),this.parse(e)}w.prototype._decimal=0,w.prototype._hex="#000000",w.prototype._red=0,w.prototype._green=0,w.prototype._blue=0,w.prototype._hue=0,w.prototype._saturation=0,w.prototype._lightness=0,w.prototype._brightness=0,w.prototype._alpha=1,w.prototype.parse=function(e){if(void 0===e)return this;switch(!0){case isFinite(e):return this.decimal(e),this.output=w.INT,this;case e instanceof w:return this.copy(e),this;default:switch(void 0===e?"undefined":n(e)){case"object":return this.set(e),this;case"string":switch(!0){case u.hasOwnProperty(e):var t=(e=u[e]).replace(v,"");return this.decimal(parseInt(t,16)),this;case h.test(e):return 3==(t=e.replace(v,"")).length&&(t=t.replace(g,"$1$1")),this.decimal(parseInt(t,16)),this;case d.test(e):var r=e.match(b);return this.red(f(r[1])),this.green(f(r[2])),this.blue(f(r[3])),this.alpha(parseFloat(r[5])||1),this.output=(y.test(r[1])?2:1)+(r[5]?2:0),this;case p.test(e):r=e.match(m);return this.hue(parseInt(r[1])),this.saturation(parseInt(r[2])),this.lightness(parseInt(r[3])),this.alpha(parseFloat(r[5])||1),this.output=r[5]?6:5,this}}}return this},w.prototype.clone=function(){return new w(this.decimal())},w.prototype.copy=function(e){return this.set(e.decimal()),this},w.prototype.set=function(e,t){if(1==arguments.length)if("object"==(void 0===e?"undefined":n(e)))for(var r in e)"function"==typeof this[r]&&this[r](e[r]);else isFinite(e)&&this.decimal(e);else"function"==typeof this[e]&&this[e](t);return this},w.prototype.interpolate=function(e,t){return e instanceof w||(e=new w(e)),this._red=c(+this._red+(e._red-this._red)*t),this._green=c(+this._green+(e._green-this._green)*t),this._blue=c(+this._blue+(e._blue-this._blue)*t),this._alpha=c(+this._alpha+(e._alpha-this._alpha)*t),this.broadcast(s.RGB_UPDATED),this.broadcast(s.UPDATED),this},w.prototype._RGB2HSL=function(){var e=this._red/255,t=this._green/255,n=this._blue/255,r=Math.max(e,t,n),i=Math.min(e,t,n),o=(r+i)/2,a=r;if(r==i)return this._hue=0,this._saturation=0,this._lightness=c(100*o),void(this._brightness=c(100*a));var s=r-i,u=s/(o<=.5?r+i:2-r-i),l=(r==e?(t-n)/s+(t<n?6:0):r==t?(n-e)/s+2:(e-t)/s+4)/6;this._hue=c(360*l),this._saturation=c(100*u),this._lightness=c(100*o),this._brightness=c(100*a)},w.prototype._HSL2RGB=function(){var e=this._hue/360,t=this._saturation/100,n=this._lightness/100,r=n<.5?n*(1+t):n+t-n*t,i=2*n-r;this._red=c(255*l(i,r,e+1/3)),this._green=c(255*l(i,r,e)),this._blue=c(255*l(i,r,e-1/3))},w.prototype._HSV2RGB=function(){var e=this._hue/360,t=this._saturation/100,n=this._brightness/100,r=0,i=0,o=0,a=Math.floor(6*e),s=6*e-a,u=n*(1-t),l=n*(1-s*t),f=n*(1-(1-s)*t);switch(a%6){case 0:r=n,i=f,o=u;break;case 1:r=l,i=n,o=u;break;case 2:r=u,i=n,o=f;break;case 3:r=u,i=l,o=n;break;case 4:r=f,i=u,o=n;break;case 5:r=n,i=u,o=l}this._red=c(255*r),this._green=c(255*i),this._blue=c(255*o)},w.prototype._INT2HEX=function(){var e=this._decimal.toString(16);e="000000".substr(0,6-e.length)+e,this._hex="#"+e.toUpperCase()},w.prototype._INT2RGB=function(){this._red=this._decimal>>16,this._green=this._decimal>>8&255,this._blue=255&this._decimal},w.prototype._HEX2INT=function(){this._decimal=parseInt(this._hex,16)},w.prototype._RGB2INT=function(){this._decimal=this._red<<16|this._green<<8&65535|this._blue},w.prototype._RGBUpdated=function(){this._RGB2INT(),this._RGB2HSL(),this._INT2HEX()},w.prototype._HSLUpdated=function(){this._HSL2RGB(),this._RGB2INT(),this._INT2HEX()},w.prototype._HSVUpdated=function(){this._HSV2RGB(),this._RGB2INT(),this._INT2HEX()},w.prototype._HEXUpdated=function(){this._HEX2INT(),this._INT2RGB(),this._RGB2HSL()},w.prototype._INTUpdated=function(){this._INT2RGB(),this._RGB2HSL(),this._INT2HEX()},w.prototype._broadcastUpdate=function(){this.broadcast(Event.UPDATED)},w.prototype.decimal=function(e){return this._handle("_decimal",e,s.INT_UPDATED)},w.prototype.hex=function(e){return this._handle("_hex",e,s.HEX_UPDATED)},w.prototype.red=function(e){return this._handle("_red",e,s.RGB_UPDATED)},w.prototype.green=function(e){return this._handle("_green",e,s.RGB_UPDATED)},w.prototype.blue=function(e){return this._handle("_blue",e,s.RGB_UPDATED)},w.prototype.hue=function(e){return this._handle("_hue",e,s.HSL_UPDATED)},w.prototype.saturation=function(e){return this._handle("_saturation",e,s.HSL_UPDATED)},w.prototype.lightness=function(e){return this._handle("_lightness",e,s.HSL_UPDATED)},w.prototype.brightness=function(e){return this._handle("_brightness",e,s.HSV_UPDATED)},w.prototype.alpha=function(e){return this._handle("_alpha",e)},w.prototype._handle=function(e,t,n){return void 0!==this[e]&&void 0!==t&&(t!=this[e]&&(this[e]=t,n&&this.broadcast(n)),this.broadcast(Event.UPDATED)),this[e]},w.prototype.getHex=function(){return this._hex},w.prototype.getRGB=function(){return"rgb("+[c(this._red),c(this._green),c(this._blue)].join(", ")+")"},w.prototype.getPRGB=function(){return"rgb("+[c(100*this._red/255)+"%",c(100*this._green/255)+"%",c(100*this._blue/255)+"%"].join(", ")+")"},w.prototype.getRGBA=function(){return"rgba("+[c(this._red),c(this._green),c(this._blue),this._alpha].join(", ")+")"},w.prototype.getPRGBA=function(){return"rgba("+[c(100*this._red/255)+"%",c(100*this._green/255)+"%",c(100*this._blue/255)+"%",this._alpha].join(", ")+")"},w.prototype.getHSL=function(){return"hsl("+[c(this._hue),c(this._saturation)+"%",c(this._lightness)+"%"].join(", ")+")"},w.prototype.getHSLA=function(){return"hsla("+[c(this._hue),c(this._saturation)+"%",c(this._lightness)+"%",this._alpha].join(", ")+")"},w.prototype.format=function(e){var t={r:this._red,g:this._green,b:this._blue,h:this._hue,s:this._saturation,l:this._lightness,v:this._brightness,a:this._alpha,x:this._hex,d:this._decimal};for(var n in t)e=e.split("%"+n+"%").join(t[n]);return e},w.prototype.output=0,w.HEX=0,w.RGB=1,w.PRGB=2,w.RGBA=3,w.PRGBA=4,w.HSL=5,w.HSLA=6,w.INT=7,w.prototype.toString=function(){switch(this.output){case 0:return this.getHex();case 1:return this.getRGB();case 2:return this.getPRGB();case 3:return this.getRGBA();case 4:return this.getPRGBA();case 5:return this.getHSL();case 6:return this.getHSLA();case 7:return this._decimal}return this.getHex()},w.prototype._listeners=null,w.prototype._isSubscribed=function(e){return null!=this._listeners[e]},w.prototype.subscribe=function(e,t){this._isSubscribed(e)||(this._listeners[e]=[]),this._listeners[e].push(t)},w.prototype.unsubscribe=function(e,t){if(this._isSubscribed(e))for(var n=this._listeners[e],r=0,i=n.length;r<i;r++)if(n[r]===t)return n.splice(r,1),this.unsubscribe(e,t)},w.prototype.broadcast=function(e,t){if(this._isSubscribed(e))for(var n=this._listeners[e],r=n.length,i=0;i<r;i++)n[i].apply(this,t)},w.prototype.tween=function(e,t){t instanceof w||(t=new w(t));var n=+new Date,r=this;this.broadcast("tweenStart");var i=setInterval(function(){var o=+new Date-n,a=Math.min(1,o/e);r.interpolate(t,a),r.broadcast("tweenProgress"),1==a&&(clearInterval(i),r.broadcast("tweenComplete"))},20);return i},w.prototype.bind=function(e,t){var n=this;this.subscribe("updated",function(){e[t]=n.toString()})},w.random=function(){return new w(c(16777215*Math.random()))},w.bind=function(e,t){var n=new w(e[t]);return n.bind(e,t),n};var k,x,_,A="16px";if(System.get("@system-env").browser)try{var S=F(16)(window.getComputedStyle(document.body).fontSize);S&&"NaN"!==S.slice(0,3)&&(A=S)}catch(e){}function x(e){return k(e)[1]}function _(e){return k(e)[0]}function F(e){return null==e&&(e=e),function(t,n,r,i){var o,a,s;if(null==r&&(r=e),null==i&&(i=r),(o=x(t))===n)return t;if(s=_(t),"px"!==x(r)&&console.warn("Parameter fromContext must resolve to a value in pixel units."),"px"!==x(i)&&console.warn("Parameter toContext must resolve to a value in pixel units."),"px"!==o)if("em"===o)s=_(t)*_(r);else if("rem"===o)s=_(t)*_(e);else{if("ex"!==o)return"ch"===o||"vw"===o||"vh"===o||"vmin"===o?(console.warn(o+" units can't be reliably converted; Returning original value."),t):(console.warn(o+" is an unknown or unsupported length unit; Returning original value."),t);s=_(t)*_(r)*2}if(a=s,"px"!==n)if("em"===n)a=s/_(i);else if("rem"===n)a=s/_(e);else{if("ex"!==n)return"ch"===n||"vw"===n||"vh"===n||"vmin"===n?(console.warn(n+" units can't be reliably converted; Returning original value."),t):(console.warn(n+" is an unknown or unsupported length unit; Returning original value."),t);a=s/_(i)/2}return parseFloat(a.toFixed(5))+n}}var E=F(A);function O(e){return Number(E(e,"px").slice(0,-2))}var C=function(){function e(t,n){r(this,e),this.x=t||0,this.y=n||0}return i(e,null,[{key:"ensure",value:function(t){return t instanceof e?t:new e(t.x,t.y)}},{key:"polar",value:function(t,n){return new e(t*Math.cos(n),t*Math.sin(n))}},{key:"random",value:function(n){return new e(t.num.randomSmallerInteger(n.x),t.num.randomSmallerInteger(n.y))}},{key:"fromLiteral",value:function(e){return M(e.x,e.y)}},{key:"fromTuple",value:function(e){return M(e[0],e[1])}}]),i(e,[{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"toFixed",value:function(t){return new e(this.x.toFixed(t),this.y.toFixed(t))}},{key:"addPt",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"addXY",value:function(t,n){return new e(this.x+t,this.y+n)}},{key:"midPt",value:function(t){return new e((this.x+t.x)/2,(this.y+t.y)/2)}},{key:"subPt",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"subXY",value:function(t,n){return new e(this.x-t,this.y-n)}},{key:"scaleBy",value:function(t,n){return new e(this.x*t,this.y*(n||t))}},{key:"scaleByPt",value:function(t){return new e(this.x*t.x,this.y*t.y)}},{key:"negated",value:function(){return new e(-this.x,-this.y)}},{key:"inverted",value:function(){return new e(1/this.x,1/this.y)}},{key:"invertedSafely",value:function(){return new e(this.x&&1/this.x,this.y&&1/this.y)}},{key:"lessPt",value:function(e){return this.x<e.x&&this.y<e.y}},{key:"leqPt",value:function(e){return this.x<=e.x&&this.y<=e.y}},{key:"eqPt",value:function(e){return this.x==e.x&&this.y==e.y}},{key:"equals",value:function(e){return this.x==e.x&&this.y==e.y}},{key:"withX",value:function(e){return M(e,this.y)}},{key:"withY",value:function(e){return M(this.x,e)}},{key:"copy",value:function(){return new e(this.x,this.y)}},{key:"minPt",value:function(t,n){return n||(n=new e(0,0)),n.x=Math.min(this.x,t.x),n.y=Math.min(this.y,t.y),n}},{key:"maxPt",value:function(t,n){return n||(n=new e(0,0)),n.x=Math.max(this.x,t.x),n.y=Math.max(this.y,t.y),n}},{key:"random",value:function(){return e.random(this)}},{key:"normalized",value:function(){var e=this.r();return M(this.x/e,this.y/e)}},{key:"fastNormalized",value:function(){var e=this.fastR();return M(this.x/e,this.y/e)}},{key:"dotProduct",value:function(e){return this.x*e.x+this.y*e.y}},{key:"matrixTransform",value:function(e,t){var n=e.a*this.x+e.c*this.y+e.e,r=e.b*this.x+e.d*this.y+e.f;return t?Object.assign(t,{x:n,y:r}):M(n,r)}},{key:"matrixTransformDirection",value:function(e,t){var n=e.a*this.x+e.c*this.y,r=e.b*this.x+e.d*this.y;return t?Object.assign(t,{x:n,y:r}):M(n,r)}},{key:"griddedBy",value:function(e){return M(this.x-this.x%e.x,this.y-this.y%e.y)}},{key:"roundTo",value:function(n){return new e(t.num.roundTo(this.x,n),t.num.roundTo(this.y,n))}},{key:"dist",value:function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)}},{key:"distSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"nearestPointOnLineBetween",value:function(e,t){if(e.x==t.x)return M(e.x,this.y);if(e.y==t.y)return M(this.x,e.y);var n=e.x,r=e.y,i=t.x-n,o=t.y-r,a=((this.y-r)/i+(this.x-n)/o)/(i/o+o/i);return M(n+a*i,r+a*o)}},{key:"r",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"fastR",value:function(){for(var e=this.x*this.x+this.y*this.y,t=17,n=0;n<6;n++)t=(t+e/t)/2;return t}},{key:"theta",value:function(){return Math.atan2(this.y,this.x)}},{key:"asRectangle",value:function(){return new P(this.x,this.y,0,0)}},{key:"extent",value:function(e){return new P(this.x,this.y,e.x,e.y)}},{key:"extentAsRectangle",value:function(){return new P(0,0,this.x,this.y)}},{key:"lineTo",value:function(e){return new T(this,e)}},{key:"toTuple",value:function(){return[this.x,this.y]}},{key:"toLiteral",value:function(){return{x:this.x,y:this.y}}},{key:"toString",value:function(){return!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?t.string.format("pt(%1.f,%1.f)",this.x,this.y):t.string.format("pt(%10.d,%10.d)",this.x,this.y)}},{key:"inspect",value:function(){return JSON.stringify(this)}},{key:"__serialize__",value:function(){return{__expr__:this.toString(!1),bindings:{"lively.graphics/geometry-2d.js":["pt"]}}}},{key:"isPoint",get:function(){return!0}}]),e}(),P=function(){function e(t,n,i,o){r(this,e),this.x=t||0,this.y=n||0,this.width=i||0,this.height=o||0}return i(e,[{key:"corners",get:function(){return["topLeft","topRight","bottomRight","bottomLeft"]}},{key:"sides",get:function(){return["leftCenter","rightCenter","topCenter","bottomCenter"]}}],[{key:"fromAny",value:function(e,t){return j(e.minPt(t),e.maxPt(t))}},{key:"fromLiteral",value:function(t){return new e(t.x,t.y,t.width,t.height)}},{key:"fromTuple",value:function(t){return new e(t[0],t[1],t[2],t[3])}},{key:"unionPts",value:function(e){for(var t=e[0],n=e[0],r=1;r<e.length;r++)t=t.minPt(e[r]),n=n.maxPt(e[r]);return j(t,n)}},{key:"ensure",value:function(t){return t instanceof e?t:new e(t.x,t.y,t.width,t.height)}},{key:"fromElement",value:function(t){if("function"==typeof t.getBoundingClientRect){var n=t.getBoundingClientRect();return j(n.left,n.top,n.width,n.height)}if("http://www.w3.org/1999/xhtml"==t.namespaceURI)return new e(O(t.style.left||"0px"),O(t.style.top||"0px"),O(t.style.width||"0px"),O(t.style.hieght||"0px"));if("http://www.w3.org/2000/svg"==t.namespaceURI)return new e(t.x.baseVal.value,t.y.baseVal.value,t.width.baseVal.value,t.height.baseVal.value);throw new Error("Cannot create Rectangle from "+t)}},{key:"inset",value:function(t,n,r,i){return void 0===n&&(n=t),void 0===r&&(r=t),void 0===i&&(i=n),new e(t,n,r-t,i-n)}}]),i(e,[{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"copy",value:function(){return new e(this.x,this.y,this.width,this.height)}},{key:"toFixed",value:function(t){return new e(this.x.toFixed(t),this.y.toFixed(t),this.width.toFixed(t),this.height.toFixed(t))}},{key:"withWidth",value:function(t){return new e(this.x,this.y,t,this.height)}},{key:"withHeight",value:function(t){return new e(this.x,this.y,this.width,t)}},{key:"withX",value:function(t){return new e(t,this.y,this.width,this.height)}},{key:"withY",value:function(t){return new e(this.x,t,this.width,this.height)}},{key:"withExtent",value:function(t){return new e(this.x,this.y,t.x,t.y)}},{key:"withTopLeft",value:function(t){return e.fromAny(t,this.bottomRight())}},{key:"withTopRight",value:function(t){return e.fromAny(this.bottomLeft(),t)}},{key:"withBottomRight",value:function(t){return e.fromAny(t,this.topLeft())}},{key:"withBottomLeft",value:function(t){return e.fromAny(t,this.topRight())}},{key:"withLeftCenter",value:function(t){return new e(t.x,this.y,this.width+(this.x-t.x),this.height)}},{key:"withRightCenter",value:function(t){return new e(this.x,this.y,t.x-this.x,this.height)}},{key:"withTopCenter",value:function(t){return new e(this.x,t.y,this.width,this.height+(this.y-t.y))}},{key:"withBottomCenter",value:function(t){return new e(this.x,this.y,this.width,t.y-this.y)}},{key:"withCenter",value:function(t){return new e(t.x-this.width/2,t.y-this.height/2,this.width,this.height)}},{key:"insetBy",value:function(t){return new e(this.x+t,this.y+t,this.width-2*t,this.height-2*t)}},{key:"insetByPt",value:function(t){return new e(this.x+t.x,this.y+t.y,this.width-2*t.x,this.height-2*t.y)}},{key:"grid",value:function(n,r){var i=this.width/r,o=this.height/n;return t.grid.mapCreate(n,r,function(t,n){return new e(i*n,o*t,i,o)})}},{key:"divide",value:function(e){var t=this;return e.map(function(e){return j(t.x+t.width*e.x,t.y+t.height*e.y,t.width*e.width,t.height*e.height)})}},{key:"toTuple",value:function(){return[this.x,this.y,this.width,this.height]}},{key:"lineTo",value:function(e){var t=this.center(),n=e.center(),r=t.lineTo(n),i=this.lineIntersection(r)[0],o=e.lineIntersection(r)[0];return i&&o&&i.lineTo(o)}},{key:"equals",value:function(e){return!!e&&(this.x==e.x&&this.y==e.y&&this.width==e.width&&this.height==e.height)}},{key:"inspect",value:function(){return JSON.stringify(this)}},{key:"topLeft",value:function(){return new C(this.x,this.y)}},{key:"topRight",value:function(){return new C(this.maxX(),this.y)}},{key:"bottomRight",value:function(){return new C(this.maxX(),this.maxY())}},{key:"bottomLeft",value:function(){return new C(this.x,this.maxY())}},{key:"leftCenter",value:function(){return new C(this.x,this.center().y)}},{key:"rightCenter",value:function(){return new C(this.maxX(),this.center().y)}},{key:"topCenter",value:function(){return new C(this.center().x,this.y)}},{key:"bottomCenter",value:function(){return new C(this.center().x,this.maxY())}},{key:"extent",value:function(){return new C(this.width,this.height)}},{key:"center",value:function(){return new C(this.x+this.width/2,this.y+this.height/2)}},{key:"topEdge",value:function(){return new T(this.topLeft(),this.topRight())}},{key:"bottomEdge",value:function(){return new T(this.bottomLeft(),this.bottomRight())}},{key:"leftEdge",value:function(){return new T(this.topLeft(),this.bottomLeft())}},{key:"rightEdge",value:function(){return new T(this.topRight(),this.bottomRight())}},{key:"edges",value:function(){return[this.topEdge(),this.rightEdge(),this.bottomEdge(),this.leftEdge()]}},{key:"allPoints",value:function(){for(var e=this.x,t=this.y,n=this.width,r=this.height,i=[],o=t;o<t+r;o++)for(var a=e;a<e+n;a++)i.push(M(a,o));return i}},{key:"isNonEmpty",value:function(e){return this.width>0&&this.height>0}},{key:"containsRect",value:function(e){return this.x<=e.x&&this.y<=e.y&&e.maxX()<=this.maxX()&&e.maxY()<=this.maxY()}},{key:"intersects",value:function(e){return this.intersection(e).isNonEmpty()}},{key:"containsPoint",value:function(e){return this.x<=e.x&&e.x<=this.x+this.width&&this.y<=e.y&&e.y<=this.y+this.height}},{key:"translatedBy",value:function(t){return new e(this.x+t.x,this.y+t.y,this.width,this.height)}},{key:"scaleByRect",value:function(t){return new e(this.x+t.x*this.width,this.y+t.y*this.height,t.width*this.width,t.height*this.height)}},{key:"scaleRectIn",value:function(t){return new e((this.x-t.x)/t.width,(this.y-t.y)/t.height,this.width/t.width,this.height/t.height)}},{key:"scaleRectTo",value:function(e){var t,n,r;return this.width>this.height?n=this.width:t=this.height,r=n?e.width/n:e.height/t,this.withExtent(this.extent().scaleBy(r)).withCenter(this.center())}},{key:"expandBy",value:function(e){return this.insetBy(0-e)}},{key:"translateForInclusion",value:function(e){var t=e.x,n=e.y,r=t+e.width,i=n+e.height;return r>this.right()&&(t-=r-this.right()),i>this.bottom()&&(n-=i-this.bottom()),t<this.x&&(t=this.x),n<this.y&&(n=this.y),j(t,n,e.width,e.height)}},{key:"transformRectForInclusion",value:function(e){var t=this.topLeft().maxPt(e.topLeft()),n=t.addPt(e.extent());return j(t,this.bottomRight().minPt(n))}},{key:"insetByRect",value:function(t){return new e(this.x+t.left(),this.y+t.top(),this.width-(t.left()+t.right()),this.height-(t.top()+t.bottom()))}},{key:"outsetByRect",value:function(t){return new e(this.x-t.left(),this.y-t.top(),this.width+(t.left()+t.right()),this.height+(t.top()+t.bottom()))}},{key:"intersection",value:function(t){var n=Math.max(this.x,t.x),r=Math.max(this.y,t.y);return new e(n,r,Math.min(this.x+this.width,t.x+t.width)-n,Math.min(this.y+this.height,t.y+t.height)-r)}},{key:"union",value:function(e){return j(this.topLeft().minPt(e.topLeft()),this.bottomRight().maxPt(e.bottomRight()))}},{key:"lineIntersection",value:function(e){return this.edges().map(function(t){return t.intersection(e)}).filter(function(e){return!!e})}},{key:"dist",value:function(e){var t=this.closestPointToPt(e.center()),n=e.closestPointToPt(t);return t.dist(n)}},{key:"relativeToAbsPoint",value:function(e){return new C(this.x+this.width*e.x,this.y+this.height*e.y)}},{key:"closestPointToPt",value:function(e){return M(Math.min(Math.max(this.x,e.x),this.maxX()),Math.min(Math.max(this.y,e.y),this.maxY()))}},{key:"maxX",value:function(){return this.x+this.width}},{key:"maxY",value:function(){return this.y+this.height}},{key:"realWidth",value:function(){return this.x<0?-this.x+this.width:this.width}},{key:"realHeight",value:function(){return this.y<0?-this.y+this.height:this.height}},{key:"area",value:function(){var e=this.width*this.height;return(this.width<0&&this.height<0?-1:1)*e}},{key:"randomPoint",value:function(){return C.random(M(this.width,this.height)).addPt(this.topLeft())}},{key:"constrainPt",value:function(e){return e.maxPt(this.topLeft()).minPt(this.bottomRight())}},{key:"left",value:function(){return this.x}},{key:"right",value:function(){return this.maxX()}},{key:"top",value:function(){return this.y}},{key:"bottom",value:function(){return this.maxY()}},{key:"toInsetTuple",value:function(){return[this.left(),this.top(),this.right(),this.bottom()]}},{key:"toAttributeValue",value:function(e){var t=[this.left()];return this.top()===this.bottom()&&this.left()===this.right()?this.top()===this.left()&&t.push(this.top()):t=t.concat([this.top(),this.right(),this.bottom()]),t.invoke("roundTo",.01)}},{key:"toLiteral",value:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}}},{key:"partNamed",value:function(e){return this[e].call(this)}},{key:"withPartNamed",value:function(e,t){return this[this.setterName(e)].call(this,t)}},{key:"setterName",value:function(e){return"with"+e[0].toUpperCase()+e.slice(1)}},{key:"partNameNear",value:function(e,t,n){var r=this.partNameNearest(e,t);return t.dist(this.partNamed(r))<n?r:null}},{key:"partNameNearest",value:function(e,t){for(var n=1e99,r=e[0],i=0;i<e.length;i++){r=e[i];var o=t.dist(this.partNamed(r));if(o<n){var a=r;n=o}}return a}},{key:"toString",value:function(){return t.string.format("rect(%s,%s,%s,%s)",this.x,this.y,this.width,this.height)}},{key:"__serialize__",value:function(){return{__expr__:this.toString(),bindings:{"lively.graphics/geometry-2d.js":["rect"]}}}},{key:"isRectangle",get:function(){return!0}}]),e}(),R=function(){function e(t,n,i){if(r(this,e),t)if(t instanceof C){var o=t,a=n||0;void 0===(i=i)&&(i=M(1,1)),this.a=this.ensureNumber(i.x*Math.cos(a)),this.b=this.ensureNumber(i.y*Math.sin(a)),this.c=this.ensureNumber(i.x*-Math.sin(a)),this.d=this.ensureNumber(i.y*Math.cos(a)),this.e=this.ensureNumber(o.x),this.f=this.ensureNumber(o.y),this.a>1&&(this.a=Math.round(this.a*Math.pow(10,2))/Math.pow(10,2)),this.d>1&&(this.d=Math.round(this.d*Math.pow(10,2))/Math.pow(10,2))}else this.fromMatrix(t);else this.a=this.d=1,this.b=this.c=this.e=this.f=0}return i(e,[{key:"exp",get:function(){return 1e-4}}]),i(e,[{key:"copy",value:function(){return new e(this)}},{key:"fromMatrix",value:function(e){this.a=this.ensureNumber(e.a),this.b=this.ensureNumber(e.b),this.c=this.ensureNumber(e.c),this.d=this.ensureNumber(e.d),this.e=this.ensureNumber(e.e),this.f=this.ensureNumber(e.f)}},{key:"getRotation",value:function(){var e=t.num.toDegrees(Math.atan2(-this.c,this.a));return Math.abs(e)<this.eps?0:e}},{key:"getScale",value:function(){var e=this.a,t=this.c,n=Math.sqrt(e*e+t*t);return Math.abs(n-1)<this.eps?1:n}},{key:"getScalePoint",value:function(){var e=this.a,t=this.b,n=this.c,r=this.d,i=Math.sqrt(e*e+n*n),o=Math.atan2(-n,e);return M(i,Math.abs(t)>Math.abs(r)?t/Math.sin(o):r/Math.cos(o))}},{key:"getTranslation",value:function(){return M(this.e,this.f)}},{key:"isTranslation",value:function(){return 1==this.a&&0==this.b&&0==this.c&&1==this.d}},{key:"toSVGAttributeValue",value:function(){var e=this.getTranslation(),t="translate("+e.x+","+e.y+")",n=this.getRotation(),r=this.getScalePoint();return 0!=n&&(t+=" rotate("+this.getRotation()+")"),1==r.x&&1==r.y||(t+=" scale("+r.x+","+r.y+")"),t}},{key:"toCSSValue",value:function(e){var t="",n=this.getTranslation();if(t+="translate("+n.x.toFixed(2)+"px,"+n.y.toFixed(2)+"px)",e){var r=e.width/2,i=e.height/2;t+=" translate("+r.toFixed(2)+"px,"+i.toFixed(2)+"px)"}if(0!=this.getRotation()&&(t+=" rotate("+this.getRotation().toFixed(2)+"deg)"),e){r=e.width/2,i=e.height/2;t+=" translate("+(-1*r).toFixed(2)+"px,"+(-1*i).toFixed(2)+"px)"}var o=this.getScalePoint();return 1==o.x&&1==o.y||(t+=" scale("+o.x.toFixed(2)+","+o.y.toFixed(2)+")"),t}},{key:"toCSSTransformString",value:function(){var e=this.getRotation(),t=this.getScale();return"translate("+this.e+"px,"+this.f+"px) rotate("+e+"deg) scale("+t+","+t+")"}},{key:"toString",value:function(){return this.toCSSTransformString()}},{key:"toMatrix",value:function(){return this.copy()}},{key:"transformPoint",value:function(e,t){return e.matrixTransform(this,t)}},{key:"transformDirection",value:function(e,t){return e.matrixTransformDirection(this,t)}},{key:"matrixTransformForMinMax",value:function(e,t,n){var r=this.a*e.x+this.c*e.y+this.e,i=this.b*e.x+this.d*e.y+this.f;r>n.x&&(n.x=r),i>n.y&&(n.y=i),r<t.x&&(t.x=r),i<t.y&&(t.y=i)}},{key:"transformRectToRect",value:function(e){var t=M(1/0,1/0),n=M(-1/0,-1/0);return this.matrixTransformForMinMax(e.topLeft(),t,n),this.matrixTransformForMinMax(e.bottomRight(),t,n),this.isTranslation()||(this.matrixTransformForMinMax(e.topRight(),t,n),this.matrixTransformForMinMax(e.bottomLeft(),t,n)),j(t,n)}},{key:"preConcatenate",value:function(e){var t=this.matrix_||this.toMatrix();return this.a=e.a*t.a+e.c*t.b,this.b=e.b*t.a+e.d*t.b,this.c=e.a*t.c+e.c*t.d,this.d=e.b*t.c+e.d*t.d,this.e=e.a*t.e+e.c*t.f+e.e,this.f=e.b*t.e+e.d*t.f+e.f,this.matrix_=this.toMatrix(),this}},{key:"invert",value:function(){var e=this.copy(),t=1/(e.a*e.d-e.c*e.b);return this.a=e.d*t,this.b=-e.b*t,this.c=-e.c*t,this.d=e.a*t,this.e=(e.c*e.f-e.e*e.d)*t,this.f=-(e.a*e.f-e.b*e.e)*t,this}},{key:"inverse",value:function(){var e=this.matrix_||this.toMatrix(),t=new this.constructor(e);return t.invert(),t}},{key:"ensureNumber",value:function(e){if(isNaN(e))throw new Error("not a number");return e}},{key:"__serialize__",value:function(){return{__expr__:"new Transform({a: "+this.a+", b: "+this.b+", c: "+this.c+", d: "+this.d+", e: "+this.e+", f: "+this.f+"})",bindings:{"lively.graphics/geometry-2d.js":["Transform"]}}}},{key:"isTransform",get:function(){return!0}}]),e}(),T=function(){function e(t,n){r(this,e),this.start=t,this.end=n}return i(e,null,[{key:"fromCoords",value:function(t,n,r,i){return new e(M(t,n),M(r,i))}}]),i(e,[{key:"withStart",value:function(t){return new e(t,this.end)}},{key:"withEnd",value:function(t){return new e(this.start,t)}},{key:"sampleN",value:function(e){e=e||10;for(var t=this.end.subPt(this.start).scaleBy(1/e),n=[],r=0;r<=e;r++)n.push(this.start.addPt(t.scaleBy(r)));return n}},{key:"sample",value:function(e){return this.sampleN(this.length()/e)}},{key:"length",value:function(){return this.start.dist(this.end)}},{key:"equals",value:function(e){return!!e&&(this.start.eqPt(e.start)&&this.end.eqPt(e.end))}},{key:"includesPoint",value:function(e,t){var n=this.start.x,r=this.start.y,i=this.end.x,o=this.end.y,a=e.x,s=e.y,u=(i-n)*(s-r)-(a-n)*(o-r)==0;if(t||!u)return u;var c=Math.min(n,i),l=Math.min(r,o),f=Math.max(n,i),h=Math.max(r,o);return c<=a&&a<=f&&l<=s&&s<=h}},{key:"intersection",value:function(e,n){var r=this.start,i=this.end,o=e.start,a=e.end,s=r.x,u=r.y,c=i.x,l=i.y,f=o.x,h=o.y,p=a.x,d=a.y,y=((s*l-u*c)*(f-p)-(s-c)*(f*d-h*p))/((s-c)*(h-d)-(u-l)*(f-p)),g=((s*l-u*c)*(h-d)-(u-l)*(f*d-h*p))/((s-c)*(h-d)-(u-l)*(f-p));return y===1/0||g===1/0?null:n||t.num.between(y,s,c,1e-4)&&t.num.between(g,u,l,1e-4)&&t.num.between(y,f,p,1e-4)&&t.num.between(g,h,d,1e-4)?M(y,g):null}},{key:"perpendicularLine",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"cc",i=this.start,o=this.toVector(),a=i.addPt(o.scaleBy(t)),s=o.theta()+("cc"===r?-1:1)*Math.PI/2;return new e(a,a.addPt(C.polar(n,s)))}},{key:"toVector",value:function(){var e=this.start;return this.end.subPt(e)}},{key:"toString",value:function(){return t.string.format("Line((%s,%s), (%s,%s))",this.start.x,this.start.y,this.end.x,this.end.y)}},{key:"__serialize__",value:function(){return{__expr__:"Line.fromCoords("+this.start.x+", "+this.start.y+", "+this.end.x+", "+this.end.y+")",bindings:{"lively.graphics/geometry-2d.js":["Line"]}}}},{key:"isLine",get:function(){return!0}}]),e}();function j(e,t,n,r){var i,o,a,s;return"number"==typeof e?(i=e,o=t,a=n,s=r):(i=e.x,o=e.y,a=t.x-i,s=t.y-o),new P(i,o,a,s)}function M(e,t){return new C(e,t)}function N(e){return Math.floor(255.99*e)}var I=new RegExp("\\s*rgba?\\s*\\(\\s*(\\d+)(%?)\\s*,\\s*(\\d+)(%?)\\s*,\\s*(\\d+)(%?)\\s*(?:,\\s*([0-9\\.]+)\\s*)?\\)\\s*"),D=function(){function e(){r(this,e)}return i(e,[{key:"offsets",value:function(){return null}},{key:"stepCount",value:function(){return 0}},{key:"stepSize",value:function(){return 0}},{key:"chord",value:function(e){var n=this,r=e.hue,i=e.saturation,o=e.brightness;return(this.offsets()||t.arr.range(0,this.steps()).map(function(e){return e*n.stepSize()})).map(function(e){return q.hsb(r+e%360,i,o)})}},{key:"name",get:function(){return"Color Harmony"}}]),e}(),B=function(e){function t(){return r(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,D),i(t,[{key:"steps",value:function(){return 1}},{key:"stepSize",value:function(){return 180}},{key:"name",get:function(){return"Complement"}}]),t}(),L=function(e){function t(){return r(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,D),i(t,[{key:"steps",value:function(){return 2}},{key:"stepSize",value:function(){return 120}},{key:"name",get:function(){return"Triadic"}}]),t}(),$=function(e){function t(){return r(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,D),i(t,[{key:"offsets",value:function(){return[0,60,180,240]}},{key:"name",get:function(){return"Tetradic"}}]),t}(),W=function(e){function t(){return r(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,D),i(t,[{key:"steps",value:function(){return 3}},{key:"stepSize",value:function(){return 90}},{key:"name",get:function(){return"Quadratic"}}]),t}(),G=function(e){function t(){return r(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,D),i(t,[{key:"steps",value:function(){return 5}},{key:"offsets",value:function(){return[-60,-30,0,30,60]}},{key:"name",get:function(){return"Analogous"}}]),t}(),U=function(e){function t(){return r(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,D),i(t,[{key:"offsets",value:function(){return[-30,-15,0,15,30]}},{key:"name",get:function(){return"Neutral"}}]),t}(),q=function(){function e(t,n,i,o){r(this,e),this.r=t||0,this.g=n||0,this.b=i||0,this.a=o||(0===o?0:1)}return i(e,[{key:"isColor",get:function(){return!0}}],[{key:"random",value:function(n,r){return void 0===n&&(n=0),void 0===r&&(r=255),e.rgb(t.num.random(n,r),t.num.random(n,r),t.num.random(n,r))}},{key:"hsb",value:function(t,n,r){var i=n,o=r;if(0==n)return new e(o,o,o);var a=t%360/60,s=Math.floor(a),u=a-s,c=(1-i)*o,l=(1-i*u)*o,f=(1-i*(1-u))*o;switch(s){case 0:return new e(o,f,c);case 1:return new e(l,o,c);case 2:return new e(c,o,f);case 3:return new e(c,l,o);case 4:return new e(f,c,o);case 5:return new e(o,c,l);default:return new e(0,0,0)}}},{key:"wheel",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return e.wheelHsb(t,0,.9,.7)}},{key:"wheelHsb",value:function(t,n,r,i){for(var o=new Array(t),a=360/Math.max(t,1),s=0;s<t;s++)o[s]=e.hsb(n+s*a,r,i);return o}},{key:"rgb",value:function(t,n,r){return new e(t/255,n/255,r/255)}},{key:"rgbHex",value:function(t){var n=this.parseHex(t);return n&&n[0]>=0&&n[1]>=0&&n[2]>=0?new e(n[0],n[1],n[2]):null}},{key:"rgba",value:function(t,n,r,i){return new e(t/255,n/255,r/255,i)}},{key:"fromLiteral",value:function(t){return new e(t.r,t.g,t.b,t.a)}},{key:"fromTuple",value:function(t){return new e(t[0],t[1],t[2],t[3])}},{key:"fromTuple8Bit",value:function(t){return new e(t[0]/255,t[1]/255,t[2]/255,t[3]/255)}},{key:"fromString",value:function(e){return e&&"none"!==e?this.fromTuple(this.parse(e)):null}},{key:"parse",value:function(e){var t;return e&&"none"!==e?[(t=function(e){var t=new w(e);return{red:t.red()/255,green:t.green()/255,blue:t.blue()/255,alpha:t.alpha()}}(e)).red,t.green,t.blue,t.alpha]:null}},{key:"parseRGB",value:function(e){var t=e.match(this.rgbaRegex);return t?[parseInt(t[1])/(t[2]?100:255),parseInt(t[3])/(t[4]?100:255),parseInt(t[5])/(t[6]?100:255),t[7]?parseFloat(t[7]):1]:null}},{key:"parseHex",value:function(e){for(var t,n,r,i="",o=0;o<e.length;o++){var a=e[o].toLowerCase();"a"!=a&&"b"!=a&&"c"!=a&&"d"!=a&&"e"!=a&&"f"!=a&&"0"!=a&&"1"!=a&&"2"!=a&&"3"!=a&&"4"!=a&&"5"!=a&&"6"!=a&&"7"!=a&&"8"!=a&&"9"!=a||(i+=a)}if(6==i.length)t=i.substring(0,2),n=i.substring(2,4),r=i.substring(4,6);else{if(3!=i.length)return null;t=i.substring(0,1),t+=t,n=i.substring(1,2),n+=n,r=i.substring(2,3),r+=r}return[parseInt(t,16)/255,parseInt(n,16)/255,parseInt(r,16)/255]}},{key:"rgbaRegex",get:function(){return I}},{key:"named",get:function(){return this._named?this._named:this._named={black:new e(0,0,0),almostBlack:e.rgb(64,64,64),white:new e(1,1,1),gray:new e(.8,.8,.8),red:new e(.8,0,0),green:new e(0,.8,0),yellow:new e(.8,.8,0),blue:new e(0,0,.8),purple:new e(1,0,1),magenta:new e(1,0,1),pink:e.rgb(255,30,153),turquoise:e.rgb(0,240,255),tangerine:e.rgb(242,133,0),orange:e.rgb(255,153,0),cyan:e.rgb(0,255,255),brown:e.rgb(182,67,0),limeGreen:e.rgb(51,255,0),darkGray:e.rgb(102,102,102),lightGray:e.rgb(230,230,230),veryLightGray:e.rgb(243,243,243),transparent:e.rgba(0,0,0,0)}}}]),i(e,[{key:"grayValue",value:function(){return(this.r+this.g+this.b)/3}},{key:"equals",value:function(e){return!!e&&(this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a)}},{key:"darker",value:function(t){var n=this.mixedWith(e.black,.5);return t>1?n.darker(t-1):n}},{key:"lighter",value:function(t){if(0==t)return this;var n=this.mixedWith(e.white,.5);return t>1?n.lighter(t-1):n}},{key:"toString",value:function(){return 1===this.a?"rgb("+N(this.r)+","+N(this.g)+","+N(this.b)+")":this.toRGBAString()}},{key:"toRGBAString",value:function(){function e(e){return Math.floor(255.99*e)}return"rgba("+e(this.r)+","+e(this.g)+","+e(this.b)+","+this.a+")"}},{key:"toHexString",value:function(){function e(e){return Math.floor(255.99*e)}function t(e){for(var t=e;t.length<2;)t="0"+t;return t}return t(e(this.r).toString(16))+t(e(this.g).toString(16))+t(e(this.b).toString(16))}},{key:"toTuple",value:function(){return[this.r,this.g,this.b,this.a]}},{key:"toTuple8Bit",value:function(){return[255*this.r,255*this.g,255*this.b,255*this.a]}},{key:"toHSB",value:function(){var e,t=Math.max(this.r,this.g,this.b),n=Math.min(this.r,this.g,this.b),r=t;return t==n?e=0:t==this.r?e=60*(0+(this.g-this.b)/(t-n)):t==this.g?e=60*(2+(this.b-this.r)/(t-n)):t==this.b&&(e=60*(4+(this.r-this.g)/(t-n))),[e=(e+360)%360,0==t?0:(t-n)/t,r]}},{key:"withA",value:function(t){return new e(this.r,this.g,this.b,t)}},{key:"mixedWith",value:function(t,n){var r=n,i=1-r;return new e(this.r*r+t.r*i,this.g*r+t.g*i,this.b*r+t.b*i,this.a*r+t.a*i)}},{key:"invert",value:function(){return e.rgb(255*(1-this.r),255*(1-this.g),255*(1-this.b))}},{key:"toCSSString",value:function(){return this.toRGBAString()}},{key:"__serialize__",value:function(){return{__expr__:"Color."+this.toString(),bindings:{"lively.graphics/color.js":["Color"]}}}},{key:"toJSExpr",value:function(){return"Color."+(this.name||this.toString())}},{key:"name",get:function(){var t=this,n=e.named;return Object.keys(n).find(function(e){return n[e].equals(t)})}}]),e}();Object.assign(q,q.named);var H=function(){function e(t){r(this,e),this.stops=t?t.map(function(e){return e}):[]}return i(e,null,[{key:"create",value:function(e){var t=[];for(var n in e)t.push({offset:Number(n),color:e[n]});return new this({stops:t})}}]),i(e,[{key:"equals",value:function(e){return!(!e||!e.isGradient)&&this.toString()==e.toString()}},{key:"getStopsLighter",value:function(e){return t.arr.collect(this.stops,function(t){return{offset:t.offset,color:t.color.lighter(e)}})}},{key:"getStopsDarker",value:function(e){return t.arr.collect(this.stops,function(t){return{offset:t.offset,color:t.color.darker(e)}})}},{key:"isGradient",get:function(){return!0}}]),e}(),z=function(e){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.stops,i=e.vector;r(this,n);var o=a(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return o.vector=i,o}return o(n,H),i(n,[{key:"angleToRect",value:function(e){return C.polar(1,e).extentAsRectangle().withCenter(M(.5,.5))}},{key:"vectorAsAngle",value:function(){return this.vector.extent().theta()}},{key:"toString",value:function(){return this.toCSSString()}},{key:"lighter",value:function(e){return new this.constructor({stops:this.getStopsLighter(e),vector:this.vector})}},{key:"darker",value:function(){return new this.constructor({stops:this.getStopsDarker(),vector:this.vector})}},{key:"toCSSString",value:function(){var e="linear-gradient("+(t.num.toDegrees(this.vectorAsAngle())+90)+"deg,";return e+=this.stops.map(function(e){return e.color.toRGBAString()+" "+(100*e.offset).toFixed()+"%"}).join(","),e+=")"}},{key:"toJSExpr",value:function(){return"new LinearGradient({stops: ["+this.stops.map(function(e){return"{offset: "+e.offset+", color: "+e.color.toJSExpr()+"}"}).join(", ")+"], vector: "+(t.num.toDegrees(this.vectorAsAngle())-90)+"})"}},{key:"type",get:function(){return"linearGradient"}},{key:"vectors",get:function(){return{northsouth:j(M(0,0),M(0,1)),northeast:j(M(1,0),M(0,1)),westeast:j(M(1,0),M(0,0)),southeast:j(M(1,1),M(0,0)),southnorth:j(M(0,1),M(0,0)),southwest:j(M(0,1),M(1,0)),eastwest:j(M(0,0),M(1,0)),northwest:j(M(0,0),M(1,1))}}},{key:"vector",get:function(){return this._vector},set:function(e){this._vector=e?"string"==typeof e?this.vectors[e.toLowerCase()]:"number"==typeof e?this.angleToRect(e):e:this.vectors.northsouth}}]),n}(),K=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.stops,i=e.focus,o=e.bounds;r(this,t);var s=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n));return s.focus=i||M(.5,.5),s.bounds=o||new P(0,0,20,20),s}return o(t,H),i(t,[{key:"toString",value:function(){return this.toCSSString()}},{key:"lighter",value:function(e){return new this.constructor({stops:this.getStopsLighter(e),focus:this.focus,bounds:this.bounds})}},{key:"darker",value:function(){return new this.constructor({stops:this.getStopsDarker(),focus:this.focus,bounds:this.bounds})}},{key:"toCSSString",value:function(){for(var e=this.focus.scaleBy(100),t=this.bounds.extent(),n="radial-gradient("+t.x/2+"px "+t.y/2+"px at "+e.x+"% "+e.y+"%",r=0;r<this.stops.length;r++)n+=","+this.stops[r].color.toRGBAString()+" "+(100*this.stops[r].offset).toFixed()+"%";return n+=")"}},{key:"type",get:function(){return"radialGradient"}}]),t}();e.Complementary=B,e.Triadic=L,e.Tetradic=$,e.Quadratic=W,e.Analogous=G,e.Neutral=U,e.Color=q,e.LinearGradient=z,e.RadialGradient=K,e.flatDesignColors=["#1abc9c","#e8f8f5","#d1f2eb","#a3e4d7","#76d7c4","#48c9b0","#1abc9c","#17a589","#148f77","#117864","#0e6251","#16a085","#e8f6f3","#d0ece7","#a2d9ce","#73c6b6","#45b39d","#16a085","#138d75","#117a65","#0e6655","#0b5345","#2ecc71","#eafaf1","#d5f5e3","#abebc6","#82e0aa","#58d68d","#2ecc71","#28b463","#239b56","#1d8348","#186a3b","#27ae60","#e9f7ef","#d4efdf","#a9dfbf","#7dcea0","#52be80","#27ae60","#229954","#1e8449","#196f3d","#145a32","#3498db","#ebf5fb","#d6eaf8","#aed6f1","#85c1e9","#5dade2","#3498db","#2e86c1","#2874a6","#21618c","#1b4f72","#2980b9","#eaf2f8","#d4e6f1","#a9cce3","#7fb3d5","#5499c7","#2980b9","#2471a3","#1f618d","#1a5276","#154360","#9b59b6","#f5eef8","#ebdef0","#d7bde2","#c39bd3","#af7ac5","#9b59b6","#884ea0","#76448a","#633974","#512e5f","#8e44ad","#f4ecf7","#e8daef","#d2b4de","#bb8fce","#a569bd","#8e44ad","#7d3c98","#6c3483","#5b2c6f","#4a235a","#34495e","#ebedef","#d6dbdf","#aeb6bf","#85929e","#5d6d7e","#34495e","#2e4053","#283747","#212f3c","#1b2631","#2c3e50","#eaecee","#d5d8dc","#abb2b9","#808b96","#566573","#2c3e50","#273746","#212f3d","#1c2833","#17202a","#f1c40f","#fef9e7","#fcf3cf","#f9e79f","#f7dc6f","#f4d03f","#f1c40f","#d4ac0d","#b7950b","#9a7d0a","#7d6608","#f39c12","#fef5e7","#fdebd0","#fad7a0","#f8c471","#f5b041","#f39c12","#d68910","#b9770e","#9c640c","#7e5109","#e67e22","#fdf2e9","#fae5d3","#f5cba7","#f0b27a","#eb984e","#e67e22","#ca6f1e","#af601a","#935116","#784212","#d35400","#fbeee6","#f6ddcc","#edbb99","#e59866","#dc7633","#d35400","#ba4a00","#a04000","#873600","#6e2c00","#e74c3c","#fdedec","#fadbd8","#f5b7b1","#f1948a","#ec7063","#e74c3c","#cb4335","#b03a2e","#943126","#78281f","#c0392b","#f9ebea","#f2d7d5","#e6b0aa","#d98880","#cd6155","#c0392b","#a93226","#922b21","#7b241c","#641e16","#ecf0f1","#fdfefe","#fbfcfc","#f7f9f9","#f4f6f7","#f0f3f4","#ecf0f1","#d0d3d4","#b3b6b7","#979a9a","#7b7d7d","#bdc3c7","#f8f9f9","#f2f3f4","#e5e7e9","#d7dbdd","#cacfd2","#bdc3c7","#a6acaf","#909497","#797d7f","#626567","#95a5a6","#f4f6f6","#eaeded","#d5dbdb","#bfc9ca","#aab7b8","#95a5a6","#839192","#717d7e","#5f6a6a","#4d5656","#7f8c8d","#f2f4f4","#e5e8e8","#ccd1d1","#b2babb","#99a3a4","#7f8c8d","#707b7c","#616a6b","#515a5a","#424949"],e.materialDesignColors=["#f44336","#ffebee","#ffcdd2","#ef9a9a","#e57373","#ef5350","#f44336","#e53935","#d32f2f","#c62828","#b71c1c","#ff8a80","#ff5252","#ff1744","#d50000","#e91e63","#fce4ec","#f8bbd0","#f48fb1","#f06292","#ec407a","#e91e63","#d81b60","#c2185b","#ad1457","#880e4f","#ff80ab","#ff4081","#f50057","#c51162","#9c27b0","#f3e5f5","#e1bee7","#ce93d8","#ba68c8","#ab47bc","#9c27b0","#8e24aa","#7b1fa2","#6a1b9a","#4a148c","#ea80fc","#e040fb","#d500f9","#aa00ff","#673ab7","#ede7f6","#d1c4e9","#b39ddb","#9575cd","#7e57c2","#673ab7","#5e35b1","#512da8","#4527a0","#311b92","#b388ff","#7c4dff","#651fff","#6200ea","#3f51b5","#e8eaf6","#c5cae9","#9fa8da","#7986cb","#5c6bc0","#3f51b5","#3949ab","#303f9f","#283593","#1a237e","#8c9eff","#536dfe","#3d5afe","#304ffe","#2196f3","#e3f2fd","#bbdefb","#90caf9","#64b5f6","#42a5f5","#2196f3","#1e88e5","#1976d2","#1565c0","#0d47a1","#82b1ff","#448aff","#2979ff","#2962ff","#03a9f4","#e1f5fe","#b3e5fc","#81d4fa","#4fc3f7","#29b6f6","#03a9f4","#039be5","#0288d1","#0277bd","#01579b","#80d8ff","#40c4ff","#00b0ff","#0091ea","#00bcd4","#e0f7fa","#b2ebf2","#80deea","#4dd0e1","#26c6da","#00bcd4","#00acc1","#0097a7","#00838f","#006064","#84ffff","#18ffff","#00e5ff","#00b8d4","#009688","#e0f2f1","#b2dfdb","#80cbc4","#4db6ac","#26a69a","#009688","#00897b","#00796b","#00695c","#004d40","#a7ffeb","#64ffda","#1de9b6","#00bfa5","#4caf50","#e8f5e9","#c8e6c9","#a5d6a7","#81c784","#66bb6a","#4caf50","#43a047","#388e3c","#2e7d32","#1b5e20","#b9f6ca","#69f0ae","#00e676","#00c853","#8bc34a","#f1f8e9","#dcedc8","#c5e1a5","#aed581","#9ccc65","#8bc34a","#7cb342","#689f38","#558b2f","#33691e","#ccff90","#b2ff59","#76ff03","#64dd17","#cddc39","#f9fbe7","#f0f4c3","#e6ee9c","#dce775","#d4e157","#cddc39","#c0ca33","#afb42b","#9e9d24","#827717","#f4ff81","#eeff41","#c6ff00","#aeea00","#ffeb3b","#fffde7","#fff9c4","#fff59d","#fff176","#ffee58","#ffeb3b","#fdd835","#fbc02d","#f9a825","#f57f17","#ffff8d","#ffff00","#ffea00","#ffd600","#ffc107","#fff8e1","#ffecb3","#ffe082","#ffd54f","#ffca28","#ffc107","#ffb300","#ffa000","#ff8f00","#ff6f00","#ffe57f","#ffd740","#ffc400","#ffab00","#ff9800","#fff3e0","#ffe0b2","#ffcc80","#ffb74d","#ffa726","#ff9800","#fb8c00","#f57c00","#ef6c00","#e65100","#ffd180","#ffab40","#ff9100","#ff6d00","#ff5722","#fbe9e7","#ffccbc","#ffab91","#ff8a65","#ff7043","#ff5722","#f4511e","#e64a19","#d84315","#bf360c","#ff9e80","#ff6e40","#ff3d00","#dd2c00","#795548","#efebe9","#d7ccc8","#bcaaa4","#a1887f","#8d6e63","#795548","#6d4c41","#5d4037","#4e342e","#3e2723","#9e9e9e","#fafafa","#f5f5f5","#eeeeee","#e0e0e0","#bdbdbd","#9e9e9e","#757575","#616161","#424242","#212121","#607d8b","#eceff1","#cfd8dc","#b0bec5","#90a4ae","#78909c","#607d8b","#546e7a","#455a64","#37474f","#263238","#ffffff","#000000"],e.webSafeColors=["ccff00","ccff33","ccff66","ccff99","ccffcc","ccffff","ffffff","ffffcc","ffff99","ffff66","ffff33","ffff00","cccc00","cccc33","cccc66","cccc99","cccccc","ccccff","ffccff","ffcccc","ffcc99","ffcc66","ffcc33","ffcc00","cc9900","cc9933","cc9966","cc9999","cc99cc","cc99ff","ff99ff","ff99cc","ff9999","ff9966","ff9933","ff9900","cc6600","cc6633","cc6666","cc6699","cc66cc","cc66ff","ff66ff","ff66cc","ff6699","ff6666","ff6633","ff6600","cc3300","cc3333","cc3366","cc3399","cc33cc","cc33ff","ff33ff","ff33cc","ff3399","ff3366","ff3333","ff3300","cc0000","cc0033","cc0066","cc0099","cc00cc","cc00ff","ff00ff","ff00cc","ff0099","ff0066","ff0033","ff0000","660000","660033","660066","660099","6600cc","6600ff","9900ff","9900cc","990099","990066","990033","990000","663300","663333","663366","663399","6633cc","6633ff","9933ff","9933cc","993399","993366","993333","993300","666600","666633","666666","666699","6666cc","6666ff","9966ff","9966cc","996699","996666","996633","996600","669900","669933","669966","669999","6699cc","6699ff","9999ff","9999cc","999999","999966","999933","999900","66cc00","66cc33","66cc66","66cc99","66cccc","66ccff","99ccff","99cccc","99cc99","99cc66","99cc33","99cc00","66ff00","66ff33","66ff66","66ff99","66ffcc","66ffff","99ffff","99ffcc","99ff99","99ff66","99ff33","99ff00","00ff00","00ff33","00ff66","00ff99","00ffcc","00ffff","33ffff","33ffcc","33ff99","33ff66","33ff33","33ff00","00cc00","00cc33","00cc66","00cc99","00cccc","00ccff","33ccff","33cccc","33cc99","33cc66","33cc33","33cc00","009900","009933","009966","009999","0099cc","0099ff","3399ff","3399cc","339999","339966","339933","339900","006600","006633","006666","006699","0066cc","0066ff","3366ff","3366cc","336699","336666","336633","336600","003300","003333","003366","003399","0033cc","0033ff","3333ff","3333cc","333399","333366","333333","333300","000000","000033","000066","000099","0000cc","0000ff","3300ff","3300cc","330099","330066","330033","330000"],e.Point=C,e.Rectangle=P,e.Transform=R,e.Line=T,e.rect=j,e.pt=M}(this.lively.graphics=this.lively.graphics||{},lively.lang),"undefined"!=typeof module&&module.exports&&(module.exports=GLOBAL.lively.graphics)}();
//LIVELY.BINDINGS
!function(){var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(t,e){"use strict";function n(t,e,n,r,o){"function"!=typeof n||void 0!==r&&"object"!==(void 0===r?"undefined":i(r))||(o=r,r="call",o||(o={}),o.updater||(o.updater=function(t,e){return t(null,e)}));var a,s=t.getConnectionPoints&&t.getConnectionPoints()||t.connections,c=s&&s[e],l=c&&c.map&&lively.morphic&&lively.morphic.GeometryConnection||c&&c.connectionClassType&&lively.Class.forName(c.connectionClassType)||u;"function"==typeof o?(console.warn("Directly passing a converter function to connect() is deprecated! Use spec object instead!"),a={converter:o}):a=o,c&&(a=lively.lang.obj.merge(c,a));var h=new l(t,e,n,r,a),f=h.getExistingConnection();if(f)return f.resetSpec(),f.init(t,e,n,r,a),f;var d=h.connect();return"function"==typeof t.onConnect&&t.onConnect(e,n,r),c&&c.updateOnConnect&&h.update(t[e]),d}function r(t,e,r,i){null!=t[e]?r[i](t[e]):n(t,e,r,i,{removeAfterUpdate:!0})}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=(function(){function t(t){this.value=t}function e(e){function n(i,o){try{var a=e[i](o),s=a.value;s instanceof t?Promise.resolve(s.value).then(function(t){n("next",t)},function(t){n("throw",t)}):r(a.done?"return":"normal",a.value)}catch(t){r("throw",t)}}function r(t,e){switch(t){case"return":i.resolve({value:e,done:!0});break;case"throw":i.reject(e);break;default:i.resolve({value:e,done:!1})}(i=i.next)?n(i.key,i.arg):o=null}var i,o;this._invoke=function(t,e){return new Promise(function(r,a){var s={key:t,arg:e,resolve:r,reject:a,next:null};o?o=o.next=s:(i=o=s,n(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},u=function(){function t(e,n,r,i,a){o(this,t),this.init(e,n,r,i,a)}return a(t,[{key:"init",value:function(t,e,n,r,i){return this.doNotSerialize=["isActive","converter","updater","varMapping"],this.sourceObj=t,this.sourceAttrName=e,this.targetObj=n,this.targetMethodName=r,this.varMapping={source:t,target:n},(i=s({removeAfterUpdate:!1,forceAttributeConnection:!1,garbageCollect:!0,signalOnAssignment:!0},i)).removeAfterUpdate&&(this.removeAfterUpdate=!0),i.forceAttributeConnection&&(this.forceAttributeConnection=!0),"boolean"==typeof i.garbageCollect&&(this.garbageCollect=i.garbageCollect),"boolean"==typeof i.signalOnAssignment&&(this.signalOnAssignment=i.signalOnAssignment),i.converter&&this.setConverter(i.converter),i.updater&&this.setUpdater(i.updater),i.varMapping&&(this.varMapping=Object.assign(i.varMapping,this.varMapping)),this.getSpec(),this}},{key:"__additionally_serialize__",value:function(t,n,r,i){e.arr.equals(e.arr.without(Object.keys(this.varMapping),"_rev"),["source","target"])?t.props.varMapping&&delete t.props.varMapping:i("varMapping",this.varMapping)}},{key:"__after_deserialize__",value:function(t,e){this.varMapping||(this.varMapping={source:this.sourceObj,target:this.targetObj}),this.connect()}},{key:"onSourceAndTargetRestored",value:function(){this.sourceObj&&this.targetObj&&this.connect()}},{key:"copy",value:function(e){return t.fromLiteral(this.toLiteral(),e)}},{key:"fixInstanceAfterCopyingFromSite",value:function(t,e,n){this.disconnect()}},{key:"clone",value:function(){var t=new this.constructor(this.getSourceObj(),this.getSourceAttrName(),this.getTargetObj(),this.getTargetMethodName(),this.getSpec());return this.dependedBy&&(t.dependedBy=this.dependedBy),t}},{key:"getTargetObj",value:function(){return this.targetObj}},{key:"getSourceObj",value:function(){return this.sourceObj}},{key:"getSourceAttrName",value:function(){return this.sourceAttrName}},{key:"getTargetMethodName",value:function(){return this.targetMethodName}},{key:"getSourceValue",value:function(){return this.getSourceObj()[this.getSourceAttrName()]}},{key:"getPrivateSourceValue",value:function(){return this.sourceObj[this.privateAttrName(this.sourceAttrName)]}},{key:"getConverter",value:function(){return this.converterString?(this.converter||(this.converter=e.Closure.fromSource(this.converterString,this.varMapping).recreateFunc()),this.converter):null}},{key:"setConverter",value:function(t){return delete this.converter,this.converterString=t?String(t):null}},{key:"getUpdater",value:function(){return this.updaterString?(this.updater||(this.updater=e.Closure.fromSource(this.updaterString,this.varMapping).recreateFunc()),this.updater):null}},{key:"setUpdater",value:function(t){return delete this.updater,this.updaterString=t?String(t):null}},{key:"getSpec",value:function(){var t={};return this.updaterString&&(t.updater=this.getUpdater()),this.converterString&&(t.converter=this.getConverter()),this.removeAfterUpdate&&(t.removeAfterUpdate=!0),this.forceAttributeConnection&&(t.forceAttributeConnection=!0),this.hasOwnProperty("garbageCollect")&&(t.garbageCollect=this.garbageCollect),this.hasOwnProperty("signalOnAssignment")&&(t.signalOnAssignment=this.signalOnAssignment),t}},{key:"resetSpec",value:function(){delete this.garbageCollect,delete this.signalOnAssignment,delete this.removeAfterUpdate,delete this.forceAttributeConnection,delete this.converter,delete this.converterString,delete this.updater,delete this.updaterString}},{key:"privateAttrName",value:function(t){return"$$"+t}},{key:"activate",value:function(){this.isActive=!0}},{key:"deactivate",value:function(){delete this.isActive}},{key:"connect",value:function(){var t=this.getExistingConnection();t!==this&&(t&&t.disconnect(),this.addAttributeConnection());var e=this.sourceObj,n=this.sourceAttrName,r=this.forceAttributeConnection,i=e.__lookupSetter__(n),o=e.__lookupGetter__(n),a=!i&&!o&&(this.getSourceValue()||this.getPrivateSourceValue());return"function"!=typeof a||r?this.addSourceObjGetterAndSetter(o,i):a.isWrapped||this.addConnectionWrapper(e,n,a),this}},{key:"disconnect",value:function(){var t=this,e=this.sourceObj;if(!e||!e.attributeConnections)return this.removeSourceObjGetterAndSetter();e.attributeConnections=e.attributeConnections.filter(function(e){return!t.isSimilarConnection(e)});var n=e.attributeConnections.filter(function(e){return t.getSourceAttrName()==e.getSourceAttrName()});return 0==e.attributeConnections.length&&delete e.attributeConnections,0==n.length&&this.removeSourceObjGetterAndSetter(),null}},{key:"update",value:function(t,e){if(this.isActive)return null;var n=this,r=this.getUpdater(),i=this.getConverter(),o=this.targetObj,a=this.targetMethodName;if(!o||!a){var s="Cannot update "+this.toString(t)+" because of no target ("+o+") or targetProp ("+a+") ";return this.isWeakConnection&&this.disconnect(),console.error(s),null}var u=o[a],c=function(e,r,s,c,l,h){var f=[e,r,s,c,l,h];i&&(t=i.call(n,e,r),e=f[0]=t);var d="function"==typeof u?u.apply(o,f):o[a]=e;return n.removeAfterUpdate&&n.disconnect(),d};try{return this.isActive=!0,r?r.call(this,c,t,e):c(t,e)}catch(e){var l=this.sourceObj&&"function"==typeof this.sourceObj.world&&this.sourceObj.world()||this.targetObj&&"function"==typeof this.targetObj.world&&this.targetObj.world();l?l.logError(e,"AttributeConnection>>update: "):console.error("Error when trying to update "+this+" with value "+t+":\n"+e+"\n"+e.stack)}finally{delete this.isActive}return null}},{key:"addSourceObjGetterAndSetter",value:function(t,n){if(!(t&&t.isAttributeConnectionGetter||n&&n.isAttributeConnectionSetter)){var r=this.sourceObj,i=this.sourceAttrName,o=this.privateAttrName(i);r[o]&&console.warn("newAttrName "+o+" already exists.Are there already other connections?"),r.hasOwnProperty("doNotSerialize")||(r.doNotSerialize=[]),e.arr.pushIfNotIncluded(r.doNotSerialize,o),r.hasOwnProperty("doNotCopyProperties")||(r.doNotCopyProperties=[]),e.arr.pushIfNotIncluded(r.doNotCopyProperties,o),t&&r.__defineGetter__(o,t),n&&r.__defineSetter__(o,n),t||n||!r.hasOwnProperty(i)||(r[o]=r[i]),r.__defineSetter__(i,function(t){var e=r[o];return r[o]=t,void 0===r.attributeConnections?(console.error("Sth wrong with sourceObj, has no attributeConnections"),null):(r.attributeConnections.forEach(function(n){n&&n.getSourceAttrName()===i&&n.signalOnAssignment&&n.update(t,e)}),t)}),r.__lookupSetter__(i).isAttributeConnectionSetter=!0,r.__defineGetter__(i,function(){return r[o]}),r.__lookupGetter__(i).isAttributeConnectionGetter=!0}}},{key:"addConnectionWrapper",value:function(t,e,n){if("function"!=typeof n)throw new Error("addConnectionWrapper didnt get a method to wrap");t.hasOwnProperty(e)&&(t[this.privateAttrName(e)]=n),t[e]=function(){if(void 0===this.attributeConnections)throw new Error("[lively.bindings] Something is wrong with connection source object, it has no attributeConnections");for(var t=this.attributeConnections.slice(),n=this[e].originalFunction.apply(this,arguments),r=0;r<t.length;r++){var i=t[r];i.getSourceAttrName()===e&&i.update(arguments[0])}return n},t[e].isWrapped=!0,t[e].isConnectionWrapper=!0,t[e].originalFunction=n}},{key:"removeSourceObjGetterAndSetter",value:function(){var t=this.sourceAttrName,n=this.privateAttrName(t),r=this.sourceObj;if(r){if(r.__lookupGetter__(t)){if(delete r[t],r.hasOwnProperty(n)){try{r[t]=r[n]}catch(t){}delete r[n]}}else r[t]&&r[t].isConnectionWrapper&&(r[t]=r[t].originalFunction);r.doNotSerialize&&r.doNotSerialize.includes(n)&&(r.doNotSerialize=e.arr.without(r.doNotSerialize,n),0==r.doNotSerialize.length&&delete r.doNotSerialize),r.doNotCopyProperties&&r.doNotCopyProperties.includes(n)&&(r.doNotCopyProperties=e.arr.without(r.doNotCopyProperties,n),0==r.doNotCopyProperties.length&&delete r.doNotCopyProperties)}}},{key:"addAttributeConnection",value:function(){this.sourceObj.attributeConnections||(this.sourceObj.attributeConnections=[]),this.sourceObj.attributeConnections.push(this)}},{key:"getExistingConnection",value:function(){var t=this.sourceObj&&this.sourceObj.attributeConnections;if(!t)return null;for(var e=0,n=t.length;e<n;e++)if(this.isSimilarConnection(t[e]))return t[e];return null}},{key:"isRecursivelyActivated",value:function(){return this.isActive}},{key:"isSimilarConnection",value:function(t){return!(!t||t.constructor!=this.constructor)&&(this.sourceObj==t.sourceObj&&this.sourceAttrName==t.sourceAttrName&&this.targetObj==t.targetObj&&this.targetMethodName==t.targetMethodName)}},{key:"toString",value:function(t){try{return e.string.format("AttributeConnection(%s.%s %s %s.%s)",this.getSourceObj(),this.getSourceAttrName(),t?"--\x3e"+String(t)+"--\x3e":"--\x3e",this.getTargetObj(),this.getTargetMethodName())}catch(t){return"<Error in AttributeConnection>>toString>"}}}]),t}();t.connect=n,t.disconnect=function(t,e,n,r){if("function"!=typeof n||void 0!==r&&"object"!==(void 0===r?"undefined":i(r))||(r="call"),t.attributeConnections){var o=!0,a=!1,s=void 0;try{for(var u,c=t.attributeConnections.slice()[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var l=u.value;l.getSourceAttrName()==e&&l.getTargetObj()===n&&l.getTargetMethodName()==r&&l.disconnect()}}catch(t){a=!0,s=t}finally{try{!o&&c.return&&c.return()}finally{if(a)throw s}}"function"==typeof t.onDisconnect&&t.onDisconnect(e,n,r)}},t.disconnectAll=function(t){for(var e=void 0;t.attributeConnections&&(e=t.attributeConnections[0]);)e.disconnect()},t.once=function(t,e,r,o,a){return"function"!=typeof r||void 0!==o&&"object"!==(void 0===o?"undefined":i(o))?a=a||{}:(a=o,o="call",(a=a||{})||(a={}),a.updater||(a.updater=function(t,e){return t(null,e)})),a=a||{},a.removeAfterUpdate=!0,n(t,e,r,o,a)},t.signal=function(t,e,n){var r=t.attributeConnections;if(r)for(var i=t[e],o=0,a=r.length;o<a;o++){var s=r[o];s.getSourceAttrName()==e&&s.update(n,i)}},t.noUpdate=function(t,n){var r,i=!1;if(n||"function"!=typeof t||(n=t,i=!0),i){var o=u.prototype;o.isActive||(o.isActive=0),o.isActive++;try{r=n()}finally{o.isActive--,o.isActive<=0&&o.isActive}}else{var a=t.sourceObj,s=t.sourceAttribute,c=t.targetObj,l=t.targetAttribute,h=c&&l?function(t){return t.getSourceAttrName()===s&&c===t.getTargetObj()&&l===t.getTargetMethodName()}:function(t){return t.getSourceAttrName()===s},f=a.attributeConnections&&a.attributeConnections.filter(h);f&&e.arr.invoke(f,"activate");try{r=n()}finally{f&&e.arr.invoke(f,"deactivate")}}return r},t.AttributeConnection=u,t.callWhenNotNull=r,t.callWhenPathNotNull=function(t,e,n,i){for(var o={key:e.pop(),whenDefined:function(t){r(t,this.key,n,i)}};e.length>0;)o={key:e.pop(),next:o,whenDefined:function(t){r(t,this.key,this.next,"whenDefined")}};o.whenDefined(t)}}(this.lively.bindings=this.lively.bindings||{},lively.lang),"undefined"!=typeof module&&module.exports&&(module.exports=t.lively.bindings)}();
//LIVELY.SERIALIZER
!function(){var GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(exports,lively_lang,lively_morphic,lively_bindings,semver){"use strict";semver="default"in semver?semver.default:semver;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},asyncGenerator=function(){function e(e){this.value=e}function r(r){var t,i;function n(t,i){try{var o=r[t](i),s=o.value;s instanceof e?Promise.resolve(s.value).then(function(e){n("next",e)},function(e){n("throw",e)}):a(o.done?"return":"normal",o.value)}catch(e){a("throw",e)}}function a(e,r){switch(e){case"return":t.resolve({value:r,done:!0});break;case"throw":t.reject(r);break;default:t.resolve({value:r,done:!1})}(t=t.next)?n(t.key,t.arg):i=null}this._invoke=function(e,r){return new Promise(function(a,o){var s={key:e,arg:r,resolve:a,reject:o,next:null};i?i=i.next=s:(t=i=s,n(e,r))})},"function"!=typeof r.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(r.prototype[Symbol.asyncIterator]=function(){return this}),r.prototype.next=function(e){return this._invoke("next",e)},r.prototype.throw=function(e){return this._invoke("throw",e)},r.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new r(e.apply(this,arguments))}},await:function(r){return new e(r)}}}(),asyncToGenerator=function(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){return function i(n,a){try{var o=r[n](a),s=o.value}catch(e){return void t(e)}if(!o.done)return Promise.resolve(s).then(function(e){i("next",e)},function(e){i("throw",e)});e(s)}("next")})}},classCallCheck=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var i=r[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(r,t,i){return t&&e(r.prototype,t),i&&e(r,i),r}}(),defineProperty=function(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e},_extends=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},get$1=function e(r,t,i){null===r&&(r=Function.prototype);var n=Object.getOwnPropertyDescriptor(r,t);if(void 0===n){var a=Object.getPrototypeOf(r);return null===a?void 0:e(a,t,i)}if("value"in n)return n.value;var o=n.get;return void 0!==o?o.call(i):void 0},inherits=function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)},possibleConstructorReturn=function(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r},set$1=function e(r,t,i,n){var a=Object.getOwnPropertyDescriptor(r,t);if(void 0===a){var o=Object.getPrototypeOf(r);null!==o&&e(o,t,i,n)}else if("value"in a&&a.writable)a.value=i;else{var s=a.set;void 0!==s&&s.call(n,i)}return i},slicedToArray=function(){return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,r){var t=[],i=!0,n=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(t.push(o.value),!r||t.length!==r);i=!0);}catch(e){n=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw a}}return t}(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),toConsumableArray=function(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)},knownSymbols,symMatcher;function isPrimitive(e){if(null==e)return!0;var r=void 0===e?"undefined":_typeof(e);return"boolean"===r||"number"===r||"string"===r}Object.defineProperty(Symbol.prototype,"__serialize__",{configurable:!0,value:(knownSymbols=Object.getOwnPropertyNames(Symbol).filter(function(e){return"symbol"===_typeof(Symbol[e])}).reduce(function(e,r){return e.set(Symbol[r],"Symbol."+r)},new Map),symMatcher=/^Symbol\((.*)\)$/,function(){var e="function"==typeof this[Symbol.toPrimitive]?this[Symbol.toPrimitive]():this,r=Symbol.keyFor(e);if(r)return{__expr__:'Symbol.for("'+r+'")'};if(knownSymbols.get(e))return{__expr__:knownSymbols.get(e)};var t=String(e).match(symMatcher);return{__expr__:t?'Symbol("'+t[1]+'")':"Symbol()"}})}),Object.defineProperty(System,"__serialize__",{configurable:!0,value:function(){return{__expr__:"System"}}}),Object.defineProperty(System.global,"__serialize__",{configurable:!0,value:function(){return{__expr__:"System.global"}}}),Object.defineProperty(Map.prototype,"__serialize__",{configurable:!0,value:function(e,r,t){var i=e.add(this),n=i.currentRev,a=i.currentSnapshot,o=a.entries=[],s=0;r[i.id]=a,e.classHelper.addClassInfo(i,this,a);var l=!0,u=!1,c=void 0;try{for(var p,f=this[Symbol.iterator]();!(l=(p=f.next()).done);l=!0){var h=slicedToArray(p.value,2),y=h[0],d=h[1];s++;var v=i.snapshotProperty(i.id,y,t.concat("key",String(s)),r,e),b=i.snapshotProperty(i.id,d,t.concat("value",String(s)),r,e);o.push(v,b)}}catch(e){u=!0,c=e}finally{try{!l&&f.return&&f.return()}finally{if(u)throw c}}return i.asRefForSerializedObjMap(n)}}),Object.defineProperty(Map.prototype,"__deserialize__",{configurable:!0,value:function(e,r,t,i,n){for(var a=e.entries,o=0;o<a.length;o+=2){var s=a[o],l=a[o+1],u=r.recreateProperty("key."+o,s,t,i,n.concat("key",o)),c=r.recreateProperty("value."+o,l,t,i,n.concat("value",o));this.set(u,c)}}}),Object.defineProperty(Set.prototype,"__serialize__",{configurable:!0,value:function(e,r,t){var i=e.add(this),n=i.currentRev,a=i.currentSnapshot,o=a.entries=[],s=0;r[i.id]=a,e.classHelper.addClassInfo(i,this,a);var l=!0,u=!1,c=void 0;try{for(var p,f=this[Symbol.iterator]();!(l=(p=f.next()).done);l=!0){var h=p.value;s++;var y=i.snapshotProperty(i.id,h,t.concat("entry",String(s)),r,e);o.push(y)}}catch(e){u=!0,c=e}finally{try{!l&&f.return&&f.return()}finally{if(u)throw c}}return i.asRefForSerializedObjMap(n)}}),Object.defineProperty(Set.prototype,"__deserialize__",{configurable:!0,value:function(e,r,t,i,n){for(var a=e.entries,o=0;o<a.length;o++){var s=r.recreateProperty("entry."+o,a[o],t,i,n.concat("key",o));this.add(s)}}});var classMetaForSerializationProp="lively.serializer-class-info",moduleMetaInClassProp=Symbol.for("lively-module-meta"),ClassHelper=function(){function e(r){classCallCheck(this,e),this.options=_extends({ignoreClassNotFound:!0},r),this[Symbol.for("lively-instance-restorer")]=!0}return createClass(e,[{key:"classNameProperty",get:function(){return"__LivelyClassName__"}},{key:"sourceModuleNameProperty",get:function(){return"__SourceModuleName__"}}],[{key:"moduleMetaInClassProp",get:function(){return moduleMetaInClassProp}},{key:"classMetaForSerializationProp",get:function(){return classMetaForSerializationProp}}]),createClass(e,[{key:"addClassInfo",value:function(e,r,t){if(r&&r.constructor){var i=r.constructor.name;if(i){var n=r.constructor[moduleMetaInClassProp];("Object"!==i||n)&&(n&&(delete n.lastChange,delete n.lastSuperclassChange),t[classMetaForSerializationProp]={className:i,module:n})}else console.warn("Cannot serialize class info of anonymous class of instance "+r)}}},{key:"restoreIfClassInstance",value:function(e,r){if(r.hasOwnProperty(classMetaForSerializationProp)){var t=r[classMetaForSerializationProp];if(t.className){var i=this.locateClass(t);if(!i||"function"!=typeof i){var n="Trying to deserialize instance of "+JSON.stringify(t)+" but this class cannot be found!";if(!this.options.ignoreClassNotFound)throw new Error(n);return console.error(n),{isClassPlaceHolder:!0,className:t.className}}return i.hasOwnProperty(Symbol.for("lively-instance-superclass"))?new i(this):new i}}}},{key:"locateClass",value:function(e){var r=e.module;if(r){var t=r.pathInPackage;if(r.package&&r.package.name&&"no group"!==r.package.name){var i=System.decanonicalize(r.package.name.replace(/\/*$/,"/"));t=lively_lang.string.joinPath(i,t)}var n=System.get("@lively-env"),a=n.moduleEnv(t)||n.moduleEnv(r.pathInPackage);if(a)return a.recorder[e.className];console.warn("Trying to deserialize instance of class "+e.className+" but the module "+t+" is not yet loaded")}return System.global[e.className]}}],[{key:"sourceModulesInObjRef",value:function(e){var r=[],t=e&&e[classMetaForSerializationProp];return t&&t.module&&r.push(t.module),r}},{key:"sourceModulesIn",value:function(e){var r=[];return Object.keys(e).forEach(function(t){var i=e[t];i&&i[classMetaForSerializationProp]&&r.push(i[classMetaForSerializationProp])}),lively_lang.arr.uniqBy(r,function(e,r){var t=e.module,i=r.module;return!t&&!i||t&&!i||!t&&i?e.className===r.className:e.className===r.className&&t.package.name==i.package.name&&t.package.pathInPackage==i.package.pathInPackage})}}]),e}(),ExpressionSerializer=function(){function ExpressionSerializer(e){classCallCheck(this,ExpressionSerializer);var r=_extends({prefix:"__lv_expr__"},e).prefix;this.prefix=r+":"}return createClass(ExpressionSerializer,[{key:"isSerializedExpression",value:function(e){return 0===e.indexOf(this.prefix)}},{key:"requiredModulesOf__expr__",value:function(e){if(!this.isSerializedExpression(e))return null;var r=this.exprStringDecode(e).bindings;return r?Object.keys(r):null}},{key:"exprStringDecode",value:function(e){for(var r=e.indexOf(":"),t=(e.slice(0,r),e.slice(r+1)),i={},n=!1;t&&t.startsWith("{")&&(r=t.indexOf("}:"))>=0;){n=!0;var a=t.slice(1,r);r=(t=t.slice(r+2)).indexOf(":");var o=t.slice(0,r),s=a.split(",").filter(function(e){return Boolean(e.trim())}).map(function(e){if(!e.includes(":"))return e;var r=e.split(":"),t=slicedToArray(r,2);return{exported:t[0],local:t[1]}});i[o]=s,t=t.slice(r+1)}return{__expr__:t,bindings:n?i:null}}},{key:"exprStringEncode",value:function(e){var r=e.__expr__,t=e.bindings,i=String(r);if(t)for(var n=Object.keys(t),a=0;a<n.length;a++){var o=n[a],s=t[o];Array.isArray(s)&&(s=s.map(function(e){return"string"==typeof e?e:e.exported+":"+e.local}).join(",")),i="{"+s+"}:"+o+":"+i}return this.prefix+i}},{key:"convert__expr__obj",value:function(e){return console.assert("__expr__"in e,"obj has no property __expr__"),this.prefix+e.__expr__}},{key:"__eval__",value:function __eval__(__source__,__boundValues__){return eval(__source__)}},{key:"deserializeExpr",value:function(e){if(!e.startsWith(this.prefix))throw new Error('"'+e+'" is not a serialized expression, missing prefix "'+this.prefix+'"');return this.deserializeExprObj(this.exprStringDecode(e))}},{key:"deserializeExprObj",value:function(e){var r=e.__expr__,t=e.bindings,i={};if(t)for(var n=t?Object.keys(t):[],a=0;a<n.length;a++){var o=n[a],s=t[o],l=System.get(System.decanonicalize(o));if(!l&&lively.FreezerRuntime){var u=lively.FreezerRuntime.fetchStandaloneFor(o);u&&(l=u.exports)}if(!l)throw new Error("[lively.serializer] expression eval: bindings specify to import "+o+" but this module is not loaded!\nSource: "+r);for(var c=0;c<s.length;c++){var p=s[c],f=void 0,h=void 0;"string"==typeof p?(f=p,h=p):"object"===(void 0===p?"undefined":_typeof(p))&&(f=p.local,h=p.exported),i[f]=l[h],r="var "+f+" = __boundValues__."+f+";\n"+r}}return this.__eval__(r,i)}}]),ExpressionSerializer}();function referenceGraph$1(e){Object.keys(e);var r={};for(var t in e)r[t]=referencesOfId(e,t);return r}function isReference(e){return e&&e.__ref__}function referencesOfId(e,r,t){var i=e[r],n=[];for(var a in i.props){var o=i.props[a]||{},s=o.value,l=o.verbatim;Array.isArray(s)?n.push.apply(n,toConsumableArray(referencesInArray(e,s,t&&a))):!l&&s&&isReference(s)&&n.push(t?{key:a,id:s.id}:s.id)}if(i.hasOwnProperty("entries"))for(var u=0;u<i.entries.length;u++){var c=i.entries[u];Array.isArray(c)?n.push.apply(n,toConsumableArray(referencesInArray(e,c,t&&c))):c&&isReference(c)&&n.push(t?{key:c,id:c.id}:c.id)}return n}function referencesInArray(e,r,t){for(var i=[],n=0;n<r.length;n++){var a=r[n];if(Array.isArray(a)){var o=t?t+"["+n+"]":void 0;i.push.apply(i,toConsumableArray(referencesInArray(e,a,o)))}else a&&isReference(a)&&i.push(t?{key:t+"["+n+"]",id:a.id}:a.id)}return i}function classNameOfId(e,r){return(e[r][ClassHelper.classMetaForSerializationProp]||{}).className||"Object"}function findPathFromToId$1(e,r,t){var i,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=void 0===n.showPath||n.showPath,o=n.hasOwnProperty("showClassNames")?n.showClassNames:!a,s=n.hasOwnProperty("showPropNames")?n.showPropNames:a,l=n.hasOwnProperty("hideId")?n.hideId:a,u=[],c={};if(function r(t,n,a){if(!i)if(a>50)alert(""+u);else{if(t===n)return u.push(t),void(i=u.slice());if(!c[t]){c[t]=!0,u.push(t);for(var o=referencesOfId(e,t),s=0;s<o.length;s++)r(o[s],n,a+1);u.pop()}}}(r,t,0),!i)return null;if(!o&&!s)return i;for(var p=[],f=0;f<i.length-1;f++){var h=i[f],y=i[f+1],d=[];if(l||d.push(h),o){var v=(e[h][ClassHelper.classMetaForSerializationProp]||{}).className;d.push(v||"Object")}if(s){var b=referencesOfId(e,h,!0).find(function(e){return e.id===y})||{key:"????"};d.push(b.key)}p.push(d.join(":"))}return a&&(p="."+p.join(".")),p}function lookupPath$1(e,r,t){t=(t=t.replace(/^\./,"")).replace(/\[([^\]])+\]/g,".$1");for(var i=lively_lang.Path(t).parts(),n=e[r],a=0;;){if(a++>1e3)throw"stop";var o=i.shift();if(!o)return n;if(!n.props||!n.props[o])throw new Error("Property "+o+" not found for ref "+JSON.stringify(n));var s=n.props[o].value;if(!s)throw new Error("Property "+o+" has no value");for(;Array.isArray(s);)s=s[i.shift()];if(!s||!s.__ref__)return s;n=e[s.id]}return n}function modifyProperty$1(e,r,t,i){t=(t=t.replace(/^\./,"")).replace(/\[([^\]])+\]/g,".$1");var n=lively_lang.Path(t).parts(),a=e[r],o=n.shift();if(!a.props||!a.props[o])throw new Error("Property "+o+" not found for ref "+JSON.stringify(a));var s=(a.props[o]||{}).value;if(!s)throw new Error("Property "+o+" has no value");if(n.length){var l=lively_lang.Path(n).get(s);lively_lang.Path(n).set(s,i(a,o,l))}else a.props[o].value=i(a,o,s)}function removeUnreachableObjects$1(e,r){var t=lively_lang.arr.withoutAll(Object.keys(r),e),i=referenceGraph$1(r);return e.forEach(function(e){for(var r=lively_lang.graph.subgraphReachableBy(i,e),n=t.length;n--;){t[n]in r&&t.splice(n,1)}}),t.forEach(function(e){return delete r[e]}),t}var defaultExprSerializer=new ExpressionSerializer;function requiredModulesOfSnapshot(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:defaultExprSerializer;e.snapshot&&(e=e.snapshot);for(var t=[],i=0,n=Object.keys(e);i<n.length;i++){var a,o=e[n[i]];if(o.__expr__){var s,l=r.requiredModulesOf__expr__(o.__expr__);l&&(s=t).push.apply(s,toConsumableArray(l))}else{var u=ClassHelper.sourceModulesInObjRef(o);if(u&&u.length&&(a=t).push.apply(a,toConsumableArray(u.map(function(e){return(e.package&&e.package.name||"")+"/"+e.pathInPackage}))),o.props)for(var c=0;c<o.props.length;c++){var p=o.props[c].value;if("string"==typeof p){var f,h=r.requiredModulesOf__expr__(p);h&&(f=t).push.apply(f,toConsumableArray(h))}}}}return t=lively_lang.arr.uniq(t)}var SnapshotInspector=function(){function e(r){classCallCheck(this,e),this.snapshot=r,this.classes={},this.expressions={}}return createClass(e,null,[{key:"forSnapshot",value:function(e){return new this(e).processSnapshot()}},{key:"forPoolAndSnapshot",value:function(e,r){return new this(e).processPool(r)}},{key:"checkForLeaks",value:function(e){(new this).processPool(e).referenceCounts(),(this.classes.AttributeConnection||{}).objects}}]),createClass(e,[{key:"processSnapshot",value:function(){var e=this.snapshot;e.snapshot&&(e=e.snapshot);var r=ObjectPool.fromSnapshot(e);return this.processPool(r)}},{key:"processPool",value:function(e){var r=this.expressions,t=this.classes;return this.pool=e,e.objectRefs().forEach(function(i){var n=i.currentSnapshot,a=(n[ClassHelper.classMetaForSerializationProp]||{}).className,o=Object.keys(n.props);null==a&&(a=o.length>3?"{"+o.slice(0,3).join(", ")+", ...}":"{"+o.join(", ")+"}"),t[a]||(t[a]={count:0,bytes:0,name:a,objects:[]}),t[a].count++,t[a].bytes+=JSON.stringify(n).length,t[a].objects.push([i.id,n]),o.forEach(function(t){var a=n.props[t].value;if(a&&"string"==typeof a&&e.expressionSerializer.isSerializedExpression(a)){var o=e.expressionSerializer.exprStringDecode(a).__expr__,s=r[o];s||(s=r[o]={count:0,bytes:0,name:o,objects:[]}),s.count++,s.bytes+=a.length,s.objects.push([[i.id,t],a])}})}),this}},{key:"explainId",value:function(e){var r=this.snapshot;r.snapshot&&(r=r.snapshot);var t=r[e];if(!t)return null;var i=(t[ClassHelper.classMetaForSerializationProp]||{className:"Object"}).className,n=Object.keys(t.props);return"Object"==i&&(i=n.length>3?"{"+n.slice(0,3).join(", ")+", ...}":"{"+n.join(", ")+"}"),i}},{key:"sorted",value:function(e){var r=this;return lively_lang.arr.sortBy(Object.keys(this[e]).map(function(t){return r[e][t]}),function(e){return isNaN(e.bytes)?0:e.bytes}).reverse()}},{key:"report",value:function(e){var r=[["#bytes","#objs","avg",e]].concat(toConsumableArray(this.sorted(e).map(function(e){return[lively_lang.num.humanReadableByteSize(e.bytes),e.count,lively_lang.num.humanReadableByteSize(e.bytes/e.count),lively_lang.string.truncate(e.name,300)]})));return lively_lang.string.printTable(r,{separator:" | "})}},{key:"toString",value:function(){var e=this.snapshot,r=JSON.stringify(e).length,t=Object.keys(e).length;return lively_lang.string.format("Total: %s (%s objs - %s per obj)",lively_lang.num.humanReadableByteSize(r),t,lively_lang.num.humanReadableByteSize(r/t))+"\nclasses:\n"+this.report("classes")+"\nexpressions:\n"+this.report("expressions")}},{key:"biggestObjectsOfType",value:function(e){return lively_lang.arr.sortBy(this.classes[e].objects.map(function(e){var r=slicedToArray(e,2),t=(r[0],r[1]);return JSON.stringify(t)}),function(e){return e.length}).reverse().map(function(e){return JSON.parse(e)})}},{key:"toCSV",value:function(){var e=["type,size,size in bytes,count,size per object,size perobject in bytes"];return this.sorted("classes").forEach(function(r){e.push([r.name,lively_lang.num.humanReadableByteSize(r.bytes),r.bytes,r.count,lively_lang.num.humanReadableByteSize(r.bytes/r.count),r.bytes/r.count].join(","))}),e.join("\n")}},{key:"findPathFromToId",value:function(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this.snapshot;return i.snapshot&&(i=i.snapshot),findPathFromToId$1(i,e,r,t)}},{key:"referenceGraph",value:function(){var e=this.snapshot;return e.snapshot&&(e=e.snapshot),referenceGraph$1(e)}},{key:"referenceCounts",value:function(){var e=lively_lang.graph.invert(this.referenceGraph()),r={};return Object.keys(e).forEach(function(t){return r[t]=e[t].length}),r}},{key:"lookupPath",value:function(e,r){var t=this.snapshot;return t.snapshot&&(t=t.snapshot),lookupPath$1(t,e,r)}},{key:"idsReferencingId",value:function(e){return lively_lang.graph.invert(this.referenceGraph())[e]}},{key:"modifyProperty",value:function(e,r,t){var i=this.snapshot;return i.snapshot&&(i=i.snapshot),modifyProperty$1(i,e,r,t)}},{key:"replaceReferencesTo",value:function(e,r){var t=lively_lang.graph.invert(this.referenceGraph())[e],i=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var l=o.value,u=this.findPathFromToId(l,e);this.modifyProperty(l,u,r)}}catch(e){n=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw a}}}},{key:"removeUnreachableObjects",value:function(e){var r=this.snapshot;if(e||(e=this.snapshot.id),!e)throw new Error("Cannot find root id");return r.snapshot&&(r=r.snapshot),removeUnreachableObjects$1([e],r)}},{key:"reportAboutObject",value:function(e,r,t){var i=this;r=r||this.referenceGraph();var n=((t=t||lively_lang.graph.invert(r))[e]||[]).map(function(r){return[r,i.findPathFromToId(r,e),i.explainId(r)]}),a=(r[e]||[]).map(function(r){return[r,i.findPathFromToId(e,r),i.explainId(r)]});return e+"\n is a "+this.explainId(e)+" object\n path from root: "+this.findPathFromToId(this.snapshot.id,e)+"\n references \n"+lively_lang.string.indent(lively_lang.string.printTable(a),"  ",2)+"\n referenced by:\n"+lively_lang.string.indent(lively_lang.string.printTable(n),"  ",2)+"\n"}},{key:"reportAboutObjects",value:function(e){var r=this,t=this.referenceGraph(),i=lively_lang.graph.invert(t);return e.map(function(e){return r.reportAboutObject(e,t,i)}).join("\n")}},{key:"rootObjectName",value:function(){var e="";if((r=this.snapshot).snapshot){var r,t=r.id;(r=r.snapshot)[t].props.name&&(e=r[t].props.name.value)}return e}},{key:"openSummary",value:function(){var e=this.rootObjectName();return $world.execCommand("open text window",{content:this.toString(),title:"serialization debug"+(e?" for "+e:""),fontFamily:"monospace"})}},{key:"openConnectionsList",value:function(){var e=this,r=this.rootObjectName(),t=((this.classes.AttributeConnection||{}).objects||[]).map(function(r){var t=slicedToArray(r,2),i=t[0],n=t[1].props,a=n.sourceObj,o=n.sourceAttrName,s=n.targetObj,l=n.targetMethodName;return e.explainId(a.value.id)+"."+o.value+" => "+e.explainId(s.value.id)+"."+l.value+"\n  "+a.value.id+" => "+s.value.id+"\n  connection id: "+i+"\n"}).join("\n");return $world.execCommand("open text window",{content:t,title:"serialized connections"+(r?" for "+r:""),fontFamily:"monospace"})}},{key:"openObjectReport",value:function(){var e=this.snapshot,r=this.rootObjectName();e.snapshot&&(e=e.snapshot),$world.execCommand("open text window",{title:"object report"+(r?" for "+r:""),content:this.reportAboutObjects(Object.keys(e)),fontFamily:"monospace"})}}]),e}(),ObjectGraphVisualizer=function(e){function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};classCallCheck(this,r);var t=possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,_extends({draggable:!0},lively_lang.obj.dissoc(e,["snapshot"]))));return t.state={cy:null,snapshot:e.snapshot},lively_bindings.connect(t,"extent",t,"updateDebounced",{updater:function(e,r,t){return e()}}),t.update(),t}return inherits(r,e),createClass(r,null,[{key:"renderSnapshotAndOpen",value:function(e){var r=this.renderSnapshot(e);return r.openInWindow({title:"object graph visualizer"}),r}},{key:"renderSnapshot",value:function(e){return new this({snapshot:e})}}]),createClass(r,[{key:"cleanup",value:function(){this.html="",this.state.cy&&(this.state.cy.destroy(),this.state.cy=null)}},{key:"update",value:function(){var e=this;this.cleanup(),this.state.snapshot&&this.renderSnapshot(this.state.snapshot).catch(function(r){return e.showError(r)})}},{key:"updateDebounced",value:function(){var e=this;lively_lang.fun.debounceNamed("updateDebounced-"+this.id,100,function(){return e.update()})()}},{key:"renderSnapshot",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(r){var t,i,n,a,o,s,l,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.cleanup(),i=new SnapshotInspector(r),n=i.referenceGraph(),lively_lang.graph.invert(n),a=Object.keys(n).filter(function(e){return!!lively_lang.Path("props.submorphs").get(r[e])}),o=Object.keys(n).map(function(e){var t=r[e],n=lively_lang.string.truncate(i.explainId(e),20),o="",s=a.includes(e),l=t["lively.serializer-class-info"]&&t["lively.serializer-class-info"].className;return s&&"ListItemMorph"!==l&&(o="Morph "+l,n+="\n"+(lively_lang.Path("props.name.value").get(t)||"")),{group:"nodes",autounselectify:!0,data:{id:e,parent:void 0,label:n,snapshot:t},classes:o}}),s=lively_lang.arr.flatmap(Object.keys(n),function(e){return n[e].map(function(r){return{group:"edges",data:{source:e,target:r}}})}),e.next=9,System.import("https://cdn.rawgit.com/cytoscape/cytoscape.js/v2.7.15/dist/cytoscape.js");case 9:return l=e.sent,e.next=12,System.import("https://cdn.rawgit.com/cytoscape/cytoscape.js-cose-bilkent/1.0.5/cytoscape-cose-bilkent.js");case 12:return u=e.sent,l&&u&&u(l),c=this.state.cy=l((t={container:this.domNode,autoungrabify:!0,layout:{name:"spread"}},defineProperty(t,"layout",{name:"cose-bilkent",idealEdgeLength:50,numIter:2500,nodeRepulsion:45e3,animate:"end"}),defineProperty(t,"style",[{selector:"",style:{"active-bg-color":"#ccc","active-bg-opacity":.333}},{selector:"node",style:defineProperty({padding:10,"background-color":"#999","background-opacity":".5",width:"label",height:20,label:"data(label)","text-valign":"center","text-halign":"center","font-size":"10px",color:"#666",shape:"roundrectangle","text-wrap":"wrap","text-outline-color":"#666","text-outline-width":3,"text-outline-opacity":1},"color","white")},{selector:"node.Morph",style:{width:"label",height:"label","background-color":"#666","background-opacity":".3","font-size":"18px","text-outline-color":"#666","text-outline-width":3,"text-outline-opacity":1}},{selector:"edge",style:{width:4,"line-color":"#666","curve-style":"bezier","target-arrow-shape":"triangle"}},{selector:"edge:selected",style:{"line-color":"blue"}}]),defineProperty(t,"elements",o.concat(s)),t)),this.onDrag=function(e){var r=c.$(":active")[0];if(r){var t=e.positionIn(this),i=t.x,n=t.y;r.renderedPosition("x",i),r.renderedPosition("y",n)}},this.onMouseUp=function(e){var r=c.$("node:active")[0],t=c.$("edge:active")[0];r&&lively_morphic.inspect({id:r.data().id,snapshot:r.data().snapshot}),t&&this.setStatusMessage(i.findPathFromToId(t.data().source,t.data().target))},e.abrupt("return",this);case 18:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}()},{key:"snapshot",get:function(){return this.state.snapshot},set:function(e){this.state.snapshot=e,this.updateDebounced()}}]),r}(lively_morphic.HTMLMorph),CustomSerializePlugin=function(){function e(){classCallCheck(this,e)}return createClass(e,[{key:"serializeObject",value:function(e,r,t,i,n){if("function"!=typeof e.__serialize__)return null;var a=e.__serialize__(t,i,n);if(a&&a.hasOwnProperty("__expr__")){var o=t.expressionSerializer.exprStringEncode(a);a=r?o:{__expr__:o}}return a}},{key:"deserializeObject",value:function(e,r,t,i){var n=t.__expr__;return n?e.expressionSerializer.deserializeExpr(n):null}}]),e}(),ClassPlugin=function(){function e(){classCallCheck(this,e)}return createClass(e,[{key:"additionallySerialize",value:function(e,r,t,i){e.classHelper.addClassInfo(r,r.realObj,t)}},{key:"deserializeObject",value:function(e,r,t,i){return e.classHelper.restoreIfClassInstance(r,t)}}]),e}(),AdditionallySerializePlugin=function(){function e(){classCallCheck(this,e)}return createClass(e,[{key:"additionallySerialize",value:function(e,r,t,i){var n=r.realObj;n&&"function"==typeof n.__additionally_serialize__&&n.__additionally_serialize__(t,r,e,i)}},{key:"additionallyDeserializeBeforeProperties",value:function(e,r,t,i,n,a,o){"function"==typeof t.__deserialize__&&t.__deserialize__(n,r,a,e,o)}},{key:"additionallyDeserializeAfterProperties",value:function(e,r,t,i,n,a){"function"==typeof t.__after_deserialize__&&t.__after_deserialize__(i,r)}}]),e}(),OnlySerializePropsPlugin=function(){function e(){classCallCheck(this,e)}return createClass(e,[{key:"propertiesToSerialize",value:function(e,r,t,i){var n=r.realObj;return n&&n.__only_serialize__||null}}]),e}(),DontSerializePropsPlugin=function(){function e(){classCallCheck(this,e)}return createClass(e,[{key:"propertiesToSerialize",value:function(e,r,t,i){var n=r.realObj;if(!n||!n.__dont_serialize__)return null;for(var a=lively_lang.obj.mergePropertyInHierarchy(n,"__dont_serialize__"),o=[],s=0;s<i.length;s++){var l=i[s];a.includes(l)||o.push(l)}return o}}]),e}(),LivelyClassPropertiesPlugin=function(){function e(){classCallCheck(this,e)}return createClass(e,[{key:"propertiesToSerialize",value:function(e,r,t,i){var n=r.realObj,a=n.constructor[Symbol.for("lively.classes-properties-and-settings")];if(!a)return null;var o=a.properties,s=a.propertySettings.valueStoreProperty||"_state",l=n[s],u=!!n.__only_serialize__,c=[];if(l){if(u){for(var p=0;p<i.length;p++){var f=i[p],h=o[f];f!==s&&(h&&h&&(h.derived||h.readOnly||h.hasOwnProperty("serialize")&&!h.serialize)||c.push(f))}return c}var y=i.indexOf(s);for(var d in y>-1&&i.splice(y,1),o){var v=o[d],b=i.indexOf(d);v.derived||v.readOnly||v.hasOwnProperty("serialize")&&!v.serialize?b>-1&&i.splice(b,1):-1===b&&c.push(d)}return c.concat(i)}}},{key:"additionallyDeserializeBeforeProperties",value:function(e,r,t,i,n,a,o){var s=t.constructor[Symbol.for("lively.classes-properties-and-settings")];if(!s)return i;var l=s.properties,u=s.propertySettings.valueStoreProperty||"_state";if((i=n.props)[u])return i;i=lively_lang.obj.clone(i),t.hasOwnProperty(u)||t.initializeProperties();t[u];for(var c=lively_lang.obj.sortKeysWithBeforeAndAfterConstraints(l),p=0;p<c.length;p++){var f=c[p];l[f];i.hasOwnProperty(f)&&(r.recreatePropertyAndSetProperty(t,i,f,a,e,o),delete i[f])}return i}}]),e}(),LeakDetectorPlugin=function(){function e(){classCallCheck(this,e)}return createClass(e,[{key:"afterSerialization",value:function(e,r,t){var i=SnapshotInspector.forPoolAndSnapshot(r,e),n=new Set([].concat(toConsumableArray((i.classes.AttributeConnection||{objects:[]}).objects),toConsumableArray((i.classes["{source, target}"]||{objects:[]}).objects),toConsumableArray((i.classes["{_rev, source, target}"]||{objects:[]}).objects)).map(function(e){return e[0]})),a=i.referenceGraph(),o=lively_lang.graph.invert(a),s=lively_lang.arr.compact(lively_lang.arr.flatten(Object.entries(o).filter(function(e){var t=slicedToArray(e,2),i=t[0],a=t[1];return a.length<3&&r.id!=i&&!n.has(i)&&a.every(function(e){return n.has(e)})}).map(function(r){var t=slicedToArray(r,1)[0],i=lively_lang.graph.subgraphReachableBy(a,t),n=e.resolveToObj(t);if(Object.keys(i).length>1)return lively_lang.arr.compact(o[t].map(function(r){var t=e.resolveToObj(r);if("AttributeConnection"===t.constructor.name)return t})).map(function(e){return{conn:e,obj:n}})})));return s.length>0&&(this.memoryLeaks=s),r}}]),e}(),plugins={livelyClassPropertiesPlugin:new LivelyClassPropertiesPlugin,dontSerializePropsPlugin:new DontSerializePropsPlugin,onlySerializePropsPlugin:new OnlySerializePropsPlugin,additionallySerializePlugin:new AdditionallySerializePlugin,classPlugin:new ClassPlugin,customSerializePlugin:new CustomSerializePlugin},allPlugins=[plugins.customSerializePlugin,plugins.classPlugin,plugins.additionallySerializePlugin,plugins.onlySerializePropsPlugin,plugins.dontSerializePropsPlugin,plugins.livelyClassPropertiesPlugin],debugSerialization=!1,debugDeserialization=!1,ObjectPool=function(){function e(r){classCallCheck(this,e),this.options=_extends({checkForLeaks:!1,ignoreClassNotFound:!0,idPropertyName:"id"},r),this.reset()}return createClass(e,null,[{key:"withDefaultPlugins",value:function(e){return new this(_extends({plugins:allPlugins},e))}},{key:"resolveFromSnapshotAndId",value:function(e,r){return new this(r).resolveFromSnapshotAndId(e)}},{key:"fromSnapshot",value:function(e,r){return new this(r).readSnapshot(e)}},{key:"withObject",value:function(e,r){var t=new this(r);return t.add(e),t}}]),createClass(e,[{key:"reset",value:function(){this.uuidGen=lively_lang.string.newUUID,this._obj_ref_map=new Map,this._id_ref_map={};var e=this.options;this.classHelper=new ClassHelper(e),this.expressionSerializer=new ExpressionSerializer,e.idPropertyName&&(this.idPropertyName=e.idPropertyName),e.uuidGen&&(this.uuidGen=e.uuidGen),e.reinitializeIds&&(this.reinitializeIds=e.reinitializeIds),e.hasOwnProperty("ignoreClassNotFound")&&(this.classHelper.options.ignoreClassNotFound=e.ignoreClassNotFound);var r=this.plugins={serializeObject:[],additionallySerialize:[],propertiesToSerialize:[],deserializeObject:[],additionallyDeserializeBeforeProperties:[],additionallyDeserializeAfterProperties:[],afterDeserialization:[],beforeDeserialization:[],afterSerialization:[],beforeSerialization:[]};e.plugins&&e.plugins.forEach(function(e){"function"==typeof e.serializeObject&&r.serializeObject.push(e),"function"==typeof e.additionallySerialize&&r.additionallySerialize.push(e),"function"==typeof e.propertiesToSerialize&&r.propertiesToSerialize.push(e),"function"==typeof e.deserializeObject&&r.deserializeObject.push(e),"function"==typeof e.additionallyDeserializeBeforeProperties&&r.additionallyDeserializeBeforeProperties.push(e),"function"==typeof e.additionallyDeserializeAfterProperties&&r.additionallyDeserializeAfterProperties.push(e),"function"==typeof e.beforeDeserialization&&r.beforeDeserialization.push(e),"function"==typeof e.afterDeserialization&&r.afterDeserialization.push(e),"function"==typeof e.beforeSerialization&&r.beforeSerialization.push(e),"function"==typeof e.afterSerialization&&r.afterSerialization.push(e)})}},{key:"knowsId",value:function(e){return!!this._id_ref_map[e]}},{key:"refForId",value:function(e){return this._id_ref_map[e]}},{key:"resolveToObj",value:function(e){var r=this._id_ref_map[e];return r?r.realObj:void 0}},{key:"ref",value:function(e){return this._obj_ref_map.get(e)}},{key:"objects",value:function(){return Array.from(this._obj_ref_map.keys())}},{key:"objectRefs",value:function(){return Array.from(this._obj_ref_map.values())}},{key:"internalAddRef",value:function(e){return e.realObj&&this._obj_ref_map.set(e.realObj,e),this._id_ref_map[e.id]=e,e}},{key:"add",value:function(e){var r=this;if(!isPrimitive(e)){if(Array.isArray(e))return e.map(function(e){return r.add(e)});var t=e.__serialization_id_property__||this.idPropertyName;return this.ref(e)||this.internalAddRef(new ObjectRef(e[t]||this.uuidGen(),e,void 0,this.idPropertyName))}}},{key:"snapshot",value:function(e){var r={};this.plugin_beforeSerialization(r,e);for(var t=0,i=Object.keys(this._id_ref_map);t<i.length;t++){this._id_ref_map[i[t]].snapshotObject(r,this)}return r=this.plugin_afterSerialization(r,e),r}},{key:"snapshotObject",value:function(e){var r=this.add(e).id;return{id:r,snapshot:this.snapshot(r)}}},{key:"readSnapshot",value:function(e){if(e.hasOwnProperty("id"))throw new Error("readSnapshot expects simple serialized object map, not id-snapshot pair!");for(var r=0,t=Object.keys(e);r<t.length;r++)this.resolveToObj(t[r])||ObjectRef.fromSnapshot(t[r],e,this,[],this.idPropertyName);return this}},{key:"resolveFromSnapshotAndId",value:function(e){if(!e.hasOwnProperty("id"))throw new Error("idAndSnapshot does not have id");if(!e.hasOwnProperty("snapshot"))throw new Error("idAndSnapshot does not have snapshot");var r=e=this.plugin_beforeDeserialization(e),t=r.id,i=r.snapshot;return this.readSnapshot(i),this.plugin_afterDeserialization(e),this.resolveToObj(t)}},{key:"plugin_beforeSerialization",value:function(e,r){for(var t=0;t<this.plugins.beforeSerialization.length;t++){this.plugins.beforeSerialization[t].beforeSerialization(this,e,r)}}},{key:"plugin_afterSerialization",value:function(e,r){for(var t=0;t<this.plugins.afterSerialization.length;t++){var i=this.plugins.afterSerialization[t].afterSerialization(this,e,r);i&&(e=i)}return e}},{key:"plugin_beforeDeserialization",value:function(e){for(var r=0;r<this.plugins.beforeDeserialization.length;r++){var t=this.plugins.beforeDeserialization[r].beforeDeserialization(this,e);t&&(e=t)}return e}},{key:"plugin_afterDeserialization",value:function(e){for(var r=0;r<this.plugins.afterDeserialization.length;r++){this.plugins.afterDeserialization[r].afterDeserialization(this,e)}}},{key:"plugin_serializeObject",value:function(e,r,t,i){for(var n=0;n<this.plugins.serializeObject.length;n++){var a=this.plugins.serializeObject[n].serializeObject(e,r,this,t,i);if(a)return a}}},{key:"plugin_propertiesToSerialize",value:function(e,r,t){for(var i=0;i<this.plugins.propertiesToSerialize.length;i++){var n=this.plugins.propertiesToSerialize[i].propertiesToSerialize(this,e,r,t);n&&(t=n)}return t}},{key:"plugin_additionallySerialize",value:function(e,r,t,i){for(var n=this.plugins.additionallySerialize.length?__additionally_serialize__addObjectFunction(e,r,t,this,i):null,a=0;a<this.plugins.additionallySerialize.length;a++){this.plugins.additionallySerialize[a].additionallySerialize(this,e,r,n)}}},{key:"plugin_deserializeObject",value:function(e,r,t){for(var i=0;i<this.plugins.deserializeObject.length;i++){var n=this.plugins.deserializeObject[i].deserializeObject(this,e,r,t);if(n)return n}}},{key:"plugin_additionallyDeserializeBeforeProperties",value:function(e,r,t,i,n,a){for(var o=0;o<this.plugins.additionallyDeserializeBeforeProperties.length;o++){var s=this.plugins.additionallyDeserializeBeforeProperties[o].additionallyDeserializeBeforeProperties(this,e,r,t,i,n,a);s&&(t=s)}return t}},{key:"plugin_additionallyDeserializeAfterProperties",value:function(e,r,t,i,n){for(var a=0;a<this.plugins.additionallyDeserializeAfterProperties.length;a++){this.plugins.additionallyDeserializeAfterProperties[a].additionallyDeserializeAfterProperties(this,e,r,t,i,n)}}}]),e}();function __additionally_serialize__addObjectFunction(e,r,t,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return function(a,o){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r.props[a]=s?{key:a,value:o,verbatim:s}:{key:a,value:e.snapshotProperty(e.id,o,n.concat([a]),t,i)}}}var ObjectRef=function(){function e(r,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"id";if(classCallCheck(this,e),this.id=r,this.idPropertyName=n,this.realObj=t,this.snapshotVersions=[],this.snapshots={},i){var a=i.rev||0;this.snapshotVersions.push(a),this.snapshots[a]=i}}return createClass(e,null,[{key:"fromSnapshot",value:function(e,r,t){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],n=new this(e,void 0,void 0,arguments[4]);return t.internalAddRef(n).recreateObjFromSnapshot(r,t,i)}}]),createClass(e,[{key:"asRefForSerializedObjMap",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"????";return{__ref__:!0,id:this.id,rev:e}}},{key:"snapshotObject",value:function(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(debugSerialization&&console.log("[serialize] "+t.join(".")),t.length>100)throw new Error("Stopping serializer, encountered a possibly infinit loop: "+t.join("."));var i,n,a=this.id,o=this.realObj,s=this.snapshots;if(!o)return console.error("Cannot marshall object ref "+a+", no real object!"),_extends({},this.asRefForSerializedObjMap(),{isMissing:!0});if(i=o._rev||0,n=this.asRefForSerializedObjMap(i),lively_lang.arr.pushIfNotIncluded(this.snapshotVersions,i),s[i])return e[a]||(e[a]=s[i]),n;var l=void 0===a?"undefined":_typeof(a);if("number"===l&&(a=String(a),l="string"),"string"!==l)throw new Error("Error snapshoting "+o+": id is not a string but "+a+" (serialization path: "+t.join(".")+")");var u=r.plugin_serializeObject(o,!1,e,t);if(u)return s[i]=e[a]=u,n;var c=Object.getOwnPropertyNames(o),p={},f=s[i]=e[a]={rev:i,props:p},h=r.plugin_propertiesToSerialize(this,f,c);h&&(c=h);for(var y=0;y<c.length;y++){var d=c[y];p[d]={key:d,value:this.snapshotProperty(a,o[d],t.concat([d]),e,r)}}return r.plugin_additionallySerialize(this,f,e,t),n}},{key:"snapshotProperty",value:function(e,r,t,i,n){var a=this;if(isPrimitive(r))return r;var o=n.plugin_serializeObject(r,!0,i,t);if(o)return o;if("function"!=typeof r){if(Array.isArray(r))return r.map(function(r,o){return a.snapshotProperty(e,r,t.concat(o),i,n)});var s=n.add(r);return s&&s.isObjectRef?s.snapshotObject(i,n,t):s}}},{key:"recreateObjFromSnapshot",value:function(e,r,t){if(this.realObj)return this;debugDeserialization&&console.log("[deserialize] "+this.id+" (via "+t.join(".")+")");var i=e[this.id];if(!i)return console.error("Cannot recreateObjFromSnapshot ObjectRef "+this.id+" b/c of missing snapshot in snapshot map!"),this;var n=i.rev,a=void 0;if(n=n||0,this.snapshotVersions.push(n),this.snapshots[n]=i,(a=r.plugin_deserializeObject(this,i,t))||(a={}),void 0===a._rev&&"object"===(void 0===a?"undefined":_typeof(a))&&(a._rev=n||0),this.realObj=a,r.internalAddRef(this),!a)return this;var o=i.props,s=r.plugin_additionallyDeserializeBeforeProperties(this,a,o,i,e,t);if(s&&(o=s),o)for(var l in o)this.recreatePropertyAndSetProperty(a,o,l,e,r,t);var u=a.__serialization_id_property__||this.idPropertyName;return r.reinitializeIds&&a.hasOwnProperty(u)&&(a[u]=r.reinitializeIds(this.id,this)),r.plugin_additionallyDeserializeAfterProperties(this,a,i,e,t),this}},{key:"recreatePropertyAndSetProperty",value:function(e,r,t,i,n,a){try{var o=r[t]||{value:"NON EXISTING"},s=o.verbatim,l=o.value;e[t]=s?l:this.recreateProperty(t,l,i,n,a.concat(t))}catch(r){var u;try{u=String(e)}catch(r){u="[some "+e.constructor.name+"]"}if(r.__seen)console.error("Error deserializing property "+t+" of "+u);else{var c=t+" of "+u+" ("+JSON.stringify(l)+")";console.error("Error deserializing property "+c),r.__seen=!0}throw r}}},{key:"recreateProperty",value:function(r,t,i,n,a){var o=this;if("string"==typeof t&&n.expressionSerializer.isSerializedExpression(t))return n.expressionSerializer.deserializeExpr(t);if(isPrimitive(t))return t;if(Array.isArray(t))return t.map(function(e,r){return o.recreateProperty(r,e,i,n,a.concat(r))});var s=t.__serialization_id_property__||this.idPropertyName;return(n.refForId(t[s])||e.fromSnapshot(t[s],i,n,a,this.idPropertyName)).realObj}},{key:"isObjectRef",get:function(){return!0}},{key:"currentSnapshot",get:function(){var e=void 0;return this.snapshotVersions.length?e=lively_lang.arr.last(this.snapshotVersions):(e=0,this.snapshotVersions.push(e)),this.snapshots[e]||(this.snapshots[e]={rev:e,props:{}})}},{key:"currentRev",get:function(){return this.snapshotVersions.length?lively_lang.arr.last(this.snapshotVersions):0}}]),e}(),_name$version$depende={name:"lively.serializer2",version:"0.1.3",dependencies:{"lively.lang":"^1.0.5",semver:"^5.3.0"},devDependencies:{"mocha-es6":"*",rollup:"^0.36.1","rollup-plugin-babel":"^2.6.1","babel-plugin-external-helpers":"^6.8.0","babel-plugin-syntax-object-rest-spread":"^6.13.0","babel-plugin-transform-async-to-generator":"^6.16.0","babel-plugin-transform-object-rest-spread":"^6.16.0","babel-preset-es2015":"^6.16.0","babel-preset-es2015-rollup":"^1.1.1","babel-regenerator-runtime":"^6.5.0","babel-plugin-inline-json-import":"^0.2.1","uglify-es":"^3.3.9"},scripts:{test:"mocha-es6 tests/{test,*-test}.js",build:"node build.js"}},serializerVersion=_name$version$depende.version;function normalizeOptions(e){if((e=_extends({plugins:allPlugins,reinitializeIds:!1},e)).reinitializeIds&&"function"!=typeof e.reinitializeIds)throw new Error("serializer option 'reinitializeIds' needs to be a function(id, ref) => id");return e}function normalizeMigrations(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return{before:e.filter(function(e){return"function"==typeof e.snapshotConverter}),after:e.filter(function(e){return"function"==typeof e.objectConverter})}}function runMigrations(e,r,t,i){for(var n=0;n<e.length;n++){var a=e[n];try{t=a[r](t,i)}catch(e){console.error("migration "+a.name+" failed:"),console.error(e)}}return t}var majorAndMinorVersionRe=/\.[^\.]+$/;function serialize(e,r){var t=(r=normalizeOptions(r)).objPool||new ObjectPool(r),i="~"+serializerVersion.replace(majorAndMinorVersionRe,""),n=t.snapshotObject(e);return removeUnreachableObjects$1([n.id],n.snapshot),n.requiredVersion=i,n}function deserialize(e,r){r=normalizeOptions(r);var t=e.requiredVersion;return t&&!semver.satisfies(serializerVersion,t)&&console.warn("[lively.serializer deserialization] snapshot requires version "+t+" but serializer has incompatible version "+serializerVersion+". Deserialization might fail...!"),(r.objPool||new ObjectPool(r)).resolveFromSnapshotAndId(e)}function deserializeWithMigrations(e,r,t){var i=(t=normalizeOptions(t)).objPool||(t.objPool=new ObjectPool(t)),n=normalizeMigrations(r),a=n.before,o=n.after,s=void 0;return runMigrations(a,"snapshotConverter",e,i),"function"==typeof t.onDeserializationStart&&(s=t.onDeserializationStart(e,t)),s instanceof Promise?s.then(l):l();function l(){var r=deserialize(e,t);return runMigrations(o,"objectConverter",e,i),r}}function copy(e,r){return deserialize(serialize(e,r),r)}exports.serialize=serialize,exports.deserialize=deserialize,exports.deserializeWithMigrations=deserializeWithMigrations,exports.copy=copy,exports.ObjectRef=ObjectRef,exports.ObjectPool=ObjectPool,exports.requiredModulesOfSnapshot=requiredModulesOfSnapshot,exports.removeUnreachableObjects=removeUnreachableObjects$1}(this.lively.serializer2=this.lively.serializer2||{},lively.lang,{HTMLMorph:null},lively.bindings,semver),"undefined"!=typeof module&&module.exports&&(module.exports=GLOBAL.lively.serializer2)}();
//LIVELY.MORPHIC
!function(e,t){var n={},r={};!function(n,a){function d(){this._delay=0,this._endDelay=0,this._fill="none",this._iterationStart=0,this._iterations=1,this._duration=0,this._playbackRate=1,this._direction="normal",this._easing="linear",this._easingFunction=x}function e(){return n.isDeprecated("Invalid timing inputs","2016-03-02","TypeError exceptions will be thrown instead.",!0)}function f(e,t,r){var i=new d;return t&&(i.fill="both",i.duration="auto"),"number"!=typeof e||isNaN(e)?void 0!==e&&Object.getOwnPropertyNames(e).forEach(function(t){if("auto"!=e[t]){if(("number"==typeof i[t]||"duration"==t)&&("number"!=typeof e[t]||isNaN(e[t])))return;if("fill"==t&&-1==y.indexOf(e[t]))return;if("direction"==t&&-1==v.indexOf(e[t]))return;if("playbackRate"==t&&1!==e[t]&&n.isDeprecated("AnimationEffectTiming.playbackRate","2014-11-28","Use Animation.playbackRate instead."))return;i[t]=e[t]}}):i.duration=e,i}function i(e,t,n,r){return e<0||e>1||n<0||n>1?x:function(i){function f(e,t,n){return 3*e*(1-n)*(1-n)*n+3*t*(1-n)*n*n+n*n*n}if(i<=0){var o=0;return e>0?o=t/e:!t&&n>0&&(o=r/n),o*i}if(i>=1){var a=0;return n<1?a=(r-1)/(n-1):1==n&&e<1&&(a=(t-1)/(e-1)),1+a*(i-1)}for(var s=0,l=1;s<l;){var u=(s+l)/2,c=f(e,n,u);if(Math.abs(i-c)<1e-5)return f(t,r,u);c<i?s=u:l=u}return f(t,r,u)}}function j(e,t){return function(n){if(n>=1)return 1;var r=1/e;return(n+=t*r)-n%r}}function k(t){M||(M=document.createElement("div").style),M.animationTimingFunction="",M.animationTimingFunction=t;var n=M.animationTimingFunction;if(""==n&&e())throw new TypeError(t+" is not a valid value for easing");return n}function l(e){if("linear"==e)return x;var t=P.exec(e);if(t)return i.apply(this,t.slice(1).map(Number));var n=T.exec(e);return n?j(Number(n[1]),{start:b,middle:w,end:_}[n[2]]):S[e]||x}function o(e,t,n){if(null==t)return A;var r=n.delay+e+n.endDelay;return t<Math.min(n.delay,r)?L:t>=Math.min(n.delay+e,r)?R:E}var y="backwards|forwards|both|none".split("|"),v="reverse|alternate|alternate-reverse".split("|"),x=function(e){return e};d.prototype={_setMember:function(e,t){this["_"+e]=t,this._effect&&(this._effect._timingInput[e]=t,this._effect._timing=n.normalizeTimingInput(this._effect._timingInput),this._effect.activeDuration=n.calculateActiveDuration(this._effect._timing),this._effect._animation&&this._effect._animation._rebuildUnderlyingAnimation())},get playbackRate(){return this._playbackRate},set delay(e){this._setMember("delay",e)},get delay(){return this._delay},set endDelay(e){this._setMember("endDelay",e)},get endDelay(){return this._endDelay},set fill(e){this._setMember("fill",e)},get fill(){return this._fill},set iterationStart(t){if((isNaN(t)||t<0)&&e())throw new TypeError("iterationStart must be a non-negative number, received: "+timing.iterationStart);this._setMember("iterationStart",t)},get iterationStart(){return this._iterationStart},set duration(t){if("auto"!=t&&(isNaN(t)||t<0)&&e())throw new TypeError("duration must be non-negative or auto, received: "+t);this._setMember("duration",t)},get duration(){return this._duration},set direction(e){this._setMember("direction",e)},get direction(){return this._direction},set easing(e){this._easingFunction=l(k(e)),this._setMember("easing",e)},get easing(){return this._easing},set iterations(t){if((isNaN(t)||t<0)&&e())throw new TypeError("iterations must be non-negative, received: "+t);this._setMember("iterations",t)},get iterations(){return this._iterations}};var b=1,w=.5,_=0,S={ease:i(.25,.1,.25,1),"ease-in":i(.42,0,1,1),"ease-out":i(0,0,.58,1),"ease-in-out":i(.42,0,.58,1),"step-start":j(1,b),"step-middle":j(1,w),"step-end":j(1,_)},M=null,C="\\s*(-?\\d+\\.?\\d*|-?\\.\\d+)\\s*",P=new RegExp("cubic-bezier\\("+C+","+C+","+C+","+C+"\\)"),T=/steps\(\s*(\d+)\s*,\s*(start|middle|end)\s*\)/,A=0,L=1,R=2,E=3;n.cloneTimingInput=function c(e){if("number"==typeof e)return e;var t={};for(var n in e)t[n]=e[n];return t},n.makeTiming=f,n.numericTimingToObject=function g(e){return"number"==typeof e&&(e=isNaN(e)?{duration:0}:{duration:e}),e},n.normalizeTimingInput=function h(e,t){return f(e=n.numericTimingToObject(e),t)},n.calculateActiveDuration=function m(e){return Math.abs(function n(e){return 0===e.duration||0===e.iterations?0:e.duration*e.iterations}(e)/e.playbackRate)},n.calculateIterationProgress=function u(e,n,i){var a=o(e,n,i),l=function p(e,t,n,r,i){switch(r){case L:return"backwards"==t||"both"==t?0:null;case E:return n-i;case R:return"forwards"==t||"both"==t?e:null;case A:return null}}(e,i.fill,n,a,i.delay);if(null===l)return null;var u=function q(e,t,n,r,i){var o=i;return 0===e?t!==L&&(o+=n):o+=r/e,o}(i.duration,a,i.iterations,l,i.iterationStart),c=function r(e,t,n,i,o,a){var s=e===1/0?t%1:e%1;return 0!==s||n!==R||0===i||0===o&&0!==a||(s=1),s}(u,i.iterationStart,a,i.iterations,l,i.duration),h=function s(e,t,n,r){return e===R&&t===1/0?1/0:1===n?Math.floor(r)-1:Math.floor(r)}(a,i.iterations,c,u),d=function t(e,n,r){var i=e;if("normal"!==e&&"reverse"!==e){var o=n;"alternate-reverse"===e&&(o+=1),i="normal",o!==1/0&&o%2!=0&&(i="reverse")}return"normal"===i?r:1-r}(i.direction,h,c);return i._easingFunction(d)},n.calculatePhase=o,n.normalizeEasing=k,n.parseEasingFunction=l}(n),function(t,n){function c(e,t){return e in a&&a[e][t]||t}function e(e,t,n){if(!function d(e){return"display"===e||0===e.lastIndexOf("animation",0)||0===e.lastIndexOf("transition",0)}(e)){var o=r[e];if(o)for(var a in i.style[e]=t,o){var s=o[a],l=i.style[s];n[s]=c(s,l)}else n[e]=c(e,t)}}function f(e){var t=[];for(var n in e)if(!(n in["easing","offset","composite"])){var r=e[n];Array.isArray(r)||(r=[r]);for(var i,o=r.length,a=0;a<o;a++)(i={}).offset="offset"in e?e.offset:1==o?1:a/(o-1),"easing"in e&&(i.easing=e.easing),"composite"in e&&(i.composite=e.composite),i[n]=r[a],t.push(i)}return t.sort(function(e,t){return e.offset-t.offset}),t}var r={background:["backgroundImage","backgroundPosition","backgroundSize","backgroundRepeat","backgroundAttachment","backgroundOrigin","backgroundClip","backgroundColor"],border:["borderTopColor","borderTopStyle","borderTopWidth","borderRightColor","borderRightStyle","borderRightWidth","borderBottomColor","borderBottomStyle","borderBottomWidth","borderLeftColor","borderLeftStyle","borderLeftWidth"],borderBottom:["borderBottomWidth","borderBottomStyle","borderBottomColor"],borderColor:["borderTopColor","borderRightColor","borderBottomColor","borderLeftColor"],borderLeft:["borderLeftWidth","borderLeftStyle","borderLeftColor"],borderRadius:["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],borderRight:["borderRightWidth","borderRightStyle","borderRightColor"],borderTop:["borderTopWidth","borderTopStyle","borderTopColor"],borderWidth:["borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth"],flex:["flexGrow","flexShrink","flexBasis"],font:["fontFamily","fontSize","fontStyle","fontVariant","fontWeight","lineHeight"],margin:["marginTop","marginRight","marginBottom","marginLeft"],outline:["outlineColor","outlineStyle","outlineWidth"],padding:["paddingTop","paddingRight","paddingBottom","paddingLeft"]},i=document.createElementNS("http://www.w3.org/1999/xhtml","div"),o={thin:"1px",medium:"3px",thick:"5px"},a={borderBottomWidth:o,borderLeftWidth:o,borderRightWidth:o,borderTopWidth:o,fontSize:{"xx-small":"60%","x-small":"75%",small:"89%",medium:"100%",large:"120%","x-large":"150%","xx-large":"200%"},fontWeight:{normal:"400",bold:"700"},outlineWidth:o,textShadow:{none:"0px 0px 0px transparent"},boxShadow:{none:"0px 0px 0px 0px transparent"}};t.convertToArrayForm=f,t.normalizeKeyframes=function g(n){if(null==n)return[];window.Symbol&&Symbol.iterator&&Array.prototype.from&&n[Symbol.iterator]&&(n=Array.from(n)),Array.isArray(n)||(n=f(n));for(var r=n.map(function(n){var r={};for(var i in n){var o=n[i];if("offset"==i){if(null!=o){if(o=Number(o),!isFinite(o))throw new TypeError("Keyframe offsets must be numbers.");if(o<0||o>1)throw new TypeError("Keyframe offsets must be between 0 and 1.")}}else if("composite"==i){if("add"==o||"accumulate"==o)throw{type:DOMException.NOT_SUPPORTED_ERR,name:"NotSupportedError",message:"add compositing is not supported"};if("replace"!=o)throw new TypeError("Invalid composite mode "+o+".")}else o="easing"==i?t.normalizeEasing(o):""+o;e(i,o,r)}return void 0==r.offset&&(r.offset=null),void 0==r.easing&&(r.easing="linear"),r}),i=!0,o=-1/0,a=0;a<r.length;a++){var s=r[a].offset;if(null!=s){if(s<o)throw new TypeError("Keyframes are not loosely sorted by offset. Sort or specify offsets.");o=s}else i=!1}return r=r.filter(function(e){return e.offset>=0&&e.offset<=1}),i||function c(){var e=r.length;null==r[e-1].offset&&(r[e-1].offset=1),e>1&&null==r[0].offset&&(r[0].offset=0);for(var t=0,n=r[0].offset,i=1;i<e;i++){var o=r[i].offset;if(null!=o){for(var a=1;a<i-t;a++)r[t+a].offset=n+(o-n)*a/(i-t);t=i,n=o}}}(),r}}(n),function(e){var t={};e.isDeprecated=function(e,n,r,i){var o=i?"are":"is",a=new Date,s=new Date(n);return s.setMonth(s.getMonth()+3),!(a<s&&(e in t||console.warn("Web Animations: "+e+" "+o+" deprecated and will stop working on "+s.toDateString()+". "+r),t[e]=!0,1))},e.deprecated=function(t,n,r,i){var o=i?"are":"is";if(e.isDeprecated(t,n,r,i))throw new Error(t+" "+o+" no longer supported. "+r)}}(n),function(){if(document.documentElement.animate){var e=document.documentElement.animate([],0),t=!0;if(e&&(t=!1,"play|currentTime|pause|reverse|playbackRate|cancel|finish|startTime|playState".split("|").forEach(function(n){void 0===e[n]&&(t=!0)})),!t)return}!function(t,n,r){n.convertEffectInput=function(r){var i=function d(e){for(var t={},n=0;n<e.length;n++)for(var r in e[n])if("offset"!=r&&"easing"!=r&&"composite"!=r){var i={offset:e[n].offset,easing:e[n].easing,value:e[n][r]};t[r]=t[r]||[],t[r].push(i)}for(var o in t){var a=t[o];if(0!=a[0].offset||1!=a[a.length-1].offset)throw{type:DOMException.NOT_SUPPORTED_ERR,name:"NotSupportedError",message:"Partial keyframes are not supported"}}return t}(t.normalizeKeyframes(r)),o=function e(r){var i=[];for(var o in r)for(var a=r[o],s=0;s<a.length-1;s++){var l=s,u=s+1,c=a[l].offset,h=a[u].offset,d=c,p=h;0==s&&(d=-1/0,0==h&&(u=l)),s==a.length-2&&(p=1/0,1==c&&(l=u)),i.push({applyFrom:d,applyTo:p,startOffset:a[l].offset,endOffset:a[u].offset,easingFunction:t.parseEasingFunction(a[l].easing),property:o,interpolation:n.propertyInterpolation(o,a[l].value,a[u].value)})}return i.sort(function(e,t){return e.startOffset-t.startOffset}),i}(i);return function(e,t){if(null!=t)o.filter(function(e){return t>=e.applyFrom&&t<e.applyTo}).forEach(function(r){var i=t-r.startOffset,o=r.endOffset-r.startOffset,a=0==o?0:r.easingFunction(i/o);n.apply(e,r.property,r.interpolation(a))});else for(var r in i)"offset"!=r&&"easing"!=r&&"composite"!=r&&n.clear(e,r)}}}(n,r),function(t,n,r){function d(e){return e.replace(/-(.)/g,function(e,t){return t.toUpperCase()})}function e(e,t,n){i[n]=i[n]||[],i[n].push([e,t])}var i={};n.addPropertiesHandler=function f(t,n,r){for(var i=0;i<r.length;i++)e(t,n,d(r[i]))};var o={backgroundColor:"transparent",backgroundPosition:"0% 0%",borderBottomColor:"currentColor",borderBottomLeftRadius:"0px",borderBottomRightRadius:"0px",borderBottomWidth:"3px",borderLeftColor:"currentColor",borderLeftWidth:"3px",borderRightColor:"currentColor",borderRightWidth:"3px",borderSpacing:"2px",borderTopColor:"currentColor",borderTopLeftRadius:"0px",borderTopRightRadius:"0px",borderTopWidth:"3px",bottom:"auto",clip:"rect(0px, 0px, 0px, 0px)",color:"black",fontSize:"100%",fontWeight:"400",height:"auto",left:"auto",letterSpacing:"normal",lineHeight:"120%",marginBottom:"0px",marginLeft:"0px",marginRight:"0px",marginTop:"0px",maxHeight:"none",maxWidth:"none",minHeight:"0px",minWidth:"0px",opacity:"1.0",outlineColor:"invert",outlineOffset:"0px",outlineWidth:"3px",paddingBottom:"0px",paddingLeft:"0px",paddingRight:"0px",paddingTop:"0px",right:"auto",strokeDasharray:"none",strokeDashoffset:"0px",textIndent:"0px",textShadow:"0px 0px 0px transparent",top:"auto",transform:"",verticalAlign:"0px",visibility:"visible",width:"auto",wordSpacing:"normal",zIndex:"auto"};n.propertyInterpolation=function g(e,r,a){var s=e;/-/.test(e)&&!t.isDeprecated("Hyphenated property names","2016-03-22","Use camelCase instead.",!0)&&(s=d(e)),"initial"!=r&&"initial"!=a||("initial"==r&&(r=o[s]),"initial"==a&&(a=o[s]));for(var l=r==a?[]:i[s],u=0;l&&u<l.length;u++){var c=l[u][0](r),h=l[u][0](a);if(void 0!==c&&void 0!==h){var p=l[u][1](c,h);if(p){var f=n.Interpolation.apply(null,p);return function(e){return 0==e?r:1==e?a:f(e)}}}}return n.Interpolation(!1,!0,function(e){return e?a:r})}}(n,r),function(e,t,n){t.KeyframeEffect=function(n,r,i,o){var a,s=function d(t){var n=e.calculateActiveDuration(t),r=function(r){return e.calculateIterationProgress(n,r,t)};return r._totalDuration=t.delay+n+t.endDelay,r}(e.normalizeTimingInput(i)),l=t.convertEffectInput(r),u=function(){l(n,a)};return u._update=function(e){return null!==(a=s(e))},u._clear=function(){l(n,null)},u._hasSameTarget=function(e){return n===e},u._target=n,u._totalDuration=s._totalDuration,u._id=o,u}}(n,r),function(t,n){function d(e,t,n){n.enumerable=!0,n.configurable=!0,Object.defineProperty(e,t,n)}function e(e){this._element=e,this._surrogateStyle=document.createElementNS("http://www.w3.org/1999/xhtml","div").style,this._style=e.style,this._length=0,this._isAnimatedProperty={},this._updateSvgTransformAttr=function c(e,t){return!(!t.namespaceURI||-1==t.namespaceURI.indexOf("/svg"))&&(r in e||(e[r]=/Trident|MSIE|IEMobile|Edge|Android 4/i.test(e.navigator.userAgent)),e[r])}(window,e),this._savedTransformAttr=null;for(var t=0;t<this._style.length;t++){var n=this._style[t];this._surrogateStyle[n]=this._style[n]}this._updateIndices()}function f(t){if(!t._webAnimationsPatchedStyle){var n=new e(t);try{d(t,"style",{get:function(){return n}})}catch(n){t.style._set=function(e,n){t.style[e]=n},t.style._clear=function(e){t.style[e]=""}}t._webAnimationsPatchedStyle=t.style}}var r="_webAnimationsUpdateSvgTransformAttr",i={cssText:1,length:1,parentRule:1},o={getPropertyCSSValue:1,getPropertyPriority:1,getPropertyValue:1,item:1,removeProperty:1,setProperty:1},a={removeProperty:1,setProperty:1};for(var s in e.prototype={get cssText(){return this._surrogateStyle.cssText},set cssText(e){for(var t={},n=0;n<this._surrogateStyle.length;n++)t[this._surrogateStyle[n]]=!0;this._surrogateStyle.cssText=e,this._updateIndices();for(n=0;n<this._surrogateStyle.length;n++)t[this._surrogateStyle[n]]=!0;for(var r in t)this._isAnimatedProperty[r]||this._style.setProperty(r,this._surrogateStyle.getPropertyValue(r))},get length(){return this._surrogateStyle.length},get parentRule(){return this._style.parentRule},_updateIndices:function(){for(;this._length<this._surrogateStyle.length;)Object.defineProperty(this,this._length,{configurable:!0,enumerable:!1,get:function(e){return function(){return this._surrogateStyle[e]}}(this._length)}),this._length++;for(;this._length>this._surrogateStyle.length;)this._length--,Object.defineProperty(this,this._length,{configurable:!0,enumerable:!1,value:void 0})},_set:function(e,n){this._style[e]=n,this._isAnimatedProperty[e]=!0,this._updateSvgTransformAttr&&"transform"==t.unprefixedPropertyName(e)&&(null==this._savedTransformAttr&&(this._savedTransformAttr=this._element.getAttribute("transform")),this._element.setAttribute("transform",t.transformToSvgMatrix(n)))},_clear:function(e){this._style[e]=this._surrogateStyle[e],this._updateSvgTransformAttr&&"transform"==t.unprefixedPropertyName(e)&&(this._savedTransformAttr?this._element.setAttribute("transform",this._savedTransformAttr):this._element.removeAttribute("transform"),this._savedTransformAttr=null),delete this._isAnimatedProperty[e]}},o)e.prototype[s]=function(e,t){return function(){var n=this._surrogateStyle[e].apply(this._surrogateStyle,arguments);return t&&(this._isAnimatedProperty[arguments[0]]||this._style[e].apply(this._style,arguments),this._updateIndices()),n}}(s,s in a);for(var l in document.documentElement.style)l in i||l in o||function(t){d(e.prototype,t,{get:function(){return this._surrogateStyle[t]},set:function(e){this._surrogateStyle[t]=e,this._updateIndices(),this._isAnimatedProperty[t]||(this._style[t]=e)}})}(l);t.apply=function(e,n,r){f(e),e.style._set(t.propertyName(n),r)},t.clear=function(e,n){e._webAnimationsPatchedStyle&&e.style._clear(t.propertyName(n))}}(r),function(e){window.Element.prototype.animate=function(t,n){var r="";return n&&n.id&&(r=n.id),e.timeline._play(e.KeyframeEffect(this,t,n,r))}}(r),function(e,t){r.Interpolation=function(e,t,n){return function(r){return n(function c(e,t,n){if("number"==typeof e&&"number"==typeof t)return e*(1-n)+t*n;if("boolean"==typeof e&&"boolean"==typeof t)return n<.5?e:t;if(e.length==t.length){for(var r=[],i=0;i<e.length;i++)r.push(c(e[i],t[i],n));return r}throw"Mismatched interpolation arguments "+e+":"+t}(e,t,r))}}}(),function(e,t){var n=function(){function a(e,t){for(var n=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],r=0;r<4;r++)for(var i=0;i<4;i++)for(var o=0;o<4;o++)n[r][i]+=t[r][o]*e[o][i];return n}return function c(e,t,n,r,i){for(var o=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],s=0;s<4;s++)o[s][3]=i[s];for(s=0;s<3;s++)for(var l=0;l<3;l++)o[3][s]+=e[l]*o[l][s];var u=r[0],c=r[1],h=r[2],d=r[3],p=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];p[0][0]=1-2*(c*c+h*h),p[0][1]=2*(u*c-h*d),p[0][2]=2*(u*h+c*d),p[1][0]=2*(u*c+h*d),p[1][1]=1-2*(u*u+h*h),p[1][2]=2*(c*h-u*d),p[2][0]=2*(u*h-c*d),p[2][1]=2*(c*h+u*d),p[2][2]=1-2*(u*u+c*c),o=a(o,p);var f=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];for(n[2]&&(f[2][1]=n[2],o=a(o,f)),n[1]&&(f[2][1]=0,f[2][0]=n[0],o=a(o,f)),n[0]&&(f[2][0]=0,f[1][0]=n[0],o=a(o,f)),s=0;s<3;s++)for(l=0;l<3;l++)o[s][l]*=t[s];return function b(e){return 0==e[0][2]&&0==e[0][3]&&0==e[1][2]&&0==e[1][3]&&0==e[2][0]&&0==e[2][1]&&1==e[2][2]&&0==e[2][3]&&0==e[3][2]&&1==e[3][3]}(o)?[o[0][0],o[0][1],o[1][0],o[1][1],o[3][0],o[3][1]]:o[0].concat(o[1],o[2],o[3])}}();e.composeMatrix=n,e.quat=function d(t,n,r){var i=e.dot(t,n),o=[];if(1===(i=function c(e,t,n){return Math.max(Math.min(e,n),t)}(i,-1,1)))o=t;else for(var a=Math.acos(i),s=1*Math.sin(r*a)/Math.sqrt(1-i*i),l=0;l<4;l++)o.push(t[l]*(Math.cos(r*a)-i*s)+n[l]*s);return o}}(r),function(e,t,n){e.sequenceNumber=0;t.Animation=function(t){this.id="",t&&t._id&&(this.id=t._id),this._sequenceNumber=e.sequenceNumber++,this._currentTime=0,this._startTime=null,this._paused=!1,this._playbackRate=1,this._inTimeline=!0,this._finishedFlag=!0,this.onfinish=null,this._finishHandlers=[],this._effect=t,this._inEffect=this._effect._update(0),this._idle=!0,this._currentTimePending=!1},t.Animation.prototype={_ensureAlive:function(){this.playbackRate<0&&0===this.currentTime?this._inEffect=this._effect._update(-1):this._inEffect=this._effect._update(this.currentTime),this._inTimeline||!this._inEffect&&this._finishedFlag||(this._inTimeline=!0,t.timeline._animations.push(this))},_tickCurrentTime:function(e,t){e!=this._currentTime&&(this._currentTime=e,this._isFinished&&!t&&(this._currentTime=this._playbackRate>0?this._totalDuration:0),this._ensureAlive())},get currentTime(){return this._idle||this._currentTimePending?null:this._currentTime},set currentTime(e){e=+e,isNaN(e)||(t.restart(),this._paused||null==this._startTime||(this._startTime=this._timeline.currentTime-e/this._playbackRate),this._currentTimePending=!1,this._currentTime!=e&&(this._idle&&(this._idle=!1,this._paused=!0),this._tickCurrentTime(e,!0),t.applyDirtiedAnimation(this)))},get startTime(){return this._startTime},set startTime(e){e=+e,isNaN(e)||this._paused||this._idle||(this._startTime=e,this._tickCurrentTime((this._timeline.currentTime-this._startTime)*this.playbackRate),t.applyDirtiedAnimation(this))},get playbackRate(){return this._playbackRate},set playbackRate(e){if(e!=this._playbackRate){var n=this.currentTime;this._playbackRate=e,this._startTime=null,"paused"!=this.playState&&"idle"!=this.playState&&(this._finishedFlag=!1,this._idle=!1,this._ensureAlive(),t.applyDirtiedAnimation(this)),null!=n&&(this.currentTime=n)}},get _isFinished(){return!this._idle&&(this._playbackRate>0&&this._currentTime>=this._totalDuration||this._playbackRate<0&&this._currentTime<=0)},get _totalDuration(){return this._effect._totalDuration},get playState(){return this._idle?"idle":null==this._startTime&&!this._paused&&0!=this.playbackRate||this._currentTimePending?"pending":this._paused?"paused":this._isFinished?"finished":"running"},_rewind:function(){if(this._playbackRate>=0)this._currentTime=0;else{if(!(this._totalDuration<1/0))throw new DOMException("Unable to rewind negative playback rate animation with infinite duration","InvalidStateError");this._currentTime=this._totalDuration}},play:function(){this._paused=!1,(this._isFinished||this._idle)&&(this._rewind(),this._startTime=null),this._finishedFlag=!1,this._idle=!1,this._ensureAlive(),t.applyDirtiedAnimation(this)},pause:function(){this._isFinished||this._paused||this._idle?this._idle&&(this._rewind(),this._idle=!1):this._currentTimePending=!0,this._startTime=null,this._paused=!0},finish:function(){this._idle||(this.currentTime=this._playbackRate>0?this._totalDuration:0,this._startTime=this._totalDuration-this.currentTime,this._currentTimePending=!1,t.applyDirtiedAnimation(this))},cancel:function(){this._inEffect&&(this._inEffect=!1,this._idle=!0,this._paused=!1,this._isFinished=!0,this._finishedFlag=!0,this._currentTime=0,this._startTime=null,this._effect._update(null),t.applyDirtiedAnimation(this))},reverse:function(){this.playbackRate*=-1,this.play()},addEventListener:function(e,t){"function"==typeof t&&"finish"==e&&this._finishHandlers.push(t)},removeEventListener:function(e,t){if("finish"==e){var n=this._finishHandlers.indexOf(t);n>=0&&this._finishHandlers.splice(n,1)}},_fireEvents:function(e){if(this._isFinished){if(!this._finishedFlag){var t=new function(e,t,n){this.target=e,this.currentTime=t,this.timelineTime=n,this.type="finish",this.bubbles=!1,this.cancelable=!1,this.currentTarget=e,this.defaultPrevented=!1,this.eventPhase=Event.AT_TARGET,this.timeStamp=Date.now()}(this,this._currentTime,e),n=this._finishHandlers.concat(this.onfinish?[this.onfinish]:[]);setTimeout(function(){n.forEach(function(e){e.call(t.target,t)})},0),this._finishedFlag=!0}}else this._finishedFlag=!1},_tick:function(e,t){this._idle||this._paused||(null==this._startTime?t&&(this.startTime=e-this._currentTime/this.playbackRate):this._isFinished||this._tickCurrentTime((e-this._startTime)*this.playbackRate)),t&&(this._currentTimePending=!1,this._fireEvents(e))},get _needsTick(){return this.playState in{pending:1,running:1}||!this._finishedFlag},_targetAnimations:function(){var e=this._effect._target;return e._activeAnimations||(e._activeAnimations=[]),e._activeAnimations},_markTarget:function(){var e=this._targetAnimations();-1===e.indexOf(this)&&e.push(this)},_unmarkTarget:function(){var e=this._targetAnimations(),t=e.indexOf(this);-1!==t&&e.splice(t,1)}}}(n,r),function(t,n,r){function d(t){var n=o;o=[],t<p.currentTime&&(t=p.currentTime),p._animations.sort(e),p._animations=h(t,!0,p._animations)[0],n.forEach(function(e){e[1](t)}),g(),void 0}function e(e,t){return e._sequenceNumber-t._sequenceNumber}function f(){this._animations=[],this.currentTime=window.performance&&performance.now?performance.now():0}function g(){u.forEach(function(e){e()}),u.length=0}function h(e,t,r){c=!0,l=!1,n.timeline.currentTime=e,s=!1;var i=[],o=[],a=[],h=[];return r.forEach(function(n){n._tick(e,t),n._inEffect?(o.push(n._effect),n._markTarget()):(i.push(n._effect),n._unmarkTarget()),n._needsTick&&(s=!0);var r=n._inEffect||n._needsTick;n._inTimeline=r,r?a.push(n):h.push(n)}),u.push.apply(u,i),u.push.apply(u,o),s&&requestAnimationFrame(function(){}),c=!1,[a,h]}var i=window.requestAnimationFrame,o=[],a=0;window.requestAnimationFrame=function(e){var t=a++;return 0==o.length&&i(d),o.push([t,e]),t},window.cancelAnimationFrame=function(e){o.forEach(function(t){t[0]==e&&(t[1]=function(){})})},f.prototype={_play:function(e){e._timing=t.normalizeTimingInput(e.timing);var r=new n.Animation(e);return r._idle=!1,r._timeline=this,this._animations.push(r),n.restart(),n.applyDirtiedAnimation(r),r}};var s=!1,l=!1;n.restart=function(){return s||(s=!0,requestAnimationFrame(function(){}),l=!0),l},n.applyDirtiedAnimation=function(t){if(!c){t._markTarget();var r=t._targetAnimations();r.sort(e),h(n.timeline.currentTime,!1,r.slice())[1].forEach(function(e){var t=p._animations.indexOf(e);-1!==t&&p._animations.splice(t,1)}),g()}};var u=[],c=!1,p=new f;n.timeline=p}(n,r),function(t,n){function c(e,t){for(var n=0,r=0;r<e.length;r++)n+=e[r]*t[r];return n}function d(e,t){return[e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],e[0]*t[4]+e[4]*t[5]+e[8]*t[6]+e[12]*t[7],e[1]*t[4]+e[5]*t[5]+e[9]*t[6]+e[13]*t[7],e[2]*t[4]+e[6]*t[5]+e[10]*t[6]+e[14]*t[7],e[3]*t[4]+e[7]*t[5]+e[11]*t[6]+e[15]*t[7],e[0]*t[8]+e[4]*t[9]+e[8]*t[10]+e[12]*t[11],e[1]*t[8]+e[5]*t[9]+e[9]*t[10]+e[13]*t[11],e[2]*t[8]+e[6]*t[9]+e[10]*t[10]+e[14]*t[11],e[3]*t[8]+e[7]*t[9]+e[11]*t[10]+e[15]*t[11],e[0]*t[12]+e[4]*t[13]+e[8]*t[14]+e[12]*t[15],e[1]*t[12]+e[5]*t[13]+e[9]*t[14]+e[13]*t[15],e[2]*t[12]+e[6]*t[13]+e[10]*t[14]+e[14]*t[15],e[3]*t[12]+e[7]*t[13]+e[11]*t[14]+e[15]*t[15]]}function e(e){var t=e.rad||0;return((e.deg||0)/360+(e.grad||0)/400+(e.turn||0))*(2*Math.PI)+t}function f(t){switch(t.t){case"rotatex":var n=e(t.d[0]);return[1,0,0,0,0,Math.cos(n),Math.sin(n),0,0,-Math.sin(n),Math.cos(n),0,0,0,0,1];case"rotatey":n=e(t.d[0]);return[Math.cos(n),0,-Math.sin(n),0,0,1,0,0,Math.sin(n),0,Math.cos(n),0,0,0,0,1];case"rotate":case"rotatez":n=e(t.d[0]);return[Math.cos(n),Math.sin(n),0,0,-Math.sin(n),Math.cos(n),0,0,0,0,1,0,0,0,0,1];case"rotate3d":var r=t.d[0],i=t.d[1],o=t.d[2],a=(n=e(t.d[3]),r*r+i*i+o*o);if(0===a)r=1,i=0,o=0;else if(1!==a){var s=Math.sqrt(a);r/=s,i/=s,o/=s}var l=Math.sin(n/2),u=l*Math.cos(n/2),c=l*l;return[1-2*(i*i+o*o)*c,2*(r*i*c+o*u),2*(r*o*c-i*u),0,2*(r*i*c-o*u),1-2*(r*r+o*o)*c,2*(i*o*c+r*u),0,2*(r*o*c+i*u),2*(i*o*c-r*u),1-2*(r*r+i*i)*c,0,0,0,0,1];case"scale":return[t.d[0],0,0,0,0,t.d[1],0,0,0,0,1,0,0,0,0,1];case"scalex":return[t.d[0],0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"scaley":return[1,0,0,0,0,t.d[0],0,0,0,0,1,0,0,0,0,1];case"scalez":return[1,0,0,0,0,1,0,0,0,0,t.d[0],0,0,0,0,1];case"scale3d":return[t.d[0],0,0,0,0,t.d[1],0,0,0,0,t.d[2],0,0,0,0,1];case"skew":var h=e(t.d[0]),d=e(t.d[1]);return[1,Math.tan(d),0,0,Math.tan(h),1,0,0,0,0,1,0,0,0,0,1];case"skewx":n=e(t.d[0]);return[1,0,0,0,Math.tan(n),1,0,0,0,0,1,0,0,0,0,1];case"skewy":n=e(t.d[0]);return[1,Math.tan(n),0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"translate":return[1,0,0,0,0,1,0,0,0,0,1,0,r=t.d[0].px||0,i=t.d[1].px||0,0,1];case"translatex":return[1,0,0,0,0,1,0,0,0,0,1,0,r=t.d[0].px||0,0,0,1];case"translatey":return[1,0,0,0,0,1,0,0,0,0,1,0,0,i=t.d[0].px||0,0,1];case"translatez":return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,o=t.d[0].px||0,1];case"translate3d":return[1,0,0,0,0,1,0,0,0,0,1,0,r=t.d[0].px||0,i=t.d[1].px||0,o=t.d[2].px||0,1];case"perspective":return[1,0,0,0,0,1,0,0,0,0,1,t.d[0].px?-1/t.d[0].px:0,0,0,0,1];case"matrix":return[t.d[0],t.d[1],0,0,t.d[2],t.d[3],0,0,0,0,1,0,t.d[4],t.d[5],0,1];case"matrix3d":return t.d}}function g(e){return 0===e.length?[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]:e.map(f).reduce(d)}var r=function(){function a(e){return e[0][0]*e[1][1]*e[2][2]+e[1][0]*e[2][1]*e[0][2]+e[2][0]*e[0][1]*e[1][2]-e[0][2]*e[1][1]*e[2][0]-e[1][2]*e[2][1]*e[0][0]-e[2][2]*e[0][1]*e[1][0]}function f(e){var t=g(e);return[e[0]/t,e[1]/t,e[2]/t]}function g(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}function h(e,t,n,r){return[n*e[0]+r*t[0],n*e[1]+r*t[1],n*e[2]+r*t[2]]}return function j(t){var n=[t.slice(0,4),t.slice(4,8),t.slice(8,12),t.slice(12,16)];if(1!==n[3][3])return null;for(var r=[],o=0;o<4;o++)r.push(n[o].slice());for(o=0;o<3;o++)r[o][3]=0;if(0===a(r))return null;var s,l=[];n[0][3]||n[1][3]||n[2][3]?(l.push(n[0][3]),l.push(n[1][3]),l.push(n[2][3]),l.push(n[3][3]),s=function e(t,n){for(var r=[],i=0;i<4;i++){for(var o=0,a=0;a<4;a++)o+=t[a]*n[a][i];r.push(o)}return r}(l,function d(e){return[[e[0][0],e[1][0],e[2][0],e[3][0]],[e[0][1],e[1][1],e[2][1],e[3][1]],[e[0][2],e[1][2],e[2][2],e[3][2]],[e[0][3],e[1][3],e[2][3],e[3][3]]]}(function b(e){for(var t=1/a(e),n=e[0][0],r=e[0][1],i=e[0][2],o=e[1][0],s=e[1][1],l=e[1][2],u=e[2][0],c=e[2][1],h=e[2][2],d=[[(s*h-l*c)*t,(i*c-r*h)*t,(r*l-i*s)*t,0],[(l*u-o*h)*t,(n*h-i*u)*t,(i*o-n*l)*t,0],[(o*c-s*u)*t,(u*r-n*c)*t,(n*s-r*o)*t,0]],p=[],f=0;f<3;f++){for(var y=0,m=0;m<3;m++)y+=e[3][m]*d[m][f];p.push(y)}return p.push(1),d.push(p),d}(r)))):s=[0,0,0,1];var u=n[3].slice(0,3),p=[];p.push(n[0].slice(0,3));var y=[];y.push(g(p[0])),p[0]=f(p[0]);var m=[];p.push(n[1].slice(0,3)),m.push(c(p[0],p[1])),p[1]=h(p[1],p[0],1,-m[0]),y.push(g(p[1])),p[1]=f(p[1]),m[0]/=y[1],p.push(n[2].slice(0,3)),m.push(c(p[0],p[2])),p[2]=h(p[2],p[0],1,-m[1]),m.push(c(p[1],p[2])),p[2]=h(p[2],p[1],1,-m[2]),y.push(g(p[2])),p[2]=f(p[2]),m[1]/=y[2],m[2]/=y[2];var v=function i(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}(p[1],p[2]);if(c(p[0],v)<0)for(o=0;o<3;o++)y[o]*=-1,p[o][0]*=-1,p[o][1]*=-1,p[o][2]*=-1;var x,w,_=p[0][0]+p[1][1]+p[2][2]+1;return _>1e-4?(x=.5/Math.sqrt(_),w=[(p[2][1]-p[1][2])*x,(p[0][2]-p[2][0])*x,(p[1][0]-p[0][1])*x,.25/x]):p[0][0]>p[1][1]&&p[0][0]>p[2][2]?w=[.25*(x=2*Math.sqrt(1+p[0][0]-p[1][1]-p[2][2])),(p[0][1]+p[1][0])/x,(p[0][2]+p[2][0])/x,(p[2][1]-p[1][2])/x]:p[1][1]>p[2][2]?(x=2*Math.sqrt(1+p[1][1]-p[0][0]-p[2][2]),w=[(p[0][1]+p[1][0])/x,.25*x,(p[1][2]+p[2][1])/x,(p[0][2]-p[2][0])/x]):(x=2*Math.sqrt(1+p[2][2]-p[0][0]-p[1][1]),w=[(p[0][2]+p[2][0])/x,(p[1][2]+p[2][1])/x,.25*x,(p[1][0]-p[0][1])/x]),[u,y,m,w,s]}}();t.dot=c,t.makeMatrixDecomposition=function h(e){return[r(g(e))]},t.transformListToMatrix=g}(r),function(t){function b(e,t){var n=e.exec(t);if(n)return[n=e.ignoreCase?n[0].toLowerCase():n[0],t.substr(n.length)]}function c(e,t){var n=e(t=t.replace(/^\s*/,""));if(n)return[n[0],n[1].replace(/^\s*/,"")]}function j(e,t,n,r,i){for(var o=[],a=[],s=[],l=function f(e,t){for(var n=e,r=t;n&&r;)n>r?n%=r:r%=n;return e*t/(n+r)}(r.length,i.length),u=0;u<l;u++){var c=t(r[u%r.length],i[u%i.length]);if(!c)return;o.push(c[0]),a.push(c[1]),s.push(c[2])}return[o,a,function(t){var r=t.map(function(e,t){return s[t](e)}).join(n);return e?e(r):r}]}t.consumeToken=b,t.consumeTrimmed=c,t.consumeRepeated=function d(e,t,n){e=c.bind(null,e);for(var r=[];;){var i=e(n);if(!i)return[r,n];if(r.push(i[0]),!(i=b(t,n=i[1]))||""==i[1])return[r,n];n=i[1]}},t.consumeParenthesised=function e(t,n){for(var r=0,i=0;i<n.length&&(!/\s|,/.test(n[i])||0!=r);i++)if("("==n[i])r++;else if(")"==n[i]&&(0==--r&&i++,r<=0))break;var o=t(n.substr(0,i));return void 0==o?void 0:[o,n.substr(i)]},t.ignore=function g(e){return function(t){var n=e(t);return n&&(n[0]=void 0),n}},t.optional=function h(e,t){return function(n){return e(n)||[t,n]}},t.consumeList=function i(e,n){for(var r=[],i=0;i<e.length;i++){var o=t.consumeTrimmed(e[i],n);if(!o||""==o[0])return;void 0!==o[0]&&r.push(o[0]),n=o[1]}if(""==n)return r},t.mergeNestedRepeated=j.bind(null,null),t.mergeWrappedNestedRepeated=j,t.mergeList=function k(e,t,n){for(var r=[],i=[],o=[],a=0,s=0;s<n.length;s++)if("function"==typeof n[s]){var l=n[s](e[a],t[a++]);r.push(l[0]),i.push(l[1]),o.push(l[2])}else!function(e){r.push(!1),i.push(!1),o.push(function(){return n[e]})}(s);return[r,i,function(e){for(var t="",n=0;n<e.length;n++)t+=o[n](e[n]);return t}]}}(r),function(t){function b(e){var n={inset:!1,lengths:[],color:null},r=t.consumeRepeated(function c(e){var r;return(r=t.consumeToken(/^inset/i,e))?(n.inset=!0,r):(r=t.consumeLengthOrPercent(e))?(n.lengths.push(r[0]),r):(r=t.consumeColor(e))?(n.color=r[0],r):void 0},/^/,e);if(r&&r[0].length)return[n,r[1]]}var n=function e(n,r,i,o){function f(e){return{inset:e,color:[0,0,0,0],lengths:[{px:0},{px:0},{px:0},{px:0}]}}for(var a=[],s=[],l=0;l<i.length||l<o.length;l++){var u=i[l]||f(o[l].inset),c=o[l]||f(i[l].inset);a.push(u),s.push(c)}return t.mergeNestedRepeated(n,r,a,s)}.bind(null,function d(e,n){for(;e.lengths.length<Math.max(e.lengths.length,n.lengths.length);)e.lengths.push({px:0});for(;n.lengths.length<Math.max(e.lengths.length,n.lengths.length);)n.lengths.push({px:0});if(e.inset==n.inset&&!!e.color==!!n.color){for(var r,i=[],o=[[],0],a=[[],0],s=0;s<e.lengths.length;s++){var l=t.mergeDimensions(e.lengths[s],n.lengths[s],2==s);o[0].push(l[0]),a[0].push(l[1]),i.push(l[2])}if(e.color&&n.color){var u=t.mergeColors(e.color,n.color);o[1]=u[0],a[1]=u[1],r=u[2]}return[o,a,function(t){for(var n=e.inset?"inset ":" ",o=0;o<i.length;o++)n+=i[o](t[0][o])+" ";return r&&(n+=r(t[1])),n}]}},", ");t.addPropertiesHandler(function c(e){var n=t.consumeRepeated(b,/^,/,e);if(n&&""==n[1])return n[0]},n,["box-shadow","text-shadow"])}(r),function(t,n){function c(e){return e.toFixed(3).replace(/0+$/,"").replace(/\.$/,"")}function d(e,t,n){return Math.min(t,Math.max(e,n))}function e(e){if(/^\s*[-+]?(\d*\.)?\d+\s*$/.test(e))return Number(e)}function i(e,t){return function(n,r){return[n,r,function(n){return c(d(e,t,n))}]}}function j(t){var n=t.trim().split(/\s*[\s,]\s*/);if(0!==n.length){for(var r=[],i=0;i<n.length;i++){var o=e(n[i]);if(void 0===o)return;r.push(o)}return r}}t.clamp=d,t.addPropertiesHandler(j,function k(e,t){if(e.length==t.length)return[e,t,function(e){return e.map(c).join(" ")}]},["stroke-dasharray"]),t.addPropertiesHandler(e,i(0,1/0),["border-image-width","line-height"]),t.addPropertiesHandler(e,i(0,1),["opacity","shape-image-threshold"]),t.addPropertiesHandler(e,function g(e,t){if(0!=e)return i(0,1/0)(e,t)},["flex-grow","flex-shrink"]),t.addPropertiesHandler(e,function h(e,t){return[e,t,function(e){return Math.round(d(1,1/0,e))}]},["orphans","widows"]),t.addPropertiesHandler(e,function l(e,t){return[e,t,Math.round]},["z-index"]),t.parseNumber=e,t.parseNumberList=j,t.mergeNumbers=function f(e,t){return[e,t,c]},t.numberToString=c}(r),function(e,t){r.addPropertiesHandler(String,function c(e,t){if("visible"==e||"visible"==t)return[0,1,function(n){return n<=0?e:n>=1?t:"visible"}]},["visibility"])}(),function(e,t){function c(e){e=e.trim(),r.fillStyle="#000",r.fillStyle=e;var t=r.fillStyle;if(r.fillStyle="#fff",r.fillStyle=e,t==r.fillStyle){r.fillRect(0,0,1,1);var n=r.getImageData(0,0,1,1).data;r.clearRect(0,0,1,1);var i=n[3]/255;return[n[0]*i,n[1]*i,n[2]*i,i]}}function d(t,n){return[t,n,function(t){function c(e){return Math.max(0,Math.min(255,e))}if(t[3])for(var n=0;n<3;n++)t[n]=Math.round(c(t[n]/t[3]));return t[3]=e.numberToString(e.clamp(0,1,t[3])),"rgba("+t.join(",")+")"}]}var n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");n.width=n.height=1;var r=n.getContext("2d");e.addPropertiesHandler(c,d,["background-color","border-bottom-color","border-left-color","border-right-color","border-top-color","color","fill","flood-color","lighting-color","outline-color","stop-color","stroke","text-decoration-color"]),e.consumeColor=e.consumeParenthesised.bind(null,c),e.mergeColors=d}(r),function(t,n){function c(t){function b(){var e=r.exec(t);n=e?e[0]:void 0}function d(){if("("!==n)return function c(){var e=Number(n);return b(),e}();b();var e=f();return")"!==n?NaN:(b(),e)}function e(){for(var e=d();"*"===n||"/"===n;){var t=n;b();var r=d();"*"===t?e*=r:e/=r}return e}function f(){for(var t=e();"+"===n||"-"===n;){var r=n;b();var i=e();"+"===r?t+=i:t-=i}return t}var n,r=/([\+\-\w\.]+|[\(\)\*\/])/g;return b(),f()}function d(e,t){if("0"==(t=t.trim().toLowerCase())&&"px".search(e)>=0)return{px:0};if(/^[^(]*$|^calc/.test(t)){var n={};t=(t=t.replace(/calc\(/g,"(")).replace(e,function(e){return n[e]=null,"U"+e});for(var r="U("+e.source+")",i=t.replace(/[-+]?(\d*\.)?\d+([Ee][-+]?\d+)?/g,"N").replace(new RegExp("N"+r,"g"),"D").replace(/\s[+-]\s/g,"O").replace(/\s/g,""),o=[/N\*(D)/g,/(N|D)[*\/]N/g,/(N|D)O\1/g,/\((N|D)\)/g],a=0;a<o.length;)o[a].test(i)?(i=i.replace(o[a],"$1"),a=0):a++;if("D"==i){for(var s in n){var l=c(t.replace(new RegExp("U"+s,"g"),"").replace(new RegExp(r,"g"),"*0"));if(!isFinite(l))return;n[s]=l}return n}}}function e(e,t){return f(e,t,!0)}function f(e,n,r){var i,o=[];for(i in e)o.push(i);for(i in n)o.indexOf(i)<0&&o.push(i);return e=o.map(function(t){return e[t]||0}),n=o.map(function(e){return n[e]||0}),[e,n,function(e){var n=e.map(function(n,i){return 1==e.length&&r&&(n=Math.max(n,0)),t.numberToString(n)+o[i]}).join(" + ");return e.length>1?"calc("+n+")":n}]}var r="px|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc",i=d.bind(null,new RegExp(r,"g")),o=d.bind(null,new RegExp(r+"|%","g")),a=d.bind(null,/deg|rad|grad|turn/g);t.parseLength=i,t.parseLengthOrPercent=o,t.consumeLengthOrPercent=t.consumeParenthesised.bind(null,o),t.parseAngle=a,t.mergeDimensions=f;var s=t.consumeParenthesised.bind(null,i),l=t.consumeRepeated.bind(void 0,s,/^/),u=t.consumeRepeated.bind(void 0,l,/^,/);t.consumeSizePairList=u;var h=t.mergeNestedRepeated.bind(void 0,e," "),p=t.mergeNestedRepeated.bind(void 0,h,",");t.mergeNonNegativeSizePair=h,t.addPropertiesHandler(function(e){var t=u(e);if(t&&""==t[1])return t[0]},p,["background-size"]),t.addPropertiesHandler(o,e,["border-bottom-width","border-image-width","border-left-width","border-right-width","border-top-width","flex-basis","font-size","height","line-height","max-height","max-width","outline-width","width"]),t.addPropertiesHandler(o,f,["border-bottom-left-radius","border-bottom-right-radius","border-top-left-radius","border-top-right-radius","bottom","left","letter-spacing","margin-bottom","margin-left","margin-right","margin-top","min-height","min-width","outline-offset","padding-bottom","padding-left","padding-right","padding-top","perspective","right","shape-margin","stroke-dashoffset","text-indent","top","vertical-align","word-spacing"])}(r),function(t,n){function c(e){return t.consumeLengthOrPercent(e)||t.consumeToken(/^auto/,e)}function d(e){var n=t.consumeList([t.ignore(t.consumeToken.bind(null,/^rect/)),t.ignore(t.consumeToken.bind(null,/^\(/)),t.consumeRepeated.bind(null,c,/^,/),t.ignore(t.consumeToken.bind(null,/^\)/))],e);if(n&&4==n[0].length)return n[0]}var r=t.mergeWrappedNestedRepeated.bind(null,function f(e){return"rect("+e+")"},function e(n,r){return"auto"==n||"auto"==r?[!0,!1,function(e){var i=e?n:r;if("auto"==i)return"auto";var o=t.mergeDimensions(i,i);return o[2](o[0])}]:t.mergeDimensions(n,r)},", ");t.parseBox=d,t.mergeBoxes=r,t.addPropertiesHandler(d,r,["clip"])}(r),function(t,n){function c(e){return function(t){var n=0;return e.map(function(e){return e===r?t[n++]:e})}}function d(e){return e}function e(e){if("none"==(e=e.toLowerCase().trim()))return[];for(var n,r=/\s*(\w+)\(([^)]*)\)/g,i=[],l=0;n=r.exec(e);){if(n.index!=l)return;l=n.index+n[0].length;var u=n[1],c=s[u];if(!c)return;var h=n[2].split(","),d=c[0];if(d.length<h.length)return;for(var p=[],f=0;f<d.length;f++){var y,m=h[f],g=d[f];if(void 0===(y=m?{A:function(e){return"0"==e.trim()?a:t.parseAngle(e)},N:t.parseNumber,T:t.parseLengthOrPercent,L:t.parseLength}[g.toUpperCase()](m):{a:a,n:p[0],t:o}[g]))return;p.push(y)}if(i.push({t:u,d:p}),r.lastIndex==e.length)return i}}function f(e){return e.toFixed(6).replace(".000000","")}function g(e,n){if(e.decompositionPair!==n){e.decompositionPair=n;var r=t.makeMatrixDecomposition(e)}if(n.decompositionPair!==e){n.decompositionPair=e;var i=t.makeMatrixDecomposition(n)}return null==r[0]||null==i[0]?[[!1],[!0],function(t){return t?n[0].d:e[0].d}]:(r[0].push(0),i[0].push(1),[r,i,function(e){var n=t.quat(r[0][3],i[0][3],e[5]);return t.composeMatrix(e[0],e[1],e[2],n,e[4]).map(f).join(",")}])}function h(e){return e.replace(/[xy]/,"")}function i(e){return e.replace(/(x|y|z|3d)?$/,"3d")}var r=null,o={px:0},a={deg:0},s={matrix:["NNNNNN",[r,r,0,0,r,r,0,0,0,0,1,0,r,r,0,1],d],matrix3d:["NNNNNNNNNNNNNNNN",d],rotate:["A"],rotatex:["A"],rotatey:["A"],rotatez:["A"],rotate3d:["NNNA"],perspective:["L"],scale:["Nn",c([r,r,1]),d],scalex:["N",c([r,1,1]),c([r,1])],scaley:["N",c([1,r,1]),c([1,r])],scalez:["N",c([1,1,r])],scale3d:["NNN",d],skew:["Aa",null,d],skewx:["A",null,c([r,a])],skewy:["A",null,c([a,r])],translate:["Tt",c([r,r,o]),d],translatex:["T",c([r,o,o]),c([r,o])],translatey:["T",c([o,r,o]),c([o,r])],translatez:["L",c([o,o,r])],translate3d:["TTL",d]};t.addPropertiesHandler(e,function j(e,n){var r=t.makeMatrixDecomposition&&!0,o=!1;if(!e.length||!n.length){e.length||(o=!0,e=n,n=[]);for(var a=0;a<e.length;a++){var l=e[a].t,u=e[a].d,c="scale"==l.substr(0,5)?1:0;n.push({t:l,d:u.map(function(e){if("number"==typeof e)return c;var t={};for(var n in e)t[n]=c;return t})})}}var d=function(e,t){return"perspective"==e&&"perspective"==t||("matrix"==e||"matrix3d"==e)&&("matrix"==t||"matrix3d"==t)},p=[],f=[],y=[];if(e.length!=n.length){if(!r)return;p=[(k=g(e,n))[0]],f=[k[1]],y=[["matrix",[k[2]]]]}else for(a=0;a<e.length;a++){var m=e[a].t,v=n[a].t,x=e[a].d,b=n[a].d,w=s[m],_=s[v];if(d(m,v)){if(!r)return;var k=g([e[a]],[n[a]]);p.push(k[0]),f.push(k[1]),y.push(["matrix",[k[2]]])}else{if(m==v)l=m;else if(w[2]&&_[2]&&h(m)==h(v))l=h(m),x=w[2](x),b=_[2](b);else{if(!w[1]||!_[1]||i(m)!=i(v)){if(!r)return;p=[(k=g(e,n))[0]],f=[k[1]],y=[["matrix",[k[2]]]];break}l=i(m),x=w[1](x),b=_[1](b)}for(var S=[],M=[],C=[],P=0;P<x.length;P++)k=("number"==typeof x[P]?t.mergeNumbers:t.mergeDimensions)(x[P],b[P]),S[P]=k[0],M[P]=k[1],C.push(k[2]);p.push(S),f.push(M),y.push([l,C])}}if(o){var T=p;p=f,f=T}return[p,f,function(e){return e.map(function(e,t){var n=e.map(function(e,n){return y[t][1][n](e)}).join(",");return"matrix"==y[t][0]&&16==n.split(",").length&&(y[t][0]="matrix3d"),y[t][0]+"("+n+")"}).join(" ")}]},["transform"]),t.transformToSvgMatrix=function(n){var r=t.transformListToMatrix(e(n));return"matrix("+f(r[0])+" "+f(r[1])+" "+f(r[4])+" "+f(r[5])+" "+f(r[12])+" "+f(r[13])+")"}}(r),function(e){function c(t){return t=100*Math.round(t/100),400===(t=e.clamp(100,900,t))?"normal":700===t?"bold":String(t)}e.addPropertiesHandler(function b(e){var t=Number(e);if(!(isNaN(t)||t<100||t>900||t%100!=0))return t},function d(e,t){return[e,t,c]},["font-weight"])}(r),function(t){function b(e){var t={};for(var n in e)t[n]=-e[n];return t}function c(e){return t.consumeToken(/^(left|center|right|top|bottom)\b/i,e)||t.consumeLengthOrPercent(e)}function d(e,r){var i=t.consumeRepeated(c,/^/,r);if(i&&""==i[1]){var o=i[0];if(o[0]=o[0]||"center",o[1]=o[1]||"center",3==e&&(o[2]=o[2]||{px:0}),o.length==e){if(/top|bottom/.test(o[0])||/left|right/.test(o[1])){var a=o[0];o[0]=o[1],o[1]=a}if(/left|right|center|Object/.test(o[0])&&/top|bottom|center|Object/.test(o[1]))return o.map(function(e){return"object"==typeof e?e:n[e]})}}}function e(e){var r=t.consumeRepeated(c,/^/,e);if(r){for(var i=r[0],o=[{"%":50},{"%":50}],a=0,s=!1,l=0;l<i.length;l++){var u=i[l];"string"==typeof u?(s=/bottom|right/.test(u),o[a={left:0,right:0,center:a,top:1,bottom:1}[u]]=n[u],"center"==u&&a++):(s&&((u=b(u))["%"]=(u["%"]||0)+100),o[a]=u,a++,s=!1)}return[o,r[1]]}}var n={left:{"%":0},center:{"%":50},right:{"%":100},top:{"%":0},bottom:{"%":100}},r=t.mergeNestedRepeated.bind(null,t.mergeDimensions," ");t.addPropertiesHandler(d.bind(null,3),r,["transform-origin"]),t.addPropertiesHandler(d.bind(null,2),r,["perspective-origin"]),t.consumePosition=e,t.mergeOffsetList=r;var i=t.mergeNestedRepeated.bind(null,r,", ");t.addPropertiesHandler(function f(n){var r=t.consumeRepeated(e,/^,/,n);if(r&&""==r[1])return r[0]},i,["background-position","object-position"])}(r),function(e){var t=e.consumeParenthesised.bind(null,e.parseLengthOrPercent),n=e.consumeRepeated.bind(void 0,t,/^/),r=e.mergeNestedRepeated.bind(void 0,e.mergeDimensions," "),i=e.mergeNestedRepeated.bind(void 0,r,",");e.addPropertiesHandler(function b(r){var i=e.consumeToken(/^circle/,r);if(i&&i[0])return["circle"].concat(e.consumeList([e.ignore(e.consumeToken.bind(void 0,/^\(/)),t,e.ignore(e.consumeToken.bind(void 0,/^at/)),e.consumePosition,e.ignore(e.consumeToken.bind(void 0,/^\)/))],i[1]));var o=e.consumeToken(/^ellipse/,r);if(o&&o[0])return["ellipse"].concat(e.consumeList([e.ignore(e.consumeToken.bind(void 0,/^\(/)),n,e.ignore(e.consumeToken.bind(void 0,/^at/)),e.consumePosition,e.ignore(e.consumeToken.bind(void 0,/^\)/))],o[1]));var a=e.consumeToken(/^polygon/,r);return a&&a[0]?["polygon"].concat(e.consumeList([e.ignore(e.consumeToken.bind(void 0,/^\(/)),e.optional(e.consumeToken.bind(void 0,/^nonzero\s*,|^evenodd\s*,/),"nonzero,"),e.consumeSizePairList,e.ignore(e.consumeToken.bind(void 0,/^\)/))],a[1])):void 0},function c(t,n){if(t[0]===n[0])return"circle"==t[0]?e.mergeList(t.slice(1),n.slice(1),["circle(",e.mergeDimensions," at ",e.mergeOffsetList,")"]):"ellipse"==t[0]?e.mergeList(t.slice(1),n.slice(1),["ellipse(",e.mergeNonNegativeSizePair," at ",e.mergeOffsetList,")"]):"polygon"==t[0]&&t[1]==n[1]?e.mergeList(t.slice(2),n.slice(2),["polygon(",t[1],i,")"]):void 0},["shape-outside"])}(r),function(e,t){function c(e,t){t.concat([e]).forEach(function(t){t in document.documentElement.style&&(n[e]=t),r[t]=e})}var n={},r={};c("transform",["webkitTransform","msTransform"]),c("transformOrigin",["webkitTransformOrigin"]),c("perspective",["webkitPerspective"]),c("perspectiveOrigin",["webkitPerspectiveOrigin"]),e.propertyName=function(e){return n[e]||e},e.unprefixedPropertyName=function(e){return r[e]||e}}(r)}(),function(){if(void 0===document.createElement("div").animate([]).oncancel){if(window.performance&&performance.now)var e=function(){return performance.now()};else e=function(){return Date.now()};var t=window.Element.prototype.animate;window.Element.prototype.animate=function(n,r){var i=t.call(this,n,r);i._cancelHandlers=[],i.oncancel=null;var o=i.cancel;i.cancel=function(){o.call(this);var t=new function(e,t,n){this.target=e,this.currentTime=t,this.timelineTime=n,this.type="cancel",this.bubbles=!1,this.cancelable=!1,this.currentTarget=e,this.defaultPrevented=!1,this.eventPhase=Event.AT_TARGET,this.timeStamp=Date.now()}(this,null,e()),n=this._cancelHandlers.concat(this.oncancel?[this.oncancel]:[]);setTimeout(function(){n.forEach(function(e){e.call(t.target,t)})},0)};var a=i.addEventListener;i.addEventListener=function(e,t){"function"==typeof t&&"cancel"==e?this._cancelHandlers.push(t):a.call(this,e,t)};var s=i.removeEventListener;return i.removeEventListener=function(e,t){if("cancel"==e){var n=this._cancelHandlers.indexOf(t);n>=0&&this._cancelHandlers.splice(n,1)}else s.call(this,e,t)},i}}}(),function(e){var t=document.documentElement,n=null,r=!1;try{var i="0"==getComputedStyle(t).getPropertyValue("opacity")?"1":"0";(n=t.animate({opacity:[i,i]},{duration:1})).currentTime=0,r=getComputedStyle(t).getPropertyValue("opacity")==i}catch(e){}finally{n&&n.cancel()}if(!r){var o=window.Element.prototype.animate;window.Element.prototype.animate=function(t,n){return window.Symbol&&Symbol.iterator&&Array.prototype.from&&t[Symbol.iterator]&&(t=Array.from(t)),Array.isArray(t)||null===t||(t=e.convertToArrayForm(t)),o.call(this,t,n)}}}(n),t.true={}}(0,function(){return this}()),function(){var e,t;!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).kldIntersections=e()}}(function(){return function e(t,n,r){function s(o,a){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(i)return i(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return s(n||e)},c,c.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(e,t,n){n.Intersection=e("./lib/Intersection"),n.IntersectionArgs=e("./lib/IntersectionArgs"),n.Shapes=e("./lib/Shapes"),n.AffineShapes=e("./lib/AffineShapes"),n.IntersectionQuery=e("./lib/IntersectionQuery"),n.Point2D=e("kld-affine").Point2D,n.Vector2D=e("kld-affine").Vector2D,n.Matrix2D=e("kld-affine").Matrix2D},{"./lib/AffineShapes":2,"./lib/Intersection":3,"./lib/IntersectionArgs":4,"./lib/IntersectionQuery":5,"./lib/Shapes":6,"kld-affine":7}],2:[function(e,t,n){if(void 0!==t){e("kld-affine").Point2D;var r=e("./IntersectionArgs")}var i={quadraticBezier:function(e,t,n){return new r("Bezier2",[e,t,n])},cubicBezier:function(e,t,n,i){return new r("Bezier3",[e,t,n,i])},circle:function(e,t){return new r("Circle",[e,t])},ellipse:function(e,t,n){return new r("Ellipse",[e,t,n])},line:function(e,t){return new r("Line",[e,t])},path:function(e){return new r("Path",[e])},polygon:function(e){return new r("Polygon",[e])},polyline:function(e){return new r("Polyline",[e])},rectangle:function(e,t){return new r("Rectangle",[e,e.add(t)])}};void 0!==t&&(t.exports=i)},{"./IntersectionArgs":4,"kld-affine":7}],3:[function(e,t,n){if(void 0!==t)var r=e("kld-affine").Point2D,i=e("kld-affine").Vector2D,o=e("kld-polynomial").Polynomial;function closePolygon(e){var t=e.slice();return t.push(e[0]),t}function Intersection(e){this.init(e)}Intersection.prototype.init=function(e){this.status=e,this.points=new Array},Intersection.prototype.appendPoint=function(e){this.points.push(e)},Intersection.prototype.appendPoints=function(e){this.points=this.points.concat(e)},Intersection.intersect=function(e,t){var n;if(null!=e&&null!=t)if("Path"==e.name)n=Intersection.intersectPathShape(e,t);else if("Path"==t.name)n=Intersection.intersectPathShape(t,e);else{var r,i;if(e.name<t.name?(r="intersect"+e.name+t.name,i=e.args.concat(t.args)):(r="intersect"+t.name+e.name,i=t.args.concat(e.args)),!(r in Intersection))throw new Error("Intersection not available: "+r);n=Intersection[r].apply(null,i)}else n=new Intersection("No Intersection");return n},Intersection.intersectPathShape=function(e,t){for(var n=new Intersection("No Intersection"),r=e.args.length,i=0;i<r;i++){var o=e.args[i],a=Intersection.intersect(o,t);n.appendPoints(a.points)}return n.points.length>0&&(n.status="Intersection"),n},Intersection.intersectBezier2Bezier2=function(e,t,n,i,a,s){var l,u,c,h,d,p,f,y,m,g=new Intersection("No Intersection");if(l=t.multiply(-2),c=e.add(l.add(n)),l=e.multiply(-2),u=t.multiply(2),h=l.add(u),d=new r(e.x,e.y),l=a.multiply(-2),p=i.add(l.add(s)),l=i.multiply(-2),u=a.multiply(2),f=l.add(u),y=new r(i.x,i.y),0==c.y){var v=(b=c.x*(d.y-y.y))+(w=b-h.x*h.y),x=h.y*h.y;m=new o(c.x*p.y*p.y,2*c.x*f.y*p.y,c.x*f.y*f.y-p.x*x-p.y*b-p.y*w,-f.x*x-f.y*b-f.y*w,(d.x-y.x)*x+(d.y-y.y)*w)}else{var b=c.x*p.y-c.y*p.x,w=c.x*f.y-f.x*c.y,_=(v=h.x*c.y-h.y*c.x,x=d.y-y.y,c.y*(d.x-y.x)-c.x*x),k=-h.y*v+c.y*_,S=v*v;m=new o(b*b,2*b*w,(-p.y*S+c.y*w*w+c.y*b*_+b*k)/c.y,(-f.y*S+c.y*w*_+w*k)/c.y,(x*S+_*k)/c.y)}for(var M=m.getRoots(),C=0;C<M.length;C++){var P=M[C];if(0<=P&&P<=1){var T=new o(c.x,h.x,d.x-y.x-P*f.x-P*P*p.x).getRoots(),A=new o(c.y,h.y,d.y-y.y-P*f.y-P*P*p.y).getRoots();if(T.length>0&&A.length>0){e:for(var L=0;L<T.length;L++){var R=T[L];if(0<=R&&R<=1)for(var E=0;E<A.length;E++)if(Math.abs(R-A[E])<1e-4){g.points.push(p.multiply(P*P).add(f.multiply(P).add(y)));break e}}}}}return g.points.length>0&&(g.status="Intersection"),g},Intersection.intersectBezier2Bezier3=function(e,t,n,a,s,l,u){var c,h,d,p,f,y,m,g,v,x,b,w=new Intersection("No Intersection");c=t.multiply(-2),f=e.add(c.add(n)),c=e.multiply(-2),h=t.multiply(2),y=c.add(h),m=new r(e.x,e.y),c=a.multiply(-1),h=s.multiply(3),d=l.multiply(-3),p=c.add(h.add(d.add(u))),g=new i(p.x,p.y),c=a.multiply(3),h=s.multiply(-6),d=l.multiply(3),p=c.add(h.add(d)),v=new i(p.x,p.y),c=a.multiply(-3),h=s.multiply(3),d=c.add(h),x=new i(d.x,d.y),b=new i(a.x,a.y);for(var _=m.x*m.x,k=m.y*m.y,S=y.x*y.x,M=y.y*y.y,C=f.x*f.x,P=f.y*f.y,T=b.x*b.x,A=b.y*b.y,L=x.x*x.x,R=x.y*x.y,E=v.x*v.x,z=v.y*v.y,O=g.x*g.x,I=g.y*g.y,D=new o(-2*f.x*f.y*g.x*g.y+C*I+P*O,-2*f.x*f.y*v.x*g.y-2*f.x*f.y*v.y*g.x+2*P*v.x*g.x+2*C*v.y*g.y,-2*f.x*x.x*f.y*g.y-2*f.x*f.y*x.y*g.x-2*f.x*f.y*v.x*v.y+2*x.x*P*g.x+P*E+C*(2*x.y*g.y+z),2*m.x*f.x*f.y*g.y+2*m.y*f.x*f.y*g.x+y.x*y.y*f.x*g.y+y.x*y.y*f.y*g.x-2*b.x*f.x*f.y*g.y-2*f.x*b.y*f.y*g.x-2*f.x*x.x*f.y*v.y-2*f.x*f.y*x.y*v.x-2*m.x*P*g.x-2*m.y*C*g.y+2*b.x*P*g.x+2*x.x*P*v.x-M*f.x*g.x-S*f.y*g.y+C*(2*b.y*g.y+2*x.y*v.y),2*m.x*f.x*f.y*v.y+2*m.y*f.x*f.y*v.x+y.x*y.y*f.x*v.y+y.x*y.y*f.y*v.x-2*b.x*f.x*f.y*v.y-2*f.x*b.y*f.y*v.x-2*f.x*x.x*f.y*x.y-2*m.x*P*v.x-2*m.y*C*v.y+2*b.x*P*v.x-M*f.x*v.x-S*f.y*v.y+L*P+C*(2*b.y*v.y+R),2*m.x*f.x*f.y*x.y+2*m.y*f.x*x.x*f.y+y.x*y.y*f.x*x.y+y.x*y.y*x.x*f.y-2*b.x*f.x*f.y*x.y-2*f.x*b.y*x.x*f.y-2*m.x*x.x*P-2*m.y*C*x.y+2*b.x*x.x*P-M*f.x*x.x-S*f.y*x.y+2*C*b.y*x.y,-2*m.x*m.y*f.x*f.y-m.x*y.x*y.y*f.y-m.y*y.x*y.y*f.x+2*m.x*f.x*b.y*f.y+2*m.y*b.x*f.x*f.y+y.x*b.x*y.y*f.y+y.x*y.y*f.x*b.y-2*b.x*f.x*b.y*f.y-2*m.x*b.x*P+m.x*M*f.x+m.y*S*f.y-2*m.y*C*b.y-b.x*M*f.x-S*b.y*f.y+_*P+k*C+T*P+C*A).getRootsInInterval(0,1),N=0;N<D.length;N++){var F=D[N],B=new o(f.x,y.x,m.x-b.x-F*x.x-F*F*v.x-F*F*F*g.x).getRoots(),j=new o(f.y,y.y,m.y-b.y-F*x.y-F*F*v.y-F*F*F*g.y).getRoots();if(B.length>0&&j.length>0){e:for(var W=0;W<B.length;W++){var H=B[W];if(0<=H&&H<=1)for(var V=0;V<j.length;V++)if(Math.abs(H-j[V])<1e-4){w.points.push(g.multiply(F*F*F).add(v.multiply(F*F).add(x.multiply(F).add(b))));break e}}}}return w.points.length>0&&(w.status="Intersection"),w},Intersection.intersectBezier2Circle=function(e,t,n,r,i){return Intersection.intersectBezier2Ellipse(e,t,n,r,i,i)},Intersection.intersectBezier2Ellipse=function(e,t,n,i,a,s){var l,u,c,h,d,p=new Intersection("No Intersection");l=t.multiply(-2),c=e.add(l.add(n)),l=e.multiply(-2),u=t.multiply(2),h=l.add(u),d=new r(e.x,e.y);for(var f=a*a,y=s*s,m=new o(y*c.x*c.x+f*c.y*c.y,2*(y*c.x*h.x+f*c.y*h.y),y*(2*c.x*d.x+h.x*h.x)+f*(2*c.y*d.y+h.y*h.y)-2*(y*i.x*c.x+f*i.y*c.y),2*(y*h.x*(d.x-i.x)+f*h.y*(d.y-i.y)),y*(d.x*d.x+i.x*i.x)+f*(d.y*d.y+i.y*i.y)-2*(y*i.x*d.x+f*i.y*d.y)-f*y).getRoots(),g=0;g<m.length;g++){var v=m[g];0<=v&&v<=1&&p.points.push(c.multiply(v*v).add(h.multiply(v).add(d)))}return p.points.length>0&&(p.status="Intersection"),p},Intersection.intersectBezier2Line=function(e,t,n,a,s){var l,u,c,h,d,p,f,y=a.min(s),m=a.max(s),g=new Intersection("No Intersection");l=t.multiply(-2),c=e.add(l.add(n)),l=e.multiply(-2),u=t.multiply(2),h=l.add(u),d=new r(e.x,e.y),f=new i(a.y-s.y,s.x-a.x),p=a.x*s.y-s.x*a.y,roots=new o(f.dot(c),f.dot(h),f.dot(d)+p).getRoots();for(var v=0;v<roots.length;v++){var x=roots[v];if(0<=x&&x<=1){var b=e.lerp(t,x),w=t.lerp(n,x),_=b.lerp(w,x);a.x==s.x?y.y<=_.y&&_.y<=m.y&&(g.status="Intersection",g.appendPoint(_)):a.y==s.y?y.x<=_.x&&_.x<=m.x&&(g.status="Intersection",g.appendPoint(_)):y.x<=_.x&&_.x<=m.x&&y.y<=_.y&&_.y<=m.y&&(g.status="Intersection",g.appendPoint(_))}}return g},Intersection.intersectBezier2Polygon=function(e,t,n,r){return this.intersectBezier2Polyline(e,t,n,closePolygon(r))},Intersection.intersectBezier2Polyline=function(e,t,n,r){for(var i=new Intersection("No Intersection"),o=r.length,a=0;a<o-1;a++){var s=r[a],l=r[a+1],u=Intersection.intersectBezier2Line(e,t,n,s,l);i.appendPoints(u.points)}return i.points.length>0&&(i.status="Intersection"),i},Intersection.intersectBezier2Rectangle=function(e,t,n,i,o){var a=i.min(o),s=i.max(o),l=new r(s.x,a.y),u=new r(a.x,s.y),c=Intersection.intersectBezier2Line(e,t,n,a,l),h=Intersection.intersectBezier2Line(e,t,n,l,s),d=Intersection.intersectBezier2Line(e,t,n,s,u),p=Intersection.intersectBezier2Line(e,t,n,u,a),f=new Intersection("No Intersection");return f.appendPoints(c.points),f.appendPoints(h.points),f.appendPoints(d.points),f.appendPoints(p.points),f.points.length>0&&(f.status="Intersection"),f},Intersection.intersectBezier3Bezier3=function(e,t,n,r,a,s,l,u){var c,h,d,p,f,y,m,g,v,x,b,w,_=new Intersection("No Intersection");c=e.multiply(-1),h=t.multiply(3),d=n.multiply(-3),p=c.add(h.add(d.add(r))),f=new i(p.x,p.y),c=e.multiply(3),h=t.multiply(-6),d=n.multiply(3),p=c.add(h.add(d)),y=new i(p.x,p.y),c=e.multiply(-3),h=t.multiply(3),d=c.add(h),m=new i(d.x,d.y),g=new i(e.x,e.y),c=a.multiply(-1),h=s.multiply(3),d=l.multiply(-3),p=c.add(h.add(d.add(u))),v=new i(p.x,p.y),c=a.multiply(3),h=s.multiply(-6),d=l.multiply(3),p=c.add(h.add(d)),x=new i(p.x,p.y),c=a.multiply(-3),h=s.multiply(3),d=c.add(h),b=new i(d.x,d.y),w=new i(a.x,a.y);for(var k=g.x*g.x,S=g.x*g.x*g.x,M=g.y*g.y,C=g.y*g.y*g.y,P=m.x*m.x,T=m.x*m.x*m.x,A=m.y*m.y,L=m.y*m.y*m.y,R=y.x*y.x,E=y.x*y.x*y.x,z=y.y*y.y,O=y.y*y.y*y.y,I=f.x*f.x,D=f.x*f.x*f.x,N=f.y*f.y,F=f.y*f.y*f.y,B=w.x*w.x,j=w.x*w.x*w.x,W=w.y*w.y,H=w.y*w.y*w.y,V=b.x*b.x,U=b.x*b.x*b.x,q=b.y*b.y,G=x.x*x.x,$=x.x*x.x*x.x,K=x.y*x.y,X=v.x*v.x,Y=v.x*v.x*v.x,J=v.y*v.y,Q=v.y*v.y*v.y,Z=new o(-D*Q+F*Y-3*f.x*N*X*v.y+3*I*f.y*v.x*J,-6*f.x*x.x*N*v.x*v.y+6*I*f.y*x.y*v.x*v.y+3*x.x*F*X-3*D*x.y*J-3*f.x*N*x.y*X+3*I*x.x*f.y*J,-6*b.x*f.x*N*v.x*v.y-6*f.x*x.x*N*x.y*v.x+6*I*x.x*f.y*x.y*v.y+3*b.x*F*X+3*G*F*v.x+3*b.x*I*f.y*J-3*f.x*b.y*N*X-3*f.x*G*N*v.y+I*f.y*v.x*(6*b.y*v.y+3*K)+D*(-b.y*J-2*K*v.y-v.y*(2*b.y*v.y+K)),m.x*y.y*f.x*f.y*v.x*v.y-m.y*y.x*f.x*f.y*v.x*v.y+6*b.x*x.x*F*v.x+3*m.x*y.x*f.x*f.y*J+6*g.x*f.x*N*v.x*v.y-3*m.x*y.x*N*v.x*v.y-3*m.y*y.y*f.x*f.y*X-6*g.y*I*f.y*v.x*v.y-6*w.x*f.x*N*v.x*v.y+3*m.y*y.y*I*v.x*v.y-2*y.x*z*f.x*v.x*v.y-6*b.x*f.x*x.x*N*v.y-6*b.x*f.x*N*x.y*v.x-6*f.x*b.y*x.x*N*v.x+6*b.x*I*f.y*x.y*v.y+2*R*y.y*f.y*v.x*v.y+$*F-3*g.x*F*X+3*g.y*D*J+3*w.x*F*X+O*f.x*X-E*f.y*J-3*g.x*I*f.y*J+3*g.y*f.x*N*X-2*m.x*y.y*I*J+m.x*y.y*N*X-m.y*y.x*I*J+2*m.y*y.x*N*X+3*w.x*I*f.y*J-y.x*z*f.y*X-3*w.y*f.x*N*X+R*y.y*f.x*J-3*f.x*G*N*x.y+I*f.y*v.x*(6*w.y*v.y+6*b.y*x.y)+I*x.x*f.y*(6*b.y*v.y+3*K)+D*(-2*b.y*x.y*v.y-w.y*J-x.y*(2*b.y*v.y+K)-v.y*(2*w.y*v.y+2*b.y*x.y)),6*m.x*y.x*f.x*f.y*x.y*v.y+m.x*y.y*f.x*x.x*f.y*v.y+m.x*y.y*f.x*f.y*x.y*v.x-m.y*y.x*f.x*x.x*f.y*v.y-m.y*y.x*f.x*f.y*x.y*v.x-6*m.y*y.y*f.x*x.x*f.y*v.x-6*g.x*x.x*F*v.x+6*w.x*x.x*F*v.x+6*g.y*D*x.y*v.y+2*O*f.x*x.x*v.x-2*E*f.y*x.y*v.y+6*g.x*f.x*x.x*N*v.y+6*g.x*f.x*N*x.y*v.x+6*g.y*f.x*x.x*N*v.x-3*m.x*y.x*x.x*N*v.y-3*m.x*y.x*N*x.y*v.x+2*m.x*y.y*x.x*N*v.x+4*m.y*y.x*x.x*N*v.x-6*g.x*I*f.y*x.y*v.y-6*g.y*I*x.x*f.y*v.y-6*g.y*I*f.y*x.y*v.x-4*m.x*y.y*I*x.y*v.y-6*w.x*f.x*x.x*N*v.y-6*w.x*f.x*N*x.y*v.x-2*m.y*y.x*I*x.y*v.y+3*m.y*y.y*I*x.x*v.y+3*m.y*y.y*I*x.y*v.x-2*y.x*z*f.x*x.x*v.y-2*y.x*z*f.x*x.y*v.x-2*y.x*z*x.x*f.y*v.x-6*w.y*f.x*x.x*N*v.x-6*b.x*f.x*b.y*N*v.x-6*b.x*f.x*x.x*N*x.y+6*w.x*I*f.y*x.y*v.y+2*R*y.y*f.x*x.y*v.y+2*R*y.y*x.x*f.y*v.y+2*R*y.y*f.y*x.y*v.x+3*b.x*G*F+3*V*F*v.x-3*f.x*b.y*G*N-3*V*f.x*N*v.y+I*x.x*f.y*(6*w.y*v.y+6*b.y*x.y)+I*f.y*v.x*(6*w.y*x.y+3*q)+b.x*I*f.y*(6*b.y*v.y+3*K)+D*(-2*w.y*x.y*v.y-v.y*(2*w.y*x.y+q)-b.y*(2*b.y*v.y+K)-x.y*(2*w.y*v.y+2*b.y*x.y)),m.x*b.x*y.y*f.x*f.y*v.y+m.x*y.y*f.x*b.y*f.y*v.x+m.x*y.y*f.x*x.x*f.y*x.y-m.y*y.x*b.x*f.x*f.y*v.y-m.y*y.x*f.x*b.y*f.y*v.x-m.y*y.x*f.x*x.x*f.y*x.y-6*m.y*b.x*y.y*f.x*f.y*v.x-6*g.x*b.x*F*v.x+6*w.x*b.x*F*v.x+2*b.x*O*f.x*v.x+6*g.x*b.x*f.x*N*v.y+6*g.x*f.x*b.y*N*v.x+6*g.x*f.x*x.x*N*x.y+6*g.y*b.x*f.x*N*v.x-3*m.x*y.x*b.x*N*v.y-3*m.x*y.x*b.y*N*v.x-3*m.x*y.x*x.x*N*x.y+2*m.x*b.x*y.y*N*v.x+4*m.y*y.x*b.x*N*v.x-6*g.y*b.x*I*f.y*v.y-6*g.y*I*b.y*f.y*v.x-6*g.y*I*x.x*f.y*x.y-6*w.x*b.x*f.x*N*v.y-6*w.x*f.x*b.y*N*v.x-6*w.x*f.x*x.x*N*x.y+3*m.y*b.x*y.y*I*v.y-3*m.y*y.y*f.x*G*f.y+3*m.y*y.y*I*b.y*v.x+3*m.y*y.y*I*x.x*x.y-2*y.x*b.x*z*f.x*v.y-2*y.x*b.x*z*f.y*v.x-2*y.x*z*f.x*b.y*v.x-2*y.x*z*f.x*x.x*x.y-6*w.y*b.x*f.x*N*v.x-6*b.x*f.x*b.y*x.x*N+6*w.y*I*b.y*f.y*v.x+2*R*b.x*y.y*f.y*v.y+2*R*y.y*b.y*f.y*v.x+2*R*y.y*x.x*f.y*x.y-3*g.x*G*F+3*w.x*G*F+3*V*x.x*F+O*f.x*G+3*g.y*f.x*G*N+m.x*y.y*G*N+2*m.y*y.x*G*N-y.x*z*G*f.y-3*w.y*f.x*G*N-3*V*f.x*N*x.y+R*y.y*f.x*(2*b.y*v.y+K)+m.x*y.x*f.x*f.y*(6*b.y*v.y+3*K)+b.x*I*f.y*(6*w.y*v.y+6*b.y*x.y)+E*f.y*(-2*b.y*v.y-K)+g.y*D*(6*b.y*v.y+3*K)+m.y*y.x*I*(-2*b.y*v.y-K)+m.x*y.y*I*(-4*b.y*v.y-2*K)+g.x*I*f.y*(-6*b.y*v.y-3*K)+I*x.x*f.y*(6*w.y*x.y+3*q)+w.x*I*f.y*(6*b.y*v.y+3*K)+D*(-2*w.y*b.y*v.y-x.y*(2*w.y*x.y+q)-w.y*(2*b.y*v.y+K)-b.y*(2*w.y*v.y+2*b.y*x.y)),-g.x*m.x*y.y*f.x*f.y*v.y+g.x*m.y*y.x*f.x*f.y*v.y+6*g.x*m.y*y.y*f.x*f.y*v.x-6*g.y*m.x*y.x*f.x*f.y*v.y-g.y*m.x*y.y*f.x*f.y*v.x+g.y*m.y*y.x*f.x*f.y*v.x+m.x*m.y*y.x*y.y*f.x*v.y-m.x*m.y*y.x*y.y*f.y*v.x+m.x*w.x*y.y*f.x*f.y*v.y+m.x*w.y*y.y*f.x*f.y*v.x+m.x*b.x*y.y*f.x*f.y*x.y+m.x*y.y*f.x*b.y*x.x*f.y-w.x*m.y*y.x*f.x*f.y*v.y-6*w.x*m.y*y.y*f.x*f.y*v.x-m.y*y.x*w.y*f.x*f.y*v.x-m.y*y.x*b.x*f.x*f.y*x.y-m.y*y.x*f.x*b.y*x.x*f.y-6*m.y*b.x*y.y*f.x*x.x*f.y-6*g.x*w.x*F*v.x-6*g.x*b.x*x.x*F-2*g.x*O*f.x*v.x+6*w.x*b.x*x.x*F+2*w.x*O*f.x*v.x+2*b.x*O*f.x*x.x+2*g.y*E*f.y*v.y-6*g.x*g.y*f.x*N*v.x+3*g.x*m.x*y.x*N*v.y-2*g.x*m.x*y.y*N*v.x-4*g.x*m.y*y.x*N*v.x+3*g.y*m.x*y.x*N*v.x+6*g.x*g.y*I*f.y*v.y+6*g.x*w.x*f.x*N*v.y-3*g.x*m.y*y.y*I*v.y+2*g.x*y.x*z*f.x*v.y+2*g.x*y.x*z*f.y*v.x+6*g.x*w.y*f.x*N*v.x+6*g.x*b.x*f.x*N*x.y+6*g.x*f.x*b.y*x.x*N+4*g.y*m.x*y.y*I*v.y+6*g.y*w.x*f.x*N*v.x+2*g.y*m.y*y.x*I*v.y-3*g.y*m.y*y.y*I*v.x+2*g.y*y.x*z*f.x*v.x+6*g.y*b.x*f.x*x.x*N-3*m.x*w.x*y.x*N*v.y+2*m.x*w.x*y.y*N*v.x+m.x*m.y*z*f.x*v.x-3*m.x*y.x*w.y*N*v.x-3*m.x*y.x*b.x*N*x.y-3*m.x*y.x*b.y*x.x*N+2*m.x*b.x*y.y*x.x*N+4*w.x*m.y*y.x*N*v.x+4*m.y*y.x*b.x*x.x*N-2*g.x*R*y.y*f.y*v.y-6*g.y*w.x*I*f.y*v.y-6*g.y*w.y*I*f.y*v.x-6*g.y*b.x*I*f.y*x.y-2*g.y*R*y.y*f.x*v.y-2*g.y*R*y.y*f.y*v.x-6*g.y*I*b.y*x.x*f.y-m.x*m.y*R*f.y*v.y-2*m.x*A*f.x*f.y*v.x+3*w.x*m.y*y.y*I*v.y-2*w.x*y.x*z*f.x*v.y-2*w.x*y.x*z*f.y*v.x-6*w.x*w.y*f.x*N*v.x-6*w.x*b.x*f.x*N*x.y-6*w.x*f.x*b.y*x.x*N+3*m.y*w.y*y.y*I*v.x+3*m.y*b.x*y.y*I*x.y+3*m.y*y.y*I*b.y*x.x-2*y.x*w.y*z*f.x*v.x-2*y.x*b.x*z*f.x*x.y-2*y.x*b.x*z*x.x*f.y-2*y.x*z*f.x*b.y*x.x-6*w.y*b.x*f.x*x.x*N-A*y.x*y.y*f.x*v.x+2*w.x*R*y.y*f.y*v.y+6*w.y*I*b.y*x.x*f.y+2*P*m.y*f.x*f.y*v.y+P*y.x*y.y*f.y*v.y+2*R*w.y*y.y*f.y*v.x+2*R*b.x*y.y*f.y*x.y+2*R*y.y*b.y*x.x*f.y+U*F+3*k*F*v.x-3*M*D*v.y+3*B*F*v.x+L*I*v.x-T*N*v.y-m.x*A*I*v.y+P*m.y*N*v.x-3*k*f.x*N*v.y+3*M*I*f.y*v.x-P*z*f.x*v.y+A*R*f.y*v.x-3*V*f.x*b.y*N-3*B*f.x*N*v.y+3*W*I*f.y*v.x+m.x*y.x*f.x*f.y*(6*w.y*v.y+6*b.y*x.y)+E*f.y*(-2*w.y*v.y-2*b.y*x.y)+g.y*D*(6*w.y*v.y+6*b.y*x.y)+m.y*y.x*I*(-2*w.y*v.y-2*b.y*x.y)+R*y.y*f.x*(2*w.y*v.y+2*b.y*x.y)+m.x*y.y*I*(-4*w.y*v.y-4*b.y*x.y)+g.x*I*f.y*(-6*w.y*v.y-6*b.y*x.y)+w.x*I*f.y*(6*w.y*v.y+6*b.y*x.y)+b.x*I*f.y*(6*w.y*x.y+3*q)+D*(-2*w.y*b.y*x.y-W*v.y-b.y*(2*w.y*x.y+q)-w.y*(2*w.y*v.y+2*b.y*x.y)),-g.x*m.x*y.y*f.x*f.y*x.y+g.x*m.y*y.x*f.x*f.y*x.y+6*g.x*m.y*y.y*f.x*x.x*f.y-6*g.y*m.x*y.x*f.x*f.y*x.y-g.y*m.x*y.y*f.x*x.x*f.y+g.y*m.y*y.x*f.x*x.x*f.y+m.x*m.y*y.x*y.y*f.x*x.y-m.x*m.y*y.x*y.y*x.x*f.y+m.x*w.x*y.y*f.x*f.y*x.y+m.x*w.y*y.y*f.x*x.x*f.y+m.x*b.x*y.y*f.x*b.y*f.y-w.x*m.y*y.x*f.x*f.y*x.y-6*w.x*m.y*y.y*f.x*x.x*f.y-m.y*y.x*w.y*f.x*x.x*f.y-m.y*y.x*b.x*f.x*b.y*f.y-6*g.x*w.x*x.x*F-2*g.x*O*f.x*x.x+2*w.x*O*f.x*x.x+2*g.y*E*f.y*x.y-6*g.x*g.y*f.x*x.x*N+3*g.x*m.x*y.x*N*x.y-2*g.x*m.x*y.y*x.x*N-4*g.x*m.y*y.x*x.x*N+3*g.y*m.x*y.x*x.x*N+6*g.x*g.y*I*f.y*x.y+6*g.x*w.x*f.x*N*x.y-3*g.x*m.y*y.y*I*x.y+2*g.x*y.x*z*f.x*x.y+2*g.x*y.x*z*x.x*f.y+6*g.x*w.y*f.x*x.x*N+6*g.x*b.x*f.x*b.y*N+4*g.y*m.x*y.y*I*x.y+6*g.y*w.x*f.x*x.x*N+2*g.y*m.y*y.x*I*x.y-3*g.y*m.y*y.y*I*x.x+2*g.y*y.x*z*f.x*x.x-3*m.x*w.x*y.x*N*x.y+2*m.x*w.x*y.y*x.x*N+m.x*m.y*z*f.x*x.x-3*m.x*y.x*w.y*x.x*N-3*m.x*y.x*b.x*b.y*N+4*w.x*m.y*y.x*x.x*N-2*g.x*R*y.y*f.y*x.y-6*g.y*w.x*I*f.y*x.y-6*g.y*w.y*I*x.x*f.y-6*g.y*b.x*I*b.y*f.y-2*g.y*R*y.y*f.x*x.y-2*g.y*R*y.y*x.x*f.y-m.x*m.y*R*f.y*x.y-2*m.x*A*f.x*x.x*f.y+3*w.x*m.y*y.y*I*x.y-2*w.x*y.x*z*f.x*x.y-2*w.x*y.x*z*x.x*f.y-6*w.x*w.y*f.x*x.x*N-6*w.x*b.x*f.x*b.y*N+3*m.y*w.y*y.y*I*x.x+3*m.y*b.x*y.y*I*b.y-2*y.x*w.y*z*f.x*x.x-2*y.x*b.x*z*f.x*b.y-A*y.x*y.y*f.x*x.x+2*w.x*R*y.y*f.y*x.y-3*m.y*V*y.y*f.x*f.y+6*w.y*b.x*I*b.y*f.y+2*P*m.y*f.x*f.y*x.y+P*y.x*y.y*f.y*x.y+2*R*w.y*y.y*x.x*f.y+2*R*b.x*y.y*b.y*f.y-3*g.x*V*F+3*w.x*V*F+3*k*x.x*F-3*M*D*x.y+3*B*x.x*F+V*O*f.x+L*I*x.x-T*N*x.y+3*g.y*V*f.x*N-m.x*A*I*x.y+m.x*V*y.y*N+2*m.y*y.x*V*N+P*m.y*x.x*N-y.x*V*z*f.y-3*w.y*V*f.x*N-3*k*f.x*N*x.y+3*M*I*x.x*f.y-P*z*f.x*x.y+A*R*x.x*f.y-3*B*f.x*N*x.y+3*W*I*x.x*f.y+R*y.y*f.x*(2*w.y*x.y+q)+m.x*y.x*f.x*f.y*(6*w.y*x.y+3*q)+E*f.y*(-2*w.y*x.y-q)+g.y*D*(6*w.y*x.y+3*q)+m.y*y.x*I*(-2*w.y*x.y-q)+m.x*y.y*I*(-4*w.y*x.y-2*q)+g.x*I*f.y*(-6*w.y*x.y-3*q)+w.x*I*f.y*(6*w.y*x.y+3*q)+D*(-2*w.y*q-W*x.y-w.y*(2*w.y*x.y+q)),-g.x*m.x*y.y*f.x*b.y*f.y+g.x*m.y*y.x*f.x*b.y*f.y+6*g.x*m.y*b.x*y.y*f.x*f.y-6*g.y*m.x*y.x*f.x*b.y*f.y-g.y*m.x*b.x*y.y*f.x*f.y+g.y*m.y*y.x*b.x*f.x*f.y-m.x*m.y*y.x*b.x*y.y*f.y+m.x*m.y*y.x*y.y*f.x*b.y+m.x*w.x*y.y*f.x*b.y*f.y+6*m.x*y.x*w.y*f.x*b.y*f.y+m.x*w.y*b.x*y.y*f.x*f.y-w.x*m.y*y.x*f.x*b.y*f.y-6*w.x*m.y*b.x*y.y*f.x*f.y-m.y*y.x*w.y*b.x*f.x*f.y-6*g.x*w.x*b.x*F-2*g.x*b.x*O*f.x+6*g.y*w.y*D*b.y+2*w.x*b.x*O*f.x+2*g.y*E*b.y*f.y-2*E*w.y*b.y*f.y-6*g.x*g.y*b.x*f.x*N+3*g.x*m.x*y.x*b.y*N-2*g.x*m.x*b.x*y.y*N-4*g.x*m.y*y.x*b.x*N+3*g.y*m.x*y.x*b.x*N+6*g.x*g.y*I*b.y*f.y+6*g.x*w.x*f.x*b.y*N-3*g.x*m.y*y.y*I*b.y+2*g.x*y.x*b.x*z*f.y+2*g.x*y.x*z*f.x*b.y+6*g.x*w.y*b.x*f.x*N+4*g.y*m.x*y.y*I*b.y+6*g.y*w.x*b.x*f.x*N+2*g.y*m.y*y.x*I*b.y-3*g.y*m.y*b.x*y.y*I+2*g.y*y.x*b.x*z*f.x-3*m.x*w.x*y.x*b.y*N+2*m.x*w.x*b.x*y.y*N+m.x*m.y*b.x*z*f.x-3*m.x*y.x*w.y*b.x*N+4*w.x*m.y*y.x*b.x*N-6*g.x*w.y*I*b.y*f.y-2*g.x*R*y.y*b.y*f.y-6*g.y*w.x*I*b.y*f.y-6*g.y*w.y*b.x*I*f.y-2*g.y*R*b.x*y.y*f.y-2*g.y*R*y.y*f.x*b.y-m.x*m.y*R*b.y*f.y-4*m.x*w.y*y.y*I*b.y-2*m.x*A*b.x*f.x*f.y+3*w.x*m.y*y.y*I*b.y-2*w.x*y.x*b.x*z*f.y-2*w.x*y.x*z*f.x*b.y-6*w.x*w.y*b.x*f.x*N-2*m.y*y.x*w.y*I*b.y+3*m.y*w.y*b.x*y.y*I-2*y.x*w.y*b.x*z*f.x-A*y.x*b.x*y.y*f.x+6*w.x*w.y*I*b.y*f.y+2*w.x*R*y.y*b.y*f.y+2*P*m.y*f.x*b.y*f.y+P*y.x*y.y*b.y*f.y+2*R*w.y*b.x*y.y*f.y+2*R*w.y*y.y*f.x*b.y+3*k*b.x*F-3*M*D*b.y+3*B*b.x*F+L*b.x*I-T*b.y*N-3*W*D*b.y-m.x*A*I*b.y+P*m.y*b.x*N-3*k*f.x*b.y*N+3*M*b.x*I*f.y-P*z*f.x*b.y+A*R*b.x*f.y-3*B*f.x*b.y*N+3*W*b.x*I*f.y,g.x*g.y*m.x*y.y*f.x*f.y-g.x*g.y*m.y*y.x*f.x*f.y+g.x*m.x*m.y*y.x*y.y*f.y-g.y*m.x*m.y*y.x*y.y*f.x-g.x*m.x*w.y*y.y*f.x*f.y+6*g.x*w.x*m.y*y.y*f.x*f.y+g.x*m.y*y.x*w.y*f.x*f.y-g.y*m.x*w.x*y.y*f.x*f.y-6*g.y*m.x*y.x*w.y*f.x*f.y+g.y*w.x*m.y*y.x*f.x*f.y-m.x*w.x*m.y*y.x*y.y*f.y+m.x*m.y*y.x*w.y*y.y*f.x+m.x*w.x*w.y*y.y*f.x*f.y-w.x*m.y*y.x*w.y*f.x*f.y-2*g.x*w.x*O*f.x+2*g.y*E*w.y*f.y-3*g.x*g.y*m.x*y.x*N-6*g.x*g.y*w.x*f.x*N+3*g.x*g.y*m.y*y.y*I-2*g.x*g.y*y.x*z*f.x-2*g.x*m.x*w.x*y.y*N-g.x*m.x*m.y*z*f.x+3*g.x*m.x*y.x*w.y*N-4*g.x*w.x*m.y*y.x*N+3*g.y*m.x*w.x*y.x*N+6*g.x*g.y*w.y*I*f.y+2*g.x*g.y*R*y.y*f.y+2*g.x*m.x*A*f.x*f.y+2*g.x*w.x*y.x*z*f.y+6*g.x*w.x*w.y*f.x*N-3*g.x*m.y*w.y*y.y*I+2*g.x*y.x*w.y*z*f.x+g.x*A*y.x*y.y*f.x+g.y*m.x*m.y*R*f.y+4*g.y*m.x*w.y*y.y*I-3*g.y*w.x*m.y*y.y*I+2*g.y*w.x*y.x*z*f.x+2*g.y*m.y*y.x*w.y*I+m.x*w.x*m.y*z*f.x-3*m.x*w.x*y.x*w.y*N-2*g.x*R*w.y*y.y*f.y-6*g.y*w.x*w.y*I*f.y-2*g.y*w.x*R*y.y*f.y-2*g.y*P*m.y*f.x*f.y-g.y*P*y.x*y.y*f.y-2*g.y*R*w.y*y.y*f.x-2*m.x*w.x*A*f.x*f.y-m.x*m.y*R*w.y*f.y+3*w.x*m.y*w.y*y.y*I-2*w.x*y.x*w.y*z*f.x-w.x*A*y.x*y.y*f.x+3*M*m.x*y.x*f.x*f.y+3*m.x*y.x*W*f.x*f.y+2*w.x*R*w.y*y.y*f.y-3*k*m.y*y.y*f.x*f.y+2*P*m.y*w.y*f.x*f.y+P*y.x*w.y*y.y*f.y-3*B*m.y*y.y*f.x*f.y-S*F+C*D+j*F-H*D-3*g.x*B*F-g.x*L*I+3*k*w.x*F+g.y*T*N+3*g.y*W*D+w.x*L*I+k*O*f.x-3*M*w.y*D-M*E*f.y+B*O*f.x-T*w.y*N-E*W*f.y-g.x*P*m.y*N+g.y*m.x*A*I-3*g.x*M*I*f.y-g.x*A*R*f.y+g.y*P*z*f.x-m.x*A*w.y*I+3*k*g.y*f.x*N+k*m.x*y.y*N+2*k*m.y*y.x*N-2*M*m.x*y.y*I-M*m.y*y.x*I+P*w.x*m.y*N-3*g.x*W*I*f.y+3*g.y*B*f.x*N+m.x*B*y.y*N-2*m.x*W*y.y*I+w.x*A*R*f.y-m.y*y.x*W*I-k*y.x*z*f.y-3*k*w.y*f.x*N+3*M*w.x*I*f.y+M*R*y.y*f.x-P*w.y*z*f.x+2*B*m.y*y.x*N+3*w.x*W*I*f.y-B*y.x*z*f.y-3*B*w.y*f.x*N+R*W*y.y*f.x).getRootsInInterval(0,1),ee=0;ee<Z.length;ee++){var te=Z[ee],ne=new o(f.x,y.x,m.x,g.x-w.x-te*b.x-te*te*x.x-te*te*te*v.x);ne.simplify(),xRoots=ne.getRoots();var re=new o(f.y,y.y,m.y,g.y-w.y-te*b.y-te*te*x.y-te*te*te*v.y);if(re.simplify(),yRoots=re.getRoots(),xRoots.length>0&&yRoots.length>0){e:for(var ie=0;ie<xRoots.length;ie++){var oe=xRoots[ie];if(0<=oe&&oe<=1)for(var ae=0;ae<yRoots.length;ae++)if(Math.abs(oe-yRoots[ae])<1e-4){_.points.push(v.multiply(te*te*te).add(x.multiply(te*te).add(b.multiply(te).add(w))));break e}}}}return _.points.length>0&&(_.status="Intersection"),_},Intersection.intersectBezier3Circle=function(e,t,n,r,i,o){return Intersection.intersectBezier3Ellipse(e,t,n,r,i,o,o)},Intersection.intersectBezier3Ellipse=function(e,t,n,r,a,s,l){var u,c,h,d,p,f,y,m,g=new Intersection("No Intersection");u=e.multiply(-1),c=t.multiply(3),h=n.multiply(-3),d=u.add(c.add(h.add(r))),p=new i(d.x,d.y),u=e.multiply(3),c=t.multiply(-6),h=n.multiply(3),d=u.add(c.add(h)),f=new i(d.x,d.y),u=e.multiply(-3),c=t.multiply(3),h=u.add(c),y=new i(h.x,h.y),m=new i(e.x,e.y);for(var v=s*s,x=l*l,b=new o(p.x*p.x*x+p.y*p.y*v,2*(p.x*f.x*x+p.y*f.y*v),2*(p.x*y.x*x+p.y*y.y*v)+f.x*f.x*x+f.y*f.y*v,2*p.x*x*(m.x-a.x)+2*p.y*v*(m.y-a.y)+2*(f.x*y.x*x+f.y*y.y*v),2*f.x*x*(m.x-a.x)+2*f.y*v*(m.y-a.y)+y.x*y.x*x+y.y*y.y*v,2*y.x*x*(m.x-a.x)+2*y.y*v*(m.y-a.y),m.x*m.x*x-2*m.y*a.y*v-2*m.x*a.x*x+m.y*m.y*v+a.x*a.x*x+a.y*a.y*v-v*x).getRootsInInterval(0,1),w=0;w<b.length;w++){var _=b[w];g.points.push(p.multiply(_*_*_).add(f.multiply(_*_).add(y.multiply(_).add(m))))}return g.points.length>0&&(g.status="Intersection"),g},Intersection.intersectBezier3Line=function(e,t,n,r,a,s){var l,u,c,h,d,p,f,y,m,g,v=a.min(s),x=a.max(s),b=new Intersection("No Intersection");l=e.multiply(-1),u=t.multiply(3),c=n.multiply(-3),h=l.add(u.add(c.add(r))),d=new i(h.x,h.y),l=e.multiply(3),u=t.multiply(-6),c=n.multiply(3),h=l.add(u.add(c)),p=new i(h.x,h.y),l=e.multiply(-3),u=t.multiply(3),c=l.add(u),f=new i(c.x,c.y),y=new i(e.x,e.y),g=new i(a.y-s.y,s.x-a.x),m=a.x*s.y-s.x*a.y,roots=new o(g.dot(d),g.dot(p),g.dot(f),g.dot(y)+m).getRoots();for(var w=0;w<roots.length;w++){var _=roots[w];if(0<=_&&_<=1){var k=e.lerp(t,_),S=t.lerp(n,_),M=n.lerp(r,_),C=k.lerp(S,_),P=S.lerp(M,_),T=C.lerp(P,_);a.x==s.x?v.y<=T.y&&T.y<=x.y&&(b.status="Intersection",b.appendPoint(T)):a.y==s.y?v.x<=T.x&&T.x<=x.x&&(b.status="Intersection",b.appendPoint(T)):v.x<=T.x&&T.x<=x.x&&v.y<=T.y&&T.y<=x.y&&(b.status="Intersection",b.appendPoint(T))}}return b},Intersection.intersectBezier3Polygon=function(e,t,n,r,i){return this.intersectBezier3Polyline(e,t,n,r,closePolygon(i))},Intersection.intersectBezier3Polyline=function(e,t,n,r,i){for(var o=new Intersection("No Intersection"),a=i.length,s=0;s<a-1;s++){var l=i[s],u=i[s+1],c=Intersection.intersectBezier3Line(e,t,n,r,l,u);o.appendPoints(c.points)}return o.points.length>0&&(o.status="Intersection"),o},Intersection.intersectBezier3Rectangle=function(e,t,n,i,o,a){var s=o.min(a),l=o.max(a),u=new r(l.x,s.y),c=new r(s.x,l.y),h=Intersection.intersectBezier3Line(e,t,n,i,s,u),d=Intersection.intersectBezier3Line(e,t,n,i,u,l),p=Intersection.intersectBezier3Line(e,t,n,i,l,c),f=Intersection.intersectBezier3Line(e,t,n,i,c,s),y=new Intersection("No Intersection");return y.appendPoints(h.points),y.appendPoints(d.points),y.appendPoints(p.points),y.appendPoints(f.points),y.points.length>0&&(y.status="Intersection"),y},Intersection.intersectCircleCircle=function(e,t,n,i){var o,a=t+i,s=Math.abs(t-i),l=e.distanceFrom(n);if(l>a)o=new Intersection("Outside");else if(l<s)o=new Intersection("Inside");else{o=new Intersection("Intersection");var u=(t*t-i*i+l*l)/(2*l),c=Math.sqrt(t*t-u*u),h=e.lerp(n,u/l),d=c/l;o.points.push(new r(h.x-d*(n.y-e.y),h.y+d*(n.x-e.x))),o.points.push(new r(h.x+d*(n.y-e.y),h.y-d*(n.x-e.x)))}return o},Intersection.intersectCircleEllipse=function(e,t,n,r,i){return Intersection.intersectEllipseEllipse(e,t,t,n,r,i)},Intersection.intersectCircleLine=function(e,t,n,r){var i,o=(r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y),a=2*((r.x-n.x)*(n.x-e.x)+(r.y-n.y)*(n.y-e.y)),s=a*a-4*o*(e.x*e.x+e.y*e.y+n.x*n.x+n.y*n.y-2*(e.x*n.x+e.y*n.y)-t*t);if(s<0)i=new Intersection("Outside");else if(0==s)i=new Intersection("Tangent");else{var l=Math.sqrt(s),u=(-a+l)/(2*o),c=(-a-l)/(2*o);(u<0||u>1)&&(c<0||c>1)?i=new Intersection(u<0&&c<0||u>1&&c>1?"Outside":"Inside"):(i=new Intersection("Intersection"),0<=u&&u<=1&&i.points.push(n.lerp(r,u)),0<=c&&c<=1&&i.points.push(n.lerp(r,c)))}return i},Intersection.intersectCirclePolygon=function(e,t,n){return this.intersectCirclePolyline(e,t,closePolygon(n))},Intersection.intersectCirclePolyline=function(e,t,n){for(var r,i=new Intersection("No Intersection"),o=n.length,a=0;a<o-1;a++){var s=n[a],l=n[a+1];r=Intersection.intersectCircleLine(e,t,s,l),i.appendPoints(r.points)}return i.points.length>0?i.status="Intersection":i.status=r.status,i},Intersection.intersectCircleRectangle=function(e,t,n,i){var o=n.min(i),a=n.max(i),s=new r(a.x,o.y),l=new r(o.x,a.y),u=Intersection.intersectCircleLine(e,t,o,s),c=Intersection.intersectCircleLine(e,t,s,a),h=Intersection.intersectCircleLine(e,t,a,l),d=Intersection.intersectCircleLine(e,t,l,o),p=new Intersection("No Intersection");return p.appendPoints(u.points),p.appendPoints(c.points),p.appendPoints(h.points),p.appendPoints(d.points),p.points.length>0?p.status="Intersection":p.status=u.status,p},Intersection.intersectEllipseEllipse=function(e,t,n,i,a,s){for(var l=[n*n,0,t*t,-2*n*n*e.x,-2*t*t*e.y,n*n*e.x*e.x+t*t*e.y*e.y-t*t*n*n],u=[s*s,0,a*a,-2*s*s*i.x,-2*a*a*i.y,s*s*i.x*i.x+a*a*i.y*i.y-a*a*s*s],c=Intersection.bezout(l,u).getRoots(),h=.001*(l[0]*l[0]+2*l[1]*l[1]+l[2]*l[2]),d=.001*(u[0]*u[0]+2*u[1]*u[1]+u[2]*u[2]),p=new Intersection("No Intersection"),f=0;f<c.length;f++)for(var y=new o(l[0],l[3]+c[f]*l[1],l[5]+c[f]*(l[4]+c[f]*l[2])).getRoots(),m=0;m<y.length;m++){var g=(l[0]*y[m]+l[1]*c[f]+l[3])*y[m]+(l[2]*c[f]+l[4])*c[f]+l[5];Math.abs(g)<h&&(g=(u[0]*y[m]+u[1]*c[f]+u[3])*y[m]+(u[2]*c[f]+u[4])*c[f]+u[5],Math.abs(g)<d&&p.appendPoint(new r(y[m],c[f])))}return p.points.length>0&&(p.status="Intersection"),p},Intersection.intersectEllipseLine=function(e,t,n,r,o){var a,s=new i(r.x,r.y),l=i.fromPoints(r,o),u=new i(e.x,e.y),c=s.subtract(u),h=new i(l.x/(t*t),l.y/(n*n)),d=new i(c.x/(t*t),c.y/(n*n)),p=l.dot(h),f=l.dot(d),y=f*f-p*(e=c.dot(d)-1);if(y<0)a=new Intersection("Outside");else if(y>0){var m=Math.sqrt(y),g=(-f-m)/p,v=(-f+m)/p;(g<0||1<g)&&(v<0||1<v)?a=new Intersection(g<0&&v<0||g>1&&v>1?"Outside":"Inside"):(a=new Intersection("Intersection"),0<=g&&g<=1&&a.appendPoint(r.lerp(o,g)),0<=v&&v<=1&&a.appendPoint(r.lerp(o,v)))}else{var x=-f/p;0<=x&&x<=1?(a=new Intersection("Intersection")).appendPoint(r.lerp(o,x)):a=new Intersection("Outside")}return a},Intersection.intersectEllipsePolygon=function(e,t,n,r){return this.intersectEllipsePolyline(e,t,n,closePolygon(r))},Intersection.intersectEllipsePolyline=function(e,t,n,r){for(var i=new Intersection("No Intersection"),o=r.length,a=0;a<o-1;a++){var s=r[a],l=r[a+1],u=Intersection.intersectEllipseLine(e,t,n,s,l);i.appendPoints(u.points)}return i.points.length>0&&(i.status="Intersection"),i},Intersection.intersectEllipseRectangle=function(e,t,n,i,o){var a=i.min(o),s=i.max(o),l=new r(s.x,a.y),u=new r(a.x,s.y),c=Intersection.intersectEllipseLine(e,t,n,a,l),h=Intersection.intersectEllipseLine(e,t,n,l,s),d=Intersection.intersectEllipseLine(e,t,n,s,u),p=Intersection.intersectEllipseLine(e,t,n,u,a),f=new Intersection("No Intersection");return f.appendPoints(c.points),f.appendPoints(h.points),f.appendPoints(d.points),f.appendPoints(p.points),f.points.length>0&&(f.status="Intersection"),f},Intersection.intersectLineLine=function(e,t,n,i){var o,a=(i.x-n.x)*(e.y-n.y)-(i.y-n.y)*(e.x-n.x),s=(t.x-e.x)*(e.y-n.y)-(t.y-e.y)*(e.x-n.x),l=(i.y-n.y)*(t.x-e.x)-(i.x-n.x)*(t.y-e.y);if(0!=l){var u=a/l,c=s/l;0<=u&&u<=1&&0<=c&&c<=1?(o=new Intersection("Intersection")).points.push(new r(e.x+u*(t.x-e.x),e.y+u*(t.y-e.y))):o=new Intersection("No Intersection")}else o=new Intersection(0==a||0==s?"Coincident":"Parallel");return o},Intersection.intersectLinePolygon=function(e,t,n){return this.intersectLinePolyline(e,t,closePolygon(n))},Intersection.intersectLinePolyline=function(e,t,n){for(var r=new Intersection("No Intersection"),i=n.length,o=0;o<i-1;o++){var a=n[o],s=n[o+1],l=Intersection.intersectLineLine(e,t,a,s);r.appendPoints(l.points)}return r.points.length>0&&(r.status="Intersection"),r},Intersection.intersectLineRectangle=function(e,t,n,i){var o=n.min(i),a=n.max(i),s=new r(a.x,o.y),l=new r(o.x,a.y),u=Intersection.intersectLineLine(o,s,e,t),c=Intersection.intersectLineLine(s,a,e,t),h=Intersection.intersectLineLine(a,l,e,t),d=Intersection.intersectLineLine(l,o,e,t),p=new Intersection("No Intersection");return p.appendPoints(u.points),p.appendPoints(c.points),p.appendPoints(h.points),p.appendPoints(d.points),p.points.length>0&&(p.status="Intersection"),p},Intersection.intersectPolygonPolygon=function(e,t){return this.intersectPolylinePolyline(closePolygon(e),closePolygon(t))},Intersection.intersectPolygonPolyline=function(e,t){return this.intersectPolylinePolyline(closePolygon(e),t)},Intersection.intersectPolygonRectangle=function(e,t,n){return this.intersectPolylineRectangle(closePolygon(e),t,n)},Intersection.intersectPolylinePolyline=function(e,t){for(var n=new Intersection("No Intersection"),r=e.length,i=0;i<r-1;i++){var o=e[i],a=e[i+1],s=Intersection.intersectLinePolyline(o,a,t);n.appendPoints(s.points)}return n.points.length>0&&(n.status="Intersection"),n},Intersection.intersectPolylineRectangle=function(e,t,n){var i=t.min(n),o=t.max(n),a=new r(o.x,i.y),s=new r(i.x,o.y),l=Intersection.intersectLinePolyline(i,a,e),u=Intersection.intersectLinePolyline(a,o,e),c=Intersection.intersectLinePolyline(o,s,e),h=Intersection.intersectLinePolyline(s,i,e),d=new Intersection("No Intersection");return d.appendPoints(l.points),d.appendPoints(u.points),d.appendPoints(c.points),d.appendPoints(h.points),d.points.length>0&&(d.status="Intersection"),d},Intersection.intersectRectangleRectangle=function(e,t,n,i){var o=e.min(t),a=e.max(t),s=new r(a.x,o.y),l=new r(o.x,a.y),u=Intersection.intersectLineRectangle(o,s,n,i),c=Intersection.intersectLineRectangle(s,a,n,i),h=Intersection.intersectLineRectangle(a,l,n,i),d=Intersection.intersectLineRectangle(l,o,n,i),p=new Intersection("No Intersection");return p.appendPoints(u.points),p.appendPoints(c.points),p.appendPoints(h.points),p.appendPoints(d.points),p.points.length>0&&(p.status="Intersection"),p},Intersection.intersectRayRay=function(e,t,n,i){var o,a=(i.x-n.x)*(e.y-n.y)-(i.y-n.y)*(e.x-n.x),s=(t.x-e.x)*(e.y-n.y)-(t.y-e.y)*(e.x-n.x),l=(i.y-n.y)*(t.x-e.x)-(i.x-n.x)*(t.y-e.y);if(0!=l){var u=a/l;(o=new Intersection("Intersection")).points.push(new r(e.x+u*(t.x-e.x),e.y+u*(t.y-e.y)))}else o=new Intersection(0==a||0==s?"Coincident":"Parallel");return o},Intersection.bezout=function(e,t){var n=e[0]*t[1]-t[0]*e[1],r=e[0]*t[2]-t[0]*e[2],i=e[0]*t[3]-t[0]*e[3],a=e[0]*t[4]-t[0]*e[4],s=e[0]*t[5]-t[0]*e[5],l=e[1]*t[2]-t[1]*e[2],u=e[1]*t[4]-t[1]*e[4],c=e[1]*t[5]-t[1]*e[5],h=e[2]*t[3]-t[2]*e[3],d=e[3]*t[4]-t[3]*e[4],p=e[3]*t[5]-t[3]*e[5],f=c+d,y=u-h;return new o(n*l-r*r,n*y+i*l-2*r*a,n*f+i*y-a*a-2*r*s,n*p+i*f-2*a*s,i*p-s*s)},void 0!==t&&(t.exports=Intersection)},{"kld-affine":7,"kld-polynomial":11}],4:[function(e,t,n){function IntersectionArgs(e,t){this.init(e,t)}IntersectionArgs.prototype.init=function(e,t){this.name=e,this.args=t},void 0!==t&&(t.exports=IntersectionArgs)},{}],5:[function(e,t,n){var r={pointInCircle:function(e,t,n){return Vector.fromPoints(t,e).length()<=n},pointInEllipse:function(e,t,n,r){var i=e.subtract(t);return i.x*i.x/(n*n)+i.y*i.y/(r*r)<=1},pointInPolyline:function(e,t){for(var n,r=t.length,i=0,o=t[0],a=1;a<=r;a++){var s=t[a%r],l=Math.min(o.y,s.y),u=Math.max(o.y,s.y),c=Math.max(o.x,s.x);o.y!=s.y&&l<e.y&&e.y<=u&&e.x<=c&&(n=(e.y-o.y)*(s.x-o.x)/(s.y-o.y)+o.x,(o.x==s.x||e.x<=n)&&i++),o=s}return i%2==1}};r.pointInPolygon=r.pointInPolyline,r.pointInRectangle=function(e,t,n){return t.x<=e.x&&e.x<n.x&&topleft.y<=e.y&&e.y<n.y},void 0!==t&&(t.exports=r)},{}],6:[function(e,t,n){if(void 0!==t)var r=e("kld-affine").Point2D,i=e("./IntersectionArgs");var o={quadraticBezier:function(e,t,n,o,a,s){return new i("Bezier2",[new r(e,t),new r(n,o),new r(a,s)])},cubicBezier:function(e,t,n,o,a,s,l,u){return new i("Bezier3",[new r(e,t),new r(n,o),new r(a,s),new r(l,u)])},circle:function(e,t,n){return new i("Circle",[new r(e,t),n])},ellipse:function(e,t,n,o){return new i("Ellipse",[new r(e,t),n,o])},line:function(e,t,n,o){return new i("Line",[new r(e,t),new r(n,o)])},path:function(e){return new i("Path",e)},polygon:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(new r(e[n],e[n+1]));return new i("Polygon",[t])},polyline:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(new r(e[n],e[n+1]));return new i("Polyline",[t])},rectangle:function(e,t,n,o){return new i("Rectangle",[new r(e,t),new r(e+n,t+o)])}};void 0!==t&&(t.exports=o)},{"./IntersectionArgs":4,"kld-affine":7}],7:[function(e,t,n){n.Point2D=e("./lib/Point2D"),n.Vector2D=e("./lib/Vector2D"),n.Matrix2D=e("./lib/Matrix2D")},{"./lib/Matrix2D":8,"./lib/Point2D":9,"./lib/Vector2D":10}],8:[function(e,t,n){function setReadonlyProperty(e,t,n){Object.defineProperty(e,t,{value:n,writable:!1,enumerable:!0,configurable:!1})}function Matrix2D(e,t,n,r,i,o){setReadonlyProperty(this,"a",void 0!==e?e:1),setReadonlyProperty(this,"b",void 0!==t?t:0),setReadonlyProperty(this,"c",void 0!==n?n:0),setReadonlyProperty(this,"d",void 0!==r?r:1),setReadonlyProperty(this,"e",void 0!==i?i:0),setReadonlyProperty(this,"f",void 0!==o?o:0)}setReadonlyProperty(Matrix2D,"IDENTITY",new Matrix2D(1,0,0,1,0,0)),setReadonlyProperty(Matrix2D.IDENTITY,"isIdentity",function(){return!0}),Matrix2D.translation=function(e,t){return new Matrix2D(1,0,0,1,e,t)},Matrix2D.scaling=function(e){return new Matrix2D(e,0,0,e,0,0)},Matrix2D.scalingAt=function(e,t){return new Matrix2D(e,0,0,e,t.x-t.x*e,t.y-t.y*e)},Matrix2D.nonUniformScaling=function(e,t){return new Matrix2D(e,0,0,t,0,0)},Matrix2D.nonUniformScalingAt=function(e,t,n){return new Matrix2D(e,0,0,t,n.x-n.x*e,n.y-n.y*t)},Matrix2D.rotation=function(e){let t=Math.cos(e),n=Math.sin(e);return new Matrix2D(t,n,-n,t,0,0)},Matrix2D.rotationAt=function(e,t){let n=Math.cos(e),r=Math.sin(e);return new Matrix2D(n,r,-r,n,t.x-t.x*n+t.y*r,t.y-t.y*n-t.x*r)},Matrix2D.rotationFromVector=function(e){var t=e.unit(),n=t.x,r=t.y;return new Matrix2D(n,r,-r,n,0,0)},Matrix2D.xFlip=function(){return new Matrix2D(-1,0,0,1,0,0)},Matrix2D.yFlip=function(){return new Matrix2D(1,0,0,-1,0,0)},Matrix2D.xSkew=function(e){return new Matrix2D(1,0,Math.tan(e),1,0,0)},Matrix2D.ySkew=function(e){return new Matrix2D(1,Math.tan(e),0,1,0,0)},Matrix2D.prototype.multiply=function(e){return this.isIdentity()?e:e.isIdentity()?this:new this.constructor(this.a*e.a+this.c*e.b,this.b*e.a+this.d*e.b,this.a*e.c+this.c*e.d,this.b*e.c+this.d*e.d,this.a*e.e+this.c*e.f+this.e,this.b*e.e+this.d*e.f+this.f)},Matrix2D.prototype.inverse=function(){if(this.isIdentity())return this;var e=this.a*this.d-this.b*this.c;if(0===e)throw"Matrix is not invertible";var t=1/e,n=this.f*this.c-this.e*this.d,r=this.e*this.b-this.f*this.a;return new this.constructor(this.d*t,-this.b*t,-this.c*t,this.a*t,n*t,r*t)},Matrix2D.prototype.translate=function(e,t){return new this.constructor(this.a,this.b,this.c,this.d,this.a*e+this.c*t+this.e,this.b*e+this.d*t+this.f)},Matrix2D.prototype.scale=function(e){return new this.constructor(this.a*e,this.b*e,this.c*e,this.d*e,this.e,this.f)},Matrix2D.prototype.scaleAt=function(e,t){var n=t.x-e*t.x,r=t.y-e*t.y;return new this.constructor(this.a*e,this.b*e,this.c*e,this.d*e,this.a*n+this.c*r+this.e,this.b*n+this.d*r+this.f)},Matrix2D.prototype.scaleNonUniform=function(e,t){return new this.constructor(this.a*e,this.b*e,this.c*t,this.d*t,this.e,this.f)},Matrix2D.prototype.scaleNonUniformAt=function(e,t,n){var r=n.x-e*n.x,i=n.y-t*n.y;return new this.constructor(this.a*e,this.b*e,this.c*t,this.d*t,this.a*r+this.c*i+this.e,this.b*r+this.d*i+this.f)},Matrix2D.prototype.rotate=function(e){var t=Math.cos(e),n=Math.sin(e);return new this.constructor(this.a*t+this.c*n,this.b*t+this.d*n,this.a*-n+this.c*t,this.b*-n+this.d*t,this.e,this.f)},Matrix2D.prototype.rotateAt=function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.x,o=t.y,a=this.a*n+this.c*r,s=this.b*n+this.d*r,l=this.c*n-this.a*r,u=this.d*n-this.b*r;return new this.constructor(a,s,l,u,(this.a-a)*i+(this.c-l)*o+this.e,(this.b-s)*i+(this.d-u)*o+this.f)},Matrix2D.prototype.rotateFromVector=function(e){var t=e.unit(),n=t.x,r=t.y;return new this.constructor(this.a*n+this.c*r,this.b*n+this.d*r,this.a*-r+this.c*n,this.b*-r+this.d*n,this.e,this.f)},Matrix2D.prototype.flipX=function(){return new this.constructor(-this.a,-this.b,this.c,this.d,this.e,this.f)},Matrix2D.prototype.flipY=function(){return new this.constructor(this.a,this.b,-this.c,-this.d,this.e,this.f)},Matrix2D.prototype.skewX=function(e){var t=Math.tan(e);return new this.constructor(this.a,this.b,this.c+this.a*t,this.d+this.b*t,this.e,this.f)},Matrix2D.prototype.skewY=function(e){var t=Math.tan(e);return new this.constructor(this.a+this.c*t,this.b+this.d*t,this.c,this.d,this.e,this.f)},Matrix2D.prototype.isIdentity=function(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.e&&0===this.f},Matrix2D.prototype.isInvertible=function(){return this.a*this.d-this.b*this.c!=0},Matrix2D.prototype.getScale=function(){return{scaleX:Math.sqrt(this.a*this.a+this.c*this.c),scaleY:Math.sqrt(this.b*this.b+this.d*this.d)}},Matrix2D.prototype.getDecomposition=function(){var e=.5*(this.a+this.d),t=.5*(this.a-this.d),n=.5*(this.b+this.c),r=.5*(this.b-this.c),i=Math.sqrt(e*e+r*r),o=Math.sqrt(t*t+n*n),a=i+o,s=i-o,l=Math.atan2(n,t),u=Math.atan2(r,e),c=.5*(u-l),h=.5*(u+l);return{translation:new this.constructor(1,0,0,1,this.e,this.f),rotation:this.constructor.IDENTITY.rotate(h),scale:new this.constructor(a,0,0,s,0,0),rotation0:this.constructor.IDENTITY.rotate(c)}},Matrix2D.prototype.equals=function(e){return this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f},Matrix2D.prototype.precisionEquals=function(e,t){return Math.abs(this.a-e.a)<t&&Math.abs(this.b-e.b)<t&&Math.abs(this.c-e.c)<t&&Math.abs(this.d-e.d)<t&&Math.abs(this.e-e.e)<t&&Math.abs(this.f-e.f)<t},Matrix2D.prototype.toString=function(){return"matrix("+[this.a,this.b,this.c,this.d,this.e,this.f].join(",")+")"},void 0!==t&&(t.exports=Matrix2D)},{}],9:[function(e,t,n){function Point2D(e,t){Object.defineProperties(this,{x:{value:void 0!==e?e:0,writable:!1,enumerable:!0,configurable:!1},y:{value:void 0!==t?t:0,writable:!1,enumerable:!0,configurable:!1}})}Point2D.prototype.clone=function(){return new this.constructor(this.x,this.y)},Point2D.prototype.add=function(e){return new this.constructor(this.x+e.x,this.y+e.y)},Point2D.prototype.subtract=function(e){return new this.constructor(this.x-e.x,this.y-e.y)},Point2D.prototype.multiply=function(e){return new this.constructor(this.x*e,this.y*e)},Point2D.prototype.divide=function(e){return new this.constructor(this.x/e,this.y/e)},Point2D.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},Point2D.prototype.precisionEquals=function(e,t){return Math.abs(this.x-e.x)<t&&Math.abs(this.y-e.y)<t},Point2D.prototype.lerp=function(e,t){var n=1-t;return new this.constructor(this.x*n+e.x*t,this.y*n+e.y*t)},Point2D.prototype.distanceFrom=function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)},Point2D.prototype.min=function(e){return new this.constructor(Math.min(this.x,e.x),Math.min(this.y,e.y))},Point2D.prototype.max=function(e){return new this.constructor(Math.max(this.x,e.x),Math.max(this.y,e.y))},Point2D.prototype.transform=function(e){return new this.constructor(e.a*this.x+e.c*this.y+e.e,e.b*this.x+e.d*this.y+e.f)},Point2D.prototype.toString=function(){return"point("+this.x+","+this.y+")"},void 0!==t&&(t.exports=Point2D)},{}],10:[function(e,t,n){function Vector2D(e,t){Object.defineProperties(this,{x:{value:void 0!==e?e:0,writable:!1,enumerable:!0,configurable:!1},y:{value:void 0!==t?t:0,writable:!1,enumerable:!0,configurable:!1}})}Vector2D.fromPoints=function(e,t){return new Vector2D(t.x-e.x,t.y-e.y)},Vector2D.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Vector2D.prototype.magnitude=function(){return this.x*this.x+this.y*this.y},Vector2D.prototype.dot=function(e){return this.x*e.x+this.y*e.y},Vector2D.prototype.cross=function(e){return this.x*e.y-this.y*e.x},Vector2D.prototype.determinant=function(e){return this.x*e.y-this.y*e.x},Vector2D.prototype.unit=function(){return this.divide(this.length())},Vector2D.prototype.add=function(e){return new this.constructor(this.x+e.x,this.y+e.y)},Vector2D.prototype.subtract=function(e){return new this.constructor(this.x-e.x,this.y-e.y)},Vector2D.prototype.multiply=function(e){return new this.constructor(this.x*e,this.y*e)},Vector2D.prototype.divide=function(e){return new this.constructor(this.x/e,this.y/e)},Vector2D.prototype.angleBetween=function(e){var t=this.dot(e)/(this.length()*e.length());t=Math.max(-1,Math.min(t,1));var n=Math.acos(t);return this.cross(e)<0?-n:n},Vector2D.prototype.perp=function(){return new this.constructor(-this.y,this.x)},Vector2D.prototype.perpendicular=function(e){return this.subtract(this.project(e))},Vector2D.prototype.project=function(e){var t=this.dot(e)/e.dot(e);return e.multiply(t)},Vector2D.prototype.transform=function(e){return new this.constructor(e.a*this.x+e.c*this.y,e.b*this.x+e.d*this.y)},Vector2D.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},Vector2D.prototype.precisionEquals=function(e,t){return Math.abs(this.x-e.x)<t&&Math.abs(this.y-e.y)<t},Vector2D.prototype.toString=function(){return"vector("+this.x+","+this.y+")"},void 0!==t&&(t.exports=Vector2D)},{}],11:[function(e,t,n){n.Polynomial=e("./lib/Polynomial"),n.SqrtPolynomial=e("./lib/SqrtPolynomial")},{"./lib/Polynomial":12,"./lib/SqrtPolynomial":13}],12:[function(e,t,n){function Polynomial(){this.init(arguments)}Polynomial.TOLERANCE=1e-6,Polynomial.ACCURACY=15,Polynomial.interpolate=function(e,t,n,r,i){if(e.constructor!==Array||t.constructor!==Array)throw new Error("Polynomial.interpolate: xs and ys must be arrays");if(isNaN(n)||isNaN(r)||isNaN(i))throw new Error("Polynomial.interpolate: n, offset, and x must be numbers");for(var o=0,a=0,s=new Array(n),l=new Array(n),u=0,c=Math.abs(i-e[r]),h=0;h<n;h++){var d=Math.abs(i-e[r+h]);d<c&&(u=h,c=d),s[h]=l[h]=t[r+h]}o=t[r+u],u--;for(var p=1;p<n;p++){for(h=0;h<n-p;h++){var f=e[r+h]-i,y=e[r+h+p]-i,m=s[h+1]-l[h],g=f-y;if(0==g)throw new Error("Unable to interpolate polynomial. Two numbers in n were identical (to within roundoff)");g=m/g,l[h]=y*g,s[h]=f*g}o+=a=2*(u+1)<n-p?s[u+1]:l[u--]}return{y:o,dy:a}},Polynomial.prototype.init=function(e){this.coefs=new Array;for(var t=e.length-1;t>=0;t--)this.coefs.push(e[t]);this._variable="t",this._s=0},Polynomial.prototype.eval=function(e){if(isNaN(e))throw new Error("Polynomial.eval: parameter must be a number");for(var t=0,n=this.coefs.length-1;n>=0;n--)t=t*e+this.coefs[n];return t},Polynomial.prototype.add=function(e){for(var t=new Polynomial,n=this.getDegree(),r=e.getDegree(),i=Math.max(n,r),o=0;o<=i;o++){var a=o<=n?this.coefs[o]:0,s=o<=r?e.coefs[o]:0;t.coefs[o]=a+s}return t},Polynomial.prototype.multiply=function(e){for(var t=new Polynomial,n=0;n<=this.getDegree()+e.getDegree();n++)t.coefs.push(0);for(n=0;n<=this.getDegree();n++)for(var r=0;r<=e.getDegree();r++)t.coefs[n+r]+=this.coefs[n]*e.coefs[r];return t},Polynomial.prototype.divide_scalar=function(e){for(var t=0;t<this.coefs.length;t++)this.coefs[t]/=e},Polynomial.prototype.simplify=function(e){void 0===e&&(e=1e-12);for(var t=this.getDegree();t>=0&&Math.abs(this.coefs[t])<=e;t--)this.coefs.pop()},Polynomial.prototype.bisection=function(e,t){var n,r=this.eval(e),i=this.eval(t);if(Math.abs(r)<=Polynomial.TOLERANCE)n=e;else if(Math.abs(i)<=Polynomial.TOLERANCE)n=t;else if(r*i<=0)for(var o=Math.log(t-e),a=Math.LN10*Polynomial.ACCURACY,s=Math.ceil((o+a)/Math.LN2),l=0;l<s;l++){n=.5*(e+t);var u=this.eval(n);if(Math.abs(u)<=Polynomial.TOLERANCE)break;u*r<0?(t=n,i=u):(e=n,r=u)}return n},Polynomial.prototype.toString=function(){for(var e=new Array,t=new Array,n=this.coefs.length-1;n>=0;n--){var r=Math.round(1e3*this.coefs[n])/1e3;if(0!=r){var i=r<0?" - ":" + ";r=Math.abs(r),n>0&&(1==r?r=this._variable:r+=this._variable),n>1&&(r+="^"+n),t.push(i),e.push(r)}}t[0]=" + "==t[0]?"":"-";var o="";for(n=0;n<e.length;n++)o+=t[n]+e[n];return o},Polynomial.prototype.trapezoid=function(e,t,n){if(isNaN(e)||isNaN(t)||isNaN(n))throw new Error("Polynomial.trapezoid: parameters must be numbers");var r=t-e;if(1==n){var i=this.eval(e),o=this.eval(t);this._s=.5*r*(i+o)}else{for(var a=1<<n-2,s=r/a,l=e+.5*s,u=0,c=0;c<a;c++)u+=this.eval(l),l+=s;this._s=.5*(this._s+r*u/a)}if(isNaN(this._s))throw new Error("Polynomial.trapezoid: this._s is NaN");return this._s},Polynomial.prototype.simpson=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Polynomial.simpson: parameters must be numbers");for(var n=t-e,r=.5*n*(this.eval(e)+this.eval(t)),i=r,o=4*r/3,a=o,s=r,l=1,u=2;u<=20;u++){for(var c=n/l,h=e+.5*c,d=0,p=1;p<=l;p++)d+=this.eval(h),h+=c;if(o=(4*(r=i=.5*(i+n*d/l))-s)/3,Math.abs(o-a)<1e-7*Math.abs(a))break;a=o,s=r,l<<=1}return o},Polynomial.prototype.romberg=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Polynomial.romberg: parameters must be numbers");var n=new Array(21),r=new Array(21),i={y:0,dy:0};r[0]=1;for(var o=1;o<=20&&(n[o-1]=this.trapezoid(e,t,o),!(o>=3&&(i=Polynomial.interpolate(r,n,3,o-3,0),Math.abs(i.dy)<=1e-6*i.y)));o++)n[o]=n[o-1],r[o]=.25*r[o-1];return i.y},Polynomial.prototype.getDegree=function(){return this.coefs.length-1},Polynomial.prototype.getDerivative=function(){for(var e=new Polynomial,t=1;t<this.coefs.length;t++)e.coefs.push(t*this.coefs[t]);return e},Polynomial.prototype.getRoots=function(){var e;switch(this.simplify(),this.getDegree()){case 0:e=[];break;case 1:e=this.getLinearRoot();break;case 2:e=this.getQuadraticRoots();break;case 3:e=this.getCubicRoots();break;case 4:e=this.getQuarticRoots();break;default:e=[]}return e},Polynomial.prototype.getRootsInInterval=function(e,t){var n,r=new Array;if(1==this.getDegree())null!=(n=this.bisection(e,t))&&r.push(n);else{var o=this.getDerivative().getRootsInInterval(e,t);if(o.length>0){for(null!=(n=this.bisection(e,o[0]))&&r.push(n),i=0;i<=o.length-2;i++)null!=(n=this.bisection(o[i],o[i+1]))&&r.push(n);null!=(n=this.bisection(o[o.length-1],t))&&r.push(n)}else null!=(n=this.bisection(e,t))&&r.push(n)}return r},Polynomial.prototype.getLinearRoot=function(){var e=[],t=this.coefs[1];return 0!=t&&e.push(-this.coefs[0]/t),e},Polynomial.prototype.getQuadraticRoots=function(){var e=[];if(2==this.getDegree()){var t=this.coefs[2],n=this.coefs[1]/t,r=n*n-4*(this.coefs[0]/t);if(r>0){var i=Math.sqrt(r);e.push(.5*(-n+i)),e.push(.5*(-n-i))}else 0==r&&e.push(.5*-n)}return e},Polynomial.prototype.getCubicRoots=function(){var e=[];if(3==this.getDegree()){var t=this.coefs[3],n=this.coefs[2]/t,r=this.coefs[1]/t,i=(3*r-n*n)/3,o=(2*n*n*n-9*r*n+27*(this.coefs[0]/t))/27,a=n/3,s=o*o/4+i*i*i/27,l=o/2,u=this.zeroErrorEstimate();if(Math.abs(s)<=u&&(s=0),s>0){var c,h=Math.sqrt(s);c=(g=-l+h)>=0?Math.pow(g,1/3):-Math.pow(-g,1/3),(g=-l-h)>=0?c+=Math.pow(g,1/3):c-=Math.pow(-g,1/3),e.push(c-a)}else if(s<0){var d=Math.sqrt(-i/3),p=Math.atan2(Math.sqrt(-s),-l)/3,f=Math.cos(p),y=Math.sin(p),m=Math.sqrt(3);e.push(2*d*f-a),e.push(-d*(f+m*y)-a),e.push(-d*(f-m*y)-a)}else{var g;g=l>=0?-Math.pow(l,1/3):Math.pow(-l,1/3),e.push(2*g-a),e.push(-g-a)}}return e};var r=function(e){return"number"==typeof e?e?e<0?-1:1:e==e?e:NaN:NaN};Polynomial.prototype.getQuarticRoots=function(){var e=[],t=this.getDegree();if(4==t){var n=new Polynomial;n.coefs=this.coefs.slice(),n.divide_scalar(n.coefs[t]);Math.abs(n.coefs[0])<10*1e-15*Math.abs(n.coefs[3])&&(n.coefs[0]=0);var i,o=n.getDerivative(),a=o.getRoots().sort(function(e,t){return e-t}),s=[],l=a.length-1,u=this.bounds();maxabsX=Math.max(Math.abs(u.minX),Math.abs(u.maxX));var c=this.zeroErrorEstimate(maxabsX);for(i=0;i<=l;i++)s.push(n.eval(a[i]));for(i=0;i<=l;i++)Math.abs(s[i])<c&&(s[i]=0);i=0;var h=Math.max(.1*(u.maxX-u.minX)/t,1e-15),d=[],p=[];if(l>-1){for(0!=s[0]?r(s[0])!=r(n.eval(a[0]-h)-s[0])&&(d.push(a[0]-h),p.push([u.minX,a[0]])):(e.push(a[0],a[0]),i++);i<l;i++)0==s[i+1]?(e.push(a[i+1],a[i+1]),i++):r(s[i])!=r(s[i+1])&&(d.push((a[i]+a[i+1])/2),p.push([a[i],a[i+1]]));0!=s[l]&&r(s[l])!=r(n.eval(a[l]+h)-s[l])&&(d.push(a[l]+h),p.push([a[l],u.maxX]))}var f=function(e){return n.eval(e)},y=function(e){return o.eval(e)};if(d.length>0)for(i=0;i<d.length;i++)d[i]=Polynomial.newton_secant_bisection(d[i],f,y,32,p[i][0],p[i][1]);e=e.concat(d)}return e},Polynomial.prototype.zeroErrorEstimate=function(e){if(void 0===e){var t=this.bounds();e=Math.max(Math.abs(t.minX),Math.abs(t.maxX))}if(e<.001)return 2*Math.abs(this.eval(1e-15));var n=this.coefs.length-1,r=this.coefs[n];return 10*1e-15*this.coefs.reduce(function(t,n,i){var o=n/r*Math.pow(e,i);return o>t?o:t},0)},Polynomial.prototype.bounds_UpperReal_Fujiwara=function(){var e=this.coefs,t=e.length-1,n=e[t];1!=n&&(e=this.coefs.map(function(e){return e/n}));var r,i=e.map(function(e,n){return n<t?Math.pow(Math.abs(0==n?e/2:e),1/(t-n)):e}),o=function(e,t,n){return r(n)&&(e.max<t?(e.nearmax=e.max,e.max=t):e.nearmax<t&&(e.nearmax=t)),e};r=function(n){return n<t&&e[n]<0};var a=i.reduce(o,{max:0,nearmax:0});return r=function(n){return n<t&&(t%2==n%2?e[n]<0:e[n]>0)},{negX:-2*i.reduce(o,{max:0,nearmax:0}).max,posX:2*a.max}},Polynomial.prototype.bounds_LowerReal_Fujiwara=function(){var e=new Polynomial;e.coefs=this.coefs.slice().reverse();var t=e.bounds_UpperReal_Fujiwara();return t.negX=1/t.negX,t.posX=1/t.posX,t},Polynomial.prototype.bounds=function(){var e=this.bounds_UpperReal_Fujiwara(),t={minX:e.negX,maxX:e.posX};return 0===e.negX&&0===e.posX?t:(0===e.negX?t.minX=this.bounds_LowerReal_Fujiwara().posX:0===e.posX&&(t.maxX=this.bounds_LowerReal_Fujiwara().negX),t.minX>t.maxX&&(t.minX=t.maxX=0),t)},Polynomial.newton_secant_bisection=function(e,t,n,i,o,a){var s,l,u,c,h,d,p=0,f=0;s=e;var m=Math.pow(10,-14),g="number"==typeof o&&"number"==typeof a;if(g){if(o>a)throw new Error("newton root finding: min must be greater than max");if(h=t(o),d=t(a),r(h)==r(d))throw new Error("newton root finding: y values of bounds must be of opposite sign")}var v,x=function(){return Math.abs(u)<=m*Math.abs(s)||f==s-u-s};for(v=0;v<i;v++){if(0==(l=n(s))){if(0==p)throw new Error("newton root finding: df(x) is zero");l=p}if(p=l,y=t(s),u=y/l,c=s-u,x())break;if(g){if(r(y)==r(d))a=s,d=y;else{if(r(y)!=r(h)){s=c;break}o=s,h=y}if(c<o||c>a){if(r(h)==r(d))break;var b=d-h,w=a-o;if(u=0==b?s-(o+.5*w):Math.abs(b/Math.min(h,d))>50?s-(o+w*(.5+(Math.abs(h)<Math.abs(d)?-.25:.25))):s-(o-h/b*w),c=s-u,x())break}}f=s-c,s=c}return s},void 0!==t&&(t.exports=Polynomial)},{}],13:[function(e,t,n){if(void 0!==t)var r=e("./Polynomial");function SqrtPolynomial(){this.init(arguments)}SqrtPolynomial.VERSION=1,SqrtPolynomial.prototype=new r,SqrtPolynomial.prototype.constructor=SqrtPolynomial,SqrtPolynomial.superclass=r.prototype,SqrtPolynomial.prototype.eval=function(e){var t=SqrtPolynomial.superclass.eval.call(this,e);if(Math.abs(t)<1e-7&&(t=0),t<0)throw new Error("SqrtPolynomial.eval: cannot take square root of negative number");return Math.sqrt(t)},SqrtPolynomial.prototype.toString=function(){return"sqrt("+SqrtPolynomial.superclass.toString.call(this)+")"},void 0!==t&&(t.exports=SqrtPolynomial)},{"./Polynomial":12}]},{},[1])(1)}),function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):this.bowser=t()}(0,function(){function t(t){function n(e){var n=t.match(e);return n&&n.length>1&&n[1]||""}var i,o=n(/(ipod|iphone|ipad)/i).toLowerCase(),a=!/like android/i.test(t)&&/android/i.test(t),s=/nexus\s*[0-6]\s*/i.test(t),l=!s&&/nexus\s*[0-9]+/i.test(t),u=/CrOS/.test(t),c=/silk/i.test(t),h=/sailfish/i.test(t),d=/tizen/i.test(t),p=/(web|hpw)os/i.test(t),f=/windows phone/i.test(t),y=!f&&/windows/i.test(t),m=!o&&!c&&/macintosh/i.test(t),g=!a&&!h&&!d&&!p&&/linux/i.test(t),v=n(/edge\/(\d+(\.\d+)?)/i),x=n(/version\/(\d+(\.\d+)?)/i),b=/tablet/i.test(t),w=!b&&/[^-]mobi/i.test(t),_=/xbox/i.test(t);/opera|opr|opios/i.test(t)?i={name:"Opera",opera:e,version:x||n(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(t)?i={name:"Opera Coast",coast:e,version:x||n(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(t)?i={name:"Yandex Browser",yandexbrowser:e,version:x||n(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(t)?i={name:"UC Browser",ucbrowser:e,version:n(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(t)?i={name:"Maxthon",maxthon:e,version:n(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(t)?i={name:"Epiphany",epiphany:e,version:n(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(t)?i={name:"Puffin",puffin:e,version:n(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(t)?i={name:"Sleipnir",sleipnir:e,version:n(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(t)?i={name:"K-Meleon",kMeleon:e,version:n(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:f?(i={name:"Windows Phone",windowsphone:e},v?(i.msedge=e,i.version=v):(i.msie=e,i.version=n(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(t)?i={name:"Internet Explorer",msie:e,version:n(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:u?i={name:"Chrome",chromeos:e,chromeBook:e,chrome:e,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(t)?i={name:"Microsoft Edge",msedge:e,version:v}:/vivaldi/i.test(t)?i={name:"Vivaldi",vivaldi:e,version:n(/vivaldi\/(\d+(\.\d+)?)/i)||x}:h?i={name:"Sailfish",sailfish:e,version:n(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?i={name:"SeaMonkey",seamonkey:e,version:n(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(i={name:"Firefox",firefox:e,version:n(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(i.firefoxos=e)):c?i={name:"Amazon Silk",silk:e,version:n(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(t)?i={name:"PhantomJS",phantom:e,version:n(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(t)?i={name:"SlimerJS",slimer:e,version:n(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?i={name:"BlackBerry",blackberry:e,version:x||n(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:p?(i={name:"WebOS",webos:e,version:x||n(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(i.touchpad=e)):/bada/i.test(t)?i={name:"Bada",bada:e,version:n(/dolfin\/(\d+(\.\d+)?)/i)}:d?i={name:"Tizen",tizen:e,version:n(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||x}:/qupzilla/i.test(t)?i={name:"QupZilla",qupzilla:e,version:n(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||x}:/chromium/i.test(t)?i={name:"Chromium",chromium:e,version:n(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||x}:/chrome|crios|crmo/i.test(t)?i={name:"Chrome",chrome:e,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:a?i={name:"Android",version:x}:/safari|applewebkit/i.test(t)?(i={name:"Safari",safari:e},x&&(i.version=x)):o?(i={name:"iphone"==o?"iPhone":"ipad"==o?"iPad":"iPod"},x&&(i.version=x)):i=/googlebot/i.test(t)?{name:"Googlebot",googlebot:e,version:n(/googlebot\/(\d+(\.\d+))/i)||x}:{name:n(/^(.*)\/(.*) /),version:function r(e){var n=t.match(e);return n&&n.length>1&&n[2]||""}(/^(.*)\/(.*) /)},!i.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\/537\.36/i.test(t)?(i.name=i.name||"Blink",i.blink=e):(i.name=i.name||"Webkit",i.webkit=e),!i.version&&x&&(i.version=x)):!i.opera&&/gecko\//i.test(t)&&(i.name=i.name||"Gecko",i.gecko=e,i.version=i.version||n(/gecko\/(\d+(\.\d+)?)/i)),i.msedge||!a&&!i.silk?o?(i[o]=e,i.ios=e):m?i.mac=e:_?i.xbox=e:y?i.windows=e:g&&(i.linux=e):i.android=e;var k="";i.windowsphone?k=n(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):o?k=(k=n(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):a?k=n(/android[ \/-](\d+(\.\d+)*)/i):i.webos?k=n(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):i.blackberry?k=n(/rim\stablet\sos\s(\d+(\.\d+)*)/i):i.bada?k=n(/bada\/(\d+(\.\d+)*)/i):i.tizen&&(k=n(/tizen[\/\s](\d+(\.\d+)*)/i)),k&&(i.osversion=k);var S=k.split(".")[0];return b||l||"ipad"==o||a&&(3==S||S>=4&&!w)||i.silk?i.tablet=e:(w||"iphone"==o||"ipod"==o||a||s||i.blackberry||i.webos||i.bada)&&(i.mobile=e),i.msedge||i.msie&&i.version>=10||i.yandexbrowser&&i.version>=15||i.vivaldi&&i.version>=1||i.chrome&&i.version>=20||i.firefox&&i.version>=20||i.safari&&i.version>=6||i.opera&&i.version>=10||i.ios&&i.osversion&&i.osversion.split(".")[0]>=6||i.blackberry&&i.version>=10.1||i.chromium&&i.version>=20?i.a=e:i.msie&&i.version<10||i.chrome&&i.version<20||i.firefox&&i.version<20||i.safari&&i.version<6||i.opera&&i.version<10||i.ios&&i.osversion&&i.osversion.split(".")[0]<6||i.chromium&&i.version<20?i.c=e:i.x=e,i}function r(e){return e.split(".").length}function i(e,t){var n,r=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(n=0;n<e.length;n++)r=t(e[n]);return r}function s(e){for(var t=Math.max(r(e[0]),r(e[1])),n=i(e,function(e){var n=t-r(e);return i((e+=new Array(n+1).join(".0")).split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});--t>=0;){if(n[0][t]>n[1][t])return 1;if(n[0][t]!==n[1][t])return-1;if(0===t)return 0}}function o(e,n,r){var i=a;"string"==typeof n&&(r=n,n=void 0),void 0===n&&(n=!1),r&&(i=t(r));var o=""+i.version;for(var l in e)if(e.hasOwnProperty(l)&&i[l])return s([o,e[l]])<0;return n}var e=!0,a=t("undefined"!=typeof navigator?navigator.userAgent:"");return a.test=function(e){for(var t=0;t<e.length;++t){var n=e[t];if("string"==typeof n&&n in a)return!0}return!1},a.isUnsupportedBrowser=o,a.compareVersions=s,a.check=function u(e,t,n){return!o(e,t,n)},a._detect=t,a}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.virtualDom=e()}}(function(){return function e(t,n,r){function s(o,a){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(i)return i(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return s(n||e)},c,c.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(e,t,n){var r=e("./vdom/create-element.js");t.exports=r},{"./vdom/create-element.js":15}],2:[function(e,t,n){var r=e("./vtree/diff.js");t.exports=r},{"./vtree/diff.js":35}],3:[function(e,t,n){var r=e("./virtual-hyperscript/index.js");t.exports=r},{"./virtual-hyperscript/index.js":22}],4:[function(e,t,n){var r=e("./diff.js"),i=e("./patch.js"),o=e("./h.js"),a=e("./create-element.js"),s=e("./vnode/vnode.js"),l=e("./vnode/vtext.js");t.exports={diff:r,patch:i,h:o,create:a,VNode:s,VText:l}},{"./create-element.js":1,"./diff.js":2,"./h.js":3,"./patch.js":13,"./vnode/vnode.js":31,"./vnode/vtext.js":33}],5:[function(e,t,n){t.exports=function split(e){var t=String.prototype.split,n=/()??/.exec("")[1]===e;return function(r,i,o){if("[object RegExp]"!==Object.prototype.toString.call(i))return t.call(r,i,o);var a,s,l,u,c=[],h=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.extended?"x":"")+(i.sticky?"y":""),d=0;i=new RegExp(i.source,h+"g");for(r+="",n||(a=new RegExp("^"+i.source+"$(?!\\s)",h)),o=o===e?-1>>>0:o>>>0;(s=i.exec(r))&&!((l=s.index+s[0].length)>d&&(c.push(r.slice(d,s.index)),!n&&s.length>1&&s[0].replace(a,function(){for(var t=1;t<arguments.length-2;t++)arguments[t]===e&&(s[t]=e)}),s.length>1&&s.index<r.length&&Array.prototype.push.apply(c,s.slice(1)),u=s[0].length,d=l,c.length>=o));)i.lastIndex===s.index&&i.lastIndex++;return d===r.length?!u&&i.test("")||c.push(""):c.push(r.slice(d)),c.length>o?c.slice(0,o):c}}()},{}],6:[function(e,t,n){},{}],7:[function(e,t,n){"use strict";e("individual/one-version")("ev-store","7");var r="__EV_STORE_KEY@7";t.exports=function EvStore(e){var t=e[r];t||(t=e[r]={});return t}},{"individual/one-version":9}],8:[function(e,t,n){(function(e){"use strict";var n="undefined"!=typeof window?window:void 0!==e?e:{};t.exports=function Individual(e,t){if(e in n)return n[e];return n[e]=t,t}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(e,t,n){"use strict";var r=e("./index.js");t.exports=function OneVersion(e,t,n){var i="__INDIVIDUAL_ONE_VERSION_"+e,o=r(i+"_ENFORCE_SINGLETON",t);if(o!==t)throw new Error("Can only have one copy of "+e+".\nYou already have version "+o+" installed.\nThis means you cannot install version "+t);return r(i,n)}},{"./index.js":8}],10:[function(e,t,n){(function(n){var r=void 0!==n?n:"undefined"!=typeof window?window:{},i=e("min-document");if("undefined"!=typeof document)t.exports=document;else{var o=r["__GLOBAL_DOCUMENT_CACHE@4"];o||(o=r["__GLOBAL_DOCUMENT_CACHE@4"]=i),t.exports=o}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"min-document":6}],11:[function(e,t,n){"use strict";t.exports=function isObject(e){return"object"==typeof e&&null!==e}},{}],12:[function(e,t,n){var r=Array.isArray,i=Object.prototype.toString;t.exports=r||function isArray(e){return"[object Array]"===i.call(e)}},{}],13:[function(e,t,n){var r=e("./vdom/patch.js");t.exports=r},{"./vdom/patch.js":18}],14:[function(e,t,n){var r=e("is-object"),i=e("../vnode/is-vhook.js");function removeProperty(e,t,n,r){if(r){var o=r[t];if(i(o))o.unhook&&o.unhook(e,t,n);else if("attributes"===t)for(var a in o)e.removeAttribute(a);else if("style"===t)for(var s in o)e.style[s]="";else e[t]="string"==typeof o?"":null}}function patchObject(e,t,n,i,o){var a=n?n[i]:void 0;if("attributes"!==i)if(a&&r(a)&&getPrototype(a)!==getPrototype(o))e[i]=o;else{r(e[i])||(e[i]={});var s="style"===i?"":void 0;for(var l in o){var u=o[l];e[i][l]=void 0===u?s:u}}else for(var c in o){var h=o[c];void 0===h?e.removeAttribute(c):e.setAttribute(c,h)}}function getPrototype(e){return Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__?e.__proto__:e.constructor?e.constructor.prototype:void 0}t.exports=function applyProperties(e,t,n){for(var o in t){var a=t[o];void 0===a?removeProperty(e,o,a,n):i(a)?(removeProperty(e,o,a,n),a.hook&&a.hook(e,o,n?n[o]:void 0)):r(a)?patchObject(e,t,n,o,a):e[o]=a}}},{"../vnode/is-vhook.js":26,"is-object":11}],15:[function(e,t,n){var r=e("global/document"),i=e("./apply-properties"),o=e("../vnode/is-vnode.js"),a=e("../vnode/is-vtext.js"),s=e("../vnode/is-widget.js"),l=e("../vnode/handle-thunk.js");t.exports=function createElement(e,t){var n=t&&t.document||r;var u=t?t.warn:null;e=l(e).a;if(s(e))return e.init();if(a(e))return n.createTextNode(e.text);if(!o(e))return u&&u("Item is not a valid virtual dom node",e),null;var c=null===e.namespace?n.createElement(e.tagName):n.createElementNS(e.namespace,e.tagName);var h=e.properties;i(c,h);var d=e.children;for(var p=0;p<d.length;p++){var f=createElement(d[p],t);f&&c.appendChild(f)}return c}},{"../vnode/handle-thunk.js":24,"../vnode/is-vnode.js":27,"../vnode/is-vtext.js":28,"../vnode/is-widget.js":29,"./apply-properties":14,"global/document":10}],16:[function(e,t,n){var r={};function indexInRange(e,t,n){if(0===e.length)return!1;for(var r,i,o=0,a=e.length-1;o<=a;){if(i=e[r=(a+o)/2>>0],o===a)return i>=t&&i<=n;if(i<t)o=r+1;else{if(!(i>n))return!0;a=r-1}}return!1}function ascending(e,t){return e>t?1:-1}t.exports=function domIndex(e,t,n,i){return n&&0!==n.length?(n.sort(ascending),function recurse(e,t,n,i,o){i=i||{};if(e){indexInRange(n,o,o)&&(i[o]=e);var a=t.children;if(a)for(var s=e.childNodes,l=0;l<t.children.length;l++){o+=1;var u=a[l]||r,c=o+(u.count||0);indexInRange(n,o,c)&&recurse(s[l],u,n,i,o),o=c}}return i}(e,t,n,i,0)):{}}},{}],17:[function(e,t,n){var r=e("./apply-properties"),i=e("../vnode/is-widget.js"),o=e("../vnode/vpatch.js"),a=e("./update-widget");function destroyWidget(e,t){"function"==typeof t.destroy&&i(t)&&t.destroy(e)}t.exports=function applyPatch(e,t,n){var i=e.type,s=e.vNode,l=e.patch;switch(i){case o.REMOVE:return function removeNode(e,t){var n=e.parentNode;n&&n.removeChild(e);return destroyWidget(e,t),null}(t,s);case o.INSERT:return function insertNode(e,t,n){var r=n.render(t,n);e&&e.appendChild(r);return e}(t,l,n);case o.VTEXT:return function stringPatch(e,t,n,r){var i;if(3===e.nodeType)e.replaceData(0,e.length,n.text),i=e;else{var o=e.parentNode;i=r.render(n,r),o&&i!==e&&o.replaceChild(i,e)}return i}(t,0,l,n);case o.WIDGET:return function widgetPatch(e,t,n,r){var i,o=a(t,n);i=o?n.update(t,e)||e:r.render(n,r);var s=e.parentNode;s&&i!==e&&s.replaceChild(i,e);o||destroyWidget(e,t);return i}(t,s,l,n);case o.VNODE:return function vNodePatch(e,t,n,r){var i=e.parentNode,o=r.render(n,r);i&&o!==e&&i.replaceChild(o,e);return o}(t,0,l,n);case o.ORDER:return function reorderChildren(e,t){for(var n,r,i,o=e.childNodes,a={},s=0;s<t.removes.length;s++)r=t.removes[s],n=o[r.from],r.key&&(a[r.key]=n),e.removeChild(n);for(var l=o.length,u=0;u<t.inserts.length;u++)i=t.inserts[u],n=a[i.key],e.insertBefore(n,i.to>=l++?null:o[i.to])}(t,l),t;case o.PROPS:return r(t,l,s.properties),t;case o.THUNK:return function replaceRoot(e,t){e&&t&&e!==t&&e.parentNode&&e.parentNode.replaceChild(t,e);return t}(t,n.patch(t,l,n));default:return t}}},{"../vnode/is-widget.js":29,"../vnode/vpatch.js":32,"./apply-properties":14,"./update-widget":19}],18:[function(e,t,n){var r=e("global/document"),i=e("x-is-array"),o=e("./create-element"),a=e("./dom-index"),s=e("./patch-op");function patchRecursive(e,t,n){var i=function patchIndices(e){var t=[];for(var n in e)"a"!==n&&t.push(Number(n));return t}(t);if(0===i.length)return e;var o=a(e,t.a,i),s=e.ownerDocument;n.document||s===r||(n.document=s);for(var l=0;l<i.length;l++){var u=i[l];e=applyPatch(e,o[u],t[u],n)}return e}function applyPatch(e,t,n,r){if(!t)return e;var o;if(i(n))for(var a=0;a<n.length;a++)o=s(n[a],t,r),t===e&&(e=o);else o=s(n,t,r),t===e&&(e=o);return e}t.exports=function patch(e,t,n){n=n||{};n.patch=n.patch&&n.patch!==patch?n.patch:patchRecursive;n.render=n.render||o;return n.patch(e,t,n)}},{"./create-element":15,"./dom-index":16,"./patch-op":17,"global/document":10,"x-is-array":12}],19:[function(e,t,n){var r=e("../vnode/is-widget.js");t.exports=function updateWidget(e,t){if(r(e)&&r(t))return"name"in e&&"name"in t?e.id===t.id:e.init===t.init;return!1}},{"../vnode/is-widget.js":29}],20:[function(e,t,n){"use strict";var r=e("ev-store");function EvHook(e){if(!(this instanceof EvHook))return new EvHook(e);this.value=e}t.exports=EvHook,EvHook.prototype.hook=function(e,t){r(e)[t.substr(3)]=this.value},EvHook.prototype.unhook=function(e,t){r(e)[t.substr(3)]=void 0}},{"ev-store":7}],21:[function(e,t,n){"use strict";function SoftSetHook(e){if(!(this instanceof SoftSetHook))return new SoftSetHook(e);this.value=e}t.exports=SoftSetHook,SoftSetHook.prototype.hook=function(e,t){e[t]!==this.value&&(e[t]=this.value)}},{}],22:[function(e,t,n){"use strict";var r=e("x-is-array"),i=e("../vnode/vnode.js"),o=e("../vnode/vtext.js"),a=e("../vnode/is-vnode"),s=e("../vnode/is-vtext"),l=e("../vnode/is-widget"),u=e("../vnode/is-vhook"),c=e("../vnode/is-thunk"),d=e("./parse-tag.js"),p=e("./hooks/soft-set-hook.js"),f=e("./hooks/ev-hook.js");function isChild(e){return a(e)||s(e)||l(e)||c(e)}function errorString(e){try{return JSON.stringify(e,null,"    ")}catch(t){return String(e)}}t.exports=function h(e,t,n){var a,s,l,c,h=[];!n&&function isChildren(e){return"string"==typeof e||r(e)||isChild(e)}(t)&&(n=t,s={});a=d(e,s=s||t||{}),s.hasOwnProperty("key")&&(l=s.key,s.key=void 0);s.hasOwnProperty("namespace")&&(c=s.namespace,s.namespace=void 0);"INPUT"!==a||c||!s.hasOwnProperty("value")||void 0===s.value||u(s.value)||(s.value=p(s.value));(function transformProperties(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];if(u(n))continue;"ev-"===t.substr(0,3)&&(e[t]=f(n))}})(s),void 0!==n&&null!==n&&function addChild(e,t,n,i){if("string"==typeof e)t.push(new o(e));else if("number"==typeof e)t.push(new o(String(e)));else if(isChild(e))t.push(e);else{if(!r(e)){if(null===e||void 0===e)return;throw function UnexpectedVirtualElement(e){var t=new Error;return t.type="virtual-hyperscript.unexpected.virtual-element",t.message="Unexpected virtual child passed to h().\nExpected a VNode / Vthunk / VWidget / string but:\ngot:\n"+errorString(e.foreignObject)+".\nThe parent vnode is:\n"+errorString(e.parentVnode),t.foreignObject=e.foreignObject,t.parentVnode=e.parentVnode,t}({foreignObject:e,parentVnode:{tagName:n,properties:i}})}for(var a=0;a<e.length;a++)addChild(e[a],t,n,i)}}(n,h,a,s);return new i(a,s,h,l,c)}},{"../vnode/is-thunk":25,"../vnode/is-vhook":26,"../vnode/is-vnode":27,"../vnode/is-vtext":28,"../vnode/is-widget":29,"../vnode/vnode.js":31,"../vnode/vtext.js":33,"./hooks/ev-hook.js":20,"./hooks/soft-set-hook.js":21,"./parse-tag.js":23,"x-is-array":12}],23:[function(e,t,n){"use strict";var r=e("browser-split"),i=/([\.#]?[a-zA-Z0-9\u007F-\uFFFF_:-]+)/,o=/^\.|#/;t.exports=function parseTag(e,t){if(!e)return"DIV";var n,a,s,l,u=!t.hasOwnProperty("id"),c=r(e,i),h=null;o.test(c[1])&&(h="DIV");for(l=0;l<c.length;l++)(a=c[l])&&(s=a.charAt(0),h?"."===s?(n=n||[]).push(a.substring(1,a.length)):"#"===s&&u&&(t.id=a.substring(1,a.length)):h=a);n&&(t.className&&n.push(t.className),t.className=n.join(" "));return t.namespace?h:h.toUpperCase()}},{"browser-split":5}],24:[function(e,t,n){var r=e("./is-vnode"),i=e("./is-vtext"),o=e("./is-widget"),a=e("./is-thunk");function renderThunk(e,t){var n=e.vnode;if(n||(n=e.vnode=e.render(t)),!(r(n)||i(n)||o(n)))throw new Error("thunk did not return a valid node");return n}t.exports=function handleThunk(e,t){var n=e,r=t;a(t)&&(r=renderThunk(t,e));a(e)&&(n=renderThunk(e,null));return{a:n,b:r}}},{"./is-thunk":25,"./is-vnode":27,"./is-vtext":28,"./is-widget":29}],25:[function(e,t,n){t.exports=function isThunk(e){return e&&"Thunk"===e.type}},{}],26:[function(e,t,n){t.exports=function isHook(e){return e&&("function"==typeof e.hook&&!e.hasOwnProperty("hook")||"function"==typeof e.unhook&&!e.hasOwnProperty("unhook"))}},{}],27:[function(e,t,n){var r=e("./version");t.exports=function isVirtualNode(e){return e&&"VirtualNode"===e.type&&e.version===r}},{"./version":30}],28:[function(e,t,n){var r=e("./version");t.exports=function isVirtualText(e){return e&&"VirtualText"===e.type&&e.version===r}},{"./version":30}],29:[function(e,t,n){t.exports=function isWidget(e){return e&&"Widget"===e.type}},{}],30:[function(e,t,n){t.exports="2"},{}],31:[function(e,t,n){var r=e("./version"),i=e("./is-vnode"),o=e("./is-widget"),a=e("./is-thunk"),s=e("./is-vhook");t.exports=VirtualNode;var l={},u=[];function VirtualNode(e,t,n,r,c){this.tagName=e,this.properties=t||l,this.children=n||u,this.key=null!=r?String(r):void 0,this.namespace="string"==typeof c?c:null;var h,d=n&&n.length||0,p=0,f=!1,y=!1,m=!1;for(var g in t)if(t.hasOwnProperty(g)){var v=t[g];s(v)&&v.unhook&&(h||(h={}),h[g]=v)}for(var x=0;x<d;x++){var b=n[x];i(b)?(p+=b.count||0,!f&&b.hasWidgets&&(f=!0),!y&&b.hasThunks&&(y=!0),m||!b.hooks&&!b.descendantHooks||(m=!0)):!f&&o(b)?"function"==typeof b.destroy&&(f=!0):!y&&a(b)&&(y=!0)}this.count=d+p,this.hasWidgets=f,this.hasThunks=y,this.hooks=h,this.descendantHooks=m}VirtualNode.prototype.version=r,VirtualNode.prototype.type="VirtualNode"},{"./is-thunk":25,"./is-vhook":26,"./is-vnode":27,"./is-widget":29,"./version":30}],32:[function(e,t,n){var r=e("./version");function VirtualPatch(e,t,n){this.type=Number(e),this.vNode=t,this.patch=n}VirtualPatch.NONE=0,VirtualPatch.VTEXT=1,VirtualPatch.VNODE=2,VirtualPatch.WIDGET=3,VirtualPatch.PROPS=4,VirtualPatch.ORDER=5,VirtualPatch.INSERT=6,VirtualPatch.REMOVE=7,VirtualPatch.THUNK=8,t.exports=VirtualPatch,VirtualPatch.prototype.version=r,VirtualPatch.prototype.type="VirtualPatch"},{"./version":30}],33:[function(e,t,n){var r=e("./version");function VirtualText(e){this.text=String(e)}t.exports=VirtualText,VirtualText.prototype.version=r,VirtualText.prototype.type="VirtualText"},{"./version":30}],34:[function(e,t,n){var r=e("is-object"),i=e("../vnode/is-vhook");function getPrototype(e){return Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__?e.__proto__:e.constructor?e.constructor.prototype:void 0}t.exports=function diffProps(e,t){var n;for(var o in e){o in t||((n=n||{})[o]=void 0);var a=e[o],s=t[o];if(a!==s)if(r(a)&&r(s))if(getPrototype(s)!==getPrototype(a))(n=n||{})[o]=s;else if(i(s))(n=n||{})[o]=s;else{var l=diffProps(a,s);l&&((n=n||{})[o]=l)}else(n=n||{})[o]=s}for(var u in t)u in e||((n=n||{})[u]=t[u]);return n}},{"../vnode/is-vhook":26,"is-object":11}],35:[function(e,t,n){var r=e("x-is-array"),i=e("../vnode/vpatch"),o=e("../vnode/is-vnode"),a=e("../vnode/is-vtext"),s=e("../vnode/is-widget"),l=e("../vnode/is-thunk"),u=e("../vnode/handle-thunk"),c=e("./diff-props");function diff(e,t){var n={a:e};return walk(e,t,n,0),n}function walk(e,t,n,r){if(e!==t){var u=n[r],h=!1;if(l(e)||l(t))thunks(e,t,n,r);else if(null==t)s(e)||(clearState(e,n,r),u=n[r]),u=appendPatch(u,new i(i.REMOVE,e,t));else if(o(t))if(o(e))if(e.tagName===t.tagName&&e.namespace===t.namespace&&e.key===t.key){var d=c(e.properties,t.properties);d&&(u=appendPatch(u,new i(i.PROPS,e,d))),u=function diffChildren(e,t,n,r,a){for(var s=e.children,l=function reorder(e,t){var n=keyIndex(t),r=n.keys,i=n.free;if(i.length===t.length)return{children:t,moves:null};var o=keyIndex(e),a=o.keys;if(o.free.length===e.length)return{children:t,moves:null};for(var s=[],l=0,u=i.length,c=0,h=0;h<e.length;h++){var d,p=e[h];p.key?r.hasOwnProperty(p.key)?(d=r[p.key],s.push(t[d])):(d=h-c++,s.push(null)):l<u?(d=i[l++],s.push(t[d])):(d=h-c++,s.push(null))}for(var f=l>=i.length?t.length:i[l],y=0;y<t.length;y++){var m=t[y];m.key?a.hasOwnProperty(m.key)||s.push(m):y>=f&&s.push(m)}for(var g,v=s.slice(),x=0,b=[],w=[],_=0;_<t.length;){var k=t[_];for(g=v[x];null===g&&v.length;)b.push(remove(v,x,null)),g=v[x];g&&g.key===k.key?(x++,_++):k.key?(g&&g.key&&r[g.key]!==_+1?(b.push(remove(v,x,g.key)),(g=v[x])&&g.key===k.key?x++:w.push({key:k.key,to:_})):w.push({key:k.key,to:_}),_++):g&&g.key&&b.push(remove(v,x,g.key))}for(;x<v.length;)g=v[x],b.push(remove(v,x,g&&g.key));if(b.length===c&&!w.length)return{children:s,moves:null};return{children:s,moves:{removes:b,inserts:w}}}(s,t.children),u=l.children,c=s.length,h=u.length,d=c>h?c:h,p=0;p<d;p++){var f=s[p],y=u[p];a+=1,f?walk(f,y,n,a):y&&(r=appendPatch(r,new i(i.INSERT,null,y))),o(f)&&f.count&&(a+=f.count)}l.moves&&(r=appendPatch(r,new i(i.ORDER,e,l.moves)));return r}(e,t,n,u,r)}else u=appendPatch(u,new i(i.VNODE,e,t)),h=!0;else u=appendPatch(u,new i(i.VNODE,e,t)),h=!0;else a(t)?a(e)?e.text!==t.text&&(u=appendPatch(u,new i(i.VTEXT,e,t))):(u=appendPatch(u,new i(i.VTEXT,e,t)),h=!0):s(t)&&(s(e)||(h=!0),u=appendPatch(u,new i(i.WIDGET,e,t)));u&&(n[r]=u),h&&clearState(e,n,r)}}function clearState(e,t,n){!function unhook(e,t,n){if(o(e)){if(e.hooks&&(t[n]=appendPatch(t[n],new i(i.PROPS,e,function undefinedKeys(e){var t={};for(var n in e)t[n]=void 0;return t}(e.hooks)))),e.descendantHooks||e.hasThunks)for(var r=e.children,a=r.length,s=0;s<a;s++){var u=r[s];unhook(u,t,n+=1),o(u)&&u.count&&(n+=u.count)}}else l(e)&&thunks(e,null,t,n)}(e,t,n),function destroyWidgets(e,t,n){if(s(e))"function"==typeof e.destroy&&(t[n]=appendPatch(t[n],new i(i.REMOVE,e,null)));else if(o(e)&&(e.hasWidgets||e.hasThunks))for(var r=e.children,a=r.length,u=0;u<a;u++){var c=r[u];destroyWidgets(c,t,n+=1),o(c)&&c.count&&(n+=c.count)}else l(e)&&thunks(e,null,t,n)}(e,t,n)}function thunks(e,t,n,r){var o=u(e,t),a=diff(o.a,o.b);(function hasPatches(e){for(var t in e)if("a"!==t)return!0;return!1})(a)&&(n[r]=new i(i.THUNK,null,a))}function remove(e,t,n){return e.splice(t,1),{from:t,key:n}}function keyIndex(e){for(var t={},n=[],r=e.length,i=0;i<r;i++){var o=e[i];o.key?t[o.key]=i:n.push(i)}return{keys:t,free:n}}function appendPatch(e,t){return e?(r(e)?e.push(t):e=[e,t],e):t}t.exports=diff},{"../vnode/handle-thunk":24,"../vnode/is-thunk":25,"../vnode/is-vnode":27,"../vnode/is-vtext":28,"../vnode/is-widget":29,"../vnode/vpatch":32,"./diff-props":34,"x-is-array":12}]},{},[4])(4)}),e="undefined"!=typeof window?window:this,t=function(e,t){var n=this.SVG=function(e){if(n.supported)return e=new n.Doc(e),n.parser.draw||n.prepare(),e};if(n.ns="http://www.w3.org/2000/svg",n.xmlns="http://www.w3.org/2000/xmlns/",n.xlink="http://www.w3.org/1999/xlink",n.svgjs="http://svgjs.com/svgjs",n.supported=!!t.createElementNS&&!!t.createElementNS(n.ns,"svg").createSVGRect,!n.supported)return!1;n.did=1e3,n.eid=function(e){return"Svgjs"+capitalize(e)+n.did++},n.create=function(e){var n=t.createElementNS(this.ns,e);return n.setAttribute("id",this.eid(e)),n},n.extend=function(){var e,t,r,i;for(t=(e=[].slice.call(arguments)).pop(),i=e.length-1;i>=0;i--)if(e[i])for(r in t)e[i].prototype[r]=t[r];n.Set&&n.Set.inherit&&n.Set.inherit()},n.invent=function(e){var t="function"==typeof e.create?e.create:function(){this.constructor.call(this,n.create(e.create))};return e.inherit&&(t.prototype=new e.inherit),e.extend&&n.extend(t,e.extend),e.construct&&n.extend(e.parent||n.Container,e.construct),t},n.adopt=function(t){return t?t.instance?t.instance:((r="svg"==t.nodeName?t.parentNode instanceof e.SVGElement?new n.Nested:new n.Doc:"linearGradient"==t.nodeName?new n.Gradient("linear"):"radialGradient"==t.nodeName?new n.Gradient("radial"):n[capitalize(t.nodeName)]?new(n[capitalize(t.nodeName)]):new n.Element(t)).type=t.nodeName,r.node=t,t.instance=r,r instanceof n.Doc&&r.namespace().defs(),r.setData(JSON.parse(t.getAttribute("svgjs:data"))||{}),r):null;var r},n.prepare=function(){var e=t.getElementsByTagName("body")[0],r=(e?new n.Doc(e):n.adopt(t.documentElement).nested()).size(2,0);n.parser={body:e||t.documentElement,draw:r.style("opacity:0;position:absolute;left:-100%;top:-100%;overflow:hidden").node,poly:r.polyline().node,path:r.path().node,native:n.create("svg")}},n.parser={native:n.create("svg")},t.addEventListener("DOMContentLoaded",function(){n.parser.draw||n.prepare()},!1),n.regex={numberAndUnit:/^([+-]?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?)([a-z%]*)$/i,hex:/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,rgb:/rgb\((\d+),(\d+),(\d+)\)/,reference:/#([a-z0-9\-_]+)/i,transforms:/\)\s*,?\s*/,whitespace:/\s/g,isHex:/^#[a-f0-9]{3,6}$/i,isRgb:/^rgb\(/,isCss:/[^:]+:[^;]+;?/,isBlank:/^(\s+)?$/,isNumber:/^[+-]?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,isPercent:/^-?[\d\.]+%$/,isImage:/\.(jpg|jpeg|png|gif|svg)(\?[^=]+.*)?/i,delimiter:/[\s,]+/,hyphen:/([^e])\-/gi,pathLetters:/[MLHVCSQTAZ]/gi,isPathLetter:/[MLHVCSQTAZ]/i,numbersWithDots:/((\d?\.\d+(?:e[+-]?\d+)?)((?:\.\d+(?:e[+-]?\d+)?)+))+/gi,dots:/\./g},n.utils={map:function(e,t){var n,r=e.length,i=[];for(n=0;n<r;n++)i.push(t(e[n]));return i},filter:function(e,t){var n,r=e.length,i=[];for(n=0;n<r;n++)t(e[n])&&i.push(e[n]);return i},radians:function(e){return e%360*Math.PI/180},degrees:function(e){return 180*e/Math.PI%360},filterSVGElements:function(t){return this.filter(t,function(t){return t instanceof e.SVGElement})}},n.defaults={attrs:{"fill-opacity":1,"stroke-opacity":1,"stroke-width":0,"stroke-linejoin":"miter","stroke-linecap":"butt",fill:"#000000",stroke:"#000000",opacity:1,x:0,y:0,cx:0,cy:0,width:0,height:0,r:0,rx:0,ry:0,offset:0,"stop-opacity":1,"stop-color":"#000000","font-size":16,"font-family":"Helvetica, Arial, sans-serif","text-anchor":"start"}},n.Color=function(e){var t;this.r=0,this.g=0,this.b=0,e&&("string"==typeof e?n.regex.isRgb.test(e)?(t=n.regex.rgb.exec(e.replace(n.regex.whitespace,"")),this.r=parseInt(t[1]),this.g=parseInt(t[2]),this.b=parseInt(t[3])):n.regex.isHex.test(e)&&(t=n.regex.hex.exec(function fullHex(e){return 4==e.length?["#",e.substring(1,2),e.substring(1,2),e.substring(2,3),e.substring(2,3),e.substring(3,4),e.substring(3,4)].join(""):e}(e)),this.r=parseInt(t[1],16),this.g=parseInt(t[2],16),this.b=parseInt(t[3],16)):"object"==typeof e&&(this.r=e.r,this.g=e.g,this.b=e.b))},n.extend(n.Color,{toString:function(){return this.toHex()},toHex:function(){return"#"+compToHex(this.r)+compToHex(this.g)+compToHex(this.b)},toRgb:function(){return"rgb("+[this.r,this.g,this.b].join()+")"},brightness:function(){return this.r/255*.3+this.g/255*.59+this.b/255*.11},morph:function(e){return this.destination=new n.Color(e),this},at:function(e){return this.destination?(e=e<0?0:e>1?1:e,new n.Color({r:~~(this.r+(this.destination.r-this.r)*e),g:~~(this.g+(this.destination.g-this.g)*e),b:~~(this.b+(this.destination.b-this.b)*e)})):this}}),n.Color.test=function(e){return e+="",n.regex.isHex.test(e)||n.regex.isRgb.test(e)},n.Color.isRgb=function(e){return e&&"number"==typeof e.r&&"number"==typeof e.g&&"number"==typeof e.b},n.Color.isColor=function(e){return n.Color.isRgb(e)||n.Color.test(e)},n.Array=function(e,t){0==(e=(e||[]).valueOf()).length&&t&&(e=t.valueOf()),this.value=this.parse(e)},n.extend(n.Array,{morph:function(e){if(this.destination=this.parse(e),this.value.length!=this.destination.length){for(var t=this.value[this.value.length-1],n=this.destination[this.destination.length-1];this.value.length>this.destination.length;)this.destination.push(n);for(;this.value.length<this.destination.length;)this.value.push(t)}return this},settle:function(){for(var e=0,t=this.value.length,n=[];e<t;e++)-1==n.indexOf(this.value[e])&&n.push(this.value[e]);return this.value=n},at:function(e){if(!this.destination)return this;for(var t=0,r=this.value.length,i=[];t<r;t++)i.push(this.value[t]+(this.destination[t]-this.value[t])*e);return new n.Array(i)},toString:function(){return this.value.join(" ")},valueOf:function(){return this.value},parse:function(e){return e=e.valueOf(),Array.isArray(e)?e:this.split(e)},split:function(e){return e.trim().split(n.regex.delimiter).map(parseFloat)},reverse:function(){return this.value.reverse(),this},clone:function(){var e=new this.constructor;return e.value=function array_clone(e){var t=e.slice(0);for(var n=t.length;n--;)Array.isArray(t[n])&&(t[n]=array_clone(t[n]));return t}(this.value),e}}),n.PointArray=function(e,t){n.Array.call(this,e,t||[[0,0]])},n.PointArray.prototype=new n.Array,n.PointArray.prototype.constructor=n.PointArray,n.extend(n.PointArray,{toString:function(){for(var e=0,t=this.value.length,n=[];e<t;e++)n.push(this.value[e].join(","));return n.join(" ")},toLine:function(){return{x1:this.value[0][0],y1:this.value[0][1],x2:this.value[1][0],y2:this.value[1][1]}},at:function(e){if(!this.destination)return this;for(var t=0,r=this.value.length,i=[];t<r;t++)i.push([this.value[t][0]+(this.destination[t][0]-this.value[t][0])*e,this.value[t][1]+(this.destination[t][1]-this.value[t][1])*e]);return new n.PointArray(i)},parse:function(e){var t=[];if(e=e.valueOf(),Array.isArray(e)){if(Array.isArray(e[0]))return e}else e=e.trim().split(n.regex.delimiter).map(parseFloat);e.length%2!=0&&e.pop();for(var r=0,i=e.length;r<i;r+=2)t.push([e[r],e[r+1]]);return t},move:function(e,t){var n=this.bbox();if(e-=n.x,t-=n.y,!isNaN(e)&&!isNaN(t))for(var r=this.value.length-1;r>=0;r--)this.value[r]=[this.value[r][0]+e,this.value[r][1]+t];return this},size:function(e,t){var n,r=this.bbox();for(n=this.value.length-1;n>=0;n--)r.width&&(this.value[n][0]=(this.value[n][0]-r.x)*e/r.width+r.x),r.height&&(this.value[n][1]=(this.value[n][1]-r.y)*t/r.height+r.y);return this},bbox:function(){return n.parser.poly.setAttribute("points",this.toString()),n.parser.poly.getBBox()}});for(var r={M:function(e,t,n){return t.x=n.x=e[0],t.y=n.y=e[1],["M",t.x,t.y]},L:function(e,t){return t.x=e[0],t.y=e[1],["L",e[0],e[1]]},H:function(e,t){return t.x=e[0],["H",e[0]]},V:function(e,t){return t.y=e[0],["V",e[0]]},C:function(e,t){return t.x=e[4],t.y=e[5],["C",e[0],e[1],e[2],e[3],e[4],e[5]]},S:function(e,t){return t.x=e[2],t.y=e[3],["S",e[0],e[1],e[2],e[3]]},Q:function(e,t){return t.x=e[2],t.y=e[3],["Q",e[0],e[1],e[2],e[3]]},T:function(e,t){return t.x=e[0],t.y=e[1],["T",e[0],e[1]]},Z:function(e,t,n){return t.x=n.x,t.y=n.y,["Z"]},A:function(e,t){return t.x=e[5],t.y=e[6],["A",e[0],e[1],e[2],e[3],e[4],e[5],e[6]]}},i="mlhvqtcsaz".split(""),o=0,a=i.length;o<a;++o)r[i[o]]=function(e){return function(t,n,i){if("H"==e)t[0]=t[0]+n.x;else if("V"==e)t[0]=t[0]+n.y;else if("A"==e)t[5]=t[5]+n.x,t[6]=t[6]+n.y;else for(var o=0,a=t.length;o<a;++o)t[o]=t[o]+(o%2?n.y:n.x);return r[e](t,n,i)}}(i[o].toUpperCase());n.PathArray=function(e,t){n.Array.call(this,e,t||[["M",0,0]])},n.PathArray.prototype=new n.Array,n.PathArray.prototype.constructor=n.PathArray,n.extend(n.PathArray,{toString:function(){return function arrayToString(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t][0],null!=e[t][1]&&(r+=e[t][1],null!=e[t][2]&&(r+=" ",r+=e[t][2],null!=e[t][3]&&(r+=" ",r+=e[t][3],r+=" ",r+=e[t][4],null!=e[t][5]&&(r+=" ",r+=e[t][5],r+=" ",r+=e[t][6],null!=e[t][7]&&(r+=" ",r+=e[t][7])))));return r+" "}(this.value)},move:function(e,t){var n=this.bbox();if(e-=n.x,t-=n.y,!isNaN(e)&&!isNaN(t))for(var r,i=this.value.length-1;i>=0;i--)"M"==(r=this.value[i][0])||"L"==r||"T"==r?(this.value[i][1]+=e,this.value[i][2]+=t):"H"==r?this.value[i][1]+=e:"V"==r?this.value[i][1]+=t:"C"==r||"S"==r||"Q"==r?(this.value[i][1]+=e,this.value[i][2]+=t,this.value[i][3]+=e,this.value[i][4]+=t,"C"==r&&(this.value[i][5]+=e,this.value[i][6]+=t)):"A"==r&&(this.value[i][6]+=e,this.value[i][7]+=t);return this},size:function(e,t){var n,r,i=this.bbox();for(n=this.value.length-1;n>=0;n--)"M"==(r=this.value[n][0])||"L"==r||"T"==r?(this.value[n][1]=(this.value[n][1]-i.x)*e/i.width+i.x,this.value[n][2]=(this.value[n][2]-i.y)*t/i.height+i.y):"H"==r?this.value[n][1]=(this.value[n][1]-i.x)*e/i.width+i.x:"V"==r?this.value[n][1]=(this.value[n][1]-i.y)*t/i.height+i.y:"C"==r||"S"==r||"Q"==r?(this.value[n][1]=(this.value[n][1]-i.x)*e/i.width+i.x,this.value[n][2]=(this.value[n][2]-i.y)*t/i.height+i.y,this.value[n][3]=(this.value[n][3]-i.x)*e/i.width+i.x,this.value[n][4]=(this.value[n][4]-i.y)*t/i.height+i.y,"C"==r&&(this.value[n][5]=(this.value[n][5]-i.x)*e/i.width+i.x,this.value[n][6]=(this.value[n][6]-i.y)*t/i.height+i.y)):"A"==r&&(this.value[n][1]=this.value[n][1]*e/i.width,this.value[n][2]=this.value[n][2]*t/i.height,this.value[n][6]=(this.value[n][6]-i.x)*e/i.width+i.x,this.value[n][7]=(this.value[n][7]-i.y)*t/i.height+i.y);return this},equalCommands:function(e){var t,r,i;for(e=new n.PathArray(e),i=this.value.length===e.value.length,t=0,r=this.value.length;i&&t<r;t++)i=this.value[t][0]===e.value[t][0];return i},morph:function(e){return e=new n.PathArray(e),this.equalCommands(e)?this.destination=e:this.destination=null,this},at:function(e){if(!this.destination)return this;var t,r,i,o,a=this.value,s=this.destination.value,l=[],u=new n.PathArray;for(t=0,r=a.length;t<r;t++){for(l[t]=[a[t][0]],i=1,o=a[t].length;i<o;i++)l[t][i]=a[t][i]+(s[t][i]-a[t][i])*e;"A"===l[t][0]&&(l[t][4]=+(0!=l[t][4]),l[t][5]=+(0!=l[t][5]))}return u.value=l,u},parse:function(e){if(e instanceof n.PathArray)return e.valueOf();var t,i={M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7,Z:0};e="string"==typeof e?e.replace(n.regex.numbersWithDots,pathRegReplace).replace(n.regex.pathLetters," $& ").replace(n.regex.hyphen,"$1 -").trim().split(n.regex.delimiter):e.reduce(function(e,t){return[].concat.call(e,t)},[]);var o=[],a=new n.Point,s=new n.Point,l=0,u=e.length;do{n.regex.isPathLetter.test(e[l])?(t=e[l],++l):"M"==t?t="L":"m"==t&&(t="l"),o.push(r[t].call(null,e.slice(l,l+=i[t.toUpperCase()]).map(parseFloat),a,s))}while(u>l);return o},bbox:function(){return n.parser.path.setAttribute("d",this.toString()),n.parser.path.getBBox()}}),n.Number=n.invent({create:function(e,t){this.value=0,this.unit=t||"","number"==typeof e?this.value=isNaN(e)?0:isFinite(e)?e:e<0?-3.4e38:3.4e38:"string"==typeof e?(t=e.match(n.regex.numberAndUnit))&&(this.value=parseFloat(t[1]),"%"==t[5]?this.value/=100:"s"==t[5]&&(this.value*=1e3),this.unit=t[5]):e instanceof n.Number&&(this.value=e.valueOf(),this.unit=e.unit)},extend:{toString:function(){return("%"==this.unit?~~(1e8*this.value)/1e6:"s"==this.unit?this.value/1e3:this.value)+this.unit},toJSON:function(){return this.toString()},valueOf:function(){return this.value},plus:function(e){return e=new n.Number(e),new n.Number(this+e,this.unit||e.unit)},minus:function(e){return e=new n.Number(e),new n.Number(this-e,this.unit||e.unit)},times:function(e){return e=new n.Number(e),new n.Number(this*e,this.unit||e.unit)},divide:function(e){return e=new n.Number(e),new n.Number(this/e,this.unit||e.unit)},to:function(e){var t=new n.Number(this);return"string"==typeof e&&(t.unit=e),t},morph:function(e){return this.destination=new n.Number(e),e.relative&&(this.destination.value+=this.value),this},at:function(e){return this.destination?new n.Number(this.destination).minus(this).times(e).plus(this):this}}}),n.Element=n.invent({create:function(e){this._stroke=n.defaults.attrs.stroke,this._event=null,this.dom={},(this.node=e)&&(this.type=e.nodeName,this.node.instance=this,this._stroke=e.getAttribute("stroke")||this._stroke)},extend:{x:function(e){return this.attr("x",e)},y:function(e){return this.attr("y",e)},cx:function(e){return null==e?this.x()+this.width()/2:this.x(e-this.width()/2)},cy:function(e){return null==e?this.y()+this.height()/2:this.y(e-this.height()/2)},move:function(e,t){return this.x(e).y(t)},center:function(e,t){return this.cx(e).cy(t)},width:function(e){return this.attr("width",e)},height:function(e){return this.attr("height",e)},size:function(e,t){var r=proportionalSize(this,e,t);return this.width(new n.Number(r.width)).height(new n.Number(r.height))},clone:function(t,r){this.writeDataToDom();var i=function assignNewId(t){for(var r=t.childNodes.length-1;r>=0;r--)t.childNodes[r]instanceof e.SVGElement&&assignNewId(t.childNodes[r]);return n.adopt(t).id(n.eid(t.nodeName))}(this.node.cloneNode(!0));return t?t.add(i):this.after(i),i},remove:function(){return this.parent()&&this.parent().removeElement(this),this},replace:function(e){return this.after(e).remove(),e},addTo:function(e){return e.put(this)},putIn:function(e){return e.add(this)},id:function(e){return this.attr("id",e)},inside:function(e,t){var n=this.bbox();return e>n.x&&t>n.y&&e<n.x+n.width&&t<n.y+n.height},show:function(){return this.style("display","")},hide:function(){return this.style("display","none")},visible:function(){return"none"!=this.style("display")},toString:function(){return this.attr("id")},classes:function(){var e=this.attr("class");return null==e?[]:e.trim().split(n.regex.delimiter)},hasClass:function(e){return-1!=this.classes().indexOf(e)},addClass:function(e){if(!this.hasClass(e)){var t=this.classes();t.push(e),this.attr("class",t.join(" "))}return this},removeClass:function(e){return this.hasClass(e)&&this.attr("class",this.classes().filter(function(t){return t!=e}).join(" ")),this},toggleClass:function(e){return this.hasClass(e)?this.removeClass(e):this.addClass(e)},reference:function(e){return n.get(this.attr(e))},parent:function(t){var r=this;if(!r.node.parentNode)return null;if(r=n.adopt(r.node.parentNode),!t)return r;for(;r&&r.node instanceof e.SVGElement;){if("string"==typeof t?r.matches(t):r instanceof t)return r;r=n.adopt(r.node.parentNode)}},doc:function(){return this instanceof n.Doc?this:this.parent(n.Doc)},parents:function(e){var t=[],n=this;do{if(!(n=n.parent(e))||!n.node)break;t.push(n)}while(n.parent);return t},matches:function(e){return function matches(e,t){return(e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector).call(e,t)}(this.node,e)},native:function(){return this.node},svg:function(e){var r=t.createElement("svg");if(!(e&&this instanceof n.Parent))return r.appendChild(e=t.createElement("svg")),this.writeDataToDom(),e.appendChild(this.node.cloneNode(!0)),r.innerHTML.replace(/^<svg>/,"").replace(/<\/svg>$/,"");r.innerHTML="<svg>"+e.replace(/\n/,"").replace(/<(\w+)([^<]+?)\/>/g,"<$1$2></$1>")+"</svg>";for(var i=0,o=r.firstChild.childNodes.length;i<o;i++)this.node.appendChild(r.firstChild.firstChild);return this},writeDataToDom:function(){(this.each||this.lines)&&(this.each?this:this.lines()).each(function(){this.writeDataToDom()});return this.node.removeAttribute("svgjs:data"),Object.keys(this.dom).length&&this.node.setAttribute("svgjs:data",JSON.stringify(this.dom)),this},setData:function(e){return this.dom=e,this},is:function(e){return function is(e,t){return e instanceof t}(this,e)}}}),n.easing={"-":function(e){return e},"<>":function(e){return-Math.cos(e*Math.PI)/2+.5},">":function(e){return Math.sin(e*Math.PI/2)},"<":function(e){return 1-Math.cos(e*Math.PI/2)}},n.morph=function(e){return function(t,r){return new n.MorphObj(t,r).at(e)}},n.Situation=n.invent({create:function(e){this.init=!1,this.reversed=!1,this.reversing=!1,this.duration=new n.Number(e.duration).valueOf(),this.delay=new n.Number(e.delay).valueOf(),this.start=+new Date+this.delay,this.finish=this.start+this.duration,this.ease=e.ease,this.loop=0,this.loops=!1,this.animations={},this.attrs={},this.styles={},this.transforms=[],this.once={}}}),n.FX=n.invent({create:function(e){this._target=e,this.situations=[],this.active=!1,this.situation=null,this.paused=!1,this.lastPos=0,this.pos=0,this.absPos=0,this._speed=1},extend:{animate:function(e,t,r){"object"==typeof e&&(t=e.ease,r=e.delay,e=e.duration);var i=new n.Situation({duration:e||1e3,delay:r||0,ease:n.easing[t||"-"]||t});return this.queue(i),this},delay:function(e){var t=new n.Situation({duration:e,delay:0,ease:n.easing["-"]});return this.queue(t)},target:function(e){return e&&e instanceof n.Element?(this._target=e,this):this._target},timeToAbsPos:function(e){return(e-this.situation.start)/(this.situation.duration/this._speed)},absPosToTime:function(e){return this.situation.duration/this._speed*e+this.situation.start},startAnimFrame:function(){this.stopAnimFrame(),this.animationFrame=e.requestAnimationFrame(function(){this.step()}.bind(this))},stopAnimFrame:function(){e.cancelAnimationFrame(this.animationFrame)},start:function(){return!this.active&&this.situation&&(this.active=!0,this.startCurrent()),this},startCurrent:function(){return this.situation.start=+new Date+this.situation.delay/this._speed,this.situation.finish=this.situation.start+this.situation.duration/this._speed,this.initAnimations().step()},queue:function(e){return("function"==typeof e||e instanceof n.Situation)&&this.situations.push(e),this.situation||(this.situation=this.situations.shift()),this},dequeue:function(){return this.stop(),this.situation=this.situations.shift(),this.situation&&(this.situation instanceof n.Situation?this.start():this.situation.call(this)),this},initAnimations:function(){var e,t,r,i=this.situation;if(i.init)return this;for(e in i.animations)for(r=this.target()[e](),Array.isArray(r)||(r=[r]),Array.isArray(i.animations[e])||(i.animations[e]=[i.animations[e]]),t=r.length;t--;)i.animations[e][t]instanceof n.Number&&(r[t]=new n.Number(r[t])),i.animations[e][t]=r[t].morph(i.animations[e][t]);for(e in i.attrs)i.attrs[e]=new n.MorphObj(this.target().attr(e),i.attrs[e]);for(e in i.styles)i.styles[e]=new n.MorphObj(this.target().style(e),i.styles[e]);return i.initialTransformation=this.target().matrixify(),i.init=!0,this},clearQueue:function(){return this.situations=[],this},clearCurrent:function(){return this.situation=null,this},stop:function(e,t){var n=this.active;return this.active=!1,t&&this.clearQueue(),e&&this.situation&&(!n&&this.startCurrent(),this.atEnd()),this.stopAnimFrame(),this.clearCurrent()},reset:function(){if(this.situation){var e=this.situation;this.stop(),this.situation=e,this.atStart()}return this},finish:function(){for(this.stop(!0,!1);this.dequeue().situation&&this.stop(!0,!1););return this.clearQueue().clearCurrent(),this},atStart:function(){return this.at(0,!0)},atEnd:function(){return!0===this.situation.loops&&(this.situation.loops=this.situation.loop+1),"number"==typeof this.situation.loops?this.at(this.situation.loops,!0):this.at(1,!0)},at:function(e,t){var n=this.situation.duration/this._speed;return this.absPos=e,t||(this.situation.reversed&&(this.absPos=1-this.absPos),this.absPos+=this.situation.loop),this.situation.start=+new Date-this.absPos*n,this.situation.finish=this.situation.start+n,this.step(!0)},speed:function(e){return 0===e?this.pause():e?(this._speed=e,this.at(this.absPos,!0)):this._speed},loop:function(e,t){var n=this.last();return n.loops=null==e||e,n.loop=0,t&&(n.reversing=!0),this},pause:function(){return this.paused=!0,this.stopAnimFrame(),this},play:function(){return this.paused?(this.paused=!1,this.at(this.absPos,!0)):this},reverse:function(e){var t=this.last();return t.reversed=void 0===e?!t.reversed:e,this},progress:function(e){return e?this.situation.ease(this.pos):this.pos},after:function(e){var t=this.last();return this.target().on("finished.fx",function wrapper(n){n.detail.situation==t&&(e.call(this,t),this.off("finished.fx",wrapper))}),this._callStart()},during:function(e){var t=this.last(),r=function(r){r.detail.situation==t&&e.call(this,r.detail.pos,n.morph(r.detail.pos),r.detail.eased,t)};return this.target().off("during.fx",r).on("during.fx",r),this.after(function(){this.off("during.fx",r)}),this._callStart()},afterAll:function(e){var t=function wrapper(t){e.call(this),this.off("allfinished.fx",wrapper)};return this.target().off("allfinished.fx",t).on("allfinished.fx",t),this._callStart()},duringAll:function(e){var t=function(t){e.call(this,t.detail.pos,n.morph(t.detail.pos),t.detail.eased,t.detail.situation)};return this.target().off("during.fx",t).on("during.fx",t),this.afterAll(function(){this.off("during.fx",t)}),this._callStart()},last:function(){return this.situations.length?this.situations[this.situations.length-1]:this.situation},add:function(e,t,n){return this.last()[n||"animations"][e]=t,this._callStart()},step:function(e){var t,n,r;(e||(this.absPos=this.timeToAbsPos(+new Date)),!1!==this.situation.loops)?(t=Math.max(this.absPos,0),n=Math.floor(t),!0===this.situation.loops||n<this.situation.loops?(this.pos=t-n,r=this.situation.loop,this.situation.loop=n):(this.absPos=this.situation.loops,this.pos=1,r=this.situation.loop-1,this.situation.loop=this.situation.loops),this.situation.reversing&&(this.situation.reversed=this.situation.reversed!=Boolean((this.situation.loop-r)%2))):(this.absPos=Math.min(this.absPos,1),this.pos=this.absPos);this.pos<0&&(this.pos=0),this.situation.reversed&&(this.pos=1-this.pos);var i=this.situation.ease(this.pos);for(var o in this.situation.once)o>this.lastPos&&o<=i&&(this.situation.once[o].call(this.target(),this.pos,i),delete this.situation.once[o]);return this.active&&this.target().fire("during",{pos:this.pos,eased:i,fx:this,situation:this.situation}),this.situation?(this.eachAt(),1==this.pos&&!this.situation.reversed||this.situation.reversed&&0==this.pos?(this.stopAnimFrame(),this.target().fire("finished",{fx:this,situation:this.situation}),this.situations.length||(this.target().fire("allfinished"),this.situations.length||(this.target().off(".fx"),this.active=!1)),this.active?this.dequeue():this.clearCurrent()):!this.paused&&this.active&&this.startAnimFrame(),this.lastPos=i,this):this},eachAt:function(){var e,t,r,i=this,o=this.target(),a=this.situation;for(e in a.animations)r=[].concat(a.animations[e]).map(function(e){return"string"!=typeof e&&e.at?e.at(a.ease(i.pos),i.pos):e}),o[e].apply(o,r);for(e in a.attrs)r=[e].concat(a.attrs[e]).map(function(e){return"string"!=typeof e&&e.at?e.at(a.ease(i.pos),i.pos):e}),o.attr.apply(o,r);for(e in a.styles)r=[e].concat(a.styles[e]).map(function(e){return"string"!=typeof e&&e.at?e.at(a.ease(i.pos),i.pos):e}),o.style.apply(o,r);if(a.transforms.length){for(r=a.initialTransformation,e=0,t=a.transforms.length;e<t;e++){var s=a.transforms[e];s instanceof n.Matrix?r=s.relative?r.multiply((new n.Matrix).morph(s).at(a.ease(this.pos))):r.morph(s).at(a.ease(this.pos)):(s.relative||s.undo(r.extract()),r=r.multiply(s.at(a.ease(this.pos))))}o.matrix(r)}return this},once:function(e,t,n){var r=this.last();return n||(e=r.ease(e)),r.once[e]=t,this},_callStart:function(){return setTimeout(function(){this.start()}.bind(this),0),this}},parent:n.Element,construct:{animate:function(e,t,r){return(this.fx||(this.fx=new n.FX(this))).animate(e,t,r)},delay:function(e){return(this.fx||(this.fx=new n.FX(this))).delay(e)},stop:function(e,t){return this.fx&&this.fx.stop(e,t),this},finish:function(){return this.fx&&this.fx.finish(),this},pause:function(){return this.fx&&this.fx.pause(),this},play:function(){return this.fx&&this.fx.play(),this},speed:function(e){if(this.fx){if(null==e)return this.fx.speed();this.fx.speed(e)}return this}}}),n.MorphObj=n.invent({create:function(e,t){return n.Color.isColor(t)?new n.Color(e).morph(t):n.regex.numberAndUnit.test(t)?new n.Number(e).morph(t):(this.value=e,void(this.destination=t))},extend:{at:function(e,t){return t<1?this.value:this.destination},valueOf:function(){return this.value}}}),n.extend(n.FX,{attr:function(e,t,n){if("object"==typeof e)for(var r in e)this.attr(r,e[r]);else this.add(e,t,"attrs");return this},style:function(e,t){if("object"==typeof e)for(var n in e)this.style(n,e[n]);else this.add(e,t,"styles");return this},x:function(e,t){if(this.target()instanceof n.G)return this.transform({x:e},t),this;var r=new n.Number(e);return r.relative=t,this.add("x",r)},y:function(e,t){if(this.target()instanceof n.G)return this.transform({y:e},t),this;var r=new n.Number(e);return r.relative=t,this.add("y",r)},cx:function(e){return this.add("cx",new n.Number(e))},cy:function(e){return this.add("cy",new n.Number(e))},move:function(e,t){return this.x(e).y(t)},center:function(e,t){return this.cx(e).cy(t)},size:function(e,t){var r;this.target()instanceof n.Text?this.attr("font-size",e):(e&&t||(r=this.target().bbox()),e||(e=r.width/r.height*t),t||(t=r.height/r.width*e),this.add("width",new n.Number(e)).add("height",new n.Number(t)));return this},width:function(e){return this.add("width",new n.Number(e))},height:function(e){return this.add("height",new n.Number(e))},plot:function(e,t,n,r){return 4==arguments.length?this.plot([e,t,n,r]):this.add("plot",new(this.target().morphArray)(e))},leading:function(e){return this.target().leading?this.add("leading",new n.Number(e)):this},viewbox:function(e,t,r,i){return this.target()instanceof n.Container&&this.add("viewbox",new n.ViewBox(e,t,r,i)),this},update:function(e){if(this.target()instanceof n.Stop){if("number"==typeof e||e instanceof n.Number)return this.update({offset:arguments[0],color:arguments[1],opacity:arguments[2]});null!=e.opacity&&this.attr("stop-opacity",e.opacity),null!=e.color&&this.attr("stop-color",e.color),null!=e.offset&&this.attr("offset",e.offset)}return this}}),n.Box=n.invent({create:function(e,t,r,i){if(!("object"!=typeof e||e instanceof n.Element))return n.Box.call(this,null!=e.left?e.left:e.x,null!=e.top?e.top:e.y,e.width,e.height);4==arguments.length&&(this.x=e,this.y=t,this.width=r,this.height=i),fullBox(this)},extend:{merge:function(e){var t=new this.constructor;return t.x=Math.min(this.x,e.x),t.y=Math.min(this.y,e.y),t.width=Math.max(this.x+this.width,e.x+e.width)-t.x,t.height=Math.max(this.y+this.height,e.y+e.height)-t.y,fullBox(t)},transform:function(e){var t,r=1/0,i=-1/0,o=1/0,a=-1/0;return[new n.Point(this.x,this.y),new n.Point(this.x2,this.y),new n.Point(this.x,this.y2),new n.Point(this.x2,this.y2)].forEach(function(t){t=t.transform(e),r=Math.min(r,t.x),i=Math.max(i,t.x),o=Math.min(o,t.y),a=Math.max(a,t.y)}),(t=new this.constructor).x=r,t.width=i-r,t.y=o,t.height=a-o,fullBox(t),t}}}),n.BBox=n.invent({create:function(e){if(n.Box.apply(this,[].slice.call(arguments)),e instanceof n.Element){var r;try{if(t.documentElement.contains){if(!t.documentElement.contains(e.node))throw new Exception("Element not in the dom")}else{for(var i=e.node;i.parentNode;)i=i.parentNode;if(i!=t)throw new Exception("Element not in the dom")}r=e.node.getBBox()}catch(t){if(e instanceof n.Shape){var o=e.clone(n.parser.draw.instance).show();r=o.node.getBBox(),o.remove()}else r={x:e.node.clientLeft,y:e.node.clientTop,width:e.node.clientWidth,height:e.node.clientHeight}}n.Box.call(this,r)}},inherit:n.Box,parent:n.Element,construct:{bbox:function(){return new n.BBox(this)}}}),n.BBox.prototype.constructor=n.BBox,n.extend(n.Element,{tbox:function(){return console.warn("Use of TBox is deprecated and mapped to RBox. Use .rbox() instead."),this.rbox(this.doc())}}),n.RBox=n.invent({create:function(e){n.Box.apply(this,[].slice.call(arguments)),e instanceof n.Element&&n.Box.call(this,e.node.getBoundingClientRect())},inherit:n.Box,parent:n.Element,extend:{addOffset:function(){return this.x+=e.pageXOffset,this.y+=e.pageYOffset,this}},construct:{rbox:function(e){return e?new n.RBox(this).transform(e.screenCTM().inverse()):new n.RBox(this).addOffset()}}}),n.RBox.prototype.constructor=n.RBox,n.Matrix=n.invent({create:function(e){var t,r=arrayToMatrix([1,0,0,1,0,0]);for(e=e instanceof n.Element?e.matrixify():"string"==typeof e?arrayToMatrix(e.split(n.regex.delimiter).map(parseFloat)):6==arguments.length?arrayToMatrix([].slice.call(arguments)):Array.isArray(e)?arrayToMatrix(e):"object"==typeof e?e:r,t=l.length-1;t>=0;--t)this[l[t]]=null!=e[l[t]]?e[l[t]]:r[l[t]]},extend:{extract:function(){var e=deltaTransformPoint(this,0,1),t=deltaTransformPoint(this,1,0),r=180/Math.PI*Math.atan2(e.y,e.x)-90;return{x:this.e,y:this.f,transformedX:(this.e*Math.cos(r*Math.PI/180)+this.f*Math.sin(r*Math.PI/180))/Math.sqrt(this.a*this.a+this.b*this.b),transformedY:(this.f*Math.cos(r*Math.PI/180)+this.e*Math.sin(-r*Math.PI/180))/Math.sqrt(this.c*this.c+this.d*this.d),skewX:-r,skewY:180/Math.PI*Math.atan2(t.y,t.x),scaleX:Math.sqrt(this.a*this.a+this.b*this.b),scaleY:Math.sqrt(this.c*this.c+this.d*this.d),rotation:r,a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f,matrix:new n.Matrix(this)}},clone:function(){return new n.Matrix(this)},morph:function(e){return this.destination=new n.Matrix(e),this},at:function(e){return this.destination?new n.Matrix({a:this.a+(this.destination.a-this.a)*e,b:this.b+(this.destination.b-this.b)*e,c:this.c+(this.destination.c-this.c)*e,d:this.d+(this.destination.d-this.d)*e,e:this.e+(this.destination.e-this.e)*e,f:this.f+(this.destination.f-this.f)*e}):this},multiply:function(e){return new n.Matrix(this.native().multiply(function parseMatrix(e){e instanceof n.Matrix||(e=new n.Matrix(e));return e}(e).native()))},inverse:function(){return new n.Matrix(this.native().inverse())},translate:function(e,t){return new n.Matrix(this.native().translate(e||0,t||0))},scale:function(e,t,r,i){return 1==arguments.length?t=e:3==arguments.length&&(i=r,r=t,t=e),this.around(r,i,new n.Matrix(e,0,0,t,0,0))},rotate:function(e,t,r){return e=n.utils.radians(e),this.around(t,r,new n.Matrix(Math.cos(e),Math.sin(e),-Math.sin(e),Math.cos(e),0,0))},flip:function(e,t){return"x"==e?this.scale(-1,1,t,0):"y"==e?this.scale(1,-1,0,t):this.scale(-1,-1,e,null!=t?t:e)},skew:function(e,t,r,i){return 1==arguments.length?t=e:3==arguments.length&&(i=r,r=t,t=e),e=n.utils.radians(e),t=n.utils.radians(t),this.around(r,i,new n.Matrix(1,Math.tan(t),Math.tan(e),1,0,0))},skewX:function(e,t,n){return this.skew(e,0,t,n)},skewY:function(e,t,n){return this.skew(0,e,t,n)},around:function(e,t,r){return this.multiply(new n.Matrix(1,0,0,1,e||0,t||0)).multiply(r).multiply(new n.Matrix(1,0,0,1,-e||0,-t||0))},native:function(){for(var e=n.parser.native.createSVGMatrix(),t=l.length-1;t>=0;t--)e[l[t]]=this[l[t]];return e},toString:function(){return"matrix("+this.a+","+this.b+","+this.c+","+this.d+","+this.e+","+this.f+")"}},parent:n.Element,construct:{ctm:function(){return new n.Matrix(this.node.getCTM())},screenCTM:function(){if(this instanceof n.Nested){var e=this.rect(1,1),t=e.node.getScreenCTM();return e.remove(),new n.Matrix(t)}return new n.Matrix(this.node.getScreenCTM())}}}),n.Point=n.invent({create:function(e,t){var n;n=Array.isArray(e)?{x:e[0],y:e[1]}:"object"==typeof e?{x:e.x,y:e.y}:null!=e?{x:e,y:null!=t?t:e}:{x:0,y:0},this.x=n.x,this.y=n.y},extend:{clone:function(){return new n.Point(this)},morph:function(e,t){return this.destination=new n.Point(e,t),this},at:function(e){return this.destination?new n.Point({x:this.x+(this.destination.x-this.x)*e,y:this.y+(this.destination.y-this.y)*e}):this},native:function(){var e=n.parser.native.createSVGPoint();return e.x=this.x,e.y=this.y,e},transform:function(e){return new n.Point(this.native().matrixTransform(e.native()))}}}),n.extend(n.Element,{point:function(e,t){return new n.Point(e,t).transform(this.screenCTM().inverse())}}),n.extend(n.Element,{attr:function(e,t,r){if(null==e){for(e={},r=(t=this.node.attributes).length-1;r>=0;r--)e[t[r].nodeName]=n.regex.isNumber.test(t[r].nodeValue)?parseFloat(t[r].nodeValue):t[r].nodeValue;return e}if("object"==typeof e)for(t in e)this.attr(t,e[t]);else if(null===t)this.node.removeAttribute(e);else{if(null==t)return null==(t=this.node.getAttribute(e))?n.defaults.attrs[e]:n.regex.isNumber.test(t)?parseFloat(t):t;"stroke-width"==e?this.attr("stroke",parseFloat(t)>0?this._stroke:null):"stroke"==e&&(this._stroke=t),"fill"!=e&&"stroke"!=e||(n.regex.isImage.test(t)&&(t=this.doc().defs().image(t,0,0)),t instanceof n.Image&&(t=this.doc().defs().pattern(0,0,function(){this.add(t)}))),"number"==typeof t?t=new n.Number(t):n.Color.isColor(t)?t=new n.Color(t):Array.isArray(t)&&(t=new n.Array(t)),"leading"==e?this.leading&&this.leading(t):"string"==typeof r?this.node.setAttributeNS(r,e,t.toString()):this.node.setAttribute(e,t.toString()),!this.rebuild||"font-size"!=e&&"x"!=e||this.rebuild(e,t)}return this}}),n.extend(n.Element,{transform:function(e,t){var r,i;if("object"!=typeof e)return r=new n.Matrix(this).extract(),"string"==typeof e?r[e]:r;if(r=new n.Matrix(this),t=!!t||!!e.relative,null!=e.a)r=t?r.multiply(new n.Matrix(e)):new n.Matrix(e);else if(null!=e.rotation)ensureCentre(e,this),r=t?r.rotate(e.rotation,e.cx,e.cy):r.rotate(e.rotation-r.extract().rotation,e.cx,e.cy);else if(null!=e.scale||null!=e.scaleX||null!=e.scaleY){if(ensureCentre(e,this),e.scaleX=null!=e.scale?e.scale:null!=e.scaleX?e.scaleX:1,e.scaleY=null!=e.scale?e.scale:null!=e.scaleY?e.scaleY:1,!t){var o=r.extract();e.scaleX=1*e.scaleX/o.scaleX,e.scaleY=1*e.scaleY/o.scaleY}r=r.scale(e.scaleX,e.scaleY,e.cx,e.cy)}else if(null!=e.skew||null!=e.skewX||null!=e.skewY){if(ensureCentre(e,this),e.skewX=null!=e.skew?e.skew:null!=e.skewX?e.skewX:0,e.skewY=null!=e.skew?e.skew:null!=e.skewY?e.skewY:0,!t){o=r.extract();r=r.multiply((new n.Matrix).skew(o.skewX,o.skewY,e.cx,e.cy).inverse())}r=r.skew(e.skewX,e.skewY,e.cx,e.cy)}else e.flip?("x"==e.flip||"y"==e.flip?e.offset=null==e.offset?this.bbox()["c"+e.flip]:e.offset:null==e.offset?(i=this.bbox(),e.flip=i.cx,e.offset=i.cy):e.flip=e.offset,r=(new n.Matrix).flip(e.flip,e.offset)):null==e.x&&null==e.y||(t?r=r.translate(e.x,e.y):(null!=e.x&&(r.e=e.x),null!=e.y&&(r.f=e.y)));return this.attr("transform",r)}}),n.extend(n.FX,{transform:function(e,t){var r,i,o=this.target();return"object"!=typeof e?(r=new n.Matrix(o).extract(),"string"==typeof e?r[e]:r):(t=!!t||!!e.relative,null!=e.a?r=new n.Matrix(e):null!=e.rotation?(ensureCentre(e,o),r=new n.Rotate(e.rotation,e.cx,e.cy)):null!=e.scale||null!=e.scaleX||null!=e.scaleY?(ensureCentre(e,o),e.scaleX=null!=e.scale?e.scale:null!=e.scaleX?e.scaleX:1,e.scaleY=null!=e.scale?e.scale:null!=e.scaleY?e.scaleY:1,r=new n.Scale(e.scaleX,e.scaleY,e.cx,e.cy)):null!=e.skewX||null!=e.skewY?(ensureCentre(e,o),e.skewX=null!=e.skewX?e.skewX:0,e.skewY=null!=e.skewY?e.skewY:0,r=new n.Skew(e.skewX,e.skewY,e.cx,e.cy)):e.flip?("x"==e.flip||"y"==e.flip?e.offset=null==e.offset?o.bbox()["c"+e.flip]:e.offset:null==e.offset?(i=o.bbox(),e.flip=i.cx,e.offset=i.cy):e.flip=e.offset,r=(new n.Matrix).flip(e.flip,e.offset)):null==e.x&&null==e.y||(r=new n.Translate(e.x,e.y)),r?(r.relative=t,this.last().transforms.push(r),this._callStart()):this)}}),n.extend(n.Element,{untransform:function(){return this.attr("transform",null)},matrixify:function(){return(this.attr("transform")||"").split(n.regex.transforms).slice(0,-1).map(function(e){var t=e.trim().split("(");return[t[0],t[1].split(n.regex.delimiter).map(function(e){return parseFloat(e)})]}).reduce(function(e,t){return"matrix"==t[0]?e.multiply(arrayToMatrix(t[1])):e[t[0]].apply(e,t[1])},new n.Matrix)},toParent:function(e){if(this==e)return this;var t=this.screenCTM(),n=e.screenCTM().inverse();return this.addTo(e).untransform().transform(n.multiply(t)),this},toDoc:function(){return this.toParent(this.doc())}}),n.Transformation=n.invent({create:function(e,t){if(arguments.length>1&&"boolean"!=typeof t)return this.constructor.call(this,[].slice.call(arguments));if(Array.isArray(e))for(var n=0,r=this.arguments.length;n<r;++n)this[this.arguments[n]]=e[n];else if("object"==typeof e)for(n=0,r=this.arguments.length;n<r;++n)this[this.arguments[n]]=e[this.arguments[n]];this.inversed=!1,!0===t&&(this.inversed=!0)},extend:{arguments:[],method:"",at:function(e){for(var t=[],r=0,i=this.arguments.length;r<i;++r)t.push(this[this.arguments[r]]);var o=this._undo||new n.Matrix;return o=(new n.Matrix).morph(n.Matrix.prototype[this.method].apply(o,t)).at(e),this.inversed?o.inverse():o},undo:function(e){for(var t=0,r=this.arguments.length;t<r;++t)e[this.arguments[t]]=void 0===this[this.arguments[t]]?0:e[this.arguments[t]];return e.cx=this.cx,e.cy=this.cy,this._undo=new(n[capitalize(this.method)])(e,!0).at(1),this}}}),n.Translate=n.invent({parent:n.Matrix,inherit:n.Transformation,create:function(e,t){this.constructor.apply(this,[].slice.call(arguments))},extend:{arguments:["transformedX","transformedY"],method:"translate"}}),n.Rotate=n.invent({parent:n.Matrix,inherit:n.Transformation,create:function(e,t){this.constructor.apply(this,[].slice.call(arguments))},extend:{arguments:["rotation","cx","cy"],method:"rotate",at:function(e){var t=(new n.Matrix).rotate((new n.Number).morph(this.rotation-(this._undo?this._undo.rotation:0)).at(e),this.cx,this.cy);return this.inversed?t.inverse():t},undo:function(e){return this._undo=e,this}}}),n.Scale=n.invent({parent:n.Matrix,inherit:n.Transformation,create:function(e,t){this.constructor.apply(this,[].slice.call(arguments))},extend:{arguments:["scaleX","scaleY","cx","cy"],method:"scale"}}),n.Skew=n.invent({parent:n.Matrix,inherit:n.Transformation,create:function(e,t){this.constructor.apply(this,[].slice.call(arguments))},extend:{arguments:["skewX","skewY","cx","cy"],method:"skew"}}),n.extend(n.Element,{style:function(e,t){if(0==arguments.length)return this.node.style.cssText||"";if(arguments.length<2)if("object"==typeof e)for(t in e)this.style(t,e[t]);else{if(!n.regex.isCss.test(e))return this.node.style[camelCase(e)];for(e=e.split(/\s*;\s*/).filter(function(e){return!!e}).map(function(e){return e.split(/\s*:\s*/)});t=e.pop();)this.style(t[0],t[1])}else this.node.style[camelCase(e)]=null===t||n.regex.isBlank.test(t)?"":t;return this}}),n.Parent=n.invent({create:function(e){this.constructor.call(this,e)},inherit:n.Element,extend:{children:function(){return n.utils.map(n.utils.filterSVGElements(this.node.childNodes),function(e){return n.adopt(e)})},add:function(e,t){return null==t?this.node.appendChild(e.node):e.node!=this.node.childNodes[t]&&this.node.insertBefore(e.node,this.node.childNodes[t]),this},put:function(e,t){return this.add(e,t),e},has:function(e){return this.index(e)>=0},index:function(e){return[].slice.call(this.node.childNodes).indexOf(e.node)},get:function(e){return n.adopt(this.node.childNodes[e])},first:function(){return this.get(0)},last:function(){return this.get(this.node.childNodes.length-1)},each:function(e,t){var r,i,o=this.children();for(r=0,i=o.length;r<i;r++)o[r]instanceof n.Element&&e.apply(o[r],[r,o]),t&&o[r]instanceof n.Container&&o[r].each(e,t);return this},removeElement:function(e){return this.node.removeChild(e.node),this},clear:function(){for(;this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);return delete this._defs,this},defs:function(){return this.doc().defs()}}}),n.extend(n.Parent,{ungroup:function(e,t){return 0===t||this instanceof n.Defs||this.node==n.parser.draw?this:(e=e||(this instanceof n.Doc?this:this.parent(n.Parent)),t=t||1/0,this.each(function(){return this instanceof n.Defs?this:this instanceof n.Parent?this.ungroup(e,t-1):this.toParent(e)}),this.node.firstChild||this.remove(),this)},flatten:function(e,t){return this.ungroup(e,t)}}),n.Container=n.invent({create:function(e){this.constructor.call(this,e)},inherit:n.Parent}),n.ViewBox=n.invent({create:function(e){var t,r,i,o,a,s,l,u=1,c=1,h=/[+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?/gi;if(e instanceof n.Element){for(s=e,l=e,a=(e.attr("viewBox")||"").match(h),e.bbox,i=new n.Number(e.width()),o=new n.Number(e.height());"%"==i.unit;)u*=i.value,i=new n.Number(s instanceof n.Doc?s.parent().offsetWidth:s.parent().width()),s=s.parent();for(;"%"==o.unit;)c*=o.value,o=new n.Number(l instanceof n.Doc?l.parent().offsetHeight:l.parent().height()),l=l.parent();this.x=0,this.y=0,this.width=i*u,this.height=o*c,this.zoom=1,a&&(t=parseFloat(a[0]),r=parseFloat(a[1]),i=parseFloat(a[2]),o=parseFloat(a[3]),this.zoom=this.width/this.height>i/o?this.height/o:this.width/i,this.x=t,this.y=r,this.width=i,this.height=o)}else e="string"==typeof e?e.match(h).map(function(e){return parseFloat(e)}):Array.isArray(e)?e:"object"==typeof e?[e.x,e.y,e.width,e.height]:4==arguments.length?[].slice.call(arguments):[0,0,0,0],this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]},extend:{toString:function(){return this.x+" "+this.y+" "+this.width+" "+this.height},morph:function(e,t,r,i){return this.destination=new n.ViewBox(e,t,r,i),this},at:function(e){return this.destination?new n.ViewBox([this.x+(this.destination.x-this.x)*e,this.y+(this.destination.y-this.y)*e,this.width+(this.destination.width-this.width)*e,this.height+(this.destination.height-this.height)*e]):this}},parent:n.Container,construct:{viewbox:function(e,t,r,i){return 0==arguments.length?new n.ViewBox(this):this.attr("viewBox",new n.ViewBox(e,t,r,i))}}}),["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","touchstart","touchmove","touchleave","touchend","touchcancel"].forEach(function(e){n.Element.prototype[e]=function(t){return n.on(this.node,e,t),this}}),n.listeners=[],n.handlerMap=[],n.listenerId=0,n.on=function(e,t,r,i,o){var a=r.bind(i||e.instance||e),s=(n.handlerMap.indexOf(e)+1||n.handlerMap.push(e))-1,l=t.split(".")[0],u=t.split(".")[1]||"*";n.listeners[s]=n.listeners[s]||{},n.listeners[s][l]=n.listeners[s][l]||{},n.listeners[s][l][u]=n.listeners[s][l][u]||{},r._svgjsListenerId||(r._svgjsListenerId=++n.listenerId),n.listeners[s][l][u][r._svgjsListenerId]=a,e.addEventListener(l,a,o||!1)},n.off=function(e,t,r){var i=n.handlerMap.indexOf(e),o=t&&t.split(".")[0],a=t&&t.split(".")[1],s="";if(-1!=i)if(r){if("function"==typeof r&&(r=r._svgjsListenerId),!r)return;n.listeners[i][o]&&n.listeners[i][o][a||"*"]&&(e.removeEventListener(o,n.listeners[i][o][a||"*"][r],!1),delete n.listeners[i][o][a||"*"][r])}else if(a&&o){if(n.listeners[i][o]&&n.listeners[i][o][a]){for(r in n.listeners[i][o][a])n.off(e,[o,a].join("."),r);delete n.listeners[i][o][a]}}else if(a)for(t in n.listeners[i])for(s in n.listeners[i][t])a===s&&n.off(e,[t,a].join("."));else if(o){if(n.listeners[i][o]){for(s in n.listeners[i][o])n.off(e,[o,s].join("."));delete n.listeners[i][o]}}else{for(t in n.listeners[i])n.off(e,t);delete n.listeners[i],delete n.handlerMap[i]}},n.extend(n.Element,{on:function(e,t,r,i){return n.on(this.node,e,t,r,i),this},off:function(e,t){return n.off(this.node,e,t),this},fire:function(t,n){return t instanceof e.Event?this.node.dispatchEvent(t):this.node.dispatchEvent(t=new e.CustomEvent(t,{detail:n,cancelable:!0})),this._event=t,this},event:function(){return this._event}}),n.Defs=n.invent({create:"defs",inherit:n.Container}),n.G=n.invent({create:"g",inherit:n.Container,extend:{x:function(e){return null==e?this.transform("x"):this.transform({x:e-this.x()},!0)},y:function(e){return null==e?this.transform("y"):this.transform({y:e-this.y()},!0)},cx:function(e){return null==e?this.gbox().cx:this.x(e-this.gbox().width/2)},cy:function(e){return null==e?this.gbox().cy:this.y(e-this.gbox().height/2)},gbox:function(){var e=this.bbox(),t=this.transform();return e.x+=t.x,e.x2+=t.x,e.cx+=t.x,e.y+=t.y,e.y2+=t.y,e.cy+=t.y,e}},construct:{group:function(){return this.put(new n.G)}}}),n.extend(n.Element,{siblings:function(){return this.parent().children()},position:function(){return this.parent().index(this)},next:function(){return this.siblings()[this.position()+1]},previous:function(){return this.siblings()[this.position()-1]},forward:function(){var e=this.position()+1,t=this.parent();return t.removeElement(this).add(this,e),t instanceof n.Doc&&t.node.appendChild(t.defs().node),this},backward:function(){var e=this.position();return e>0&&this.parent().removeElement(this).add(this,e-1),this},front:function(){var e=this.parent();return e.node.appendChild(this.node),e instanceof n.Doc&&e.node.appendChild(e.defs().node),this},back:function(){return this.position()>0&&this.parent().removeElement(this).add(this,0),this},before:function(e){e.remove();var t=this.position();return this.parent().add(e,t),this},after:function(e){e.remove();var t=this.position();return this.parent().add(e,t+1),this}}),n.Mask=n.invent({create:function(){this.constructor.call(this,n.create("mask")),this.targets=[]},inherit:n.Container,extend:{remove:function(){for(var e=this.targets.length-1;e>=0;e--)this.targets[e]&&this.targets[e].unmask();return this.targets=[],this.parent().removeElement(this),this}},construct:{mask:function(){return this.defs().put(new n.Mask)}}}),n.extend(n.Element,{maskWith:function(e){return this.masker=e instanceof n.Mask?e:this.parent().mask().add(e),this.masker.targets.push(this),this.attr("mask",'url("#'+this.masker.attr("id")+'")')},unmask:function(){return delete this.masker,this.attr("mask",null)}}),n.ClipPath=n.invent({create:function(){this.constructor.call(this,n.create("clipPath")),this.targets=[]},inherit:n.Container,extend:{remove:function(){for(var e=this.targets.length-1;e>=0;e--)this.targets[e]&&this.targets[e].unclip();return this.targets=[],this.parent().removeElement(this),this}},construct:{clip:function(){return this.defs().put(new n.ClipPath)}}}),n.extend(n.Element,{clipWith:function(e){return this.clipper=e instanceof n.ClipPath?e:this.parent().clip().add(e),this.clipper.targets.push(this),this.attr("clip-path",'url("#'+this.clipper.attr("id")+'")')},unclip:function(){return delete this.clipper,this.attr("clip-path",null)}}),n.Gradient=n.invent({create:function(e){this.constructor.call(this,n.create(e+"Gradient")),this.type=e},inherit:n.Container,extend:{at:function(e,t,r){return this.put(new n.Stop).update(e,t,r)},update:function(e){return this.clear(),"function"==typeof e&&e.call(this,this),this},fill:function(){return"url(#"+this.id()+")"},toString:function(){return this.fill()},attr:function(e,t,r){return"transform"==e&&(e="gradientTransform"),n.Container.prototype.attr.call(this,e,t,r)}},construct:{gradient:function(e,t){return this.defs().gradient(e,t)}}}),n.extend(n.Gradient,n.FX,{from:function(e,t){return"radial"==(this._target||this).type?this.attr({fx:new n.Number(e),fy:new n.Number(t)}):this.attr({x1:new n.Number(e),y1:new n.Number(t)})},to:function(e,t){return"radial"==(this._target||this).type?this.attr({cx:new n.Number(e),cy:new n.Number(t)}):this.attr({x2:new n.Number(e),y2:new n.Number(t)})}}),n.extend(n.Defs,{gradient:function(e,t){return this.put(new n.Gradient(e)).update(t)}}),n.Stop=n.invent({create:"stop",inherit:n.Element,extend:{update:function(e){return("number"==typeof e||e instanceof n.Number)&&(e={offset:arguments[0],color:arguments[1],opacity:arguments[2]}),null!=e.opacity&&this.attr("stop-opacity",e.opacity),null!=e.color&&this.attr("stop-color",e.color),null!=e.offset&&this.attr("offset",new n.Number(e.offset)),this}}}),n.Pattern=n.invent({create:"pattern",inherit:n.Container,extend:{fill:function(){return"url(#"+this.id()+")"},update:function(e){return this.clear(),"function"==typeof e&&e.call(this,this),this},toString:function(){return this.fill()},attr:function(e,t,r){return"transform"==e&&(e="patternTransform"),n.Container.prototype.attr.call(this,e,t,r)}},construct:{pattern:function(e,t,n){return this.defs().pattern(e,t,n)}}}),n.extend(n.Defs,{pattern:function(e,t,r){return this.put(new n.Pattern).update(r).attr({x:0,y:0,width:e,height:t,patternUnits:"userSpaceOnUse"})}}),n.Doc=n.invent({create:function(e){e&&("svg"==(e="string"==typeof e?t.getElementById(e):e).nodeName?this.constructor.call(this,e):(this.constructor.call(this,n.create("svg")),e.appendChild(this.node),this.size("100%","100%")),this.namespace().defs())},inherit:n.Container,extend:{namespace:function(){return this.attr({xmlns:n.ns,version:"1.1"}).attr("xmlns:xlink",n.xlink,n.xmlns).attr("xmlns:svgjs",n.svgjs,n.xmlns)},defs:function(){var e;this._defs||((e=this.node.getElementsByTagName("defs")[0])?this._defs=n.adopt(e):this._defs=new n.Defs,this.node.appendChild(this._defs.node));return this._defs},parent:function(){return"#document"==this.node.parentNode.nodeName?null:this.node.parentNode},spof:function(e){var t=this.node.getScreenCTM();return t&&this.style("left",-t.e%1+"px").style("top",-t.f%1+"px"),this},remove:function(){return this.parent()&&this.parent().removeChild(this.node),this},clear:function(){for(;this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);return delete this._defs,n.parser.draw.parentNode||this.node.appendChild(n.parser.draw),this}}}),n.Shape=n.invent({create:function(e){this.constructor.call(this,e)},inherit:n.Element}),n.Bare=n.invent({create:function(e,t){if(this.constructor.call(this,n.create(e)),t)for(var r in t.prototype)"function"==typeof t.prototype[r]&&(this[r]=t.prototype[r])},inherit:n.Element,extend:{words:function(e){for(;this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);return this.node.appendChild(t.createTextNode(e)),this}}}),n.extend(n.Parent,{element:function(e,t){return this.put(new n.Bare(e,t))}}),n.Symbol=n.invent({create:"symbol",inherit:n.Container,construct:{symbol:function(){return this.put(new n.Symbol)}}}),n.Use=n.invent({create:"use",inherit:n.Shape,extend:{element:function(e,t){return this.attr("href",(t||"")+"#"+e,n.xlink)}},construct:{use:function(e,t){return this.put(new n.Use).element(e,t)}}}),n.Rect=n.invent({create:"rect",inherit:n.Shape,construct:{rect:function(e,t){return this.put(new n.Rect).size(e,t)}}}),n.Circle=n.invent({create:"circle",inherit:n.Shape,construct:{circle:function(e){return this.put(new n.Circle).rx(new n.Number(e).divide(2)).move(0,0)}}}),n.extend(n.Circle,n.FX,{rx:function(e){return this.attr("r",e)},ry:function(e){return this.rx(e)}}),n.Ellipse=n.invent({create:"ellipse",inherit:n.Shape,construct:{ellipse:function(e,t){return this.put(new n.Ellipse).size(e,t).move(0,0)}}}),n.extend(n.Ellipse,n.Rect,n.FX,{rx:function(e){return this.attr("rx",e)},ry:function(e){return this.attr("ry",e)}}),n.extend(n.Circle,n.Ellipse,{x:function(e){return null==e?this.cx()-this.rx():this.cx(e+this.rx())},y:function(e){return null==e?this.cy()-this.ry():this.cy(e+this.ry())},cx:function(e){return null==e?this.attr("cx"):this.attr("cx",e)},cy:function(e){return null==e?this.attr("cy"):this.attr("cy",e)},width:function(e){return null==e?2*this.rx():this.rx(new n.Number(e).divide(2))},height:function(e){return null==e?2*this.ry():this.ry(new n.Number(e).divide(2))},size:function(e,t){var r=proportionalSize(this,e,t);return this.rx(new n.Number(r.width).divide(2)).ry(new n.Number(r.height).divide(2))}}),n.Line=n.invent({create:"line",inherit:n.Shape,extend:{array:function(){return new n.PointArray([[this.attr("x1"),this.attr("y1")],[this.attr("x2"),this.attr("y2")]])},plot:function(e,t,r,i){return null==e?this.array():(e=void 0!==t?{x1:e,y1:t,x2:r,y2:i}:new n.PointArray(e).toLine(),this.attr(e))},move:function(e,t){return this.attr(this.array().move(e,t).toLine())},size:function(e,t){var n=proportionalSize(this,e,t);return this.attr(this.array().size(n.width,n.height).toLine())}},construct:{line:function(e,t,r,i){return n.Line.prototype.plot.apply(this.put(new n.Line),null!=e?[e,t,r,i]:[0,0,0,0])}}}),n.Polyline=n.invent({create:"polyline",inherit:n.Shape,construct:{polyline:function(e){return this.put(new n.Polyline).plot(e||new n.PointArray)}}}),n.Polygon=n.invent({create:"polygon",inherit:n.Shape,construct:{polygon:function(e){return this.put(new n.Polygon).plot(e||new n.PointArray)}}}),n.extend(n.Polyline,n.Polygon,{array:function(){return this._array||(this._array=new n.PointArray(this.attr("points")))},plot:function(e){return null==e?this.array():this.clear().attr("points","string"==typeof e?e:this._array=new n.PointArray(e))},clear:function(){return delete this._array,this},move:function(e,t){return this.attr("points",this.array().move(e,t))},size:function(e,t){var n=proportionalSize(this,e,t);return this.attr("points",this.array().size(n.width,n.height))}}),n.extend(n.Line,n.Polyline,n.Polygon,{morphArray:n.PointArray,x:function(e){return null==e?this.bbox().x:this.move(e,this.bbox().y)},y:function(e){return null==e?this.bbox().y:this.move(this.bbox().x,e)},width:function(e){var t=this.bbox();return null==e?t.width:this.size(e,t.height)},height:function(e){var t=this.bbox();return null==e?t.height:this.size(t.width,e)}}),n.Path=n.invent({create:"path",inherit:n.Shape,extend:{morphArray:n.PathArray,array:function(){return this._array||(this._array=new n.PathArray(this.attr("d")))},plot:function(e){return null==e?this.array():this.clear().attr("d","string"==typeof e?e:this._array=new n.PathArray(e))},clear:function(){return delete this._array,this},move:function(e,t){return this.attr("d",this.array().move(e,t))},x:function(e){return null==e?this.bbox().x:this.move(e,this.bbox().y)},y:function(e){return null==e?this.bbox().y:this.move(this.bbox().x,e)},size:function(e,t){var n=proportionalSize(this,e,t);return this.attr("d",this.array().size(n.width,n.height))},width:function(e){return null==e?this.bbox().width:this.size(e,this.bbox().height)},height:function(e){return null==e?this.bbox().height:this.size(this.bbox().width,e)}},construct:{path:function(e){return this.put(new n.Path).plot(e||new n.PathArray)}}}),n.Image=n.invent({create:"image",inherit:n.Shape,extend:{load:function(t){if(!t)return this;var r=this,i=new e.Image;return n.on(i,"load",function(){var e=r.parent(n.Pattern);null!==e&&(0==r.width()&&0==r.height()&&r.size(i.width,i.height),e&&0==e.width()&&0==e.height()&&e.size(r.width(),r.height()),"function"==typeof r._loaded&&r._loaded.call(r,{width:i.width,height:i.height,ratio:i.width/i.height,url:t}))}),n.on(i,"error",function(e){"function"==typeof r._error&&r._error.call(r,e)}),this.attr("href",i.src=this.src=t,n.xlink)},loaded:function(e){return this._loaded=e,this},error:function(e){return this._error=e,this}},construct:{image:function(e,t,r){return this.put(new n.Image).load(e).size(t||0,r||t||0)}}}),n.Text=n.invent({create:function(){this.constructor.call(this,n.create("text")),this.dom.leading=new n.Number(1.3),this._rebuild=!0,this._build=!1,this.attr("font-family",n.defaults.attrs["font-family"])},inherit:n.Shape,extend:{x:function(e){return null==e?this.attr("x"):this.attr("x",e)},y:function(e){var t=this.attr("y"),n="number"==typeof t?t-this.bbox().y:0;return null==e?"number"==typeof t?t-n:t:this.attr("y","number"==typeof e?e+n:e)},cx:function(e){return null==e?this.bbox().cx:this.x(e-this.bbox().width/2)},cy:function(e){return null==e?this.bbox().cy:this.y(e-this.bbox().height/2)},text:function(e){if(void 0===e){e="";for(var t=this.node.childNodes,r=0,i=t.length;r<i;++r)0!=r&&3!=t[r].nodeType&&1==n.adopt(t[r]).dom.newLined&&(e+="\n"),e+=t[r].textContent;return e}if(this.clear().build(!0),"function"==typeof e)e.call(this,this);else{r=0;for(var o=(e=e.split("\n")).length;r<o;r++)this.tspan(e[r]).newLine()}return this.build(!1).rebuild()},size:function(e){return this.attr("font-size",e).rebuild()},leading:function(e){return null==e?this.dom.leading:(this.dom.leading=new n.Number(e),this.rebuild())},lines:function(){var e=(this.textPath&&this.textPath()||this).node,t=n.utils.map(n.utils.filterSVGElements(e.childNodes),function(e){return n.adopt(e)});return new n.Set(t)},rebuild:function(e){if("boolean"==typeof e&&(this._rebuild=e),this._rebuild){var t=this,r=0,i=this.dom.leading*new n.Number(this.attr("font-size"));this.lines().each(function(){this.dom.newLined&&(t.textPath()||this.attr("x",t.attr("x")),"\n"==this.text()?r+=i:(this.attr("dy",i+r),r=0))}),this.fire("rebuild")}return this},build:function(e){return this._build=!!e,this},setData:function(e){return this.dom=e,this.dom.leading=new n.Number(e.leading||1.3),this}},construct:{text:function(e){return this.put(new n.Text).text(e)},plain:function(e){return this.put(new n.Text).plain(e)}}}),n.Tspan=n.invent({create:"tspan",inherit:n.Shape,extend:{text:function(e){return null==e?this.node.textContent+(this.dom.newLined?"\n":""):("function"==typeof e?e.call(this,this):this.plain(e),this)},dx:function(e){return this.attr("dx",e)},dy:function(e){return this.attr("dy",e)},newLine:function(){var e=this.parent(n.Text);return this.dom.newLined=!0,this.dy(e.dom.leading*e.attr("font-size")).attr("x",e.x())}}}),n.extend(n.Text,n.Tspan,{plain:function(e){return!1===this._build&&this.clear(),this.node.appendChild(t.createTextNode(e)),this},tspan:function(e){var t=(this.textPath&&this.textPath()||this).node,r=new n.Tspan;return!1===this._build&&this.clear(),t.appendChild(r.node),r.text(e)},clear:function(){for(var e=(this.textPath&&this.textPath()||this).node;e.hasChildNodes();)e.removeChild(e.lastChild);return this},length:function(){return this.node.getComputedTextLength()}}),n.TextPath=n.invent({create:"textPath",inherit:n.Parent,parent:n.Text,construct:{morphArray:n.PathArray,path:function(e){for(var t=new n.TextPath,r=this.doc().defs().path(e);this.node.hasChildNodes();)t.node.appendChild(this.node.firstChild);return this.node.appendChild(t.node),t.attr("href","#"+r,n.xlink),this},array:function(){var e=this.track();return e?e.array():null},plot:function(e){var t=this.track(),n=null;return t&&(n=t.plot(e)),null==e?n:this},track:function(){var e=this.textPath();if(e)return e.reference("href")},textPath:function(){if(this.node.firstChild&&"textPath"==this.node.firstChild.nodeName)return n.adopt(this.node.firstChild)}}}),n.Nested=n.invent({create:function(){this.constructor.call(this,n.create("svg")),this.style("overflow","visible")},inherit:n.Container,construct:{nested:function(){return this.put(new n.Nested)}}}),n.A=n.invent({create:"a",inherit:n.Container,extend:{to:function(e){return this.attr("href",e,n.xlink)},show:function(e){return this.attr("show",e,n.xlink)},target:function(e){return this.attr("target",e)}},construct:{link:function(e){return this.put(new n.A).to(e)}}}),n.extend(n.Element,{linkTo:function(e){var t=new n.A;return"function"==typeof e?e.call(t,t):t.to(e),this.parent().put(t).put(this)}}),n.Marker=n.invent({create:"marker",inherit:n.Container,extend:{width:function(e){return this.attr("markerWidth",e)},height:function(e){return this.attr("markerHeight",e)},ref:function(e,t){return this.attr("refX",e).attr("refY",t)},update:function(e){return this.clear(),"function"==typeof e&&e.call(this,this),this},toString:function(){return"url(#"+this.id()+")"}},construct:{marker:function(e,t,n){return this.defs().marker(e,t,n)}}}),n.extend(n.Defs,{marker:function(e,t,r){return this.put(new n.Marker).size(e,t).ref(e/2,t/2).viewbox(0,0,e,t).attr("orient","auto").update(r)}}),n.extend(n.Line,n.Polyline,n.Polygon,n.Path,{marker:function(e,t,r,i){var o=["marker"];return"all"!=e&&o.push(e),o=o.join("-"),e=arguments[1]instanceof n.Marker?arguments[1]:this.doc().marker(t,r,i),this.attr(o,e)}});var s={stroke:["color","width","opacity","linecap","linejoin","miterlimit","dasharray","dashoffset"],fill:["color","opacity","rule"],prefix:function(e,t){return"color"==t?e:e+"-"+t}};function pathRegReplace(e,t,r,i){return r+i.replace(n.regex.dots," .")}function camelCase(e){return e.toLowerCase().replace(/-(.)/g,function(e,t){return t.toUpperCase()})}function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function compToHex(e){var t=e.toString(16);return 1==t.length?"0"+t:t}function proportionalSize(e,t,n){if(null==t||null==n){var r=e.bbox();null==t?t=r.width/r.height*n:null==n&&(n=r.height/r.width*t)}return{width:t,height:n}}function deltaTransformPoint(e,t,n){return{x:t*e.a+n*e.c+0,y:t*e.b+n*e.d+0}}function arrayToMatrix(e){return{a:e[0],b:e[1],c:e[2],d:e[3],e:e[4],f:e[5]}}function ensureCentre(e,t){e.cx=null==e.cx?t.bbox().cx:e.cx,e.cy=null==e.cy?t.bbox().cy:e.cy}function fullBox(e){return null==e.x&&(e.x=0,e.y=0,e.width=0,e.height=0),e.w=e.width,e.h=e.height,e.x2=e.x+e.width,e.y2=e.y+e.height,e.cx=e.x+e.width/2,e.cy=e.y+e.height/2,e}["fill","stroke"].forEach(function(e){var t,r={};r[e]=function(r){if(void 0===r)return this;if("string"==typeof r||n.Color.isRgb(r)||r&&"function"==typeof r.fill)this.attr(e,r);else for(t=s[e].length-1;t>=0;t--)null!=r[s[e][t]]&&this.attr(s.prefix(e,s[e][t]),r[s[e][t]]);return this},n.extend(n.Element,n.FX,r)}),n.extend(n.Element,n.FX,{rotate:function(e,t,n){return this.transform({rotation:e,cx:t,cy:n})},skew:function(e,t,n,r){return 1==arguments.length||3==arguments.length?this.transform({skew:e,cx:t,cy:n}):this.transform({skewX:e,skewY:t,cx:n,cy:r})},scale:function(e,t,n,r){return 1==arguments.length||3==arguments.length?this.transform({scale:e,cx:t,cy:n}):this.transform({scaleX:e,scaleY:t,cx:n,cy:r})},translate:function(e,t){return this.transform({x:e,y:t})},flip:function(e,t){return t="number"==typeof e?e:t,this.transform({flip:e||"both",offset:t})},matrix:function(e){return this.attr("transform",new n.Matrix(6==arguments.length?[].slice.call(arguments):e))},opacity:function(e){return this.attr("opacity",e)},dx:function(e){return this.x(new n.Number(e).plus(this instanceof n.FX?0:this.x()),!0)},dy:function(e){return this.y(new n.Number(e).plus(this instanceof n.FX?0:this.y()),!0)},dmove:function(e,t){return this.dx(e).dy(t)}}),n.extend(n.Rect,n.Ellipse,n.Circle,n.Gradient,n.FX,{radius:function(e,t){var r=(this._target||this).type;return"radial"==r||"circle"==r?this.attr("r",new n.Number(e)):this.rx(e).ry(null==t?e:t)}}),n.extend(n.Path,{length:function(){return this.node.getTotalLength()},pointAt:function(e){return this.node.getPointAtLength(e)}}),n.extend(n.Parent,n.Text,n.Tspan,n.FX,{font:function(e,t){if("object"==typeof e)for(t in e)this.font(t,e[t]);return"leading"==e?this.leading(t):"anchor"==e?this.attr("text-anchor",t):"size"==e||"family"==e||"weight"==e||"stretch"==e||"variant"==e||"style"==e?this.attr("font-"+e,t):this.attr(e,t)}}),n.Set=n.invent({create:function(e){Array.isArray(e)?this.members=e:this.clear()},extend:{add:function(){var e,t,n=[].slice.call(arguments);for(e=0,t=n.length;e<t;e++)this.members.push(n[e]);return this},remove:function(e){var t=this.index(e);return t>-1&&this.members.splice(t,1),this},each:function(e){for(var t=0,n=this.members.length;t<n;t++)e.apply(this.members[t],[t,this.members]);return this},clear:function(){return this.members=[],this},length:function(){return this.members.length},has:function(e){return this.index(e)>=0},index:function(e){return this.members.indexOf(e)},get:function(e){return this.members[e]},first:function(){return this.get(0)},last:function(){return this.get(this.members.length-1)},valueOf:function(){return this.members},bbox:function(){if(0==this.members.length)return new n.RBox;var e=this.members[0].rbox(this.members[0].doc());return this.each(function(){e=e.merge(this.rbox(this.doc()))}),e}},construct:{set:function(e){return new n.Set(e)}}}),n.FX.Set=n.invent({create:function(e){this.set=e}}),n.Set.inherit=function(){var e=[];for(var t in n.Shape.prototype)"function"==typeof n.Shape.prototype[t]&&"function"!=typeof n.Set.prototype[t]&&e.push(t);for(var t in e.forEach(function(e){n.Set.prototype[e]=function(){for(var t=0,r=this.members.length;t<r;t++)this.members[t]&&"function"==typeof this.members[t][e]&&this.members[t][e].apply(this.members[t],arguments);return"animate"==e?this.fx||(this.fx=new n.FX.Set(this)):this}}),e=[],n.FX.prototype)"function"==typeof n.FX.prototype[t]&&"function"!=typeof n.FX.Set.prototype[t]&&e.push(t);e.forEach(function(e){n.FX.Set.prototype[e]=function(){for(var t=0,n=this.set.members.length;t<n;t++)this.set.members[t].fx[e].apply(this.set.members[t].fx,arguments);return this}})},n.extend(n.Element,{data:function(e,t,n){if("object"==typeof e)for(t in e)this.data(t,e[t]);else if(arguments.length<2)try{return JSON.parse(this.attr("data-"+e))}catch(t){return this.attr("data-"+e)}else this.attr("data-"+e,null===t?null:!0===n||"string"==typeof t||"number"==typeof t?t:JSON.stringify(t));return this}}),n.extend(n.Element,{remember:function(e,t){if("object"==typeof arguments[0])for(var t in e)this.remember(t,e[t]);else{if(1==arguments.length)return this.memory()[e];this.memory()[e]=t}return this},forget:function(){if(0==arguments.length)this._memory={};else for(var e=arguments.length-1;e>=0;e--)delete this.memory()[arguments[e]];return this},memory:function(){return this._memory||(this._memory={})}}),n.get=function(e){var r=t.getElementById(function idFromReference(e){var t=e.toString().match(n.regex.reference);if(t)return t[1]}(e)||e);return n.adopt(r)},n.select=function(e,r){return new n.Set(n.utils.map((r||t).querySelectorAll(e),function(e){return n.adopt(e)}))},n.extend(n.Parent,{select:function(e){return n.select(e,this.node)}});var l="abcdef".split("");if("function"!=typeof e.CustomEvent){var u=function(e,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var r=t.createEvent("CustomEvent");return r.initCustomEvent(e,n.bubbles,n.cancelable,n.detail),r};u.prototype=e.Event.prototype,e.CustomEvent=u}return function(t){for(var n=0,r=["moz","webkit"],i=0;i<r.length&&!e.requestAnimationFrame;++i)t.requestAnimationFrame=t[r[i]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[r[i]+"CancelAnimationFrame"]||t[r[i]+"CancelRequestAnimationFrame"];t.requestAnimationFrame=t.requestAnimationFrame||function(e){var r=(new Date).getTime(),i=Math.max(0,16-(r-n)),o=t.setTimeout(function(){e(r+i)},i);return n=r+i,o},t.cancelAnimationFrame=t.cancelAnimationFrame||t.clearTimeout}(e),n},"function"==typeof define&&define.amd?define(function(){return t(e,e.document)}):"object"==typeof exports?module.exports=e.document?t(e,e.document):function(e){return t(e,e.document)}:e.SVG=t(e,e.document);var n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;System.global._classRecorder={},this.lively=this.lively||{},function(e,t,n,r,i,o,a,s,l,u,c,h,d,p,f,y,m,g,v,x,b,w,_,k,S,M,C,P,T,A,L){"use strict";n="default"in n?n.default:n;var R="default"in o?o.default:o;d="default"in d?d.default:d;var E="default"in _?_.default:_;"undefined"!=typeof $world&&$world.withAllSubmorphsDo(function(e){return e.hasOwnProperty("_cachedKeyhandlers")&&(e._cachedKeyhandlers=null)});var z={onloadURLQuery:function parseURLQuery(){if("undefined"==typeof document||!document.location)return{};var e=(document.location.hash||document.location.search).slice(1),t=e&&e.split("&"),n={};if(t)for(var r=0;r<t.length;r++){var i=t[r].split("="),o=i[0],a=!0;if(i.length>1&&(a=decodeURIComponent(i.slice(1).join("="))).match(/^(true|false|null|[0-9"[{].*)$/))try{a=JSON.parse(a)}catch(e){"["===a[0]&&(a=a.slice(1,-1).split(","))}n[o]=a}return n}(),defaultShadow:{fast:!0,distance:18,blur:30,color:t.Color.black.withA(.2),spread:0},undoLevels:20,halosEnabled:!0,altClickDefinesThat:!0,verboseLogging:!0,maxStatusMessages:5,repeatClickInterval:250,longClick:{minDur:500,maxDur:1e3,maxDist:2},showTooltipsAfter:.8,users:{authServerURL:"https://auth.lively-next.org",autoLoginAsGuest:!1},ide:{workerEnabled:!1,js:{ignoredPackages:["lively.web","no group",function(e){return e.includes("lively.morphic/objectdb")||e.includes("lively.next-node_modules")||e.includes("node_modules")||e.includes("custom-npm-modules")||e.includes("mocha-es6")||e.includes("test-resources/es6")}]},modes:{aliases:{sh:"shell",markdown:"md",javascript:"js",htmlmixed:"html",haskell:"hs",python:"py"}}},globalKeyBindings:[{keys:{mac:"Meta-Z",win:"Ctrl-Z"},command:"undo"},{keys:{mac:"Meta-Shift-Z",win:"Ctrl-Shift-Z"},command:"redo"},{keys:"Alt-X",command:"run command"},{keys:{mac:"Meta-S",win:"Ctrl-S"},command:"save world"},{keys:"Meta-Shift-L s a v e",command:"save this world"},{keys:"Meta-H",command:"show halo for focused morph"},{keys:"Meta-Shift-L C O P Y",command:"copy morph"},{keys:"Alt-M",command:"select morph"},{keys:"Escape",command:"escape"},{keys:{win:"Ctrl-Escape",mac:"Meta-Escape"},command:"close active window or morph"},{keys:"Alt-Shift-C",command:"toggle minimize active window"},{keys:{mac:"Meta-Shift-L W S",win:"Ctrl-Shift-L W S"},command:"search workspaces"},{keys:{mac:"Meta-O",win:"Ctrl-O"},command:"open status message of focused morph"},{keys:{win:"Ctrl-K",mac:"Meta-K"},command:{command:"open workspace",onlyWhenFocused:!1,args:{askForMode:!0}}},{keys:"Alt-Shift-1",command:{command:"open shell terminal",onlyWhenFocused:!1}},{keys:{win:"Ctrl-B",mac:"Meta-B"},command:{command:"open browser",onlyWhenFocused:!1}},{keys:{win:"Ctrl-P",mac:"Meta-P"},command:{command:"open PartsBin",onlyWhenFocused:!0}},{keys:"Alt-T",command:{command:"choose and browse module",onlyWhenFocused:!1}},{keys:"Alt-Shift-T",command:{command:"choose and browse package resources",onlyWhenFocused:!1}},{keys:"Ctrl-X D",command:"open file browser"},{keys:"Ctrl-X Ctrl-F",command:"open file"},{keys:{win:"Ctrl-Shift-F",mac:"Meta-Shift-F"},command:{command:"open code search",onlyWhenFocused:!1}},{keys:"Left",command:{command:"move or resize halo target",args:{what:"move",direction:"left",offset:1}}},{keys:"Right",command:{command:"move or resize halo target",args:{what:"move",direction:"right",offset:1}}},{keys:"Up",command:{command:"move or resize halo target",args:{what:"move",direction:"up",offset:1}}},{keys:"Down",command:{command:"move or resize halo target",args:{what:"move",direction:"down",offset:1}}},{keys:"Meta-Left",command:{command:"move or resize halo target",args:{what:"move",direction:"left",offset:10}}},{keys:"Meta-Right",command:{command:"move or resize halo target",args:{what:"move",direction:"right",offset:10}}},{keys:"Meta-Up",command:{command:"move or resize halo target",args:{what:"move",direction:"up",offset:10}}},{keys:"Meta-Down",command:{command:"move or resize halo target",args:{what:"move",direction:"down",offset:10}}},{keys:"Alt-Left",command:{command:"move or resize halo target",args:{what:"move",direction:"left",offset:100}}},{keys:"Alt-Right",command:{command:"move or resize halo target",args:{what:"move",direction:"right",offset:100}}},{keys:"Alt-Up",command:{command:"move or resize halo target",args:{what:"move",direction:"up",offset:100}}},{keys:"Alt-Down",command:{command:"move or resize halo target",args:{what:"move",direction:"down",offset:100}}},{keys:"Shift-Left",command:{command:"move or resize halo target",args:{what:"resize",direction:"left",offset:1}}},{keys:"Shift-Right",command:{command:"move or resize halo target",args:{what:"resize",direction:"right",offset:1}}},{keys:"Shift-Up",command:{command:"move or resize halo target",args:{what:"resize",direction:"up",offset:1}}},{keys:"Shift-Down",command:{command:"move or resize halo target",args:{what:"resize",direction:"down",offset:1}}},{keys:"Meta-Shift-Left",command:{command:"move or resize halo target",args:{what:"resize",direction:"left",offset:10}}},{keys:"Meta-Shift-Right",command:{command:"move or resize halo target",args:{what:"resize",direction:"right",offset:10}}},{keys:"Meta-Shift-Up",command:{command:"move or resize halo target",args:{what:"resize",direction:"up",offset:10}}},{keys:"Meta-Shift-Down",command:{command:"move or resize halo target",args:{what:"resize",direction:"down",offset:10}}},{keys:"Alt-Shift-Left",command:{command:"move or resize halo target",args:{what:"resize",direction:"left",offset:100}}},{keys:"Alt-Shift-Right",command:{command:"move or resize halo target",args:{what:"resize",direction:"right",offset:100}}},{keys:"Alt-Shift-Up",command:{command:"move or resize halo target",args:{what:"resize",direction:"up",offset:100}}},{keys:"Alt-Shift-Down",command:{command:"move or resize halo target",args:{what:"resize",direction:"down",offset:100}}},{keys:{win:"Ctrl-`|Alt-`",mac:"Meta-1"},command:"window switcher"},{keys:{mac:"Meta-Shift-L R E S 1",win:"Ctrl-Shift-L R E S 1"},command:{command:"resize active window",args:{how:"col1"}}},{keys:{mac:"Meta-Shift-L R E S 2",win:"Ctrl-Shift-L R E S 2"},command:{command:"resize active window",args:{how:"col2"}}},{keys:{mac:"Meta-Shift-L R E S 3",win:"Ctrl-Shift-L R E S 3"},command:{command:"resize active window",args:{how:"col3"}}},{keys:{mac:"Meta-Shift-L R E S 4",win:"Ctrl-Shift-L R E S 4"},command:{command:"resize active window",args:{how:"col4"}}},{keys:{mac:"Meta-Shift-L R E S 5",win:"Ctrl-Shift-L R E S 5"},command:{command:"resize active window",args:{how:"col5"}}},{keys:{mac:"Meta-Shift-L R E S Alt-1",win:"Ctrl-Shift-L R E S Alt-1"},command:{command:"resize active window",args:{how:"quadrant1"}}},{keys:{mac:"Meta-Shift-L R E S Alt-2",win:"Ctrl-Shift-L R E S Alt-2"},command:{command:"resize active window",args:{how:"quadrant2"}}},{keys:{mac:"Meta-Shift-L R E S Alt-3",win:"Ctrl-Shift-L R E S Alt-3"},command:{command:"resize active window",args:{how:"quadrant3"}}},{keys:{mac:"Meta-Shift-L R E S Alt-4",win:"Ctrl-Shift-L R E S Alt-4"},command:{command:"resize active window",args:{how:"quadrant4"}}},{keys:{mac:"Meta-Shift-L R E S Alt-5",win:"Ctrl-Shift-L R E S Alt-5"},command:{command:"resize active window",args:{how:"quadrant5"}}},{keys:{mac:"Meta-Shift-L R E S Alt-6",win:"Ctrl-Shift-L R E S Alt-6"},command:{command:"resize active window",args:{how:"quadrant6"}}},{keys:{mac:"Meta-Shift-L R E S Alt-7",win:"Ctrl-Shift-L R E S Alt-7"},command:{command:"resize active window",args:{how:"quadrant7"}}},{keys:{mac:"Meta-Shift-L R E S Alt-8",win:"Ctrl-Shift-L R E S Alt-8"},command:{command:"resize active window",args:{how:"quadrant8"}}},{keys:{mac:"Meta-Shift-L R E S Alt-9",win:"Ctrl-Shift-L R E S Alt-9"},command:{command:"resize active window",args:{how:"quadrant9"}}},{keys:{mac:"Meta-Shift-L R E S Alt-0",win:"Ctrl-Shift-L R E S Alt-0"},command:{command:"resize active window",args:{how:"quadrant0"}}},{keys:{mac:"Meta-Shift-L R E S C",win:"Ctrl-Shift-L R E S C"},command:{command:"resize active window",args:{how:"center"}}},{keys:{mac:"Meta-Shift-L R E S L",win:"Ctrl-Shift-L R E S L"},command:{command:"resize active window",args:{how:"left"}}},{keys:{mac:"Meta-Shift-L R E S R",win:"Ctrl-Shift-L R E S R"},command:{command:"resize active window",args:{how:"right"}}},{keys:{mac:"Meta-Shift-L R E S F",win:"Ctrl-Shift-L R E S F"},command:{command:"resize active window",args:{how:"full"}}},{keys:{mac:"Meta-Shift-L R E S T",win:"Ctrl-Shift-L R E S T"},command:{command:"resize active window",args:{how:"top"}}},{keys:{mac:"Meta-Shift-L R E S H T",win:"Ctrl-Shift-L R E S H T"},command:{command:"resize active window",args:{how:"halftop"}}},{keys:{mac:"Meta-Shift-L R E S B",win:"Ctrl-Shift-L R E S B"},command:{command:"resize active window",args:{how:"bottom"}}},{keys:{mac:"Meta-Shift-L R E S H B",win:"Ctrl-Shift-L R E S H B"},command:{command:"resize active window",args:{how:"halfbottom"}}},{keys:{mac:"Meta-Shift-L R E S Escape",win:"Ctrl-Shift-L R E S Escape"},command:{command:"resize active window",args:{how:"reset"}}}],text:{basicFontItems:["Sans-serif","serif","Monospace","Arial Black","Arial Narrow","Comic Sans MS","Garamond","Tahoma","Trebuchet MS","Verdana","custom..."],cursorBlinkPeriod:.5,useSoftTabs:!0,tabWidth:2,markStackSize:16,undoLevels:50,clipboardBufferLength:100,useMultiSelect:!0,undoGroupDelay:600,defaultKeyBindings:[{keys:{mac:"Meta-C",win:"Ctrl-C"},command:{command:"clipboard copy",passEvent:!0}},{keys:"Ctrl-W",command:{command:"manual clipboard copy",args:{delete:!0}}},{keys:"Alt-W",command:"manual clipboard copy"},{keys:"Ctrl-Y",command:"manual clipboard paste"},{keys:"Alt-Y",command:{command:"manual clipboard paste",args:{killRingCycleBack:!0}}},{keys:{mac:"Meta-X",win:"Ctrl-X"},command:{command:"clipboard cut",passEvent:!0}},{keys:{mac:"Meta-V",win:"Ctrl-V"},command:{command:"clipboard paste",passEvent:!0}},{keys:{mac:"Meta-Z|Ctrl-Shift--|Ctrl-x u",win:"Ctrl-Z|Ctrl-Shift--|Ctrl-x u"},command:"text undo"},{keys:{mac:"Meta-Shift-Z",win:"Ctrl-Shift-Z"},command:"text redo"},{keys:{mac:"Meta-A|Ctrl-X H",win:"Ctrl-A|Ctrl-X H"},command:"select all"},{keys:{mac:"Meta-D",win:"Ctrl-D"},command:"doit"},{keys:{mac:"Meta-Shift-L X B"},command:"eval all"},{keys:{mac:"Meta-P",win:"Ctrl-P"},command:"printit"},{keys:{mac:"Meta-I",win:"Ctrl-I"},command:"print inspectit"},{keys:{mac:"Meta-Shift-I",win:"Ctrl-Shift-I"},command:"inspectit"},{keys:{mac:"Meta-Shift-U",win:"Ctrl-Shift-U"},command:"undefine variable"},{keys:"Backspace",command:"delete backwards"},{keys:{win:"Delete",mac:"Delete|Ctrl-D"},command:"delete"},{keys:{win:"Left",mac:"Left|Ctrl-B"},command:"go left"},{keys:{win:"Right",mac:"Right|Ctrl-F"},command:"go right"},{keys:{win:"Up",mac:"Up|Ctrl-P"},command:"go up"},{keys:{win:"Down",mac:"Down|Ctrl-N"},command:"go down"},{keys:"Shift-Left",command:"select left"},{keys:"Shift-Right",command:"select right"},{keys:"Shift-Up",command:"select up"},{keys:"Shift-Down",command:"select down"},{keys:{win:"Ctrl-Right",mac:"Alt-Right|Alt-F"},command:"goto word right"},{keys:{win:"Ctrl-Left",mac:"Alt-Left|Alt-B"},command:"goto word left"},{keys:{win:"Ctrl-Shift-Right",mac:"Alt-Shift-Right|Alt-Shift-F"},command:{command:"goto word right",args:{select:!0}}},{keys:{win:"Ctrl-Shift-Left",mac:"Alt-Shift-Left|Alt-Shift-B"},command:{command:"goto word left",args:{select:!0}}},{keys:"Alt-Backspace",command:"delete word left"},{keys:"Alt-D",command:"delete word right"},{keys:"Alt-Ctrl-K",command:"delete word right"},{keys:"Alt-Shift-2",command:"select word right"},{keys:"Ctrl-X Ctrl-X",command:"reverse selection"},{keys:{win:"Ctrl-Shift-L",mac:"Meta-L"},command:"select line"},{keys:{win:"Shift-Home",mac:"Shift-Home|Ctrl-Shift-A"},command:{command:"goto line start",args:{select:!0}}},{keys:{win:"Home",mac:"Home|Ctrl-A"},command:{command:"goto line start",args:{select:!1}}},{keys:{win:"Shift-End",mac:"Shift-End|Ctrl-Shift-E"},command:{command:"goto line end",args:{select:!0}}},{keys:{win:"End",mac:"End|Ctrl-E"},command:{command:"goto line end",args:{select:!1}}},{keys:"Ctrl-C J",command:{command:"join line",args:{withLine:"before"}}},{keys:"Ctrl-C Shift-J",command:{command:"join line",args:{withLine:"after"}}},{keys:{win:"Ctrl-Shift-D",mac:"Meta-Shift-D|Ctrl-C P"},command:"duplicate line or selection"},{keys:{win:"Ctrl-Backspace",mac:"Meta-Backspace"},command:"delete left until beginning of line"},{keys:"Ctrl-K",command:"delete emtpy line or until end of line"},{keys:{win:"Ctrl-Alt-Up|Ctrl-Alt-P",mac:"Ctrl-Meta-Up|Ctrl-Meta-P"},command:"move lines up"},{keys:{win:"Ctrl-Alt-Down|Ctrl-Alt-N",mac:"Ctrl-Meta-Down|Ctrl-Meta-N"},command:"move lines down"},{keys:{win:"PageDown",mac:"PageDown|Ctrl-V"},command:"goto page down"},{keys:{win:"PageUp",mac:"PageUp|Alt-V"},command:"goto page up"},{keys:{win:"Shift-PageDown",mac:"Shift-PageDown"},command:"goto page down and select"},{keys:{win:"Shift-PageUp",mac:"Shift-PageUp"},command:"goto page up and select"},{keys:"Alt-Ctrl-,",command:"move cursor to screen top in 1/3 steps"},{keys:"Alt-Ctrl-.",command:"move cursor to screen bottom in 1/3 steps"},{keys:{win:"Alt-Left",mac:"Meta-Left"},command:"goto matching left"},{keys:{win:"Alt-Shift-Left",mac:"Meta-Shift-Left"},command:{command:"goto matching left",args:{select:!0}}},{keys:{win:"Alt-Right",mac:"Meta-Right"},command:"goto matching right"},{keys:{win:"Alt-Shift-Right",mac:"Meta-Shift-Right"},command:{command:"goto matching right",args:{select:!0}}},{keys:"Alt-Ctrl-B",command:"goto matching left"},{keys:"Alt-Ctrl-F",command:"goto matching right"},{keys:"Ctrl-Up",command:"goto paragraph above"},{keys:"Ctrl-Down",command:"goto paragraph below"},{keys:{win:"Ctrl-Shift-Home",mac:"Meta-Shift-Up"},command:{command:"goto start",args:{select:!0}}},{keys:{win:"Ctrl-Shift-End",mac:"Meta-Shift-Down"},command:{command:"goto end",args:{select:!0}}},{keys:{win:"Ctrl-Home",mac:"Meta-Up|Meta-Home|Alt-Shift-,"},command:"goto start"},{keys:{win:"Ctrl-End",mac:"Meta-Down|Meta-End|Alt-Shift-."},command:"goto end"},{keys:"Ctrl-L",command:"realign top-bottom-center"},{keys:{win:"Ctrl-Shift-L",mac:"Ctrl-Shift-L|Alt-G G"},command:"goto line"},{keys:"Enter",command:"newline"},{keys:"Space",command:{command:"insertstring",args:{string:" ",undoGroup:!0}}},{keys:"Tab",command:{command:"tab - snippet expand or indent"}},{keys:{win:"Ctrl-]",mac:"Meta-]"},command:"indent"},{keys:{win:"Ctrl-[",mac:"Meta-["},command:"outdent"},{keys:{win:"Ctrl-Enter",mac:"Meta-Enter"},command:{command:"insert line",args:{where:"below"}}},{keys:"Shift-Enter",command:{command:"insert line",args:{where:"above"}}},{keys:"Ctrl-O",command:"split line"},{keys:{mac:"Ctrl-X Ctrl-T"},command:"transpose chars"},{keys:{mac:"Ctrl-C Ctrl-U"},command:"uppercase"},{keys:{mac:"Ctrl-C Ctrl-L"},command:"lowercase"},{keys:{mac:"Meta-Shift-L W t"},command:"remove trailing whitespace"},{keys:{mac:"Ctrl-Space"},command:"toggle active mark"},{keys:{mac:"Meta-Shift-L M O D E"},command:"change editor mode"},{keys:{mac:"Meta-Shift-L L T"},command:"toggle line wrapping"},{keys:"Esc|Ctrl-G",command:"cancel input"},{keys:{win:"Ctrl-/",mac:"Meta-/"},command:"toggle comment"},{keys:{win:"Alt-Ctrl-/",mac:"Alt-Meta-/|Alt-Meta-"},command:"toggle block comment"},{keys:"Meta-Shift-L /  D",command:"comment box"},{keys:{windows:"Ctrl-.",mac:"Meta-."},command:"[IyGotoChar] activate"},{keys:{windows:"Ctrl-,",mac:"Meta-,"},command:{command:"[IyGotoChar] activate",args:{backwards:!0}}},{keys:{mac:"Alt-Shift-Space|Alt-Space|Meta-Shift-P",win:"Ctrl-Space|Ctrl-Shift-P"},command:"text completion"},{keys:"|Alt-/",command:"text completion first match"},{keys:"Alt-Q",command:"fit text to column"},{keys:{win:"Ctrl-F|Ctrl-G|F3",mac:"Meta-F|Meta-G|Ctrl-S"},command:"search in text"},{keys:{win:"Ctrl-Shift-F|Ctrl-Shift-G",mac:"Meta-Shift-F|Meta-Shift-G|Ctrl-R"},command:{command:"search in text",args:{backwards:!0}}},{keys:"Ctrl-Shift-/|Ctrl-C Ctrl-Shift-,",command:"[multi select] all like this"},{keys:"Alt-Ctrl-P",command:"[multi select] add cursor above"},{keys:"Alt-Ctrl-N",command:"[multi select] add cursor below"},{keys:"Ctrl-Shift-,",command:"[multi select] more like this backward"},{keys:"Ctrl-Shift-.",command:"[multi select] more like this forward"},{keys:{mac:"Meta-Shift-,"},command:"[multi select] goto previous focused cursor"},{keys:{mac:"Meta-Shift-."},command:"[multi select] goto next focused cursor"},{keys:"Ctrl-Shift-;",command:"[multi select] remove focused cursor"},{keys:"Alt-Ctrl-A",command:"[multi select] align cursors"},{keys:"Ctrl-X R",command:"[multi select] create rectangular selection"},{keys:{win:"Shift-Ctrl-S|Ctrl-Alt-Space",mac:"Ctrl-Command-space|Ctrl-Alt-Space"},command:"contractRegion"},{keys:{win:"Shift-Ctrl-E|Ctrl-Shift-Space",mac:"Shift-Command-Space|Ctrl-Shift-Space"},command:"expandRegion"},{keys:"Ctrl-Alt-h",command:"markDefun"},{keys:"Ctrl-Alt-d|Ctrl-Alt-Down",command:"forwardDownSexp"},{keys:"Ctrl-Alt-u|Ctrl-Alt-Up",command:"backwardUpSexp"},{keys:"Ctrl-Alt-b|Ctrl-Alt-Left",command:"backwardSexp"},{keys:"Ctrl-Alt-f|Ctrl-Alt-Right",command:"forwardSexp"},{keys:"Alt-.",command:"selectDefinition"},{keys:"Ctrl-Shift-'",command:"selectSymbolReferenceOrDeclaration"},{keys:"Ctrl-Shift-[",command:"selectSymbolReferenceOrDeclarationPrev"},{keys:"Ctrl-Shift-]",command:"selectSymbolReferenceOrDeclarationNext"},{keys:{win:"Ctrl-=",mac:"Meta-="},command:"increase font size"},{keys:{win:"Ctrl--",mac:"Meta--"},command:"decrease font size"},{keys:"Alt-K",command:"set link of selection"},{keys:"Alt-O",command:"set doit of selection"},{keys:{mac:"Meta-\\",wind:"Ctrl-\\"},command:"reset text style"},{keys:{mac:"Meta-Shift-L T U I",win:"Ctrl-Shift-L T U I"},command:"open text attribute controls"},{keys:{mac:"Meta-Shift-L T D",win:"Ctrl-Shift-L T D"},command:"[todo] toggle todo marker"},{keys:{mac:"Meta-Shift-L D A T E",win:"Ctrl-Shift-L D A T E"},command:"insert date"},{keys:"Ctrl-C Ctrl-I",command:"change string inflection"},{keys:"Alt-Shift-4",command:"spell check word"},{keys:"Alt-Shift-\\",command:"[shell] run shell command on region"},{keys:"Alt-Shift-;",command:"run code on text morph"},{keys:{mac:"Meta-Shift-L O P E N",win:"Ctrl-Shift-L O P E N"},command:"open file at cursor"},{keys:"Meta-F1",command:"report token at cursor"}]},codeEditor:{defaultTheme:"default",collapseSelection:!1,search:{maxCharsPerLine:1e4,fastHighlightLineCount:4e3,showTextMap:!0},defaultStyle:{fontFamily:"Monaco, Inconsolata, monospace",padding:t.Rectangle.inset(4,2,4,2),fontSize:n.mac?12:16,clipMode:"auto"},modes:{text:{style:{}}}},systemBrowser:{fixUndeclaredVarsOnSave:!0},objectEditor:{fixUndeclaredVarsOnSave:!0},remotes:{server:System.get("@system-env").browser?document.location.origin+"/eval":null}};function styleProps(e){var n={};return function addFill(e,n){var r=e.fill;if(!r)return void(n.background=t.Color.transparent.toString());r.isGradient?n.backgroundImage=r.toString():n.background=r.toString()}(e,n),function addTransform(e,t){var n=e.position,r=e.origin,i=e.scale,o=e.rotation;t.transform="translate3d("+Math.round(n.x-r.x)+"px, "+Math.round(n.y-r.y)+"px, 0px) rotate("+o.toFixed(2)+"rad) scale("+i.toFixed(2)+","+i.toFixed(2)+")"}(e,n),function addTransformOrigin(e,t){var n=e.origin;n&&(t.transformOrigin=n.x+"px "+n.y+"px")}(e,n),function addDisplay(e,t){var n=e.visible;null!=n&&(t.display=n?"":"none")}(e,n),function addExtentStyle(e,t){var n=e.extent;t.width=n.x+"px",t.height=n.y+"px"}(e,n),function addBorder(e,t){var n=e.borderWidthLeft,r=e.borderColorLeft,i=e.borderStyleLeft,o=e.borderWidthRight,a=e.borderColorRight,s=e.borderStyleRight,l=e.borderColor,u=e.borderWidthBottom,c=e.borderColorBottom,h=e.borderStyleBottom,d=e.borderWidthTop,p=e.borderColorTop,f=e.borderStyleTop;t["border-left-style"]=""+i,t["border-right-style"]=""+s,t["border-bottom-style"]=""+h,t["border-top-style"]=""+f,t["border-left-width"]=n+"px",t["border-right-width"]=o+"px",t["border-bottom-width"]=u+"px",t["border-top-width"]=d+"px",t["border-top-color"]=p?p.toString():"transparent",t["border-right-color"]=a?a.toString():"transparent",t["border-bottom-color"]=c?c.toString():"transparent",t["border-left-color"]=r?r.toString():"transparent",l&&l.isGradient&&(t["border-image"]=l.toString())}(e,n),function addBorderRadius(e,t){var n=e.borderRadiusLeft,r=e.borderRadiusRight,i=e.borderRadiusBottom,o=e.borderRadiusTop;t.borderRadius=o+"px "+o+"px "+i+"px "+i+"px / "+n+"px "+r+"px "+r+"px "+n+"px"}(e,n),function addShadowStyle(e,t){if(e.isSvgMorph||e.isImage)return void(t.filter=function shadowCss(e){return e.dropShadow?e.dropShadow.toFilterCss():""}(e));var n=e.dropShadow;n&&n.fast||n&&n.inset?t.boxShadow=n?n.toCss():"none":t.filter=n?n.toFilterCss():"none"}(e,n),null!=e.opacity&&(n.opacity=e.opacity),n}function addSvgAttributes(e,t){var n=e.width,r=e.height;e.borderWidth;return t.width=n||1,t.height=r||1,t.viewBox=[0,0,n||1,r||1].join(" "),t}function getSvgVertices(e){var t=void 0,n=void 0,r=void 0,i="",o=(r=e[0]).position,a=o.x,s=o.y;i=i+"M "+(t=a)+" "+(n=s)+" ";for(var l=1;l<e.length-1;l++){var u=e[l],c=u.position,h=c.x,d=c.y,p=u.isSmooth,f=u.controlPoints,y=f.previous;f.next;i=p?i+"C "+(t+r.controlPoints.next.x)+" "+(n+r.controlPoints.next.y)+" "+(h+y.x)+" "+(d+y.y)+" "+h+" "+d+" ":i+"L "+h+" "+d+" ",r=u,t=h,n=d}var m=e[e.length-1],g=(p=m.isSmooth,m.x),v=m.y;y=m.controlPoints.previous;return i=p?i+"C "+(t+r.controlPoints.next.x)+" "+(n+r.controlPoints.next.y)+" "+(g+y.x)+" "+(v+y.y)+" "+g+" "+v:i+"L "+g+" "+v}function addPathAttributes(e,t){var n=e.id,r=e.vertices,i=e.fill,o=e.borderColor,a=e.borderWidth;return r.length&&(t.d=getSvgVertices(r)),function addSvgBorderStyle(e,t){var n=e.borderStyle.valueOf();if("dashed"===n){var r=e.borderWidth.valueOf();t["stroke-dasharray"]=1.61*r+" "+r}else if("dotted"===n){var i=e.borderWidth.valueOf();t["stroke-dasharray"]="1 "+2*i,t["stroke-linecap"]="round",t["stroke-linejoin"]="round"}return t}(e,t),t["stroke-width"]=a.valueOf(),t["paint-order"]="stroke",t.fill=i?i.isGradient?"url(#gradient-fill"+n+")":i.toString():"transparent",t.stroke=o.valueOf().isGradient?"url(#gradient-borderColor"+n+")":o.valueOf().toString(),t}var O,I,D,N=(O=void 0,I=_classRecorder,D=I.hasOwnProperty("ShadowObject")&&"function"==typeof I.ShadowObject?I.ShadowObject:I.ShadowObject=function ShadowObject(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)},lively.classes.runtime.initializeClass(D,O,[{key:Symbol.for("lively-instance-initialize"),value:function ShadowObject_initialize_(e){r.obj.isBoolean(e)&&(e=z.defaultShadow);var n=e,i=n.rotation,o=n.distance,a=n.blur,s=n.color,l=n.morph,u=n.inset,c=n.spread,h=n.fast;this.rotation=r.obj.isNumber(i)?i:45,this.distance=r.obj.isNumber(o)?o:2,this.blur=r.obj.isNumber(a)?a:6,this.inset=u||!1,this.spread=c||0,this.color=s||t.Color.gray.darker(),this.morph=l,this.fast=h}},{key:"distance",get:function get(){return this._distance}},{key:"blur",get:function get(){return this._blur}},{key:"rotation",get:function get(){return this._rotation}},{key:"color",get:function get(){return this._color}},{key:"inset",get:function get(){return this._inset}},{key:"inset",set:function set(e){this._inset=e,this.morph&&(this.morph.dropShadow=this)}},{key:"distance",set:function set(e){this._distance=e,this.morph&&(this.morph.dropShadow=this)}},{key:"blur",set:function set(e){this._blur=e,this.morph&&(this.morph.dropShadow=this)}},{key:"rotation",set:function set(e){this._rotation=e,this.morph&&(this.morph.dropShadow=this)}},{key:"color",set:function set(e){this._color=e,this.morph&&(this.morph.dropShadow=this)}},{key:"isShadowObject",get:function get(){return!0}},{key:"toCss",value:function ShadowObject_toCss_(){var e=this.distance,n=this.rotation,i=this.color,o=this.inset,a=this.blur,s=this.spread,l=t.Point.polar(e,r.num.toRadians(n)),u=l.x,c=l.y;return(o?"inset":"")+" "+i.toString()+" "+u+"px "+c+"px "+a+"px "+s+"px"}},{key:"toJson",value:function ShadowObject_toJson_(){return r.obj.select(this,["rotation","distance","blur","color","inset","spread"])}},{key:"toFilterCss",value:function ShadowObject_toFilterCss_(){var e=this.distance,i=this.rotation,o=this.blur,a=this.color,s=(this.spread,t.Point.polar(e,r.num.toRadians(i)));return"drop-shadow("+s.x+"px "+s.y+"px "+(o="Chrome"==n.name?o/3:o/2)+"px "+a.toString()+")"}}],void 0,I,void 0,{start:3383,end:5773}));function defaultStyle(e){e.opacity;var t=e.reactsToPointer,n=e.nativeCursor,r=e.clipMode,i=styleProps(e),o=e._animationQueue.maskedProps("css");return"backgroundImage"in o&&delete i.background,"visible"!==r&&(i.overflow=r,i["-webkit-overflow-scrolling"]="touch",i["overflow-anchor"]="none"),Object.assign(i,o),i.position="absolute",i["pointer-events"]=t?"auto":"none",i.cursor=n,i}function MorphAfterRenderHook(e,t){this.morph=e,this.renderer=t}function Animation(e){this.morph=e}function SvgAnimation(e,t){this.morph=e,this.type=t}function defaultAttributes(e,t){return{animation:new Animation(e),key:e.id,id:e.id,className:(e.hideScrollbars?e.styleClasses.concat("hiddenScrollbar"):e.styleClasses).join(" "),draggable:!1,"morph-after-render-hook":new MorphAfterRenderHook(e,t)}}function renderGradient(e,t){var n=e[t].valueOf(),i=n.bounds,a=n.focus,s=n.vector,l=n.stops,u=e.extent,c=u.x,h=u.y,d={namespace:"http://www.w3.org/2000/svg",attributes:{id:"gradient-"+t+e.id,gradientUnits:"userSpaceOnUse",r:"50%"}};if(s&&(d.attributes.gradientTransform="rotate("+r.num.toDegrees(s.extent().theta())+", "+c/2+", "+h/2+")"),a&&i){var p=i.width,f=i.height,y=a.x,m=a.y;d.attributes.gradientTransform="matrix(\n"+p/c+", 0, 0, "+f/h+",\n"+(c/2-p/c*(c/2)+y*c-c/2)+",\n"+(h/2-f/h*(h/2)+m*h-h/2)+")"}return o.h(n.type,d,l.map(function(e){return o.h("stop",{namespace:"http://www.w3.org/2000/svg",attributes:{offset:100*e.offset+"%","stop-color":e.color.toString()}})}))}function renderRootMorph(e,t){if(e.needsRerender()){var n=t.renderMap.get(e)||t.render(e),i=t.render(e),a=o.diff(n,i),s=t.domNode||(t.domNode=o.create(n,t.domEnvironment));s.parentNode||function initDOMState(e,t){e.rootNode.appendChild(e.domNode),e.ensureDefaultCSS().then(function(){return r.promise.delay(500)}).then(function(){return t.env.fontMetric&&t.env.fontMetric.reset()}).then(function(){return t.withAllSubmorphsDo(function(e){if(e.isText||e.isLabel){var t=(e.metadata||{}).serializationInfo;if(t&&t.recoveredTextBounds)return;e.forceRerender()}})}).catch(function(e){return console.error(e)})}(t,e),o.patch(s,a),t.renderFixedMorphs(i.fixedMorphs,e)}}MorphAfterRenderHook.prototype.hook=function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=!!e.parentNode;if(o&&(this.morph._submorphOrderChanged&&this.morph.submorphs.length?(this.morph._submorphOrderChanged=!1,this.updateScrollOfSubmorphs(this.morph,this.renderer)):this.morph.isClip()&&this.updateScroll(this.morph,e)),o||i>3)return this.morph._rendering=!1,void this.morph.onAfterRender(e);i++,setTimeout(function(){return r.hook(e,t,n,i)},20*i)},MorphAfterRenderHook.prototype.updateScroll=function(e,t){var n=this,r=e.env.eventDispatcher.eventState.scroll.interactiveScrollInProgress;if(r)return r.then(function(){return n.updateScroll(e,t)});if(t){var i=e.scroll,o=i.x,a=i.y;t.scrollTop!==a&&(t.scrollTop=a),t.scrollLeft!==o&&(t.scrollLeft=o)}},MorphAfterRenderHook.prototype.updateScrollOfSubmorphs=function(e,t){var n=this;e.submorphs.forEach(function(e){e.isClip()&&n.updateScroll(e,t.getNodeForMorph(e)),n.updateScrollOfSubmorphs(e,t)})},Animation.prototype.hook=function(e){this.morph._animationQueue.startAnimationsFor(e)},SvgAnimation.prototype.hook=function(e){this.morph._animationQueue.startSvgAnimationsFor(e,this.type)};var F,B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j=(F="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103,function createRawReactElement(e,t,n,r){var i=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={}),t&&i)for(var a in i)void 0===t[a]&&(t[a]=i[a]);else t||(t=i||{});if(1===o)t.children=r;else if(o>1){for(var s=Array(o),l=0;l<o;l++)s[l]=arguments[l+3];t.children=s}return{$$typeof:F,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}),W=function(){function AwaitValue(e){this.value=e}function AsyncGenerator(e){var t,n;function resume(t,n){try{var r=e[t](n),i=r.value;i instanceof AwaitValue?Promise.resolve(i.value).then(function(e){resume("next",e)},function(e){resume("throw",e)}):settle(r.done?"return":"normal",r.value)}catch(e){settle("throw",e)}}function settle(e,r){switch(e){case"return":t.resolve({value:r,done:!0});break;case"throw":t.reject(r);break;default:t.resolve({value:r,done:!1})}(t=t.next)?resume(t.key,t.arg):n=null}this._invoke=function send(e,r){return new Promise(function(i,o){var a={key:e,arg:r,resolve:i,reject:o,next:null};n?n=n.next=a:(t=n=a,resume(e,r))})},"function"!=typeof e.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(AsyncGenerator.prototype[Symbol.asyncIterator]=function(){return this}),AsyncGenerator.prototype.next=function(e){return this._invoke("next",e)},AsyncGenerator.prototype.throw=function(e){return this._invoke("throw",e)},AsyncGenerator.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new AsyncGenerator(e.apply(this,arguments))}},await:function(e){return new AwaitValue(e)}}}(),H=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function step(r,i){try{var o=t[r](i),a=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(a).then(function(e){step("next",e)},function(e){step("throw",e)});e(a)}("next")})}},V=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),U=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},G="undefined"==typeof global?self:global,$=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function sliceIterator(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),K=function(e){return Array.isArray(e)?e:Array.from(e)},X=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},Y=Object.freeze({jsx:j,asyncIterator:function(e){if("function"==typeof Symbol){if(Symbol.asyncIterator){var t=e[Symbol.asyncIterator];if(null!=t)return t.call(e)}if(Symbol.iterator)return e[Symbol.iterator]()}throw new TypeError("Object is not async iterable")},asyncGenerator:W,asyncGeneratorDelegate:function(e,t){var n={},r=!1;function pump(n,i){return r=!0,i=new Promise(function(t){t(e[n](i))}),{done:!1,value:t(i)}}return"function"==typeof Symbol&&Symbol.iterator&&(n[Symbol.iterator]=function(){return this}),n.next=function(e){return r?(r=!1,e):pump("next",e)},"function"==typeof e.throw&&(n.throw=function(e){if(r)throw r=!1,e;return pump("throw",e)}),"function"==typeof e.return&&(n.return=function(e){return pump("return",e)}),n},asyncToGenerator:H,classCallCheck:function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass:V,defineEnumerableProperties:function(e,t){for(var n in t){var r=t[n];r.configurable=r.enumerable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n,r)}return e},defaults:function(e,t){for(var n=Object.getOwnPropertyNames(t),r=0;r<n.length;r++){var i=n[r],o=Object.getOwnPropertyDescriptor(t,i);o&&o.configurable&&void 0===e[i]&&Object.defineProperty(e,i,o)}return e},defineProperty:U,get:function get$1(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:get$1(i,t,n)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(n):void 0},inherits:function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},interopRequireDefault:function(e){return e&&e.__esModule?e:{default:e}},interopRequireWildcard:function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},newArrowCheck:function(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")},objectDestructuringEmpty:function(e){if(null==e)throw new TypeError("Cannot destructure undefined")},objectWithoutProperties:function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},possibleConstructorReturn:function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},selfGlobal:G,set:function set$1(e,t,n,r){var i=Object.getOwnPropertyDescriptor(e,t);if(void 0===i){var o=Object.getPrototypeOf(e);null!==o&&set$1(o,t,n,r)}else if("value"in i&&i.writable)i.value=n;else{var a=i.set;void 0!==a&&a.call(r,n)}return n},slicedToArray:$,slicedToArrayLoose:function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){for(var n,r=[],i=e[Symbol.iterator]();!(n=i.next()).done&&(r.push(n.value),!t||r.length!==t););return r}throw new TypeError("Invalid attempt to destructure non-iterable instance")},taggedTemplateLiteral:function(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))},taggedTemplateLiteralLoose:function(e,t){return e.raw=t,e},temporalRef:function(e,t,n){if(e===n)throw new ReferenceError(t+" is not defined - temporal dead zone");return e},temporalUndefined:{},toArray:K,toConsumableArray:X,typeof:B,extends:q,instanceof:function(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}});function pad(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.arr.last;return[].concat(X(e),X(new Array(Math.max(t-e.length,0)).fill(n(e))))}var J={inQuad:"cubic-bezier(0.550,  0.085, 0.680, 0.530)",inCubic:"cubic-bezier(0.550,  0.055, 0.675, 0.190)",inQuart:"cubic-bezier(0.895,  0.030, 0.685, 0.220)",inQuint:"cubic-bezier(0.755,  0.050, 0.855, 0.060)",inSine:"cubic-bezier(0.470,  0.000, 0.745, 0.715)",inExpo:"cubic-bezier(0.950,  0.050, 0.795, 0.035)",inCirc:"cubic-bezier(0.600,  0.040, 0.980, 0.335)",inBack:"cubic-bezier(0.600, -0.280, 0.735, 0.045)",outQuad:"cubic-bezier(0.250,  0.460, 0.450, 0.940)",outCubic:"cubic-bezier(0.215,  0.610, 0.355, 1.000)",outQuart:"cubic-bezier(0.165,  0.840, 0.440, 1.000)",outQuint:"cubic-bezier(0.230,  1.000, 0.320, 1.000)",outSine:"cubic-bezier(0.390,  0.575, 0.565, 1.000)",outExpo:"cubic-bezier(0.190,  1.000, 0.220, 1.000)",outCirc:"cubic-bezier(0.075,  0.820, 0.165, 1.000)",outBack:"cubic-bezier(0.175,  0.885, 0.320, 1.275)",inOutQuad:"cubic-bezier(0.455,  0.030, 0.515, 0.955)",inOutCubic:"cubic-bezier(0.645,  0.045, 0.355, 1.000)",inOutQuart:"cubic-bezier(0.770,  0.000, 0.175, 1.000)",inOutQint:"cubic-bezier(0.860,  0.000, 0.070, 1.000)",inOutSine:"cubic-bezier(0.445,  0.050, 0.550, 0.950)",inOutExpo:"cubic-bezier(1.000,  0.000, 0.000, 1.000)",inOutCirc:"cubic-bezier(0.785,  0.135, 0.150, 0.860)",inOutBack:"cubic-bezier(0.680, -0.550, 0.265, 1.550)"};function convertToSvgEasing(e){for(var t in J)if(J[t]===e){if(t.includes("inOut"))return t.replace("inOut","").toLowerCase()+"InOut";if(t.includes("out"))return t.replace("out","").toLowerCase()+"Out";if(t.includes("in"))return t.replace("in","").toLowerCase()+"In"}}var Q,Z=function(e){var t=_classRecorder,n=t.hasOwnProperty("AnimationQueue")&&"function"==typeof t.AnimationQueue?t.AnimationQueue:t.AnimationQueue=function AnimationQueue(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function AnimationQueue_initialize_(e){this.morph=e,this.animations=[]}},{key:"maskedProps",value:function AnimationQueue_maskedProps_(e){return this.animations.length>0?r.obj.merge(this.animations.map(function(t){return t.getAnimationProps(e)[0]})):{}}},{key:"animationsActive",get:function get(){return!0}},{key:"registerAnimation",value:function AnimationQueue_registerAnimation_(e){var t=this,n=new ee(this,this.morph,e);return this.morph.withMetaDo({animation:n},function(){if(!t.animations.find(function(e){return e.equals(n)})&&n.affectsMorph){var e=void 0;return(e=t.animations.find(function(e){return e.canMerge(n)}))?(e.mergeWith(n),e):(n.assignProps(),t.animations.push(n),n)}})}},{key:"startAnimationsFor",value:function AnimationQueue_startAnimationsFor_(e){for(var t=0;t<this.animations.length;t++){this.animations[t].start(e)}}},{key:"startSvgAnimationsFor",value:function AnimationQueue_startSvgAnimationsFor_(e,t){this.animations.forEach(function(n){return n.startSvg(e,t)})}},{key:"removeAnimation",value:function AnimationQueue_removeAnimation_(e){r.arr.remove(this.animations,e)}}],void 0,t,void 0,{start:2424,end:3610})}(void 0),ee=function(e){var n=_classRecorder,i=n.hasOwnProperty("PropertyAnimation")&&"function"==typeof n.PropertyAnimation?n.PropertyAnimation:n.PropertyAnimation=function PropertyAnimation(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(i,e,[{key:Symbol.for("lively-instance-initialize"),value:function PropertyAnimation_initialize_(e,t,n){this.queue=e,this.morph=t,this.config=this.convertGradients(this.convertBounds(n)),this.needsAnimation={svg:t.isSvgMorph,path:t.isPath,polygon:t.isPolygon},this.capturedProperties=r.obj.select(this.morph,this.propsToCapture)}},{key:"propsToCapture",get:function get(){return["fill","origin"]}},{key:"asPromise",value:function PropertyAnimation_asPromise_(){var e=this;return this._promise||(this._promise=new Promise(function(t,n){e.resolveCallback=function(){e.onFinish(e),e.subAnimations?e.subAnimations.then(t):t(e.morph)}}))}},{key:"finish",value:function PropertyAnimation_finish_(){var e=this;this.config.scale&&this.morph.whenRendered().then(function(){return e.morph.withAllSubmorphsDo(function(e){return e.isText&&e.invalidateTextLayout(!0,!0)})}),this.queue.removeAnimation(this),this.resolveCallback?this.resolveCallback():this.onFinish()}},{key:"convertGradients",value:function PropertyAnimation_convertGradients_(e){var n=this;if(this.morph.isSvgMorph&&e.fill)return this.morph.fill=e.fill,r.obj.dissoc(e,["fill"]);if(e.fill&&e.fill.isGradient&&this.morph.fill.isGradient){var i=this.morph.fill,o=e.fill,a=e.duration||1e3;if("linearGradient"==i.type&&"radialGradient"==o.type)return this.subAnimation=H(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.morph.animate({fill:new t.LinearGradient(Object.assign({},i,{vector:t.rect(0,0,0,1)})),duration:a/2,easing:J.inQuad});case 2:return n.morph.fill=new t.RadialGradient({stops:i.stops,focus:t.pt(.5,0),bounds:t.rect(0,0,100*n.morph.width,2*n.morph.height)}),e.next=5,n.morph.animate({fill:o,duration:a/2,easing:J.outQuad});case 5:return e.abrupt("return",n.morph);case 6:case"end":return e.stop()}},_callee,n)}))(),r.obj.dissoc(e,["fill"]);if("radialGradient"==i.type&&"linearGradient"==o.type)return this.subAnimations=H(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function _callee2$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.morph.animate({fill:new t.RadialGradient({stops:i.stops,focus:t.pt(.5,0),bounds:t.rect(0,0,100*n.morph.width,2*n.morph.height)}),duration:a/2,easing:J.inQuad});case 2:return n.morph.fill=new t.LinearGradient(Object.assign({},i,{vector:t.rect(0,0,0,1)})),e.next=5,n.morph.animate({fill:o,duration:a/2,easing:J.outQuad});case 5:return e.abrupt("return",n.morph);case 6:case"end":return e.stop()}},_callee2,n)}))(),r.obj.dissoc(e,["fill"])}return e}},{key:"convertBounds",value:function PropertyAnimation_convertBounds_(e){var t=e.bounds,n=e.origin,i=e.rotation,o=e.scale;e.layout,e.fill,n=n||this.morph.origin,i=i||this.morph.rotation,o=o||this.morph.scale;return t?Object.assign({},r.obj.dissoc(e,["bounds"]),{origin:n,rotation:i,scale:o,position:t.topLeft().addPt(n),extent:t.extent()}):e}},{key:"equals",value:function PropertyAnimation_equals_(e){return r.obj.equals(this.animatedProps,e.animatedProps)}},{key:"canMerge",value:function PropertyAnimation_canMerge_(e){return this.easing==e.easing&&this.duration==e.duration}},{key:"mergeWith",value:function PropertyAnimation_mergeWith_(e){Object.assign(this.morph,e.animatedProps),Object.assign(this.config,e.config),this.afterProps=this.gatherAnimationProps()}},{key:"affectsMorph",get:function get(){var e=this;return r.properties.any(this.animatedProps,function(t,n){return!r.obj.equals(t[n],e.morph[n])})}},{key:"animatedProps",get:function get(){return r.obj.dissoc(this.config,["easing","onFinish","duration"])}},{key:"easing",get:function get(){return this.config.easing||J.inOutQuad}},{key:"onFinish",get:function get(){return this.config.onFinish||function(){}}},{key:"setonFinish",value:function PropertyAnimation_setonFinish_(e){this.config.onFinish=e}},{key:"duration",get:function get(){return this.config.duration||1e3}},{key:"getChangedProps",value:function PropertyAnimation_getChangedProps_(e,t){var n=[];for(var i in e)r.obj.equals(t[i],e[i])&&n.push(i);return[r.obj.dissoc(e,n),r.obj.dissoc(t,n)]}},{key:"getAnimationProps",value:function PropertyAnimation_getAnimationProps_(e){var t=this.getChangedProps(this.beforeProps[e],this.afterProps[e]),n=$(t,2),i=n[0],o=n[1],a=this.capturedProperties,s=a.fill,l=(a.dropShadow,this.morph),u=l.fill;l.dropShadow;if("none"==i.filter&&o.boxShadow&&(delete i.filter,i.boxShadow="none"),"none"==o.filter&&i.boxShadow&&(delete o.filter,o.boxShadow="none"),s&&u){if(s.isGradient&&u.isGradient){var c=Math.max(u.stops.length,s.stops.length),h=pad(s.stops,c),d=new s.__proto__.constructor(Object.assign({},s,{vector:s.vector&&s.vectorAsAngle()+1e-5,stops:h})).toString(),p=pad(u.stops,c),f=new u.__proto__.constructor(Object.assign({},u,{vector:u.vector&&u.vectorAsAngle(),stops:p})).toString();i.backgroundImage=d,o.backgroundImage=f}if(s.isColor&&u.isGradient){var y=u.__proto__.constructor,m=u.stops,g=new y(Object.assign({},u,{vector:u.g&&u.vectorAsAngle()+1e-5,stops:m.map(function(e){var t=e.offset;return{color:s,offset:t}})})).toString();delete i.background,delete o.background,i.backgroundImage=g}if(s.isGradient&&u.isColor){var v=s,x=v.__proto__.constructor,b=v.stops,w=new x(Object.assign({},v,{vector:v.vector&&v.vectorAsAngle()+.001,stops:v.stops})).toString(),_=new x(Object.assign({},v,{vector:v.vector&&v.vectorAsAngle(),stops:b.map(function(e){var t=e.offset;return{color:u,offset:t}})})).toString();delete o.background,delete i.background,o.backgroundImage=_,i.backgroundImage=w}}var k=!0,S=!1,M=void 0;try{for(var C,P=r.arr.union(r.obj.keys(i),r.obj.keys(o))[Symbol.iterator]();!(k=(C=P.next()).done);k=!0){var T=C.value;!T in i&&(i[T]=o[T]),!T in o&&(o[T]=i[T])}}catch(e){S=!0,M=e}finally{try{!k&&P.return&&P.return()}finally{if(S)throw M}}return[!r.obj.isEmpty(i)&&i,!r.obj.isEmpty(o)&&o]}},{key:"gatherAnimationProps",value:function PropertyAnimation_gatherAnimationProps_(){var e=this.morph,t=e.isSvgMorph,n=e.isPath,r=e.isPolygon,i={};return i.css=styleProps(this.morph),t&&(i.svg=addSvgAttributes(e,{})),n&&(i.path=addPathAttributes(e,{})),r&&(i.polygon=addPathAttributes(e,{})),i}},{key:"assignProps",value:function PropertyAnimation_assignProps_(){this.beforeProps=this.gatherAnimationProps(),Object.assign(this.morph,this.animatedProps),this.afterProps=this.gatherAnimationProps()}},{key:"startSvg",value:function PropertyAnimation_startSvg_(e,t){var n=this;if(this.needsAnimation[t]){this.needsAnimation[t]=!1;var r=this.getAnimationProps(t),i=$(r,2),o=i[0],a=i[1];if(o&&a){var s=SVG.adopt(e).animate(this.duration,convertToSvgEasing(this.easing));if("svg"==t){var l=s.target().defs().children().find(function(e){return"clipPath"==e.type}).children()[0];if(l){var u=this.getAnimationProps("path"),c=$(u,2),h=(c[0],c[1]);h.d&&l.animate(this.duration,convertToSvgEasing(this.easing)).plot(h.d)}}for(var d in a){var p;if("d"!=d)if("viewBox"!=d)s=s.attr(d,a[d]);else s=(p=s).viewbox.apply(p,X(a.viewBox.split(" ").map(parseFloat)));else s=s.plot(a.d)}s.afterAll(function(){n.finish(),n.morph.makeDirty()})}else this.finish()}}},{key:"start",value:function PropertyAnimation_start_(e){if(!this.active){this.active=!0;var t=this.getAnimationProps("css"),n=$(t,2),r=n[0],i=n[1];if(this.tween(e,r,i),this.config.origin){var o=this.capturedProperties.origin,a=this.config.origin;this.tween(e.childNodes[0],{transform:"translate3d("+o.x+"px, "+o.y+"px, 0px)"},{transform:"translate3d("+a.x+"px, "+a.y+"px, 0px)"})}}}},{key:"tween",value:function PropertyAnimation_tween_(e,t,n){var i=this,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=function onComplete(){o&&(i.finish(),i.morph.makeDirty())};t&&n?function(){var o={},s={};for(var l in t)o[r.string.camelize(l)]=t[l];for(var u in n)s[r.string.camelize(u)]=n[u];var c=e.animate([o,s],{duration:i.duration,easing:i.easing,fill:"forwards",composite:"replace"});c.onfinish=function(){a(),setTimeout(function(){return c.cancel()},200)}}():a()}}],void 0,n,void 0,{start:3619,end:14650})}(void 0),te=(Q=H(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=ie,e.next=3,createIFrame(document.body);case 3:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 5:case"end":return e.stop()}},_callee,this)})),function createDOMEnvironment_browser(){return Q.apply(this,arguments)});function cumulativeOffset(e){var t=0,n=0;do{t+=e.offsetTop||0,n+=e.offsetLeft||0,e=e.offsetParent}while(e);return{top:t,left:n}}function createIFrame(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"about:blank",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.Rectangle(0,0,700,700);return new Promise(function(t,o){if(!e)throw new Error("Need parent element!");var a=document.createElement("iframe");a.style.position="absolute",a.style.top=i.top()+"px",a.style.left=i.left()+"px",a.style.width=i.width+"px",a.style.height=i.height+"px",a.src=n;var s=!1;a.onload=function(e){s=!0,a.onload=null,t(a)},r.promise.waitFor(1e3,function(){return!!s}).catch(function(e){return o(new Error("iframe load timeout"))}),e.appendChild(a)})}function createDOMEnvironment(){return System.get("@system-env").browser?te():function createDOMEnvironment_node(){System.decanonicalize("lively.morphic/").replace(/file:\/\//,"");var e=System._nodeRequire("jsdom"),t=e.createVirtualConsole().sendTo(console);return new Promise(function(n,r){e.env("<div></div>",["https://code.jquery.com/pep/0.4.1/pep.js"],{virtualConsole:t},function(e,t){return e?r(e):n(new re(t,t.document,function(){return t.close()}))})})}()}var ne,re=function(e){var t=_classRecorder,n=t.hasOwnProperty("DomEnvironment")&&"function"==typeof t.DomEnvironment?t.DomEnvironment:t.DomEnvironment=function DomEnvironment(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function DomEnvironment_initialize_(e,t,n){!function requestAnimationFramePolyfill(e){for(var t=0,n=["ms","moz","webkit","o"],r=0;r<n.length&&!e.requestAnimationFrame;++r)e.requestAnimationFrame=e[n[r]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[n[r]+"CancelAnimationFrame"]||e[n[r]+"CancelRequestAnimationFrame"];e.requestAnimationFrame||(e.requestAnimationFrame=function(n,r){var i=Date.now(),o=Math.max(0,16-(i-t)),a=e.setTimeout(function(){n(i+o)},o);return t=i+o,a}),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(e){clearTimeout(e)})}(e),this.window=e,this.document=t,this.destroyFn=n}},{key:"destroy",value:function DomEnvironment_destroy_(){"function"==typeof this.destroyFn&&this.destroyFn()}}],void 0,t,void 0,{start:3027,end:3321})}(void 0),ie=function(e){var t=_classRecorder,n=t.hasOwnProperty("IFramedDomEnvironment")&&"function"==typeof t.IFramedDomEnvironment?t.IFramedDomEnvironment:t.IFramedDomEnvironment=function IFramedDomEnvironment(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function IFramedDomEnvironment_initialize_(e){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(n.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e.contentWindow,e.contentWindow.document,function(){e.contentWindow&&e.contentWindow.close(),e.parentNode&&e.parentNode.removeChild(e)}),this.iframe=e}}],void 0,t,void 0,{start:3323,end:3667})}(re);function setCSSDef(e,t,n){r.arr.from(e.childNodes).forEach(function(t){return e.removeChild(t)});var i=n.createTextNode(t);return e.styleSheet?e.styleSheet.cssText=i.nodeValue:e.appendChild(i),e}function addOrChangeCSSDeclaration(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"lively-css",t=arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document,r=n.getElementById(e);return r?setCSSDef(r,t,n):function addCSSDef(e,t,n){var r=n.createElement("style");return r.type="text/css",e&&r.setAttribute("id",e),setCSSDef(r,t,n),n.head.appendChild(r),r}(e,t,n)}function addOrChangeLinkedCSS(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document,i=n.getElementById(e);if(i||((i=n.createElement("link")).type="text/css",i.rel="stylesheet",i.setAttribute("id",e),n.head.appendChild(i)),i.getAttribute("href")!==t){i.setAttribute("href",t);var o=!1;return i.onload=function(){return o=!0},r.promise.waitFor(function(){return!!o&&i})}return Promise.resolve()}var oe=function(){new WeakMap;return function hyperscriptFnForDocument(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.document;return h_dom;function h_dom(t,n,r){var i=n||void 0;void 0===r&&(r=n,i=void 0);var o=[],a=t.split(".");if(a.length>1){t=a.shift();for(var s=0;s<a.length;s++){var l,u=a[s];(l=u.indexOf("#"))>-1&&(u.slice(l+1),u=u.slice(0,l)),o.push(u)}}var c=t.split("#");c.length>1&&(t=c[0],c[1]);var h=e.createElement(t);if(i){for(var d in i)"style"!==d&&"dataset"!==d&&(h[d]=i[d]);var p=i.style;if(p)for(var f in p)h.style[f]=p[f];var y=i.dataset;if(y)if(h.dataset)for(var m in y)h.dataset[m]=y[m];else for(var m in y)h.setAttribute("data-"+m,y[m])}if(r||(r=""),"string"==typeof r)h.appendChild(e.createTextNode(r));else if(Array.isArray(r))for(s=0;s<r.length;s++){var g=r[s];h.appendChild("string"==typeof g?e.createTextNode(g):g)}else h.appendChild("string"==typeof r?e.createTextNode(r):r);return h}}}(),ae="http://www.w3.org/2000/svg",se=function(e){var n=_classRecorder,i=n.hasOwnProperty("Renderer")&&"function"==typeof n.Renderer?n.Renderer:n.Renderer=function Renderer(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(i,e,[{key:Symbol.for("lively-instance-initialize"),value:function Renderer_initialize_(e,t,n){if(!e||!e.isMorph)throw new Error("Trying to initialize renderer with an invalid world morph: "+e);if(!(t&&"nodeType"in t))throw new Error("Trying to initialize renderer with an invalid root node: "+t);if(!n){var r=t.ownerDocument;n={window:System.global,document:r}}this.worldMorph=e,e._renderer=this,this.rootNode=t,this.domNode=null,this.domEnvironment=n,this.renderMap=new WeakMap,this.fixedMorphNodeMap=new Map,this.renderWorldLoopProcess=null,this.renderWorldLoopLater=null,this.requestAnimationFrame=n.window.requestAnimationFrame.bind(n.window)}},{key:"clear",value:function Renderer_clear_(){this.stopRenderWorldLoop(),this.domNode&&this.domNode.parentNode.removeChild(this.domNode),this.domNode=null,this.renderMap=new WeakMap}},{key:"ensureDefaultCSS",value:function Renderer_ensureDefaultCSS_(){var e=this;return r.promise.waitFor(3e3,function(){return e.domNode.ownerDocument}).then(function(e){return Promise.all([addOrChangeCSSDeclaration("lively-morphic-css","\n\n/*-=- html fixes -=-*/\n\nhtml {\n  overflow: visible;\n}\n\ntextarea.lively-text-input.debug {\n  z-index: 20 !important;\n  opacity: 1 !important;\n  background: rgba(0,255,0,0.5) !important;\n}\n\n.no-html-select {\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -khtml-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.hiddenScrollbar::-webkit-scrollbar {\n  /* This is the magic bit */\n  display: none;\n}\n\n\n/*-=- generic morphic -=-*/\n\n.Morph {\n  outline: none;\n  /*for aliasing issue in chrome: http://stackoverflow.com/questions/6492027/css-transform-jagged-edges-in-chrome*/\n  -webkit-backface-visibility: hidden;\n\n  /*include border size in extent of element*/\n  box-sizing: border-box;\n\n  /*don't use dom selection on morphs*/\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -khtml-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.Tooltip {\n  z-index: 3;\n}\n\n.Hand {\n  z-index: 1;\n}\n\n/*-=- halos -=-*/\n\n.Halo {\n  z-index: 2;\n}\n\n.ProportionalLayoutHalo, .FlexLayoutHalo, .GridLayoutHalo, .TilingLayoutHalo {\n  z-index: auto;\n}\n\n.HaloItem:not(.NameHaloItem) {\n  /*FIXME: we shouldn't need to hardcode the size...*/\n  line-height: 24px !important;\n  text-align: center;\n  vertical-align: middle;\n}\n\n.halo-mesh {\n  background-color:transparent;\n  background-image: linear-gradient(rgba(0,0,0,.1) 2px, transparent 2px),\n  linear-gradient(90deg, rgba(0,0,0,.1) 2px, transparent 2px),\n  linear-gradient(rgba(0,0,0,.1) 1px, transparent 1px),\n  linear-gradient(90deg, rgba(0,0,0,.1) 1px, transparent 1px);\n  background-size:100px 100px, 100px 100px, 10px 10px, 10px 10px;\n  background-position:-2px -2px, -2px -2px, -1px -1px, -1px -1px;\n}\n\n/*-=- text -=-*/\n\n.center-text {\n  text-align: center;\n}\n\n.v-center-text {\n  position: relative;\n  top: 50%;\n  transform: translateY(-50%);\n}\n\ndiv.text-layer span {\n  line-height: normal;\n}\n\n/*-=- text -=-*/\n\n.Label span {\n  white-space: pre;\n  float: left;\n}\n\n.Text .annotation {\n  text-align: right;\n  position: absolute;\n  right: 0;\n}\n\n.Label .annotation {\n/*  vertical-align: middle;\n  height: 100%;*/\n  /*vertical align*/\n  float: right;\n  position: relative;\n  top: 50%;\n  transform: translateY(-50%);\n  text-align: right;\n}\n\n.truncated-text {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n/*-=- input elements -=-*/\n\ninput::-webkit-input-placeholder {\n  color: rgb(202, 202, 202);\n}\ninput::-moz-placeholder {\n  color: rgb(202, 202, 202);\n}\ninput:-ms-input-placeholder {\n  color: rgb(202, 202, 202);\n}\ninput:-moz-placeholder {\n  color: rgb(202, 202, 202);\n}\ninput:placeholder {\n  color: rgb(202, 202, 202);\n}\n\n/*-=- input elements -=-*/\n.Morph svg .path-point {\n  cursor: move; /* fallback if grab cursor is unsupported */\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab;\n  fill: red;\n}\n\n",e),addOrChangeLinkedCSS("lively-font-awesome","/lively.morphic/assets/font-awesome/css/font-awesome.css",e),addOrChangeLinkedCSS("lively-font-inconsolata","/lively.morphic/assets/inconsolata/inconsolata.css",e)])})}},{key:"startRenderWorldLoop",value:function Renderer_startRenderWorldLoop_(){var e=this;return this.renderWorldLoopProcess=this.requestAnimationFrame(function(){return e.startRenderWorldLoop()}),this.renderStep()}},{key:"stopRenderWorldLoop",value:function Renderer_stopRenderWorldLoop_(){this.domEnvironment.window.cancelAnimationFrame(this.renderWorldLoopProcess),this.renderWorldLoopProcess=null,this.domEnvironment.window.cancelAnimationFrame(this.renderWorldLoopLater),this.renderWorldLoopLater=null}},{key:"renderLater",value:function Renderer_renderLater_(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this.renderWorldLoopLaterCounter=t,this.renderWorldLoopLater||(this.renderWorldLoopLater=this.requestAnimationFrame(function(){e.renderWorldLoopLater=null,e.renderWorldLoopLaterCounter>0&&e.renderLater(e.renderWorldLoopLaterCounter-1);try{e.renderStep()}catch(e){console.error("Error rendering morphs:",e)}}))}},{key:"renderStep",value:function Renderer_renderStep_(){return this.worldMorph.renderAsRoot(this),this}},{key:"getNodeForMorph",value:function Renderer_getNodeForMorph_(e){return this.domNode?this.domNode.querySelector("#"+r.string.regExpEscape(e.id)):null}},{key:"getMorphForNode",value:function Renderer_getMorphForNode_(e){return this.worldMorph?this.worldMorph.withAllSubmorphsDetect(function(t){return t.id===e.id}):null}},{key:"render",value:function Renderer_render_(e){if(!e.needsRerender()){var t=this.renderMap.get(e);if(t)return t}e.aboutToRender(this);var n=e.render(this);return this.renderMap.set(e,n),n}},{key:"renderAsFixed",value:function Renderer_renderAsFixed_(e){var t=this.render(e);return t.properties.style.position="fixed",t}},{key:"renderFixedMorphs",value:function Renderer_renderFixedMorphs_(e,t){var n=this.domNode,r=this.fixedMorphNodeMap;if((e.length||r.size)&&n&&n.parentNode){var i=!0,a=!1,s=void 0;try{for(var l,u=r[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var c=$(l.value,2),h=c[0],d=c[1];e.includes(h)||(d.parentNode.removeChild(d),r.delete(h))}}catch(e){a=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(a)throw s}}var p=!0,f=!1,y=void 0;try{for(var m,g=e[Symbol.iterator]();!(p=(m=g.next()).done);p=!0){h=m.value;var v=this.renderMap.get(h)||this.renderAsFixed(h),x=this.renderAsFixed(h),b=o.diff(v,x),w=r.get(h);w||(w=o.create(v,this.domEnvironment),r.set(h,w)),w.parentNode||n.parentNode.appendChild(w),o.patch(w,b)}}catch(e){f=!0,y=e}finally{try{!p&&g.return&&g.return()}finally{if(f)throw y}}}}},{key:"renderMorph",value:function Renderer_renderMorph_(e){var t=this.renderSubmorphs(e);return o.h("div",Object.assign({},defaultAttributes(e,this),{style:defaultStyle(e)}),t)}},{key:"renderSubmorphs",value:function Renderer_renderSubmorphs_(e){return this.renderSelectedSubmorphs(e,e.submorphs)}},{key:"renderSelectedSubmorphs",value:function Renderer_renderSelectedSubmorphs_(e,t){for(var n=e.borderWidthLeft,r=e.borderWidthTop,i=e.origin,a=i.x,s=i.y,l=t.length-1,u=new Array(l+1);l>=0;l--)u[l]=this.render(t[l]);return o.h("div",{style:Object.assign({position:"absolute",transform:"translate("+(a-n)+"px,"+(s-r)+"px)"},e.isPolygon?Object.assign({height:"100%",width:"100%",overflow:e.clipMode},"visible"!==e.clipMode?U({},navigator.userAgent.includes("AppleWebKit")?"-webkit-clip-path":"clip-path","url(#clipPath"+e.id+")"):{}):{})},u)}},{key:"renderWorld",value:function Renderer_renderWorld_(e){for(var t=e.submorphs,n=[],r=[],i=0;i<t.length;i++){var a=t[i];a.hasFixedPosition?r.push(a):n.push(a)}var s=this.renderSelectedSubmorphs(e,n),l=o.h("div",Object.assign({},defaultAttributes(e,this),{style:defaultStyle(e)}),s);return l.fixedMorphs=r,l}},{key:"renderImage",value:function Renderer_renderImage_(e){return o.h("div",Object.assign({},defaultAttributes(e,this),{style:defaultStyle(e)}),[o.h("img",{src:e.imageUrl,draggable:!1,style:{"pointer-events":"none",position:"absolute",width:"100%",height:"100%"}}),this.renderSubmorphs(e)])}},{key:"renderCanvas",value:function Renderer_renderCanvas_(e){var t=function CanvasHook(){};return t.prototype.hook=function(t,n,r){var i=e._canvas!==t;e.afterRender(t,i)},o.h("div",Object.assign({},defaultAttributes(e,this),{style:defaultStyle(e)}),[o.h("canvas",{width:e.width,height:e.height,style:{"pointer-events":"none",position:"absolute"},canvasHook:new t}),this.renderSubmorphs(e)])}},{key:"renderCheckBox",value:function Renderer_renderCheckBox_(e){return o.h("div",Object.assign({},defaultAttributes(e,this),{style:defaultStyle(e)}),[o.h("input",{type:"checkbox",checked:e.checked,disabled:!e.active,draggable:!1,style:{"pointer-events":"none",width:"15px",height:"15px",position:"absolute"}}),this.renderSubmorphs(e)])}},{key:"renderPath",value:function Renderer_renderPath_(e){e.id;var t=e.startMarker,n=e.endMarker,r=e.showControlPoints,i=(e.origin,getSvgVertices(e.vertices)),a=o.h("path",Object.assign({namespace:ae,id:"svg"+e.id},function pathAttributes(e){var t=new SvgAnimation(e,"path"),n={};return addPathAttributes(e,n),Object.assign(n,e._animationQueue.maskedProps("path")),{animation:t,attributes:n}}(e))),s=[o.h("clipPath",{namespace:ae,id:"clipPath"+e.id},o.h("path",{namespace:ae,attributes:{d:i,fill:"white"}}))];t&&(t.id||(t.id="start-marker"),a.properties.attributes["marker-start"]="url(#"+e.id+"-"+t.id+")",(s=[]).push(this._renderPath_Marker(e,t))),n&&(n.id||(n.id="end-marker"),a.properties.attributes["marker-end"]="url(#"+e.id+"-"+n.id+")",s||(s=[]),s.push(this._renderPath_Marker(e,n)));var l=void 0;return r&&(l=o.h("g",{namespace:ae},this._renderPath_ControlPoints(e))),this.renderSvgMorph(e,a,s,l)}},{key:"_renderPath_ControlPoints",value:function Renderer__renderPath_ControlPoints_(e,t){var n=e.vertices,r=e.borderWidth,i=e.showControlPoints,a=e._controlPointDrag,s=0==r?6:r+2,l="red",u=[];if("object"===(void 0===i?"undefined":B(i))){var c=i.radius,h=i.fill;h&&(l=String(h)),"number"==typeof c&&(s=c)}if(n.length){var d=0,p=void 0,f=void 0,y=void 0,m=n[0],g=m.x,v=m.y,x=m.controlPoints.next,b=a&&a.maybeMerge&&a.maybeMerge.includes(d);for(p=g,f=v,u.push(circ(p,f,d,b)),y=x,d=1;d<n.length-1;d++){var w=n[d],_=w.isSmooth,k=w.x,S=w.y,M=w.controlPoints,C=M.previous,P=M.next,T=a&&a.maybeMerge&&a.maybeMerge.includes(d);_?u.push(circ(k,S,d,T),circ(p+y.x,f+y.y,d-1,!1,"control-2",!0),circ(k+C.x,S+C.y,d,!1,"control-1",!0)):u.push(circ(k,S,d,T)),p=k,f=S,y=P}var A=n[n.length-1],L=(_=A.isSmooth,A.x),R=A.y,E=(C=A.controlPoints.previous,a&&a.maybeMerge&&a.maybeMerge.includes(d));_?u.push(circ(L,R,d,E),circ(p+y.x,f+y.y,d-1,!1,"control-2",!0),circ(L+C.x,R+C.y,d,!1,"control-1",!0)):u.push(circ(L,R,d,E))}return u;function circ(e,t,n,r,i,a){var u=r?12:Math.min(8,Math.max(3,s)),c="path-point path-point-"+n,h=r?"orange":l;return"string"==typeof i&&(c+="-"+i),a&&(u=Math.max(3,Math.ceil(u/2))),a?o.h("circle",{namespace:ae,style:{fill:"white","stroke-width":2,stroke:h},attributes:{class:c,cx:e,cy:t,r:u}}):o.h("circle",{namespace:ae,style:{fill:h},attributes:{class:c,cx:e,cy:t,r:u}})}}},{key:"_renderPath_Marker",value:function Renderer__renderPath_Marker_(e,t){return function specTo_h_svg(t){var n=t.tagName;var i=t.id;var a=t.children;var s=t.style;var l=a?a.map(specTo_h_svg):void 0;i&&(i=e.id+"-"+i);return o.h(n,{namespace:ae,id:i,style:s,attributes:r.obj.dissoc(t,["tagName","id","children","style"])},l)}(t)}},{key:"renderSvgMorph",value:function Renderer_renderSvgMorph_(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=defaultStyle(e),s=a.position,l=a.filter,u=a.display,c=a.opacity,h=a.transform,d=a.transformOrigin,p=a.cursor,f=(a.overflow,function svgAttributes(e){var t=new SvgAnimation(e,"svg"),n={};return addSvgAttributes(e,n),Object.assign(n,e._animationQueue.maskedProps("svg")),{animation:t,attributes:n}}(e)),y=e.innerBounds(),m=y.width,g=y.height,v=void 0,x=[];(e.fill&&e.fill.isGradient&&(v||(v=[]),v.push(renderGradient(e,"fill"))),e.borderColor&&e.borderColor.valueOf().isGradient&&(v||(v=[]),v.push(renderGradient(e,"borderColor"))),n&&n.length)&&(v||(v=[]),(r=v).push.apply(r,X(n)));return x.push(t),v&&x.push(o.h("defs",{namespace:ae},v)),o.h("div",Object.assign({},defaultAttributes(e,this),{style:{transform:h,transformOrigin:d,position:s,opacity:c,cursor:p,width:m+"px",height:g+"px",display:u,filter:l,"pointer-events":e.reactsToPointer?"auto":"none"}}),[o.h("svg",Object.assign({namespace:ae,version:"1.1",style:{position:"absolute",overflow:"visible"}},f),x),this.renderSubmorphs(e),o.h("svg",Object.assign({namespace:ae,version:"1.1",style:{position:"absolute",overflow:"visible"}},f),i)])}},{key:"renderPreview",value:function Renderer_renderPreview_(e,n){var i=n.width,a=void 0===i?100:i,s=n.height,l=void 0===s?100:s,u=n.center,c=void 0===u||u,h=n.asNode,d=void 0!==h&&h,p=(n.includeStyles,n.disableScroll,e.borderWidthLeft,e.borderWidthTop,e.borderWidthBottom,e.borderWidthRight,e.scale),f=e.position,y=e.origin,m=e.rotation,g=a,v=l,x=Math.max(.1,1/p),b=new t.Transform(f.negated(),0,t.pt(x,x)).transformRectToRect(e.bounds()),w=b.width,_=b.height,k=Math.max(.1,Math.min(g/w,v/_)),S=function renderMorph(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.env.renderer;return o.create(e.render(t),t.domEnvironment)}(e),M=new t.Transform(b.topLeft().negated().scaleBy(k).subPt(y),m,t.pt(k,k));if(c){var C=M.transformRectToRect(e.extent.extentAsRectangle()),P=C.width<g?(g-C.width)/2:0,T=C.height<v?(v-C.height)/2:0;M=M.preConcatenate(new t.Transform(t.pt(P,T)))}return S.style.transform=M.toCSSTransformString(),S.style.pointerEvents="",r.tree.prewalk(S,function(e){if("string"==typeof e.className){var t=e.className.split(" ").map(function(e){return e.trim()}).filter(Boolean);t.includes("Morph")&&(e.className=r.arr.withoutAll(t,["morph","Morph"]).join(" "),e.id="")}},function(e){return Array.from(e.childNodes)}),d?S:S.outerHTML}}],[{key:"default",value:function Renderer_default_(){return this._default||new this}}],n,void 0,{start:565,end:17059})}(void 0),le=function(e){var t=_classRecorder,n=t.hasOwnProperty("FontDetector")&&"function"==typeof t.FontDetector?t.FontDetector:t.FontDetector=function FontDetector(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function FontDetector_initialize_(e){this.document=e,this.prepared=!1,this.defaultWidth={},this.defaultHeight={},this.baseFonts=["monospace","sans-serif","serif"],this.span=null}},{key:"prepare",value:function FontDetector_prepare_(){var e=this.defaultWidth,t=this.defaultHeight,n=this.baseFonts,r=this.document.getElementsByTagName("body")[0],i=this.span=this.document.createElement("span");for(var o in i.style.fontSize="72px",i.innerHTML="mmmmmmmmmmlli",n)i.style.fontFamily=n[o],r.appendChild(i),e[n[o]]=i.offsetWidth,t[n[o]]=i.offsetHeight,r.removeChild(i);this.prepared=!0}},{key:"isFontSupported",value:function FontDetector_isFontSupported_(e){this.prepared||this.prepare();var t=this.defaultWidth,n=this.defaultHeight,r=this.baseFonts,i=this.span,o=this.document.body;try{for(var a in o.appendChild(i),r){if(i.style.fontFamily=e+","+r[a],i.offsetWidth!=t[r[a]]||i.offsetHeight!=n[r[a]])return!0}return!1}finally{o.removeChild(i)}}}],[{key:"fonts",get:function get(){return ue}}],t,void 0,{start:15,end:2530})}(void 0),ue=[{name:"serif",type:"default"},{name:"sans-serif",type:"default"},{name:"monospace",type:"default"},{name:"Adobe Jenson",type:"serif"},{name:"Albertus",type:"serif"},{name:"Aldus",type:"serif"},{name:"Alexandria",type:"serif"},{name:"Algerian",type:"serif"},{name:"American Typewriter",type:"serif"},{name:"Antiqua",type:"serif"},{name:"Arno",type:"serif"},{name:"Aster",type:"serif"},{name:"Aurora",type:"serif"},{name:"News 706",type:"serif"},{name:"Baskerville",type:"serif"},{name:"Bell",type:"serif"},{name:"Belwe Roman",type:"serif"},{name:"Bembo",type:"serif"},{name:"Berkeley Old Style",type:"serif"},{name:"Bernhard Modern",type:"serif"},{name:"Bodoni",type:"serif"},{name:"Book Antiqua",type:"serif"},{name:"Bookman",type:"serif"},{name:"Bulmer",type:"serif"},{name:"Caledonia",type:"serif"},{name:"Californian FB",type:"serif"},{name:"Calisto MT",type:"serif"},{name:"Cambria",type:"serif"},{name:"Capitals",type:"serif"},{name:"Cartier",type:"serif"},{name:"Caslon",type:"serif"},{name:"Wyld",type:"serif"},{name:"Caslon Antique / Fifteenth Century",type:"serif"},{name:"Catull",type:"serif"},{name:"Centaur",type:"serif"},{name:"Century Old Style",type:"serif"},{name:"Century Schoolbook",type:"serif"},{name:"New Century Schoolbook",type:"serif"},{name:"Century Schoolbook Infant",type:"serif"},{name:"Charis SIL",type:"serif"},{name:"Charter (typeface)",type:"serif"},{name:"Cheltenham",type:"serif"},{name:"Clearface",type:"serif"},{name:"Cochin",type:"serif"},{name:"Colonna",type:"serif"},{name:"Computer Modern",type:"serif"},{name:"Concrete Roman",type:"serif"},{name:"Constantia",type:"serif"},{name:"Cooper Black",type:"serif"},{name:"Copperplate Gothic",type:"serif"},{name:"Corona",type:"serif"},{name:"News 705",type:"serif"},{name:"DejaVu Serif",type:"serif"},{name:"Didot",type:"serif"},{name:"Droid Serif",type:"serif"},{name:"Elephant",type:"serif"},{name:"Emerson",type:"serif"},{name:"Excelsior",type:"serif"},{name:"News 702",type:"serif"},{name:"Fairfield",type:"serif"},{name:"FF Scala",type:"serif"},{name:"Footlight",type:"serif"},{name:"FreeSerif",type:"serif"},{name:"Friz Quadrata",type:"serif"},{name:"Garamond",type:"serif"},{name:"Gentium",type:"serif"},{name:"Georgia",type:"serif"},{name:"Gloucester",type:"serif"},{name:"Goudy",type:"serif"},{name:"Granjon",type:"serif"},{name:"High Tower Text",type:"serif"},{name:"Hoefler Text",type:"serif"},{name:"Imprint",type:"serif"},{name:"Ionic No. 5",type:"serif"},{name:"News 701",type:"serif"},{name:"ITC Benguiat",type:"serif"},{name:"Janson",type:"serif"},{name:"Jokerman",type:"serif"},{name:"Joanna",type:"serif"},{name:"Korinna",type:"serif"},{name:"Lexicon",type:"serif"},{name:"Liberation Serif",type:"serif"},{name:"Linux Libertine",type:"serif"},{name:"Literaturnaya",type:"serif"},{name:"Lucida Bright",type:"serif"},{name:"Melior",type:"serif"},{name:"Memphis",type:"serif"},{name:"Miller",type:"serif"},{name:"Minion",type:"serif"},{name:"Modern",type:"serif"},{name:"Mona Lisa",type:"serif"},{name:"Mrs Eaves",type:"serif"},{name:"MS Serif",type:"serif"},{name:"New York",type:"serif"},{name:"Nimbus Roman",type:"serif"},{name:"NPS Rawlinson Roadway",type:"serif"},{name:"OCR A Extended",type:"serif"},{name:"Palatino",type:"serif"},{name:"Book Antiqua",type:"serif"},{name:"Perpetua",type:"serif"},{name:"Plantin",type:"serif"},{name:"Playbill",type:"serif"},{name:"Primer",type:"serif"},{name:"Renault",type:"serif"},{name:"Requiem",type:"serif"},{name:"Rotis Serif",type:"serif"},{name:"Sabon",type:"serif"},{name:"Sistina",type:"serif"},{name:"Souvenir",type:"serif"},{name:"XITS",type:"serif"},{name:"Sylfaen",type:"serif"},{name:"Times New Roman",type:"serif"},{name:"Times",type:"serif"},{name:"Torino",type:"serif"},{name:"Trajan",type:"serif"},{name:"Trinit",type:"serif"},{name:"Trump Mediaeval",type:"serif"},{name:"Utopia",type:"serif"},{name:"Vera Serif",type:"serif"},{name:"Wide Latin",type:"serif"},{name:"Windsor",type:"serif"},{name:"XITS",type:"serif"},{name:"Playfair Display",type:"serif",isGoogleFont:!0},{name:"Cormorant",type:"serif",isGoogleFont:!0},{name:"Eczar",type:"serif",isGoogleFont:!0},{name:"Alegreya",type:"serif",isGoogleFont:!0},{name:"Lora",type:"serif",isGoogleFont:!0},{name:"Source Serif Pro",type:"serif",isGoogleFont:!0},{name:"Roboto Slab",type:"serif",isGoogleFont:!0},{name:"BioRhyme",type:"serif",isGoogleFont:!0},{name:"Libre Baskerville",type:"serif",isGoogleFont:!0},{name:"Crimson Text",type:"serif",isGoogleFont:!0},{name:"Old Standard TT",type:"serif",isGoogleFont:!0},{name:"Domine",type:"serif",isGoogleFont:!0},{name:"Bitter",type:"serif",isGoogleFont:!0},{name:"Gentium Basic",type:"serif",isGoogleFont:!0},{name:"PT Serif",type:"serif",isGoogleFont:!0},{name:"Cardo",type:"serif",isGoogleFont:!0},{name:"Neuton",type:"serif",isGoogleFont:!0},{name:"Arvo",type:"serif",isGoogleFont:!0},{name:"Merriweather",type:"serif",isGoogleFont:!0},{name:"Alexandria",type:"slab serif"},{name:"American Typewriter",type:"slab serif"},{name:"Archer",type:"slab serif"},{name:"Athens",type:"slab serif"},{name:"Candida",type:"slab serif"},{name:"Cholla Slab",type:"slab serif"},{name:"City",type:"slab serif"},{name:"Clarendon",type:"slab serif"},{name:"Concrete Roman",type:"slab serif"},{name:"Courier",type:"slab serif"},{name:"Egyptienne",type:"slab serif"},{name:"Guardian Egyptian",type:"slab serif"},{name:"Ionic No. 5",type:"slab serif"},{name:"Lexia",type:"slab serif"},{name:"Memphis",type:"slab serif"},{name:"Nilland",type:"slab serif"},{name:"Roboto Slab",type:"slab serif"},{name:"Rockwell",type:"slab serif"},{name:"Schadow",type:"slab serif"},{name:"Serifa",type:"slab serif"},{name:"Skeleton Antique",type:"slab serif"},{name:"Sreda",type:"slab serif"},{name:"Swift",type:"slab serif"},{name:"Tower",type:"slab serif"},{name:"Agency FB",type:"sans-serif"},{name:"Akzidenz-Grotesk",type:"sans-serif"},{name:"Andal Sans",type:"sans-serif"},{name:"Antique Olive",type:"sans-serif"},{name:"Arial",type:"sans-serif"},{name:"Arial Unicode MS",type:"sans-serif"},{name:"Avant Garde Gothic",type:"sans-serif"},{name:"Avenir",type:"sans-serif"},{name:"Bank Gothic",type:"sans-serif"},{name:"Bauhaus",type:"sans-serif"},{name:"Bell Centennial",type:"sans-serif"},{name:"Bell Gothic",type:"sans-serif"},{name:"Benguiat Gothic",type:"sans-serif"},{name:"Berlin Sans",type:"sans-serif"},{name:"Brandon Grotesque",type:"sans-serif"},{name:"Calibri",type:"sans-serif"},{name:"Casey",type:"sans-serif"},{name:"Century Gothic",type:"sans-serif"},{name:"Charcoal",type:"sans-serif"},{name:"Chicago",type:"sans-serif"},{name:"Clearview",type:"sans-serif"},{name:"Comic Sans",type:"sans-serif"},{name:"Compacta",type:"sans-serif"},{name:"Corbel",type:"sans-serif"},{name:"DejaVu Sans",type:"sans-serif"},{name:"DIN",type:"sans-serif"},{name:"Dotum",type:"sans-serif"},{name:"Droid Sans",type:"sans-serif"},{name:"Dyslexie",type:"sans-serif"},{name:"Ecofont",type:"sans-serif"},{name:"Eras",type:"sans-serif"},{name:"Esseltub",type:"sans-serif"},{name:"Espy Sans",type:"sans-serif"},{name:"Eurocrat",type:"sans-serif"},{name:"Eurostile",type:"sans-serif"},{name:"Square 721",type:"sans-serif"},{name:"FF Dax",type:"sans-serif"},{name:"FF Meta",type:"sans-serif"},{name:"FF Scala Sans",type:"sans-serif"},{name:"Fira Sans",type:"sans-serif"},{name:"Folio",type:"sans-serif"},{name:"Franklin Gothic",type:"sans-serif"},{name:"FreeSans",type:"sans-serif"},{name:"Frutiger",type:"sans-serif"},{name:"Futura",type:"sans-serif"},{name:"Geneva",type:"sans-serif"},{name:"Gill Sans",type:"sans-serif"},{name:"Gill Sans Schoolbook",type:"sans-serif"},{name:"Gotham",type:"sans-serif"},{name:"Haettenschweiler",type:"sans-serif"},{name:"Handel Gothic",type:"sans-serif"},{name:"Hei",type:"sans-serif"},{name:"Helvetica",type:"sans-serif"},{name:"Helvetica Neue",type:"sans-serif"},{name:"Swiss 721",type:"sans-serif"},{name:"Highway Gothic",type:"sans-serif"},{name:"Hobo",type:"sans-serif"},{name:"Impact",type:"sans-serif"},{name:"Industria",type:"sans-serif"},{name:"Interstate",type:"sans-serif"},{name:"Johnston/New Johnston",type:"sans-serif"},{name:"Kabel",type:"sans-serif"},{name:"Klavika",type:"sans-serif"},{name:"Lexia Readable",type:"sans-serif"},{name:"Liberation Sans",type:"sans-serif"},{name:"Linux Biolinum",type:"sans-serif"},{name:"Lucida Sans",type:"sans-serif"},{name:"Lucida Grande",type:"sans-serif"},{name:"Lucida Sans Unicode",type:"sans-serif"},{name:"Lydian",type:"sans-serif"},{name:"Meiryo",type:"sans-serif"},{name:"Meta",type:"sans-serif"},{name:"Microgramma",type:"sans-serif"},{name:"Modern",type:"sans-serif"},{name:"Motorway",type:"sans-serif"},{name:"Arial",type:"sans-serif"},{name:"Myriad",type:"sans-serif"},{name:"Neutraface",type:"sans-serif"},{name:"Neuzeit S",type:"sans-serif"},{name:"News Gothic",type:"sans-serif"},{name:"Nimbus Sans L",type:"sans-serif"},{name:"Open Sans",type:"sans-serif"},{name:"Optima",type:"sans-serif"},{name:"Paris",type:"sans-serif"},{name:"Product Sans",type:"sans-serif"},{name:"Proxima Nova",type:"sans-serif"},{name:"Russian Federation",type:"sans-serif"},{name:"Rail Alphabet",type:"sans-serif"},{name:"Roboto",type:"sans-serif"},{name:"Rotis Sans",type:"sans-serif"},{name:"Segoe UI",type:"sans-serif"},{name:"Skia",type:"sans-serif"},{name:"Source Sans Pro",type:"sans-serif"},{name:"Sweden Sans",type:"sans-serif"},{name:"Syntax",type:"sans-serif"},{name:"Tahoma",type:"sans-serif"},{name:"Template Gothic",type:"sans-serif"},{name:"Thesis Sans",type:"sans-serif"},{name:"Tiresias",type:"sans-serif"},{name:"Trade Gothic",type:"sans-serif"},{name:"Transport",type:"sans-serif"},{name:"Trebuchet MS",type:"sans-serif"},{name:"Twentieth Century (Tw Cen MT)",type:"sans-serif"},{name:"Ubuntu",type:"sans-serif"},{name:"Univers",type:"sans-serif"},{name:"Zurich",type:"sans-serif"},{name:"Vera Sans",type:"sans-serif"},{name:"Verdana",type:"sans-serif"},{name:"Work Sans",type:"sans-serif",isGoogleFont:!0},{name:"Rubik",type:"sans-serif",isGoogleFont:!0},{name:"Libre Franklin",type:"sans-serif",isGoogleFont:!0},{name:"Fira Sans",type:"sans-serif",isGoogleFont:!0},{name:"Alegreya Sans",type:"sans-serif",isGoogleFont:!0},{name:"Chivo",type:"sans-serif",isGoogleFont:!0},{name:"Source Sans Pro",type:"sans-serif",isGoogleFont:!0},{name:"Roboto",type:"sans-serif",isGoogleFont:!0},{name:"Poppins",type:"sans-serif",isGoogleFont:!0},{name:"Archivo Narrow",type:"sans-serif",isGoogleFont:!0},{name:"Karla",type:"sans-serif",isGoogleFont:!0},{name:"Montserrat",type:"sans-serif",isGoogleFont:!0},{name:"Rajdhani",type:"sans-serif",isGoogleFont:!0},{name:"PT Sans",type:"sans-serif",isGoogleFont:!0},{name:"Lato",type:"sans-serif",isGoogleFont:!0},{name:"Open Sans",type:"sans-serif",isGoogleFont:!0},{name:"Cabin",type:"sans-serif",isGoogleFont:!0},{name:"Raleway",type:"sans-serif",isGoogleFont:!0},{name:"Nyala",type:"semi-serif"},{name:"Rotis Semi Serif",type:"semi-serif"},{name:"Easyreading",type:"semi-serif"},{name:"Andal Mono",type:"monospace"},{name:"Arial",type:"monospace"},{name:"Bitstream Vera (Vera Sans Mono)",type:"monospace"},{name:"Consolas",type:"monospace"},{name:"Courier",type:"monospace"},{name:"Courier New",type:"monospace"},{name:"DejaVu Sans Mono",type:"monospace"},{name:"Droid Sans Mono",type:"monospace"},{name:"Everson Mono",type:"monospace"},{name:"Fixed",type:"monospace"},{name:"Fixedsys",type:"monospace"},{name:"Fixedsys Excelsior",type:"monospace"},{name:"HyperFont",type:"monospace"},{name:"Inconsolata",type:"monospace"},{name:"Letter Gothic",type:"monospace"},{name:"Liberation Mono",type:"monospace"},{name:"Lucida Console",type:"monospace"},{name:"Lucida Sans Typewriter",type:"monospace"},{name:"Lucida Typewriter",type:"monospace"},{name:"Menlo",type:"monospace"},{name:"MICR",type:"monospace"},{name:"Monaco",type:"monospace"},{name:"Monospace",type:"monospace"},{name:"MS Gothic",type:"monospace"},{name:"MS Mincho",type:"monospace"},{name:"Nimbus Mono L",type:"monospace"},{name:"OCR-A",type:"monospace"},{name:"OCR-B",type:"monospace"},{name:"PragmataPro",type:"monospace"},{name:"Prestige Elite",type:"monospace"},{name:"ProFont",type:"monospace"},{name:"Proggy programming fonts",type:"monospace"},{name:"SimHei",type:"monospace"},{name:"SimSun",type:"monospace"},{name:"Source Code Pro",type:"monospace"},{name:"Terminal",type:"monospace"},{name:"Trixie",type:"monospace"},{name:"Ubuntu Mono",type:"monospace"},{name:"Vera Sans Mono (Bitstream Vera)",type:"monospace"},{name:"Space Mono",type:"monospace",isGoogleFont:!0},{name:"Inconsolata",type:"monospace",isGoogleFont:!0},{name:"Anonymous Pro",type:"monospace",isGoogleFont:!0},{name:"Balloon",type:"script"},{name:"Brush Script",type:"script"},{name:"Choc",type:"script"},{name:"Dom Casual",type:"script"},{name:"Mistral",type:"script"},{name:"Papyrus",type:"script"},{name:"Segoe Script",type:"script"},{name:"Utopia",type:"script"},{name:"Coronet",type:"script"},{name:"Curlz",type:"script"},{name:"Gravura",type:"script"},{name:"Script",type:"script"},{name:"Wiesbaden Swing",type:"script"},{name:"American Scribe",type:"script"},{name:"AMS Euler",type:"script"},{name:"Apple Chancery",type:"script"},{name:"Forte",type:"script"},{name:"French Script",type:"script"},{name:"ITC Zapf Chancery",type:"script"},{name:"Kuenstler Script",type:"script"},{name:"Monotype Corsiva",type:"script"},{name:"Old English Text MT",type:"script"},{name:"Zapfino",type:"script"},{name:"Andy",type:"handwriting"},{name:"Ashley Script",type:"handwriting"},{name:"Czanne",type:"handwriting"},{name:"Chalkboard",type:"handwriting"},{name:"Comic Sans MS",type:"handwriting"},{name:"Dom Casual",type:"handwriting"},{name:"Kristen",type:"handwriting"},{name:"Lucida Handwriting",type:"handwriting"},{name:"Bastard",type:"blackletter"},{name:"Breitkopf Fraktur",type:"blackletter"},{name:"Cloister Black",type:"blackletter"},{name:"Fette Fraktur",type:"blackletter"},{name:"Fletcher",type:"blackletter"},{name:"Fraktur",type:"blackletter"},{name:"Lucida Blackletter",type:"blackletter"},{name:"Old English Text",type:"blackletter"},{name:"Schwabacher",type:"blackletter"},{name:"Aharoni",type:"non-latin"},{name:"Aparajita",type:"non-latin"},{name:"Arial",type:"non-latin"},{name:"Calibri",type:"non-latin"},{name:"Chandas",type:"non-latin"},{name:"Gadugi",type:"non-latin"},{name:"Grecs du roi",type:"non-latin"},{name:"Javanese script",type:"non-latin"},{name:"Japanese Gothic",type:"non-latin"},{name:"Jomolhari",type:"non-latin"},{name:"Kiran",type:"non-latin"},{name:"Kochi",type:"non-latin"},{name:"Koren",type:"non-latin"},{name:"Kruti Dev",type:"non-latin"},{name:"Malgun Gothic",type:"non-latin"},{name:"Meiryo",type:"non-latin"},{name:"Microsoft JhengHei",type:"non-latin"},{name:"Microsoft YaHei",type:"non-latin"},{name:"Minch",type:"non-latin"},{name:"Ming",type:"non-latin"},{name:"Mona",type:"non-latin"},{name:"MS Gothic",type:"non-latin"},{name:"Nastaliq Navees",type:"non-latin"},{name:"Porson",type:"non-latin"},{name:"Segoe UI Symbol",type:"non-latin"},{name:"Shruti",type:"non-latin"},{name:"SimSun",type:"non-latin"},{name:"Sylfaen",type:"non-latin"},{name:"Tahoma",type:"non-latin"},{name:"Tengwar",type:"non-latin"},{name:"Tibetan Machine Uni",type:"non-latin"},{name:"Wilson Greek",type:"non-latin"},{name:"SMP",type:"unicode"},{name:"Microsoft Office",type:"unicode"},{name:"Bitstream Cyberbit",type:"unicode"},{name:"DejaVu fonts",type:"unicode"},{name:"Charis SIL",type:"unicode"},{name:"BMP",type:"unicode"},{name:"SMP",type:"unicode"},{name:"Code2002",type:"unicode"},{name:"DejaVu fonts",type:"unicode"},{name:"IPA",type:"unicode"},{name:"Everson Mono",type:"unicode"},{name:"Windows",type:"unicode"},{name:"Fixedsys Excelsior",type:"unicode"},{name:"FreeFont",type:"unicode"},{name:"Gentium",type:"unicode"},{name:"GNU Unifont",type:"unicode"},{name:"Georgia Ref",type:"unicode"},{name:"Microsoft Office",type:"unicode"},{name:"Junicode",type:"unicode"},{name:"Mac OS 8.5",type:"unicode"},{name:"macOS",type:"unicode"},{name:"ISO 8859-x",type:"unicode"},{name:"MS Gothic",type:"unicode"},{name:"MS Mincho",type:"unicode"},{name:"Nimbus Sans Global",type:"unicode"},{name:"Noto",type:"unicode"},{name:"Fabrizio Schiavi",type:"unicode"},{name:"Squarish Sans CT",type:"unicode"},{name:"XITS",type:"unicode"},{name:"Titus Cyberbit Basic",type:"unicode"},{name:"Verdana Ref",type:"unicode"},{name:"XITS",type:"unicode"},{name:"Apple Symbols",type:"symbol"},{name:"Asana-Math",type:"symbol"},{name:"Blackboard bold",type:"symbol"},{name:"Bookshelf Symbol 7",type:"symbol"},{name:"Cambria Math",type:"symbol"},{name:"Computer Modern",type:"symbol"},{name:"Lucida Math",type:"symbol"},{name:"Marlett",type:"symbol"},{name:"Symbol",type:"symbol"},{name:"Webdings",type:"symbol"},{name:"Wingdings",type:"symbol"},{name:"Wingdings 2",type:"symbol"},{name:"Wingdings 3",type:"symbol"},{name:"Zapf Dingbats",type:"symbol"},{name:"Ad Lib",type:"decorative"},{name:"Allegro",type:"decorative"},{name:"Andreas",type:"decorative"},{name:"Arnold Bcklin",type:"decorative"},{name:"Astur",type:"decorative"},{name:"Banco",type:"decorative"},{name:"Bauhaus",type:"decorative"},{name:"Braggadocio",type:"decorative"},{name:"Broadway",type:"decorative"},{name:"Caslon Antique",type:"decorative"},{name:"Cooper Black",type:"decorative"},{name:"Curlz",type:"decorative"},{name:"Ellington",type:"decorative"},{name:"Exocet",type:"decorative"},{name:"FIG Script",type:"decorative"},{name:"Forte",type:"decorative"},{name:"Gabriola",type:"decorative"},{name:"Horizon",type:"decorative"},{name:"Jim Crow",type:"decorative"},{name:"Lo-Type",type:"decorative"},{name:"Neuland",type:"decorative"},{name:"Peignot",type:"decorative"},{name:"San Francisco",type:"decorative"},{name:"Stencil",type:"decorative"},{name:"Umbra",type:"decorative"},{name:"Westminster",type:"decorative"},{name:"Willow",type:"decorative"},{name:"Windsor",type:"decorative"},{name:"Lithos",type:"mimicry"},{name:"Skia",type:"mimicry"},{name:"3x3",type:"misc"},{name:"Compatil",type:"misc"},{name:"Generis",type:"misc"},{name:"Grasset",type:"misc"},{name:"LED",type:"misc"},{name:"Luxi",type:"misc"},{name:"System",type:"misc"}],ce=function(e){var t=_classRecorder,n=t.hasOwnProperty("FontMetric")&&"function"==typeof t.FontMetric?t.FontMetric:t.FontMetric=function FontMetric(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function FontMetric_initialize_(){this.charMap={},this.cachedBoundsInfo={},this.element=null,this.isProportionalCache={}}},{key:"reset",value:function FontMetric_reset_(e){var t,n;this.element&&(n=this.element.parentNode,t=this.element.ownerDocument),this.uninstall(),this.charMap={},this.cachedBoundsInfo={},t&&n&&this.install(t,n,e)}},{key:"install",value:function FontMetric_install_(e,t,n){this.element=e.createElement("div"),this.element.name="fontMetric",this.setMeasureNodeStyles(this.element.style,!0),t.appendChild(this.element),this._domMeasure=(new he).install(e,t,n)}},{key:"uninstall",value:function FontMetric_uninstall_(){this.element&&(this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this._domMeasure&&this._domMeasure.uninstall())}},{key:"setMeasureNodeStyles",value:function FontMetric_setMeasureNodeStyles_(e,t){e.width=e.height="auto",e.left=e.top="0px",e.visibility="hidden",e.position="absolute",e.whiteSpace="pre",e.font="inherit",e.overflow=t?"hidden":"visible"}},{key:"measure",value:function FontMetric_measure_(e,t){var n,r,i=e.fontFamily,o=e.fontSize,a=e.fontWeight,s=e.fontStyle,l=e.textDecoration,u=e.textStyleClasses,c=e.transform,h=this.element;c&&(c=c.inverse()),h.textContent=t,Object.assign(h.style,{fontFamily:i,fontWeight:a,fontStyle:s,textDecoration:l,transform:c,fontSize:o+"px"}),h.className=u?u.join(" "):"";try{var d=h.getBoundingClientRect();n=d.width,r=d.height}catch(e){return{width:0,height:0}}return{height:r,width:n}}},{key:"charBoundsFor",value:function FontMetric_charBoundsFor_(e,t){var n=t.length,i=new Array(n),o=this.cachedBoundsInfo,a=o.bounds,s=o.str,l=o.style;if(!this.isProportional(e.fontFamily))for(var u=this.sizeFor(e,"x",!0),c=this.sizeFor(e,"xx",!0).width-u.width,h=u.height,d=0,p=0;p<n;p++)d=c*p,i[p]={x:d,y:0,width:c,height:h};else{for(var f=a&&r.obj.equals(l,e),y=!e.fixedCharacterSpacing,m=0,g=0;m<n;m++){var v=void 0,x=void 0,b=t[m];if(y)if(f=f&&b===s[m]){var w=a[m];v=w.width,x=w.height}else{var _=t.substr(0,m+1),k=this.measure(e,_);v=k.width,x=k.height,v-=g}else{var S=this.sizeFor(e,b);v=S.width,x=S.height}i[m]={x:g,y:0,width:v,height:x},g+=v}y&&(this.cachedBoundsInfo={bounds:i,str:t,style:e})}return i}},{key:"isProportional",value:function FontMetric_isProportional_(e){if(this.isProportionalCache.hasOwnProperty(e))return this.isProportionalCache[e];var t={fontFamily:e,fontSize:12},n=this.sizeFor(t,"w").width,r=this.sizeFor(t,"i").width;return this.isProportionalCache[e]=n!==r}},{key:"sizeFor",value:function FontMetric_sizeFor_(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.fontFamily,i=e.fontSize,o=e.fontWeight,a=e.fontStyle,s=e.textDecoration,l=e.textStyleClasses,u={fontFamily:r,fontSize:i,fontWeight:o,fontStyle:a,textDecoration:s,textStyleClasses:l};if(!n&&t.length>1)return this.measure(u,t);var c=[r,i,o,a,s,l?l.join(" "):""].join("-");return this.charMap[c]||(this.charMap[c]={}),this.charMap[c][t]||(this.charMap[c][t]=this.measure(u,t)),this.charMap[c][t]}},{key:"defaultLineHeight",value:function FontMetric_defaultLineHeight_(e){return this.sizeFor(e," ").height}},{key:"isFontSupported",value:function FontMetric_isFontSupported_(e){return(this.fontDetector||(this.fontDetector=new le(this.element.ownerDocument))).isFontSupported(e)}},{key:"defaultCharExtent",value:function FontMetric_defaultCharExtent_(e,t,n){return this._domMeasure.defaultCharExtent(e,t,n)}},{key:"manuallyComputeCharBoundsOfLine",value:function FontMetric_manuallyComputeCharBoundsOfLine_(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3];var n=arguments[4],r=arguments[5],i=arguments[6];return this._domMeasure.computeCharBBoxes(e,t,0,0,n,r,i,this)}},{key:"manuallyComputeBoundsOfLines",value:function FontMetric_manuallyComputeBoundsOfLines_(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3];var n=arguments[4],r=arguments[5],i=arguments[6];return this._domMeasure.computeBBoxesOfLines(e,t,0,0,n,r,i)}}],[{key:"default",value:function FontMetric_default_(){if(!this._fontMetric)throw new Error("FontMetric has not yet been initialized!");return this._fontMetric}},{key:"initDefault",value:function FontMetric_initDefault_(e){if(!this._fontMetric){if(!e&&"undefined"==typeof document)throw new Error("Cannot initialize FontMetric without document");e||(e={document:document}),this._fontMetric=this.forDOMEnv(e)}return this._fontMetric}},{key:"removeDefault",value:function FontMetric_removeDefault_(){this._fontMetric&&(this._fontMetric.uninstall(),this._fontMetric=null)}},{key:"forDOMEnv",value:function FontMetric_forDOMEnv_(e){var t=e.document,n=new ce;return n.install(t,t.body),n}}],t,void 0,{start:290,end:6770})}(void 0);var he=function(e){var t=_classRecorder,n=t.hasOwnProperty("DOMTextMeasure")&&"function"==typeof t.DOMTextMeasure?t.DOMTextMeasure:t.DOMTextMeasure=function DOMTextMeasure(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:"reset",value:function DOMTextMeasure_reset_(){var e,t;return this.element&&(t=this.element.parentNode,e=this.element.ownerDocument),this.uninstall(),e&&t&&this.install(e,t),this}},{key:"install",value:function DOMTextMeasure_install_(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.debug=n,this.maxLineBBoxCacheCount=n?1:3e3,this.lineBBoxCacheCount=0,this.lineBBoxCache={},this.maxTextlayerNodeCacheCount=n?1:30,this.textlayerNodeCacheCount=0,this.textlayerNodeCache={},this.defaultCharWidthHeightCache={},this.doc=e;var r=this.element=e.createElement("div");return r.className="dom-measure"+(n?" debug":""),this.setMeasureNodeStyles(r.style,!0),t.appendChild(r),this}},{key:"uninstall",value:function DOMTextMeasure_uninstall_(){var e=this.element;e&&(e.parentNode&&e.parentNode.removeChild(e),this.element=null)}},{key:"setMeasureNodeStyles",value:function DOMTextMeasure_setMeasureNodeStyles_(e,t){e.width=e.height="auto",this.debug||(e.left=e.top="0px",e.visibility="hidden"),e.position="absolute",e.whiteSpace="pre",e.font="inherit",e.overflow=t&&!this.debug?"hidden":"visible"}},{key:"generateStyleKey",value:function DOMTextMeasure_generateStyleKey_(e){var t=e.defaultTextStyle;return[t.fontFamily,t.fontSize,t.fontWeight,t.fontStyle,t.textDecoration,t.textStyleClasses,e.paddingLeft,e.paddingRight,e.paddingTop,e.paddingBottom,e.width,e.height,e.clipMode,e.lineWrapping,e.textAlign].join("-")}},{key:"defaultCharExtent",value:function DOMTextMeasure_defaultCharExtent_(e,t,n){var r=this,i=this.generateStyleKey(t),o=this.defaultCharWidthHeightCache[i];if(void 0!==o&&(0!==o.height||0!==o.width))return o;var a=this.doc,s="abcdefghijklmnopqrstufwxyz ABCDEFGHIJKLMNOPQRSTUFWXYZ 1234567890 {}[];,./<>?'\"!@#$%^&*()-=_+";return this.withTextLayerNodeDo(e,n,t,i,function(e){var t=a.createElement("span");t.className="line",t.style.whiteSpace="pre",e.appendChild(t),t.textContent=s;var n=t.getBoundingClientRect().width,o=a.createElement("span");o.className="line",o.style.whiteSpace="pre",e.appendChild(o),o.textContent="H\ne\nll\no";var l=o.getBoundingClientRect().height;return e.removeChild(t),e.removeChild(o),r.defaultCharWidthHeightCache[i]={width:n/s.length,height:Math.ceil(l/4)}})}},{key:"computeBBoxesOfLines",value:function DOMTextMeasure_computeBBoxesOfLines_(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments[4],o=this,a=arguments[5],s=arguments[6],l=this.generateStyleKey(i),u=new Array(t.length),c=!0,h=0;h<t.length;h++){var d=!t[h].textAttributes.length&&this.lineBBoxCache[l+"_"+t[h].text];d&&d.height&&d.width?u[h]=d:c=!1}return c?u:this.withTextLayerNodeDo(e,a,i,l,function(e,i,a){for(var u=new Array(t.length),c=new Array(t.length),h=(o.doc,0);h<t.length;h++)if(!c[h]){var d=s(t[h]);d.style.display="inline-block",e.appendChild(d),u[h]=d}for(var p=0;p<u.length;p++)if(!c[p]){var f=u[p],y=f.getBoundingClientRect(),m=y.left,g=y.top,v=y.width,x=y.height;o.lineBBoxCache[l+"_"+t[p].text]=c[p]={x:m-f.offsetLeft+n-i,y:g-f.offsetTop+r-a,width:v,height:x}}for(var b=0;b<u.length;b++)e.removeChild(u[b]);return c})}},{key:"computeCharBBoxes",value:function DOMTextMeasure_computeCharBBoxes_(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments[4],o=arguments[5],a=this,s=arguments[6],l=arguments[7];return this.withTextLayerNodeDo(e,o,i,this.generateStyleKey(i),function(u,c,h){var d=s(t),p=(u.appendChild(d),a.doc,t.stringSize>1e4&&function charBoundsOfBigMonospacedLine(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments[6],s=arguments[7],l=n.text.length;if(l<500||t.isProportional(pe(r)))return null;var u=1/0,c=a.defaultTextStyle;if(a.lineWrapping){var h=r.getBoundingClientRect();u=h.width,h.height}for(var d=t._domMeasure.defaultCharExtent(e,{defaultTextStyle:c},s),p=d.width,f=d.height,y=i,m=o,g=new Array(l),v=0;v<l;v++)y+p>u&&(y=0,m+=f),g[v]={x:y,y:m,width:p,height:f},y+=p;return g}(e,l,t,d,n,r,i,o)||function charBoundsOfLine(e,t){var n,r,i,o,a,s,l,u,c,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=t.ELEMENT_NODE,f=t.TEXT_NODE,y=(t.childNodes,1/0),m=t.ownerDocument,g=[],v=0;if(t)if(t.className.includes("line"))h-=t.offsetLeft,d-=t.offsetTop,c=t.childNodes[0];else{var x=t.getElementsByClassName("line")[0];c=x.childNodes[0];h=h-t.offsetLeft+fe(t),d-=t.offsetTop}else c=null;c||(u=c=m.createElement("br"),t.appendChild(u));for(;c&&!(v>y);){if((n="BR"!==c.tagName&&c.nodeType===p&&c.childNodes[0]||c).nodeType===f)for(var b=n.length,w=0;w<b;w++){var _=measureCharInner(m,n,w,"right");r=_.left,i=_.top,o=_.width,a=_.height,s=r+h,l=i+d,g[v++]={x:s,y:l,width:o,height:a}}else{if(c.nodeType!==p)throw new Error("Cannot deal with node "+c);var k=c.getBoundingClientRect();r=k.left,i=k.top,o=k.width,a=k.height,s=r+h,l=i+d,g[v++]={x:s,y:l,width:o,height:a}}c=c.nextSibling}u&&u.parentNode.removeChild(u);return g}(t,d,n-c,r-h));return a.debug||d.parentNode.removeChild(d),p})}},{key:"withTextLayerNodeDo",value:function DOMTextMeasure_withTextLayerNodeDo_(e,t,n,r,i){var o,a,s=this.doc,l=this.textlayerNodeCache,u=this.element,c=function textlayerNodeForFontMeasure(e){var t=e.viewState,n=t.text_layer_node,r=t.fontmetric_text_layer_node;return n&&(n.className.includes("newtext-text-layer")||(e.viewState.text_layer_node=n=n.parentNode.querySelector(".newtext-text-layer.actual"))),r&&(r.className.includes("newtext-text-layer")||(e.viewState.fontmetric_text_layer_node=r=null)),n&&!r&&n.parentNode&&(r=e.viewState.fontmetric_text_layer_node=n.parentNode.querySelector(".newtext-text-layer.font-measure")),r}(e);if(c||(c=l[r]),!c){this.textlayerNodeCacheCount++,(c=l[r]=t(n,[])).id=r;var h=n.width,d=n.clipMode;if(n.width||n.clipMode&&"visible"!==n.clipMode){var p=s.createElement("div");p.style.position="absolute",d&&(p.style.overflow=d),h&&(p.style.width=h+"px"),p.id=r,p.appendChild(c),u.appendChild(p)}else u.appendChild(c)}var f=e.getGlobalTransform().inverse();e.env.renderer&&e.env.renderer.getNodeForMorph(e)&&(1!=f.getScale()||0!=f.getRotation())&&(f.e=f.f=0,c.style.transform=f.toString());var y=c.getBoundingClientRect();o=y.left,a=y.top;try{return i(c,o,a)}finally{if(c.style.transform="",!this.debug&&this.textlayerNodeCacheCount>this.maxTextlayerNodeCacheCount){for(var m=Math.ceil(this.maxTextlayerNodeCacheCount/2),g=void 0;m--&&(g=u.childNodes[0]);)l[g.id]=null,u.removeChild(g);this.textlayerNodeCacheCount=this.textlayerNodeCacheCount-m}}}}],void 0,t,void 0,{start:10424,end:18786})}(void 0),de="undefined"!=typeof System?System.global:window||global||self||void 0,pe="function"==typeof de.getComputedStyle?function(e){return de.getComputedStyle(e).fontFamily}:function(){return""},fe="function"==typeof de.getComputedStyle?function(e){return parseInt(de.getComputedStyle(e).marginLeft)||0}:function(){return 0};function measureCharInner(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"left",i=void 0,o=n,a=n+1;if(3==t.nodeType)for(var s=0;s<4&&(!(i=getUsefulRect(range(e,t,o,a).getClientRects(),r)).left&&!i.right&&0!=o);s++)a=o,o-=1;return i}function range(e,t,n,r,i){var o=e.createRange();return o.setEnd(i||t,r),o.setStart(t,n),o}function getUsefulRect(e,t){var n={left:0,right:0,top:0,bottom:0};if("left"==t)for(var r=0;r<e.length&&(n=e[r]).left==n.right;r++);else for(var i=e.length-1;i>=0&&(n=e[i]).left==n.right;i--);return n}var ye=function(e){var t=_classRecorder,n=t.hasOwnProperty("Change")&&"function"==typeof t.Change?t.Change:t.Change=function Change(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function Change_initialize_(e){this.target=e,this.group=null}},{key:"type",get:function get(){return"abstract change"}},{key:"apply",value:function Change_apply_(){throw new Error("Not yet implemented")}},{key:"reverseApply",value:function Change_reverseApply_(){throw new Error("Not yet implemented")}}],void 0,t,void 0,{start:758,end:1008})}(void 0),me=function(e){var t=_classRecorder,n=t.hasOwnProperty("GroupChange")&&"function"==typeof t.GroupChange?t.GroupChange:t.GroupChange=function GroupChange(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function GroupChange_initialize_(e){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(n.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e),this.changes=[]}},{key:"consumesChanges",value:function GroupChange_consumesChanges_(){return!0}},{key:"addChange",value:function GroupChange_addChange_(e){this.changes.push(e),e.group=this}},{key:"apply",value:function GroupChange_apply_(){return this.changes.slice().forEach(function(e){return e.apply()}),this}},{key:"reverseApply",value:function GroupChange_reverseApply_(){return this.changes.slice().reverse().forEach(function(e){return e.reverseApply()}),this}}],void 0,t,void 0,{start:1017,end:1440})}(ye),ge=function(e){var t=_classRecorder,n=t.hasOwnProperty("ValueChange")&&"function"==typeof t.ValueChange?t.ValueChange:t.ValueChange=function ValueChange(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:"type",get:function get(){return"setter"}},{key:Symbol.for("lively-instance-initialize"),value:function ValueChange_initialize_(e,t,r,i){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(n.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e),this.prop=t,this.value=r,this.prevValue=null,this.meta=i}},{key:"apply",value:function ValueChange_apply_(){var e=this.target,t=this.prop,n=this.value;e[t]=n}},{key:"reverseApply",value:function ValueChange_reverseApply_(){var e=this.target,t=this.prop,n=this.prevValue;e[t]=n}}],void 0,t,void 0,{start:1449,end:1858})}(ye),ve=function(e){var t=_classRecorder,n=t.hasOwnProperty("MethodCallChange")&&"function"==typeof t.MethodCallChange?t.MethodCallChange:t.MethodCallChange=function MethodCallChange(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:"type",get:function get(){return"method-call"}},{key:Symbol.for("lively-instance-initialize"),value:function MethodCallChange_initialize_(e,t,r,i,o){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(n.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e),this.selector=t,this.args=r,this.undo=i,this.meta=o}},{key:"apply",value:function MethodCallChange_apply_(){var e=this.target,t=this.selector,n=this.args;e[t].apply(e,n)}},{key:"reverseApply",value:function MethodCallChange_reverseApply_(){if(this.undo)if("function"==typeof this.undo)this.undo();else{var e=this.undo,t=e.target,n=e.selector,r=e.args;t[n].apply(t,r)}}}],void 0,t,void 0,{start:1867,end:2440})}(me),xe=function(e){var t=_classRecorder,n=t.hasOwnProperty("ChangeManager")&&"function"==typeof t.ChangeManager?t.ChangeManager:t.ChangeManager=function ChangeManager(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function ChangeManager_initialize_(){this.reset()}},{key:"reset",value:function ChangeManager_reset_(){this.changes=[],this.changeRecordedListeners=[],this.revision=0,this.changeRecordersPerMorph=new WeakMap,this.changeRecorders={},this.changeGroupStack=[],this.defaultMeta={},this.metaStack=[]}},{key:"changesFor",value:function ChangeManager_changesFor_(e){return this.changes.filter(function(t){return t.target===e})}},{key:"apply",value:function ChangeManager_apply_(e,t){t.apply()}},{key:"doWithValueChangeMeta",value:function ChangeManager_doWithValueChangeMeta_(e,t,n){this.defaultMeta=e,this.metaStack.push(e);var i=n(t);return this.metaStack.pop(),this.defaultMeta=r.arr.last(this.metaStack)||{},i}},{key:"addValueChange",value:function ChangeManager_addValueChange_(e,t,n,r){var i=new ge(e,t,n,Object.assign({},this.defaultMeta,{},r));return this._record(e,i)}},{key:"addMethodCallChangeDoing",value:function ChangeManager_addMethodCallChangeDoing_(e,t,n){var r=e.target,i=e.selector,o=e.args,a=e.undo;a||(a=function undo(){return console.warn("No undo recorded for "+r+"."+i)});var s=new ve(r,i,o,a,this.defaultMeta);return t.groupChangesWhile(s,n),s}},{key:"_record",value:function ChangeManager__record_(e,t){t.hasOwnProperty("value")&&(t.prevValue=e._morphicState[t.prop],e._morphicState[t.prop]=t.value),e.makeDirty();var n=r.arr.last(this.changeGroupStack);return n&&n.consumesChanges()?n.addChange(t):(this.changes.push(t),e._rev=++this.revision,this.informChangeListeners(t)),function informMorph(e,t,n){try{n.onChange(t),function signalBindings(e,t,n){var r=e.attributeConnections;if(r){r=r.slice();for(var i=0;i<r.length;i++)r[i].sourceAttrName===t&&r[i].update(n)}}(n,"change",t);for(var r=n.owner;r;)r.onSubmorphChange(t,n),r=r.owner}catch(e){console.error("Error in informMorph: "+e.stack)}}(0,t,e),t}},{key:"groupChangesWhile",value:function ChangeManager_groupChangesWhile_(e,t,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];t||(t=new me(e)),this.changeGroupStack.push(t);try{return n(),r.arr.remove(this.changeGroupStack,t),i?this._record(e,t):t}catch(e){throw r.arr.remove(this.changeGroupStack,t),e}}},{key:"dontRecordChangesWhile",value:function ChangeManager_dontRecordChangesWhile_(e,t){return this.groupChangesWhile(e,void 0,t,!1)}},{key:"recordChangesWhile",value:function ChangeManager_recordChangesWhile_(e,t){var n=this.changes.length;e();var r=this.changes.slice(n,this.changes.length);return t?r.filter(t):r}},{key:"addChangeListener",value:function ChangeManager_addChangeListener_(e){r.arr.pushIfNotIncluded(this.changeRecordedListeners,e)}},{key:"removeChangeListener",value:function ChangeManager_removeChangeListener_(e){r.arr.remove(this.changeRecordedListeners,e)}},{key:"informChangeListeners",value:function ChangeManager_informChangeListeners_(e){this.changeRecordedListeners.forEach(function(t){return t(e)})}},{key:"recordChangesStart",value:function ChangeManager_recordChangesStart_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=r.obj.newKeyIn(this.changeRecorders,t+"__change_recorder_"+Date.now()),i=e?function(t){return e(t)&&o.changes.push(t)}:function(e){return o.changes.push(e)},o=this.changeRecorders[n]={id:n,filter:e,changes:[],listener:i};return this.addChangeListener(i),o}},{key:"recordChangesStop",value:function ChangeManager_recordChangesStop_(e){if(!(e in this.changeRecorders))return[];var t=this.changeRecorders[e],n=t.changes,r=t.listener;return delete this.changeRecorders[e],this.removeChangeListener(r),n}},{key:"recordChangesStartForMorph",value:function ChangeManager_recordChangesStartForMorph_(e,t){var n=this.recordChangesStart(t,e.id),r=this.changeRecordersPerMorph.get(e);return r||(r=[],this.changeRecordersPerMorph.set(e,r)),r.push(n.id),n}},{key:"recordChangesStopForMorph",value:function ChangeManager_recordChangesStopForMorph_(e,t){var n=this.changeRecordersPerMorph.get(e);if(!n||!n.length)return console.warn("Cannot endMorphChangeRecorder for morph "+e+": recorder not found"),[];var i=t;return t?r.arr.remove(n,i):i=n.pop(),this.recordChangesStop(i)}}],void 0,t,void 0,{start:2450,end:7446})}(void 0),be=function(e){var t=_classRecorder,n=t.hasOwnProperty("Undo")&&"function"==typeof t.Undo?t.Undo:t.Undo=function Undo(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function Undo_initialize_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.name=e,this.targets=t,this.recorder=null,this.changes=null,this.timestamp=null,this.no=n}},{key:"recorded",value:function Undo_recorded_(){return!!this.changes}},{key:"isRecording",value:function Undo_isRecording_(){return!!this.recorder}},{key:"startRecording",value:function Undo_startRecording_(e){var t=this;if(this.recorded()||this.isRecording())throw new Error("Undo already recorded / recording");if(!this.targets.length)throw new Error("Undo has no target morphs");this.timestamp=Date.now();var n=this.targets[0];return this.recorder=n.recordChangesStart(function(n){var r=n.target;return!r.isUsedAsEpiMorph()&&(!!t.targets.some(function(e){return e===r||e.isAncestorOf(r)})&&("function"!=typeof e||e(n)))}),this}},{key:"stopRecording",value:function Undo_stopRecording_(){this.name;var e=this.recorder,t=e.id,n=(e.changes,$(this.targets,1)[0]);this.changes=n.recordChangesStop(t),this.targets=null,this.recorder=null}},{key:"apply",value:function Undo_apply_(){if(!this.recorded())throw new Error("Cannot apply undo that has no changes recorded yet");return this.changes.slice().forEach(function(e){return e.apply()}),this}},{key:"reverseApply",value:function Undo_reverseApply_(){if(!this.recorded())throw new Error("Cannot reverseApply undo that has no changes recorded yet");return this.changes.slice().reverse().forEach(function(e){return e.reverseApply()}),this}},{key:"addTarget",value:function Undo_addTarget_(e){r.arr.pushIfNotIncluded(this.targets,e)}},{key:"addUndos",value:function Undo_addUndos_(e){(e=r.arr.sortBy(e.concat(this).filter(function(e){return e.recorded()}),function(e){return e.no})).length&&(this.changes=r.arr.flatmap(e,function(e){return e.changes}),this.timestamp=e[0].timestamp,this.no=e[0].no,this.name=e.map(function(e){return e.name}).join("-"))}},{key:"toString",value:function Undo_toString_(){var e=this.name,t=this.changes,n=this.no,r=this.isRecording(),i=t.length?"\n  "+t.map(function(e){var t=e.selector,n=e.args,r=e.prop,i=e.value,o=e.target;return t?o+"."+t+"("+n.map(printArg)+")":o+"."+r+" = "+printArg(i)}).join("\n  "):"no changes";return"Undo("+n+":"+e+" "+(r?"RECORDING ":"")+i+")"}}],void 0,t,void 0,{start:54,end:2487})}(void 0);function printArg(e){return r.obj.inspect(e,{maxDepth:1}).replace(/\n/g,"").replace(/\s+/g," ")}var we=function(e){var t=_classRecorder,n=t.hasOwnProperty("UndoManager")&&"function"==typeof t.UndoManager?t.UndoManager:t.UndoManager=function UndoManager(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function UndoManager_initialize_(e){this.reset(),this.filter=e}},{key:"reset",value:function UndoManager_reset_(){this.undos=[],this.redos=[],this.undoInProgress=null,this.applyCount=0,this.counter=0,this.grouping={current:[],debounce:null,debouncedCanceled:!1,debounceTime:31}}},{key:"group",value:function UndoManager_group_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.groupLaterCancel(),e&&this.undos.includes(e)&&(this.grouping.current=r.arr.uniq(this.undos.slice(this.undos.indexOf(e)).concat(this.grouping.current))),this.grouping.current.length){var t=this.grouping.current.slice(1);this.grouping.current[0].addUndos(t),this.undos=r.arr.withoutAll(this.undos,t),this.grouping.current=[]}}},{key:"ensureNewGroup",value:function UndoManager_ensureNewGroup_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"new undo group";return this.group(),this.undoStart(e,t),this.undoStop()}},{key:"groupLaterCancel",value:function UndoManager_groupLaterCancel_(){var e=this.grouping;e.debounce&&(e.debouncedCanceled=!0,this.grouping=Object.assign({},e,{debounce:null,debouncedCanceled:!1}))}},{key:"groupLater",value:function UndoManager_groupLater_(e){var t=this,n=this.grouping;(n.debounce||(n.debounce=r.fun.debounce(e||n.debounceTime,function(){n.debounce=null,n.debouncedCanceled||t.group()})))()}},{key:"undoStart",value:function UndoManager_undoStart_(e,t){if(!this.applyCount){if(!this.undoInProgress)return this.undoInProgress=new be(t,[e],this.counter++).startRecording(this.filter);console.warn("There is already an undo recorded")}}},{key:"undoStop",value:function UndoManager_undoStop_(){var e=this.undoInProgress;return e?(e.stopRecording(),this.undoInProgress=null,this.undos.push(e),this.grouping.current.push(e),this.redos.length&&(this.redos.length=0),e):null}},{key:"undo",value:function UndoManager_undo_(){this.undoStop();var e=this.undos.pop();if(e){r.arr.remove(this.grouping.current,e),this.redos.unshift(e),this.applyCount++;try{e.reverseApply()}finally{this.applyCount--}return e}}},{key:"redo",value:function UndoManager_redo_(){this.undoStop();var e=this.redos.shift();if(e){this.undos.push(e),this.applyCount++;try{e.apply()}finally{this.applyCount--}return e}}},{key:"toString",value:function UndoManager_toString_(){var e=0===this.undos.length?"":"\n  "+(this.undos.length>20?"...\n  ":"")+this.undos.slice(-20).join("\n  "),t=!!this.undoInProgress;return"UndoManager("+this.undos.length+" undos, "+this.redos.length+" redos, "+(t?", UNDO IN PROGRESS":"")+e+")"}}],void 0,t,void 0,{start:2619,end:5662})}(void 0),_e=new RegExp("","g"),ke=function(e){var t=_classRecorder,i=t.hasOwnProperty("TextInput")&&"function"==typeof t.TextInput?t.TextInput:t.TextInput=function TextInput(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(i,e,[{key:Symbol.for("lively-instance-initialize"),value:function TextInput_initialize_(e){this.eventDispatcher=e,this.domState={rootNode:null,textareaNode:null,eventHandlers:[],isInstalled:!1},this.inputState={composition:null,manualCopy:null,manualPaste:null,positionChangedTime:0,scrollLeftWhenChanged:0,scrollTopWhenChanged:0}}},{key:"install",value:function TextInput_install_(e){var t=this,r=this.domState,i=r.isInstalled,o=r.rootNode;if(i){if(o===e)return;this.uninstall()}r.isInstalled=!0,r.rootNode=e,e.tabIndex=1;var a=e.ownerDocument,s=r.textareaNode=a.createElement("textarea");return s.setAttribute("style","\n      position: absolute;\n      /*extent cannot be 0, input won't work correctly in Chrome 52.0*/\n      width: 20px; height: 20px;\n      z-index: 0;\n      opacity: 1;\n      background: transparent;\n      -moz-appearance: none;\n      appearance: none;\n      border: none;\n      resize: none;\n      outline: none;\n      overflow: hidden;\n      font: inherit;\n      padding: 0 1px;\n      margin: 0 -1px;\n      text-indent: -1em;\n      -ms-user-select: text;\n      -moz-user-select: text;\n      -webkit-user-select: text;\n      user-select: text;\n      /*with pre-line chrome inserts &nbsp; instead of space*/\n      white-space: pre!important;"),(n.tablet||n.mobile)&&s.setAttribute("x-palm-disable-auto-cap",!0),s.setAttribute("wrap","off"),s.setAttribute("autocorrect","off"),s.setAttribute("autocapitalize","off"),s.setAttribute("spellcheck",!1),s.className="lively-text-input",s.value="",e.insertBefore(s,e.firstChild),(n.tablet||n.mobile)&&(s.setAttribute("disabled",!0),s.style.setProperty("transform","scale(0)")),r.eventHandlers=[{type:"focusin",node:e,fn:function fn(e){return t.onRootNodeFocus(e)},capturing:!0},{type:"focusin",node:r.textareaNode,fn:function fn(e){return t.onTextAreaFocus(e)},capturing:!0},{type:"blur",node:r.textareaNode,fn:function fn(e){return t.onTextAreaBlur(e)},capturing:!0},{type:"keydown",node:r.textareaNode,fn:function fn(e){return t.eventDispatcher.dispatchDOMEvent(e)},capturing:!1},{type:"keyup",node:r.textareaNode,fn:function fn(e){return t.eventDispatcher.dispatchDOMEvent(e)},capturing:!1},{type:"cut",node:r.textareaNode,fn:function fn(e){return t.eventDispatcher.dispatchDOMEvent(e)},capturing:!1},{type:"copy",node:r.textareaNode,fn:function fn(e){return t.inputState.manualCopy?t.inputState.manualCopy.onEvent(e):t.eventDispatcher.dispatchDOMEvent(e)},capturing:!1},{type:"paste",node:r.textareaNode,fn:function fn(e){return t.inputState.manualPaste?t.inputState.manualPaste.onEvent(e):t.eventDispatcher.dispatchDOMEvent(e)},capturing:!1},{type:"compositionstart",node:r.textareaNode,fn:function fn(e){return t.onCompositionStart(e)},capturing:!1},{type:"compositionend",node:r.textareaNode,fn:function fn(e){return t.onCompositionEnd(e)},capturing:!1},{type:"compositionupdate",node:r.textareaNode,fn:function fn(e){return t.onCompositionUpdate(e)},capturing:!1},{type:"input",node:r.textareaNode,fn:function fn(e){return t.onInput(e)},capturing:!1}],r.eventHandlers.forEach(function(e){var t=e.type,n=e.node,r=e.fn,i=e.capturing;return n.addEventListener(t,r,i)}),this}},{key:"uninstall",value:function TextInput_uninstall_(){var e=this.domState;e.isInstalled=!1,e.eventHandlers.forEach(function(e){var t=e.node,n=e.type,r=e.fn,i=e.capturing;return t.removeEventListener(n,r,i)});var t=e.textareaNode;return t&&t.parentNode&&t.parentNode.removeChild(t),e.rootNode=null,this}},{key:"resetValue",value:function TextInput_resetValue_(){var e=this.domState.textareaNode;e&&(e.value="")}},{key:"readValue",value:function TextInput_readValue_(){var e=this.domState.textareaNode;return e?e.value.replace(_e,""):""}},{key:"focus",value:function TextInput_focus_(e,t){var r=this.domState.textareaNode;r&&((n.tablet||n.mobile)&&(e&&e.isText&&!e.readOnly?r.removeAttribute("disabled"):e&&!e.isText&&r.setAttribute("disabled",!0)),r.ownerDocument.activeElement!==r&&r.focus(),n.firefox&&Promise.resolve().then(function(){return r.ownerDocument.activeElement!==r&&r.focus()}),e&&e.isText?(r.focus(),this.ensureBeingAtCursorOfText(e)):t&&this.ensureBeingInVisibleBoundsOfWorld(t))}},{key:"blur",value:function TextInput_blur_(){var e=this.domState.textareaNode;(n.tablet||n.mobile)&&e.setAttribute("disabled",!0),e&&e.blur()}},{key:"doCopyWithMimeTypes",value:function TextInput_doCopyWithMimeTypes_(e){var t=this;return this.execCommand("manualCopy",function(){var n=t.domState.textareaNode,r=function h$$1(t){n.removeEventListener("copy",h$$1),t.preventDefault(),e.forEach(function(e){var n=e.data,r=e.type;return t.clipboardData.setData(r,n)})};setTimeout(function(){return n.removeEventListener("copy",r)},300),n.addEventListener("copy",r),n.value="",n.select(),n.ownerDocument.execCommand("copy")})}},{key:"doCopy",value:function TextInput_doCopy_(e){var t=this;return this.execCommand("manualCopy",function(){var n=t.domState.textareaNode;n.value=e,n.select(),n.ownerDocument.execCommand("copy")})}},{key:"doPaste",value:function TextInput_doPaste_(){var e=this;return this.execCommand("manualPaste",function(){var t=e.domState.textareaNode;t.value="",t.select(),t.ownerDocument.execCommand("paste")})}},{key:"execCommand",value:function(){var e=H(regeneratorRuntime.mark(function _callee(e,t){var n,i,o;return regeneratorRuntime.wrap(function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(this.domState.isInstalled){a.next=2;break}throw new Error("Cannot copy to clipboard  input helper is not installed into DOM!");case 2:if(!(n=this.inputState)[e]){a.next=11;break}return a.prev=4,a.next=7,n[e].promise;case 7:a.next=11;break;case 9:a.prev=9,a.t0=a.catch(4);case 11:return i=r.promise.deferred(),o=!1,n[e]={onEvent:function onEvent(t){o||(n[e]=null,o=!0,i.resolve(t))},promise:i.promise},t(),a.prev=14,a.next=17,r.promise.waitFor(1e3,function(){return o});case 17:a.next=24;break;case 19:a.prev=19,a.t1=a.catch(14),n[e]=null,o=!0,i.reject(a.t1);case 24:return a.abrupt("return",i.promise);case 25:case"end":return a.stop()}},_callee,this,[[4,9],[14,19]])}));return function TextInput_execCommand_(t,n){return e.apply(this,arguments)}}()},{key:"onTextAreaBlur",value:function TextInput_onTextAreaBlur_(e){var t=this;setTimeout(function(){var e=t.domState||{},r=e.textareaNode,i=e.rootNode;i&&document.activeElement===i&&!n.mobile&&!n.tablet&&r&&r.focus()})}},{key:"onTextAreaFocus",value:function TextInput_onTextAreaFocus_(e){}},{key:"onRootNodeFocus",value:function TextInput_onRootNodeFocus_(e){var t=this.domState||{},n=t.textareaNode,r=t.rootNode;e.target!==n&&e.target!==r||this.focus(),this.inputState.composition=null}},{key:"onInput",value:function TextInput_onInput_(e){this.inputState.composition||(e.data||(e.data=this.readValue()),this.resetValue(),this.eventDispatcher.dispatchDOMEvent(e))}},{key:"onCompositionStart",value:function TextInput_onCompositionStart_(e){this.inputState.composition={},this.eventDispatcher.dispatchDOMEvent(e)}},{key:"onCompositionUpdate",value:function TextInput_onCompositionUpdate_(e){var t=this.inputState.composition,n=this.readValue();t.lastValue!==n&&(t.lastValue=n,this.eventDispatcher.dispatchDOMEvent(e))}},{key:"onCompositionEnd",value:function TextInput_onCompositionEnd_(e){this.inputState.composition=null,this.eventDispatcher.dispatchDOMEvent(e)}},{key:"setPosition",value:function TextInput_setPosition_(e){var t=(this.domState||{}).textareaNode;t&&(t.style.left=e.x+"px",t.style.top=e.y+"px")}},{key:"ensureBeingInVisibleBoundsOfWorld",value:function TextInput_ensureBeingInVisibleBoundsOfWorld_(e){this.setPosition(e.visibleBounds().center())}},{key:"ensureBeingAtCursorOfText",value:function TextInput_ensureBeingAtCursorOfText_(e){var t=e.world();if(t){var n=e.whatsVisible,r=n.startRow,i=n.endRow,o=e.cursorPosition,a=o.row,s=o.column;a=Math.max(r,Math.min(a,i));var l=e.charBoundsFromTextPosition({row:a,column:s}).topLeft(),u=t.visibleBounds().insetBy(10).constrainPt(e.worldPoint(l.subPt(e.scroll)));this.inputState.positionChangedTime=Date.now(),this.inputState.scrollLeftWhenChanged=document.documentElement.scrollLeft,this.inputState.scrollTopWhenChanged=document.documentElement.scrollTop,this.setPosition(u)}}}],void 0,t,void 0,{start:185,end:11631})}(void 0),Se=function(e){var t=_classRecorder,n=t.hasOwnProperty("KillRing")&&"function"==typeof t.KillRing?t.KillRing:t.KillRing=function KillRing(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function KillRing_initialize_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.size=e,this.buffer=[],this.pointer=-1}},{key:"isCycling",value:function KillRing_isCycling_(){return this.pointer!==this.buffer.length-1}},{key:"add",value:function KillRing_add_(e){var t=this.buffer;return t.push(e),this.size&&t.length>this.size&&t.splice(0,t.length-this.size),this.pointer=this.buffer.length-1,e}},{key:"yank",value:function KillRing_yank_(){return this.buffer[this.pointer]||""}},{key:"back",value:function KillRing_back_(){return this.pointer=(this.pointer<=0?this.buffer.length:this.pointer)-1,this.yank()}}],void 0,t,void 0,{start:51,end:614})}(void 0),Me=/[a-z]/i;function computeHashIdOfEvent(e){var t=e.key,n=e.ctrlKey,r=e.altKey,i=e.shiftKey,o=e.metaKey,a=0|(n?1:0)|(r?2:0)|(i?4:0)|(o?8:0);return 0===a&&!canonicalizeFunctionKey(t)&&t&&Me.test(t)&&(a=-1),a}var Ce,Pe=function(){for(var e={control:1,ctrl:1,alt:2,option:2,shift:4,super:8,win:8,meta:8,command:8,cmd:8},t=["alt","ctrl","meta","shift"],n=Math.pow(2,t.length);n--;)e[n]=t.filter(function(t){return n&e[t]}).join("-")+"-";return e[0]="",e[-1]="input-",e}(),Te=(Ce=/^[0-9]+$/,function(e){return Ce.test(e)});function isModifier(e){return!Te(e)&&(e=e.replace(/-$/,"").toLowerCase(),r.arr.withoutAll(Object.keys(Pe),["","input-"]).includes(e))}var Ae=["backspace","tab","enter","pause","escape"," ","pageup","pagedown","end","home","left","up","right","down","print","insert","delete","numpad0","numpad1","numpad2","numpad3","numpad4","numpad5","numpad6","numpad7","numpad8","numpad9","numpadenter","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","numlock","scrolllock"];function canonicalizeFunctionKey(e){switch(e=e.toLowerCase()){case"space":e="space";break;case"esc":e="escape";break;case"return":e="enter";break;case"arrowleft":e="left";break;case"arrowright":e="right";break;case"arrowup":e="up";break;case"arrowdown":e="down";break;case"esc":e="escape";break;case"return":e="enter"}return Ae.includes(e)?r.string.capitalize(e):""}function dedasherize(e){for(var t=[];;){var n=e.indexOf("-");if(-1===n)return e&&t.push(e),t;0===n?(t.push(e[0]),e=e.slice(2)):(t.push(e.slice(0,n)),e=e.slice(n+1))}}var Le={computeHashIdOfEvent:computeHashIdOfEvent,keyComboToEventSpec:function keyComboToEventSpec(e,t){var n=Object.assign({_isLivelyKeyEventSpec:!0,keyCombo:"",key:"",ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1,altGraphKey:!1,isFunctionKey:!1,isModified:!1,onlyModifiers:!1},t),i=dedasherize(e),o={shift:"shiftKey",control:"ctrlKey",ctrl:"ctrlKey",alt:"altKey",meta:"metaKey",command:"metaKey",cmd:"metaKey"};if("input"===i[0]&&2===i.length)return n.keyCombo=e,n.key=i[1],n;for(var a=i.length-1;a>=0;a--){var s=o[i[a].toLowerCase()];s&&(i.splice(a,1),n.isModified=!0,n[s]=!0)}if(!i.length)return n.keyCombo=Le.eventToKeyCombo(n),n.key=r.arr.last(dedasherize(n.keyCombo)),n.onlyModifiers=!0,n;i.length>1&&console.warn('Strange key "'+e+'" encountered in keyComboToEventSpec, parsing probably failed');var l=r.arr.last(i),u=canonicalizeFunctionKey(l);return u?(n.isFunctionKey=!0,n.key=u):n.isModified?n.key=r.string.capitalize(l):n.key=l,n.keyCombo=Le.eventToKeyCombo(n),n},eventToKeyCombo:function eventToKeyCombo(e,t){var n=Object.assign({ignoreModifiersIfNoCombo:!1,ignoreKeys:[]},t),i=(n.ignoreModifiersIfNoCombo,n.ignoreKeys,e.key),o=e.data,a=e.keyIdentifier;if("string"==typeof o)return"input-"+o;if(!i&&a&&(i=function decodeKeyIdentifier(e,t){var n=e&&e.replace(/u\+?([\d\w]{4})/gi,function unicodeReplacer(e,t){return String.fromCharCode(parseInt(t,16))});return"Command"!==n&&"Cmd"!==n||(n="Meta")," "===n&&(n="Space"),8===t&&(n="Backspace"),n}(a,e.which||e.keyCode),e.key=i=i[e.shiftKey?"toUpperCase":"toLowerCase"](),isModifier(i)))return r.string.capitalize(i);var s=Pe[computeHashIdOfEvent(e)];if("input-"===s)return s+i;e.code&&(i=function identifyKeyFromCode(e){var t=e.code;if("string"!=typeof t)return null;if(t.startsWith("Key"))return t.slice(3);if(t.startsWith("Numpad"))return t;if(t.startsWith("Digit"))return t.slice(5);if(t.startsWith("Arrow"))return t.slice(5);if(t.match(/^F[0-9]{1-2}$/))return t;switch(t){case"Insert":case"Home":case"PageUp":case"PageDown":return t;case"Period":return".";case"Comma":return",";case"Help":return"Insert";case"Equal":return"=";case"Backslash":case"IntlBackslash":return"\\";case"Equal":return"=";case"Minus":return"-";case"BracketRight":return"]";case"BracketLeft":return"[";case"Quote":return"'";case"Backquote":return"`";case"Semicolon":return";"}return null}(e)||i);var l=!i||isModifier(i)?s.replace(/-$/,""):s+i;return l.match(/\s$/)&&(l=l.replace(/\s$/,"Space")),l.replace(/(^|-)([a-z])/g,function(e,t,n){return t+n.toUpperCase()})},canonicalizeKeyCombo:function canonicalizeKeyCombo(e){return Le.eventToKeyCombo(Le.keyComboToEventSpec(e))},canonicalizeEvent:function canonicalizeEvent(e){return e._isLivelyKeyEventSpec?e:Le.keyComboToEventSpec(Le.eventToKeyCombo(e))}},Re=["pointerover","pointerenter","pointerout","pointerleave","pointerdown","pointermove","pointerup","pointercancel","gotpointercapture","lostpointercapture"],Ee=["mouseover","mouseenter","mousedown","mousemove","mouseup","mouseout","mouseleave","click","dblclick","contextmenu","mousewheel"],ze=["keydown","keyup","keypress"],Oe=ze.concat("input","compositionstart","compositionupdate","compositionend"),Ie=function(e){var r=_classRecorder,i=r.hasOwnProperty("Event")&&"function"==typeof r.Event?r.Event:r.Event=function Event(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(i,e,[{key:Symbol.for("lively-instance-initialize"),value:function Event_initialize_(e,t,n,r,i,o,a){this.type=e,this.domEvt=t,this.dispatcher=n,this.targetMorphs=r,this.hand=i,this.halo=o,this.layoutHalo=a,this.stopped=!1,this._keyCombo=void 0,this.onDispatchCallbacks=[],this.onAfterDispatchCallbacks=[],this.onStopCallbacks=[]}},{key:"onDispatch",value:function Event_onDispatch_(e){return this.onDispatchCallbacks.push(e),this}},{key:"onAfterDispatch",value:function Event_onAfterDispatch_(e){return this.onAfterDispatchCallbacks.push(e),this}},{key:"onStop",value:function Event_onStop_(e){return this.onStopCallbacks.push(e),this}},{key:"data",get:function get(){return this.domEvt.data}},{key:"world",get:function get(){return this.dispatcher.world}},{key:"state",get:function get(){return this.dispatcher.eventState}},{key:"keyInputState",get:function get(){return this.state.keyInputState}},{key:"isMouseEvent",value:function Event_isMouseEvent_(){return Re.includes(this.type)||Ee.includes(this.type)}},{key:"isKeyboardEvent",value:function Event_isKeyboardEvent_(){return!this.isMouseEvent()&&ze.includes(this.type)}},{key:"stop",value:function Event_stop_(){this.stopped=!0,this.domEvt&&"function"==typeof this.domEvt.stopPropagation&&this.domEvt.stopPropagation(),this.domEvt&&"function"==typeof this.domEvt.preventDefault&&this.domEvt.preventDefault(),this.onStopCallbacks.forEach(function(e){return e()})}},{key:"targetMorph",get:function get(){return this.targetMorphs[0]}},{key:"timestamp",get:function get(){return this.domEvt.timeStamp}},{key:"position",get:function get(){if(!this.domEvt)return t.pt(0,0);for(var e=this.domEvt.target;e&&e.id!==this.world.id;)e=e.parentNode;if(!e){var n=this.domEvt.target;e=(n.nodeType===n.DOCUMENT_NODE?n:n.ownerDocument).getElementById(this.world.id)}if(!e)return console.error("event position: cannot find world node for determining the position!"),t.pt(0,0);var r=cumulativeOffset(e),i=r.left,o=r.top,a=this.domEvt,s=a.pageX,l=a.pageY,u=t.pt((s||0)-i,(l||0)-o);return 1!==this.world.scale&&(u=u.scaleBy(1/this.world.scale)),u}},{key:"startPosition",get:function get(){return this.state.clickedOnPosition}},{key:"pressure",get:function get(){return this.domEvt?this.domEvt.pressure:.5}},{key:"positionIn",value:function Event_positionIn_(e){return e.localize(this.position)}},{key:"isClickTarget",value:function Event_isClickTarget_(e){var t=this.state.clickedOnMorph;return t&&(e===t||e.isAncestorOf(t))}},{key:"leftMouseButtonPressed",value:function Event_leftMouseButtonPressed_(){return!!this.domEvt&&1&(this.domEvt.buttons||0)}},{key:"rightMouseButtonPressed",value:function Event_rightMouseButtonPressed_(){return n.firefox,3===this.domEvt.which||2===this.domEvt.buttons}},{key:"middleMouseButtonPressed",value:function Event_middleMouseButtonPressed_(){return!!this.domEvt&&4&(this.domEvt.buttons||0)}},{key:"isCommandKey",value:function Event_isCommandKey_(){var e=this.domEvt;if(!e)return!1;var t=!1;return n.mac||(t=t||e.ctrlKey),(n.tablet||n.tablet)&&(t=t||!1),t||e.metaKey||"Meta"===e.keyIdentifier}},{key:"isShiftDown",value:function Event_isShiftDown_(){return this.domEvt&&!!this.domEvt.shiftKey}},{key:"isCtrlDown",value:function Event_isCtrlDown_(){return this.domEvt&&!!this.domEvt.ctrlKey}},{key:"isAltDown",value:function Event_isAltDown_(){return this.domEvt&&!!this.domEvt.altKey}},{key:"keyCombo",get:function get(){return this._keyCombo||(this._keyCombo=Le.eventToKeyCombo(this.domEvt))}},{key:"keyCombo",set:function set(e){return this._keyCombo=e}}],void 0,r,void 0,{start:956,end:4962})}(void 0),De=function(e){var t=_classRecorder,n=t.hasOwnProperty("KeyEvent")&&"function"==typeof t.KeyEvent?t.KeyEvent:t.KeyEvent=function KeyEvent(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function KeyEvent_initialize_(e,t,r,i,o,a,s){console.assert(Oe.includes(e),"not a keyboard event: "+e),lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(n.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e,t,r,i,o,a,s),Object.assign(this,Le.canonicalizeEvent(t))}},{key:"isKeyEvent",get:function get(){return!0}}],void 0,t,void 0,{start:4972,end:5341})}(Ie),Ne=function(e){var t=_classRecorder,n=t.hasOwnProperty("SimulatedDOMEvent")&&"function"==typeof t.SimulatedDOMEvent?t.SimulatedDOMEvent:t.SimulatedDOMEvent=function SimulatedDOMEvent(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function SimulatedDOMEvent_initialize_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.position){var t=e,n=t.position,i=n.x,o=n.y;t.target;(e=r.obj.dissoc(e,["position"])).pageX=i,e.pageY=o}!e.hasOwnProperty("pointerId")&&Ee.concat(Re).includes(e.type)&&(e=Object.assign({},e,{pointerId:1})),Object.assign(this,Object.assign({type:void 0,target:void 0,pageX:void 0,pageY:void 0,pointerId:void 0,pointerType:"mouse",buttons:0,keyCode:void 0,keyString:"",keyIdentifier:void 0,altKey:!1,ctrlKey:!1,shiftKey:!1,metaKey:!1,stopped:!1},e))}},{key:"preventDefault",value:function SimulatedDOMEvent_preventDefault_(){this.defaultPrevented=!0}},{key:"stopPropagation",value:function SimulatedDOMEvent_stopPropagation_(){this.propagationStopped=!0}}],void 0,t,void 0,{start:5350,end:6246})}(void 0),Fe=[{type:"pointerdown",capturing:!1},{type:"pointerup",capturing:!1},{type:"pointermove",capturing:!1,passive:!1},{type:"pointerover",capturing:!1,passive:!1},{type:"pointerout",capturing:!1,passive:!1},{type:"contextmenu",capturing:!1},{type:"scroll",capturing:!0,passive:!1},{type:"wheel",capturing:!1,passive:!1},{type:"drag",capturing:!1},{type:"dragstart",capturing:!1},{type:"dragend",capturing:!1},{type:"dragover",capturing:!1},{type:"dragenter",capturing:!1},{type:"dragleave",capturing:!1},{type:"drop",capturing:!1}],Be=new Set(["pointerdown","pointerup","keydown","keyup","input"]),je=[{type:"resize",capturing:!1,morphMethod:"onWindowResize"},{type:"orientationchange",capturing:!1,morphMethod:"onWindowResize"},{type:"scroll",capturing:!1,passive:!1,morphMethod:"onWindowScroll"},{type:"beforeunload",capturing:!1,passive:!1,morphMethod:"onBeforeUnload"}],We={pointerdown:"onMouseDown",pointerup:"onMouseUp",pointermove:"onMouseMove",longclick:"onLongClick",hoverin:"onHoverIn",hoverout:"onHoverOut",morphicdrag:"onDrag",morphicdragstart:"onDragStart",morphicdragend:"onDragEnd",grab:"onGrab",morphicdrop:"onDrop",morphicdrophoverin:"onDropHoverIn",morphicdrophoverout:"onDropHoverOut",morphicdrophoverupdate:"onDropHoverUpdate",keydown:"onKeyDown",keyup:"onKeyUp",input:"onTextInput",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd",blur:"onBlur",focus:"onFocus",contextmenu:"onContextMenu",cut:"onCut",copy:"onCopy",paste:"onPaste",scroll:"onScroll",wheel:"onMouseWheel",drag:"onNativeDrag",dragstart:"onNativeDragstart",dragend:"onNativeDragend",dragover:"onNativeDragover",dragenter:"onNativeDragenter",dragleave:"onNativeDragleave",drop:"onNativeDrop"},He=["keydown","keyup","keypress","input","compositionstart","compositionupdate","compositionend","cut","copy","paste"];function dragEndEvent(e,n,r,i,o,a,s){var l=i.draggedMorph||r,u=new Ie("morphicdragend",e,n,[l],o,a,s).onDispatch(function(){i.dragDelta=(l.owner||n.world).getInverseTransform().transformDirection(u.position.subPt(i.lastDragPosition)),i.absDragDelta=u.position.subPt(i.clickedOnPosition)}).onAfterDispatch(function(){i.draggedMorph=null,i.lastDragPosition=null,i.dragDelta=t.pt(0,0),i.absDragDelta=t.pt(0,0),i.dragStartMorphPosition=null,i.dragStartPosition=null});return u}function focusEvents(e,t){var n=e.eventState;if(n.focusedMorph===t)return[];var r=[];return n.focusedMorph&&r.push(new Ie("blur",null,this,[n.focusedMorph],null,null,null).onDispatch(function(){return n.focusedMorph=null})),r.push(new Ie("focus",null,this,[t],null,null,null).onDispatch(function(){return n.focusedMorph=t})),r}var Ve=function(e){var i=_classRecorder,o=i.hasOwnProperty("EventDispatcher")&&"function"==typeof i.EventDispatcher?i.EventDispatcher:i.EventDispatcher=function EventDispatcher(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(o,e,[{key:Symbol.for("lively-instance-initialize"),value:function EventDispatcher_initialize_(e,t){this.activations=0,this.emitter=e,this.keyInputHelper=null,this.world=t,this.installed=!1,this.handlerFunctions=[],this.killRing=new Se(z.text.clipboardBufferLength),this.nodeMorphMap=new WeakMap,this.timestampBase=r.Path("performance.timing.navigationStart").get(e)||0,this.resetState()}},{key:"resetState",value:function EventDispatcher_resetState_(){this.eventState={timeOfLastActivity:0,focusedMorph:null,clickedOnPosition:null,clickedOnMorph:null,clickCount:0,prevClick:null,draggedMorph:null,dragDelta:null,absDragDelta:null,lastDragPosition:null,dragStartMorphPosition:null,dragStartPosition:null,hover:{hoveredOverMorphs:[],unresolvedPointerOut:!1},scroll:{interactiveScrollInProgress:null},keyInputState:null,pressedKeys:{},html5Drag:{},dropHoverTarget:null},this.resetKeyInputState()}},{key:"resetKeyInputState",value:function EventDispatcher_resetKeyInputState_(){this.eventState.keyInputState={keyChain:"",count:void 0}}},{key:"focusMorph",value:function EventDispatcher_focusMorph_(e){var t=this;this.keyInputHelper&&this.keyInputHelper.focus(e,this.world),focusEvents(this,e).forEach(function(e){return t.dispatchEvent(e)})}},{key:"isMorphFocused",value:function EventDispatcher_isMorphFocused_(e){return this.eventState.focusedMorph===e}},{key:"isKeyPressed",value:function EventDispatcher_isKeyPressed_(e){return Object.keys(this.eventState.pressedKeys).map(function(e){return e.toLowerCase()}).includes(e.toLowerCase())}},{key:"whenIdle",value:function EventDispatcher_whenIdle_(){var e=this;return r.promise.waitFor(function(){return 0===e.activations})}},{key:"install",value:function EventDispatcher_install_(e){var t=this;if(this.installed)return this;this.installed=!0;var n=this.emitter,r=System.global;return Fe.forEach(function(e){var r=e.type,i=e.capturing,o=function fn(e){return t.dispatchDOMEvent(e)};t.handlerFunctions.push({node:n,type:r,fn:o,capturing:i});var a=i;n.addEventListener(r,o,a)}),r.addEventListener&&je.forEach(function(e){var n=e.type,i=e.capturing,o=e.morphMethod,a=function fn(e){return t.dispatchDOMEvent(e,t.world,o)};t.handlerFunctions.push({node:r,type:n,fn:a,capturing:i});var s=i;r.addEventListener(n,a,s)}),this.keyInputHelper=new ke(this).install(e),e.setAttribute("touch-action","none"),this}},{key:"uninstall",value:function EventDispatcher_uninstall_(){this.installed=!1;var e=this.handlerFunctions;return e.forEach(function(e){var t=e.node,n=e.type,r=e.fn,i=e.capturing;t.removeEventListener(n,r,i)}),e.length=0,this.keyInputHelper&&this.keyInputHelper.uninstall(),this.keyInputHelper=null,this}},{key:"processDOMEvent",value:function EventDispatcher_processDOMEvent_(e,i){var o=this,a=e.type,s=this.eventState,l=[i].concat(i.ownerChain()),u="touch"===e.pointerType,c=e.pointerId,h="number"==typeof c?this.world.handForPointerId(c):this.world.firstHand,d=c&&!u?this.world.haloForPointerId(c):null,p=c&&!u?this.world.layoutHaloForPointerId(c):null,f=new(Oe.includes(a)?De:Ie)(a,e,this,l,h,d,p),y=[f],m=[];switch(a){case"keydown":s.pressedKeys[f.key]=!0;break;case"keyup":"Meta"===f.key?s.pressedKeys={}:delete s.pressedKeys[f.key];break;case"click":var g=this.processDOMEvent(Object.assign({},e,{type:"pointerdown"}),i).events,v=this.processDOMEvent(Object.assign({},e,{type:"pointerup"}),i).events;y=g.concat(v);break;case"pointerdown":e.target.setPointerCapture,f.onDispatch(function(){o.focusMorph(i),s.clickedOnMorph=i,s.clickedOnPosition=f.position,s.downTimeStamp=e.timeStamp;var t=!1,n=0;if(s.prevClick){var r=s.prevClick,a=r.clickedOnMorph,l=(r.clickedOnPosition,r.clickedAtTime),u=r.clickCount,c=Date.now()-l;t=a===i&&c<z.repeatClickInterval,n=u}s.clickCount=t?n+1:1});break;case"pointerup":f.onAfterDispatch(function(){var t=s.clickedOnMorph,n=s.clickedOnPosition,r=s.clickCount,i=Date.now();s.prevClick={clickedOnMorph:t,clickedOnPosition:n,clickedAtTime:i,clickCount:r},s.clickedOnMorph=null,s.clickCount=0,u&&o.world.removeHandForPointerId(c);var a=e.timeStamp-s.downTimeStamp,y=s.clickedOnPosition.dist(f.position),m=z.longClick,g=m.maxDist,v=m.minDur,x=m.maxDur;if(y<g&&a>=v&&a<=x){var b=new Ie("longclick",e,o,l,h,d,p);o.schedule(b)}}),s.draggedMorph&&(y.push(dragEndEvent(e,this,i,s,h,d,p)),f.targetMorphs=[this.world]),h.carriesMorphs()&&(s.dropHoverTarget?(y.push(new Ie("morphicdrophoverout",e,this,[s.dropHoverTarget],h,d,p)),i=s.dropHoverTarget,s.dropHoverTarget=null):i=h.findDropTarget(f.position,h.grabbedMorphs),h.isAncestorOf(i)&&(i=this.world),y.push(new Ie("morphicdrop",e,this,[i],h,d,p)),f.targetMorphs=[this.world]);break;case"pointermove":if(h.carriesMorphs()){f.targetMorphs=[this.world];var x=h.findDropTarget(f.position,h.grabbedMorphs)||this.world;s.dropHoverTarget===x?y.push(new Ie("morphicdrophoverupdate",e,this,[x],h,d,p)):(s.dropHoverTarget&&y.push(new Ie("morphicdrophoverout",e,this,[s.dropHoverTarget],h,d,p)),s.dropHoverTarget=x,y.push(new Ie("morphicdrophoverin",e,this,[x],h,d,p)))}else if(s.draggedMorph)f.targetMorphs=[this.world],y.push(function dragEvent(e,t,n,r,i,o,a){var s=new Ie("morphicdrag",e,t,[r.draggedMorph],i,o,a).onDispatch(function(){r.dragDelta=(r.draggedMorph.owner||t.world).getInverseTransform().transformDirection(s.position.subPt(r.lastDragPosition)),r.absDragDelta=s.position.subPt(r.clickedOnPosition)}).onAfterDispatch(function(){return r.lastDragPosition=s.position}).onStop(function(){r.draggedMorph=null,t.schedule(dragEndEvent(e,t,n,r,i,o,a))});return s}(e,this,i,s,h,d,p));else if(s.clickedOnMorph&&s.clickedOnPosition&&s.clickedOnMorph.draggable&&!s.draggedMorph&&!h.carriesMorphs()){var b=s.clickedOnPosition.dist(f.position),w=s.clickedOnMorph;b>w.dragTriggerDistance&&(w.grabbable?y.push(new Ie("grab",e,this,[w],h,d,p)):w.draggable&&y.push(function dragStartEvent(e,n,r,i,o,a,s){var l=new Ie("morphicdragstart",e,n,[r],o,a,s).onDispatch(function(){i.draggedMorph=r,i.dragStartMorphPosition=r.position,i.dragStartPosition=l.position,i.lastDragPosition=l.position,i.dragDelta=t.pt(0,0),i.absDragDelta=t.pt(0,0)}).onStop(function(){i.draggedMorph=null,n.schedule(dragEndEvent(e,n,r,i,o,a,s))});return l}(e,this,w,s,h,d,p)),f.targetMorphs=[this.world])}break;case"pointerover":s.hover.unresolvedPointerOut&&(s.hover.unresolvedPointerOut=!1);var _=[i].concat(i.ownerChain()).reverse(),k=r.arr.withoutAll(s.hover.hoveredOverMorphs,_).map(function(t){return new Ie("hoverout",e,o,[t],h,d,p).onDispatch(function(){return r.arr.remove(s.hover.hoveredOverMorphs,t)})}),S=r.arr.withoutAll(_,s.hover.hoveredOverMorphs).map(function(t){return new Ie("hoverin",e,o,[t],h,d,p).onDispatch(function(){return r.arr.pushIfNotIncluded(s.hover.hoveredOverMorphs,t)})});y=k.concat(S);break;case"pointerout":y=[],s.hover.unresolvedPointerOut=!0,m.push(function(){if(s.hover.unresolvedPointerOut)return Promise.all(s.hover.hoveredOverMorphs.map(function(t){return o.schedule(new Ie("hoverout",e,o,[t],h,d,p).onAfterDispatch(function(){return r.arr.remove(s.hover.hoveredOverMorphs,t)}))}))});break;case"blur":y=[new Ie(a,e,this,[i],h,d,p).onDispatch(function(){return s.focusedMorph=null})];break;case"focus":y=focusEvents(this,i);break;case"scroll":y=[new Ie(a,e,this,[i],h,d,p).onDispatch(function(){if(!!!s.scroll.interactiveScrollInProgress){var o=r.promise.deferred(),a=o.promise,l=o.resolve,u="Firefox"==n.name?500:250;s.scroll.interactiveScrollInProgress=a,a.debounce=r.fun.debounce(u,function(){s.scroll.interactiveScrollInProgress=null,l()})}s.scroll.interactiveScrollInProgress.debounce();var c=e.target,h=c.scrollLeft,d=c.scrollTop,p=i.scroll,f=p.x,y=p.y;f===h&&y===d||(i.scroll=t.pt(h,d))})];break;case"input":case"compositionstart":case"compositionupdate":case"compositionend":i.isText?f.targetMorphs=[i]:y=[];break;case"drag":case"dragstart":case"dragend":case"dragover":case"dragenter":case"dragleave":case"drop":"drop"!==a&&"dragover"!==a||e.preventDefault()}return{events:y,later:m}}},{key:"schedule",value:function EventDispatcher_schedule_(e){var t=this;return this.activations++,Promise.resolve().then(function(){return t.dispatchEvent(e)}).then(function(){return t.activations--},function(e){throw t.activations--,e})}},{key:"dispatchEvent",value:function EventDispatcher_dispatchEvent_(e,t){if(!(t=t||We[e.type]))throw new Error("dispatchEvent: "+e.type+" not yet supported!");var n;e.onDispatchCallbacks.forEach(function(e){return e()}),this.activations++;for(var r=e.targetMorphs.length-1;r>=0;r--){try{e.targetMorphs[r][t](e)}catch(i){(n=new Error("Error in event handler "+e.targetMorphs[r]+"."+t+": "+(i.stack||i))).originalError=i,void 0!==this.world?this.world.logError(n):console.error(n)}if(n||e.stopped)break}if(this.activations--,e.onAfterDispatchCallbacks.forEach(function(e){return e()}),n)throw n}},{key:"dispatchDOMEvent",value:function EventDispatcher_dispatchDOMEvent_(e,t,n){var i=this,o=this.world,a=this.eventState,s=this.nodeMorphMap,l=e.timeStamp,u=e.type;if(a.timeOfLastActivity=this.timestampBase+l,!t&&He.includes(u))t=a.focusedMorph||o;else if(!t){for(var c=e.target;;){var h=c.className||"";if("string"!=typeof h&&"baseVal"in h&&(h=h.baseVal),h&&h.includes("Morph"))break;if(!(c=c.parentNode))return}if(!(t=s.get(c))){var d=c.id;(t=o.withAllSubmorphsDetect(function(e){return e.id===d}))&&s.set(c,t)}}if(t){var p=this.processDOMEvent(e,t),f=p.events;p.later.map(function(e){return i.activations++,r.promise.delay(0).then(e).then(function(){return i.activations--},function(e){throw i.activations--,e})}),f.forEach(function(e){return i.dispatchEvent(e,n)}),o&&o.needsRerender()&&Be.has(u)&&o.env.renderer.renderLater()}}},{key:"simulateDOMEvents",value:function EventDispatcher_simulateDOMEvents_(){for(var e=this.emitter.document||this.emitter.ownerDocument,t=[],n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];var o=!0,a=!1,s=void 0;try{for(var l,u=r[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var c=l.value,h=c,d=h.target,p=h.position,f=h.type;if(He.includes(f)){if(!this.keyInputHelper.domState.textareaNode)throw new Error("Cannot simulate event of type "+f+", no keyInputHelper installed!");c=Object.assign({},c,{target:this.keyInputHelper.textareaNode})}if(d||(d=p?this.world.morphsContainingPoint(p)[0]:this.world),d.isMorph&&(c=Object.assign({},c,{target:e.getElementById(d.id)})),c.position){var y=cumulativeOffset(e.getElementById(this.world.id)),m=y.left,g=y.top;c.position=c.position.addXY(m,g)}"scroll"===f&&("scrollLeft"in c||"scrollTop"in c)&&(c.target.scrollLeft=c.scrollLeft||0,c.target.scrollTop=c.scrollTop||0);var v=new Ne(c);t.push(v),this.dispatchDOMEvent(v)}}catch(e){a=!0,s=e}finally{try{!o&&u.return&&u.return()}finally{if(a)throw s}}return t}},{key:"doCopy",value:function EventDispatcher_doCopy_(e){return this.keyInputHelper.doCopy(e)}},{key:"doCopyWithMimeTypes",value:function EventDispatcher_doCopyWithMimeTypes_(e){return this.keyInputHelper.doCopyWithMimeTypes(e)}},{key:"doPaste",value:function EventDispatcher_doPaste_(){return this.keyInputHelper.doPaste()}},{key:"cancelGrab",value:function EventDispatcher_cancelGrab_(e,t){var n=this,r=[],i=this.eventState;i.clickedOnMorph=null,i.dropHoverTarget&&(r.push(new Ie("morphicdrophoverout",t.domEvt,this,[i.dropHoverTarget],e,null,null)),i.dropHoverTarget=null),r.forEach(function(e){return n.dispatchEvent(e)})}}],void 0,i,void 0,{start:7592,end:28632})}(void 0),Ue=function(e){var t=_classRecorder,n=t.hasOwnProperty("MorphicEnv")&&"function"==typeof t.MorphicEnv?t.MorphicEnv:t.MorphicEnv=function MorphicEnv(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function MorphicEnv_initialize_(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function defaultDOMEnv(){return ne||(ne=System.get("@system-env").browser?new re(window,document):createDOMEnvironment())}();this.initialized=!1,this.fontMetric=null,this.renderer=null,this.eventDispatcher=null,this.world=null,this.systemChangeHandlers=null,this.objPool=null,this.synchronizer=null,this.changeManager=new xe,this.undoManager=new we,this.installSystemChangeHandlers(),this.whenRenderedRequesters=new Map,this.whenRenderedTickingProcess=null,"function"==typeof t.then?this._waitForDOMEnv=t.then(function(t){e._waitForDOMEnv=null,e.initWithDOMEnv(t),e.initialized=!0}).catch(function(e){return console.error("Error initializing MorphicEnv with dom env: "+e.stack)}):(this.initWithDOMEnv(t),this.initialized=!0)}},{key:"isDefault",value:function MorphicEnv_isDefault_(){return this.constructor.default()===this}},{key:"initWithDOMEnv",value:function MorphicEnv_initWithDOMEnv_(e){this.domEnv=e,this.fontMetric=ce.forDOMEnv(e)}},{key:"uninstallWorldRelated",value:function MorphicEnv_uninstallWorldRelated_(){this.renderer&&this.renderer.clear(),this.eventDispatcher&&this.eventDispatcher.uninstall(),this.world&&this.world.suspendSteppingAll()}},{key:"uninstall",value:function MorphicEnv_uninstall_(){var e=this;return this._waitForDOMEnv?this._waitForDOMEnv.then(function(){return e.uninstall()}):(this.deleteHistory(),this.uninstallWorldRelated(),this.fontMetric&&(this.fontMetric.uninstall(),this.fontMetric=null),this.domEnv&&this.whenRenderedTickingProcess&&(this.domEnv.window.cancelAnimationFrame(this.whenRenderedTickingProcess),this.whenRenderedTickingProcess=null),this.whenRenderedRequesters=new Map,this.domEnv&&this.domEnv.destroy(),this.initialized=!1,Promise.resolve())}},{key:"setWorld",value:function MorphicEnv_setWorld_(e){var t=this;return this._waitForDOMEnv?this._waitForDOMEnv.then(function(){return t.setWorld(e)}):this.setWorldRenderedOn(e,this.domEnv.document.body)}},{key:"setWorldRenderedOn",value:function MorphicEnv_setWorldRenderedOn_(e,t){var n=this;if(!e||!e.isWorld)throw new Error("world object does not look like a morphic world");return this._waitForDOMEnv?this._waitForDOMEnv.then(function(){return n.setWorldRenderedOn(e,t)}):(this.deleteHistory(),this.uninstallWorldRelated(),this.world=e,this.renderer=new se(e,t,this.domEnv),this.eventDispatcher=new Ve(this.domEnv.window,e).install(t),e.resumeSteppingAll(),this.isDefault()&&(this.domEnv.window.$world=e),e.focus(),e.makeDirty(),this.renderer.renderLater(),e.whenRendered().then(function(){return n}))}},{key:"installSystemChangeHandlers",value:function MorphicEnv_installSystemChangeHandlers_(){var e=this;if(!this.systemChangeHandlers){var t=this.systemChangeHandlers={};t["lively.modules/moduleloaded"]=[h.subscribe("lively.modules/moduleloaded",function(t){return e.getTargetsFor("onModuleLoaded").forEach(function(e){return e.onModuleLoaded(t)})})],t["lively.modules/modulechanged"]=[h.subscribe("lively.modules/modulechanged",function(t){return e.getTargetsFor("onModuleChanged").forEach(function(e){return e.onModuleChanged(t)})})],t["lively.partsbin/partpublished"]=[h.subscribe("lively.partsbin/partpublished",function(t){return e.getTargetsFor("onPartPublished").forEach(function(e){return e.onPartPublished(t)})})],t["lively.user/userchanged"]=[h.subscribe("lively.user/userchanged",function(t){return e.getTargetsFor("onUserChanged").forEach(function(e){return e.onUserChanged(t)})})]}}},{key:"uninstallSystemChangeHandlers",value:function MorphicEnv_uninstallSystemChangeHandlers_(){var e=this.systemChangeHandlers;e&&(this.systemChangeHandlers=null,Object.keys(e).forEach(function(t){return e[t].forEach(function(e){return h.unsubscribe(t,e)})}))}},{key:"getTargetsFor",value:function MorphicEnv_getTargetsFor_(e){var t=this.world,n=[];if(!t||!t.submorphs)return n;"function"==typeof t[e]&&n.push(t);var r=!0,i=!1,o=void 0;try{for(var a,s=t.submorphs[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=a.value;"function"==typeof l[e]&&n.push(l),l.isWindow&&l.targetMorph&&"function"==typeof l.targetMorph[e]&&n.push(l.targetMorph)}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}},{key:"deleteHistory",value:function MorphicEnv_deleteHistory_(){var e=this.changeManager,t=this.world,n=this.fontMetric;e&&(e.changes.length=0),t&&t.withAllSubmorphsDo(function(e){return e.undoManager&&e.undoManager.reset()}),n&&n.reset()}},{key:"printStatus",value:function MorphicEnv_printStatus_(){var e=this.changeManager,t=this.world,n=(this.fontMetric,0),r=0;return t&&t.withAllSubmorphsDo(function(e){e.undoManager&&(n++,r+=e.undoManager.undos.length+e.undoManager.redos.length)}),e.changes.length+" changes recorded\n"+n+" morphs with undos\n"+r+" undo changes"}},{key:"updateWhenRenderedRequests",value:function MorphicEnv_updateWhenRenderedRequests_(){var e=this,t=this.whenRenderedRequesters,n=0,r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=$(a.value,2),u=l[0],c=l[1],h=c.maxAttempts,d=(c.currentAttempt,c.resolve),p=c.reject;u._dirty||u._rendering?++c.currentAttempt>h?(t.delete(u),p(new Error("Failed to wait for whenRendered of "+u+" (tried "+h+"x)"))):n++:(t.delete(u),d(u))}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}this.whenRenderedTickingProcess=n?this.domEnv.window.requestAnimationFrame(function(){return e.updateWhenRenderedRequests()}):null}},{key:"whenRendered",value:function MorphicEnv_whenRendered_(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=this.whenRenderedRequesters,i=this.whenRenderedTickingProcess,o=r.get(e);if(!o){var a=void 0,s=void 0,l=new Promise(function(e,t){a=e,s=t});r.set(e,o={maxAttempts:n,currentAttempt:0,resolve:a,reject:s,promise:l})}return i||(this.whenRenderedTickingProcess=this.domEnv.window.requestAnimationFrame(function(){return t.updateWhenRenderedRequests()})),o.promise}}],[{key:"reset",value:function MorphicEnv_reset_(){for(;;){var e=this.popDefault();if(!e)break;try{e.uninstall()}catch(e){console.error("Error uninstalling MorphicEnv: "+(e.stack||e))}}}},{key:"default",value:function MorphicEnv_default_(){var e=this.envs;return e.length||this.pushDefault(new this),e[e.length-1]}},{key:"pushDefault",value:function MorphicEnv_pushDefault_(e){return this.envs.push(e),e}},{key:"popDefault",value:function MorphicEnv_popDefault_(){return this.envs.pop()}},{key:"envs",get:function get(){return this._envs||(this._envs=[])}}],t,void 0,{start:406,end:8070})}(void 0);var qe=function(e){var t=_classRecorder,n=t.hasOwnProperty("CommandHandler")&&"function"==typeof t.CommandHandler?t.CommandHandler:t.CommandHandler=function CommandHandler(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function CommandHandler_initialize_(){this.history=[],this.maxHistorySize=1e3}},{key:"addToHistory",value:function CommandHandler_addToHistory_(e){this.history.push(e),this.history.length>this.maxHistorySize&&this.history.splice(0,this.history.length-this.maxHistorySize)}},{key:"printHistory",value:function CommandHandler_printHistory_(){return this.history.map(this.printCommand).join("\n")}},{key:"printCommand",value:function CommandHandler_printCommand_(e){var t=e.name,n=e.target.string,i=e.args,o=e.count,a=e.evt,s=e.keyCombo;return'"'+t+'" '+(a?a+" ":"")+(s?s+" ":"")+(i?function printArg$1(e){return r.obj.inspect(e,{maxDepth:1}).replace(/\n/g,"").replace(/\s+/g," ")}(i):"")+("number"==typeof o?" x"+o:"")+" "+n}},{key:"lookupCommand",value:function CommandHandler_lookupCommand_(e,t){var n,r;return e?("string"==typeof e&&(n=e),"string"==typeof e.command&&(n=e.command),e.exec&&(n=(r=e).name),r||(r=t.commands.find(function(e){return e.name===n})),{name:n,command:r}):{}}},{key:"exec",value:function CommandHandler_exec_(e,t,n,i,o){var a=this,s=this.lookupCommand(e,t)||{},l=s.name,u=s.command;if(!u)return console.warn("Cannot find command "+(l||e)),null;if(l){var c=void 0,h=void 0;o&&(c=o.type,o.isKeyEvent&&(h=o.keyCombo)),this.addToHistory({name:l,target:{string:String(t),id:t.id},args:n,count:i,time:Date.now(),evt:c,keyCombo:h})}var p,f,y=t.world();if("string"==typeof u.progressIndicator&&(p=d.open(u.progressIndicator)),"function"==typeof u.exec)try{f=u.exec(t,n,u.handlesCount?i:void 0,o)}catch(e){f=e;var m="Error in interactive command "+l+": "+(e.stack||e);y?y.logError(m):console.error(m)}else console.error("command "+l+" has no exec function!");return f&&"function"==typeof f.catch?(f.catch(function(e){var t="Error in interactive command "+l+": "+e+"\n"+(e.stack||e);throw y?y.logError(t):console.error(t),e}),p&&r.promise.finally(f,function(){return p.remove()})):p&&p.remove(),f&&"number"==typeof i&&i>1&&!u.handlesCount&&(f="function"==typeof f.then?f.then(function(){return a.exec(u,t,n,i-1,o,null)}):this.exec(u,t,n,i-1,o,null)),f}}],void 0,t,void 0,{start:242,end:3541})}(void 0),Ge=function(){var e=H(regeneratorRuntime.mark(function _callee(e,t){var n,r,i,o,a,s,l,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{keyChain:void 0,count:void 0};return regeneratorRuntime.wrap(function _callee$(c){for(;;)switch(c.prev=c.next){case 0:n=1===t.length?[t]:t.split(/ /g).map(ensureSpaces),r=!0,i=!1,o=void 0,c.prev=4,a=n[Symbol.iterator]();case 6:if(r=(s=a.next()).done){c.next=13;break}return l=s.value,c.next=10,simulateKey(e,l,u);case 10:r=!0,c.next=6;break;case 13:c.next=19;break;case 15:c.prev=15,c.t0=c.catch(4),i=!0,o=c.t0;case 19:c.prev=19,c.prev=20,!r&&a.return&&a.return();case 22:if(c.prev=22,!i){c.next=25;break}throw o;case 25:return c.finish(22);case 26:return c.finish(19);case 27:case"end":return c.stop()}},_callee,this,[[4,15,19,27],[20,,22,26]])}));return function simulateKeys(t,n,r){return e.apply(this,arguments)}}();function ensureSpaces(e){return e.length?e:" "}function invokeKeyHandlers(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t=Le.canonicalizeEvent(t),i=r.keyCombo,o=r.key,a=r.data,s=void 0,l=!1,u=e.keyhandlers,c=t.keyInputState||{},h=i.startsWith("input-"),d=!1,p=c.count,f=c.keyChain||"",y=!1;if(!u||n&&h)return!1;for(var m=u.length;m--;)if((s=u[m].eventCommandLookup(e,t))&&s.command){var g=s,v=g.command,x=g.args,b=g.passEvent,w=g.count,_=g.keyChain,k=g.onlyWhenFocused;if(y=!0,p=w,f=_,d="null"===v,k){var S=e.world();if(S&&S.focusedMorph&&S.focusedMorph!==e)continue}if(!(l=!d&&e.execCommand(v,x,w,t))||h&&"insertstring"===v||b||"function"!=typeof t.stop||t.stop(),l||d)break}if(!l&&!d&&h&&e.onTextInput&&!f){var M=c.count;l=e.execCommand("insertstring",{string:a||o,undoGroup:z.text.undoGroupDelay},M,t)}return y&&("function"==typeof t.onAfterDispatch?t.onAfterDispatch(function(){c.count=l?void 0:p,c.keyChain=l?"":f}):(c.count=l?void 0:p,c.keyChain=l?"":f)),l&&!d}function simulateKey(e,t,n){return invokeKeyHandlers(e,Object.assign({},Le.keyComboToEventSpec(t),{keyInputState:n}))}function findKeysForPlatform(e,t){if("string"==typeof e)return e;if(!e||"object"!==(void 0===e?"undefined":B(e)))return null;switch(t){case"ios":return e.ios||e.mac;case"mac":return e.mac||e.ios;case"win":case"windows":case"windowsphone":return e.win||e.windows;case"linux":return e.linux||e.win||e.windows;case"chromeos":return e.chromeos||e.linux||e.win||e.windows;case"android":return e.android||e.linux||e.win||e.windows;default:return e.linux||e.win||e.windows}}var $e,Ke,Xe,Ye,Je=/Meta|Cmd|Command/gi,Qe=/Alt/gi,Ze=/Ctrl|Control/gi,et=/Tab/gi,tt=/Enter|Return/gi,nt=/Shift/gi,rt=/Backspace/gi,it=/del(ete)?/gi,ot=/left/gi,at=/right/gi,st=/up/gi,lt=/down/gi,ut=/([^-])-/g,ct=/([^\s])\s/g,ht=function(e){var t=_classRecorder,i=t.hasOwnProperty("KeyHandler")&&"function"==typeof t.KeyHandler?t.KeyHandler:t.KeyHandler=function KeyHandler(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(i,e,[{key:Symbol.for("lively-instance-initialize"),value:function KeyHandler_initialize_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function bowserOS(){return n.mac?"mac":n.windows?"windows":n.windowsphone?"windowsphone":n.linux?"linux":n.chromeos?"chromeos":n.android?"android":n.ios?"ios":n.blackberry?"blackberry":n.firefoxos?"firefoxos":n.webos?"webos":n.bada?"bada":n.tizen?"tizen":n.sailfish?"sailfish":"unknown"}();this.platform=e,this.keyBindings={}}},{key:"eventCommandLookup",value:function KeyHandler_eventCommandLookup_(e,t){var n=t.keyCombo,r=t.keyInputState;return this.lookup(n,r)}},{key:"lookup",value:function KeyHandler_lookup_(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{keyChain:void 0,count:void 0};e=Le.canonicalizeKeyCombo(e);var r=n.keyChain||"",i=n.count;if(!r&&e.startsWith("Ctrl-")){var o=e.match(/^Ctrl-([0-9]+)/);if(o)return{command:"null",count:parseInt(("number"==typeof i?i:"")+o[1])};if("Ctrl-U"===e)return{command:"null",count:4,keyChain:"Ctrl-U"}}var a=[e];if(!u&&e.startsWith("input-")){var s=e.replace(/^(input-)(.*)$/,function(e,t,n){return t+n.toUpperCase()}),l=e.replace(/^(input-)(.*)$/,function(e,t,n){return t+n.toLowerCase()});a.push(s,l)}var u=a.map(function(e){return t.keyBindings[e]})[0];if(r){var c=a.find(function(e){return t.keyBindings[r+" "+e]});c&&(r+=" "+c,u=this.keyBindings[r]||u)}if(u&&"chainKeys"===u){var h={command:"null",keyChain:r=r||e};return void 0!==i&&(h.count=i),h}if(u){h="object"===(void 0===u?"undefined":B(u))?Object.assign({},u):{command:u};return void 0!==i&&(h.count=i),h}}},{key:"bindKey",value:function KeyHandler_bindKey_(e,t){var n=this;if("object"==(void 0===e?"undefined":B(e))&&e&&!Array.isArray(e)&&(e=findKeysForPlatform(e,this.platform)),e){if("function"==typeof t)return this.addCommand({exec:t,bindKey:e,name:t.name||e});(Array.isArray(e)?e:e.includes("|")?e.split("|"):[e]).forEach(function(e){var r="";if(-1!=e.indexOf(" ")){var i=e.split(/\s+/);e=i.pop(),i.forEach(function(e){var t=Le.canonicalizeKeyCombo(e);r+=(r?" ":"")+t,n.addCommandToBinding(r,"chainKeys")}),r+=" "}n.addCommandToBinding(r+Le.canonicalizeKeyCombo(e),t)}),this.cleanupUnusedKeyChains()}}},{key:"unbindKey",value:function KeyHandler_unbindKey_(e){this.bindKey(e,null)}},{key:"cleanupUnusedKeyChains",value:function KeyHandler_cleanupUnusedKeyChains_(){var e=this,t=Object.keys(this.keyBindings),n=t.filter(function(t){return"chainKeys"===e.keyBindings[t]});(n=r.arr.sortBy(n,function(e){return e.length}).reverse()).forEach(function(i){t.some(function(e){return i!==e&&e.startsWith(i)})||(delete e.keyBindings[i],r.arr.remove(t,i),r.arr.remove(n,i))})}},{key:"addCommand",value:function KeyHandler_addCommand_(e){return e&&e.bindKey?this.addCommandToBinding(e.bindKey,e):void 0}},{key:"addCommandToBinding",value:function KeyHandler_addCommandToBinding_(e,t){var n=this;"chainKeys"===this.keyBindings[e]&&"chainKeys"!=t&&Object.keys(this.keyBindings).forEach(function(t){t.startsWith(e)&&delete n.keyBindings[t]}),t?this.keyBindings[e]=t:delete this.keyBindings[e],"chainKeys"!==t&&this.cleanupUnusedKeyChains()}}],[{key:"invokeKeyHandlers",value:function KeyHandler_invokeKeyHandlers_(e,t){return invokeKeyHandlers(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}},{key:"simulateKeys",value:function KeyHandler_simulateKeys_(e,t,n){return Ge(e,t,n)}},{key:"withBindings",value:function KeyHandler_withBindings_(e,t){var n=new this(t);return e.forEach(function(e){var t=e.command,r=e.keys;return n.bindKey(r,t)}),n}},{key:"prettyCombo",value:function KeyHandler_prettyCombo_(e){var t=this._prettyCombos||(this._prettyCombos={});return this._prettyCombos[e]?t[e]:t[e]=e.replace(Je,"").replace(Qe,"").replace(Ze,"").replace(et,"").replace(tt,"").replace(nt,"").replace(rt,"").replace(it,"").replace(ot,"").replace(at,"").replace(st,"").replace(lt,"").replace(ut,"$1").replace(ct,"$1-")}},{key:"generateCommandToKeybindingMap",value:function KeyHandler_generateCommandToKeybindingMap_(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o={},a={};return(n?e.commandsIncludingOwners:e.commands.map(function(t){return{command:t,target:e}})).map(function(e){var n=e.target,s=e.command,l=function commandsToKeysFor(e){if(a[e.id])return a[e.id];var t=o[e.id]||(o[e.id]=e.keyCommandMap);return a[e.id]=r.arr.groupBy(Object.keys(t),function(e){return t[e].name})}(n)[s.name];return{keys:l,target:n,command:s,prettyKeys:l&&i?l.map(function(e){return t.prettyCombo(e)}):null}})}}],t,void 0,{start:6168,end:13037})}(void 0),dt=function(e){var t=_classRecorder,n=t.hasOwnProperty("Script")&&"function"==typeof t.Script?t.Script:t.Script=function Script(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function Script_initialize_(){this.suspended=!1,this.stopped=!0,this.tickTime=null,this.type=null,this.currentTimeout=null}},{key:"__additionally_serialize__",value:function Script___additionally_serialize___(e,t,n){e.props.suspended.value=!0}},{key:"isScript",get:function get(){return!0}},{key:"global",get:function get(){return System.global}},{key:"execute",value:function Script_execute_(){throw new Error("subclass responsibility")}},{key:"tick",value:function Script_tick_(){try{this.execute()}catch(e){return void console.error("Error executing script "+this+": "+e+"\n"+e.stack)}this.stopped||this.startTicking(this.tickTime)}},{key:"startTicking",value:function Script_startTicking_(e){this.stopped=!1,this.tickTime=e,this.type="number"==typeof e?"setTimeout":"requestAnimationFrame",this.currentTimeout="setTimeout"===this.type?this.global.setTimeout(this.tick.bind(this),e):this.global.requestAnimationFrame(this.tick.bind(this))}},{key:"stop",value:function Script_stop_(){var e="setTimeout"===this.type?"clearTimeout":"cancelAnimationFrame";this.global[e](this.currentTimeout),this.stopped=!0}},{key:"resume",value:function Script_resume_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.tickTime;this.suspended&&(this.suspended=!1,this.startTicking(this.tickTime=e))}},{key:"suspend",value:function Script_suspend_(){this.stop(),this.suspended=!0}}],void 0,t,void 0,{start:19,end:1360})}(void 0),pt=function(e){var t=_classRecorder,n=t.hasOwnProperty("TargetScript")&&"function"==typeof t.TargetScript?t.TargetScript:t.TargetScript=function TargetScript(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function TargetScript_initialize_(e,t,r){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(n.prototype),Symbol.for("lively-instance-initialize"),this).call(this),this.target=e,this.selector=t,this.args=r||[]}},{key:"execute",value:function TargetScript_execute_(){"function"==typeof this.target[this.selector]&&this.target[this.selector].apply(this.target,this.args)}},{key:"equals",value:function TargetScript_equals_(e){return e.isScript&&this.target==e.target&&this.selector==e.selector}},{key:"toString",value:function TargetScript_toString_(){return"Script("+this.target+">>"+this.selector+"("+this.args.join(",")+"))"}}],void 0,t,void 0,{start:1362,end:1906})}(dt),ft=(function(e){var t=_classRecorder,n=t.hasOwnProperty("FunctionScript")&&"function"==typeof t.FunctionScript?t.FunctionScript:t.FunctionScript=function FunctionScript(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function FunctionScript_initialize_(e){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(n.prototype),Symbol.for("lively-instance-initialize"),this).call(this),this.callback=e}},{key:"execute",value:function FunctionScript_execute_(){this.callback()}},{key:"equals",value:function FunctionScript_equals_(e){return e.isScript&&this.callback==e.callback}},{key:"toString",value:function FunctionScript_toString_(){return"Script("+this.callback.toString().replace(/\n/g,"").slice(0,40)+"...)"}}],void 0,t,void 0,{start:1908,end:2242})}(dt),ft||(ft=new Map)),yt=("undefined"!=typeof document?document.location.origin:"http://localhost:9001")+"/objectdb/",mt=function(e){var t=_classRecorder,n=t.hasOwnProperty("MorphicDB")&&"function"==typeof t.MorphicDB?t.MorphicDB:t.MorphicDB=function MorphicDB(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function MorphicDB_initialize_(e,t){var n=t.snapshotLocation,r=t.serverURL;this.name=e,this.serverURL=r,this.snapshotLocation=n||e+"/snapshots/",this.httpDB=new y.ObjectDBHTTPInterface(r),this._initialized=!1}},{key:"__serialize__",value:function MorphicDB___serialize___(){var e=this.name,t=this.serverURL;return{__expr__:'MorphicDB.named("'+e+'", {snapshotLocation: "'+this.snapshotLocation+'", serverURL: "'+t+'"})',bindings:{"lively.morphic/morphicdb.js":[{exported:"default",local:"MorphicDB"}]}}}},{key:"initializeIfNecessary",value:function(){var e=H(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(e){for(;;)switch(e.prev=e.next){case 0:if(!this._initialized){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.ensureDB();case 4:this._initialized=!0;case 5:case"end":return e.stop()}},_callee,this)}));return function MorphicDB_initializeIfNecessary_(){return e.apply(this,arguments)}}()},{key:"snapshotResourceFor",value:function MorphicDB_snapshotResourceFor_(e){var t=e.content.slice(0,2),n=e.content.slice(2);return f.resource(System.decanonicalize(this.snapshotLocation)).join(t+"/"+n+".json")}},{key:"ensureDB",value:function MorphicDB_ensureDB_(){var e=this.name,t=this.snapshotLocation;return this.httpDB.ensureDB({db:e,snapshotLocation:t})}},{key:"destroyDB",value:function MorphicDB_destroyDB_(){this._initialized=!1;var e=this.name;return this.httpDB.destroyDB({db:e})}},{key:"latestCommits",value:function(){var e=H(regeneratorRuntime.mark(function _callee2(){var e,t,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"world",i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return regeneratorRuntime.wrap(function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.initializeIfNecessary();case 2:return e=this.name,t="HEAD",n={},o.abrupt("return",this.httpDB.fetchCommits({db:e,type:r,ref:t,knownCommitIds:n,includeDeleted:i}));case 6:case"end":return o.stop()}},_callee2,this)}));return function MorphicDB_latestCommits_(t,n){return e.apply(this,arguments)}}()},{key:"fetchCommit",value:function(){var e=H(regeneratorRuntime.mark(function _callee3(e,t,n){var r,i;return regeneratorRuntime.wrap(function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.initializeIfNecessary();case 2:return r=[{type:e,name:t,ref:n}],o.next=5,this.httpDB.fetchCommits({db:this.name,ref:n,type:e,typesAndNames:r});case 5:return i=o.sent,o.abrupt("return",i[0]);case 7:case"end":return o.stop()}},_callee3,this)}));return function MorphicDB_fetchCommit_(t,n,r){return e.apply(this,arguments)}}()},{key:"fetchSnapshot",value:function(){var e=H(regeneratorRuntime.mark(function _callee4(e,t,n,r){var i,o,a=arguments;return regeneratorRuntime.wrap(function _callee4$(s){for(;;)switch(s.prev=s.next){case 0:return i=e,1===a.length&&i.type&&i.name&&(e=i.type,t=i.name,n=i._id),s.next=4,this.initializeIfNecessary();case 4:return o=this.name,s.abrupt("return",this.httpDB.fetchSnapshot({db:o,type:e,name:t,ref:r,commit:n}));case 6:case"end":return s.stop()}},_callee4,this)}));return function MorphicDB_fetchSnapshot_(t,n,r,i){return e.apply(this,arguments)}}()},{key:"exists",value:function(){var e=H(regeneratorRuntime.mark(function _callee5(e,t,n){var r;return regeneratorRuntime.wrap(function _callee5$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.initializeIfNecessary();case 2:return r=this.name,i.abrupt("return",this.httpDB.exists({db:r,type:e,name:t,ref:n}));case 4:case"end":return i.stop()}},_callee5,this)}));return function MorphicDB_exists_(t,n,r){return e.apply(this,arguments)}}()},{key:"history",value:function(){var e=H(regeneratorRuntime.mark(function _callee6(e,t){var n;return regeneratorRuntime.wrap(function _callee6$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.initializeIfNecessary();case 2:return n=this.name,r.abrupt("return",this.httpDB.fetchVersionGraph({db:n,type:e,name:t}));case 4:case"end":return r.stop()}},_callee6,this)}));return function MorphicDB_history_(t,n){return e.apply(this,arguments)}}()},{key:"log",value:function(){var e=H(regeneratorRuntime.mark(function _callee7(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments[3];return regeneratorRuntime.wrap(function _callee7$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.initializeIfNecessary();case 2:return n=this.name,o.abrupt("return",this.httpDB.fetchLog({db:n,commit:e,limit:t,includeCommits:r,knownCommitIds:i}));case 4:case"end":return o.stop()}},_callee7,this)}));return function MorphicDB_log_(t,n,r,i){return e.apply(this,arguments)}}()},{key:"revert",value:function(){var e=H(regeneratorRuntime.mark(function _callee8(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"HEAD";return regeneratorRuntime.wrap(function _callee8$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.initializeIfNecessary();case 2:return r=this.name,o.abrupt("return",this.httpDB.revert({db:r,type:e,name:t,toCommitId:n,ref:i}));case 4:case"end":return o.stop()}},_callee8,this)}));return function MorphicDB_revert_(t,n,r,i){return e.apply(this,arguments)}}()},{key:"snapshotAndCommit",value:function(){var e=H(regeneratorRuntime.mark(function _callee9(e,t,n,i,o,a,s){var l,u;return regeneratorRuntime.wrap(function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,Ft(n,i);case 2:return l=c.sent,c.next=5,this.commit(e,t,l,o,a,s);case 5:return u=c.sent,n.changeMetaData("commit",r.obj.dissoc(u,["preview"]),!0,!1),c.abrupt("return",u);case 8:case"end":return c.stop()}},_callee9,this)}));return function MorphicDB_snapshotAndCommit_(t,n,r,i,o,a,s){return e.apply(this,arguments)}}()},{key:"commit",value:function(){var e=H(regeneratorRuntime.mark(function _callee10(e,t,n,i,o,a){var s,l,u=arguments;return regeneratorRuntime.wrap(function _callee10$(c){for(;;)switch(c.prev=c.next){case 0:return s=e,1===u.length&&s.type&&s.name&&(e=s.type,t=s.name,n=s.snapshot||s.content,i=r.obj.dissoc(s,["snapshot","_rev","_id","ancestors","deleted"]),a=s._id),c.next=4,this.initializeIfNecessary();case 4:return l=this.name,c.abrupt("return",this.httpDB.commit({db:l,type:e,name:t,ref:o,expectedParentCommit:a,commitSpec:i,snapshot:n}));case 6:case"end":return c.stop()}},_callee10,this)}));return function MorphicDB_commit_(t,n,r,i,o,a){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=H(regeneratorRuntime.mark(function _callee11(e,t,n,i,o){var a,s,l,u,c,h;return regeneratorRuntime.wrap(function _callee11$(d){for(;;)switch(d.prev=d.next){case 0:if(a=void 0,"object"===(void 0===e?"undefined":B(e))?i=e:a=e,s=i){d.next=9;break}return d.next=6,this.fetchCommit(a,t,o);case 6:s=d.sent,d.next=15;break;case 9:if("string"!=typeof s){d.next=15;break}return d.next=12,this.log(s,1,!0);case 12:l=d.sent,u=$(l,1),s=u[0];case 15:return d.next=17,this.fetchSnapshot(void 0,void 0,s._id);case 17:return c=d.sent,d.next=20,loadMorphFromSnapshot$$1(c,n);case 20:return(h=d.sent).changeMetaData("commit",r.obj.dissoc(s,["preview"]),!0,!1),d.abrupt("return",h);case 23:case"end":return d.stop()}},_callee11,this)}));return function MorphicDB_load_(t,n,r,i,o){return e.apply(this,arguments)}}()},{key:"fetchDiff",value:function(){var e=H(regeneratorRuntime.mark(function _callee12(e){var t;return regeneratorRuntime.wrap(function _callee12$(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.initializeIfNecessary();case 2:return t=this.name,n.abrupt("return",this.httpDB.fetchDiff({db:t,otherDB:e}));case 4:case"end":return n.stop()}},_callee12,this)}));return function MorphicDB_fetchDiff_(t){return e.apply(this,arguments)}}()},{key:"fetchConflicts",value:function(){var e=H(regeneratorRuntime.mark(function _callee13(e,t){var n;return regeneratorRuntime.wrap(function _callee13$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.initializeIfNecessary();case 2:return n=this.name,r.abrupt("return",this.httpDB.fetchConflicts({db:n,includeDocs:e,only:t}));case 4:case"end":return r.stop()}},_callee13,this)}));return function MorphicDB_fetchConflicts_(t,n){return e.apply(this,arguments)}}()},{key:"resolveConflict",value:function(){var e=H(regeneratorRuntime.mark(function _callee14(e){var t;return regeneratorRuntime.wrap(function _callee14$(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.initializeIfNecessary();case 2:return t=this.name,n.abrupt("return",this.httpDB.resolveConflict(Object.assign({db:t},e)));case 4:case"end":return n.stop()}},_callee14,this)}));return function MorphicDB_resolveConflict_(t){return e.apply(this,arguments)}}()},{key:"synchronize",value:function(){var e=H(regeneratorRuntime.mark(function _callee15(e){var t,n=e.method,r=e.otherDB,i=e.otherDBSnapshotLocation,o=e.onlyTypesAndNames;return regeneratorRuntime.wrap(function _callee15$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initializeIfNecessary();case 2:return t=this.name,e.abrupt("return",this.httpDB.synchronize({db:t,method:n,otherDB:r,otherDBSnapshotLocation:i,onlyTypesAndNames:o}));case 4:case"end":return e.stop()}},_callee15,this)}));return function MorphicDB_synchronize_(t){return e.apply(this,arguments)}}()},{key:"softDelete",value:function(){var e=H(regeneratorRuntime.mark(function _callee16(e,t,n,r,i){return regeneratorRuntime.wrap(function _callee16$(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",this.commit(e,t,void 0,n,r,i));case 1:case"end":return o.stop()}},_callee16,this)}));return function MorphicDB_softDelete_(t,n,r,i,o){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=H(regeneratorRuntime.mark(function _callee17(e,t){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return regeneratorRuntime.wrap(function _callee17$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.initializeIfNecessary();case 2:return n=this.name,i.abrupt("return",this.httpDB.delete({db:n,type:e,name:t,dryRun:r}));case 4:case"end":return i.stop()}},_callee17,this)}));return function MorphicDB_delete_(t,n,r){return e.apply(this,arguments)}}()},{key:"deleteCommit",value:function(){var e=H(regeneratorRuntime.mark(function _callee18(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return regeneratorRuntime.wrap(function _callee18$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.initializeIfNecessary();case 2:return t=this.name,r.abrupt("return",this.httpDB.deleteCommit({db:t,commit:e,dryRun:n}));case 4:case"end":return r.stop()}},_callee18,this)}));return function MorphicDB_deleteCommit_(t,n){return e.apply(this,arguments)}}()},{key:"codeSearchInPackages",value:function(){var e=H(regeneratorRuntime.mark(function _callee19(e){var t,n,r,i,o,a,s,l,u,c,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"part",d=arguments[2],p=arguments[3];return regeneratorRuntime.wrap(function _callee19$(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.latestCommits(h);case 2:t=f.sent,n=[],r=0,"function"==typeof p&&(t=t.filter(p)),i=!0,o=!1,a=void 0,f.prev=9,s=t[Symbol.iterator]();case 11:if(i=(l=s.next()).done){f.next=21;break}return u=l.value,"function"==typeof d&&d(u.name,r++,t.length),f.next=16,this._textSearchInSnapshotOfCommit(e,u);case 16:(c=f.sent).length&&n.push.apply(n,X(c));case 18:i=!0,f.next=11;break;case 21:f.next=27;break;case 23:f.prev=23,f.t0=f.catch(9),o=!0,a=f.t0;case 27:f.prev=27,f.prev=28,!i&&s.return&&s.return();case 30:if(f.prev=30,!o){f.next=33;break}throw a;case 33:return f.finish(30);case 34:return f.finish(27);case 35:return f.abrupt("return",n);case 36:case"end":return f.stop()}},_callee19,this,[[9,23,27,35],[28,,30,34]])}));return function MorphicDB_codeSearchInPackages_(t,n,r,i){return e.apply(this,arguments)}}()},{key:"_textSearchInSnapshotOfCommit",value:function(){var e=H(regeneratorRuntime.mark(function _callee20(e,t,n){var r,i;return regeneratorRuntime.wrap(function _callee20$(o){for(;;)switch(o.prev=o.next){case 0:if(r=t._id,o.t0=n,o.t0){o.next=6;break}return o.next=5,this.fetchSnapshot(void 0,void 0,r);case 5:o.t0=o.sent;case 6:return i=o.t0,o.abrupt("return",new gt(i).textSearch(e,t));case 8:case"end":return o.stop()}},_callee20,this)}));return function MorphicDB__textSearchInSnapshotOfCommit_(t,n,r){return e.apply(this,arguments)}}()}],[{key:"default",get:function get(){return this.named("lively.morphic/objectdb/morphicdb",{serverURL:yt})}},{key:"named",value:function MorphicDB_named_(e,t){var n=ft.get(e);if(n)return n;if(!t.serverURL)throw new Error("Needs serverURL!");var r=new this(e,t);return ft.set(e,r),r}},{key:"wellKnownMorphicDBs",value:function(){var e=H(regeneratorRuntime.mark(function _callee21(){var e,t,n,r=this;return regeneratorRuntime.wrap(function _callee21$(i){for(;;)switch(i.prev=i.next){case 0:return e=y.Database.ensureDB("lively.morphic/morphicdb/well-known-morphic-dbs"),i.next=3,e.getAll();case 3:return t=i.sent,(n=t.reduce(function(e,t){var n=t._id,i=t.name,o=t.serverURL,a=t.snapshotLocation;return Object.assign(e,U({},n,r.named(i,{serverURL:o,snapshotLocation:a})))},{})).default||(n.default=this.default),i.abrupt("return",n);case 7:case"end":return i.stop()}},_callee21,this)}));return function MorphicDB_wellKnownMorphicDBs_(){return e.apply(this,arguments)}}()},{key:"addWellKnownMorphicDB",value:function(){var e=H(regeneratorRuntime.mark(function _callee22(e,t){var n,r,i,o;return regeneratorRuntime.wrap(function _callee22$(a){for(;;)switch(a.prev=a.next){case 0:return n=t.name,r=t.snapshotLocation,i=t.serverURL,o=y.Database.ensureDB("lively.morphic/morphicdb/well-known-morphic-dbs"),a.next=6,o.set(e,{name:n,snapshotLocation:r,serverURL:i});case 6:case"end":return a.stop()}},_callee22,this)}));return function MorphicDB_addWellKnownMorphicDB_(t,n){return e.apply(this,arguments)}}()},{key:"removeWellKnownMorphicDB",value:function(){var e=H(regeneratorRuntime.mark(function _callee23(e){var t;return regeneratorRuntime.wrap(function _callee23$(n){for(;;)switch(n.prev=n.next){case 0:return t=y.Database.ensureDB("lively.morphic/morphicdb/well-known-morphic-dbs"),n.next=3,t.remove(e);case 3:case"end":return n.stop()}},_callee23,this)}));return function MorphicDB_removeWellKnownMorphicDB_(t){return e.apply(this,arguments)}}()}],t,void 0,{start:885,end:9265})}(void 0),gt=function(e){var t=_classRecorder,n=t.hasOwnProperty("SnapshotPackageHelper")&&"function"==typeof t.SnapshotPackageHelper?t.SnapshotPackageHelper:t.SnapshotPackageHelper=function SnapshotPackageHelper(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function SnapshotPackageHelper_initialize_(e){this.snapshot=e}},{key:"textSearch",value:function SnapshotPackageHelper_textSearch_(e,t){var n=this,i=e&&e instanceof RegExp,o=[];if(!e)return o;var a=!0,s=!1,l=void 0;try{for(var u,c=function _loop(){var a=u.value,s=a.get(n.snapshot),l=r.string.lineIndexComputer(s),c=r.string.lineRanges(s);if(i){var h=r.string.reMatches(s,e);h.length&&o.push.apply(o,X(h.map(function(e){return Object.assign(e,{commit:t,file:a})})))}else for(var d=0,p=0;(d=s.indexOf(e))>=0;){var f,y=d+p,m=y+e.length,g=l(y),v=(f=s).slice.apply(f,X(c[g]));o.push({match:e,start:y,end:m,length:e.length,line:g,lineString:v,commit:t,file:a}),p+=d+e.length,s=s.slice(d+e.length)}},h=this.filesInPackages()[Symbol.iterator]();!(a=(u=h.next()).done);a=!0)c()}catch(e){s=!0,l=e}finally{try{!a&&h.return&&h.return()}finally{if(s)throw l}}return o}},{key:"filesInPackages",value:function SnapshotPackageHelper_filesInPackages_(){var e=[];for(var t in this.snapshot.packages)collectFiles(this.snapshot.packages[t],[t],t,null,e);return e;function collectFiles(e,t,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];if(e["package.json"]&&"string"==typeof e["package.json"])try{var a=JSON.parse(e["package.json"]);i={url:n,path:t,name:a.name||r.arr.last(t)}}catch(e){}var s=[];for(var l in e)"string"==typeof e[l]?o.push({path:t.concat(l),url:r.string.joinPath(n,l),package:i,get:function get(e){return r.Path(this.path).get(e.packages)},set:function set(e,t){r.Path(this.path).set(e.packages,t)}}):s.push(l);return s.forEach(function(a){return collectFiles(e[a],t.concat(a),r.string.joinPath(n,a),i,o)}),o}}}],void 0,t,void 0,{start:9275,end:12284})}(void 0),vt=function(){var e=H(regeneratorRuntime.mark(function _callee(e){var t,n,r,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return t=o.morphicDB||mt.default,a.next=3,t.load("part","string"==typeof e?e:e.name,o,"string"==typeof e?void 0:e);case 3:return(n=a.sent).isWindow&&n.targetMorph&&(r=n.targetMorph,(i=n.metadata&&n.metadata.commit)&&r.changeMetaData("commit",i,!0,!1)),a.abrupt("return",n);case 6:case"end":return a.stop()}},_callee,this)}));return function loadPart(t,n){return e.apply(this,arguments)}}(),xt=($e=H(regeneratorRuntime.mark(function _callee3(e,t,n,r,i,o){var a,s,l,u,c,d=this;return regeneratorRuntime.wrap(function _callee3$(p){for(;;)switch(p.prev=p.next){case 0:if(p.prev=0,!e.isMorph){p.next=5;break}return p.delegateYield(regeneratorRuntime.mark(function _callee2(){var t,n,r,i,o,s;return regeneratorRuntime.wrap(function _callee2$(l){for(;;)switch(l.prev=l.next){case 0:t=[],e.withAllSubmorphsDo(function(e){"function"==typeof e.beforePublish&&t.push(e)}),n=!0,r=!1,i=void 0,l.prev=5,o=t[Symbol.iterator]();case 7:if(n=(s=o.next()).done){l.next=14;break}return a=s.value,l.next=11,a.beforePublish();case 11:n=!0,l.next=7;break;case 14:l.next=20;break;case 16:l.prev=16,l.t0=l.catch(5),r=!0,i=l.t0;case 20:l.prev=20,l.prev=21,!n&&o.return&&o.return();case 23:if(l.prev=23,!r){l.next=26;break}throw i;case 26:return l.finish(23);case 27:return l.finish(20);case 28:case"end":return l.stop()}},_callee2,d,[[5,16,20,28],[21,,23,27]])})(),"t0",3);case 3:p.next=8;break;case 5:if("function"!=typeof e.beforePublish){p.next=8;break}return p.next=8,e.beforePublish(t,e);case 8:p.next=14;break;case 10:p.prev=10,p.t1=p.catch(0),s="Error in beforePublish of "+e+"\n"+p.t1.stack,"function"==typeof e.world&&e.world()?e.world().logError(new Error(s)):console.error(s);case 14:return l=Object.assign({previewWidth:100,previewHeight:100,previewType:"png"},n),u=n.morphicDB||mt.default,p.next=18,u.snapshotAndCommit("part",t,e,l,r,i,o);case 18:return c=p.sent,h.emit("lively.partsbin/partpublished",c),p.abrupt("return",c);case 21:case"end":return p.stop()}},_callee3,this,[[0,10]])})),function savePart(e,t,n,r,i,o){return $e.apply(this,arguments)}),bt=(Ke=H(regeneratorRuntime.mark(function _callee4(e){var t,n,i,o,a,s,l,u,c,h,p,f,y,m,g,v,x,b,w,_,k,S,M,C,P,T,A,L,R,E,z,O,I,D,N,F,B,j,W,H,V,U,q,G,K,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function _callee4$(Y){for(;;)switch(Y.prev=Y.next){case 0:if(t=X.showPublishDialog,n=void 0===t||t,i=X.notifications,o=void 0===i||i,a=X.loadingIndicator,s=void 0===a||a,l=X.preferWindow,u=void 0===l||l,c=void 0,h=void 0,p=e,f=e.world()||e.env.world,y=e.name,m=[],g="",v=r.Path("metadata.commit").get(e)||r.Path("metadata.commit").get(p),x=X.morphicDB||mt.default,v||(v={type:"part",name:e.name,author:f.getCurrentUser(),tags:[],description:"no description"}),!n){Y.next=30;break}return Y.t0=f,Y.next=15,vt("publish part dialog");case 15:return Y.t1=Y.sent,Y.t2={part:e},Y.next=19,Y.t0.openPrompt.call(Y.t0,Y.t1,Y.t2);case 19:if(b=Y.sent,w=b.db,_=b.commit){Y.next=24;break}return Y.abrupt("return",null);case 24:w&&(X.morphicDB=x=w),y=_.name,m=_.tags,g=_.description,Y.next=31;break;case 30:v&&(y=(k=v).name,m=k.tags,g=k.description);case 31:if(!s){Y.next=35;break}return S=d.open("saving "+y+"..."),Y.next=35,r.promise.delay(80);case 35:if(Y.prev=35,M="HEAD",C=v?v.name:e.name,P=void 0,C===y){Y.next=53;break}return Y.next=40,x.exists("part",y);case 40:if(T=Y.sent,A=T.exists,L=T.commitId,!A){Y.next=50;break}return Y.next=46,f.confirm('A part "'+y+'" already exists, overwrite?');case 46:if(Y.sent){Y.next=49;break}return Y.abrupt("return",null);case 49:P=L;case 50:p.name=y,Y.next=54;break;case 53:P=v?v._id:void 0;case 54:return u&&!e.isWindow&&(R=e.getWindow())&&R.targetMorph===e&&(e=R,h=R.metadata,c=!0),E={author:e.world().getCurrentUser(),message:"published",tags:m,description:g},Y.next=58,xt(e,y,X,E,M,P);case 58:return z=Y.sent,c&&(p.metadata?p.metadata.commit=R.metadata.commit:p.metadata={commit:R.metadata.commit},R.metadata=h),o&&e.setStatusMessage("saved part "+y),Y.abrupt("return",z);case 64:if(Y.prev=64,Y.t3=Y.catch(35),O=Y.t3.message.match(/Trying to store "([^\"]+)" on top of expected version ([^\s]+) but ref HEAD is of version ([^\s\!]+)/)||[],I=$(O,4),I[0],I[1],D=I[2],N=I[3],!D||!N){Y.next=89;break}return Y.next=75,x.log(N,1,!0);case 75:return F=Y.sent,B=$(F,1),j=B[0],W=j.author.name,H=j.timestamp,V="The current version of part "+y+" is not the most recent!\nA newer version by "+W+" was saved on "+r.date.format(new Date(H),"yyyy-mm-dd HH:MM")+". Overwrite?",Y.next=83,f.confirm(V);case 83:if(Y.sent){Y.next=86;break}return Y.abrupt("return",null);case 86:return U=r.obj.dissoc(j,["preview"]),p.changeMetaData("commit",U,!0,!1),Y.abrupt("return",bt(p,Object.assign({},X,{morphicDB:x,showPublishDialog:!1})));case 89:if(q=Y.t3.message.match(/Trying to store "([^\"]+)" on top of expected version ([^\s]+) but no version entry exists/)||[],G=$(q,3),G[0],G[1],!G[2]){Y.next=103;break}return K="Part "+y+" no longer exist in the object database.\nDo you still want to publish it?",Y.next=98,f.confirm(K);case 98:if(Y.sent){Y.next=101;break}return Y.abrupt("return",null);case 101:return p.changeMetaData("commit",null,!0,!1),Y.abrupt("return",bt(p,Object.assign({},X,{morphicDB:x,showPublishDialog:!1})));case 103:throw console.error(Y.t3),o&&f.logError("Error saving part: "+Y.t3),Y.t3;case 106:return Y.prev=106,S&&S.remove(),Y.finish(106);case 109:case"end":return Y.stop()}},_callee4,this,[[35,64,106,109]])})),function interactivelySavePart(e,t){return Ke.apply(this,arguments)}),wt=(Xe=H(regeneratorRuntime.mark(function _callee8(e,t){var n,r,i,o,a,s=this,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return regeneratorRuntime.wrap(function _callee8$(u){for(;;)switch(u.prev=u.next){case 0:if((l=Object.assign({preferWindow:!0},l)).preferWindow&&(n=e.getWindow(),e=n&&n.targetMorph===e?n:e),u.prev=2,!e.isMorph){u.next=7;break}return u.delegateYield(regeneratorRuntime.mark(function _callee7(){var t,n,i,o,a,l;return regeneratorRuntime.wrap(function _callee7$(s){for(;;)switch(s.prev=s.next){case 0:t=[],e.withAllSubmorphsDo(function(e){"function"==typeof e.beforePublish&&t.push(e)}),n=!0,i=!1,o=void 0,s.prev=5,a=t[Symbol.iterator]();case 7:if(n=(l=a.next()).done){s.next=14;break}return r=l.value,s.next=11,r.beforePublish();case 11:n=!0,s.next=7;break;case 14:s.next=20;break;case 16:s.prev=16,s.t0=s.catch(5),i=!0,o=s.t0;case 20:s.prev=20,s.prev=21,!n&&a.return&&a.return();case 23:if(s.prev=23,!i){s.next=26;break}throw o;case 26:return s.finish(23);case 27:return s.finish(20);case 28:case"end":return s.stop()}},_callee7,s,[[5,16,20,28],[21,,23,27]])})(),"t0",5);case 5:u.next=10;break;case 7:if("function"!=typeof e.beforePublish){u.next=10;break}return u.next=10,e.beforePublish(t,e);case 10:u.next=16;break;case 12:u.prev=12,u.t1=u.catch(2),i="Error in beforePublish of "+e+"\n"+u.t1.stack,"function"==typeof e.world&&e.world()?e.world().logError(new Error(i)):console.error(i);case 16:return u.next=18,f.resource(l.partsbinFolder).ensureExistance();case 18:return o=f.resource(l.partsbinFolder).join(t+".json"),u.next=21,Ft(e,l);case 21:return a=u.sent,u.next=24,o.write(JSON.stringify(a,null,2));case 24:return u.abrupt("return",{partName:t,url:o.url});case 25:case"end":return u.stop()}},_callee8,this,[[2,12]])})),Ye=H(regeneratorRuntime.mark(function _callee9(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function _callee9$(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",vt(e,t));case 1:case"end":return n.stop()}},_callee9,this)})),function loadObjectFromPartsbinFolder(e,t){return Ye.apply(this,arguments)});!function(e){var n=_classRecorder,o=n.hasOwnProperty("SnapshotEditor")&&"function"==typeof n.SnapshotEditor?n.SnapshotEditor:n.SnapshotEditor=function SnapshotEditor(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};lively.classes.runtime.initializeClass(o,e,[{key:Symbol.for("lively-instance-initialize"),value:function SnapshotEditor_initialize_(e,t,n){this.commit=e,this.snapshot=t,this._db=n}},{key:"db",get:function get(){return this._db||mt.default}},{key:"saveModifiedSnapshot",value:function(){var e=H(regeneratorRuntime.mark(function _callee10(e,t){var n,r,i,o;return regeneratorRuntime.wrap(function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:if(r=(n=e)._id,i=n.name,o=n.type,r){a.next=6;break}throw new Error("No id of commit, cannot save!");case 6:return a.next=8,this.db.commit(o,i,t,e,void 0,r);case 8:return e=a.sent,this.commit=e,this.snapshot=t,a.abrupt("return",e);case 12:case"end":return a.stop()}},_callee10,this)}));return function SnapshotEditor_saveModifiedSnapshot_(t,n){return e.apply(this,arguments)}}()},{key:"interactivelySaveModifiedSnapshot",value:function(){var e=H(regeneratorRuntime.mark(function _callee12(e,n){var o,s,l,u,c;return regeneratorRuntime.wrap(function _callee12$(h){for(;;)switch(h.prev=h.next){case 0:return o=r.promise.deferred(),s=o.promise,l=o.resolve,u=o.reject,c=this,Object.assign((d=void 0,void 0,p={type:"input",extent:t.pt(420,24),fixedWidth:!0,fixedHeight:!0,padding:t.Rectangle.inset(4,4),border:{color:t.Color.gray,width:1}},Object.assign(a.morph({extent:t.pt(420,24),layout:new a.VerticalLayout({resizeSubmorphs:!0,spacing:3}),submorphs:[Object.assign({},p,{name:"name input",placeholder:"name"}),Object.assign({},p,{name:"type input",placeholder:"type"}),Object.assign({},p,{name:"timestamp input",placeholder:"timestamp"}),{layout:new a.VerticalLayout({resizeSubmorphs:!0,spacing:3}),submorphs:[Object.assign({},p,{name:"author.name input",placeholder:"author name"}),Object.assign({},p,{name:"author.email input",placeholder:"author email"}),Object.assign({},p,{name:"author.realm input",placeholder:"author realm"})]},Object.assign({},p,{name:"tags input",placeholder:"tags"}),Object.assign({},p,{height:70,name:"description input",type:"text"}),Object.assign({},p,{height:70,name:"message input",type:"text"}),Object.assign({},p,{height:70,name:"metadata input",type:"text"}),{layout:new a.HorizontalLayout({spacing:3,direction:"centered"}),submorphs:[{type:"button",name:"ok button",label:"OK"},{type:"button",name:"cancel button",label:"Cancel"}]}],name:"commit editor",get ui(){return{metadataInput:this.get("metadata input"),messageInput:this.get("message input"),descriptionInput:this.get("description input"),tagsInput:this.get("tags input"),authorRealmInput:this.get("author.realm input"),authorEmailInput:this.get("author.email input"),authorNameInput:this.get("author.name input"),timestampInput:this.get("timestamp input"),typeInput:this.get("type input"),nameInput:this.get("name input"),cancelButton:this.get("cancel button"),okButton:this.get("ok button")}},set commit(e){this._commit=e;var t=e.name,n=e.type,r=e.timestamp,i=e.author,o=e.tags,a=e.description,s=e.metadata,l=this.ui,u=l.nameInput,c=l.typeInput,h=l.timestampInput,d=l.authorNameInput,p=l.authorEmailInput,f=l.authorRealmInput,y=l.tagsInput,m=l.descriptionInput,g=l.messageInput,v=l.metadataInput;u.input=t,c.input=n,h.input=String(new Date(r)),d.input=i.name,p.input=i.email,f.input=i.realm,y.input=o.join(" "),m.textString=a,g.textString="",v.textString=s?JSON.stringify(s,null,2):""},get commit(){var e=this._commit;if(!e)throw new Error("commit editor does not have a _commit object");var t=this.ui,n=t.nameInput,r=t.typeInput,i=(t.timestampInput,t.authorNameInput),o=t.authorEmailInput,a=t.authorRealmInput,s=t.tagsInput,l=t.descriptionInput,u=t.messageInput,c=t.metadataInput,h=n.input,d=r.input;if(e.name!==h)throw new Error("name does not match _commit.name: "+h+" vs "+e.name);if(e.type!==d)throw new Error("type does not match _commit.type: "+d+" vs "+e.type);return e.author.name=i.input,e.author.email=o.input,e.author.realm=a.input,e.tags=s.input.split(" ").map(function(e){return e.trim()}).filter(Boolean),e.description=l.textString,e.message=u.textString,e.metadata=c.textString?JSON.parse(c.textString):null,e},onLoad:function onLoad(){i.connect(this.ui.okButton,"fire",this,"accept"),i.connect(this.ui.cancelButton,"fire",this,"cancel")},accept:function accept(){},cancel:function cancel(){}}),d)),{commit:Object.assign({},this.commit,{},e),cancel:function cancel(){(this.getWindow()||this).remove(),u("canceled")},accept:function accept(){var e=this;return H(regeneratorRuntime.mark(function _callee11(){var t;return regeneratorRuntime.wrap(function _callee11$(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,c.saveModifiedSnapshot(e.commit,n);case 3:t=r.sent,(e.getWindow()||e).remove(),l(e.commit=t),r.next=12;break;case 8:r.prev=8,r.t0=r.catch(0),e.showError(r.t0),u(r.t0);case 12:case"end":return r.stop()}},_callee11,e,[[0,8]])}))()}}).openInWindow({title:"commit"}),h.abrupt("return",s);case 7:case"end":return h.stop()}var d,p},_callee12,this)}));return function SnapshotEditor_interactivelySaveModifiedSnapshot_(t,n){return e.apply(this,arguments)}}()},{key:"interactivelyEditMetadata",value:function(){var e=H(regeneratorRuntime.mark(function _callee13(e){var t;return regeneratorRuntime.wrap(function _callee13$(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.interactivelySaveModifiedSnapshot(this.commit,this.snapshot);case 2:return t=n.sent,"function"==typeof e&&e({commit:t,snapshot:this.snapshot}),n.abrupt("return",t);case 5:case"end":return n.stop()}},_callee13,this)}));return function SnapshotEditor_interactivelyEditMetadata_(t){return e.apply(this,arguments)}}()},{key:"interactivelyEditSnapshotJSON",value:function(){var e=H(regeneratorRuntime.mark(function _callee16(e){var t,n,r,i,o,a,s,l,u=this;return regeneratorRuntime.wrap(function _callee16$(c){for(;;)switch(c.prev=c.next){case 0:return t=this.commit,n=this.snapshot,i=(r=t)._id,o=r.name,a=r.type,r.author,s=void 0,c.next=10,System.import("lively.ide/text-editor.js");case 10:l=c.sent,l.default.openURL("<"+a+"/"+o+">",{historyId:"object-serialization-debugger-editor",customSaveAction:function(){var r=H(regeneratorRuntime.mark(function _callee14(r){var o,a,l;return regeneratorRuntime.wrap(function _callee14$(c){for(;;)switch(c.prev=c.next){case 0:if(c.t0=n,c.t0){c.next=5;break}return c.next=4,u.db.fetchSnapshot(void 0,void 0,i);case 4:c.t0=c.sent;case 5:if(o=c.t0,JSON.stringify(o,null,2)===s){c.next=13;break}return c.next=10,$world.confirm("Content change since loading, save anyway");case 10:if(c.sent){c.next=13;break}return c.abrupt("return",{saved:!1,message:"canceled"});case 13:return a=JSON.parse(r.ui.contentText.textString),c.next=16,u.interactivelySaveModifiedSnapshot(u.commit,a);case 16:return t=c.sent,n=a,s=r.ui.contentText.textString,l={saved:!0,snapshot:a,commit:t},"function"==typeof e&&e(l),c.abrupt("return",l);case 22:case"end":return c.stop()}},_callee14,u)}));return function customSaveAction(e){return r.apply(this,arguments)}}(),customLoadContentAction:function(){var e=H(regeneratorRuntime.mark(function _callee15(e,t){var r;return regeneratorRuntime.wrap(function _callee15$(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n,e.t0){e.next=5;break}return e.next=4,u.db.fetchSnapshot(void 0,void 0,i);case 4:e.t0=e.sent;case 5:return r=e.t0,e.abrupt("return",{content:s=JSON.stringify(r,null,2),url:a+"/"+o+".json"});case 7:case"end":return e.stop()}},_callee15,u)}));return function customLoadContentAction(t,n){return e.apply(this,arguments)}}()});case 13:case"end":return c.stop()}},_callee16,this)}));return function SnapshotEditor_interactivelyEditSnapshotJSON_(t){return e.apply(this,arguments)}}()},{key:"interactivelyEditPackageCode",value:function(){var e=H(regeneratorRuntime.mark(function _callee17(e){var t,n,r,i,o,a,s,l,u;return regeneratorRuntime.wrap(function _callee17$(c){for(;;)switch(c.prev=c.next){case 0:if(t=this.commit,n=this.snapshot,r=t._id,t.author,t.name,t.type,c.t0=n,c.t0){c.next=11;break}return c.next=10,this.db.fetchSnapshot(void 0,void 0,r);case 10:c.t0=c.sent;case 11:return i=c.t0,o=new gt(i).filesInPackages(),a=o.map(function(e){return{isListItem:!0,string:e.url,value:e}}),c.next=16,$world.filterableListPrompt("select file to edit",a,{historyId:"object-serialization-debugger-hist"});case 16:if(s=c.sent,l=$(s.selected,1),u=l[0]){c.next=21;break}return c.abrupt("return");case 21:return c.abrupt("return",this.interactivelyEditFileInSnapshotPackage(u,e));case 22:case"end":return c.stop()}},_callee17,this)}));return function SnapshotEditor_interactivelyEditPackageCode_(t){return e.apply(this,arguments)}}()},{key:"interactivelyEditFileInSnapshotPackage",value:function(){var e=H(regeneratorRuntime.mark(function _callee19(e,t,n){var r,i,o,a,s,l,u,c,h,d,p=this;return regeneratorRuntime.wrap(function _callee19$(f){for(;;)switch(f.prev=f.next){case 0:if(r=this.snapshot,i=this.commit,o=i._id,i.author,a=i.name,s=i.type,f.t0=r,f.t0){f.next=11;break}return f.next=10,this.db.fetchSnapshot(void 0,void 0,o);case 10:f.t0=f.sent;case 11:return l=f.t0,u=e.get(l),f.next=15,System.import("lively.ide/text-editor.js");case 15:return c=f.sent,h=c.default,d=h.openURL("<"+s+"/"+a+" - "+e.path.slice(1).join("/")+">",{historyId:"interactivelyEditFileInSnapshotPackage-hist",customSaveAction:function(){var n=H(regeneratorRuntime.mark(function _callee18(n){var r;return regeneratorRuntime.wrap(function _callee18$(i){for(;;)switch(i.prev=i.next){case 0:if(e.get(l)===u){i.next=7;break}return i.next=4,$world.confirm("Content change since loading, save anyway");case 4:if(i.sent){i.next=7;break}return i.abrupt("return",{saved:!1,message:"canceled"});case 7:return e.set(l,n.ui.contentText.textString),i.next=10,p.interactivelySaveModifiedSnapshot(p.commit,l);case 10:return p.commit=i.sent,r={commit:p.commit,snapshot:l,saved:!0},"function"==typeof t&&t(r),i.abrupt("return",r);case 14:case"end":return i.stop()}},_callee18,p)}));return function customSaveAction(e){return n.apply(this,arguments)}}(),customLoadContentAction:function customLoadContentAction(t,n){return{content:e.get(l),url:e.url}}}),n&&d.whenRendered().then(function(){return d.lineNumber=n.row}),f.abrupt("return",d);case 20:case"end":return f.stop()}},_callee19,this)}));return function SnapshotEditor_interactivelyEditFileInSnapshotPackage_(t,n,r){return e.apply(this,arguments)}}()}],void 0,n,void 0,{start:9274,end:14184})}(void 0);var _t,kt,St,Mt=(_t=H(regeneratorRuntime.mark(function _callee5(){var e;return regeneratorRuntime.wrap(function _callee5$(t){for(;;)switch(t.prev=t.next){case 0:return e=lively.modules.module("localconfig.js"),t.prev=1,t.next=4,f.resource(e.id).exists();case 4:if(!t.sent){t.next=7;break}return t.next=7,e.reload({resetEnv:!1,reloadDeps:!1});case 7:t.next=13;break;case 9:t.prev=9,t.t0=t.catch(1),console.error("Error loading localconfig:",t.t0),"undefined"!=typeof $world&&$world.showError("Error loading localconfig.js: "+t.t0);case 13:case"end":return t.stop()}},_callee5,this,[[1,9]])})),function loadLocalConfig(){return _t.apply(this,arguments)}),Ct=(kt=H(regeneratorRuntime.mark(function _callee6(e){var t,n,r,i,o;return regeneratorRuntime.wrap(function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,lively.modules.importPackage("lively.shell");case 2:return a.next=4,lively.modules.module("lively.shell/client-command.js").load();case 4:return t=a.sent,n=t.default,a.next=8,lively.modules.module("lively.shell/client-resource.js").load();case 8:r=a.sent,i=r.resourceExtension,o=e.l2lClient,n.installLively2LivelyServices(o),i.resourceClass.defaultL2lClient=o,f.registerExtension(i),console.log("[lively] lively.shell setup");case 15:case"end":return a.stop()}},_callee6,this)})),function setupLivelyShell(e){return kt.apply(this,arguments)}),Pt=(St=H(regeneratorRuntime.mark(function _callee7(e){var t,n,r,i,o;return regeneratorRuntime.wrap(function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return t=e.getCurrentUser(),n={world:e.name},t&&(n.userToken=t.token,n.userRealm=t.realm),a.next=4,lively.modules.importPackage("lively.2lively");case 4:return a.next=6,lively.modules.module("lively.2lively/client.js").load();case 6:return r=a.sent,i=r.default,a.next=10,i.forLivelyInBrowser(n);case 10:return o=a.sent,console.log("[lively] lively2lively client created "+o),o._onUserChange?reportWorldLoad(e,t):(o._onUserChange=function(e){if(o.isOnline()&&e.user){var t=e.user,n=t.token,r=t.realm;o.info=Object.assign({},o.info,{userToken:n,userRealm:r}),o.unregister().then(function(){return o.register()}).then(function(){return console.log("re-registered after user change")})}},lively.notifications.subscribe("lively.user/userchanged",o._onUserChange,System),o.once("registered",function(){reportWorldLoad(e,t)}),o.on("registered",function(){var t=e.get("user flap");t&&t.updateNetworkIndicator(o)}),o.on("connected",function(){var t=e.get("user flap");t&&t.updateNetworkIndicator(o)}),o.on("reconnecting",function(){var t=e.get("user flap");t&&t.updateNetworkIndicator(o)}),o.on("disconnected",function(){var t=e.get("user flap");t&&t.updateNetworkIndicator(o)})),a.abrupt("return",o);case 14:case"end":return a.stop()}},_callee7,this)})),function setupLively2Lively(e){return St.apply(this,arguments)});function pathForBrowserHistory(e,t){(t=t.trim())&&"?"!==t||(t="");return"/worlds/"+(e=e.replace(/\.json$/,"").replace(/%20/g," "))+t}var Tt,At,Lt=function(){var e=H(regeneratorRuntime.mark(function _callee(e,t,n){var r,i;return regeneratorRuntime.wrap(function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return r=e.isResource?e:lively.resources.resource(System.decanonicalize(e)),i=r.nameWithoutExt(),o.abrupt("return",Et(i,void 0,t,n));case 2:case"end":return o.stop()}},_callee,this)}));return function loadWorldFromURL(t,n,r){return e.apply(this,arguments)}}(),Rt=function(){var e=H(regeneratorRuntime.mark(function _callee2(e,t,n){var r,i,o;return regeneratorRuntime.wrap(function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return r=mt.default,a.next=3,r.load("world",void 0,n,e);case 3:return i=a.sent,o="undefined"!=typeof document?document.location.search:"",n=Object.assign({pathForBrowserHistory:pathForBrowserHistory(i.name,o)},n),a.abrupt("return",zt(i,t,n));case 7:case"end":return a.stop()}},_callee2,this)}));return function loadWorldFromCommit(t,n,r){return e.apply(this,arguments)}}(),Et=function(){var e=H(regeneratorRuntime.mark(function _callee3(e,t,n,r){var i,o,a;return regeneratorRuntime.wrap(function _callee3$(s){for(;;)switch(s.prev=s.next){case 0:return i=mt.default,s.next=3,i.load("world",e,r,void 0,t||void 0);case 3:return o=s.sent,a="undefined"!=typeof document?document.location.search:"",r=Object.assign({pathForBrowserHistory:pathForBrowserHistory(e,a)},r),s.abrupt("return",zt(o,n,r));case 7:case"end":return s.stop()}},_callee3,this)}));return function loadWorldFromDB(t,n,r,i){return e.apply(this,arguments)}}(),zt=(Tt=H(regeneratorRuntime.mark(function _callee4(e,t){var n,r,i,o,a,s,l,u,c,h,d,p,f,y,m,g,v,x,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return regeneratorRuntime.wrap(function _callee4$(w){for(;;)switch(w.prev=w.next){case 0:if(n=b.env,r=b.verbose,i=void 0===r||r,o=b.localconfig,a=void 0===o||o,s=b.l2l,l=void 0===s||s,u=b.shell,c=void 0===u||u,h=b.worldLoadDialog,d=void 0!==h&&h,p=b.initializeGlobalStyleSheets,f=void 0===p||p,y=b.showUserFlap,m=void 0===y?void 0===e.showsUserFlap||e.showsUserFlap:y,n=n||(t?t.env:Ue.default()),g=n.domEnv.document||document,v=g.getElementById("dom-loading-indicator"),w.prev=17,w.t0=l,!w.t0){w.next=23;break}return w.next=22,Pt(e);case 22:w.t0=w.sent;case 23:if(!(x=w.t0)||!c){w.next=27;break}return w.next=27,Ct({l2lClient:x});case 27:return i&&v&&(v.style.display=""),w.next=30,n.setWorld(e);case 30:if(w.t1=a,!w.t1){w.next=34;break}return w.next=34,Mt();case 34:return f&&e.whenRendered().then(function(){return e.propertiesAndPropertySettings().properties.styleSheets.initialize.call(e)}),d&&e.execCommand("load world"),b.pathForBrowserHistory&&window.history.pushState({},"lively.next",b.pathForBrowserHistory),e.showsUserFlap=m,t&&t.onUnload(),w.abrupt("return",e);case 42:if(w.prev=42,w.t2=w.catch(17),console.error("Error loading world: ",w.t2),!t){w.next=49;break}return w.next=48,n.setWorld(t);case 48:t.showError(w.t2);case 49:throw w.t2;case 50:return w.prev=50,v&&(v.style.display="none"),w.finish(50);case 53:case"end":return w.stop()}},_callee4,this,[[17,42,50,53]])})),function loadWorld(e,t,n){return Tt.apply(this,arguments)}),Ot=(At=H(regeneratorRuntime.mark(function _callee8(e,t){var n,i,o,a,s,l,u,c,h,p,f,y,m,g,v,x,b,w,_,k,S,M,C,P,T,A,L,R,E,z,O,I,D;return regeneratorRuntime.wrap(function _callee8$(N){for(;;)switch(N.prev=N.next){case 0:if(t=Object.assign({showSaveDialog:!0,useExpectedCommit:!0,errorOnMissingExpectedCommit:!1,confirmOverwrite:!0},t),n=e.name,i=[],o="",a=r.Path("metadata.commit").get(e),s=t.morphicdb||mt.default,!t.showSaveDialog){N.next=20;break}return N.next=5,wt("save world dialog");case 5:return l=N.sent,N.next=8,e.openPrompt(l,{targetWorld:e});case 8:if(u=N.sent,c=u.commit,(h=u.db)&&(s=h),n=(p=c||{}).name,i=p.tags,o=p.description,n){N.next=18;break}return N.abrupt("return",null);case 18:N.next=21;break;case 20:a&&(n=a.name,i=a.tags,o=a.description);case 21:return f=d.open("saving "+n+"..."),N.next=24,r.promise.delay(80);case 24:if(N.prev=24,y={previewWidth:200,previewHeight:200,previewType:"png"},m="HEAD",g=a?a.name:e.name,v=void 0,!t.useExpectedCommit){N.next=44;break}if(g===n||!t.confirmOverwrite){N.next=43;break}return N.next=30,s.exists("world",n);case 30:if(x=N.sent,b=x.exists,w=x.commitId,!b){N.next=40;break}return N.next=36,e.confirm('A world "'+n+'" already exists, overwrite?');case 36:if(N.sent){N.next=39;break}return N.abrupt("return",null);case 39:v=w;case 40:e.name=n,N.next=44;break;case 43:v=a?a._id:void 0;case 44:return f.remove(),_={author:e.getCurrentUser(),message:"world save",tags:i,description:o},N.next=48,s.snapshotAndCommit("world",n,e,y,_,m,v);case 48:return k=N.sent,f.openInWorld(),window.history&&(S="undefined"!=typeof document?document.location.search:"",M=pathForBrowserHistory(n,S),window.history.pushState({},"lively.next",M)),e.setStatusMessage("saved world "+n),e.get("world-list")&&e.get("world-list").onWorldSaved(n),N.abrupt("return",k);case 56:if(N.prev=56,N.t0=N.catch(24),!N.t0.message.includes("but no version entry exists")||t.errorOnMissingExpectedCommit){N.next=60;break}return N.abrupt("return",Ot(e,Object.assign({},t,{morphicdb:s,useExpectedCommit:!1,showSaveDialog:!1})));case 60:if(C=N.t0.message.match(/Trying to store "([^\"]+)" on top of expected version ([^\s]+) but ref HEAD is of version ([^\s\!]+)/)||[],P=$(C,4),P[0],P[1],T=P[2],A=P[3],!T||!A){N.next=84;break}return N.next=69,s.log(A,1,!0);case 69:if(L=N.sent,R=$(L,1),E=R[0],z=!0,!t.confirmOverwrite){N.next=80;break}return O=E.author.name,I=E.timestamp,D="The current version of world "+n+" is not the most recent!\nA newer version by "+O+" was saved on "+r.date.format(new Date(I),"yyyy-mm-dd HH:MM")+". Overwrite?",N.next=79,e.confirm(D);case 79:z=N.sent;case 80:if(z){N.next=82;break}return N.abrupt("return",null);case 82:return e.changeMetaData("commit",r.obj.dissoc(E,["preview"]),!0,!1),N.abrupt("return",Ot(e,Object.assign({},t,{morphicdb:s,showSaveDialog:!1})));case 84:console.error(N.t0),e.logError("Error saving world: "+N.t0);case 86:return N.prev=86,f.remove(),N.finish(86);case 89:case"end":return N.stop()}},_callee8,this,[[24,56,86,89]])})),function interactivelySaveWorld(e,t){return At.apply(this,arguments)});function reportWorldLoad(e,t){var n=t?t.name+" ("+(t.token||"").slice(0,5)+")":"---";fetch("/report-world-load",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:n+" logged in at "+e.name+" ["+window._livelyLoadId+"]"})}).catch(function(e){return console.warn("report-world-load failed: "+e)})}var It,Dt=[{date:"2017-04-08",name:"Text and Label textAndAttributes format change",description:"\nChanging the format from\n  [[string1, attr1_1, attr1_2], [string2, attr2_1, attr2_2], ...]\nto\n  [string1, attr1, string2, attr2, ...].\n    ",snapshotConverter:function snapshotConverter(e){var t=e.snapshot;for(var n in t){var r=t[n],i=r.props&&r.props.textAndAttributes;if(i){var o=i.value;if(Array.isArray(o)){if(o.length&&"string"!=typeof o[0]){o=[].concat.apply([],o);for(var a=0;a<o.length;a+=2){o[a];var s=o[a+1];s&&Array.isArray(s)&&(o[a+1]=Object.assign.apply(Object,[{}].concat(X(s))))}r.props.textAndAttributes=Object.assign({},i,{value:o})}}else console.warn("object migrator found textAndAttributes field but it is not an Array!")}}return e}},{date:"2017-04-29",name:"Window button fix",description:'\nA recent change in the structure of windows, that now adds a "button wrapper"\nmorph breaks old windows without it.\n',objectConverter:function objectConverter(e,t){e.snapshot;var n=e.id,r=t.refForId(n).realObj;return r&&r.isMorph&&r.withAllSubmorphsDo(function(e){e.isWindow&&(e.submorphs.some(function(e){return"button wrapper"===e.name})&&e.get("button wrapper").submorphs.some(function(e){return"window menu button"===e.name})||e.fixControls(),e.minimizedBounds=null,i.disconnectAll(e.get("minimize")),i.connect(e.get("minimize"),"onMouseDown",e,"minimized",{updater:function updater(e){e(!this.targetObj.minimized)}}))}),e}},{date:"2017-05-03",name:"Style Sheet Status Fix",description:"\nState management of the style sheets has changes substantially, moving all of the style sheets that are being applied to the world.\n",snapshotConverter:function snapshotConverter(e){var t=e.id,n=e.snapshot;for(var r in n){var i=n[r].props;i&&i.styleSheets&&(i.styleSheets.value||(i.styleSheets.value=[]),i.styleSheets.value=i.styleSheets.value&&i.styleSheets.value.filter(function(e){var t=n[e.id],r=t.props.rules,i=n[r.value.id];return!(t.props.styledMorphs||"lively.serializer-class-info"in i)}))}return p.removeUnreachableObjects([t],n),e}},{date:"2017-05-22",name:"Removal of ChromeTheme and GithubTheme",description:"\nFor now only a simple default theme...\n",snapshotConverter:function snapshotConverter(e){var t=e.snapshot;for(var n in t){var r=t[n],i=r["lively.serializer-class-info"];i&&("ChromeTheme"===i.className||"GithubTheme"===i.className?(i.className="DefaultTheme",i.module.pathInPackage="ide/themes/default.js"):"JavaScriptTokenizer"===i.className&&delete r["lively.serializer-class-info"])}return e}},{date:"2017-06-20",name:"Unwrapped Style Sheet Props",description:"Style Sheets now store foldable props in their nested format.",objectConverter:function objectConverter(e,t){var n=e.id,i=(e.snapshot,t.refForId(n).realObj);return i&&i.isMorph&&i.withAllSubmorphsDo(function(e){e.styleSheets&&e.styleSheets.length>0&&e.styleSheets.forEach(function(e){for(var t in r.obj.dissoc(e.rules,["_rev"]))e.rules[t]=e.unwrapFoldedProps(e.rules[t])})}),e}},{date:"2017-07-13",name:"Renamed style-rules.js to style-sheets.js",snapshotConverter:function snapshotConverter(e){var t=e.snapshot;for(var n in t){var r=t[n]["lively.serializer-class-info"];r&&("StyleSheet"===r.className&&(r.module.pathInPackage="style-sheets.js"))}return e}},{date:"2017-07-26",name:"components, ide, and halo extraction",snapshotConverter:function snapshotConverter(e){var t=e.snapshot,n=e.packages,r=n&&n["local://lively-object-modules/"]||{},i=[["lively.morphic/halo","lively.halos"],["lively.morphic/components/markers.js","lively.halos"],["lively.morphic/components/icons.js","lively.morphic"],["lively.morphic/components/loading-indicator.js","lively.components",function(e){return"{"+e+"}"}],["lively.morphic/components","lively.components"],["lively.components/markers.js","lively.halos"],["lively.morphic/ide","lively.ide"],["lively.morphic/text/ui.js","lively.ide",null,"text/ui.js"]];for(var o in r){var a=r[o]["index.js"],s=!0,l=!1,u=void 0;try{for(var c,h=i[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var d=$(c.value,3),p=d[0],f=d[1],y=d[2];if(y){var m=new RegExp('(import\\s)(.*)(\\sfrom \\"'+p+")","g"),g=m.exec(a);g&&(a=a.replace(m,"import "+y(g[2])+'from "'+f))}else{var v=new RegExp(p,"g");a=a.replace(v,f)}}}catch(e){l=!0,u=e}finally{try{!s&&h.return&&h.return()}finally{if(l)throw u}}r[o]["index.js"]=a}for(var x in t){var b=t[x]["lively.serializer-class-info"];if(b&&b.module){var w=b.module.package.name+"/"+b.module.pathInPackage,_=!0,k=!1,S=void 0;try{for(var M,C=i[Symbol.iterator]();!(_=(M=C.next()).done);_=!0){var P=$(M.value,4),T=(p=P[0],f=P[1],P[2],P[3]);if(w.includes(p)){b.module.package.name=f,b.module.package.version="0.1.0",b.module.pathInPackage=T||w.substring(w.indexOf(p)+p.length+1)||"index.js";break}}}catch(e){k=!0,S=e}finally{try{!_&&C.return&&C.return()}finally{if(k)throw S}}}}return e}},{date:"2017-10-16",name:"change scroll implementation of list items",objectConverter:function objectConverter(e,t){var n=!0,r=!1,i=void 0;try{for(var o,a=t.objectRefs()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value.realObj;s.isList&&"function"==typeof s.initializeSubmorphs&&s.initializeSubmorphs()}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return e}},{date:"2017-10-30",name:"change implementation of tree",snapshotConverter:function snapshotConverter(e){var t=e.snapshot;for(var n in t){var r=t[n],i=r["lively.serializer-class-info"];i&&i.module&&("Tree"==i.className&&(r.props.submorphs.value=[]),"TreeNode"==i.className&&delete t[n],"nodeItemContainer"==r.props.name&&delete t[n])}return e}}],Nt=(It=H(regeneratorRuntime.mark(function _callee6(e,t){var n,r,i,o,a,s,l,u;return regeneratorRuntime.wrap(function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:if(e.isDirectory()){c.next=7;break}return c.next=3,e.read();case 3:return t[e.name()]=c.sent,c.abrupt("return",t);case 7:return n=t[e.name()]={},c.next=10,e.dirList();case 10:r=c.sent,i=!0,o=!1,a=void 0,c.prev=14,s=r[Symbol.iterator]();case 16:if(i=(l=s.next()).done){c.next=23;break}return u=l.value,c.next=20,Nt(u,n);case 20:i=!0,c.next=16;break;case 23:c.next=29;break;case 25:c.prev=25,c.t0=c.catch(14),o=!0,a=c.t0;case 29:c.prev=29,c.prev=30,!i&&s.return&&s.return();case 32:if(c.prev=32,!o){c.next=35;break}throw a;case 35:return c.finish(32);case 36:return c.finish(29);case 37:return c.abrupt("return",t);case 38:case"end":return c.stop()}},_callee6,this,[[14,25,29,37],[30,,32,36]])})),function resourceToJSON(e,t){return It.apply(this,arguments)});function normalizeOptions(e){return(e=Object.assign({reinitializeIds:!1},e)).reinitializeIds&&(e.reinitializeIds="function"==typeof e.reinitializeIds?e.reinitializeIds:function(e,t){return t.realObj.isMorph?newMorphId$$1(t.realObj.constructor):null}),e}function serializeMorph(e,t){return p.serialize(e,normalizeOptions(t))}function deserializeMorph(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p.deserializeWithMigrations(e,t.migrations||Dt,normalizeOptions(t))}var Ft=function(){var e=H(regeneratorRuntime.mark(function _callee5(e){var t,n,r,i,o,a,s,l,u,c,h,d,p,y,g,v,x,b,w,_,k=this,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function _callee5$(M){for(;;)switch(M.prev=M.next){case 0:if(t=System.get("@system-env").node,n=S.addPreview,r=void 0===n?!t:n,i=S.previewWidth,o=void 0===i?100:i,a=S.previewHeight,s=void 0===a?100:a,l=S.previewType,u=void 0===l?"png":l,c=S.testLoad,h=void 0===c||c,d=S.addPackages,p=void 0===d||d,y=serializeMorph(e),!p){M.next=16;break}return M.delegateYield(regeneratorRuntime.mark(function _callee4(){var e,t,n,r,i,o,a,s,l,u,c,h;return regeneratorRuntime.wrap(function _callee4$(d){for(;;)switch(d.prev=d.next){case 0:for(o in e=y.packages={},t=y.snapshot,n=[],r={},i=!0,t)if((a=t[o]["lively.serializer-class-info"])&&a.module&&a.module.package&&(s=m.getPackage(a.module.package.name)).address.startsWith("local://")&&n.push(s),(l=t[o].props.metadata)&&(u=void 0,l.value&&l.value.__ref__?(c=t[l.value.id]).props.externalPackages&&(u=c.props.externalPackages.value):u=l.externalPackages,u))for(i=!0,h=0;h<u.length;h++)r[u[h]]=!0;return i&&(y.packagesToRegister=Object.keys(r)),d.next=5,Promise.all(n.map(function(){var t=H(regeneratorRuntime.mark(function _callee3(t){var n,r;return regeneratorRuntime.wrap(function _callee3$(i){for(;;)switch(i.prev=i.next){case 0:return n=f.resource(t.address).asDirectory(),i.next=3,Nt(n,{});case 3:r=i.sent,e[n.parent().url]||(e[n.parent().url]={}),Object.assign(e[n.parent().url],r);case 6:case"end":return i.stop()}},_callee3,k)}));return function(e){return t.apply(this,arguments)}}()));case 5:case"end":return d.stop()}},_callee4,k)})(),"t0",16);case 16:if(!r){M.next=36;break}return M.next=19,System.import("lively.morphic/rendering/morph-to-image.js");case 19:return g=M.sent,v=g.renderMorphToDataURI,x=o||e.width,b=s||e.height,w=u||"png",M.prev=24,M.next=27,v(e,{width:x,height:b,type:w});case 27:y.preview=M.sent,M.next=36;break;case 30:return M.prev=30,M.t1=M.catch(24),console.error("Error generating morph preview: "+M.t1),M.next=35,v(new $t({fill:e.fill,width:x,height:b}),{width:x,height:b,type:w});case 35:y.preview=M.sent;case 36:if(y.preview||(y.preview=""),!h){M.next=49;break}return M.prev=38,M.next=41,loadMorphFromSnapshot$$1(y);case 41:if((_=M.sent)&&_.isMorph){M.next=44;break}throw new Error("reloading snapshot does not create a morph!");case 44:M.next=49;break;case 46:throw M.prev=46,M.t2=M.catch(38),new Error("Error snapshotting morph: Cannot recreate morph from snapshot!\n"+M.t2.stack);case 49:return M.abrupt("return",y);case 50:case"end":return M.stop()}},_callee5,this,[[24,30],[38,46]])}));return function createMorphSnapshot(t,n){return e.apply(this,arguments)}}();function loadMorphFromSnapshot$$1(e,t){return deserializeMorph(e,Object.assign({reinitializeIds:!0,ignoreClassNotFound:!1,onDeserializationStart:Bt,migrations:Dt},t))}function packagesOfSnapshot(e){return function findPackagesInFileSpec(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=[];if(e.hasOwnProperty("package.json")){var r=t.slice(1).reduceRight(function(e,t){return e.join(t)},f.resource(t[0])).url;n.push({files:e,url:r})}for(var i in e)"object"===B(e[i])&&n.push.apply(n,X(findPackagesInFileSpec(e[i],t.concat(i))));return n}(e.packages)}var Bt=function(){var e=H(regeneratorRuntime.mark(function _callee7(e){var t,n,r,i,o,a,s,l,u,c,h,d,y,g,v,x,b,w,_,k,S,M;return regeneratorRuntime.wrap(function _callee7$(C){for(;;)switch(C.prev=C.next){case 0:if(!e.packagesToRegister){C.next=33;break}t=!0,n=!1,r=void 0,C.prev=4,i=e.packagesToRegister[Symbol.iterator]();case 6:if(t=(o=i.next()).done){C.next=19;break}return a=o.value,C.prev=8,C.next=11,m.registerPackage(a);case 11:C.next=16;break;case 13:C.prev=13,C.t0=C.catch(8),console.error("Failed to register package "+a);case 16:t=!0,C.next=6;break;case 19:C.next=25;break;case 21:C.prev=21,C.t1=C.catch(4),n=!0,r=C.t1;case 25:C.prev=25,C.prev=26,!t&&i.return&&i.return();case 28:if(C.prev=28,!n){C.next=31;break}throw r;case 31:return C.finish(28);case 32:return C.finish(25);case 33:if(!e.packages){C.next=89;break}s=packagesOfSnapshot(e),l=!0,u=!1,c=void 0,C.prev=38,h=s[Symbol.iterator]();case 40:if(l=(d=h.next()).done){C.next=75;break}if(y=d.value,g=y.files,v=y.url,x=m.lookupPackage(v),!(b=x&&x.pkg)){C.next=58;break}if(w=b.version,_=JSON.parse(g["package.json"]),k=_.version,C.prev=49,!(k&&w&&m.semver.lte(k,w,!0))){C.next=53;break}return console.log("[load morph] Package "+v+" is loaded in version "+w+" which is newer than "+k+". Will NOT load older variant."),C.abrupt("continue",72);case 53:C.next=58;break;case 55:C.prev=55,C.t2=C.catch(49),console.warn("Error in package version comparison: ",C.t2);case 58:return C.next=60,f.createFiles(v,g);case 60:return C.sent,C.next=63,m.ensurePackage(v);case 63:return b=C.sent,C.next=66,b.reload({forgetEnv:!1,forgetDeps:!1});case 66:return C.next=68,System.import("lively.classes/object-classes.js");case 68:S=C.sent,M=S.default,!!M&&M.withId(b.name);case 72:l=!0,C.next=40;break;case 75:C.next=81;break;case 77:C.prev=77,C.t3=C.catch(38),u=!0,c=C.t3;case 81:C.prev=81,C.prev=82,!l&&h.return&&h.return();case 84:if(C.prev=84,!u){C.next=87;break}throw c;case 87:return C.finish(84);case 88:return C.finish(81);case 89:return C.next=91,Promise.all(p.requiredModulesOfSnapshot(e).map(function(e){return(System.get(e)?null:System.import(e)).catch(function(t){return console.error("Error loading "+e,t)})}));case 91:case"end":return C.stop()}},_callee7,this,[[4,21,25,33],[8,13],[26,,28,32],[38,77,81,89],[49,55],[82,,84,88]])}));return function loadPackagesAndModulesOfSnapshot(t){return e.apply(this,arguments)}}(),jt=function(e){var t=_classRecorder,n=t.hasOwnProperty("SizzleExpression")&&"function"==typeof t.SizzleExpression?t.SizzleExpression:t.SizzleExpression=function SizzleExpression(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function SizzleExpression_initialize_(e,t){this.matchStacks={},this.context=t,this.compileRule(e)}},{key:"compileRule",value:function SizzleExpression_compileRule_(e){this.compiledRule=[];var t=!0,n=!1,i=void 0;try{for(var o,a=e.split(" ")[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var s=o.value;this.compiledRule.push(this.createMatcher(s))}}catch(e){n=!0,i=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw i}}r.arr.any(this.compiledRule,function(e){return!e})&&(this.compileError=!0)}},{key:"createMatcher",value:function SizzleExpression_createMatcher_(e){return r.arr.findAndGet([Vt,Ht,Ut],function(t){return t.create(e)})}},{key:"reset",value:function SizzleExpression_reset_(){this.active=!1,this.matchStacks={}}},{key:"startMatching",value:function SizzleExpression_startMatching_(){this.active=!0}},{key:"matches",value:function SizzleExpression_matches_(e){if(this.context==e&&this.startMatching(),!this.active)return!1;var t=e.owner&&this.matchStacks[e.owner.id]||0;return this.compiledRule[t].matches(e)?t<this.compiledRule.length-1?void(this.matchStacks[e.id]=t+1):(this.matchStacks[e.id]=t,!0):(this.matchStacks[e.id]=t,!1)}}],[{key:"compile",value:function SizzleExpression_compile_(e,t){return new this(e,t)}}],t,void 0,{start:56,end:1394})}(void 0),Wt=function(e){var t=_classRecorder,n=t.hasOwnProperty("Matcher")&&"function"==typeof t.Matcher?t.Matcher:t.Matcher=function Matcher(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function Matcher_initialize_(e,t){this.token=t,this.description=e}},{key:"matches",value:function Matcher_matches_(e){return!1}}],[{key:"characterEncoding",get:function get(){return"(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+"}},{key:"create",value:function Matcher_create_(e){var t;if(t=this.appliesTo(e))return new this(e,t)}},{key:"appliesTo",value:function Matcher_appliesTo_(e){return!1}}],t,void 0,{start:1396,end:1818})}(void 0),Ht=function(e){var t=_classRecorder,n=t.hasOwnProperty("NameMatcher")&&"function"==typeof t.NameMatcher?t.NameMatcher:t.NameMatcher=function NameMatcher(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:"matches",value:function NameMatcher_matches_(e){return e.name==this.token}}],[{key:"appliesTo",value:function NameMatcher_appliesTo_(e){var t;return this.re||(this.re=new RegExp("^\\[name=['\"]?("+this.characterEncoding+")['\"]?\\]")),(t=this.re.exec(e))&&t[1]}}],t,void 0,{start:1820,end:2128})}(Wt),Vt=function(e){var t=_classRecorder,n=t.hasOwnProperty("ClassMatcher")&&"function"==typeof t.ClassMatcher?t.ClassMatcher:t.ClassMatcher=function ClassMatcher(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:"matches",value:function ClassMatcher_matches_(e){return r.arr.every(this.token,function(t){return e.styleClasses.includes(t)})}}],[{key:"appliesTo",value:function ClassMatcher_appliesTo_(e){var t=!0,n=[];for(this.re||(this.re=new RegExp("^\\.("+this.characterEncoding+")"));t;)(t=this.re.exec(e))&&(n.push(t[1]),e=e.replace(t[0],""));return!!(r.string.empty(e)&&n.length>0)&&n}}],t,void 0,{start:2130,end:2659})}(Wt),Ut=function(e){var t=_classRecorder,n=t.hasOwnProperty("IdMatcher")&&"function"==typeof t.IdMatcher?t.IdMatcher:t.IdMatcher=function IdMatcher(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:"matches",value:function IdMatcher_matches_(e){return e.id==this.token}}],[{key:"appliesTo",value:function IdMatcher_appliesTo_(e){this.re||(this.re=new RegExp("^#("+this.characterEncoding+")"));var t=this.re.exec(e);return t&&t[1]}}],t,void 0,{start:2661,end:2927})}(Wt),qt=(function(e){var t=_classRecorder,n=t.hasOwnProperty("Sizzle")&&"function"==typeof t.Sizzle?t.Sizzle:t.Sizzle=function Sizzle(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function Sizzle_initialize_(e){this.context=e,this.cachedExpressions={}}},{key:"fetchExpressionFor",value:function Sizzle_fetchExpressionFor_(e){var t=this.cachedExpressions[e];return t||(this.cachedExpressions[e]=t=jt.compile(e,this.context)),t}},{key:"matches",value:function Sizzle_matches_(e,t){return this.fetchExpressionFor(e).matches(t)}},{key:"select",value:function Sizzle_select_(e){var t=this.fetchExpressionFor(e);return this.context.withAllSubmorphsSelect(function(e){return t.matches(e)})}}],void 0,t,void 0,{start:2936,end:3482})}(void 0),function(e){var t=_classRecorder,n=t.hasOwnProperty("StylingVisitor")&&"function"==typeof t.StylingVisitor?t.StylingVisitor:t.StylingVisitor=function StylingVisitor(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function StylingVisitor_initialize_(e){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(n.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e),this.retainedProps={}}},{key:"retrieveExpressions",value:function StylingVisitor_retrieveExpressions_(e){return!(e.styleSheets.length<1)&&e.styleSheets.map(function(e){return e.applicableRules()})}},{key:"visitMorph",value:function StylingVisitor_visitMorph_(e,t){if(e._wantsStyling){var n,i=this.retainedProps[e.id]||{},o=r.obj.keys(i),a={},s=!0,l=!1,u=void 0;try{for(var c,h=t[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var d=$(c.value,2),p=d[0],f=d[1];if(Object.assign(a,n=p.applyRule(f,e)),r.arr.remove(o,f),i[f])for(var y in i[f])y in a||(e[y]=i[f][y]);i[f]=n}}catch(e){l=!0,u=e}finally{try{!s&&h.return&&h.return()}finally{if(l)throw u}}var m=!0,g=!1,v=void 0;try{for(var x,b=o[Symbol.iterator]();!(m=(x=b.next()).done);m=!0){f=x.value;Object.assign(e,r.obj.dissoc(i[f],r.obj.keys(a))),delete i[f]}}catch(e){g=!0,v=e}finally{try{!m&&b.return&&b.return()}finally{if(g)throw v}}this.retainedProps[e.id]=i,e._wantsStyling=!1}}},{key:"getChildren",value:function StylingVisitor_getChildren_(e){return e.submorphs.filter(function(e){return e.needsRerender()})}}],void 0,t,void 0,{start:7149,end:8706})}(function(e){var t=_classRecorder,n=t.hasOwnProperty("SizzleVisitor")&&"function"==typeof t.SizzleVisitor?t.SizzleVisitor:t.SizzleVisitor=function SizzleVisitor(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function SizzleVisitor_initialize_(e){this.rootMorph=e,this.expressionCache={}}},{key:"deleteFromCache",value:function SizzleVisitor_deleteFromCache_(e){var t=this;e.withAllSubmorphsDo(function(e){delete t.expressionCache[e.id]})}},{key:"retrieveExpressions",value:function SizzleVisitor_retrieveExpressions_(e){throw Error("Not yet implemented!")}},{key:"visitMorph",value:function SizzleVisitor_visitMorph_(e,t){throw Error("Not yet implemented!")}},{key:"getChildren",value:function SizzleVisitor_getChildren_(e){throw Error("Not yet implemented!")}},{key:"visit",value:function SizzleVisitor_visit_(e){var t=this;if(!e)for(var n in this.ownerChain=[e=this.rootMorph],this.morphExpressions=[],this.expressionCache)for(var i in this.expressionCache[n])this.expressionCache[n][i].reset();var o=this.retrieveExpressions(e),a=[];o&&this.morphExpressions.push([e,o]);var s=!0,l=!1,u=void 0;try{for(var c,h=function _loop(){var n=$(c.value,2),i=n[0],o=n[1],s=t.expressionCache[i.id]||{};r.obj.isArray(o)?o.forEach(function(n){return t.matchExpressions(i,e,n,s,a)}):t.matchExpressions(i,e,o,s,a),t.expressionCache[i.id]=s},d=this.morphExpressions[Symbol.iterator]();!(s=(c=d.next()).done);s=!0)h()}catch(e){l=!0,u=e}finally{try{!s&&d.return&&d.return()}finally{if(l)throw u}}this.visitMorph(e,a),this.getChildren(e).forEach(function(e){t.ownerChain.push(e),t.visit(e),t.ownerChain.pop()}),o&&this.morphExpressions.pop()}},{key:"matchExpressions",value:function SizzleVisitor_matchExpressions_(e,t,n,r,i){for(var o in n){var a=r[o]||jt.compile(o,e);a.compileError||a.matches(t)&&i.push(n[o]),r[o]=a}}}],void 0,t,void 0,{start:3757,end:7140})}(void 0))),Gt=new qe;function newMorphId$$1(e){return("function"==typeof e?e.name:"string"==typeof e?e.toLowerCase():"")+"_"+r.string.newUUID().replace(/-/g,"_")}function generateUnfolded(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["top","left","right","bottom"],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"core",i={},o=!0,a=!1,s=void 0;try{for(var l,u=function _loop(){var t=l.value;i[e+r.string.capitalize(t)]={group:n,derived:!0,generated:!0,after:[e],get:function get(){return this.getProperty(e)[t]},set:function set(n){this[e]=Object.assign({},this.getProperty(e),U({},t,n))}}},c=t[Symbol.iterator]();!(o=(l=c.next()).done);o=!0)u()}catch(e){a=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(a)throw s}}return i}var $t=function(e){var n=_classRecorder,o=n.hasOwnProperty("Morph")&&"function"==typeof n.Morph?n.Morph:n.Morph=function Morph(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(o,e,[{key:Symbol.for("lively-instance-initialize"),value:function Morph_initialize_(e){e||(e={});var t=e.env||Ue.default();this._env=t,this._rev=t.changeManager.revision,this._owner=null,this._dirty=!0,this._rendering=!1,this._submorphOrderChanged=!1,this._id=newMorphId$$1(this.constructor.name),this._animationQueue=new Z(this),this._cachedPaths={},this._pathDependants=[],this._tickingScripts=[],this.initializeProperties(e),e.bounds&&this.setBounds(e.bounds);var n=Object.getOwnPropertyDescriptors(e),r={},i={env:!0,type:!0,submorphs:!0,bounds:!0,layout:!0},o=this.propertiesAndPropertySettings().properties;for(var a in n)a in i||a in o||(r[a]=n[a]);Object.defineProperties(this,r),e.layout&&(this.layout=e.layout),"function"==typeof this.onLoad&&this.onLoad()}},{key:"__serialization_id_property__",get:function get(){return"_id"}},{key:"__deserialize__",value:function Morph___deserialize___(e,t){this._env=Ue.default(),this._rev=e.rev,this._owner=null,this._dirty=!0,this._rendering=!1,this._submorphOrderChanged=!1,this._id=t.id,this._animationQueue=new Z(this),this._cachedPaths={},this._pathDependants=[],this._tickingScripts=[],this.initializeProperties()}},{key:"__after_deserialize__",value:function Morph___after_deserialize___(){if(this.resumeStepping(),"function"==typeof this.onLoad)try{this.onLoad()}catch(e){console.error("[lively.morphic] "+this+".onLoad() error: "+e.stack)}}},{key:"__only_serialize__",get:function get(){var e=this.defaultProperties,t=this.propertiesAndPropertySettings().properties,n=["_tickingScripts","attributeConnections"];for(var r in t){var i=t[r];i.readOnly||i.derived||this[r]===e[r]||i.hasOwnProperty("serialize")&&!i.serialize||n.push(r)}return n}},{key:"__additionally_serialize__",value:function Morph___additionally_serialize___(e,t,n,i){if(!this.isEpiMorph)for(var o=e.props.submorphs.value,a=o.length;a--;){var s=o[a].id;n.refForId(s).realObj.isEpiMorph&&r.arr.removeAt(o,a)}for(var l=["borderColor","borderWidth","borderStyle","borderRadius"],u=0;u<l.length;u++){var c=l[u];e.props[c]={key:c,verbatim:!0,value:r.obj.extract(this[c],["top","right","bottom","left"],function(e,t){return t&&t.isColor?t.toTuple():t})}}}},{key:"isMorph",get:function get(){return!0}},{key:"id",get:function get(){return this._id}},{key:"env",get:function get(){return this._env}},{key:"spec",value:function Morph_spec_(){var e=this.defaultProperties,t=this.propertiesAndPropertySettings().properties,n={submorphs:!0},r={};for(var i in t){var o=t[i];o.readOnly||o.derived||this[i]===e[i]||this[i]&&"function"==typeof this[i].equals&&this[i].equals(e[i])||o.hasOwnProperty("serialize")&&!o.serialize||i in n||(r[i]=this[i])}return this.submorphs.length&&(r.submorphs=this.submorphs.map(function(e){return e.spec()})),r.type=this.constructor.name.toLowerCase(),r}},{key:"printSpec",value:function Morph_printSpec_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e=e||this.spec();var n={name:!0,type:!0,submorphs:!0},i="  ".repeat(t+1),o="  ".repeat(t)+"{\n"+i+'name: "'+e.name+'",\n'+i+'type: "'+e.type+'",\n';for(var a in e)n[a]||(o=o+""+i+a+": "+r.string.print(e[a])+",\n");if(e.submorphs){o+=i+"submorphs: [\n";var s=!0,l=!1,u=void 0;try{for(var c,h=e.submorphs[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var d=c.value;o+=this.printSpec(d,t+1)}}catch(e){l=!0,u=e}finally{try{!s&&h.return&&h.return()}finally{if(l)throw u}}o+="]\n"}return o+="  ".repeat(t)+"}\n"}},{key:"defaultProperties",get:function get(){var e=this.constructor,t=e[Symbol.for("lively-instance-superclass")];if(!e._morphicDefaultPropertyValues||e._morphicDefaultPropertyValues==(t&&t._morphicDefaultPropertyValues)){var n=this.constructor._morphicDefaultPropertyValues={},r=this.propertiesAndPropertySettings().properties;for(var i in r){var o=r[i];if(o.hasOwnProperty("defaultValue")){var a=o.defaultValue;Array.isArray(a)&&(a=a.slice()),n[i]=a}}}return this.constructor._morphicDefaultPropertyValues}},{key:"defaultProperty",value:function Morph_defaultProperty_(e){return this.defaultProperties[e]}},{key:"getProperty",value:function Morph_getProperty_(e){return this._morphicState[e]}},{key:"setProperty",value:function Morph_setProperty_(e,t,n){return this.addValueChange(e,t,n)}},{key:"changeMetaData",value:function Morph_changeMetaData_(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=this.metadata;o||(o={}),r.Path(e).withParentAndKeyDo(o,!0,function(e,o){e[o]=i?Object.assign({},e[o],{},t):t;var a=e.__dont_serialize__;n?a&&a.includes(o)&&(r.arr.remove(a,o),0===a.length&&delete e.__dont_serialize__):(a||(a=e.__dont_serialize__=[]),r.arr.pushIfNotIncluded(a,o))}),this.metadata=o}},{key:"toString",value:function Morph_toString_(){return"<"+this.constructor.name+" - "+(this.name?this.name:this.id)+">"}},{key:"edit",value:function Morph_edit_(e){return this.env.world.execCommand("open object editor",Object.assign({className:this.constructor.name},e,{target:this}))}},{key:"inspect",value:function Morph_inspect_(e){return this.env.world.execCommand("open object inspector",Object.assign({},e,{target:this}))}},{key:"livelyCustomInspect",value:function Morph_livelyCustomInspect_(){var e={_id:!0,_owner:!0},t={},n=this.propertiesAndPropertySettings().properties,r=[];for(var i in n)e[i]||n[i].derived&&!n[i].showInInspector||(t[i]=!0,r.push({key:i,value:this[i]}));r.push({key:"id",value:this.id}),r.push({key:"owner",value:this.owner}),r=r.sort(function(e,t){var n=e.key.toLowerCase(),r=t.key.toLowerCase();return n<r?-1:n===r?0:1});if(this.attributeConnections){var o=!0,a=!1,s=void 0;try{for(var l,u=this.attributeConnections[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var c=l.value;e[(c.sourceAttrName,""+c.sourceAttrName)]=!0}}catch(e){a=!0,s=e}finally{try{!o&&u.return&&u.return()}finally{if(a)throw s}}}Object.assign(t,e);var h=!0,d=!1,p=void 0;try{for(var f,y=["attributeConnections","_animationQueue","_morphicState","_dirty","doNotCopyProperties","doNotSerialize","_env","_cachedPaths","_pathDependants","_rendering","_rev","_submorphOrderChanged","_tickingScripts","_transform","_invTransform","_styleSheetProps","_renderer","_tooltipViewer","layout"][Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var m=f.value;m in this&&(t[m]=!0,r.push({key:m,value:this[m],keyString:"[internal] "+m}))}}catch(e){d=!0,p=e}finally{try{!h&&y.return&&y.return()}finally{if(d)throw p}}for(var g in this)!t[g]&&this.hasOwnProperty(g)&&r.unshift({key:g,value:this[g],keyString:"[UNKNOWN PROPERTY] "+g});return{sort:!1,includeDefault:!1,properties:r}}},{key:"show",value:function Morph_show_(){return v.show(this)}},{key:"setStatusMessage",value:function Morph_setStatusMessage_(e,t,n,r){var i=this.world();return r=Object.assign({maxLines:7},r),i?i.setStatusMessageFor(this,e,t,n,r):console.log(e)}},{key:"showError",value:function Morph_showError_(e){var t=this.world();return t?t.showErrorFor(this,e):console.error(e)}},{key:"onChange",value:function Morph_onChange_(e){var t=e.meta&&e.meta.animation,n=e.prop,r=e.value;"position"===n||"rotation"===n||"scale"===n||"origin"===n||"reactsToPointer"===n?(this.onBoundsChanged(this.bounds()),this.updateTransform(U({},n,r))):"extent"==n?this.onBoundsChanged(this.bounds()):"layout"==n&&(t?r&&r.attachAnimated(t.duration,this,t.easing):r&&r.attach()),this.layout&&this.layout.onChange(e)}},{key:"onBoundsChanged",value:function Morph_onBoundsChanged_(e){var t=this;i.signal(this,"bounds",e),[].concat(X(e.corners),X(e.sides)).forEach(function(n){i.signal(t,n,e.partNamed(n))})}},{key:"onSubmorphChange",value:function Morph_onSubmorphChange_(e,t){this.layout&&this.layout.onSubmorphChange(t,e)}},{key:"changes",get:function get(){return this.env.changeManager.changesFor(this)}},{key:"applyChange",value:function Morph_applyChange_(e){this.env.changeManager.apply(this,e)}},{key:"addValueChange",value:function Morph_addValueChange_(e,t,n){return this.env.changeManager.addValueChange(this,e,t,n)}},{key:"addMethodCallChangeDoing",value:function Morph_addMethodCallChangeDoing_(e,t){return this.env.changeManager.addMethodCallChangeDoing(e,this,t)}},{key:"groupChangesWhile",value:function Morph_groupChangesWhile_(e,t){return this.env.changeManager.groupChangesWhile(this,e,t)}},{key:"dontRecordChangesWhile",value:function Morph_dontRecordChangesWhile_(e){return this.env.changeManager.dontRecordChangesWhile(this,e)}},{key:"recordChangesWhile",value:function Morph_recordChangesWhile_(e,t){return this.env.changeManager.recordChangesWhile(e,t)}},{key:"recordChangesStart",value:function Morph_recordChangesStart_(e){return this.env.changeManager.recordChangesStartForMorph(this,e)}},{key:"recordChangesStop",value:function Morph_recordChangesStop_(e){return this.env.changeManager.recordChangesStopForMorph(this,e)}},{key:"withMetaDo",value:function Morph_withMetaDo_(e,t){return this.env.changeManager.doWithValueChangeMeta(e,this,t)}},{key:"undoStart",value:function Morph_undoStart_(e){return this.env.undoManager.undoStart(this,e)}},{key:"undoStop",value:function Morph_undoStop_(e){return this.env.undoManager.undoStop(this,e)}},{key:"undoInProgress",get:function get(){return this.env.undoManager.undoInProgress}},{key:"animate",value:function(){var e=H(regeneratorRuntime.mark(function _callee(e){var t;return regeneratorRuntime.wrap(function _callee$(n){for(;;)switch(n.prev=n.next){case 0:if(t=this._animationQueue.registerAnimation(e),this._animationQueue.animationsActive){n.next=4;break}return t&&t.finish(),n.abrupt("return",Promise.resolve(this));case 4:return n.abrupt("return",t?t.asPromise():Promise.resolve(this));case 5:case"end":return n.stop()}},_callee,this)}));return function Morph_animate_(t){return e.apply(this,arguments)}}()},{key:"isClip",value:function Morph_isClip_(){return"visible"!==this.clipMode}},{key:"scrollExtent",get:function get(){return(this.submorphs.length?this.innerBounds().union(this.submorphBounds()):this.innerBounds()).extent().addPt(this.scrollbarOffset)}},{key:"scrollBounds",value:function Morph_scrollBounds_(){var e=this.scroll,n=e.x,r=e.y,i=this.scrollExtent,o=i.x,a=i.y;return new t.Rectangle(n,r,o,a)}},{key:"scrollDown",value:function Morph_scrollDown_(e){this.scroll=this.scroll.addXY(0,e)}},{key:"scrollUp",value:function Morph_scrollUp_(e){this.scrollDown(50*-e)}},{key:"scrollLeft",value:function Morph_scrollLeft_(e){this.scroll=this.scroll.addXY(e,0)}},{key:"scrollRight",value:function Morph_scrollRight_(e){this.scrollLeft(-e)}},{key:"scrollPageDown",value:function Morph_scrollPageDown_(e){this.scrollDown(this.height)}},{key:"scrollPageUp",value:function Morph_scrollPageUp_(e){this.scrollUp(2*this.height)}},{key:"addStyleClass",value:function Morph_addStyleClass_(e){this.styleClasses=r.arr.uniq(this.styleClasses.concat(e))}},{key:"removeStyleClass",value:function Morph_removeStyleClass_(e){this.styleClasses=this.styleClasses.filter(function(t){return t!=e})}},{key:"adjustOrigin",value:function Morph_adjustOrigin_(e){var t=this.origin,n=this.globalBounds().topLeft();this.origin=e,this.submorphs.forEach(function(n){return n.position=n.position.subPt(e.subPt(t))});var r=this.globalBounds().topLeft(),i=n.subPt(r);this.globalPosition=this.globalPosition.addPt(i)}},{key:"setBounds",value:function Morph_setBounds_(e){this.extent=e.extent(),this.position=e.topLeft().addPt(this.origin)}},{key:"innerBounds",value:function Morph_innerBounds_(){var e=this.extent,n=e.x,r=e.y;return t.rect(0,0,n,r)}},{key:"relativeBounds",value:function Morph_relativeBounds_(e){e=e||this.world();var t=this.origin.negated().extent(this.extent);return t=e?this.transformRectToMorph(e,t):this.getGlobalTransform().transformRectToRect(t),this.isClip()||this.submorphs.forEach(function(n){t=t.union(n.relativeBounds(e))}),t}},{key:"bounds",value:function Morph_bounds_(){return this.relativeBounds(this.owner)}},{key:"relativeSubmorphBounds",value:function Morph_relativeSubmorphBounds_(){var e=this.innerBounds();return this.submorphs.map(function(n){var r=n.bounds(),i=r.width,o=r.height,a=r.x,s=r.y;return t.rect(a/e.width,s/e.height,i/e.width,o/e.height)})}},{key:"globalBounds",value:function Morph_globalBounds_(){return this.relativeBounds(this.world())}},{key:"submorphBounds",value:function Morph_submorphBounds_(){return this.submorphs.length<1?this.innerBounds():this.submorphs.map(function(e){return e.bounds()}).reduce(function(e,t){return e.union(t)})}},{key:"fitToSubmorphs",value:function Morph_fitToSubmorphs_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.Rectangle.inset(0),n=this.submorphs;if(n.length){var i=n.reduce(function(e,t){return e.union(t.bounds())},n[0].bounds()),o=i.top()-e.top(),a=i.left()-e.left();this.moveBy(t.pt(a,o)),r.arr.invoke(this.submorphs,"moveBy",t.pt(-a,-o)),this.extent=t.pt(i.width+e.left()+e.right(),i.height+e.top()+e.bottom())}}},{key:"align",value:function Morph_align_(e,t){return this.moveBy(t.subPt(e))}},{key:"moveBy",value:function Morph_moveBy_(e){return this.position=this.position.addPt(e),this}},{key:"rotateBy",value:function Morph_rotateBy_(e){this.rotation+=e}},{key:"resizeBy",value:function Morph_resizeBy_(e){this.extent=this.extent.addPt(e)}},{key:"snap",value:function Morph_snap_(e){this.position=this.position.roundTo(e||1)}},{key:"isEpiMorph",get:function get(){return this.getProperty("epiMorph")}},{key:"isUsedAsEpiMorph",value:function Morph_isUsedAsEpiMorph_(){for(var e=this;e;){if(e.isEpiMorph)return!0;e=e.owner}return!1}},{key:"replaceWith",value:function Morph_replaceWith_(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this===e||!e)return e;if(this===e.owner)return e.replaceWith(this),e;var i=this.owner,o=this.submorphs,a=this.getTransform().copy(),s="number"==typeof t?t:i?i.submorphs.indexOf(this):-1,l=e.owner,u=r.arr.without(e.submorphs,this),c=e.getTransform().copy(),h=l?l.submorphs.indexOf(e):-1;return i&&this.remove(),l&&e.remove(),n&&(this.submorphs=[],e.submorphs=[]),i===e?(l&&l.addMorphAt(this,h),n&&(this.submorphs=u.slice(0,s).concat(e).concat(u.slice(s)),e.submorphs=o)):(i&&i.addMorphAt(e,s),l&&l.addMorphAt(this,h),n&&(e.submorphs=o,this.submorphs=u)),e.setTransform(a),this.setTransform(c),e}},{key:"addMorphAt",value:function Morph_addMorphAt_(e,t){var n=this;if(!e||"object"!==(void 0===e?"undefined":B(e)))throw new Error(e+" cannot be added as a submorph to "+this);if(e.isMorph){if(e.isAncestorOf(this))return this.env.world.logError(new Error("addMorph: Circular relationships between morphs not allowed\ntried to add "+e+" to "+this)),null;if(e===this)return this.env.world.logError(new Error("addMorph: Trying to add itself as a submorph: "+this)),null}e.isMorph||(e=morph$2(e));var r=this.submorphs.indexOf(e);if(!(r>-1&&r===t))return this.addMethodCallChangeDoing({target:this,selector:"addMorphAt",args:[e,t],undo:{target:this,selector:"removeMorph",args:[e]}},function(){var i,o=e.owner,a=n.submorphs;o&&o!==n&&(i=e.transformForNewOwner(n),e.remove()),e._env!==n._env&&(e._env=n._env),t=Math.min(a.length,Math.max(0,t)),r>-1&&(a.splice(r,1),r<t&&t--),a.splice(t,0,e),e._owner=n,e._cachedPaths={},i&&e.setTransform(i),n._morphicState.submorphs=a,e.requestStyling(),n._submorphOrderChanged=!0,n.makeDirty(),e.resumeSteppingAll(),e.withAllSubmorphsDo(function(e){return e.onOwnerChanged(n)})}),e}},{key:"addMorph",value:function Morph_addMorph_(e,t){var n=this.submorphs,r=t?n.indexOf(t):-1,i=-1===r?n.length:r;return this.addMorphAt(e,i)}},{key:"addMorphBack",value:function Morph_addMorphBack_(e){var t=e===this.submorphs[0]?this.submorphs[1]:this.submorphs[0];return this.addMorph(e,t)}},{key:"removeMorph",value:function Morph_removeMorph_(e){var t=this.submorphs.indexOf(e);-1!==t&&((this.getProperty("submorphs")||[]).splice(t,1),this.addMethodCallChangeDoing({target:this,selector:"removeMorph",args:[e],undo:{target:this,selector:"addMorphAt",args:[e,t]}},function(){e.suspendSteppingAll(),e._owner=null}),this._pathDependants=r.arr.withoutAll(this._pathDependants,e._pathDependants))}},{key:"remove",value:function Morph_remove_(){var e=this;return this.ownerChain().forEach(function(t){t._stylingVisitor&&t._stylingVisitor.deleteFromCache(e)}),this.owner&&this.owner.removeMorph(this),this._cachedPaths={},this._pathDependants.forEach(function(e){return e._cachedPaths={}}),this._pathDependants=[],this.withAllSubmorphsDo(function(e){return e.onOwnerChanged(null)}),this}},{key:"onOwnerChanged",value:function Morph_onOwnerChanged_(e){}},{key:"fadeOut",value:function(){var e=H(regeneratorRuntime.mark(function _callee2(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return regeneratorRuntime.wrap(function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.animate({opacity:0,duration:e,easing:J.outQuad});case 2:this.remove(),this.opacity=1;case 4:case"end":return t.stop()}},_callee2,this)}));return function Morph_fadeOut_(t){return e.apply(this,arguments)}}()},{key:"fadeIn",value:function(){var e=H(regeneratorRuntime.mark(function _callee3(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return regeneratorRuntime.wrap(function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:return this.opacity=0,this.animate({opacity:1,duration:e}),t.abrupt("return",this);case 3:case"end":return t.stop()}},_callee3,this)}));return function Morph_fadeIn_(t){return e.apply(this,arguments)}}()},{key:"fadeIntoWorld",value:function(){var e=H(regeneratorRuntime.mark(function _callee4(){var e,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$world.visibleBounds().center(),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return regeneratorRuntime.wrap(function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return e=new $t({opacity:0,scale:0,fill:t.Color.transparent}),n=this.env.world,e.openInWorld(),e.addMorph(this),this.position=e.extent.scaleBy(.5),e.center=r,e.scale=.8,o.next=8,e.animate({opacity:1,scale:1,duration:i});case 8:return n.addMorph(this),e.remove(),o.abrupt("return",this);case 11:case"end":return o.stop()}},_callee4,this)}));return function Morph_fadeIntoWorld_(t,n){return e.apply(this,arguments)}}()},{key:"removeAllMorphs",value:function Morph_removeAllMorphs_(){this.submorphs=[]}},{key:"bringToFront",value:function Morph_bringToFront_(){return this.owner&&r.arr.last(this.owner.submorphs)!==this&&this.owner.addMorph(this),this}},{key:"owner",get:function get(){return this._owner}},{key:"withAllSubmorphsDetect",value:function Morph_withAllSubmorphsDetect_(e){if(e(this))return this;var t=!0,n=!1,r=void 0;try{for(var i,o=this.submorphs[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value.withAllSubmorphsDetect(e);if(a)return a}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"withAllSubmorphsDo",value:function Morph_withAllSubmorphsDo_(e){var t=[e(this)],n=!0,i=!1,o=void 0;try{for(var a,s=this.submorphs[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;r.arr.pushAll(t,l.withAllSubmorphsDo(e))}}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return t}},{key:"withAllSubmorphsSelect",value:function Morph_withAllSubmorphsSelect_(e){var t=[];return this.withAllSubmorphsDo(function(n){return e(n)&&t.push(n)}),t}},{key:"ownerChain",value:function Morph_ownerChain_(){return this.owner?[this.owner].concat(this.owner.ownerChain()):[]}},{key:"world",value:function Morph_world_(){return this.owner?this.owner.world():null}},{key:"getWindow",value:function Morph_getWindow_(){return this.isWindow?this:this.ownerChain().find(function(e){return e.isWindow})}},{key:"openInWorldNear",value:function Morph_openInWorldNear_(e,t){var n=t||this.world()||this.env.world;return n?(this.center=e,this.setBounds(n.visibleBounds().insetBy(5).translateForInclusion(this.bounds())),this.openInWorld(this.position)):this}},{key:"openInWorldNearHand",value:function Morph_openInWorldNearHand_(e){var n=e||this.world()||this.env.world,r=n.firstHand?n.firstHand.position:t.pt(0,0);return n?this.openInWorldNear(r):void 0}},{key:"openInWorld",value:function Morph_openInWorld_(e,t){var n=t||this.world()||this.env.world;return n?(e?this.position=e:(this.center=n.visibleBounds().center(),this.snap()),n.addMorph(this),this):(console.warn("Cannot open morph "+this+", world morph not found;"),this)}},{key:"openInHand",value:function Morph_openInHand_(e){e||(e=(this.world()||this.env.world).firstHand);e.grab(this),this.center=t.pt(0,0)}},{key:"openInWindow",value:function Morph_openInWindow_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{title:this.name,name:"window for "+this.name,world:null};return(e.world||this.world()||this.env.world).openInWindow(this,r.obj.dissoc(e,["world"]))}},{key:"isAncestorOf",value:function Morph_isAncestorOf_(e){for(var t=e.owner;t;){if(t===this)return!0;t=t.owner}return!1}},{key:"morphsContainingPoint",value:function Morph_morphsContainingPoint_(e,t){if(t||(t=[]),!this.fullContainsWorldPoint(e))return t;for(var n=this.submorphs.length-1;n>=0;n--)this.submorphs[n].morphsContainingPoint(e,t);return this.innerBoundsContainsWorldPoint(e)&&t.push(this),t}},{key:"morphBeneath",value:function Morph_morphBeneath_(e){var t=this.world()||this.owner;if(!t)return null;var n=t.morphsContainingPoint(e);return n[n.indexOf(this)+1]}},{key:"transformTillMorph",value:function Morph_transformTillMorph_(e){if("down"==(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"up"))return e.transformTillMorph(this,"up").inverse();for(var n=new t.Transform,r=this;r&&r!=e;r=r.owner){var i=r,o=i.origin,a=i.scroll;0===o.x&&0===o.y||n.preConcatenate(new t.Transform(r.origin)),n.preConcatenate(r.getTransform()),r!=this&&(0===a.x&&0===a.y||!r.owner||n.preConcatenate(new t.Transform(a.negated()))),r.hasFixedPosition&&r.owner&&n.preConcatenate(new t.Transform(r.owner.scroll))}return n}},{key:"localize",value:function Morph_localize_(e){var n=this.world(),r=e.x,i=e.y;return n?n.transformPointToMorph(this,t.pt(r,i)):e}},{key:"worldPoint",value:function Morph_worldPoint_(e){var n=this.world(),r=e.x,i=e.y;return n?this.transformPointToMorph(n,t.pt(r,i)):e.addPt(this.position)}},{key:"transformToMorph",value:function Morph_transformToMorph_(e){var n=this.getGlobalTransform(),r=e.getGlobalTransform().inverse();n.preConcatenate(r);var i=e.scroll;return 0===i.x&&0===i.y||!e.owner||n.preConcatenate(new t.Transform(i)),n}},{key:"transformPointToMorph",value:function Morph_transformPointToMorph_(e,t){var n=!0,r=!1,i=void 0;try{for(var o,a=this.pathToMorph(e)[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=$(o.value,2),l=s[0],u=s[1];this!=u&&"up"==l&&(t.x-=u.scroll.x,t.y-=u.scroll.y,u.hasFixedPosition&&u.owner&&u.owner.owner&&(t.x+=u.owner.scroll.x,t.y+=u.owner.scroll.y)),this.applyTransform(l,u,t),this!=u&&"down"==l&&(t.x+=u.scroll.x,t.y+=u.scroll.y,u.hasFixedPosition&&u.owner&&u.owner.owner&&(t.x-=u.owner.scroll.x,t.y-=u.owner.scroll.y))}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return t}},{key:"transformRectToMorph",value:function Morph_transformRectToMorph_(e,n){var r,i,o,a,s=this;return[r=n.topLeft(),i=n.topRight(),o=n.bottomRight(),a=n.bottomLeft()].forEach(function(t){return s.transformPointToMorph(e,t)}),t.Rectangle.unionPts([r,i,o,a])}},{key:"applyTransform",value:function Morph_applyTransform_(e,t,n){"up"==e?(n.x+=t.origin.x,n.y+=t.origin.y,n.matrixTransform(t.getTransform(),n)):(n.matrixTransform(t.getInverseTransform(),n),n.x-=t.origin.x,n.y-=t.origin.y)}},{key:"_addPathDependant",value:function Morph__addPathDependant_(e){this._pathDependants.includes(e)||this._pathDependants.push(e)}},{key:"pathToMorph",value:function Morph_pathToMorph_(e){var t;if(t=this._cachedPaths[e.id])return t;var n=this.closestCommonAncestor(e)||this,r=this,i=[],o=[];for(n._addPathDependant(this);r&&r!=n;)o.push(["up",r]),r._addPathDependant(this),r=r.owner;for(r=e;r&&r!=n;)i.push(["down",r]),r._addPathDependant(this),r=r.owner;return this._cachedPaths[e.id]=t=[].concat(o,X(i.reverse())),t}},{key:"closestCommonAncestor",value:function Morph_closestCommonAncestor_(e){return r.arr.intersect([this].concat(X(this.ownerChain())),[e].concat(X(e.ownerChain())))[0]}},{key:"transformForNewOwner",value:function Morph_transformForNewOwner_(e){return new t.Transform(this.transformToMorph(e))}},{key:"localizePointFrom",value:function Morph_localizePointFrom_(e,t){try{return t.transformPointToMorph(this,e)}catch(t){return console.warn("problem "+t+" in localizePointFrom"),e}}},{key:"getGlobalTransform",value:function Morph_getGlobalTransform_(){return this.transformTillMorph(this.world())}},{key:"globalPosition",get:function get(){return this.worldPoint(t.pt(0,0))}},{key:"globalPosition",set:function set(e){return this.position=this.owner?this.owner.localize(e):e}},{key:"ensureToBeInWorldBounds",value:function Morph_ensureToBeInWorldBounds_(){var e=this.world();if(e){var t=this.globalBounds(),n=e.innerBounds().translateForInclusion(t).topLeft().subPt(t.topLeft());this.moveBy(n)}}},{key:"getTransform",value:function Morph_getTransform_(){return this._transform||this.updateTransform(),this._transform}},{key:"getInverseTransform",value:function Morph_getInverseTransform_(){return this._invTransform||this.updateTransform(),this._invTransform}},{key:"updateTransform",value:function Morph_updateTransform_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.position,r=e.scale,i=e.origin,o=e.rotation,a=this._transform||new t.Transform,s=this._invTransform||new t.Transform;n=n||this.position,i=i||this.origin,r=r||this.scale,o=o||this.rotation,a.a=r*Math.cos(o),a.b=r*Math.sin(o),a.c=r*-Math.sin(o),a.d=r*Math.cos(o),a.e=a.a*-i.x+a.c*-i.y+n.x,a.f=a.b*-i.x+a.d*-i.y+n.y;var l=a.a,u=a.b,c=a.c,h=a.d,d=a.e,p=a.f,f=1/(l*h-c*u);s.a=h*f,s.b=-u*f,s.c=-c*f,s.d=l*f,s.e=(c*p-d*h)*f,s.f=-(l*p-u*d)*f,this._transform=a,this._invTransform=s}},{key:"setTransform",value:function Morph_setTransform_(e){this.position=e.getTranslation(),this.rotation=r.num.toRadians(e.getRotation()),this.scale=e.getScalePoint().x,this.updateTransform(this)}},{key:"fullContainsWorldPoint",value:function Morph_fullContainsWorldPoint_(e){return this.fullContainsPoint(null==this.owner?e:this.owner.localize(e))}},{key:"fullContainsPoint",value:function Morph_fullContainsPoint_(e){return this.bounds().containsPoint(e)}},{key:"innerBoundsContainsWorldPoint",value:function Morph_innerBoundsContainsWorldPoint_(e){return this.innerBoundsContainsPoint(this.localize(e))}},{key:"innerBoundsContainsPoint",value:function Morph_innerBoundsContainsPoint_(e){return this.innerBounds().containsPoint(e.addPt(this.origin).subPt(this.scroll))}},{key:"get",value:function Morph_get_(e){if(!e)return null;try{return this.getSubmorphNamed(e)||this.getNameTest(this,e)&&this||this.getOwnerOrOwnerSubmorphNamed(e)}catch(e){if(e.constructor==RangeError&&"Maximum call stack size exceeded"==e.message)throw new Error("'get' failed due to a stack overflow. The most\nlikely source of the problem is using 'get' as part of\ntoString, because 'get' calls 'getOwnerOrOwnerSubmorphNamed', which\ncalls 'toString' on this. Try using 'getSubmorphNamed' instead,\nwhich only searches in this' children.\nOriginal error:\n"+e.stack);throw e}}},{key:"getNameTest",value:function Morph_getNameTest_(e,t){if(r.obj.isRegExp(t)){if(t.test(e.name)||t.test(String(e)))return!0}else if(e.name===t||String(e)===t)return!0;return!1}},{key:"getAllNamed",value:function Morph_getAllNamed_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!this._morphicState||!this.submorphs.length)return t;for(var n=0;n<this.submorphs.length;n++){var r=this.submorphs[n];this.getNameTest(r,e)&&t.push(r)}for(var i=0;i<this.submorphs.length;i++)this.submorphs[i].getAllNamed(e,t);return t}},{key:"getSubmorphNamed",value:function Morph_getSubmorphNamed_(e){if(!this._morphicState||!this.submorphs.length)return null;for(var t=0;t<this.submorphs.length;t++){var n=this.submorphs[t];if(this.getNameTest(n,e))return n}for(var r=0;r<this.submorphs.length;r++){var i=this.submorphs[r].getSubmorphNamed(e);if(i)return i}return null}},{key:"getSubmorphsByStyleClassName",value:function Morph_getSubmorphsByStyleClassName_(e){return this.withAllSubmorphsSelect(function(t){return t.styleClasses.includes(e)})}},{key:"getOwnerNamed",value:function Morph_getOwnerNamed_(e){return this.ownerChain().find(function(t){return t.name===e})}},{key:"getOwnerOrOwnerSubmorphNamed",value:function Morph_getOwnerOrOwnerSubmorphNamed_(e){var t=this.owner;if(!t)return null;if(t.name===e)return t;for(var n=0;n<t.submorphs.length;n++){var r=t.submorphs[n];if(r!==this){if(this.getNameTest(r,e))return r;var i=r.getSubmorphNamed(e);if(i)return i}}return this.owner.getOwnerOrOwnerSubmorphNamed(e)}},{key:"getMorphWithId",value:function Morph_getMorphWithId_(e){return this.withAllSubmorphsDetect(function(t){var n=t.id;return e===n})}},{key:"generateReferenceExpression",value:function Morph_generateReferenceExpression_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.world(),n=e.maxLength,i=void 0===n?10:n,o=e.fromMorph,a=void 0===o?t:o;if(a===this)return"this";var s=t===a?"$world":"this";if(!(t||this.name&&a.get(this.name)===this))return"morph";var l=lively.vm,u=function makeReferenceExpressionListFor(e){var t,n=e.name,i=e.ownerChain(),o=e.owner,u=e.world();e===a&&(t=[s]);u===e&&(t=["$world"]);if(!t&&n&&o){if(o===u&&1===r.arr.count(r.arr.pluck(u.submorphs,"name"),n)&&(t=['$world.get("'+n+'")']),!t&&o!=u)for(var c=i.length-1;c--;)if(1===i[c].getAllNamed(n).length){t=[].concat(X(makeReferenceExpressionListFor(i[c])),['get("'+n+'")']);break}if(!t){var h=[].concat(X(makeReferenceExpressionListFor(o)),['get("'+n+'")']);l.syncEval(h.join("."),{context:a}).value===e&&(t=h)}}t||(t=[s+'.getMorphById("'+e.id+'")']);return t}(this);return u.length>i?'$world.getMorphWithId("'+this.id+'")':u.join(".")}},{key:"setMirrored",value:function Morph_setMirrored_(e){e?this.removeStyleClass("hidden-in-mirror"):this.addStyleClass("hidden-in-mirror")}},{key:"isMirrored",value:function Morph_isMirrored_(){return this.styleClasses.indexOf("hidden-in-mirror")>=0}},{key:"dragTriggerDistance",get:function get(){return 0}},{key:"onMouseDown",value:function Morph_onMouseDown_(e){var t=this;this===e.targetMorph&&setTimeout(function(){!t.grabbable||e.state.draggedMorph||e.state.clickedOnMorph!==t||e.hand.carriesMorphs()||e.hand.grab(t)},800)}},{key:"onMouseUp",value:function Morph_onMouseUp_(e){}},{key:"onMouseMove",value:function Morph_onMouseMove_(e){}},{key:"onLongClick",value:function Morph_onLongClick_(e){}},{key:"addKeyBindings",value:function Morph_addKeyBindings_(e){var t=this;this.addMethodCallChangeDoing({target:this,selector:"addKeyBindings",args:[e],undo:null},function(){var n;t._keybindings||(t._keybindings=[]),t._cachedKeyhandlers=null,(n=t._keybindings).unshift.apply(n,X(e))})}},{key:"keybindings",get:function get(){return this._keybindings||[]}},{key:"keybindings",set:function set(e){return this._cachedKeyhandlers=null,this._keybindings=e}},{key:"keyhandlers",get:function get(){return this._cachedKeyhandlers||(this._cachedKeyhandlers=[ht.withBindings(this.keybindings)])}},{key:"keyCommandMap",get:function get(){var e=this.keyhandlers[0].platform;return this.keybindings.reduce(function(t,n){var r=findKeysForPlatform(n.keys,e),i=n.command,o="string"==typeof i?i:i.command||i.name;return"string"!=typeof r?t:r.split("|").reduce(function(e,t){return Object.assign(e,U({},t,{name:o,command:i,prettyKeys:ht.prettyCombo(t)}))},t)},{})}},{key:"keysForCommand",value:function Morph_keysForCommand_(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.keyCommandMap,r=Object.keys(n).find(function(t){return n[t].name===e});return r&&t?n[r].prettyKeys:r}},{key:"simulateKeys",value:function Morph_simulateKeys_(e){return ht.simulateKeys(this,e)}},{key:"onKeyDown",value:function Morph_onKeyDown_(e){ht.invokeKeyHandlers(this,e,!1)&&e.stop()}},{key:"onKeyUp",value:function Morph_onKeyUp_(e){}},{key:"onContextMenu",value:function Morph_onContextMenu_(e){var t=this;e.targetMorph===this&&(e.stop(),Promise.resolve(this.menuItems()).then(function(n){return t.openMenu(n,e)}).catch(function(e){return $world.logError(e)}))}},{key:"openMenu",value:function Morph_openMenu_(e,t){var n=this.world();return e&&e.length&&n?n.openWorldMenu(t,e):null}},{key:"menuItems",value:function Morph_menuItems_(){var e=this,n=this.world(),r=[],i=this;function menuItemsForMorphsBeneathMe(e){var r=this,o=n.morphsContainingPoint(i.worldPoint(t.pt(0,0)));o.pop();var a=o.indexOf(i);return(o=o.slice(a+1)).map(function(t){return[String(t),e.bind(r,t)]})}r.push(["Publish...",function(){return e.interactivelyPublish()}]),r.push(["Open in...",[["Window",function(){e.openInWindow()}]]]),r.push(["Add morph to...",{getItems:menuItemsForMorphsBeneathMe.bind(this,function(e){return e.addMorph(i)})}]),r.push(["Get halo on...",{getItems:menuItemsForMorphsBeneathMe.bind(this,function(e){return e.world().showHaloFor(e)})}]),this.owner&&this.owner.submorphs.length>1&&r.push(["Arrange morph",[["Bring to front",function(){return e.owner.addMorph(e)}],["Send to back",function(){return e.owner.addMorphBack(e)}]]]),this.submorphs.length&&r.push(["Select all submorphs",function(){return e.world().showHaloFor(e.submorphs.slice())}]);var o=[];this.startSteppingScripts?o.push(["Start stepping",function(){i.startSteppingScripts()}]):o.push(["Start stepping",H(regeneratorRuntime.mark(function _callee5(){var t,n,r,i,o,a,s,l,u,c,h,d,p,f,y,m,g,v,x,b,w,_,k,S,M,C,P,T,A,L,R;return regeneratorRuntime.wrap(function _callee5$(E){for(;;)switch(E.prev=E.next){case 0:return t=[],E.next=3,lively.vm.completions.getCompletions(function(){return e},"");case 3:n=E.sent,r=n.completions,i=!0,o=!1,a=void 0,E.prev=8,s=r[Symbol.iterator]();case 10:if(i=(l=s.next()).done){E.next=52;break}u=l.value,c=$(u,2),h=c[0],d=c[1],p=!0,f=!1,y=void 0,E.prev=18,m=d[Symbol.iterator]();case 20:if(p=(g=m.next()).done){E.next=35;break}if(!(v=g.value).startsWith("_")&&!v.startsWith("$")){E.next=24;break}return E.abrupt("continue",32);case 24:if(x=v.match(/^([^\(]+)\(?([^\)]+)?\)?$/)||[],b=$(x,3),b[0],w=b[1],_=b[2],w&&"function"==typeof e[w]){E.next=31;break}return E.abrupt("continue",32);case 31:t.push({isListItem:!0,string:h+" "+v,value:{selector:w,args:_}});case 32:p=!0,E.next=20;break;case 35:E.next=41;break;case 37:E.prev=37,E.t0=E.catch(18),f=!0,y=E.t0;case 41:E.prev=41,E.prev=42,!p&&m.return&&m.return();case 44:if(E.prev=44,!f){E.next=47;break}throw y;case 47:return E.finish(44);case 48:return E.finish(41);case 49:i=!0,E.next=10;break;case 52:E.next=58;break;case 54:E.prev=54,E.t1=E.catch(8),o=!0,a=E.t1;case 58:E.prev=58,E.prev=59,!i&&s.return&&s.return();case 61:if(E.prev=61,!o){E.next=64;break}throw a;case 64:return E.finish(61);case 65:return E.finish(58);case 66:return E.next=68,$world.filterableListPrompt("Select method to start",t,{requester:e,historyId:"lively.morphic-start-stepping-chooser"});case 68:if(k=E.sent,S=$(k.selected,1),M=S[0]){E.next=73;break}return E.abrupt("return");case 73:return E.next=75,$world.prompt("Steptime in ms (how of the method will be called)?",{input:100});case 75:if(C=E.sent,C=Number(C),!isNaN(C)){E.next=79;break}return E.abrupt("return");case 79:if(P=[C,M.selector],!M.args){E.next=94;break}return T={targetModule:"lively://lively.morphic-stepping-args/eval.js"},E.next=84,$world.editPrompt("Arguments to pass",{input:"["+M.args+"]",mode:"js",evalEnvironment:T});case 84:return A=E.sent,E.next=87,lively.vm.runEval(A,T);case 87:if(L=E.sent,R=L.value,!L.isError){E.next=93;break}return $world.inform("Error evaluating the arguments: "+R),E.abrupt("return");case 93:Array.isArray(R)&&P.push.apply(P,X(R));case 94:e.startStepping.apply(e,P);case 95:case"end":return E.stop()}},_callee5,e,[[8,54,58,66],[18,37,41,49],[42,,44,48],[59,,61,65]])}))]),0!=this.tickingScripts.length&&o.push(["Stop stepping",function(){return i.stopStepping()}]),0!=o.length&&r.push(["Stepping",o]);var a=["Morphic properties",[]];r.push(a);var s=Un.textAttribute("check-square-o"),l=Un.textAttribute("square-o");l[1].paddingRight="7px",Object.assign(s[1],{paddingRight:"5px",float:"none",display:"inline"}),["grabbable","draggable","acceptsDrops","halosEnabled"].forEach(function(t){return a[1].push([[].concat(X(e[t]?s:l),[t,{float:"none"}]),function(){return e[t]=!e[t]}])}),r.push(["Fit to submorphs",H(regeneratorRuntime.mark(function _callee6(){var n,r,i;return regeneratorRuntime.wrap(function _callee6$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,e.world().prompt("Padding around submorphs:",{input:"Rectangle.inset(5)",historyId:"lively.morphic-fit-to-submorphs-padding-hist",requester:e});case 2:if("string"==typeof(n=o.sent)){o.next=5;break}return o.abrupt("return");case 5:return o.next=7,lively.vm.runEval(n,{topLevelVarRecorder:{Rectangle:t.Rectangle}});case 7:r=o.sent,i=r.value,n=i&&i.isRectangle?i:t.Rectangle.inset(0),e.undoStart("fitToSubmorphs"),e.fitToSubmorphs(n),e.undoStop("fitToSubmorphs");case 13:case"end":return o.stop()}},_callee6,e)}))]);var u=this.connectionMenuItems();u&&r.push(["connections...",u]);var c=this.connectMenuItems();return c&&r.push(["connect...",c]),r}},{key:"connectionMenuItems",value:function Morph_connectionMenuItems_(){var e=this;return this.attributeConnections&&this.attributeConnections.length?this.attributeConnections.map(function(t){return[String(t),[["show",H(regeneratorRuntime.mark(function _callee7(){var n;return regeneratorRuntime.wrap(function _callee7$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,System.import("lively.morphic/fabrik.js");case 2:n=e.sent,(0,n.interactivelyShowConnection)(t);case 5:case"end":return e.stop()}},_callee7,e)}))],["edit",H(regeneratorRuntime.mark(function _callee8(){var n;return regeneratorRuntime.wrap(function _callee8$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,System.import("lively.morphic/fabrik.js");case 2:n=e.sent,(0,n.interactivelyReEvaluateConnection)(t);case 5:case"end":return e.stop()}},_callee8,e)}))],["disconnect",function(){t.disconnect(),$world.setStatusMessage("disconnected "+t)}]]]}):null}},{key:"sourceDataBindings",value:function Morph_sourceDataBindings_(){var e=this.propertiesAndPropertySettings().properties,t=r.arr.groupByKey(Object.keys(e).map(function(t){var n=Object.assign({name:t},e[t]);return n.group&&n.group.startsWith("_")?null:n}).filter(Boolean),"group"),n=["core","geometry","interaction","styling","layouting"],i=[];return n.forEach(function(e){return i.push(t[e])}),r.arr.withoutAll(t.keys(),n).forEach(function(e){return i.push(t[e])}),i}},{key:"targetDataBindings",value:function Morph_targetDataBindings_(){for(var e=[],t=this;t!==Object.prototype;){var n=t===this?String(this):t.constructor.name,r=null,i=Object.getOwnPropertyDescriptors(t),o=Object.getPrototypeOf(t);for(var a in i){var s=i[a].value;if("function"==typeof s&&s!==t.constructor&&(!a.startsWith("$")&&!a.startsWith("_"))){r||(r=[]);var l=lively.lang.fun.argumentNames(s);r.push({group:n+" methods",signature:a+"("+l.join(", ")+")",name:a})}}r&&e.push(r),t=o}return this.sourceDataBindings().concat(e)}},{key:"connectMenuItems",value:function Morph_connectMenuItems_(e){var t=this,n=this.sourceDataBindings(),r=this.world(),i=n.map(function(n){return[n[0].group||"uncategorized",n.map(function(n){return[n.name,e?function(){return e(n.name,t,n)}:H(regeneratorRuntime.mark(function _callee9(){var e;return regeneratorRuntime.wrap(function _callee9$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,System.import("lively.morphic/fabrik.js");case 2:e=r.sent,(0,e.interactiveConnectGivenSource)(t,n.name);case 5:case"end":return r.stop()}},_callee9,t)}))]})]});return r&&i.push(["custom...",e?function(){return e("custom...",t,null)}:H(regeneratorRuntime.mark(function _callee10(){var e,n,i;return regeneratorRuntime.wrap(function _callee10$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,System.import("lively.morphic/fabrik.js");case 2:return e=o.sent,n=e.interactiveConnectGivenSource,o.next=6,r.prompt("Enter custom connection point",{requester:t,historyId:"lively.morphic-custom-connection-points",useLastInput:!0});case 6:(i=o.sent)&&n(t,i);case 8:case"end":return o.stop()}},_callee10,t)}))]),i}},{key:"onCut",value:function Morph_onCut_(e){}},{key:"onCopy",value:function Morph_onCopy_(e){}},{key:"onPaste",value:function Morph_onPaste_(e){}},{key:"onDragStart",value:function Morph_onDragStart_(e){this.undoStart("drag-move");var t=e.state,n=t.dragStartMorphPosition,r=t.absDragDelta;this.position=n.addPt(r)}},{key:"onDragEnd",value:function Morph_onDragEnd_(e){this.undoStop("drag-move"),g.removeSnapToGuidesOf&&g.removeSnapToGuidesOf(this)}},{key:"onDrag",value:function Morph_onDrag_(e){var t=e.state,n=t.dragStartMorphPosition,r=t.absDragDelta;this.position=n.addPt(r),g.showAndSnapToGuides&&g.showAndSnapToGuides(this,e.isCtrlDown(),e.isCtrlDown())}},{key:"onGrab",value:function Morph_onGrab_(e){if(e.isShiftDown()){var n=this.copy();n.position=this.transformPointToMorph(e.hand,t.pt(0,0)),e.hand.grab(n)}else e.hand.grab(this)}},{key:"onDrop",value:function Morph_onDrop_(e){e.hand.dropMorphsOn(this)}},{key:"wantsToBeDroppedOn",value:function Morph_wantsToBeDroppedOn_(e){return!0}},{key:"onDropHoverIn",value:function Morph_onDropHoverIn_(e){}},{key:"onDropHoverUpdate",value:function Morph_onDropHoverUpdate_(e){}},{key:"onDropHoverOut",value:function Morph_onDropHoverOut_(e){}},{key:"onBeingDroppedOn",value:function Morph_onBeingDroppedOn_(e,t){t.addMorph(this)}},{key:"onHoverIn",value:function Morph_onHoverIn_(e){}},{key:"onHoverOut",value:function Morph_onHoverOut_(e){}},{key:"onScroll",value:function Morph_onScroll_(e){}},{key:"onMouseWheel",value:function Morph_onMouseWheel_(e){}},{key:"onNativeDrop",value:function Morph_onNativeDrop_(e){}},{key:"onNativeDragleave",value:function Morph_onNativeDragleave_(e){}},{key:"onNativeDragenter",value:function Morph_onNativeDragenter_(e){}},{key:"onNativeDragover",value:function Morph_onNativeDragover_(e){}},{key:"onNativeDragend",value:function Morph_onNativeDragend_(e){}},{key:"onNativeDragstart",value:function Morph_onNativeDragstart_(e){}},{key:"onNativeDrag",value:function Morph_onNativeDrag_(e){}},{key:"focus",value:function Morph_focus_(){var e=this.env.eventDispatcher;e&&e.focusMorph(this)}},{key:"onFocus",value:function Morph_onFocus_(e){}},{key:"onBlur",value:function Morph_onBlur_(e){}},{key:"isFocused",value:function Morph_isFocused_(){var e=this.env.eventDispatcher;return e&&e.isMorphFocused(this)}},{key:"exportToJSON",value:function Morph_exportToJSON_(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{keepFunctions:!0},n=Object.keys(this._morphicState).reduce(function(t,n){var r=e[n];return"submorphs"===n&&(r=r.map(function(e){return e.exportToJSON()})),t[n]=r,t},{});return n.name||(n.name=this.name),n._id=this._id,n.type=this.constructor,t.keepFunctions&&Object.keys(this).forEach(function(t){return"function"==typeof e[t]&&(n[t]=e[t])}),n}},{key:"initFromJSON",value:function Morph_initFromJSON_(e){return this._env=Ue.default(),this._rev=0,this._owner=null,this._dirty=!0,this._rendering=!1,this._submorphOrderChanged=!1,this._id=newMorphId$$1(this.constructor.name),this._animationQueue=new Z(this),this._cachedPaths={},this._pathDependants=[],this._tickingScripts=[],this.initializeProperties(),Object.assign(this,e),this}},{key:"copyViaJSON",value:function Morph_copyViaJSON_(){var e=this.exportToJSON();return r.tree.prewalk(e,function(e){return e._id=newMorphId$$1(e.type)},function(e){return e.submorphs}),e.name=e.name.replace(/copy( [0-9]+)?$/,function(e,t){return"copy "+(t&&t.trim()?Number(t)+1:"1")}),morph$2(Object.assign({attributeConnections:[]},e))}},{key:"copy",value:function Morph_copy_(){return function copyMorph(e){return deserializeMorph(serializeMorph(e),{migrations:Dt,reinitializeIds:!0})}(this)}},{key:"interactivelyPublish",value:function(){var e=H(regeneratorRuntime.mark(function _callee11(){var e,n,r;return regeneratorRuntime.wrap(function _callee11$(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,System.import("lively.morphic/partsbin.js");case 3:return e=i.sent,n=e.interactivelySavePart,i.next=7,n(this,{notifications:!1,loadingIndicator:!0});case 7:r=i.sent,(this.world()||this.env.world).setStatusMessage(r?"Published "+this+" as "+r.name:"Failed to publish part "+this,r?t.Color.green:t.Color.red),i.next=15;break;case 12:i.prev=12,i.t0=i.catch(0),"canceled"!=i.t0&&world.showError(i.t0);case 15:case"end":return i.stop()}},_callee11,this,[[0,12]])}));return function Morph_interactivelyPublish_(){return e.apply(this,arguments)}}()},{key:"makeDirty",value:function Morph_makeDirty_(){this._dirty||(this._dirty=!0,this.owner&&this.owner.makeDirty())}},{key:"needsRerender",value:function Morph_needsRerender_(){return this._dirty}},{key:"aboutToRender",value:function Morph_aboutToRender_(e){this._dirty=!1,this._rendering=!0}},{key:"onAfterRender",value:function Morph_onAfterRender_(e){}},{key:"whenRendered",value:function Morph_whenRendered_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;return this.env.whenRendered(this,e).then(function(){return!0}).catch(function(){return!1})}},{key:"render",value:function Morph_render_(e){return e.renderMorph(this)}},{key:"applyLayoutIfNeeded",value:function Morph_applyLayoutIfNeeded_(){if(this._dirty){for(var e in this.submorphs)this.submorphs[e].applyLayoutIfNeeded();this.layout&&!this.layout.manualUpdate&&this.layout.forceLayout()}}},{key:"requestStyling",value:function Morph_requestStyling_(){this.withAllSubmorphsDo(function(e){e._wantsStyling=!0,e.makeDirty()})}},{key:"renderAsRoot",value:function Morph_renderAsRoot_(e){var t=this;return this.dontRecordChangesWhile(function(){var e=t._stylingVisitor;e||(e=t._stylingVisitor=new qt(t)),e.visit(),t.applyLayoutIfNeeded()}),renderRootMorph(this,e)}},{key:"renderPreview",value:function Morph_renderPreview_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.env.renderer).renderPreview(this,e)}},{key:"startStepping",value:function Morph_startStepping_(){var e=Array.from(arguments),t="number"==typeof e[0]?e.shift():null,n=e.shift(),r=new pt(this,n,e);return this.removeEqualScripts(r),this._tickingScripts.push(r),r.startTicking(t),r}},{key:"tickingScripts",get:function get(){return this._tickingScripts}},{key:"stopStepping",value:function Morph_stopStepping_(){r.arr.invoke(this._tickingScripts,"stop"),this._tickingScripts.length=[]}},{key:"stopSteppingScriptNamed",value:function Morph_stopSteppingScriptNamed_(e){var t=this._tickingScripts.filter(function(t){return t.selector===e});this.stopScripts(t)}},{key:"stopScripts",value:function Morph_stopScripts_(e){r.arr.invoke(e,"stop"),this._tickingScripts=r.arr.withoutAll(this._tickingScripts,e)}},{key:"suspendStepping",value:function Morph_suspendStepping_(){this._tickingScripts&&r.arr.invoke(this._tickingScripts,"suspend")}},{key:"suspendSteppingAll",value:function Morph_suspendSteppingAll_(){this.withAllSubmorphsDo(function(e){return e.suspendStepping()})}},{key:"resumeStepping",value:function Morph_resumeStepping_(){r.arr.invoke(this._tickingScripts,"resume")}},{key:"resumeSteppingAll",value:function Morph_resumeSteppingAll_(){this.withAllSubmorphsDo(function(e){return r.arr.invoke(e._tickingScripts,"resume")})}},{key:"removeEqualScripts",value:function Morph_removeEqualScripts_(e){this.stopScripts(this._tickingScripts.filter(function(t){return t.equals(e)}))}},{key:"commands",get:function get(){return this._commands||[]}},{key:"commands",set:function set(e){this._commands&&this.removeCommands(this._commands),this.addCommands(e)}},{key:"commandsIncludingOwners",get:function get(){return r.arr.flatmap([this].concat(this.ownerChain()),function(e){return r.arr.sortByKey(e.commands,"name").map(function(t){return{target:e,command:t}})})}},{key:"addCommands",value:function Morph_addCommands_(e){var t=this;this.addMethodCallChangeDoing({target:this,selector:"addCommands",args:[e],undo:{target:this,selector:"removeCommands",args:[e]}},function(){t.removeCommands(e),t._commands=(t._commands||[]).concat(e)})}},{key:"removeCommands",value:function Morph_removeCommands_(e){var t=this;this.addMethodCallChangeDoing({target:this,selector:"removeCommands",args:[e],undo:{target:this,selector:"addCommands",args:[e]}},function(){var n=e.map(function(e){return"string"==typeof e?e:e.name}),r=(t._commands||[]).filter(function(e){var t=e.name;return!n.includes(t)});r.length?t._commands=r:delete t._commands})}},{key:"commandHandler",get:function get(){return this._commandHandler||Gt}},{key:"lookupCommand",value:function Morph_lookupCommand_(e){var t=this.commandHandler.lookupCommand(e,this);return t&&t.command?t:null}},{key:"execCommand",value:function Morph_execCommand_(e,t,n,r){return this.commandHandler.exec(e,this,t,n,r)}}],[{key:"propertySettings",get:function get(){return{defaultGetter:function defaultGetter(e){return this.getProperty(e)},defaultSetter:function defaultSetter(e,t){this.setProperty(e,t)},valueStoreProperty:"_morphicState"}}},{key:"properties",get:function get(){return Object.assign({name:{group:"core",initialize:function initialize(e){if(!e){var t=this.constructor.name;e=(r.string.startsWithVowel(t)?"an":"a")+t}this.name=e}},draggable:{group:"interaction",isStyleProp:!0,defaultValue:!0},grabbable:{group:"interaction",isStyleProp:!0,defaultValue:!1,set:function set(e){e&&!this.draggable&&(this.draggable=!0),this.setProperty("grabbable",e)}},acceptsDrops:{group:"interaction",isStyleProp:!0,defaultValue:!0},dropShadow:{group:"styling",type:"Shadow",isStyleProp:!0,defaultValue:null,set:function set(e){e&&!e.isShadowObject&&((e=new N(e)).morph=this),this.setProperty("dropShadow",e)}},tooltip:{group:"core",defaultValue:null},focusable:{group:"interaction",defaultValue:!0},nativeCursor:{group:"interaction",type:"Enum",values:["auto","default","none","context-menu","help","pointer","progress","wait","cell","crosshair","text","vertical-text","alias","copy","move","no-drop","not-allowed","e-resize","n-resize","ne-resize","nw-resize","s-resize","se-resize","sw-resize","w-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","col-resize","row-resize","all-scroll","zoom-in","zoom-out","grab","grabbing"],isStyleProp:!0,defaultValue:"auto"},halosEnabled:{group:"interaction",isStyleProp:!0,defaultValue:!!z.halosEnabled},reactsToPointer:{group:"interaction",isStyleProp:!0,defaultValue:!0},position:{group:"geometry",type:"Point",isStyleProp:!0,defaultValue:t.pt(0,0)},origin:{group:"geometry",type:"Point",isStyleProp:!0,defaultValue:t.pt(0,0)},extent:{group:"geometry",type:"Point",isStyleProp:!0,defaultValue:t.pt(10,10),set:function set(e){var n=this.extent;if(this.setProperty("extent",e),!this.origin.equals(t.pt(0,0))){var r=t.pt(e.x/n.x,e.y/n.y);this.adjustOrigin(this.origin.scaleByPt(r))}}},width:{group:"geometry",derived:!0,after:["extent"],before:["submorphs"],get:function get(){return this.extent.x},set:function set(e){return this.extent=t.pt(e,this.extent.y)}},height:{group:"geometry",derived:!0,after:["extent"],before:["submorphs"],get:function get(){return this.extent.y},set:function set(e){return this.extent=t.pt(this.extent.x,e)}},left:{group:"geometry",derived:!0,after:["extent","submorphs","layout"],get:function get(){return this.bounds().left()},set:function set(e){return this.moveBy(t.pt(e-this.left),0)}},right:{group:"geometry",derived:!0,after:["extent","submorphs","layout"],get:function get(){return this.bounds().right()},set:function set(e){return this.moveBy(t.pt(e-this.right),0)}},top:{group:"geometry",derived:!0,after:["extent","submorphs","layout"],get:function get(){return this.bounds().top()},set:function set(e){return this.moveBy(t.pt(0,e-this.top))}},bottom:{group:"geometry",derived:!0,after:["extent","submorphs","layout"],get:function get(){return this.bounds().bottom()},set:function set(e){return this.moveBy(t.pt(0,e-this.bottom))}},center:{group:"geometry",derived:!0,after:["extent","submorphs","layout"],get:function get(){return this.bounds().center()},set:function set(e){return this.align(this.center,e)}},topLeft:{group:"geometry",derived:!0,after:["extent","submorphs","layout"],get:function get(){return this.bounds().topLeft()},set:function set(e){return this.align(this.topLeft,e)}},topRight:{group:"geometry",derived:!0,after:["extent","submorphs","layout"],get:function get(){return this.bounds().topRight()},set:function set(e){return this.align(this.topRight,e)}},bottomRight:{group:"geometry",derived:!0,after:["extent","layout"],get:function get(){return this.bounds().bottomRight()},set:function set(e){return this.align(this.bottomRight,e)}},bottomLeft:{group:"geometry",derived:!0,after:["extent","submorphs","layout"],get:function get(){return this.bounds().bottomLeft()},set:function set(e){return this.align(this.bottomLeft,e)}},bottomCenter:{group:"geometry",derived:!0,after:["extent","submorphs","layout"],get:function get(){return this.bounds().bottomCenter()},set:function set(e){return this.align(this.bottomCenter,e)}},topCenter:{group:"geometry",derived:!0,after:["extent","submorphs","layout"],get:function get(){return this.bounds().topCenter()},set:function set(e){return this.align(this.topCenter,e)}},leftCenter:{group:"geometry",derived:!0,after:["extent","submorphs"],get:function get(){return this.bounds().leftCenter()},set:function set(e){return this.align(this.leftCenter,e)}},rightCenter:{group:"geometry",derived:!0,after:["extent","submorphs"],get:function get(){return this.bounds().rightCenter()},set:function set(e){return this.align(this.rightCenter,e)}},rotation:{group:"geometry",type:"Number",isFloat:!0,isStyleProp:!0,defaultValue:0},scale:{group:"geometry",type:"Number",min:0,isFloat:!0,isStyleProp:!0,defaultValue:1},hasFixedPosition:{group:"geometry",doc:"When morph is submorph of world hasFixedPosition == true will keep the morph at the same position relative to top left of the browser window. This means, when the world is scrolled, the morph keeps its place.",defaultValue:!1},opacity:{group:"styling",type:"Number",min:0,max:1,isStyleProp:!0,defaultValue:1},fill:{group:"styling",type:"ColorGradient",isStyleProp:!0,defaultValue:t.Color.white},visible:{group:"styling",isStyleProp:!0,defaultValue:!0,set:function set(e){e||this.makeDirty(),this.setProperty("visible",e)}},submorphs:{group:"core",defaultValue:[],after:["isLayoutable","origin","position","rotation","scale"],get:function get(){return(this.getProperty("submorphs")||[]).slice()},set:function set(e){var t=this,n=this.layout,r=n&&n.isEnabled();r&&n.disable(),this.submorphs.forEach(function(t){return e.includes(t)||t.remove()}),e.forEach(function(e,n){return t.submorphs[n]!==e&&t.addMorph(e,t.submorphs[n])}),r&&n.enable()}},clipMode:{group:"styling",type:"Enum",values:["visible","hidden","scroll","auto"],isStyleProp:!0,defaultValue:"visible",set:function set(e){this.setProperty("clipMode",e),this.isClip()||(this.scroll=t.pt(0,0))}},scroll:{group:"geometry",defaultValue:t.pt(0,0),type:"Point",set:function set(e){var n=e.x,r=e.y;if(this.isClip()){var i=this.scrollExtent.subPt(this.extent),o=i.x,a=i.y;n=Math.max(0,Math.min(o,n)),r=Math.max(0,Math.min(a,r)),this.setProperty("scroll",t.pt(n,r)),this.makeDirty()}}},scrollbarOffset:{group:"styling",defaultValue:t.pt(15,15)},styleClasses:{group:"styling",isStyleProp:!0,defaultValue:["morph"],get:function get(){return this.constructor.styleClasses.concat(this.getProperty("styleClasses"))},set:function set(e){this.setProperty("styleClasses",r.arr.withoutAll(e,this.constructor.styleClasses)),this.requestStyling()}},layout:{group:"layouting",isStyleProp:!0,type:"Layout",after:["submorphs","extent","origin","position","isLayoutable","styleSheets"],set:function set(e){e&&(e.container=this),this.setProperty("layout",e)}},isLayoutable:{group:"layouting",isStyleProp:!0,defaultValue:!0},borderLeft:{group:"styling",isStyleProp:!0,derived:!0,after:["borderStyleLeft","borderWidthLeft","borderColorLeft"],get:function get(){return{style:this.borderStyleLeft,width:this.borderWidthLeft,color:this.borderColorLeft}},set:function set(e){"style"in e&&(this.borderStyleLeft=e.style),"width"in e&&(this.borderWidthLeft=e.width),"color"in e&&(this.borderColorLeft=e.color),"radius"in e&&(this.borderRadiusLeft=e.radius)}},borderRight:{group:"styling",isStyleProp:!0,derived:!0,after:["borderStyleRight","borderWidthRight","borderColorRight"],get:function get(){return{style:this.borderStyleRight,width:this.borderWidthRight,color:this.borderColorRight}},set:function set(e){"style"in e&&(this.borderStyleRight=e.style),"width"in e&&(this.borderWidthRight=e.width),"color"in e&&(this.borderColorRight=e.color),"radius"in e&&(this.borderRadiusRight=e.radius)}},borderBottom:{group:"styling",isStyleProp:!0,derived:!0,after:["borderStyleBottom","borderWidthBottom","borderColorBottom"],get:function get(){return{style:this.borderStyleBottom,width:this.borderWidthBottom,color:this.borderColorBottom}},set:function set(e){"style"in e&&(this.borderStyleBottom=e.style),"width"in e&&(this.borderWidthBottom=e.width),"color"in e&&(this.borderColorBottom=e.color),"radius"in e&&(this.borderRadiusBottom=e.radius)}},borderTop:{group:"styling",isStyleProp:!0,derived:!0,after:["borderStyleTop","borderWidthTop","borderColorTop"],get:function get(){return{style:this.borderStyleTop,width:this.borderWidthTop,color:this.borderColorTop}},set:function set(e){"style"in e&&(this.borderStyleTop=e.style),"width"in e&&(this.borderWidthTop=e.width),"color"in e&&(this.borderColorTop=e.color),"radius"in e&&(this.borderRadiusTop=e.radius)}},borderWidth:{group:"styling",isStyleProp:!0,type:"Number",foldable:["top","left","right","bottom"],min:0,defaultValue:{top:0,bottom:0,left:0,right:0,valueOf:function valueOf(){return 0}},get:function get(){var e=this.getProperty("borderWidth");return Object.assign({},e,{valueOf:function valueOf(){return e.left}})},set:function set(e){r.obj.isNumber(e)&&(e={left:e,right:e,top:e,bottom:e});this.setProperty("borderWidth",e)}}},generateUnfolded("borderWidth",void 0,"styling"),{borderRadius:{group:"styling",isStyleProp:!0,type:"Number",min:0,foldable:["top","left","right","bottom"],defaultValue:{top:0,bottom:0,right:0,left:0,valueOf:function valueOf(){return 0}},get:function get(){var e=this.getProperty("borderRadius");return Object.assign({},e,{valueOf:function valueOf(){return e.left}})},set:function set(e){(e||(e=0),r.obj.isNumber(e))&&(e={left:e,right:e,top:e,bottom:e});e.isRectangle&&(e={left:e.left(),right:e.right(),top:e.top(),bottom:e.bottom()}),this.setProperty("borderRadius",e)}}},generateUnfolded("borderRadius",void 0,"styling"),{borderStyle:{group:"styling",isStyleProp:!0,type:"Enum",foldable:["top","left","right","bottom"],values:["none","hidden","dotted","dashed","solid","double","groove","ridge","inset","outset"],defaultValue:{top:"solid",left:"solid",bottom:"solid",right:"solid",valueOf:function valueOf(){return"solid"}},get:function get(){var e=this.getProperty("borderStyle");return Object.assign({},e,{valueOf:function valueOf(){return e.left}})},set:function set(e){r.obj.isString(e)&&(e={left:e,right:e,top:e,bottom:e});this.setProperty("borderStyle",e)}}},generateUnfolded("borderStyle",void 0,"styling"),{borderColor:{group:"styling",isStyleProp:!0,type:"Color",foldable:["top","left","right","bottom"],defaultValue:{top:t.Color.white,left:t.Color.white,bottom:t.Color.white,right:t.Color.white,valueOf:function valueOf(){return t.Color.white}},get:function get(){var e=this.getProperty("borderColor");return Object.assign({},e,{valueOf:function valueOf(){return e.left}})},set:function set(e){e||(e=t.Color.white),e.isColor&&(e={top:e,left:e,right:e,bottom:e}),this.setProperty("borderColor",e?r.obj.extract(e,["top","left","right","bottom"],function(e,n){return r.obj.isArray(n)?t.Color.fromTuple(n):n}):e)}}},generateUnfolded("borderColor",void 0,"styling"),{border:{group:"styling",isStyleProp:!0,derived:!0,after:["borderStyle","borderWidth","borderColor"],get:function get(){var e=this;return{get style(){return e.borderStyle},set style(t){e.borderStyle=t},get width(){return e.borderWidth},set width(t){e.borderWidth=t},get color(){return e.borderColor},set color(t){e.borderColor=t},get borderRadius(){return e.borderRadius},set borderRadius(t){e.borderRadius=t}}},set:function set(e){"style"in e&&(this.borderStyle=e.style),"width"in e&&(this.borderWidth=e.width),"color"in e&&(this.borderColor=e.color),"radius"in e&&(this.borderRadius=e.radius)}},styleSheets:{group:"styling",before:["submorphs"],type:"StyleSheets",defaultValue:[],set:function set(e){var t=this;r.obj.isArray(e)||(e=[e]),this.setProperty("styleSheets",e),e.forEach(function(e){e.context=t}),this.requestStyling()}},styleProperties:{group:"styling",derived:!0,readOnly:!0,get:function get(){var e=this.propertiesAndPropertySettings().properties,t=[];for(var n in e)e[n].isStyleProp&&t.push(n);return t}},style:{group:"styling",derived:!0,readOnly:!0,get:function get(){for(var e=this.styleProperties,t={},n=0;n<e.length;n++){var r=e[n];t[r]=this[r]}return t}},epiMorph:{group:"core",doc:"epi morphs are 'transient' morphs, i.e. meta objects that should not be serialized like halo items, menus, etc.",defaultValue:!1},respondsToVisibleWindow:{group:"interaction",doc:"Morphs will respond to changes in visible window and a call will be made to the morph's relayout function, supplying the event generated",defaultValue:!1},metadata:{group:"core"}})}},{key:"styleClasses",get:function get(){if(this.hasOwnProperty("_styclassNames"))return this._styleClasses;for(var e=this,t=[];e&&e!==Object;)t.push(e.name),e=e[Symbol.for("lively-instance-superclass")];return this._styleClasses=t}}],n,void 0,{start:1835,end:84134})}(void 0),Kt=function(e){var t=_classRecorder,n=t.hasOwnProperty("Ellipse")&&"function"==typeof t.Ellipse?t.Ellipse:t.Ellipse=function Ellipse(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,void 0,[{key:"properties",get:function get(){return{borderRadius:{get:function get(){return{top:this.borderRadiusTop,right:this.borderRadiusRight,left:this.borderRadiusLeft,bottom:this.borderRadiusBottom}}},borderRadiusLeft:{get:function get(){return this.height},set:function set(){}},borderRadiusRight:{get:function get(){return this.height},set:function set(){}},borderRadiusTop:{get:function get(){return this.width},set:function set(){}},borderRadiusBottom:{get:function get(){return this.width},set:function set(){}}}}}],t,void 0,{start:84144,end:84816})}($t),Xt=function(e){var n=_classRecorder,r=n.hasOwnProperty("Triangle")&&"function"==typeof n.Triangle?n.Triangle:n.Triangle=function Triangle(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(r,e,[{key:Symbol.for("lively-instance-initialize"),value:function Triangle_initialize_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(r.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e),this.update()}},{key:"onChange",value:function Triangle_onChange_(e){("extent"==e.prop||"direction"==e.prop||"fill"==e.prop&&e.value)&&this.update(),lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(r.prototype),"onChange",this).call(this,e)}},{key:"update",value:function Triangle_update_(){var e,n=this.extent,r=n.x,i=n.y;r!=i&&(this.extent=t.pt(Math.max(r,i),Math.max(r,i))),this.origin=t.pt(r/2,i/2);var o=this.triangleFill=this.fill||this.triangleFill;this.fill=null;var a,s,l,u={width:r/2,style:"solid",color:o},c={width:i/2,style:"solid",color:t.Color.transparent};switch(this.direction){case"down":a="borderLeft",s="borderRight",l="borderTop";break;case"up":a="borderLeft",s="borderRight",l="borderBottom";break;case"left":a="borderBottom",s="borderTop",l="borderRight";break;case"right":a="borderBottom",s="borderTop",l="borderLeft"}Object.assign(this,(U(e={},a,c),U(e,s,c),U(e,l,u),e))}}],[{key:"properties",get:function get(){return{direction:{defaultValue:"up"},triangleFill:{after:["fill"],initialize:function initialize(){this.triangleFill=this.fill}}}}}],n,void 0,{start:84825,end:86240})}($t),Yt=function(e){var n=_classRecorder,i=n.hasOwnProperty("Image")&&"function"==typeof n.Image?n.Image:n.Image=function Image(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(i,e,[{key:"__deserialize__",value:function Image___deserialize___(e,t){this._isDeserializing=!0,lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(i.prototype),"__deserialize__",this).call(this,e,t)}},{key:"__after_deserialize__",value:function Image___after_deserialize___(e,t){delete this._isDeserializing,lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(i.prototype),"__after_deserialize__",this).call(this,e,t)}},{key:"isImage",get:function get(){return!0}},{key:"ratio",get:function get(){var e=this.naturalExtent;return e.x/e.y}},{key:"setWidthKeepingRatio",value:function Image_setWidthKeepingRatio_(e){this.width=e,this.height=e/this.ratio}},{key:"setHeightKeepingRatio",value:function Image_setHeightKeepingRatio_(e){this.width=this.ratio*e,this.height=e}},{key:"loadUrl",value:function Image_loadUrl_(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.autoResize,i=this.autoResize;return this.autoResize=n,this.imageUrl=e,r.promise.finally(this.whenLoaded(),function(){return t.autoResize=i})}},{key:"whenLoaded",value:function Image_whenLoaded_(){var e=this;return this.isLoaded?Promise.resolve(this):new Promise(function(n,r){var i=e.imageUrl;e.imageElement(function(o){e.imageUrl!==i&&r(new Error("url changed ("+i+" => "+e.imageUrl+")")),e.naturalExtent=t.pt(o.width,o.height),e.isLoaded=!0,n(e)})})}},{key:"determineNaturalExtent",value:function Image_determineNaturalExtent_(){var e=this;return this.whenLoaded().then(function(){return e.naturalExtent})}},{key:"render",value:function Image_render_(e){return e.renderImage(this)}},{key:"clear",value:function Image_clear_(){return this.loadUrl("data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",!1)}},{key:"imageElement",value:function Image_imageElement_(e){var t=this;return new Promise(function(n,r){var i=t.env.domEnv.document.createElement("img");i.onload=function(){n(i),"function"==typeof e&&e(i)},i.src=t.imageUrl})}},{key:"canvasElementAndContext",value:function(){var e=H(regeneratorRuntime.mark(function _callee12(){var e,t,n,r;return regeneratorRuntime.wrap(function _callee12$(i){for(;;)switch(i.prev=i.next){case 0:return e=this.env.domEnv.document,i.next=3,this.imageElement();case 3:return t=i.sent,n=e.createElement("canvas"),r=n.getContext("2d"),n.width=t.width,n.height=t.height,r.drawImage(t,0,0,t.width,t.height),i.abrupt("return",{canvas:n,ctx:r,image:t});case 10:case"end":return i.stop()}},_callee12,this)}));return function Image_canvasElementAndContext_(){return e.apply(this,arguments)}}()},{key:"imageData",value:function(){var e=H(regeneratorRuntime.mark(function _callee13(e){var n,r,i,o,a,s,l,u;return regeneratorRuntime.wrap(function _callee13$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.canvasElementAndContext();case 2:return n=c.sent,r=n.ctx,i=n.image,e||(e=t.rect(0,0,i.width,i.height)),a=(o=e).x,s=o.y,l=o.width,u=o.height,console.log(a,s),c.abrupt("return",r.getImageData(a,s,l,u));case 13:case"end":return c.stop()}},_callee13,this)}));return function Image_imageData_(t){return e.apply(this,arguments)}}()},{key:"pixelAt",value:function(){var e=H(regeneratorRuntime.mark(function _callee14(e){return regeneratorRuntime.wrap(function _callee14$(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.imageData(e.extent(t.pt(1,1)));case 2:return n.abrupt("return",n.sent.data);case 3:case"end":return n.stop()}},_callee14,this)}));return function Image_pixelAt_(t){return e.apply(this,arguments)}}()},{key:"colorAt",value:function(){var e=H(regeneratorRuntime.mark(function _callee15(e){return regeneratorRuntime.wrap(function _callee15$(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=t.Color,n.next=3,this.pixelAt(e);case 3:return n.t1=n.sent,n.abrupt("return",n.t0.fromTuple8Bit.call(n.t0,n.t1));case 5:case"end":return n.stop()}},_callee15,this)}));return function Image_colorAt_(t){return e.apply(this,arguments)}}()},{key:"loadArrayBuffer",value:function Image_loadArrayBuffer_(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=new Uint8Array(e),n=new Blob([t],{type:"image/jpeg"}),r=(window.URL||window.webkitURL).createObjectURL(n);this.imageUrl=r,this.makeDirty()}},{key:"convertToBase64",value:function(){var e=H(regeneratorRuntime.mark(function _callee16(){var e,t,n,r,i,o,a;return regeneratorRuntime.wrap(function _callee16$(s){for(;;)switch(s.prev=s.next){case 0:return e=this.imageUrl,"jpg"==(t=e.slice(e.lastIndexOf(".")+1,e.length).toLowerCase())&&(t="jpeg"),["gif","jpeg","png","tiff"].includes(t)||(t="gif"),e.startsWith("http")||(e=location.origin+"/"+e),s.next=6,System.import("lively.ide/shell/shell-interface");case 6:return n=s.sent,r=n.runCommand,i='curl --silent "'+e+'" | openssl base64',s.next=11,r(i).whenDone();case 11:return o=s.sent,a=o.stdout,s.abrupt("return",this.loadUrl("data:image/"+t+";base64,"+a,!1));case 14:case"end":return s.stop()}},_callee16,this)}));return function Image_convertToBase64_(){return e.apply(this,arguments)}}()},{key:"downloadImage",value:function Image_downloadImage_(){var e,t=this.imageUrl;if(t.match(/^data:image/)){e=this.name||"image-from-lively";var n=t.match(/image\/([^;]+)/);n&&n[1]&&(e+="."+n[1])}else e||(e=r.arr.last(t.split("/")));var i=document.createElement("a");i.download=e,i.href=t,i.click()}},{key:"convertTo",value:function Image_convertTo_(e,t){t||(t=1);var n=this.canvasElementAndContext(),r=n.ctx,i=n.canvas,o=n.image,a=this.width,s=this.height;return i.width=o.width,i.height=o.height,r.drawImage(o,0,0,a,s),this.loadUrl(i.toDataURL(e,t),!1)}},{key:"resampleImageToFitBounds",value:function(){var e=H(regeneratorRuntime.mark(function _callee17(){var e,t,n,r,i,o,a,s,l;return regeneratorRuntime.wrap(function _callee17$(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.canvasElementAndContext();case 2:return e=u.sent,t=e.ctx,n=e.canvas,r=e.image,i=this.width,o=this.height,a=r.width,s=r.height,n.width=a,n.height=s,t.drawImage(r,0,0,i,o),l=t.getImageData(0,0,a,s),n.width=i,n.height=o,t.putImageData(l,0,0),u.abrupt("return",this.loadUrl(n.toDataURL(),!1));case 18:case"end":return u.stop()}},_callee17,this)}));return function Image_resampleImageToFitBounds_(){return e.apply(this,arguments)}}()},{key:"crop",value:function Image_crop_(e){var n=this.canvasElementAndContext(),r=n.ctx,i=n.canvas,o=n.image,a=(this.width,this.height,this.innerBounds()),s=o.width,l=o.height,u=a.intersection(e),c=new t.Rectangle(u.x/a.width,u.y/a.height,u.width/a.width,u.height/a.height),h=new t.Rectangle(0,0,s,l).divide([c]),d=$(h,1)[0];i.width=s,i.height=l,r.drawImage(o,0,0,s,l);var p=r.getImageData(d.x,d.y,d.width,d.height);return i.width=d.width,i.height=d.height,r.putImageData(p,0,0),this.loadUrl(i.toDataURL(),!1)}},{key:"interactivelyChangeImageURL",value:function(){var e=H(regeneratorRuntime.mark(function _callee18(){var e;return regeneratorRuntime.wrap(function _callee18$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.world().prompt("Enter image url",{historyId:"lively.morphic-image-url-inputs",input:this.imageUrl.startsWith("data:")?"":this.imageUrl,requester:this});case 2:"string"==typeof(e=t.sent)&&(this.imageUrl=e);case 4:case"end":return t.stop()}},_callee18,this)}));return function Image_interactivelyChangeImageURL_(){return e.apply(this,arguments)}}()},{key:"menuItems",value:function Image_menuItems_(){var e=this,t=lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(i.prototype),"menuItems",this).call(this);return t.unshift(["change image url...",function(){return e.interactivelyChangeImageURL()}],["resize image to its real image size",function(){return e.extent=e.naturalExtent}],["resample image to fit current bounds",function(){return e.resampleImageToFitBounds()}],{isDivider:!0}),t}}],[{key:"properties",get:function get(){return{imageUrl:{isStyleProp:!0,after:["extent","autoResize"],defaultValue:System.decanonicalize("lively.morphic/lively-web-logo-small.svg"),set:function set(e){var t=this;this.isLoaded=!1,this.setProperty("imageUrl",e),this.setProperty("naturalExtent",null);var n=this.autoResize&&!this._isDeserializing;this.whenLoaded().then(function(){t.imageUrl===e&&(t.isLoaded=!0,n&&(t.extent=t.naturalExtent))})}},naturalExtent:{defaultValue:null},isLoaded:{defaultValue:!1,serialize:!1},autoResize:{defaultValue:!1}}}}],n,void 0,{start:86249,end:94854})}($t),Jt=function(e){var n=_classRecorder,r=n.hasOwnProperty("PathPoint")&&"function"==typeof n.PathPoint?n.PathPoint:n.PathPoint=function PathPoint(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(r,e,[{key:Symbol.for("lively-instance-initialize"),value:function PathPoint_initialize_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.path=e,this._isSmooth=t.isSmooth||!1,this.x=t.position?t.position.x:t.x||0,this.y=t.position?t.position.y:t.y||0,this._controlPoints=t.controlPoints,i.connect(this,"position",e,"makeDirty"),i.connect(this,"controlPoints",e,"makeDirty")}},{key:"isPathPoint",get:function get(){return!0}},{key:"isSmooth",get:function get(){return this._isSmooth||!1}},{key:"isSmooth",set:function set(e){this._isSmooth!==e&&(this._isSmooth=e,this.adaptControlPoints(e))}},{key:"position",get:function get(){return t.pt(this.x,this.y)}},{key:"position",set:function set(e){var t=e.x,n=e.y;this.x=t,this.y=n}},{key:"moveBy",value:function PathPoint_moveBy_(e){return this.position=this.position.addPt(e),this.path.onVertexChanged(this),this}},{key:"__serialize__",value:function PathPoint___serialize___(){return{__expr__:("({\n         position: "+this.position.toString(!1)+",\n         isSmooth: "+this.isSmooth+",\n         controlPoints: {\n           next: "+this.controlPoints.next.toString(!1)+",\n           previous: "+this.controlPoints.previous.toString(!1)+"\n         }\n      })").replace(/[\n|\s]/g,""),bindings:{"lively.graphics/geometry-2d.js":["pt"]}}}},{key:"controlPoints",get:function get(){return this._controlPoints||{next:t.pt(0,0),previous:t.pt(0,0)}}},{key:"controlPoints",set:function set(e){this._controlPoints=e}},{key:"moveNextControlPoint",value:function PathPoint_moveNextControlPoint_(e){this.moveControlPoint("next",e)}},{key:"movePreviousControlPoint",value:function PathPoint_movePreviousControlPoint_(e){this.moveControlPoint("previous",e)}},{key:"moveControlPoint",value:function PathPoint_moveControlPoint_(e,t){var n,r=(r=this.controlPoints[e])?r.addPt(t):t,i="next"==e?"previous":"next",o=this.controlPoints[i];this.isSmooth&&(o=r.negated().normalized().scaleBy(o.r())),this.controlPoints=(U(n={},e,r),U(n,i,o),n),this.path.onVertexChanged(this)}},{key:"pointOnLine",value:function PathPoint_pointOnLine_(e,n,r,i){var o=t.pt(e.x,e.y),a=t.pt(n.x,n.y),s=a.subPt(o),l=s.scaleBy(1/s.r()),u=a.subPt(r).dotProduct(l);return a.subPt(l.scaleBy(Math.max(1,Math.min(u,s.r())))).addXY(i,i)}},{key:"nextVertex",get:function get(){return this.path.vertexAfter(this)}},{key:"previousVertex",get:function get(){return this.path.vertexBefore(this)}},{key:"adaptControlPoints",value:function PathPoint_adaptControlPoints_(e){var n=this.nextVertex,r=this.previousVertex,i=this.position,o=this.path,a=o.vertices,s=a.indexOf(this),l=0===s,u=s===a.length-1,c=r?r.position:i,h=n?n.position:i;if(e){var d=this.pointOnLine(c,h,i,o.borderWidth);this.controlPoints={previous:l?t.pt(0,0):d.subPt(h),next:d.subPt(c)}}else this.controlPoints={previous:l?t.pt(0,0):c.subPt(i).scaleBy(.5),next:u?t.pt(0,0):h.subPt(i).scaleBy(.5)};o.onVertexChanged(this)}}],void 0,n,void 0,{start:94863,end:98143})}(void 0),Qt=function(e){var n=_classRecorder,i=n.hasOwnProperty("Path")&&"function"==typeof n.Path?n.Path:n.Path=function Path(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(i,e,[{key:Symbol.for("lively-instance-initialize"),value:function Path_initialize_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(i.prototype),Symbol.for("lively-instance-initialize"),this).call(this,Object.assign({},r.obj.dissoc(e,"origin"))),this.adjustOrigin(e.origin||this.origin),this.position=e.position||this.position,this.updateBounds(this.vertices)}},{key:"__after_deserialize__",value:function Path___after_deserialize___(e,t){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(i.prototype),"__after_deserialize__",this).call(this,e,t),this.updateBounds(this.vertices)}},{key:"isPath",get:function get(){return!0}},{key:"isSvgMorph",get:function get(){return!0}},{key:"onVertexChanged",value:function Path_onVertexChanged_(e){this.makeDirty(),this.updateBounds(this.vertices)}},{key:"copyVertices",value:function Path_copyVertices_(){return this.vertices.map(function(e){return{x:e.x,y:e.y,isSmooth:e.isSmooth,controlPoints:r.obj.deepCopy(e.controlPoints)}})}},{key:"updateBounds",value:function Path_updateBounds_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.vertices;if(e.length&&!this._adjustingVertices){this._adjustingVertices=!0;var n=this.origin,r=this.extent,i=r.x,o=r.y,a=n.x/i,s=n.y/o,l=[],u=!0,c=!1,h=void 0;try{for(var d,p=e[Symbol.iterator]();!(u=(d=p.next()).done);u=!0){var f=d.value,y=f.isSmooth,m=f.position,g=f.controlPoints||{},v=g.next,x=g.previous;l.push(m),y&&l.push(m.addPt(v),m.addPt(x))}}catch(e){c=!0,h=e}finally{try{!u&&p.return&&p.return()}finally{if(c)throw h}}var b=t.Rectangle.unionPts(l),w=t.pt(b.width*a,b.height*s),_=b.topLeft();e.forEach(function(e){return e.moveBy(_.negated())}),this.moveBy(this.getTransform().transformDirection(_)),this.extent=b.extent(),this.origin=w,this._adjustingVertices=!1}}},{key:"onChange",value:function Path_onChange_(e){var t=e.prop,n=e.value,r=e.prevValue,o=this._adjustingVertices,a=this._adjustingOrigin;"extent"==t&&n&&r&&!o&&this.adjustVertices(n.scaleByPt(r.inverted())),(!a&&"vertices"===t||"borderWidthLeft"===t)&&this.updateBounds("vertices"==t?n:this.vertices),o||"origin"!==t||this.updateBounds(this.vertices),lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(i.prototype),"onChange",this).call(this,e)}},{key:"vertexBefore",value:function Path_vertexBefore_(e){var t=this.vertices.indexOf(e)-1;return this.vertices[t>=0?t:this.vertices.length-1]}},{key:"vertexAfter",value:function Path_vertexAfter_(e){var t=this.vertices.indexOf(e)+1;return this.vertices[t>this.vertices.length-1?0:t]}},{key:"adjustVertices",value:function Path_adjustVertices_(e){var t=this,n=this.vertices;n&&n.forEach(function(n){var r=n.controlPoints,i=r.next,o=r.previous;i=i.scaleByPt(e),o=o.scaleByPt(e),n.position=n.position.addPt(t.origin).scaleByPt(e).subPt(t.origin),n.controlPoints={next:i,previous:o}})}},{key:"adjustOrigin",value:function Path_adjustOrigin_(e){this._adjustingOrigin=!0;var t=this.vertices,n=this.origin;t.forEach(function(t){return t.position=n.subPt(e).addXY(t.x,t.y)}),lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(i.prototype),"adjustOrigin",this).call(this,e),this._adjustingOrigin=!1}},{key:"addVertex",value:function Path_addVertex_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.vertices,r="number"==typeof t?t:t&&t.isPathPoint?n.indexOf(t):void 0;"number"==typeof r&&r>-1?n.splice(r,0,e):n.push(e),this.vertices=n}},{key:"addVertexCloseTo",value:function Path_addVertexCloseTo_(e){var t=this.verticesCloseTo(e),n=t.closest,r=n.length,i=n.vertex,o=t.next,a=this.findClosestPointOnPath(e,10,3),s=a.length,l=a.point,u=s<=r?i:o?o.vertex:null;return this.addVertex(l,u)}},{key:"render",value:function Path_render_(e){return e.renderPath(this)}},{key:"_pathNode",get:function get(){var e=this.env.renderer.getNodeForMorph(this);return e&&e.querySelector("#svg"+r.string.regExpEscape(this.id))}},{key:"verticesCloseTo",value:function Path_verticesCloseTo_(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.vertices,r=[],i=1/0,o=-1,a=0;a<n.length;a++){var s=n[a].position.dist(e);r.push(s),s>=i||(i=s,o=a)}var l=0===o?null:{index:o-1,vertex:n[o-1]},u=o===n.length-1?null:{index:o+1,vertex:n[o+1]},c={index:o,vertex:n[o]};if(t){var h=this._pathNode;if(l){var d=this.findClosestPointOnPath(l.vertex.position,6,3,h).length;l.length=d}if(u){var p=this.findClosestPointOnPath(u.vertex.position,6,3,h).length;u.length=p}var f=this.findClosestPointOnPath(c.vertex.position,6,3,h).length;c.length=f}return{previous:l,next:u,closest:c}}},{key:"findClosestPointOnPath",value:function Path_findClosestPointOnPath_(e,n,i,o){if(!o){var a=this.env.renderer.getNodeForMorph(this);o=a&&a.querySelector("#svg"+r.string.regExpEscape(this.id))}return o?function findClosestPointOnPath(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3;var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e.getTotalLength();var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;var l=function samplePathPoints(e,n,r,i){var o=[],a=(r-n)/(i-1),s=0;for(o.push([t.Point.ensure(e.getPointAtLength(n)),n,s]),s=1;s<i-1;s++){var l=n+s*a;o.push([t.Point.ensure(e.getPointAtLength(l)),l,s])}return o.push([t.Point.ensure(e.getPointAtLength(r)),r,s]),o}(e,a,o,r),u=1/0,c=-1;var h=!0;var d=!1;var p=void 0;try{for(var f,y=l[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var m=$(f.value,3),g=m[0],v=(m[1],m[2]),x=n.dist(g);x>=u||(u=x,c=v)}}catch(e){d=!0,p=e}finally{try{!h&&y.return&&y.return()}finally{if(d)throw p}}if(s>=i){var b=$(l[c],2),w=b[0],_=b[1];return{point:w,length:_}}o=l[Math.max(0,c-1)][1];a=l[Math.min(l.length-1,c+1)][1];return findClosestPointOnPath(e,n,r,i,o,a,s+1)}(o,e,n,i):{length:0,point:e}}},{key:"onDragStart",value:function Path_onDragStart_(e){var t=e.domEvt.target,n=r.Path("attributes.class.value").get(t);if(!n||!n.includes("path-point"))return lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(i.prototype),"onDragStart",this).call(this,e);var o=n.match(/path-point-([0-9]+)(?:-control-([0-9]+))?$/),a=$(o,3),s=(a[0],a[1]),l=a[2];this._controlPointDrag={marker:t,n:Number(s)},void 0!==l&&(this._controlPointDrag.ctrlN=Number(l))}},{key:"onDrag",value:function Path_onDrag_(e){if(!this._controlPointDrag)return lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(i.prototype),"onDrag",this).call(this,e);var t=this._controlPointDrag,n=(t.target,t.n),r=t.ctrlN,o=this.vertices,a=o[n];if(a){var s=this.getInverseTransform().transformDirection(e.state.dragDelta);if(void 0===r){a.moveBy(s);var l=o[n-1],u=o[n+1];l&&l.position.dist(a.position)<10?this._controlPointDrag.maybeMerge=[n-1,n]:u&&u.position.dist(a.position)<10?this._controlPointDrag.maybeMerge=[n,n+1]:this._controlPointDrag.maybeMerge=void 0}else 1===r?a.movePreviousControlPoint(s):2===r&&a.moveNextControlPoint(s)}}},{key:"onDragEnd",value:function Path_onDragEnd_(e){var t=this.vertices,n=this._controlPointDrag;if(n){var r=n.maybeMerge;if(delete this._controlPointDrag,r){var i=$(r,2),o=i[0],a=i[1],s=t[o],l=t[a];s.controlPoints.next=l.controlPoints.next,t.splice(a,1),this.vertices=t}}}},{key:"onMouseDown",value:function Path_onMouseDown_(e){2===e.state.clickCount&&this.addVertexCloseTo(this.localize(e.position))}},{key:"menuItems",value:function Path_menuItems_(){var e=this,t=Un.textAttribute("check-square-o"),n=Un.textAttribute("square-o");return n[1].paddingRight="7px",t[1].paddingRight="5px",[[[].concat(X(this.showControlPoints?t:n),[" control points"]),function(){return e.showControlPoints=!e.showControlPoints}],[[].concat(X(this.isSmooth?t:n),[" smooth"]),function(){return e.isSmooth=!e.isSmooth}],{isDivider:!0}].concat(X(lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(i.prototype),"menuItems",this).call(this)))}}],[{key:"properties",get:function get(){return{borderColor:{isStyleProp:!0,type:"ColorGradient",foldable:["top","left","right","bottom"],set:function set(e){e||(e=t.Color.white),(e.isColor||e.isGradient)&&(e={top:e,left:e,right:e,bottom:e}),this.setProperty("borderColor",r.obj.extract(e,["top","left","right","bottom"],function(e,n){return r.obj.isArray(n)?t.Color.fromTuple(n):n}))}},showControlPoints:{defaultValue:!1},vertices:{defaultValue:[],after:["isSmooth","borderWidth"],before:["extent","origin"],type:"Vertices",set:function set(e){var t=this,n=this.isSmooth;this._adjustingVertices=!0,e=e.map(function(e){return e.isPathPoint?Object.assign(e,{path:t}):new Jt(t,Object.assign({isSmooth:n},e))}),this.setProperty("vertices",e),this._adjustingVertices=!1,this.updateBounds(e)}},startMarker:{defaultValue:null,type:"Object"},endMarker:{defaultValue:null,type:"Object"},isSmooth:{defaultValue:!1,type:"Boolean",set:function set(e){this.setProperty("isSmooth",e),this.vertices&&(this._adjustingVertices=!0,this.vertices.forEach(function(t){return t.isSmooth=e}),this._adjustingVertices=!1,this.updateBounds(this.vertices))}}}}}],n,void 0,{start:98152,end:109849})}($t),Zt=function(e){var t=_classRecorder,n=t.hasOwnProperty("Polygon")&&"function"==typeof t.Polygon?t.Polygon:t.Polygon=function Polygon(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function Polygon_initialize_(e){if(!(e.vertices&&e.vertices.length>2))throw new Error("A polygon requires 3 or more vertices!");lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(n.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e)}},{key:"isPolygon",get:function get(){return!0}}],void 0,t,void 0,{start:109858,end:110112})}(Qt),en=function(e){var n=_classRecorder,r=n.hasOwnProperty("LineMorph")&&"function"==typeof n.LineMorph?n.LineMorph:n.LineMorph=function LineMorph(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(r,e,[{key:"isPolygon",get:function get(){return!0}},{key:"update",value:function LineMorph_update_(){if(!this._isUpdating){this._isUpdating=!0;var e=this.line,t=this.height,n=e.toVector();this.setProperty("position",this.position.addPt(e.perpendicularLine(0,t,"cc").toVector())),this.width=n.fastR(),this.rotation=n.theta(),this._isUpdating=!1}}}],[{key:"properties",get:function get(){return{borderWidth:{defaultValue:0},fill:{defaultValue:t.Color.black},height:{defaultValue:1},line:{defaultValue:t.Line.fromCoords(0,0,0,0),set:function set(e){this.setProperty("line",e),this.update()}},start:{derived:!0,after:["line"],get:function get(e){return this.line.start},set:function set(e){this.line=this.line.withStart(e)}},end:{derived:!0,after:["line"],get:function get(e){return this.line.end},set:function set(e){this.line=this.line.withEnd(e)}},position:{derived:!0,after:["line"],get:function get(e){return this.start},set:function set(e){var n=e.subPt(this.start);this.line=new t.Line(e,this.end.addPt(n))}}}}}],n,void 0,{start:110121,end:111463})}($t),tn=function(e){var t=_classRecorder,n=t.hasOwnProperty("TooltipViewer")&&"function"==typeof t.TooltipViewer?t.TooltipViewer:t.TooltipViewer=function TooltipViewer(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function TooltipViewer_initialize_(e){this.currentMorph=e}},{key:"__dont_serialialize__",get:function get(){return["currentTooltip","currentMorph"]}},{key:"notPartOfCurrentTooltip",value:function TooltipViewer_notPartOfCurrentTooltip_(e){return!e.ownerChain().includes(this.currentMorph)}},{key:"invalidatesCurrentTooltip",value:function TooltipViewer_invalidatesCurrentTooltip_(e){return e.tooltip||this.notPartOfCurrentTooltip(e)}},{key:"mouseMove",value:function TooltipViewer_mouseMove_(e){var t=e.targetMorph,n=e.hand;this.currentMorph!==t&&this.invalidatesCurrentTooltip(t)&&(this.hoverOutOfMorph(this.currentMorph),this.hoverIntoMorph(t,n),this.currentMorph=t)}},{key:"mouseDown",value:function TooltipViewer_mouseDown_(e){e.targetMorph;this.currentTooltip&&this.currentTooltip.remove(),this.currentTooltip=null}},{key:"hoverIntoMorph",value:function TooltipViewer_hoverIntoMorph_(e,t){this.clearScheduledTooltip(),this.currentTooltip?this.showTooltipFor(e,t):this.scheduleTooltipFor(e,t)}},{key:"hoverOutOfMorph",value:function TooltipViewer_hoverOutOfMorph_(e){var t=this;this.currentTooltip;this.currentTooltip&&this.currentTooltip.softRemove(function(e){return t.currentTooltip==e&&(t.currentTooltip=null)})}},{key:"scheduleTooltipFor",value:function TooltipViewer_scheduleTooltipFor_(e,t){var n=this;this.timer=setTimeout(function(){return n.showTooltipFor(e,t)},1e3*z.showTooltipsAfter)}},{key:"clearScheduledTooltip",value:function TooltipViewer_clearScheduledTooltip_(){clearTimeout(this.timer)}},{key:"showTooltipFor",value:function TooltipViewer_showTooltipFor_(e,t){if(e.tooltip&&e.world()){this.currentTooltip&&this.currentTooltip.remove();var n=t?t.position.addXY(10,7):e.globalBounds().bottomRight();this.currentTooltip=new nn({position:n,description:e.tooltip}),e.world().addMorph(this.currentTooltip)}}}],void 0,t,void 0,{start:130,end:1919})}(void 0),nn=function(e){var n=_classRecorder,r=n.hasOwnProperty("Tooltip")&&"function"==typeof n.Tooltip?n.Tooltip:n.Tooltip=function Tooltip(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(r,e,[{key:"softRemove",value:function(){var e=H(regeneratorRuntime.mark(function _callee(e){return regeneratorRuntime.wrap(function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.animate({opacity:0});case 2:e&&e(this),this.remove();case 4:case"end":return t.stop()}},_callee,this)}));return function Tooltip_softRemove_(t){return e.apply(this,arguments)}}()}],[{key:"styleSheet",get:function get(){return new Ir({".Tooltip":{draggable:!1,fill:t.Color.black.withA(.5),borderRadius:4,fontColor:t.Color.white,layout:new Mr({spacing:5})},".Tooltip .Label":{fontColor:t.Color.white}})}},{key:"properties",get:function get(){return{description:{after:["submorphs"],derived:!0,get:function get(){return $(this.submorphs,1)[0].value},set:function set(e){var t=$(this.submorphs,1)[0];t.fixedWidth=e.length>40,t.value=e}},submorphs:{initialize:function initialize(){this.submorphs=[new Gn({width:200})]}}}}}],n,void 0,{start:1928,end:3019})}($t),rn=function(){var e=H(regeneratorRuntime.mark(function _callee(e,t,n){var r;return regeneratorRuntime.wrap(function _callee$(n){for(;;)switch(n.prev=n.next){case 0:if(!t.startsWith("image/")){n.next=5;break}return n.next=3,fileReadAsDataURL(e);case 3:return r=n.sent,n.abrupt("return",new a.Image({imageUrl:r,autoResize:!0,name:e.name}));case 5:return n.abrupt("return",null);case 6:case"end":return n.stop()}},_callee,this)}));return function uploadFile(t,n,r){return e.apply(this,arguments)}}();function fileReadAsDataURL(e){return new Promise(function(t,n){var r=new FileReader;r.onload=function(e){return t(e.target.result)},r.readAsDataURL(e)})}var on,an,sn,ln,un,cn,hn,dn,pn,fn,yn,mn,gn,vn,xn,bn,wn,_n,kn,Sn,Mn,Cn,Pn,Tn=void 0,An=[{name:"undo",exec:function exec(e){return(!e.focusedMorph||e.focusedMorph===e||!e.focusedMorph.undoManager)&&(e.env.undoManager.undo(),!0)}},{name:"redo",exec:function exec(e){return(!e.focusedMorph||e.focusedMorph===e||!e.focusedMorph.undoManager)&&(e.env.undoManager.redo(),!0)}},{name:"run command",handlesCount:!0,exec:function(){var e=H(regeneratorRuntime.mark(function _callee(e,n,r){var i,o,a,s,l,u;return regeneratorRuntime.wrap(function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return i=e.focusedMorph||e,o=ht.generateCommandToKeybindingMap(i,!0).map(function(e){var t=e.prettyKeys,n=e.target,r=e.command.name;return{isListItem:!0,value:e,label:[""+n.constructor.name,{fontSize:"80%",textStyleClasses:["v-center-text"],paddingRight:"10px"},""+r,null],annotation:[t?t.join(", "):"",{fontSize:"80%",textStyleClasses:["truncated-text"],maxWidth:140}]}}),c.next=3,e.filterableListPrompt("Run command",o,{historyId:"lively.morphic-run command",extent:t.pt(700,900),prompt:e._cachedRunCommandPrompt});case 3:return a=c.sent,s=a.prompt,l=$(a.selected,1),u=l[0],e._cachedRunCommandPrompt=s,c.abrupt("return",!u||u.target.execCommand(u.command,n,r));case 9:case"end":return c.stop()}},_callee,Tn)}));return function exec(t,n,r){return e.apply(this,arguments)}}()},{name:"show command history",exec:function exec(e,t){var n=e.commandHandler,i=r.arr.sortBy(n.history,function(e){return-e.time}).map(function(e){return{isListItem:!0,string:n.printCommand(e),value:e}});return $world.editListPrompt("select commands",i,{multiSelect:!0}),!0}},{name:"show halo for focused morph",exec:function exec(e){var t=e.focusedMorph;return e.showHaloFor(t.getWindow()||t,e.firstHand.pointerId),!0}},{name:"copy morph",exec:function exec(e){var t=e.focusedMorph;if(!t||t===e)return $world.setStatusMessage("no morph selected"),!0;var n=t.getWindow()||t,r=n.copy();return r.openInWorld(n.globalPosition.addXY(10,10)),r.isWindow&&r.activate(),r}},{name:"select morph",exec:function(){var e=H(regeneratorRuntime.mark(function _callee2(e){var t,n,i,o,a,s,l,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{root:e,justReturn:!1,filterFn:null,prependItems:[],prompt:null};return regeneratorRuntime.wrap(function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return t=u.filterFn||function(){return!0},n=0,i=r.arr.compact(r.tree.map(u.root||e,function(e,r){return t(e)?{isListItem:!0,label:[""+String(++n)+"".repeat(r),{fontSize:"80%",textStyleClasses:["v-center-text"],paddingRight:"10px"},""+e,null],value:e}:null},function(e){return t(e)?e.submorphs:[]})),o=["show halo","open object editor","open object inspector"],c.next=6,e.filterableListPrompt(u.prompt||"Choose morph",(u.prependItems||[]).concat(i),{historyId:"lively.morphic-select morph",onSelection:function onSelection(e){return e&&e.show&&e.show()},selectedAction:"show halo",actions:o});case 6:if(a=c.sent,s=a.selected,l=a.action,!u.justReturn){c.next=11;break}return c.abrupt("return",s);case 11:return s.forEach(function(t){l===o[0]?e.showHaloFor(t):l===o[1]?e.execCommand("open object editor",{target:t}):l===o[2]&&e.execCommand("open object inspector",{target:t})}),c.abrupt("return",s);case 13:case"end":return c.stop()}},_callee2,Tn)}));return function exec(t,n){return e.apply(this,arguments)}}()},{name:"escape",exec:function exec(e,t,n,i){var o=e.env.eventDispatcher.eventState;o.menu&&o.menu.remove();var a=e.halos();a.forEach(function(e){return e.remove()}),e.hands.forEach(function(e){return e.cancelGrab(!0,i)});var s=r.arr.last(a)&&r.arr.last(a).target||e.focusedMorph||e;return s.focus(),s.isText&&s.selection.disableMultiSelect&&s.selection.disableMultiSelect(),!1}},{name:"move or resize halo target",exec:function exec(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{direction:"left",offset:1,what:"move"},n=e.halos()[0];if(!n||n.changingName)return!1;var r=t.direction,i=t.offset,o=t.what,a=n.target;switch(i=i||1,r){case"left":a["move"===o?"left":"width"]-=i;break;case"right":a["move"===o?"left":"width"]+=i;break;case"up":a["move"===o?"top":"height"]-=i;break;case"down":a["move"===o?"top":"height"]+=i}return n.alignWithTarget(),!0}},{name:"resize to fit window",exec:function exec(e){return delete e._cachedWindowBounds,e.extent=e.windowBounds().union(e.submorphBounds()).extent(),!0}},{name:"resize manually",exec:function(){var e=H(regeneratorRuntime.mark(function _callee3(e){var n,r,i,o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function _callee3$(s){for(;;)switch(s.prev=s.next){case 0:if(n=void 0,r=void 0,i=e.windowBounds(),o=e.bounds(),s.t0=a.width,s.t0){s.next=6;break}return s.next=5,e.prompt("Enter world width",{input:Math.max(o.width,i.width)});case 5:s.t0=s.sent;case 6:if(s.t1=s.t0,"number"!=typeof(n=Number(s.t1))){s.next=16;break}if(s.t2=a.height,s.t2){s.next=14;break}return s.next=13,e.prompt("Enter world height",{input:Math.max(o.height,i.height)});case 13:s.t2=s.sent;case 14:s.t3=s.t2,r=Number(s.t3);case 16:return"number"!=typeof n||isNaN(n)||"number"!=typeof r||isNaN(r)||(e.extent=t.pt(n,r)),s.abrupt("return",!0);case 18:case"end":return s.stop()}},_callee3,Tn)}));return function exec(t,n){return e.apply(this,arguments)}}()},{name:"resize windows to fit visible world bounds",exec:function exec(e){var n=e.getWindows().filter(function(e){return!e.minimized});if(!n.length)return!0;var r=e.visibleBounds(),i=n.reduce(function(e,t){return t.bounds().union(e)},new t.Rectangle(0,0,0,0)),o=r.width/i.width,a=r.height/i.height;return n.forEach(function(e){var n=e.bounds(),r=n.x,i=n.y,s=n.width,l=n.height;e.setBounds(new t.Rectangle(r*o,i*a,s*o,l*a))}),!0}},{name:"window switcher",exec:function(){var e=H(regeneratorRuntime.mark(function _callee4(e){var n,r,i,o,a;return regeneratorRuntime.wrap(function _callee4$(s){for(;;)switch(s.prev=s.next){case 0:if(!(n=e.activePrompt())||"lively.morphic-window switcher"!==n.historyId){s.next=4;break}return n.focus(),s.abrupt("return",n.get("list").execCommand("select down"));case 4:return r=e.submorphs.filter(function(e){return e.isWindow}).reverse().map(function(e){return{isListItem:!0,string:e.title||String(e),value:e}}),s.next=7,e.filterableListPrompt("Choose window",r,{preselect:1,historyId:"lively.morphic-window switcher",onSelection:function onSelection(e){return e&&e.show()},width:1*e.visibleBounds().extent().x/3,itemPadding:t.Rectangle.inset(4)});case 7:return i=s.sent,o=$(i.selected,1),(a=o[0])&&a.activate(),s.abrupt("return",!0);case 12:case"end":return s.stop()}},_callee4,Tn)}));return function exec(t){return e.apply(this,arguments)}}()},{name:"close active window or morph",exec:function exec(e){var t=e.focusedMorph;if(!t)return!0;var n=t.getWindow();(e.undoStart("window close"),n)?n.close():(r.arr.last(r.arr.without(t.ownerChain(),e)).remove(),(n=e.activeWindow())&&n.activate());return e.undoStop("window close"),!0}},{name:"toggle minimize active window",exec:function exec(e){var t=e.activeWindow();return t&&t.toggleMinimize(),!0}},{name:"open status message of focused morph",exec:function exec(e){var t=e.focusedMorph,n=t?e.visibleStatusMessagesFor(t):[],r=$(n,1)[0];return r&&(r.expand(),r.focus()),r||!0}},{name:"resize active window",exec:function(){var e=H(regeneratorRuntime.mark(function _callee6(e){var n,r,i,o,a,s,l,u,c,h,d=(n=H(regeneratorRuntime.mark(function _callee5(){var t,n,r;return regeneratorRuntime.wrap(function _callee5$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,e.filterableListPrompt("How to resize the window?",["full","fullscreen","center","right","left","bottom","top","shrinkWidth","growWidth","shrinkHeight","growHeight","col1","col2","col3","col4","col5","reset"]);case 2:return t=i.sent,n=$(t.selected,1),r=n[0],i.abrupt("return",r);case 6:case"end":return i.stop()}},_callee5,this)})),function askForHow(){return n.apply(this,arguments)}),p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{how:null,window:null};return regeneratorRuntime.wrap(function _callee6$(n){for(;;)switch(n.prev=n.next){case 0:if(h=function resizeBounds(e,n){switch(e){case"full":case"fullscreen":return a;case"col1":case"left":return c.withTopLeft(a.topLeft());case"col2":return c.withTopLeft(a.topCenter().scaleByPt(t.pt(.333,1))).withWidth(u);case"col3":case"center":return c.withCenter(a.center());case"col4":return c.translatedBy(a.topCenter().withY(0));case"col5":case"right":return c.translatedBy(t.pt(a.width-u,0));case"top":return a.divide([t.rect(0,0,1,.5)])[0];case"bottom":return a.divide([t.rect(0,.5,1,.5)])[0];case"halftop":return n.withY(a.top()).withHeight(n.height/2);case"halfbottom":return n.withHeight(a.height/2).withY(a.top()+a.height/2);case"reset":return o.normalBounds||t.pt(500,400).extentAsRectangle().withCenter(n.center());case"quadrant1":return resizeBounds("halftop",resizeBounds("col1",n));case"quadrant2":return resizeBounds("halftop",resizeBounds("col2",n));case"quadrant3":return resizeBounds("halftop",resizeBounds("col3",n));case"quadrant4":return resizeBounds("halftop",resizeBounds("col4",n));case"quadrant5":return resizeBounds("halftop",resizeBounds("col5",n));case"quadrant6":return resizeBounds("halfbottom",resizeBounds("col1",n));case"quadrant7":return resizeBounds("halfbottom",resizeBounds("col2",n));case"quadrant8":return resizeBounds("halfbottom",resizeBounds("col3",n));case"quadrant9":return resizeBounds("halfbottom",resizeBounds("col4",n));case"quadrant0":return resizeBounds("halfbottom",resizeBounds("col5",n));default:return n}},r=p.window,i=p.how,o=r||e.activeWindow()){n.next=6;break}return n.abrupt("return");case 6:if(a=e.visibleBounds().insetBy(20),s=o.bounds(),o._normalBounds||(o._normalBounds=s),l=700,u=Math.min(l,Math.max(1e3,a.width/3)),c=a.withWidth(u),i){n.next=13;break}return n.next=12,d();case 12:i=n.sent;case 13:if(i){n.next=15;break}return n.abrupt("return");case 15:return"reset"===i&&delete o.normalBounds,o.setBounds(h(i,i.startsWith("half")?s:a)),n.abrupt("return",!0);case 18:case"end":return n.stop()}},_callee6,this)}));return function exec(t,n){return e.apply(this,arguments)}}()},{name:"[recovery] show last object editor saves",exec:function exec(e,t){return e.execCommand("[recovery] show last doits",Object.assign({},t,{title:"logged ObjectEditor save",logAccessFn:function logAccessFn(){return JSON.parse(localStorage["oe helper"]).saves}}))}},{name:"[recovery] show last doits",description:"browse a list of your last doits",exec:(Pn=H(regeneratorRuntime.mark(function _callee7(e){var t,n,i,o,a,s,l,u,c,h,d,p,f,y,m,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function _callee7$(v){for(;;)switch(v.prev=v.next){case 0:(t=g.logAccessFn)||(t=function logAccessFn(){return JSON.parse(localStorage["lively.next-js-ide-doitlog"])}),n=void 0;try{n=t()}catch(e){}if(n){v.next=7;break}return v.abrupt("return",e.inform("no log yet"));case 7:return i=r.arr.sortBy(n.map(function(e,t){var n="string"==typeof e?e:e.source,i="string"==typeof e?t:e.time||t;return{time:i,source:n,printedTime:r.date.format(new Date(i),"yy-mm-dd HH:MM")}}),function(e){return-e.time}),o=i.map(function(e,t){return{isListItem:!0,string:"["+e.printedTime+"] "+e.source.slice(0,100).replace(/\n/g,"").trim(),value:e}}),v.next=11,e.filterableListPrompt("select doit code",o,{multiSelect:!0});case 11:if(a=v.sent,!(s=a.selected).length){v.next=35;break}for(l=[],u=!0,c=!1,h=void 0,v.prev=18,d=s[Symbol.iterator]();!(u=(p=d.next()).done);u=!0)f=p.value,y=f.source,m=f.printedTime,l.push("// "+m+"\n"+y);v.next=26;break;case 22:v.prev=22,v.t0=v.catch(18),c=!0,h=v.t0;case 26:v.prev=26,v.prev=27,!u&&d.return&&d.return();case 29:if(v.prev=29,!c){v.next=32;break}throw h;case 32:return v.finish(29);case 33:return v.finish(26);case 34:return v.abrupt("return",e.execCommand("open workspace",Object.assign({title:"logged doits",mode:"js"},g,{content:l.join("\n\n")})));case 35:return v.abrupt("return",!0);case 36:case"end":return v.stop()}},_callee7,Tn,[[18,22,26,34],[27,,29,33]])})),function exec(e,t){return Pn.apply(this,arguments)})},{name:"open workspace",exec:function(){var e=H(regeneratorRuntime.mark(function _callee8(e){var t,n,r,i,o,a,s,l,u,c,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=(arguments[2],arguments[3]);return regeneratorRuntime.wrap(function _callee8$(p){for(;;)switch(p.prev=p.next){case 0:if(!(t=d&&e.relayCommandExecutionToFocusedMorph(d))){p.next=3;break}return p.abrupt("return",t);case 3:if(n=h.language||h.mode||"javascript",r={javascript:"lively.ide/js/workspace.js",shell:"lively.ide/shell/workspace.js",html:"lively.ide/html/workspace.js",py:"lively.ide/py/workspace.js",md:"lively.ide/md/workspace.js",sql:"lively.ide/sql/workspace.js",text:null},i=Object.keys(z.ide.modes.aliases).reduce(function(e,t){return Object.assign(e,U({},z.ide.modes.aliases[t],t))},{}),!h.askForMode){p.next=13;break}return o=Object.keys(r).concat("javascript console"),p.next=8,e.filterableListPrompt("Open workspace for...",o);case 8:if(a=p.sent,s=$(a.selected,1),n=s[0]){p.next=13;break}return p.abrupt("return",!0);case 13:if("javascript console"!==n){p.next=15;break}return p.abrupt("return",e.execCommand("open console",h));case 15:if(h=Object.assign({content:""},h,{mode:n,language:n}),l=r[h.language]||r[i[h.language]],"text"!==n&&l){p.next=19;break}return p.abrupt("return",e.execCommand("open text window",Object.assign({},z.codeEditor.modes.text,{},h)));case 19:return p.next=21,System.import(l);case 21:return u=p.sent,c=u.default,p.abrupt("return",new c({title:h.title||h.language+" workspace",center:e.center,content:h.content,target:h.target,systemInterface:h.systemInterface||h.backend}).activate());case 24:case"end":return p.stop()}},_callee8,Tn)}));return function exec(t,n,r,i){return e.apply(this,arguments)}}()},{name:"open console",exec:(Cn=H(regeneratorRuntime.mark(function _callee9(e){var t;arguments.length>1&&void 0!==arguments[1]&&arguments[1];return regeneratorRuntime.wrap(function _callee9$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,wt("Console");case 2:return t=e.sent,e.abrupt("return",t.openInWorldNearHand());case 4:case"end":return e.stop()}},_callee9,Tn)})),function exec(e,t){return Cn.apply(this,arguments)})},{name:"open shell workspace",exec:function exec(e,t){return e.execCommand("open workspace",Object.assign({},t,{language:"shell"}))}},{name:"open shell terminal",exec:(Mn=H(regeneratorRuntime.mark(function _callee10(e,t){var n,r;return regeneratorRuntime.wrap(function _callee10$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,System.import("lively.ide/shell/terminal.js");case 2:return n=e.sent,r=n.default,e.abrupt("return",r.open(t).openInWorldNearHand());case 5:case"end":return e.stop()}},_callee10,Tn)})),function exec(e,t){return Mn.apply(this,arguments)})},{name:"open text window",exec:function exec(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.title,o=n.extent,a=n.content,s=n.mode,l=n.name,u=n.rangesAndStyles;i=i||"text window",a=a||"",o=o||t.pt(500,400),l=l||"text workspace";var c="string"==typeof a?[a,null]:a,h=new dr(Object.assign({padding:t.Rectangle.inset(3)},r.obj.dissoc(n,["title","content"]),{textAndAttributes:c,clipMode:"auto",name:l,extent:o}));return u&&h.setTextAttributesWithSortedRanges(u),s&&h.changeEditorMode(s),e.openInWindow(h,{title:i}).activate()}},{name:"merge and open in window",exec:(Sn=H(regeneratorRuntime.mark(function _callee11(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{a:"",b:"",format:null,extent:t.pt(500,600)};return regeneratorRuntime.wrap(function _callee11$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,wt("text merger");case 2:return n=e.sent,e.abrupt("return",n.targetMorph.open(r.a,r.b,r));case 4:case"end":return e.stop()}},_callee11,Tn)})),function exec(e,t){return Sn.apply(this,arguments)})},{name:"diff and open in window",exec:(kn=H(regeneratorRuntime.mark(function _callee13(e){var n,i,o,a,s,l,u,c,h,d=(n=H(regeneratorRuntime.mark(function _callee12(n,i,o){var a,l,h,d,p,f,y,m,g,v,x,b;return regeneratorRuntime.wrap(function _callee12$(w){for(;;)switch(w.prev=w.next){case 0:if(a=o.format,l=null,"patch"!==a){w.next=16;break}return d=o.headerA,p=o.headerB,f=o.filenameA,y=o.filenameB,m=o.context,h=[u.createTwoFilesPatch(f||"a",y||"b",n,i,d,p,"number"==typeof m?{context:m}:void 0),{}],w.next=11,System.import("lively.ide/diff/editor-plugin.js");case 11:g=w.sent,v=g.default,l=new v,w.next=18;break;case 16:c=u[a](n,i,o),h=r.arr.flatmap(c,function(e){e.count;var n=e.value,r=e.added;return[n,e.removed?{fontWeight:"normal",textDecoration:"line-through",fontColor:t.Color.red}:r?{fontWeight:"bold",textDecoration:"",fontColor:t.Color.green}:{fontWeight:"normal",textDecoration:"",fontColor:t.Color.darkGray}]});case 18:return x=e.execCommand("open text window",o),b=x.targetMorph,x.extent=s||t.pt(300,200).maxPt(b.textBounds().extent()),b.textAndAttributes=h,l&&b.addPlugin(l),w.abrupt("return",b);case 23:case"end":return w.stop()}},_callee12,this)})),function diffInWindow(e,t,r){return n.apply(this,arguments)}),p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{a:"",b:"",format:null,extent:t.pt(500,600)};return regeneratorRuntime.wrap(function _callee13$(e){for(;;)switch(e.prev=e.next){case 0:return h=function findFormat(e,t){if((r.obj.isPrimitive(e)||e instanceof RegExp||r.obj.isPrimitive(t)||t instanceof RegExp)&&(e=String(e),t=String(t)),"string"!=typeof e||"string"!=typeof t)try{return JSON.stringify(e),JSON.stringify(t),{format:"diffJson",a:e,b:t}}catch(n){e=String(e),t=String(t)}return{format:"diffLines",a:e,b:t}},i=p.a,o=p.b,a=p.format,s=p.extent,a?(i=String(i),o=String(o)):(l=h(i,o),i=l.a,o=l.b,a=l.format),e.next=8,System.import("jsdiff",System.decanonicalize("lively.morphic"));case 8:return u=e.sent,e.next=11,d(i,o,Object.assign({fontFamily:"monospace"},p,{format:a}));case 11:return c=e.sent,e.abrupt("return",c);case 13:case"end":return e.stop()}},_callee13,Tn)})),function exec(e,t){return kn.apply(this,arguments)})},{name:"merge workspaces",exec:function exec(e,t){return e.execCommand("diff workspace",Object.assign({},t,{merge:!0}))}},{name:"diff workspaces",exec:function(){var e=H(regeneratorRuntime.mark(function _callee16(e){var t,n,i,o,a,s,l,u=(t=H(regeneratorRuntime.mark(function _callee14(e,t){var n;return regeneratorRuntime.wrap(function _callee14$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,wt("text merger");case 2:return n=r.sent,r.abrupt("return",n.targetMorph.open(e.textString,t.textString));case 4:case"end":return r.stop()}},_callee14,this)})),function doMerge(e,n){return t.apply(this,arguments)}),c=(n=H(regeneratorRuntime.mark(function _callee15(t,n){var r,i,o,a;return regeneratorRuntime.wrap(function _callee15$(n){for(;;)switch(n.prev=n.next){case 0:return r=t.map(function(e){return{isListItem:!0,value:e,string:e.name||String(e)}}),n.next=3,e.filterableListPrompt("choose text: ",r,{onSelection:function onSelection(e){return e&&e.show()}});case 3:return i=n.sent,o=$(i.selected,1),a=o[0],n.abrupt("return",a);case 7:case"end":return n.stop()}},_callee15,this)})),function selectMorph(e,t){return n.apply(this,arguments)}),h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function _callee16$(t){for(;;)switch(t.prev=t.next){case 0:if(l=function doDiff(t,n){var r=t.pluginFind(function(e){return e.evalEnvironment}),i=r&&r.evalEnvironment.targetModule||"no file",o=n.pluginFind(function(e){return e.evalEnvironment}),a=o&&o.evalEnvironment.targetModule||"no file";return e.execCommand("diff and open in window",{a:t.textString,b:n.textString,filenameA:i,filenameB:a})},i=h.editor1,o=h.editor2,a=h.merge,i&&o||(s=e.withAllSubmorphsSelect(function(e){return e.isText&&!e.isInputLine&&!e.isUsedAsEpiMorph()}).reverse()),i){t.next=9;break}return t.next=8,c(s);case 8:i=t.sent;case 9:if(i){t.next=11;break}return t.abrupt("return",e.setStatusMessage("Canceled"));case 11:if(o){t.next=15;break}return t.next=14,c(r.arr.without(s,i));case 14:o=t.sent;case 15:if(o){t.next=17;break}return t.abrupt("return",e.setStatusMessage("Canceled"));case 17:return t.abrupt("return",a?u(i,o):l(i,o));case 18:case"end":return t.stop()}},_callee16,this)}));return function exec(t,n){return e.apply(this,arguments)}}()},{name:"search workspaces",exec:function(){var e=H(regeneratorRuntime.mark(function _callee17(){var e,t,n,r,i,o,a,s;return regeneratorRuntime.wrap(function _callee17$(l){for(;;)switch(l.prev=l.next){case 0:return s=function findWindowOrMorphWithStrings(e){return $world.withAllSubmorphsDo(function(t){if(t.isWindow&&t.minimized&&t.targetMorph&&t.targetMorph.isText&&(t=t.targetMorph),!t.textString)return null;if(!t.isText)return null;if(t.isUsedAsEpiMorph())return null;var n=t.textString.toLowerCase();return e.every(function(e){return n.includes(e)})?t:null}).filter(Boolean)},a=function morphsToCandidates(e,t){return e.map(function(e){var n=e.world()?e.getWindow():$world.withAllSubmorphsDetect(function(e){return e.isWindow&&e.targetMorph===morph}),r=0,i=lively.lang.string.lines(e.textString).find(function(e,n){return e=e.toLowerCase(),r=n,t.every(function(t){return e.includes(t)})}),o=n?n.title:e.toString();return i?{isListItem:!0,string:o+" | "+i,value:{window:n,morph:e,row:r}}:null}).filter(Boolean)},l.next=4,$world.filterableListPrompt("search workspaces",[],{historyId:"lively.morphic-ide-search-workspaces-hist",customize:function customize(e){e.getSubmorphNamed("list").updateFilter=function(){var e=this.parseInput();if(!(e.input.length<3)){var t=s(e.lowercasedTokens);this.listMorph.items=a(t,e.lowercasedTokens)}}}});case 4:if(e=l.sent,t=$(e.selected,1),!(n=t[0])){l.next=15;break}return r=n.morph,i=n.window,o=n.row,i&&(i.minimized&&i.toggleMinimize(),i.activate()),(i||r).show(),this.cursorPosition={row:o,column:0},l.abrupt("return",r);case 15:return l.abrupt("return",null);case 16:case"end":return l.stop()}},_callee17,this)}));return function exec(){return e.apply(this,arguments)}}()},{name:"open PartsBin",exec:function(){var e=H(regeneratorRuntime.mark(function _callee18(e){var t,n,r;return regeneratorRuntime.wrap(function _callee18$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,System.import("lively.morphic/partsbin.js");case 2:return t=e.sent,n=t.loadPart,e.next=6,n("PartsBin");case 6:return(r=e.sent).openInWorldNearHand(),r.targetMorph.selectedCategory="*basics*",r.targetMorph.update(),r.focus(),e.abrupt("return",r);case 12:case"end":return e.stop()}},_callee18,this)}));return function exec(t){return e.apply(this,arguments)}}()},{name:"load object from PartsBin",exec:function(){var e=H(regeneratorRuntime.mark(function _callee19(e){var t,n,r,i,o,a,s,l,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function _callee19$(e){for(;;)switch(e.prev=e.next){case 0:if(t=void 0,n=u.name,r=u.open,i=void 0===r||r,!n){e.next=14;break}return e.next=7,System.import("lively.morphic/partsbin.js");case 7:return o=e.sent,a=o.loadObjectFromPartsbinFolder,e.next=11,a(n);case 11:t=e.sent,e.next=21;break;case 14:return e.next=16,System.import("lively.morphic/partsbin.js");case 16:return s=e.sent,l=s.interactivelyLoadObjectFromPartsBinFolder,e.next=20,l();case 20:t=e.sent;case 21:return t&&i&&t.openInWorldNearHand(),e.abrupt("return",t);case 23:case"end":return e.stop()}},_callee19,this)}));return function exec(t,n){return e.apply(this,arguments)}}()},{name:"open object drawer",exec:function(){var e=H(regeneratorRuntime.mark(function _callee20(e){var t,n;return regeneratorRuntime.wrap(function _callee20$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,System.import("lively.components/object-drawer.js");case 2:return t=e.sent,n=t.default,e.abrupt("return",(new n).openInWorldNearHand());case 5:case"end":return e.stop()}},_callee20,this)}));return function exec(t){return e.apply(this,arguments)}}()},{name:"open object editor",exec:function(){var e=H(regeneratorRuntime.mark(function _callee21(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{target:null,selectedClass:null,selectedMethod:null};return regeneratorRuntime.wrap(function _callee21$(i){for(;;)switch(i.prev=i.next){case 0:if(r.target){i.next=3;break}return e.setStatusMessage("no target for ObjectEditor"),i.abrupt("return",null);case 3:return i.next=5,System.import("lively.ide/js/objecteditor/index.js");case 5:return t=i.sent,n=t.ObjectEditor,r.target,r.className,r.methodName,i.next=12,n.open(r);case 12:return i.abrupt("return",i.sent);case 13:case"end":return i.stop()}},_callee21,this)}));return function exec(t,n){return e.apply(this,arguments)}}()},{name:"open object inspector",exec:(_n=H(regeneratorRuntime.mark(function _callee22(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{target:null};return regeneratorRuntime.wrap(function _callee22$(r){for(;;)switch(r.prev=r.next){case 0:if(n.target){r.next=3;break}return t.setStatusMessage("no target for Inspector"),r.abrupt("return",null);case 3:return r.abrupt("return",e.inspect(n.target));case 4:case"end":return r.stop()}},_callee22,Tn)})),function exec(e,t){return _n.apply(this,arguments)})},{name:"open scene graph inspector",exec:(wn=H(regeneratorRuntime.mark(function _callee23(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{target:null};return regeneratorRuntime.wrap(function _callee23$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,wt("scene graph inspector");case 2:return(t=r.sent).targetMorph=n.target||e,r.abrupt("return",t.openInWindow({title:"morph graph"}));case 5:case"end":return r.stop()}},_callee23,Tn)})),function exec(e,t){return wn.apply(this,arguments)})},{name:"open browser",progressIndicator:"opening browser...",exec:(bn=H(regeneratorRuntime.mark(function _callee24(e){var n,i,o,a,s,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{packageName:"lively.morphic",moduleName:"morph.js"},u=(arguments[2],arguments[3]);return regeneratorRuntime.wrap(function _callee24$(c){for(;;)switch(c.prev=c.next){case 0:if(!(n=u&&e.relayCommandExecutionToFocusedMorph(u))){c.next=3;break}return c.abrupt("return",n);case 3:return c.next=5,System.import("lively.ide/js/browser/index.js");case 5:return i=c.sent,o=i.default,a=r.obj.select(l,["packageName","moduleName","textPosition","codeEntity","systemInterface"]),c.next=10,o.browse(a,{extent:t.pt(700,600)});case 10:return(s=c.sent).getWindow().activate(),c.abrupt("return",s);case 13:case"end":return c.stop()}},_callee24,Tn)})),function exec(e,t,n,r){return bn.apply(this,arguments)})},{name:"choose and browse package resources",progressIndicator:"browsing resources...",exec:(xn=H(regeneratorRuntime.mark(function _callee25(e){var t,n,i,o,a,s,l,u,c,h,d,p,f,y,m,g,v,x,b,w,_,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{browser:null,systemInterface:null},S=(arguments[2],arguments[3]);return regeneratorRuntime.wrap(function _callee25$(M){for(;;)switch(M.prev=M.next){case 0:if(!(t=S&&e.relayCommandExecutionToFocusedMorph(S))){M.next=3;break}return M.abrupt("return",t);case 3:return n=(n=k.browser||e.focusedMorph&&e.focusedMorph.ownerChain().find(function(e){return e.isBrowser}))&&n.isBrowser?n.getWindow():null,M.next=7,System.import("lively-system-interface");case 7:return i=M.sent,o=i.localInterface,a=k&&k.systemInterface?k.systemInterface:n?n.systemInterface:o,M.next=12,a.getPackages({excluded:z.ide.js.ignoredPackages});case 12:s=M.sent,l=[],u=!0,c=!1,h=void 0,M.prev=17,d=regeneratorRuntime.mark(function _loop(){var e,t;return regeneratorRuntime.wrap(function _loop$(n){for(;;)switch(n.prev=n.next){case 0:return e=f.value,(t=(r.Path("lively.ide.exclude").get(e)||[]).map(function(e){return e.includes("*")?new RegExp(e.replace(/\*/g,".*")):e})).push(".git","node_modules",".module_cache"),n.t0=l.push,n.t1=l,n.t2=Y,n.next=8,a.resourcesOfPackage(e,t);case 8:n.t3=function(e){var n=e.url;return!n.endsWith("/")&&!t.some(function(e){return e instanceof RegExp?e.test(n):n.includes(e)})},n.t4=function(e,t){return e.isLoaded&&!t.isLoaded?-1:!e.isLoaded&&t.isLoaded?1:e.nameInPackage.toLowerCase()<t.nameInPackage.toLowerCase()?-1:e.nameInPackage.toLowerCase()==t.nameInPackage.toLowerCase()?0:1},n.t5=function(t){return{isListItem:!0,string:"["+e.name+"] "+t.nameInPackage+(t.isLoaded?"":" [not loaded]"),value:t}},n.t6=n.sent.filter(n.t3).sort(n.t4).map(n.t5),n.t7=n.t2.toConsumableArray.call(n.t2,n.t6),n.t0.apply.call(n.t0,n.t1,n.t7);case 14:case"end":return n.stop()}},_loop,Tn)}),p=s[Symbol.iterator]();case 20:if(u=(f=p.next()).done){M.next=25;break}return M.delegateYield(d(),"t0",22);case 22:u=!0,M.next=20;break;case 25:M.next=31;break;case 27:M.prev=27,M.t1=M.catch(17),c=!0,h=M.t1;case 31:M.prev=31,M.prev=32,!u&&p.return&&p.return();case 34:if(M.prev=34,!c){M.next=37;break}throw h;case 37:return M.finish(34);case 38:return M.finish(31);case 39:return M.next=41,e.filterableListPrompt("Choose module to open",l,{historyId:"lively.morphic-choose and browse package resources",requester:n,width:700,multiSelect:!0,fuzzy:"value.shortName"});case 41:return y=M.sent,m=y.selected,g=r.arr.partition(m,function(e){return e.url.match(/\.js(on)?/)}),v=$(g,2),x=v[0],b=v[1],M.next=49,System.import("lively.ide/js/browser/index.js");case 49:return w=M.sent,_=w.default,M.next=53,Promise.all(x.map(function(e){var t={packageName:e.package,moduleName:e.url};return _.browse(t,n,a).then(function(e){return e.activate()})}));case 53:if(!b.length){M.next=56;break}return M.next=56,Promise.all(b.map(function(t){var n=t.url;return e.execCommand("open file",{url:n})}));case 56:return M.abrupt("return",!0);case 57:case"end":return M.stop()}},_callee25,Tn,[[17,27,31,39],[32,,34,38]])})),function exec(e,t,n,r){return xn.apply(this,arguments)})},{name:"choose and browse module",progressIndicator:"browsing module...",handlesCount:!0,exec:(vn=H(regeneratorRuntime.mark(function _callee27(e){var n,i,o,a,s,l,u,c,h,d,p,f,y,m,g,v,x,b,w,_,k,S,M,C,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{browser:void 0,systemInterface:void 0},T=arguments[2];return regeneratorRuntime.wrap(function _callee27$(A){for(;;)switch(A.prev=A.next){case 0:if(P.browser){A.next=4;break}if(n=e.focusedMorph,!((i=n&&n.getWindow())&&i.targetMorph&&i.targetMorph.isFileBrowser)){A.next=4;break}return A.abrupt("return",i.targetMorph.execCommand("find file and select",P,T));case 4:return o=P.browser||n&&n.ownerChain().find(function(e){return e.isBrowser}),A.next=7,System.import("lively.ide/js/browser/index.js");case 7:return a=A.sent,s=a.default,A.next=11,System.import("lively-system-interface");case 11:return l=A.sent,u=l.localInterface,c=P&&P.systemInterface?P.systemInterface:o?o.systemInterface:u,A.next=16,c.getPackages();case 16:h=A.sent,d=[],p=!0,f=!1,y=void 0,A.prev=21,m=h[Symbol.iterator]();case 23:if(p=(g=m.next()).done){A.next=57;break}v=g.value,x=(x=r.Path("lively.ide.exclude").get(v)||[]).map(function(e){return e.includes("*")?new RegExp(e.replace(/\*/g,".*")):e}),b=!0,w=!1,_=void 0,A.prev=30,k=function _loop2(){var e=M.value;if(x.some(function(t){return t instanceof RegExp?t.test(e.name):e.name.includes(t)}))return"continue";C=c.shortModuleName(e.name,v),d.push({isListItem:!0,string:"["+v.name+"] "+C,value:{package:v,module:e,shortName:C}})},S=v.modules[Symbol.iterator]();case 33:if(b=(M=S.next()).done){A.next=40;break}if("continue"!==k()){A.next=37;break}return A.abrupt("continue",37);case 37:b=!0,A.next=33;break;case 40:A.next=46;break;case 42:A.prev=42,A.t0=A.catch(30),w=!0,_=A.t0;case 46:A.prev=46,A.prev=47,!b&&S.return&&S.return();case 49:if(A.prev=49,!w){A.next=52;break}throw _;case 52:return A.finish(49);case 53:return A.finish(46);case 54:p=!0,A.next=23;break;case 57:A.next=63;break;case 59:A.prev=59,A.t1=A.catch(21),f=!0,y=A.t1;case 63:A.prev=63,A.prev=64,!p&&m.return&&m.return();case 66:if(A.prev=66,!f){A.next=69;break}throw y;case 69:return A.finish(66);case 70:return A.finish(63);case 71:return d=r.arr.sortBy(d,function(e){return e.string}),H(regeneratorRuntime.mark(function _callee26(){var r,i,a,l,u,h,p,f;return regeneratorRuntime.wrap(function _callee26$(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,e.filterableListPrompt("Choose module to open",d,{historyId:"lively.morphic-choose and browse module",requester:o||n,width:700,multiSelect:!0,listFontColor:"white",fuzzy:"value.shortName"});case 2:r=y.sent,i=r.selected,a=0;case 5:if(!(a<i.length)){y.next=18;break}return l=i[a],u=l.package,h=l.shortName,p={packageName:u.name,moduleName:h},y.next=12,s.browse(p,0===a?o:void 0,c);case 12:(f=y.sent).moveBy(t.pt(20*a,20*a)),f.activate();case 15:a++,y.next=5;break;case 18:case"end":return y.stop()}},_callee26,Tn)}))(),A.abrupt("return",!0);case 74:case"end":return A.stop()}},_callee27,Tn,[[21,59,63,71],[30,42,46,54],[47,,49,53],[64,,66,70]])})),function exec(e,t,n){return vn.apply(this,arguments)})},{name:"open code search",progressIndicator:"opening code search...",exec:(gn=H(regeneratorRuntime.mark(function _callee28(e){var t,n,r,i,o,a,s,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{browser:null,systemInterface:null,input:null};return regeneratorRuntime.wrap(function _callee28$(u){for(;;)switch(u.prev=u.next){case 0:if(t=e.focusedMorph?e.focusedMorph.ownerChain():[],!(n=l.browser||t.find(function(e){return e.isBrowser}))||!n.isBrowser){u.next=6;break}if(!n.state.associatedSearchPanel){u.next=4;break}return u.abrupt("return",n.state.associatedSearchPanel.getWindow().activate());case 4:u.next=7;break;case 6:n=null;case 7:return u.next=9,System.import("lively-system-interface");case 9:return r=u.sent,i=r.localInterface,(o=l.systemInterface||n&&n.systemInterface)||(a=t.find(function(e){return e.isText&&e.editorPlugin&&e.editorPlugin.isJSEditorPlugin}),o=a?a.editorPlugin.systemInterface():i),u.next=15,wt("code search");case 15:return s=u.sent,Object.assign(s.targetMorph,{browser:n,input:l.input,systemInterface:o}),s.activate(),n&&(n.state.associatedSearchPanel=s),u.abrupt("return",s);case 20:case"end":return u.stop()}},_callee28,Tn)})),function exec(e,t){return gn.apply(this,arguments)})},{name:"open grep search",progressIndicator:"opening code search...",exec:(mn=H(regeneratorRuntime.mark(function _callee29(e,t){var n;return regeneratorRuntime.wrap(function _callee29$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,wt("grep search");case 2:return n=t.sent,t.abrupt("return",n.openInWorldNearHand(e).activate());case 4:case"end":return t.stop()}},_callee29,Tn)})),function exec(e,t){return mn.apply(this,arguments)})},{name:"open test runner",progressIndicator:"opening test runner...",exec:(yn=H(regeneratorRuntime.mark(function _callee30(e){var t,n;return regeneratorRuntime.wrap(function _callee30$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,System.import("lively.ide/test-runner.js");case 2:return t=e.sent,n=t.default,e.next=6,n.open();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},_callee30,Tn)})),function exec(e){return yn.apply(this,arguments)})},{name:"open file browser",progressIndicator:"opening file browser...",exec:(fn=H(regeneratorRuntime.mark(function _callee31(e){var t,n,r,i,o,a,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function _callee31$(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,System.import("lively.ide/http-file-browser.js");case 2:return t=l.sent,n=t.default,r=s.location,i=s.url,o=s.file,a=o?n.forFile(o,r):n.forLocation(i||r||document.location.origin),l.abrupt("return",e.openInWindow(a).activate());case 9:case"end":return l.stop()}},_callee31,Tn)})),function exec(e,t){return fn.apply(this,arguments)})},{name:"open file",progressIndicator:"opening file...",exec:(pn=H(regeneratorRuntime.mark(function _callee32(e){var t,n,i,o,a,s,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{url:null,lineNumber:null,reuse:!1};return regeneratorRuntime.wrap(function _callee32$(u){for(;;)switch(u.prev=u.next){case 0:if(t=l.url,n=l.lineNumber,i=l.reuse,t){u.next=7;break}return u.next=6,e.prompt("Enter file location",{historyId:"lively.morphic-text editor url",useLastInput:!0});case 6:t=u.sent;case 7:if(!i){u.next=12;break}if(e.getWindows().slice(-2)[0],!(o=r.arr.findAndGet(e.getWindows(),function(e){var n=e.targetMorph;return n&&n.isTextEditor&&n.location.split(":")[0]===t?n:null}))){u.next=12;break}return"number"==typeof n&&(o.lineNumber=n),u.abrupt("return",o.getWindow().activate());case 12:return n&&(t+=":"+n),u.next=15,System.import("lively.ide/text-editor.js");case 15:return a=u.sent,s=a.default,u.abrupt("return",t?s.openURL(t,r.obj.dissoc(l,["url"])):null);case 18:case"end":return u.stop()}},_callee32,Tn)})),function exec(e,t){return pn.apply(this,arguments)})},{name:"open file for EDITOR",exec:(dn=H(regeneratorRuntime.mark(function _callee33(e){var t,n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{url:null,lineNumber:null};return regeneratorRuntime.wrap(function _callee33$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,System.import("lively.ide/text-editor.js");case 2:return t=e.sent,n=t.default,r=i.url,i.lineNumber,e.next=8,n.openAsEDITOR(r,{});case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},_callee33,Tn)})),function exec(e,t){return dn.apply(this,arguments)})},{name:"open subserver controller",exec:(hn=H(regeneratorRuntime.mark(function _callee34(e,t){var n;return regeneratorRuntime.wrap(function _callee34$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,vt("subserver controller");case 2:return n=e.sent,e.abrupt("return",n.openInWorld());case 4:case"end":return e.stop()}},_callee34,Tn)})),function exec(e,t){return hn.apply(this,arguments)})},{name:"[lively.installer] publish new version of a package",exec:(cn=H(regeneratorRuntime.mark(function _callee35(e){var t,n;return regeneratorRuntime.wrap(function _callee35$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lively.modules.registerPackage(document.location.origin+"/lively.installer");case 2:return e.next=4,System.import("lively.installer/packages/publish-new-package-version.js");case 4:return t=e.sent,n=t.default,e.next=8,n();case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}},_callee35,Tn)})),function exec(e){return cn.apply(this,arguments)})},{name:"report a bug",exec:(un=H(regeneratorRuntime.mark(function _callee36(e){return regeneratorRuntime.wrap(function _callee36$(e){for(;;)switch(e.prev=e.next){case 0:return window.open("https://github.com/LivelyKernel/lively.morphic/issues/new","_blank"),e.abrupt("return",!0);case 2:case"end":return e.stop()}},_callee36,Tn)})),function exec(e){return un.apply(this,arguments)})},{name:"fix font metric",exec:(ln=H(regeneratorRuntime.mark(function _callee37(e){return regeneratorRuntime.wrap(function _callee37$(t){for(;;)switch(t.prev=t.next){case 0:return e.env.fontMetric.reset(),e.withAllSubmorphsDo(function(e){return e.isText&&e.textLayout&&e.textLayout.reset()}),t.abrupt("return",!0);case 3:case"end":return t.stop()}},_callee37,Tn)})),function exec(e){return ln.apply(this,arguments)})},{name:"delete change history",exec:function exec(e){var t=e.env,n=t.printStatus();return t.deleteHistory(),e.setStatusMessage(n),!0}},{name:"install global inspect and show",exec:function exec(t){return window.show=b.show,window.inspect=e.inspect,t.setStatusMessage("inspect() and show() are now globally available"),!0}},{name:"save world",exec:(sn=H(regeneratorRuntime.mark(function _callee38(e,t,n,r){var i,o,a;return regeneratorRuntime.wrap(function _callee38$(n){for(;;)switch(n.prev=n.next){case 0:if(!(i=r&&e.relayCommandExecutionToFocusedMorph(r))){n.next=3;break}return n.abrupt("return",i);case 3:return t=Object.assign({confirmOverwrite:!0,showSaveDialog:!0},t),o=e.focusedMorph,n.next=7,Ot(e,t);case 7:return a=n.sent,o&&o.focus(),n.abrupt("return",a);case 10:case"end":return n.stop()}},_callee38,Tn)})),function exec(e,t,n,r){return sn.apply(this,arguments)})},{name:"save this world",exec:function exec(e,t,n,r){return e.execCommand("save world",Object.assign({confirmOverwrite:!0},t,{showSaveDialog:!1}))}},{name:"load world",exec:(an=H(regeneratorRuntime.mark(function _callee39(e){var t,n,r,i,o,a,s,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function _callee39$(u){for(;;)switch(u.prev=u.next){case 0:if(t=l.id,n=l.commit,r=l.name,i=l.ref,o=l.world,a=e.constructor,!o){u.next=8;break}return u.abrupt("return",a.loadWorld(o,e));case 8:if(!t&&!n){u.next=10;break}return u.abrupt("return",a.loadFromCommit(t||n,e));case 10:if(!r){u.next=12;break}return u.abrupt("return",a.loadFromDB(r,i,e));case 12:if(u.t0=e.get("world-list"),u.t0){u.next=17;break}return u.next=16,wt("world-list");case 16:u.t0=u.sent;case 17:return(s=u.t0).bringToFront().alignInWorld(e),s.update(),s.focus(),u.abrupt("return",s);case 22:case"end":return u.stop()}},_callee39,Tn)})),function exec(e,t){return an.apply(this,arguments)})},{name:"add external package dependency to object",exec:(on=H(regeneratorRuntime.mark(function _callee40(e){var t,n,r,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function _callee40$(a){for(;;)switch(a.prev=a.next){case 0:return t=o.target||e,n=t.metadata&&t.metadata.externalPackages||[],a.next=4,e.editListPrompt("modify package dependencies of "+t,n);case 4:if(r=a.sent,i=r.list){a.next=8;break}return a.abrupt("return");case 8:return i.length?(t.metadata||(t.metadata={}),t.metadata.externalPackages=i):t.metadata&&delete t.metadata.externalPackages,a.abrupt("return",!0);case 10:case"end":return a.stop()}},_callee40,Tn)})),function exec(e,t){return on.apply(this,arguments)})}],Ln=function(n){var o=_classRecorder,a=o.hasOwnProperty("World")&&"function"==typeof o.World?o.World:o.World=function World(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(a,n,[{key:Symbol.for("lively-instance-initialize"),value:function World_initialize_(e){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(a.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e),this._renderer=null,this._tooltipViewer=new tn(this)}},{key:"__deserialize__",value:function World___deserialize___(e,t){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(a.prototype),"__deserialize__",this).call(this,e,t),this._renderer=null,this._tooltipViewer=new tn(this)}},{key:"__additionally_serialize__",value:function World___additionally_serialize___(e,t,n,i){if(lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(a.prototype),"__additionally_serialize__",this).call(this,e,t,n,i),e.props.submorphs)for(var o=e.props.submorphs.value,s=o.length;s--;){var l=o[s].id;n.refForId(l).realObj.isHand&&r.arr.removeAt(o,s)}}},{key:"isWorld",get:function get(){return!0}},{key:"render",value:function World_render_(e){return e.renderWorld(this)}},{key:"draggable",get:function get(){return!0}},{key:"draggable",set:function set(e){}},{key:"grabbable",get:function get(){return!1}},{key:"grabbable",set:function set(e){}},{key:"existingHandForPointerId",value:function World_existingHandForPointerId_(e){return this.submorphs.find(function(t){return t instanceof Rn&&t.pointerId===e})}},{key:"handForPointerId",value:function World_handForPointerId_(e){return this.existingHandForPointerId(e)||this.addMorph(new Rn(e),this.submorphs[0])}},{key:"removeHandForPointerId",value:function World_removeHandForPointerId_(e){var t=this.existingHandForPointerId(e);t&&this.hands.length>1&&t.remove()}},{key:"world",value:function World_world_(){return this}},{key:"makeDirty",value:function World_makeDirty_(){if(!this._dirty){this._dirty=!0;var e=this.env.renderer;e&&e.renderLater()}}},{key:"hands",get:function get(){return r.arr.sortBy(this.submorphs.filter(function(e){return e.isHand}),function(e){return e.pointerId})}},{key:"firstHand",get:function get(){return this.hands[0]}},{key:"activeWindow",value:function World_activeWindow_(){return this.getWindows().reverse().find(function(e){return e.isActive()})}},{key:"getWindows",value:function World_getWindows_(){return this.submorphs.filter(function(e){return e.isWindow})}},{key:"activePrompt",value:function World_activePrompt_(){return this.getPrompts().reverse().find(function(e){return e.isActive()})}},{key:"getPrompts",value:function World_getPrompts_(){return this.submorphs.filter(function(e){return e.isPrompt})}},{key:"openInWindow",value:function World_openInWindow_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{title:e.name,name:"window for "+e.name},n=new S.Window(Object.assign({},t,{extent:e.extent.addXY(0,25),targetMorph:e})).openInWorld();return n.ensureNotOverTheTop(),n}},{key:"getCurrentUser",value:function World_getCurrentUser_(){return lively.user?lively.user.UserRegistry.current.loadUserFromLocalStorage(z.users.authServerURL):null}},{key:"focusedMorph",get:function get(){var e=this.env.eventDispatcher,t=e&&e.eventState.focusedMorph;return t&&t.world()===this?t:this}},{key:"onMouseMove",value:function World_onMouseMove_(e){e.hand&&e.hand.update(e),this._tooltipViewer.mouseMove(e)}},{key:"onMouseDown",value:function World_onMouseDown_(e){var t,n=e.state.clickedOnMorph,r=e.isCommandKey(),i=e.isShiftDown(),o=this.activeWindow();if(o&&n==this&&o.deactivate(),r&&!n.isHalo){var a=e.world.morphsContainingPoint(e.position),s=a.slice(a.indexOf(n));a=a.filter(function(e){return e.halosEnabled}),t=(s=s.filter(function(e){return e.halosEnabled}))[0]||a[0]}if(i&&!n.isHaloItem&&t&&e.halo&&e.halo.borderBox!=t)e.halo.addMorphToSelection(t);else{var l=e.halo&&!e.targetMorphs.find(function(e){return e.isHaloItem}),u=e.layoutHalo&&!e.targetMorphs.find(function(e){return e.isHaloItem}),c=(!e.halo||l)&&t;if(u&&e.layoutHalo.remove(),l&&e.halo.remove(),c)return e.stop(),void this.showHaloFor(t,e.domEvt.pointerId);e.state.menu&&e.state.menu.remove(),this._tooltipViewer.mouseDown(e)}}},{key:"onMouseUp",value:function World_onMouseUp_(e){if(e.isCommandKey()&&e.stop(),e.isAltDown()&&z.altClickDefinesThat){var t=this.morphsContainingPoint(e.position)[0];return setTimeout(function(){return System.global.that=t},100),t.show(),e.stop(),void console.log('Set global "that" to '+t)}}},{key:"onLongClick",value:function World_onLongClick_(e){var t,n=e.state.prevClick.clickedOnMorph,r=e.world.morphsContainingPoint(e.position),i=r.slice(r.indexOf(n));r=r.filter(function(e){return e.halosEnabled}),t=(i=i.filter(function(e){return e.halosEnabled}))[0]||r[0];var o=e.halo&&!e.targetMorphs.find(function(e){return e.isHaloItem}),a=e.layoutHalo&&!e.targetMorphs.find(function(e){return e.isHaloItem}),s=(!e.halo||o)&&t;if(a&&e.layoutHalo.remove(),o&&e.halo.remove(),s)return e.stop(),void this.showHaloFor(t,e.domEvt.pointerId)}},{key:"onMouseWheel",value:function World_onMouseWheel_(e){e.isShiftDown()&&(window.scrollBy(-e.domEvt.wheelDeltaX,-e.domEvt.wheelDeltaY),e.stop())}},{key:"onDragStart",value:function World_onDragStart_(e){e.leftMouseButtonPressed()&&(this.selectionStartPos=e.positionIn(this),this.morphSelection=this.addMorph({isSelectionElement:!0,position:this.selectionStartPos,extent:e.state.dragDelta,fill:t.Color.gray.withA(.2),borderWidth:2,borderColor:t.Color.gray}),this.selectedMorphs={})}},{key:"onDrag",value:function World_onDrag_(e){var n,r=this;this.morphSelection&&(n=t.Rectangle.fromAny(e.position,r.selectionStartPos),r.morphSelection.setBounds(n),r.submorphs.forEach(function(e){if(!e.isSelectionElement&&!e.isHand){var i=e.bounds(),o=n.containsRect(i);!r.selectedMorphs[e.id]&&o&&(r.selectedMorphs[e.id]=r.addMorph({isSelectionElement:!0,bounds:i,borderColor:t.Color.red,borderWidth:1,fill:t.Color.transparent},r.morphSelection)),r.selectedMorphs[e.id]&&!o&&(r.selectedMorphs[e.id].remove(),delete r.selectedMorphs[e.id])}}))}},{key:"onDragEnd",value:function World_onDragEnd_(e){var t=this;this.morphSelection&&(this.morphSelection.fadeOut(200),r.obj.values(this.selectedMorphs).map(function(e){return e.remove()}),this.showHaloForSelection(Object.keys(this.selectedMorphs).map(function(e){return t.getMorphWithId(e)})),this.selectedMorphs={},this.morphSelection=null)}},{key:"nativeDrop_ensureUploadIndicator",value:function(){var e=H(regeneratorRuntime.mark(function _callee(){var e,t=this;return regeneratorRuntime.wrap(function _callee$(n){for(;;)switch(n.prev=n.next){case 0:return this._cachedDragIndicator||(this._cachedDragIndicator=wt("upload-indicator")),n.next=3,this._cachedDragIndicator;case 3:(e=n.sent).world()||e.openInWorld(),r.fun.debounceNamed("remove-upload-indicator",1e3,function(){t.nativeDrop_removeUploadIndicator()})();case 6:case"end":return n.stop()}},_callee,this)}));return function World_nativeDrop_ensureUploadIndicator_(){return e.apply(this,arguments)}}()},{key:"nativeDrop_removeUploadIndicator",value:function World_nativeDrop_removeUploadIndicator_(){this._cachedDragIndicator&&this._cachedDragIndicator.then(function(e){return e.remove()})}},{key:"onNativeDragover",value:function World_onNativeDragover_(e){e.targetMorph===this&&this.nativeDrop_ensureUploadIndicator()}},{key:"onNativeDrop",value:function(){var t=H(regeneratorRuntime.mark(function _callee2(t){var n,i,o,a,s,l,u,c,h,d,p,f,y,m,g,v,x,b,w,_,k,S,M,C,P,T,A,L,R,E,z,O,I,D,N,F,B,j,W,H,V,U,q=this;return regeneratorRuntime.wrap(function _callee2$(G){for(;;)switch(G.prev=G.next){case 0:if(this.nativeDrop_removeUploadIndicator(),n=t.domEvt,i=n.dataTransfer,o=i.files,i.items,a=document.location.origin,!o.length){G.next=131;break}if(s=this.getCurrentUser(),l=s.isGuestUser?"uploads/":"users/"+$world.getCurrentUser().name+"/uploads",!t.isAltDown()){G.next=14;break}return G.next=11,this.prompt("Choose upload location",{history:"lively.morphic-html-drop-file-upload-location",input:l});case 11:if(l=G.sent){G.next=14;break}return G.abrupt("return",this.setStatusMessage("Canceled upload"));case 14:return G.next=16,this.confirm("Upload "+o.length+" file"+(o.length>1?"s":"")+"?");case 16:if(G.sent){G.next=19;break}return G.abrupt("return");case 19:for(u=new FormData,c=0;c<o.length;c++)u.append("file",o[c],o[c].name);return h=void 0,d=void 0,G.prev=22,p={},s.isGuestUser||(p.Authorization="Bearer "+s.token),G.next=27,fetch("/upload?uploadPath="+encodeURIComponent(l),{method:"POST",body:u,headers:p});case 27:return h=G.sent,G.next=30,h.text();case 30:d=G.sent,G.next=36;break;case 33:return G.prev=33,G.t0=G.catch(22),G.abrupt("return",this.showError("Upload failed: "+G.t0.message+"\n"));case 36:if(h.ok){G.next=38;break}return G.abrupt("return",this.showError(d||h.statusText));case 38:if(G.prev=38,"done"===(f=JSON.parse(d)).status){G.next=42;break}return G.abrupt("return",this.setStatusMessage("File upload failed: "+f.status));case 42:for(this.setStatusMessage("Uploaded "+f.uploadedFiles.length+" file"),y=f.uploadedFiles.map(function(e){var t=lively.resources.resource(a).join(e.path);return Object.assign({},e,{url:t.url,name:t.name()})}),m=[],g=[],v=[],x=!0,b=!1,w=void 0,G.prev=48,_=y[Symbol.iterator]();!(x=(k=_.next()).done);x=!0)(S=k.value).type.startsWith("image/")?m.push(S):S.type.startsWith("video")?g.push(S):v.push(S);G.next=56;break;case 52:G.prev=52,G.t1=G.catch(48),b=!0,w=G.t1;case 56:G.prev=56,G.prev=57,!x&&_.return&&_.return();case 59:if(G.prev=59,!b){G.next=62;break}throw w;case 62:return G.finish(59);case 63:return G.finish(56);case 64:if(!g.length){G.next=95;break}M=!0,C=!1,P=void 0,G.prev=68,T=g[Symbol.iterator]();case 70:if(M=(A=T.next()).done){G.next=81;break}return L=A.value,G.t2=Object,G.next=75,wt("video morph");case 75:G.t3=G.sent,G.t4={videoURL:L.url,name:L.name},G.t2.assign.call(G.t2,G.t3,G.t4).openInWorld();case 78:M=!0,G.next=70;break;case 81:G.next=87;break;case 83:G.prev=83,G.t5=G.catch(68),C=!0,P=G.t5;case 87:G.prev=87,G.prev=88,!M&&T.return&&T.return();case 90:if(G.prev=90,!C){G.next=93;break}throw P;case 93:return G.finish(90);case 94:return G.finish(87);case 95:if(m.length&&!0&&m.forEach(function(e){var t=new Yt({imageUrl:e.url,autoResize:!0,name:e.name});t.whenLoaded().then(function(){t.extent=t.naturalExtent.scaleBy(.8*q.visibleBounds().height/t.height),t.openInWorld(),t.center=q.visibleBounds().center()})}),!v.length){G.next=125;break}R=!0,E=!1,z=void 0,G.prev=100,O=v[Symbol.iterator]();case 102:if(R=(I=O.next()).done){G.next=111;break}return D=I.value,G.next=106,this.confirm("open file "+D.name+" ("+D.type+")?");case 106:G.sent&&this.execCommand("open file",{url:D.url});case 108:R=!0,G.next=102;break;case 111:G.next=117;break;case 113:G.prev=113,G.t6=G.catch(100),E=!0,z=G.t6;case 117:G.prev=117,G.prev=118,!R&&O.return&&O.return();case 120:if(G.prev=120,!E){G.next=123;break}throw z;case 123:return G.finish(120);case 124:return G.finish(117);case 125:G.next=130;break;case 127:G.prev=127,G.t7=G.catch(38),this.showError(G.t7);case 130:return G.abrupt("return");case 131:if(!(N=n.dataTransfer.types).includes("text/html")){G.next=145;break}if(F=n.dataTransfer.getData("text/html"),B=(new DOMParser).parseFromString(F,"text/html"),1!==(j=B.querySelectorAll("img")).length||!j[0].src||!N.includes("text/uri-list")){G.next=138;break}!function(){var e=j[0].src,t=new Yt({imageUrl:e,autoResize:!0,name:r.arr.last(e.split("/"))});t.whenLoaded().then(function(){return t.openInWorld()})}(),G.next=144;break;case 138:return G.t8=Object,G.next=141,wt("html-morph");case 141:G.t9=G.sent,G.t10={html:F},G.t8.assign.call(G.t8,G.t9,G.t10).openInWorld();case 144:return G.abrupt("return");case 145:W=0;case 146:if(!(W<n.dataTransfer.items.length)){G.next=165;break}if("file"!==(H=n.dataTransfer.items[W]).kind){G.next=161;break}return V=H.getAsFile(),G.next=152,this.confirm("Upload "+V.name+"?");case 152:if(!G.sent){G.next=159;break}return G.next=156,rn(V,V.type);case 156:(U=G.sent)&&U.openInWorld(),U.center=this.visibleBounds().center();case 159:G.next=162;break;case 161:"string"===H.kind&&H.getAsString(function(t){return e.inspect(t)});case 162:W++,G.next=146;break;case 165:case"end":return G.stop()}},_callee2,this,[[22,33],[38,127],[48,52,56,64],[57,,59,63],[68,83,87,95],[88,,90,94],[100,113,117,125],[118,,120,124]])}));return function World_onNativeDrop_(e){return t.apply(this,arguments)}}()},{key:"serveFileAsDownload",value:function World_serveFileAsDownload_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.fileName,r=void 0===n?"file.txt":n,i=t.type,o=void 0===i?"text/plain":i,a=window.document.createElement("a");a.href=window.URL.createObjectURL(new Blob([e],{type:o})),a.download=r,document.body.appendChild(a),a.click(),document.body.removeChild(a)}},{key:"menuItems",value:function World_menuItems_(){var e=this;return[{title:"World menu"},{command:"undo",target:this},{command:"redo",target:this},{isDivider:!0},["Debugging",[{command:"delete change history",target:this},{command:"fix font metric",target:this}]],["Tools",[{command:"open PartsBin",target:this},{command:"open workspace",target:this},{command:"open browser",target:this},{command:"choose and browse module",target:this},{command:"open code search",target:this},{command:"open file browser",target:this},{command:"open shell workspace",target:this}]],{isDivider:!0},{command:"run command",target:this},{command:"select morph",target:this},{command:"window switcher",target:this},["Resize","static"===this.resizePolicy?[{command:"resize to fit window",target:this},{command:"resize manually",target:this},["switch to automatic resizing of world",function(){return e.resizePolicy="elastic"}]]:[["switch to manual resizing of world",function(){return e.resizePolicy="static"}]]],{command:"report a bug",target:this},{isDivider:!0},{command:"save world",target:this},{command:"load world",target:this}]}},{key:"openWorldMenu",value:function World_openWorldMenu_(e,t){var n=this.env.eventDispatcher.eventState;return n.menu&&n.menu.remove(),n.menu=t&&t.length?S.Menu.openAtHand(t,{hand:e&&e.hand||this.firstHand}):null}},{key:"onWindowScroll",value:function World_onWindowScroll_(e){var n=e.dispatcher.keyInputHelper.inputState,r=n.positionChangedTime,i=n.scrollLeftWhenChanged,o=n.scrollTopWhenChanged,a=document.documentElement;if(Date.now()-r<500)return a.scrollLeft=i,void(a.scrollTop=o);this.setProperty("scroll",t.pt(a.scrollLeft,a.scrollTop)),this._cachedWindowBounds=null,this.updateVisibleWindowMorphs(e),this.onMouseMove(e)}},{key:"onWindowResize",value:function World_onWindowResize_(e){this._cachedWindowBounds=null,"elastic"===this.resizePolicy&&this.execCommand("resize to fit window"),this.updateVisibleWindowMorphs(e);var t=!0,n=!1,r=void 0;try{for(var i,o=this.submorphs[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;"function"==typeof a.onWorldResize&&a.onWorldResize(e)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"updateVisibleWindowMorphs",value:function World_updateVisibleWindowMorphs_(e){this.withAllSubmorphsDo(function(t){if(t.respondsToVisibleWindow)return"function"!=typeof t.relayout?t.showError(new Error(t+" listed as responding to visible window change, but has no relayout instruction")):void t.relayout(e)})}},{key:"onPaste",value:function(){var e=H(regeneratorRuntime.mark(function _callee3(e){var n,r,i,o,a,s,l,u,c,h,d,p,f;return regeneratorRuntime.wrap(function _callee3$(y){for(;;)switch(y.prev=y.next){case 0:if(y.prev=0,!(n=e.domEvt.clipboardData).types.includes("application/morphic")){y.next=38;break}e.stop(),r=JSON.parse(n.getData("application/morphic")),i=[],n.clearData(),Array.isArray(r)||(r=[r]),o=!0,a=!1,s=void 0,y.prev=10,l=r[Symbol.iterator]();case 12:if(o=(u=l.next()).done){y.next=23;break}return c=u.value,y.next=16,loadMorphFromSnapshot$$1(c);case 16:(h=y.sent).openInWorld(e.hand.position),c.copyMeta&&c.copyMeta.offset&&(d=c.copyMeta.offset,p=d.x,f=d.y,h.moveBy(t.pt(p,f))),i.push(h);case 20:o=!0,y.next=12;break;case 23:y.next=29;break;case 25:y.prev=25,y.t0=y.catch(10),a=!0,s=y.t0;case 29:y.prev=29,y.prev=30,!o&&l.return&&l.return();case 32:if(y.prev=32,!a){y.next=35;break}throw s;case 35:return y.finish(32);case 36:return y.finish(29);case 37:this.showHaloFor(i);case 38:y.next=43;break;case 40:y.prev=40,y.t1=y.catch(0),this.showError(y.t1);case 43:case"end":return y.stop()}},_callee3,this,[[0,40],[10,25,29,37],[30,,32,36]])}));return function World_onPaste_(t){return e.apply(this,arguments)}}()},{key:"relayCommandExecutionToFocusedMorph",value:function World_relayCommandExecutionToFocusedMorph_(e){if(!e)return null;var t=this.focusedMorph,n=r.arr.findAndGet(r.arr.without([t].concat(X(t.ownerChain())),this),function(t){return r.arr.findAndGet(t.keyhandlers,function(n){var r=n.eventCommandLookup(t,e);return r?{command:r,morph:t}:null})})||{},i=n.command,o=n.morph;return i?o.execCommand(i):null}},{key:"commands",get:function get(){return An.concat(lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(a.prototype),"commands",this))}},{key:"keybindings",get:function get(){return lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(a.prototype),"keybindings",this).concat(z.globalKeyBindings)}},{key:"keybindings",set:function set(e){lively.classes.runtime.initializeClass._set(Object.getPrototypeOf(a.prototype),"keybindings",e,this)}},{key:"onBeforeUnload",value:function World_onBeforeUnload_(e){return this.onUnload(e)}},{key:"onUnload",value:function World_onUnload_(e){this.submorphs.forEach(function(t){"function"==typeof t.onWorldUnload&&t.onWorldUnload(e)})}},{key:"halos",value:function World_halos_(){return this.submorphs.filter(function(e){return e.isHalo})}},{key:"haloForPointerId",value:function World_haloForPointerId_(e){return this.submorphs.find(function(t){return t.isHalo&&t.state&&t.state.pointerId===e})}},{key:"showHaloFor",value:function World_showHaloFor_(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.firstHand&&this.firstHand.pointerId,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(E)return t="function"==typeof e.createHalo?e.createHalo(E,n):new E({pointerId:n,target:e}),this.addMorph(t),r&&t.focus(),t}},{key:"showHaloForSelection",value:function World_showHaloForSelection_(e,t){return e.length>0&&this.showHaloFor(e,t)}},{key:"layoutHaloForPointerId",value:function World_layoutHaloForPointerId_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.firstHand&&this.firstHand.pointerId;return this.submorphs.find(function(t){return t.isLayoutHalo&&t.state&&t.state.pointerId===e})}},{key:"showLayoutHaloFor",value:function World_showLayoutHaloFor_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.firstHand&&this.firstHand.pointerId,n=e===this?null:e.owner===this?e:e.ownerChain().slice(-2)[0],r=n?this.submorphs.indexOf(n)+1:this.submorphs.length,i=e.layout.inspect(t);return this.addMorphAt(i,r)}},{key:"highlightMorph",value:function World_highlightMorph_(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return _.MorphHighlighter.for(e,t,n,r)}},{key:"removeHighlighters",value:function World_removeHighlighters_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return _.MorphHighlighter.removeHighlighters(e)}},{key:"visibleBounds",value:function World_visibleBounds_(){return this.env.renderer?this.windowBounds().intersection(this.innerBounds()):this.innerBounds()}},{key:"windowBounds",value:function World_windowBounds_(e){if(this._cachedWindowBounds)return this._cachedWindowBounds;var n=this.env.domEnv.window,r=1/this.scale,i=n.scrollX*r,o=n.scrollY*r,a=(n.innerWidth||this.width)*r,s=(n.innerHeight||this.height)*r;return this._cachedWindowBounds=new t.Rectangle(i,o,a,s)}},{key:"visibleStatusMessages",value:function World_visibleStatusMessages_(){return this.submorphs.filter(function(e){return e.isStatusMessage})}},{key:"visibleStatusMessagesFor",value:function World_visibleStatusMessagesFor_(e){return this.submorphs.filter(function(t){return t.isStatusMessage&&t.targetMorph===e})}},{key:"logErrorPreperation",value:function World_logErrorPreperation_(e){var t=String(e),n=e.stack||"";n&&e.message!==e.stack&&(0===(n=String(n)).indexOf(t)&&(n=n.slice(t.length)),t+="\n"+n);return t}},{key:"logError",value:function World_logError_(e){this.setStatusMessage(this.logErrorPreperation(e),t.Color.red)}},{key:"showError",value:function World_showError_(e){return this.logError(e)}},{key:"showErrorFor",value:function World_showErrorFor_(e,n){return this.setStatusMessageFor(e,this.logErrorPreperation(n),t.Color.red)}},{key:"setStatusMessageFor",value:function World_setStatusMessageFor_(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5e3,o=arguments[4];this.visibleStatusMessagesFor(e).forEach(function(e){return e.remove()});var a=new b.StatusMessageForMorph(Object.assign({message:t,color:n},o));return this.openStatusMessage(a,r),a.targetMorph=e,a.fadeIn(300),a.removeOnTargetMorphChange&&e.isText&&i.once(e,"selectionChange",a,"fadeOut",{converter:function converter(){return 200}}),a}},{key:"setStatusMessage",value:function World_setStatusMessage_(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return console[n==t.Color.red?"error":"log"](e),z.verboseLogging?this.openStatusMessage(new b.StatusMessage(Object.assign({message:e,color:n},i)),r):null}},{key:"openStatusMessage",value:function World_openStatusMessage_(e,n){var i,o=this;if(this.addMorph(e),e.slidable){var a=this.visibleStatusMessages(),s=!0,l=!1,u=void 0;try{for(var c,h=a[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var d=c.value;if(a.length<=(z.maxStatusMessages||0))break;!d.stayOpen&&d.slidable&&(d.remove(),r.arr.remove(a,d))}}catch(e){l=!0,u=e}finally{try{!s&&h.return&&h.return()}finally{if(l)throw u}}r.arr.without(a,e).forEach((i=H(regeneratorRuntime.mark(function _callee4(n){return regeneratorRuntime.wrap(function _callee4$(r){for(;;)switch(r.prev=r.next){case 0:!n.isMaximized&&n.slidable&&n.slideTo(n.position.addPt(t.pt(0,-e.extent.y-10)));case 1:case"end":return r.stop()}},_callee4,o)})),function(e){return i.apply(this,arguments)}));var p=this.visibleBounds().bottomRight().addXY(-20,-20);e.align(e.bounds().bottomRight(),p),e.topRight=p.addPt(t.pt(0,40)),e.animate({bottomRight:p,duration:500})}return"number"==typeof n&&setTimeout(function(){return e.stayOpen||e.fadeOut()},n),e}},{key:"addProgressBar",value:function(){var e=H(regeneratorRuntime.mark(function _callee5(){var e,t,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return e=i.location,t=void 0===e?"center":e,o.next=4,wt("progress bar");case 4:return n=o.sent,Object.assign(n,{progress:0},r.obj.dissoc(i,["location"])),this.addMorph(n),n.align(n[t],this.visibleBounds()[t]()),o.abrupt("return",n);case 9:case"end":return o.stop()}},_callee5,this)}));return function World_addProgressBar_(t){return e.apply(this,arguments)}}()},{key:"withProgressBarDo",value:function(){var e=H(regeneratorRuntime.mark(function _callee6(e,t){var n;return regeneratorRuntime.wrap(function _callee6$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.addProgressBar(t);case 2:return n=r.sent,r.prev=3,r.next=6,e(n);case 6:return r.abrupt("return",r.sent);case 7:return r.prev=7,n.remove(),r.finish(7);case 10:case"end":return r.stop()}},_callee6,this,[[3,,7,10]])}));return function World_withProgressBarDo_(t,n){return e.apply(this,arguments)}}()},{key:"openPrompt",value:function(){var e=H(regeneratorRuntime.mark(function _callee7(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{requester:null,animated:!1};return regeneratorRuntime.wrap(function _callee7$(o){for(;;)switch(o.prev=o.next){case 0:return t=this.focusedMorph,n=this.visibleBounds(),e.openInWorldNear(i.requester?n.intersection(i.requester.globalBounds()).center():n.center(),this),e.height>n.height&&(e.height=n.height-5),"function"==typeof i.customize&&i.customize(e),i.animated&&(this.previousPrompt&&this.previousPrompt.world()?this.previousPrompt.transitionTo(e):e.openInWorld(e.globalPosition)),this.previousPrompt=e,o.abrupt("return",r.promise.finally(e.activate(i),function(){return t&&t.focus()}));case 7:case"end":return o.stop()}},_callee7,this)}));return function World_openPrompt_(t,n){return e.apply(this,arguments)}}()},{key:"inform",value:function World_inform_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"no message",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fontSize:16,requester:null,animated:!0};return this.openPrompt(new x.InformPrompt(Object.assign({label:e},t)),t)}},{key:"prompt",value:function World_prompt_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{requester:null,input:"",historyId:null,useLastInput:!1};return this.openPrompt(new x.TextPrompt(Object.assign({label:e},t)),t)}},{key:"editPrompt",value:function World_editPrompt_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{requester:null,input:"",historyId:null,useLastInput:!1,textStyle:null,mode:null,evalEnvironment:null};return this.openPrompt(new x.EditPrompt(Object.assign({label:e},t)),t)}},{key:"passwordPrompt",value:function World_passwordPrompt_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{requester:null,input:""};return this.openPrompt(new x.PasswordPrompt(Object.assign({label:e},t)),t)}},{key:"confirm",value:function World_confirm_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{requester:null,animated:!0};return this.openPrompt(new x.ConfirmPrompt(Object.assign({label:e},t)),t)}},{key:"multipleChoicePrompt",value:function World_multipleChoicePrompt_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{requester:null,animated:!0,choices:[]};return this.openPrompt(new x.MultipleChoicePrompt(Object.assign({label:e},t)),t)}},{key:"listPrompt",value:function World_listPrompt_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{requester:null,onSelection:null,preselect:0};return this.openPrompt(new x.ListPrompt(Object.assign({filterable:!1,padding:t.Rectangle.inset(3),label:e,items:n},r)),r)}},{key:"filterableListPrompt",value:function World_filterableListPrompt_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{requester:null,onSelection:null,preselect:0,multiSelect:!1,historyId:null,fuzzy:!1,actions:["default"],selectedAction:"default",theme:"dark"};if(r.prompt){var i=r.prompt.get("list");return i.items=n,i.selectedIndex=r.preselect||0,this.openPrompt(r.prompt,r)}return this.openPrompt(new x.ListPrompt(Object.assign({filterable:!0,padding:t.Rectangle.inset(3),label:e,items:n},r)),r)}},{key:"editListPrompt",value:function World_editListPrompt_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{requester:null,multiSelect:!0,historyId:null};return this.openPrompt(new x.EditListPrompt(Object.assign({label:e,multiSelect:!0,items:n,padding:t.Rectangle.inset(3)},r)),r)}},{key:"showLoadingIndicatorFor",value:function World_showLoadingIndicatorFor_(e,t){return this.addMorph(d.open(t,{center:e.globalBounds().center()}))}}],[{key:"properties",get:function get(){return{resizePolicy:{doc:"how the world behaves on window size changes 'elastic': resizes to window extent, 'static': leaves its extent unchanged",defaultValue:"elastic",after:["clipMode"],type:"Enum",values:["static","elastic"],set:function set(e){this.setProperty("resizePolicy",e),this.clipMode="static"===e?"visible":"hidden","elastic"==e&&this.execCommand("resize to fit window")}},showsUserFlap:{defaultValue:!0,set:function set(e){var t=this;this.setProperty("showsUserFlap",e),System.import("lively.user/morphic/user-ui.js").then(function(n){return n.UserUI[e?"showUserFlap":"hideUserFlap"](t)})}},styleSheets:{initialize:function initialize(){this.styleSheets=r.arr.compact([b.StatusMessage,w.GradientEditor,S.Window,S.FilterableList,S.List,d,nn]).map(function(e){return e.styleSheet}).filter(Boolean)}}}}},{key:"defaultWorld",value:function World_defaultWorld_(){return Ue.default().world}},{key:"loadWorldFromURL",value:function World_loadWorldFromURL_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.defaultWorld(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Lt(e,t,n)}},{key:"loadWorld",value:function World_loadWorld_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.defaultWorld(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return zt(e,t,n)}},{key:"loadFromCommit",value:function World_loadFromCommit_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.defaultWorld(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Rt(e,t,n)}},{key:"loadFromDB",value:function World_loadFromDB_(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.defaultWorld(),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Et(e,t,n,r)}}],o,void 0,{start:1400,end:33063})}($t),Rn=function(e){var n=_classRecorder,o=n.hasOwnProperty("Hand")&&"function"==typeof n.Hand?n.Hand:n.Hand=function Hand(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(o,e,[{key:Symbol.for("lively-instance-initialize"),value:function Hand_initialize_(e){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),Symbol.for("lively-instance-initialize"),this).call(this,{pointerId:e})}},{key:"__deserialize__",value:function Hand___deserialize___(e,t){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"__deserialize__",this).call(this,e,t),this.reset()}},{key:"reset",value:function Hand_reset_(){this._grabbedMorphProperties=new WeakMap}},{key:"isHand",get:function get(){return!0}},{key:"pointerId",get:function get(){return this.getProperty("pointerId")}},{key:"pointerId",set:function set(e){this.setProperty("pointerId",e)}},{key:"draggable",get:function get(){return!1}},{key:"draggable",set:function set(e){}},{key:"grabbable",get:function get(){return!1}},{key:"grabbable",set:function set(e){}},{key:"grabbedMorphs",get:function get(){return this.submorphs}},{key:"carriesMorphs",value:function Hand_carriesMorphs_(){return!!this.grabbedMorphs.length}},{key:"morphsContainingPoint",value:function Hand_morphsContainingPoint_(e,t){return t}},{key:"update",value:function Hand_update_(e){this.position=e.position}},{key:"cancelGrab",value:function(){var e=H(regeneratorRuntime.mark(function _callee8(){var e,t,n,r,i,o,a,s,l,u,c,h,d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=arguments[1];return regeneratorRuntime.wrap(function _callee8$(f){for(;;)switch(f.prev=f.next){case 0:if(this.grabbedMorphs.length){f.next=2;break}return f.abrupt("return");case 2:this.env.eventDispatcher.cancelGrab(this,p),e=[],t=!0,n=!1,r=void 0,f.prev=7,i=this.grabbedMorphs[Symbol.iterator]();case 9:if(t=(o=i.next()).done){f.next=25;break}if(a=o.value,s=this._grabbedMorphProperties.get(a)||{},l=s.prevOwner,u=s.prevIndex,c=s.prevPosition,h=s.pointerAndShadow,Object.assign(a,h),l){f.next=20;break}return a.remove(),f.abrupt("continue",22);case 20:l.addMorphAt(a,u),d?e.push(a.animate({position:c})):a.position=c;case 22:t=!0,f.next=9;break;case 25:f.next=31;break;case 27:f.prev=27,f.t0=f.catch(7),n=!0,r=f.t0;case 31:f.prev=31,f.prev=32,!t&&i.return&&i.return();case 34:if(f.prev=34,!n){f.next=37;break}throw r;case 37:return f.finish(34);case 38:return f.finish(31);case 39:return f.abrupt("return",e.length?Promise.all(e):null);case 40:case"end":return f.stop()}},_callee8,this,[[7,27,31,39],[32,,34,38]])}));return function Hand_cancelGrab_(t,n){return e.apply(this,arguments)}}()},{key:"grab",value:function Hand_grab_(e){var t=this;if(r.obj.isArray(e))return e.forEach(function(e){return t.grab(e)});this._grabbedMorphProperties.set(e,{prevOwner:e.owner,prevPosition:e.position,prevIndex:e.owner?e.owner.submorphs.indexOf(e):-1,pointerAndShadow:r.obj.select(e,["dropShadow","reactsToPointer"])}),e.reactsToPointer=!1,e.dropShadow=!0,this.addMorph(e),i.signal(this,"grab",e)}},{key:"dropMorphsOn",value:function Hand_dropMorphsOn_(e){var t=this;this.grabbedMorphs.forEach(function(n){try{var r=(t._grabbedMorphProperties.get(n)||{}).pointerAndShadow;Object.assign(n,r),i.signal(t,"drop",n),n.onBeingDroppedOn(t,e)}catch(r){console.error(r),t.world().showError("Error dropping "+n+" onto "+e+":\n"+r.stack),n.owner!==e&&t.world().addMorph(e)}})}},{key:"findDropTarget",value:function Hand_findDropTarget_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.position,t=this,n=arguments[1],r=arguments[2],i=this.world().morphsContainingPoint(e),o="function"==typeof r?function(e,i){return!t.isAncestorOf(e)&&e.acceptsDrops&&!n.includes(e)&&n.every(function(t){return t.wantsToBeDroppedOn(e)})&&r(e,i)}:function(e){return!t.isAncestorOf(e)&&e.acceptsDrops&&n.every(function(t){return t.wantsToBeDroppedOn(e)})};return i.find(o)}}],[{key:"properties",get:function get(){return{fill:{defaultValue:t.Color.orange},extent:{defaultValue:t.pt(1,1)},reactsToPointer:{defaultValue:!1},_grabbedMorphProperties:{serialize:!1,initialize:function initialize(){this._grabbedMorphProperties=new WeakMap}}}}}],n,void 0,{start:33072,end:36499})}($t);function comparePosition(e,t){var n=e.row,r=e.column,i=t.row,o=t.column;return n<i?-2:n===i?r<o?-1:r===o?0:1:2}function lessPosition(e,t){return comparePosition(e,t)<0}function lessEqPosition(e,t){return comparePosition(e,t)<=0}function eqPosition(e,t){return 0===comparePosition(e,t)}function minPosition(e,t){return lessPosition(e,t)?e:t}function maxPosition(e,t){return lessPosition(e,t)?t:e}var En=function(e){var t=_classRecorder,n=t.hasOwnProperty("Range")&&"function"==typeof t.Range?t.Range:t.Range=function Range(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function Range_initialize_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{start:{row:0,column:0},end:{row:0,column:0}},t=e.start,n=t.row,r=t.column,i=e.end,o=i.row,a=i.column;if(o<n||o===n&&a<r){var s=[n,r,o,a];o=s[0],a=s[1],n=s[2],r=s[3]}this.start={row:n,column:r},this.end={row:o,column:a}}},{key:"isRange",get:function get(){return!0}},{key:"isEmpty",value:function Range_isEmpty_(){return this.start.row===this.end.row&&this.start.column===this.end.column}},{key:"equals",value:function Range_equals_(e){return!!(e&&e.start&&e.end)&&(eqPosition(this.start,e.start)&&eqPosition(this.end,e.end))}},{key:"copy",value:function Range_copy_(){return new En(this)}},{key:"toLiteral",value:function Range_toLiteral_(){return{start:this.start,end:this.end}}},{key:"merge",value:function Range_merge_(e){return e.isRange||(e=new En(e)),lessPosition(this.end,e.start)||lessPosition(e.end,this.start)?this:En.fromPositions(minPosition(this.start,e.start),maxPosition(this.end,e.end))}},{key:"without",value:function Range_without_(e){e.isRange||(e=new En(e));var t=En.compare(this,e);return 0===t?En.fromPositions(this.start,this.start):Math.abs(t)>=5?this:t<0?En.fromPositions(this.start,e.start):En.fromPositions(e.end,this.end)}},{key:"intersect",value:function Range_intersect_(e){e.isRange||(e=new En(e));var t=En.compare(this,e),n=t<0?this:e,r=t<0?e:this;switch(Math.abs(t)){case 0:case 1:return new En(n);case 2:case 3:return new En(r);case 4:return En.fromPositions(r.start,n.end);case 5:return En.at(r.start);case 6:return En.at(n.end)}}},{key:"subtract",value:function Range_subtract_(e){switch(e.isRange||(e=new En(e)),En.compare(this,e)){case-6:case-5:case 5:case 6:return[new En(this)];case-1:case 0:case 2:case 3:return[En.at(this.start)];case 1:case 4:return[En.fromPositions(e.end,this.end)];case-4:case-3:return[En.fromPositions(this.start,e.start)];case-2:return[En.fromPositions(this.start,e.start),En.fromPositions(e.end,this.end)]}}},{key:"containsPosition",value:function Range_containsPosition_(e){return lessEqPosition(this.start,e)&&lessEqPosition(e,this.end)}},{key:"toString",value:function Range_toString_(){var e=this.start,t=e.row,n=e.column,r=this.end;return"Range("+t+"/"+n+" -> "+r.row+"/"+r.column+")"}}],[{key:"sort",value:function Range_sort_(e){return e.sort(En.compare)}},{key:"compare",value:function Range_compare_(e,t){var n=e.start,r=e.end,i=t.start,o=t.end;return lessPosition(n,i)?lessPosition(r,i)?-6:eqPosition(r,i)?-5:lessPosition(r,o)?-4:eqPosition(r,o)?-3:-2:eqPosition(n,i)?eqPosition(r,o)?0:lessPosition(r,o)?-1:1:-1*En.compare(t,e)}},{key:"at",value:function Range_at_(e){return new this({start:e,end:e})}},{key:"fromPositions",value:function Range_fromPositions_(e,t){return new this({start:e,end:t})}},{key:"create",value:function Range_create_(e,t,n,r){return new this({start:{row:e,column:t},end:{row:n,column:r}})}},{key:"isValidLiteral",value:function Range_isValidLiteral_(e){return!!e&&(!!e.isRange||e.start&&e.end&&"number"==typeof e.start.row&&"number"==typeof e.start.column&&"number"==typeof e.end.row&&"number"==typeof e.end.column)}}],t,void 0,{start:108,end:5392})}(void 0),zn=new En,On=function(e){var t=_classRecorder,n=t.hasOwnProperty("Selection")&&"function"==typeof t.Selection?t.Selection:t.Selection=function Selection(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function Selection_initialize_(e,t){this.textMorph=e,this.initialize(t)}},{key:"isSelection",get:function get(){return!0}},{key:"initialize",value:function Selection_initialize_(e){this._goalColumn=void 0,this._goalX=void 0,this._isReverse=!1;var t=r.string.newUUID();this.startAnchor=this.textMorph.addAnchor("selection-start-"+t),this.endAnchor=this.textMorph.addAnchor("selection-end-"+t),this.range=En.isValidLiteral(e)?e:zn,this._cursorVisible=!0,this.cursorBlinkProcess=null}},{key:"isSelection",get:function get(){return!0}},{key:"uninstall",value:function Selection_uninstall_(){this.cursorBlinkStop(),this.textMorph.removeAnchor(this.startAnchor),this.textMorph.removeAnchor(this.endAnchor)}},{key:"compareRangesForMerge",value:function Selection_compareRangesForMerge_(e,t){var n=e.start,r=n.row,i=n.column,o=e.end,a=o.row,s=o.column,l=t.start,u=l.row,c=l.column,h=t.end,d=h.row,p=h.column;return r<u||r===u&&i<c?a<u||a===u&&s<c?"separate":a===u&&s===c?u===d&&c===p?"overlapping":"bordering":"overlapping":r===u&&i===c?a===d&&s===p?"equal":"overlapping":this.compareRangesForMerge(t,e)}},{key:"mergeWith",value:function Selection_mergeWith_(e){if(!e||!e.isSelection)return!1;var t=this.compareRangesForMerge(this.range,e.range);return"separate"!==t&&"bordering"!==t&&(this.range=this.range.merge(e.range),e.isReverse()!=this.isReverse()&&this.reverse(),!0)}},{key:"range",get:function get(){return this._range}},{key:"range",set:function set(e){if(e){var t=e,n=t.start,r=t.end;if(void 0!==n&&void 0!==r){var o=this.textMorph.document;if("number"==typeof n&&(e.start=n=o.indexToPosition(n)),"number"==typeof r&&(e.end=r=o.indexToPosition(r)),En.isValidLiteral(e)){if(n=o.clipPositionToLines(n),r=o.clipPositionToLines(r),this._isReverse=lessPosition(r,n)){var a=[r,n];n=a[0],r=a[1]}e.start=n,e.end=r,e.isRange||(e=new En(e)),e.equals(this._range)||(this._range=e,this._goalColumn=this.textMorph.lineWrapping?this.textMorph.columnInWrappedLine(this.lead):this.lead.column,this._goalX=this.textMorph.charBoundsFromTextPosition(this.lead).x,this.startAnchor.position=e.start,this.endAnchor.position=e.end,this.textMorph.makeDirty(),i.signal(this.textMorph,"selectionChange",this))}}}}},{key:"directedRange",get:function get(){return{end:this.lead,start:this.anchor}}},{key:"updateFromAnchors",value:function Selection_updateFromAnchors_(){this.range={start:this.startAnchor.position,end:this.endAnchor.position}}},{key:"start",get:function get(){return this.range.start}},{key:"start",set:function set(e){this.range=En.fromPositions(e,this.end)}},{key:"end",get:function get(){return this.range.end}},{key:"end",set:function set(e){this.range=En.fromPositions(this.start,e)}},{key:"selectionColor",get:function get(){return this.textMorph.selectionColor||"#bed8f7"}},{key:"anchor",get:function get(){return this.isReverse()?this.range.end:this.range.start}},{key:"anchor",set:function set(e){this.range={start:e,end:this.lead}}},{key:"lead",get:function get(){return this.isReverse()?this.range.start:this.range.end}},{key:"lead",set:function set(e){this.range={start:this.anchor,end:e}}},{key:"text",get:function get(){return this.textMorph.document.textInRange(this.range)}},{key:"text",set:function set(e){this.replace(e)}},{key:"replace",value:function Selection_replace_(e,t,n,r){var i=this.range,o=this.textMorph,a=this.isReverse();return this.range=o.replace(i,e,t,n,r),a&&this.reverse(),this.range}},{key:"selectedRows",get:function get(){return{first:this.start.row,last:this.end.row}}},{key:"reverse",value:function Selection_reverse_(){return this._isReverse=!this.isEmpty()&&!this._isReverse,this}},{key:"isReverse",value:function Selection_isReverse_(){return this._isReverse&&!this.isEmpty()}},{key:"isEmpty",value:function Selection_isEmpty_(){return this.range.isEmpty()}},{key:"collapse",value:function Selection_collapse_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.start;return this.range={start:e,end:e},this}},{key:"collapseToEnd",value:function Selection_collapseToEnd_(){return this.collapse(this.end),this}},{key:"growLeft",value:function Selection_growLeft_(e){var t=this.textMorph.document,n=t.positionToIndex(this.end),r=Math.min(n,t.positionToIndex(this.start)-e),i=this.isReverse();return this.start=t.indexToPosition(r),this._isReverse=i,this}},{key:"growRight",value:function Selection_growRight_(e){var t=this.textMorph.document,n=t.positionToIndex(this.start),r=Math.max(n,t.positionToIndex(this.end)+e),i=this.isReverse();return this.end=t.indexToPosition(r),this._isReverse=i,this}},{key:"selectAll",value:function Selection_selectAll_(){return this.range={start:{row:0,column:0},end:this.textMorph.document.endPosition},this}},{key:"selectLine",value:function Selection_selectLine_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.lead.row,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.range={start:{row:e,column:0},end:{row:t?e+1:e,column:t?0:this.textMorph.getLine(e).length}},this}},{key:"gotoLineEnd",value:function Selection_gotoLineEnd_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.lead.row,t={row:e,column:this.textMorph.getLine(e).length};this.range={start:t,end:t}}},{key:"selectLeft",value:function Selection_selectLeft_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.isEmpty()?(this.growLeft(e),this.reverse()):this.isReverse()?this.growLeft(e):this.growRight(-e),this}},{key:"selectRight",value:function Selection_selectRight_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.isReverse()?this.growLeft(-e):this.growRight(e),this}},{key:"selectUp",value:function Selection_selectUp_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments[1];return this.goUp(e,t,!0)}},{key:"selectDown",value:function Selection_selectDown_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments[1];return this.selectUp(-e,t)}},{key:"goUp",value:function Selection_goUp_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e)return this;var r=this._goalColumn,i=this._goalX;return this.lead=this.textMorph.getPositionAboveOrBelow(e,this.lead,t,r,i),n||(this.anchor=this.lead),this._goalColumn=r,this._goalX=i,this}},{key:"goDown",value:function Selection_goDown_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments[1];return this.goUp(-e,t)}},{key:"goLeft",value:function Selection_goLeft_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.isEmpty()&&this.growLeft(e),this.collapse(),this}},{key:"goRight",value:function Selection_goRight_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.isEmpty()&&this.growRight(e),this.collapseToEnd(),this}},{key:"cursorVisible",get:function get(){return this._cursorVisible&&this.textMorph.isFocused()&&!this.textMorph.rejectsInput()}},{key:"cursorBlinkStart",value:function Selection_cursorBlinkStart_(){var e=this;this.cursorBlinkStop();var t,n,r=z.text.cursorBlinkPeriod;r&&(t=e.textMorph,n=t.env.renderer.getNodeForMorph(t),e.cursorBlinkProcess=setInterval(function(){if(n||(n=t.env.renderer.getNodeForMorph(t)),n){e._cursorVisible=!e._cursorVisible;var r=n.className.split(" "),i=r.indexOf("hidden-cursor");e._cursorVisible&&i>-1&&(r.splice(i,1),n.className=r.join(" ")),e._cursorVisible||-1!==i||(n.className=[].concat(X(r),["hidden-cursor"]).join(" "))}},1e3*r))}},{key:"cursorBlinkStop",value:function Selection_cursorBlinkStop_(){this.cursorBlinkProcess&&clearInterval(this.cursorBlinkProcess),this.cursorBlinkProcess=null,this._cursorVisible=!0;var e=this.textMorph,t=e.env.renderer.getNodeForMorph(e);if(t){var n=t.className.split(" "),r=n.indexOf("hidden-cursor");r>-1&&(n.splice(r,1),t.className=n.join(" "))}}},{key:"toString",value:function Selection_toString_(){var e=this.anchor,t=e.row,n=e.column,r=this.lead;return"Selection("+t+"/"+n+" -> "+r.row+"/"+r.column+")"}}],void 0,t,void 0,{start:223,end:9050})}(void 0),In=function(e){var t=_classRecorder,n=t.hasOwnProperty("MultiSelection")&&"function"==typeof t.MultiSelection?t.MultiSelection:t.MultiSelection=function MultiSelection(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:"initialize",value:function MultiSelection_initialize_(e){this._selections=[new On(this.textMorph,e)]}},{key:"__deserialize__",value:function MultiSelection___deserialize___(e,t){this._selections=[]}},{key:"selections",get:function get(){return this._selections}},{key:"selections",set:function set(e){var t=this._selections?this._selections.filter(function(t){return!e.includes(t)}):[];this._selections=e,t.forEach(function(e){return e.uninstall()})}},{key:"isMultiSelection",get:function get(){return!0}},{key:"uninstall",value:function MultiSelection_uninstall_(){this.selections.forEach(function(e){return e.uninstall()})}},{key:"defaultSelection",get:function get(){return r.arr.last(this.selections)}},{key:"removeSelections",value:function MultiSelection_removeSelections_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.selections.slice(e);t.forEach(function(e){return e.uninstall()}),this.selections=r.arr.withoutAll(this.selections,t)}},{key:"disableMultiSelect",value:function MultiSelection_disableMultiSelect_(){r.arr.without(this.selections,this.defaultSelection).forEach(function(e){return e.uninstall()}),this.selections=[this.defaultSelection]}},{key:"range",get:function get(){return this.defaultSelection.range}},{key:"range",set:function set(e){this.disableMultiSelect(),this.defaultSelection.range=e}},{key:"updateFromAnchors",value:function MultiSelection_updateFromAnchors_(){this.selections.forEach(function(e){return e.updateFromAnchors()})}},{key:"start",get:function get(){return this.defaultSelection.start}},{key:"start",set:function set(e){this.defaultSelection.start=e}},{key:"end",get:function get(){return this.defaultSelection.end}},{key:"end",set:function set(e){this.defaultSelection.end=e}},{key:"anchor",get:function get(){return this.defaultSelection.anchor}},{key:"anchor",set:function set(e){this.defaultSelection.anchor=e}},{key:"lead",get:function get(){return this.defaultSelection.lead}},{key:"lead",set:function set(e){this.defaultSelection.lead=e}},{key:"text",get:function get(){return this.selections.map(function(e){return e.text}).join("\n")}},{key:"text",set:function set(e){this.selections.forEach(function(t){return t.text=e})}},{key:"selectedRows",get:function get(){return this.defaultSelection.selectedRows}},{key:"reverse",value:function MultiSelection_reverse_(){this.defaultSelection.reverse()}},{key:"isReverse",value:function MultiSelection_isReverse_(){return this.defaultSelection.isReverse()}},{key:"isEmpty",value:function MultiSelection_isEmpty_(){return this.defaultSelection.isEmpty()}},{key:"collapse",value:function MultiSelection_collapse_(e){return this.defaultSelection.collapse(e),this}},{key:"collapseToEnd",value:function MultiSelection_collapseToEnd_(){return this.defaultSelection.collapseToEnd(),this}},{key:"growLeft",value:function MultiSelection_growLeft_(e){return this.defaultSelection.growLeft(e),this}},{key:"growRight",value:function MultiSelection_growRight_(e){return this.defaultSelection.growRight(e),this}},{key:"selectAll",value:function MultiSelection_selectAll_(){return this.disableMultiSelect(),this.defaultSelection.selectAll(),this}},{key:"selectLine",value:function MultiSelection_selectLine_(e,t){return this.defaultSelection.selectLine(e,t),this}},{key:"gotoLineEnd",value:function MultiSelection_gotoLineEnd_(e){this.defaultSelection.gotoLineEnd(e)}},{key:"selectLeft",value:function MultiSelection_selectLeft_(e){return this.defaultSelection.selectLeft(e),this}},{key:"selectRight",value:function MultiSelection_selectRight_(e){return this.defaultSelection.selectRight(e),this}},{key:"selectUp",value:function MultiSelection_selectUp_(e,t){return this.defaultSelection.selectUp(e,t),this}},{key:"selectDown",value:function MultiSelection_selectDown_(e,t){return this.defaultSelection.selectDown(e,t),this}},{key:"goUp",value:function MultiSelection_goUp_(e,t){return this.defaultSelection.goUp(e,t)}},{key:"goDown",value:function MultiSelection_goDown_(e,t){return this.defaultSelection.goDown(e,t)}},{key:"goLeft",value:function MultiSelection_goLeft_(e){return this.defaultSelection.goLeft(e)}},{key:"goRight",value:function MultiSelection_goRight_(e){return this.defaultSelection.goRight(e)}},{key:"cursorVisible",get:function get(){return this.defaultSelection.cursorVisible}},{key:"style",set:function set(e){this.defaultSelection.style=e}},{key:"getTextAttributes",value:function MultiSelection_getTextAttributes_(){return this.defaultSelection.getTextAttributes()}},{key:"toString",value:function MultiSelection_toString_(){return"MultiSelection("+this.selections.join(", ")+")"}},{key:"mergeSelections",value:function MultiSelection_mergeSelections_(){for(var e=this.selections.slice(),t=e.length-1;t>=0;t--)for(var n=e.length-1;n>=0;n--)if(t!==n&&e[n].mergeWith(e[t])){e.splice(t,1);break}this.selections=e}},{key:"ranges",get:function get(){return this.selections.map(function(e){return e.range})}},{key:"ranges",set:function set(e){for(var t=0;t<e.length;t++){var n=this.selections[t];n?n.range=e[t]:this.addRange(e[t],!1)}this.removeSelections(t),this.mergeSelections()}},{key:"addRange",value:function MultiSelection_addRange_(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.selections.push(new On(this.textMorph,e)),t&&this.mergeSelections(),r.arr.last(this.selections).range}}],void 0,t,void 0,{start:9059,end:13620})}(On);function concatAttributePair(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",o="string"!=typeof e,a="string"!=typeof n;if(o||a){var s=[];return o?s.push(e,t):s.push(e+i,t),a?s.push(n,r):s.push(n+i,r),s}return t||r?t==r?[e+i+n,t]:t&&r&&function shallowEquals(e,t){if(!e||!t)return e==t;var n=!0,r={};for(var i in e)if(r[i]=!0,!t.hasOwnProperty(i)||e[i]!==t[i]){n=!1;break}if(n)for(var o in t)if(!(r[o]||e.hasOwnProperty(o)&&e[o]===t[o])){n=!1;break}return n}(t,r)?[e+i+n,t]:[e+i,t,n,r]:[e+i+n,t]}function joinTextAttributes(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(e.length<=2)return e;for(var n=[],r=$(e,2),i=r[0],o=r[1],a=2;a<e.length;a+=2){var s=concatAttributePair(i,o,e[a],e[a+1],t);if(s.length<=2)i=s[0],o=s[1];else{n.push.apply(n,X(s.slice(0,-2)));var l=s.slice(-2),u=$(l,2);i=u[0],o=u[1]}}return n.push(i,o),n}function splitTextAndAttributesAt(e,t){for(var n=0,r=0;r<e.length;r+=2){var i=e[r],o=n+("string"==typeof i?i.length:1);if(!(o<t)){if(n===t)return[e.slice(0,r),e.slice(r)];if(o===t)return[e.slice(0,r+2),e.slice(r+2)];if("string"!=typeof i)throw new Error("Assuming text is a string for splitting it, got "+i+" instead!");var a=e[r+1],s=t-n;return[[].concat(X(e.slice(0,r)),[i.slice(0,s),a]),i.length===s?e.slice(r+2):[i.slice(t-n),a].concat(X(e.slice(r+2)))]}n=o}return[e,[]]}function splitTextAndAttributesAtColumns(e,t){for(var n=e,r=0,i=[],o=0;o<t.length;o++){var a=splitTextAndAttributesAt(n,t[o]-r),s=$(a,2),l=s[0],u=s[1];i.push(l);for(var c=0;c<l.length;c+=2)r+="string"==typeof l[c]?l[c].length:1;n=u}return i.push(n),i}function concatTextAndAttributes(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e.length||2===e.length&&""==e[0])return n?t:t.slice();if(!t.length||2===t.length&&""==t[0])return n?e:e.slice();for(var r=n?e:e.slice(),i=0;i<t.length;i+=2){var o=t[i],a=t[i+1];r.push(o,a)}return r}function modifyAttributesInRange(e,t,n){var r=t.start,i=t.end;if(eqPosition(r,i))return null;if(lessPosition(i,r)){var o=[i,r];r=o[0],i=o[1]}var a=r,s=a.row,l=a.column,u=i,c=u.row,h=u.column,d=e.getLine(s),p=function(){var e=d.textAndAttributes,t=0,r=splitTextAndAttributesAt(e,l),i=$(r,2),o=i[0],a=i[1],u=void 0;if(e.length=0,textAndAttributesDo(o,function(n,r){t+="string"==typeof n?n.length:1,e.push(n,r)}),s===c){var p=splitTextAndAttributesAt(a,h-t),f=$(p,2);a=f[0],u=f[1]}if(textAndAttributesDo(a,function(t,r){return e.push(t,n(d,r))}),s===c&&textAndAttributesDo(u,function(t,n){return e.push(t,n)}),d._textAttributes=null,d.textAndAttributes=joinTextAttributes(e),s===c)return{v:void 0}}();if("object"===(void 0===p?"undefined":B(p)))return p.v;for(var f,y,m,g,v,x=function _loop(e){var t=(d=d.nextLine()).textAndAttributes,r=t.slice();t.length=0,textAndAttributesDo(r,function(e,r){return t.push(e,n(d,r))}),d._textAttributes=null,d.textAndAttributes=joinTextAttributes(t)},b=s+1;b<c;b++)x();f=(d=d.nextLine()).textAndAttributes,y=splitTextAndAttributesAt(f,h),m=$(y,2),g=m[0],v=m[1],f.length=0,textAndAttributesDo(g,function(e,t){return f.push(e,n(d,t))}),textAndAttributesDo(v,function(e,t){return f.push(e,t)}),d._textAttributes=null,d.textAndAttributes=joinTextAttributes(f)}function textAndAttributesDo(e,t){for(var n=0;n<e.length;n+=2)t(e[n],e[n+1])}function splitTextAndAttributesIntoLines(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\n";if(!e.length)return[];for(var n=[],r=[],i=0;i<e.length;i+=2){var o=e[i],a=e[i+1];if("string"==typeof o)for(;o.length;){var s=o.indexOf(t);if(-1===s){r.push(o,a);break}s>0&&r.push(o.slice(0,s),a),n.push(r),o=o.slice(s+1),r=[]}else r.push(o,a)}if(r.length)n.push(r);else{var l=e.slice(-2),u=$(l,2),c=u[0],h=u[1];"string"==typeof c&&c.endsWith(t)&&n.push(["",h])}return n}var Dn="",Nn={maxLeafSize:3,minLeafSize:2,leafSplit:.5,maxNodeSize:10,minNodeSize:5,nodeSplit:.5},Fn=function(e){var t=_classRecorder,n=t.hasOwnProperty("TreeNode")&&"function"==typeof t.TreeNode?t.TreeNode:t.TreeNode=function TreeNode(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function TreeNode_initialize_(e){this.parent=e}},{key:"root",get:function get(){return this.parent?this.parent.root:this}},{key:"isRoot",get:function get(){return!this.parent}},{key:"withParents",value:function TreeNode_withParents_(){for(var e=this,t=[];e;)t.push(e),e=e.parent;return t}},{key:"traverse",value:function TreeNode_traverse_(e){var t=[e.call(null,this)];if(this.isLeaf)return t;for(var n=0;n<this.children.length;n++)t.push.apply(t,X(this.children[n].traverse(e)));return t}},{key:"consistencyCheck",value:function TreeNode_consistencyCheck_(){var e=[],t=this.isRoot,n=this.isLeaf,i=this.children,o=this.size,a=this.stringSize,s=this.height,l=this.width,u=this.options,c=u.maxLeafSize,h=u.maxNodeSize,d=u.minLeafSize,p=u.minNodeSize;if(t||0!==o||e.push({error:"size of "+this+" expected to be > 0!"}),!Array.isArray(i))return e.push({error:this+".children is not an array but "+i}),e;var f=r.arr.sum(r.arr.pluck(i,"size"));f!=o&&e.push({error:"Sum of child sizes is not size of "+this+": "+f+" != "+o});var y=r.arr.sum(r.arr.pluck(i,"stringSize"));y!=a&&e.push({error:"Sum of child stringSize is not stringSIze of "+this+": "+y+" != "+a});var m=r.arr.sum(r.arr.pluck(i,"height"));Number.parseInt(m)!=Number.parseInt(s)&&e.push({error:"Sum of child Height is not Height of "+this+": "+m+" != "+s});var g=i.length?Math.max.apply(null,r.arr.pluck(i,"width")):0;Number.parseInt(g)!=Number.parseInt(l)&&e.push({error:"max width of children of "+this+" is not node width: "+g+" != "+l});var v=n?c:h,x=n?d:p;!t&&i.length>v&&e.push({error:"children count of "+this+" expected to be between "+x+" and "+v+" but is "+i.length});for(var b=0;b<i.length;b++){var w=i[b];w?(n&&!w.isLine?e.push({error:"child "+b+" of leaf "+this+" is not a line!"}):!n&&w.isLine&&e.push({error:"child of non-leaf "+this+" is a line!"}),this!==w.parent&&e.push({error:"child.parent is "+w.parent+" but should be "+this})):e.push({error:"child "+b+" of "+this+" is nullish!"})}return e.push.apply(e,X(r.arr.flatmap(i,function(e){return e.consistencyCheck()}))),e}}],void 0,t,void 0,{start:1416,end:4438})}(void 0),Bn=function(e){var t=_classRecorder,n=t.hasOwnProperty("InnerTreeNode")&&"function"==typeof t.InnerTreeNode?t.InnerTreeNode:t.InnerTreeNode=function InnerTreeNode(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function InnerTreeNode_initialize_(e){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(n.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e.parent),this.options=e.options,this.children=e.children,this.size=e.size,this.stringSize=e.stringSize,this.height=e.height,this.width=e.width,this.isLeaf=!0}},{key:"isNode",get:function get(){return!0}},{key:"resize",value:function InnerTreeNode_resize_(e,t,n){this.size=this.size+e,this.height=this.height+t,this.stringSize=this.stringSize+n;for(var r=0,i=0;i<this.children.length;i++){var o=this.children[i].width;o>r&&(r=o)}this.width=r,this.parent&&this.parent.resize(e,t,n)}},{key:"lines",value:function InnerTreeNode_lines_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(this.isLeaf)return e.push.apply(e,X(this.children)),e;for(var t=0;t<this.children.length;t++)this.children[t].lines(e);return e}},{key:"findRow",value:function InnerTreeNode_findRow_(e){if(e<0||e>=this.size)return null;if(this.isLeaf)return this.children[e];for(var t=0;t<this.children.length;t++){var n=this.children[t],r=n.size;if(e<r)return n.findRow(e);e-=r}return null}},{key:"findLineByVerticalOffset",value:function InnerTreeNode_findLineByVerticalOffset_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e<0||e>this.height)return null;for(var r=0;r<this.children.length;r++){var i=this.children[r],o=i.height;if(e<=o)return this.isLeaf?{line:i,offset:e,y:t,row:n}:i.findLineByVerticalOffset(e,t,n);e-=o,t+=o,n+=i.size}return null}},{key:"computeVerticalOffsetOf",value:function InnerTreeNode_computeVerticalOffsetOf_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e<0||e>=this.size)return console.warn("strange row in computeVerticalOffsetOf: "+e),t;if(this.isLeaf){for(var n=0;n<Math.min(e,this.children.length);n++)t+=this.children[n].height;return t}for(var r=0;r<this.children.length;r++){var i=this.children[r],o=i.size;if(e<o)return i.computeVerticalOffsetOf(e,t);e-=o,t+=i.height}return t}},{key:"ensureLine",value:function InnerTreeNode_ensureLine_(e){e||(e="");var t="string"==typeof e;if(!t&&e.isLine)return e.parent=this,e;var n=t?[e,null]:e.textAndAttributes||[e.text||"",null],r=t?0:e.width||0,i=t?0:e.height||0;return new jn({parent:this,width:r,height:i,textAndAttributes:n})}},{key:"insert",value:function InnerTreeNode_insert_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.size,n=this.children,r=this.options;if(this.isLeaf){for(var i=[],o=0,a=0,s=0;s<e.length;s++){var l=this.ensureLine(e[s]);i.push(l),o+=l.height,a+=l.stringSize,n.splice(t++,0,l)}return this.resize(i.length,o,a),this.balanceAfterGrowth(),i}0===n.length&&n.push(new Bn({parent:this,children:[],size:0,stringSize:0,width:0,height:0,options:r}));for(s=0;s<n.length;s++){var u=n[s],c=u.size;if(t<=c)return u.insert(e,t);t-=c}var h=n[s-1];return h.insert(e,h.size)}},{key:"withParentChainsUpToCommonParentDo",value:function InnerTreeNode_withParentChainsUpToCommonParentDo_(e,t,n){for(var r=this.withParents(),i=e,o=void 0,a=0;i;){if(r.includes(i)){o=i;break}t(i,a++),i=i.parent}var s=r.indexOf(o);s<0&&(s=r.length);for(var l=r.slice(0,s),u=0;u<l.length;u++)n(l[u],u)}},{key:"findLineWithTextIndex",value:function InnerTreeNode_findLineWithTextIndex_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.isLeaf){for(var n=0;n<this.children.length;n++){var i=this.children[n],o=i.stringSize;if(e<o)return{line:i,column:e,row:t};e-=o,t++}var a=r.arr.last(this.children);return{line:a,row:t-1,column:a.stringSize-1}}for(var s=0,l=0;l<this.children.length;l++){var u=this.children[l],c=u.stringSize;if(e<s+c)return u.findLineWithTextIndex(e-s,t);t+=u.size,s+=c}return r.arr.last(this.children).findLineWithTextIndex(e-s)}},{key:"findLeafs",value:function InnerTreeNode_findLeafs_(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e>n+this.size||t<n)return[];if(this.isLeaf){var r=Math.max(0,e-n),i=this.children.length-1,o=Math.min(i,t-n),a=!1;return 0===r&&o===i&&(a=!0,o=i),[{node:this,firstLine:r,lastLine:o,full:a}]}for(var s=[],l=0;l<this.children.length;l++){var u=this.children[l];s.push.apply(s,X(u.findLeafs(e,t,n))),n+=u.size}return s}},{key:"removeFromToInRoot",value:function InnerTreeNode_removeFromToInRoot_(e,t,n){var i=this;if(!this.isRoot)throw new Error("removeFromTo() should be called on the root node");if(e>t){var o=[t,e];e=o[0],t=o[1]}var a=this.size,s=this.options,l=(s.maxLeafSize,s.minLeafSize),u=this.findLeafs(e,t),c=u.shift(),h=u.pop(),d=u,p=[],f=void 0,y=void 0,m=!1,g=!1;if(!(e>=a)){if(h&&c.node===h.node&&(h=null),c.full)n&&n.log("Removing complete first line "+c),d.push(c);else{var v=c.lastLine-c.firstLine+1;m=c.node.children.length-v<l}if(h)if(h.full)n&&n.log("Removing complete last line "+h),d.push(h);else{var x=h,b=x.lastLine-x.firstLine+1;g=x.node.children.length-b<l}if(m||g){var w=c.node.children[0].prevLine();f=w?w.parent:null;var _=r.arr.last(h?h.node.children:c.node.children).nextLine();y=_?_.parent:null}for(var k=0;k<d.length;k++){for(var S=d[k].node,M=S.children.length,C=0,P=0,T=0;T<M;T++){var A=S.children[T];C+=A.height,P+=A.stringSize,A.parent=null}S.children.length=0,S.resize(-M,-C,-P);var L=S.parent;L&&(S.parent=null,L.children.splice(L.children.indexOf(S),1),p.includes(L)||p.push(L))}if(!c.full){for(var R=c.lastLine,E=c.firstLine,z=c.node,O=z.children,I=(z.options,R-E+1),D=O.splice(E,I),N=0,F=0,B=0;B<D.length;B++){var j=D[B];N+=j.height,F+=j.stringSize,j.parent=null}z.resize(-I,-N,-F)}if(h&&!h.full){for(var W=h,H=W.lastLine,V=W.firstLine,U=W.node,q=H-V+1,G=U.children.splice(V,q),$=0,K=0,X=0;X<G.length;X++){var Y=G[X];$+=Y.height,K+=Y.stringSize,Y.parent=null}U.resize(-q,-$,-K)}if(n&&n.dump(""+this.print(!1)),m&&c.node.balanceByMergeOrTheft(f,!h||h.full?y:h.node,n),h&&g&&h.node.root===this){var J=!0,Q=c.full||!c.node.parent?f:c.node;m&&(h.node.root!==this&&(J=!1),Q&&Q.root!==this&&(Q=null),y&&y.root!==this&&(y=null)),J&&h.node.balanceByMergeOrTheft(Q,y,n)}p.forEach(function(e){return e.root===i&&e.balanceAfterShrink(n)})}}},{key:"balanceByMergeOrTheft",value:function InnerTreeNode_balanceByMergeOrTheft_(e,t,n){var r=this,i=this.children,o=this.options,a=this.isLeaf,s=a?o.maxLeafSize:o.maxNodeSize,l=a?o.minLeafSize:o.minNodeSize,u=(i.length,e&&e.children.length+i.length<=s),c=!u&&t&&t.children.length+i.length<=s,h=u?e:c?t:null;if(h){var d,p;n&&n.log("[balanceByMergeOrTheft] merging "+this+" "+(u?"left":"right")+" into "+h);var f=this.size,y=this.width,m=this.height,g=this.stringSize;i.forEach(function(e){return e.parent=h}),u?(d=h.children).push.apply(d,X(i)):(p=h.children).unshift.apply(p,X(i)),i.length=0,this.width=0,this.withParentChainsUpToCommonParentDo(h,function(e){y>e.width&&(e.width=y),e.height=e.height+m,e.size=e.size+f,e.stringSize=e.stringSize+g},function(e){if(y===e.width)for(var t=0;t<e.children.length;t++){var n=e.children[t];n.width>e.width&&(e.width=n.width)}e.height=e.height-m,e.size=e.size-f,e.stringSize=e.stringSize-g})}else{var v=e?Math.ceil((e.children.length-l)/2):0,x=t?Math.ceil((t.children.length-l)/2):0,b=v>0&&v>=x;if(b||!b&&x>0){var w,_,k=b?e.children.splice(e.children.length-v,v):t.children.splice(0,x),S=b?e:t,M=b?v:x,C=0,P=0,T=0,A=0;n&&n.log("[balanceByMergeOrTheft] "+this+" steals from "+(b?"left":"right")+" node "+S+" "+M+" nodes");for(var L=0;L<k.length;L++)C+=k[L].height,P+=k[L].stringSize,T=Math.max(T,k[L].width);for(var R=0;R<S.children.length;R++)A=Math.max(A,S.children[R].width);this.withParentChainsUpToCommonParentDo(S,function(e){if(A<T&&A<e.width){if(e===S)e.width=A;else{for(var t=!1,n=0;n<e.children.length;n++){if(e.children[n].width>A){t=!0;break}}t||(e.width=A)}e.width=T}e.height=e.height-C,e.size=e.size-M,e.stringSize=e.stringSize-P},function(e){e.width<T&&(e.width=T),e.height=e.height+C,e.size=e.size+M,e.stringSize=e.stringSize+P}),k.forEach(function(e){return e.parent=r}),b?(w=this.children).unshift.apply(w,X(k)):(_=this.children).push.apply(_,X(k))}}var E=this.parent;0===i.length&&(this.parent=null,E&&E.children.splice(E.children.indexOf(this),1)),E&&E.balanceAfterShrink(n)}},{key:"balanceAfterGrowth",value:function InnerTreeNode_balanceAfterGrowth_(){var e=this.isLeaf,t=this.size,n=this.stringSize,r=this.parent,i=this.children,o=this.width,a=this.height,s=this.options,l=e?s.maxLeafSize:s.maxNodeSize;if(i.length>l){r||((r=this.parent=new Bn({parent:null,children:[this],size:t,width:o,height:a,stringSize:n,options:s})).isLeaf=!1);for(var u=Math.floor(i.length/2),c=0,h=0,d=0,p=0,f=0,y=0,m=0,g=0,v=0;c<u;c++)h+=i[c].size,p=Math.max(p,i[c].width),y+=i[c].height,g+=i[c].stringSize;for(;c<i.length;c++)d+=i[c].size,f=Math.max(f,i[c].width),m+=i[c].height,v+=i[c].stringSize;this.children=i.slice(0,u),this.size=h,this.width=p,this.height=y,this.stringSize=g;var x=r.children.indexOf(this),b=i.slice(u),w=new Bn({parent:r,children:b,size:d,height:m,width:f,stringSize:v,options:s});w.isLeaf=e,b.forEach(function(e){return e.parent=w}),r.children.splice(x+1,0,w),w.children.length>l&&w.balanceAfterGrowth(),this.children.length>l&&this.balanceAfterGrowth(),this.parent.balanceAfterGrowth()}}},{key:"balanceAfterShrink",value:function InnerTreeNode_balanceAfterShrink_(e){for(var t=this,n=this.isLeaf,i=this.parent,o=this.children,a=this.options,s=a.maxLeafSize,l=a.maxNodeSize,u=a.minLeafSize,c=a.minNodeSize,h=n?s:l,d=n?u:c,p=!1,f=o.length;f--;)0===o[f].size&&(o.splice(f,1),p=!0,e&&e.log("[balanceAfterShrink] "+this+" removes node "+f+" b/c it is empty, remaining children: "+o.length+" (min: "+d+", max: "+h+")"));if(p&&e&&e.dump(""+this.root.print(!1)),o.length>=d)i&&i.balanceAfterShrink(e);else if(0!==o.length)if(n){if(i)if(1===i.children.length){var y;e&&e.log("[balanceAfterShrink] "+this+" is the only child - will remove it's parent and take its position"),e&&e.dump(""+this.root.print(!1)),this.parent=null,i.children.length=0,(y=i.children).push.apply(y,X(o)),o.forEach(function(e){return e.parent=i}),i.isLeaf=!0}else{var m=o[0].prevLine(),g=m&&m.parent,v=r.arr.last(o).nextLine(),x=v&&v.parent;this.balanceByMergeOrTheft(g,x,e)}this.parent&&this.parent.balanceAfterShrink(e)}else{for(var b=[],w=!1,_=!1,k=!1,S=0;S<o.length;S++){var M=o[S];if(!w&&M.isLeaf&&(w=!0),_||M.isLeaf||(_=!0),w&&_){k=!0;break}b.push.apply(b,X(M.children))}var C=w;!k&&b.length<=(C?s:l)&&(e&&e.log("[balanceAfterShrink] "+this+" grandChildren.length is "+b.length+" and <= max size so it is removing all its children and adopting their children"),o.forEach(function(e){return e.parent=null}),b.forEach(function(e){return e.parent=t}),o.length=0,o.push.apply(o,b),this.isLeaf=C,e&&e.log("[balanceAfterShrink] "+o.join("\n")),e&&e.dump(""+this.root.print(!1))),i&&i.balanceAfterShrink(e)}else i&&i.balanceAfterShrink(e)}},{key:"print",value:function InnerTreeNode_print_(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments[3],i=this.isLeaf,o=this.size,a=this.stringSize,s=this.width,l=this.height,u=this.children,c=r||(i?"leaf":"node"),h=""+" ".repeat(n)+c+" (size: "+o+" width: "+Math.round(s)+" height: "+Math.round(l)+" text length: "+a+")";if(u.length){for(var d="",p=t+o,f=u.length;f--;){var y=u[f];p-=y.size,d="\n"+y.print(e,p,n+1)+d}h+=d}return h}},{key:"toString",value:function InnerTreeNode_toString_(){var e=this.isLeaf,t=this.size,n=this.width,i=this.height,o=this.children;return"node ("+(e?"leaf, ":"")+(e&&o.length?"rows: "+o[0].row+"-"+r.arr.last(o).row+" ":"")+"size: "+t+" "+n+"x"+i+")"}}],void 0,t,void 0,{start:4441,end:28527})}(Fn),jn=function(e){var t=_classRecorder,n=t.hasOwnProperty("Line")&&"function"==typeof t.Line?t.Line:t.Line=function Line(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function Line_initialize_(e){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(n.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e.parent),this.textAndAttributes=joinTextAttributes(e.textAndAttributes||[]),this._text="",this._textAttributes=null,this.width=e.width,this.height=e.height,this.hasEstimatedExtent=!1,this.modeState=null,this.textAlign="left",this.lineHeight=null,this.marginTop=0,this.marginBottom=0}},{key:"isLine",get:function get(){return!0}},{key:"size",get:function get(){return 1}},{key:"stringSize",get:function get(){return this.text.length+1}},{key:"text",get:function get(){if(this._text)return this._text;for(var e="",t=this.textAndAttributes,n=0;n<t.length;n+=2)e+="string"==typeof t[n]?t[n]:Dn;return this._text=e}},{key:"textAttributes",get:function get(){if(this._textAttributes)return this._textAttributes;for(var e=[],t=this.textAndAttributes,n=0;n<t.length;n+=2){var r=t[n+1];r&&!e.includes(r)&&e.push(r)}return this._textAttributes=e}},{key:"row",get:function get(){if(!this.parent)return 0;var e=this.withParents();if(1===e.length)return e.children.indexOf(this);for(var t=0,n=e.length-1;n>=1;n--)for(var r=e[n],i=e[n-1],o=r.children.indexOf(i),a=0;a<o;a++)t+=r.children[a].size;return t}},{key:"nextLine",value:function Line_nextLine_(){var e=this.parent;if(!e)return null;var t=e.children[e.children.indexOf(this)+1];if(t)return t;var n=this.root,r=this.row;return n.findRow(r+1)}},{key:"prevLine",value:function Line_prevLine_(){var e=this.parent;if(!e)return null;var t=e.children[e.children.indexOf(this)-1];if(t)return t;var n=this.root,r=this.row;return n.findRow(r-1)}},{key:"changeExtent",value:function Line_changeExtent_(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.height,i=this.width,o=this.parent;if(this.width=e,this.height=t,this.hasEstimatedExtent=n,i!==e||r!==t)for(var a=t-r;o;){if(o.height=o.height+a,e>=o.width)o.width=e;else if(i===o.width){for(var s=0,l=0;l<o.children.length;l++){var u=o.children[l].width;u>s&&(s=u)}o.width=s}o=o.parent}return this}},{key:"changeText",value:function Line_changeText_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.parent,r=this.text,i=this.height,o=e.length+1-(r.length+1),a=0;if(this.modeState&&this.modeState._string!==e&&(this.modeState=null),this.height||this.width?this.hasEstimatedExtent=!0:(this.height=0,this.width=0,this.hasEstimatedExtent=!1,a=-i),this._text=e,this._textAttributes=null,this.textAndAttributes=t||(t=[e,null]),t.length%2!=0)throw new Error("textAndAttributes list is strange, expected flat pairs of text/attr");for(var s=0;s<t.length;s+=2){t[s];var l=t[s+1];if(l&&Array.isArray(l))throw new Error("invalid attr part of text/attr pair, its an array: "+l)}for(;n;){n.stringSize=n.stringSize+o,n.height=n.height+a;for(var u=0,c=0;c<n.children.length;c++){var h=n.children[c].width;h>u&&(u=h)}n.width=u,n=n.parent}return this}},{key:"changeTextAndAttributes",value:function Line_changeTextAndAttributes_(e){e=joinTextAttributes(e);for(var t="",n=0;n<e.length;n+=2)t+="string"==typeof e[n]?e[n]:Dn;return this.changeText(t,e)}},{key:"print",value:function Line_print_(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=" ".repeat(n),o=this.width,a=this.height,s=this.stringSize,l=this.textAndAttributes,u=i+"line "+t+" (size: 1 width: "+Math.round(o)+" height: "+Math.round(a)+" text length: "+s,c=r.arr.toTuples(l,2).map(function printTextAttrTuple(e){var t=$(e,2),n=t[0],r=t[1];return("string"==typeof n?'"'+n+'"':String(n))+","+JSON.stringify(r)}).join(",");return u+(e?")":" content: ["+c+"])")}},{key:"toString",value:function Line_toString_(){var e=this.width,t=this.height,n=this._text;return'line ("'+r.string.truncate(n,30)+'", '+e+"x"+t+")"}},{key:"consistencyCheck",value:function Line_consistencyCheck_(){var e=[];if(!this.parent)return e.push("line "+this+" has no parent!"),e}}],void 0,t,void 0,{start:28537,end:34881})}(Fn),Wn={makeString:function makeString(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,n=r.arr.range(65,90).map(function(e){return String.fromCharCode(e)}).join("");n+=n.toLowerCase()+" \n";var i=r.num.random(e,t);return r.arr.shuffle(Array.from(n.repeat(Math.ceil(i/n.length)))).slice(0,i).join("")},randomDocPosition:function randomDocPosition(e){var t=0===e.rowCount?0:r.num.random(0,e.rowCount-1);return{row:t,column:r.num.random(0,e.getLineString(t).length-1)}},insertRandom:function insertRandom(e,t,n,r){var i=[this.makeString(n,r),null],o=this.randomDocPosition(e);t.push(["insertTextAndAttributes",i,o]),e.insertTextAndAttributes(i,o)},deleteRandom:function deleteRandom(e,t,n,r){var i={start:this.randomDocPosition(e),end:this.randomDocPosition(e)};t.push(["remove",i]),e.remove(i)},maybe:function maybe(){return Math.random()<.5},replay:function replay(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n&&(e.debug=n,(n=e.debugHelper()).reset());var i=new Hn([""]);t.forEach(function(e,o){var a=K(e),s=a[0],l=a.slice(1);r&&t.length,i[s].apply(i,X(l).concat([n]))}),e.changeDocument(i)},run:function run(){var e=Date.now(),t=0,n=new Hn([],{maxLeafSize:3,minLeafSize:2,leafSplit:.5,maxNodeSize:10,minNodeSize:5,nodeSplit:.5}),r=[],i=void 0;try{for(;n.stringSize<1e4&&t++<1e4;)this.maybe()?this.deleteRandom(n,r):this.insertRandom(n,r),n.consistencyCheck()}catch(e){i=e}return{error:i,doc:n,actions:r,time:Date.now()-e}}},Hn=function(e){var t=_classRecorder,n=t.hasOwnProperty("Document")&&"function"==typeof t.Document?t.Document:t.Document=function Document(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function Document_initialize_(e,t){this.options=Object.assign({},Nn,{},t),this.lines=e}},{key:"balance",value:function Document_balance_(){this.root.balanceAfterGrowth(),this.fixRoot()}},{key:"fixRoot",value:function Document_fixRoot_(){var e=this.root.root;this.root!==e&&(this.root=e)}},{key:"height",get:function get(){return this.root.height}},{key:"width",get:function get(){return this.root.width}},{key:"rowCount",get:function get(){return this.root.size}},{key:"stringSize",get:function get(){return 0===this.rowCount?0:this.root.stringSize-1}},{key:"lineStrings",get:function get(){return this.lines.map(function(e){return e.text})}},{key:"lines",get:function get(){return this.root.lines()}},{key:"lines",set:function set(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.root=new Bn({parent:null,children:[],size:0,width:0,height:0,stringSize:0,options:this.options}),this.insertLines(e)}},{key:"clipRow",value:function Document_clipRow_(e){return Math.max(0,Math.min(e,this.rowCount-1))}},{key:"clipPositionToLines",value:function Document_clipPositionToLines_(e){var t=e.row,n=e.column,r=this.rowCount;if(0===r)return{row:0,column:0};if(t<0?t=0:t>=r&&(t=r-1,n=1/0),n<0)n=0;else{var i=this.getLineString(t).length;n>i&&(n=i)}return{row:t,column:n}}},{key:"findLineByVerticalOffset",value:function Document_findLineByVerticalOffset_(e){return this.root.findLineByVerticalOffset(e)}},{key:"computeVerticalOffsetOf",value:function Document_computeVerticalOffsetOf_(e){return this.root.computeVerticalOffsetOf(e)}},{key:"getLine",value:function Document_getLine_(e){return this.root.findRow(this.clipRow(e))}},{key:"getLineString",value:function Document_getLineString_(e){var t=this.getLine(e);return t?t.text:""}},{key:"insertLine",value:function Document_insertLine_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.root.rowCount;return this.insertLines([e],t)[0]}},{key:"removeLine",value:function Document_removeLine_(e){this.root.removeFromToInRoot(e,e)}},{key:"removeLines",value:function Document_removeLines_(e,t,n){this.root.removeFromToInRoot(e,t,n)}},{key:"insertLines",value:function Document_insertLines_(e,t){var n=this.root.insert(e,t);return this.fixRoot(),n}},{key:"textString",get:function get(){var e="",t=this.lines;if(!t.length)return e;for(var n=0;n<t.length-1;n++)e=e+t[n].text+"\n";return e+=t[n].text}},{key:"textString",set:function set(e){this.lines=e.split("\n")}},{key:"endPosition",get:function get(){var e=this.rowCount;if(0===e)return{row:0,column:0};var t=e-1;return{row:t,column:this.getLine(t).stringSize-1}}},{key:"textAndAttributes",get:function get(){var e=this.lines;if(!e.length)return n;for(var t=e.length-1,n=e[0].textAndAttributes.slice(),r=1;r<=t;r++){var i=e[r],o=n.pop()||null,a=n.pop()||"",s=i.textAndAttributes,l=s[0]||"",u=s[1]||null;n.push.apply(n,X(concatAttributePair(a,o,l,u,"\n")));for(var c=2;c<s.length;c+=2)n.push(s[c],s[c+1])}return n}},{key:"textAndAttributes",set:function set(e){this.lines=splitTextAndAttributesIntoLines(e,"\n").map(function(e){return new jn({parent:null,width:0,height:0,textAndAttributes:e})})}},{key:"getTextAndAttributesOfLine",value:function Document_getTextAndAttributesOfLine_(e){return this.getLine(e).textAndAttributes}},{key:"setTextAndAttributesOfLine",value:function Document_setTextAndAttributesOfLine_(e,t){return this.getLine(e).changeTextAndAttributes(t),t}},{key:"mixinTextAttribute",value:function Document_mixinTextAttribute_(e,t){modifyAttributesInRange(this,t,function(t,n){return t._textAttributes=null,Object.assign({},n,e)})}},{key:"setTextAttribute",value:function Document_setTextAttribute_(e,t){modifyAttributesInRange(this,t,function(t,n){return t._textAttributes=null,e})}},{key:"mixoutTextAttribute",value:function Document_mixoutTextAttribute_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{start:{row:0,column:0},end:this.endPosition};if(e){var n=Object.keys(e);modifyAttributesInRange(this,t,function(e,t){if(!t)return t;e._textAttributes=null;var r=0,i={};for(var o in t)n.includes(o)||(i[o]=t[o],r++);return 0===r?null:i})}}},{key:"setTextAttributesWithSortedRanges",value:function Document_setTextAttributesWithSortedRanges_(e){if(!(e.length<2)){var t=e[0].start,n=e.slice(-2)[0].end,r=this.getLine(t.row);if(t.row!==n.row){var i=t.row,o=t.column,a=0,s=textAndAttributesFromRangedAttributesForRow(i,r.text,e,a),l=s.attributes,u=s.index,c=splitTextAndAttributesAt(r.textAndAttributes,o),h=$(c,2),d=h[0],p=(h[1],splitTextAndAttributesAt(l,o)),f=$(p,2),y=(f[0],f[1]);for(r.changeTextAndAttributes([].concat(X(d),X(y))),a=u;(r=r.nextLine())&&++i!==n.row;){var m=textAndAttributesFromRangedAttributesForRow(i,r.text,e,a),g=m.attributes;a=m.index,r.changeTextAndAttributes(g)}if(r){var v=n.column,x=textAndAttributesFromRangedAttributesForRow(i,r.text,e,a).attributes,b=splitTextAndAttributesAt(r.textAndAttributes,v),w=$(b,2),_=(w[0],w[1]),k=splitTextAndAttributesAt(x,v),S=$(k,1)[0];r.changeTextAndAttributes([].concat(X(S),X(_)))}}else{if(t.column>=n.column)return;var M=textAndAttributesFromRangedAttributesForRow(t.row,r.text,e,0).attributes,C=splitTextAndAttributesAtColumns(r.textAndAttributes,[t.column,n.column]),P=$(C,3),T=P[0],A=(P[1],P[2]),L=splitTextAndAttributesAtColumns(M,[t.column,n.column]),R=$(L,3),E=(R[0],R[1]);R[2];r.changeTextAndAttributes([].concat(X(T),X(E),X(A)))}}function textAndAttributesFromRangedAttributesForRow(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=0,o=t.length;if(n.length-r<=0)return{attributes:[t,null],index:r};for(var a=[],s=r;s<n.length&&!(i>=o);s+=2){var l=n[s],u=l.start,c=l.end,h=n[s+1];if(c.row<e)i=0;else{if(u.row===e&&i<u.column&&(a.push(t.slice(i,u.column),null),i=u.column),c.row>e){a.push(t.slice(i,o),h),i=o;break}i<c.column&&a.push(t.slice(i,c.column),h),i=c.column}}return i<o&&a.push(t.slice(i,o),null),{attributes:a,index:s}}}},{key:"resetTextAttributes",value:function Document_resetTextAttributes_(){this.lines.forEach(function(e){return e.changeText(e.text)})}},{key:"textAttributeAt",value:function Document_textAttributeAt_(e){var t=e.row,n=e.column;n=Math.max(0,n);var r=this.getLine(t);if(!r)return null;for(var i=0,o=r.textAndAttributes,a=0;a<o.length;a+=2){var s=o[a],l=o[a+1];if(n<(i+="string"==typeof s?s.length:1))return l}return o[o.length-1]}},{key:"textAndAttributesInRange",value:function Document_textAndAttributesInRange_(e){var t=e.start,n=e.end;if(eqPosition(t,n))return["",null];if(lessPosition(n,t)){var r=[n,t];t=r[0],n=r[1]}t=maxPosition(t,{column:0,row:0}),n=minPosition(n,this.endPosition);var i=this.getLine(t.row),o=i;if(n.row===t.row){var a=t.column,s=n.column;a===s&&s++;var l=splitTextAndAttributesAtColumns(o.textAndAttributes,[a,s]),u=$(l,2);u[0];return u[1]}for(var c=[i],h=0;h<n.row-t.row;h++)c.push(i=i.nextLine());var d=c[c.length-1],p=splitTextAndAttributesAt(o.textAndAttributes,t.column),f=$(p,2),y=(f[0],f[1]),m=splitTextAndAttributesAt(d.textAndAttributes,n.column),g=$(m,1)[0];if(0===y.length&&(y=["",null]),1===c.length)return concatTextAndAttributes(y,g,!0);for(var v=y,x=1;x<c.length-1;x++)"string"==typeof v[v.length-2]&&(v[v.length-2]=v[v.length-2]+"\n"),concatTextAndAttributes(v,c[x].textAndAttributes,!0);return"string"==typeof v[v.length-2]&&(v[v.length-2]=v[v.length-2]+"\n"),concatTextAndAttributes(v,g,!0),joinTextAttributes(v,"")}},{key:"textInRange",value:function Document_textInRange_(e){var t=e.start,n=e.end;if(t=this.clipPositionToLines(t),lessPosition(n=this.clipPositionToLines(n),t)){var r=[n,t];t=r[0],n=r[1]}var i=t,o=i.row,a=i.column,s=n,l=s.row,u=s.column;if(o===l)return a===u?"":this.getLineString(o).slice(a,u);for(var c=this.getLine(o),h=c.text.slice(a);(c=c.nextLine())&&++o<l;)h+="\n"+c.text;return h+"\n"+this.getLineString(l).slice(0,u)}},{key:"setTextInRange",value:function Document_setTextInRange_(e,t){return this.remove(t),this.insertText(e,t.start,!1)}},{key:"indexToPosition",value:function Document_indexToPosition_(e){e<0&&(e=0);var t=this.root.findLineWithTextIndex(e,0);return{row:t.row,column:t.column}}},{key:"positionToIndex",value:function Document_positionToIndex_(e){for(var t=e.row,n=e.column,r=this.getLine(t),i=n=Math.max(0,Math.min(n,r.stringSize-1)),o=r.parent,a=r;o;){for(var s=o.children.indexOf(a),l=o.children.slice(0,s),u=0;u<l.length;u++)i+=l[u].stringSize;a=o,o=o.parent}return i}},{key:"insertTextAndAttributes",value:function Document_insertTextAndAttributes_(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||!e.length||2===e.length&&!e[0])return{start:t,end:t};n&&!n.debugDocumentUpdate&&(n=!1),n&&!n.log&&(n=console);var i=t.row,o=t.column;i<0&&(i=0),o<0&&(o=0);var a=this.getLine(i),s=splitTextAndAttributesIntoLines(e,"\n");if(n&&(n.log||(n={log:console.log.bind(console),dump:console.log.bind(console)})),!a){var l=this.insertLines(s.map(function(e){return new jn({parent:null,width:0,height:0,textAndAttributes:e})}));return n&&n.log("insert "+l.length+" lines into empty text"),{start:{row:0,column:0},end:{row:l.length,column:r.arr.last(l).text.length}}}if(i>=this.rowCount){var u=this.endPosition;n&&n.log("insertion after doc end, "+i+"/"+o+", inserting "+(i-u.row)+" rows");for(var c=0;c<i-u.row;c++)s.unshift(["",null]);i=u.row,o=u.column}if(1===s.length&&""===s[0][0]){n&&n.log("insert just newline at "+i+"/"+o);var h=this.splitLineAt({row:i,column:o});return n&&n.dump(""+this.root.print(!1)),h}var d=s.shift(),p=s.length,f={row:i,column:o},y=a.stringSize-1;if(o>y){n&&n.log("filling up insertion column at "+i+"/"+o+": "+(o-y));var m=" ".repeat(o-y);d.length?"string"==typeof d[0]?d[0]=m+d[0]:d.unshift(m,null):d.push(m,null)}var g=splitTextAndAttributesAt(a.textAndAttributes,o),v=$(g,2),x=v[0],b=v[1];""===x[0]&&(x=[]);var w=concatTextAndAttributes(x,d,!0);if(0===p){for(var _=0,k=0;k<d.length;k+=2){var S=d[k];_+="string"==typeof S?S.length:1}f.column=o+_,concatTextAndAttributes(w,b,!0)}if(a.changeTextAndAttributes(w),0===p)return n&&(n.log("single line inserted at "+i+"/"+o),n&&n.dump(""+this.root.print(!1))),{start:{row:i,column:o},end:f};for(var M=s[p-1],C=0,P=0;P<M.length;P+=2){var T=M[P];C+="string"==typeof T?T.length:1}f.row+=p,f.column=C;var A=this.insertLines(s.map(function(e){return new jn({parent:null,width:0,height:0,textAndAttributes:e})}),i+1),L=r.arr.last(A);return L.changeTextAndAttributes(concatTextAndAttributes(L.textAndAttributes,b,!0)),n&&(n.log(A.length+" inserted at "+i+"/"+o),n&&n.dump(""+this.root.print(!1))),{start:{row:i,column:o},end:f}}},{key:"insertText",value:function Document_insertText_(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)return{start:t,end:t};var i=t.row,o=t.column;i<0&&(i=0),o<0&&(o=0);var a=this.getLine(i);if(!a){var s=this.insertLines(e.split("\n"));return{start:{row:0,column:0},end:{row:s.length,column:r.arr.last(s).text.length}}}if(i>=this.rowCount){var l=this.endPosition;e="\n".repeat(i-l.row)+e,i=l.row,o=l.column}var u=e.split("\n"),c=u.shift(),h=u.length,d={row:i,column:o},p=a.stringSize-1;o>p&&(c=" ".repeat(o-p)+c);var f=splitTextAndAttributesAt(a.textAndAttributes,o),y=$(f,2),m=y[0],g=y[1];""===m[0]&&(m=[]);var v=concatTextAndAttributes(m,[c,n&&m.length?m[m.length-1]:null],!0);if(0===h&&(d.column=o+c.length,concatTextAndAttributes(v,g,!0)),a.changeTextAndAttributes(v),0===h)return{start:{row:i,column:o},end:d};d.row+=h,d.column=u[h-1].length;var x=this.insertLines(u,i+1),b=r.arr.last(x);return b.changeTextAndAttributes(concatTextAndAttributes(b.textAndAttributes,g,!0)),{start:{row:i,column:o},end:d}}},{key:"remove",value:function Document_remove_(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0!==this.rowCount){var n=e.start,r=e.end;if(n.row!==r.row||n.column!==r.column){if(lessPosition(r,n)){var i=[r,n];n=i[0],r=i[1]}var o=this.endPosition;if(!lessEqPosition(o,n)){var a=maxPosition(n,{column:0,row:0}),s=a.row,l=a.column,u=minPosition(r,o),c=u.row,h=u.column;l<0&&(l=0),h<0&&(h=0),t&&!t.debugDocumentUpdate&&(t=!1),t&&(t.log||(t={log:console.log.bind(console),dump:console.log.bind(console),group:console.group.bind(console),groupEnd:console.groupEnd.bind(console)}),t.group("document.remove "+JSON.stringify(e)),t.log("[text doc] removing "+s+"/"+l+" => "+c+"/"+h));for(var d=this.getLine(s),p=d,f=[d],y=0;y<c-s;y++)f.push(d=d.nextLine());var m=f[f.length-1],g=splitTextAndAttributesAt(p.textAndAttributes,l),v=$(g,1)[0],x=splitTextAndAttributesAt(m.textAndAttributes,h),b=$(x,2),w=(b[0],b[1]);p.changeTextAndAttributes(concatTextAndAttributes(v,w,!0)),t&&t.log('[text doc removal] what remains of start/end line: "'+p.textAndAttributes+'"'),f.length>1&&this.removeLines(s+1,c,t),t&&t.groupEnd("[text doc removal]")}}}}},{key:"splitLineAt",value:function Document_splitLineAt_(e){var t=e.row,n=e.column,r=this.getLine(t),i=splitTextAndAttributesAt(r.textAndAttributes,n),o=$(i,2),a=o[0],s=o[1];r.changeTextAndAttributes(a);var l=new jn({parent:null,width:0,height:0,textAndAttributes:s});return this.insertLines([l],t+1),{start:{row:t,column:n},end:{row:t+1,column:0}}}},{key:"replace",value:function Document_replace_(e,t,n){var r=e.start,i=e.end;if(!t.length)return this.remove({start:r,end:i},n),{removed:{start:r,end:i},inserted:{start:r,end:r}};var o=this.clipPositionToLines(r),a=this.clipPositionToLines(i);if(o.row===a.row&&this.remove({start:o,end:a},n),o.row===a.row||lessEqPosition(this.endPosition,r)){var s=void 0;return"string"==typeof t?t.length&&(s=t.length&&this.insertText(t,r)):t.length&&(2!==t.length||t[0])&&(s=this.insertTextAndAttributes(t,r,n)),s||(s={start:o,end:o}),{removed:{start:r,end:i},inserted:s}}i=a;var l=r=o,u=l.row,c=l.column,h=i,d=h.row,p=(h.column,void 0);if("string"==typeof t){p=[];for(var f=t.split("\n"),y=0;y<f.length;y++)p.push([f[y],null])}else p=splitTextAndAttributesIntoLines(t,"\n");var m=!p.length||1===p.length&&(!p[0].length||!p[0][0].length);m&&(p=[]);var g=this.getLine(u),v=g,x=this.getLine(d),b=splitTextAndAttributesAt(v.textAndAttributes,c),w=$(b,2),_=w[0];w[1];v.changeTextAndAttributes(m?_:concatTextAndAttributes(_,p.shift(),!0));for(var k=u;p.length&&(k++,(g=g.nextLine())!==x);)g.changeTextAndAttributes(p.shift());if(!p.length){var S=g.stringSize-1;return this.remove({start:{row:k,column:g.stringSize},end:i}),{removed:{start:r,end:i},inserted:{start:r,end:{row:k,column:S}}}}console.assert(k==d,"not end row"),console.assert(g.row==k,"row != last line.row"),this.remove({start:{row:k,column:0},end:i});for(var M=[],C=p.length,P=0;P<C-1;P++){var T=p[P];T.length||(T=["",null]),"string"==typeof T[T.length-2]?T[T.length-2]=T[T.length-2]+"\n":T.push("\n",null),M.push.apply(M,X(T))}return M.push.apply(M,X(p[C-1])),{removed:{start:r,end:i},inserted:{start:r,end:this.insertTextAndAttributes(M,{row:k,column:0}).end}}}},{key:"wordsOfLine",value:function Document_wordsOfLine_(e){for(var t,n=this.getLineString(e),r=[],i=function isWordDelimiter(e){return/[^a-z0-9_]/i.test(e)},o=0;o<n.length;o++)i(n[o])?t&&(t.range.end.column=o,r.push(t),t=null):(t=t||{index:r.length,string:"",range:{start:{row:e,column:o},end:{row:e,column:o}}}).string+=n[o];return t&&(t.range.end.column=o,r.push(t)),r}},{key:"wordAt",value:function Document_wordAt_(e){var t=e.row,n=e.column;return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.wordsOfLine(t)).find(function(e){var t=e.range,r=t.start.column,i=t.end.column;return r<=n&&n<=i})||{range:{start:{column:n,row:t},end:{column:n,row:t}},string:""}}},{key:"wordLeft",value:function Document_wordLeft_(e){var t=e.row,n=e.column,i=this.wordsOfLine(t);if(!i.length||lessEqPosition(e,i[0].range.start)){for(;--t>=0;)if((i=this.wordsOfLine(t)).length)return r.arr.last(i);return{range:{start:e,end:e},string:""}}var o=this.wordAt(e);return o.string?eqPosition(o.range.start,e)?i[o.index-1]:o:i.slice().reverse().find(function(e){return e.range.end.column<=n})||{range:{start:e,end:e},string:""}}},{key:"wordRight",value:function Document_wordRight_(e){var t=e.column,n=e.row,i=this.wordsOfLine(e.row);if(!i.length||lessEqPosition(r.arr.last(i).range.end,e)){for(;++n<this.lines.length;)if((i=this.wordsOfLine(n)).length)return i[0];return{range:{start:e,end:e},string:""}}var o=this.wordAt(e);return o.string?eqPosition(o.range.end,e)?i[o.index+1]:o:i.find(function(e){return e.range.start.column>=t})||{range:{start:e,end:e},string:""}}},{key:"scanForward",value:function Document_scanForward_(e,t){for(var n=e.row,r=e.column,i=this.getLine(n),o=i.text,a=r;a<i.stringSize-1;a++){var s=t(o[a],{row:n,column:a});if(s)return s}for(;i=i.nextLine();){n++,o=i.text;for(var l=0;l<i.stringSize-1;l++){var u=t(o[l],{row:n,column:l});if(u)return u}}return null}},{key:"scanBackward",value:function Document_scanBackward_(e,t){for(var n=e.row,r=e.column,i=this.getLine(n),o=i.text,a=r-1;a>=0;a--){var s=t(o[a],{row:n,column:a});if(s)return s}for(;i=i.prevLine();){n--,o=i.text;for(var l=i.stringSize-2;l>=0;l--){var u=t(o[l],{row:n,column:l});if(u)return u}}return null}},{key:"copy",value:function Document_copy_(){return new this.constructor(this.lines.slice(),this.options)}},{key:"toString",value:function Document_toString_(){return"Document("+this.rowCount+" lines)"}},{key:"consistencyCheck",value:function Document_consistencyCheck_(){var e=[],t=this.rowCount,n=this.stringSize,r=this.lines,i=this.textString,o=this.root;t!==r.length&&e.push({error:"document "+this+" row count: "+t+" !== "+r.length}),i.length!==n&&e.push({error:"document "+this+" textString.length vs stringSize: "+i.length+" !== "+n}),e.push.apply(e,X(o.consistencyCheck()));for(var a=0,s=r[0];s;)s!=r[a]&&e.push({error:"line iteration at "+a+" is broken: nextLine() of "+r[a-1]+" is not "+r[a]+"!"}),a++,s=s.nextLine();if(r[a]&&e.push({error:"nextLine() of\n  "+r[a-1]+"\nis nullish but \n  "+r[a]+"\nexists in tree!"}),e.length)throw new Error("Consistency check of document revealed "+e.length+" error"+(e.length>1?"s":"")+":\n"+e.map(function(e){return e.error}).filter(Boolean).join("\n"))}},{key:"print",value:function Document_print_(){return this.root.print(!1,0,0,"root")}},{key:"print2",value:function Document_print2_(){var e=System.decanonicalize("lively.lang/text-graphics.js"),t=(System.get(e)||{}).printTree;return t?t(this.root,function(e){return e.toString()},function(e){return e.children},{padding:[2,1,2,1]}):(lively.module.module(e).load().then(function(){return console.log("lively.lang/text-graphics.js loaded")}).catch(function(e){return console.error(e)}),"Loading lively.lang/text-graphics.js lib, please try again later :P")}}],[{key:"fuzzyTest",value:function Document_fuzzyTest_(){return Wn.run()}},{key:"newline",get:function get(){return"\n"}},{key:"fromString",value:function Document_fromString_(e,t){return new this(e.split("\n"),t)}}],t,void 0,{start:37090,end:70393})}(void 0),Vn=function(e){var t=_classRecorder,n=t.hasOwnProperty("Anchor")&&"function"==typeof t.Anchor?t.Anchor:t.Anchor=function Anchor(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function Anchor_initialize_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{column:0,row:0},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"move";this.id=e||""+(this.constructor._id=(this.constructor._id||0)+1),this.position=t,this.insertBehavior=n}},{key:"isAnchor",get:function get(){return!0}},{key:"onDelete",value:function Anchor_onDelete_(e){if(lessEqPosition(this.position,e.start))return!1;if(lessEqPosition(e.start,this.position)&&lessEqPosition(this.position,e.end))return this.position=e.start,!0;var t=this.position,n=t.row,r=t.column,i=e.start,o=i.row,a=i.column,s=e.end,l=s.row,u=s.column,c=n-(l-o),h=l!==this.position.row?r:a===u?r-(u-a):a+(r-u);return this.position={column:h,row:c},!0}},{key:"onInsert",value:function Anchor_onInsert_(e){if(lessPosition(this.position,e.start))return!1;if(eqPosition(this.position,e.start)&&"stay"===this.insertBehavior)return!1;var t=this.position,n=t.row,r=t.column,i=e.start,o=i.row,a=i.column,s=e.end,l=s.row,u=s.column,c=l-o,h=o!==this.position.row?0:u-a;return this.position={column:r+h,row:n+c},!0}},{key:"equalsPosition",value:function Anchor_equalsPosition_(e){return!!e&&(e.isAnchor?eqPosition(this.position,e.position):eqPosition(this.position,e))}},{key:"toString",value:function Anchor_toString_(){var e=this.id,t=this.position;return"Anchor("+e+" "+t.row+"/"+t.column+")"}}],void 0,t,void 0,{start:82,end:3157})}(void 0),Un=function(e){var t=_classRecorder,n=t.hasOwnProperty("Icon")&&"function"==typeof t.Icon?t.Icon:t.Icon=function Icon(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,void 0,[{key:"makeLabel",value:function Icon_makeLabel_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{prefix:"",suffix:""},n=t.prefix,i=t.suffix,o=[];return n&&o.push.apply(o,X("string"==typeof n?[n||"",{}]:n)),o.push.apply(o,X(this.textAttribute(e))),i&&o.push.apply(o,X("string"==typeof i?[i||"",{}]:i)),new Gn(Object.assign({value:o},r.obj.dissoc(t,["prefix","suffix"])))}},{key:"textAttribute",value:function Icon_textAttribute_(e){return[qn[e].code||"icon "+e+" not found",{fontFamily:"",textStyleClasses:["fa"]}]}},{key:"setIcon",value:function Icon_setIcon_(e,t){e.textAndAttributes=this.textAttribute(t)}}],t,void 0,{start:750,end:1642})}(void 0),qn={"500px":{code:""},"address-book":{code:""},"address-book-o":{code:""},"address-card":{code:""},"address-card-o":{code:""},adjust:{code:""},adn:{code:""},"align-center":{code:""},"align-justify":{code:""},"align-left":{code:""},"align-right":{code:""},amazon:{code:""},ambulance:{code:""},"american-sign-language-interpreting":{code:""},anchor:{code:""},android:{code:""},angellist:{code:""},"angle-double-down":{code:""},"angle-double-left":{code:""},"angle-double-right":{code:""},"angle-double-up":{code:""},"angle-down":{code:""},"angle-left":{code:""},"angle-right":{code:""},"angle-up":{code:""},apple:{code:""},archive:{code:""},"area-chart":{code:""},"arrow-circle-down":{code:""},"arrow-circle-left":{code:""},"arrow-circle-o-down":{code:""},"arrow-circle-o-left":{code:""},"arrow-circle-o-right":{code:""},"arrow-circle-o-up":{code:""},"arrow-circle-right":{code:""},"arrow-circle-up":{code:""},"arrow-down":{code:""},"arrow-left":{code:""},"arrow-right":{code:""},"arrow-up":{code:""},arrows:{code:""},"arrows-alt":{code:""},"arrows-h":{code:""},"arrows-v":{code:""},"asl-interpreting":{code:""},"assistive-listening-systems":{code:""},asterisk:{code:""},at:{code:""},"audio-description":{code:""},automobile:{code:""},backward:{code:""},"balance-scale":{code:""},ban:{code:""},bandcamp:{code:""},bank:{code:""},"bar-chart":{code:""},"bar-chart-o":{code:""},barcode:{code:""},bars:{code:""},bath:{code:""},bathtub:{code:""},battery:{code:""},"battery-0":{code:""},"battery-1":{code:""},"battery-2":{code:""},"battery-3":{code:""},"battery-4":{code:""},"battery-empty":{code:""},"battery-full":{code:""},"battery-half":{code:""},"battery-quarter":{code:""},"battery-three-quarters":{code:""},bed:{code:""},beer:{code:""},behance:{code:""},"behance-square":{code:""},bell:{code:""},"bell-o":{code:""},"bell-slash":{code:""},"bell-slash-o":{code:""},bicycle:{code:""},binoculars:{code:""},"birthday-cake":{code:""},bitbucket:{code:""},"bitbucket-square":{code:""},bitcoin:{code:""},"black-tie":{code:""},blind:{code:""},bluetooth:{code:""},"bluetooth-b":{code:""},bold:{code:""},bolt:{code:""},bomb:{code:""},book:{code:""},bookmark:{code:""},"bookmark-o":{code:""},braille:{code:""},briefcase:{code:""},btc:{code:""},bug:{code:""},building:{code:""},"building-o":{code:""},bullhorn:{code:""},bullseye:{code:""},bus:{code:""},buysellads:{code:""},cab:{code:""},calculator:{code:""},calendar:{code:""},"calendar-check-o":{code:""},"calendar-minus-o":{code:""},"calendar-o":{code:""},"calendar-plus-o":{code:""},"calendar-times-o":{code:""},camera:{code:""},"camera-retro":{code:""},car:{code:""},"caret-down":{code:""},"caret-left":{code:""},"caret-right":{code:""},"caret-square-o-down":{code:""},"caret-square-o-left":{code:""},"caret-square-o-right":{code:""},"caret-square-o-up":{code:""},"caret-up":{code:""},"cart-arrow-down":{code:""},"cart-plus":{code:""},cc:{code:""},"cc-amex":{code:""},"cc-diners-club":{code:""},"cc-discover":{code:""},"cc-jcb":{code:""},"cc-mastercard":{code:""},"cc-paypal":{code:""},"cc-stripe":{code:""},"cc-visa":{code:""},certificate:{code:""},chain:{code:""},"chain-broken":{code:""},check:{code:""},"check-circle":{code:""},"check-circle-o":{code:""},"check-square":{code:""},"check-square-o":{code:""},"chevron-circle-down":{code:""},"chevron-circle-left":{code:""},"chevron-circle-right":{code:""},"chevron-circle-up":{code:""},"chevron-down":{code:""},"chevron-left":{code:""},"chevron-right":{code:""},"chevron-up":{code:""},child:{code:""},chrome:{code:""},circle:{code:""},"circle-o":{code:""},"circle-o-notch":{code:""},"circle-thin":{code:""},clipboard:{code:""},"clock-o":{code:""},clone:{code:""},close:{code:""},cloud:{code:""},"cloud-download":{code:""},"cloud-upload":{code:""},cny:{code:""},code:{code:""},"code-fork":{code:""},codepen:{code:""},codiepie:{code:""},coffee:{code:""},cog:{code:""},cogs:{code:""},columns:{code:""},comment:{code:""},"comment-o":{code:""},commenting:{code:""},"commenting-o":{code:""},comments:{code:""},"comments-o":{code:""},compass:{code:""},compress:{code:""},connectdevelop:{code:""},contao:{code:""},copy:{code:""},copyright:{code:""},"creative-commons":{code:""},"credit-card":{code:""},"credit-card-alt":{code:""},crop:{code:""},crosshairs:{code:""},css3:{code:""},cube:{code:""},cubes:{code:""},cut:{code:""},cutlery:{code:""},dashboard:{code:""},dashcube:{code:""},database:{code:""},deaf:{code:""},deafness:{code:""},dedent:{code:""},delicious:{code:""},desktop:{code:""},deviantart:{code:""},diamond:{code:""},digg:{code:""},dollar:{code:""},"dot-circle-o":{code:""},download:{code:""},dribbble:{code:""},"drivers-license":{code:""},"drivers-license-o":{code:""},dropbox:{code:""},drupal:{code:""},edge:{code:""},edit:{code:""},eercast:{code:""},eject:{code:""},"ellipsis-h":{code:""},"ellipsis-v":{code:""},empire:{code:""},envelope:{code:""},"envelope-o":{code:""},"envelope-open":{code:""},"envelope-open-o":{code:""},"envelope-square":{code:""},envira:{code:""},eraser:{code:""},etsy:{code:""},eur:{code:""},euro:{code:""},exchange:{code:""},exclamation:{code:""},"exclamation-circle":{code:""},"exclamation-triangle":{code:""},expand:{code:""},expeditedssl:{code:""},"external-link":{code:""},"external-link-square":{code:""},eye:{code:""},"eye-slash":{code:""},eyedropper:{code:""},fa:{code:""},facebook:{code:""},"facebook-f":{code:""},"facebook-official":{code:""},"facebook-square":{code:""},"fast-backward":{code:""},"fast-forward":{code:""},fax:{code:""},feed:{code:""},female:{code:""},"fighter-jet":{code:""},file:{code:""},"file-archive-o":{code:""},"file-audio-o":{code:""},"file-code-o":{code:""},"file-excel-o":{code:""},"file-image-o":{code:""},"file-movie-o":{code:""},"file-o":{code:""},"file-pdf-o":{code:""},"file-photo-o":{code:""},"file-picture-o":{code:""},"file-powerpoint-o":{code:""},"file-sound-o":{code:""},"file-text":{code:""},"file-text-o":{code:""},"file-video-o":{code:""},"file-word-o":{code:""},"file-zip-o":{code:""},"files-o":{code:""},film:{code:""},filter:{code:""},fire:{code:""},"fire-extinguisher":{code:""},firefox:{code:""},"first-order":{code:""},flag:{code:""},"flag-checkered":{code:""},"flag-o":{code:""},flash:{code:""},flask:{code:""},flickr:{code:""},"floppy-o":{code:""},folder:{code:""},"folder-o":{code:""},"folder-open":{code:""},"folder-open-o":{code:""},font:{code:""},"font-awesome":{code:""},fonticons:{code:""},"fort-awesome":{code:""},forumbee:{code:""},forward:{code:""},foursquare:{code:""},"free-code-camp":{code:""},"frown-o":{code:""},"futbol-o":{code:""},gamepad:{code:""},gavel:{code:""},gbp:{code:""},ge:{code:""},gear:{code:""},gears:{code:""},genderless:{code:""},"get-pocket":{code:""},gg:{code:""},"gg-circle":{code:""},gift:{code:""},git:{code:""},"git-square":{code:""},github:{code:""},"github-alt":{code:""},"github-square":{code:""},gitlab:{code:""},gittip:{code:""},glass:{code:""},glide:{code:""},"glide-g":{code:""},globe:{code:""},google:{code:""},"google-plus":{code:""},"google-plus-circle":{code:""},"google-plus-official":{code:""},"google-plus-square":{code:""},"google-wallet":{code:""},"graduation-cap":{code:""},gratipay:{code:""},grav:{code:""},group:{code:""},"h-square":{code:""},"hacker-news":{code:""},"hand-grab-o":{code:""},"hand-lizard-o":{code:""},"hand-o-down":{code:""},"hand-o-left":{code:""},"hand-o-right":{code:""},"hand-o-up":{code:""},"hand-paper-o":{code:""},"hand-peace-o":{code:""},"hand-pointer-o":{code:""},"hand-rock-o":{code:""},"hand-scissors-o":{code:""},"hand-spock-o":{code:""},"hand-stop-o":{code:""},"handshake-o":{code:""},"hard-of-hearing":{code:""},hashtag:{code:""},"hdd-o":{code:""},header:{code:""},headphones:{code:""},heart:{code:""},"heart-o":{code:""},heartbeat:{code:""},history:{code:""},home:{code:""},"hospital-o":{code:""},hotel:{code:""},hourglass:{code:""},"hourglass-1":{code:""},"hourglass-2":{code:""},"hourglass-3":{code:""},"hourglass-end":{code:""},"hourglass-half":{code:""},"hourglass-o":{code:""},"hourglass-start":{code:""},houzz:{code:""},html5:{code:""},"i-cursor":{code:""},"id-badge":{code:""},"id-card":{code:""},"id-card-o":{code:""},ils:{code:""},image:{code:""},imdb:{code:""},inbox:{code:""},indent:{code:""},industry:{code:""},info:{code:""},"info-circle":{code:""},inr:{code:""},instagram:{code:""},institution:{code:""},"internet-explorer":{code:""},intersex:{code:""},ioxhost:{code:""},italic:{code:""},joomla:{code:""},jpy:{code:""},jsfiddle:{code:""},key:{code:""},"keyboard-o":{code:""},krw:{code:""},language:{code:""},laptop:{code:""},lastfm:{code:""},"lastfm-square":{code:""},leaf:{code:""},leanpub:{code:""},legal:{code:""},"lemon-o":{code:""},"level-down":{code:""},"level-up":{code:""},"life-bouy":{code:""},"life-buoy":{code:""},"life-ring":{code:""},"life-saver":{code:""},"lightbulb-o":{code:""},"line-chart":{code:""},link:{code:""},linkedin:{code:""},"linkedin-square":{code:""},linode:{code:""},linux:{code:""},list:{code:""},"list-alt":{code:""},"list-ol":{code:""},"list-ul":{code:""},"location-arrow":{code:""},lock:{code:""},"long-arrow-down":{code:""},"long-arrow-left":{code:""},"long-arrow-right":{code:""},"long-arrow-up":{code:""},"low-vision":{code:""},magic:{code:""},magnet:{code:""},"mail-forward":{code:""},"mail-reply":{code:""},"mail-reply-all":{code:""},male:{code:""},map:{code:""},"map-marker":{code:""},"map-o":{code:""},"map-pin":{code:""},"map-signs":{code:""},mars:{code:""},"mars-double":{code:""},"mars-stroke":{code:""},"mars-stroke-h":{code:""},"mars-stroke-v":{code:""},maxcdn:{code:""},meanpath:{code:""},medium:{code:""},medkit:{code:""},meetup:{code:""},"meh-o":{code:""},mercury:{code:""},microchip:{code:""},microphone:{code:""},"microphone-slash":{code:""},minus:{code:""},"minus-circle":{code:""},"minus-square":{code:""},"minus-square-o":{code:""},mixcloud:{code:""},mobile:{code:""},"mobile-phone":{code:""},modx:{code:""},money:{code:""},"moon-o":{code:""},"mortar-board":{code:""},motorcycle:{code:""},"mouse-pointer":{code:""},music:{code:""},navicon:{code:""},neuter:{code:""},"newspaper-o":{code:""},"object-group":{code:""},"object-ungroup":{code:""},odnoklassniki:{code:""},"odnoklassniki-square":{code:""},opencart:{code:""},openid:{code:""},opera:{code:""},"optin-monster":{code:""},outdent:{code:""},pagelines:{code:""},"paint-brush":{code:""},"paper-plane":{code:""},"paper-plane-o":{code:""},paperclip:{code:""},paragraph:{code:""},paste:{code:""},pause:{code:""},"pause-circle":{code:""},"pause-circle-o":{code:""},paw:{code:""},paypal:{code:""},pencil:{code:""},"pencil-square":{code:""},"pencil-square-o":{code:""},percent:{code:""},phone:{code:""},"phone-square":{code:""},photo:{code:""},"picture-o":{code:""},"pie-chart":{code:""},"pied-piper":{code:""},"pied-piper-alt":{code:""},"pied-piper-pp":{code:""},pinterest:{code:""},"pinterest-p":{code:""},"pinterest-square":{code:""},plane:{code:""},play:{code:""},"play-circle":{code:""},"play-circle-o":{code:""},plug:{code:""},plus:{code:""},"plus-circle":{code:""},"plus-square":{code:""},"plus-square-o":{code:""},podcast:{code:""},"power-off":{code:""},print:{code:""},"product-hunt":{code:""},"puzzle-piece":{code:""},qq:{code:""},qrcode:{code:""},question:{code:""},"question-circle":{code:""},"question-circle-o":{code:""},quora:{code:""},"quote-left":{code:""},"quote-right":{code:""},ra:{code:""},random:{code:""},ravelry:{code:""},rebel:{code:""},recycle:{code:""},reddit:{code:""},"reddit-alien":{code:""},"reddit-square":{code:""},refresh:{code:""},registered:{code:""},remove:{code:""},renren:{code:""},reorder:{code:""},repeat:{code:""},reply:{code:""},"reply-all":{code:""},resistance:{code:""},retweet:{code:""},rmb:{code:""},road:{code:""},rocket:{code:""},"rotate-left":{code:""},"rotate-right":{code:""},rouble:{code:""},rss:{code:""},"rss-square":{code:""},rub:{code:""},ruble:{code:""},rupee:{code:""},s15:{code:""},safari:{code:""},save:{code:""},scissors:{code:""},scribd:{code:""},search:{code:""},"search-minus":{code:""},"search-plus":{code:""},sellsy:{code:""},send:{code:""},"send-o":{code:""},server:{code:""},share:{code:""},"share-alt":{code:""},"share-alt-square":{code:""},"share-square":{code:""},"share-square-o":{code:""},shekel:{code:""},sheqel:{code:""},shield:{code:""},ship:{code:""},shirtsinbulk:{code:""},"shopping-bag":{code:""},"shopping-basket":{code:""},"shopping-cart":{code:""},shower:{code:""},"sign-in":{code:""},"sign-language":{code:""},"sign-out":{code:""},signal:{code:""},signing:{code:""},simplybuilt:{code:""},sitemap:{code:""},skyatlas:{code:""},skype:{code:""},slack:{code:""},sliders:{code:""},slideshare:{code:""},"smile-o":{code:""},snapchat:{code:""},"snapchat-ghost":{code:""},"snapchat-square":{code:""},"snowflake-o":{code:""},"soccer-ball-o":{code:""},sort:{code:""},"sort-alpha-asc":{code:""},"sort-alpha-desc":{code:""},"sort-amount-asc":{code:""},"sort-amount-desc":{code:""},"sort-asc":{code:""},"sort-desc":{code:""},"sort-down":{code:""},"sort-numeric-asc":{code:""},"sort-numeric-desc":{code:""},"sort-up":{code:""},soundcloud:{code:""},"space-shuttle":{code:""},spinner:{code:""},spoon:{code:""},spotify:{code:""},square:{code:""},"square-o":{code:""},"stack-exchange":{code:""},"stack-overflow":{code:""},star:{code:""},"star-half":{code:""},"star-half-empty":{code:""},"star-half-full":{code:""},"star-half-o":{code:""},"star-o":{code:""},steam:{code:""},"steam-square":{code:""},"step-backward":{code:""},"step-forward":{code:""},stethoscope:{code:""},"sticky-note":{code:""},"sticky-note-o":{code:""},stop:{code:""},"stop-circle":{code:""},"stop-circle-o":{code:""},"street-view":{code:""},strikethrough:{code:""},stumbleupon:{code:""},"stumbleupon-circle":{code:""},subscript:{code:""},subway:{code:""},suitcase:{code:""},"sun-o":{code:""},superpowers:{code:""},superscript:{code:""},support:{code:""},table:{code:""},tablet:{code:""},tachometer:{code:""},tag:{code:""},tags:{code:""},tasks:{code:""},taxi:{code:""},telegram:{code:""},television:{code:""},"tencent-weibo":{code:""},terminal:{code:""},"text-height":{code:""},"text-width":{code:""},th:{code:""},"th-large":{code:""},"th-list":{code:""},themeisle:{code:""},thermometer:{code:""},"thermometer-0":{code:""},"thermometer-1":{code:""},"thermometer-2":{code:""},"thermometer-3":{code:""},"thermometer-4":{code:""},"thermometer-empty":{code:""},"thermometer-full":{code:""},"thermometer-half":{code:""},"thermometer-quarter":{code:""},"thermometer-three-quarters":{code:""},"thumb-tack":{code:""},"thumbs-down":{code:""},"thumbs-o-down":{code:""},"thumbs-o-up":{code:""},"thumbs-up":{code:""},ticket:{code:""},times:{code:""},"times-circle":{code:""},"times-circle-o":{code:""},"times-rectangle":{code:""},"times-rectangle-o":{code:""},tint:{code:""},"toggle-down":{code:""},"toggle-left":{code:""},"toggle-off":{code:""},"toggle-on":{code:""},"toggle-right":{code:""},"toggle-up":{code:""},trademark:{code:""},train:{code:""},transgender:{code:""},"transgender-alt":{code:""},trash:{code:""},"trash-o":{code:""},tree:{code:""},trello:{code:""},tripadvisor:{code:""},trophy:{code:""},truck:{code:""},try:{code:""},tty:{code:""},tumblr:{code:""},"tumblr-square":{code:""},"turkish-lira":{code:""},tv:{code:""},twitch:{code:""},twitter:{code:""},"twitter-square":{code:""},umbrella:{code:""},underline:{code:""},undo:{code:""},"universal-access":{code:""},university:{code:""},unlink:{code:""},unlock:{code:""},"unlock-alt":{code:""},unsorted:{code:""},upload:{code:""},usb:{code:""},usd:{code:""},user:{code:""},"user-circle":{code:""},"user-circle-o":{code:""},"user-md":{code:""},"user-o":{code:""},"user-plus":{code:""},"user-secret":{code:""},"user-times":{code:""},users:{code:""},vcard:{code:""},"vcard-o":{code:""},venus:{code:""},"venus-double":{code:""},"venus-mars":{code:""},viacoin:{code:""},viadeo:{code:""},"viadeo-square":{code:""},"video-camera":{code:""},vimeo:{code:""},"vimeo-square":{code:""},vine:{code:""},vk:{code:""},"volume-control-phone":{code:""},"volume-down":{code:""},"volume-off":{code:""},"volume-up":{code:""},warning:{code:""},wechat:{code:""},weibo:{code:""},weixin:{code:""},whatsapp:{code:""},wheelchair:{code:""},"wheelchair-alt":{code:""},wifi:{code:""},"wikipedia-w":{code:""},"window-close":{code:""},"window-close-o":{code:""},"window-maximize":{code:""},"window-minimize":{code:""},"window-restore":{code:""},windows:{code:""},won:{code:""},wordpress:{code:""},wpbeginner:{code:""},wpexplorer:{code:""},wpforms:{code:""},wrench:{code:""},xing:{code:""},"xing-square":{code:""},"y-combinator":{code:""},"y-combinator-square":{code:""},yahoo:{code:""},yc:{code:""},"yc-square":{code:""},yelp:{code:""},yen:{code:""},yoast:{code:""},youtube:{code:""},"youtube-play":{code:""},"youtube-square":{code:""}},Gn=function(e){var n=_classRecorder,a=n.hasOwnProperty("Label")&&"function"==typeof n.Label?n.Label:n.Label=function Label(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(a,e,[{key:Symbol.for("lively-instance-initialize"),value:function Label_initialize_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.fontMetric,n=e.position,i=e.rightCenter,o=e.leftCenter,s=e.topCenter,l=e.bottom,u=e.top,c=e.right,h=e.left,d=e.bottomCenter,p=e.bottomLeft,f=e.bottomRight,y=e.topRight,m=e.topLeft,g=e.center,v=e.extent;lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(a.prototype),Symbol.for("lively-instance-initialize"),this).call(this,r.obj.dissoc(e,["fontMetric"])),t&&(this._fontMetric=t),this._cachedTextBounds=null,this.fit(),void 0!==v&&(this.extent=v),void 0!==n&&(this.position=n),void 0!==i&&(this.rightCenter=i),void 0!==o&&(this.leftCenter=o),void 0!==s&&(this.topCenter=s),void 0!==l&&(this.bottom=l),void 0!==u&&(this.top=u),void 0!==c&&(this.right=c),void 0!==h&&(this.left=h),void 0!==d&&(this.bottomCenter=d),void 0!==p&&(this.bottomLeft=p),void 0!==f&&(this.bottomRight=f),void 0!==y&&(this.topRight=y),void 0!==m&&(this.topLeft=m),void 0!==g&&(this.center=g)}},{key:"__additionally_serialize__",value:function Label___additionally_serialize___(e,t,n,r){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(a.prototype),"__additionally_serialize__",this).call(this,e,t,n,r),this.fit(),e._cachedTextBounds=this._cachedTextBounds&&this._cachedTextBounds.toTuple()}},{key:"__after_deserialize__",value:function Label___after_deserialize___(e,n){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(a.prototype),"__after_deserialize__",this).call(this,e,n),e._cachedTextBounds&&(this.changeMetaData("deserializeInfo",{recoveredTextBounds:!0}),this._cachedTextBounds=t.Rectangle.fromTuple(e._cachedTextBounds))}},{key:"isLabel",get:function get(){return!0}},{key:"textStyle",get:function get(){return r.obj.select(this,["textStyleClasses","textDecoration","fontStyle","fontWeight","textShadow","fontColor","fontSize","fontFamily"])}},{key:"fit",value:function Label_fit_(){return this.extent=this.textBounds().extent(),this._needsFit=!1,this}},{key:"fitIfNeeded",value:function Label_fitIfNeeded_(){this._needsFit&&this.fit()}},{key:"textAndAttributesOfLines",get:function get(){return splitTextAndAttributesIntoLines(this.textAndAttributes,"\n")}},{key:"textBoundsSingleChunk",value:function Label_textBoundsSingleChunk_(){var e,n,r=this._fontMetric||this.env.fontMetric,i=$(this.textAndAttributes,2),o=i[0],a=i[1],s=Object.assign({},this.textStyle,{},a),l=this.padding;if(r.isProportional(s.fontFamily)){var u=r.sizeFor(s,o);e=u.width,n=u.height}else{var c=r.sizeFor(s,"x"),h=c.width,d=c.height;e=o.length*h,n=d}return new t.Rectangle(0,0,l.left()+l.right()+e,l.top()+l.bottom()+n)}},{key:"textBoundsAllChunks",value:function Label_textBoundsAllChunks_(){for(var e=this._fontMetric||this.env.fontMetric,n=this.padding,r=this.textStyle,i=this.textAndAttributesOfLines,o=!e.isProportional(r.fontFamily),a=e.sizeFor(r,"x").height,s=0,l=0,u=0;u<i.length;u++){var c=i[u];if(c.length){for(var h=0,d=0,p=0;p<c.length;p+=2){var f=c[p],y=c[p+1]||{},m=Object.assign({},r,{},y);if(o&&!y.fontFamily||!e.isProportional(m.fontFamily)){m.fontFamily,m.fontSize;var g=e.sizeFor(m,"x"),v=g.width,x=g.height;d+=f.length*v,h=Math.max(h,x)}else{var b=e.sizeFor(m,f),w=b.width,_=b.height;d+=w,h=Math.max(h,_)}}s+=h,l=Math.max(l,d)}else s+=a}return new t.Rectangle(0,0,n.left()+n.right()+l,n.top()+n.bottom()+s)}},{key:"invalidateTextLayout",value:function Label_invalidateTextLayout_(){this._cachedTextBounds=null,this.autofit&&(this._needsFit=!0),this.makeDirty()}},{key:"textBounds",value:function Label_textBounds_(){var e=this.textAndAttributes,t=this._cachedTextBounds;return t||(this._cachedTextBounds=e.length<=2?this.textBoundsSingleChunk():this.textBoundsAllChunks())}},{key:"forceRerender",value:function Label_forceRerender_(){this._cachedTextBounds=null,this.makeDirty()}},{key:"applyLayoutIfNeeded",value:function Label_applyLayoutIfNeeded_(){this.fitIfNeeded(),lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(a.prototype),"applyLayoutIfNeeded",this).call(this)}},{key:"render",value:function Label_render_(e){for(var t=[],n=this.textAndAttributesOfLines.length,r=0;r<n;r++){for(var i=this.textAndAttributesOfLines[r],a=0;a<i.length;a+=2){var s=i[a],l=i[a+1];t.push(this.renderChunk(s,l))}r<n-1&&t.push(o.h("br"))}var u=this.textStyle,c=u.fontColor,h=u.fontFamily,d=u.fontSize,p=u.fontStyle,f=u.fontWeight,y=u.textShadow,m=u.textDecoration,g=u.textStyleClasses,v=this.padding,x=(l={fontFamily:h,fontSize:"number"==typeof d?d+"px":d,color:c?String(c):"transparent",position:"absolute",paddingLeft:v.left()+"px",paddingRight:v.right()+"px",paddingTop:v.top()+"px",paddingBottom:v.bottom()+"px",cursor:this.nativeCursor},defaultAttributes(this,e));return y&&(l.textShadow=y),"normal"!==f&&(l.fontWeight=f),"normal"!==p&&(l.fontStyle=p),"none"!==m&&(l.textDecoration=m),g&&g.length&&(x.className=(x.className||"")+" "+g.join(" ")),x.style=Object.assign({},defaultStyle(this),{},l),o.h("div",x,[].concat(t,[e.renderSubmorphs(this)]))}},{key:"renderChunk",value:function Label_renderChunk_(e,t){var n=t=t||{},r=n.backgroundColor,i=n.fontColor,a=n.fontFamily,s=n.fontStyle,l=n.fontWeight,u=n.textShadow,c=n.textDecoration,h=n.textStyleClasses,d=n.textAlign,p=n.float,f=n.display,y={},m={style:y};p&&(y.float=p),f&&(y.display=f),r&&(y.backgroundColor=String(r)),a&&(y.fontFamily=a),i&&(y.color=String(i)),u&&(y.textShadow=u),"normal"!==l&&(y.fontWeight=l),"normal"!==s&&(y.fontStyle=s),"none"!==c&&(y.textDecoration=c),d&&(y.textAlign=d),h&&h.length&&(m.className=h.join(" "));for(var g=["fontSize","width","height","maxWidth","maxHeight","top","left","padding","paddingLeft","paddingRight","paddingBottom","paddingTop","marginTop","marginRight","marginLeft","marginBottom"],v=0;v<g.length;v++){var x=g[v];if(t.hasOwnProperty(x)){var b=t[x];y[x]="number"==typeof b?b+"px":b}}return o.h("span",m,e)}},{key:"interactivelyChangeLabel",value:function(){var e=H(regeneratorRuntime.mark(function _callee(){var e;return regeneratorRuntime.wrap(function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.world().prompt("edit label",{input:this.textString,historyId:"lively.morphic-label-edit-hist"});case 2:"string"==typeof(e=t.sent)&&(this.textString=e);case 4:case"end":return t.stop()}},_callee,this)}));return function Label_interactivelyChangeLabel_(){return e.apply(this,arguments)}}()},{key:"menuItems",value:function Label_menuItems_(){var e=this,t=lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(a.prototype),"menuItems",this).call(this);return t.unshift({isDivider:!0}),t.unshift(["change label",function(){return e.interactivelyChangeLabel()}]),t}}],[{key:"properties",get:function get(){return{fill:{defaultValue:t.Color.transparent},draggable:{defaultValue:!1},nativeCursor:{defaultValue:"default"},isIcon:{derived:!0,get:function get(){return r.properties.values(qn).map(function(e){return e.code}).includes(this.textString)}},value:{derived:!0,after:["textAndAttributes","textString"],get:function get(){var e=this.textAndAttributes;if(e.length<=2){var t=$(e,2),n=t[0],r=t[1];if(!Object.keys(r||{}).length)return n||""}return e},set:function set(e){"string"==typeof e?this.textString=e:this.textAndAttributes=e}},textString:{derived:!0,after:["textAndAttributes"],get:function get(){return this.textAndAttributes.map(function(e,t){return t%2==0?e:""}).join("")},set:function set(e){this.textAndAttributes=[e,null]}},textAndAttributes:{get:function get(){var e=this.getProperty("textAndAttributes");return(!e||e.length<1)&&(e=["",null]),e},set:function set(e){Array.isArray(e)||(e=[String(e),{}]),0===e.length&&(e=["",{}]);var t=this.textAndAttributes;this.setProperty("textAndAttributes",e),this.autofit&&!r.arr.equals(t,e)&&this.invalidateTextLayout(),i.signal(this,"value",e)}},valueAndAnnotation:{derived:!0,after:["textAndAttributes"],get:function get(){var e=this.textAndAttributes,t=null;if(e.length>2){var n=e.slice(-2),r=$(n,2),i=r[0],o=r[1];o&&o.textStyleClasses&&o.textStyleClasses.includes("annotation")&&(e=e.slice(0,-2),t=[i,o])}return{value:e,annotation:t}},set:function set(e){var t=e.value,n=e.annotation;t||(t=""),"string"==typeof t&&(t=[t,null]),Array.isArray(t)||(t=[String(t),null]);var r=t.slice();if(n){"string"==typeof n&&(n=[n,null]);var i=n[1];i||(i=n[1]={}),r.push.apply(r,X(n)),i.textStyleClasses=(i.textStyleClasses||[]).concat("annotation"),i.textStyleClasses.includes("annotation")||i.textStyleClasses.push("annotation")}this.textAndAttributes=r}},autofit:{defaultValue:!0,set:function set(e){this.setProperty("autofit",e),e&&(this._needsFit=!0)}},padding:{type:"Rectangle",isStyleProp:!0,defaultValue:t.Rectangle.inset(0),initialize:function initialize(e){this.padding=e},set:function set(e){e||(e=t.Rectangle.inset(0));var n=this.padding;this.setProperty("padding","number"==typeof e?t.Rectangle.inset(e):e),this.autofit&&!n.equals(e)&&this.invalidateTextLayout()}},fontFamily:{isStyleProp:!0,type:"Enum",values:z.text.basicFontItems,defaultValue:"Sans-Serif",set:function set(e){var t=this.fontFamily;this.setProperty("fontFamily",e),this.autofit&&t!=e&&this.invalidateTextLayout()}},fontSize:{type:"Number",min:1,isStyleProp:!0,defaultValue:12,set:function set(e){var t=this.fontSize;this.setProperty("fontSize",e),this.autofit&&e!=t&&this.invalidateTextLayout()}},fontColor:{type:"Color",isStyleProp:!0,defaultValue:t.Color.black},fontWeight:{type:"Enum",values:["bold","bolder","light","lighter"],isStyleProp:!0,defaultValue:"normal",set:function set(e){var t=this.fontWeight;this.setProperty("fontWeight",e),this.autofit&&t!=e&&this.invalidateTextLayout()}},fontStyle:{type:"Enum",values:["normal","italic","oblique"],isStyleProp:!0,defaultValue:"normal",set:function set(e){var t=this.fontStyle;this.setProperty("fontStyle",e),this.autofit&&t!=e&&this.invalidateTextLayout()}},textShadow:{type:"String",isStyleProp:!0,defaultValue:""},textDecoration:{defaultValue:"none"},textStyleClasses:{defaultValue:void 0,set:function set(e){this.setProperty("textStyleClasses",e),this.autofit&&this.invalidateTextLayout()}}}}},{key:"icon",value:function Label_icon_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{prefix:"",suffix:""};return Un.makeLabel(e,t)}}],n,void 0,{start:435,end:16134})}($t);var $n=function(e){var t=_classRecorder,n=t.hasOwnProperty("Snippet")&&"function"==typeof t.Snippet?t.Snippet:t.Snippet=function Snippet(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function Snippet_initialize_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{trigger:null,expansion:""},t=e.trigger,n=e.expansion;this.trigger=t,this.expansion=n,this.resetExpansionState()}},{key:"isTextSnippet",get:function get(){return!0}},{key:"attach",value:function Snippet_attach_(e){this.isExpanding&&(this.textMorph=e,i.connect(this.textMorph,"selectionChange",this,"onCursorMove"))}},{key:"detach",value:function Snippet_detach_(e){this.isExpanding&&(i.disconnect(e,"selectionChange",this,"onCursorMove"),this.textMorph=null)}},{key:"onCursorMove",value:function Snippet_onCursorMove_(){var e=this.expansionState,t=e.startAnchor,n=e.endAnchor;e.isExpanding?En.fromPositions(t.position,n.position).containsPosition(this.textMorph.cursorPosition)||this.resetExpansionState():this.resetExpansionState()}},{key:"resetExpansionState",value:function Snippet_resetExpansionState_(){var e=this.textMorph;if(e){var t=this.expansionState||{},n=t.marker,r=t.startAnchor,i=t.endAnchor,o=t.steps;r&&e.removeAnchor(r),i&&e.removeAnchor(i),n&&e.removeMarker(n),o.forEach(function(t){var n=t.anchor;return e.removeAnchor(n)})}this.expansionState={stepIndex:-1,steps:[],isExpanding:!1,startMarker:null,endMarker:null},e&&e.removePlugin(this)}},{key:"isExpanding",get:function get(){return this.expansionState.isExpanding}},{key:"createExpansionSteps",value:function Snippet_createExpansionSteps_(e){var t=[],n=0;return lively.lang.string.reMatches(e,/\$[0-9]+|\$\{[0-9]+:[^\}]*\}/g).forEach(function(r){var i,o=r.start,a=r.end,s=r.match,l="";if(s.startsWith("${")){var u=s.match(/^\$\{([0-9]+):([^\}]*)\}/),c=$(u,3),h=(c[0],c[1]),d=c[2];i=Number(h),l=d}else i=Number(s.replace(/^\$/,""));e=e.slice(0,o-n)+l+e.slice(a-n),t[i]={index:o-n,prefill:l,anchor:null},n+=a-o-l.length}),{steps:t,expansion:e}}},{key:"expandAtCursor",value:function Snippet_expandAtCursor_(e){var t=e,n=t.selection,i=t.cursorPosition.column,o=this.expansion;if(this.trigger&&(i-=this.trigger.length),i=Math.max(0,i)){var a=r.string.lines(o);o=(a=[a[0]].concat(X(a.slice(1).map(function(e){return r.string.indent(e," ",i)})))).join("\n")}var s=this.createExpansionSteps(o),l=(o=s.expansion,s.steps);this.trigger&&n.growLeft(this.trigger.length),n.text=o;var u=n.start,c=n.end;if(n.collapseToEnd(),l.length){var h=r.string.newUUID();l.forEach(function(e,n){return e.anchor=t.addAnchor(Object.assign({id:"snippet-step-"+n+"-"+h},function addIndexToTextPos(e,t,n){return e.indexToPosition(e.positionToIndex(t)+n)}(t,u,e.index)))});var d=t.addAnchor(Object.assign({id:"snippet-start-"+h},u,{insertBehavior:"stay"})),p=t.addAnchor(Object.assign({id:"snippet-end-"+h},c)),f=t.addMarker({id:"snippet-marker-"+h,get range(){return{start:d.position,end:p.position}},style:{"border-radius":"4px","background-color":"rgba(30, 200, 140, 0.3)","box-shadow":"0 0 4px rgba(30, 200, 140, 0.3)","pointer-events":"none",content:"fooooo"}});this.expansionState={marker:f,startAnchor:d,endAnchor:p,stepIndex:0,steps:l,isExpanding:!0},t.addPlugin(this),this.nextStep()}}},{key:"nextStep",value:function Snippet_nextStep_(){var e=this.expansionState,t=e.steps,n=e.stepIndex,r=(e.startAnchor,e.isExpanding),i=this.textMorph;if(r&&i){var o=i.selection,a=t[n],s=a.anchor.position,l=a.prefill;o.lead=o.anchor=s,o.growRight(l.length),this.expansionState.stepIndex++,this.expansionState.stepIndex>=t.length&&(this.resetExpansionState(),console.log("[snippet] expansion of "+this.expansion+" done"))}}},{key:"canExpand",value:function Snippet_canExpand_(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.cursorPosition;var t=e.positionToIndex(e.cursorPosition),n=t-this.trigger.length;return e.textString.slice(n,t)===this.trigger}},{key:"tryTrigger",value:function Snippet_tryTrigger_(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.cursorPosition;return!!this.canExpand(e,e.cursorPosition)&&(this.expandAtCursor(e),!0)}},{key:"getCommands",value:function Snippet_getCommands_(e){var t=this;return e.concat([{name:"[snippet] next expansion step",exec:function exec(e){return t.nextStep(),!0}},{name:"[snippet] cancel expansion",exec:function exec(e){return t.resetExpansionState(),!0}}])}},{key:"getKeyHandlers",value:function Snippet_getKeyHandlers_(e){return e.concat(ht.withBindings([{keys:"Tab",command:"[snippet] next expansion step"},{keys:"Escape",command:"[snippet] cancel expansion"}]))}}],void 0,t,void 0,{start:331,end:5939})}(void 0),Kn=Object.assign(ht.withBindings([{keys:"Escape|Ctrl-G",command:"occur exit"},{keys:"Enter",command:"occur accept"}]),{isOccurHandler:!0}),Xn={name:"occur",exec:function exec(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.needle&&e.addPlugin(new Jn(t)),!!t.needle}};function findOccurPlugin(e){return e.plugins.slice().reverse().find(function(e){return e.isOccurPlugin})}var Yn=[{name:"occur exit",exec:function exec(e){var t=findOccurPlugin(e);if(!t)return!1;t.options.translatePosition=!0,e.removePlugin(t);var n=findOccurPlugin(e);return n&&n.highlight(),!0},readOnly:!0},{name:"occur accept",bindKey:"Enter",exec:function exec(e){var t=findOccurPlugin(e);if(!t)return!1;t.options.translatePosition=!0,e.removePlugin(t);var n=findOccurPlugin(e);return n&&n.highlight(),!0},readOnly:!0}],Jn=function(e){var t=_classRecorder,n=t.hasOwnProperty("Occur")&&"function"==typeof t.Occur?t.Occur:t.Occur=function Occur(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function Occur_initialize_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e,e.textMorph&&(this.textMorph=e.textMorph)}},{key:"isOccurPlugin",get:function get(){return!0}},{key:"attach",value:function Occur_attach_(e){this.textMorph=e;var t=this.textMorph.cursorPosition;if(this.displayOccurContent(this.options)){var n=this.originalToOccurPosition(t);this.textMorph.cursorPosition=n}return this}},{key:"detach",value:function Occur_detach_(e){this.removeHighlight();var t=this.options.translatePosition&&this.textMorph.cursorPosition,n=t&&this.occurToOriginalPosition(t);return this.displayOriginalContent(),n&&(this.textMorph.cursorPosition=n),this.textMorph=null,this}},{key:"getKeyHandlers",value:function Occur_getKeyHandlers_(e){return e.concat(Kn)}},{key:"getCommands",value:function Occur_getCommands_(e){return Yn.concat(e)}},{key:"matchingLines",value:function Occur_matchingLines_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{needle:""};if(!e.needle)return[];var t=this.textMorph.document.lineStrings,n=new Zn(this.textMorph).searchForAll(Object.assign({},e,{start:{column:0,row:0}}));return r.arr.groupBy(n,function(e){return e.range.start.row}).mapGroups(function(e,n){var r=n[0].range.start.row;return{row:r,ranges:n.map(function(e){return e.range}),line:t[r]}}).toArray()}},{key:"displayOccurContent",value:function Occur_displayOccurContent_(e){this._originalDocument=this.textMorph.document;var t=this._originalDocument.constructor,n=this.matchingLines(e),r=n.map(function(e){return e.line}),i=this._document=new t(r);return i._occurMatchingLines=n,n.length>0&&(this.textMorph.changeDocument(i,!0),this.highlight(e.needle),!0)}},{key:"displayOriginalContent",value:function Occur_displayOriginalContent_(){this.textMorph.changeDocument(this._originalDocument)}},{key:"occurToOriginalPosition",value:function Occur_occurToOriginalPosition_(e){var t=this._document._occurMatchingLines;return t&&t[e.row]?{row:t[e.row].row,column:e.column}:e}},{key:"originalToOccurPosition",value:function Occur_originalToOccurPosition_(e){var t=this._document._occurMatchingLines,n={row:0,column:0};if(!t)return n;for(var r=0;r<t.length;r++)if(t[r].row===e.row)return{row:r,column:e.column};return n}},{key:"highlight",value:function Occur_highlight_(e){var t=this;this.removeHighlight();var n={borderRadius:"4px",backgroundColor:"rgba(87, 255, 8, 0.25)",position:"absolute","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box","box-sizing":"border-box","box-shadow":"0 0 4px rgb(91, 255, 50)"};r.arr.flatmap(this._document._occurMatchingLines,function(e,t){return e.ranges.map(function(e){var n=e.start.column,r=e.end.column;return{start:{column:n,row:t},end:{column:r,row:t}}})}).map(function(e,t){return{id:"occur-"+t,range:e,style:n}}).forEach(function(e){return t.textMorph.addMarker(e)})}},{key:"removeHighlight",value:function Occur_removeHighlight_(){var e=this;(this.textMorph.markers||[]).filter(function(e){return 0===e.id.indexOf("occur-")}).forEach(function(t){return e.textMorph.removeMarker(t)})}}],void 0,t,void 0,{start:1810,end:5871})}(void 0),Qn=function(e){var n=_classRecorder,o=n.hasOwnProperty("TextMap")&&"function"==typeof n.TextMap?n.TextMap:n.TextMap=function TextMap(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(o,e,[{key:"onChange",value:function TextMap_onChange_(e){return"extent"===e.prop&&this.update(),lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"onChange",this).call(this,e)}},{key:"reset",value:function TextMap_reset_(){this.border={width:0},this.preserveContents=!0}},{key:"attachTo",value:function TextMap_attachTo_(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.textMorph&&this.detachFrom(this.textMorph),this.textMorph=e,i.connect(e,"viewChange",this,"updateDebounced"),i.connect(e,"textChange",this,"updateDebounced"),i.connect(e,"selectionChange",this,"updateDebounced"),t&&(this.textMorph.addMorph(this),this.height=this.textMorph.height),this.update(),this.makeDirty()}},{key:"detachFromCurrentTextMorph",value:function TextMap_detachFromCurrentTextMorph_(){this.detachFrom(this.textMorph),this.textMorph=null}},{key:"detachFrom",value:function TextMap_detachFrom_(e){var t=this;e&&e.attributeConnections.forEach(function(e){return e.targetObj===t&&e.disconnect()})}},{key:"updateDebounced",value:function TextMap_updateDebounced_(){var e=this;this.owner===this.textMorph&&(this.topRight=this.textMorph.innerBounds().topRight().addPt(this.textMorph.scroll)),r.fun.throttleNamed("update-"+this.id,100,function(){return e.update()})()}},{key:"measure",get:function get(){var e=this.width,t=this.height,n=this.textMorph.document;return{width:e,height:t,heightPerLine:Math.min(2,t/n.lines.length),widthPerChar:.5}}},{key:"update",value:function TextMap_update_(){var e=this.context,n=this.textMorph,r=this.measure,i=r.width,o=r.height,a=r.heightPerLine,s=r.widthPerChar,l=n.document,u=n.textLayout,c=n.markers,h=n.selections,d=u.whatsVisible(n),p=d.startRow,f=d.endRow;if(this.owner===n&&(this.topRight=this.textMorph.innerBounds().topRight().addPt(this.textMorph.scroll)),e){this.clear(null),e.fillStyle="rgba(0,0,0, 0.1)",e.fillRect(0,0,i,p*a),e.fillStyle="rgba(0,0,0, 0.1)",e.fillRect(0,f*a,i,o-f*a);var y=0;e.beginPath(),e.lineWidth=Math.max(1,a-.3),e.strokeStyle="gray";var m=!0,g=!1,v=void 0;try{for(var x,b=l.lines[Symbol.iterator]();!(m=(x=b.next()).done);m=!0){var w=x.value.text,_=w.length,k=w.trimLeft().length,S=_-k;e.moveTo(S,y),e.lineTo(S+k*s,y),S=0,y+=a}}catch(e){g=!0,v=e}finally{try{!m&&b.return&&b.return()}finally{if(g)throw v}}e.stroke(),e.beginPath(),e.strokeStyle="black",e.moveTo(0,p*a),e.lineTo(i,p*a),e.moveTo(0,f*a),e.lineTo(i,f*a),e.stroke(),e.fillStyle="blue";var M=!0,C=!1,P=void 0;try{for(var T,A=h[Symbol.iterator]();!(M=(T=A.next()).done);M=!0){var L=T.value;L.isEmpty()||highlighRange(L,"blue",!0)}}catch(e){C=!0,P=e}finally{try{!M&&A.return&&A.return()}finally{if(C)throw P}}var R=!0,E=!1,z=void 0;try{for(var O,I=c[Symbol.iterator]();!(R=(O=I.next()).done);R=!0){var D=O.value,N=D.style["background-color"]||"red";if("string"==typeof N){var F=t.Color.fromString(N);F&&F.a<.5&&(F.a=.9,N=F.toRGBAString())}highlighRange(D.range,N,!0)}}catch(e){E=!0,z=e}finally{try{!R&&I.return&&I.return()}finally{if(E)throw z}}}function highlighRange(t,n){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var r=t.start,o=t.end,s=Math.max((o.row-r.row+1)*a,1);e.fillStyle=n,e.fillRect(0,r.row*a,i,s)}}},{key:"onMouseDown",value:function TextMap_onMouseDown_(e){var t=this,n=this.textMorph,i=this.measure,o=(i.width,i.height,i.heightPerLine),a=e.positionIn(this),s=Math.round(a.y/o);n.scrollPositionIntoView({row:s,column:0}),r.promise.delay(100).then(function(){return t.update()})}},{key:"onDrag",value:function TextMap_onDrag_(e){this.onMouseDown(e)}}],[{key:"openInside",value:function TextMap_openInside_(e){var t=new Qn;return t.attachTo(e),t}},{key:"properties",get:function get(){return{textMorph:{},relativeBoundsInTextMorph:{},extent:{defaultValue:t.pt(60,50)},markers:{}}}}],n,void 0,{start:202,end:4959})}({}.Canvas),Zn=function(e){var t=_classRecorder,n=t.hasOwnProperty("TextSearcher")&&"function"==typeof t.TextSearcher?t.TextSearcher:t.TextSearcher=function TextSearcher(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function TextSearcher_initialize_(e){this.morph=e,this.STOP={}}},{key:"doc",get:function get(){return this.morph.document}},{key:"processFind",value:function TextSearcher_processFind_(e,t){var n=this.doc.positionToIndex(e);return{range:{start:e,end:this.doc.indexToPosition(n+t.length)},match:t}}},{key:"stringSearch",value:function TextSearcher_stringSearch_(e,t,n,r,i,o,a){if(i&&(lessPosition(a,i.start)||lessPosition(i.end,a)))return this.STOP;if(n||(o=o.toLowerCase()),o!==t[0])return null;var s=a.row,l=a.column,u=e[s],c=r<=1?"":"\n"+e.slice(s+1,s+1+(r-1)).join("\n"),h=u.slice(l)+c;return 0!==(n?h:h.toLowerCase()).indexOf(t)?null:this.processFind({row:s,column:l},h.slice(0,t.length))}},{key:"reSearch",value:function TextSearcher_reSearch_(e,t,n,r,i,o){if(r&&(lessPosition(o,r.start)||lessPosition(r.end,o)))return this.STOP;var a=o.row,s=o.column,l=(e[a].slice(s)+(n?"\n"+e.slice(a+1).join("\n"):"")).match(t);return l?this.processFind({row:a,column:s},l[0]):null}},{key:"search",value:function TextSearcher_search_(e){var t,n=Object.assign({start:this.morph.cursorPosition,needle:"",backwards:!1,caseSensitive:!1,inRange:null},e),r=n.start,i=n.needle,o=n.backwards,a=n.caseSensitive,s=n.inRange;if(!i)return null;if(s&&(r=o?minPosition(s.end,r):maxPosition(s.start,r)),i instanceof RegExp){var l=(i.flags||"").split(""),u=!!i.multiline;l.splice(l.indexOf("m"),1),a||l.includes("i")||l.push("i"),i=new RegExp("^"+i.source.replace(/^\^+/,""),l.join("")),t=this.reSearch.bind(this,this.doc.lineStrings,i,u,s)}else{i=String(i),a||(i=i.toLowerCase());var c=i.split(this.doc.constructor.newline).length;t=this.stringSearch.bind(this,this.doc.lineStrings,i,a,c,s)}var h=this.doc[o?"scanBackward":"scanForward"](r,t);return h===this.STOP?null:h}},{key:"searchForAll",value:function TextSearcher_searchForAll_(e){for(var t=[],n=0;;){if(n++>1e4)throw new Error("endless loop");var r=this.search(e);if(!r)return t;t.push(r),e=Object.assign({},e,{start:e.backwards?r.range.start:r.range.end})}}}],void 0,t,void 0,{start:584,end:3725})}(void 0),er=function(e){var n=_classRecorder,o=n.hasOwnProperty("SearchWidget")&&"function"==typeof n.SearchWidget?n.SearchWidget:n.SearchWidget=function SearchWidget(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(o,e,[{key:Symbol.for("lively-instance-initialize"),value:function SearchWidget_initialize_(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t.targetText&&(t.target=t.targetText),!t.target)throw new Error("SearchWidget needs a target text morph!");lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),Symbol.for("lively-instance-initialize"),this).call(this,t);var n,r=this.getSubmorphNamed("replaceButton"),a=this.getSubmorphNamed("replaceAllButton"),s=(this.getSubmorphNamed("replaceInput"),this.getSubmorphNamed("searchInput")),l=this.getSubmorphNamed("prevButton"),u=this.getSubmorphNamed("nextButton"),c=this.getSubmorphNamed("cancelButton"),h=this.getSubmorphNamed("acceptButton");i.connect(h,"fire",this,"execCommand",{converter:function converter(){return"accept search"}}),i.connect(c,"fire",this,"execCommand",{converter:function converter(){return"cancel search"}}),i.connect(u,"fire",this,"execCommand",{converter:function converter(){return"search next"}}),i.connect(l,"fire",this,"execCommand",{converter:function converter(){return"search prev"}}),i.connect(s,"inputChanged",this,"search"),i.connect(r,"fire",this,"execCommand",{converter:function converter(){return"replace and go to next"}}),i.connect(a,"fire",this,"execCommand",{converter:function converter(){return"replace all"}}),this.state={backwards:!1,before:null,position:null,inProgress:null,last:null},s.addCommands([{name:"realign top-bottom-center",exec:(n=H(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return e.target.execCommand("realign top-bottom-center"),e.addSearchMarkersForPreview(e.state.inProgress&&e.state.inProgress.found,!1),t.abrupt("return",!0);case 3:case"end":return t.stop()}},_callee,e)})),function exec(){return n.apply(this,arguments)})}])}},{key:"focus",value:function SearchWidget_focus_(){var e=this;this.get("searchInput").focus(),this.whenRendered().then(function(){return e.get("searchInput").invalidateTextLayout(!0,!0)})}},{key:"onBlur",value:function SearchWidget_onBlur_(e){var t=this,n=this.world();n&&setTimeout(function(){var e=n.focusedMorph;t.withAllSubmorphsDetect(function(e){return e.isFocused()})?t.get("searchInput")!=e&&t.get("replaceInput")!=e&&t.get("searchInput").focus():t.cancelSearch()})}},{key:"cleanup",value:function SearchWidget_cleanup_(){this.removeSearchMarkers(),this.state.inProgress=null,this.textMap&&this.textMap.update()}},{key:"cancelSearch",value:function SearchWidget_cancelSearch_(){if(this.state.inProgress&&(this.state.last=this.state.inProgress),this.cleanup(),this.removeTextMap(),this.state.before){var e=this.state.before,t=e.scroll,n=e.selectionRange;this.target.selection=n,this.target.scroll=t,this.state.before=null}this.remove(),this.target.focus()}},{key:"acceptSearch",value:function SearchWidget_acceptSearch_(){this.state.inProgress&&(this.state.last=this.state.inProgress),this.applySearchResult(this.state.inProgress)&&this.state.before&&this.target.saveMark(this.state.before.position),this.get("searchInput").acceptInput(),this.cleanup(),this.removeTextMap(),this.state.before=null,this.remove(),this.target.focus()}},{key:"applySearchResult",value:function SearchWidget_applySearchResult_(e){if(!e||!e.found)return null;var t=this.target,n=t.selection,r=!!t.activeMark||!n.isEmpty(),i=e.backwards,o=e.found.range,a=o.start,s=o.end,l=i?a:s;return r?n.lead=l:t.cursorPosition=l,t.isLineFullyVisible(l.row)||t.centerRow(),e}},{key:"removeSearchMarkers",value:function SearchWidget_removeSearchMarkers_(){var e=this;(this.target.markers||[]).forEach(function(t){var n=t.id;return n.startsWith("search-highlight")&&e.target.removeMarker(n)})}},{key:"addSearchMarkers",value:function SearchWidget_addSearchMarkers_(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.removeSearchMarkers();var n=this.target,r=this.textMap,i=n.whatsVisible,o=i.startRow,a=i.endRow,s=n.document.lineStrings,l=0,u=z.codeEditor.search,c=u.maxCharsPerLine,h=u.fastHighlightLineCount;r&&e.match.length>=3&&s.length<h&&(o=0,a=s.length-1);for(var d,p=!1,f=window.performance.now(),y=o;y<=a&&!p;y++)for(var m=s[y]||"",g=0;g<Math.min(m.length,c);g++){if(window.performance.now()-f>300){p=!0;break}(t?0===m.slice(g).indexOf(e.match):0===m.slice(g).toLowerCase().indexOf(e.match.toLowerCase()))&&(n.addMarker({id:"search-highlight-"+l++,range:{start:{row:y,column:g},end:{row:y,column:g+e.match.length}},style:{"border-radius":"4px","background-color":"rgba(255, 200, 0, 0.3)","box-shadow":"0 0 4px rgba(255, 200, 0, 0.3)","pointer-events":"none"}}),g+=e.match.length)}if(this.state.backwards){var v=e.range.start,x=v.row,b=v.column;d={start:{row:x,column:b},end:{row:x,column:b+1}}}else{var w=e.range.end,_=w.row,k=w.column;d={start:{row:_,column:k-1},end:{row:_,column:k}}}n.addMarker({id:"search-highlight-cursor",range:d,style:U({"pointer-events":"none","box-sizing":"border-box"},this.state.backwards?"border-left":"border-right","3px red solid")}),r&&r.update()}},{key:"addSearchMarkersForPreview",value:function SearchWidget_addSearchMarkersForPreview_(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&(this.addSearchMarkers(e),t&&this.target.removeMarker("search-highlight-cursor"))}},{key:"prepareForNewSearch",value:function SearchWidget_prepareForNewSearch_(){var e=this.target,t=this.state,n=e.world();if(n){this.openInWorld(n.visibleBounds().center(),n),this.topRight=e.globalBounds().insetBy(5).topRight(),e.getWindow()&&i.once(e.getWindow(),"remove",this,"remove");var r=this.get("searchInput"),o=e.scroll,a=e.selection;t.position=a.lead,t.before={scroll:o,position:a.lead,selectionRange:a.range,selectionReverse:a.isReverse()},t.last&&t.last.found&&(i.disconnect(r,"inputChanged",this,"search"),this.input=t.last.needle,i.connect(r,"inputChanged",this,"search"),this.addSearchMarkersForPreview(t.last.found)),this.focus(),r.selectAll()}}},{key:"advance",value:function SearchWidget_advance_(e){var t=this.state.inProgress;if(t&&t.found){var n=e!==this.state.backwards,r=t.found.range,i=r.start,o=r.end;this.state.position=n?e?o:i:e?i:o}return this.state.backwards=e,this.search()}},{key:"searchNext",value:function SearchWidget_searchNext_(){return this.advance(!1)}},{key:"searchPrev",value:function SearchWidget_searchPrev_(){return this.advance(!0)}},{key:"search",value:function SearchWidget_search_(){if(!this.input)return this.cleanup(),null;var e=this.state,t=e.backwards,n=(e.inProgress,{backwards:t,start:e.position}),r=this.target.search(this.input,n),i=this.state.inProgress=Object.assign({},n,{needle:this.input,found:r});return this.applySearchResult(i),r&&this.addSearchMarkers(r,t),i}},{key:"showTextMap",value:function SearchWidget_showTextMap_(){var e=this.textMap=new Qn;return e.attachTo(this.target),e.isLayoutable=!1,this.addMorph(e),e.topRight=this.innerBounds().bottomRight().addXY(0,5),e.height=this.target.height-this.height-15,e.update(),e}},{key:"removeTextMap",value:function SearchWidget_removeTextMap_(){this.textMap&&(this.textMap.remove(),this.textMap.detachFromCurrentTextMorph(),this.textMap=null)}},{key:"keybindings",get:function get(){return[{keys:"Enter",command:"accept search or replace and go to next"},{keys:"Tab",command:"change focus"},{keys:"Ctrl-O",command:"occur with search term"},{keys:"Ctrl-W",command:"yank next word from text"},{keys:"Escape|Ctrl-G",command:"cancel search"},{keys:{win:"Ctrl-F|Ctrl-S|Ctrl-G",mac:"Meta-F|Ctrl-S|Meta-G"},command:"search next"},{keys:{win:"Ctrl-Shift-F|Ctrl-R|Ctrl-Shift-G",mac:"Meta-Shift-F|Ctrl-R|Meta-Shift-G"},command:"search prev"}]}},{key:"commands",get:function get(){var e=this;return[{name:"occur with search term",exec:function exec(){return e.target.addCommands([Xn]),e.execCommand("accept search"),e.target.execCommand("occur",{needle:e.input})}},{name:"accept search",exec:function exec(){return e.acceptSearch(),!0}},{name:"cancel search",exec:function exec(){return e.cancelSearch(),!0}},{name:"search next",exec:function exec(){return e.searchNext(),!0}},{name:"search prev",exec:function exec(){return e.searchPrev(),!0}},{name:"accept search or replace and go to next",exec:function exec(t,n,r){return e.execCommand(e.get("replaceInput").isFocused()?"replace and go to next":"accept search",n,r)}},{name:"replace current search location with replace input",exec:function exec(){var t=r.Path("state.inProgress").get(e);if(t.found){var n=e.get("replaceInput").textString;e.get("replaceInput").get("replaceInput").acceptInput(),t.needle instanceof RegExp&&(n=t.found.match.replace(t.needle,n)),e.target.replace(t.found.range,n)}return!0}},{name:"replace and go to next",exec:function exec(){return e.execCommand("replace current search location with replace input"),e.execCommand(e.state.backwards?"search prev":"search next"),!0}},{name:"replace all",exec:function exec(){var t=r.Path("state.inProgress").get(e);if(t.found){t=Object.assign({},t,{start:{row:0,column:0}});var n=e.get("replaceInput").textString;e.get("replaceInput").get("replaceInput").acceptInput();var i=new Zn(e.target).searchForAll(t);e.target.undoManager.group(),i.forEach(function(r){var i=r.range,o=r.match;t.needle instanceof RegExp&&(n=o.replace(t.needle,n)),e.target.replace(i,n,!0,!0,!1)}),e.target.undoManager.group(),e.acceptSearch()}return!0}},{name:"change focus",exec:function exec(){return e.get("searchInput").isFocused()?e.get("replaceInput").focus():e.get("searchInput").focus(),!0}},{name:"yank next word from text",exec:function exec(){var t=e.target,n=t.wordRight(),r=e.get("searchInput");r.selection.isEmpty()||(r.selection.text="");var i=t.textInRange({start:t.cursorPosition,end:n.range.end});return r.textString+=i,!0}}]}}],[{key:"properties",get:function get(){return{name:{defaultValue:"search widget"},borderWidth:{defaultValue:1},borderColor:{defaultValue:t.Color.gray},borderRadius:{defaultValue:3},fill:{defaultValue:t.Color.black.withA(.6)},target:{},input:{after:["submorphs"],get:function get(){var e=this.get("searchInput").textString,t=e.match(/^\/(.*)\/([a-z]*)$/);return t?new RegExp(t[1],t[2]):e},set:function set(e){this.get("searchInput").textString=String(e)}},fontSize:{after:["submorphs"],get:function get(){return this.get("searchInput").fontSize},set:function set(e){this.get("replaceInput").fontSize=e}},fontFamily:{after:["submorphs"],get:function get(){return this.get("searchInput").fontFamily},set:function set(e){this.get("searchInput").fontFamily=e,this.get("replaceInput").fontFamily=e}},styleSheets:{initialize:function initialize(){this.styleSheets=new Ir({".Button.nav":{extent:t.pt(24,24),opacity:.9,borderWidth:0,fill:t.Color.transparent},".Button.nav [name=label]":{fontSize:18,fontColor:t.Color.white},".Button.replace":{borderWidth:2,borderColor:t.Color.white,fill:t.Color.transparent},".Button.replace [name=label]":{fontColor:t.Color.white},".InputLine [name=placeholder]":{fontSize:12,fontFamily:"Monaco, monospace"},".InputLine":{fill:t.Color.gray.withA(.2),fontSize:12,fontFamily:"Monaco, monospace",fontColor:t.Color.white,borderWidth:1,borderColor:t.Color.gray,padding:t.Rectangle.inset(2)}})}},layout:{initialize:function initialize(){this.layout=new Or({groups:{nextButton:{resize:!1},prevButton:{resize:!1},acceptButton:{resize:!1},cancelButton:{resize:!1}},rows:[0,{fixed:28,paddingTop:5,paddingBottom:2.5},1,{fixed:28,paddingTop:2.5,paddingBottom:5}],columns:[0,{paddingLeft:5,paddingRight:5},1,{fixed:25},2,{fixed:25},3,{fixed:5},4,{fixed:25},5,{fixed:25},6,{fixed:10}],grid:[["searchInput","nextButton","prevButton",null,"acceptButton","cancelButton",null],["replaceInput","replaceButton","replaceButton",null,"replaceAllButton","replaceAllButton",null]]})}},submorphs:{after:["extent"],initialize:function initialize(){this.submorphs=[new C.Button({name:"acceptButton",label:Un.textAttribute("check-circle-o"),styleClasses:["nav"]}).fit(),new C.Button({name:"cancelButton",label:Un.textAttribute("times-circle-o"),styleClasses:["nav"]}).fit(),new C.Button({name:"nextButton",label:Un.textAttribute("arrow-circle-o-down"),styleClasses:["nav"]}).fit(),new C.Button({name:"prevButton",label:Un.textAttribute("arrow-circle-o-up"),styleClasses:["nav"]}).fit(),dr.makeInputLine({name:"searchInput",clipMode:"hidden",width:this.width,height:20,placeholder:"search input",historyId:"lively.morphic-text search"}),dr.makeInputLine({name:"replaceInput",clipMode:"hidden",width:this.width,height:20,placeholder:"replace input",historyId:"lively.morphic-text replace"}),new C.Button({styleClasses:["replace"],name:"replaceButton",label:"replace",fontSize:10,extent:t.pt(60,17)}),new C.Button({styleClasses:["replace"],name:"replaceAllButton",label:"replace all",fontSize:10,extent:t.pt(60,17)})],i.connect(this.get("searchInput"),"onBlur",this,"onBlur"),i.connect(this.get("replaceInput"),"onBlur",this,"onBlur")}},textMap:{after:["submorphs"]}}}}],n,void 0,{start:3845,end:21764})}($t),tr=[{name:"search in text",exec:function exec(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{backwards:!1},r=e._searchWidget||(e._searchWidget=new er({target:e,extent:t.pt(300,20)}));return r.state.backwards=n.backwards,r.prepareForNewSearch(),z.codeEditor.search.showTextMap&&r.showTextMap(),!0}}];var nr=function(e){var n=_classRecorder,i=n.hasOwnProperty("TextLayout")&&"function"==typeof n.TextLayout?n.TextLayout:n.TextLayout=function TextLayout(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(i,e,[{key:Symbol.for("lively-instance-initialize"),value:function TextLayout_initialize_(){this.reset()}},{key:"reset",value:function TextLayout_reset_(){this.resetLineCharBoundsCache()}},{key:"resetLineCharBoundsCache",value:function TextLayout_resetLineCharBoundsCache_(e){this.lineCharBoundsCache=new WeakMap,e&&(this.estimateLineHeights(e),e.makeDirty())}},{key:"resetLineCharBoundsCacheOfLine",value:function TextLayout_resetLineCharBoundsCacheOfLine_(e){e&&this.lineCharBoundsCache.set(e,null)}},{key:"resetLineCharBoundsCacheOfRow",value:function TextLayout_resetLineCharBoundsCacheOfRow_(e,t){var n=e.document;n&&this.resetLineCharBoundsCacheOfLine(n.getLine(t))}},{key:"resetLineCharBoundsCacheOfRange",value:function TextLayout_resetLineCharBoundsCacheOfRange_(e,t){for(var n=t.start.row;n<=t.end.row;n++)this.resetLineCharBoundsCacheOfRow(e,n)}},{key:"estimateLineHeights",value:function TextLayout_estimateLineHeights_(e,t){var n=e.fontMetric,i=e.textRenderer,o=e.document,a=e.defaultTextStyle,s=e.extent,l=s.x,u=s.y,c=e.clipMode,h=e.textAlign,d=e.padding,p=e.lineWrapping,f=e.debug,y=e.getGlobalTransform(),m=d.left(),g=d.right(),v=d.top(),x=d.bottom(),b=o.lines,w=(o.stringSize,i.directRenderTextLayerFn(e));if(f&&((f=e.debugHelper(f)).debugTextLayout||(f=!1)),!f&&e.lineCount()<10&&e.document.stringSize<3e3&&!r.arr.any(e.textAndAttributes,function(e){return e&&void 0!=e.fontFamily}))for(var _=i.directRenderLineFn(e),k=n.manuallyComputeBoundsOfLines(e,b,0,0,{defaultTextStyle:a,width:l,height:u,clipMode:c,lineWrapping:p,textAlign:h,transform:y,paddingLeft:m,paddingRight:g,paddingTop:v,paddingBottom:x},w,_),S=0;S<b.length;S++){var M=k[S],C=M.width,P=M.height;b[S].changeExtent(C,P,!1)}else{var T=0;l=l-m-g;for(S=0;S<b.length;S++){var A=b[S];if(t||!(A.height>0)){T++;var L,R=A.textAndAttributes,E=[];if(R&&R.length)for(var z=0;z<R.length;z+=2)(L=R[z])&&L.isMorph&&(L.position=this.pixelPositionFor(e,{row:S,column:z/2}).subPt(e.origin)),E.push(Object.assign({},a,{},R[z+1]));else E.push(a);for(var O=E.length,I=0,D=0,N=0;N<O;N++){var F=n.defaultCharExtent(e,{defaultTextStyle:E[N],width:1e3,transform:y,paddingBottom:x,paddingTop:v,paddingRight:g,paddingLeft:m},w);C=F.width,P=F.height;D=Math.max(P,D),I+=C}var B=D,j=A.text.length||1,W=Math.round(I/O),H=j*W,V=p?Math.min(H,l):H;if(p){var U=Math.max(3,l/W),q=Math.ceil(j/U)||1;B=Math.round(q*D)}f&&f.log(A.row+": "+A.height+" => "+B),A.changeExtent(V,B,!0)}}e.viewState._textLayoutStale=!1,f&&f.log("estimateLineHeights, "+T+"/"+b.length+" updated, force: "+t)}}},{key:"defaultCharExtent",value:function TextLayout_defaultCharExtent_(e){var t=e.textRenderer,n=e.fontMetric,r=e.defaultTextStyle,i=e.getGlobalTransform(),o=t.directRenderTextLayerFn(e);return n.defaultCharExtent(e,{transform:i,defaultTextStyle:r,width:1e3},o)}},{key:"textBounds",value:function TextLayout_textBounds_(e){var n=e.document,r=e.padding,i=e.borderWidthLeft,o=e.borderWidthRight,a=e.borderWidthTop,s=e.borderWidthBottom;return new t.Rectangle(r.left(),r.top(),n.width+i+o,n.height+a+s)}},{key:"isFirstLineVisible",value:function TextLayout_isFirstLineVisible_(e){return e.viewState.firstVisibleRow<=0}},{key:"isLastLineVisible",value:function TextLayout_isLastLineVisible_(e){return e.viewState.lastVisibleRow>=e.lineCount()-1}},{key:"isLineVisible",value:function TextLayout_isLineVisible_(e,t){return t>=e.viewState.firstVisibleRow&&t<=e.viewState.lastVisibleRow}},{key:"isLineFullyVisible",value:function TextLayout_isLineFullyVisible_(e,t){return t>=e.viewState.firstFullyVisibleRow&&t<=e.viewState.lastFullyVisibleRow}},{key:"whatsVisible",value:function TextLayout_whatsVisible_(e){var t=e.viewState.firstVisibleRow,n=e.viewState.lastVisibleRow;return{lines:e.document.lines.slice(t,n),startRow:t,endRow:n}}},{key:"firstFullVisibleLine",value:function TextLayout_firstFullVisibleLine_(e){return e.viewState.firstFullyVisibleRow}},{key:"lastFullVisibleLine",value:function TextLayout_lastFullVisibleLine_(e){return e.viewState.lastFullyVisibleRow}},{key:"screenLineRange",value:function TextLayout_screenLineRange_(e,t,n){var r=t.row,i=t.column;i=Math.max(0,i),r=Math.min(e.lineCount()-1,Math.max(0,r));var o=this.charBoundsOfRow(e,r);i>o.length-1&&(i=o.length-1);for(var a=o[i],s=i,l=i,u=i+1;u<o.length&&!(o[u].y+o[u].height>a.y+a.height);u++)l=u;l===o.length-1&&l++;for(u=i-1;u>=0&&!(o[u].y+o[u].height<a.y+a.height);u--)s=u;n&&(s+=e.getLine(r).slice(s,l).match(/^\s*/)[0].length);return new En({start:{row:r,column:s},end:{row:r,column:l}})}},{key:"rangesOfWrappedLine",value:function TextLayout_rangesOfWrappedLine_(e,t){for(var n=e.getLine(t).length,r=0,i=[];;){var o=this.screenLineRange(e,{row:t,column:r},!1);if(i.push(o),o.end.column>=n)break;var a=o.end.column+1;if(a>=n)break;if(a<=r)throw new Error("should not happen "+o.end.column+" vs "+r);r=a}return i}},{key:"chunkAtPos",value:function TextLayout_chunkAtPos_(e,t){!function todo(e){throw new Error("not yet implemented "+e)}("chunkAtPos")}},{key:"charBoundsOfRow",value:function TextLayout_charBoundsOfRow_(e,t){var n=e.document.getLine(t),r=this.lineCharBoundsCache.get(n);if(r)return r;var i=e.fontMetric,o=e.textRenderer,a=e.defaultTextStyle,s=e.extent,l=s.x,u=s.y,c=e.clipMode,h=e.textAlign,d=e.padding,p=e.lineWrapping,f=e.getGlobalTransform(),y=d.left(),m=d.right(),g=d.top(),v=d.bottom(),x=o.directRenderLineFn(e),b=o.directRenderTextLayerFn(e),w=i.manuallyComputeCharBoundsOfLine(e,n,0,0,{defaultTextStyle:a,width:l,height:u,clipMode:c,lineWrapping:p,textAlign:h,paddingLeft:y,paddingRight:m,paddingTop:g,paddingBottom:v,transform:f},b,x);return this.lineCharBoundsCache.set(n,w),w}},{key:"computeMaxBoundsForLineSelection",value:function TextLayout_computeMaxBoundsForLineSelection_(e,t){var n=t.start,i=t.end,o=e.textLayout,a=(i=(i=e.lineWrapping?o.rangesOfWrappedLine(e,n.row).find(function(e){return e.containsPosition(n)}).end:i).row==n.row?i:{row:i.row,column:-1},o.charBoundsOfRow(e,n.row)),s=(a=i.column<0?a.slice(n.column):a.slice(n.column,i.column+1),n.column+(a?a.indexOf(r.arr.max(a,function(e){return e.height})):0));return o.boundsFor(e,{row:n.row,column:s})}},{key:"boundsFor",value:function TextLayout_boundsFor_(e,n){var r=n.row,i=n.column;i=Math.max(0,i),r=Math.min(e.lineCount()-1,Math.max(0,r));var o=this.charBoundsOfRow(e,r),a=void 0;if(o.length>0)if(i>=o.length){var s=o[o.length-1],l=s.x,u=s.y,c=s.width,h=s.height;a=new t.Rectangle(l+c,u,0,h)}else a=t.Rectangle.fromLiteral(o[i]);a||(console.warn("Cannot compute bounds for line "+r+"/"+i),a=new t.Rectangle(0,0,0,0));var d=e.document,p=e.padding;return a.x=a.x+p.left(),a.y=a.y+d.computeVerticalOffsetOf(r)+p.top(),a}},{key:"pixelPositionFor",value:function TextLayout_pixelPositionFor_(e,n){var r=this.boundsFor(e,n),i=r.x,o=r.y;return t.pt(i,o).addPt(e.origin)}},{key:"textPositionFromPoint",value:function TextLayout_textPositionFromPoint_(e,n){var i=n.addPt(e.origin),o=i.x,a=i.y,s=e.document,l=e.padding,u=(e.origin,l.left()),c=l.top();if(a>s.height+c)return s.endPosition;if(a<c)return{row:0,column:0};var h=s.findLineByVerticalOffset(a-c);if(!h)return{row:0,column:0};var d=h.line.row,p=this.charBoundsOfRow(e,d),f=p.length,y=p[0],m=p[f-1],g={row:d,column:0};if(o-=u,a-=c+s.computeVerticalOffsetOf(d),0===f||o<=y.x+Math.round(y.width/2)&&a>=y.y&&a<=y.y+y.height)return g;if(o>m.x+Math.round(m.width/2)&&a>=m.y&&a<=m.y+m.height)return g.column=f,g;for(var v=[],x=f-1;x>=0;x--){var b=(P=p[x]).x,w=P.width,_=P.y,k=P.height;if(!(a<_||a>_+k)&&(v.push(P),o>=b+Math.round(w/2))){var S=1===v.length;return g.column=S?x:x+1,g}}if(v.length)return g.column=p.indexOf(r.arr.last(v)),g;var M=1/0,C=-1;for(x=0;x<p.length;x++){b=(P=p[x]).x,w=P.width,_=P.y,k=P.height;var P,T=n.distSquared(t.pt(b+w/2,_+k/2));T>=M||(M=T,C=x)}return g.column=C,g}}],void 0,n,void 0,{start:274,end:14499})}(void 0),rr=!1,ir=!!z.onloadURLQuery["debug-text"];var or=function(e,t,n,r,i,o){for(;!i&&n<t.length;)i=e[t[n++]+"equestAnimationFrame"];return i&&i.bind(e)||e.setImmediate||function(t){e.setTimeout(t,0)}}("undefined"!=typeof window?window:global,"r webkitR mozR msR oR".split(" "),0);function AfterTextRenderHook(){}AfterTextRenderHook.prototype.reset=function(e){this.morph=e,this.called=!1,this.needsRerender=!1},AfterTextRenderHook.prototype.updateLineHeightOfNode=function(e,t,n){if(0===t.height||t.hasEstimatedExtent){var r=e.getGlobalTransform().inverse();r.e=r.f=0,1==r.getScale()&&0==r.getRotation()||(n.style.transform=r.toString());var i=n.getBoundingClientRect(),o=i.height,a=i.width;return n.style.transform="",o&&a&&(t.height!==o||t.width!==a)&&(t.changeExtent(a,o,!1),e.textLayout.resetLineCharBoundsCacheOfLine(t),this.needsRerender=!0,e.viewState._needsFit=!0),o}return t.height},AfterTextRenderHook.prototype.updateExtentsOfLines=function(e){var t=this.morph,n=(t.textLayout,t.viewState);n.dom_nodes=[],n.dom_nodeFirstRow=0,n.textWidth=e.scrollWidth;for(var r=e.children,i=0,o=void 0;i<r.length&&"line"!=r[i].className;)i++;if(i<r.length){var a=(o=r[i]).dataset,s=Number(a?a.row:o.getAttribute("data-row"));if("number"==typeof s&&!isNaN(s)){n.dom_nodeFirstRow=s;for(var l=t.document.getLine(s);i<r.length;i++){var u=r[i];n.dom_nodes.push(u),l&&(this.updateLineHeightOfNode(t,l,u),l=l.nextLine())}this.needsRerender?(t.fitIfNeeded(),t.makeDirty()):t._dirty=!1}}},AfterTextRenderHook.prototype.hook=function(e,t,n){if(e&&e.parentNode){var r=this.morph.viewState;r.text_layer_node=e,r.fontmetric_text_layer_node=null,this.called=!0,this.updateExtentsOfLines(e)}};var ar=function(e){var n=_classRecorder,i=n.hasOwnProperty("TextRenderer")&&"function"==typeof n.TextRenderer?n.TextRenderer:n.TextRenderer=function TextRenderer(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(i,e,[{key:Symbol.for("lively-instance-initialize"),value:function TextRenderer_initialize_(e){e?rr||function installCSS(e){rr=!0,addOrChangeCSSDeclaration("new-text-css","\n\n    /* markers */\n\n    .newtext-marker-layer {\n      position: absolute;\n    }\n\n    /* selection / cursor */\n\n    .newtext-cursor {\n      z-index: 5;\n      pointer-events: none;\n      position: absolute;\n      background-color: black;\n    }\n\n    .hidden-cursor .newtext-cursor {\n      background-color: transparent !important;\n    }\n\n    .newtext-cursor.diminished {\n      background-color: gray;\n    }\n\n    .newtext-selection-layer {\n      position: absolute;\n    }\n\n    /*-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-*/\n    /* text layer / content */\n\n    .newtext-text-layer {\n      box-sizing: border-box;\n      position: absolute;\n      white-space: pre;\n      z-index: 0;\n      min-width: 100%;\n    }\n\n    .newtext-before-filler {}\n\n    .newtext-text-layer.wrap-by-words {\n      white-space: pre-wrap;\n      overflow-wrap: break-word;\n      max-width: 100%;\n    }\n\n    .newtext-text-layer.only-wrap-by-words {\n      white-space: pre-wrap;\n      overflow-wrap: break-all;\n      max-width: 100%;\n    }\n\n    .newtext-text-layer.wrap-by-chars {\n      white-space: pre-wrap;\n      word-break: break-all;\n      max-width: 100%;\n    }\n\n    .newtext-text-layer.no-wrapping {\n    }\n\n    .newtext-text-layer .line {\n      -moz-border-radius: 0;\n      -webkit-border-radius: 0;\n      border-radius: 0;\n      border-width: 0;\n      background: transparent;\n      font-family: inherit;\n      font-size: inherit;\n      margin: 0;\n      word-wrap: normal;\n      line-height: inherit;\n      color: inherit;\n      position: relative;\n      overflow: visible;\n      -webkit-tap-highlight-color: transparent;\n      -webkit-font-variant-ligatures: contextual;\n      font-variant-ligatures: contextual;\n    }\n\n    .line > .Morph {\n      display: inline-block !important;\n      vertical-align: top !important;\n    }\n\n    blockquote {\n      margin: 0;\n      -webkit-margin-start: 0;\n      -webkit-margin-end: 0;\n    }\n\n    .newtext-text-layer blockquote {\n      margin-left: 2em;\n      margin-right: 2em;\n      border-left: 2px lightgray solid;\n      padding-left: 2%;\n    }\n\n    /* -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-*/\n    /* debug styling */\n\n    .debug-info {\n      position: absolute;\n      outline: 1px solid green;\n      pointer-events: none;\n      z-index: 4;\n      text-align: center;\n      font-family: monospace;\n      color: green;\n      background-color: white;\n      font-size: small;\n      vertical-align: baseline;\n    }\n\n    .debug-line {\n      position: absolute;\n      outline: 1px solid red;\n      pointer-events: none;\n      z-index: 4,\n      text-align: right;\n      font-family: monospace;\n      font-size: small;\n      vertical-align: baseline;\n      color: red;\n    }\n\n    .debug-char {\n      position: absolute;\n      outline: 1px solid orange;\n      pointer-events: none;\n      z-index: 3\n    }\n\n  ",e.document)}(e):console.warn("Text renderer initialized without domEnv. Depending on what you want to do you might have bad luck...!"),this.domEnv=e}},{key:"directRenderLineFn",value:function TextRenderer_directRenderLineFn_(e){var t,n=this,r=e.viewState._renderLineFn;return r||(t=oe(n.domEnv.document),r=e.viewState._renderLineFn=function(r){return n.renderLine(t,null,e,r)}),r}},{key:"directRenderTextLayerFn",value:function TextRenderer_directRenderTextLayerFn_(e){var t,n=this,r=e.viewState._renderTextLayerFn;return r||(t=oe(n.domEnv.document),r=e.viewState._renderTextLayerFn=function(r){return n.renderJustTextLayerNode(t,e,r,[])}),r}},{key:"renderMorph",value:function TextRenderer_renderMorph_(e,t){var n=e.fontSize<=11?2:3,r=[];e.textLayout.estimateLineHeights(e,!1);var i=e.selection;if(e.inMultiSelectMode()){for(var a,s=i.selections,l=0;l<s.length-1;l++){var u;(u=r).push.apply(u,X(this.renderSelectionLayer(e,s[l],!0,2)))}(a=r).push.apply(a,X(this.renderSelectionLayer(e,s[l],!1,4)))}else r=this.renderSelectionLayer(e,i,!1,n);var c=this.renderTextLayer(e,t),h=this.renderJustTextLayerNode(o.h,e,null,[]),d=this.renderMarkerLayer(e,t);c.properties.className+=" actual",h.properties.className+=" font-measure";var p=e.embeddedMorphMap,f=p?e.submorphs.filter(function(e){return!p.has(e)}):e.submorphs;return o.h("div",Object.assign({},defaultAttributes(e,t),{style:Object.assign({},defaultStyle(e),{cursor:"auto"===e.nativeCursor?e.readOnly?"default":"text":e.nativeCursor})}),[].concat(X(r),[d,h,c,t.renderSelectedSubmorphs(e,f)]))}},{key:"renderTextLayer",value:function TextRenderer_renderTextLayer_(e,t){var n=e.debug?[].concat(X(this.renderDebugLayer(e)),X(this.renderLines(o.h,t,e))):this.renderLines(o.h,t,e),r=this.renderJustTextLayerNode(o.h,e,null,n),i=e.viewState.afterTextRenderHook||(e.viewState.afterTextRenderHook=new AfterTextRenderHook);return i.reset(e),r.properties["after-text-render-hook"]=i,or(function(){if(!i.called){var n=t.getNodeForMorph(e),r=n&&n.querySelector(".actual.newtext-text-layer");r&&i.hook(r)}}),r}},{key:"renderJustTextLayerNode",value:function TextRenderer_renderJustTextLayerNode_(e,t,n,r){t.height;var i=t.padding,o=i.x,a=i.y,s=i.width,l=i.height,u=t.lineWrapping,c=t.backgroundColor,h=t.fontColor,d=t.textAlign,p=t.fontSize,f=t.textDecoration,y=t.fontStyle,m=t.fontWeight,g=t.fontFamily,v=t.lineHeight,x=t.wordSpacing,b=t.letterSpacing,w=(t.document,t.tabWidth),_=o+s,k=a+l,S=Math.max(t.document.height,t.height),M="newtext-text-layer";switch(u){case!0:case"by-words":M+=" wrap-by-words";break;case"only-by-words":M+=" only-wrap-by-words";break;case"by-chars":M+=" wrap-by-chars";break;case!1:M+=" no-wrapping"}var C={height:S+"px"};o>0&&(C.paddingLeft=o+"px"),_>0&&(C.paddingRight=_+"px"),a>0&&(C.paddingTop=a+"px"),k>0&&(C.paddingBottom=k+"px"),b&&(C.letterSpacing=b),x&&(C.wordSpacing=x),v&&(C.lineHeight=v),g&&(C.fontFamily=g),m&&(C.fontWeight=m),y&&(C.fontStyle=y),f&&(C.textDecoration=f),p&&(C.fontSize=p+"px"),d&&(C.textAlign=d),h&&(C.color=String(h)),c&&(C.backgroundColor=c),8!==w&&(C.tabSize=w);var P={className:M,style:C};if(n){var T=n.clipMode,A=n.height,L=n.width;"number"==typeof L&&(C.width=L+"px"),"number"==typeof A&&(C.height=A+"px"),T&&(C.overflow=T)}return C.overflow="hidden",e("div",P,r)}},{key:"renderLines",value:function TextRenderer_renderLines_(e,t,n){var r=n.height,i=n.scroll,o=n.padding,a=(o.x,o.y),s=(o.width,o.height,n.document),l=n.clipMode,u=i.y,c=r,h=s.rowCount-1,d=s.height,p="visible"!==l,f=s.findLineByVerticalOffset(p?Math.max(0,p?u-a:0):0)||{row:0,y:0,offset:0,line:s.getLine(0)},y=f.line,m=f.offset,g=f.y,v=f.row,x=s.findLineByVerticalOffset(p?Math.min(d,u-a+c):d)||{row:h,offset:0,y:0,line:s.getLine(h)},b=x.line,w=x.offset,_=x.row,k=p?v:0,S=0===m?v:v+1,M=p?_+1:h,C=b&&w!==b.height?_-1:_,P=[],T=[];T.push(e("div.newtext-before-filler",{style:{height:g+"px"}}));for(var A=y;A&&(P.push(A),T.push(this.renderLine(e,t,n,A)),0,A!==b);)A=A.nextLine();return Object.assign(n.viewState,{scrollTop:u,scrollHeight:c,scrollBottom:u+c,heightBefore:g,textHeight:d,firstVisibleRow:k,lastVisibleRow:M,firstFullyVisibleRow:S,lastFullyVisibleRow:C,visibleLines:P}),ir&&function printViewState(e){var t=e.viewState,n=t.scrollTop,r=t.scrollHeight,i=(t.heightBefore,t.textHeight),o=t.firstVisibleRow,a=t.lastVisibleRow,s=(t.firstFullyVisibleRow,t.lastFullyVisibleRow,t.visibleLines,e.document.lines);console.log(e+" #"+e.id.slice(0,12)+"\nscroll: "+n+" + "+r+"\nlines: "+o+" - "+a+"\nheight: "+i+", "+s.length+" lines")}(n),T}},{key:"renderLine",value:function TextRenderer_renderLine_(e,t,n,i){var o=i.textAndAttributes,a=[],s=o.length,l=void 0,u=void 0,c=void 0,h=void 0,d=void 0,p=void 0,f=void 0,y=void 0,m=void 0,g=void 0,v=void 0,x=void 0,b=void 0,w=void 0,_=void 0,k=void 0,S=void 0,M=void 0,C=void 0,P=void 0,T=void 0,A=void 0,L=void 0,R=void 0;if(s>0)for(var E=0;E<s;E+=2)l=o[E]||"",u=o[E+1],"string"==typeof l?u?(c=u.fontSize&&(r.obj.isString(u.fontSize)?u.fontSize:u.fontSize+"px"),h=u.fontFamily,d=u.fontWeight,p=u.fontStyle,f=u.textDecoration,y=u.fontColor,m=u.backgroundColor,g=u.nativeCursor,v=u.textStyleClasses,x=u.link,P=u.lineHeight||P,T=u.textAlign||T,A=u.wordSpacing||A,L=u.letterSpacing||L,k=u.paddingRight,S=u.paddingLeft,M=u.paddingTop,C=u.paddingBottom,R=u.quote||R,b="span",_={style:w={}},x&&(b="a",_.href=x,_.target="_blank"),c&&(w.fontSize=c),h&&(w.fontFamily=h),d&&(w.fontWeight=d),p&&(w.fontStyle=p),f&&(w.textDecoration=f),y&&(w.color=String(y)),m&&(w.backgroundColor=String(m)),g&&(w.cursor=g),k&&(w.paddingRight=k),S&&(w.paddingLeft=S),M&&(w.paddingTop=M),C&&(w.paddingBottom=C),v&&v.length&&(_.className=v.join(" ")),a.push(e(b,_,l))):a.push(l):a.push(l.isMorph?this.renderEmbeddedSubmorph(e,t,l,u):Dn);else a.push(e("br"));var z={};P&&(z.lineHeight=P),T&&(z.textAlign=T),L&&(z.letterSpacing=L),A&&(z.wordSpacing=A);var O=e("div",{className:"line",style:z,dataset:{row:i.row}},a);if(R){"number"!=typeof R&&(R=1);for(var I=R;I--;)O=e("blockquote",{},O)}return O}},{key:"renderEmbeddedSubmorph",value:function TextRenderer_renderEmbeddedSubmorph_(e,t,n,r){var i=void 0;if(r=r||{},t)return(i=t.render(n)).properties.style.position="relative",i.properties.style.transform="",r.paddingTop&&(i.properties.style.marginTop=r.paddingTop),r.paddingLeft&&(i.properties.style.marginLeft=r.paddingLeft),r.paddingRight&&(i.properties.style.marginRight=r.paddingRight),r.paddingBottom&&(i.properties.style.marginBottom=r.paddingBottom),i;var o=n.extent,a=n.styleClasses,s=o.x+"px",l=o.y+"px";return e("div",{className:a.join(" "),style:{width:s,height:l}},[])}},{key:"renderSelectionLayer",value:function TextRenderer_renderSelectionLayer_(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;if(!n)return[];var o=e.textLayout,a=n.start,s=n.end,l=(n.lead,n.cursorVisible),u=n.selectionColor,c=n.isReverse(),h=(e.document,e.cursorColor),d=o.boundsFor(e,a),p=o.computeMaxBoundsForLineSelection(e,n),f=o.boundsFor(e,s),y=t.pt(d.x,p.y),m=t.pt(f.x,f.y),g=d.height,v=p.height,x=f.height,b=c?t.pt(d.x,d.y):m,w=c?g:x;if(n.isEmpty())return[this.cursor(b,w,l,r,i,h)];if(Math.abs(d.y+g-(f.y+x))<5)return[this.selectionLayerPart(y,m.withY(p.y+v),u),this.cursor(b,w,l,r,i,h)];var _=t.pt(e.width-e.padding.right(),p.y+v),k=t.pt(e.padding.left(),_.y);if(Math.abs(d.y+g-f.y)<5)return[this.selectionLayerPart(y,_,u),this.selectionLayerPart(k,m.addXY(0,x),u),this.cursor(b,w,l,r,i,h)];var S=t.pt(e.width-e.padding.right(),m.y),M=t.pt(e.padding.left(),m.y);return[this.selectionLayerPart(y,_,u),this.selectionLayerPart(k,S,u),this.selectionLayerPart(M,m.addXY(0,x),u),this.cursor(b,w,l,r,i,h)]}},{key:"selectionLayerPart",value:function TextRenderer_selectionLayerPart_(e,t,n){return o.h("div.newtext-selection-layer.selection-layer-part",{style:{left:e.x+"px",top:e.y+"px",width:t.x-e.x+"px",height:t.y-e.y+"px",backgroundColor:n}})}},{key:"cursor",value:function TextRenderer_cursor_(e,t,n,r,i,a){return o.h("div",{className:"newtext-cursor"+(r?" diminished":""),style:{left:e.x-Math.ceil(i/2)+"px",top:e.y+"px",width:i+"px",height:t+"px",display:n?"":"none",background:a||"black"}})}},{key:"renderMarkerLayer",value:function TextRenderer_renderMarkerLayer_(e){var t=e.markers,n=e.textLayout,r=e.viewState,i=r.firstVisibleRow,o=r.lastVisibleRow,a=[];if(!t)return a;var s=!0,l=!1,u=void 0;try{for(var c,h=t[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var d=c.value,p=d.style,f=d.range,y=f.start,m=f.end;if(!(m.row<i||y.row>o))if(y.row!==m.row){a.push(this.renderMarkerPart(n,e,y,e.lineRange(y.row).end,p));for(var g=y.row+1;g<=m.row-1;g++){var v=e.lineRange(g),x=v.start,b=v.end;a.push(this.renderMarkerPart(n,e,x,b,p,!0))}a.push(this.renderMarkerPart(n,e,{row:m.row,column:0},m,p))}else a.push(this.renderMarkerPart(n,e,y,m,p))}}catch(e){l=!0,u=e}finally{try{!s&&h.return&&h.return()}finally{if(l)throw u}}return a}},{key:"renderMarkerPart",value:function TextRenderer_renderMarkerPart_(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=0,l=0,u=0,c=0,h=t.document,d=h.getLine(n.row);if(a){var p=t.padding;s=p.left(),u=p.top()+h.computeVerticalOffsetOf(n.row),l=s+d.width,c=d.height}else{var f=e.boundsFor(t,n);s=f.x,u=f.y;var y=e.boundsFor(t,r);l=y.x,c=y.height}return c=Math.ceil(c),o.h("div.newtext-marker-layer",{style:Object.assign({},i,{left:s+"px",top:u+"px",height:c+"px",width:l-s+"px"})})}},{key:"renderDebugLayer",value:function TextRenderer_renderDebugLayer_(e){var t=e.viewState,n=[],r=t.heightBefore,i=t.firstVisibleRow,a=t.lastVisibleRow,s=t.visibleLines,l=e.padding,u=e.scroll,c=u.x,h=u.y,d=l.left(),p=l.right(),f=l.top();l.bottom();n.push(o.h("div.debug-info",{style:{left:c+d+"px",top:h+"px",width:e.width-p+"px"}},o.h("span","visible rows: "+i+" - "+a)));for(var y=0,m=i;m<a;y++,m++){var g=s[y],v=e.textLayout.lineCharBoundsCache.get(g),x=g.height;if(n.push(o.h("div.debug-line",{style:{left:c+d+"px",top:f+r+"px",width:e.width-p+"px",height:x+"px"}},o.h("span",String(m)))),v){for(var b=0;b<v.length;b++){var w=v[b],_=w.x,k=w.y,S=w.width,M=w.height;n.push(o.h("div.debug-char",{style:{left:d+_+"px",top:f+r+k+"px",width:S+"px",height:M+"px"}}))}r+=x}else r+=x}return n}}],void 0,n,void 0,{start:7426,end:28337})}(void 0);var sr={activate:{name:"[IyGotoChar] activate",exec:function exec(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{backwards:!1};return ur.installInto(e,t.backwards),!0}},moveTo:{name:"[IyGotoChar] move to",exec:function exec(e,t){e.saveMark();var n=e.selection,r=n.lead,i=r.row,o=r.column,a=!!e.activeMark||!n.isEmpty(),s={row:i,column:o-1},l=e.document[t.backwards?"scanBackward":"scanForward"](s,function(e,n){return e!==t.needle||eqPosition(s,n)?null:n});return!l||(l.column++,n.lead=l,a||(n.anchor=l),!0)},multiSelectAction:"forEach",readOnly:!0}},lr=sr.activate,ur=function(e){var t=_classRecorder,n=t.hasOwnProperty("IyGotoCharKeyHandler")&&"function"==typeof t.IyGotoCharKeyHandler?t.IyGotoCharKeyHandler:t.IyGotoCharKeyHandler=function IyGotoCharKeyHandler(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function IyGotoCharKeyHandler_initialize_(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(n.prototype),Symbol.for("lively-instance-initialize"),this).call(this),this.charToFind=void 0,this.backwards=e}},{key:"isIyGoToChar",get:function get(){return!0}},{key:"uninstallFrom",value:function IyGotoCharKeyHandler_uninstallFrom_(e){e._cachedKeyhandlers=null,r.arr.remove(e._keyhandlers||[],this)}},{key:"eventCommandLookup",value:function IyGotoCharKeyHandler_eventCommandLookup_(e,t){var n=t.keyCombo,r=n.startsWith("input-");if(t.onlyModifiers||n.startsWith("Shift-")||t.isFunctionKey&&"Escape"===!n&&"Backspace"===!n||!r&&!t.isModified&&!t.isFunctionKey)return{command:"null",passEvent:!0};var i=r&&n.slice("input-".length);if(!this.charToFind){if(!r)return this.uninstallFrom(e),null;this.charToFind=i}return i!==this.charToFind?(this.uninstallFrom(e),null):{command:sr.moveTo,args:{backwards:this.backwards,needle:i}}}}],[{key:"installInto",value:function IyGotoCharKeyHandler_installInto_(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.keyhandlers.filter(function(e){return e.isIyGoToChar}).forEach(function(t){return t.uninstallFrom(e)}),e._cachedKeyhandlers=null,e._keyhandlers=(e._keyhandlers||[]).concat(new this(t))}}],t,void 0,{start:1049,end:3032})}(ht),cr=[{name:"clipboard copy",doc:"placeholder for native copy",scrollCursorIntoView:!1,exec:function exec(e){return e.selection.isEmpty()&&e.selectLine(e.cursorPosition.row),!0}},{name:"manual clipboard copy",doc:"attempts to copy selection via browser interface",scrollCursorIntoView:!1,multiSelectAction:"single",exec:function exec(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{collapseSelection:!0,delete:!1,dontTryNativeClipboard:!1},n=e.selection,r=n.text,i=!t.hasOwnProperty("collapseSelection")||t.collapseSelection;return e.saveMark(n.anchor),e.activeMark=null,(n.isMultiSelection?n.selections.slice():[n]).forEach(function(n){var r=n.isEmpty()?e.lineRange():n.range,o=e.textInRange(r);e.env.eventDispatcher.killRing.add(o),t.delete?e.deleteText(r):!n.isEmpty()&&i&&n.collapse(n.lead)}),t.dontTryNativeClipboard||e.env.eventDispatcher.doCopy(r),!0}},{name:"clipboard cut",doc:"placeholder for native cut",exec:function exec(e){return e.selection.isEmpty()&&e.selectLine(e.cursorPosition.row,!0),!0}},{name:"clipboard paste",doc:"placeholder for native paste",exec:function exec(){return!0}},{name:"manual clipboard paste",doc:"attempts to paste from the clipboard to lively  currently requires browser extension!",multiSelectAction:"single",exec:function(){var e=H(regeneratorRuntime.mark(function _callee(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{killRingCycleBack:!1};return regeneratorRuntime.wrap(function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return n=e.env.eventDispatcher.killRing,i.killRingCycleBack&&(r.arr.last(r.arr.pluck(e.commandHandler.history,"name"))||"").includes("clipboard paste")&&(t=n.back()),!t&&n.isCycling()&&(t=n.yank()),t||(t=n.yank()),e.selection.isMultiSelection?(e.undoManager.group(),e.selection.selections.slice(0,-1).reverse().map(function(e,t){var r=n.pointer-1-t;return r<0&&(r=n.buffer.length-1),{selection:e,pasted:n.buffer[r]||""}}).concat({selection:e.selection.defaultSelection,pasted:t}).forEach(function(e){var t=e.selection,n=e.pasted;return t.text=n}),e.undoManager.group()):t&&(e.undoManager.group(),e.selection.text=t,e.undoManager.group()),o.abrupt("return",!0);case 6:case"end":return o.stop()}},_callee,this)}));return function exec(t,n){return e.apply(this,arguments)}}()},{name:"browse clipboard",exec:function(){var e=H(regeneratorRuntime.mark(function _callee2(e){var t,n,i,o,a,s;return regeneratorRuntime.wrap(function _callee2$(l){for(;;)switch(l.prev=l.next){case 0:return t=e.env.eventDispatcher.killRing,n=t.pointer,i=t.buffer,o=i.map(function(e){return{isListItem:!0,string:r.string.truncate(e,80).replace(/\n/g,""),value:e}}),l.next=6,e.world().filterableListPrompt("select items to paste",o,{preselect:n,multiSelect:!0});case 6:return a=l.sent,(s=a.selected).length&&(e.undoManager.group(),e.insertTextAndSelect(s.join("\n")),e.undoManager.group()),l.abrupt("return",!0);case 10:case"end":return l.stop()}},_callee2,this)}));return function exec(t){return e.apply(this,arguments)}}()},{name:"text undo",doc:"undo text changes",multiSelectAction:"single",exec:function exec(e){return e.textUndo(),!0}},{name:"text redo",doc:"redo text changes",multiSelectAction:"single",exec:function exec(e){return e.textRedo(),!0}},{name:"select all",doc:"Selects entire text contents.",scrollCursorIntoView:!1,multiSelectAction:"single",exec:function exec(e){return e.saveMark(),e.selectAll(),!0}},{name:"delete backwards",doc:"Delete the character in front of the cursor or the selection.",exec:function exec(e){if(e.rejectsInput())return!1;if(e.editorPlugin&&"function"==typeof e.editorPlugin.cmd_newline&&e.editorPlugin.cmd_delete_backwards())return!0;var t=e.selection;return t.isEmpty()&&t.growLeft(1),t.text="",t.collapse(),e.activeMark&&(e.activeMark=null),!0}},{name:"delete",doc:"Delete the character following the cursor or the selection.",exec:function exec(e){var t=e.selection;return!e.rejectsInput()&&(t.isEmpty()&&t.growRight(1),t.text="",t.collapse(),e.activeMark&&(e.activeMark=null),!0)}},{name:"indent",scrollCursorIntoView:!1,exec:function exec(e){return e.undoManager.group(),e.withSelectedLinesDo(function(t,n){return e.insertText(e.tab,n.start)}),e.undoManager.group(),!0}},{name:"outdent",scrollCursorIntoView:!1,exec:function exec(e){return e.undoManager.group(),e.withSelectedLinesDo(function(t,n){return t.startsWith(e.tab)&&e.deleteText({start:n.start,end:{row:n.start.row,column:e.tab.length}})}),e.undoManager.group(),!0}},{name:"indent according to mode",exec:function(){var e=H(regeneratorRuntime.mark(function _callee3(e){var t,n,r,i,o,a,s,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function _callee3$(u){for(;;)switch(u.prev=u.next){case 0:if(t=e.editorPlugin&&e.editorPlugin.mode){u.next=3;break}return u.abrupt("return",!0);case 3:return n=void 0,r=void 0,i=!l.hasOwnProperty("undo")||l.undo,l.hasOwnProperty("firstRow")&&l.hasOwnProperty("lastRow")?(n=l.firstRow,r=l.lastRow):e.selection.isEmpty()?n=r=e.cursorPosition.row:(o=e.selection.selectedRows,n=o.first,r=o.last),u.next=7,System.import("lively.ide/editor-modes.js");case 7:return a=u.sent,s=a.indentLines,i&&e.undoManager.group(),s(e,t,n,r,"smart",!0,l),i&&e.undoManager.group(),u.abrupt("return",!0);case 13:case"end":return u.stop()}},_callee3,void 0)}));return function exec(t,n){return e.apply(this,arguments)}}()},{name:"tab - snippet expand or indent",scrollCursorIntoView:!0,exec:function exec(e){var t=e.snippets.find(function(t){return t.canExpand(e)});return t?(t.expandAtCursor(e),!0):e.selection.isEmpty()?e.execCommand("insertstring",{string:e.tab}):e.execCommand("indent according to mode")}},{name:"browse snippets",scrollCursorIntoView:!0,exec:function(){var e=H(regeneratorRuntime.mark(function _callee4(e){var t,n,r,i;return regeneratorRuntime.wrap(function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return t=e.snippets.map(function(e){return{isListItem:!0,string:e.trigger+" - "+e.expansion,value:e}}),o.next=3,e.world().filterableListPrompt("select snippet",t,{requester:e});case 3:return n=o.sent,r=$(n.selected,1),(i=r[0])&&i.expandAtCursor(e),o.abrupt("return",!0);case 8:case"end":return o.stop()}},_callee4,this)}));return function exec(t){return e.apply(this,arguments)}}()},{name:"transpose chars",exec:function exec(e){if(e.selection.isEmpty()){var t=e.cursorPosition,n=t.row,r=t.column,i=En.create(n,r-1,n,r+1),o=e.getLine(n),a=o[r-1],s=o[r];a&&s&&e.replace(i,s+a,!0)}return!0}},{name:"cycle selection contents",documentation:"If there are multiple selections, will take the text of the first one and replace the second one with it, the text of the second will replace the third, the last selection contents will replace the contents of the first.",multiSelectAction:"single",exec:function exec(e){var t=e.selection.selections;return e.undoManager.group(),t.reduce(function(e,t){var n=t.text;return t.text=e,n},r.arr.last(t).text),e.undoManager.group(),!0}},{name:"go left",doc:"Move the cursor 1 character left. At the beginning of a line move the cursor up. If a selection is active, collapse the selection left.",exec:function exec(e){return e.activeMark?e.selection.selectLeft(1):e.selection.goLeft(1),!0}},{name:"go right",doc:"Move the cursor 1 character right. At the end of a line move the cursor down. If a selection is active, collapse the selection right.",exec:function exec(e){return e.activeMark?e.selection.selectRight(1):e.selection.goRight(1),!0}},{name:"go up",doc:"Move the cursor 1 line. At the end of a line move the cursor down. If a selection is active, collapse the selection right.",scrollCursorIntoView:!0,exec:function exec(e){return e.activeMark?e.selection.selectUp(1):e.selection.goUp(1,!0),!0}},{name:"go down",exec:function exec(e){return e.activeMark?e.selection.selectDown(1):e.selection.goDown(1,!0),!0}},{name:"select left",exec:function exec(e){return e.selection.selectLeft(1),!0}},{name:"select right",exec:function exec(e){return e.selection.selectRight(1),!0}},{name:"select up",exec:function exec(e){return e.selection.selectUp(1,!0),!0}},{name:"select down",exec:function exec(e){return e.selection.selectDown(1,!0),!0}},{name:"select line",exec:function exec(e){var t=e.selection,n=t.lead.row,r=e.lineRange(n,!1);return t.range=t.range.equals(r)?e.lineRange(n,!0):r,!0}},{name:"goto line start",exec:function exec(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{select:!1}).select||!!e.activeMark,n=e.selection,r=n.lead,i=e.screenLineRange(r,!0);return n.lead=eqPosition(r,i.start)?{column:0,row:r.row}:i.start,!t&&(n.anchor=n.lead),!0}},{name:"goto line end",exec:function exec(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{select:!1}).select||!!e.activeMark,n=e.selection,r=n.lead,i=e.screenLineRange(r,!0);return n.lead=i.end,!t&&(n.anchor=n.lead),!0}},{name:"goto page up",exec:function exec(e){return e.pageUpOrDown({direction:"up",select:!!e.activeMark}),!0}},{name:"goto page down",exec:function exec(e){return e.pageUpOrDown({direction:"down",select:!!e.activeMark}),!0}},{name:"goto page up and select",exec:function exec(e){return e.pageUpOrDown({direction:"up",select:!0}),!0}},{name:"goto page down and select",exec:function exec(e){return e.pageUpOrDown({direction:"down",select:!0}),!0}},{name:"goto start",exec:function exec(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{select:!!e.activeMark};return e.gotoDocumentStart(Object.assign({},t)),!0}},{name:"goto end",exec:function exec(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{select:!!e.activeMark};return e.gotoDocumentEnd(Object.assign({},t)),!0}},{name:"goto paragraph above",exec:function exec(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{select:!!e.activeMark},n=e.paragraphRangeAbove(e.cursorPosition.row);return n.start.row--,e.selection.lead=n.start,t.select||e.collapseSelection(),!0}},{name:"goto paragraph below",exec:function exec(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{select:!!e.activeMark},n=e.paragraphRangeBelow(e.cursorPosition.row);return n.end.row++,e.selection.lead=n.end,t.select||e.collapseSelection(),!0}},{name:"move cursor to screen bottom in 1/3 steps",readOnly:!0,exec:function exec(e){var t=!!e.activeMark,n=e.cursorPosition,r=e.textLayout.firstFullVisibleLine(e),i=e.textLayout.lastFullVisibleLine(e),o=r+Math.floor((i-r)/2),a=n;if(n.row<r)a.row=r;else if(n.row<o)a.row=o;else{if(!(n.row<i))return!0;a.row=i}return e.selection.lead=a,t||(e.selection.anchor=e.selection.lead),!0}},{name:"move cursor to screen top in 1/3 steps",readOnly:!0,exec:function exec(e){var t=!!e.activeMark,n=e.cursorPosition,r=e.textLayout.firstFullVisibleLine(e),i=e.textLayout.lastFullVisibleLine(e),o=r+Math.floor((i-r)/2),a=n;return n.row<=r||(n.row<=o?a.row=r:n.row<=i?a.row=o:a.row=i,e.selection.lead=a,t||(e.selection.anchor=e.selection.lead),!0)}},{name:"goto line",exec:function(){var e=H(regeneratorRuntime.mark(function _callee5(e){var t,n;return regeneratorRuntime.wrap(function _callee5$(r){for(;;)switch(r.prev=r.next){case 0:return t=!!e.activeMark,r.next=3,e.world().prompt("Enter line number");case 3:return r.t0=r.sent,n=Number(r.t0),isNaN(n)||(t?e.selection.lead={row:n,column:0}:e.cursorPosition={row:n,column:0},e.scrollCursorIntoView(),e.focus()),r.abrupt("return",!0);case 7:case"end":return r.stop()}},_callee5,this)}));return function exec(t){return e.apply(this,arguments)}}()},{name:"join line",exec:function exec(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{withLine:"before"},n=e.selection,i=n.start,o=n.end,a=n.lead;if(!e.selection.isEmpty()){if(i.row===o.row)return!0;var s=e.undoManager.ensureNewGroup(e,"join line"),l=r.arr.range(0,o.row-1-i.row).map(function(t){return e.joinLine(i.row)});return e.undoManager.group(s),e.selection.isMultiSelection&&(e.cursorPosition=l[0],l.slice(1).forEach(function(t){return e.selection.addRange({start:t,end:t})})),!0}var u=a.row;if("before"===t.withLine&&u<=0)return!0;if("after"===t.withLine&&u>=e.document.endPosition.row)return!0;e.undoManager.group();var c="before"===t.withLine?u-1:u;return e.cursorPosition=e.joinLine(c),e.undoManager.group(),!0}},{name:"split line",exec:function exec(e){var t=e.cursorPosition,n=e.getLine(t.row).match(/^\s*/)[0].length;return e.insertText("\n"+" ".repeat(n),t),e.cursorPosition=t,!0}},{name:"insert line",exec:function exec(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{where:"above"},n=e.cursorPosition.row,r=e.getLine(n).match(/^\s*/)[0].length;return"below"===t.where&&n++,e.insertText(" ".repeat(r)+"\n",{column:0,row:n}),e.cursorPosition={column:r,row:n},!0}},{name:"duplicate line or selection",exec:function exec(e){e.undoManager.group();var t=e.selection.end;if(e.selection.isEmpty())e.insertText(e.getLine(t.row)+"\n",{column:0,row:t.row+1});else{var n=e.selection.range;e.insertText(e.selection.text,t),e.selection=n}return e.undoManager.group(),!0}},{name:"delete emtpy line or until end of line",exec:function exec(e){var t=e.cursorPosition,n=e.getLine(t.row);if(eqPosition(e.document.endPosition,t))return!0;var r=n.trim()?{start:t,end:{row:t.row,column:n.length}}:{start:{row:t.row,column:0},end:{row:t.row+1,column:0}};return e.env.eventDispatcher.doCopy(e.textInRange(r)),e.undoManager.group(),e.deleteText(r),e.undoManager.group(),!0}},{name:"delete left until beginning of line",exec:function exec(e){if(e.activeMark&&(e.activeMark=null),!e.selection.isEmpty())return e.selection.text="",!0;var t=e.lineRange(),n=e.cursorPosition;if(eqPosition({row:n.row,column:0},n))return!0;var r={start:eqPosition(t.start,n)?{row:n.row,column:0}:t.start,end:n};return e.deleteText(r),!0}},{name:"move lines up",multiSelectAction:"single",exec:function exec(e){var t=e.selection;if(e.inMultiSelectMode()){var n=t.selections.map(function(e){return e.range});return n.slice().sort(En.compare).forEach(function(t){e.selection=t,e.execCommand("move lines up")}),n.forEach(function(e){e.start.row--,e.end.row--}),e.selection.ranges=n,!0}t.isEmpty()||0!==t.end.column||t.growRight(-1);var r=t.start,i=t.end,o=e.getLine(r.row-1),a=e.undoManager.ensureNewGroup(e);return e.insertText(o+"\n",{row:i.row+1,column:0}),e.deleteText({start:{row:r.row-1,column:0},end:{row:r.row,column:0}}),e.undoManager.group(a),!0}},{name:"move lines down",multiSelectAction:"single",exec:function exec(e){var t=e.selection;if(e.inMultiSelectMode()){var n=t.selections.map(function(e){return e.range});return n.slice().sort(En.compare).reverse().forEach(function(t){e.selection=t,e.execCommand("move lines down")}),n.forEach(function(e){e.start.row++,e.end.row++}),e.selection.ranges=n,!0}t.isEmpty()||0!==t.end.column||t.growRight(-1);var r=t.range,i=r,o=i.start,a=i.end;t.isEmpty()?r={start:{row:o.row,column:0},end:{row:o.row+1,column:0}}:0!==a.column&&(r={start:o,end:{row:a.row+1,column:0}});var s=e.undoManager.ensureNewGroup(e),l=e.deleteText(r);return e.insertText(l,{row:o.row+1,column:0}),e.undoManager.group(s),e.selection={start:Object.assign({},o,{row:o.row+1}),end:Object.assign({},a,{row:a.row+1})},!0}},{name:"old select word",exec:function exec(e){var t=e.selection;return t.range=e.wordAt(t.lead).range,!0}},{name:"select word",exec:function exec(e){var t=e.selection,n=e.selectMatchingBrackets(e.textString,e.positionToIndex(t.lead));return n&&(t.range={start:n[0],end:n[1]+1}),!0}},{name:"select word right",exec:function exec(e){var t=e.selection;return t.anchor=e.wordRight(t.end).range.end,!0}},{name:"goto word left",exec:function exec(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{select:!1}).select||!!e.activeMark,n=e.wordLeft().range;return e.selection.lead=n.start,t||(e.selection.anchor=n.start),!0}},{name:"goto word right",exec:function exec(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{select:!1}).select||!!e.activeMark,n=e.wordRight().range;return e.selection.lead=n.end,t||(e.selection.anchor=n.end),!0}},{name:"delete word right",exec:function exec(e){e.undoManager.group();var t=e.wordRight().range.end,n={start:e.cursorPosition,end:t};return e.env.eventDispatcher.doCopy(e.textInRange(n)),e.deleteText(n),e.undoManager.group(),!0}},{name:"delete word left",exec:function exec(e){e.undoManager.group();var t={start:e.wordLeft().range.start,end:e.cursorPosition};return e.deleteText(t),e.undoManager.group(),!0}},{name:"goto matching right",exec:function exec(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{select:!!e.activeMark},n=t.pairs||{"{":"}","[":"]","(":")","<":">"},r=e.findMatchingForward(e.cursorPosition,"right",n)||e.findMatchingForward(e.cursorPosition,"left",n);return r&&(e.selection.lead=r,t.select||(e.selection.anchor=e.selection.lead)),!0}},{name:"goto matching left",exec:function exec(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{select:!!e.activeMark},n=t.pairs||{"}":"{","]":"[",")":"(",">":"<"},r=e.findMatchingBackward(e.cursorPosition,"left",n)||e.findMatchingBackward(e.cursorPosition,"right",n);return r&&(e.selection.lead=r,t.select||(e.selection.anchor=e.selection.lead)),!0}},{name:"realign top-bottom-center",doc:"Cycles through centering the cursor position, aligning it at the top, aligning it at the bottom.",scrollCursorIntoView:!1,multiSelectAction:"single",exec:function exec(e){var n=e.charBoundsFromTextPosition(e.cursorPosition),r=n.topLeft(),i=e.height-n.height,o=e.scroll,a=o.x,s=o.y;return s=Math.abs(r.y-s)<2?r.y-i:Math.abs(r.y-s-.5*i)<2?r.y:r.y-.5*i,e.scroll=t.pt(a,s),!0}},{name:"reverse selection",doc:"switches the selection lead and anchor",exec:function exec(e){var t=e.selection;if(t.isEmpty()){var n=e.popSavedMark();n&&(e.saveMark(e.cursorPosition),t.lead=n.position)}else t.reverse();return!0}},{name:"toggle active mark",doc:"....",handlesCount:!0,multiSelectAction:"single",exec:function exec(e,t,n){var r=e.activeMark,i=e.selection,o=!i.isEmpty();if(4===n){var a=e.popSavedMark();return a&&(i.lead=a.position,o||(i.anchor=i.lead)),!0}if(!r&&!o)return e.activeMark=i.lead,!0;(e.saveMark(r||i.anchor),e.activeMark=null,o)&&(e.inMultiSelectMode()?i.selections:[i]).forEach(function(e){return e.anchor=e.lead});return!0}},{name:"fit text to column",handlesCount:!0,multiSelectAction:"forEach",exec:function exec(e,t,n){if(4===n)return e.execCommand("join line");e.selection.isEmpty()&&e.selectLine();var i=e.selection,o=n||80,a=i.selectedRows,s=i.range,l=/[ ]+/g,u=/^[\s\t]+/,c=r.string.paragraphs(r.arr.range(a.first,a.last).map(function(t){return e.getLine(t)}).join("\n"),{keepEmptyLines:!0}),h=r.chain(c.map(function fitParagraph(e){return/^\s*$/.test(e)?e:function fitRow(e){if(""===e.trim())return[""];var t=e.match(u),n=t?t[0]:"";return function splitLineIntoChunks(e,t,n){if(e.length<=o)return[t+e.trim()];var i=e.slice(0,o),a=r.arr.last(r.string.reMatches(i,l)),s=a&&a.start>0?a.start:o,u=i.slice(0,s),c=t+(i.slice(s)+e.slice(o)).trimLeft();return[u].concat(splitLineIntoChunks(c,t,n+1))}(n+e.trim(),n)}(e.split("\n").join(" ")).join("\n")+"\n"})).flatten().value().join("\n");return e.undoManager.group(),e.replace(s,h),e.undoManager.group(),!0}},{name:"lowercase",exec:function exec(e){return e.undoManager.group(),e.selection.isEmpty()&&(e.selection=e.wordAt().range),e.selection.text=e.selection.text.toLowerCase(),e.undoManager.group(),!0}},{name:"remove trailing whitespace",exec:function exec(e){e.undoManager.group();var t=0;return e.withLinesDo(0,e.documentEndPosition.row,function(n,r){return n.match(/\s+$/)&&++t&&e.replace(r,n.trimRight())}),e.world().setStatusMessage(t+" lines cleaned up"),e.undoManager.group(),!0}},{name:"uppercase",exec:function exec(e){return e.undoManager.group(),e.selection.isEmpty()&&(e.selection=e.wordAt().range),e.selection.text=e.selection.text.toUpperCase(),e.undoManager.group(),!0}},{name:"newline",exec:function exec(e){var t=e.cursorPosition,n=e.getLine(t.row),r=n.match(/^\s*/)[0].length;return e.undoManager.group(),!n.trim()&&r&&(e.deleteText({start:{row:t.row,column:0},end:{row:t.row,column:r}}),t.column=0),!(!e.editorPlugin||"function"!=typeof e.editorPlugin.cmd_newline||!e.editorPlugin.cmd_newline(t,n,r))||(e.selection.text="\n"+" ".repeat(r),e.selection.collapseToEnd(),e.undoManager.group(),!0)}},{name:"insertstring",exec:function exec(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{string:null,undoGroup:!1},n=t.string,r=t.undoGroup,i="string"==typeof n&&n.length;if(i||console.warn("command insertstring called with not string value"),e.rejectsInput()||!i)return!1;if(e.saveActiveMarkAndDeactivate(),e.editorPlugin&&"function"==typeof e.editorPlugin.cmd_insertstring&&e.editorPlugin.cmd_insertstring(n))return!0;var o=e.selection,a=!o.isEmpty();a&&e.undoManager.group();var s=o.lead,l=!(1===n.length&&"\n"!==n&&s.column>0);return o.replace(n,!0,!0,!0,l),o.collapseToEnd(),a&&e.undoManager.group(),r&&(/^[\s\.,\?\+=]+$/.test(n)||"number"!=typeof r?e.undoManager.group():e.undoManager.groupLater(r)),!0}},{name:"toggle line wrapping",scrollCursorIntoView:!1,multiSelectAction:"single",exec:function exec(e){return e.keepPosAtSameScrollOffsetWhile(function(){return e.lineWrapping=!e.lineWrapping&&(!!e.fontMetric.isProportional(e.fontFamily)||"by-chars")}),!0}},{name:"cancel input",scrollCursorIntoView:!1,multiSelectAction:"single",exec:function exec(e,t,n,r){return e.env.eventDispatcher.resetKeyInputState(),e.selection.disableMultiSelect&&e.selection.disableMultiSelect(),e.selection.isEmpty()||(e.selection.anchor=e.selection.lead),e.activeMark&&(e.activeMark=null),!0}}],hr=[{name:"insert date",handlesCount:!0,exec:function exec(e,t,n){var i=r.date.format(new Date,n?"mediumDate":"isoDate");return e.undoManager.group(),e.insertText(i),e.undoManager.group(),!0}},{name:"[todo] toggle todo marker",exec:function exec(e){var t=e.selection;t.isEmpty()&&e.selectLine();var n=/\[\s*\]/g,r=/\[X\]/g,i=t.text;return i=n.test(i)?i.replace(n,"[X]"):r.test(i)?i.replace(r,"[ ]"):"[ ] "+i.trimLeft(),t.text=i,!0}},{name:"selected lines: sort",exec:function exec(e){var t=e.selection,n=t.start.row,r=t.end.row,i=[];return e.withLinesDo(n,r,function(e){var t=i.findIndex(function(t){return t>e});t>-1?i.splice(t,0,e):i.push(e)}),e.undoManager.group(),e.replace({start:{row:n,column:0},end:{row:r+1,column:0}},i.join("\n")+"\n"),e.undoManager.group(),!0}},{name:"selected lines: reverse",exec:function exec(e){var t=e.selection,n=t.start.row,r=t.end.row,i=[];return e.withLinesDo(n,r,function(e){return i.push(e)}),e.undoManager.group(),e.replace({start:{row:n,column:0},end:{row:r+1,column:0}},i.reverse().join("\n")+"\n"),e.undoManager.group(),!0}},{name:"selected lines: remove duplicates (uniq)",exec:function exec(e){var t=e.selection,n=t.start.row,i=t.end.row,o=[];return e.withLinesDo(n,i,function(e){return r.arr.pushIfNotIncluded(o,e)}),e.undoManager.group(),e.replace({start:{row:n,column:0},end:{row:i+1,column:0}},o.join("\n")+"\n"),e.undoManager.group(),!0}},{name:"change string inflection",handlesCount:!0,multiSelectAction:"single",exec:function(){var e=H(regeneratorRuntime.mark(function _callee6(e,t,n){var i,o,a,s,l,u,c,h,d;return regeneratorRuntime.wrap(function _callee6$(t){for(;;)switch(t.prev=t.next){case 0:if(d=function detectCamelCaseType(e){return e.match(/[A-Z]/)?"uppercased":e.match(/-/)?"dashed":e.match(/\s/)?"spaced":"unknown"},h=function convertCamelCased(e,t){var n,r,i=d(e).trim();return"uppercased"===i?n=/\s*[A-Z0-9]+/g:"dashed"===i?n=/-\w/g:"spaced"===i&&(n=/\s+.?/g),"uppercased"===t?r=function replace(e){return e.trim().replace(/^-/,"").toUpperCase()}:"dashed"===t?r=function replace(e){return"-"+e.trim().replace(/^-/,"").toLowerCase()}:"spaced"===t&&(r=function replace(e){return" "+e.trim().replace(/^-/,"").toLowerCase()}),e.replace(n,r)},e.selection.isEmpty()&&(e.selection=e.wordAt().range),i=e.selection.ranges,o=e.textInRange(i[0])){t.next=7;break}return e.setStatusMessage("Please select some text"),t.abrupt("return",!0);case 7:return a=d(o),s=r.arr.without(["uppercased","dashed","spaced"],a),t.next=11,e.world().listPrompt("Convert "+a+" into?",s,{});case 11:if(l=t.sent,u=$(l.selected,1),c=u[0]){t.next=16;break}return t.abrupt("return",!0);case 16:return e.undoManager.group(),i.forEach(function(t,n){var r=e.textInRange(t),i=h(r,c);e.replace(t,i)}),e.undoManager.group(),e.focus(),t.abrupt("return",!0);case 21:case"end":return t.stop()}},_callee6,this)}));return function exec(t,n,r){return e.apply(this,arguments)}}()},{name:"spell check word",exec:function(){var e=H(regeneratorRuntime.mark(function _callee7(e,t){var n,r,i,o,a,s,l;return regeneratorRuntime.wrap(function _callee7$(t){for(;;)switch(t.prev=t.next){case 0:if((n=e.wordAt()).string){t.next=4;break}return e.setStatusMessage("no word for spellcheck!"),t.abrupt("return",!0);case 4:return t.next=6,System.import("lively.ide/shell/spell-checker.js");case 6:return r=t.sent,i=r.spellCheckWord,t.next=10,i(n.string);case 10:if((o=t.sent).length){t.next=14;break}return e.setStatusMessage("no suggestions for word "+n.string),t.abrupt("return",!0);case 14:return t.next=16,e.world().filterableListPrompt("Choose replacement for "+n.string,o);case 16:return a=t.sent,s=$(a.selected,1),(l=s[0])&&(e.undoManager.group(),e.replace(n.range,l),e.undoManager.group()),t.abrupt("return",!0);case 21:case"end":return t.stop()}},_callee7,this)}));return function exec(t,n){return e.apply(this,arguments)}}()},{name:"[shell] run shell command on region",multiSelectAction:"single",exec:function(){var e=H(regeneratorRuntime.mark(function _callee8(e,t){var n,r,i,o,a,s,l;return regeneratorRuntime.wrap(function _callee8$(t){for(;;)switch(t.prev=t.next){case 0:return n=e.textInRange(e.selection),r=n&&0!==n.length?{stdin:n}:{},t.next=4,e.world().prompt("Enter shell command to run on region.",{historyId:"lively.ide.execShellCommand"});case 4:return i=t.sent,t.next=7,System.import("lively.ide/shell/shell-interface.js");case 7:if(o=t.sent,a=o.runCommand,i){t.next=11;break}return t.abrupt("return",e.setStatusMessage("No command entered, aborting...!"));case 11:return s=a(i,r),t.prev=12,t.next=15,s.whenDone();case 15:l=s.output.trim(),e.undoManager.group(),e.selection.selections.forEach(function(e){return e.text=l}),e.undoManager.group(),t.next=24;break;case 21:t.prev=21,t.t0=t.catch(12),e.showError(t.t0);case 24:return t.abrupt("return",!0);case 25:case"end":return t.stop()}},_callee8,this,[[12,21]])}));return function exec(t,n){return e.apply(this,arguments)}}()},{name:"open file at cursor",exec:function(){var e=H(regeneratorRuntime.mark(function _callee9(e,t){var n,r,i,o,a,s,l,u,c;return regeneratorRuntime.wrap(function _callee9$(t){for(;;)switch(t.prev=t.next){case 0:return e.getLine(),n=e.cursorPosition.row,r=e.document.scanBackward(e.cursorPosition,function(e,t){return(t.column<=0||e.match(/\s/))&&t})||{row:0,column:0},i=e.document.scanForward(e.cursorPosition,function(e,t){return(t.row!=n||e.match(/\s/))&&t})||e.documentEndPosition,o=e.textInRange({start:r,end:i}).replace(/\s/g,""),a=o.split(":"),s=a[0].match(/^file|http/)?a.shift()+":"+a.shift():a.shift(),a[0].match(/^[0-9]+$/)&&(s+=":"+a.shift()),t.next=4,System.import("lively.ide/text-editor.js");case 4:return l=t.sent,u=l.default,(c=u.openInWindow()).location=s,t.abrupt("return",c);case 9:case"end":return t.stop()}},_callee9,this)}));return function exec(t,n){return e.apply(this,arguments)}}()},{name:"run code on text morph",doc:"...",exec:function(){var e=H(regeneratorRuntime.mark(function _callee10(e,t){var n,r,i,o,a;return regeneratorRuntime.wrap(function _callee10$(t){for(;;)switch(t.prev=t.next){case 0:return n={targetModule:"lively://code-on-text-morph",context:e},t.next=3,e.world().editPrompt("Run code on selection. Use this.selection.text to access it",{requester:e,mode:"js",evalEnvironment:n,historyId:"run-code-on-text-morph-hist"});case 3:return r=t.sent,i=void 0,o=void 0,t.prev=6,e.undoManager.group(),t.next=10,lively.vm.runEval(r,n);case 10:a=t.sent,e.undoManager.group(),o=a.isError?a.value:null,t.next=18;break;case 15:t.prev=15,t.t0=t.catch(6),o=t.t0;case 18:return o&&e.showError(o),t.abrupt("return",i);case 20:case"end":return t.stop()}},_callee10,this,[[6,15]])}));return function exec(t,n){return e.apply(this,arguments)}}()},{name:"change editor mode",exec:function(){var e=H(regeneratorRuntime.mark(function _callee11(e){var t,n,r,i,o,a,s,l,u;return regeneratorRuntime.wrap(function _callee11$(c){for(;;)switch(c.prev=c.next){case 0:return t=function filter(e){return!e.endsWith("ide/editor-plugin.js")&&e.endsWith("editor-plugin.js")},c.next=3,lively.modules.getPackage("lively.ide").resources(t);case 3:return n=c.sent,r=e.editorPlugin||{},i=r.shortName,o=0,a=["<no mode>"].concat(n.map(function(e,t){var n=e.url.match(/([^\/]+)\/editor-plugin.js/)[1];return n===i&&(o=t),{isListItem:!0,string:n,value:e}})),c.next=10,e.world().filterableListPrompt("choose mode",a,{requester:e,preselect:o,historyId:"lively.morphic/text-change-editor-mode-hist",fuzzy:!0});case 10:if(s=c.sent,l=$(s.selected,1),u=l[0]){c.next=15;break}return c.abrupt("return");case 15:if("<no mode>"!==u){c.next=20;break}return c.next=18,e.changeEditorMode(null);case 18:return e.resetTextAttributes(),c.abrupt("return");case 20:if(u.isLoaded){c.next=23;break}return c.next=23,lively.modules.module(u.url).load();case 23:return c.next=25,e.changeEditorMode(u.url);case 25:case"end":return c.stop()}},_callee11,this)}));return function exec(t){return e.apply(this,arguments)}}()},{name:"report token at cursor",exec:function(){var e=H(regeneratorRuntime.mark(function _callee12(e){var t,n,r,i;return regeneratorRuntime.wrap(function _callee12$(o){for(;;)switch(o.prev=o.next){case 0:return t=e.tokenAt(e.cursorPosition)||{},n=t.token,r=t.start,i=t.end,e.setStatusMessage(n?n+" "+r.column+" => "+i.column:"no token"),o.abrupt("return",!0);case 6:case"end":return o.stop()}},_callee12,this)}));return function exec(t){return e.apply(this,arguments)}}()}];cr.push.apply(cr,hr),cr.push(lr),cr.push.apply(cr,X(tr));var dr=function(e){var n=_classRecorder,o=n.hasOwnProperty("Text")&&"function"==typeof n.Text?n.Text:n.Text=function Text(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(o,e,[{key:Symbol.for("lively-instance-initialize"),value:function Text_initialize_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.position,n=e.rightCenter,r=e.leftCenter,i=e.topCenter,a=e.bottom,s=e.top,l=e.right,u=e.left,c=e.bottomCenter,h=e.bottomLeft,d=e.bottomRight,p=e.topRight,f=e.topLeft,y=e.center;lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e),this.undoManager.reset(),this.fit(),void 0!==t&&(this.position=t),void 0!==n&&(this.rightCenter=n),void 0!==r&&(this.leftCenter=r),void 0!==i&&(this.topCenter=i),void 0!==a&&(this.bottom=a),void 0!==s&&(this.top=s),void 0!==l&&(this.right=l),void 0!==u&&(this.left=u),void 0!==c&&(this.bottomCenter=c),void 0!==h&&(this.bottomLeft=h),void 0!==d&&(this.bottomRight=d),void 0!==p&&(this.topRight=p),void 0!==f&&(this.topLeft=f),void 0!==y&&(this.center=y)}},{key:"__deserialize__",value:function Text___deserialize___(e,t,n){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"__deserialize__",this).call(this,e,t),this.viewState=this.defaultViewState,this.markers=[],this.textRenderer=new ar(this.env.domEnv),this.textLayout=new nr(this),this.changeDocument(Hn.fromString("")),this.ensureUndoManager()}},{key:"__after_deserialize__",value:function Text___after_deserialize___(e,t){var n=this;lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"__after_deserialize__",this).call(this,e,t),e._cachedLineExtents&&(this.changeMetaData("deserializeInfo",{recoveredTextBounds:!0}),this.whenRendered().then(function(){for(var t=0;t<Math.min(e._cachedLineExtents.length,n.document.lines.length);t++){var r=$(e._cachedLineExtents[t],2),i=r[0],o=r[1];n.document.lines[t].changeExtent(i,o),n.fit()}}))}},{key:"__only_serialize__",get:function get(){return r.arr.withoutAll(lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"__only_serialize__",this),["document","textRenderer","viewState","undoManager","markers","textLayout","embeddedMorphMap"])}},{key:"__additionally_serialize__",value:function Text___additionally_serialize___(e,t,n,i){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"__additionally_serialize__",this).call(this,e,t,n,i),e.props.selections={key:"selections",verbatim:!0,value:(this.selection.isMultiSelection?this.selection.ranges:[this.selection.range]).map(function(e){return r.obj.select(e,["start","end"])})},e.props.textAndAttributes={key:"textAndAttributes",value:this.textAndAttributes.map(function(e){return e?e.isMorph?n.ref(e).asRefForSerializedObjMap():r.obj.isObject(e)?n.expressionSerializer.exprStringEncode({__expr__:"("+JSON.stringify(e)+")"}):e:e})},e._cachedLineExtents=this.document.lines.map(function(e){return[e.width,e.height]})}},{key:"isText",get:function get(){return!0}},{key:"onChange",value:function Text_onChange_(e){var t=this,n=e.prop,a=e.selector,s=e.meta,l=this.lineWrapping,u=!1,c=!1,h=!1,d=!1,p=!1;if(a)u="replace"===a,d="addTextAttribute"===a,this._displacementChange=!this._displacing&&u;else switch(n){case"scroll":c=!0,p=!0;break;case"extent":c=!0,h=!0,d=l&&e.prevValue.x!=e.value.x,this._displacementChange=d;break;case"wordSpacing":case"letterSpacing":case"tabWidth":l&&(d=!0);break;case"fontFamily":case"fontSize":case"lineHeight":case"textAlign":case"fontWeight":case"fontStyle":case"textStyleClasses":case"fixedWidth":case"lineWrapping":d=!0;break;case"fixedHeight":case"padding":h=!0}lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"onChange",this).call(this,e);var f=function updateTextEngine(){p&&(t.viewState.wasScrolled=!0),(d||h)&&t.invalidateTextLayout(d,d),t._displacementChange&&(t._displacementChange=!1),u&&i.signal(t,"textChange",e),c&&i.signal(t,"viewChange",e)};s.animation?r.promise.delay(s.animation.duration).then(f):f()}},{key:"onSubmorphChange",value:function Text_onSubmorphChange_(e,t){var n=this;lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"onSubmorphChange",this).call(this,e,t);var i=e.prop,a="position"==i||"extent"==i||"scale"==i||"rotation"==i;!t.isDisplacementMorph&&this.displacingMorphMap.get(t)&&a&&[].concat(X(this.displacingMorphMap.keys())).filter(function(e){return e.top>=t.top}).forEach(function(e){n._intersectionShapeCache&&n._intersectionShapeCache.delete(e),n.updateTextDisplacementFor(e)}),!t.isDisplacementMorph&&this.embeddedMorphMap.get(t)&&!this._positioningSubmorphs&&a&&(r.obj.equals(e.prevValue,e.value)||(this._positioningSubmorphs=!0,this.invalidateTextLayout("position"!=i,"position"!=i),this._positioningSubmorphs=!1))}},{key:"removeMorph",value:function Text_removeMorph_(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.embeddedMorphMap,r=this.displacingMorphMap;if(r&&r.has(e)&&this.toggleTextWrappingAround(e,!1),n&&n.has(e)){var i=n.get(e).anchor;if(i){var a=i.position,s=a.row,l=a.column;this.replace({start:{row:s,column:l},end:{row:s,column:l+1}},[],!0,t),this.replace}n.delete(e)}return lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"removeMorph",this).call(this,e)}},{key:"toggleTextWrappingAround",value:function Text_toggleTextWrappingAround_(e,t){var n=this;if(t){if(this.displacingMorphMap.has(e))return;this.embeddedMorphMap.has(e)&&this.addMorph(e.remove()),this.displacingMorphMap.set(e,[]),this.updateTextDisplacementFor(e)}else{var r=this.displacingMorphMap.get(e);r&&(this._displacing=!0,r.forEach(function(e){return n.removeMorph(e)}),this._displacing=!1,this.displacingMorphMap.delete(e))}}},{key:"updateTextDisplacementFor",value:function Text_updateTextDisplacementFor_(e){var t=this;if(!this._displacing){this._displacing=!0;var n,r=this.displacingMorphMap.get(e),i=this.computeDisplacementRectsFor(e).values(),o=[];r.forEach(function(e){return t.removeMorph(e,!1)}),this.textLayout.resetLineCharBoundsCacheOfRange(this,e._displacementRange);var a=!0,s=!1,l=void 0;try{for(var u,c=i[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var h=u.value,d=r.shift()||morph$2({visible:!0,reactsToPointer:!1,isDisplacementMorph:!0}),p=this.textLayout.textPositionFromPoint(this,h.leftCenter());d.setBounds(h),this.insertText([d,{}],p),this.viewState._needsFit=!1,n!=d.top?(n=d.top,o.push(d)):d.remove()}}catch(e){s=!0,l=e}finally{try{!a&&c.return&&c.return()}finally{if(s)throw l}}r.forEach(function(e){return t.removeMorph(e,!1)}),this.displacingMorphMap.set(e,o),this._displacing=!1}}},{key:"computeDisplacementRectsFor",value:function Text_computeDisplacementRectsFor_(e){var n=this.textLayout,r=n.textPositionFromPoint(this,e.topLeft),i=n.textPositionFromPoint(this,e.bottomLeft),o=[];e._displacementRange=En.fromPositions(r,i);for(var a=r.row;a<i.row+1;a++)o.push.apply(o,X(n.rangesOfWrappedLine(this,a)));this._intersectionShapeCache||(this._intersectionShapeCache=new Map);var s=this._intersectionShapeCache.get(e)||function computeIntersectionShape(e){return e.isPath?M.Shapes.path(getSvgVertices(e.vertices)):"Ellipse"==e.constructor.name?M.Shapes.ellipse(e.center.x,e.center.y,e.width/2,e.height/2):M.Shapes.rectangle(e.left,e.top,e.width,e.height)}(e);this._intersectionShapeCache.set(e,s);var l=this.width,u=new Map,c=!0,h=!1,d=void 0;try{for(var p,f=o[Symbol.iterator]();!(c=(p=f.next()).done);c=!0){var y=p.value,m=n.computeMaxBoundsForLineSelection(this,y),g=m.height,v=m.y,x=M.Shapes.rectangle(l,g,0,v),b=M.Intersection.intersect(x,s);if(!(b.points.length<1)){var w=t.Rectangle.unionPts(b.points.map(t.Point.fromLiteral));w.y=v,w.height=g,w.x-=15,w.width+=30,u.set(y,w)}}}catch(e){h=!0,d=e}finally{try{!c&&f.return&&f.return()}finally{if(h)throw d}}return u}},{key:"rejectsInput",value:function Text_rejectsInput_(){return this.readOnly}},{key:"addAnchor",value:function Text_addAnchor_(e){if(e){if("string"==typeof e&&(e={id:e,row:0,column:0}),!e.isAnchor){var t=e,n=t.id,r=t.column,i=t.row,o=t.insertBehavior;e=new Vn(n,"number"==typeof i&&"number"==typeof r?{row:i,column:r}:void 0,o||"move")}var a=e.id&&this.anchors.find(function(t){return t.id===e.id});return a?Object.assign(a,e):(this.anchors.push(e),e)}}},{key:"removeAnchor",value:function Text_removeAnchor_(e){for(var t=this.anchors,n=void 0,r=t.length;r--;){var i=t[r];i.id!=e&&i!==e||(n=i,t.splice(r,1))}return n}},{key:"addMarker",value:function Text_addMarker_(e){return this.removeMarker(e.id),this.markers.push(e),this.makeDirty(),e}},{key:"removeMarker",value:function Text_removeMarker_(e){var t="string"==typeof e?e:e.id;this.markers=this.markers.filter(function(e){return e.id!==t}),this.makeDirty()}},{key:"saveMark",value:function Text_saveMark_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cursorPosition,t=arguments[1],n=this.activeMark;n&&n!==e&&!n.equalsPosition(e)&&(this.savedMarks=this.savedMarks.concat(n)),t?this.activeMark=e:this.savedMarks=this.savedMarks.concat(e)}},{key:"saveActiveMarkAndDeactivate",value:function Text_saveActiveMarkAndDeactivate_(){var e=this.activeMark;e&&(this.saveMark(e),this.activeMark=null)}},{key:"popSavedMark",value:function Text_popSavedMark_(){var e=this.activeMark;if(e)return this.activeMark=null,e;var t=r.arr.last(this.savedMarks);return this.savedMarks=this.savedMarks.slice(0,-1),t}},{key:"lastSavedMark",get:function get(){return this.activeMark||r.arr.last(this.savedMarks)}},{key:"savedMarkForSelection",value:function Text_savedMarkForSelection_(e){var t=this.selection,n=this.savedMarks,r=this.multiSelect?this.multiSelect.getAllRanges().length:1,i=t.index||0,o=n.length-(r-i),a=n[o]||t.anchor;return e&&"row"in e&&"column"in e&&(this.savedMarks=n.slice(0,o).concat(e).concat(n.slice(o+1))),a}},{key:"addPlugin",value:function Text_addPlugin_(e){return this.plugins.includes(e)||(this.plugins.push(e),this._cachedKeyhandlers=null,"function"==typeof e.attach&&e.attach(this)),e}},{key:"removePlugin",value:function Text_removePlugin_(e){return!!this.plugins.includes(e)&&(this._cachedKeyhandlers=null,r.arr.remove(this.plugins,e),"function"==typeof e.detach&&e.detach(this),!0)}},{key:"pluginCollect",value:function Text_pluginCollect_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.plugins.forEach(function(n){return"function"==typeof n[e]&&(t=n[e](t))}),t}},{key:"pluginInvokeFirst",value:function Text_pluginInvokeFirst_(e){for(var t=this.pluginFind(function(t){return"function"==typeof t[e]}),n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return t?t[e].apply(t,r):void 0}},{key:"pluginFind",value:function Text_pluginFind_(e){return this.plugins.slice().reverse().find(e)}},{key:"editorPlugin",get:function get(){return this.pluginFind(function(e){return e.isEditorPlugin})}},{key:"lookupEditorPluginNamed",value:function(){var e=H(regeneratorRuntime.mark(function _callee(e){var t,n,r,i;return regeneratorRuntime.wrap(function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return e=z.ide.modes.aliases[e]||e,t=/^[^:\\]+:\/\//.test(e),n=t?e:"lively.ide/"+e+"/editor-plugin.js",o.next=4,lively.modules.doesModuleExist(n);case 4:if(o.sent){o.next=6;break}return o.abrupt("return",null);case 6:return o.next=8,lively.modules.module(n).load();case 8:return r=o.sent,i=r.default,o.abrupt("return",i);case 11:case"end":return o.stop()}},_callee,this)}));return function Text_lookupEditorPluginNamed_(t){return e.apply(this,arguments)}}()},{key:"changeEditorMode",value:function(){var e=H(regeneratorRuntime.mark(function _callee2(e){var t,n;return regeneratorRuntime.wrap(function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:if(t=this.plugins.filter(function(e){return!e.isEditorPlugin}),e){r.next=4;break}return this.plugins=t,r.abrupt("return",null);case 4:if("string"!=typeof e){r.next=11;break}return r.next=7,this.lookupEditorPluginNamed(e);case 7:if(n=r.sent){r.next=10;break}throw new Error("Cannot find editor mode "+e);case 10:e=new n(z.codeEditor.defaultTheme);case 11:return this.plugins=t.concat(e),r.abrupt("return",e);case 13:case"end":return r.stop()}},_callee2,this)}));return function Text_changeEditorMode_(t){return e.apply(this,arguments)}}()},{key:"invalidateTextLayout",value:function Text_invalidateTextLayout_(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.viewState;if(n){this.fixedWidth&&this.fixedHeight||(n._needsFit=!0);var r=this.textLayout;r&&(e&&r.resetLineCharBoundsCache(this),r.estimateLineHeights(this,t))}}},{key:"textBounds",value:function Text_textBounds_(){return this.textLayout.textBounds(this)}},{key:"defaultCharExtent",value:function Text_defaultCharExtent_(){return this.textLayout.defaultCharExtent(this)}},{key:"scrollExtent",get:function get(){return this.textBounds().extent().addPt(this.padding.topLeft()).addPt(this.padding.bottomRight()).addPt(this.scrollbarOffset).maxPt(lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"scrollExtent",this))}},{key:"commands",get:function get(){return this.pluginCollect("getCommands",(this._commands||[]).concat(cr))}},{key:"execCommand",value:function Text_execCommand_(e,t,n,i){var o=this,a=this.lookupCommand(e)||{},s=(a.name,a.command);if(s){var l=this.inMultiSelectMode(),u=s.hasOwnProperty("multiSelectAction")?s.multiSelectAction:"forEach";if(l&&"forEach"===u){var c=this.selection,h=this.selection.selections.slice().reverse();this.selection=h[0],this._multiSelection=c;try{var d=this.execCommand(e,t,n,i)}catch(e){throw this.selection=c,this._multiSelection=null,this.selection.mergeSelections(),e}if(!d)return d;var p=[d];if("function"==typeof d.then&&"function"==typeof d.catch)return r.promise.finally(r.promise.chain([function(){return d}].concat(h.slice(1).map(function(r){return function(){return o.selection=r,Promise.resolve(o.execCommand(e,t,n,i)).then(function(e){return p.push(e)})}}))).then(function(){return p}),function(){o.selection=c,o._multiSelection=null,o.selection.mergeSelections()});try{var f=!0,y=!1,m=void 0;try{for(var g,v=h.slice(1)[Symbol.iterator]();!(f=(g=v.next()).done);f=!0){var x=g.value;this.selection=x,p.push(this.execCommand(e,t,n,i))}}catch(e){y=!0,m=e}finally{try{!f&&v.return&&v.return()}finally{if(y)throw m}}}finally{this.selection=c,this._multiSelection=null,this.selection.mergeSelections()}return p}return(d=this.commandHandler.exec(e,this,t,n,i))&&("function"==typeof d.then&&"function"==typeof d.catch?d.then(function(){return cleanupScroll(o)}):cleanupScroll(this)),d}function cleanupScroll(e){(!s.hasOwnProperty("scrollCursorIntoView")||s.scrollCursorIntoView)&&r.fun.debounceNamed("execCommand-scrollCursorIntoView-"+e.id,100,function(){return e.scrollCursorIntoView()})()}}},{key:"changeDocument",value:function Text_changeDocument_(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.document)var n=this.defaultTextStyle;else t=!1;this.document=e,this.textLayout.reset(),t&&(this.defaultTextStyle=n),this.makeDirty(),this.consistencyCheck()}},{key:"textInRange",value:function Text_textInRange_(e){return this.document.textInRange(e)}},{key:"charRight",value:function Text_charRight_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cursorPosition,t=e.row,n=e.column;return this.getLine(t).slice(n,n+1)}},{key:"charLeft",value:function Text_charLeft_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cursorPosition,t=e.row,n=e.column;return this.getLine(t).slice(n-1,n)}},{key:"indexToPosition",value:function Text_indexToPosition_(e){return this.document.indexToPosition(e)}},{key:"positionToIndex",value:function Text_positionToIndex_(e){return this.document.positionToIndex(e)}},{key:"getVisibleLine",value:function Text_getVisibleLine_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cursorPosition.row;return this.textLayout.wrappedLines(this)[e].text}},{key:"isLineVisible",value:function Text_isLineVisible_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cursorPosition.row;return this.textLayout.isLineVisible(this,e)}},{key:"isLineFullyVisible",value:function Text_isLineFullyVisible_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cursorPosition.row;return this.textLayout.isLineFullyVisible(this,e)}},{key:"getLine",value:function Text_getLine_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cursorPosition.row;return this.document.getLineString(e)}},{key:"lineCount",value:function Text_lineCount_(){return this.document.rowCount}},{key:"isLineEmpty",value:function Text_isLineEmpty_(e){return!this.getLine(e).trim()}},{key:"isAtLineEnd",value:function Text_isAtLineEnd_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cursorPosition,t=this.getLine(e.row);return e.column===t.length}},{key:"wordsOfLine",value:function Text_wordsOfLine_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cursorPosition.row;return this.document.wordsOfLine(e)}},{key:"wordAt",value:function Text_wordAt_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cursorPosition;return this.document.wordAt(e)}},{key:"wordLeft",value:function Text_wordLeft_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cursorPosition;return this.document.wordLeft(e)}},{key:"wordRight",value:function Text_wordRight_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cursorPosition;return this.document.wordRight(e)}},{key:"lineRange",value:function Text_lineRange_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cursorPosition.row,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];"number"!=typeof e&&this.cursorPosition.row;var n=this.getLine(e),r={start:{column:0,row:e},end:{column:n.length,row:e}},i=n.match(/^\s*/);return i[0].length&&t&&(r.start.column+=i[0].length),new En(r)}},{key:"screenLineRange",value:function Text_screenLineRange_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cursorPosition,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.textLayout.screenLineRange(this,e,t)}},{key:"insertTextAndSelect",value:function Text_insertTextAndSelect_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e=String(e),t?this.selection.range=this.insertText(e,t):this.selection.text=e}},{key:"append",value:function Text_append_(e){var t=this;return this.saveExcursion(function(){return t.insertText(e,t.documentEndPosition)})}},{key:"insertText",value:function Text_insertText_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.cursorPosition,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return this.replace({start:t,end:t},e,n,r)}},{key:"deleteText",value:function Text_deleteText_(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.textAndAttributesInRange(e);return this.replace(e,[],!1,t),n}},{key:"replace",value:function Text_replace_(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=this,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];e=e.isRange?e:new En(e);var s="string"==typeof t?[t,null]:Array.isArray(t)?t:[String(t||""),null],l=!s.length||2==s.length&&!s[0],u=e.isEmpty();if(l&&u)return e;var c=void 0;n&&(c=this.textAttributeAt({row:e.start.row,column:e.start.column-(e.start.column>0?1:0)}));for(var h=[],d=0;d<s.length;d+=2){var p=s[d],f=s[d+1];p.isMorph&&h.push(p),c&&(s[d+1]=Object.assign({},c,{},f))}o&&this.undoManager.undoStart(this,"replace");var y=this.textAndAttributesInRange(e),m=this.document.replace(e,s,this.debug&&this.debugHelper(this.debug)).inserted;return this.addMethodCallChangeDoing({target:this,selector:"replace",args:[e,s],undo:{target:this,selector:"replace",args:[m,y,!1]}},function(){var t,n,o,l;r&&(i.invalidateTextLayout(!1,!1),i.textLayout.resetLineCharBoundsCacheOfRange(i,m)),eqPosition(e.end,m.end)||(lessPosition(m.end,e.end)?(o=new En(e).subtract(m),l=$(o,1)[0],i.anchors.forEach(function(e){return e.onDelete(l)})):(t=new En(m).subtract(e),n=$(t,1)[0],i.anchors.forEach(function(e){return e.onInsert(n)})),i._multiSelection?i._multiSelection.updateFromAnchors():i.selection.updateFromAnchors()),i._updateEmbeddedMorphsDuringReplace(h,m,s,y),a&&i.consistencyCheck()}),o&&this.undoManager.undoStop(),m}},{key:"_updateEmbeddedMorphsDuringReplace",value:function Text__updateEmbeddedMorphsDuringReplace_(e,t,n,r){for(var o=this.embeddedMorphMap,a=0;a<r.length;a+=2){var s=r[a];if(s.isMorph&&!e.includes(s)){if(o){var l=o.get(s);l&&l.anchor&&(this.removeAnchor(l.anchor),i.disconnect(l.anchor,"position",s,"position")),o.set(s,Object.assign({},l,{anchor:null}))}s.remove()}}if(e.length)for(var u=function textAndAttributesWithSubRanges(e,t){var n=e.column,r=e.row,i=[],o=[],a=!0,s=!1,l=void 0;try{for(var u,c=splitTextAndAttributesIntoLines(t)[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){for(var h=u.value,d=0;d<h.length;d+=2){var p=h[d],f=n+("string"==typeof p?p.length:1);i.push({start:{row:r,column:n},end:{row:r,column:f}}),o.push(h[d],h[d+1]),n=f}n=0,r++}}catch(e){s=!0,l=e}finally{try{!a&&c.return&&c.return()}finally{if(s)throw l}}return{ranges:i,textAndAttributes:o}}(t.start,n),c=u.ranges,h=u.textAndAttributes,d=0;d<c.length;d++){var p=h[2*d];if(p.isMorph){console.assert(e.includes(p),"????");var f=c[d].start;if(p.owner!==this&&this.addMorph(p),o&&!o.has(p)){var y=this.addAnchor(Object.assign({id:"embedded-"+p.id},f));i.connect(y,"position",p,"position",{converter:function converter(e){var t=this.targetObj.owner;return t?t.charBoundsFromTextPosition(e).topLeft().subPt(t.origin):this.targetObj.position}}).update(y.position),o.set(p,{anchor:y})}}}}},{key:"applyJsDiffPatch",value:function Text_applyJsDiffPatch_(e){var t=this,n=[],r=0,i=0,o=!0,a=!1,s=void 0;try{for(var l,u=e[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var c=l.value;c.removed?i=remove(r,r+c.count,i,n):c.added&&(i=insert(r,c.value,i,n)),r+=c.count}}catch(e){a=!0,s=e}finally{try{!o&&u.return&&u.return()}finally{if(a)throw s}}return n;function remove(e,n,r,i){var o=t.indexToPosition(e+r),a=t.indexToPosition(n+r);return i.push(t.deleteText({start:o,end:a})),r-(n-e)}function insert(e,n,r,i){return i.push(t.insertText(n,t.indexToPosition(e+r))),r}}},{key:"applyTextChanges",value:function Text_applyTextChanges_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments[3],i=[],o=!0,a=!1,s=void 0;try{for(var l,u=e[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var c=$(l.value,3),h=c[0],d=c[1],p=c[2];if(t){var f="number"==typeof d?d:this.positionToIndex(d);if(d=f+t,p&&"string"!=typeof p&&!Array.isArray(p))p=("number"==typeof p?p:this.positionToIndex(p))+t;d=f+t}var y="number"==typeof d?this.indexToPosition(d):d;switch(h){case"delete":case"remove":var m="number"==typeof p?this.indexToPosition(p):p;i.push(this.deleteText({start:y,end:m},r));break;case"insert":i.push(this.insertText(p,y,n,r));break;default:console.warn("[applyTextChanges] unknown type: "+h)}}}catch(e){a=!0,s=e}finally{try{!o&&u.return&&u.return()}finally{if(a)throw s}}return i}},{key:"modifyLines",value:function Text_modifyLines_(e,t,n){var i=this,o=r.arr.range(e,t).map(function(e){return i.getLine(e)}).map(n).join("\n")+"\n";this.deleteText({start:{row:e,column:0},end:{row:t+1,column:0}},!1),this.insertText(o,{row:e,column:0})}},{key:"modifySelectedLines",value:function Text_modifySelectedLines_(e){var t=this.selection.isEmpty()?this.lineRange(void 0,!1):this.selection.range;return this.modifyLines(t.start.row,t.end.row,e)}},{key:"withLinesDo",value:function Text_withLinesDo_(e,t,n){var i=this;return r.arr.range(e,t).map(function(e){var t=i.getLine(e),r=En.create(e,0,e,t.length);return n(t,r)})}},{key:"withSelectedLinesDo",value:function Text_withSelectedLinesDo_(e){var t=this.selection.isEmpty()?this.lineRange(void 0,!1):this.selection.range,n=t.start.row,r=t.end,i=r.row,o=r.column;return this.withLinesDo(n,0===o&&i>n?i-1:i,e)}},{key:"joinLine",value:function Text_joinLine_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cursorPosition.row,t=this.getLine(e),n=t+this.getLine(e+1).replace(/^\s+/,"")+this.document.constructor.newline;return this.replace({start:{column:0,row:e},end:{column:0,row:e+2}},n,!0),{row:e,column:t.length}}},{key:"whatsVisible",get:function get(){return this.textLayout.whatsVisible(this)}},{key:"flash",value:function Text_flash_(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selection.range,i=arguments[1],o=(i=Object.assign({time:1e3,fill:t.Color.orange},i)).id||"flash"+r.string.newUUID();this.addMarker({id:o,range:n,style:{"background-color":i.fill.toCSSString(),"pointer-events":"none"}}),r.fun.debounceNamed("flash-"+o,i.time,function(){return e.removeMarker(o)})()}},{key:"addTextAttribute",value:function Text_addTextAttribute_(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selection,r={start:n.start,end:n.end};return this.undoManager.undoStart(this,"addTextAttribute"),this.addMethodCallChangeDoing({target:this,selector:"addTextAttribute",args:[e,r],undo:{target:this,selector:"removeTextAttribute",args:[e,r]}},function(){t.document.mixinTextAttribute(e,r),t.onAttributesChanged(r),t.consistencyCheck()}),this.undoManager.undoStop(),e}},{key:"removeTextAttribute",value:function Text_removeTextAttribute_(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selection,r={start:n.start,end:n.end};this.undoManager.undoStart(this,"removeTextAttribute"),this.addMethodCallChangeDoing({target:this,selector:"removeTextAttribute",args:[e,r],undo:{target:this,selector:"addTextAttribute",args:[e,r]}},function(){t.document.mixoutTextAttribute(e,r),t.onAttributesChanged(r),t.consistencyCheck()}),this.undoManager.undoStop()}},{key:"setTextAttributesWithSortedRanges",value:function Text_setTextAttributesWithSortedRanges_(e){this.document.setTextAttributesWithSortedRanges(e),this.consistencyCheck();for(var t=0;t<e.length;)this.onAttributesChanged(e[t]),t+=2}},{key:"textAttributeAt",value:function Text_textAttributeAt_(e){var t=this.document;this.textLayout;return t.textAttributeAt(e)}},{key:"textAttributeAtPoint",value:function Text_textAttributeAtPoint_(e){return this.textAttributeAt(this.textLayout.textPositionFromPoint(this,e))}},{key:"textAndAttributesInRange",value:function Text_textAndAttributesInRange_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selection.range;return this.document.textAndAttributesInRange(e)}},{key:"resetTextAttributes",value:function Text_resetTextAttributes_(){this.document.resetTextAttributes(),this.onAttributesChanged(this.documentRange),this.consistencyCheck()}},{key:"onAttributesChanged",value:function Text_onAttributesChanged_(e){this.invalidateTextLayout(!1,!1);var t=this.textLayout;t&&t.resetLineCharBoundsCacheOfRange(this,e),this.makeDirty()}},{key:"styleAt",value:function Text_styleAt_(e){var t=this.textLayout.chunkAtPos(this,e);return t?t.style:Object.assign({},this.defaultTextStyle)}},{key:"getStyleInRange",value:function Text_getStyleInRange_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selection;return this.textAndAttributesInRange(e).filter(function(e,t){return t%2!=0}).reduce(function(e,t){for(var n in t){var r=t[n];(!e.hasOwnProperty(n)||void 0!==r&&null!==r)&&(e[n]=r)}return e},{})}},{key:"setStyleInRange",value:function Text_setStyleInRange_(e){for(var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selection,r=this.textAndAttributesInRange(n),i={start:Object.assign({},n.start),end:Object.assign({},n.start)},o=[],a=0;a<r.length;a+=2){var s=r[a],l=r[a+1],u=-1;for("string"!=typeof s&&(s=Dn);(u=s.indexOf("\n"))>-1;){u>0&&(i.end.column=i.end.column+u,o.push(i,l));var c={row:i.end.row+1,column:0};i={start:c,end:Object.assign({},c)},s=s.slice(u+1)}i.end.column+=s.length,o.push(i,l),i={start:Object.assign({},i.end),end:Object.assign({},i.end)}}this.undoManager.undoStart(this,"setStyleInRange"),this.addMethodCallChangeDoing({target:this,selector:"setStyleInRange",args:[e,n],undo:{target:this,selector:"setTextAttributesWithSortedRanges",args:[o]}},function(){t.document.setTextAttribute(e,n),t.consistencyCheck(),t.onAttributesChanged(n)}),this.undoManager.undoStop()}},{key:"resetStyleInRange",value:function Text_resetStyleInRange_(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selection,t=this.document.textAndAttributesInRange(e),n={},r=0;r<t.length;r+=2)Object.assign(n,t[r+1]);this.removeTextAttribute(n,e)}},{key:"changeStyleProperty",value:function Text_changeStyleProperty_(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.selection,i=t(this.getStyleInRange(r)[e]);this.selections.forEach(function(t){return n.addTextAttribute(U({},e,i),t)})}},{key:"inMultiSelectMode",value:function Text_inMultiSelectMode_(){return this.selection.selections&&this.selection.selections.length>1}},{key:"selectionBounds",value:function Text_selectionBounds_(){var e=this;return this.selections.map(function(n){var r=e.charBoundsFromTextPosition(n.start),i=e.charBoundsFromTextPosition(n.end);return n.start.row===n.end.row?r.union(i):t.rect(t.pt(e.padding.left(),r.top()),t.pt(e.width-e.padding.left(),i.bottom()))}).reduce(function(e,t){return t.union(e)})}},{key:"documentEndPosition",get:function get(){return this.document?this.document.endPosition:{row:0,column:0}}},{key:"isAtDocumentEnd",value:function Text_isAtDocumentEnd_(){return eqPosition(this.cursorPosition,this.documentEndPosition)}},{key:"documentRange",get:function get(){return{start:{row:0,column:0},end:this.documentEndPosition}}},{key:"cursorUp",value:function Text_cursorUp_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.selection.goUp(e)}},{key:"cursorDown",value:function Text_cursorDown_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.selection.goDown(e)}},{key:"cursorLeft",value:function Text_cursorLeft_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.selection.goLeft(e)}},{key:"cursorRight",value:function Text_cursorRight_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.selection.goRight(e)}},{key:"getPositionAboveOrBelow",value:function Text_getPositionAboveOrBelow_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.cursorPosition,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments[3],o=arguments[4];if(0===e)return t;"number"==typeof o&&(o-=this.padding.left());var a=t.row,s=t.column;if(n&&this.lineWrapping){var l=this.textLayout.rangesOfWrappedLine(this,t.row);if(!l.length)return t;var u,c=l.length-1-l.slice().reverse().findIndex(function(e){var n=e.start;e.end;return n.column<=t.column});l[c];if(e>=1){var h=0===c;if(!(u=h?t.row<=0?null:r.arr.last(this.textLayout.rangesOfWrappedLine(this,t.row-1)):l[c-1]))return t;h}else if(e<=-1){var d=l.length-1===c?t.row>=this.lineCount()-1?[]:this.textLayout.rangesOfWrappedLine(this,t.row+1):l.slice(c+1);if(!(u=d[0]))return t;1===d.length}a=u.start.row;var p=this.textLayout.charBoundsOfRow(this,a).slice(u.start.column,u.end.column+1);s=u.start.column+columnInCharBoundsClosestToX(p,o)}else{if(a=Math.min(Math.max(0,t.row-e),this.lineCount()-1),"number"==typeof o)s=columnInCharBoundsClosestToX(this.textLayout.charBoundsOfRow(this,a),o)}var f={row:a,column:s};return Math.abs(e)>1?this.getPositionAboveOrBelow(e+(e>1?-1:1),f,n,i,o):f;function columnInCharBoundsClosestToX(e,t){(e=e.slice()).push({x:r.arr.last(e).x+r.arr.last(e).width});for(var n=0,i=1/0,o=0;o<e.length;o++){var a=e[o].x,s=Math.abs(a-t);s<i&&(i=s,n=o)}return n}}},{key:"collapseSelection",value:function Text_collapseSelection_(){return this.selection.collapse(this.selection.lead),this.selection}},{key:"selectAll",value:function Text_selectAll_(){return this.selection.selectAll(),this.selection}},{key:"selectLine",value:function Text_selectLine_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cursorPosition.row,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.selection.selectLine(e,t),this.selection}},{key:"selectionOrLineString",value:function Text_selectionOrLineString_(){var e=this.selection,t=e.text,n=e.start;return t||this.getLine(n.row)}},{key:"scrollCursorIntoView",value:function Text_scrollCursorIntoView_(){this.scrollPositionIntoView(this.cursorPosition)}},{key:"centerRange",value:function Text_centerRange_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selection.range,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.pt(0,0),r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this.charBoundsFromTextPosition(e.start).top(),o=this.charBoundsFromTextPosition(e.end).bottom()-i;if(o<this.height||!1===r){var a=i+o/2;this.scroll=this.scroll.withY(a-this.height/2).addPt(n)}else this.scroll=this.scroll.withY(i).addPt(n)}},{key:"centerRow",value:function Text_centerRow_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cursorPosition.row,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.pt(0,0);return this.alignRowAtTop(e,n.addXY(0,-this.height/2))}},{key:"alignRowAtTop",value:function Text_alignRowAtTop_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cursorPosition.row,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.pt(0,0),r=this.charBoundsFromTextPosition({row:e,column:0}).topLeft().addXY(-this.padding.left(),0);this.scroll=r.addPt(n)}},{key:"alignRowAtBottom",value:function Text_alignRowAtBottom_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cursorPosition.row,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.pt(0,0),r=this.charBoundsFromTextPosition({row:e,column:0}).height;this.alignRowAtTop(e,n.addXY(0,-this.textPageHeight()+r))}},{key:"scrollPositionIntoView",value:function Text_scrollPositionIntoView_(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.pt(0,0);if(this.isClip()){var r=this.scroll,i=(this.padding,this.innerBounds().translatedBy(r).insetByRect(this.padding).insetBy(this.borderWidth)),o=this.charBoundsFromTextPosition(e);this.lineWrapping||(o=o.insetByPt(t.pt(-20,0)));var a=i.bottom()-o.bottom()>20?"bottomLeft":"topLeft",s=o[a]().subPt(i.translateForInclusion(o)[a]()).addPt(n);0==s.x&&0==s.y||(this.scroll=this.scroll.addPt(s).addPt(n),this.isFocused()&&this.ensureKeyInputHelperAtCursor())}}},{key:"keepPosAtSameScrollOffsetWhile",value:function Text_keepPosAtSameScrollOffsetWhile_(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.cursorPosition,i=this.scroll,o=(n=this.selection.lead,this.charBoundsFromTextPosition(n).y-i.y),a=!1,s=function cleanup(){return t.scroll=t.scroll.withY(t.charBoundsFromTextPosition(n).y-o)};try{var l=e();a=l&&l instanceof Promise}finally{!a&&s()}return a&&r.promise.finally(l,s),l}},{key:"saveExcursion",value:function Text_saveExcursion_(e,t){var n=this;t=Object.assign({useAnchors:!1},t);var i=this.selection.isMultiSelection?this.selection.selections.map(function(e){return e.directedRange}):[this.selection],o=t.useAnchors?i.map(function(e){var t=e.start,i=e.end;return[n.addAnchor(Object.assign({},t,{id:"save-excursion-"+r.string.newUUID()})),n.addAnchor(Object.assign({},i,{id:"save-excursion-"+r.string.newUUID()}))]}):null,a=!1,s=t.useAnchors?function(){var e=o.map(function(e){var t=$(e,2);return{start:t[0].position,end:t[1].position}});n.selections=e,o.forEach(function(e){var t=$(e,2),r=t[0],i=t[1];n.removeAnchor(r),n.removeAnchor(i)})}:function(){return n.selections=i};try{var l=this.keepPosAtSameScrollOffsetWhile(e);a=l&&l instanceof Promise}finally{!a&&s()}return a&&r.promise.finally(l,s),l}},{key:"alignRow",value:function Text_alignRow_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"center";if(this.isClip()){var n=this.scroll,r=this.padding,i=this.innerBounds().insetByRect(r).translatedBy(n),o=this.charBoundsFromTextPosition({row:e,column:0}),a="top"===t||"bottom"===t?i[t]()-o[t]():"center"===t?i[t]().y-o[t]().y:0;a&&(this.scroll=this.scroll.addXY(0,-a))}}},{key:"fit",value:function Text_fit_(){var e=this,t=this.viewState,n=this.fixedWidth,r=this.fixedHeight;if(t._needsFit=!1,r&&n||!this.textLayout)return this;var i=this.textBounds().outsetByRect(this.padding),o=function resize(){r||e.height==i.height||(e.height=i.height),n||e.width==i.width||(e.width=i.width),e.embeddedMorphs.forEach(function(t){var n=e.embeddedMorphMap.get(t).anchor;n.position=n.position})};return t._needsFit=!1,this.document.lines.find(function(e){return e.hasEstimatedExtent})?this.whenRendered().then(o):o(),this}},{key:"fitIfNeeded",value:function Text_fitIfNeeded_(){this.viewState._needsFit&&this.fit()}},{key:"defaultLineHeight",get:function get(){var e=this.padding;return e.top()+e.bottom()+this.fontMetric.defaultLineHeight({fontSize:this.fontSize,fontFamily:this.fontFamily})}},{key:"columnInWrappedLine",value:function Text_columnInWrappedLine_(e){if(!this.lineWrapping)return e.column;var t=this.screenLineRange(e,!0).start.column;return e.column-t}},{key:"textPositionFromPoint",value:function Text_textPositionFromPoint_(e){return this.textLayout.textPositionFromPoint(this,e)}},{key:"charBoundsFromTextPosition",value:function Text_charBoundsFromTextPosition_(e){return this.textLayout.boundsFor(this,e)}},{key:"forceRerender",value:function Text_forceRerender_(){this.textLayout.reset(),this.makeDirty()}},{key:"aboutToRender",value:function Text_aboutToRender_(e){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"aboutToRender",this).call(this,e)}},{key:"applyLayoutIfNeeded",value:function Text_applyLayoutIfNeeded_(){this.fitIfNeeded(),lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"applyLayoutIfNeeded",this).call(this)}},{key:"render",value:function Text_render_(e){return this.textRenderer.renderMorph(this,e)}},{key:"onMouseDown",value:function Text_onMouseDown_(e){if(!e.rightMouseButtonPressed()){this.activeMark&&(this.activeMark=null);var t=e.position,n=e.state,r=n.clickedOnMorph,i=(n.clickedOnPosition,n.clickCount);if(r===this){var o=(i-1)%3+1,a=this.localize(t),s=this.textPositionFromPoint(a);e.leftMouseButtonPressed()&&!e.isShiftDown()&&!e.isAltDown()&&this.callTextAttributeDoitFromMouseEvent(e,a),this.selectable&&(e.isShiftDown()?this.selection.lead=s:e.isAltDown()?this.selection.addRange(En.at(s)):(this.selection.disableMultiSelect(),1===o?e.isShiftDown()?this.selection.lead=s:this.selection={start:s,end:s}:2===o?this.execCommand("select word",null,1,e):3===o&&this.execCommand("select line",null,1,e)),this.isFocused()&&this.ensureKeyInputHelperAtCursor())}}}},{key:"evalEnvForDoit",value:function Text_evalEnvForDoit_(e){var t="lively://text-doit/"+this.id;lively.modules.module(t);return{context:e.context||this,format:"esm",targetModule:t}}},{key:"callTextAttributeDoitFromMouseEvent",value:function Text_callTextAttributeDoitFromMouseEvent_(e,t){var n=this,r=this.textAttributeAtPoint(t)||[],i=r&&r.doit;if(!i||!i.code)return!1;var o=this.evalEnvForDoit(i),a=lively.modules.module(o.targetModule);return a.recorder.evt=e,lively.vm.runEval(i.code,o).catch(function(e){return n.world().logError(new Error("Error in text doit: "+e.stack))}).then(function(){return a.recorder.evt=null}),!0}},{key:"onMouseMove",value:function Text_onMouseMove_(e){e.leftMouseButtonPressed()&&this.selectable&&e.state.clickedOnMorph===this&&(this.selection.lead=this.textPositionFromPoint(this.localize(e.position)))}},{key:"selectMatchingBrackets",value:function Text_selectMatchingBrackets_(e,t){function isWhiteSpace(e){return"\t"===e||" "===e}function isAlpha(e){return(e||"").match(/^[a-zA-Z0-9\-]+$/)}function periodWithDigit(e,t){return"."==e&&"0123456789".indexOf(t)>=0}function matchBrackets(e,t,n,r,i){for(var o=r,a=1;i<0?o-1>=0:o+1<e.length;)if(e[o+=i]==t&&t!=n&&a++,e[o]==n&&a--,0==a)return o;return o}function findLine(e,t,n,r){for(var i=t;n<0?i-1>=0:i+1<e.length;)if(e[i+=n]==r)return n>0?[t,i]:[i+1,t];return n>0?[t+1,e.length-1]:[0,t]}if(!e)return t;if(0==t||t==e.length)return[0,e.length-1];var n=t-1;if(t>0){if("\n"==e[t-1]||"\r"==e[t-1])return findLine(e,t,1,e[t-1]);var r="*({[<'\"`".indexOf(e[t-1]);if("*"==e[t-1]&&(t-2<0||"/"!=e[t-2])&&(r=-1),r>=0)return[t,(n=matchBrackets(e,"*({[<'\"`"[r],"*)}]>'\"`"[r],t-1,1))-1]}if(t<e.length){if("\n"==e[t]||"\r"==e[t])return findLine(e,t,-1,e[t]);r="*)}]>'\"`".indexOf(e[t]);if("*"==e[t]&&(t+1>=e.length||"/"!=e[t+1])&&(r=-1),r>=0)return[(t=matchBrackets(e,"*)}]>'\"`"[r],"*({[<'\"`"[r],t,-1))+1,n]}if("/"===e[t-1]&&"/"===e[t-2]){for(;n+1<e.length&&"\n"!==e[n+1]&&"\r"!==e[n+1];)n++;return[t,n]}for(var i=t,o=n;i-1>=0&&isWhiteSpace(e[i-1]);)i--;for(;o<e.length&&isWhiteSpace(e[o+1]);)o++;if(o-i>=1)return[i,o];for(var a=t<e.length?e[t]:"";t-1>=0&&(isAlpha(e[t-1])||periodWithDigit(e[t-1],a));)a=e[t-1],t--;for(;n+1<e.length&&(isAlpha(e[n+1])||periodWithDigit(e[n+1],a));)a=e[n+1],n++;return[t,n]}},{key:"onContextMenu",value:function Text_onContextMenu_(e){var t=this;if(e.targetMorph===this){e.stop();var n=this.textPositionFromPoint(this.localize(e.position)),r=this.selection.selections||[this.selection];(this.selection.isEmpty()||r.every(function(e){return!e.range.containsPosition(n)}))&&(this.cursorPosition=n),Promise.resolve(this.menuItemsForContextMenu()).then(function(n){return t.openMenu(n,e)}).catch(function(e){return $world.logError(e)})}}},{key:"onDrop",value:function Text_onDrop_(e){var t=e.hand.grabbedMorphs.filter(function(e){return e.isLayoutable});if(lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"onDrop",this).call(this,e),t[0]){var n=this.textPositionFromPoint(this.localize(e.hand.position));this.insertText([t[0],null],n),t[0].opacity=e.state.originalOpacity||1}}},{key:"buildDropHoverGrid",value:function Text_buildDropHoverGrid_(e){var n=this;if(e.simpleDrop)return null;var i=this.whatsVisible,o=i.startRow,a=i.endRow,s=Math.min(this.documentEndPosition.row,a),l=this.document,u=this.padding.left(),c=this.padding.top(),h=r.arr.range(o,s).reduce(function(i,o){var a=n.textLayout.charBoundsOfRow(n,o).slice();if(a.length>=1&&0==r.arr.last(a).width&&(r.arr.last(a).width=12),a.length>1){var s=r.arr.last(a);a.push({x:s.x+s.width,y:s.y,height:s.height,width:s.width||12})}var h=a.map(function(r,i){var a=t.Rectangle.fromLiteral(r).translatedBy(t.pt(u,c+l.computeVerticalOffsetOf(o))),s=n.getGlobalTransform().transformRectToRect(a);return{textPos:{row:o,column:i},bounds:a,globalBounds:s,morph:e.showDropGrid?morph$2({reactsToPointer:!1,acceptsDrops:!1,bounds:a,border:{width:1,color:t.Color.green},fill:null}):null}});return i.concat(h)},[]);return h.forEach(function(e){return e.morph&&n.addMorph(e.morph)}),h}},{key:"onDropHoverIn",value:function Text_onDropHoverIn_(e){var t={simpleDrop:!window.hasOwnProperty("simpleDrop")||window.simpleDrop,showDropGrid:!!window.hasOwnProperty("showDropGrid")&&window.showDropGrid,useTextFlowPlaceholder:!!window.hasOwnProperty("useTextFlowPlaceholder")&&window.useTextFlowPlaceholder},n=e.hand.grabbedMorphs[0];n&&(e.state.originalOpacity=n.opacity,n.opacity=.3);var r=this.buildDropHoverGrid(t),i=e.state.dropHover||(e.state.dropHover=new WeakMap),o=i.get(this);o||(o={},i.set(this,o)),o.config=t,o.dropGrid=r}},{key:"onDropHoverUpdate",value:function Text_onDropHoverUpdate_(e){var t=e.hand.grabbedMorphs[0];if(t){var n=e.state.dropHover;if(n){var i=n.get(this);if(i){if(!i.dropGrid){var o=this.textPositionFromPoint(e.positionIn(this));return this.focus(),void(this.cursorPosition=o)}var a=i.config,s=e.positionIn(this),l=void 0,u=void 0,c=1/0,h=!0,d=!1,p=void 0;try{for(var f,y=i.dropGrid[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var m=f.value;if(m.bounds.containsPoint(s)){l=m;break}var g=m.bounds.closestPointToPt(s).dist(s);g<c&&(c=g,u=m)}}catch(e){d=!0,p=e}finally{try{!h&&y.return&&y.return()}finally{if(d)throw p}}if(l||(l=u),l){var v=i.placeholder;v||(i.placeholder=v=morph$2({fill:t.fill,extent:t.extent,reactsToPointer:!1,acceptsDrops:!1})),r.obj.equals(v._textPos||{},l.textPos)||(this!==v.owner&&this.addMorph(v),v.position=l.bounds.topLeft(),a&&a.useTextFlowPlaceholder&&(v.remove(),v._textPos=l.textPos,this.insertText([v,null],l.textPos)))}}}}}},{key:"onDropHoverOut",value:function Text_onDropHoverOut_(e){var t=e.hand.grabbedMorphs[0];t&&(t.opacity=e.state.originalOpacity||1);var n=e.state.dropHover;if(n){var r=n.get(this);r&&(n.delete(this),r.dropGrid&&(r.dropGrid.forEach(function(e){return e.morph&&e.morph.remove()}),r.dropGrid=null),r.placeholder&&(r.placeholder.remove(),r.placeholder=null))}}},{key:"menuItems",value:function(){var e=H(regeneratorRuntime.mark(function _callee3(){var e,t,n,r;return regeneratorRuntime.wrap(function _callee3$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Promise.all([lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"menuItems",this).call(this),this.menuItemsForContextMenu()]);case 2:return e=i.sent,t=$(e,2),n=t[0],r=t[1],i.abrupt("return",n.concat({isDivider:!0}).concat(r));case 7:case"end":return i.stop()}},_callee3,this)}));return function Text_menuItems_(){return e.apply(this,arguments)}}()},{key:"menuItemsForContextMenu",value:function(){var e=H(regeneratorRuntime.mark(function _callee4(){var e,t,n,r,i,o,a,s=this;return regeneratorRuntime.wrap(function _callee4$(l){for(;;)switch(l.prev=l.next){case 0:e=[{command:"text undo",alias:"undo",target:this,showKeyShortcuts:!0},{command:"text redo",alias:"redo",target:this,showKeyShortcuts:!0},{command:"manual clipboard copy",alias:"copy",target:this,showKeyShortcuts:this.keysForCommand("clipboard copy"),args:{collapseSelection:!1,delete:!1}},{command:"manual clipboard paste",alias:"paste",target:this,showKeyShortcuts:this.keysForCommand("clipboard paste")},{command:"open text attribute controls",alias:"edit text attributes",target:this},{isDivider:!0},{command:"toggle line wrapping",alias:(this.lineWrapping?"disable":"enable")+" line wrapping",target:this,showKeyShortcuts:!0},["run command",function(){s.focus(),s.world().execCommand("run command")}]],t=!0,n=!1,r=void 0,l.prev=4,i=this.plugins[Symbol.iterator]();case 6:if(t=(o=i.next()).done){l.next=15;break}if("function"!=typeof(a=o.value).getMenuItems){l.next=12;break}return l.next=11,a.getMenuItems(e);case 11:e=l.sent;case 12:t=!0,l.next=6;break;case 15:l.next=21;break;case 17:l.prev=17,l.t0=l.catch(4),n=!0,r=l.t0;case 21:l.prev=21,l.prev=22,!t&&i.return&&i.return();case 24:if(l.prev=24,!n){l.next=27;break}throw r;case 27:return l.finish(24);case 28:return l.finish(21);case 29:return l.abrupt("return",e);case 30:case"end":return l.stop()}},_callee4,this,[[4,17,21,29],[22,,24,28]])}));return function Text_menuItemsForContextMenu_(){return e.apply(this,arguments)}}()},{key:"keybindings",get:function get(){return this.pluginCollect("getKeyBindings",lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"keybindings",this).concat(z.text.defaultKeyBindings))}},{key:"keybindings",set:function set(e){lively.classes.runtime.initializeClass._set(Object.getPrototypeOf(o.prototype),"keybindings",e,this)}},{key:"keyhandlers",get:function get(){if(this._cachedKeyhandlers)return this._cachedKeyhandlers;var e=lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"keyhandlers",this).concat(this._keyhandlers||[]);return e=this.pluginCollect("getKeyHandlers",e),this._cachedKeyhandlers=e}},{key:"snippets",get:function get(){return this.pluginCollect("getSnippets",[]).map(function(e){if(e.isTextSnippet)return e;var t=$(e,2),n=t[0],r=t[1];return new $n({trigger:n,expansion:r})})}},{key:"onKeyDown",value:function Text_onKeyDown_(e){this.compositionRange||(this.selection.cursorBlinkStart(),ht.invokeKeyHandlers(this,e,!0))}},{key:"onTextInput",value:function Text_onTextInput_(e){ht.invokeKeyHandlers(this,e,!1)}},{key:"onCompositionStart",value:function Text_onCompositionStart_(e){this.insertTextAndSelect(e.data),this.compositionRange=this.selection.range}},{key:"onCompositionUpdate",value:function Text_onCompositionUpdate_(e){this.selection.range=this.compositionRange,this.selection.text=[e.data,{textDecoration:"underline"}],this.compositionRange=this.selection.range}},{key:"onCompositionEnd",value:function Text_onCompositionEnd_(e){this.selection.range=this.compositionRange,this.selection.text=e.data,this.cursorPosition=this.compositionRange.end,this.compositionRange=null}},{key:"onCut",value:function Text_onCut_(e){!this.rejectsInput()&&this.isFocused()&&(z.emacs||this.onCopy(e,!this.rejectsInput()))}},{key:"onCopy",value:function Text_onCopy_(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isFocused()){e.stop();var n=this.selection;try{for(var r=this.textAndAttributesInRange(this.selection.range),i=this.defaultTextStyle,o={},a=0;a<r.length;a+=2){var s=r[a];if(s.isMorph)if(s.isDisplacementMorph)r[a]="";else{var l=o[a]=serializeMorph(r[a]);r[a]=deserializeMorph(l,{reinitializeIds:!0})}}var u=function extractHTMLFromTextMorph(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.textAndAttributesInRange(e.selection.range),n=new e.constructor(Object.assign({},e.defaultTextStyle,{width:e.width,textAndAttributes:t})),r=n.textRenderer.directRenderTextLayerFn(n),i=n.textRenderer.directRenderLineFn(n),o=r(),a=System.global&&System.global.getComputedStyle?System.global.getComputedStyle(o):null;a&&(o.ownerDocument.body.appendChild(o),o.style.whiteSpace=a.whiteSpace,o.style.overflowWrap=a.overflowWrap,o.style.wordBreak=a.wordBreak,o.style.minWidth=a.minWidth,o.parentNode.removeChild(o));var s=!0,l=!1,u=void 0;try{for(var c,h=n.document.lines[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var d=c.value;o.appendChild(i(d))}}catch(e){l=!0,u=e}finally{try{!s&&h.return&&h.return()}finally{if(l)throw u}}return o.outerHTML}(this,r);for(var c in e.domEvt.clipboardData.setData("text/html",u),o)r[c]=o[c];var h=JSON.stringify({textAndAttributes:r,defaultTextStyle:i});e.domEvt.clipboardData.setData("application/x-lively-text",h)}catch(e){$world.logError(e)}e.domEvt.clipboardData.setData("text/plain",n.text),this.execCommand("manual clipboard copy",{collapseSelection:z.codeEditor.collapseSelection||!1,delete:t,dontTryNativeClipboard:!0})}}},{key:"onPaste",value:function Text_onPaste_(e){var t=this;if(!this.rejectsInput()){e.stop();var n,r="";try{r=e.domEvt.clipboardData.getData("text")}catch(e){console.warn(e)}if(!this.editorPlugin)try{for(var i=e.domEvt.clipboardData.getData("application/x-lively-text"),o=(n=i&&JSON.parse(i)).textAndAttributes,a=0;a<o.length;a+=2)"string"!=typeof o[a]&&(o[a]=deserializeMorph(o[a],{reinitializeIds:!0}))}catch(e){console.warn(e)}var s=this.selection,l=s.isMultiSelection?s.selections:[s];n&&this.undoManager.group(),l.forEach(function(e){n?t.replace(e.range,n.textAndAttributes,!1,!0,!0):e.text=r,t.saveMark(e.start),e.collapseToEnd()}),n&&this.undoManager.group()}}},{key:"onFocus",value:function Text_onFocus_(e){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"onFocus",this).call(this,e),this.makeDirty(),this.selection.cursorBlinkStart(),this.highlightWhenFocused&&this.animate({dropShadow:this.haloShadow||this.propertiesAndPropertySettings().properties.haloShadow.defaultValue,duration:200})}},{key:"onBlur",value:function Text_onBlur_(e){this.makeDirty(),this.selection.cursorBlinkStop(),this.highlightWhenFocused&&this.animate({dropShadow:null,duration:200}),lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"onBlur",this).call(this,e)}},{key:"onScroll",value:function Text_onScroll_(e){this.isFocused()&&this.ensureKeyInputHelperAtCursor();var n=this.env.renderer.getNodeForMorph(this);if(n){var r=n.scrollTop,o=n.scrollLeft;i.signal(this,"viewChanged",{prop:"scroll",value:t.pt(o,r)})}}},{key:"ensureKeyInputHelperAtCursor",value:function Text_ensureKeyInputHelperAtCursor_(){this.env.eventDispatcher.keyInputHelper&&this.env.eventDispatcher.keyInputHelper.ensureBeingAtCursorOfText(this)}},{key:"textPageHeight",value:function Text_textPageHeight_(){var e=this.height,t=this.padding,n=this.borderWidthBottom,r=this.borderWidthTop;return e-t.top()-t.bottom()-n-r}},{key:"scrollPageDown",value:function Text_scrollPageDown_(){this.scrollDown(this.textPageHeight())}},{key:"scrollPageUp",value:function Text_scrollPageUp_(){this.scrollUp(this.textPageHeight())}},{key:"pageUpOrDown",value:function Text_pageUpOrDown_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{direction:"up",select:!1},n=e.direction,r=e.select,i=this.textLayout["down"===n?"lastFullVisibleLine":"firstFullVisibleLine"](this),o=this.cursorPosition.column,a=this.padding;r?this.selection.lead={row:i,column:o}:this.cursorPosition={row:i,column:o},"down"===n?this.alignRowAtTop(i,t.pt(0,-a.top()-a.bottom())):(this.alignRowAtBottom(i,t.pt(0,0)),this.alignRowAtBottom(i,t.pt(0,a.top()+a.bottom())))}},{key:"gotoDocumentStart",value:function Text_gotoDocumentStart_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{select:!1};this.selection.lead={row:0,column:0},e&&e.select||(this.selection.anchor=this.selection.lead)}},{key:"gotoDocumentEnd",value:function Text_gotoDocumentEnd_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{select:!1};this.selection.lead=this.documentEndPosition,e&&e.select||(this.selection.anchor=this.selection.lead)}},{key:"paragraphRangeAbove",value:function Text_paragraphRangeAbove_(e){var t;if(this.isLineEmpty(e)){for(var n=e-1;n>=0;n--)if(!this.isLineEmpty(n)){t=n;break}if(void 0===t)return{start:{row:e,column:0},end:{row:e,column:0}}}else t=e;return this.paragraphRange(t)}},{key:"paragraphRangeBelow",value:function Text_paragraphRangeBelow_(e){var t,n=this.isLineEmpty(e),r=this.documentEndPosition;if(n){for(var i=e+1;i<=r.row;i++)if(!this.isLineEmpty(i)){t=i;break}if(void 0===t)return{start:{row:e,column:0},end:{row:e,column:0}}}else t=e;return this.paragraphRange(t)}},{key:"paragraphRange",value:function Text_paragraphRange_(e){if(this.isLineEmpty(e))return{start:{row:e,column:0},end:{row:e,column:0}};for(var t,n,r=this.documentEndPosition,i=e+1;i<=r.row;i++)if(this.isLineEmpty(i)){t={row:i-1,column:this.getLine(i-1).length};break}t||(t=r);for(i=t.row-1;i>=0;i--)if(this.isLineEmpty(i)){n={row:i+1,column:0};break}return n||(n={row:0,column:0}),{start:n,end:t}}},{key:"astNodeRange",value:function Text_astNodeRange_(e){return{start:this.document.indexToPosition(e.start),end:this.document.indexToPosition(e.end)}}},{key:"parseIntoLines",value:function Text_parseIntoLines_(e){return e.split("\n")}},{key:"computeTextRangeForChanges",value:function Text_computeTextRangeForChanges_(e){var t=En.at(this.cursorPosition);if(!e.length)return t;for(var n=this,i=e[0],o="replace"===i.selector?insertRange(i.args[1],i.args[0].start):t,a=1;a<e.length;a++){var s=e[a];o="replace"===s.selector?o.merge(insertRange(s.args[1],s.args[0].start)):o}return o;function insertRange(e,t){for(var i="",o=0;o<e.length;o+=2)i+="string"==typeof e[o]?e[o]:Dn;var a=n.parseIntoLines(i);return 1===a.length?En.fromPositions(t,{row:t.row,column:t.column+a[0].length}):a.length>1?En.fromPositions(t,{row:t.row+a.length-1,column:r.arr.last(a).length}):En.at(t)}}},{key:"ensureUndoManager",value:function Text_ensureUndoManager_(){if(this.undoManager)return this.undoManager;var e=["addTextAttribute","removeTextAttribute","setStyleInRange","replace"];return this.undoManager=new we(function(t){return e.includes(t.selector)})}},{key:"textUndo",value:function Text_textUndo_(){var e=this.undoManager.undo();if(e){var t=e.changes.slice().reverse().map(function(e){return e.undo});this.selection=this.computeTextRangeForChanges(t)}}},{key:"textRedo",value:function Text_textRedo_(){var e=this.undoManager.redo();if(e){var t=e.changes.slice();this.selection=this.computeTextRangeForChanges(t)}}},{key:"findMatchingForward",value:function Text_findMatchingForward_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"right",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this["right"===t?"charRight":"charLeft"](e),i=n[r];if(!i)return null;var o="right"===t?-1:0;return this.document.scanForward(e,function(e,n){if(e===i){if(0===o)return"right"===t?{row:n.row,column:n.column+1}:n;o--}else e===r&&o++;return null})}},{key:"findMatchingBackward",value:function Text_findMatchingBackward_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"right",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this["right"===t?"charRight":"charLeft"](e),i=n[r];if(!i)return null;var o="left"===t?-1:0;return this.document.scanBackward(e,function(e,n){if(e===i){if(0===o)return"right"===t?{row:n.row,column:n.column+1}:n;o--}else e===r&&o++;return null})}},{key:"search",value:function Text_search_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{start:this.cursorPosition,backwards:!1,caseSensitive:!1};return new Zn(this).search(Object.assign({needle:e},t))}},{key:"searchForAll",value:function Text_searchForAll_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{caseSensitive:!1};return new Zn(this).searchForAll(Object.assign({needle:e},t))}},{key:"tokenAt",value:function Text_tokenAt_(e){return this.pluginInvokeFirst("tokenAt",e)}},{key:"astAt",value:function Text_astAt_(e){return this.pluginInvokeFirst("astAt",e)}},{key:"evalEnvironment",get:function get(){var e=this.editorPlugin;return e&&e.evalEnvironment}},{key:"evalEnvironment",set:function set(e){var t=this.editorPlugin;t&&(t.evalEnvironment=e)}},{key:"doitContext",get:function get(){return(this.evalEnvironment||{}).context}},{key:"doitContext",set:function set(e){(this.evalEnvironment||{}).context=e}},{key:"logDoit",value:function Text_logDoit_(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).time,n=void 0===t?Date.now():t,r=void 0;if(!(e.length>12e4)){try{r=JSON.parse(localStorage["lively.next-js-ide-doitlog"])}catch(e){}if(r||(r=[]),!r.some(function(t){return"string"==typeof t?t===e:t.source===e})){r.push({source:e,time:n}),r.length>50&&(r=r.slice(-50));try{localStorage["lively.next-js-ide-doitlog"]=JSON.stringify(r)}catch(e){}}}}},{key:"doEval",value:function Text_doEval_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selection.isEmpty()?this.lineRange():this.selection.range,t=arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.textInRange(e),r=this.pluginFind(function(e){return e.isEditorPlugin&&"function"==typeof e.runEval});if(!r)throw new Error("doit not possible: cannot find js editor plugin of !"+this);return t&&t.logDoit&&this.logDoit(n,t),r.runEval(n,t)}},{key:"maybeSelectCommentOrLine",value:function Text_maybeSelectCommentOrLine_(){var e=this.selection,t=e.lead,n=t.row,r=t.column,i=this.selectionOrLineString();if(e.isEmpty()){var o=i.indexOf("//");-1===o||r<o||o>0&&":\"'".indexOf(i[o-1])>=0?this.selectLine(n):e.range={start:{row:n,column:o+2},end:{row:n,column:i.length}}}}},{key:"debugHelper",value:function Text_debugHelper_(e){return e=Object.assign({debugDocumentUpdate:!0,debugTextLayout:!0},e),this._debugHelper?Object.assign(this._debugHelper,e):this._debugHelper=Object.assign({},e,{logged:[],groups:[],reset:function reset(){this.groups=[[]],this.logged=this.groups[0]},log:function log(){for(var e,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).log.apply(e,n),this.logged.push({args:n})},dump:function dump(e){console.log(e.split("\n").map(function(e){return e.slice(0,100)}).join("\n")),this.logged.push({dump:e})},group:function group(e){this.groups.push([]),this.logged=r.arr.last(this.groups),console.group(e)},groupEnd:function groupEnd(e){console.groupEnd(e)},steps:function steps(e){for(var steps=[];e.length;){var t=r.arr.takeWhile(e,function(e){return!e.dump}),n=((e=e.slice(t.length)).shift()||{}).dump;steps.push({actions:t,dump:n})}return steps},printToConsole:function printToConsole(){var e=this;console.clear(),this.groups.forEach(function(t){var n=e.steps(t);console.group(n.length),e.steps(t).forEach(function(e,t){var n=e.actions;console.group("step "+(t+1)),n.forEach(function(e){var t,n=e.args;return(t=console).log.apply(t,X(n))}),console.groupEnd("step "+(t+1))}),console.groupEnd(n.length)})},report:function report(){var e=this;return H(regeneratorRuntime.mark(function _callee5(){var t,n,i,o,a,s,l;return regeneratorRuntime.wrap(function _callee5$(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,System.import("jsdiff",System.decanonicalize("lively.morphic"));case 2:return t=u.sent,u.next=5,System.import("lively.ide/diff/editor-plugin.js");case 5:return n=u.sent,i=n.default,o=0,a="",s=[],l=0,e.groups.forEach(function(n,u){a+=">>> group "+(u+1)+"\n",l++,o++;var c=e.steps(n);c.forEach(function(e,n){var u=e.actions,h=e.dump;if(a+=r.string.indent(">>> step "+(n+1)," ",o)+"\n",l++,o++,u.forEach(function(e){var t=e.args,n=r.string.indent(r.string.formatFromArray(t.slice()).trim()," ",o);l+=n.split("\n").length,a+=n+"\n"}),n>=1&&h&&c[n-1].dump){var d=new i,p=t.createPatch(String(n),c[n-1].dump,h);d.tokenize(p),s.push.apply(s,X(d.styledRanges(l,o))),a+=p,l+=p.split("\n").length-1}a+=r.string.indent("<< step "+(n+1)," ",o)+"\n",l++,o--}),a+="<<< group "+(u+1)+"\n",l++,o--}),u.abrupt("return",{report:a,reportStyles:s});case 13:case"end":return u.stop()}},_callee5,e)}))()},openReport:function openReport(){var e=this;return H(regeneratorRuntime.mark(function _callee6(){var t,n,r;return regeneratorRuntime.wrap(function _callee6$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,e.report();case 2:return t=i.sent,n=t.reportStyles,r=t.report,i.abrupt("return",$world.execCommand("open text window",{title:"text debug",fontFamily:"monospace",content:r,rangesAndStyles:n}));case 6:case"end":return i.stop()}},_callee6,e)}))()}})}},{key:"consistencyCheck",value:function Text_consistencyCheck_(){if(this.debug)return this.document.consistencyCheck();try{return this.document.consistencyCheck()}catch(i){var e=this.document;this.brokenDocument||(this.brokenDocument=e);var t=this.world()||$world;try{var n=new Hn([]);n.textAndAttributes=e.textAndAttributes,this.changeDocument(n)}catch(e){var r="Broken document could not be fixed";t?t.logError(r):console.error(r)}t?t.logError(i):console.error(i)}}}],[{key:"makeLabel",value:function Text_makeLabel_(e,n){return new Gn(Object.assign({value:e,fontFamily:"Helvetica Neue, Arial, sans-serif",fontColor:t.Color.almostBlack,fontSize:11},n))}},{key:"makeInputLine",value:function Text_makeInputLine_(e){return new(m.module("lively.morphic").recorder.InputLine||lively.morphic.InputLine)(e)}},{key:"defaultTextStyle",get:function get(){if(this._defaultTextStyle)return this._defaultTextStyle;for(var e=this.prototype.propertiesAndPropertySettings().properties,t=this.defaultTextStyleProps,n={},r=0;r<t.length;r++){var i=t[r];n[i]=e[i].defaultValue}return this._defaultTextStyle=n}},{key:"defaultTextStyleProps",get:function get(){if(this._defaultTextStyleProps)return this._defaultTextStyleProps;var e=this.prototype.propertiesAndPropertySettings().properties,t=[];for(var n in e)e[n].isDefaultTextStyleProp&&t.push(n);return this._defaultTextStyleProps=t}},{key:"properties",get:function get(){return{clipMode:{isStyleProp:!0,defaultValue:"visible",set:function set(e){this.setProperty("clipMode",e),this.fixedWidth=this.fixedHeight=this.isClip()}},fontMetric:{group:"_rendering",serialize:!1,get:function get(){return this.getProperty("fontMetric")||this.env.fontMetric}},undoManager:{group:"core",before:["document"],initialize:function initialize(){this.ensureUndoManager()}},textRenderer:{group:"_rendering",after:["viewState"],initialize:function initialize(){this.textRenderer=new ar(this.env.domEnv)}},debug:{group:"_debugging",isStyleProp:!0,after:["textRenderer","textLayout"],defaultValue:!1,doc:"For visualizing and debugging text layout and rendering"},defaultViewState:{group:"_rendering",derived:!0,readOnly:!0,get:function get(){return{_needsFit:!0,text_layer_node:null,fontmetric_text_layer_node:null,dom_nodes:[],dom_nodeFirstRow:[],scrollTop:0,scrollHeight:0,scrollBottom:0,textHeight:0,textWidth:0,firstVisibleRow:0,lastVisibleRow:0,heightBefore:0,wasScrolled:!1,afterTextRenderHook:null}}},viewState:{group:"_rendering",initialize:function initialize(){this.viewState=this.defaultViewState}},displacingMorphMap:{group:"_rendering",initialize:function initialize(){this.displacingMorphMap=new Map}},embeddedMorphMap:{group:"_rendering",initialize:function initialize(){this.embeddedMorphMap=new Map}},embeddedMorphs:{group:"text",derived:!0,readOnly:!0,after:["embeddedMorphMap"],get:function get(){return this.embeddedMorphMap?Array.from(this.embeddedMorphMap.keys()):[]}},textLayout:{group:"_rendering",after:["textRenderer"],initialize:function initialize(){this.textLayout=new nr(this)}},document:{group:"text",initialize:function initialize(){this.document=Hn.fromString("",{maxLeafSize:50,minLeafSize:25,maxNodeSize:35,minNodeSize:7}),this.consistencyCheck()}},draggable:{defaultValue:!1},useSoftTabs:{group:"text",isStyleProp:!0,defaultValue:void 0===z.text.useSoftTabs||z.text.useSoftTabs},tabWidth:{group:"text",isStyleProp:!0,defaultValue:z.text.tabWidth||2},tab:{group:"text",isStyleProp:!0,after:["useSoftTabs","tabWidth"],readOnly:!0,get:function get(){return this.useSoftTabs?" ".repeat(this.tabWidth):"\t"}},autoInsertPairs:{group:"text",defaultValue:!0},fixedWidth:{group:"text",isStyleProp:!0,after:["clipMode","viewState"],defaultValue:!1},fixedHeight:{group:"text",isStyleProp:!0,after:["clipMode","viewState"],defaultValue:!1},readOnly:{group:"text",isStyleProp:!0,defaultValue:!1,set:function set(e){this.nativeCursor=e?"default":"auto",this.setProperty("readOnly",e)}},selectable:{group:"selection",isStyleProp:!0,after:["selection"],defaultValue:!0,set:function set(e){this.setProperty("selectable",e),e||this.selection.collapse()}},padding:{group:"styling",type:"Rectangle",isStyleProp:!0,after:["textLayout","viewState"],defaultValue:t.Rectangle.inset(0),set:function set(e){this.setProperty("padding","number"==typeof e?t.Rectangle.inset(e):e)}},haloShadow:{group:"styling",type:"Shadow",isStyleProp:!0,defaultValue:null},highlightWhenFocused:{group:"styling",defaultValue:!1,after:["haloShadow"],set:function set(e){this.setProperty("highlightWhenFocused",e),e&&!this.haloShadow&&(this.haloShadow={blur:6,color:t.Color.rgb(52,152,219),distance:0,rotation:45})}},cursorPosition:{group:"selection",derived:!0,after:["selection"],get:function get(){return this.selection.lead},set:function set(e){this.selection.range={start:e,end:e}}},selection:{group:"selection",derived:!0,after:["document","anchors"],get:function get(){var e=this.getProperty("selection");return e||(e=new(z.text.useMultiSelect?In:On)(this),this.setProperty("selection",e),e)},set:function set(e){e?e.isSelection?this.setProperty("selection",e):this.selection.range=e:(this.selection.isMultiSelection&&this.selection.disableMultiSelect(),this.selection.collapse())}},selections:{group:"selection",derived:!0,after:["selection"],get:function get(){return this.selection.isMultiSelection?this.selection.selections:[this.selection]},set:function set(e){var t=this;this.selection=e[0],this.selection.isMultiSelection&&e.slice(1).forEach(function(e){return t.selection.addRange(e)})}},textString:{group:"text",after:["document"],derived:!0,get:function get(){return this.document?this.document.textString:""},set:function set(e){e=e?String(e):"",this.deleteText({start:{column:0,row:0},end:this.document.endPosition}),this.insertText(e,{column:0,row:0})}},value:{group:"text",after:["document","embeddedMorphMap"],derived:!0,get:function get(){var e=this.textAndAttributes;if(1===e.length){var t=$(e[0],2),n=t[0],r=t[1];if(!Object.keys(r||{}).length)return n}return e},set:function set(e){"string"==typeof e?this.textString=e:this.textAndAttributes=e}},textAndAttributes:{group:"text",derived:!0,after:["document"],get:function get(){return this.document.textAndAttributes},set:function set(e){this.replace({start:{row:0,column:0},end:this.documentEndPosition},e)}},defaultTextStyleProps:{group:"_internal",readOnly:!0,derived:!0,get:function get(){return this.constructor.defaultTextStyleProps}},defaultTextStyle:{group:"styling",after:["viewState"],derived:!0,get:function get(){return r.obj.select(this,this.defaultTextStyleProps)},set:function set(e){Object.assign(this,e)}},customizedTextStyle:{group:"styling",readOnly:!0,derived:!0,get:function get(){for(var e={},t=this.defaultTextStyleProps,n=this.constructor.defaultTextStyle,r=0;r<t.length;r++){var i=t[r],o=this[i];o!==n[i]&&(e[i]=o)}return e}},nativeCursor:{defaultValue:"",isDefaultTextStyleProp:!0},fontFamily:{group:"text styling",type:"Enum",values:z.basicFontItems,defaultValue:"Sans-Serif",isStyleProp:!0,isDefaultTextStyleProp:!0,after:["defaultTextStyle"]},fontSize:{group:"text styling",type:"Number",min:1,unit:"pt",defaultValue:12,isStyleProp:!0,isDefaultTextStyleProp:!0,after:["defaultTextStyle"]},selectionColor:{group:"text styling",type:"Color",isStyleProp:!0,after:["defaultTextStyle"]},fontColor:{group:"text styling",type:"Color",defaultValue:t.Color.black,isStyleProp:!0,isDefaultTextStyleProp:!0,after:["defaultTextStyle"]},fontWeight:{group:"text styling",type:"Enum",values:["bold","bolder","light","lighter","normal"],defaultValue:"normal",isStyleProp:!0,isDefaultTextStyleProp:!0,after:["defaultTextStyle"]},fontStyle:{group:"text styling",type:"Enum",values:["normal","italic","oblique"],defaultValue:"normal",isStyleProp:!0,isDefaultTextStyleProp:!0,after:["defaultTextStyle"]},textDecoration:{group:"text styling",type:"Enum",values:["none","underline"],defaultValue:"none",isStyleProp:!0,isDefaultTextStyleProp:!0,after:["defaultTextStyle"]},textStyleClasses:{group:"text styling",isStyleProp:!0,isDefaultTextStyleProp:!0,after:["defaultTextStyle"]},backgroundColor:{group:"text styling",type:"Color",isStyleProp:!0,isDefaultTextStyleProp:!0,after:["defaultTextStyle"]},textAlign:{group:"text styling",type:"Enum",values:["center","justify","left","right"],isStyleProp:!0,isDefaultTextStyleProp:!0,after:["document","defaultTextStyle","viewState"]},lineHeight:{group:"text styling",isStyleProp:!0,isDefaultTextStyleProp:!0,after:["document","defaultTextStyle","viewState"]},letterSpacing:{group:"text styling",isStyleProp:!0,isDefaultTextStyleProp:!0,after:["document","defaultTextStyle","viewState"]},wordSpacing:{group:"text styling",isStyleProp:!0,isDefaultTextStyleProp:!0,after:["document","defaultTextStyle","viewState"]},lineWrapping:{group:"text",type:"Enum",values:[!1,!0,"by-words","anywhere","only-by-words","wider","by-chars"],isStyleProp:!0,defaultValue:!1,after:["document","viewState"]},anchors:{group:"core",defaultValue:[],set:function set(e){var t=this,n=r.arr.withoutAll(e,this.anchors);r.arr.withoutAll(this.anchors,e).forEach(function(e){return t.removeAnchor(e)}),n.forEach(function(e){return t.addAnchor(e)})}},markers:{group:"core",defaultValue:[]},savedMarks:{group:"core",defaultValue:[],after:["anchors"],set:function set(e){var t=this;this.savedMarks;e=e.map(function(e){return e.isAnchor?e:t.addAnchor(Object.assign({},e,{id:"saved-mark-"+r.string.newUUID()}))});var n=this.savedMarks.filter(function(t){return!e.includes(t)});return e>z.text.markStackSize&&n.push.apply(n,X(e.splice(0,e.length-z.text.markStackSize))),n.map(function(e){return t.removeAnchor(e)}),this.setProperty("savedMarks",e)}},activeMarkPosition:{group:"_internal",after:["activeMark"],derived:!0,get:function get(){var e=this.activeMark;return e?e.position:null}},activeMark:{group:"core",after:["anchors"],set:function set(e){if(e)e=this.addAnchor(e.isAnchor?e:Object.assign({},e,{id:"saved-mark-"+r.string.newUUID()}));else{var t=this.activeMark;this.savedMarks.includes(t)||this.removeAnchor(t)}this.setProperty("activeMark",e)}},plugins:{group:"plugins",defaultValue:[],after:["value"],set:function set(e){var t=this,n=this.getProperty("plugins");r.arr.withoutAll(n,e).forEach(function(e){return t.removePlugin(e)}),e.forEach(function(e){return t.addPlugin(e)})}},editorModeName:{group:"plugins",derived:!0,after:["plugins"],get:function get(){var e=this.editorPlugin;return e?e.shortName:null},set:function set(e){this.changeEditorMode(e)}}}}}],n,void 0,{start:1254,end:106194})}($t),pr=R.diff,fr=R.patch,yr=R.h,mr=R.create,gr=function(e){var t=_classRecorder,n=t.hasOwnProperty("CustomVNode")&&"function"==typeof t.CustomVNode?t.CustomVNode:t.CustomVNode=function CustomVNode(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function CustomVNode_initialize_(e,t){this.morph=e,this.renderer=t,this.morphVtree=null,this.key="custom-"+e.id}},{key:"type",get:function get(){return"Widget"}},{key:"renderMorph",value:function CustomVNode_renderMorph_(){var e=this.morph,t=this.renderer,n=this.morphVtree=t.renderMorph(e),r="customNode-key-"+e.id;return n.children[0]&&n.children[0].key===r||n.children.unshift(yr(e.domNodeTagName||"div",{key:r},[])),n}},{key:"init",value:function CustomVNode_init_(){var e=mr(this.renderMorph(),this.renderer.domEnvironment);return e.childNodes[0].appendChild(this.morph.domNode),e}},{key:"update",value:function CustomVNode_update_(e,t){var n=e.morphVtree||this.renderMorph(),r=this.renderMorph(),i=pr(n,r);return fr(t,i),null}},{key:"destroy",value:function CustomVNode_destroy_(e){console.log("[HTMLMorph] node of "+this.morph.name+" gets removed from DOM")}}],void 0,t,void 0,{start:381,end:1946})}(void 0),vr=function(e){var n=_classRecorder,r=n.hasOwnProperty("HTMLMorph")&&"function"==typeof n.HTMLMorph?n.HTMLMorph:n.HTMLMorph=function HTMLMorph(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(r,e,[{key:"isHTMLMorph",get:function get(){return!0}},{key:"defaultHTML",get:function get(){return'\n<div style="display: flex;\n            align-items: center;\n            justify-content: center;\n            height: 100%;\n            background: -webkit-gradient(linear, 0% 0%, 0% 100%, color-stop(0%, rgba(242,243,244,1)),color-stop(100%, rgba(229,231,233,1)))">\n  <p style="font: bold 40pt Inconsolata, monospace; color: lightgray;">&lt;HTML&#x2F;&gt;</p>\n</div>'}},{key:"render",value:function HTMLMorph_render_(e){return new gr(this,e)}},{key:"menuItems",value:function HTMLMorph_menuItems_(){var e=this,t=lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(r.prototype),"menuItems",this).call(this);return t.unshift(["edit html...",function(){return e.world().execCommand("open workspace",{language:"html",content:e.html,target:e})}],{isDivider:!0}),t}}],[{key:"properties",get:function get(){return{extent:{defaultValue:t.pt(420,330)},html:{after:["cssDeclaration"],initialize:function initialize(){this.html=this.defaultHTML},get:function get(){return this.domNode.innerHTML},set:function set(e){if(this.domNode.innerHTML=e,e.includes("<script")){var t=this.domNode.querySelectorAll("script"),n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,l=s.parentNode;s.remove();var u=document.createElement("script"),c=!0,h=!1,d=void 0;try{for(var p,f=s.attributes[Symbol.iterator]();!(c=(p=f.next()).done);c=!0){var y=p.value,m=y.name,g=y.value;u.setAttribute(m,g)}}catch(e){h=!0,d=e}finally{try{!c&&f.return&&f.return()}finally{if(h)throw d}}var v=!0,x=!1,b=void 0;try{for(var w,_=s.childNodes[Symbol.iterator]();!(v=(w=_.next()).done);v=!0){var k=w.value;u.appendChild(k)}}catch(e){x=!0,b=e}finally{try{!v&&_.return&&_.return()}finally{if(x)throw b}}l.appendChild(u)}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}}},domNodeTagName:{readOnly:!0,get:function get(){return"div"}},domNodeStyle:{readOnly:!0,get:function get(){return"position: absolute; width: 100%; height: 100%;"}},domNode:{derived:!0,get:function get(){return this._domNode||(this._domNode=this.document.createElement(this.domNodeTagName),this._domNode.setAttribute("style",this.domNodeStyle)),this._domNode},set:function set(e){return this.domNode.parentNode&&this.domNode.parentNode.replaceChild(e,this.domNode),this._domNode=e}},document:{readOnly:!0,get:function get(){return this.env.domEnv.document}},scrollExtent:{readOnly:!0,get:function get(){return t.pt(this.domNode.scrollWidth,this.domNode.scrollHeight)}},cssDeclaration:{set:function set(e){var t=this;if(this.setProperty("cssDeclaration",e),e)System.import("lively.ide/css/parser.js").then(function(n){var r=n.parse(e);r.stylesheet.rules.forEach(function(e){e.selectors&&(e.selectors=e.selectors.map(function(e){return"#"+t.id+" "+e}))}),addOrChangeCSSDeclaration("css-for-"+t.id,n.stringify(r))}).catch(function(e){return console.error("Error setting cssDeclaration of "+t+": "+e)});else{var n=this.env.domEnv.document.getElementById("css-for-"+this.id);n&&n.remove()}}}}}}],n,void 0,{start:2271,end:5895})}($t),xr=function(e){var n=_classRecorder,i=n.hasOwnProperty("IFrameMorph")&&"function"==typeof n.IFrameMorph?n.IFrameMorph:n.IFrameMorph=function IFrameMorph(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(i,e,[{key:"isIFrameMorph",get:function get(){return!0}},{key:"reload",value:function IFrameMorph_reload_(){return this.src?this.loadURL(this.src):this.srcDoc?this.displayHTML(this.srcDoc):null}},{key:"whenLoaded",value:function IFrameMorph_whenLoaded_(){return this._whenLoaded||Promise.resolve()}},{key:"displayHTML",value:function(){var e=H(regeneratorRuntime.mark(function _callee(e){var t,n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return t=i.keepScroll,(n=void 0===t||t)&&(r=this.iframeScroll),this.srcDoc=e,o.next=6,this.whenLoaded();case 6:return n&&r&&(this.iframeScroll=r),o.abrupt("return",this);case 8:case"end":return o.stop()}},_callee,this)}));return function IFrameMorph_displayHTML_(t,n){return e.apply(this,arguments)}}()},{key:"loadURL",value:function(){var e=H(regeneratorRuntime.mark(function _callee2(e){var t,n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return t=i.keepScroll,(n=void 0===t||t)&&(r=this.iframeScroll),this.src=e,o.next=6,this.whenLoaded();case 6:return n&&r&&(this.iframeScroll=r),o.abrupt("return",this);case 8:case"end":return o.stop()}},_callee2,this)}));return function IFrameMorph_loadURL_(t,n){return e.apply(this,arguments)}}()},{key:"defaultSrcDoc",get:function get(){return'\n    <div style="display: flex;\n                align-items: center;\n                justify-content: center;\n                height: 100%;\n                background: -webkit-gradient(linear, 0% 0%, 0% 100%, color-stop(0%, rgba(242,243,244,1)),color-stop(100%, rgba(229,231,233,1)))">\n      <p style="font: bold 40pt Inconsolata, monospace; color: lightgray;">&lt;iFrame&#x2F;&gt;</p>\n    </div>'}},{key:"defaultHTML",get:function get(){return'<iframe width="100%" height="100%" frameBorder="false" srcdoc=""></iframe>'}}],[{key:"example",value:function(){var e=H(regeneratorRuntime.mark(function _callee3(){var e;return regeneratorRuntime.wrap(function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:return(e=(new xr).openInWindow({title:"iframe"}).targetMorph).srcDoc="",e.src="http://localhost:9011/worlds/html%20export",t.next=5,e.loadURL("https://google.com");case 5:return e.iframe.src,e.iframe.srcDoc,e.src="",e.srcDoc="fooo",t.next=11,e.reload();case 11:case"end":return t.stop()}},_callee3,this)}));return function IFrameMorph_example_(){return e.apply(this,arguments)}}()},{key:"properties",get:function get(){return{html:{initialize:function initialize(){this.html=this.defaultHTML,this.srcDoc=this.defaultSrcDoc}},iframe:{derived:!0,readOnly:!0,after:["domNode"],get:function get(){return this.domNode.querySelector("iframe")}},src:{derived:!0,after:["iframe"],get:function get(){return this.iframe.src},set:function set(e){this.iframe.removeAttribute("srcDoc"),this.iframe.src=e;var t=r.promise.deferred(),n=(t.promise,t.resolve);t.reject;this._whenLoaded=r.promise,this.iframe.onload=function(e){return n(e)}}},srcDoc:{derived:!0,after:["iframe"],get:function get(){return this.iframe.srcdoc},set:function set(e){this.iframe.removeAttribute("src"),this.iframe.srcdoc=e,this._whenLoaded=this.whenRendered().then(function(){return r.promise.delay(20)})}},iframeScroll:{derived:!0,after:["iframe"],get:function get(){try{var e=this.iframe.contentWindow,n=e.scrollX,r=e.scrollY;return t.pt(n,r)}catch(e){return t.pt(0,0)}},set:function set(e){try{this.iframe.contentWindow.scrollTo(e.x,e.y)}catch(e){}}}}}}],n,void 0,{start:5905,end:9097})}(vr),br=function(e){var n=_classRecorder,i=n.hasOwnProperty("Layout")&&"function"==typeof n.Layout?n.Layout:n.Layout=function Layout(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(i,e,[{key:Symbol.for("lively-instance-initialize"),value:function Layout_initialize_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.spacing,r=e.padding,i=e.border,o=e.container,a=e.manualUpdate,s=e.autoResize,l=e.ignore,u=e.onScheduleApply,c=e.layoutOrder,h=e.reactToSubmorphAnimations;this.applyRequests=!1,this.border=Object.assign({top:0,left:0,right:0,bottom:0},i),this.ignore=l||[],this.lastBoundsExtent=this.container&&this.container.bounds().extent(),this.active=!1,this.container=o,this.manualUpdate=a,this.reactToSubmorphAnimations=h||!1,this.autoResize=void 0==s||s,this.onScheduleApply=u||function(e,t,n){},c&&(this.layoutOrder=c,this.layoutOrderSource=JSON.stringify(String(c))),this.spacing=n||0,this._padding=r?"number"==typeof r?t.Rectangle.inset(r):r:null}},{key:"attach",value:function Layout_attach_(){this.apply(),this.refreshBoundsCache()}},{key:"copy",value:function Layout_copy_(){return new this.constructor(this)}},{key:"description",value:function Layout_description_(){return"Describe the layout behavior here."}},{key:"name",value:function Layout_name_(){return"Name presented to the user."}},{key:"isEnabled",value:function Layout_isEnabled_(){return!this.active}},{key:"disable",value:function Layout_disable_(){this.active=!0}},{key:"enable",value:function Layout_enable_(e){this.active=!1,this.scheduleApply(null,e)}},{key:"padding",get:function get(){return this._padding}},{key:"padding",set:function set(e){"number"==typeof e&&(e=t.Rectangle.inset(e)),this._padding=e,this.apply()}},{key:"boundsChanged",value:function Layout_boundsChanged_(e){return!(this.lastBoundsExtent&&e.bounds().extent().equals(this.lastBoundsExtent))}},{key:"extentChanged",value:function Layout_extentChanged_(e){return!(this.lastExtent&&e.extent.equals(this.lastExtent))}},{key:"layoutableSubmorphs",get:function get(){var e=this;return this.layoutOrder||(this.layoutOrder=r.Closure.fromSource(JSON.parse(this.layoutOrderSource)).recreateFunc()),r.arr.sortBy(this.container.submorphs.filter(function(t){return t.isLayoutable&&!e.ignore.includes(t.name)}),function(t){return e.layoutOrder(t)})}},{key:"layoutOrder",value:function Layout_layoutOrder_(e){return this.container.submorphs.indexOf(e)}},{key:"submorphBoundsChanged",get:function get(){var e=this.layoutableSubmorphs,t=this.layoutableSubmorphBounds;if(!t||e.length!=t.length)return!0;for(var n=0;n<e.length;n++){var r=e[n];if(!t[n].equals(r.bounds()))return!0}return!1}},{key:"refreshBoundsCache",value:function Layout_refreshBoundsCache_(){this.lastExtent=this.container.extent,this.layoutableSubmorphBounds=this.layoutableSubmorphs.map(function(e){return e.bounds()})}},{key:"onContainerRender",value:function Layout_onContainerRender_(){this.forceLayout()}},{key:"noLayoutActionNeeded",get:function get(){return!this.submorphBoundsChanged&&!this.boundsChanged(this.container)&&!this.extentChanged(this.container)}},{key:"__dont_serialize__",get:function get(){return["lastAnim","animationPromise"]}},{key:"forceLayout",value:function Layout_forceLayout_(){var e=this;if(this.applyRequests){if(this.applyRequests=!1,this.noLayoutActionNeeded)return;this.refreshBoundsCache(),this.container.withMetaDo({isLayoutAction:!0,animation:this.lastAnim},function(){return e.apply(e.lastAnim)}),this.lastAnim=!1}}},{key:"forceLayoutsInNextLevel",value:function Layout_forceLayoutsInNextLevel_(){this.layoutableSubmorphs.forEach(function forceLayouts(e){e.layout?e.layout.forceLayout():e.submorphs.forEach(forceLayouts)})}},{key:"scheduleApply",value:function Layout_scheduleApply_(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};"function"==typeof this.onScheduleApply&&this.onScheduleApply(e,t,n),this.active||(t&&(this.lastAnim=t),this.applyRequests=!0)}},{key:"onSubmorphResized",value:function Layout_onSubmorphResized_(e,t){this.scheduleApply(e,this.reactToSubmorphAnimations&&t.meta.animation,t)}},{key:"onSubmorphAdded",value:function Layout_onSubmorphAdded_(e,t){this.scheduleApply(e,t)}},{key:"onSubmorphRemoved",value:function Layout_onSubmorphRemoved_(e,t){this.scheduleApply(e,t)}},{key:"onChange",value:function Layout_onChange_(e){var t=e.selector,n=e.args,r=e.prop,i=e.value,o=e.prevValue,a=e.meta,s=this.reactToSubmorphAnimations&&a&&a.animation,l=n&&n[0];switch(t){case"removeMorph":this.onSubmorphRemoved(l,s);break;case"addMorphAt":this.onSubmorphAdded(l,s)}"extent"===r&&i&&o&&(o.x!==i.x||o.y!==i.y)&&this.scheduleApply(l,s)}},{key:"affectsLayout",value:function Layout_affectsLayout_(e,t){var n=t.prop,i=t.value,o=t.prevValue;return["position","scale","rotation","isLayoutable","extent"].includes(n)&&!r.obj.equals(i,o)}},{key:"onSubmorphChange",value:function Layout_onSubmorphChange_(e,t){if(t.meta&&t.meta.isLayoutAction)return this.scheduleApply(e,this.reactToSubmorphAnimation&&t.meta.animation);this.affectsLayout(e,t)&&this.onSubmorphResized(e,t)}},{key:"changePropertyAnimated",value:function Layout_changePropertyAnimated_(e,t,n,r){if(r){var i,o=r.duration,a=r.easing;this.animationPromise=e.animate((U(i={},t,n),U(i,"duration",o),U(i,"easing",a),i))}else e[t]=n}},{key:"attachAnimated",value:function Layout_attachAnimated_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments[1],n=arguments[2];this.active||(this.container=t,this.apply({duration:e,easing:n}),this.active=!0,t.layout=this,this.active=!1)}},{key:"apply",value:function Layout_apply_(e){this.active||(this.active=!0,this.lastBoundsExtent=this.container&&this.container.bounds().extent(),this.active=!1)}}],void 0,n,void 0,{start:281,end:6436})}(void 0),wr=function(e){var t=_classRecorder,n=t.hasOwnProperty("CustomLayout")&&"function"==typeof t.CustomLayout?t.CustomLayout:t.CustomLayout=function CustomLayout(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function CustomLayout_initialize_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.relayout=e.relayout,this.layouterString=JSON.stringify(String(e.relayout)),this.varMapping=e.varMapping||{},lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(n.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e)}},{key:"name",value:function CustomLayout_name_(){return"Custom Layout"}},{key:"apply",value:function CustomLayout_apply_(e){if(!this.active&&this.container){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(n.prototype),"apply",this).call(this,e),this.active=!0,this.relayout||(this.relayout=r.Closure.fromSource(JSON.parse(this.layouterString),this.varMapping).recreateFunc());try{this.relayout(this.container,e)}catch(e){console.error("Error in relayout() of a custom layout:",e)}this.lastBoundsExtent=this.container&&this.container.bounds().extent(),this.active=!1}}}],void 0,t,void 0,{start:6445,end:7391})}(br),_r=function(e){var n=_classRecorder,i=n.hasOwnProperty("FillLayout")&&"function"==typeof n.FillLayout?n.FillLayout:n.FillLayout=function FillLayout(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(i,e,[{key:Symbol.for("lively-instance-initialize"),value:function FillLayout_initialize_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(i.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e),this.morphs=e.morphs||[],this.fixedHeight=e.fixedHeight,this.fixedWidth=e.fixedWidth,this._spacing=0}},{key:"name",value:function FillLayout_name_(){return"Fill"}},{key:"description",value:function FillLayout_description_(){return"Forces all submorphs to match the extent of their owner."}},{key:"spacing",set:function set(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(r.obj.isNumber(e))var t=n=i=o=e;else{t=e.top;var n=e.left,i=e.right,o=e.bottom;t=t||0,n=n||0,i=i||0,o=o||0}this._spacing={top:t,left:n,right:i,bottom:o},this.apply()}},{key:"spacing",get:function get(){return this._spacing}},{key:"apply",value:function FillLayout_apply_(){var e=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.active&&this.container){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(i.prototype),"apply",this).call(this,n);var r=this.fixedWidth,o=this.fixedHeight,a=this.spacing,s=a.top,l=a.bottom,u=a.left,c=a.right,h=!o&&this.container.height-s-l,d=!r&&this.container.width-u-c;this.active=!0,this.morphs.forEach(function(r){if(r.isLayoutable){r=e.container.getSubmorphNamed(r);var i=t.pt(u,s).extent(t.pt(d||r.width,h||r.height));if(n){var o=n.duration,a=n.easing;r.animate({bounds:i,duration:o,easing:a})}else r.setBounds(i)}}),this.active=!1}}},{key:"layoutOrder",value:function FillLayout_layoutOrder_(e){return e.top}}],void 0,n,void 0,{start:7600,end:9250})}(br),kr=function(e){var t=_classRecorder,n=t.hasOwnProperty("FloatLayout")&&"function"==typeof t.FloatLayout?t.FloatLayout:t.FloatLayout=function FloatLayout(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:"layoutOrder",value:function FloatLayout_layoutOrder_(e){return e.left}}],void 0,t,void 0,{start:9252,end:9335})}(br),Sr=function(e){var n=_classRecorder,r=n.hasOwnProperty("VerticalLayout")&&"function"==typeof n.VerticalLayout?n.VerticalLayout:n.VerticalLayout=function VerticalLayout(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(r,e,[{key:Symbol.for("lively-instance-initialize"),value:function VerticalLayout_initialize_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(r.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e),this._resizeSubmorphs=void 0!==e.resizeSubmorphs&&e.resizeSubmorphs,this._align=e.align||"left"}},{key:"name",value:function VerticalLayout_name_(){return"Vertical"}},{key:"description",value:function VerticalLayout_description_(){return"Assemble the submorphs in a vertically growing list."}},{key:"inspect",value:function VerticalLayout_inspect_(e){return new T.FlexLayoutHalo(this.container,e)}},{key:"possibleAlignValues",get:function get(){return["left","center","right"]}},{key:"align",get:function get(){return this._align}},{key:"align",set:function set(e){this._align=e,this.apply()}},{key:"autoResize",get:function get(){return this._autoResize}},{key:"autoResize",set:function set(e){this._autoResize=e,this.apply()}},{key:"spacing",get:function get(){return this._spacing}},{key:"spacing",set:function set(e){this._spacing=e,this.apply()}},{key:"resizeSubmorphs",get:function get(){return this._resizeSubmorphs}},{key:"resizeSubmorphs",set:function set(e){this._resizeSubmorphs=e,this.apply()}},{key:"apply",value:function VerticalLayout_apply_(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.active&&this.container){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(r.prototype),"apply",this).call(this,e);var n=this.container,i=this.autoResize,o=this.resizeSubmorphs,a=this.spacing,s=this.align,l=this.layoutableSubmorphs,u=this.padding,c=u?u.left():0,h=u?u.right():0,d=u?u.top():0,p=u?u.bottom():0,f=t.pt(c+a,d+a),y=n.width,m=y-2*a-c-h,g=0;this.active=!0;var v=!0,x=!1,b=void 0;try{for(var w,_=l[Symbol.iterator]();!(v=(w=_.next()).done);v=!0){var k=w.value,S=k.position,M=S.x,C=S.y,P=k.extent.x,T=f.y,A=f.x,L="topLeft";if("center"==s&&(L="topCenter",A=y/2),"right"==s&&(L="topRight",A=y-h-a),M!==A||C!==T)if(e){var R,E=e.duration,z=e.easing;k.animate((U(R={},L,t.pt(A,T)),U(R,"duration",E),U(R,"easing",z),R))}else k[L]=t.pt(A,T);f=k.bottomLeft.addPt(t.pt(0,a)),o&&P!==m&&(k.width=m),g=Math.max(k.bounds().width,g)}}catch(e){x=!0,b=e}finally{try{!v&&_.return&&_.return()}finally{if(x)throw b}}if(this.forceLayoutsInNextLevel(),i&&l.length>0){var O=t.pt(g+2*a+c+h,p+f.y);if(e){var I=e.duration,D=e.easing;this.container.animate({extent:O,duration:I,easing:D})}else this.container.extent=O}this.lastBoundsExtent=this.container.bounds().extent(),this.active=!1}}},{key:"layoutOrder",value:function VerticalLayout_layoutOrder_(e){return e.top}}],void 0,n,void 0,{start:9344,end:12461})}(kr),Mr=function(e){var n=_classRecorder,i=n.hasOwnProperty("HorizontalLayout")&&"function"==typeof n.HorizontalLayout?n.HorizontalLayout:n.HorizontalLayout=function HorizontalLayout(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(i,e,[{key:Symbol.for("lively-instance-initialize"),value:function HorizontalLayout_initialize_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(i.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e),this._direction=e.direction||"leftToRight",this._align=e.align||"top"}},{key:"name",value:function HorizontalLayout_name_(){return"Horizontal"}},{key:"description",value:function HorizontalLayout_description_(){return"Assemble the submorphs in a horizontally growing list."}},{key:"inspect",value:function HorizontalLayout_inspect_(e){return new T.FlexLayoutHalo(this.container,e)}},{key:"possibleDirectionValues",get:function get(){return["leftToRight","rightToLeft","centered"]}},{key:"direction",get:function get(){return this._direction}},{key:"direction",set:function set(e){this._direction=e,this.apply()}},{key:"possibleAlignValues",get:function get(){return["top","center","bottom"]}},{key:"align",get:function get(){return this._align}},{key:"align",set:function set(e){this._align=e,this.apply()}},{key:"autoResize",get:function get(){return this._autoResize}},{key:"autoResize",set:function set(e){this._autoResize=e,this.apply()}},{key:"spacing",get:function get(){return this._spacing}},{key:"spacing",set:function set(e){this._spacing=e,this.apply()}},{key:"apply",value:function(){var e=H(regeneratorRuntime.mark(function _callee(){var e,n,o,a,s,l,u,c,h,d,p,f,y,m,g,v,x,b,w,_,k,S,M=this,C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return regeneratorRuntime.wrap(function _callee$(P){for(;;)switch(P.prev=P.next){case 0:if(!this.active&&this.container&&this.container.submorphs.length){P.next=2;break}return P.abrupt("return");case 2:if(e=this.direction,n=this.align,o=this.spacing,a=this.container,s=this.autoResize,(l=this.layoutableSubmorphs).length){P.next=10;break}return P.abrupt("return");case 10:if(lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(i.prototype),"apply",this).call(this,C),this.active=!0,this.maxHeight=0,u=this.computeMinContainerExtent(o,a,l),s||(u=u.maxPt(a.extent)),c=0,h=!1,"rightToLeft"!==e){P.next=22;break}h=!0,l=l.reverse(),c=Math.max(0,a.width),P.next=44;break;case 22:if("centered"!==e){P.next=44;break}for(s?a.width-u.x:u.x,d=l.length-1*o,p=!0,f=!1,y=void 0,P.prev=27,m=l[Symbol.iterator]();!(p=(g=m.next()).done);p=!0)v=g.value,d+=v.width;P.next=35;break;case 31:P.prev=31,P.t0=P.catch(27),f=!0,y=P.t0;case 35:P.prev=35,P.prev=36,!p&&m.return&&m.return();case 38:if(P.prev=38,!f){P.next=41;break}throw y;case 41:return P.finish(38);case 42:return P.finish(35);case 43:c=u.x/2-d/2;case 44:return"top"===n?(x=o,h&&(o=-o),l.reduce(function(e,n){return M.changePropertyAnimated(n,h?"topRight":"topLeft",e,C),h?n.topLeft.addPt(t.pt(o,0)):n.topRight.addPt(t.pt(o,0))},t.pt(Math.max(0,c)+o,x)),this.forceLayoutsInNextLevel()):"bottom"===n?(b=u.y+(s?o:-o),l.reduce(function(e,n){return M.changePropertyAnimated(n,h?"bottomRight":"bottomLeft",e,C),h?n.bottomLeft.subPt(t.pt(o,0)):n.bottomRight.addPt(t.pt(o,0))},t.pt(Math.max(0,c)+o,b)),this.forceLayoutsInNextLevel()):(w=u.y/2+(s?o:0),l.reduce(function(e,n){return M.changePropertyAnimated(n,"leftCenter",e,C),n.rightCenter.addPt(t.pt(o,0))},t.pt(Math.max(0,c)+o,w)),this.forceLayoutsInNextLevel()),s&&(_=0,"centered"===e?(k=l[0].left,_=r.arr.last(l).right+k):_=r.arr.last(l).right+o,S=t.pt(Math.max(u.x,_),u.y+2*o),this.changePropertyAnimated(a,"extent",S,C)),this.lastBoundsExtent=this.container.bounds().extent(),this.active=!1,P.abrupt("return",this.animationPromise);case 49:case"end":return P.stop()}},_callee,this,[[27,31,35,43],[36,,38,42]])}));return function HorizontalLayout_apply_(t){return e.apply(this,arguments)}}()},{key:"computeMinContainerExtent",value:function HorizontalLayout_computeMinContainerExtent_(e,n,r){for(var i=(r.length+1)*e,o=0,a=0,s=0;s<r.length;s++){var l=r[s].extent,u=l.x,c=l.y;o+=u,a=Math.max(c,a)}return t.pt(o+i,a)}}],void 0,n,void 0,{start:12470,end:16726})}(kr),Cr=function(e){var n=_classRecorder,o=n.hasOwnProperty("ProportionalLayout")&&"function"==typeof n.ProportionalLayout?n.ProportionalLayout:n.ProportionalLayout=function ProportionalLayout(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(o,e,[{key:"name",value:function ProportionalLayout_name_(){return"Proportional"}},{key:"description",value:function ProportionalLayout_description_(){return"Resizes, scales, and moves morphs according to their original position."}},{key:"inspect",value:function ProportionalLayout_inspect_(e){return new T.ProportionalLayoutHalo(this.container,e)}},{key:Symbol.for("lively-instance-initialize"),value:function ProportionalLayout_initialize_(e){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e),this.extentDelta=t.pt(0,0),this.submorphSettings=e&&e.submorphSettings||[]}},{key:"__after_deserialize__",value:function ProportionalLayout___after_deserialize___(e,t){var n=this._submorphSettings,r=this.container,i=this.constructor.proportionalLayoutSettingsForMorphs;if(n&&r){var o=!0,a=!1,s=void 0;try{for(var l,u=n[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var c=$(l.value,2),h=c[0],d=c[1],p=this._morphsMatchingSelector(r,h),f=$(p,1)[0];f&&i.set(f,d)}}catch(e){a=!0,s=e}finally{try{!o&&u.return&&u.return()}finally{if(a)throw s}}}}},{key:"onSubmorphChange",value:function ProportionalLayout_onSubmorphChange_(e,t,n,r){if("name"===t.prop){var i=this.constructor.proportionalLayoutSettingsForMorphs.get(e);i&&this.changeSettingsFor(e,i,!0)}return lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"onSubmorphChange",this).call(this,e,t)}},{key:"settingsFor",value:function ProportionalLayout_settingsFor_(e){return this.constructor.proportionalLayoutSettingsForMorphs.get(e)||{x:"scale",y:"scale"}}},{key:"changeSettingsFor",value:function ProportionalLayout_changeSettingsFor_(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("string"==typeof t&&(t={x:t,y:t}),this.constructor.proportionalLayoutSettingsForMorphs.set(e,Object.assign({},this.settingsFor(e),{},t)),n){var r=this.submorphSettings.filter(function(t){return t[0]!==e.name});r.push([e.name,this.settingsFor(e)]),this._submorphSettings=r}}},{key:"submorphSettings",get:function get(){return this._submorphSettings}},{key:"submorphSettings",set:function set(e){this.container?(this._submorphSettings=e,this.changeSubmorphSettings(e)):i.once(this,"container",this,"submorphSettings",{converter:function converter(){return e},varMapping:{submorphSettings:e}})}},{key:"changeSubmorphSettings",value:function ProportionalLayout_changeSubmorphSettings_(e){var t=this,n=!0,r=!1,i=void 0;try{for(var o,a=function _loop(){var e=$(o.value,2),n=e[0],r=e[1];t._morphsMatchingSelector(t.container,n).forEach(function(e){return t.changeSettingsFor(e,r)})},s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0)a()}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}}},{key:"_morphsMatchingSelector",value:function ProportionalLayout__morphsMatchingSelector_(e,t){var n=this,i=[];return t?(t.isMorph?i=[t]:t instanceof RegExp?i=e.submorphs.filter(function(e){return e.name.match(t)}):"string"==typeof t?i=e.submorphs.filter(function(e){return e.name===t}):Array.isArray(t)&&(i=r.arr.flatmap(t,function(t){return n._morphsMatchingSelector(e,t)})),i):i}},{key:"refreshBoundsCache",value:function ProportionalLayout_refreshBoundsCache_(){var e=this.container.extent,t=this.lastExtent;t&&!e.eqPt(t)&&(this.extentDelta=this.extentDelta.addPt(e.subPt(t))),this.lastExtent=e,this.layoutableSubmorphBounds=this.layoutableSubmorphs.map(function(e){return e.bounds()})}},{key:"apply",value:function ProportionalLayout_apply_(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.container,r=this.active,i=this.extentDelta,a=i.x,s=i.y,l=(n||{}).extent;if(!r&&n&&(0!=a||0!=s)){this.extentDelta=t.pt(0,0),this.active=!0,lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"apply",this).call(this,e);var u=this.layoutableSubmorphs,c=l.scaleByPt(l.addXY(-a,-s).invertedSafely()),h=!0,d=!1,p=void 0;try{for(var f,y=u[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var m=f.value,g=this.settingsFor(m),v=g.x,x=g.y,b=0,w=0,_=0,k=0;if("move"===v&&(b=a),"move"===x&&(w=s),"resize"===v&&(_=a),"resize"===x&&(k=s),"scale"===v||"scale"===x){var S=t.pt("scale"===v?c.x:1,"scale"===x?c.y:1);m.position=m.position.scaleByPt(S),m.extent=m.extent.scaleByPt(S)}(b||w)&&m.moveBy(t.pt(b,w)),(_||k)&&(m.extent=m.extent.addXY(_,k))}}catch(e){d=!0,p=e}finally{try{!h&&y.return&&y.return()}finally{if(d)throw p}}this.forceLayoutsInNextLevel(),this.active=!1}}}],[{key:"proportionalLayoutSettingsForMorphs",get:function get(){return this._proportionalLayoutSettingsForMorphs||(this._proportionalLayoutSettingsForMorphs=new WeakMap)}}],n,void 0,{start:16736,end:21512})}(br),Pr=function(e){var n=_classRecorder,i=n.hasOwnProperty("TilingLayout")&&"function"==typeof n.TilingLayout?n.TilingLayout:n.TilingLayout=function TilingLayout(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(i,e,[{key:Symbol.for("lively-instance-initialize"),value:function TilingLayout_initialize_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(i.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e),this._axis=e.axis||"row",this._align=e.align||"left"}},{key:"name",value:function TilingLayout_name_(){return"Tiling"}},{key:"description",value:function TilingLayout_description_(){return"Make the submorphs fill their owner, inserting breaks to defer intersecting the bounds as much as possible."}},{key:"inspect",value:function TilingLayout_inspect_(e){return new T.TilingLayoutHalo(this.container,e)}},{key:"axis",get:function get(){return this._axis}},{key:"axis",set:function set(e){this._axis=e,this.apply()}},{key:"align",get:function get(){return this._align}},{key:"align",set:function set(e){this._align=e,this.apply()}},{key:"spacing",get:function get(){return this._spacing}},{key:"spacing",set:function set(e){this._spacing=e,this.apply()}},{key:"apply",value:function TilingLayout_apply_(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.active&&this.container){this.active=!0,lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(i.prototype),"apply",this).call(this,e);for(var n=this.container,o=this.axis,a=this.align,s=this.border,l=this.spacing,u=this.layoutableSubmorphs,c=this.getOptimalWidth(n),h="row"==o,d=h?"left":"top",p=h?"x":"y",f=h?"y":"x",y=0,m=l+s[h?"top":"left"];u.length;){var g,v=c-l,x=r.arr.takeWhile(u,function(e){var t=e.extent,n=v-(t[p]+l);return!(n<0)&&(v=n,!0)});x.length?u.splice(0,x.length):(x=[u.shift()],v=0),g=h?"center"===a?t.pt(v/2+l+s[d],m):t.pt(l,m):"center"===a?t.pt(m,v/2+l+s[d]):t.pt(m,l);var b=!0,w=!1,_=void 0;try{for(var k,S=x[Symbol.iterator]();!(b=(k=S.next()).done);b=!0){var M=k.value;if(e){var C=e.duration,P=e.easing;M.animate({position:g,duration:C,easing:P})}else M.position=g;g=h?g.addXY(l+M.extent[p],0):g.addXY(0,l+M.extent[p]),y=Math.max(y,M.extent[f])}}catch(e){w=!0,_=e}finally{try{!b&&S.return&&S.return()}finally{if(w)throw _}}m+=l+y,y=0}this.active=!1}}},{key:"getMinWidth",value:function TilingLayout_getMinWidth_(){var e=this.layoutableSubmorphs,t=this.border,n=t.left,r=t.right;return e.reduce(function(e,t){return t.width>e?t.width:e},0)+n+r}},{key:"getMinHeight",value:function TilingLayout_getMinHeight_(){var e=this.layoutableSubmorphs,t=this.border,n=t.top,r=t.bottom;return e.reduce(function(e,t){return t.height>e?t.height:e},0)+n+r}},{key:"getOptimalWidth",value:function TilingLayout_getOptimalWidth_(e){var t=this.axis,n=this.border,r=n.left,i=n.top,o=n.right,a=n.bottom,s="row"==t?e.width-r-o:e.height-i-a,l="row"==t?this.getMinWidth():this.getMinHeight();return Math.max(s,l)}},{key:"layoutOrder",value:function TilingLayout_layoutOrder_(e){return e.top}}],void 0,n,void 0,{start:21521,end:25190})}(br),Tr=function(e){var n=_classRecorder,i=n.hasOwnProperty("CenteredTilingLayout")&&"function"==typeof n.CenteredTilingLayout?n.CenteredTilingLayout:n.CenteredTilingLayout=function CenteredTilingLayout(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(i,e,[{key:"name",value:function CenteredTilingLayout_name_(){return"CenteredTiling"}},{key:"description",value:function CenteredTilingLayout_description_(){return"Similar to TilingLayout but center the rows."}},{key:"apply",value:function CenteredTilingLayout_apply_(){var e=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.active&&this.container){this.active=!0,lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(i.prototype),"apply",this).call(this,n);var o=this.getOptimalWidth(this.container),a=this.spacing,s=this.layoutableSubmorphs,l=a+this.border.top;s=s.slice();for(var u=function _loop2(){var n=o,i=r.arr.takeWhile(s,function(e){var t=n-(e.width+2*a);return!(t<0)&&(n=t,!0)});i.length?s=r.arr.withoutAll(s,i):(i=[s.shift()],n=0);var u=t.pt(n/2+a+e.border.left,l),c=!0,h=!1,d=void 0;try{for(var p,f=i[Symbol.iterator]();!(c=(p=f.next()).done);c=!0){var y=p.value;y.position=u,u=u.addXY(2*a+y.width,0),l=Math.max(l,y.bottom)}}catch(e){h=!0,d=e}finally{try{!c&&f.return&&f.return()}finally{if(h)throw d}}l+=2*a};s.length;)u();this.active=!1}}}],void 0,n,void 0,{start:25199,end:26475})}(Pr),Ar=function(e){var n=_classRecorder,i=n.hasOwnProperty("CellGroup")&&"function"==typeof n.CellGroup?n.CellGroup:n.CellGroup=function CellGroup(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(i,e,[{key:Symbol.for("lively-instance-initialize"),value:function CellGroup_initialize_(e){var t=e.cell,n=e.morph,r=e.layout,i=e.align;this.state={cells:[t],layout:r,align:i,resize:r.fitToCell},r&&r.addGroup(this),this.morph=n}},{key:"morph",get:function get(){var e=this.state,t=e.morph,n=e.layout;return t?t.isMorph?t:n.layoutableSubmorphs.find(function(e){return e.name==t}):null}},{key:"compensateOrigin",get:function get(){return this.layout.compensateOrigin}},{key:"resize",get:function get(){return this.state.resize}},{key:"resize",set:function set(e){this.state.resize=e,this.layout.apply()}},{key:"align",get:function get(){return this.state.align||"topLeft"}},{key:"align",set:function set(e){this.state.align=e,this.layout.apply()}},{key:"morph",set:function set(e){var t=e&&this.layout.getCellGroupFor(e);t&&(t.morph=null),this.state.morph=e,this.layout.apply()}},{key:"manages",value:function CellGroup_manages_(e){return this.morph&&(this.morph==e||this.morph.name==e)}},{key:"apply",value:function CellGroup_apply_(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.morph;if(n){var r=this.bounds(),i=this.compensateOrigin?this.layout.container.origin.negated():t.pt(0,0);if(e){var o,a=this.resize?r.extent():n.extent,s=e.duration,l=e.easing;n.animate((U(o={},this.alignedProperty||this.align,r[this.align]().addPt(i)),U(o,"extent",a),U(o,"duration",s),U(o,"easing",l),o))}else this.resize&&(n.extent=r.extent()),n[this.alignedProperty||this.align]=r[this.align]().addPt(i);this.layout.forceLayoutsInNextLevel()}}},{key:"cells",get:function get(){return this.state.cells}},{key:"layout",get:function get(){return this.state.layout}},{key:"bounds",value:function CellGroup_bounds_(){return this.cells.length>0?this.cells.map(function(e){return e.bounds()}).reduce(function(e,t){return e.union(t)}):t.rect(0,0,0,0)}},{key:"includes",value:function CellGroup_includes_(e){return this.cells.find(function(t){return t==e})}},{key:"connect",value:function CellGroup_connect_(e){void 0==this.morph&&(this.morph=e.group.morph),e.group?e.group.disconnect(e,this):e.group=this,this.cells.push(e)}},{key:"disconnect",value:function CellGroup_disconnect_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e.group=t||new Ar({morph:null,layout:this.layout,cell:e}),r.arr.remove(this.cells,e),this.cells.length<1&&this.layout&&this.layout.removeGroup(this)}},{key:"merge",value:function CellGroup_merge_(e){var t=this;e.cells.forEach(function(e){t.connect(e)})}},{key:"topLeft",get:function get(){var e=this;return this.cells.find(function(t){return!(null!=t.left&&t.left.group==e||null!=t.top&&t.top.group==e)})}},{key:"bottomRight",get:function get(){var e=this;return this.cells.find(function(t){return!(null!=t.right&&t.right.group==e||null!=t.bottom&&t.bottom.group==e)})}},{key:"position",get:function get(){return this.topLeft.position}}],void 0,n,void 0,{start:26484,end:29676})}(void 0),Lr=function(e){var t=_classRecorder,n=t.hasOwnProperty("LayoutAxis")&&"function"==typeof t.LayoutAxis?t.LayoutAxis:t.LayoutAxis=function LayoutAxis(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function LayoutAxis_initialize_(e){this.origin=e}},{key:"otherAxis",get:function get(){return[].concat(X(this.axisBefore),X(this.axisAfter))}},{key:"axisBefore",get:function get(){for(var e=this,t=[];e=e.before;)t=[e].concat(X(t));return t}},{key:"axisAfter",get:function get(){for(var e=this,t=[];e=e.after;)t=[].concat(X(t),[e]);return t}},{key:"before",get:function get(){throw Error("before() not implemented!")}},{key:"after",get:function get(){throw Error("after() not implemented!")}},{key:"containerLength",get:function get(){return this.container[this.dimension]}},{key:"containerLength",set:function set(e){this.container[this.dimension]=e}},{key:"getRoot",value:function LayoutAxis_getRoot_(){return(this.axisBefore[0]||this).items[0]}},{key:"container",get:function get(){return this.origin.container}},{key:"layout",get:function get(){return this.origin.layout}},{key:"frozen",get:function get(){return this.origin.frozen[this.dimension]}},{key:"frozen",set:function set(e){this.origin.frozen[this.dimension]=e}},{key:"align",set:function set(e){this.items.forEach(function(t){return t.group.state.align=e})}},{key:"fixed",get:function get(){return this.origin.fixed[this.dimension]}},{key:"fixed",set:function set(e){var t,n,i=this;r.obj.isNumber(e)&&(t=e,e=!0),this.items.forEach(function(t){t.fixed[i.dimension]=e}),n=this.containerLength,t&&(this[this.dimension]=t),this.adjustOtherProportions(e),this.containerLength=n}},{key:"length",get:function get(){return this.origin[this.dimension]}},{key:"length",set:function set(e){var t=this;this.items.forEach(function(n){n[t.dimension]=r.num.roundTo(e,1)})}},{key:"proportion",get:function get(){return this.origin.proportion[this.dimension]}},{key:"proportion",set:function set(e){var t=this;this.items.forEach(function(n){n.proportion[t.dimension]=e})}},{key:"min",get:function get(){return this.origin.min[this.dimension]}},{key:"min",set:function set(e){this.adjustMin(e-this.min)}},{key:"adjustMin",value:function LayoutAxis_adjustMin_(e){var t=this;this.items.forEach(function(n){n.min[t.dimension]+e<0?n.min[t.dimension]=0:(n.min[t.dimension],n[t.dimension],n.min[t.dimension]+=e)}),this.layout.apply()}},{key:"adjustProportion",value:function LayoutAxis_adjustProportion_(){this.fixed||(this.proportion=this.dynamicLength>0?this.length/this.dynamicLength:0)}},{key:"adjustOtherProportions",value:function LayoutAxis_adjustOtherProportions_(e){var t=this,n=this.axisBefore,i=this.axisAfter,o=r.arr.sum([].concat(X(n),X(i)).filter(function(e){return!e.fixed}).map(function(e){return e.proportion})),a=function removeOwnProportion(e){return e.proportion=e.proportion/o},s=function insertOwnProportion(e){return e.proportion=e.proportion*t.origin.removedDynamicProportions};e&&(this.origin.removedDynamicProportions=o),n.forEach(e?a:s),i.forEach(e?a:s)}},{key:"prepareForResize",value:function LayoutAxis_prepareForResize_(e){var t=this.proportion*Math.max(0,e-this.staticLength);return this.frozen&&t>=this.min?(this.frozen=!1,this.fixed=!1,this.length=t):!this.frozen&&this.min>t&&(this.frozen=!0,this.fixed=!0,this.length=this.min),this}},{key:"adjustLength",value:function LayoutAxis_adjustLength_(e){var t;this.length+e<0&&(e=-this.length),(t=this.axisAfter.find(function(e){return!e.fixed}))?(e=Math.min(e,t.length),this.length+=e,t.length-=e,this.adjustProportion(),t.adjustProportion()):(t=this.axisBefore.reverse().find(function(e){return!e.fixed}))?(t.length-=e,this.length+=e,this.adjustProportion(),t.adjustProportion()):(this.length+=e,this.adjustProportion(),this.otherAxis.forEach(function(e){return e.adjustProportion()}),this.containerLength+=e)}},{key:"equalizeDynamicAxis",value:function LayoutAxis_equalizeDynamicAxis_(){var e=[].concat(X(this.otherAxis.filter(function(e){return!e.fixed})),X(this.fixed?[]:[this])),t=(this.containerLength-this.staticLength)/e.length;e.map(function(e){return e.fixed||(e.length=t),e}).forEach(function(e){return e.adjustProportion()})}},{key:"addBefore",value:function LayoutAxis_addBefore_(){var e=this.emptyAxis();this.before&&this.before.attachTo(e),e.attachTo(this),this.equalizeDynamicAxis(),this.layout.grid=this.getRoot()}},{key:"addAfter",value:function LayoutAxis_addAfter_(){var e=this.emptyAxis();this.after&&e.attachTo(this.after),this.attachTo(e),this.equalizeDynamicAxis(),this.layout.grid=this.getRoot()}}],void 0,t,void 0,{start:30316,end:35966})}(void 0),Rr=function(e){var t=_classRecorder,n=t.hasOwnProperty("LayoutColumn")&&"function"==typeof t.LayoutColumn?t.LayoutColumn:t.LayoutColumn=function LayoutColumn(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function LayoutColumn_initialize_(e){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(n.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e),this.items=[].concat(X(e.above),[e],X(e.below))}},{key:"dimension",get:function get(){return"width"}},{key:"before",get:function get(){return this._before||(this._before=this.origin.left&&new Rr(this.origin.left))}},{key:"after",get:function get(){return this._after||(this._after=this.origin.right&&new Rr(this.origin.right))}},{key:"row",value:function LayoutColumn_row_(e){return this.items[e]}},{key:"dynamicLength",get:function get(){return this.origin.dynamicWidth}},{key:"staticLength",get:function get(){return this.origin.totalStaticWidth}},{key:"width",get:function get(){return this.length}},{key:"width",set:function set(e){var t=e-this.width;this.fixed?(this.length+=t,this.container.width+=t):this.adjustLength(t),!this.layout.manualUpdate&&this.layout.apply()}},{key:"paddingLeft",set:function set(e){this.items.forEach(function(t){t.padding.x=e}),this.layout.apply()}},{key:"paddingRight",set:function set(e){this.items.forEach(function(t){t.padding.width=e}),this.layout.apply()}},{key:"emptyAxis",value:function LayoutColumn_emptyAxis_(){var e=new Rr(new zr({column:r.arr.withN(this.items.length,null),layout:this.layout}));return r.arr.zip(e.items,this.items).forEach(function(e){var t=$(e,2),n=t[0],r=t[1];n.height=r.height,n.fixed.height=r.fixed.height,n.frozen.height=r.frozen.height,n.proportion.height=r.proportion.height,n.min.height=r.min.height}),e}},{key:"attachTo",value:function LayoutColumn_attachTo_(e){return this.after&&(this.after._before=null),this._after=null,r.arr.zip(this.items,e.items).forEach(function(e){var t=$(e,2),n=t[0],r=t[1];n.right=r,r.left=n}),this.equalizeDynamicAxis(),e}},{key:"remove",value:function LayoutColumn_remove_(){var e=this,t=this.before||this.after;this.items.forEach(function(t){t.left&&(t.left.right=t.right),t.right&&(t.right.left=t.left),t.group.disconnect(t),e.layout.removeGroup(t.group)}),this.before&&(this.before._after=null),this.after&&(this.after._before=null),this.before||(this.layout.grid=this.after.getRoot()),t.equalizeDynamicAxis()}}],void 0,t,void 0,{start:35975,end:38227})}(Lr),Er=function(e){var t=_classRecorder,n=t.hasOwnProperty("LayoutRow")&&"function"==typeof t.LayoutRow?t.LayoutRow:t.LayoutRow=function LayoutRow(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(n,e,[{key:Symbol.for("lively-instance-initialize"),value:function LayoutRow_initialize_(e){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(n.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e),this.items=[].concat(X(e.before),[e],X(e.after))}},{key:"dimension",get:function get(){return"height"}},{key:"emptyAxis",value:function LayoutRow_emptyAxis_(){var e=new Er(new zr({row:r.arr.withN(this.items.length,null),layout:this.layout}));return r.arr.zip(e.items,this.items).forEach(function(e){var t=$(e,2),n=t[0],r=t[1];n.width=r.width,n.fixed.width=r.fixed.width,n.frozen.width=r.frozen.width,n.proportion.width=r.proportion.width,n.min.width=r.min.width}),e}},{key:"paddingTop",set:function set(e){this.items.forEach(function(t){t.padding.y=e}),this.layout.apply()}},{key:"paddingBottom",set:function set(e){this.items.forEach(function(t){t.padding.height=e}),this.layout.apply()}},{key:"before",get:function get(){return this._before||(this._before=this.origin.top&&new Er(this.origin.top))}},{key:"after",get:function get(){return this._after||(this._after=this.origin.bottom&&new Er(this.origin.bottom))}},{key:"dynamicLength",get:function get(){return this.origin.dynamicHeight}},{key:"staticLength",get:function get(){return this.origin.totalStaticHeight}},{key:"attachTo",value:function LayoutRow_attachTo_(e){return this.after&&(this.after._before=null),this._after=null,r.arr.zip(this.items,e.items).forEach(function(e){var t=$(e,2),n=t[0],r=t[1];n.bottom=r,r.top=n}),this.equalizeDynamicAxis(),e}},{key:"col",value:function LayoutRow_col_(e){return this.items[e]}},{key:"height",get:function get(){return this.length}},{key:"height",set:function set(e){var t=e-this.height;this.fixed?(this.length+=t,this.container.height+=t):(this.adjustLength(t),this.proportion=this.origin.dynamicHeight>0?this.height/this.origin.dynamicHeight:0),!this.layout.manualUpdate&&this.layout.apply()}},{key:"remove",value:function LayoutRow_remove_(){var e=this,t=this.before||this.after;this.items.forEach(function(t){t.top&&(t.top.bottom=t.bottom),t.bottom&&(t.bottom.top=t.top),t.group.disconnect(t),e.layout.removeGroup(t.group)}),this.before&&(this.before._after=null),this.after&&(this.after._before=null),this.before||(this.layout.grid=this.after.getRoot()),t.equalizeDynamicAxis()}}],void 0,t,void 0,{start:38236,end:40568})}(Lr),zr=function(e){var n=_classRecorder,i=n.hasOwnProperty("LayoutCell")&&"function"==typeof n.LayoutCell?n.LayoutCell:n.LayoutCell=function LayoutCell(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(i,e,[{key:Symbol.for("lively-instance-initialize"),value:function LayoutCell_initialize_(e){var n,r=e.row,i=e.column,o=e.top,a=e.left,s=e.right,l=e.bottom,u=e.layout,c=K(r||[]),h=c[0],d=(r=c.slice(1),K(i||[])),p=d[0];i=d.slice(1);this.layout=u,this.fixed={width:!1,height:!1},this.frozen={width:!1,height:!1},this.min={width:0,height:0},this.top=o,this.left=a,this.bottom=l,this.right=s,this.padding=t.rect(0,0,0,0),r.length>0?this.right=new zr({row:r,left:this,layout:u}):i.length>0&&(this.bottom=new zr({column:i,top:this,layout:u})),this.proportion={width:1/(1+this.before.length+this.after.length),height:1/(1+this.above.length+this.below.length)},this.height=this.container.height*this.proportion.height,this.width=this.container.width*this.proportion.width,(n=u&&u.getCellGroupFor(h||p))?n.connect(this):this.group=new Ar({cell:this,morph:h||p,layout:u})}},{key:"container",get:function get(){return this.layout.container}},{key:"above",get:function get(){return this.collect({neighbor:"top",prepend:!0})}},{key:"below",get:function get(){return this.collect({neighbor:"bottom",append:!0})}},{key:"before",get:function get(){return this.collect({neighbor:"left",prepend:!0})}},{key:"after",get:function get(){return this.collect({neighbor:"right",append:!0})}},{key:"collect",value:function LayoutCell_collect_(e){for(var t=e.neighbor,n=e.prepend,r=e.append,i=[],o=this;o=o[t];)n&&(i=[o].concat(X(i))),r&&(i=[].concat(X(i),[o]));return i}},{key:"col",value:function LayoutCell_col_(e){for(var t=this,n=e;n>0&&t;)t=t.right,n--;if(!t)throw Error(e+" out of bounds! Last column was "+(e-n-1));return new Rr(t)}},{key:"row",value:function LayoutCell_row_(e){for(var t=this,n=e;n>0&&t;)t=t.bottom,n--;if(!t)throw Error(e+" out of bounds! Last row was "+(e-n-1));return new Er(t)}},{key:"extent",get:function get(){return t.pt(this.width,this.height)}},{key:"staticWidth",get:function get(){return this.fixed.width||this.min.width==this.width}},{key:"staticHeight",get:function get(){return this.fixed.height||this.min.height==this.height}},{key:"totalStaticWidth",get:function get(){return r.arr.sum([this].concat(X(this.before),X(this.after)).filter(function(e){return e.staticWidth}).map(function(e){return e.width}))}},{key:"totalStaticHeight",get:function get(){return r.arr.sum([this].concat(X(this.above),X(this.below)).filter(function(e){return e.staticHeight}).map(function(e){return e.height}))}},{key:"dynamicWidth",get:function get(){return r.arr.sum([this].concat(X(this.before),X(this.after)).filter(function(e){return!e.staticWidth}).map(function(e){return e.width}))}},{key:"dynamicHeight",get:function get(){return r.arr.sum([this].concat(X(this.above),X(this.below)).filter(function(e){return!e.staticHeight}).map(function(e){return e.height}))}},{key:"height",get:function get(){return Math.max(this.min.height,this._height||0)}},{key:"height",set:function set(e){this._height=e}},{key:"width",get:function get(){return Math.max(this.min.width,this._width||0)}},{key:"width",set:function set(e){this._width=e}},{key:"position",get:function get(){return t.pt(r.arr.sum(this.before.map(function(e){return e.width})),r.arr.sum(this.above.map(function(e){return e.height})))}},{key:"bounds",value:function LayoutCell_bounds_(){return this.position.addPt(this.padding.topLeft()).extent(this.extent.subPt(this.padding.extent()).subPt(this.padding.topLeft()))}}],void 0,n,void 0,{start:40577,end:44323})}(void 0),Or=function(e){var n=_classRecorder,i=n.hasOwnProperty("GridLayout")&&"function"==typeof n.GridLayout?n.GridLayout:n.GridLayout=function GridLayout(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(i,e,[{key:Symbol.for("lively-instance-initialize"),value:function GridLayout_initialize_(e){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(i.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e),e=Object.assign({autoAssign:!0,fitToCell:!0},e),this.cellGroups=[],this.config=e}},{key:"name",value:function GridLayout_name_(){return"Grid"}},{key:"description",value:function GridLayout_description_(){return"Aligns the submorphs alongside a configurable grid. Columns and rows and be configured to have different proportional, minimal or fixed sizes. Cells can further be grouped such that submorphs fill up multiple slots of the grid."}},{key:"initGrid",value:function GridLayout_initGrid_(){var e=this,t=this.ensureGrid(this.config).map(function(t){return new Er(new zr({row:t,layout:e}))});t.reduce(function(e,t){return e.attachTo(t)}),this.config.autoAssign&&this.autoAssign(this.notInLayout),this.grid=t[0].col(0),this.col(0).equalizeDynamicAxis(),this.row(0).equalizeDynamicAxis(),this.initRowsAndColumns(),this.initGroups()}},{key:"initGroups",value:function GridLayout_initGroups_(){var e=this.config.groups;if(e)for(var t in e){var n=this.getCellGroupFor(this.container.getSubmorphNamed(t)),r=e[t],i=r.resize,o=r.align,a=void 0===o?"topLeft":o,s=r.alignedProperty,l=void 0===s?"topLeft":s;void 0!=i&&(n.resize=i),n.align=a,n.alignedProperty=l}}},{key:"initRowsAndColumns",value:function GridLayout_initRowsAndColumns_(){var e=this.config,t=e.rows,n=void 0===t?[]:t,i=e.columns,o=void 0===i?[]:i,a=!0,s=!1,l=void 0;try{for(var u,c=r.arr.toTuples(n,2)[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var h=$(u.value,2),d=h[0],p=h[1];Object.assign(this.row(d),p)}}catch(e){s=!0,l=e}finally{try{!a&&c.return&&c.return()}finally{if(s)throw l}}var f=!0,y=!1,m=void 0;try{for(var g,v=r.arr.toTuples(o,2)[Symbol.iterator]();!(f=(g=v.next()).done);f=!0){var x=$(g.value,2);d=x[0],p=x[1];Object.assign(this.col(d),p)}}catch(e){y=!0,m=e}finally{try{!f&&v.return&&v.return()}finally{if(y)throw m}}}},{key:"compensateOrigin",get:function get(){return this.config.compensateOrigin}},{key:"compensateOrigin",set:function set(e){this.config.compensateOrigin=e,this.apply()}},{key:"fitToCell",get:function get(){return this.config.fitToCell}},{key:"fitToCell",set:function set(e){this.config.fitToCell=e,this.cellGroups.forEach(function(t){return t.resize=e}),this.apply()}},{key:"notInLayout",get:function get(){return r.arr.withoutAll(this.layoutableSubmorphs,this.cellGroups.map(function(e){return e.morph}))}},{key:"col",value:function GridLayout_col_(e){return this.grid.col(e)}},{key:"row",value:function GridLayout_row_(e){return this.grid.row(e)}},{key:"rowCount",get:function get(){return this.grid.col(0).items.length}},{key:"columnCount",get:function get(){return this.grid.row(0).items.length}},{key:"addGroup",value:function GridLayout_addGroup_(e){this.cellGroups.push(e)}},{key:"removeGroup",value:function GridLayout_removeGroup_(e){r.arr.remove(this.cellGroups,e)}},{key:"fitAxis",value:function GridLayout_fitAxis_(){var e,t,n=this;this.grid.dynamicHeight,this.grid.dynamicWidth;[this.grid.row(0)].concat(X(this.grid.row(0).axisAfter)).map(function(t){return t.prepareForResize(n.container.height),e=n.grid.totalStaticHeight,t}).forEach(function(t){t.fixed||(t.length=t.proportion*Math.max(0,n.container.height-e))}),[this.grid.col(0)].concat(X(this.grid.col(0).axisAfter)).map(function(e){return e.prepareForResize(n.container.width),t=n.grid.totalStaticWidth,e}).forEach(function(e){e.fixed||(e.length=e.proportion*Math.max(0,n.container.width-t))})}},{key:"apply",value:function GridLayout_apply_(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.active||(this.active=!0,lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(i.prototype),"apply",this).call(this,e),this.grid||this.initGrid(),this.fitAxis(),this.container.extent=t.pt(Math.max(this.grid.totalStaticWidth,this.container.width),Math.max(this.grid.totalStaticHeight,this.container.height)),this.fitAxis(),this.cellGroups.forEach(function(t){t&&t.apply(e)}),this.lastBoundsExtent=this.container.bounds().extent(),this.active=!1)}},{key:"submorphBoundsChanged",get:function get(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.cellGroups[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;if(o.morph&&!o.bounds().equals(o.morph.bounds()))return!0}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}return!1}},{key:"getCellGroupFor",value:function GridLayout_getCellGroupFor_(e){return e&&this.cellGroups.find(function(t){return t.morph==e})}},{key:"onSubmorphRemoved",value:function GridLayout_onSubmorphRemoved_(e){var t=this.getCellGroupFor(e);t&&(t.morph=null),lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(i.prototype),"onSubmorphRemoved",this).call(this,e)}},{key:"inspect",value:function GridLayout_inspect_(e){return new T.GridLayoutHalo(this.container,e)}},{key:"ensureGrid",value:function GridLayout_ensureGrid_(e){var t=this,n=e.grid,i=e.rowCount,o=e.columnCount;return n=n||[[]],i=i||n.length,o=o||r.arr.max(n.map(function(e){return e.length})),n.length<i&&(n=n.concat(r.arr.withN(i-n.length,[]))),n=n.map(function(e){return e.length<o&&(e=e.concat(r.arr.withN(o-e.length,null))),e.map(function(e){return e&&e.isMorph?(e.owner!=t.container&&t.container.addMorph(e),e):e&&t.container.getSubmorphNamed(e)||e})})}},{key:"autoAssign",value:function GridLayout_autoAssign_(e){var t=this;e.forEach(function(e){var n,r=1/0;t.cellGroups.forEach(function(t){t.morph||t.cells.forEach(function(i){var o=i.position.dist(e.position);o<r&&(n=t,r=o)})}),n&&(n.morph=e)})}}],void 0,n,void 0,{start:44332,end:49819})}(br),Ir=function(e){var n=_classRecorder,i=n.hasOwnProperty("StyleSheet")&&"function"==typeof n.StyleSheet?n.StyleSheet:n.StyleSheet=function StyleSheet(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(i,e,[{key:Symbol.for("lively-instance-initialize"),value:function StyleSheet_initialize_(e,t){for(var n in r.obj.isObject(e)&&!t&&(t=e,e=null),this.rules=t,t)t[n]=this.unwrapFoldedProps(t[n]);this.name=e}},{key:"copy",value:function StyleSheet_copy_(){var e={};for(var t in this.rules)e[t]=Object.assign({},this.rules[t]);return new Ir(this.name,e)}},{key:"__only_serialize__",get:function get(){return["rules","context"]}},{key:"context",set:function set(e){this._context=e}},{key:"context",get:function get(){return this._context}},{key:"unwrapFoldedProps",value:function StyleSheet_unwrapFoldedProps_(e){return["borderRadius","borderWidth","borderColor","borderStyle"].forEach(function(t){var n;t in e&&((n=e[t])||(n=0),e[t]=4==r.arr.intersect(r.obj.keys(n),["top","left","bottom","right"]).length?n:{top:n,bottom:n,right:n,left:n,valueOf:function valueOf(){return n}})}),e}},{key:"removeRule",value:function StyleSheet_removeRule_(e){delete this.rules[e],this.context.requestStyling()}},{key:"setRule",value:function StyleSheet_setRule_(e,t){this.rules[e]=this.unwrapFoldedProps(t),this.context.requestStyling()}},{key:"toggleRule",value:function StyleSheet_toggleRule_(e){this.rules[e]._deactivated=!this.rules[e]._deactivated,this.context.requestStyling()}},{key:"applicableRules",value:function StyleSheet_applicableRules_(){var e={};for(var t in this.rules)e[t]=[this,t];return e}},{key:"applyRule",value:function StyleSheet_applyRule_(e,n){var i={};if(!(e=this.rules[e])._deactivated){if("layout"in(i=r.obj.dissoc(e,["_deactivated"]))){var o=i.layout.copy();o.container=n,i.layout=o}"dropShadow"in i&&(i.dropShadow=new N(i.dropShadow),i.dropShadow.morph=n),"padding"in i&&(i.padding=i.padding.isRect?i.padding:t.rect(i.padding,i.padding));var a=r.obj.select(n,r.obj.keys(e));return Object.assign(n,i),a}}}],void 0,n,void 0,{start:152,end:2310})}(void 0),Dr=function(e){var n=_classRecorder,o=n.hasOwnProperty("InputLine")&&"function"==typeof n.InputLine?n.InputLine:n.InputLine=function InputLine(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(o,e,[{key:Symbol.for("lively-instance-initialize"),value:function InputLine_initialize_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e),i.connect(this,"textChange",this,"onInputChanged"),i.connect(this,"selectionChange",this,"fixCursor"),this.updatePlaceholder()}},{key:"onChange",value:function InputLine_onChange_(e){return["extent","fontSize","padding","fontFamily","position","selection"].includes(e.prop)&&this.updatePlaceholder(),lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"onChange",this).call(this,e)}},{key:"isInputLine",get:function get(){return!0}},{key:"allowDuplicatesInHistory",get:function get(){return!1}},{key:"resetHistory",value:function InputLine_resetHistory_(){this.inputHistory={items:[],max:50,index:0}}},{key:"inputHistory",get:function get(){return this._inputHistory?this._inputHistory:this._inputHistory=this.historyId?this.constructor.getHistory(this.historyId):{items:[],max:30,index:0}}},{key:"inputHistory",set:function set(e){this._inputHistory=e,this.historyId&&this.constructor.setHistory(this.historyId,this._inputHistory)}},{key:"clear",value:function InputLine_clear_(){this.input=""}},{key:"focus",value:function InputLine_focus_(){return this.fixCursor(),lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"focus",this).call(this)}},{key:"fitToLineHeight",value:function InputLine_fitToLineHeight_(){this.height=this.defaultLineHeight+this.padding.top()+this.padding.bottom()}},{key:"updatePlaceholder",value:function InputLine_updatePlaceholder_(){var e=this.getSubmorphNamed("placeholder");if(e)if(this.input.length)e.visible=!1;else{var t=this.textBounds();e.fontSize=this.fontSize,e.leftCenter=this.label.length?t.rightCenter().addXY(0,this.borderWidth):t.leftCenter().withX(0),e.visible=!0,e.height=this.height,e.padding=this.padding,e.defaultTextStyle=this.defaultTextStyle,e.lineHeight=this.height+"px"}}},{key:"fixCursor",value:function InputLine_fixCursor_(){this.label&&(this.positionToIndex(this.selection.lead)<this.label.length&&(this.selection.lead=this.indexToPosition(this.label.length)),this.positionToIndex(this.selection.anchor)<this.label.length&&(this.selection.anchor=this.indexToPosition(this.label.length)))}},{key:"acceptInput",value:function InputLine_acceptInput_(){var e=this.input;return this.onInput(e),e}},{key:"onInput",value:function InputLine_onInput_(e){this.input.length>0&&this.addInputToHistory(this.input),this.clearOnInput&&this.clear(),i.signal(this,"inputAccepted",e)}},{key:"onInputChanged",value:function InputLine_onInputChanged_(e){i.signal(this,"inputChanged",e),this.updatePlaceholder()}},{key:"deleteText",value:function InputLine_deleteText_(e){if(!(e=e.isRange?e:new En(e)).isEmpty())return e=e.subtract({start:{row:0,column:0},end:{row:0,column:this.label.length}})[0],lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"deleteText",this).call(this,e)}},{key:"addInputToHistory",value:function InputLine_addInputToHistory_(e){var t=this.inputHistory,n=t.items;if(r.arr.last(n)!==e){if(n.push(e),n.length>t.max&&(t.items=n=n.slice(-t.max)),t.index=n.length-1,!this.allowDuplicatesInHistory)for(var i=t.items.length-1;i--;)t.items[i]===e&&(t.items.splice(i,1),t.index--);this.historyId&&this.constructor.addHistoryToLocalStorage(this.historyId,t)}}},{key:"browseHistory",value:function(){var e=H(regeneratorRuntime.mark(function _callee(){var e,t,n,r;return regeneratorRuntime.wrap(function _callee$(i){for(;;)switch(i.prev=i.next){case 0:return e=this.inputHistory.items.map(function(e,t){return{isListItem:!0,string:e,value:t}}).reverse(),i.next=3,this.world().filterableListPrompt("Choose item:",e,{commands:[this.histEditCommandForHistBrowse()]});case 3:t=i.sent,n=$(t.selected,1),"number"==typeof(r=n[0])&&this.setAndShowHistItem(r),this.focus();case 8:case"end":return i.stop()}},_callee,this)}));return function InputLine_browseHistory_(){return e.apply(this,arguments)}}()},{key:"histEditCommandForHistBrowse",value:function InputLine_histEditCommandForHistBrowse_(){var e,t=this;return{name:"edit history "+this.historyId,exec:(e=H(regeneratorRuntime.mark(function _callee2(e){var n,r,i,o;return regeneratorRuntime.wrap(function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return n=t.inputHistory.items.slice().reverse(),a.next=3,e.world().editListPrompt("edit history "+t.historyId,n);case 3:if(r=a.sent,i=r.status,o=r.list,"canceled"!==i){a.next=8;break}return a.abrupt("return",!0);case 8:return n=n.filter(function(e){return e.isListItem?o.includes(e.value):o.includes(e)}),t.inputHistory=Object.assign({},t.inputHistory,{items:n}),e.get("list").items=n.map(function(e,t){return{isListItem:!0,string:e,value:t}}).reverse(),a.abrupt("return",!0);case 12:case"end":return a.stop()}},_callee2,t)})),function exec(t){return e.apply(this,arguments)})}}},{key:"setAndShowHistItem",value:function InputLine_setAndShowHistItem_(e){var t=this.inputHistory,n=t.items,i=n.length-1,o=e;r.num.between(o,0,i+1)?t.index=o:t.index=o=i,this.input!==n[o]&&void 0!==n[o]&&(this.input=n[o])}},{key:"showHistItem",value:function InputLine_showHistItem_(e){e=e||"next";var t=this.inputHistory,n=t.items,i=n.length-1,o=t.index;if(r.num.between(o,0,i+1)||(t.index=o=i),this.input===n[o]||void 0===n[o]){if("next"===e){if(o>i)return;o=++t.index}else{if(o<=0)return;o=--t.index}this.input=n[o]||""}else this.input=n[o]}},{key:"commands",get:function get(){var e,t=this;return[{name:"accept input",exec:function exec(){return t.acceptInput(),!0}},{name:"show previous input from history",exec:function exec(){return t.showHistItem("prev"),!0}},{name:"show next input from history",exec:function exec(){return t.showHistItem("next"),!0}},{name:"browse history",exec:function exec(){return t.browseHistory(),!0}},{name:"remove items from history",exec:(e=H(regeneratorRuntime.mark(function _callee3(e){var n,i,o,a;return regeneratorRuntime.wrap(function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:return n=e.inputHistory,i=n.items.map(function(e,t){return{isListItem:!0,string:e,value:t}}).reverse(),t.next=4,e.world().filterableListPrompt("Choose items to delete:",i,{multiSelect:!0});case 4:return o=t.sent,a=o.selected,r.arr.sort(a).reverse().forEach(function(e){e<n.index&&n.index--,n.items.splice(e,1)}),e.inputHistory=n,t.abrupt("return",!0);case 9:case"end":return t.stop()}},_callee3,t)})),function exec(t){return e.apply(this,arguments)})}].concat(lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"commands",this))}},{key:"keybindings",get:function get(){return lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"keybindings",this).concat([{keys:"Enter",command:"accept input"},{keys:{mac:"Meta-S",win:"Ctrl-S"},command:"accept input"},{keys:"Up|Ctrl-Up|Alt-P",command:"show previous input from history"},{keys:"Down|Ctrl-Down|Alt-N",command:"show next input from history"},{keys:"Alt-H",command:"browse history"},{keys:"Alt-Shift-H",command:"remove items from history"}])}},{key:"onFocus",value:function InputLine_onFocus_(e){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"onFocus",this).call(this,e),this.highlightWhenFocused&&this.animate({dropShadow:this.haloShadow,duration:200})}},{key:"onBlur",value:function InputLine_onBlur_(e){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"onBlur",this).call(this,e),this.highlightWhenFocused&&this.animate({dropShadow:!1,duration:200})}},{key:"htmlExport_transformNode",value:function InputLine_htmlExport_transformNode_(e){var t=e.ownerDocument.createElement("input"),n=e.querySelector(".newtext-text-layer.actual");return t.id=e.id,t.className=e.className,t.style=e.style.cssText,Object.assign(t.style,r.obj.select(n.style,["padding","font-family","font-weight","font-style","text-decoration","font-size","color"])),t.placeholder=this.placeholder,t.type="text",t.autocomplete=t.name=this.name.replace(/[\s"]/g,"-"),t}}],[{key:"getHistoryFromLocalSorage",value:function InputLine_getHistoryFromLocalSorage_(e){if("undefined"==typeof localStorage)return null;try{var t=localStorage.getItem("lively.morphic-inputline-"+e);return t?JSON.parse(t):null}catch(e){return null}}},{key:"addHistoryToLocalStorage",value:function InputLine_addHistoryToLocalStorage_(e,t){if("undefined"!=typeof localStorage)try{localStorage.setItem("lively.morphic-inputline-"+e,JSON.stringify(t))}catch(e){console.error(e)}}},{key:"histories",get:function get(){return this._histories||(this._histories=new Map),this._histories}},{key:"getHistory",value:function InputLine_getHistory_(e){var t=this.histories.get(e);return t||(t=this.getHistoryFromLocalSorage(e)||{items:[],max:50,index:0},this.histories.set(e,t),t)}},{key:"setHistory",value:function InputLine_setHistory_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{items:[],max:50,index:0};return this.histories.set(e,t),this.addHistoryToLocalStorage(e,t),t}},{key:"properties",get:function get(){return{fixedWidth:{defaultValue:!0},fixedHeight:{defaultValue:!0},extent:{defaultValue:t.pt(100,20)},padding:{defaultValue:t.Rectangle.inset(2,4)},clipMode:{defaultValue:"hidden"},lineWrapping:{defaultValue:!1},historyId:{defaultValue:null},clearOnInput:{defaultValue:!1},label:{after:["textAndAttributes","extent","padding","submorphs"],defaultValue:"",set:function set(e){this.setProperty("label",e),this.textString.startsWith(e)||(i.disconnect(this,"textChange",this,"onInputChanged"),this.textString=e+this.input,i.connect(this,"textChange",this,"onInputChanged"))}},input:{after:["label"],derived:!0,get:function get(){return this.textString.slice(this.label.length)},set:function set(e){this.textString=this.label+(e?String(e):""),this.updatePlaceholder()}},placeholder:{after:["submorphs","label","defaultTextStyle"],dervied:!0,get:function get(){var e=this.getSubmorphNamed("placeholder");return e?e.value:null},set:function set(e){var n=this.getSubmorphNamed("placeholder");e?n?(n.defaultTextStyle=Object.assign({},this.defaultTextStyle,{fontColor:t.Color.gray}),n.value=e):n=this.addMorph(dr.makeLabel(e,Object.assign({},this.defaultTextStyle,{name:"placeholder",reactsToPointer:!1,fontColor:t.Color.gray}))):n&&(n.remove(),n=null),this.updatePlaceholder()}}}}}],n,void 0,{start:334,end:13012})}(dr),Nr=function(e){var n=_classRecorder,o=n.hasOwnProperty("PasswordInputLine")&&"function"==typeof n.PasswordInputLine?n.PasswordInputLine:n.PasswordInputLine=function PasswordInputLine(e){e&&e[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lively.classes.runtime.initializeClass(o,e,[{key:Symbol.for("lively-instance-initialize"),value:function PasswordInputLine_initialize_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),Symbol.for("lively-instance-initialize"),this).call(this,e),this.onLoad()}},{key:"bounds",value:function PasswordInputLine_bounds_(){return lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"bounds",this).call(this)}},{key:"onLoad",value:function PasswordInputLine_onLoad_(){var e=this;this.ensureInputNode().then(function(t){e.updateHtml(e.input),t.onkeydown=function(t){return e.env.eventDispatcher.dispatchDOMEvent(t,e,"onKeyDown")},t.onkeyup=function(t){return e.env.eventDispatcher.dispatchDOMEvent(t,e,"onKeyUp")}})}},{key:"ensureInputNode",value:function PasswordInputLine_ensureInputNode_(){var e=this;return this.whenRendered().then(function(){return e.domNode})}},{key:"onKeyDown",value:function PasswordInputLine_onKeyDown_(e){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"onKeyDown",this).call(this,e),this.input!=this.lastInput&&this.onInputChanged(this.input),this.lastInput=this.input}},{key:"focus",value:function PasswordInputLine_focus_(){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"focus",this).call(this),this.domNode&&this.domNode.focus()}},{key:"onFocus",value:function PasswordInputLine_onFocus_(e){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"onFocus",this).call(this,e),this.animate({dropShadow:this.haloShadow,duration:200})}},{key:"onBlur",value:function PasswordInputLine_onBlur_(e){lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"onBlur",this).call(this,e),this.animate({dropShadow:null,duration:200})}},{key:"acceptInput",value:function PasswordInputLine_acceptInput_(){var e=this.input;return i.signal(this,"inputAccepted",e),e}},{key:"onInputChanged",value:function PasswordInputLine_onInputChanged_(e){i.signal(this,"inputChanged",e)}},{key:"updateHtml",value:function(){var e=H(regeneratorRuntime.mark(function _callee4(e){var n,r,i,o,a,s,l,u,c,h,d,p;return regeneratorRuntime.wrap(function _callee4$(f){for(;;)switch(f.prev=f.next){case 0:return n=this.fontSize,r=this.fontFamily,i=this.padding,o=this.placeholder,a=this.fill,s=void 0===a?t.Color.white:a,l=this.borderRadius,u=i.top(),c=i.right(),h=i.bottom(),d=i.left(),f.next=13,this.ensureInputNode();case 13:(p=f.sent).setAttribute("type","password"),p.setAttribute("placeholder",o),p.setAttribute("value",e),Object.assign(p.style,{height:"calc(100% - "+u+"px - "+h+"px)",width:"calc(100% - "+d+"px - "+c+"px)","border-width":0,outline:"none","border-radius":l.valueOf()+"px",background:s.toString(),padding:u+"px "+c+"px "+h+"px "+d+"px","font-size":n+"px","font-family":""+r});case 18:case"end":return f.stop()}},_callee4,this)}));return function PasswordInputLine_updateHtml_(t){return e.apply(this,arguments)}}()},{key:"commands",get:function get(){var e=this;return[{name:"accept input",exec:function exec(){return e.acceptInput(),!0}}].concat(lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"commands",this))}},{key:"keybindings",get:function get(){return lively.classes.runtime.initializeClass._get(Object.getPrototypeOf(o.prototype),"keybindings",this).concat([{keys:"Enter",command:"accept input"},{keys:{mac:"Meta-S",win:"Ctrl-S"},command:"accept input"}])}},{key:"htmlExport_transformNode",value:function PasswordInputLine_htmlExport_transformNode_(e){var t=e.ownerDocument,n=e.querySelector("input"),i=t.createElement("input");return i.id=e.id,i.className=e.className,i.placeholder=this.placeholder,i.style=e.style.cssText,Object.assign(i.style,r.obj.select(n.style,["padding","font-family","font-weight","font-style","text-decoration","font-size","color"])),i.type="password",i.autocomplete=i.name=this.name.replace(/[\s"]/g,"-"),i}}],[{key:"properties",get:function get(){return{extent:{defaultValue:t.pt(100,20)},html:{derived:!0,initialize:function initialize(){},get:function get(){return""},set:function set(e){}},haloShadow:{readOnly:!0,get:function get(){return{blur:10,color:t.Color.rgb(52,152,219),distance:0,rotation:45}}},domNodeTagName:{readOnly:!0,get:function get(){return"input"}},domNodeStyle:{readOnly:!0,get:function get(){return"background: grey"}},input:{derived:!0,after:["domNode"],get:function get(){return this.domNode&&this.domNode.value||""},set:function set(e){this.domNode.value=e,this.updateHtml(this.input)}},placeholder:{after:["domNode"],set:function set(e){this.setProperty("placeholder",e),this.updateHtml(this.input)}},fontSize:{defaultValue:12,after:["input"],set:function set(e){this.setProperty("fontSize",e),this.updateHtml(this.input)}},fontFamily:{defaultValue:"sans-serif",after:["input"],set:function set(e){this.setProperty("fontFamily",e),this.updateHtml(this.input)}},padding:{defaultValue:t.Rectangle.inset(2),after:["input"],set:function set(e){this.setProperty("padding",e),this.updateHtml(this.input)}}}}}],n,void 0,{start:13135,end:18564})}(vr),Fr=function(){var t=H(regeneratorRuntime.mark(function _callee(t){var n,r;return regeneratorRuntime.wrap(function _callee$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,System.import("lively.ide/js/inspector.js");case 2:return n=i.sent,r=n.inspect,e.inspect=r,i.abrupt("return",r(t));case 6:case"end":return i.stop()}},_callee,this)}));return function lazyInspect(e){return t.apply(this,arguments)}}();function morph$2(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{restore:!1},n=$t;if(e.type)if("function"==typeof e.type)n=e.type;else if("string"==typeof e.type)switch(e.type.toLowerCase()){case"world":n=Ln;break;case"hand":n=Rn;break;case"image":n=Yt;break;case"ellipse":n=Kt;break;case"triangle":n=Xt;break;case"path":n=Qt;break;case"text":n=dr;break;case"input":n=Dr;break;case"label":n=Gn;break;case"list":n=L.List;break;case"polygon":n=Zt;break;case"line":n=en;break;case"html":n=vr;break;case"dropdownlist":n=L.DropDownList;break;case"button":n=C.Button;break;case"checkbox":n=A.CheckBox;break;case"labeledcheckbox":n=A.LabeledCheckBox}return t.restore?new n(U({},Symbol.for("lively-instance-restorer"),!0)).initFromJSON(e):new n(e)}e.inspect=Fr,e.InputLine=Dr,e.PasswordInputLine=Nr,e.morph=morph$2,e.config=z,e.StyleSheet=Ir,e.ShadowObject=N,e.addOrChangeCSSDeclaration=addOrChangeCSSDeclaration,e.addOrChangeLinkedCSS=addOrChangeLinkedCSS,e.easings=J,e.Icon=Un,e.loadMorphFromSnapshot=loadMorphFromSnapshot$$1,e.newMorphId=newMorphId$$1,e.Morph=$t,e.Ellipse=Kt,e.Triangle=Xt,e.Image=Yt,e.PathPoint=Jt,e.Path=Qt,e.Polygon=Zt,e.LineMorph=en,e.World=Ln,e.Hand=Rn,e.Text=dr,e.Label=Gn,e.Anchor=Vn,e.HTMLMorph=vr,e.IFrameMorph=xr,e.MorphicEnv=Ue,e.CustomLayout=wr,e.FillLayout=_r,e.VerticalLayout=Sr,e.HorizontalLayout=Mr,e.ProportionalLayout=Cr,e.TilingLayout=Pr,e.CenteredTilingLayout=Tr,e.CellGroup=Ar,e.LayoutColumn=Rr,e.LayoutRow=Er,e.LayoutCell=zr,e.GridLayout=Or,e.TooltipViewer=tn,e.Tooltip=nn,e.MorphicDB=mt}(this.lively.morphic=this.lively.morphic||{},lively.graphics,bowser,lively.lang,lively.bindings,virtualDom,lively.morphic,0,0,0,0,lively.notifications,{},lively.serializer2,lively.resources,lively.storage,lively.modules,{},{},{},{},{},{},0,{},kldIntersections,{},0,{},{},{}),"undefined"!=typeof module&&"function"==typeof require&&(module.exports=n.lively.modules)}();