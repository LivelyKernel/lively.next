!function(e){"use strict";function t(e,t,r,i){var o=Object.create((t||n).prototype),a=new p(i||[]);return o._invoke=c(e,r,a),o}function r(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function n(){}function i(){}function o(){}function a(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function s(e){this.arg=e}function u(e){function t(t,r){var o=e[t](r),a=o.value;return a instanceof s?Promise.resolve(a.arg).then(n,i):Promise.resolve(a).then(function(e){return o.value=e,o})}"object"==typeof process&&process.domain&&(t=process.domain.bind(t));var r,n=t.bind(e,"next"),i=t.bind(e,"throw");t.bind(e,"return");this._invoke=function(e,n){function i(){return t(e,n)}return r=r?r.then(i,i):new Promise(function(e){e(i())})}}function c(e,t,n){var i=_;return function(o,a){if(i===x)throw new Error("Generator is already running");if(i===k){if("throw"===o)throw a;return h()}for(;;){var s=n.delegate;if(s){if("return"===o||"throw"===o&&s.iterator[o]===m){n.delegate=null;var u=s.iterator.return;if(u&&"throw"===(c=r(u,s.iterator,a)).type){o="throw",a=c.arg;continue}if("return"===o)continue}if("throw"===(c=r(s.iterator[o],s.iterator,a)).type){n.delegate=null,o="throw",a=c.arg;continue}if(o="next",a=m,!(l=c.arg).done)return i=w,l;n[s.resultName]=l.value,n.next=s.nextLoc,n.delegate=null}if("next"===o)n._sent=a,n.sent=i===w?a:m;else if("throw"===o){if(i===_)throw i=k,a;n.dispatchException(a)&&(o="next",a=m)}else"return"===o&&n.abrupt("return",a);i=x;var c=r(e,t,n);if("normal"===c.type){i=n.done?k:w;var l={value:c.arg,done:n.done};if(c.arg!==E)return l;n.delegate&&"next"===o&&(a=m)}else"throw"===c.type&&(i=k,o="throw",a=c.arg)}}}function l(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function f(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function p(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(l,this),this.reset(!0)}function d(e){if(e){var t=e[y];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(v.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=m,t.done=!0,t};return n.next=n}}return{next:h}}function h(){return{value:m,done:!0}}var m,v=Object.prototype.hasOwnProperty,y="function"==typeof Symbol&&Symbol.iterator||"@@iterator",g="object"==typeof module,b=e.regeneratorRuntime;if(b)g&&(module.exports=b);else{(b=e.regeneratorRuntime=g?module.exports:{}).wrap=t;var _="suspendedStart",w="suspendedYield",x="executing",k="completed",E={},S=o.prototype=n.prototype;i.prototype=S.constructor=o,o.constructor=i,i.displayName="GeneratorFunction",b.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===i||"GeneratorFunction"===(t.displayName||t.name))},b.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,o):e.__proto__=o,e.prototype=Object.create(S),e},b.awrap=function(e){return new s(e)},a(u.prototype),b.async=function(e,r,n,i){var o=new u(t(e,r,n,i));return b.isGeneratorFunction(r)?o:o.next().then(function(e){return e.done?e.value:o.next()})},a(S),S[y]=function(){return this},S.toString=function(){return"[object Generator]"},b.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},b.values=d,p.prototype={constructor:p,reset:function(e){if(this.prev=0,this.next=0,this.sent=m,this.done=!1,this.delegate=null,this.tryEntries.forEach(f),!e)for(var t in this)"t"===t.charAt(0)&&v.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=m)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,n){return o.type="throw",o.arg=e,r.next=t,!!n}if(this.done)throw e;for(var r=this,n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var a=v.call(i,"catchLoc"),s=v.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&v.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?this.next=i.finallyLoc:this.complete(o),E},complete:function(e,t){if("throw"===e.type)throw e.arg;"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=e.arg,this.next="end"):"normal"===e.type&&t&&(this.next=t)},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),f(r),E}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;f(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:d(e),resultName:t,nextLoc:r},E}}}}("object"==typeof global?global:"object"==typeof window?window:"object"==typeof self?self:this),function(){var GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;void 0===GLOBAL.lively&&(GLOBAL.lively={}),function(){this.lively=this.lively||{},function(exports){"use strict";function Empty(){return function(){}}function K(){return function(e){return e}}function Null(){return function(){return null}}function False(){return function(){return!1}}function True(){return function(){return!0}}function notYetImplemented(){return function(){throw new Error("Not yet implemented")}}function all(e){var t=[];for(var r in e)e.__lookupGetter__(r)||"function"!=typeof e[r]||t.push(r);return t}function own(e){var t=[];for(var r in e)!e.__lookupGetter__(r)&&e.hasOwnProperty(r)&&"function"==typeof e[r]&&t.push(r);return t}function argumentNames(e){if(e.superclass)return[];var t=e.toString(),r="",n=t.match(/(?:\(([^\)]*)\)|([^\(\)-+!]+))\s*=>/);if(n)r=n[1]||n[2]||"";else{var i=t.match(/^[\s\(]*function[^(]*\(([^)]*)\)/);i&&i[1]&&(r=i[1])}return r.replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",").map(function(e){return e.trim()}).filter(function(e){return!!e})}function qualifiedMethodName(e){var t="";return e.declaredClass?t+=e.declaredClass+">>":e.declaredObject&&(t+=e.declaredObject+"."),t+(e.methodName||e.displayName||e.name||"anonymous")}function extractBody(e){for(var t=String(e).replace(/^function[^\{]+\{\s*/,"").replace(/\}$/,"").trim(),r=t.split(/\n|\r/),n=void 0,i=0;i<r.length;i++){var o=r[i].match(/^(\s+)[^\s]/);o&&(void 0===n||o[1].length<n.length)&&(n=o[1])}return n?t.replace(new RegExp("^"+n,"gm"),""):t}function timeToRun(e){var t=Date.now();return e(),Date.now()-t}function timeToRunN$1(e,t){for(var r=Date.now(),n=0;n<t;n++)e();return(Date.now()-r)/t}function delay(e,t){var r=Array.prototype.slice.call(arguments),n=r.shift(),t=1e3*r.shift();return setTimeout(function(){return n.apply(n,r)},t)}function throttle(e,t){var r,n,i,o,a,s,u=debounce(t,function(){a=o=!1});return function(){r=this,n=arguments;return i||(i=setTimeout(function(){i=null,a&&e.apply(r,n),u()},t)),o?a=!0:s=e.apply(r,n),u(),o=!0,s}}function debounce(e,t,r){var n;return function(){var i=this,o=arguments;r&&!n&&t.apply(i,o),clearTimeout(n),n=setTimeout(function(){n=null,r||t.apply(i,o)},e)}}function throttleNamed(e,t,r){var n=_throttledByName;return n[e]?n[e]:n[e]=throttle(function(){debounceNamed(e,t,function(){delete n[e]})(),r.apply(this,arguments)},t)}function debounceNamed(e,t,r,n){var i=_debouncedByName;return i[e]?i[e]:i[e]=debounce(t,function(){delete i[e],r.apply(this,arguments)},n)}function createQueue(e,t){var r=_queues,n=r[e]||(r[e]={_workerActive:!1,worker:t,tasks:[],drain:null,push:function(e){n.tasks.push(e),n.activateWorker()},pushAll:function(e){e.forEach(function(e){n.tasks.push(e)}),n.activateWorker()},pushNoActivate:function(e){n.tasks.push(e)},handleError:function(e){e&&console.error("Error in queue: "+e)},activateWorker:function(){function t(e){n.handleError(e),n.activateWorker()}var i=n.tasks,o=n._workerActive;if(0===i.length)o&&(n._workerActive=!1,"function"==typeof n.drain&&n.drain()),delete r[e];else{o||(n._workerActive=!0);try{n.worker(i.shift(),t)}catch(e){t(e)}}}});return n}function workerWithCallbackQueue(e,t,r){function n(){c&&clearTimeout(c),s=!0,delete o[e]}function i(t){s||(n(),a.callbacks.forEach(function(r){try{r.apply(null,t)}catch(t){console.error("Error when invoking callbacks in queueUntil ["+e+"]:\n"+String(t.stack||t))}}))}var o=_queueUntilCallbacks,a=o[e];if(!!a)return a;var s=!1,u=!1;if(r)var c=setTimeout(function(){s||i([new Error("timeout")])},r);return a=o[e]={callbacks:[],cancel:function(){u=!0,n()},whenDone:function(e){return a.callbacks.push(e),a}},setTimeout(function(){if(!u)try{t(function(){i(arguments)})}catch(e){i([e])}},0),a}function _composeAsyncDefaultEndCallback(e,t){e&&console.error("lively.lang.composeAsync error",e)}function composeAsync(){var e,t,r=Array.prototype.slice,n=r.call(arguments),i=_composeAsyncDefaultEndCallback,o=i,a=new Promise(function(r,n){e=r,t=n});return n.reverse().reduce(function(e,s,u){var c=!1;return function(){function l(){c=!0;var n=r.call(arguments),i=n.shift();i?(o(i),t(i)):e.apply(null,n)}var f=r.call(arguments);if(o===i&&u===n.length-1){for(;f.length&&"function"!=typeof f[f.length-1];)f.pop();"function"==typeof f[f.length-1]&&(o=f.pop())}if("function"==typeof s)try{var p=s.apply(this,f.concat([l]));p&&"function"==typeof p.then&&"function"==typeof p.catch&&p.then(function(e){return l(null,e)}).catch(function(e){return l(e)})}catch(e){console.error("composeAsync: ",e.stack||e),c||(o(e),t(e))}else if(s&&"function"==typeof s.then&&"function"==typeof s.catch)s.then(function(e){l(null,e)}).catch(function(e){l(e)});else{var d=new Error("Invalid argument to composeAsync: "+s);o(d),t(d)}return a}},function(){var t=r.call(arguments);o.apply(null,[null].concat(t)),e(t[0])})}function compose(){return Array.prototype.slice.call(arguments).reverse().reduce(function(e,t){return function(){return e(t.apply(this,arguments))}},function(e){return e})}function flip(e){return function(){var t=Array.prototype.slice.call(arguments),r=[t[1],t[0]].concat(t.slice(2));return e.apply(null,r)}}function withNull(e){return e=e||function(){},function(){var t=lively.lang.arr.from(arguments);e.apply(null,[null].concat(t))}}function waitFor(e,t,r){var n=Date.now(),i=50;r||(r=t,t=e,e=void 0),function o(){if(t())return r();if(e){var a=Date.now()-n,s=e-a;if(s<=0)return r(new Error("timeout"));s<i&&(i=s)}setTimeout(o,i)}()}function waitForAll(e,t,r){function n(e,t,n,a){if(o.length){var s=null,u=o.indexOf(e);u>-1&&o.splice(u,1),n?(o.length=0,s=new Error("in waitForAll at"+("number"==typeof t?" "+t:"")+": \n"+(n.stack||String(n)))):a&&(i[t]=a),o.length||setTimeout(function(){r(s,i)},0)}}r||(r=t,t=e,e=null),e=e||{};var i=t.map(function(){return null});if(t.length){var o=Array.prototype.slice.call(t);t.forEach(function(e,t){try{e(function(){var r=Array.prototype.slice.call(arguments),i=r.shift();n(e,t,i,r)})}catch(r){n(e,t,r,null)}}),e.timeout&&setTimeout(function(){if(o.length){var e=i.map(function(e,t){return null===e&&t}).filter(function(e){return"number"==typeof e}).join(", ");n(null,null,new Error("waitForAll timed out, functions at "+e+" not done"),null)}},e.timeout)}else r(null,i)}function curry(e,t,r,n){function i(){return e.apply(this,o.concat(Array.prototype.slice.call(arguments)))}if(arguments.length<=1)return arguments[0];var o=Array.prototype.slice.call(arguments),e=o.shift();return i.isWrapper=!0,i.originalFunction=e,i}function wrap(e,t){var r=e,n=function(){var e=Array.prototype.slice.call(arguments),n=t.isWrapper?e:[r.bind(this)].concat(e);return t.apply(this,n)};return n.isWrapper=!0,n.originalFunction=r,n}function getOriginal(e){for(;e.originalFunction;)e=e.originalFunction;return e}function wrapperChain(e){var t=[];do{t.push(e),e=e.originalFunction}while(e);return t}function replaceMethodForOneCall(e,t,r){r.originalFunction=e[t];var n=e.hasOwnProperty(t);return e[t]=function(){return n?e[t]=r.originalFunction:delete e[t],r.apply(this,arguments)},e}function once(e){if(e){if("function"!=typeof e)throw new Error("once() expecting a function");var t,r=!1;return function(){return r?t:(r=!0,t=e.apply(this,arguments))}}}function either(){var e=!1;return Array.prototype.slice.call(arguments).map(function(t){return function(){if(!e)return e=!0,t.apply(this,arguments)}})}function eitherNamed(e,t){var r=Array.prototype.slice.call(arguments),n=_eitherNameRegistry,e=r.shift(),i=n[e]||(n[e]={wasCalled:!1,callsLeft:0});return i.callsLeft++,function(){if(--i.callsLeft<=0&&delete n[e],!i.wasCalled)return i.wasCalled=!0,t.apply(this,arguments)}}function evalJS(src){return eval(src)}function fromString(e){return evalJS("("+e.toString()+");")}function asScript(e,t){return Closure.fromFunction(e,t).recreateFunc()}function asScriptOf(e,t,r,n){var i=r||e.name;if(!i)throw Error("Function that wants to be a script needs a name: "+this);var o=Object.getPrototypeOf(t),a={this:t};if(n&&(a=merge([a,n])),o&&o[i]){var s=function(){try{return Object.getPrototypeOf(t)[i].apply(t,arguments)}catch(e){return void 0!==("undefined"==typeof $world?"undefined":_typeof($world))?$world.logError(e,"Error in $super call"):console.error("Error in $super call: "+e+"\n"+e.stack),null}};a.$super=Closure.fromFunction(s,{obj:t,name:i}).recreateFunc()}return addToObject(asScript(e,a),t,i)}function addToObject(e,t,r){e.displayName=r;var n=t.attributeConnections?t.attributeConnections.filter(function(e){return"update"===e.getSourceAttrName()}):[];return n&&n.forEach(function(e){e.disconnect()}),t[r]=e,(void 0===t?"undefined":_typeof(t))&&(e.declaredObject=safeToString(t)),"undefined"!=typeof lively&&t&&lively.Tracing&&lively.Tracing.stackTracingEnabled&&lively.Tracing.instrumentMethod(t,r,{declaredObject:safeToString(t)}),n&&n.forEach(function(e){e.connect()}),e}function binds(e,t){return Closure.fromFunction(e,t||{}).recreateFunc()}function setLocalVarValue(e,t,r){e.hasLivelyClosure&&(e.livelyClosure.funcProperties[t]=r)}function getVarMapping(e){return e.hasLivelyClosure?e.livelyClosure.varMapping:e.isWrapper?e.originalFunction.varMapping:e.varMapping?e.varMapping:{}}function setProperty(e,t,r){e[t]=r,e.hasLivelyClosure&&(e.livelyClosure.funcProperties[t]=r)}function functionNames(e){for(var t=[],r=e.prototype;r;)t=Object.keys(r).reduce(function(e,t){return"function"==typeof r[t]&&-1===e.indexOf(t)&&e.push(t),e},t),r=Object.getPrototypeOf(r);return t}function localFunctionNames(e){return Object.keys(e.prototype).filter(function(t){return"function"==typeof e.prototype[t]})}function logErrors(e,t){var r=function(r){var n=Array.prototype.slice.call(arguments);n.shift();try{return r.apply(e,n)}catch(r){if("undefined"!=typeof lively&&lively.morphic&&lively.morphic.World&&lively.morphic.World.current())throw lively.morphic.World.current().logError(r),r;throw t?console.warn("ERROR: %s.%s(%s): err: %s %s",e,t,n,r,r.stack||""):console.warn("ERROR: %s %s",r,r.stack||""),r}};r.methodName="$logErrorsAdvice";var n=wrap(e,r);return n.originalFunction=e,n.methodName="$logErrorsWrapper",n}function logCompletion(e,t){var r=function(r){var n=Array.prototype.slice.call(arguments);n.shift();try{var i=r.apply(e,n)}catch(e){throw console.warn("failed to load "+t+": "+e),"undefined"!=typeof lively&&lively.lang.Execution&&lively.lang.Execution.showStack(),e}return console.log("completed "+t),i};r.methodName="$logCompletionAdvice::"+t;var n=wrap(e,r);return n.methodName="$logCompletionWrapper::"+t,n.originalFunction=e,n}function logCalls(e,t){var r=e,n=function(n){var o=Array.prototype.slice.call(arguments);return o.shift(),i=n.apply(e,o),t?console.warn("%s(%s) -> %s",qualifiedMethodName(r),o,i):console.log("%s(%s) -> %s",qualifiedMethodName(r),o,i),i};n.methodName="$logCallsAdvice::"+qualifiedMethodName(e);var i=wrap(e,n);return i.originalFunction=e,i.methodName="$logCallsWrapper::"+qualifiedMethodName(e),i}function traceCalls(e,t){return wrap(e,function(r){var n=Array.prototype.slice.call(arguments);n.shift(),t.push(n);var i=r.apply(e,n);return t.pop(),i})}function webkitStack(){try{throw new Error}catch(e){return String(e.stack).split(/\n/).slice(2).map(function(e){return e.replace(/^\s*at\s*([^\s]+).*/,"$1")}).join("\n")}}function range(e,t,r){r=r||0;var n=[];if(e<=t){r<=0&&(r=-r||1);for(i=e;i<=t;i+=r)n.push(i)}else{r>=0&&(r=-r||-1);for(var i=e;i>=t;i+=r)n.push(i)}return n}function withN(e,t){for(var r=new Array(e);e>0;)r[--e]=t;return r}function genN(e,t){for(var r=new Array(e);e>0;)r[--e]=t(e);return r}function filter(e,t,r){return e.filter(t,r)}function findAndGet(e,t){var r;return e.find(function(e,n){return r=t(e,n)}),r}function filterByKey(e,t){return e.filter(function(e){return!!e[t]})}function grep(e,t,r){return"string"==typeof t&&(t=new RegExp(t,"i")),e.filter(t.test.bind(t))}function mask(e,t){return e.filter(function(e,r){return!!t[r]})}function reject(e,t,r){return e.filter(function(e,n){return!t.call(r,e,n)})}function rejectByKey(e,t){return e.filter(function(e){return!e[t]})}function without(e,t){return e.filter(function(e){return e!==t})}function withoutAll(e,t){return e.filter(function(e){return-1===t.indexOf(e)})}function uniq(e,t){if(!e.length)return e;var r=[e[0]];if(t)for(var n=1;n<e.length;n++){var i=e[n];i!==r[r.length]&&r.push(i)}else for(var o=1;o<e.length;o++){var a=e[o];-1===r.indexOf(a)&&r.push(a)}return r}function uniqBy(e,t,r){for(var n=e.slice(),i=n.length;i--;)for(var o=e[i],a=i+1;a<n.length;a++)t.call(r,o,n[a])&&n.splice(a--,1);return n}function uniqByKey(e,t){for(var r={},n=[],i=0;i<e.length;i++){var o=e[i];r[o[t]]||(r[o[t]]=!0,n.push(o))}return n}function compact(e){return e.filter(Boolean)}function mutableCompact(e){for(var t=0,r=0,n=e.length;t<n;)e.hasOwnProperty(t)&&(e[r++]=e[t]),t++;for(;r++<n;)e.pop();return e}function forEach$1(e,t,r){return e.forEach(t,r)}function zip(){var e=Array.from(arguments),t=e.shift(),r="function"==typeof last(e)?e.pop():function(e){return e},n=[t].concat(e).map(function(e){return Array.from(e)});return t.map(function(e,t){return r(pluck(n,t),t)})}function flatten(e,t){if("number"==typeof t){if(t<=0)return e;t--}return e.reduce(function(e,r){return e.concat(Array.isArray(r)?flatten(r,t):[r])},[])}function flatmap(e,t,r){for(var n=[],i=0;i<e.length;i++)n.push.apply(n,t.call(r,e[i],i));return n}function interpose(e,t){return e.reduce(function(e,r){return e.length>0&&e.push(t),e.push(r),e},[])}function delimWith(e,t){return interpose(e,t)}function map$1(e,t,r){return e.map(t,r)}function invoke(e,t,r,n,i,o,a,s){return e.map(function(e){return e[t](r,n,i,o,a,s)})}function pluck(e,t){return e.map(function(e){return e[t]})}function reduce(e,t,r,n){return e.reduce(t,r,n)}function reduceRight(e,t,r,n){return e.reduceRight(t,r,n)}function some(e,t,r){return e.some(t,r)}function every(e,t,r){return e.every(t,r)}function equals$2(e,t){var r=e.length;if(!t||r!==t.length)return!1;for(var n=0;n<r;n++){if(e[n]&&t[n]&&e[n].equals&&t[n].equals){if(e[n].equals(t[n]))continue;return!1}if(e[n]!=t[n])return!1}return!0}function deepEquals(e,t){var r=e.length;if(!t||r!==t.length)return!1;for(var n=0;n<r;n++)if(!equals$1(e[n],t[n]))return!1;return!0}function isSorted(e,t){if(t){for(r=1;r<e.length;r++)if(e[r-1]<e[r])return!1}else for(var r=1;r<e.length;r++)if(e[r-1]>e[r])return!1;return!0}function sort(e,t){return e.sort(t)}function sortBy(e,t,r){return pluck(e.map(function(e,n){return{value:e,criteria:t.call(r,e,n)}}).sort(function(e,t){var r=e.criteria,n=t.criteria;return r<n?-1:r>n?1:0}),"value")}function sortByKey(e,t){return sortBy(e,function(e){return e[t]})}function reverse(e){return e.reverse()}function reversed(e){return e.slice().reverse()}function reMatches$1(e,t,r){return r=r||String,e.map(function(e){return r(e).match(t)})}function first(e){return e[0]}function last(e){return e[e.length-1]}function intersect(e,t){return uniq(e).filter(function(e){return t.indexOf(e)>-1})}function union(e,t){for(var r=e.slice(),n=0;n<t.length;n++){var i=t[n];-1===r.indexOf(i)&&r.push(i)}return r}function pushAt(e,t,r){e.splice(r,0,t)}function removeAt(e,t){e.splice(t,1)}function remove(e,t){var r=e.indexOf(t);return r>=0&&removeAt(e,r),t}function pushAll$1(e,t){return e.push.apply(e,t),e}function pushAllAt(e,t,r){e.splice.apply(e,[r,0].concat(t))}function pushIfNotIncluded(e,t){e.includes(t)||e.push(t)}function replaceAt(e,t,r){e.splice(r,1,t)}function clear(e){return e.length=0,e}function isSubset(e,t){for(var r=0;r<e.length;r++)if(!t.includes(e[r]))return!1;return!0}function doAndContinue(e,t,r,n){return r=r||Null,n=n||GLOBAL$1,t=t||function(e,t,r){t.call(n,e,r)},e.reduceRight(function(e,r,i){return function(){t.call(n,e,r,i)}},r)()}function nestedDelay(e,t,r,n,i,o){return n=n||function(){},e.clone().reverse().reduce(function(e,n,a){return function(){t.call(i||GLOBAL$1,n,a),o&&a%o!=0?e():e.delay(r)}},n)()}function forEachShowingProgress(){var e,t,r,n,i,o=Array.from(arguments),a=o.shift(),s=a.length,u=!1;if(1===o.length?(e=o[0].progressBar,t=o[0].iterator,r=o[0].labelFunction,n=o[0].whenDone,i=o[0].context):(e=o[0],t=o[1],r=o[2],n=o[3],i=o[4]),i||(i="undefined"!=typeof window?window:global),r||(r=function(e){return e}),!e){u=!0;var c=("undefined"!=typeof window?window:global).lively&&lively.morphic&&lively.morphic.World.current();e=c?c.addProgressBar():{setValue:function(e){},setLabel:function(){},remove:function(){}}}return e.setValue(0),a.reduceRight(function(n,o,a){return function(){try{e.setValue(a/s),r&&e.setLabel(r.call(i,o,a)),t.call(i,o,a)}catch(e){console.error("Error in forEachShowingProgress at %s (%s)\n%s\n%s",a,o,e,e.stack)}n.delay(0)}},function(){e.setValue(1),u&&function(){e.remove()}.delay(0),n&&n.call(i)})(),a}function swap(e,t,r){t<0&&(t=e.length+t),r<0&&(r=e.length+r);var n=e[t];return e[t]=e[r],e[r]=n,e}function rotate(e,t){return t=t||1,e.slice(t).concat(e.slice(0,t))}function groupBy(e,t,r){return Group.fromArray(e,t,r)}function groupByKey(e,t){return groupBy(e,function(e){return e[t]})}function partition(e,t,r){t=t||function(e){return e};var n=[],i=[];return e.forEach(function(e,o){(t.call(r,e,o)?n:i).push(e)}),[n,i]}function batchify(e,t,r){function n(e,i){if(!i.length)return[e,[]];var o=i[0],a=i.slice(1),s=e.concat([o]);if(t.call(r,s))return n(s,a);var u=n(e,a);return[u[0],[o].concat(u[1])]}function i(e,t){if(!t.length)return e;var r=n([],t);if(!r[0].length)throw new Error("Batchify constrained does not ensure consumption of at least one item per batch!");return i(e.concat([r[0]]),r[1])}return i([],e)}function toTuples(e,t){return t=t||1,range(0,Math.ceil(e.length/t)-1).map(function(r){return e.slice(r*t,r*t+t)},e)}function combinationsPick(e,t){for(var r=e.map(function(e,r){return e[t[r]]}),n=t.slice(),i=e.length;i--;i>=0){var o=e[i],a=n[i]+1;if(o[a]){n[i]=a;break}if(0===i){n=void 0;break}n[i]=0}return[r,n]}function combinations(e){for(var t=e.reduce(function(e,t){return e*t.length},1),r=e.map(function(e){return 0}),n=new Array(t),i=0;i<t;i++){var o=combinationsPick(e,r);n[i]=o[0],r=o[1]}return n}function take(e,t){return e.slice(0,t)}function drop(e,t){return e.slice(t)}function takeWhile(e,t,r){for(var n=0;n<e.length&&t.call(r,e[n],n);n++);return e.slice(0,n)}function dropWhile(e,t,r){for(var n=0;n<e.length&&t.call(r,e[n],n);n++);return e.slice(n)}function shuffle(e){for(var t=range(0,e.length-1),r=Array(e.length),n=0;n<e.length;n++)r[t.splice(Math.round(Math.random()*(t.length-1)),1)]=e[n];return r}function max(e,t,r){t=t||function(e){return e};var n;return e.reduce(function(e,i,o){var a=t.call(r,i,o);return"number"!=typeof a||a<=e?e:(n=i,a)},-1/0),n}function min(e,t,r){return t=t||function(e){return e},max(e,function(e,n){return-t.call(r,e,n)})}function sum(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}function count$1(e,t){return e.reduce(function(e,r){return r===t?e+1:e},0)}function size$1(e){return e.length}function histogram(e,t){if(void 0===t||"number"==typeof t){var r=t||Math.ceil(Math.log(e.length)/Math.log(2)+1),n=Math.ceil(Math.round(e.length/r));return range(0,r-1).map(function(t){return e.slice(t*n,(t+1)*n)})}if(t instanceof Array){var i=t;return e.reduce(function(e,t){if(t<i[1])return e[0].push(t),e;for(var r=1;r<i.length;r++)if(t>=i[r]&&(!i[r+1]||t<=i[r+1]))return e[r].push(t),e;throw new Error("Histogram creation: Cannot group data "+t+" into thresholds "+i)},range(1,i.length).map(function(){return[]}))}}function clone$1(e){return[].concat(e)}function toArray$3(e){return from(e)}function each(e,t,r){return e.forEach(t,r)}function all$1(e,t,r){return e.every(t,r)}function any(e,t,r){return e.some(t,r)}function collect(e,t,r){return e.map(t,r)}function findAll(e,t,r){return e.filter(t,r)}function inject(e,t,r,n){return n&&(r=r.bind(n)),e.reduce(r,t)}function mapAsyncSeries(e,t,r){function n(e,t){if(!o&&(e||t)){o=!0;try{r(e,i)}catch(e){console.error("Error in mapAsyncSeries - callback invocation error:\n"+(e.stack||e))}}}var i=[],o=!1;return e.reduceRight(function(e,r,a){if(!o)return function(o,s){if(o)return n(o);a>0&&i.push(s);try{t(r,a,once(e))}catch(e){n(e)}}},function(e,t){i.push(t),n(e,!0)})()}function mapAsync(e,t,r,n){function i(){for(;l<t.parallel&&c<e.length;)f[c++]()}function o(t,r){if(!(s.indexOf(t)>-1||(s.push(t),l--,u)))if(!r&&s.length<e.length)i();else{u=!0;try{n&&n(r,a)}catch(e){console.error("Error in mapAsync - main callback invocation error:\n"+(e.stack||e))}}}if("function"==typeof t&&(n=r,r=t,t=null),t=t||{},!e.length)return n&&n(null,[]);t.parallel||(t.parallel=1/0);var a=[],s=[],u=!1,c=0,l=0,f=e.map(function(e,t){return function(){l++;try{r(e,t,once(function(e,r){a[t]=e||r,o(t,e)}))}catch(e){o(t,e)}}});return i()}function print$1(e){if(e&&Array.isArray(e))return"["+e.map(print$1)+"]";if("string"!=typeof e)return String(e);var t=String(e);return t=t.replace(/\n/g,"\\n\\\n"),t=t.replace(/(")/g,"\\$1"),t='"'+t+'"'}function indent$1(e,t,r){if(!r||r<=0)return e;for(;r>0;)r--,e=t+e;return e}function isArray$$1(e){return Array.isArray(e)}function isElement(e){return e&&1==e.nodeType}function isFunction(e){return e instanceof Function}function isBoolean(e){return"boolean"==typeof e}function isString(e){return"string"==typeof e}function isNumber(e){return"number"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return e instanceof RegExp}function isObject(e){return"object"==(void 0===e?"undefined":_typeof(e))}function isPrimitive(e){if(!e)return!0;switch(void 0===e?"undefined":_typeof(e)){case"string":case"number":case"boolean":return!0}return!1}function isEmpty(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function equals$1(e,t){if(e===t)return!0;if(!e||!t)return e==t;if(Array.isArray(e))return deepEquals(e,t);switch(e.constructor){case String:case Date:case Boolean:case Number:return e==t}if("function"==typeof e.isEqualNode)return e.isEqualNode(t);if("function"==typeof e.equals)return e.equals(t);var r=[];for(var n in e)if(r.push(n),"function"!=typeof e[n]&&!equals$1(e[n],t[n]))return!1;for(var n in t)if(-1===r.indexOf(n)&&"function"!=typeof t[n]&&!equals$1(t[n],e[n]))return!1;return!0}function values(e){return e?Object.keys(e).map(function(t){return e[t]}):[]}function select(e,t){for(var r={},n=0;n<t.length;n++)r[t[n]]=e[t[n]];return r}function dissoc(e,t){var r={};for(var n in e)e.hasOwnProperty(n)&&-1===t.indexOf(n)&&(r[n]=e[n]);return r}function addScript(e,t,r,n){return asScriptOf(fromString(t),e,r,n)}function extend(e,t){for(var r=null,n=1;n<arguments.length;n++)if("string"!=typeof arguments[n]){var t=arguments[n];for(var i in t){var o=t.__lookupGetter__(i),a=t.__lookupSetter__(i);if(o&&e.__defineGetter__(i,o),a&&e.__defineSetter__(i,a),!o&&!a){var s=t[i];e[i]=s,r&&r.push(i),"function"==typeof s&&(s.displayName||(s.displayName=i),"undefined"!=typeof lively&&lively.Module&&lively.Module.current&&(s.sourceModule=lively.Module.current()))}}}else{var u=arguments[n];e.categories||(e.categories={}),e.categories[u]||(e.categories[u]=[]),r=e.categories[u]}return e}function clone$$1(e){if(isPrimitive(e))return e;if(Array.isArray(e))return Array.prototype.slice.call(e);var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}function extract(e,t,r){for(var n={},i=0;i<t.length;i++)t[i]in e&&(n[t[i]]=r?r(t[i],e[t[i]]):e[t[i]]);return n}function inspect(e,t,r){if(t=t||{},r=r||0,t.customPrinter){var n=t._ignoreSignal||(t._ignoreSignal={}),i=function(e){return inspect(e,t,r+1)},o=t.customPrinter(e,n,i);if(o!==n)return o}if(!e)return print$1(e);if("function"==typeof e)return t.printFunctionSource?String(e):"function"+(e.name?" "+e.name:"")+"("+argumentNames(e).join(",")+") {/*...*/}";switch(e.constructor){case String:case Boolean:case RegExp:case Number:return print$1(e)}if("function"==typeof e.serializeExpr)return e.serializeExpr();var a=e&&Array.isArray(e),s=a?"[":"{",u=a?"]":"}";if(t.maxDepth&&r>=t.maxDepth)return s+"/*...*/"+u;var c=[];if(0===(c=a?e.map(function(e){return inspect(e,t,r+1)}):Object.keys(e).sort(function(t,r){var n="function"==typeof e[t];return n===("function"==typeof e[r])?t<r?-1:t>r?1:0:n?1:-1}).map(function(n,i){a&&inspect(e[n],t,r+1);var o=inspect(e[n],t,r+1);return t.escapeKeys?JSON.stringify(n):n+": "+o})).length)return s+u;var l=c.join(", "),f=(!a||t.newLineInArrays)&&(!t.minLengthForNewLine||l.length>=t.minLengthForNewLine),p=indent$1("",t.indent||"  ",r),d=indent$1("",t.indent||"  ",r+1),h=f&&!a?"\n"+d:"",m=f?"\n"+d:"",v=f&&!a?"\n"+p:"";return f&&(l=c.join(","+m)),s+h+l+v+u}function merge(e){return arguments.length>1?merge(Array.prototype.slice.call(arguments)):Array.isArray(e[0])?Array.prototype.concat.apply([],e):e.reduce(function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},{})}function deepMerge(e,t){if(!e)return t;if(!t)return e;if(Array.isArray(e)){if(!Array.isArray(t))return t;var r=e.map(function(e,r){return deepMerge(e,t[r])});return t.length>e.length&&(r=r.concat(t.slice(e.length))),r}return"object"!==(void 0===e?"undefined":_typeof(e))||"object"!==(void 0===t?"undefined":_typeof(t))?t:Object.keys(e).concat(Object.keys(t)).reduce(function(r,n){return e[n]?t[n]?"object"!==_typeof(e[n])||"object"!==_typeof(t[n])?r[n]=t[n]:r[n]=deepMerge(e[n],t[n]):r[n]=e[n]:r[n]=t[n],r},{})}function sortKeysWithBeforeAndAfterConstraints(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=[],r=[],n=[];for(var i in e){var o=e[i],a=o.hasOwnProperty("before")?o.before:o.before=[],s=o.hasOwnProperty("after")?o.after:o.after=[];t.push(i),r.push(o);for(var u=a.length;u--;){var c=a[u],l=e[c];l?(l.hasOwnProperty("after")||(l.after=[]),l.after.push(i)):(console.warn("[initializeProperties] "+this+" sortProperties: Property "+i+" requires to be initialized before "+c+" but that property cannot be found."),a.splice(u,1))}for(var f=s.length;f--;){var p=s[f];e[p]||(console.warn("[initializeProperties] "+this+" sortProperties: Property "+i+" requires to be initialized after "+p+" but that property cannot be found."),s.splice(f,1))}n.push(i)}for(var d=[],h=[],m=n.length+1;n.length;){if(m===n.length)throw new Error("Circular dependencies in handler order, could not resolve properties "+n.map(function(t){var r=e[t].before,n=e[t].after;if(!(r&&r.length||n&&n.length))return"";var i=t+"\n";return r&&r.length&&(i+="  - before "+r.join(",")+"\n"),n&&n.length&&(i+="  - after "+n.join(",")+"\n"),i}).join(""));m=n.length;for(var v=[],y=n.length;y--;){var g=n[y];isSubset(e[g].after,h)&&(n.splice(y,1),h.push(g),v.push(g))}d.push(v)}return flatten(d,1)}function inherit(e){return Object.create(e)}function valuesInPropertyHierarchy(e,t){for(var r=[],n=e;n;)n.hasOwnProperty(t)&&r.unshift(n[t]),n=Object.getPrototypeOf(n);return r}function mergePropertyInHierarchy(e,t){return merge(valuesInPropertyHierarchy(e,t))}function deepCopy(e){if(!e||"object"!==(void 0===e?"undefined":_typeof(e))||e instanceof RegExp)return e;var t=Array.isArray(e)?Array(e.length):{};for(var r in e)e.hasOwnProperty(r)&&(t[r]=deepCopy(e[r]));return t}function typeStringOf(e){return null===e?"null":void 0===e?"undefined":e.constructor.name}function shortPrintStringOf(e){function t(e,t,n,i){e.constructor.name===t&&(r+=n,(e.length||Object.keys(e).length)&&(r+="..."),r+=i)}if(!isMutableType(e))return safeToString(e);if("Object"!==e.constructor.name&&!Array.isArray(e)&&e.constructor.name)return e.constructor.name?e.constructor.name:Object.prototype.toString.call(e).split(" ")[1].split("]")[0];var r="";return t(e,"Object","{","}"),t(e,"Array","[","]"),r}function isMutableType(e){return-1===["null","undefined","Boolean","Number","String"].indexOf(typeStringOf(e))}function safeToString(e){try{return(e?e.toString():String(e)).replace("\n","")}catch(e){return"<error printing object>"}}function asObject(e){switch(void 0===e?"undefined":_typeof(e)){case"string":return new String(e);case"boolean":return new Boolean(e);case"number":return new Number(e);default:return e}}function newKeyIn(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"_",n=1;do{t=r+"-"+n++}while(t in e);return t}function format(){return formatFromArray(Array.prototype.slice.call(arguments))}function formatFromArray(e){function t(e,t){return""+e}function r(e,t){return e.toString()}function n(e,t){return inspect(e)}var i=e.shift();i||console.log("Error in Strings>>formatFromArray, first arg is undefined");for(var o={s:t,d:r,i:r,f:function(e,t,r){return r>-1?e.toFixed(r):e.toString()},o:n},a=/((^%|[^\\]%)(\d+)?(\.)([a-zA-Z]))|((^%|[^\\]%)([a-zA-Z]))/,s=(function(e){for(var t=[],r=a.exec(e);r;r=a.exec(e)){var i=r[8]||r[5],s=i in o?o[i]:n,u=r[3]?parseInt(r[3]):"."==r[4]?-1:0;t.push(e.substr(0,"%"==r[0][0]?r.index:r.index+1)),t.push({appender:s,precision:u}),e=e.substr(r.index+r[0].length)}return e&&t.push(e.toString()),t}(i)),u="",c=0,l=0;l<s.length;++l){var f=s[l];if(f&&"object"==(void 0===f?"undefined":_typeof(f))){var p=e[c++];u+=(f.appender||t)(p,u,f.precision)}else u+=t(f,u)}return u}function indent(e,t,r){if(!r||r<=0)return e;for(var n="";r>0;)r--,n+=t;return lines(e).map(function(e){return n+e}).join("\n")}function minIndent(e,t){t||(t="  ");var r=new RegExp("^("+t+")*","gm");return min(e.match(r).map(function(e){return Math.floor(e.length/t.length)}))}function changeIndent(e,t,r){t||(t="  "),r||(r=0);var n=minIndent(e,t);if(n===r)return e;if(n<r)return indent(e,t,r-n);var i=t.repeat(n-r);return lines(e).map(function(e){return e.slice(i.length)}).join("\n")}function quote(e){return'"'+e.replace(/"/g,'\\"')+'"'}function print(e){if(e&&Array.isArray(e))return"["+e.map(print)+"]";if("string"!=typeof e)return String(e);var t=String(e);return t=t.replace(/\n/g,"\\n\\\n"),t=t.replace(/(")/g,"\\$1"),t='"'+t+'"'}function printNested(e,t){return t=t||0,e.reduce(function(e,r){return e+=Array.isArray(r)?printNested(r,t+1):indent(r+"\n","  ",t)},"")}function pad(e,t,r){return r?" ".repeat(t)+e:e+" ".repeat(t)}function printTable(e,t){function r(e){return!o&&(!!a||t&&Array.isArray(t.align)&&"right"===t.align[e])}var n=[],i=t&&t.separator||" ",o=!t||!t.align||"left"===t.align,a=t&&"right"===t.align;return e.forEach(function(e){e.forEach(function(e,t){void 0===n[t]&&(n[t]=0),n[t]=Math.max(n[t],String(e).length)})}),e.map(function(e){return e.map(function(e,t){var i=String(e);return pad(i,n[t]-i.length,r(t))}).join(i)}).join("\n")}function printTree(e,t,r,n){function i(e,a,s){o[a]=n.repeat(e)+t(s,e);var u=r(s,e),c=a+1;if(!u||!u.length)return c;var l=c,f=u.length-1;return u.forEach(function(t,r){c=i(e+1,c,t);for(var a=f===r,s=o[l].split(""),u=e*n.length+1,p=e*n.length+n.length,r=u;r<p;r++)s[r]="-";a&&(s[e*n.length]="\\"),o[l]=s.join(""),a||o.slice(l,c).forEach(function(t,r){var i=t.split("");i[e*n.length]="|",o[l+r]=i.join("")}),l=c}),c}var o=[];return n=n||"  ",i(0,0,e),o.join("\n")}function toArray$1(e){return e.split("")}function lines(e){return e.split(/\n\r?/)}function paragraphs(e,t){function r(e){return/^\s*$/.test(e)}var n=t?t.sep:"\n\n";return t&&t.keepEmptyLines?e.split("\n").concat("").reduce(function(e,t){var n=e[0],i=e[1];return r(i)===r(t)?i+="\n"+t:(i.length&&n.push(i),i=t),[n,i]},[[],""])[0]:e.split(new RegExp(n+"+"))}function nonEmptyLines(e){return lines(e).compact()}function tokens(e,t){return e.split(t||/\s+/).filter(function(e){return!/^\s*$/.test(e)})}function tableize(e,t){for(var r=(t=t||{}).cellSplitter||/\s+/,n=/^\s*$/,i=!t.hasOwnProperty("convertTypes")||!!t.convertTypes,o=lines(e),a=[],s=0;s<o.length;s++){var u=tokens(o[s],r);i&&(u=u.map(function(e){if(e.match(n))return e;var t=Number(e);if(!isNaN(t))return t;var r=new Date(e);return isNaN(+r)?e.trim():r})),u.length>0&&a.push(u)}return a}function unescapeCharacterEntities(e){if("undefined"==typeof document)throw new Error("Cannot unescapeCharacterEntities");var t=document.createElement("div");return t.innerHTML=e,t.textContent}function toQueryParams(e,t){var r=e.trim().match(/([^?#]*)(#.*)?$/);return r?r[1].split(t||"&").inject({},function(e,t){if((t=t.split("="))[0]){var r=decodeURIComponent(t.shift()),n=t.length>1?t.join("="):t[0];void 0!=n&&(n=decodeURIComponent(n)),r in e?(Array.isArray(e[r])||(e[r]=[e[r]]),e[r].push(n)):e[r]=n}return e}):{}}function normalizePath$1(e){var t=e.match(urlStartRe),r=t?t[0]:null,n=r?e.slice(r.length):e;do{n=(e=n).replace(pathDoubleDotRe,"")}while(n!=e);return n=n.replace(pathDoubleSlashRe,"$1/"),n=n.replace(pathDotRe,"/"),r&&(n=r+n),n}function joinPath(){return normalizePath$1(Array.prototype.slice.call(arguments).reduce(function(e,t){return"string"==typeof t?e.replace(/\/*$/,"")+"/"+t.replace(/^\/*/,""):e}))}function newUUID(){return newUUIDTemplate.replace(newUUIDRe,newUUIDReplacer).toUpperCase()}function createDataURI(e,t){return"data:"+(t=t||"text/plain")+";base64,"+btoa(e)}function hashCode(e){var t=0,r=e.length;if(0==r)return t;for(var n=0;n<r;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t}function md5(e){function t(e,t,r,n,i,o){return t=c(c(t,e),c(n,o)),c(t<<i|t>>>32-i,r)}function r(e,r,n,i,o,a,s){return t(r&n|~r&i,e,r,o,a,s)}function n(e,r,n,i,o,a,s){return t(r&i|n&~i,e,r,o,a,s)}function i(e,r,n,i,o,a,s){return t(r^n^i,e,r,o,a,s)}function o(e,r,n,i,o,a,s){return t(n^(r|~i),e,r,o,a,s)}function a(e,t){var a=e[0],s=e[1],u=e[2],l=e[3];s=o(s=o(s=o(s=o(s=i(s=i(s=i(s=i(s=n(s=n(s=n(s=n(s=r(s=r(s=r(s=r(s,u=r(u,l=r(l,a=r(a,s,u,l,t[0],7,-680876936),s,u,t[1],12,-389564586),a,s,t[2],17,606105819),l,a,t[3],22,-1044525330),u=r(u,l=r(l,a=r(a,s,u,l,t[4],7,-176418897),s,u,t[5],12,1200080426),a,s,t[6],17,-1473231341),l,a,t[7],22,-45705983),u=r(u,l=r(l,a=r(a,s,u,l,t[8],7,1770035416),s,u,t[9],12,-1958414417),a,s,t[10],17,-42063),l,a,t[11],22,-1990404162),u=r(u,l=r(l,a=r(a,s,u,l,t[12],7,1804603682),s,u,t[13],12,-40341101),a,s,t[14],17,-1502002290),l,a,t[15],22,1236535329),u=n(u,l=n(l,a=n(a,s,u,l,t[1],5,-165796510),s,u,t[6],9,-1069501632),a,s,t[11],14,643717713),l,a,t[0],20,-373897302),u=n(u,l=n(l,a=n(a,s,u,l,t[5],5,-701558691),s,u,t[10],9,38016083),a,s,t[15],14,-660478335),l,a,t[4],20,-405537848),u=n(u,l=n(l,a=n(a,s,u,l,t[9],5,568446438),s,u,t[14],9,-1019803690),a,s,t[3],14,-187363961),l,a,t[8],20,1163531501),u=n(u,l=n(l,a=n(a,s,u,l,t[13],5,-1444681467),s,u,t[2],9,-51403784),a,s,t[7],14,1735328473),l,a,t[12],20,-1926607734),u=i(u,l=i(l,a=i(a,s,u,l,t[5],4,-378558),s,u,t[8],11,-2022574463),a,s,t[11],16,1839030562),l,a,t[14],23,-35309556),u=i(u,l=i(l,a=i(a,s,u,l,t[1],4,-1530992060),s,u,t[4],11,1272893353),a,s,t[7],16,-155497632),l,a,t[10],23,-1094730640),u=i(u,l=i(l,a=i(a,s,u,l,t[13],4,681279174),s,u,t[0],11,-358537222),a,s,t[3],16,-722521979),l,a,t[6],23,76029189),u=i(u,l=i(l,a=i(a,s,u,l,t[9],4,-640364487),s,u,t[12],11,-421815835),a,s,t[15],16,530742520),l,a,t[2],23,-995338651),u=o(u,l=o(l,a=o(a,s,u,l,t[0],6,-198630844),s,u,t[7],10,1126891415),a,s,t[14],15,-1416354905),l,a,t[5],21,-57434055),u=o(u,l=o(l,a=o(a,s,u,l,t[12],6,1700485571),s,u,t[3],10,-1894986606),a,s,t[10],15,-1051523),l,a,t[1],21,-2054922799),u=o(u,l=o(l,a=o(a,s,u,l,t[8],6,1873313359),s,u,t[15],10,-30611744),a,s,t[6],15,-1560198380),l,a,t[13],21,1309151649),u=o(u,l=o(l,a=o(a,s,u,l,t[4],6,-145523070),s,u,t[11],10,-1120210379),a,s,t[2],15,718787259),l,a,t[9],21,-343485551),e[0]=c(a,e[0]),e[1]=c(s,e[1]),e[2]=c(u,e[2]),e[3]=c(l,e[3])}function s(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function u(e){for(var t="",r=0;r<4;r++)t+=l[e>>8*r+4&15]+l[e>>8*r&15];return t}var c=function(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r},l="0123456789abcdef".split("");return function(e){for(var t=e.length,r=0;r<t;r++)e[r]=u(e[r]);return e.join("")}(function(e){var t,r=e.length,n=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=r;t+=64)a(n,s(e.substring(t-64,t)));var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=(e=e.substring(t-64)).length;for(t=0;t<o;t++)i[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(a(n,i),t=16;t--;)i[t]=0;return i[14]=8*r,a(n,i),n}(e))}function reMatches$$1(e,t){var r=[];return e.replace(t,function(e,t){r.push({match:e,start:t,end:t+e.length})}),r}function stringMatch(e,t,r){function n(e,t,r,n,i){return n=n||0,i=i||0,[e.slice(0,t),e.slice(t+n,r-i),e.slice(r)]}function i(e,t){if(t.constructor!==RegExp){if(0===e.indexOf(t))return{match:t,rest:e.slice(t.length)};for(var r=0;r<t.length;r++)if(t[r]!=e[r])return{match:null,pos:r};return{match:null}}var n=reMatches$$1(e,t);return n&&n.length&&0===n[0].start?{match:n[0].match,rest:e.slice(n[0].end)}:{match:null}}function o(e,t){for(var r=0,n=0;n<t.length;n++){var o=t[n],a=i(e,o);if(!a.match)return{matched:!1,pos:r+(a.pos||0),pattern:o};r+=a.match.length,e=a.rest}return e.length?{matched:!1,pos:r}:{matched:!0}}function a(e){var t=reMatches$$1(e,/__\//g),r=reMatches$$1(e,/\/__/g);if(t.length!==r.length)throw new Error("pattern invalid: "+e+" cannot be split into __/.../__ embedded RegExps\nstarts: "+JSON.stringify(t)+"\nvs ends:\n"+JSON.stringify(r));var i=0;return t.reduce(function(e,t,o){var a=r[o],s=n(e.pop(),t.start-i,a.end-i,3,3);s[0].length&&(e.push(s[0]),i+=s[0].length);try{s[1].length&&(e.push(new RegExp(s[1])),i+=s[1].length+3+3)}catch(e){throw new Error("Cannot create pattern re from: "+inspect(s))}return s[2].length&&e.push(s[2]),e},[e])}return(r=r||{}).normalizeWhiteSpace&&(e=e.replace(/\s+/g," ")),r.ignoreIndent&&(e=e.replace(/^\s+/gm,""),t=t.replace(/^\s+/gm,"")),e==t?{matched:!0}:function(e,t){var r=o(e,a(t));return r.matched?r:(r.error=e.slice(0,r.pos)+"<--UNMATCHED--\x3e"+e.slice(r.pos),r)}(e,t)}function peekRight(e,t,r){if(e=e.slice(t),"string"==typeof r){var n=e.indexOf(r);return-1===n?null:n+t}if(r.constructor===RegExp){var i=reMatches$$1(e,r);return i[0]?i[0].start:null}return null}function peekLeft(e,t,r){if(e=e.slice(0,t),"string"==typeof r){var n=e.lastIndexOf(r);return-1===n?null:n}if(r.constructor===RegExp){var i=reMatches$$1(e,r);return last(i)?last(i).start:null}return null}function lineIndexComputer(e){var t=lineRanges(e);return function(e){for(var r=0;r<t.length;r++){var n=t[r];if(e>=n[0]&&e<n[1])return r}return-1}}function lineNumberToIndexesComputer(e){return function(t){return lineRanges(e)[t]}}function lineRanges(e){for(var t=0,r=0,n=lines(e),i=[],o=0;o<n.length;o++)r=t+n[o].length+1,i.push([t,r]),t=r;return i}function findLineWithIndexInLineRanges(e,t){var r=e.length;if(0===r)return-1;for(var n=0,i=r;;){var o=n+Math.floor((i-n)/2),a=slicedToArray(e[o],2),s=a[0],u=a[1];if(t<s){if(0===o)return-1;i=o}else{if(!(t>u))return o;n=o}}return-1}function diff(e,t){return"undefined"==typeof JsDiff?"diff not supported":JsDiff.convertChangesToXML(JsDiff.diffWordsWithSpace(e,t))}function empty(e){return""==e}function startsWithVowel(e){var t=e[0];return"A"===t||"E"===t||"I"===t||"O"===t||"U"===t||"a"===t||"e"===t||"i"===t||"o"===t||"u"===t||!1}function withDecimalPrecision(e,t){var r=parseFloat(e);return isNaN(r)?e:r.toFixed(t)}function capitalize(e){return e.length?e.charAt(0).toUpperCase()+e.slice(1):e}function camelCaseString(e){return e.split(" ").invoke("capitalize").join("")}function camelize(e){var t=e.split("-"),r=t.length;if(1==r)return t[0];for(var n="-"==e.charAt(0)?t[0].charAt(0).toUpperCase()+t[0].substring(1):t[0],i=1;i<r;i++)n+=t[i].charAt(0).toUpperCase()+t[i].substring(1);return n}function truncate(e,t,r){return t=t||30,r=void 0===r?"...":r,e.length>t?e.slice(0,t-r.length)+r:String(e)}function truncateLeft(e,t,r){return t=t||30,r=void 0===r?"...":r,e.length>t?r+e.slice(-t):String(e)}function regExpEscape(e){return e.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")}function succ(e){return e.slice(0,e.length-1)+String.fromCharCode(e.charCodeAt(e.length-1)+1)}function digitValue(e){return e.charCodeAt(0)-"0".charCodeAt(0)}function applyChange(e,t){return"insert"===t.action?e.slice(0,t.start)+t.lines.join("\n")+e.slice(t.start):"remove"===t.action?e.slice(0,t.start)+e.slice(t.end):e}function applyChanges(e,t){return t.reduce(function(t,r){return applyChange(e,r)},e)}function levenshtein(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;var r,n,i,o,a,s;for(e.length>t.length&&(r=e,e=t,t=r),s=Array(e.length+1),n=0;n<=e.length;n++)s[n]=n;for(n=1;n<=t.length;n++){for(o=n,i=1;i<=e.length;i++)a=t[n-1]===e[i-1]?s[i-1]:Math.min(s[i-1]+1,Math.min(o+1,s[i]+1)),s[i-1]=o,o=a;s[e.length]=o}return s[e.length]}function random(e,t){return e=e||0,t=t||100,Math.round(Math.random()*(t-e)+e)}function randomSmallerInteger(e){return Math.floor(Math.random()*e)}function humanReadableByteSize(e){function t(e){return Math.round(100*e)/100}return e<1e3?String(t(e))+"B":(e/=1024)<1e3?String(t(e))+"KB":(e/=1024,String(t(e))+"MB")}function average(e){return e.reduce(function(e,t){return e+t},0)/e.length}function median(e){var t=e.sort(function(e,t){return t-e}),r=e.length;return r%2==0?.5*(t[r/2-1]+t[r/2]):t[(r-1)/2]}function between(e,t,r,n){n=n||0;var i,o;return t<r?(i=t,o=r):(o=t,i=r),o-e+n>=0&&i-e-n<=0}function sort$1(e){return e.sort(function(e,t){return e-t})}function parseLength(e,t){t=t||"px";var r=e.match(/([0-9\.]+)\s*(.*)/);if(r&&r[1]){var n=parseFloat(r[1]),i=r[2];return convertLength(n,i,t)}}function roundTo(e,t){return t=1/t,Math.round(e*t)/t}function detent(e,t,r,n){var i=roundTo(e,r);return Math.abs(e-i)<t/2?i:n?e:i+(e-(e<i?i-t/2:i+t/2))*r/(r-t)}function toDegrees(e){return 180*e/Math.PI%360}function toRadians(e){return e/180*Math.PI}function backoff(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4,n=Math.min(r,t*Math.pow(2,e)),i=n/2+Math.round(Math.random()*(n/2));return Math.min(r,t+Math.random()*(3*i-t))}function all$2(e,t){var r=[];for(var n in e)!e.__lookupGetter__(n)&&"function"==typeof e[n]||t&&!t(n,e)||r.push(n);return r}function allOwnPropertiesOrFunctions(e,t){return Object.getOwnPropertyNames(e).reduce(function(r,n){return t&&!t(e,n)||r.push(n),r},[])}function own$1(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&(e.__lookupGetter__(r)||"function"!==e[r])&&t.push(r);return t}function forEachOwn(e,t,r){var n=[];for(var i in e)if(e.hasOwnProperty(i)){var o=e[i];"function"!==o&&n.push(t.call(r||this,i,o))}return n}function nameFor(e,t){for(var r in e)if(e[r]===t)return r}function values$1(e){var t=[];for(var r in e)t.push(e[r]);return t}function ownValues(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(e[r]);return t}function any$1(e,t){for(var r in e)if(t(e,r))return!0;return!1}function allProperties(e,t){var r=[];for(var n in e)t&&!t(e,n)||r.push(n);return r}function hash(e){return Object.keys(e).sort().join("").hashCode()}function format$1(e,t,r){return dateFormat(e,t,r)}function equals$3(e,t){return t&&t instanceof Date&&t.getTime()===e.getTime()}function relativeTo(e,t){if(!(t instanceof Date))return"";if(t<e)return"";if(t===e)return"now";var r="min",n="sec",i="hour",o="day",a=t-e,s=Math.round(a/1e3),u=s%60,c=Math.floor(s/60)%60,l=Math.floor(s/60/60)%24,f=Math.floor(s/60/60/24),p=[];return f>0&&(p.push(f),f>1&&(o+="s"),p.push(o)),l>0&&f<2&&(p.push(l),l>1&&(i+="s"),p.push(i)),c>0&&l<3&&0===f&&(p.push(c),c>1&&(r+="s"),p.push(r)),u>0&&c<3&&0===l&&0===f&&(p.push(u),u>1&&(n+="s"),p.push(n)),p.join(" ")}function promise(e){return"function"==typeof e?promise.convertCallbackFun(e):Promise.resolve(e)}function delay$1(e,t){return new Promise(function(r){return setTimeout(r,e,t)})}function delayReject(e,t){return new Promise(function(r,n){return setTimeout(n,e,t)})}function timeout(e,t){return new Promise(function(r,n){var i=!1;setTimeout(function(){return!i&&(i=!0)&&n(new Error("Promise timed out"))},e),t.then(function(e){return!i&&(i=!0)&&r(e)},function(e){return!i&&(i=!0)&&n(e)})})}function waitFor$1(e,t,r){return"function"==typeof e&&(t=e,e=void 0),new Promise(function(n,i){var o=!1,a=!1,s=void 0,u=void 0,c=setInterval(function(){if(o)clearInterval(c);else{try{u=t()}catch(e){s=e}if(u||s||a)return o=!0,clearInterval(c),s?i(s):a?void 0===r?i(new Error("timeout")):n(r):n(u)}},10);"number"==typeof e&&setTimeout(function(){return a=!0},e)})}function deferred(){var e,t,r=new Promise(function(r,n){e=r,t=n});return{resolve:e,reject:t,promise:r}}function convertCallbackFun(e){return function(){var t=Array.from(arguments),r=this;return new Promise(function(n,i){t.push(function(e,t){return e?i(e):n(t)}),e.apply(r,t)})}}function convertCallbackFunWithManyArgs(e){return function(){var t=Array.from(arguments),r=this;return new Promise(function(n,i){t.push(function(){var e=Array.from(arguments),t=e.shift();return t?i(t):n(e)}),e.apply(r,t)})}}function _chainResolveNext(e,t,r,n,i){var o=e.shift();if(o)try{Promise.resolve(o(t,r)).then(function(t){return _chainResolveNext(e,t,r,n,i)}).catch(function(e){i(e)})}catch(e){i(e)}else n(t)}function chain$1(e){return new Promise(function(t,r){return _chainResolveNext(e.slice(),void 0,{},t,r)})}function promise_finally(e,t){return Promise.resolve(e).then(function(e){try{t()}catch(e){console.error("Error in promise finally: "+e.stack||e)}return e}).catch(function(e){try{t()}catch(e){console.error("Error in promise finally: "+e.stack||e)}throw e})}function Path(e,t){return e instanceof Path?e:this instanceof Path?(this.setSplitter(t||"."),void this.fromPath(e)):new Path(e,t)}function clone$2(e){var t={};for(var r in e)t[r]=e[r].slice();return t}function without$1(e,t){var r={};for(var n in e)if(!t.includes(n)){r[n]=[];for(var i=e[n],o=0;o<i.length;o++){var a=i[o];t.includes(a)||r[n].push(a)}}return r}function hull(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;if(!Array.isArray(e[t]))return[];for(var i=[],o={},a={},s=0;s<r.length;s++)a[r[s]]=!0;for(var u=e[t].slice(),c={},l=u.length;l--;){var f=u[l];f in a?u.splice(l,1):c[f]=1}if(r)for(;;){if(0===u.length)break;for(var p=0;p<u.length;p++){var d=u.shift();if(!(d in o||d in a)){var h=c[d]||0;if(!(h>n)){i.push(d),o[d]=!0;var m=e[d];if(m)for(var v=0;v<m.length;v++){var y=m[v];y in o||y in c||(c[y]=h+1,u.push(y))}}}}}return i}function subgraphReachableBy(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;r&&(e=without$1(e,r));for(var i=[t],o=0,a={};i.length&&o++<n;){var s=i.shift();if(!a[s]){var u=e[s]||[];a[s]=u,i.push.apply(i,toConsumableArray(u))}}return a}function invert(e){var t={};for(var r in e)for(var n=e[r],i=0;i<n.length;i++){var o=n[i];t[o]?t[o].push(r):t[o]=[r]}return t}function sortByReference(e,t){for(var r=[t].concat(hull(e,t)),n=[],i=[];n.length!==r.length;){var o=withoutAll(r,n).reduce(function(t,r){return t[r]=withoutAll(e[r]||[],n).length,t},{}),a=withoutAll(r,n).reduce(function(e,t){return o[t]<=o[e]?t:e});0===o[a]?i.push(Object.keys(o).filter(function(e){return 0===o[e]})):i.push([a]),n=flatten(i)}return i}function reduce$1(e,t,r,n,i,o){function a(r){s.indexOf(r)>-1||(n=e.call(o,n,r,u++),s=s.concat([r]),withoutAll(t[r]||[],s).forEach(function(e){return a(e)}))}var s=i||[],u=0;return a(r),n}function random$1(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t={},r=range(1,e).map(String),n=0;n<r.length;n++){var i=Math.floor(Math.random()*e);t[r[n]]=shuffle(r).slice(0,i)}return t}function isInterval(e){return Array.isArray(e)&&e.length>=2&&e[0]<=e[1]}function sort$2(e){return e.sort(compare)}function compare(e,t){return e[0]<t[0]?e[1]<t[0]?-3:e[1]===t[0]?-2:-1:e[0]===t[0]?e[1]===t[1]?0:e[1]<t[1]?-1:1:-1*compare(t,e)}function coalesce(e,t,r){switch(this.compare(e,t)){case-3:case 3:return null;case 0:return r&&r(e,t,e),e;case 2:case 1:var n=e;e=t,t=n;case-2:case-1:var i=[e[0],Math.max(e[1],t[1])];return r&&r(e,t,i),i;default:throw new Error("Interval compare failed")}}function coalesceOverlapping(e,t){for(var r=[],n=e.length;n>0;){var i=e.shift();n--;for(var o=0;o<n;o++){var a=coalesce(i,e[o],t);a&&(i=a,e.splice(o,1),n--,o--)}r.push(i)}return this.sort(r)}function mergeOverlapping(e,t,r){for(var n=[];e.length>0;){var i=e.shift(),o=t.map(function(e){var t=compare(i,e);return-1===t||0===t||1===t});n.push(r(i,o[0])),n.push(i)}return n}function intervalsInRangeDo(e,t,r,n,i,o){o=o||GLOBAL$2,r=this.sort(r);for(var a,s=[];a=r.shift();)if(!(a[1]<e)){a[0]<e&&((a=Array.prototype.slice.call(a))[0]=e);var u=t<a[0]?t:a[0];if(e<u&&s.push(n.call(o,[e,u],!0)),t<a[1]&&((a=Array.prototype.slice.call(a))[1]=t),a[0]===a[1]){var c;i&&(c=s.slice(-1)[0])&&i.call(o,c,a,c)}else s.push(n.call(o,a,!1));if((e=a[1])>=t)break}return e<t&&s.push(n.call(o,[e,t],!0)),s}function intervalsInbetween(e,t,r){return intervalsInRangeDo(e,t,coalesceOverlapping(Array.prototype.slice.call(r)),function(e,t){return t?e:null}).filter(Boolean)}function mapToMatchingIndexes(e,t){var r,n,i=0;return t.map(function(t){for(;(n=e[i])&&n[0]<t[0];)i++;if(n&&n[0]===t[0]){for(r=i;(n=e[r])&&n[1]<t[1];)r++;if(n&&n[1]===t[1])return range(i,r)}return[]})}function create(e,t,r){var n=r||0;return n+t>e.length&&(n-=n+t-e.length),{array:e,from:n,to:n+t}}function toArray$4(e){return e.array.slice(e.from,e.to)}function originalToProjectedIndex(e,t){return t<e.from||t>=e.to?null:t-e.from}function projectedToOriginalIndex(e,t){return t<0||t>e.to-e.from?null:e.from+t}function transformToIncludeIndex(e,t){if(!(t in e.array))return null;var r=0;return t<e.from&&(r=-e.from+t),t>=e.to&&(r=t-e.to+1),0===r?e:create(e.array,e.to-e.from,e.from+r)}function get$2(e,t,r){var n=e[t];return n?n[r]:void 0}function set$2(e,t,r,n){var i=e[t];return i&&(i[r]=n),n}function getRow(e,t){return e[t]}function setRow(e,t,r){return e[t]=r}function getCol(e,t){return e.reduce(function(e,r){return e.push(r[t]),e},[])}function setCol(e,t,r){return e.map(function(e,n){return e[t]?e[t]=r[n]:void 0})}function create$1(e,t,r){for(var n=new Array(e);e>0;)n[--e]=withN(t,r);return n}function mapCreate(e,t,r,n){for(var i=new Array(e),o=0;o<e;o++){i[o]=new Array(t);for(var a=0;a<t;a++)i[o][a]=r.call(n||this,o,a)}return i}function forEach$2(e,t,r){e.forEach(function(e,n){e.forEach(function(e,i){t.call(r||this,e,n,i)})})}function map$2(e,t,r){var n=new Array(e.length);return e.forEach(function(e,i){n[i]=new Array(e.length),e.forEach(function(e,o){n[i][o]=t.call(r||this,e,i,o)})}),n}function toObjects(e){for(var t=e[0],r=new Array(e.length-1),n=1;n<e.length;n++)for(var i=r[n-1]={},o=0;o<t.length;o++)i[t[o]]=e[n][o];return r}function tableFromObjects(e,t){Array.isArray(e)||(e=[e]);var r=[[]],n=r[0],i=e.reduce(function(e,t){return e.concat([Object.keys(t).reduce(function(e,r){var i=n.indexOf(r);return-1===i&&(i=n.length,n.push(r)),e[i]=t[r],e},[])])},[]);return t=1===arguments.length?null:t,i.forEach(function(e){for(var r=0;r<n.length;r++)e[r]||(e[r]=t)}),r.concat(i)}function prewalk(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{i:0},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=n.i++;t(e,o,i),(r(e,o,i)||[]).forEach(function(e){return prewalk(e,t,r,n,i+1)})}function postwalk(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{i:0},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=n.i++;(r(e,o,i)||[]).forEach(function(e){return postwalk(e,t,r,n,i)}),t(e,o,i)}function find(e,t,r){if(t(e))return e;var n=r(e);if(n&&n.length)for(var i=0;i<n.length;i++){var o=find(n[i],t,r);if(o)return o}}function filter$1(e,t,r){var n=[];return t(e)&&n.push(e),n.concat(flatten((r(e)||[]).map(function(e){return filter$1(e,t,r)})))}function map$3(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return[t(e,n)].concat(flatten((r(e)||[]).map(function(e){return map$3(e,t,r,n+1)})))}function mapTree(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=(r(e)||[]).map(function(e){return mapTree(e,t,r,n+1)});return t(e,i,n)}function create$2(e){var t=[{name:"send",args:["msg","callback"]},{name:"listen",args:["messenger","callback"]},{name:"close",args:["messenger","callback"]},{name:"isOnline",args:[]}],r=t.map(function(e){return e.name}).concat(["id","sendHeartbeat","heartbeatInterval","ignoreUnknownMessages","allowConcurrentSends","sendTimeout","services"]);t.forEach(function(t){if(!e[t.name]){var r="message implementation needs function "+t.name+"("+t.args.join(",")+")";throw new Error(r)}});var n=e.sendHeartbeat&&(e.heartbeatInterval||1e3),i=!!e.hasOwnProperty("ignoreUnknownMessages")&&e.ignoreUnknownMessages,o={_outgoing:[],_inflight:[],_id:e.id||newUUID(),_ignoreUnknownMessages:i,_services:{},_messageCounter:0,_messageResponseCallbacks:{},_whenOnlineCallbacks:[],_statusWatcherProc:null,_startHeartbeatProcessProc:null,_listenInProgress:null,_heartbeatInterval:n,_status:OFFLINE,_runWhenOnlineCallbacks:function(){var e=o._whenOnlineCallbacks.slice();o._whenOnlineCallbacks=[],e.forEach(function(e){try{e.call(null,null,o)}catch(e){console.error("error in _runWhenOnlineCallbacks: %s",e)}})},_ensureStatusWatcher:function(){o._statusWatcherProc||(o._statusWatcherProc=setInterval(function(){o.isOnline()&&o._whenOnlineCallbacks.length&&o._runWhenOnlineCallbacks();var e=o._status;o._status=o.isOnline()?ONLINE:OFFLINE,o._status!==ONLINE&&o._statusWatcherProc&&o.reconnect(),o._status!==e&&o.onStatusChange&&o.onStatusChange()},20))},_addMissingData:function(e){if(!e.target)throw new Error("Message needs target!");if(!e.action)throw new Error("Message needs action!");return e.data||(e.data=null),e.messageId||(e.messageId=newUUID()),e.sender=o.id(),e.messageIndex=o._messageCounter++,e},_queueSend:function(e,t){if(t&&"function"!=typeof t)throw new Error("Expecing a when send callback, got: "+t);o._outgoing.push([e,t])},_deliverMessageQueue:function(){function t(t){if(-1!==o._inflight.indexOf(t)){var n=t[0],i=t[1];i&&(o._messageResponseCallbacks[n.messageId]=i),e.send.call(o,n,function(e){remove(o._inflight,t),e&&r(e,t),o._deliverMessageQueue()})}}function r(e,t){var r=t[0],n=t[1];delete o._messageResponseCallbacks[r.messageId],console.error(e),n&&n(e)}if(e.allowConcurrentSends||!o._inflight.length){var n=o._outgoing.shift();n&&(o._inflight.push(n),o.isOnline()?t(n):o.whenOnline(function(){t(n)}),function(t){"number"==typeof e.sendTimeout&&setTimeout(function(){-1!==o._inflight.indexOf(t)&&(remove(o._inflight,t),r(new Error("Timeout sending message"),t),o._deliverMessageQueue())},e.sendTimeout)}(n),e.allowConcurrentSends&&o._outgoing.length&&o._deliverMessageQueue())}},_startHeartbeatProcess:function(){o._startHeartbeatProcessProc||(o._startHeartbeatProcessProc=setTimeout(function(){e.sendHeartbeat.call(o,function(e,t){o._startHeartbeatProcessProc=null,o._startHeartbeatProcess()})},o._heartbeatInterval))},id:function(){return o._id},isOnline:function(){return e.isOnline.call(o)},heartbeatEnabled:function(){return"number"==typeof o._heartbeatInterval},listen:function(t){if(!o._listenInProgress)return o._listenInProgress=!0,o._ensureStatusWatcher(),e.listen.call(o,function(e){o._listenInProgress=null,t&&t(e),o.heartbeatEnabled()&&o._startHeartbeatProcess()})},reconnect:function(){if(o._status!==ONLINE)return o.listen(),o},send:function(e,t){return o._addMissingData(e),o._queueSend(e,t),o._deliverMessageQueue(),e},sendTo:function(e,t,r,n){var i={target:e,action:t,data:r};return o.send(i,n)},onMessage:function(e){if(o.emit("message",e),e.inResponseTo){var t=o._messageResponseCallbacks[e.inResponseTo];t&&!e.expectMoreResponses&&delete o._messageResponseCallbacks[e.inResponseTo],t&&t(null,e)}else{var r=o._services[e.action];if(r)try{r.call(null,e,o)}catch(t){var n=String(t.stack||t);console.error("Error invoking service: "+n),o.answer(e,{error:n})}else if(!o._ignoreUnknownMessages){var i=new Error("messageNotUnderstood: "+e.action);o.answer(e,{error:String(i)})}}},answer:function(e,t,r,n){"function"==typeof r&&(n=r,r=!1);var i={target:e.sender,action:e.action+"Result",inResponseTo:e.messageId,data:t};return r&&(i.expectMoreResponses=!0),o.send(i,n)},close:function(t){return clearInterval(o._statusWatcherProc),o._statusWatcherProc=null,e.close.call(o,function(e){o._status=OFFLINE,t&&t(e)}),o},whenOnline:function(e){return o._whenOnlineCallbacks.push(e),o.isOnline()&&o._runWhenOnlineCallbacks(),o},outgoingMessages:function(){return pluck(o._inflight.concat(o._outgoing),0)},addServices:function(e){return Object.assign(o._services,e),o}};e.services&&o.addServices(e.services),makeEmitter(o);for(var a in e)-1===r.indexOf(a)&&e.hasOwnProperty(a)&&(o[a]=e[a]);return o}function fork(e,t,r){r||(r=t,t=e,e=null);var n=(e=e||{}).args||[],i=create$3(e);return i.run.apply(i,[t].concat(n).concat(r)),i}function create$3(e){(e=e||{}).useMessenger=!0;var t=e.workerId||newUUID(),r=create$2({sendTimeout:5e3,send:function(e,t){r.worker.postMessage(e),t()},listen:function(t){var n=r.worker=isNodejs?NodejsWorker.create(e):BrowserWorker.create(e);n.on("message",function(e){r.onMessage(e)}),n.on("ready",function(){NodejsWorker.debug&&console.log("WORKER READY!!!")}),n.on("close",function(){NodejsWorker.debug&&console.log("WORKER CLOSED...!!!")}),n.once("ready",t)},close:function(e){return r.worker.ready?r.sendTo(t,"close",{},function(t,n){if((t=t||n.data.error)&&console.error("Error in worker messenger close: "+t.stack||t),t)e(t);else{var i=!1;r.worker.once("close",function(){i=!0}),waitFor(1e3,function(){return!!i},e)}}):e(null)},isOnline:function(){return r.worker&&r.worker.ready}});return Object.assign(r,{eval:function(e,n){r.sendTo(t,"remoteEval",{expr:e},function(e,t){n(e,t?t.data.result:null)})},run:function(){var e=Array.prototype.slice.call(arguments),n=e.shift(),i=e.pop();if("function"!=typeof n)throw new Error("run: no function that should run in worker passed");if("function"!=typeof i)throw new Error("run: no callback passed");return r.sendTo(t,"run",{func:String(n),args:e},function(e,t){i(e||t.data.error,t?t.data.result:null)})}}),r.listen(),r}function createLivelyLangObject(){return{chain:chain$$1,noConflict:noConflict,installGlobals:installGlobals,uninstallGlobals:uninstallGlobals,globalInterfaceSpec:globalInterfaceSpec,toString:function(){return"[object lively.lang]"}}}function chain$$1(e){if(!e)return e;if(Array.isArray(e))return createChain(arr,e);if("Date"===e.constructor.name)return createChain(date,e);switch(void 0===e?"undefined":_typeof(e)){case"string":return createChain(string,e);case"object":return createChain(obj,e);case"function":return createChain(fun,e);case"number":return createChain(num,e)}throw new Error("Chain for object "+e+" ("+e.constructor.name+") no supported")}function createChain(e,t){return Object.keys(e).reduce(function(r,n){return r[n]=function(){var r=Array.prototype.slice.call(arguments);return chain$$1(e[n].apply(null,[t].concat(r)))},r},{value:function(){return t}})}function noConflict(){return isNode||(livelyLang._prevLivelyGlobal?delete GLOBAL.lively.lang:delete GLOBAL.lively),livelyLang}function installGlobals(){Object.assign(livelyLang,{worker:worker,messenger:messenger,events:events,tree:tree,grid:grid,arrayProjection:arrayProjection,interval:interval,graph:graph,date:date,properties:properties,obj:obj,arr:arr,fun:fun,num:num,string:string,Closure:Closure,promise:promise,Path:Path,Group:Group}),globalInterfaceSpec.forEach(function(e){if("installMethods"===e.action){(r=Path(e.target)).isIn(GLOBAL)||r.set(GLOBAL,{},!0);var t=Path(e.sources[0]);e.methods.forEach(function(e){installProperty(t.concat([e]),r.concat([e]))}),e.alias&&e.alias.forEach(function(e){installProperty(t.concat([e[1]]),r.concat([e[0]]))})}else{if("installObject"!==e.action)throw new Error("Cannot deal with global setup action: "+e.action);var r=Path(e.target),n=Path(e.source).get(livelyLang);r.set(GLOBAL,n,!0)}})}function installProperty(e,t){if(!e.isIn(livelyLang)){var r=new Error("property not provided by lively.lang: "+e);throw console.error(r.stack||r),r}var n=e.get(livelyLang);if("function"==typeof n&&"prototype"===t.slice(-2,-1).toString()){var i=n;(n=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this),i.apply(null,e)}).toString=function(){return i.toString()}}t.set(GLOBAL,n,!0)}function uninstallGlobals(){globalInterfaceSpec.forEach(function(e){if("installMethods"===e.action){var t=Path(e.target),r=Path(e.source).get(livelyLang),n=t.get(GLOBAL);if(!n)return;e.methods.filter(function(e){return r===n[e]}).forEach(function(e){delete n[e]}),e.alias&&e.alias.filter(function(e){return r===n[e]}).forEach(function(e){delete n[e[0]]})}else{if("installObject"!==e.action)throw new Error("Cannot deal with global setup action: "+e.action);(t=Path(e.target)).del(GLOBAL)}})}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),get$1=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},set$1=function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var s=o.set;void 0!==s&&s.call(i,n)}return n},slicedToArray=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},parameterRegex=/function[^\(]*\(([^\)]*)\)|\(?([^\)=]*)\)?\s*=>/,Closure=function(){function e(t,r,n,i){classCallCheck(this,e),this.originalFunc=t,this.varMapping=r||{},this.setFuncSource(n||t),this.setFuncProperties(t||i)}return createClass(e,null,[{key:"fromFunction",value:function(e,t){return new this(e,t||{})}},{key:"fromSource",value:function(e,t){return new this(null,t||{},e)}}]),createClass(e,[{key:"setFuncSource",value:function(e){return e="undefined"!=typeof lively&&lively.sourceTransform&&"function"==typeof lively.sourceTransform.stringifyFunctionWithoutToplevelRecorder?lively.sourceTransform.stringifyFunctionWithoutToplevelRecorder(e):String(e),this.source=e}},{key:"getFuncSource",value:function(){return this.source||this.setFuncSource(this.originalFunc)}},{key:"hasFuncSource",value:function(){return this.source&&!0}},{key:"getFunc",value:function(){return this.originalFunc||this.recreateFunc()}},{key:"getFuncProperties",value:function(){return this.funcProperties||(this.funcProperties={})}},{key:"setFuncProperties",value:function(e){var t=this.getFuncProperties();for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])}},{key:"lookup",value:function(e){return this.varMapping[e]}},{key:"parameterNames",value:function(e){if("undefined"!=typeof lively&&lively.ast)return(lively.ast.parseFunction(e).params||[]).map(function(e){return"Identifier"===e.type?e.name:e.left&&"Identifier"===e.left.type?e.left.name:null}).filter(Boolean);var t=parameterRegex.exec(e);return t?(t[1]||t[2]||"").split(",").map(function(e){return e.trim()}):[]}},{key:"firstParameter",value:function(e){return this.parameterNames(e)[0]||null}},{key:"recreateFunc",value:function(){return this.recreateFuncFromSource(this.getFuncSource(),this.originalFunc)}},{key:"recreateFuncFromSource",value:function(e,t){var r=[],n="$super"===this.firstParameter(e);for(var i in this.varMapping)this.varMapping.hasOwnProperty(i)&&("this"!=i?r.push("var "+i+" = this.varMapping."+i+";\n"):!0);var o="";r.length>0&&(o+=r.join("\n")),n&&(o+="(function superWrapperForClosure() { return "),o+="("+e+")",n&&(o+=".apply(this, [$super.bind(this)].concat(Array.from(arguments))) })");try{var a=evalJS.call(this,o)||this.couldNotCreateFunc(o);return this.addFuncProperties(a),this.originalFunc=a,a}catch(e){var s="Cannot create function "+e+" src: "+o;throw console.error(s),new Error(s)}}},{key:"addFuncProperties",value:function(e){var t=this.getFuncProperties();for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);this.addClosureInformation(e)}},{key:"couldNotCreateFunc",value:function(e){var t="Could not recreate closure from source: \n"+e;return console.error(t),function(){throw new Error(t)}}},{key:"asFunction",value:function(){return this.recreateFunc()}},{key:"addClosureInformation",value:function(e){return e.hasLivelyClosure=!0,e.livelyClosure=this,e}},{key:"isLivelyClosure",get:function(){return!0}},{key:"doNotSerialize",get:function(){return["originalFunc"]}}]),e}(),_throttledByName={},_debouncedByName={},_queues={},_queueUntilCallbacks={},_eitherNameRegistry={},fun=Object.freeze({Empty:Empty,K:K,Null:Null,False:False,True:True,notYetImplemented:notYetImplemented,withNull:withNull,all:all,own:own,argumentNames:argumentNames,qualifiedMethodName:qualifiedMethodName,extractBody:extractBody,timeToRun:timeToRun,timeToRunN:timeToRunN$1,delay:delay,throttle:throttle,debounce:debounce,throttleNamed:throttleNamed,debounceNamed:debounceNamed,createQueue:createQueue,workerWithCallbackQueue:workerWithCallbackQueue,composeAsync:composeAsync,compose:compose,waitFor:waitFor,waitForAll:waitForAll,flip:flip,curry:curry,wrap:wrap,binds:binds,getOriginal:getOriginal,wrapperChain:wrapperChain,replaceMethodForOneCall:replaceMethodForOneCall,once:once,either:either,eitherNamed:eitherNamed,evalJS:evalJS,fromString:fromString,asScript:asScript,asScriptOf:asScriptOf,addToObject:addToObject,setLocalVarValue:setLocalVarValue,getVarMapping:getVarMapping,setProperty:setProperty,functionNames:functionNames,localFunctionNames:localFunctionNames,logErrors:logErrors,logCompletion:logCompletion,logCalls:logCalls,traceCalls:traceCalls,webkitStack:webkitStack}),Group=function(){function e(){classCallCheck(this,e)}return createClass(e,[{key:"toArray",value:function(){return this.reduceGroups(function(e,t,r){return e.concat([r])},[])}},{key:"forEach",value:function(e,t){var r=this;return Object.keys(r).forEach(function(n){r[n].forEach(e.bind(t,n))}),r}},{key:"forEachGroup",value:function(e,t){var r=this;return Object.keys(r).forEach(function(n){e.call(t,n,r[n])}),r}},{key:"map",value:function(t,r){var n=new e;return this.forEachGroup(function(e,i){n[e]=i.map(t.bind(r,e))}),n}},{key:"mapGroups",value:function(t,r){var n=new e;return this.forEachGroup(function(e,i){n[e]=t.call(r,e,i)}),n}},{key:"keys",value:function(){return Object.keys(this)}},{key:"reduceGroups",value:function(e,t,r){return this.forEachGroup(function(n,i){t=e.call(r,t,n,i)}),t}},{key:"count",value:function(){return this.reduceGroups(function(e,t,r){return e[t]=r.length,e},{})}}],[{key:"fromArray",value:function(t,r,n){for(var i=new e,o=0,a=t.length;o<a;o++){var s=r.call(n,t[o],o);i[s]||(i[s]=[]),i[s].push(t[o])}return i}},{key:"by",get:function(){return groupBy}}]),e}(),GLOBAL$1="undefined"!=typeof System?System.global:"undefined"!=typeof window?window:global,features$1={from:!!Array.from,filter:!!Array.prototype.filter,find:!!Array.prototype.find,findIndex:!!Array.prototype.findIndex,includes:!!Array.prototype.includes},from=features$1.from?Array.from:function(e){if(!e)return[];if(Array.isArray(e))return e;if(e.toArray)return e.toArray();for(var t=e.length,r=new Array(t);t--;)r[t]=e[t];return r},detect=features$1.find?function(e,t,r){return e.find(t,r)}:function(e,t,r){for(var n,i=0,o=e.length;i<o;i++)if(n=e[i],t.call(r,n,i))return n},findIndex=features$1.findIndex?function(e,t,r){return e.findIndex(t,r)}:function(e,t,r){var n=-1;return e.find(function(e,i){return n=i,t.call(e,r)})?n:-1},isArray$1=Array.isArray,includes$1=features$1.includes?function(e,t){return e.includes(t)}:function(e,t){return-1!==e.indexOf(t)},include$1=includes$1,permutations=function(){function e(t,r){return t.length?flatmap(t,function(n,i){return e(t.slice(0,i).concat(t.slice(i+1)),r.concat([n]))}):[r]}return function(t){return e(t,[])}}();features$1.from||(Array.from=from),features$1.filter||(Array.prototype.filter=function(e,t){return filter(this,e,t)}),features$1.find||(Array.prototype.find=function(e,t){return detect(this,e,t)}),features$1.findIndex||(Array.prototype.findIndex=function(e,t){return findIndex(this,e,t)}),features$1.includes||(Array.prototype.includes=function(e){return includes$1(this,e)});var arr=Object.freeze({range:range,from:from,withN:withN,genN:genN,filter:filter,detect:detect,findIndex:findIndex,findAndGet:findAndGet,filterByKey:filterByKey,grep:grep,mask:mask,reject:reject,rejectByKey:rejectByKey,without:without,withoutAll:withoutAll,uniq:uniq,uniqBy:uniqBy,uniqByKey:uniqByKey,compact:compact,mutableCompact:mutableCompact,forEach:forEach$1,zip:zip,flatten:flatten,flatmap:flatmap,interpose:interpose,delimWith:delimWith,map:map$1,invoke:invoke,pluck:pluck,reduce:reduce,reduceRight:reduceRight,isArray:isArray$1,includes:includes$1,include:include$1,some:some,every:every,equals:equals$2,deepEquals:deepEquals,isSorted:isSorted,sort:sort,sortBy:sortBy,sortByKey:sortByKey,reverse:reverse,reversed:reversed,reMatches:reMatches$1,first:first,last:last,intersect:intersect,union:union,pushAt:pushAt,removeAt:removeAt,remove:remove,pushAll:pushAll$1,pushAllAt:pushAllAt,pushIfNotIncluded:pushIfNotIncluded,replaceAt:replaceAt,clear:clear,isSubset:isSubset,doAndContinue:doAndContinue,nestedDelay:nestedDelay,forEachShowingProgress:forEachShowingProgress,swap:swap,rotate:rotate,groupBy:groupBy,groupByKey:groupByKey,partition:partition,batchify:batchify,toTuples:toTuples,permutations:permutations,combinationsPick:combinationsPick,combinations:combinations,take:take,drop:drop,takeWhile:takeWhile,dropWhile:dropWhile,shuffle:shuffle,max:max,min:min,sum:sum,count:count$1,size:size$1,histogram:histogram,clone:clone$1,toArray:toArray$3,each:each,all:all$1,any:any,collect:collect,findAll:findAll,inject:inject,mapAsyncSeries:mapAsyncSeries,mapAsync:mapAsync}),keys$1=Object.keys,obj=Object.freeze({isArray:isArray$$1,isElement:isElement,isFunction:isFunction,isBoolean:isBoolean,isString:isString,isNumber:isNumber,isUndefined:isUndefined,isRegExp:isRegExp,isObject:isObject,isPrimitive:isPrimitive,isEmpty:isEmpty,equals:equals$1,keys:keys$1,values:values,select:select,dissoc:dissoc,addScript:addScript,extend:extend,clone:clone$$1,extract:extract,inspect:inspect,merge:merge,deepMerge:deepMerge,inherit:inherit,valuesInPropertyHierarchy:valuesInPropertyHierarchy,mergePropertyInHierarchy:mergePropertyInHierarchy,sortKeysWithBeforeAndAfterConstraints:sortKeysWithBeforeAndAfterConstraints,deepCopy:deepCopy,typeStringOf:typeStringOf,shortPrintStringOf:shortPrintStringOf,isMutableType:isMutableType,safeToString:safeToString,asObject:asObject,newKeyIn:newKeyIn}),features={repeat:!!String.prototype.repeat,includes:!!String.prototype.includes,startsWith:!!String.prototype.startsWith,endsWith:!!String.prototype.endsWith},pathDotRe=/\/\.\//g,pathDoubleDotRe=/\/[^\/]+\/\.\./,pathDoubleSlashRe=/(^|[^:])[\/]+/g,urlStartRe=/^[a-z0-9-_\.]+:\/\//,newUUIDTemplate="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",newUUIDRe=/[xy]/g,newUUIDReplacer=function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)},includes$$1=features.includes?function(e,t){return e.includes(t)}:function(e,t){return e.indexOf(t)>-1},include$$1=includes$$1,startsWith=features.startsWith?function(e,t){return e.startsWith(t)}:function(e,t){return 0===e.indexOf(t)},endsWith=features.endsWith?function(e,t){return e.endsWith(t)}:function(e,t){var r=e.length-t.length;return r>=0&&e.lastIndexOf(t)===r},times=features.repeat?function(e,t){return e.repeat(t)}:function(e,t){return t<1?"":new Array(t+1).join(e)},string=Object.freeze({format:format,formatFromArray:formatFromArray,indent:indent,minIndent:minIndent,changeIndent:changeIndent,quote:quote,print:print,printNested:printNested,pad:pad,printTable:printTable,printTree:printTree,toArray:toArray$1,lines:lines,paragraphs:paragraphs,nonEmptyLines:nonEmptyLines,tokens:tokens,tableize:tableize,unescapeCharacterEntities:unescapeCharacterEntities,toQueryParams:toQueryParams,normalizePath:normalizePath$1,joinPath:joinPath,newUUID:newUUID,createDataURI:createDataURI,hashCode:hashCode,md5:md5,reMatches:reMatches$$1,stringMatch:stringMatch,peekRight:peekRight,peekLeft:peekLeft,lineIndexComputer:lineIndexComputer,lineNumberToIndexesComputer:lineNumberToIndexesComputer,findLineWithIndexInLineRanges:findLineWithIndexInLineRanges,lineRanges:lineRanges,diff:diff,empty:empty,includes:includes$$1,include:include$$1,startsWith:startsWith,startsWithVowel:startsWithVowel,endsWith:endsWith,withDecimalPrecision:withDecimalPrecision,capitalize:capitalize,camelCaseString:camelCaseString,camelize:camelize,truncate:truncate,truncateLeft:truncateLeft,regExpEscape:regExpEscape,succ:succ,digitValue:digitValue,times:times,applyChange:applyChange,applyChanges:applyChanges,levenshtein:levenshtein}),normalRandom=function(e,t){var r,n=!1;return function(e,t){if(n)return n=!1,r*t+e;var i,o,a;do{a=(i=2*Math.random()-1)*i+(o=2*Math.random()-1)*o}while(a>=1||0==a);var s=Math.sqrt(-2*Math.log(a)/a);return r=o*s,n=!0,e+t*i*s}}(),convertLength=function(){function e(t,r){return"cm"===r?t:"mm"===r?.1*t:"in"===r?2.54*t:"px"===r?t*e(1/96,"in"):"pt"===r?t*e(1/72,"in"):"pc"===r?t*e(12,"pt"):void 0}return function t(r,n,i){return n===i?r:"cm"===i?e(r,n):"cm"===n?r/e(1,i):t(t(r,n,"cm"),"cm",i)}}(),num=Object.freeze({random:random,normalRandom:normalRandom,randomSmallerInteger:randomSmallerInteger,humanReadableByteSize:humanReadableByteSize,average:average,median:median,between:between,sort:sort$1,parseLength:parseLength,convertLength:convertLength,roundTo:roundTo,detent:detent,toDegrees:toDegrees,toRadians:toRadians,backoff:backoff}),properties=Object.freeze({all:all$2,allOwnPropertiesOrFunctions:allOwnPropertiesOrFunctions,own:own$1,forEachOwn:forEachOwn,nameFor:nameFor,values:values$1,ownValues:ownValues,any:any$1,allProperties:allProperties,hash:hash}),dateFormat=function(){var e=function(){var t=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,r=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,i=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e};return function(o,a,s){var u=e;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(o)||/\d/.test(o)||(a=o,o=void 0),o=o?new Date(o):new Date,isNaN(o))throw SyntaxError("invalid date");"UTC:"==(a=String(u.masks[a]||a||u.masks.default)).slice(0,4)&&(a=a.slice(4),s=!0);var c=s?"getUTC":"get",l=o[c+"Date"](),f=o[c+"Day"](),p=o[c+"Month"](),d=o[c+"FullYear"](),h=o[c+"Hours"](),m=o[c+"Minutes"](),v=o[c+"Seconds"](),y=o[c+"Milliseconds"](),g=s?0:o.getTimezoneOffset(),b={d:l,dd:i(l),ddd:u.i18n.dayNames[f],dddd:u.i18n.dayNames[f+7],m:p+1,mm:i(p+1),mmm:u.i18n.monthNames[p],mmmm:u.i18n.monthNames[p+12],yy:String(d).slice(2),yyyy:d,h:h%12||12,hh:i(h%12||12),H:h,HH:i(h),M:m,MM:i(m),s:v,ss:i(v),l:i(y,3),L:i(y>99?Math.round(y/10):y),t:h<12?"a":"p",tt:h<12?"am":"pm",T:h<12?"A":"P",TT:h<12?"AM":"PM",Z:s?"UTC":(String(o).match(r)||[""]).pop().replace(n,""),o:(g>0?"-":"+")+i(100*Math.floor(Math.abs(g)/60)+Math.abs(g)%60,4),S:["th","st","nd","rd"][l%10>3?0:(l%100-l%10!=10)*l%10]};return a.replace(t,function(e){return e in b?b[e]:e.slice(1,e.length-1)})}}();return e.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},e.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},e}(),date=Object.freeze({format:format$1,equals:equals$3,relativeTo:relativeTo});Object.assign(promise,{delay:delay$1,delayReject:delayReject,timeout:timeout,waitFor:waitFor$1,deferred:deferred,convertCallbackFun:convertCallbackFun,convertCallbackFunWithManyArgs:convertCallbackFunWithManyArgs,chain:chain$1,finally:promise_finally}),Object.assign(Path.prototype,{get isPathAccessor(){return!0},fromPath:function(e){return"string"==typeof e&&""!==e&&e!==this.splitter?(this._parts=e.split(this.splitter),this._path=e):Array.isArray(e)?(this._parts=[].concat(e),this._path=e.join(this.splitter)):(this._parts=[],this._path=""),this},setSplitter:function(e){return e&&(this.splitter=e),this},parts:function(){return this._parts},size:function(){return this._parts.length},slice:function(e,t){return Path(this.parts().slice(e,t))},normalizePath:function(){return this._path},isRoot:function(e){return 0===this._parts.length},isIn:function(e){if(this.isRoot())return!0;var t=this.get(e,-1);return t&&t.hasOwnProperty(this._parts[this._parts.length-1])},equals:function(e){return e&&e.isPathAccessor&&this.parts().equals(e.parts())},isParentPathOf:function(e){e=e&&e.isPathAccessor?e:Path(e);for(var t=this.parts(),r=e.parts(),n=0;n<t.length;n++)if(t[n]!=r[n])return!1;return!0},relativePathTo:function(e){return e=Path(e),this.isParentPathOf(e)?e.slice(this.size(),e.size()):void 0},del:function(e){if(this.isRoot())return!1;for(var t=e,r=0;r<this._parts.length-1;r++){var n=this._parts[r];if(!t.hasOwnProperty(n))return!1;t=t[n]}return delete t[this._parts[this._parts.length-1]]},withParentAndKeyDo:function(e,t,r){if(this.isRoot())return r(null,null);for(var n=e,i=0;i<this._parts.length-1;i++){var o=this._parts[i];if(!n.hasOwnProperty(o)||"object"!==_typeof(n[o])&&"function"!=typeof n[o]){if(!t)return r(null,o);n=n[o]={}}else n=n[o]}return r(n,this._parts[this._parts.length-1])},set:function(e,t,r){return this.withParentAndKeyDo(e,r,function(e,r){return e?e[r]=t:void 0})},defineProperty:function(e,t,r){return this.withParentAndKeyDo(e,r,function(e,r){return e?Object.defineProperty(e,r,t):void 0})},get:function(e,t){return(t?this._parts.slice(0,t):this._parts).reduce(function(e,t){return e?e[t]:e},e)},concat:function(e,t){return Path(this.parts().concat(Path(e,t).parts()))},toString:function(){return this.normalizePath()},serializeExpr:function(){return"lively.lang.Path("+inspect(this.parts())+")"},watch:function(e){if(e&&!this.isRoot()){var t=e.target,r=this.get(t,-1),n=this.parts().slice(-1)[0],i="propertyWatcher$"+n,o=r&&r.hasOwnProperty(i),a=e.uninstall,s=(e.haltWhenChanged,e.showStack),u=r.__lookupGetter__(n),c=r.__lookupSetter__(n);if(t&&n&&r)if(a){if(!o)return;delete r[n],r[n]=r[i],delete r[i];l="Watcher for "+r+"."+n+" uninstalled";show(l)}else if(o){l="Watcher for "+r+"."+n+" already installed";show(l)}else{if(u||c){l=r+'["'+n+'"] is a getter/setter, watching not support';return console.log(l),void("undefined"==typeof show&&show(l))}r[i]=r[n],r.__defineSetter__(n,function(t){var o=r[i];e.onSet&&e.onSet(t,o);var a=r+"."+n+" changed: "+o+" -> "+t;return s&&(a+="\n"+("undefined"!=typeof lively?lively.printStack():console.trace())),e.verbose&&(console.log(a),"undefined"!=typeof show&&show(a)),r[i]=t}),r.__defineGetter__(n,function(){return e.onGet&&e.onGet(r[i]),r[i]});var l="Watcher for "+r+"."+n+" installed";console.log(l),"undefined"!=typeof show&&show(l)}}},debugFunctionWrapper:function(e){var t=e.target,r=this.get(t,-1),n=this.parts().slice(-1)[0],i=e.uninstall,o=(void 0===e.haltWhenChanged||e.haltWhenChanged,e.showStack),a=r&&n&&r[n],s=a&&a.isDebugFunctionWrapper;if(t&&n&&a&&r){if(i){if(!s)return;r[n]=r[n].debugTargetFunction;c="Uninstalled debugFunctionWrapper for "+r+"."+n;return console.log(c),"undefined"!=typeof show&&show(c),void show(c)}if(s){c="debugFunctionWrapper for "+r+"."+n+" already installed";return console.log(c),void("undefined"!=typeof show&&show(c))}var u=r[n]=a.wrap(function(t){var i=Array.from(arguments);return o&&show(lively.printStack()),e.verbose&&show(n+" called"),i.shift().apply(r,i)});u.isDebugFunctionWrapper=!0,u.debugTargetFunction=a;var c="debugFunctionWrapper for "+r+"."+n+" installed";console.log(c),"undefined"!=typeof show&&show(c)}}});var graph=Object.freeze({clone:clone$2,without:without$1,hull:hull,subgraphReachableBy:subgraphReachableBy,invert:invert,sortByReference:sortByReference,reduce:reduce$1,random:random$1}),GLOBAL$2="undefined"!=typeof System?System.global:"undefined"!=typeof window?window:global,interval=Object.freeze({isInterval:isInterval,sort:sort$2,compare:compare,coalesce:coalesce,coalesceOverlapping:coalesceOverlapping,mergeOverlapping:mergeOverlapping,intervalsInRangeDo:intervalsInRangeDo,intervalsInbetween:intervalsInbetween,mapToMatchingIndexes:mapToMatchingIndexes}),arrayProjection=Object.freeze({create:create,toArray:toArray$4,originalToProjectedIndex:originalToProjectedIndex,projectedToOriginalIndex:projectedToOriginalIndex,transformToIncludeIndex:transformToIncludeIndex}),grid=Object.freeze({get:get$2,set:set$2,getRow:getRow,setRow:setRow,getCol:getCol,setCol:setCol,create:create$1,mapCreate:mapCreate,forEach:forEach$2,map:map$2,toObjects:toObjects,tableFromObjects:tableFromObjects}),detect$1=find,tree=Object.freeze({prewalk:prewalk,postwalk:postwalk,find:find,detect:detect$1,filter:filter$1,map:map$3,mapTree:mapTree}),isNode$1="undefined"!=typeof process&&process.versions&&process.versions.node,makeEmitter=isNode$1?function(e,t){if(e.on&&e.removeListener)return e;var r="undefined"!=typeof System?System._nodeRequire("events"):require("events");return Object.assign(e,r.EventEmitter.prototype),r.EventEmitter.call(e),t&&t.maxListenerLimit&&e.setMaxListeners(t.maxListenerLimit),e}:function(e){return e.on&&e.removeListener?e:(e.listeners={},e.on=function(t,r){r&&(e.listeners[t]||(e.listeners[t]=[]),e.listeners[t].push(r))},e.once=function(t,r){function n(){e.removeListener(t,n),r.apply(this,arguments)}r&&e.on(t,n)},e.removeListener=function(t,r){e.listeners[t]&&(e.listeners[t]=e.listeners[t].filter(function(e){return e!==r}))},e.removeAllListeners=function(t){e.listeners[t]&&(e.listeners[t]=[])},e.emit=function(){var t=Array.prototype.slice.call(arguments),r=t.shift(),n=e.listeners[r];n&&n.length&&n.forEach(function(e){try{e.apply(null,t)}catch(e){console.error("Error in event handler: %s",e.stack||String(e))}})},e)},events=Object.freeze({makeEmitter:makeEmitter}),OFFLINE="offline",ONLINE="online",messenger=Object.freeze({create:create$2}),isNodejs="undefined"!=typeof require&&"undefined"!=typeof process,WorkerSetup={loadDependenciesBrowser:function(e){var t="undefined"!=typeof self?self:this;importScripts.apply(t,e.scriptsToLoad||[])},loadDependenciesNodejs:function(e){(global.lively||(global.lively={})).lang=require(require("path").join(e.libLocation,"index"))},initBrowserGlobals:function(e){remoteWorker.send=function(e){postMessage(e)};var t="undefined"!=typeof self?self:this,r=t.Global=t;r.window=r,r.console=r.console||function(){var e={};return["log","error","warn"].forEach(function(t){e[t]=function(){for(var e=arguments[0],r=1;r<arguments.length;r++)e=e.replace("%s",arguments[r]);remoteWorker.send({type:t,message:["[",t.toUpperCase(),"] ",e].join("")})}}),e}()},initOnMessageHandler:function(e){function t(e){if(e=e.data.data?e.data:e,remoteWorker.messenger)remoteWorker.messenger.onMessage(e);else if("close"==e.action)return remoteWorker.send({type:"closed",workerReady:!1}),void remoteWorker.close()}remoteWorker.on?remoteWorker.on("message",t):remoteWorker.onmessage=t},initWorkerInterface:function initWorkerInterface(options){remoteWorker.callStringifiedFunction=function(stringifiedFunc,args,thenDo){var func;try{func=eval("("+stringifiedFunc+")")}catch(e){return void thenDo(new Error("Cannot create function from string: "+e.stack||e))}var usesCallback=func.length===args.length+1,whenDone=lively.lang.fun.once(function(e,t){remoteWorker.isBusy=!1,thenDo(e,t)});remoteWorker.isBusy=!0,usesCallback&&args.push(whenDone);try{var result=func.apply(remoteWorker,args.concat([whenDone]))}catch(e){return void whenDone(e,null)}usesCallback||whenDone(null,result)},remoteWorker.httpRequest=function(e){if(e.url){var t=new XMLHttpRequest,r=e.method||"GET";t.onreadystatechange=function(){4===t.readyState&&e.done&&e.done(t)},t.open(r,e.url),t.send()}else console.log("Error, httpRequest needs url")},remoteWorker.terminateIfNotBusyIn=function(e){setTimeout(function(){remoteWorker.isBusy?remoteWorker.terminateIfNotBusyIn(e):(remoteWorker.send({type:"closed",workerReady:!1}),remoteWorker.close())},e)}},initWorkerMessenger:function initWorkerMessenger(options){if(!options.useMessenger)return null;if(!lively.lang.messenger)throw new Error("worker.create requires messenger.js to be loaded!");if(!lively.lang.events)throw new Error("worker.create requires events.js to be loaded!");return remoteWorker.messenger=lively.lang.messenger.create({services:{remoteEval:function remoteEval(msg,messenger){var result;try{result=eval(msg.data.expr)}catch(e){result=e.stack||e}messenger.answer(msg,{result:String(result)})},run:function(e,t){var r=e.data.func,n=e.data.args;r?remoteWorker.callStringifiedFunction(r,n,function(r,n){t.answer(e,{error:r?String(r):null,result:n})}):t.answer(e,{error:"no funcString"})},close:function(e,t){t.answer(e,{status:"OK"}),remoteWorker.send({type:"closed",workerReady:!1}),remoteWorker.close()}},isOnline:function(){return!0},send:function(e,t){remoteWorker.send(e),t()},listen:function(e){e()},close:function(e){remoteWorker.send({type:"closed",workerReady:!1}),remoteWorker.close()}})}},BrowserWorker={create:function(e){if(!(e=e||{}).libLocation&&!e.scriptsToLoad){var t=document.querySelector('script[src$="worker.js"]');if(!t)throw new Error('Cannot find library path to start worker. Use worker.create({libLocation: "..."}) to explicitly define the path!');e.libLocation=t.src.replace(/worker.js$/,"")}var r="("+String(function(){self.onmessage=function(e){if("setup"!==e.data.action)throw new Error("expected setup to be first message but got "+JSON.stringify(e.data));var t=e.data.options||{};initBrowserGlobals(t),loadDependenciesBrowser(t),initOnMessageHandler(t),initWorkerInterface(t),initWorkerMessenger(t),postMessage({workerReady:!0})},__FUNCTIONDECLARATIONS__}).replace("__FUNCTIONDECLARATIONS__",[WorkerSetup.initBrowserGlobals,WorkerSetup.loadDependenciesBrowser,WorkerSetup.initOnMessageHandler,WorkerSetup.initWorkerInterface,WorkerSetup.initWorkerMessenger].join("\n"))+")();",n=new Worker(function(e){var t;try{t=new Blob([e],{type:"text/javascript"})}catch(r){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,(t=new BlobBuilder).append(e),t=t.getBlob()}return("undefined"!=typeof webkitURL?webkitURL:URL).createObjectURL(t)}(r));return function(e,t){makeEmitter(t),e.scriptsToLoad||(e.scriptsToLoad=["base.js","events.js","object.js","collection.js","function.js","string.js","number.js","date.js","messenger.js","worker.js"].map(function(t){return e.libLocation+t}));var r=Object.keys(e).reduce(function(t,r){return"function"!=typeof e[r]&&(t[r]=e[r]),t},{});t.onmessage=function(e){void 0!==e.data.workerReady?(t.ready=!!e.data.workerReady,t.ready?t.emit("ready"):t.emit("close")):t.emit("message",e.data)},t.errors=[],t.onerror=function(e){console.error(e),t.errors.push(e),t.emit("error",e)},t.postMessage({action:"setup",options:r})}(e,n),n}},NodejsWorker={debug:!1,initCodeFileCreated:!1,create:function(e){e=e||{};var t,r=makeEmitter({ready:!1,errors:[],postMessage:function(e){t?r.ready?t.send(e):r.emit("error",new Error("nodejs worker process not ready or already closed")):r.emit("error",new Error("nodejs worker process not yet created"))}});return NodejsWorker.startWorker(e,function(e,n){if(e)return r.ready=!1,void r.emit("error",e);(t=n).on("message",function(e){NodejsWorker.debug&&console.log("[WORKER PARENT] got message:",e),r.emit("message",e)}),t.on("close",function(){console.log("[WORKER PARENT] worker closed"),r.emit("close")}),t.on("error",function(e){console.log("[WORKER PARENT] error ",e),r.errors.push(e),r.emit("error",e)}),r.ready=!0,r.emit("ready")}),r},workerSetupFunction:function(){var e=process;console.log("[WORKER] Starting init"),e.on("message",function(t){if("setup"!==t.action)throw new Error("expected setup to be first message but got "+JSON.stringify(t.data));e.removeAllListeners("message");var r=t.data.options||{};console.log("[WORKER] running setup with options",r),loadDependenciesNodejs(r),initOnMessageHandler(r),initWorkerInterface(r),initWorkerMessenger(r),e.send({workerReady:!0})}),__FUNCTIONDECLARATIONS__},ensureInitCodeFile:function(e,t,r){var n=require("path"),i=require("os"),o=require("fs"),a=n.join(i.tmpDir(),"lively-nodejs-workers/"),s=n.join(a,"nodejs-worker-init.js");NodejsWorker.initCodeFileCreated?o.exists(s,function(n){n?r(null,s):NodejsWorker.createWorkerCodeFile(e,s,t,r)}):NodejsWorker.createWorkerCodeFile(e,s,t,r)},createWorkerCodeFile:function(e,t,r,n){var i=require("path"),o=require("fs");(0,require("child_process").exec)("mkdir -p "+i.dirname(t),function(e,i,a){e?n(new Error(["[WORKER PARENT] Could not create worker temp dir:",i,a].join("\n"))):o.writeFile(t,r,function(e){NodejsWorker.debug&&console.log("worker code file %s created",t),NodejsWorker.initCodeFileCreated=!0,n(e,t)})})},startWorker:function(e,t){var r=require("util"),n=require("child_process").fork,i=String(NodejsWorker.workerSetupFunction).replace("__FUNCTIONDECLARATIONS__",[WorkerSetup.loadDependenciesNodejs,WorkerSetup.initOnMessageHandler,WorkerSetup.initWorkerInterface,WorkerSetup.initWorkerMessenger].join("\n")),o=r.format("(%s)();\n",i);NodejsWorker.ensureInitCodeFile(e,o,function(r,i){if(r)return t(r);var o=n(i,{});NodejsWorker.debug&&console.log("worker forked"),o.on("message",function(e){"pong"===e.action?console.log("[WORKER pong] ",e):"log"===e.action&&console.log("[Message from WORKER] ",e.data)}),o.once("message",function(e){NodejsWorker.debug&&console.log("worker setup done"),t(null,o,e)}),o.on("close",function(){NodejsWorker.debug&&console.log("[WORKER PARENT] worker closed")}),o.send({action:"setup",data:{options:e}}),global.WORKER=o})}},worker=Object.freeze({fork:fork,create:create$3}),GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:void 0,isNode="undefined"!=typeof process&&process.env&&"function"==typeof process.exit,globalInterfaceSpec=[{action:"installMethods",target:"Array",sources:["arr"],methods:["from","genN","range","withN"]},{action:"installMethods",target:"Array.prototype",sources:["arr"],methods:["all","any","batchify","clear","clone","collect","compact","delimWith","detect","doAndContinue","each","equals","filterByKey","findAll","first","flatten","forEachShowingProgress","grep","groupBy","groupByKey","histogram","include","inject","intersect","invoke","last","mapAsync","mapAsyncSeries","mask","max","min","mutableCompact","nestedDelay","partition","pluck","pushAll","pushAllAt","pushAt","pushIfNotIncluded","reMatches","reject","rejectByKey","remove","removeAt","replaceAt","rotate","shuffle","size","sortBy","sortByKey","sum","swap","toArray","toTuples","union","uniq","uniqBy","without","withoutAll","zip"],alias:[["select","filter"]]},{action:"installMethods",target:"Date",sources:["date"],methods:[]},{action:"installMethods",target:"Date.prototype",sources:["date"],methods:["equals","format","relativeTo"]},{action:"installMethods",target:"Function",sources:["fun"],methods:["fromString"]},{action:"installMethods",target:"Function.prototype",sources:["fun"],methods:["addToObject","argumentNames","asScript","asScriptOf","binds","curry","delay","functionNames","localFunctionNames","getOriginal","getVarMapping","logCalls","logCompletion","logErrors","qualifiedMethodName","setProperty","traceCalls","wrap"]},{action:"installMethods",target:"Number",sources:["num"],methods:[]},{action:"installMethods",target:"Number.prototype",sources:["num"],methods:["detent","randomSmallerInteger","roundTo","toDegrees","toRadians"]},{action:"installMethods",target:"Object",sources:["obj"],methods:["addScript","clone","deepCopy","extend","inherit","isArray","isBoolean","isElement","isEmpty","isFunction","isNumber","isObject","isRegExp","isString","isUndefined","merge","mergePropertyInHierarchy","values","valuesInPropertyHierarchy"]},{action:"installMethods",target:"Object.prototype",sources:["obj"],methods:[]},{action:"installMethods",target:"String.prototype",sources:["string"],methods:["camelize","capitalize","digitValue","empty","hashCode","include","pad","regExpEscape","startsWithVowel","succ","times","toArray","toQueryParams","truncate"]},{action:"installObject",target:"Numbers",source:"num",methods:["average","between","convertLength","humanReadableByteSize","median","normalRandom","parseLength","random","sort"]},{action:"installObject",target:"Properties",source:"properties",methods:["all","allOwnPropertiesOrFunctions","allProperties","any","forEachOwn","hash","nameFor","own","ownValues","values"]},{action:"installObject",target:"Strings",source:"string",methods:["camelCaseString","createDataURI","diff","format","formatFromArray","indent","lineIndexComputer","lines","md5","newUUID","nonEmptyLines","pad","paragraphs","peekLeft","peekRight","print","printNested","printTable","printTree","quote","reMatches","stringMatch","tableize","tokens","unescapeCharacterEntities","withDecimalPrecision"]},{action:"installObject",target:"Objects",source:"obj",methods:["asObject","equals","inspect","isMutableType","safeToString","shortPrintStringOf","typeStringOf"]},{action:"installObject",target:"Functions",source:"fun",methods:["all","compose","composeAsync","createQueue","debounce","debounceNamed","either","extractBody","flip","notYetImplemented","once","own","throttle","throttleNamed","timeToRun","timeToRunN","waitFor","workerWithCallbackQueue","wrapperChain"]},{action:"installObject",target:"Grid",source:"grid"},{action:"installObject",target:"Interval",source:"interval"},{action:"installObject",target:"lively.ArrayProjection",source:"arrayProjection"},{action:"installObject",target:"lively.Closure",source:"Closure"},{action:"installObject",target:"lively.Grouping",source:"Group"},{action:"installObject",target:"lively.PropertyPath",source:"Path"},{action:"installObject",target:"lively.Worker",source:"worker"},{action:"installObject",target:"lively.Class",source:"classHelper"}],livelyLang=createLivelyLangObject();exports.worker=worker,exports.messenger=messenger,exports.events=events,exports.tree=tree,exports.grid=grid,exports.arrayProjection=arrayProjection,exports.interval=interval,exports.graph=graph,exports.date=date,exports.properties=properties,exports.obj=obj,exports.arr=arr,exports.fun=fun,exports.num=num,exports.string=string,exports.Closure=Closure,exports.promise=promise,exports.Path=Path,exports.Group=Group,exports.livelyLang=livelyLang,exports.chain=chain$$1,exports.noConflict=noConflict,exports.installGlobals=installGlobals,exports.uninstallGlobals=uninstallGlobals}(this.lively.lang=this.lively.lang||{})}.call(GLOBAL),"undefined"!=typeof module&&module.exports&&(module.exports=GLOBAL.lively.lang)}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(e,t){"use strict";function r(e){if(void 0===e){if("undefined"==typeof System)return void 0!==o?o:o||(o={emitter:t.events.makeEmitter({},{maxListenerLimit:1e4}),notifications:[]});e=System}var r=e.get("@lively-env");r||e.set("@lively-env",e.newModule({options:{}}));var n=r.options;if(!n)throw new Error("@lively-env registered read-only");return n.emitter||Object.assign(n,{emitter:e["__lively.notifications_emitter"]||(e["__lively.notifications_emitter"]=t.events.makeEmitter({},{maxListenerLimit:1e4})),notifications:e["__lively.notifications_notifications"]||(e["__lively.notifications_notifications"]=[])}),{emitter:n.emitter,notifications:n.notifications}}function n(e,t){e.push(t),e.limit&&e.splice(0,e.length-e.limit)}function i(e){var r=e.type+" ".repeat(Math.max(0,32-e.type.length));console.log(r+" "+t.obj.inspect(e,{maxDepth:2}))}var o=void 0;e.subscribe=function(e,t,n){return r(n).emitter.on(e,t),t},e.subscribeOnce=function(e,t,n){return r(n).emitter.once(e,t),t},e.emit=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),a=arguments[3],s=Object.assign({type:e,time:o},t),u=r(a),c=u.emitter,l=u.notifications;return c.emit(e,s),c.isLogging&&i(s),c.isRecording&&n(l,s),s},e.unsubscribe=function(e,t,n){return r(n).emitter.removeListener(e,t),t},e.unsubscribeAll=function(e,t){r(t).emitter.removeAllListeners(e)},e.startRecording=function(e){r(e).emitter.isRecording=!0},e.stopRecording=function(e){r(e).emitter.isRecording=!1},e.clearRecord=function(e){var t=r(e).notifications;t.splice(0,t.length)},e.getRecord=function(e){return r(e).notifications},e.startLogging=function(e){r(e).emitter.isLogging=!0},e.stopLogging=function(e){r(e).emitter.isLogging=!1}}(this.lively.notifications=this.lively.notifications||{},lively.lang),"undefined"!=typeof module&&module.exports&&(module.exports=e.lively.classes)}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;if(e.define){var t=e;delete e.define}!function(){var e=void 0;!function(){var e=void 0;(function(t,r){"function"==typeof e&&e.amd?e(["exports"],r):r(t.acorn=t.acorn||{})})(this,function(e){"use strict";function t(e,t){for(var r=65536,n=0;n<t.length;n+=2){if((r+=t[n])>e)return!1;if((r+=t[n+1])>=e)return!0}}function r(e,r){return e<65?36===e:e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&w.test(String.fromCharCode(e)):!1!==r&&t(e,k)))}function n(e,r){return e<48?36===e:e<58||!(e<65)&&(e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&x.test(String.fromCharCode(e)):!1!==r&&(t(e,k)||t(e,E)))))}function i(e,t){return new S(e,{beforeExpr:!0,binop:t})}function o(e,t){return void 0===t&&(t={}),t.keyword=e,C[e]=new S(e,t)}function a(e){return 10===e||13===e||8232===e||8233===e}function s(e){return"[object Array]"===Object.prototype.toString.call(e)}function u(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function c(e,t){for(var r=1,n=0;;){j.lastIndex=n;var i=j.exec(e);if(!(i&&i.index<t))return new P(r,t-n);++r,n=i.index+i[0].length}}function l(e){var t={};for(var r in I)t[r]=e&&u(e,r)?e[r]:I[r];if(t.ecmaVersion>=2015&&(t.ecmaVersion-=2009),null==t.allowReserved&&(t.allowReserved=t.ecmaVersion<5),s(t.onToken)){var n=t.onToken;t.onToken=function(e){return n.push(e)}}return s(t.onComment)&&(t.onComment=f(t,t.onComment)),t}function f(e,t){return function(r,n,i,o,a,s){var u={type:r?"Block":"Line",value:n,start:i,end:o};e.locations&&(u.loc=new T(this,a,s)),e.ranges&&(u.range=[i,o]),t.push(u)}}function p(e){return new RegExp("^("+e.replace(/ /g,"|")+")$")}function d(e,t,r,n){return e.type=t,e.end=r,this.options.locations&&(e.loc.end=n),this.options.ranges&&(e.range[1]=r),e}function h(e,t,r,n){try{return new RegExp(e,t)}catch(e){if(void 0!==r)throw e instanceof SyntaxError&&n.raise(r,"Error parsing regular expression: "+e.message),e}}function m(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}var v={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},y="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",g={5:y,6:y+" const class extends export import super"},b="-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",_="-------------------------------------------------------------------------------------------------------------------------------------------------",w=new RegExp("["+b+"]"),x=new RegExp("["+b+_+"]");b=_=null;var k=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,17,26,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,26,45,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,785,52,76,44,33,24,27,35,42,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,54,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,86,25,391,63,32,0,449,56,264,8,2,36,18,0,50,29,881,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,881,68,12,0,67,12,65,0,32,6124,20,754,9486,1,3071,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,4149,196,60,67,1213,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42710,42,4148,12,221,3,5761,10591,541],E=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,1306,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,52,0,13,2,49,13,10,2,4,9,83,11,7,0,161,11,6,9,7,3,57,0,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,87,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,423,9,838,7,2,7,17,9,57,21,2,13,19882,9,135,4,60,6,26,9,1016,45,17,3,19723,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,2214,6,110,6,6,9,792487,239],S=function(e,t){void 0===t&&(t={}),this.label=e,this.keyword=t.keyword,this.beforeExpr=!!t.beforeExpr,this.startsExpr=!!t.startsExpr,this.isLoop=!!t.isLoop,this.isAssign=!!t.isAssign,this.prefix=!!t.prefix,this.postfix=!!t.postfix,this.binop=t.binop||null,this.updateContext=null},A={beforeExpr:!0},D={startsExpr:!0},C={},F={num:new S("num",D),regexp:new S("regexp",D),string:new S("string",D),name:new S("name",D),eof:new S("eof"),bracketL:new S("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new S("]"),braceL:new S("{",{beforeExpr:!0,startsExpr:!0}),braceR:new S("}"),parenL:new S("(",{beforeExpr:!0,startsExpr:!0}),parenR:new S(")"),comma:new S(",",A),semi:new S(";",A),colon:new S(":",A),dot:new S("."),question:new S("?",A),arrow:new S("=>",A),template:new S("template"),ellipsis:new S("...",A),backQuote:new S("`",D),dollarBraceL:new S("${",{beforeExpr:!0,startsExpr:!0}),eq:new S("=",{beforeExpr:!0,isAssign:!0}),assign:new S("_=",{beforeExpr:!0,isAssign:!0}),incDec:new S("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new S("prefix",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:i("||",1),logicalAND:i("&&",2),bitwiseOR:i("|",3),bitwiseXOR:i("^",4),bitwiseAND:i("&",5),equality:i("==/!=",6),relational:i("</>",7),bitShift:i("<</>>",8),plusMin:new S("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:i("%",10),star:i("*",10),slash:i("/",10),starstar:new S("**",{beforeExpr:!0}),_break:o("break"),_case:o("case",A),_catch:o("catch"),_continue:o("continue"),_debugger:o("debugger"),_default:o("default",A),_do:o("do",{isLoop:!0,beforeExpr:!0}),_else:o("else",A),_finally:o("finally"),_for:o("for",{isLoop:!0}),_function:o("function",D),_if:o("if"),_return:o("return",A),_switch:o("switch"),_throw:o("throw",A),_try:o("try"),_var:o("var"),_const:o("const"),_while:o("while",{isLoop:!0}),_with:o("with"),_new:o("new",{beforeExpr:!0,startsExpr:!0}),_this:o("this",D),_super:o("super",D),_class:o("class"),_extends:o("extends",A),_export:o("export"),_import:o("import"),_null:o("null",D),_true:o("true",D),_false:o("false",D),_in:o("in",{beforeExpr:!0,binop:7}),_instanceof:o("instanceof",{beforeExpr:!0,binop:7}),_typeof:o("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:o("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:o("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},O=/\r\n?|\n|\u2028|\u2029/,j=new RegExp(O.source,"g"),B=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,R=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,P=function(e,t){this.line=e,this.column=t};P.prototype.offset=function(e){return new P(this.line,this.column+e)};var T=function(e,t,r){this.start=t,this.end=r,null!==e.sourceFile&&(this.source=e.sourceFile)},I={ecmaVersion:7,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1,plugins:{}},L={},N=function(e,t,r){this.options=e=l(e),this.sourceFile=e.sourceFile,this.keywords=p(g[e.ecmaVersion>=6?6:5]);var n="";if(!e.allowReserved){for(var i=e.ecmaVersion;!(n=v[i]);i--);"module"==e.sourceType&&(n+=" await")}this.reservedWords=p(n);var o=(n?n+" ":"")+v.strict;this.reservedWordsStrict=p(o),this.reservedWordsStrictBind=p(o+" "+v.strictBind),this.input=String(t),this.containsEsc=!1,this.loadPlugins(e.plugins),r?(this.pos=r,this.lineStart=this.input.lastIndexOf("\n",r-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(O).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=F.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===e.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.inFunction=this.inGenerator=this.inAsync=!1,this.yieldPos=this.awaitPos=0,this.labels=[],0===this.pos&&e.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2)};N.prototype.isKeyword=function(e){return this.keywords.test(e)},N.prototype.isReservedWord=function(e){return this.reservedWords.test(e)},N.prototype.extend=function(e,t){this[e]=t(this[e])},N.prototype.loadPlugins=function(e){var t=this;for(var r in e){var n=L[r];if(!n)throw new Error("Plugin '"+r+"' not found");n(t,e[r])}},N.prototype.parse=function(){var e=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(e)};var M=N.prototype,q=/^(?:'((?:[^\']|\.)*)'|"((?:[^\"]|\.)*)"|;)/;M.strictDirective=function(e){for(var t=this;;){R.lastIndex=e,e+=R.exec(t.input)[0].length;var r=q.exec(t.input.slice(e));if(!r)return!1;if("use strict"==(r[1]||r[2]))return!0;e+=r[0].length}},M.eat=function(e){return this.type===e&&(this.next(),!0)},M.isContextual=function(e){return this.type===F.name&&this.value===e},M.eatContextual=function(e){return this.value===e&&this.eat(F.name)},M.expectContextual=function(e){this.eatContextual(e)||this.unexpected()},M.canInsertSemicolon=function(){return this.type===F.eof||this.type===F.braceR||O.test(this.input.slice(this.lastTokEnd,this.start))},M.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},M.semicolon=function(){this.eat(F.semi)||this.insertSemicolon()||this.unexpected()},M.afterTrailingComma=function(e,t){if(this.type==e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),t||this.next(),!0},M.expect=function(e){this.eat(e)||this.unexpected()},M.unexpected=function(e){this.raise(null!=e?e:this.start,"Unexpected token")};var W=function(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=-1};M.checkPatternErrors=function(e,t){if(e){e.trailingComma>-1&&this.raiseRecoverable(e.trailingComma,"Comma is not permitted after the rest element");var r=t?e.parenthesizedAssign:e.parenthesizedBind;r>-1&&this.raiseRecoverable(r,"Parenthesized pattern")}},M.checkExpressionErrors=function(e,t){var r=e?e.shorthandAssign:-1;if(!t)return r>=0;r>-1&&this.raise(r,"Shorthand property assignments are valid only in destructuring patterns")},M.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},M.isSimpleAssignTarget=function(e){return"ParenthesizedExpression"===e.type?this.isSimpleAssignTarget(e.expression):"Identifier"===e.type||"MemberExpression"===e.type};var $=N.prototype;$.parseTopLevel=function(e){var t=this,r={};for(e.body||(e.body=[]);this.type!==F.eof;){var n=t.parseStatement(!0,!0,r);e.body.push(n)}return this.next(),this.options.ecmaVersion>=6&&(e.sourceType=this.options.sourceType),this.finishNode(e,"Program")};var U={kind:"loop"},z={kind:"switch"};$.isLet=function(){if(this.type!==F.name||this.options.ecmaVersion<6||"let"!=this.value)return!1;R.lastIndex=this.pos;var e=R.exec(this.input),t=this.pos+e[0].length,i=this.input.charCodeAt(t);if(91===i||123==i)return!0;if(r(i,!0)){for(var o=t+1;n(this.input.charCodeAt(o),!0);++o);var a=this.input.slice(t,o);if(!this.isKeyword(a))return!0}return!1},$.isAsyncFunction=function(){if(this.type!==F.name||this.options.ecmaVersion<8||"async"!=this.value)return!1;R.lastIndex=this.pos;var e=R.exec(this.input),t=this.pos+e[0].length;return!(O.test(this.input.slice(this.pos,t))||"function"!==this.input.slice(t,t+8)||t+8!=this.input.length&&n(this.input.charAt(t+8)))},$.parseStatement=function(e,t,r){var n,i=this.type,o=this.startNode();switch(this.isLet()&&(i=F._var,n="let"),i){case F._break:case F._continue:return this.parseBreakContinueStatement(o,i.keyword);case F._debugger:return this.parseDebuggerStatement(o);case F._do:return this.parseDoStatement(o);case F._for:return this.parseForStatement(o);case F._function:return!e&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(o,!1);case F._class:return e||this.unexpected(),this.parseClass(o,!0);case F._if:return this.parseIfStatement(o);case F._return:return this.parseReturnStatement(o);case F._switch:return this.parseSwitchStatement(o);case F._throw:return this.parseThrowStatement(o);case F._try:return this.parseTryStatement(o);case F._const:case F._var:return n=n||this.value,e||"var"==n||this.unexpected(),this.parseVarStatement(o,n);case F._while:return this.parseWhileStatement(o);case F._with:return this.parseWithStatement(o);case F.braceL:return this.parseBlock();case F.semi:return this.parseEmptyStatement(o);case F._export:case F._import:return this.options.allowImportExportEverywhere||(t||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===F._import?this.parseImport(o):this.parseExport(o,r);default:if(this.isAsyncFunction()&&e)return this.next(),this.parseFunctionStatement(o,!0);var a=this.value,s=this.parseExpression();return i===F.name&&"Identifier"===s.type&&this.eat(F.colon)?this.parseLabeledStatement(o,a,s):this.parseExpressionStatement(o,s)}},$.parseBreakContinueStatement=function(e,t){var r=this,n="break"==t;this.next(),this.eat(F.semi)||this.insertSemicolon()?e.label=null:this.type!==F.name?this.unexpected():(e.label=this.parseIdent(),this.semicolon());for(var i=0;i<this.labels.length;++i){var o=r.labels[i];if(null==e.label||o.name===e.label.name){if(null!=o.kind&&(n||"loop"===o.kind))break;if(e.label&&n)break}}return i===this.labels.length&&this.raise(e.start,"Unsyntactic "+t),this.finishNode(e,n?"BreakStatement":"ContinueStatement")},$.parseDebuggerStatement=function(e){return this.next(),this.semicolon(),this.finishNode(e,"DebuggerStatement")},$.parseDoStatement=function(e){return this.next(),this.labels.push(U),e.body=this.parseStatement(!1),this.labels.pop(),this.expect(F._while),e.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(F.semi):this.semicolon(),this.finishNode(e,"DoWhileStatement")},$.parseForStatement=function(e){if(this.next(),this.labels.push(U),this.expect(F.parenL),this.type===F.semi)return this.parseFor(e,null);var t=this.isLet();if(this.type===F._var||this.type===F._const||t){var r=this.startNode(),n=t?"let":this.value;return this.next(),this.parseVar(r,!0,n),this.finishNode(r,"VariableDeclaration"),!(this.type===F._in||this.options.ecmaVersion>=6&&this.isContextual("of"))||1!==r.declarations.length||"var"!==n&&r.declarations[0].init?this.parseFor(e,r):this.parseForIn(e,r)}var i=new W,o=this.parseExpression(!0,i);return this.type===F._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.toAssignable(o),this.checkLVal(o),this.checkPatternErrors(i,!0),this.parseForIn(e,o)):(this.checkExpressionErrors(i,!0),this.parseFor(e,o))},$.parseFunctionStatement=function(e,t){return this.next(),this.parseFunction(e,!0,!1,t)},$.isFunction=function(){return this.type===F._function||this.isAsyncFunction()},$.parseIfStatement=function(e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement(!this.strict&&this.isFunction()),e.alternate=this.eat(F._else)?this.parseStatement(!this.strict&&this.isFunction()):null,this.finishNode(e,"IfStatement")},$.parseReturnStatement=function(e){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(F.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,"ReturnStatement")},$.parseSwitchStatement=function(e){var t=this;this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(F.braceL),this.labels.push(z);for(var r,n=!1;this.type!=F.braceR;)if(t.type===F._case||t.type===F._default){var i=t.type===F._case;r&&t.finishNode(r,"SwitchCase"),e.cases.push(r=t.startNode()),r.consequent=[],t.next(),i?r.test=t.parseExpression():(n&&t.raiseRecoverable(t.lastTokStart,"Multiple default clauses"),n=!0,r.test=null),t.expect(F.colon)}else r||t.unexpected(),r.consequent.push(t.parseStatement(!0));return r&&this.finishNode(r,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(e,"SwitchStatement")},$.parseThrowStatement=function(e){return this.next(),O.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,"ThrowStatement")};var V=[];$.parseTryStatement=function(e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===F._catch){var t=this.startNode();this.next(),this.expect(F.parenL),t.param=this.parseBindingAtom(),this.checkLVal(t.param,!0),this.expect(F.parenR),t.body=this.parseBlock(),e.handler=this.finishNode(t,"CatchClause")}return e.finalizer=this.eat(F._finally)?this.parseBlock():null,e.handler||e.finalizer||this.raise(e.start,"Missing catch or finally clause"),this.finishNode(e,"TryStatement")},$.parseVarStatement=function(e,t){return this.next(),this.parseVar(e,!1,t),this.semicolon(),this.finishNode(e,"VariableDeclaration")},$.parseWhileStatement=function(e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(U),e.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(e,"WhileStatement")},$.parseWithStatement=function(e){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement(!1),this.finishNode(e,"WithStatement")},$.parseEmptyStatement=function(e){return this.next(),this.finishNode(e,"EmptyStatement")},$.parseLabeledStatement=function(e,t,r){for(var n=this,i=0;i<this.labels.length;++i)n.labels[i].name===t&&n.raise(r.start,"Label '"+t+"' is already declared");for(var o=this.type.isLoop?"loop":this.type===F._switch?"switch":null,a=this.labels.length-1;a>=0;a--){var s=n.labels[a];if(s.statementStart!=e.start)break;s.statementStart=n.start,s.kind=o}return this.labels.push({name:t,kind:o,statementStart:this.start}),e.body=this.parseStatement(!0),("ClassDeclaration"==e.body.type||"VariableDeclaration"==e.body.type&&(this.strict||"var"!=e.body.kind)||"FunctionDeclaration"==e.body.type&&(this.strict||e.body.generator))&&this.raiseRecoverable(e.body.start,"Invalid labeled declaration"),this.labels.pop(),e.label=r,this.finishNode(e,"LabeledStatement")},$.parseExpressionStatement=function(e,t){return e.expression=t,this.semicolon(),this.finishNode(e,"ExpressionStatement")},$.parseBlock=function(){var e=this,t=this.startNode();for(t.body=[],this.expect(F.braceL);!this.eat(F.braceR);){var r=e.parseStatement(!0);t.body.push(r)}return this.finishNode(t,"BlockStatement")},$.parseFor=function(e,t){return e.init=t,this.expect(F.semi),e.test=this.type===F.semi?null:this.parseExpression(),this.expect(F.semi),e.update=this.type===F.parenR?null:this.parseExpression(),this.expect(F.parenR),e.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(e,"ForStatement")},$.parseForIn=function(e,t){var r=this.type===F._in?"ForInStatement":"ForOfStatement";return this.next(),e.left=t,e.right=this.parseExpression(),this.expect(F.parenR),e.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(e,r)},$.parseVar=function(e,t,r){var n=this;for(e.declarations=[],e.kind=r;;){var i=n.startNode();if(n.parseVarId(i),n.eat(F.eq)?i.init=n.parseMaybeAssign(t):"const"!==r||n.type===F._in||n.options.ecmaVersion>=6&&n.isContextual("of")?"Identifier"==i.id.type||t&&(n.type===F._in||n.isContextual("of"))?i.init=null:n.raise(n.lastTokEnd,"Complex binding patterns require an initialization value"):n.unexpected(),e.declarations.push(n.finishNode(i,"VariableDeclarator")),!n.eat(F.comma))break}return e},$.parseVarId=function(e){e.id=this.parseBindingAtom(),this.checkLVal(e.id,!0)},$.parseFunction=function(e,t,r,n){this.initFunction(e),this.options.ecmaVersion>=6&&!n&&(e.generator=this.eat(F.star)),this.options.ecmaVersion>=8&&(e.async=!!n),null==t&&(t=this.type==F.name),t&&(e.id=this.parseIdent());var i=this.inGenerator,o=this.inAsync,a=this.yieldPos,s=this.awaitPos,u=this.inFunction;return this.inGenerator=e.generator,this.inAsync=e.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,t||this.type!==F.name||(e.id=this.parseIdent()),this.parseFunctionParams(e),this.parseFunctionBody(e,r),this.inGenerator=i,this.inAsync=o,this.yieldPos=a,this.awaitPos=s,this.inFunction=u,this.finishNode(e,t?"FunctionDeclaration":"FunctionExpression")},$.parseFunctionParams=function(e){this.expect(F.parenL),e.params=this.parseBindingList(F.parenR,!1,this.options.ecmaVersion>=8,!0),this.checkYieldAwaitInDefaultParams()},$.parseClass=function(e,t){var r=this;this.next(),null==t&&(t=this.type===F.name),this.parseClassId(e,t),this.parseClassSuper(e);var n=this.startNode(),i=!1;for(n.body=[],this.expect(F.braceL);!this.eat(F.braceR);)if(!r.eat(F.semi)){var o=r.startNode(),a=r.eat(F.star),s=!1,u=r.type===F.name&&"static"===r.value;r.parsePropertyName(o),o.static=u&&r.type!==F.parenL,o.static&&(a&&r.unexpected(),a=r.eat(F.star),r.parsePropertyName(o)),r.options.ecmaVersion>=8&&!a&&!o.computed&&"Identifier"===o.key.type&&"async"===o.key.name&&r.type!==F.parenL&&!r.canInsertSemicolon()&&(s=!0,r.parsePropertyName(o)),o.kind="method";var c=!1;if(!o.computed){var l=o.key;a||s||"Identifier"!==l.type||r.type===F.parenL||"get"!==l.name&&"set"!==l.name||(c=!0,o.kind=l.name,l=r.parsePropertyName(o)),!o.static&&("Identifier"===l.type&&"constructor"===l.name||"Literal"===l.type&&"constructor"===l.value)&&(i&&r.raise(l.start,"Duplicate constructor in the same class"),c&&r.raise(l.start,"Constructor can't have get/set modifier"),a&&r.raise(l.start,"Constructor can't be a generator"),s&&r.raise(l.start,"Constructor can't be an async method"),o.kind="constructor",i=!0)}if(r.parseClassMethod(n,o,a,s),c){var f="get"===o.kind?0:1;if(o.value.params.length!==f){var p=o.value.start;"get"===o.kind?r.raiseRecoverable(p,"getter should have no params"):r.raiseRecoverable(p,"setter should have exactly one param")}else"set"===o.kind&&"RestElement"===o.value.params[0].type&&r.raiseRecoverable(o.value.params[0].start,"Setter cannot use rest params")}}return e.body=this.finishNode(n,"ClassBody"),this.finishNode(e,t?"ClassDeclaration":"ClassExpression")},$.parseClassMethod=function(e,t,r,n){t.value=this.parseMethod(r,n),e.body.push(this.finishNode(t,"MethodDefinition"))},$.parseClassId=function(e,t){e.id=this.type===F.name?this.parseIdent():t?this.unexpected():null},$.parseClassSuper=function(e){e.superClass=this.eat(F._extends)?this.parseExprSubscripts():null},$.parseExport=function(e,t){var r=this;if(this.next(),this.eat(F.star))return this.expectContextual("from"),e.source=this.type===F.string?this.parseExprAtom():this.unexpected(),this.semicolon(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(F._default)){this.checkExport(t,"default",this.lastTokStart);var n;if(this.type===F._function||(n=this.isAsyncFunction())){var i=this.startNode();this.next(),n&&this.next(),e.declaration=this.parseFunction(i,null,!1,n)}else if(this.type===F._class){var o=this.startNode();e.declaration=this.parseClass(o,null)}else e.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(e,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())e.declaration=this.parseStatement(!0),"VariableDeclaration"===e.declaration.type?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id.name,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual("from"))e.source=this.type===F.string?this.parseExprAtom():this.unexpected();else{for(var a=0;a<e.specifiers.length;a++)(r.keywords.test(e.specifiers[a].local.name)||r.reservedWords.test(e.specifiers[a].local.name))&&r.unexpected(e.specifiers[a].local.start);e.source=null}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")},$.checkExport=function(e,t,r){e&&(Object.prototype.hasOwnProperty.call(e,t)&&this.raiseRecoverable(r,"Duplicate export '"+t+"'"),e[t]=!0)},$.checkPatternExport=function(e,t){var r=this,n=t.type;if("Identifier"==n)this.checkExport(e,t.name,t.start);else if("ObjectPattern"==n)for(var i=0;i<t.properties.length;++i)r.checkPatternExport(e,t.properties[i].value);else if("ArrayPattern"==n)for(var o=0;o<t.elements.length;++o){var a=t.elements[o];a&&r.checkPatternExport(e,a)}else"AssignmentPattern"==n?this.checkPatternExport(e,t.left):"ParenthesizedExpression"==n&&this.checkPatternExport(e,t.expression)},$.checkVariableExport=function(e,t){var r=this;if(e)for(var n=0;n<t.length;n++)r.checkPatternExport(e,t[n].id)},$.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},$.parseExportSpecifiers=function(e){var t=this,r=[],n=!0;for(this.expect(F.braceL);!this.eat(F.braceR);){if(n)n=!1;else if(t.expect(F.comma),t.afterTrailingComma(F.braceR))break;var i=t.startNode();i.local=t.parseIdent(!0),i.exported=t.eatContextual("as")?t.parseIdent(!0):i.local,t.checkExport(e,i.exported.name,i.exported.start),r.push(t.finishNode(i,"ExportSpecifier"))}return r},$.parseImport=function(e){return this.next(),this.type===F.string?(e.specifiers=V,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===F.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(e,"ImportDeclaration")},$.parseImportSpecifiers=function(){var e=this,t=[],r=!0;if(this.type===F.name){var n=this.startNode();if(n.local=this.parseIdent(),this.checkLVal(n.local,!0),t.push(this.finishNode(n,"ImportDefaultSpecifier")),!this.eat(F.comma))return t}if(this.type===F.star){var i=this.startNode();return this.next(),this.expectContextual("as"),i.local=this.parseIdent(),this.checkLVal(i.local,!0),t.push(this.finishNode(i,"ImportNamespaceSpecifier")),t}for(this.expect(F.braceL);!this.eat(F.braceR);){if(r)r=!1;else if(e.expect(F.comma),e.afterTrailingComma(F.braceR))break;var o=e.startNode();o.imported=e.parseIdent(!0),e.eatContextual("as")?o.local=e.parseIdent():(o.local=o.imported,e.isKeyword(o.local.name)&&e.unexpected(o.local.start),e.reservedWordsStrict.test(o.local.name)&&e.raiseRecoverable(o.local.start,"The keyword '"+o.local.name+"' is reserved")),e.checkLVal(o.local,!0),t.push(e.finishNode(o,"ImportSpecifier"))}return t};var G=N.prototype;G.toAssignable=function(e,t){var r=this;if(this.options.ecmaVersion>=6&&e)switch(e.type){case"Identifier":this.inAsync&&"await"===e.name&&this.raise(e.start,"Can not use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":break;case"ObjectExpression":e.type="ObjectPattern";for(var n=0;n<e.properties.length;n++){var i=e.properties[n];"init"!==i.kind&&r.raise(i.key.start,"Object pattern can't contain getter or setter"),r.toAssignable(i.value,t)}break;case"ArrayExpression":e.type="ArrayPattern",this.toAssignableList(e.elements,t);break;case"AssignmentExpression":if("="!==e.operator){this.raise(e.left.end,"Only '=' operator can be used for specifying default value.");break}e.type="AssignmentPattern",delete e.operator,this.toAssignable(e.left,t);case"AssignmentPattern":break;case"ParenthesizedExpression":e.expression=this.toAssignable(e.expression,t);break;case"MemberExpression":if(!t)break;default:this.raise(e.start,"Assigning to rvalue")}return e},G.toAssignableList=function(e,t){var r=this,n=e.length;if(n){var i=e[n-1];if(i&&"RestElement"==i.type)--n;else if(i&&"SpreadElement"==i.type){i.type="RestElement";var o=i.argument;this.toAssignable(o,t),"Identifier"!==o.type&&"MemberExpression"!==o.type&&"ArrayPattern"!==o.type&&this.unexpected(o.start),--n}t&&i&&"RestElement"===i.type&&"Identifier"!==i.argument.type&&this.unexpected(i.argument.start)}for(var a=0;a<n;a++){var s=e[a];s&&r.toAssignable(s,t)}return e},G.parseSpread=function(e){var t=this.startNode();return this.next(),t.argument=this.parseMaybeAssign(!1,e),this.finishNode(t,"SpreadElement")},G.parseRest=function(e){var t=this.startNode();return this.next(),t.argument=e?this.type===F.name?this.parseIdent():this.unexpected():this.type===F.name||this.type===F.bracketL?this.parseBindingAtom():this.unexpected(),this.finishNode(t,"RestElement")},G.parseBindingAtom=function(){if(this.options.ecmaVersion<6)return this.parseIdent();switch(this.type){case F.name:return this.parseIdent();case F.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(F.bracketR,!0,!0),this.finishNode(e,"ArrayPattern");case F.braceL:return this.parseObj(!0);default:this.unexpected()}},G.parseBindingList=function(e,t,r,n){for(var i=this,o=[],a=!0;!this.eat(e);)if(a?a=!1:i.expect(F.comma),t&&i.type===F.comma)o.push(null);else{if(r&&i.afterTrailingComma(e))break;if(i.type===F.ellipsis){var s=i.parseRest(n);i.parseBindingListItem(s),o.push(s),i.type===F.comma&&i.raise(i.start,"Comma is not permitted after the rest element"),i.expect(e);break}var u=i.parseMaybeDefault(i.start,i.startLoc);i.parseBindingListItem(u),o.push(u)}return o},G.parseBindingListItem=function(e){return e},G.parseMaybeDefault=function(e,t,r){if(r=r||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(F.eq))return r;var n=this.startNodeAt(e,t);return n.left=r,n.right=this.parseMaybeAssign(),this.finishNode(n,"AssignmentPattern")},G.checkLVal=function(e,t,r){var n=this;switch(e.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(t?"Binding ":"Assigning to ")+e.name+" in strict mode"),r&&(u(r,e.name)&&this.raiseRecoverable(e.start,"Argument name clash"),r[e.name]=!0);break;case"MemberExpression":t&&this.raiseRecoverable(e.start,(t?"Binding":"Assigning to")+" member expression");break;case"ObjectPattern":for(var i=0;i<e.properties.length;i++)n.checkLVal(e.properties[i].value,t,r);break;case"ArrayPattern":for(var o=0;o<e.elements.length;o++){var a=e.elements[o];a&&n.checkLVal(a,t,r)}break;case"AssignmentPattern":this.checkLVal(e.left,t,r);break;case"RestElement":this.checkLVal(e.argument,t,r);break;case"ParenthesizedExpression":this.checkLVal(e.expression,t,r);break;default:this.raise(e.start,(t?"Binding":"Assigning to")+" rvalue")}};var H=N.prototype;H.checkPropClash=function(e,t){if(!(this.options.ecmaVersion>=6&&(e.computed||e.method||e.shorthand))){var r,n=e.key;switch(n.type){case"Identifier":r=n.name;break;case"Literal":r=String(n.value);break;default:return}var i=e.kind;if(this.options.ecmaVersion>=6)"__proto__"===r&&"init"===i&&(t.proto&&this.raiseRecoverable(n.start,"Redefinition of __proto__ property"),t.proto=!0);else{var o=t[r="$"+r];if(o){var a="init"!==i;(!this.strict&&!a||!o[i])&&a^o.init||this.raiseRecoverable(n.start,"Redefinition of property")}else o=t[r]={init:!1,get:!1,set:!1};o[i]=!0}}},H.parseExpression=function(e,t){var r=this,n=this.start,i=this.startLoc,o=this.parseMaybeAssign(e,t);if(this.type===F.comma){var a=this.startNodeAt(n,i);for(a.expressions=[o];this.eat(F.comma);)a.expressions.push(r.parseMaybeAssign(e,t));return this.finishNode(a,"SequenceExpression")}return o},H.parseMaybeAssign=function(e,t,r){if(this.inGenerator&&this.isContextual("yield"))return this.parseYield();var n=!1,i=-1;t?(i=t.parenthesizedAssign,t.parenthesizedAssign=-1):(t=new W,n=!0);var o=this.start,a=this.startLoc;this.type!=F.parenL&&this.type!=F.name||(this.potentialArrowAt=this.start);var s=this.parseMaybeConditional(e,t);if(r&&(s=r.call(this,s,o,a)),this.type.isAssign){this.checkPatternErrors(t,!0),n||W.call(t);var u=this.startNodeAt(o,a);return u.operator=this.value,u.left=this.type===F.eq?this.toAssignable(s):s,t.shorthandAssign=-1,this.checkLVal(s),this.next(),u.right=this.parseMaybeAssign(e),this.finishNode(u,"AssignmentExpression")}return n&&this.checkExpressionErrors(t,!0),i>-1&&(t.parenthesizedAssign=i),s},H.parseMaybeConditional=function(e,t){var r=this.start,n=this.startLoc,i=this.parseExprOps(e,t);if(this.checkExpressionErrors(t))return i;if(this.eat(F.question)){var o=this.startNodeAt(r,n);return o.test=i,o.consequent=this.parseMaybeAssign(),this.expect(F.colon),o.alternate=this.parseMaybeAssign(e),this.finishNode(o,"ConditionalExpression")}return i},H.parseExprOps=function(e,t){var r=this.start,n=this.startLoc,i=this.parseMaybeUnary(t,!1);return this.checkExpressionErrors(t)?i:this.parseExprOp(i,r,n,-1,e)},H.parseExprOp=function(e,t,r,n,i){var o=this.type.binop;if(null!=o&&(!i||this.type!==F._in)&&o>n){var a=this.type===F.logicalOR||this.type===F.logicalAND,s=this.value;this.next();var u=this.start,c=this.startLoc,l=this.parseExprOp(this.parseMaybeUnary(null,!1),u,c,o,i),f=this.buildBinary(t,r,e,l,s,a);return this.parseExprOp(f,t,r,n,i)}return e},H.buildBinary=function(e,t,r,n,i,o){var a=this.startNodeAt(e,t);return a.left=r,a.operator=i,a.right=n,this.finishNode(a,o?"LogicalExpression":"BinaryExpression")},H.parseMaybeUnary=function(e,t){var r,n=this,i=this.start,o=this.startLoc;if(this.inAsync&&this.isContextual("await"))r=this.parseAwait(e),t=!0;else if(this.type.prefix){var a=this.startNode(),s=this.type===F.incDec;a.operator=this.value,a.prefix=!0,this.next(),a.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(e,!0),s?this.checkLVal(a.argument):this.strict&&"delete"===a.operator&&"Identifier"===a.argument.type?this.raiseRecoverable(a.start,"Deleting local variable in strict mode"):t=!0,r=this.finishNode(a,s?"UpdateExpression":"UnaryExpression")}else{if(r=this.parseExprSubscripts(e),this.checkExpressionErrors(e))return r;for(;this.type.postfix&&!this.canInsertSemicolon();){var u=n.startNodeAt(i,o);u.operator=n.value,u.prefix=!1,u.argument=r,n.checkLVal(r),n.next(),r=n.finishNode(u,"UpdateExpression")}}return!t&&this.eat(F.starstar)?this.buildBinary(i,o,r,this.parseMaybeUnary(null,!1),"**",!1):r},H.parseExprSubscripts=function(e){var t=this.start,r=this.startLoc,n=this.parseExprAtom(e),i="ArrowFunctionExpression"===n.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd);if(this.checkExpressionErrors(e)||i)return n;var o=this.parseSubscripts(n,t,r);return e&&"MemberExpression"===o.type&&(e.parenthesizedAssign>=o.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=o.start&&(e.parenthesizedBind=-1)),o},H.parseSubscripts=function(e,t,r,n){for(var i,o=this,a=this.options.ecmaVersion>=8&&"Identifier"===e.type&&"async"===e.name&&this.lastTokEnd==e.end&&!this.canInsertSemicolon();;)if((i=o.eat(F.bracketL))||o.eat(F.dot)){var s=o.startNodeAt(t,r);s.object=e,s.property=i?o.parseExpression():o.parseIdent(!0),s.computed=!!i,i&&o.expect(F.bracketR),e=o.finishNode(s,"MemberExpression")}else if(!n&&o.eat(F.parenL)){var u=new W,c=o.yieldPos,l=o.awaitPos;o.yieldPos=0,o.awaitPos=0;var f=o.parseExprList(F.parenR,o.options.ecmaVersion>=8,!1,u);if(a&&!o.canInsertSemicolon()&&o.eat(F.arrow))return o.checkPatternErrors(u,!1),o.checkYieldAwaitInDefaultParams(),o.yieldPos=c,o.awaitPos=l,o.parseArrowExpression(o.startNodeAt(t,r),f,!0);o.checkExpressionErrors(u,!0),o.yieldPos=c||o.yieldPos,o.awaitPos=l||o.awaitPos;var p=o.startNodeAt(t,r);p.callee=e,p.arguments=f,e=o.finishNode(p,"CallExpression")}else{if(o.type!==F.backQuote)return e;var d=o.startNodeAt(t,r);d.tag=e,d.quasi=o.parseTemplate(),e=o.finishNode(d,"TaggedTemplateExpression")}},H.parseExprAtom=function(e){var t,r=this.potentialArrowAt==this.start;switch(this.type){case F._super:this.inFunction||this.raise(this.start,"'super' outside of function or class");case F._this:var n=this.type===F._this?"ThisExpression":"Super";return t=this.startNode(),this.next(),this.finishNode(t,n);case F.name:var i=this.start,o=this.startLoc,a=this.parseIdent(this.type!==F.name);if(this.options.ecmaVersion>=8&&"async"===a.name&&!this.canInsertSemicolon()&&this.eat(F._function))return this.parseFunction(this.startNodeAt(i,o),!1,!1,!0);if(r&&!this.canInsertSemicolon()){if(this.eat(F.arrow))return this.parseArrowExpression(this.startNodeAt(i,o),[a],!1);if(this.options.ecmaVersion>=8&&"async"===a.name&&this.type===F.name)return a=this.parseIdent(),!this.canInsertSemicolon()&&this.eat(F.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(i,o),[a],!0)}return a;case F.regexp:var s=this.value;return t=this.parseLiteral(s.value),t.regex={pattern:s.pattern,flags:s.flags},t;case F.num:case F.string:return this.parseLiteral(this.value);case F._null:case F._true:case F._false:return t=this.startNode(),t.value=this.type===F._null?null:this.type===F._true,t.raw=this.type.keyword,this.next(),this.finishNode(t,"Literal");case F.parenL:var u=this.start,c=this.parseParenAndDistinguishExpression(r);return e&&(e.parenthesizedAssign<0&&!this.isSimpleAssignTarget(c)&&(e.parenthesizedAssign=u),e.parenthesizedBind<0&&(e.parenthesizedBind=u)),c;case F.bracketL:return t=this.startNode(),this.next(),t.elements=this.parseExprList(F.bracketR,!0,!0,e),this.finishNode(t,"ArrayExpression");case F.braceL:return this.parseObj(!1,e);case F._function:return t=this.startNode(),this.next(),this.parseFunction(t,!1);case F._class:return this.parseClass(this.startNode(),!1);case F._new:return this.parseNew();case F.backQuote:return this.parseTemplate();default:this.unexpected()}},H.parseLiteral=function(e){var t=this.startNode();return t.value=e,t.raw=this.input.slice(this.start,this.end),this.next(),this.finishNode(t,"Literal")},H.parseParenExpression=function(){this.expect(F.parenL);var e=this.parseExpression();return this.expect(F.parenR),e},H.parseParenAndDistinguishExpression=function(e){var t,r=this,n=this.start,i=this.startLoc,o=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var a,s,u=this.start,c=this.startLoc,l=[],f=!0,p=!1,d=new W,h=this.yieldPos,m=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==F.parenR;){if(f?f=!1:r.expect(F.comma),o&&r.afterTrailingComma(F.parenR,!0)){p=!0;break}if(r.type===F.ellipsis){a=r.start,l.push(r.parseParenItem(r.parseRest())),r.type===F.comma&&r.raise(r.start,"Comma is not permitted after the rest element");break}r.type!==F.parenL||s||(s=r.start),l.push(r.parseMaybeAssign(!1,d,r.parseParenItem))}var v=this.start,y=this.startLoc;if(this.expect(F.parenR),e&&!this.canInsertSemicolon()&&this.eat(F.arrow))return this.checkPatternErrors(d,!1),this.checkYieldAwaitInDefaultParams(),s&&this.unexpected(s),this.yieldPos=h,this.awaitPos=m,this.parseParenArrowList(n,i,l);l.length&&!p||this.unexpected(this.lastTokStart),a&&this.unexpected(a),this.checkExpressionErrors(d,!0),this.yieldPos=h||this.yieldPos,this.awaitPos=m||this.awaitPos,l.length>1?((t=this.startNodeAt(u,c)).expressions=l,this.finishNodeAt(t,"SequenceExpression",v,y)):t=l[0]}else t=this.parseParenExpression();if(this.options.preserveParens){var g=this.startNodeAt(n,i);return g.expression=t,this.finishNode(g,"ParenthesizedExpression")}return t},H.parseParenItem=function(e){return e},H.parseParenArrowList=function(e,t,r){return this.parseArrowExpression(this.startNodeAt(e,t),r)};var J=[];H.parseNew=function(){var e=this.startNode(),t=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(F.dot))return e.meta=t,e.property=this.parseIdent(!0),"target"!==e.property.name&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is new.target"),this.inFunction||this.raiseRecoverable(e.start,"new.target can only be used in functions"),this.finishNode(e,"MetaProperty");var r=this.start,n=this.startLoc;return e.callee=this.parseSubscripts(this.parseExprAtom(),r,n,!0),this.eat(F.parenL)?e.arguments=this.parseExprList(F.parenR,this.options.ecmaVersion>=8,!1):e.arguments=J,this.finishNode(e,"NewExpression")},H.parseTemplateElement=function(){var e=this.startNode();return e.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),e.tail=this.type===F.backQuote,this.finishNode(e,"TemplateElement")},H.parseTemplate=function(){var e=this,t=this.startNode();this.next(),t.expressions=[];var r=this.parseTemplateElement();for(t.quasis=[r];!r.tail;)e.expect(F.dollarBraceL),t.expressions.push(e.parseExpression()),e.expect(F.braceR),t.quasis.push(r=e.parseTemplateElement());return this.next(),this.finishNode(t,"TemplateLiteral")},H.parseObj=function(e,t){var r=this,n=this.startNode(),i=!0,o={};for(n.properties=[],this.next();!this.eat(F.braceR);){if(i)i=!1;else if(r.expect(F.comma),r.afterTrailingComma(F.braceR))break;var a,s,u,c,l=r.startNode();r.options.ecmaVersion>=6&&(l.method=!1,l.shorthand=!1,(e||t)&&(u=r.start,c=r.startLoc),e||(a=r.eat(F.star))),r.parsePropertyName(l),e||!(r.options.ecmaVersion>=8)||a||l.computed||"Identifier"!==l.key.type||"async"!==l.key.name||r.type===F.parenL||r.type===F.colon||r.canInsertSemicolon()?s=!1:(s=!0,r.parsePropertyName(l,t)),r.parsePropertyValue(l,e,a,s,u,c,t),r.checkPropClash(l,o),n.properties.push(r.finishNode(l,"Property"))}return this.finishNode(n,e?"ObjectPattern":"ObjectExpression")},H.parsePropertyValue=function(e,t,r,n,i,o,a){if((r||n)&&this.type===F.colon&&this.unexpected(),this.eat(F.colon))e.value=t?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),e.kind="init";else if(this.options.ecmaVersion>=6&&this.type===F.parenL)t&&this.unexpected(),e.kind="init",e.method=!0,e.value=this.parseMethod(r,n);else if(this.options.ecmaVersion>=5&&!e.computed&&"Identifier"===e.key.type&&("get"===e.key.name||"set"===e.key.name)&&this.type!=F.comma&&this.type!=F.braceR){(r||n||t)&&this.unexpected(),e.kind=e.key.name,this.parsePropertyName(e),e.value=this.parseMethod(!1);var s="get"===e.kind?0:1;if(e.value.params.length!==s){var u=e.value.start;"get"===e.kind?this.raiseRecoverable(u,"getter should have no params"):this.raiseRecoverable(u,"setter should have exactly one param")}else"set"===e.kind&&"RestElement"===e.value.params[0].type&&this.raiseRecoverable(e.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!e.computed&&"Identifier"===e.key.type?((this.keywords.test(e.key.name)||(this.strict?this.reservedWordsStrict:this.reservedWords).test(e.key.name)||this.inGenerator&&"yield"==e.key.name||this.inAsync&&"await"==e.key.name)&&this.raiseRecoverable(e.key.start,"'"+e.key.name+"' can not be used as shorthand property"),e.kind="init",t?e.value=this.parseMaybeDefault(i,o,e.key):this.type===F.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),e.value=this.parseMaybeDefault(i,o,e.key)):e.value=e.key,e.shorthand=!0):this.unexpected()},H.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(F.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(F.bracketR),e.key;e.computed=!1}return e.key=this.type===F.num||this.type===F.string?this.parseExprAtom():this.parseIdent(!0)},H.initFunction=function(e){e.id=null,this.options.ecmaVersion>=6&&(e.generator=!1,e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)},H.parseMethod=function(e,t){var r=this.startNode(),n=this.inGenerator,i=this.inAsync,o=this.yieldPos,a=this.awaitPos,s=this.inFunction;return this.initFunction(r),this.options.ecmaVersion>=6&&(r.generator=e),this.options.ecmaVersion>=8&&(r.async=!!t),this.inGenerator=r.generator,this.inAsync=r.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,this.expect(F.parenL),r.params=this.parseBindingList(F.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(r,!1),this.inGenerator=n,this.inAsync=i,this.yieldPos=o,this.awaitPos=a,this.inFunction=s,this.finishNode(r,"FunctionExpression")},H.parseArrowExpression=function(e,t,r){var n=this.inGenerator,i=this.inAsync,o=this.yieldPos,a=this.awaitPos,s=this.inFunction;return this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!r),this.inGenerator=!1,this.inAsync=e.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,e.params=this.toAssignableList(t,!0),this.parseFunctionBody(e,!0),this.inGenerator=n,this.inAsync=i,this.yieldPos=o,this.awaitPos=a,this.inFunction=s,this.finishNode(e,"ArrowFunctionExpression")},H.parseFunctionBody=function(e,t){var r=t&&this.type!==F.braceL,n=this.strict,i=!1;if(r)e.body=this.parseMaybeAssign(),e.expression=!0;else{var o=this.options.ecmaVersion>=7&&!this.isSimpleParamList(e.params);n&&!o||(i=this.strictDirective(this.end))&&o&&this.raiseRecoverable(e.start,"Illegal 'use strict' directive in function with non-simple parameter list");var a=this.labels;this.labels=[],i&&(this.strict=!0),e.body=this.parseBlock(!0),e.expression=!1,this.labels=a}n||i?(this.strict=!0,e.id&&this.checkLVal(e.id,!0),this.checkParams(e),this.strict=n):!t&&this.isSimpleParamList(e.params)||this.checkParams(e)},H.isSimpleParamList=function(e){for(var t=0;t<e.length;t++)if("Identifier"!==e[t].type)return!1;return!0},H.checkParams=function(e){for(var t=this,r={},n=0;n<e.params.length;n++)t.checkLVal(e.params[n],!0,r)},H.parseExprList=function(e,t,r,n){for(var i=this,o=[],a=!0;!this.eat(e);){if(a)a=!1;else if(i.expect(F.comma),t&&i.afterTrailingComma(e))break;var s;r&&i.type===F.comma?s=null:i.type===F.ellipsis?(s=i.parseSpread(n),n&&i.type===F.comma&&n.trailingComma<0&&(n.trailingComma=i.start)):s=i.parseMaybeAssign(!1,n),o.push(s)}return o},H.parseIdent=function(e){var t=this.startNode();return e&&"never"==this.options.allowReserved&&(e=!1),this.type===F.name?(!e&&(this.strict?this.reservedWordsStrict:this.reservedWords).test(this.value)&&(this.options.ecmaVersion>=6||-1==this.input.slice(this.start,this.end).indexOf("\\"))&&this.raiseRecoverable(this.start,"The keyword '"+this.value+"' is reserved"),this.inGenerator&&"yield"===this.value&&this.raiseRecoverable(this.start,"Can not use 'yield' as identifier inside a generator"),this.inAsync&&"await"===this.value&&this.raiseRecoverable(this.start,"Can not use 'await' as identifier inside an async function"),t.name=this.value):e&&this.type.keyword?t.name=this.type.keyword:this.unexpected(),this.next(),this.finishNode(t,"Identifier")},H.parseYield=function(){this.yieldPos||(this.yieldPos=this.start);var e=this.startNode();return this.next(),this.type==F.semi||this.canInsertSemicolon()||this.type!=F.star&&!this.type.startsExpr?(e.delegate=!1,e.argument=null):(e.delegate=this.eat(F.star),e.argument=this.parseMaybeAssign()),this.finishNode(e,"YieldExpression")},H.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!0),this.finishNode(e,"AwaitExpression")};var K=N.prototype;K.raise=function(e,t){var r=c(this.input,e);t+=" ("+r.line+":"+r.column+")";var n=new SyntaxError(t);throw n.pos=e,n.loc=r,n.raisedAt=this.pos,n},K.raiseRecoverable=K.raise,K.curPosition=function(){if(this.options.locations)return new P(this.curLine,this.pos-this.lineStart)};var Y=function(e,t,r){this.type="",this.start=t,this.end=0,e.options.locations&&(this.loc=new T(e,r)),e.options.directSourceFile&&(this.sourceFile=e.options.directSourceFile),e.options.ranges&&(this.range=[t,0])},Q=N.prototype;Q.startNode=function(){return new Y(this,this.start,this.startLoc)},Q.startNodeAt=function(e,t){return new Y(this,e,t)},Q.finishNode=function(e,t){return d.call(this,e,t,this.lastTokEnd,this.lastTokEndLoc)},Q.finishNodeAt=function(e,t,r,n){return d.call(this,e,t,r,n)};var X=function(e,t,r,n){this.token=e,this.isExpr=!!t,this.preserveSpace=!!r,this.override=n},Z={b_stat:new X("{",!1),b_expr:new X("{",!0),b_tmpl:new X("${",!0),p_stat:new X("(",!1),p_expr:new X("(",!0),q_tmpl:new X("`",!0,!0,function(e){return e.readTmplToken()}),f_expr:new X("function",!0)},ee=N.prototype;ee.initialContext=function(){return[Z.b_stat]},ee.braceIsBlock=function(e){if(e===F.colon){var t=this.curContext();if(t===Z.b_stat||t===Z.b_expr)return!t.isExpr}return e===F._return?O.test(this.input.slice(this.lastTokEnd,this.start)):e===F._else||e===F.semi||e===F.eof||e===F.parenR||(e==F.braceL?this.curContext()===Z.b_stat:!this.exprAllowed)},ee.updateContext=function(e){var t,r=this.type;r.keyword&&e==F.dot?this.exprAllowed=!1:(t=r.updateContext)?t.call(this,e):this.exprAllowed=r.beforeExpr},F.parenR.updateContext=F.braceR.updateContext=function(){if(1!=this.context.length){var e=this.context.pop();e===Z.b_stat&&this.curContext()===Z.f_expr?(this.context.pop(),this.exprAllowed=!1):this.exprAllowed=e===Z.b_tmpl||!e.isExpr}else this.exprAllowed=!0},F.braceL.updateContext=function(e){this.context.push(this.braceIsBlock(e)?Z.b_stat:Z.b_expr),this.exprAllowed=!0},F.dollarBraceL.updateContext=function(){this.context.push(Z.b_tmpl),this.exprAllowed=!0},F.parenL.updateContext=function(e){var t=e===F._if||e===F._for||e===F._with||e===F._while;this.context.push(t?Z.p_stat:Z.p_expr),this.exprAllowed=!0},F.incDec.updateContext=function(){},F._function.updateContext=function(e){e.beforeExpr&&e!==F.semi&&e!==F._else&&(e!==F.colon&&e!==F.braceL||this.curContext()!==Z.b_stat)&&this.context.push(Z.f_expr),this.exprAllowed=!1},F.backQuote.updateContext=function(){this.curContext()===Z.q_tmpl?this.context.pop():this.context.push(Z.q_tmpl),this.exprAllowed=!1};var te=function(e){this.type=e.type,this.value=e.value,this.start=e.start,this.end=e.end,e.options.locations&&(this.loc=new T(e,e.startLoc,e.endLoc)),e.options.ranges&&(this.range=[e.start,e.end])},re=N.prototype,ne="object"==typeof Packages&&"[object JavaPackage]"==Object.prototype.toString.call(Packages);re.next=function(){this.options.onToken&&this.options.onToken(new te(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},re.getToken=function(){return this.next(),new te(this)},"undefined"!=typeof Symbol&&(re[Symbol.iterator]=function(){var e=this;return{next:function(){var t=e.getToken();return{done:t.type===F.eof,value:t}}}}),re.curContext=function(){return this.context[this.context.length-1]},re.nextToken=function(){var e=this.curContext();return e&&e.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(F.eof):e.override?e.override(this):void this.readToken(this.fullCharCodeAtPos())},re.readToken=function(e){return r(e,this.options.ecmaVersion>=6)||92===e?this.readWord():this.getTokenFromCode(e)},re.fullCharCodeAtPos=function(){var e=this.input.charCodeAt(this.pos);return e<=55295||e>=57344?e:(e<<10)+this.input.charCodeAt(this.pos+1)-56613888},re.skipBlockComment=function(){var e=this,t=this.options.onComment&&this.curPosition(),r=this.pos,n=this.input.indexOf("*/",this.pos+=2);if(-1===n&&this.raise(this.pos-2,"Unterminated comment"),this.pos=n+2,this.options.locations){j.lastIndex=r;for(var i;(i=j.exec(this.input))&&i.index<this.pos;)++e.curLine,e.lineStart=i.index+i[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(r+2,n),r,this.pos,t,this.curPosition())},re.skipLineComment=function(e){for(var t=this,r=this.pos,n=this.options.onComment&&this.curPosition(),i=this.input.charCodeAt(this.pos+=e);this.pos<this.input.length&&10!==i&&13!==i&&8232!==i&&8233!==i;)++t.pos,i=t.input.charCodeAt(t.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(r+e,this.pos),r,this.pos,n,this.curPosition())},re.skipSpace=function(){var e=this;e:for(;this.pos<this.input.length;){var t=e.input.charCodeAt(e.pos);switch(t){case 32:case 160:++e.pos;break;case 13:10===e.input.charCodeAt(e.pos+1)&&++e.pos;case 10:case 8232:case 8233:++e.pos,e.options.locations&&(++e.curLine,e.lineStart=e.pos);break;case 47:switch(e.input.charCodeAt(e.pos+1)){case 42:e.skipBlockComment();break;case 47:e.skipLineComment(2);break;default:break e}break;default:if(!(t>8&&t<14||t>=5760&&B.test(String.fromCharCode(t))))break e;++e.pos}}},re.finishToken=function(e,t){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var r=this.type;this.type=e,this.value=t,this.updateContext(r)},re.readToken_dot=function(){var e=this.input.charCodeAt(this.pos+1);if(e>=48&&e<=57)return this.readNumber(!0);var t=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===e&&46===t?(this.pos+=3,this.finishToken(F.ellipsis)):(++this.pos,this.finishToken(F.dot))},re.readToken_slash=function(){var e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===e?this.finishOp(F.assign,2):this.finishOp(F.slash,1)},re.readToken_mult_modulo_exp=function(e){var t=this.input.charCodeAt(this.pos+1),r=1,n=42===e?F.star:F.modulo;return this.options.ecmaVersion>=7&&42===t&&(++r,n=F.starstar,t=this.input.charCodeAt(this.pos+2)),61===t?this.finishOp(F.assign,r+1):this.finishOp(n,r)},re.readToken_pipe_amp=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?this.finishOp(124===e?F.logicalOR:F.logicalAND,2):61===t?this.finishOp(F.assign,2):this.finishOp(124===e?F.bitwiseOR:F.bitwiseAND,1)},re.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(F.assign,2):this.finishOp(F.bitwiseXOR,1)},re.readToken_plus_min=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?45==t&&62==this.input.charCodeAt(this.pos+2)&&O.test(this.input.slice(this.lastTokEnd,this.pos))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(F.incDec,2):61===t?this.finishOp(F.assign,2):this.finishOp(F.plusMin,1)},re.readToken_lt_gt=function(e){var t=this.input.charCodeAt(this.pos+1),r=1;return t===e?(r=62===e&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+r)?this.finishOp(F.assign,r+1):this.finishOp(F.bitShift,r)):33==t&&60==e&&45==this.input.charCodeAt(this.pos+2)&&45==this.input.charCodeAt(this.pos+3)?(this.inModule&&this.unexpected(),this.skipLineComment(4),this.skipSpace(),this.nextToken()):(61===t&&(r=2),this.finishOp(F.relational,r))},re.readToken_eq_excl=function(e){var t=this.input.charCodeAt(this.pos+1);return 61===t?this.finishOp(F.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===e&&62===t&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(F.arrow)):this.finishOp(61===e?F.eq:F.prefix,1)},re.getTokenFromCode=function(e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(F.parenL);case 41:return++this.pos,this.finishToken(F.parenR);case 59:return++this.pos,this.finishToken(F.semi);case 44:return++this.pos,this.finishToken(F.comma);case 91:return++this.pos,this.finishToken(F.bracketL);case 93:return++this.pos,this.finishToken(F.bracketR);case 123:return++this.pos,this.finishToken(F.braceL);case 125:return++this.pos,this.finishToken(F.braceR);case 58:return++this.pos,this.finishToken(F.colon);case 63:return++this.pos,this.finishToken(F.question);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(F.backQuote);case 48:var t=this.input.charCodeAt(this.pos+1);if(120===t||88===t)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===t||79===t)return this.readRadixNumber(8);if(98===t||66===t)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 126:return this.finishOp(F.prefix,1)}this.raise(this.pos,"Unexpected character '"+m(e)+"'")},re.finishOp=function(e,t){var r=this.input.slice(this.pos,this.pos+t);return this.pos+=t,this.finishToken(e,r)};var ie=!!h("","u");re.readRegexp=function(){for(var e,t,r=this,n=this.pos;;){r.pos>=r.input.length&&r.raise(n,"Unterminated regular expression");var i=r.input.charAt(r.pos);if(O.test(i)&&r.raise(n,"Unterminated regular expression"),e)e=!1;else{if("["===i)t=!0;else if("]"===i&&t)t=!1;else if("/"===i&&!t)break;e="\\"===i}++r.pos}var o=this.input.slice(n,this.pos);++this.pos;var a=this.readWord1(),s=o,u="";if(a){var c=/^[gim]*$/;this.options.ecmaVersion>=6&&(c=/^[gimuy]*$/),c.test(a)||this.raise(n,"Invalid regular expression flag"),a.indexOf("u")>=0&&(ie?u="u":(s=(s=s.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(e,t,i){return(t=Number("0x"+t))>1114111&&r.raise(n+i+3,"Code point out of bounds"),"x"})).replace(/\\u([a-fA-F0-9]{4})|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"),u=u.replace("u","")))}var l=null;return ne||(h(s,u,n,this),l=h(o,a)),this.finishToken(F.regexp,{pattern:o,flags:a,value:l})},re.readInt=function(e,t){for(var r=this,n=this.pos,i=0,o=0,a=null==t?1/0:t;o<a;++o){var s,u=r.input.charCodeAt(r.pos);if((s=u>=97?u-97+10:u>=65?u-65+10:u>=48&&u<=57?u-48:1/0)>=e)break;++r.pos,i=i*e+s}return this.pos===n||null!=t&&this.pos-n!==t?null:i},re.readRadixNumber=function(e){this.pos+=2;var t=this.readInt(e);return null==t&&this.raise(this.start+2,"Expected number in radix "+e),r(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(F.num,t)},re.readNumber=function(e){var t=this.pos,n=!1,i=48===this.input.charCodeAt(this.pos);e||null!==this.readInt(10)||this.raise(t,"Invalid number"),i&&this.pos==t+1&&(i=!1);var o=this.input.charCodeAt(this.pos);46!==o||i||(++this.pos,this.readInt(10),n=!0,o=this.input.charCodeAt(this.pos)),69!==o&&101!==o||i||(43!==(o=this.input.charCodeAt(++this.pos))&&45!==o||++this.pos,null===this.readInt(10)&&this.raise(t,"Invalid number"),n=!0),r(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var a,s=this.input.slice(t,this.pos);return n?a=parseFloat(s):i&&1!==s.length?/[89]/.test(s)||this.strict?this.raise(t,"Invalid number"):a=parseInt(s,8):a=parseInt(s,10),this.finishToken(F.num,a)},re.readCodePoint=function(){var e;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var t=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,e>1114111&&this.raise(t,"Code point out of bounds")}else e=this.readHexChar(4);return e},re.readString=function(e){for(var t=this,r="",n=++this.pos;;){t.pos>=t.input.length&&t.raise(t.start,"Unterminated string constant");var i=t.input.charCodeAt(t.pos);if(i===e)break;92===i?(r+=t.input.slice(n,t.pos),r+=t.readEscapedChar(!1),n=t.pos):(a(i)&&t.raise(t.start,"Unterminated string constant"),++t.pos)}return r+=this.input.slice(n,this.pos++),this.finishToken(F.string,r)},re.readTmplToken=function(){for(var e=this,t="",r=this.pos;;){e.pos>=e.input.length&&e.raise(e.start,"Unterminated template");var n=e.input.charCodeAt(e.pos);if(96===n||36===n&&123===e.input.charCodeAt(e.pos+1))return e.pos===e.start&&e.type===F.template?36===n?(e.pos+=2,e.finishToken(F.dollarBraceL)):(++e.pos,e.finishToken(F.backQuote)):(t+=e.input.slice(r,e.pos),e.finishToken(F.template,t));if(92===n)t+=e.input.slice(r,e.pos),t+=e.readEscapedChar(!0),r=e.pos;else if(a(n)){switch(t+=e.input.slice(r,e.pos),++e.pos,n){case 13:10===e.input.charCodeAt(e.pos)&&++e.pos;case 10:t+="\n";break;default:t+=String.fromCharCode(n)}e.options.locations&&(++e.curLine,e.lineStart=e.pos),r=e.pos}else++e.pos}},re.readEscapedChar=function(e){var t=this.input.charCodeAt(++this.pos);switch(++this.pos,t){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return m(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";default:if(t>=48&&t<=55){var r=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],n=parseInt(r,8);return n>255&&(r=r.slice(0,-1),n=parseInt(r,8)),"0"!==r&&(this.strict||e)&&this.raise(this.pos-2,"Octal literal in strict mode"),this.pos+=r.length-1,String.fromCharCode(n)}return String.fromCharCode(t)}},re.readHexChar=function(e){var t=this.pos,r=this.readInt(16,e);return null===r&&this.raise(t,"Bad character escape sequence"),r},re.readWord1=function(){var e=this;this.containsEsc=!1;for(var t="",i=!0,o=this.pos,a=this.options.ecmaVersion>=6;this.pos<this.input.length;){var s=e.fullCharCodeAtPos();if(n(s,a))e.pos+=s<=65535?1:2;else{if(92!==s)break;e.containsEsc=!0,t+=e.input.slice(o,e.pos);var u=e.pos;117!=e.input.charCodeAt(++e.pos)&&e.raise(e.pos,"Expecting Unicode escape sequence \\uXXXX"),++e.pos;var c=e.readCodePoint();(i?r:n)(c,a)||e.raise(u,"Invalid Unicode escape"),t+=m(c),o=e.pos}i=!1}return t+this.input.slice(o,this.pos)},re.readWord=function(){var e=this.readWord1(),t=F.name;return this.keywords.test(e)&&(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+e),t=C[e]),this.finishToken(t,e)};e.version="4.0.11",e.parse=function(e,t){return new N(t,e).parse()},e.parseExpressionAt=function(e,t,r){var n=new N(r,e,t);return n.nextToken(),n.parseExpression()},e.tokenizer=function(e,t){return new N(t,e)},e.addLooseExports=function(t,r,n){e.parse_dammit=t,e.LooseParser=r,e.pluginsLoose=n},e.Parser=N,e.plugins=L,e.defaultOptions=I,e.Position=P,e.SourceLocation=T,e.getLineInfo=c,e.Node=Y,e.TokenType=S,e.tokTypes=F,e.keywordTypes=C,e.TokContext=X,e.tokContexts=Z,e.isIdentifierChar=n,e.isIdentifierStart=r,e.Token=te,e.isNewLine=a,e.lineBreak=O,e.lineBreakG=j,Object.defineProperty(e,"__esModule",{value:!0})}),function(t,r){"function"==typeof e&&e.amd?e(["exports"],r):r((t.acorn=t.acorn||{},t.acorn.walk=t.acorn.walk||{}))}(this,function(e){"use strict";function t(e){return"string"==typeof e?function(t){return t==e}:e||function(){return!0}}function r(e,t,r){r(e,t)}function n(e,t,r){}var i=function(e,t){this.node=e,this.state=t},o=Object.create||function(e){function t(){}return t.prototype=e,new t},a={};a.Program=a.BlockStatement=function(e,t,r){for(var n=0;n<e.body.length;++n)r(e.body[n],t,"Statement")},a.Statement=r,a.EmptyStatement=n,a.ExpressionStatement=a.ParenthesizedExpression=function(e,t,r){return r(e.expression,t,"Expression")},a.IfStatement=function(e,t,r){r(e.test,t,"Expression"),r(e.consequent,t,"Statement"),e.alternate&&r(e.alternate,t,"Statement")},a.LabeledStatement=function(e,t,r){return r(e.body,t,"Statement")},a.BreakStatement=a.ContinueStatement=n,a.WithStatement=function(e,t,r){r(e.object,t,"Expression"),r(e.body,t,"Statement")},a.SwitchStatement=function(e,t,r){r(e.discriminant,t,"Expression");for(var n=0;n<e.cases.length;++n){var i=e.cases[n];i.test&&r(i.test,t,"Expression");for(var o=0;o<i.consequent.length;++o)r(i.consequent[o],t,"Statement")}},a.ReturnStatement=a.YieldExpression=a.AwaitExpression=function(e,t,r){e.argument&&r(e.argument,t,"Expression")},a.ThrowStatement=a.SpreadElement=function(e,t,r){return r(e.argument,t,"Expression")},a.TryStatement=function(e,t,r){r(e.block,t,"Statement"),e.handler&&r(e.handler,t),e.finalizer&&r(e.finalizer,t,"Statement")},a.CatchClause=function(e,t,r){r(e.param,t,"Pattern"),r(e.body,t,"ScopeBody")},a.WhileStatement=a.DoWhileStatement=function(e,t,r){r(e.test,t,"Expression"),r(e.body,t,"Statement")},a.ForStatement=function(e,t,r){e.init&&r(e.init,t,"ForInit"),e.test&&r(e.test,t,"Expression"),e.update&&r(e.update,t,"Expression"),r(e.body,t,"Statement")},a.ForInStatement=a.ForOfStatement=function(e,t,r){r(e.left,t,"ForInit"),r(e.right,t,"Expression"),r(e.body,t,"Statement")},a.ForInit=function(e,t,r){"VariableDeclaration"==e.type?r(e,t):r(e,t,"Expression")},a.DebuggerStatement=n,a.FunctionDeclaration=function(e,t,r){return r(e,t,"Function")},a.VariableDeclaration=function(e,t,r){for(var n=0;n<e.declarations.length;++n)r(e.declarations[n],t)},a.VariableDeclarator=function(e,t,r){r(e.id,t,"Pattern"),e.init&&r(e.init,t,"Expression")},a.Function=function(e,t,r){e.id&&r(e.id,t,"Pattern");for(var n=0;n<e.params.length;n++)r(e.params[n],t,"Pattern");r(e.body,t,e.expression?"ScopeExpression":"ScopeBody")},a.ScopeBody=function(e,t,r){return r(e,t,"Statement")},a.ScopeExpression=function(e,t,r){return r(e,t,"Expression")},a.Pattern=function(e,t,r){"Identifier"==e.type?r(e,t,"VariablePattern"):"MemberExpression"==e.type?r(e,t,"MemberPattern"):r(e,t)},a.VariablePattern=n,a.MemberPattern=r,a.RestElement=function(e,t,r){return r(e.argument,t,"Pattern")},a.ArrayPattern=function(e,t,r){for(var n=0;n<e.elements.length;++n){var i=e.elements[n];i&&r(i,t,"Pattern")}},a.ObjectPattern=function(e,t,r){for(var n=0;n<e.properties.length;++n)r(e.properties[n].value,t,"Pattern")},a.Expression=r,a.ThisExpression=a.Super=a.MetaProperty=n,a.ArrayExpression=function(e,t,r){for(var n=0;n<e.elements.length;++n){var i=e.elements[n];i&&r(i,t,"Expression")}},a.ObjectExpression=function(e,t,r){for(var n=0;n<e.properties.length;++n)r(e.properties[n],t)},a.FunctionExpression=a.ArrowFunctionExpression=a.FunctionDeclaration,a.SequenceExpression=a.TemplateLiteral=function(e,t,r){for(var n=0;n<e.expressions.length;++n)r(e.expressions[n],t,"Expression")},a.UnaryExpression=a.UpdateExpression=function(e,t,r){r(e.argument,t,"Expression")},a.BinaryExpression=a.LogicalExpression=function(e,t,r){r(e.left,t,"Expression"),r(e.right,t,"Expression")},a.AssignmentExpression=a.AssignmentPattern=function(e,t,r){r(e.left,t,"Pattern"),r(e.right,t,"Expression")},a.ConditionalExpression=function(e,t,r){r(e.test,t,"Expression"),r(e.consequent,t,"Expression"),r(e.alternate,t,"Expression")},a.NewExpression=a.CallExpression=function(e,t,r){if(r(e.callee,t,"Expression"),e.arguments)for(var n=0;n<e.arguments.length;++n)r(e.arguments[n],t,"Expression")},a.MemberExpression=function(e,t,r){r(e.object,t,"Expression"),e.computed&&r(e.property,t,"Expression")},a.ExportNamedDeclaration=a.ExportDefaultDeclaration=function(e,t,r){e.declaration&&r(e.declaration,t,"ExportNamedDeclaration"==e.type||e.declaration.id?"Statement":"Expression"),e.source&&r(e.source,t,"Expression")},a.ExportAllDeclaration=function(e,t,r){r(e.source,t,"Expression")},a.ImportDeclaration=function(e,t,r){for(var n=0;n<e.specifiers.length;n++)r(e.specifiers[n],t);r(e.source,t,"Expression")},a.ImportSpecifier=a.ImportDefaultSpecifier=a.ImportNamespaceSpecifier=a.Identifier=a.Literal=n,a.TaggedTemplateExpression=function(e,t,r){r(e.tag,t,"Expression"),r(e.quasi,t)},a.ClassDeclaration=a.ClassExpression=function(e,t,r){return r(e,t,"Class")},a.Class=function(e,t,r){e.id&&r(e.id,t,"Pattern"),e.superClass&&r(e.superClass,t,"Expression");for(var n=0;n<e.body.body.length;n++)r(e.body.body[n],t)},a.MethodDefinition=a.Property=function(e,t,r){e.computed&&r(e.key,t,"Expression"),r(e.value,t,"Expression")},e.simple=function(t,r,n,i,o){n||(n=e.base),function e(t,i,o){var a=o||t.type,s=r[a];n[a](t,i,e),s&&s(t,i)}(t,i,o)},e.ancestor=function(t,r,n,i){n||(n=e.base);var o=[];!function e(t,i,a){var s=a||t.type,u=r[s],c=t!=o[o.length-1];c&&o.push(t),n[s](t,i,e),u&&u(t,i||o,o),c&&o.pop()}(t,i)},e.recursive=function(t,r,n,i,o){var a=n?e.make(n,i):i;!function e(t,r,n){a[n||t.type](t,r,e)}(t,r,o)},e.findNodeAt=function(r,n,o,a,s,u){a=t(a),s||(s=e.base);try{!function e(t,r,u){var c=u||t.type;if((null==n||t.start<=n)&&(null==o||t.end>=o)&&s[c](t,r,e),(null==n||t.start==n)&&(null==o||t.end==o)&&a(c,t))throw new i(t,r)}(r,u)}catch(e){if(e instanceof i)return e;throw e}},e.findNodeAround=function(r,n,o,a,s){o=t(o),a||(a=e.base);try{!function e(t,r,s){var u=s||t.type;if(!(t.start>n||t.end<n)&&(a[u](t,r,e),o(u,t)))throw new i(t,r)}(r,s)}catch(e){if(e instanceof i)return e;throw e}},e.findNodeAfter=function(r,n,o,a,s){o=t(o),a||(a=e.base);try{!function e(t,r,s){if(!(t.end<n)){var u=s||t.type;if(t.start>=n&&o(u,t))throw new i(t,r);a[u](t,r,e)}}(r,s)}catch(e){if(e instanceof i)return e;throw e}},e.findNodeBefore=function(r,n,o,a,s){o=t(o),a||(a=e.base);var u;return function e(t,r,s){if(!(t.start>n)){var c=s||t.type;t.end<=n&&(!u||u.node.end<t.end)&&o(c,t)&&(u=new i(t,r)),a[c](t,r,e)}}(r,s),u},e.make=function(t,r){r||(r=e.base);var n=o(r);for(var i in t)n[i]=t[i];return n},e.base=a,Object.defineProperty(e,"__esModule",{value:!0})}),function(t,r){"function"==typeof e&&e.amd?e(["exports","./acorn"],r):r((t.acorn=t.acorn||{},t.acorn.loose=t.acorn.loose||{}),t.acorn)}(this,function(e,t){"use strict";function r(e){return e<14&&e>8||32===e||160===e||t.isNewLine(e)}function n(e){return""==e.name}function i(e,t){var r=new a(e,t);return r.next(),r.parseTopLevel()}var o={},a=function(e,r){if(void 0===r&&(r={}),this.toks=t.tokenizer(e,r),this.options=this.toks.options,this.input=this.toks.input,this.tok=this.last={type:t.tokTypes.eof,start:0,end:0},this.options.locations){var n=this.toks.curPosition();this.tok.loc=new t.SourceLocation(this.toks,n,n)}this.ahead=[],this.context=[],this.curIndent=0,this.curLineStart=0,this.nextLineStart=this.lineEnd(this.curLineStart)+1,this.inAsync=!1,this.options.pluginsLoose=r.pluginsLoose||{},this.loadPlugins(this.options.pluginsLoose)};a.prototype.startNode=function(){return new t.Node(this.toks,this.tok.start,this.options.locations?this.tok.loc.start:null)},a.prototype.storeCurrentPos=function(){return this.options.locations?[this.tok.start,this.tok.loc.start]:this.tok.start},a.prototype.startNodeAt=function(e){return this.options.locations?new t.Node(this.toks,e[0],e[1]):new t.Node(this.toks,e)},a.prototype.finishNode=function(e,t){return e.type=t,e.end=this.last.end,this.options.locations&&(e.loc.end=this.last.loc.end),this.options.ranges&&(e.range[1]=this.last.end),e},a.prototype.dummyNode=function(e){var r=this.startNode();return r.type=e,r.end=r.start,this.options.locations&&(r.loc.end=r.loc.start),this.options.ranges&&(r.range[1]=r.start),this.last={type:t.tokTypes.name,start:r.start,end:r.start,loc:r.loc},r},a.prototype.dummyIdent=function(){var e=this.dummyNode("Identifier");return e.name="",e},a.prototype.dummyString=function(){var e=this.dummyNode("Literal");return e.value=e.raw="",e},a.prototype.eat=function(e){return this.tok.type===e&&(this.next(),!0)},a.prototype.isContextual=function(e){return this.tok.type===t.tokTypes.name&&this.tok.value===e},a.prototype.eatContextual=function(e){return this.tok.value===e&&this.eat(t.tokTypes.name)},a.prototype.canInsertSemicolon=function(){return this.tok.type===t.tokTypes.eof||this.tok.type===t.tokTypes.braceR||t.lineBreak.test(this.input.slice(this.last.end,this.tok.start))},a.prototype.semicolon=function(){return this.eat(t.tokTypes.semi)},a.prototype.expect=function(e){var t=this;if(this.eat(e))return!0;for(var r=1;r<=2;r++)if(t.lookAhead(r).type==e){for(var n=0;n<r;n++)t.next();return!0}},a.prototype.pushCx=function(){this.context.push(this.curIndent)},a.prototype.popCx=function(){this.curIndent=this.context.pop()},a.prototype.lineEnd=function(e){for(;e<this.input.length&&!t.isNewLine(this.input.charCodeAt(e));)++e;return e},a.prototype.indentationAfter=function(e){for(var t=this,r=0;;++e){var n=t.input.charCodeAt(e);if(32===n)++r;else{if(9!==n)return r;r+=t.options.tabSize}}},a.prototype.closes=function(e,r,n,i){return this.tok.type===e||this.tok.type===t.tokTypes.eof||n!=this.curLineStart&&this.curIndent<r&&this.tokenStartsLine()&&(!i||this.nextLineStart>=this.input.length||this.indentationAfter(this.nextLineStart)<r)},a.prototype.tokenStartsLine=function(){for(var e=this,t=this.tok.start-1;t>=this.curLineStart;--t){var r=e.input.charCodeAt(t);if(9!==r&&32!==r)return!1}return!0},a.prototype.extend=function(e,t){this[e]=t(this[e])},a.prototype.loadPlugins=function(e){var t=this;for(var r in e){var n=o[r];if(!n)throw new Error("Plugin '"+r+"' not found");n(t,e[r])}};var s=a.prototype;s.next=function(){var e=this;if(this.last=this.tok,this.ahead.length?this.tok=this.ahead.shift():this.tok=this.readToken(),this.tok.start>=this.nextLineStart){for(;this.tok.start>=this.nextLineStart;)e.curLineStart=e.nextLineStart,e.nextLineStart=e.lineEnd(e.curLineStart)+1;this.curIndent=this.indentationAfter(this.curLineStart)}},s.readToken=function(){for(var e=this;;)try{return e.toks.next(),e.toks.type===t.tokTypes.dot&&"."===e.input.substr(e.toks.end,1)&&e.options.ecmaVersion>=6&&(e.toks.end++,e.toks.type=t.tokTypes.ellipsis),new t.Token(e.toks)}catch(u){if(!(u instanceof SyntaxError))throw u;var n=u.message,i=u.raisedAt,o=!0;if(/unterminated/i.test(n))if(i=e.lineEnd(u.pos+1),/string/.test(n))o={start:u.pos,end:i,type:t.tokTypes.string,value:e.input.slice(u.pos+1,i)};else if(/regular expr/i.test(n)){var a=e.input.slice(u.pos,i);try{a=new RegExp(a)}catch(e){}o={start:u.pos,end:i,type:t.tokTypes.regexp,value:a}}else o=!!/template/.test(n)&&{start:u.pos,end:i,type:t.tokTypes.template,value:e.input.slice(u.pos,i)};else if(/invalid (unicode|regexp|number)|expecting unicode|octal literal|is reserved|directly after number|expected number in radix/i.test(n))for(;i<this.input.length&&!r(this.input.charCodeAt(i));)++i;else if(/character escape|expected hexadecimal/i.test(n))for(;i<this.input.length;){var s=e.input.charCodeAt(i++);if(34===s||39===s||t.isNewLine(s))break}else if(/unexpected character/i.test(n))i++,o=!1;else{if(!/regular expression/i.test(n))throw u;o=!0}if(e.resetTo(i),!0===o&&(o={start:i,end:i,type:t.tokTypes.name,value:""}),o)return e.options.locations&&(o.loc=new t.SourceLocation(e.toks,t.getLineInfo(e.input,o.start),t.getLineInfo(e.input,o.end))),o}},s.resetTo=function(e){var r=this;this.toks.pos=e;var n=this.input.charAt(e-1);if(this.toks.exprAllowed=!n||/[\[\{\(,;:?\/*=+\-~!|&%^<>]/.test(n)||/[enwfd]/.test(n)&&/\b(keywords|case|else|return|throw|new|in|(instance|type)of|delete|void)$/.test(this.input.slice(e-10,e)),this.options.locations){this.toks.curLine=1,this.toks.lineStart=t.lineBreakG.lastIndex=0;for(var i;(i=t.lineBreakG.exec(this.input))&&i.index<e;)++r.toks.curLine,r.toks.lineStart=i.index+i[0].length}},s.lookAhead=function(e){for(var t=this;e>this.ahead.length;)t.ahead.push(t.readToken());return this.ahead[e-1]};var u=a.prototype;u.parseTopLevel=function(){var e=this,r=this.startNodeAt(this.options.locations?[0,t.getLineInfo(this.input,0)]:0);for(r.body=[];this.tok.type!==t.tokTypes.eof;)r.body.push(e.parseStatement());return this.last=this.tok,this.options.ecmaVersion>=6&&(r.sourceType=this.options.sourceType),this.finishNode(r,"Program")},u.parseStatement=function(){var e,r=this,i=this.tok.type,o=this.startNode();switch(this.toks.isLet()&&(i=t.tokTypes._var,e="let"),i){case t.tokTypes._break:case t.tokTypes._continue:this.next();var a=i===t.tokTypes._break;return this.semicolon()||this.canInsertSemicolon()?o.label=null:(o.label=this.tok.type===t.tokTypes.name?this.parseIdent():null,this.semicolon()),this.finishNode(o,a?"BreakStatement":"ContinueStatement");case t.tokTypes._debugger:return this.next(),this.semicolon(),this.finishNode(o,"DebuggerStatement");case t.tokTypes._do:return this.next(),o.body=this.parseStatement(),o.test=this.eat(t.tokTypes._while)?this.parseParenExpression():this.dummyIdent(),this.semicolon(),this.finishNode(o,"DoWhileStatement");case t.tokTypes._for:if(this.next(),this.pushCx(),this.expect(t.tokTypes.parenL),this.tok.type===t.tokTypes.semi)return this.parseFor(o,null);var s=this.toks.isLet();if(s||this.tok.type===t.tokTypes._var||this.tok.type===t.tokTypes._const){var u=this.parseVar(!0,s?"let":this.tok.value);return 1!==u.declarations.length||this.tok.type!==t.tokTypes._in&&!this.isContextual("of")?this.parseFor(o,u):this.parseForIn(o,u)}var c=this.parseExpression(!0);return this.tok.type===t.tokTypes._in||this.isContextual("of")?this.parseForIn(o,this.toAssignable(c)):this.parseFor(o,c);case t.tokTypes._function:return this.next(),this.parseFunction(o,!0);case t.tokTypes._if:return this.next(),o.test=this.parseParenExpression(),o.consequent=this.parseStatement(),o.alternate=this.eat(t.tokTypes._else)?this.parseStatement():null,this.finishNode(o,"IfStatement");case t.tokTypes._return:return this.next(),this.eat(t.tokTypes.semi)||this.canInsertSemicolon()?o.argument=null:(o.argument=this.parseExpression(),this.semicolon()),this.finishNode(o,"ReturnStatement");case t.tokTypes._switch:var l=this.curIndent,f=this.curLineStart;this.next(),o.discriminant=this.parseParenExpression(),o.cases=[],this.pushCx(),this.expect(t.tokTypes.braceL);for(var p;!this.closes(t.tokTypes.braceR,l,f,!0);)if(r.tok.type===t.tokTypes._case||r.tok.type===t.tokTypes._default){var d=r.tok.type===t.tokTypes._case;p&&r.finishNode(p,"SwitchCase"),o.cases.push(p=r.startNode()),p.consequent=[],r.next(),p.test=d?r.parseExpression():null,r.expect(t.tokTypes.colon)}else p||(o.cases.push(p=r.startNode()),p.consequent=[],p.test=null),p.consequent.push(r.parseStatement());return p&&this.finishNode(p,"SwitchCase"),this.popCx(),this.eat(t.tokTypes.braceR),this.finishNode(o,"SwitchStatement");case t.tokTypes._throw:return this.next(),o.argument=this.parseExpression(),this.semicolon(),this.finishNode(o,"ThrowStatement");case t.tokTypes._try:if(this.next(),o.block=this.parseBlock(),o.handler=null,this.tok.type===t.tokTypes._catch){var h=this.startNode();this.next(),this.expect(t.tokTypes.parenL),h.param=this.toAssignable(this.parseExprAtom(),!0),this.expect(t.tokTypes.parenR),h.body=this.parseBlock(),o.handler=this.finishNode(h,"CatchClause")}return o.finalizer=this.eat(t.tokTypes._finally)?this.parseBlock():null,o.handler||o.finalizer?this.finishNode(o,"TryStatement"):o.block;case t.tokTypes._var:case t.tokTypes._const:return this.parseVar(!1,e||this.tok.value);case t.tokTypes._while:return this.next(),o.test=this.parseParenExpression(),o.body=this.parseStatement(),this.finishNode(o,"WhileStatement");case t.tokTypes._with:return this.next(),o.object=this.parseParenExpression(),o.body=this.parseStatement(),this.finishNode(o,"WithStatement");case t.tokTypes.braceL:return this.parseBlock();case t.tokTypes.semi:return this.next(),this.finishNode(o,"EmptyStatement");case t.tokTypes._class:return this.parseClass(!0);case t.tokTypes._import:return this.parseImport();case t.tokTypes._export:return this.parseExport();default:if(this.toks.isAsyncFunction())return this.next(),this.next(),this.parseFunction(o,!0,!0);var m=this.parseExpression();return n(m)?(this.next(),this.tok.type===t.tokTypes.eof?this.finishNode(o,"EmptyStatement"):this.parseStatement()):i===t.tokTypes.name&&"Identifier"===m.type&&this.eat(t.tokTypes.colon)?(o.body=this.parseStatement(),o.label=m,this.finishNode(o,"LabeledStatement")):(o.expression=m,this.semicolon(),this.finishNode(o,"ExpressionStatement"))}},u.parseBlock=function(){var e=this,r=this.startNode();this.pushCx(),this.expect(t.tokTypes.braceL);var n=this.curIndent,i=this.curLineStart;for(r.body=[];!this.closes(t.tokTypes.braceR,n,i,!0);)r.body.push(e.parseStatement());return this.popCx(),this.eat(t.tokTypes.braceR),this.finishNode(r,"BlockStatement")},u.parseFor=function(e,r){return e.init=r,e.test=e.update=null,this.eat(t.tokTypes.semi)&&this.tok.type!==t.tokTypes.semi&&(e.test=this.parseExpression()),this.eat(t.tokTypes.semi)&&this.tok.type!==t.tokTypes.parenR&&(e.update=this.parseExpression()),this.popCx(),this.expect(t.tokTypes.parenR),e.body=this.parseStatement(),this.finishNode(e,"ForStatement")},u.parseForIn=function(e,r){var n=this.tok.type===t.tokTypes._in?"ForInStatement":"ForOfStatement";return this.next(),e.left=r,e.right=this.parseExpression(),this.popCx(),this.expect(t.tokTypes.parenR),e.body=this.parseStatement(),this.finishNode(e,n)},u.parseVar=function(e,r){var n=this,i=this.startNode();i.kind=r,this.next(),i.declarations=[];do{var o=n.startNode();o.id=n.options.ecmaVersion>=6?n.toAssignable(n.parseExprAtom(),!0):n.parseIdent(),o.init=n.eat(t.tokTypes.eq)?n.parseMaybeAssign(e):null,i.declarations.push(n.finishNode(o,"VariableDeclarator"))}while(this.eat(t.tokTypes.comma));if(!i.declarations.length){var a=this.startNode();a.id=this.dummyIdent(),i.declarations.push(this.finishNode(a,"VariableDeclarator"))}return e||this.semicolon(),this.finishNode(i,"VariableDeclaration")},u.parseClass=function(e){var r=this,i=this.startNode();this.next(),null==e&&(e=this.tok.type===t.tokTypes.name),this.tok.type===t.tokTypes.name?i.id=this.parseIdent():i.id=e?this.dummyIdent():null,i.superClass=this.eat(t.tokTypes._extends)?this.parseExpression():null,i.body=this.startNode(),i.body.body=[],this.pushCx();var o=this.curIndent+1,a=this.curLineStart;for(this.eat(t.tokTypes.braceL),this.curIndent+1<o&&(o=this.curIndent,a=this.curLineStart);!this.closes(t.tokTypes.braceR,o,a);)if(!r.semicolon()){var s,u,c=r.startNode();r.options.ecmaVersion>=6&&(c.static=!1,s=r.eat(t.tokTypes.star)),r.parsePropertyName(c),n(c.key)?(n(r.parseMaybeAssign())&&r.next(),r.eat(t.tokTypes.comma)):("Identifier"!==c.key.type||c.computed||"static"!==c.key.name||r.tok.type==t.tokTypes.parenL||r.tok.type==t.tokTypes.braceL?c.static=!1:(c.static=!0,s=r.eat(t.tokTypes.star),r.parsePropertyName(c)),c.computed||"Identifier"!==c.key.type||"async"!==c.key.name||r.tok.type===t.tokTypes.parenL||r.canInsertSemicolon()?u=!1:(r.parsePropertyName(c),u=!0),r.options.ecmaVersion>=5&&"Identifier"===c.key.type&&!c.computed&&("get"===c.key.name||"set"===c.key.name)&&r.tok.type!==t.tokTypes.parenL&&r.tok.type!==t.tokTypes.braceL?(c.kind=c.key.name,r.parsePropertyName(c),c.value=r.parseMethod(!1)):(c.computed||c.static||s||u||!("Identifier"===c.key.type&&"constructor"===c.key.name||"Literal"===c.key.type&&"constructor"===c.key.value)?c.kind="method":c.kind="constructor",c.value=r.parseMethod(s,u)),i.body.body.push(r.finishNode(c,"MethodDefinition")))}return this.popCx(),this.eat(t.tokTypes.braceR)||(this.last.end=this.tok.start,this.options.locations&&(this.last.loc.end=this.tok.loc.start)),this.semicolon(),this.finishNode(i.body,"ClassBody"),this.finishNode(i,e?"ClassDeclaration":"ClassExpression")},u.parseFunction=function(e,r,n){var i=this.inAsync;return this.initFunction(e),this.options.ecmaVersion>=6&&(e.generator=this.eat(t.tokTypes.star)),this.options.ecmaVersion>=8&&(e.async=!!n),null==r&&(r=this.tok.type===t.tokTypes.name),this.tok.type===t.tokTypes.name?e.id=this.parseIdent():r&&(e.id=this.dummyIdent()),this.inAsync=e.async,e.params=this.parseFunctionParams(),e.body=this.parseBlock(),this.inAsync=i,this.finishNode(e,r?"FunctionDeclaration":"FunctionExpression")},u.parseExport=function(){var e=this.startNode();if(this.next(),this.eat(t.tokTypes.star))return e.source=this.eatContextual("from")?this.parseExprAtom():this.dummyString(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(t.tokTypes._default)){var r;if(this.tok.type===t.tokTypes._function||(r=this.toks.isAsyncFunction())){var n=this.startNode();this.next(),r&&this.next(),e.declaration=this.parseFunction(n,null,r)}else this.tok.type===t.tokTypes._class?e.declaration=this.parseClass(null):(e.declaration=this.parseMaybeAssign(),this.semicolon());return this.finishNode(e,"ExportDefaultDeclaration")}return this.tok.type.keyword||this.toks.isLet()||this.toks.isAsyncFunction()?(e.declaration=this.parseStatement(),e.specifiers=[],e.source=null):(e.declaration=null,e.specifiers=this.parseExportSpecifierList(),e.source=this.eatContextual("from")?this.parseExprAtom():null,this.semicolon()),this.finishNode(e,"ExportNamedDeclaration")},u.parseImport=function(){var e=this.startNode();if(this.next(),this.tok.type===t.tokTypes.string)e.specifiers=[],e.source=this.parseExprAtom(),e.kind="";else{var r;this.tok.type===t.tokTypes.name&&"from"!==this.tok.value&&((r=this.startNode()).local=this.parseIdent(),this.finishNode(r,"ImportDefaultSpecifier"),this.eat(t.tokTypes.comma)),e.specifiers=this.parseImportSpecifierList(),e.source=this.eatContextual("from")&&this.tok.type==t.tokTypes.string?this.parseExprAtom():this.dummyString(),r&&e.specifiers.unshift(r)}return this.semicolon(),this.finishNode(e,"ImportDeclaration")},u.parseImportSpecifierList=function(){var e=this,r=[];if(this.tok.type===t.tokTypes.star){var i=this.startNode();this.next(),i.local=this.eatContextual("as")?this.parseIdent():this.dummyIdent(),r.push(this.finishNode(i,"ImportNamespaceSpecifier"))}else{var o=this.curIndent,a=this.curLineStart,s=this.nextLineStart;for(this.pushCx(),this.eat(t.tokTypes.braceL),this.curLineStart>s&&(s=this.curLineStart);!this.closes(t.tokTypes.braceR,o+(this.curLineStart<=s?1:0),a);){var u=e.startNode();if(e.eat(t.tokTypes.star))u.local=e.eatContextual("as")?e.parseIdent():e.dummyIdent(),e.finishNode(u,"ImportNamespaceSpecifier");else{if(e.isContextual("from"))break;if(u.imported=e.parseIdent(),n(u.imported))break;u.local=e.eatContextual("as")?e.parseIdent():u.imported,e.finishNode(u,"ImportSpecifier")}r.push(u),e.eat(t.tokTypes.comma)}this.eat(t.tokTypes.braceR),this.popCx()}return r},u.parseExportSpecifierList=function(){var e=this,r=[],i=this.curIndent,o=this.curLineStart,a=this.nextLineStart;for(this.pushCx(),this.eat(t.tokTypes.braceL),this.curLineStart>a&&(a=this.curLineStart);!this.closes(t.tokTypes.braceR,i+(this.curLineStart<=a?1:0),o)&&!e.isContextual("from");){var s=e.startNode();if(s.local=e.parseIdent(),n(s.local))break;s.exported=e.eatContextual("as")?e.parseIdent():s.local,e.finishNode(s,"ExportSpecifier"),r.push(s),e.eat(t.tokTypes.comma)}return this.eat(t.tokTypes.braceR),this.popCx(),r};var c=a.prototype;c.checkLVal=function(e){if(!e)return e;switch(e.type){case"Identifier":case"MemberExpression":return e;case"ParenthesizedExpression":return e.expression=this.checkLVal(e.expression),e;default:return this.dummyIdent()}},c.parseExpression=function(e){var r=this,n=this.storeCurrentPos(),i=this.parseMaybeAssign(e);if(this.tok.type===t.tokTypes.comma){var o=this.startNodeAt(n);for(o.expressions=[i];this.eat(t.tokTypes.comma);)o.expressions.push(r.parseMaybeAssign(e));return this.finishNode(o,"SequenceExpression")}return i},c.parseParenExpression=function(){this.pushCx(),this.expect(t.tokTypes.parenL);var e=this.parseExpression();return this.popCx(),this.expect(t.tokTypes.parenR),e},c.parseMaybeAssign=function(e){if(this.toks.isContextual("yield")){var r=this.startNode();return this.next(),this.semicolon()||this.canInsertSemicolon()||this.tok.type!=t.tokTypes.star&&!this.tok.type.startsExpr?(r.delegate=!1,r.argument=null):(r.delegate=this.eat(t.tokTypes.star),r.argument=this.parseMaybeAssign()),this.finishNode(r,"YieldExpression")}var n=this.storeCurrentPos(),i=this.parseMaybeConditional(e);if(this.tok.type.isAssign){var o=this.startNodeAt(n);return o.operator=this.tok.value,o.left=this.tok.type===t.tokTypes.eq?this.toAssignable(i):this.checkLVal(i),this.next(),o.right=this.parseMaybeAssign(e),this.finishNode(o,"AssignmentExpression")}return i},c.parseMaybeConditional=function(e){var r=this.storeCurrentPos(),n=this.parseExprOps(e);if(this.eat(t.tokTypes.question)){var i=this.startNodeAt(r);return i.test=n,i.consequent=this.parseMaybeAssign(),i.alternate=this.expect(t.tokTypes.colon)?this.parseMaybeAssign(e):this.dummyIdent(),this.finishNode(i,"ConditionalExpression")}return n},c.parseExprOps=function(e){var t=this.storeCurrentPos(),r=this.curIndent,n=this.curLineStart;return this.parseExprOp(this.parseMaybeUnary(!1),t,-1,e,r,n)},c.parseExprOp=function(e,r,n,i,o,a){if(this.curLineStart!=a&&this.curIndent<o&&this.tokenStartsLine())return e;var s=this.tok.type.binop;if(null!=s&&(!i||this.tok.type!==t.tokTypes._in)&&s>n){var u=this.startNodeAt(r);if(u.left=e,u.operator=this.tok.value,this.next(),this.curLineStart!=a&&this.curIndent<o&&this.tokenStartsLine())u.right=this.dummyIdent();else{var c=this.storeCurrentPos();u.right=this.parseExprOp(this.parseMaybeUnary(!1),c,s,i,o,a)}return this.finishNode(u,/&&|\|\|/.test(u.operator)?"LogicalExpression":"BinaryExpression"),this.parseExprOp(u,r,n,i,o,a)}return e},c.parseMaybeUnary=function(e){var r,n=this,i=this.storeCurrentPos();if(this.options.ecmaVersion>=8&&this.inAsync&&this.toks.isContextual("await"))r=this.parseAwait(),e=!0;else if(this.tok.type.prefix){var o=this.startNode(),a=this.tok.type===t.tokTypes.incDec;a||(e=!0),o.operator=this.tok.value,o.prefix=!0,this.next(),o.argument=this.parseMaybeUnary(!0),a&&(o.argument=this.checkLVal(o.argument)),r=this.finishNode(o,a?"UpdateExpression":"UnaryExpression")}else if(this.tok.type===t.tokTypes.ellipsis){var s=this.startNode();this.next(),s.argument=this.parseMaybeUnary(e),r=this.finishNode(s,"SpreadElement")}else for(r=this.parseExprSubscripts();this.tok.type.postfix&&!this.canInsertSemicolon();){var u=n.startNodeAt(i);u.operator=n.tok.value,u.prefix=!1,u.argument=n.checkLVal(r),n.next(),r=n.finishNode(u,"UpdateExpression")}if(!e&&this.eat(t.tokTypes.starstar)){var c=this.startNodeAt(i);return c.operator="**",c.left=r,c.right=this.parseMaybeUnary(!1),this.finishNode(c,"BinaryExpression")}return r},c.parseExprSubscripts=function(){var e=this.storeCurrentPos();return this.parseSubscripts(this.parseExprAtom(),e,!1,this.curIndent,this.curLineStart)},c.parseSubscripts=function(e,r,n,i,o){for(var a=this;;){if(a.curLineStart!=o&&a.curIndent<=i&&a.tokenStartsLine()){if(a.tok.type!=t.tokTypes.dot||a.curIndent!=i)return e;--i}var s="Identifier"===e.type&&"async"===e.name&&!a.canInsertSemicolon();if(a.eat(t.tokTypes.dot)){var u=a.startNodeAt(r);u.object=e,a.curLineStart!=o&&a.curIndent<=i&&a.tokenStartsLine()?u.property=a.dummyIdent():u.property=a.parsePropertyAccessor()||a.dummyIdent(),u.computed=!1,e=a.finishNode(u,"MemberExpression")}else if(a.tok.type==t.tokTypes.bracketL){a.pushCx(),a.next();var c=a.startNodeAt(r);c.object=e,c.property=a.parseExpression(),c.computed=!0,a.popCx(),a.expect(t.tokTypes.bracketR),e=a.finishNode(c,"MemberExpression")}else if(n||a.tok.type!=t.tokTypes.parenL){if(a.tok.type!=t.tokTypes.backQuote)return e;var l=a.startNodeAt(r);l.tag=e,l.quasi=a.parseTemplate(),e=a.finishNode(l,"TaggedTemplateExpression")}else{var f=a.parseExprList(t.tokTypes.parenR);if(s&&a.eat(t.tokTypes.arrow))return a.parseArrowExpression(a.startNodeAt(r),f,!0);var p=a.startNodeAt(r);p.callee=e,p.arguments=f,e=a.finishNode(p,"CallExpression")}}},c.parseExprAtom=function(){var e;switch(this.tok.type){case t.tokTypes._this:case t.tokTypes._super:var r=this.tok.type===t.tokTypes._this?"ThisExpression":"Super";return e=this.startNode(),this.next(),this.finishNode(e,r);case t.tokTypes.name:var i=this.storeCurrentPos(),o=this.parseIdent(),a=!1;if("async"===o.name&&!this.canInsertSemicolon()){if(this.eat(t.tokTypes._function))return this.parseFunction(this.startNodeAt(i),!1,!0);this.tok.type===t.tokTypes.name&&(o=this.parseIdent(),a=!0)}return this.eat(t.tokTypes.arrow)?this.parseArrowExpression(this.startNodeAt(i),[o],a):o;case t.tokTypes.regexp:e=this.startNode();var s=this.tok.value;return e.regex={pattern:s.pattern,flags:s.flags},e.value=s.value,e.raw=this.input.slice(this.tok.start,this.tok.end),this.next(),this.finishNode(e,"Literal");case t.tokTypes.num:case t.tokTypes.string:return e=this.startNode(),e.value=this.tok.value,e.raw=this.input.slice(this.tok.start,this.tok.end),this.next(),this.finishNode(e,"Literal");case t.tokTypes._null:case t.tokTypes._true:case t.tokTypes._false:return e=this.startNode(),e.value=this.tok.type===t.tokTypes._null?null:this.tok.type===t.tokTypes._true,e.raw=this.tok.type.keyword,this.next(),this.finishNode(e,"Literal");case t.tokTypes.parenL:var u=this.storeCurrentPos();this.next();var c=this.parseExpression();if(this.expect(t.tokTypes.parenR),this.eat(t.tokTypes.arrow)){var l=c.expressions||[c];return l.length&&n(l[l.length-1])&&l.pop(),this.parseArrowExpression(this.startNodeAt(u),l)}if(this.options.preserveParens){var f=this.startNodeAt(u);f.expression=c,c=this.finishNode(f,"ParenthesizedExpression")}return c;case t.tokTypes.bracketL:return e=this.startNode(),e.elements=this.parseExprList(t.tokTypes.bracketR,!0),this.finishNode(e,"ArrayExpression");case t.tokTypes.braceL:return this.parseObj();case t.tokTypes._class:return this.parseClass(!1);case t.tokTypes._function:return e=this.startNode(),this.next(),this.parseFunction(e,!1);case t.tokTypes._new:return this.parseNew();case t.tokTypes.backQuote:return this.parseTemplate();default:return this.dummyIdent()}},c.parseNew=function(){var e=this.startNode(),r=this.curIndent,n=this.curLineStart,i=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(t.tokTypes.dot))return e.meta=i,e.property=this.parseIdent(!0),this.finishNode(e,"MetaProperty");var o=this.storeCurrentPos();return e.callee=this.parseSubscripts(this.parseExprAtom(),o,!0,r,n),this.tok.type==t.tokTypes.parenL?e.arguments=this.parseExprList(t.tokTypes.parenR):e.arguments=[],this.finishNode(e,"NewExpression")},c.parseTemplateElement=function(){var e=this.startNode();return e.value={raw:this.input.slice(this.tok.start,this.tok.end).replace(/\r\n?/g,"\n"),cooked:this.tok.value},this.next(),e.tail=this.tok.type===t.tokTypes.backQuote,this.finishNode(e,"TemplateElement")},c.parseTemplate=function(){var e=this,r=this.startNode();this.next(),r.expressions=[];var n=this.parseTemplateElement();for(r.quasis=[n];!n.tail;)e.next(),r.expressions.push(e.parseExpression()),e.expect(t.tokTypes.braceR)?n=e.parseTemplateElement():((n=e.startNode()).value={cooked:"",raw:""},n.tail=!0,e.finishNode(n,"TemplateElement")),r.quasis.push(n);return this.expect(t.tokTypes.backQuote),this.finishNode(r,"TemplateLiteral")},c.parseObj=function(){var e=this,r=this.startNode();r.properties=[],this.pushCx();var i=this.curIndent+1,o=this.curLineStart;for(this.eat(t.tokTypes.braceL),this.curIndent+1<i&&(i=this.curIndent,o=this.curLineStart);!this.closes(t.tokTypes.braceR,i,o);){var a,s,u,c=e.startNode();if(e.options.ecmaVersion>=6&&(u=e.storeCurrentPos(),c.method=!1,c.shorthand=!1,a=e.eat(t.tokTypes.star)),e.parsePropertyName(c),c.computed||"Identifier"!==c.key.type||"async"!==c.key.name||e.tok.type===t.tokTypes.parenL||e.tok.type===t.tokTypes.colon||e.canInsertSemicolon()?s=!1:(e.parsePropertyName(c),s=!0),n(c.key))n(e.parseMaybeAssign())&&e.next(),e.eat(t.tokTypes.comma);else{if(e.eat(t.tokTypes.colon))c.kind="init",c.value=e.parseMaybeAssign();else if(e.options.ecmaVersion>=6&&(e.tok.type===t.tokTypes.parenL||e.tok.type===t.tokTypes.braceL))c.kind="init",c.method=!0,c.value=e.parseMethod(a,s);else if(e.options.ecmaVersion>=5&&"Identifier"===c.key.type&&!c.computed&&("get"===c.key.name||"set"===c.key.name)&&e.tok.type!=t.tokTypes.comma&&e.tok.type!=t.tokTypes.braceR)c.kind=c.key.name,e.parsePropertyName(c),c.value=e.parseMethod(!1);else{if(c.kind="init",e.options.ecmaVersion>=6)if(e.eat(t.tokTypes.eq)){var l=e.startNodeAt(u);l.operator="=",l.left=c.key,l.right=e.parseMaybeAssign(),c.value=e.finishNode(l,"AssignmentExpression")}else c.value=c.key;else c.value=e.dummyIdent();c.shorthand=!0}r.properties.push(e.finishNode(c,"Property")),e.eat(t.tokTypes.comma)}}return this.popCx(),this.eat(t.tokTypes.braceR)||(this.last.end=this.tok.start,this.options.locations&&(this.last.loc.end=this.tok.loc.start)),this.finishNode(r,"ObjectExpression")},c.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(t.tokTypes.bracketL))return e.computed=!0,e.key=this.parseExpression(),void this.expect(t.tokTypes.bracketR);e.computed=!1}var r=this.tok.type===t.tokTypes.num||this.tok.type===t.tokTypes.string?this.parseExprAtom():this.parseIdent();e.key=r||this.dummyIdent()},c.parsePropertyAccessor=function(){if(this.tok.type===t.tokTypes.name||this.tok.type.keyword)return this.parseIdent()},c.parseIdent=function(){var e=this.tok.type===t.tokTypes.name?this.tok.value:this.tok.type.keyword;if(!e)return this.dummyIdent();var r=this.startNode();return this.next(),r.name=e,this.finishNode(r,"Identifier")},c.initFunction=function(e){e.id=null,e.params=[],this.options.ecmaVersion>=6&&(e.generator=!1,e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)},c.toAssignable=function(e,t){var r=this;if(!e||"Identifier"==e.type||"MemberExpression"==e.type&&!t);else if("ParenthesizedExpression"==e.type)e.expression=this.toAssignable(e.expression,t);else{if(this.options.ecmaVersion<6)return this.dummyIdent();if("ObjectExpression"==e.type){e.type="ObjectPattern";for(var n=e.properties,i=0;i<n.length;i++)n[i].value=r.toAssignable(n[i].value,t)}else if("ArrayExpression"==e.type)e.type="ArrayPattern",this.toAssignableList(e.elements,t);else if("SpreadElement"==e.type)e.type="RestElement",e.argument=this.toAssignable(e.argument,t);else{if("AssignmentExpression"!=e.type)return this.dummyIdent();e.type="AssignmentPattern",delete e.operator}}return e},c.toAssignableList=function(e,t){for(var r=this,n=0;n<e.length;n++)e[n]=r.toAssignable(e[n],t);return e},c.parseFunctionParams=function(e){return e=this.parseExprList(t.tokTypes.parenR),this.toAssignableList(e,!0)},c.parseMethod=function(e,r){var n=this.startNode(),i=this.inAsync;return this.initFunction(n),this.options.ecmaVersion>=6&&(n.generator=!!e),this.options.ecmaVersion>=8&&(n.async=!!r),this.inAsync=n.async,n.params=this.parseFunctionParams(),n.expression=this.options.ecmaVersion>=6&&this.tok.type!==t.tokTypes.braceL,n.body=n.expression?this.parseMaybeAssign():this.parseBlock(),this.inAsync=i,this.finishNode(n,"FunctionExpression")},c.parseArrowExpression=function(e,r,n){var i=this.inAsync;return this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!n),this.inAsync=e.async,e.params=this.toAssignableList(r,!0),e.expression=this.tok.type!==t.tokTypes.braceL,e.body=e.expression?this.parseMaybeAssign():this.parseBlock(),this.inAsync=i,this.finishNode(e,"ArrowFunctionExpression")},c.parseExprList=function(e,r){var i=this;this.pushCx();var o=this.curIndent,a=this.curLineStart,s=[];for(this.next();!this.closes(e,o+1,a);)if(i.eat(t.tokTypes.comma))s.push(r?null:i.dummyIdent());else{var u=i.parseMaybeAssign();if(n(u)){if(i.closes(e,o,a))break;i.next()}else s.push(u);i.eat(t.tokTypes.comma)}return this.popCx(),this.eat(e)||(this.last.end=this.tok.start,this.options.locations&&(this.last.loc.end=this.tok.loc.start)),s},c.parseAwait=function(){var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(),this.finishNode(e,"AwaitExpression")},t.defaultOptions.tabSize=4,t.addLooseExports(i,a,o),e.parse_dammit=i,e.LooseParser=a,e.pluginsLoose=o,Object.defineProperty(e,"__esModule",{value:!0})}),function(e){function t(e,t){return e.lineStart>=t}function r(e,t,r){var n=t.input.slice(t.start);return r&&(n=n.replace(s,"$1 $3")),e.test(n)}function n(e,t,r){var n=new e.constructor(e.options,e.input,t);if(r)for(var i in r)n[i]=r[i];var o=e,a=n;return["inFunction","inAsync","inGenerator","inModule"].forEach(function(e){e in o&&(a[e]=o[e])}),n.nextToken(),n}var i={exports:{}},o=/^async[\t ]+(return|throw)/,a=/^\s*[):;]/,s=/([^\n])\/\*(\*(?!\/)|[^\n*])*\*\/([^\n])/g;i.exports=function(e,i){i&&"object"==typeof i||(i={}),e.extend("parse",function(t){return function(){return this.inAsync=i.inAsyncFunction,i.awaitAnywhere&&i.inAsyncFunction&&e.raise(node.start,"The options awaitAnywhere and inAsyncFunction are mutually exclusive"),t.apply(this,arguments)}}),e.extend("parseStatement",function(e){return function(t,n){var a=this.start,s=this.startLoc;if("name"===this.type.label&&i.asyncExits&&r(o,this)){this.next();var u=this.parseStatement(t,n);return u.async=!0,u.start=a,u.loc&&(u.loc.start=s),u.range&&(u.range[0]=a),u}return e.apply(this,arguments)}}),e.extend("parseIdent",function(e){return function(t){return"module"===this.options.sourceType&&this.options.ecmaVersion>=8&&i.awaitAnywhere?e.call(this,!0):e.apply(this,arguments)}}),e.extend("parseExprAtom",function(e){var t={};return function(r){var o,a=this.start,s=(this.startLoc,e.apply(this,arguments));if("Identifier"===s.type&&"await"===s.name&&!this.inAsync&&i.awaitAnywhere){var u=this.startNodeAt(s.start,s.loc&&s.loc.start);a=this.start;var c={raise:function(){try{return pp.raise.apply(this,arguments)}catch(e){throw t}}};try{if((o=n(this,a-4,c).parseExprSubscripts()).end<=a)return o=n(this,a,c).parseExprSubscripts(),u.argument=o,u=this.finishNodeAt(u,"AwaitExpression",o.end,o.loc&&o.loc.end),this.pos=o.end,this.end=o.end,this.endLoc=o.endLoc,this.next(),u}catch(e){if(e===t)return s;throw e}}return s}});var s={undefined:!0,get:!0,set:!0,static:!0,async:!0,constructor:!0};e.extend("parsePropertyName",function(e){return function(r){var n=r.key&&r.key.name,i=e.apply(this,arguments);return"get"===this.value&&(r.__maybeStaticAsyncGetter=!0),s[this.value]?i:("Identifier"!==i.type||"async"!==i.name&&"async"!==n||t(this,i.end)||this.input.slice(i.end).match(a)?delete r.__maybeStaticAsyncGetter:"set"===r.kind||"set"===i.name?this.raise(i.start,"'set <member>(value)' cannot be be async"):(this.__isAsyncProp=!0,"Identifier"===(i=e.apply(this,arguments)).type&&"set"===i.name&&this.raise(i.start,"'set <member>(value)' cannot be be async")),i)}}),e.extend("parseClassMethod",function(e){return function(t,r,n){var i=e.apply(this,arguments);return r.__maybeStaticAsyncGetter&&(delete r.__maybeStaticAsyncGetter,"get"!==r.key.name&&(r.kind="get")),i}}),e.extend("parseFunctionBody",function(e){return function(t,r){var n=this.inAsync;this.__isAsyncProp&&(t.async=!0,this.inAsync=!0,delete this.__isAsyncProp);var i=e.apply(this,arguments);return this.inAsync=n,i}})},e.plugins.asyncawait=i.exports}(this.acorn),function(e){var t={exports:{}};t.exports=function(e){function t(e,t){var n=this.startNode(),i=!0,o={};for(n.properties=[],this.next();!this.eat(r.braceR);){if(i)i=!1;else if(this.expect(r.comma),this.afterTrailingComma(r.braceR))break;var a,s,u,c,l=this.startNode();if(this.options.ecmaVersion>=6){if(this.type===r.ellipsis){(l=this.parseSpread()).type=e?"RestElement":"SpreadElement",n.properties.push(l);continue}l.method=!1,l.shorthand=!1,(e||t)&&(u=this.start,c=this.startLoc),e||(a=this.eat(r.star))}this.parsePropertyName(l),e||!(this.options.ecmaVersion>=8)||a||l.computed||"Identifier"!==l.key.type||"async"!==l.key.name||this.type===r.parenL||this.type===r.colon||this.canInsertSemicolon()?s=!1:(s=!0,this.parsePropertyName(l,t)),this.parsePropertyValue(l,e,a,s,u,c,t),this.checkPropClash(l,o),n.properties.push(this.finishNode(l,"Property"))}return this.finishNode(n,e?"ObjectPattern":"ObjectExpression")}var r=e.tokTypes,n=e.Parser.prototype;return e.plugins.objectSpread=function(e){n.parseObj=t},e},t.exports(e)}(this.acorn),this.acorn}(),function(t){(function(r){function n(e,t){if({}.hasOwnProperty.call(n.cache,e))return n.cache[e];var r=n.resolve(e);if(!r)throw new Error("Failed to resolve module "+e);var i={id:e,require:n,filename:e,exports:{},loaded:!1,parent:t,children:[]};t&&t.children.push(i);var o=e.slice(0,e.lastIndexOf("/")+1);return n.cache[e]=i.exports,r.call(i.exports,i,i.exports,o,e),i.loaded=!0,n.cache[e]=i.exports}n.modules={},n.cache={},n.resolve=function(e){return{}.hasOwnProperty.call(n.modules,e)?n.modules[e]:void 0},n.define=function(e,t){n.modules[e]=t};var i=function(){var e="/";return{title:"browser",version:"v7.10.0",browser:!0,env:{},argv:[],nextTick:r.setImmediate||function(e){setTimeout(e,0)},cwd:function(){return e},chdir:function(t){e=t}}}();n.define("/tools/entry-point.js",function(e,i,o,a){!function(){"use strict";r.escodegen=n("/escodegen.js",e),t.escodegen.browser=!0}()}),n.define("/escodegen.js",function(e,t,i,o){!function(){"use strict";function i(e){return R.Expression.hasOwnProperty(e.type)}function o(e){return R.Statement.hasOwnProperty(e.type)}function a(){return{indent:null,base:null,parse:null,comment:!1,format:{indent:{style:"    ",base:0,adjustMultilineComment:!1},newline:"\n",space:" ",json:!1,renumber:!1,hexadecimal:!1,quotes:"single",escapeless:!1,compact:!1,parentheses:!0,semicolons:!0,safeConcatenation:!1,preserveBlankLines:!1},moz:{comprehensionExpressionStartsWithAssignment:!1,starlessGenerator:!1},sourceMap:null,sourceMapRoot:null,sourceMapWithCode:!1,directive:!1,raw:!0,verbatim:null,sourceCode:null}}function s(e,t){var r="";for(t|=0;t>0;t>>>=1,e+=e)1&t&&(r+=e);return r}function u(e){return/[\r\n]/g.test(e)}function c(e){var t=e.length;return t&&z.code.isLineTerminator(e.charCodeAt(t-1))}function l(e,t){var r;for(r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}function f(e,t){function r(e){return"object"==typeof e&&e instanceof Object&&!(e instanceof RegExp)}var n,i;for(n in t)t.hasOwnProperty(n)&&(r(i=t[n])?r(e[n])?f(e[n],i):e[n]=f({},i):e[n]=i);return e}function p(e){var t,r,n,i,o;if(e!==e)throw new Error("Numeric literal whose value is NaN");if(e<0||0===e&&1/e<0)throw new Error("Numeric literal whose value is negative");if(e===1/0)return J?"null":K?"1e400":"1e+400";if(t=""+e,!K||t.length<3)return t;for(r=t.indexOf("."),J||48!==t.charCodeAt(0)||1!==r||(r=0,t=t.slice(1)),n=t,t=t.replace("e+","e"),i=0,(o=n.indexOf("e"))>0&&(i=+n.slice(o+1),n=n.slice(0,o)),r>=0&&(i-=n.length-r-1,n=+(n.slice(0,r)+n.slice(r+1))+""),o=0;48===n.charCodeAt(n.length+o-1);)--o;return 0!==o&&(i-=o,n=n.slice(0,o)),0!==i&&(n+="e"+i),(n.length<t.length||Y&&e>1e12&&Math.floor(e)===e&&(n="0x"+e.toString(16)).length<t.length)&&+n===e&&(t=n),t}function d(e,t){return 8232==(-2&e)?(t?"u":"\\u")+(8232===e?"2028":"2029"):10===e||13===e?(t?"":"\\")+(10===e?"n":"r"):String.fromCharCode(e)}function h(e){var t,r,n,i,o,a,s,u;if(r=e.toString(),e.source){if(!(t=r.match(/\/([^\/]*)$/)))return r;for(n=t[1],r="",s=!1,u=!1,i=0,o=e.source.length;i<o;++i)a=e.source.charCodeAt(i),u?(r+=d(a,u),u=!1):(s?93===a&&(s=!1):47===a?r+="\\":91===a&&(s=!0),r+=d(a,u),u=92===a);return"/"+r+"/"+n}return r}function m(e,t){var r;return 8===e?"\\b":12===e?"\\f":9===e?"\\t":(r=e.toString(16).toUpperCase(),J||e>255?"\\u"+"0000".slice(r.length)+r:0!==e||z.code.isDecimalDigit(t)?11===e?"\\x0B":"\\x"+"00".slice(r.length)+r:"\\0")}function v(e){if(92===e)return"\\\\";if(10===e)return"\\n";if(13===e)return"\\r";if(8232===e)return"\\u2028";if(8233===e)return"\\u2029";throw new Error("Incorrectly classified character")}function y(e){var t,r,n,i;for(i="double"===Q?'"':"'",t=0,r=e.length;t<r;++t){if(39===(n=e.charCodeAt(t))){i='"';break}if(34===n){i="'";break}92===n&&++t}return i+e+i}function g(e){var t,r,n,i,o,a="",s=0,u=0;for(t=0,r=e.length;t<r;++t){if(39===(n=e.charCodeAt(t)))++s;else if(34===n)++u;else if(47===n&&J)a+="\\";else{if(z.code.isLineTerminator(n)||92===n){a+=v(n);continue}if(!z.code.isIdentifierPartES5(n)&&(J&&n<32||!J&&!X&&(n<32||n>126))){a+=m(n,e.charCodeAt(t+1));continue}}a+=String.fromCharCode(n)}if(i=!("double"===Q||"auto"===Q&&u<s),o=i?"'":'"',!(i?s:u))return o+a+o;for(e=a,a=o,t=0,r=e.length;t<r;++t)(39===(n=e.charCodeAt(t))&&i||34===n&&!i)&&(a+="\\"),a+=String.fromCharCode(n);return a+o}function b(e){var t,r,n,i="";for(t=0,r=e.length;t<r;++t)n=e[t],i+=V(n)?b(n):n;return i}function _(e,t){if(!se)return V(e)?b(e):e;if(null==t){if(e instanceof $)return e;t={}}return null==t.loc?new $(null,null,se,e,t.name||null):new $(t.loc.start.line,t.loc.start.column,!0===se?t.loc.source||null:se,e,t.name||null)}function w(){return ee||" "}function x(e,t){var r,n,i,o;return 0===(r=_(e).toString()).length?[t]:0===(n=_(t).toString()).length?[e]:(i=r.charCodeAt(r.length-1),o=n.charCodeAt(0),(43===i||45===i)&&i===o||z.code.isIdentifierPartES5(i)&&z.code.isIdentifierPartES5(o)||47===i&&105===o?[e,w(),t]:z.code.isWhiteSpace(i)||z.code.isLineTerminator(i)||z.code.isWhiteSpace(o)||z.code.isLineTerminator(o)?[e,t]:[e,ee,t])}function k(e){return[G,e]}function E(e){var t;t=G,e(G+=H),G=t}function S(e){var t;for(t=e.length-1;t>=0&&!z.code.isLineTerminator(e.charCodeAt(t));--t);return e.length-1-t}function A(e,t){var r,n,i,o,a,s,u,c;for(r=e.split(/\r\n|[\r\n]/),s=Number.MAX_VALUE,n=1,i=r.length;n<i;++n){for(o=r[n],a=0;a<o.length&&z.code.isWhiteSpace(o.charCodeAt(a));)++a;s>a&&(s=a)}for(void 0!==t?(u=G,"*"===r[1][s]&&(t+=" "),G=t):(1&s&&--s,u=G),n=1,i=r.length;n<i;++n)c=_(k(r[n].slice(s))),r[n]=se?c.join(""):c;return G=u,r.join("\n")}function D(e,t){if("Line"===e.type){if(c(e.value))return"//"+e.value;var r="//"+e.value;return ce||(r+="\n"),r}return oe.format.indent.adjustMultilineComment&&/[\n\r]/.test(e.value)?A("/*"+e.value+"*/",t):"/*"+e.value+"*/"}function C(e,t){var r,n,i,o,a,u,l,f,p,d,h,m;if(e.leadingComments&&e.leadingComments.length>0){if(o=t,ce){for(t=[],f=(i=e.leadingComments[0]).extendedRange,p=i.range,(m=((h=ue.substring(f[0],p[0])).match(/\n/g)||[]).length)>0?(t.push(s("\n",m)),t.push(k(D(i)))):(t.push(h),t.push(D(i))),d=p,r=1,n=e.leadingComments.length;r<n;r++)p=(i=e.leadingComments[r]).range,m=(ue.substring(d[1],p[0]).match(/\n/g)||[]).length,t.push(s("\n",m)),t.push(k(D(i))),d=p;m=(ue.substring(p[1],f[1]).match(/\n/g)||[]).length,t.push(s("\n",m))}else for(i=e.leadingComments[0],t=[],ne&&e.type===M.Program&&0===e.body.length&&t.push("\n"),t.push(D(i)),c(_(t).toString())||t.push("\n"),r=1,n=e.leadingComments.length;r<n;++r)c(_(l=[D(i=e.leadingComments[r])]).toString())||l.push("\n"),t.push(k(l));t.push(k(o))}if(e.trailingComments)if(ce)f=(i=e.trailingComments[0]).extendedRange,p=i.range,(m=((h=ue.substring(f[0],p[0])).match(/\n/g)||[]).length)>0?(t.push(s("\n",m)),t.push(k(D(i)))):(t.push(h),t.push(D(i)));else for(a=!c(_(t).toString()),u=s(" ",S(_([G,t,H]).toString())),r=0,n=e.trailingComments.length;r<n;++r)i=e.trailingComments[r],a?(t=0===r?[t,H]:[t,u]).push(D(i,u)):t=[t,k(D(i))],r===n-1||c(_(t).toString())||(t=[t,"\n"]);return t}function F(e,t,r){var n,i=0;for(n=e;n<t;n++)"\n"===ue[n]&&i++;for(n=1;n<i;n++)r.push(Z)}function O(e,t,r){return t<r?["(",e,")"]:e}function j(e){var t,r,n;for(t=1,r=(n=e.split(/\r\n|\n/)).length;t<r;t++)n[t]=Z+G+n[t];return n}function B(e,t){var r,n;return r=e[oe.verbatim],n="string"==typeof r?O(j(r),q.Sequence,t):O(n=j(r.content),null!=r.precedence?r.precedence:q.Sequence,t),_(n,e)}function R(){}function P(e){return _(e.name,e)}function T(e,t){return e.async?"async"+(t?w():ee):""}function I(e){return e.generator&&!oe.moz.starlessGenerator?"*"+ee:""}function L(e){var t=e.value;return t.async?T(t,!e.computed):I(t)?"*":""}function N(e){var t;if(t=new R,o(e))return t.generateStatement(e,de);if(i(e))return t.generateExpression(e,q.Sequence,pe);throw new Error("Unknown node type: "+e.type)}var M,q,W,$,U,z,V,G,H,J,K,Y,Q,X,Z,ee,te,re,ne,ie,oe,ae,se,ue,ce,le,fe;U=n("/node_modules/estraverse/estraverse.js",e),z=n("/node_modules/esutils/lib/utils.js",e),M=U.Syntax,W={"||":(q={Sequence:0,Yield:1,Await:1,Assignment:1,Conditional:2,ArrowFunction:2,LogicalOR:3,LogicalAND:4,BitwiseOR:5,BitwiseXOR:6,BitwiseAND:7,Equality:8,Relational:9,BitwiseSHIFT:10,Additive:11,Multiplicative:12,Unary:13,Postfix:14,Call:15,New:16,TaggedTemplate:17,Member:18,Primary:19}).LogicalOR,"&&":q.LogicalAND,"|":q.BitwiseOR,"^":q.BitwiseXOR,"&":q.BitwiseAND,"==":q.Equality,"!=":q.Equality,"===":q.Equality,"!==":q.Equality,is:q.Equality,isnt:q.Equality,"<":q.Relational,">":q.Relational,"<=":q.Relational,">=":q.Relational,in:q.Relational,instanceof:q.Relational,"<<":q.BitwiseSHIFT,">>":q.BitwiseSHIFT,">>>":q.BitwiseSHIFT,"+":q.Additive,"-":q.Additive,"*":q.Multiplicative,"%":q.Multiplicative,"/":q.Multiplicative};var pe=7,de=1;(V=Array.isArray)||(V=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),R.prototype.maybeBlock=function(e,t){var r,n,i=this;return n=!oe.comment||!e.leadingComments,e.type===M.BlockStatement&&n?[ee,this.generateStatement(e,t)]:e.type===M.EmptyStatement&&n?";":(E(function(){r=[Z,k(i.generateStatement(e,t))]}),r)},R.prototype.maybeBlockSuffix=function(e,t){var r=c(_(t).toString());return e.type!==M.BlockStatement||oe.comment&&e.leadingComments||r?r?[t,G]:[t,Z,G]:[t,ee]},R.prototype.generatePattern=function(e,t,r){return e.type===M.Identifier?P(e):this.generateExpression(e,t,r)},R.prototype.generateFunctionParams=function(e){var t,r,n,i;if(i=!1,e.type!==M.ArrowFunctionExpression||e.rest||e.defaults&&0!==e.defaults.length||1!==e.params.length||e.params[0].type!==M.Identifier){for((n=e.type===M.ArrowFunctionExpression?[T(e,!1)]:[]).push("("),e.defaults&&(i=!0),t=0,r=e.params.length;t<r;++t)i&&e.defaults[t]?n.push(this.generateAssignment(e.params[t],e.defaults[t],"=",q.Assignment,pe)):n.push(this.generatePattern(e.params[t],q.Assignment,pe)),t+1<r&&n.push(","+ee);e.rest&&(e.params.length&&n.push(","+ee),n.push("..."),n.push(P(e.rest))),n.push(")")}else n=[T(e,!0),P(e.params[0])];return n},R.prototype.generateFunctionBody=function(e){var t,r;return t=this.generateFunctionParams(e),e.type===M.ArrowFunctionExpression&&(t.push(ee),t.push("=>")),e.expression?(t.push(ee),"{"===(r=this.generateExpression(e.body,q.Assignment,pe)).toString().charAt(0)&&(r=["(",r,")"]),t.push(r)):t.push(this.maybeBlock(e.body,9)),t},R.prototype.generateIterationForStatement=function(e,t,r){var n=["for"+ee+"("],i=this;return E(function(){t.left.type===M.VariableDeclaration?E(function(){n.push(t.left.kind+w()),n.push(i.generateStatement(t.left.declarations[0],0))}):n.push(i.generateExpression(t.left,q.Call,pe)),n=x(n,e),n=[x(n,i.generateExpression(t.right,q.Sequence,pe)),")"]}),n.push(this.maybeBlock(t.body,r)),n},R.prototype.generatePropertyKey=function(e,t,r){var n=[];return t&&n.push("["),"AssignmentPattern"===r.type?n.push(this.AssignmentPattern(r,q.Sequence,pe)):n.push(this.generateExpression(e,q.Sequence,pe)),t&&n.push("]"),n},R.prototype.generateAssignment=function(e,t,r,n,i){return q.Assignment<n&&(i|=1),O([this.generateExpression(e,q.Call,i),ee+r+ee,this.generateExpression(t,q.Assignment,i)],q.Assignment,n)},R.prototype.semicolon=function(e){return!re&&32&e?"":";"},R.Statement={BlockStatement:function(e,t){var r,n,i=["{",Z],o=this;return E(function(){0===e.body.length&&ce&&(r=e.range)[1]-r[0]>2&&("\n"===(n=ue.substring(r[0]+1,r[1]-1))[0]&&(i=["{"]),i.push(n));var a,s,u,l;for(l=de,8&t&&(l|=16),a=0,s=e.body.length;a<s;++a)ce&&(0===a&&(e.body[0].leadingComments&&(r=e.body[0].leadingComments[0].extendedRange,"\n"===(n=ue.substring(r[0],r[1]))[0]&&(i=["{"])),e.body[0].leadingComments||F(e.range[0],e.body[0].range[0],i)),a>0&&(e.body[a-1].trailingComments||e.body[a].leadingComments||F(e.body[a-1].range[1],e.body[a].range[0],i))),a===s-1&&(l|=32),u=e.body[a].leadingComments&&ce?o.generateStatement(e.body[a],l):k(o.generateStatement(e.body[a],l)),i.push(u),c(_(u).toString())||(ce&&a<s-1?e.body[a+1].leadingComments||i.push(Z):i.push(Z)),ce&&a===s-1&&(e.body[a].trailingComments||F(e.body[a].range[1],e.range[1],i))}),i.push(k("}")),i},BreakStatement:function(e,t){return e.label?"break "+e.label.name+this.semicolon(t):"break"+this.semicolon(t)},ContinueStatement:function(e,t){return e.label?"continue "+e.label.name+this.semicolon(t):"continue"+this.semicolon(t)},ClassBody:function(e,t){var r=["{",Z],n=this;return E(function(t){var i,o;for(i=0,o=e.body.length;i<o;++i)r.push(t),r.push(n.generateExpression(e.body[i],q.Sequence,pe)),i+1<o&&r.push(Z)}),c(_(r).toString())||r.push(Z),r.push(G),r.push("}"),r},ClassDeclaration:function(e,t){var r;return r=["class"],e.id&&(r=x(r,this.generateExpression(e.id,q.Sequence,pe))),e.superClass&&(r=x(r,x("extends",this.generateExpression(e.superClass,q.Assignment,pe)))),r.push(ee),r.push(this.generateStatement(e.body,33)),r},DirectiveStatement:function(e,t){return oe.raw&&e.raw?e.raw+this.semicolon(t):y(e.directive)+this.semicolon(t)},DoWhileStatement:function(e,t){var r=x("do",this.maybeBlock(e.body,de));return r=this.maybeBlockSuffix(e.body,r),x(r,["while"+ee+"(",this.generateExpression(e.test,q.Sequence,pe),")"+this.semicolon(t)])},CatchClause:function(e,t){var r,n=this;return E(function(){var t;r=["catch"+ee+"(",n.generateExpression(e.param,q.Sequence,pe),")"],e.guard&&(t=n.generateExpression(e.guard,q.Sequence,pe),r.splice(2,0," if ",t))}),r.push(this.maybeBlock(e.body,de)),r},DebuggerStatement:function(e,t){return"debugger"+this.semicolon(t)},EmptyStatement:function(e,t){return";"},ExportDefaultDeclaration:function(e,t){var r,n=["export"];return r=32&t?33:de,n=x(n,"default"),n=o(e.declaration)?x(n,this.generateStatement(e.declaration,r)):x(n,this.generateExpression(e.declaration,q.Assignment,pe)+this.semicolon(t))},ExportNamedDeclaration:function(e,t){var r,n=["export"],i=this;return r=32&t?33:de,e.declaration?x(n,this.generateStatement(e.declaration,r)):(e.specifiers&&(0===e.specifiers.length?n=x(n,"{"+ee+"}"):e.specifiers[0].type===M.ExportBatchSpecifier?n=x(n,this.generateExpression(e.specifiers[0],q.Sequence,pe)):(n=x(n,"{"),E(function(t){var r,o;for(n.push(Z),r=0,o=e.specifiers.length;r<o;++r)n.push(t),n.push(i.generateExpression(e.specifiers[r],q.Sequence,pe)),r+1<o&&n.push(","+Z)}),c(_(n).toString())||n.push(Z),n.push(G+"}")),e.source?n=x(n,["from"+ee,this.generateExpression(e.source,q.Sequence,pe),this.semicolon(t)]):n.push(this.semicolon(t))),n)},ExportAllDeclaration:function(e,t){return["export"+ee,"*"+ee,"from"+ee,this.generateExpression(e.source,q.Sequence,pe),this.semicolon(t)]},ExpressionStatement:function(e,t){var r,n;return r=[this.generateExpression(e.expression,q.Sequence,pe)],n=_(r).toString(),123===n.charCodeAt(0)||function(e){var t;return"class"===e.slice(0,5)&&(123===(t=e.charCodeAt(5))||z.code.isWhiteSpace(t)||z.code.isLineTerminator(t))}(n)||function(e){var t;return"function"===e.slice(0,8)&&(40===(t=e.charCodeAt(8))||z.code.isWhiteSpace(t)||42===t||z.code.isLineTerminator(t))}(n)||function(e){var t,r,n;if("async"!==e.slice(0,5))return!1;if(!z.code.isWhiteSpace(e.charCodeAt(5)))return!1;for(r=6,n=e.length;r<n&&z.code.isWhiteSpace(e.charCodeAt(r));++r);return r!==n&&"function"===e.slice(r,r+8)&&(40===(t=e.charCodeAt(r+8))||z.code.isWhiteSpace(t)||42===t||z.code.isLineTerminator(t))}(n)||ie&&16&t&&e.expression.type===M.Literal&&"string"==typeof e.expression.value?r=["(",r,")"+this.semicolon(t)]:r.push(this.semicolon(t)),r},ImportDeclaration:function(e,t){var r,n,i=this;return 0===e.specifiers.length?["import",ee,this.generateExpression(e.source,q.Sequence,pe),this.semicolon(t)]:(r=["import"],n=0,e.specifiers[n].type===M.ImportDefaultSpecifier&&(r=x(r,[this.generateExpression(e.specifiers[n],q.Sequence,pe)]),++n),e.specifiers[n]&&(0!==n&&r.push(","),e.specifiers[n].type===M.ImportNamespaceSpecifier?r=x(r,[ee,this.generateExpression(e.specifiers[n],q.Sequence,pe)]):(r.push(ee+"{"),e.specifiers.length-n==1?(r.push(ee),r.push(this.generateExpression(e.specifiers[n],q.Sequence,pe)),r.push(ee+"}"+ee)):(E(function(t){var o,a;for(r.push(Z),o=n,a=e.specifiers.length;o<a;++o)r.push(t),r.push(i.generateExpression(e.specifiers[o],q.Sequence,pe)),o+1<a&&r.push(","+Z)}),c(_(r).toString())||r.push(Z),r.push(G+"}"+ee)))),r=x(r,["from"+ee,this.generateExpression(e.source,q.Sequence,pe),this.semicolon(t)]))},VariableDeclarator:function(e,t){var r=1&t?pe:6;return e.init?[this.generateExpression(e.id,q.Assignment,r),ee,"=",ee,this.generateExpression(e.init,q.Assignment,r)]:this.generatePattern(e.id,q.Assignment,r)},VariableDeclaration:function(e,t){function r(){for(a=e.declarations[0],oe.comment&&a.leadingComments?(n.push("\n"),n.push(k(u.generateStatement(a,s)))):(n.push(w()),n.push(u.generateStatement(a,s))),i=1,o=e.declarations.length;i<o;++i)a=e.declarations[i],oe.comment&&a.leadingComments?(n.push(","+Z),n.push(k(u.generateStatement(a,s)))):(n.push(","+ee),n.push(u.generateStatement(a,s)))}var n,i,o,a,s,u=this;return n=[e.kind],s=1&t?de:0,e.declarations.length>1?E(r):r(),n.push(this.semicolon(t)),n},ThrowStatement:function(e,t){return[x("throw",this.generateExpression(e.argument,q.Sequence,pe)),this.semicolon(t)]},TryStatement:function(e,t){var r,n,i,o;if(r=["try",this.maybeBlock(e.block,de)],r=this.maybeBlockSuffix(e.block,r),e.handlers)for(n=0,i=e.handlers.length;n<i;++n)r=x(r,this.generateStatement(e.handlers[n],de)),(e.finalizer||n+1!==i)&&(r=this.maybeBlockSuffix(e.handlers[n].body,r));else{for(n=0,i=(o=e.guardedHandlers||[]).length;n<i;++n)r=x(r,this.generateStatement(o[n],de)),(e.finalizer||n+1!==i)&&(r=this.maybeBlockSuffix(o[n].body,r));if(e.handler)if(V(e.handler))for(n=0,i=e.handler.length;n<i;++n)r=x(r,this.generateStatement(e.handler[n],de)),(e.finalizer||n+1!==i)&&(r=this.maybeBlockSuffix(e.handler[n].body,r));else r=x(r,this.generateStatement(e.handler,de)),e.finalizer&&(r=this.maybeBlockSuffix(e.handler.body,r))}return e.finalizer&&(r=x(r,["finally",this.maybeBlock(e.finalizer,de)])),r},SwitchStatement:function(e,t){var r,n,i,o,a,s=this;if(E(function(){r=["switch"+ee+"(",s.generateExpression(e.discriminant,q.Sequence,pe),")"+ee+"{"+Z]}),e.cases)for(a=de,i=0,o=e.cases.length;i<o;++i)i===o-1&&(a|=32),n=k(this.generateStatement(e.cases[i],a)),r.push(n),c(_(n).toString())||r.push(Z);return r.push(k("}")),r},SwitchCase:function(e,t){var r,n,i,o,a,s=this;return E(function(){for(r=e.test?[x("case",s.generateExpression(e.test,q.Sequence,pe)),":"]:["default:"],i=0,(o=e.consequent.length)&&e.consequent[0].type===M.BlockStatement&&(n=s.maybeBlock(e.consequent[0],de),r.push(n),i=1),i===o||c(_(r).toString())||r.push(Z),a=de;i<o;++i)i===o-1&&32&t&&(a|=32),n=k(s.generateStatement(e.consequent[i],a)),r.push(n),i+1===o||c(_(n).toString())||r.push(Z)}),r},IfStatement:function(e,t){var r,n,i,o=this;return E(function(){r=["if"+ee+"(",o.generateExpression(e.test,q.Sequence,pe),")"]}),i=32&t,n=de,i&&(n|=32),e.alternate?(r.push(this.maybeBlock(e.consequent,de)),r=this.maybeBlockSuffix(e.consequent,r),r=e.alternate.type===M.IfStatement?x(r,["else ",this.generateStatement(e.alternate,n)]):x(r,x("else",this.maybeBlock(e.alternate,n)))):r.push(this.maybeBlock(e.consequent,n)),r},ForStatement:function(e,t){var r,n=this;return E(function(){r=["for"+ee+"("],e.init?e.init.type===M.VariableDeclaration?r.push(n.generateStatement(e.init,0)):(r.push(n.generateExpression(e.init,q.Sequence,6)),r.push(";")):r.push(";"),e.test?(r.push(ee),r.push(n.generateExpression(e.test,q.Sequence,pe)),r.push(";")):r.push(";"),e.update?(r.push(ee),r.push(n.generateExpression(e.update,q.Sequence,pe)),r.push(")")):r.push(")")}),r.push(this.maybeBlock(e.body,32&t?33:de)),r},ForInStatement:function(e,t){return this.generateIterationForStatement("in",e,32&t?33:de)},ForOfStatement:function(e,t){return this.generateIterationForStatement("of",e,32&t?33:de)},LabeledStatement:function(e,t){return[e.label.name+":",this.maybeBlock(e.body,32&t?33:de)]},Program:function(e,t){var r,n,i,o,a;for(o=e.body.length,r=[ne&&o>0?"\n":""],a=17,i=0;i<o;++i)ne||i!==o-1||(a|=32),ce&&(0===i&&(e.body[0].leadingComments||F(e.range[0],e.body[i].range[0],r)),i>0&&(e.body[i-1].trailingComments||e.body[i].leadingComments||F(e.body[i-1].range[1],e.body[i].range[0],r))),n=k(this.generateStatement(e.body[i],a)),r.push(n),i+1<o&&!c(_(n).toString())&&(ce?e.body[i+1].leadingComments||r.push(Z):r.push(Z)),ce&&i===o-1&&(e.body[i].trailingComments||F(e.body[i].range[1],e.range[1],r));return r},FunctionDeclaration:function(e,t){return[T(e,!0),"function",I(e)||w(),e.id?P(e.id):"",this.generateFunctionBody(e)]},ReturnStatement:function(e,t){return e.argument?[x("return",this.generateExpression(e.argument,q.Sequence,pe)),this.semicolon(t)]:["return"+this.semicolon(t)]},WhileStatement:function(e,t){var r,n=this;return E(function(){r=["while"+ee+"(",n.generateExpression(e.test,q.Sequence,pe),")"]}),r.push(this.maybeBlock(e.body,32&t?33:de)),r},WithStatement:function(e,t){var r,n=this;return E(function(){r=["with"+ee+"(",n.generateExpression(e.object,q.Sequence,pe),")"]}),r.push(this.maybeBlock(e.body,32&t?33:de)),r}},l(R.prototype,R.Statement),R.Expression={SequenceExpression:function(e,t,r){var n,i,o;for(q.Sequence<t&&(r|=1),n=[],i=0,o=e.expressions.length;i<o;++i)n.push(this.generateExpression(e.expressions[i],q.Assignment,r)),i+1<o&&n.push(","+ee);return O(n,q.Sequence,t)},AssignmentExpression:function(e,t,r){return this.generateAssignment(e.left,e.right,e.operator,t,r)},ArrowFunctionExpression:function(e,t,r){return O(this.generateFunctionBody(e),q.ArrowFunction,t)},ConditionalExpression:function(e,t,r){return q.Conditional<t&&(r|=1),O([this.generateExpression(e.test,q.LogicalOR,r),ee+"?"+ee,this.generateExpression(e.consequent,q.Assignment,r),ee+":"+ee,this.generateExpression(e.alternate,q.Assignment,r)],q.Conditional,t)},LogicalExpression:function(e,t,r){return this.BinaryExpression(e,t,r)},BinaryExpression:function(e,t,r){var n,i,o,a;return(i=W[e.operator])<t&&(r|=1),o=this.generateExpression(e.left,i,r),a=o.toString(),n=47===a.charCodeAt(a.length-1)&&z.code.isIdentifierPartES5(e.operator.charCodeAt(0))?[o,w(),e.operator]:x(o,e.operator),o=this.generateExpression(e.right,i+1,r),"/"===e.operator&&"/"===o.toString().charAt(0)||"<"===e.operator.slice(-1)&&"!--"===o.toString().slice(0,3)?(n.push(w()),n.push(o)):n=x(n,o),"in"!==e.operator||1&r?O(n,i,t):["(",n,")"]},CallExpression:function(e,t,r){var n,i,o;for((n=[this.generateExpression(e.callee,q.Call,3)]).push("("),i=0,o=e.arguments.length;i<o;++i)n.push(this.generateExpression(e.arguments[i],q.Assignment,pe)),i+1<o&&n.push(","+ee);return n.push(")"),2&r?O(n,q.Call,t):["(",n,")"]},NewExpression:function(e,t,r){var n,i,o,a,s;if(i=e.arguments.length,s=4&r&&!te&&0===i?5:1,n=x("new",this.generateExpression(e.callee,q.New,s)),!(4&r)||te||i>0){for(n.push("("),o=0,a=i;o<a;++o)n.push(this.generateExpression(e.arguments[o],q.Assignment,pe)),o+1<a&&n.push(","+ee);n.push(")")}return O(n,q.New,t)},MemberExpression:function(e,t,r){var n,i;return n=[this.generateExpression(e.object,q.Call,2&r?3:1)],e.computed?(n.push("["),n.push(this.generateExpression(e.property,q.Sequence,2&r?pe:5)),n.push("]")):(e.object.type===M.Literal&&"number"==typeof e.object.value&&(i=_(n).toString()).indexOf(".")<0&&!/[eExX]/.test(i)&&z.code.isDecimalDigit(i.charCodeAt(i.length-1))&&!(i.length>=2&&48===i.charCodeAt(0))&&n.push("."),n.push("."),n.push(P(e.property))),O(n,q.Member,t)},MetaProperty:function(e,t,r){var n,i,o;return i="string"==typeof e.meta.type&&e.meta.type===M.Identifier?e.meta.name:e.meta,o="string"==typeof e.property.type&&e.property.type===M.Identifier?e.property.name:e.property,n=[i,".",o],O(n,q.Member,t)},UnaryExpression:function(e,t,r){var n,i,o,a,s;return i=this.generateExpression(e.argument,q.Unary,pe),""===ee?n=x(e.operator,i):(n=[e.operator],e.operator.length>2?n=x(n,i):(s=(a=_(n).toString()).charCodeAt(a.length-1),o=i.toString().charCodeAt(0),(43===s||45===s)&&s===o||z.code.isIdentifierPartES5(s)&&z.code.isIdentifierPartES5(o)?(n.push(w()),n.push(i)):n.push(i))),O(n,q.Unary,t)},YieldExpression:function(e,t,r){var n;return n=e.delegate?"yield*":"yield",e.argument&&(n=x(n,this.generateExpression(e.argument,q.Yield,pe))),O(n,q.Yield,t)},AwaitExpression:function(e,t,r){return O(x(e.all?"await*":"await",this.generateExpression(e.argument,q.Await,pe)),q.Await,t)},UpdateExpression:function(e,t,r){return e.prefix?O([e.operator,this.generateExpression(e.argument,q.Unary,pe)],q.Unary,t):O([this.generateExpression(e.argument,q.Postfix,pe),e.operator],q.Postfix,t)},FunctionExpression:function(e,t,r){var n=[T(e,!0),"function"];return e.id?(n.push(I(e)||w()),n.push(P(e.id))):n.push(I(e)||ee),n.push(this.generateFunctionBody(e)),n},ArrayPattern:function(e,t,r){return this.ArrayExpression(e,t,r,!0)},ArrayExpression:function(e,t,r,n){var i,o,a=this;return e.elements.length?(o=!n&&e.elements.length>1,i=["[",o?Z:""],E(function(t){var r,n;for(r=0,n=e.elements.length;r<n;++r)e.elements[r]?(i.push(o?t:""),i.push(a.generateExpression(e.elements[r],q.Assignment,pe))):(o&&i.push(t),r+1===n&&i.push(",")),r+1<n&&i.push(","+(o?Z:ee))}),o&&!c(_(i).toString())&&i.push(Z),i.push(o?G:""),i.push("]"),i):"[]"},RestElement:function(e,t,r){return"..."+this.generatePattern(e.argument)},ClassExpression:function(e,t,r){var n;return n=["class"],e.id&&(n=x(n,this.generateExpression(e.id,q.Sequence,pe))),e.superClass&&(n=x(n,x("extends",this.generateExpression(e.superClass,q.Assignment,pe)))),n.push(ee),n.push(this.generateStatement(e.body,33)),n},MethodDefinition:function(e,t,r){var n,i;return n=e.static?["static"+ee]:[],i="get"===e.kind||"set"===e.kind?[x(e.kind,this.generatePropertyKey(e.key,e.computed,e.value)),this.generateFunctionBody(e.value)]:[L(e),this.generatePropertyKey(e.key,e.computed,e.value),this.generateFunctionBody(e.value)],x(n,i)},Property:function(e,t,r){return"get"===e.kind||"set"===e.kind?[e.kind,w(),this.generatePropertyKey(e.key,e.computed,e.value),this.generateFunctionBody(e.value)]:e.shorthand?this.generatePropertyKey(e.key,e.computed,e.value):e.method?[L(e),this.generatePropertyKey(e.key,e.computed,e.value),this.generateFunctionBody(e.value)]:[this.generatePropertyKey(e.key,e.computed,e.value),":"+ee,this.generateExpression(e.value,q.Assignment,pe)]},ObjectExpression:function(e,t,r){var n,i,o,a=this;return e.properties.length?(n=e.properties.length>1,E(function(){o=a.generateExpression(e.properties[0],q.Sequence,pe)}),n||u(_(o).toString())?(E(function(t){var r,s;if(i=["{",Z,t,o],n)for(i.push(","+Z),r=1,s=e.properties.length;r<s;++r)i.push(t),i.push(a.generateExpression(e.properties[r],q.Sequence,pe)),r+1<s&&i.push(","+Z)}),c(_(i).toString())||i.push(Z),i.push(G),i.push("}"),i):["{",ee,o,ee,"}"]):"{}"},AssignmentPattern:function(e,t,r){return this.generateAssignment(e.left,e.right,"=",t,r)},ObjectPattern:function(e,t,r){var n,i,o,a,s,u=this;if(!e.properties.length)return"{}";if(a=!1,1===e.properties.length)"RestElement"!==(s=e.properties[0]).type&&s.value.type!==M.Identifier&&(a=!0);else for(i=0,o=e.properties.length;i<o;++i)if("RestElement"!==(s=e.properties[i]).type&&!s.shorthand){a=!0;break}return n=["{",a?Z:""],E(function(t){var r,i;for(r=0,i=e.properties.length;r<i;++r)n.push(a?t:""),n.push(u.generateExpression(e.properties[r],q.Sequence,pe)),r+1<i&&n.push(","+(a?Z:ee))}),a&&!c(_(n).toString())&&n.push(Z),n.push(a?G:""),n.push("}"),n},ThisExpression:function(e,t,r){return"this"},Super:function(e,t,r){return"super"},Identifier:function(e,t,r){return P(e)},ImportDefaultSpecifier:function(e,t,r){return P(e.id||e.local)},ImportNamespaceSpecifier:function(e,t,r){var n=["*"],i=e.id||e.local;return i&&n.push(ee+"as"+w()+P(i)),n},ImportSpecifier:function(e,t,r){var n=e.imported,i=[n.name],o=e.local;return o&&o.name!==n.name&&i.push(w()+"as"+w()+P(o)),i},ExportSpecifier:function(e,t,r){var n=e.local,i=[n.name],o=e.exported;return o&&o.name!==n.name&&i.push(w()+"as"+w()+P(o)),i},Literal:function(e,t,r){var n;if(e.hasOwnProperty("raw")&&ae&&oe.raw)try{if((n=ae(e.raw).body[0].expression).type===M.Literal&&n.value===e.value)return e.raw}catch(e){}return null===e.value?"null":"string"==typeof e.value?g(e.value):"number"==typeof e.value?p(e.value):"boolean"==typeof e.value?e.value?"true":"false":e.regex?"/"+e.regex.pattern+"/"+e.regex.flags:h(e.value)},GeneratorExpression:function(e,t,r){return this.ComprehensionExpression(e,t,r)},ComprehensionExpression:function(e,t,r){var n,i,o,a,s=this;return n=e.type===M.GeneratorExpression?["("]:["["],oe.moz.comprehensionExpressionStartsWithAssignment&&(a=this.generateExpression(e.body,q.Assignment,pe),n.push(a)),e.blocks&&E(function(){for(i=0,o=e.blocks.length;i<o;++i)a=s.generateExpression(e.blocks[i],q.Sequence,pe),i>0||oe.moz.comprehensionExpressionStartsWithAssignment?n=x(n,a):n.push(a)}),e.filter&&(n=x(n,"if"+ee),a=this.generateExpression(e.filter,q.Sequence,pe),n=x(n,["(",a,")"])),oe.moz.comprehensionExpressionStartsWithAssignment||(a=this.generateExpression(e.body,q.Assignment,pe),n=x(n,a)),n.push(e.type===M.GeneratorExpression?")":"]"),n},ComprehensionBlock:function(e,t,r){var n;return n=e.left.type===M.VariableDeclaration?[e.left.kind,w(),this.generateStatement(e.left.declarations[0],0)]:this.generateExpression(e.left,q.Call,pe),n=x(n,e.of?"of":"in"),n=x(n,this.generateExpression(e.right,q.Sequence,pe)),["for"+ee+"(",n,")"]},SpreadElement:function(e,t,r){return["...",this.generateExpression(e.argument,q.Assignment,pe)]},TaggedTemplateExpression:function(e,t,r){var n=3;return 2&r||(n=1),O([this.generateExpression(e.tag,q.Call,n),this.generateExpression(e.quasi,q.Primary,4)],q.TaggedTemplate,t)},TemplateElement:function(e,t,r){return e.value.raw},TemplateLiteral:function(e,t,r){var n,i,o;for(n=["`"],i=0,o=e.quasis.length;i<o;++i)n.push(this.generateExpression(e.quasis[i],q.Primary,pe)),i+1<o&&(n.push("${"+ee),n.push(this.generateExpression(e.expressions[i],q.Sequence,pe)),n.push(ee+"}"));return n.push("`"),n},ModuleSpecifier:function(e,t,r){return this.Literal(e,t,r)}},l(R.prototype,R.Expression),R.prototype.generateExpression=function(e,t,r){var n,i;return i=e.type||M.Property,oe.verbatim&&e.hasOwnProperty(oe.verbatim)?B(e,t):(n=this[i](e,t,r),oe.comment&&(n=C(e,n)),_(n,e))},R.prototype.generateStatement=function(e,t){var r,n;return r=this[e.type](e,t),oe.comment&&(r=C(e,r)),n=_(r).toString(),e.type!==M.Program||ne||""!==Z||"\n"!==n.charAt(n.length-1)||(r=se?_(r).replaceRight(/\s+$/,""):n.replace(/\s+$/,"")),_(r,e)},le={indent:{style:"",base:0},renumber:!0,hexadecimal:!0,quotes:"auto",escapeless:!0,compact:!0,parentheses:!1,semicolons:!1},fe=a().format,t.version=n("/package.json",e).version,t.generate=function(i,o){var u,c,l=a();return null!=o?("string"==typeof o.indent&&(l.format.indent.style=o.indent),"number"==typeof o.base&&(l.format.indent.base=o.base),o=f(l,o),H=o.format.indent.style,G="string"==typeof o.base?o.base:s(H,o.format.indent.base)):(H=(o=l).format.indent.style,G=s(H,o.format.indent.base)),J=o.format.json,K=o.format.renumber,Y=!J&&o.format.hexadecimal,Q=J?"double":o.format.quotes,X=o.format.escapeless,Z=o.format.newline,ee=o.format.space,o.format.compact&&(Z=ee=H=G=""),te=o.format.parentheses,re=o.format.semicolons,ne=o.format.safeConcatenation,ie=o.directive,ae=J?null:o.parse,se=o.sourceMap,ue=o.sourceCode,ce=o.format.preserveBlankLines&&null!==ue,oe=o,se&&($=t.browser?r.sourceMap.SourceNode:n("/node_modules/source-map/lib/source-map.js",e).SourceNode),u=N(i),se?(c=u.toStringWithSourceMap({file:o.file,sourceRoot:o.sourceMapRoot}),o.sourceContent&&c.map.setSourceContent(o.sourceMap,o.sourceContent),o.sourceMapWithCode?c:c.map.toString()):(c={code:u.toString(),map:null},o.sourceMapWithCode?c:c.code)},t.attachComments=U.attachComments,t.Precedence=f({},q),t.browser=!1,t.FORMAT_MINIFY=le,t.FORMAT_DEFAULTS=fe}()}),n.define("/package.json",function(e,t,r,n){e.exports={name:"escodegen",description:"ECMAScript code generator",homepage:"http://github.com/estools/escodegen",main:"escodegen.js",bin:{esgenerate:"./bin/esgenerate.js",escodegen:"./bin/escodegen.js"},files:["LICENSE.BSD","LICENSE.source-map","README.md","bin","escodegen.js","package.json"],version:"1.8.1",engines:{node:">=0.12.0"},maintainers:[{name:"Yusuke Suzuki",email:"utatane.tea@gmail.com",web:"http://github.com/Constellation"}],repository:{type:"git",url:"http://github.com/estools/escodegen.git"},dependencies:{estraverse:"^1.9.1",esutils:"^2.0.2",esprima:"^2.7.1",optionator:"^0.8.1"},optionalDependencies:{"source-map":"~0.2.0"},devDependencies:{acorn:"^2.7.0",bluebird:"^2.3.11","bower-registry-client":"^0.2.1",chai:"^1.10.0","commonjs-everywhere":"^0.9.7",gulp:"^3.8.10","gulp-eslint":"^0.2.0","gulp-mocha":"^2.0.0",semver:"^5.1.0"},license:"BSD-2-Clause",scripts:{test:"gulp travis","unit-test":"gulp test",lint:"gulp lint",release:"node tools/release.js","build-min":"./node_modules/.bin/cjsify -ma path: tools/entry-point.js > escodegen.browser.min.js",build:"./node_modules/.bin/cjsify -a path: tools/entry-point.js > escodegen.browser.js"}}}),n.define("/node_modules/source-map/lib/source-map.js",function(e,t,r,i){t.SourceMapGenerator=n("/node_modules/source-map/lib/source-map/source-map-generator.js",e).SourceMapGenerator,t.SourceMapConsumer=n("/node_modules/source-map/lib/source-map/source-map-consumer.js",e).SourceMapConsumer,t.SourceNode=n("/node_modules/source-map/lib/source-map/source-node.js",e).SourceNode}),n.define("/node_modules/source-map/lib/source-map/source-node.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e,t,r,n,i){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==r?null:r,this.name=null==i?null:i,this[s]=!0,null!=n&&this.add(n)}var i=e("/node_modules/source-map/lib/source-map/source-map-generator.js",r).SourceMapGenerator,o=e("/node_modules/source-map/lib/source-map/util.js",r),a=/(\r?\n)/,s="$$$isSourceNode$$$";n.fromStringWithSourceMap=function(e,t,r){function i(e,t){if(null===e||void 0===e.source)s.add(t);else{var i=r?o.join(r,e.source):e.source;s.add(new n(e.originalLine,e.originalColumn,i,t,e.name))}}var s=new n,u=e.split(a),c=function(){return u.shift()+(u.shift()||"")},l=1,f=0,p=null;return t.eachMapping(function(e){if(null!==p){if(!(l<e.generatedLine)){t=(r=u[0]).substr(0,e.generatedColumn-f);return u[0]=r.substr(e.generatedColumn-f),f=e.generatedColumn,i(p,t),void(p=e)}var t="";i(p,c()),l++,f=0}for(;l<e.generatedLine;)s.add(c()),l++;if(f<e.generatedColumn){var r=u[0];s.add(r.substr(0,e.generatedColumn)),u[0]=r.substr(e.generatedColumn),f=e.generatedColumn}p=e},this),u.length>0&&(p&&i(p,c()),s.add(u.join(""))),t.sources.forEach(function(e){var n=t.sourceContentFor(e);null!=n&&(null!=r&&(e=o.join(r,e)),s.setSourceContent(e,n))}),s},n.prototype.add=function(e){if(Array.isArray(e))e.forEach(function(e){this.add(e)},this);else{if(!e[s]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this},n.prototype.prepend=function(e){if(Array.isArray(e))for(var t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[s]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this},n.prototype.walk=function(e){for(var t,r=0,n=this.children.length;r<n;r++)(t=this.children[r])[s]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})},n.prototype.join=function(e){var t,r,n=this.children.length;if(n>0){for(t=[],r=0;r<n-1;r++)t.push(this.children[r]),t.push(e);t.push(this.children[r]),this.children=t}return this},n.prototype.replaceRight=function(e,t){var r=this.children[this.children.length-1];return r[s]?r.replaceRight(e,t):"string"==typeof r?this.children[this.children.length-1]=r.replace(e,t):this.children.push("".replace(e,t)),this},n.prototype.setSourceContent=function(e,t){this.sourceContents[o.toSetString(e)]=t},n.prototype.walkSourceContents=function(e){for(var t=0,r=this.children.length;t<r;t++)this.children[t][s]&&this.children[t].walkSourceContents(e);for(var n=Object.keys(this.sourceContents),t=0,r=n.length;t<r;t++)e(o.fromSetString(n[t]),this.sourceContents[n[t]])},n.prototype.toString=function(){var e="";return this.walk(function(t){e+=t}),e},n.prototype.toStringWithSourceMap=function(e){var t={code:"",line:1,column:0},r=new i(e),n=!1,o=null,a=null,s=null,u=null;return this.walk(function(e,i){t.code+=e,null!==i.source&&null!==i.line&&null!==i.column?(o===i.source&&a===i.line&&s===i.column&&u===i.name||r.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:t.line,column:t.column},name:i.name}),o=i.source,a=i.line,s=i.column,u=i.name,n=!0):n&&(r.addMapping({generated:{line:t.line,column:t.column}}),o=null,n=!1);for(var c=0,l=e.length;c<l;c++)10===e.charCodeAt(c)?(t.line++,t.column=0,c+1===l?(o=null,n=!1):n&&r.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:t.line,column:t.column},name:i.name})):t.column++}),this.walkSourceContents(function(e,t){r.setSourceContent(e,t)}),{code:t.code,map:r}},t.SourceNode=n})}),n.define("/node_modules/source-map/lib/source-map/util.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e){var t=e.match(s);return t?{scheme:t[1],auth:t[2],host:t[3],port:t[4],path:t[5]}:null}function i(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function o(e){var t=e,r=n(e);if(r){if(!r.path)return e;t=r.path}for(var o,a="/"===t.charAt(0),s=t.split(/\/+/),u=0,c=s.length-1;c>=0;c--)"."===(o=s[c])?s.splice(c,1):".."===o?u++:u>0&&(""===o?(s.splice(c+1,u),u=0):(s.splice(c,2),u--));return""===(t=s.join("/"))&&(t=a?"/":"."),r?(r.path=t,i(r)):t}function a(e,t){var r=e||"",n=t||"";return(r>n)-(r<n)}t.getArg=function(e,t,r){if(t in e)return e[t];if(3===arguments.length)return r;throw new Error('"'+t+'" is a required argument.')};var s=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/,u=/^data:.+\,.+$/;t.urlParse=n,t.urlGenerate=i,t.normalize=o,t.join=function(e,t){""===e&&(e="."),""===t&&(t=".");var r=n(t),a=n(e);if(a&&(e=a.path||"/"),r&&!r.scheme)return a&&(r.scheme=a.scheme),i(r);if(r||t.match(u))return t;if(a&&!a.host&&!a.path)return a.host=t,i(a);var s="/"===t.charAt(0)?t:o(e.replace(/\/+$/,"")+"/"+t);return a?(a.path=s,i(a)):s},t.relative=function(e,t){""===e&&(e=".");var r=n(e=e.replace(/\/$/,""));return"/"==t.charAt(0)&&r&&"/"==r.path?t.slice(1):0===t.indexOf(e+"/")?t.substr(e.length+1):t},t.toSetString=function(e){return"$"+e},t.fromSetString=function(e){return e.substr(1)},t.compareByOriginalPositions=function(e,t,r){var n;return(n=a(e.source,t.source))?n:(n=e.originalLine-t.originalLine)?n:(n=e.originalColumn-t.originalColumn)||r?n:(n=a(e.name,t.name))?n:(n=e.generatedLine-t.generatedLine)||e.generatedColumn-t.generatedColumn},t.compareByGeneratedPositions=function(e,t,r){var n;return(n=e.generatedLine-t.generatedLine)?n:(n=e.generatedColumn-t.generatedColumn)||r?n:(n=a(e.source,t.source))?n:(n=e.originalLine-t.originalLine)?n:(n=e.originalColumn-t.originalColumn)||a(e.name,t.name)}})}),n.define("/node_modules/amdefine/amdefine.js",function(e,t,r,o){"use strict";e.exports=function(e,t){function r(e){var t,r;for(t=0;e[t];t+=1)if("."===(r=e[t]))e.splice(t,1),t-=1;else if(".."===r){if(1===t&&(".."===e[2]||".."===e[0]))break;t>0&&(e.splice(t-1,2),t-=2)}}function a(e,t){var n;return e&&"."===e.charAt(0)&&t&&(r(n=(n=(n=t.split("/")).slice(0,n.length-1)).concat(e.split("/"))),e=n.join("/")),e}function s(e){return function(t){return a(t,e)}}function u(e){function t(t){h[e]=t}return t.fromText=function(e,t){throw new Error("amdefine does not implement load.fromText")},t}function c(r,n,i){var a,s,u,c;if(r)s=h[r]={},a=f(t,s,u={id:r,uri:o,exports:s},r);else{if(m)throw new Error("amdefine with no module ID cannot be called more than once per file.");m=!0,s=e.exports,a=f(t,s,u=e,e.id)}n&&(n=n.map(function(e){return a(e)})),void 0!==(c="function"==typeof i?i.apply(u.exports,n):i)&&(u.exports=c,r&&(h[r]=u.exports))}function l(e,t,r){Array.isArray(e)?(r=t,t=e,e=void 0):"string"!=typeof e&&(r=e,e=t=void 0),t&&!Array.isArray(t)&&(r=t,t=void 0),t||(t=["require","exports","module"]),e?d[e]=[e,t,r]:c(e,t,r)}var f,p,d={},h={},m=!1,v=n("path",e);return f=function(e,t,r,n){function o(o,a){if("string"==typeof o)return p(e,t,r,o,n);o=o.map(function(i){return p(e,t,r,i,n)}),a&&i.nextTick(function(){a.apply(null,o)})}return o.toUrl=function(e){return 0===e.indexOf(".")?a(e,v.dirname(r.filename)):e},o},t=t||function(){return e.require.apply(e,arguments)},p=function(e,t,r,n,i){var o,l,m=n.indexOf("!"),v=n;if(-1===m){if("require"===(n=a(n,i)))return f(e,t,r,i);if("exports"===n)return t;if("module"===n)return r;if(h.hasOwnProperty(n))return h[n];if(d[n])return c.apply(null,d[n]),h[n];if(e)return e(v);throw new Error("No module with ID: "+n)}return o=n.substring(0,m),n=n.substring(m+1,n.length),l=p(e,t,r,o,i),n=l.normalize?l.normalize(n,s(i)):a(n,i),h[n]?h[n]:(l.load(n,f(e,t,r,i),u(n),{}),h[n])},l.require=function(e){return h[e]?h[e]:d[e]?(c.apply(null,d[e]),h[e]):void 0},l.amd={},l}}),n.define("/node_modules/source-map/lib/source-map/source-map-generator.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e){e||(e={}),this._file=o.getArg(e,"file",null),this._sourceRoot=o.getArg(e,"sourceRoot",null),this._skipValidation=o.getArg(e,"skipValidation",!1),this._sources=new a,this._names=new a,this._mappings=new s,this._sourcesContents=null}var i=e("/node_modules/source-map/lib/source-map/base64-vlq.js",r),o=e("/node_modules/source-map/lib/source-map/util.js",r),a=e("/node_modules/source-map/lib/source-map/array-set.js",r).ArraySet,s=e("/node_modules/source-map/lib/source-map/mapping-list.js",r).MappingList;n.prototype._version=3,n.fromSourceMap=function(e){var t=e.sourceRoot,r=new n({file:e.file,sourceRoot:t});return e.eachMapping(function(e){var n={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(n.source=e.source,null!=t&&(n.source=o.relative(t,n.source)),n.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(n.name=e.name)),r.addMapping(n)}),e.sources.forEach(function(t){var n=e.sourceContentFor(t);null!=n&&r.setSourceContent(t,n)}),r},n.prototype.addMapping=function(e){var t=o.getArg(e,"generated"),r=o.getArg(e,"original",null),n=o.getArg(e,"source",null),i=o.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,r,n,i),null==n||this._sources.has(n)||this._sources.add(n),null==i||this._names.has(i)||this._names.add(i),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:null!=r&&r.line,originalColumn:null!=r&&r.column,source:n,name:i})},n.prototype.setSourceContent=function(e,t){var r=e;null!=this._sourceRoot&&(r=o.relative(this._sourceRoot,r)),null!=t?(this._sourcesContents||(this._sourcesContents={}),this._sourcesContents[o.toSetString(r)]=t):this._sourcesContents&&(delete this._sourcesContents[o.toSetString(r)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},n.prototype.applySourceMap=function(e,t,r){var n=t;if(null==t){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');n=e.file}var i=this._sourceRoot;null!=i&&(n=o.relative(i,n));var s=new a,u=new a;this._mappings.unsortedForEach(function(t){if(t.source===n&&null!=t.originalLine){var a=e.originalPositionFor({line:t.originalLine,column:t.originalColumn});null!=a.source&&(t.source=a.source,null!=r&&(t.source=o.join(r,t.source)),null!=i&&(t.source=o.relative(i,t.source)),t.originalLine=a.line,t.originalColumn=a.column,null!=a.name&&(t.name=a.name))}var c=t.source;null==c||s.has(c)||s.add(c);var l=t.name;null==l||u.has(l)||u.add(l)},this),this._sources=s,this._names=u,e.sources.forEach(function(t){var n=e.sourceContentFor(t);null!=n&&(null!=r&&(t=o.join(r,t)),null!=i&&(t=o.relative(i,t)),this.setSourceContent(t,n))},this)},n.prototype._validateMapping=function(e,t,r,n){if((!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0)||t||r||n)&&!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:t,name:n}))},n.prototype._serializeMappings=function(){for(var e,t=0,r=1,n=0,a=0,s=0,u=0,c="",l=this._mappings.toArray(),f=0,p=l.length;f<p;f++){if((e=l[f]).generatedLine!==r)for(t=0;e.generatedLine!==r;)c+=";",r++;else if(f>0){if(!o.compareByGeneratedPositions(e,l[f-1]))continue;c+=","}c+=i.encode(e.generatedColumn-t),t=e.generatedColumn,null!=e.source&&(c+=i.encode(this._sources.indexOf(e.source)-u),u=this._sources.indexOf(e.source),c+=i.encode(e.originalLine-1-a),a=e.originalLine-1,c+=i.encode(e.originalColumn-n),n=e.originalColumn,null!=e.name&&(c+=i.encode(this._names.indexOf(e.name)-s),s=this._names.indexOf(e.name)))}return c},n.prototype._generateSourcesContent=function(e,t){return e.map(function(e){if(!this._sourcesContents)return null;null!=t&&(e=o.relative(t,e));var r=o.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,r)?this._sourcesContents[r]:null},this)},n.prototype.toJSON=function(){var e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e},n.prototype.toString=function(){return JSON.stringify(this)},t.SourceMapGenerator=n})}),n.define("/node_modules/source-map/lib/source-map/mapping-list.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e,t){var r=e.generatedLine,n=t.generatedLine,i=e.generatedColumn,a=t.generatedColumn;return n>r||n==r&&a>=i||o.compareByGeneratedPositions(e,t)<=0}function i(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}var o=e("/node_modules/source-map/lib/source-map/util.js",r);i.prototype.unsortedForEach=function(e,t){this._array.forEach(e,t)},i.prototype.add=function(e){n(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))},i.prototype.toArray=function(){return this._sorted||(this._array.sort(o.compareByGeneratedPositions),this._sorted=!0),this._array},t.MappingList=i})}),n.define("/node_modules/source-map/lib/source-map/array-set.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(){this._array=[],this._set={}}var i=e("/node_modules/source-map/lib/source-map/util.js",r);n.fromArray=function(e,t){for(var r=new n,i=0,o=e.length;i<o;i++)r.add(e[i],t);return r},n.prototype.add=function(e,t){var r=this.has(e),n=this._array.length;r&&!t||this._array.push(e),r||(this._set[i.toSetString(e)]=n)},n.prototype.has=function(e){return Object.prototype.hasOwnProperty.call(this._set,i.toSetString(e))},n.prototype.indexOf=function(e){if(this.has(e))return this._set[i.toSetString(e)];throw new Error('"'+e+'" is not in the set.')},n.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},n.prototype.toArray=function(){return this._array.slice()},t.ArraySet=n})}),n.define("/node_modules/source-map/lib/source-map/base64-vlq.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e){return e<0?1+(-e<<1):0+(e<<1)}function i(e){var t=e>>1;return 1==(1&e)?-t:t}var o=e("/node_modules/source-map/lib/source-map/base64.js",r);t.encode=function(e){var t,r="",i=n(e);do{t=31&i,(i>>>=5)>0&&(t|=32),r+=o.encode(t)}while(i>0);return r},t.decode=function(e,t){var r,n,a=0,s=e.length,u=0,c=0;do{if(a>=s)throw new Error("Expected more digits in base 64 VLQ value.");r=!!(32&(n=o.decode(e.charAt(a++)))),u+=(n&=31)<<c,c+=5}while(r);t.value=i(u),t.rest=e.slice(a)}})}),n.define("/node_modules/source-map/lib/source-map/base64.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){var n={},i={};"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("").forEach(function(e,t){n[e]=t,i[t]=e}),t.encode=function(e){if(e in i)return i[e];throw new TypeError("Must be between 0 and 63: "+e)},t.decode=function(e){if(e in n)return n[e];throw new TypeError("Not a valid base 64 digit: "+e)}})}),n.define("/node_modules/source-map/lib/source-map/source-map-consumer.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(t){var n=t;return"string"==typeof t&&(n=JSON.parse(t.replace(/^\)\]\}'/,""))),null!=n.sections?new(e("/node_modules/source-map/lib/source-map/indexed-source-map-consumer.js",r).IndexedSourceMapConsumer)(n):new(e("/node_modules/source-map/lib/source-map/basic-source-map-consumer.js",r).BasicSourceMapConsumer)(n)}var i=e("/node_modules/source-map/lib/source-map/util.js",r);n.fromSourceMap=function(t){return e("/node_modules/source-map/lib/source-map/basic-source-map-consumer.js",r).BasicSourceMapConsumer.fromSourceMap(t)},n.prototype._version=3,n.prototype.__generatedMappings=null,Object.defineProperty(n.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||(this.__generatedMappings=[],this.__originalMappings=[],this._parseMappings(this._mappings,this.sourceRoot)),this.__generatedMappings}}),n.prototype.__originalMappings=null,Object.defineProperty(n.prototype,"_originalMappings",{get:function(){return this.__originalMappings||(this.__generatedMappings=[],this.__originalMappings=[],this._parseMappings(this._mappings,this.sourceRoot)),this.__originalMappings}}),n.prototype._nextCharIsMappingSeparator=function(e){var t=e.charAt(0);return";"===t||","===t},n.prototype._parseMappings=function(e,t){throw new Error("Subclasses must implement _parseMappings")},n.GENERATED_ORDER=1,n.ORIGINAL_ORDER=2,n.prototype.eachMapping=function(e,t,r){var o,a=t||null;switch(r||n.GENERATED_ORDER){case n.GENERATED_ORDER:o=this._generatedMappings;break;case n.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var s=this.sourceRoot;o.map(function(e){var t=e.source;return null!=t&&null!=s&&(t=i.join(s,t)),{source:t,generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:e.name}}).forEach(e,a)},n.prototype.allGeneratedPositionsFor=function(e){var t={source:i.getArg(e,"source"),originalLine:i.getArg(e,"line"),originalColumn:1/0};null!=this.sourceRoot&&(t.source=i.relative(this.sourceRoot,t.source));var r=[],n=this._findMapping(t,this._originalMappings,"originalLine","originalColumn",i.compareByOriginalPositions);if(n>=0)for(var o=this._originalMappings[n];o&&o.originalLine===t.originalLine;)r.push({line:i.getArg(o,"generatedLine",null),column:i.getArg(o,"generatedColumn",null),lastColumn:i.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[--n];return r.reverse()},t.SourceMapConsumer=n})}),n.define("/node_modules/source-map/lib/source-map/basic-source-map-consumer.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var r=i.getArg(t,"version"),n=i.getArg(t,"sources"),o=i.getArg(t,"names",[]),s=i.getArg(t,"sourceRoot",null),u=i.getArg(t,"sourcesContent",null),c=i.getArg(t,"mappings"),l=i.getArg(t,"file",null);if(r!=this._version)throw new Error("Unsupported version: "+r);n=n.map(i.normalize),this._names=a.fromArray(o,!0),this._sources=a.fromArray(n,!0),this.sourceRoot=s,this.sourcesContent=u,this._mappings=c,this.file=l}var i=e("/node_modules/source-map/lib/source-map/util.js",r),o=e("/node_modules/source-map/lib/source-map/binary-search.js",r),a=e("/node_modules/source-map/lib/source-map/array-set.js",r).ArraySet,s=e("/node_modules/source-map/lib/source-map/base64-vlq.js",r),u=e("/node_modules/source-map/lib/source-map/source-map-consumer.js",r).SourceMapConsumer;(n.prototype=Object.create(u.prototype)).consumer=u,n.fromSourceMap=function(e){var t=Object.create(n.prototype);return t._names=a.fromArray(e._names.toArray(),!0),t._sources=a.fromArray(e._sources.toArray(),!0),t.sourceRoot=e._sourceRoot,t.sourcesContent=e._generateSourcesContent(t._sources.toArray(),t.sourceRoot),t.file=e._file,t.__generatedMappings=e._mappings.toArray().slice(),t.__originalMappings=e._mappings.toArray().slice().sort(i.compareByOriginalPositions),t},n.prototype._version=3,Object.defineProperty(n.prototype,"sources",{get:function(){return this._sources.toArray().map(function(e){return null!=this.sourceRoot?i.join(this.sourceRoot,e):e},this)}}),n.prototype._parseMappings=function(e,t){for(var r,n=1,o=0,a=0,u=0,c=0,l=0,f=e,p={};f.length>0;)if(";"===f.charAt(0))n++,f=f.slice(1),o=0;else if(","===f.charAt(0))f=f.slice(1);else{if(r={},r.generatedLine=n,s.decode(f,p),r.generatedColumn=o+p.value,o=r.generatedColumn,(f=p.rest).length>0&&!this._nextCharIsMappingSeparator(f)){if(s.decode(f,p),r.source=this._sources.at(c+p.value),c+=p.value,0===(f=p.rest).length||this._nextCharIsMappingSeparator(f))throw new Error("Found a source, but no line and column");if(s.decode(f,p),r.originalLine=a+p.value,a=r.originalLine,r.originalLine+=1,0===(f=p.rest).length||this._nextCharIsMappingSeparator(f))throw new Error("Found a source and line, but no column");s.decode(f,p),r.originalColumn=u+p.value,u=r.originalColumn,(f=p.rest).length>0&&!this._nextCharIsMappingSeparator(f)&&(s.decode(f,p),r.name=this._names.at(l+p.value),l+=p.value,f=p.rest)}this.__generatedMappings.push(r),"number"==typeof r.originalLine&&this.__originalMappings.push(r)}this.__generatedMappings.sort(i.compareByGeneratedPositions),this.__originalMappings.sort(i.compareByOriginalPositions)},n.prototype._findMapping=function(e,t,r,n,i){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[n]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[n]);return o.search(e,t,i)},n.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var r=this._generatedMappings[e+1];if(t.generatedLine===r.generatedLine){t.lastGeneratedColumn=r.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},n.prototype.originalPositionFor=function(e){var t={generatedLine:i.getArg(e,"line"),generatedColumn:i.getArg(e,"column")},r=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",i.compareByGeneratedPositions);if(r>=0){var n=this._generatedMappings[r];if(n.generatedLine===t.generatedLine){var o=i.getArg(n,"source",null);return null!=o&&null!=this.sourceRoot&&(o=i.join(this.sourceRoot,o)),{source:o,line:i.getArg(n,"originalLine",null),column:i.getArg(n,"originalColumn",null),name:i.getArg(n,"name",null)}}}return{source:null,line:null,column:null,name:null}},n.prototype.sourceContentFor=function(e,t){if(!this.sourcesContent)return null;if(null!=this.sourceRoot&&(e=i.relative(this.sourceRoot,e)),this._sources.has(e))return this.sourcesContent[this._sources.indexOf(e)];var r;if(null!=this.sourceRoot&&(r=i.urlParse(this.sourceRoot))){var n=e.replace(/^file:\/\//,"");if("file"==r.scheme&&this._sources.has(n))return this.sourcesContent[this._sources.indexOf(n)];if((!r.path||"/"==r.path)&&this._sources.has("/"+e))return this.sourcesContent[this._sources.indexOf("/"+e)]}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},n.prototype.generatedPositionFor=function(e){var t={source:i.getArg(e,"source"),originalLine:i.getArg(e,"line"),originalColumn:i.getArg(e,"column")};null!=this.sourceRoot&&(t.source=i.relative(this.sourceRoot,t.source));var r=this._findMapping(t,this._originalMappings,"originalLine","originalColumn",i.compareByOriginalPositions);if(r>=0){var n=this._originalMappings[r];return{line:i.getArg(n,"generatedLine",null),column:i.getArg(n,"generatedColumn",null),lastColumn:i.getArg(n,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},t.BasicSourceMapConsumer=n})}),n.define("/node_modules/source-map/lib/source-map/binary-search.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e,t,r,i,o){var a=Math.floor((t-e)/2)+e,s=o(r,i[a],!0);return 0===s?a:s>0?t-a>1?n(a,t,r,i,o):a:a-e>1?n(e,a,r,i,o):e<0?-1:e}t.search=function(e,t,r){return 0===t.length?-1:n(-1,t.length,e,t,r)}})}),n.define("/node_modules/source-map/lib/source-map/indexed-source-map-consumer.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var r=i.getArg(t,"version"),n=i.getArg(t,"sections");if(r!=this._version)throw new Error("Unsupported version: "+r);var o={line:-1,column:0};this._sections=n.map(function(e){if(e.url)throw new Error("Support for url field in sections not implemented.");var t=i.getArg(e,"offset"),r=i.getArg(t,"line"),n=i.getArg(t,"column");if(r<o.line||r===o.line&&n<o.column)throw new Error("Section offsets must be ordered and non-overlapping.");return o=t,{generatedOffset:{generatedLine:r+1,generatedColumn:n+1},consumer:new a(i.getArg(e,"map"))}})}var i=e("/node_modules/source-map/lib/source-map/util.js",r),o=e("/node_modules/source-map/lib/source-map/binary-search.js",r),a=e("/node_modules/source-map/lib/source-map/source-map-consumer.js",r).SourceMapConsumer;e("/node_modules/source-map/lib/source-map/basic-source-map-consumer.js",r).BasicSourceMapConsumer;(n.prototype=Object.create(a.prototype)).constructor=a,n.prototype._version=3,Object.defineProperty(n.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var r=0;r<this._sections[t].consumer.sources.length;r++)e.push(this._sections[t].consumer.sources[r]);return e}}),n.prototype.originalPositionFor=function(e){var t={generatedLine:i.getArg(e,"line"),generatedColumn:i.getArg(e,"column")},r=o.search(t,this._sections,function(e,t){var r=e.generatedLine-t.generatedOffset.generatedLine;return r||e.generatedColumn-t.generatedOffset.generatedColumn}),n=this._sections[r];return n?n.consumer.originalPositionFor({line:t.generatedLine-(n.generatedOffset.generatedLine-1),column:t.generatedColumn-(n.generatedOffset.generatedLine===t.generatedLine?n.generatedOffset.generatedColumn-1:0)}):{source:null,line:null,column:null,name:null}},n.prototype.sourceContentFor=function(e,t){for(var r=0;r<this._sections.length;r++){var n=this._sections[r].consumer.sourceContentFor(e,!0);if(n)return n}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},n.prototype.generatedPositionFor=function(e){for(var t=0;t<this._sections.length;t++){var r=this._sections[t];if(-1!==r.consumer.sources.indexOf(i.getArg(e,"source"))){var n=r.consumer.generatedPositionFor(e);if(n)return{line:n.line+(r.generatedOffset.generatedLine-1),column:n.column+(r.generatedOffset.generatedLine===n.line?r.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},n.prototype._parseMappings=function(e,t){this.__generatedMappings=[],this.__originalMappings=[];for(var r=0;r<this._sections.length;r++)for(var n=this._sections[r],o=n.consumer._generatedMappings,a=0;a<o.length;a++){var s=o[r],u=s.source,c=n.consumer.sourceRoot;null!=u&&null!=c&&(u=i.join(c,u));var l={source:u,generatedLine:s.generatedLine+(n.generatedOffset.generatedLine-1),generatedColumn:s.column+(n.generatedOffset.generatedLine===s.generatedLine)?n.generatedOffset.generatedColumn-1:0,originalLine:s.originalLine,originalColumn:s.originalColumn,name:s.name};this.__generatedMappings.push(l),"number"==typeof l.originalLine&&this.__originalMappings.push(l)}this.__generatedMappings.sort(i.compareByGeneratedPositions),this.__originalMappings.sort(i.compareByOriginalPositions)},t.IndexedSourceMapConsumer=n})}),n.define("/node_modules/esutils/lib/utils.js",function(e,t,r,i){!function(){"use strict";t.ast=n("/node_modules/esutils/lib/ast.js",e),t.code=n("/node_modules/esutils/lib/code.js",e),t.keyword=n("/node_modules/esutils/lib/keyword.js",e)}()}),n.define("/node_modules/esutils/lib/keyword.js",function(e,t,r,i){!function(){"use strict";function t(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"let":return!0;default:return!1}}function r(e,t){return!(!t&&"yield"===e)&&i(e,t)}function i(e,r){if(r&&t(e))return!0;switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}}function o(e,t){return"null"===e||"true"===e||"false"===e||r(e,t)}function a(e,t){return"null"===e||"true"===e||"false"===e||i(e,t)}function s(e){var t,r,n;if(0===e.length)return!1;if(n=e.charCodeAt(0),!l.isIdentifierStartES5(n))return!1;for(t=1,r=e.length;t<r;++t)if(n=e.charCodeAt(t),!l.isIdentifierPartES5(n))return!1;return!0}function u(e,t){return 1024*(e-55296)+(t-56320)+65536}function c(e){var t,r,n,i,o;if(0===e.length)return!1;for(o=l.isIdentifierStartES6,t=0,r=e.length;t<r;++t){if(55296<=(n=e.charCodeAt(t))&&n<=56319){if(++t>=r)return!1;if(!(56320<=(i=e.charCodeAt(t))&&i<=57343))return!1;n=u(n,i)}if(!o(n))return!1;o=l.isIdentifierPartES6}return!0}var l=n("/node_modules/esutils/lib/code.js",e);e.exports={isKeywordES5:r,isKeywordES6:i,isReservedWordES5:o,isReservedWordES6:a,isRestrictedWord:function(e){return"eval"===e||"arguments"===e},isIdentifierNameES5:s,isIdentifierNameES6:c,isIdentifierES5:function(e,t){return s(e)&&!o(e,t)},isIdentifierES6:function(e,t){return c(e)&&!a(e,t)}}}()}),n.define("/node_modules/esutils/lib/code.js",function(e,t,r,n){!function(){"use strict";function t(e){return e<=65535?String.fromCharCode(e):String.fromCharCode(Math.floor((e-65536)/1024)+55296)+String.fromCharCode((e-65536)%1024+56320)}var r,n,i,o,a,s;for(n={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,NonAsciiIdentifierPart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/},r={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDE00-\uDE11\uDE13-\uDE2B\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDE00-\uDE2F\uDE44\uDE80-\uDEAA]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDD0-\uDDDA\uDE00-\uDE11\uDE13-\uDE37\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF01-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/},i=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279],o=new Array(128),s=0;s<128;++s)o[s]=s>=97&&s<=122||s>=65&&s<=90||36===s||95===s;for(a=new Array(128),s=0;s<128;++s)a[s]=s>=97&&s<=122||s>=65&&s<=90||s>=48&&s<=57||36===s||95===s;e.exports={isDecimalDigit:function(e){return 48<=e&&e<=57},isHexDigit:function(e){return 48<=e&&e<=57||97<=e&&e<=102||65<=e&&e<=70},isOctalDigit:function(e){return e>=48&&e<=55},isWhiteSpace:function(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&i.indexOf(e)>=0},isLineTerminator:function(e){return 10===e||13===e||8232===e||8233===e},isIdentifierStartES5:function(e){return e<128?o[e]:n.NonAsciiIdentifierStart.test(t(e))},isIdentifierPartES5:function(e){return e<128?a[e]:n.NonAsciiIdentifierPart.test(t(e))},isIdentifierStartES6:function(e){return e<128?o[e]:r.NonAsciiIdentifierStart.test(t(e))},isIdentifierPartES6:function(e){return e<128?a[e]:r.NonAsciiIdentifierPart.test(t(e))}}}()}),n.define("/node_modules/esutils/lib/ast.js",function(e,t,r,n){!function(){"use strict";function t(e){if(null==e)return!1;switch(e.type){case"BlockStatement":case"BreakStatement":case"ContinueStatement":case"DebuggerStatement":case"DoWhileStatement":case"EmptyStatement":case"ExpressionStatement":case"ForInStatement":case"ForStatement":case"IfStatement":case"LabeledStatement":case"ReturnStatement":case"SwitchStatement":case"ThrowStatement":case"TryStatement":case"VariableDeclaration":case"WhileStatement":case"WithStatement":return!0}return!1}function r(e){switch(e.type){case"IfStatement":return null!=e.alternate?e.alternate:e.consequent;case"LabeledStatement":case"ForStatement":case"ForInStatement":case"WhileStatement":case"WithStatement":return e.body}return null}e.exports={isExpression:function(e){if(null==e)return!1;switch(e.type){case"ArrayExpression":case"AssignmentExpression":case"BinaryExpression":case"CallExpression":case"ConditionalExpression":case"FunctionExpression":case"Identifier":case"Literal":case"LogicalExpression":case"MemberExpression":case"NewExpression":case"ObjectExpression":case"SequenceExpression":case"ThisExpression":case"UnaryExpression":case"UpdateExpression":return!0}return!1},isStatement:t,isIterationStatement:function(e){if(null==e)return!1;switch(e.type){case"DoWhileStatement":case"ForInStatement":case"ForStatement":case"WhileStatement":return!0}return!1},isSourceElement:function(e){return t(e)||null!=e&&"FunctionDeclaration"===e.type},isProblematicIfStatement:function(e){var t;if("IfStatement"!==e.type)return!1;if(null==e.alternate)return!1;t=e.consequent;do{if("IfStatement"===t.type&&null==t.alternate)return!0;t=r(t)}while(t);return!1},trailingStatement:r}}()}),n.define("/node_modules/estraverse/estraverse.js",function(t,r,n,i){!function(t,n){"use strict";"function"==typeof e&&e.amd?e(["exports"],n):n(void 0!==r?r:t.estraverse={})}(this,function e(t){"use strict";function r(){}function n(e){var t,r,i={};for(t in e)e.hasOwnProperty(t)&&(r=e[t],i[t]="object"==typeof r&&null!==r?n(r):r);return i}function i(e,t){var r,n,i,o;for(n=e.length,i=0;n;)t(e[o=i+(r=n>>>1)])?n=r:(i=o+1,n-=r+1);return i}function o(e,t){var r,n,i,o=g(t);for(n=0,i=o.length;n<i;n+=1)e[r=o[n]]=t[r];return e}function a(e,t){this.parent=e,this.key=t}function s(e,t,r,n){this.node=e,this.path=t,this.wrap=r,this.ref=n}function u(){}function c(e){return null!=e&&("object"==typeof e&&"string"==typeof e.type)}function l(e,t){return(e===d.ObjectExpression||e===d.ObjectPattern)&&"properties"===t}function f(e,t){return(new u).traverse(e,t)}function p(e,t){var r;return r=i(t,function(t){return t.range[0]>e.range[0]}),e.extendedRange=[e.range[0],e.range[1]],r!==t.length&&(e.extendedRange[1]=t[r].range[0]),(r-=1)>=0&&(e.extendedRange[0]=t[r].range[1]),e}var d,h,m,v,y,g,b,_,w;return(h=Array.isArray)||(h=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),r(),r(),y=Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}(),g=Object.keys||function(e){var t,r=[];for(t in e)r.push(t);return r},d={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportBatchSpecifier:"ExportBatchSpecifier",ExportDeclaration:"ExportDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",GeneratorExpression:"GeneratorExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MethodDefinition:"MethodDefinition",ModuleSpecifier:"ModuleSpecifier",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"},v={AssignmentExpression:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","defaults","rest","body"],AwaitExpression:["argument"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ClassBody:["body"],ClassDeclaration:["id","body","superClass"],ClassExpression:["id","body","superClass"],ComprehensionBlock:["left","right"],ComprehensionExpression:["blocks","filter","body"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExportBatchSpecifier:[],ExportDeclaration:["declaration","specifiers","source"],ExportSpecifier:["id","name"],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","defaults","rest","body"],FunctionExpression:["id","params","defaults","rest","body"],GeneratorExpression:["blocks","filter","body"],Identifier:[],IfStatement:["test","consequent","alternate"],ImportDeclaration:["specifiers","source"],ImportDefaultSpecifier:["id"],ImportNamespaceSpecifier:["id"],ImportSpecifier:["id","name"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MethodDefinition:["key","value"],ModuleSpecifier:[],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],Program:["body"],Property:["key","value"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SpreadElement:["argument"],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],TaggedTemplateExpression:["tag","quasi"],TemplateElement:[],TemplateLiteral:["quasis","expressions"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handlers","handler","guardedHandlers","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]},b={},_={},w={},m={Break:b,Skip:_,Remove:w},a.prototype.replace=function(e){this.parent[this.key]=e},a.prototype.remove=function(){return h(this.parent)?(this.parent.splice(this.key,1),!0):(this.replace(null),!1)},u.prototype.path=function(){function e(e,t){if(h(t))for(n=0,i=t.length;n<i;++n)e.push(t[n]);else e.push(t)}var t,r,n,i,o;if(!this.__current.path)return null;for(o=[],t=2,r=this.__leavelist.length;t<r;++t)e(o,this.__leavelist[t].path);return e(o,this.__current.path),o},u.prototype.type=function(){return this.current().type||this.__current.wrap},u.prototype.parents=function(){var e,t,r;for(r=[],e=1,t=this.__leavelist.length;e<t;++e)r.push(this.__leavelist[e].node);return r},u.prototype.current=function(){return this.__current.node},u.prototype.__execute=function(e,t){var r,n;return n=void 0,r=this.__current,this.__current=t,this.__state=null,e&&(n=e.call(this,t.node,this.__leavelist[this.__leavelist.length-1].node)),this.__current=r,n},u.prototype.notify=function(e){this.__state=e},u.prototype.skip=function(){this.notify(_)},u.prototype.break=function(){this.notify(b)},u.prototype.remove=function(){this.notify(w)},u.prototype.__initialize=function(e,t){this.visitor=t,this.root=e,this.__worklist=[],this.__leavelist=[],this.__current=null,this.__state=null,this.__fallback="iteration"===t.fallback,this.__keys=v,t.keys&&(this.__keys=o(y(this.__keys),t.keys))},u.prototype.traverse=function(e,t){var r,n,i,o,a,u,f,p,d,m,v,y;for(this.__initialize(e,t),y={},r=this.__worklist,n=this.__leavelist,r.push(new s(e,null,null,null)),n.push(new s(null,null,null,null));r.length;)if((i=r.pop())!==y){if(i.node){if(u=this.__execute(t.enter,i),this.__state===b||u===b)return;if(r.push(y),n.push(i),this.__state===_||u===_)continue;if(o=i.node,a=i.wrap||o.type,!(m=this.__keys[a])){if(!this.__fallback)throw new Error("Unknown node type "+a+".");m=g(o)}for(p=m.length;(p-=1)>=0;)if(f=m[p],v=o[f])if(h(v)){for(d=v.length;(d-=1)>=0;)if(v[d]){if(l(a,m[p]))i=new s(v[d],[f,d],"Property",null);else{if(!c(v[d]))continue;i=new s(v[d],[f,d],null,null)}r.push(i)}}else c(v)&&r.push(new s(v,f,null,null))}}else if(i=n.pop(),u=this.__execute(t.leave,i),this.__state===b||u===b)return},u.prototype.replace=function(e,t){function r(e){var t,r,i,o;if(e.ref.remove())for(r=e.ref.key,o=e.ref.parent,t=n.length;t--;)if((i=n[t]).ref&&i.ref.parent===o){if(i.ref.key<r)break;--i.ref.key}}var n,i,o,u,f,p,d,m,v,y,x,k,E;for(this.__initialize(e,t),x={},n=this.__worklist,i=this.__leavelist,p=new s(e,null,null,new a(k={root:e},"root")),n.push(p),i.push(p);n.length;)if((p=n.pop())!==x){if(void 0!==(f=this.__execute(t.enter,p))&&f!==b&&f!==_&&f!==w&&(p.ref.replace(f),p.node=f),this.__state!==w&&f!==w||(r(p),p.node=null),this.__state===b||f===b)return k.root;if((o=p.node)&&(n.push(x),i.push(p),this.__state!==_&&f!==_)){if(u=p.wrap||o.type,!(v=this.__keys[u])){if(!this.__fallback)throw new Error("Unknown node type "+u+".");v=g(o)}for(d=v.length;(d-=1)>=0;)if(E=v[d],y=o[E])if(h(y)){for(m=y.length;(m-=1)>=0;)if(y[m]){if(l(u,v[d]))p=new s(y[m],[E,m],"Property",new a(y,m));else{if(!c(y[m]))continue;p=new s(y[m],[E,m],null,new a(y,m))}n.push(p)}}else c(y)&&n.push(new s(y,E,null,new a(o,E)))}}else if(p=i.pop(),void 0!==(f=this.__execute(t.leave,p))&&f!==b&&f!==_&&f!==w&&p.ref.replace(f),this.__state!==w&&f!==w||r(p),this.__state===b||f===b)return k.root;return k.root},t.version="1.8.1-dev",t.Syntax=d,t.traverse=f,t.replace=function(e,t){return(new u).replace(e,t)},t.attachComments=function(e,t,r){var i,o,a,s,u=[];if(!e.range)throw new Error("attachComments needs range information");if(!r.length){if(t.length){for(a=0,o=t.length;a<o;a+=1)(i=n(t[a])).extendedRange=[0,e.range[0]],u.push(i);e.leadingComments=u}return e}for(a=0,o=t.length;a<o;a+=1)u.push(p(n(t[a]),r));return s=0,f(e,{enter:function(e){for(var t;s<u.length&&!((t=u[s]).extendedRange[1]>e.range[0]);)t.extendedRange[1]===e.range[0]?(e.leadingComments||(e.leadingComments=[]),e.leadingComments.push(t),u.splice(s,1)):s+=1;return s===u.length?m.Break:u[s].extendedRange[0]>e.range[1]?m.Skip:void 0}}),s=0,f(e,{leave:function(e){for(var t;s<u.length&&(t=u[s],!(e.range[1]<t.extendedRange[0]));)e.range[1]===t.extendedRange[0]?(e.trailingComments||(e.trailingComments=[]),e.trailingComments.push(t),u.splice(s,1)):s+=1;return s===u.length?m.Break:u[s].extendedRange[0]>e.range[1]?m.Skip:void 0}}),e},t.VisitorKeys=v,t.VisitorOption=m,t.Controller=u,t.cloneEnvironment=function(){return e({})},t})}),n("/tools/entry-point.js")}).call(t,t)}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this)}(),function(){this.lively=this.lively||{},function(e,t,r,n){"use strict";function i(){}function o(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={style:"  ",base:0,adjustMultilineComment:!1,optsIndent:r&&r.format&&r.format.indent||{}},i=r&&r.format||{},o=ue({indent:n,quotes:"double"},t.obj.dissoc(i,["indent"]));return r=ue({format:o,comment:!1},t.obj.dissoc(r,["format"])),ge.generate(e,r)}function a(e,r,n,i){var o=(i=i||{}).traversal||"preorder",a=t.obj.clone(i.visitors?i.visitors:be.make(be.visitors.withMemberExpression)),s="preorder"===o?function(e,t,i,o,a){return r(i,n,o,t),e(i,o+1,a)}:function(e,t,i,o,a){var s=e(i,o+1,a);return r(i,n,o,t),s};return Object.keys(a).forEach(function(e){var t=a[e];a[e]=function(r,n,i){return s(t,e,r,n,i)}}),be.recursive(e,0,null,a),e}function s(e,r,n,i){var o=[];return i=i||be.make(be.visitors.withMemberExpression),Object.keys(be.base).forEach(function(e){var r=i[e];i[e]=function(e,n,i){return t.arr.pushIfNotIncluded(o,e),r(e,n,i)}}),i.Property=function(e,r,n){t.arr.pushIfNotIncluded(o,e),n(e.key,r,"Expression"),n(e.value,r,"Expression")},i.LabeledStatement=function(e,t,r){e.label&&r(e.label,t,"Expression"),r(e.body,t,"Statement")},be.findNodeAround(e,r,n,i),o}function u(e){return De(e,{index:0},function(e,t,r){e(),t.astIndex=r.index++}),e}function c(e){if(Array.isArray(e.body))for(var t=e.body.length-1;t>=0;t--){var r=e.body[t];"BlockStatement"===r.type&&r[ke]&&e.body.splice.apply(e.body,[t,1].concat(r.body))}return e}function l(e,t){return"string"==typeof e&&(t=e,e=d(e)),t&&we.run(e,function(e,r,n){return!e.source&&(e.source=t.slice(e.start,e.end))}),e}function f(e,t){return t="string"==typeof t?this.parse(t):t,s(t,e)}function p(e,t){(t=t||{}).ecmaVersion=t.ecmaVersion||8,t.sourceType=t.sourceType||"module",t.plugins=t.plugins||{},t.plugins.asyncawait=t.plugins.hasOwnProperty("asyncawait")?t.plugins.asyncawait:{inAsyncFunction:!0},t.plugins.objectSpread=!t.plugins.hasOwnProperty("objectSpread")||t.plugins.objectSpread;var r,n,i;"LabeledStatement"===t.type&&(n="$={"+e+"}");try{r=d(n||e,t),n?r=null:t.addSource&&l(r,e)}catch(e){i=e}if(i&&void 0!==i.raisedAt){n&&(i.pos-=3,i.raisedAt-=3,i.loc.column-=3);var o="";o+=e.slice(i.raisedAt-20,i.raisedAt),o+="<-error->",o+=e.slice(i.raisedAt,i.raisedAt+20),t.verbose&&show("parse error: "+o),i.parseErrorSource=o}else i&&t.verbose&&show(""+i+i.stack);return r||(r=_e.parse_dammit(e,t),t.addSource&&l(r,e),r.isFuzzy=!0,r.parseError=i),r}function d(e,r){function n(e){return o.forEach(function(r){var n=t.arr.detect(f(r.start,a).reverse(),function(e){return"BlockStatement"===e.type||"Program"===e.type});n||(n=a),n.comments||(n.comments=[]),n.comments.push(r),e.nodesWithComments.push(n)}),e}function i(r){return r.nodesWithComments.forEach(function(n){t.arr.clone(n.comments).reduce(function(i,o){if(o.isBlock)return i.lastComment=null,i;if(!i.lastComment)return i.lastComment=o,i;var a=i.lastComment;if(t.arr.detect(n.body,function(e){return e.start>=a.end&&e.end<=o.start}))return i.lastComment=o,i;var s=e.slice(a.end,o.start);return/[\n\r][\n\r]+/.test(s)?(i.lastComment=o,i):(a.text+="\n"+o.text,a.end=o.end,t.arr.remove(n.comments,o),t.arr.remove(r.comments,o),i)},{lastComment:null})}),r}if(r=r||{},r.ecmaVersion=r.ecmaVersion||8,r.sourceType=r.sourceType||"module",r.hasOwnProperty("allowImportExportEverywhere")||(r.allowImportExportEverywhere=!0),r.plugins=r.plugins||{},r.plugins.asyncawait=r.plugins.hasOwnProperty("asyncawait")?r.plugins.asyncawait:{inAsyncFunction:!0},r.plugins.objectSpread=!r.plugins.hasOwnProperty("objectSpread")||r.plugins.objectSpread,r.withComments){delete r.withComments;var o=[];r.onComment=function(e,t,r,n,i,a){o.push({isBlock:e,text:t,node:null,start:r,end:n,line:i,column:a})}}try{var a=acorn.parse(e,r)}catch(t){if("undefined"!=typeof SyntaxError&&t instanceof SyntaxError&&t.loc){var s=e.split("\n"),c=t.message,p=t.loc,d=p.line,h=p.column,m=t.pos,v=s[d-1],y="Syntax error at line "+d+" column "+h+" (index "+m+') "'+c+'"\nsource: '+v.slice(0,h)+"<--SyntaxError--\x3e"+v.slice(h),g=new SyntaxError(y);throw g.loc={line:d,column:h},g.pos=m,g}throw t}return r.addSource&&l(a,e),r.addAstIndex&&!a.hasOwnProperty("astIndex")&&u(a),a&&o&&function(e){e=i(n(e)),a.allComments=e.comments}({ast:a,comments:o,nodesWithComments:[]}),a}function h(e){return Be.test(e)&&-1===e.indexOf("-")}function m(e){return"this"===e?{type:"ThisExpression"}:{name:String(e),type:"Identifier"}}function v(e){return{type:"Literal",value:e}}function y(e){return{type:"ExpressionStatement",expression:e}}function g(e){return{type:"ReturnStatement",argument:e}}function b(e){for(var t=arguments.length,r=Array(t>2?t-2:0),n=2;n<t;n++)r[n-2]=arguments[n];var i=e.arrow,o=e.id,a=e.expression,s=e.generator,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return u=u.map(function(e){return"string"==typeof e?m(e):e}),{type:(i?"Arrow":"")+"FunctionExpression",id:o?"string"==typeof o?m(o):o:void 0,params:u,body:{body:r,type:"BlockStatement"},expression:a||!1,generator:s||!1}}function _(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return"string"==typeof e&&(e=m(e)),{type:"CallExpression",callee:e,arguments:r}}function w(e,t,r){return"string"==typeof e&&(e={name:e,type:"Identifier"}),{type:"VariableDeclaration",kind:r||"var",declarations:[{type:"VariableDeclarator",id:e,init:t}]}}function x(e,t,r){return"string"==typeof e&&(e=m(e)),"string"==typeof t?(r||h(t)||(r=!0),t=r?v(t):m(t)):"number"==typeof t?(t=v(t),r=!0):"Literal"===t.type&&(r=!0),{type:"MemberExpression",computed:!!r,object:e,property:t}}function k(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return r.reduce(function(e,t){return x(e,t)},"object"===(void 0===e?"undefined":oe(e))?e:m(e))}function E(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return{body:Array.isArray(t[0])?t[0]:t,type:"BlockStatement"}}function S(){return Object.assign(E.apply(void 0,arguments),{sourceType:"module",type:"Program"})}function A(e,t,r){for(var n=arguments.length,i=Array(n>3?n-3:0),o=3;o<n;o++)i[o-3]=arguments[o];return Array.isArray(r)||(i.unshift(r),r=null),{block:E(i),finalizer:r?E(r):null,handler:{body:E(t),param:m(e),type:"CatchClause"},type:"TryStatement"}}function D(e,t){return{type:"Property",key:e,computed:"Identifier"!==e.type,shorthand:!1,value:t}}function C(e){var t=new ye,r=t.newScope(e,null);return t.accept(e,r,[]),r}function F(e,r){return t.tree.filter(C(e),function(e){var t=e.node,n=t.start,i=t.end;return"FunctionDeclaration"===t.type&&(n=t.params.length?t.params[0].start:t.body.start,i=t.body.end),n<=r&&r<=i},function(e){return e.subScopes})}function O(e,t){return(t&&e.node.id&&e.node.id.name?[e.node.id]:[]).concat(Pe.declIds(e.params)).concat(e.funcDecls.map(function(e){return e.id})).concat(Pe.varDeclIds(e)).concat(e.catches).concat(e.classDecls.map(function(e){return e.id})).concat(e.importSpecifiers)}function j(e){var t=Pe.declIds(e.params).concat(e.catches),r=(e.node.id&&e.node.id.name?[e.node]:[]).concat(e.funcDecls).concat(e.classDecls);return t.map(function(e){return[e,e]}).concat(r.map(function(e){return[e,e.id]})).concat(Pe.varDecls(e)).concat(e.importSpecifiers.map(function(t){return[M(e.node,t),t]}))}function B(e,r){return t.arr.pluck(O(e,!0),"name").concat(r?R("Program"===e.node.type?e.node:e.node.body):[])}function R(e){return e&&e.comments?t.arr.flatten(e.comments.filter(function(e){return e.text.trim().match(/^global/)}).map(function(e){return t.arr.invoke(e.text.replace(/^\s*global\s*/,"").split(","),"trim")})):[]}function P(e){return xe.run(e)}function T(e,t){if(0==t.length)return[null,null];var r=de(t),n=r[0],i=r.slice(1),o=n.decls||j(n);return n.decls=o,o.find(function(t){var r=pe(t,2);r[0];return r[1].name==e})||T(e,i)}function I(e){function t(e,n){var i=[e].concat(n);e.refs.forEach(function(e){var t=T(e.name,i),n=pe(t,2),o=n[0],a=n[1];r.set(e,{decl:o,declId:a,ref:e})}),e.subScopes.forEach(function(e){return t(e,i)})}if(e.referencesResolvedSafely)return e;var r=e.resolvedRefMap||(e.resolvedRefMap=new Map);return t(e,[]),e.referencesResolvedSafely=!0,e}function L(e,r){function n(e){var t=B(e,o);return e.subScopes.map(n).reduce(function(e,t){return e.concat(t)},e.refs).filter(function(e){return-1===t.indexOf(e.name)})}(r=r||{}).withComments=!0,"string"==typeof e&&(e=d(e,r));var i=C(e),o=!!r.jslintGlobalComment,a=B(i,o),s=i.refs.concat(t.arr.flatten(i.subScopes.map(n))),u=t.arr.withoutAll(s.map(function(e){return e.name}),a);return{scope:i,varDecls:i.varDecls,funcDecls:i.funcDecls,classDecls:i.classDecls,declaredNames:a,undeclaredNames:u,refs:s,thisRefs:i.thisRefs}}function N(e,t){return t="string"==typeof t?d(t):t,acorn.walk.findNodesIncluding(t,e)}function M(e,r,n){var o=N(r.start,e).reverse().find(function(e){return t.arr.include(Ie,e.type)});if(n&&n.asPath){var a=new i,s=void 0;a.accept=t.fun.wrap(a.accept,function(e,t,r,n){if(t===o)throw s=n,new Error("stop search");return e(t,r,n)});try{a.accept(e,{},[])}catch(e){}return s}return o}function q(e){return e.source||o(e)}function W(e,r){var n=t.string.peekLeft(e,r,/\s+$/),i="number"==typeof n?e.slice(n,r):"";return"\n"===i[0]&&(i=i.slice(1)),i}function $(e,r){for(var n=0;n<e.length;n++){var i=e[n];if("del"===i.type)r=r.slice(0,i.pos)+r.slice(i.pos+i.length);else{if("add"!==i.type)throw new Error("Unexpected change "+t.obj.inspect(i));r=r.slice(0,i.pos)+i.string+r.slice(i.pos)}}return r}function U(e,t){if(e.start===t.start&&e.end===t.end)return 0;if(e.end<=t.start)return-1;if(e.start>=t.end)return 1;if(e.start<=t.start&&e.end>=t.end)return 1;if(t.start<=e.start&&t.end>=e.end)return-1;throw new Error("Comparing nodes")}function z(e,r,n){var i="object"===(void 0===n?"undefined":oe(n))?n:{changes:[],source:n},o=!1,a=i.changes.reduce(function(e,r){if(e.end<r.pos)return e;var n=r.pos<e.start;if(o=o||r.pos>=e.start&&r.pos<=e.end,"add"===r.type)return{start:n?e.start+r.string.length:e.start,end:e.end+r.string.length};if("del"===r.type)return{start:n?e.start-r.length:e.start,end:e.end-r.length};throw new Error("Cannot deal with change "+t.obj.inspect(r))},{start:e.start,end:e.end}),s=i.source,u=r(e,s.slice(a.start,a.end),o),c=Array.isArray(u)?u.map(q).join("\n"+W(s,a.start)):c=q(u),l=[{type:"del",pos:a.start,length:a.end-a.start},{type:"add",pos:a.start,string:c}];return{changes:i.changes.concat(l),source:$(l,s)}}function V(e,t){for(var r=e.sort(function(e,t){return U(e.target,t.target)}),n="object"===(void 0===t?"undefined":oe(t))?t:{changes:[],source:t},i=0;i<r.length;i++){var o=r[i];n=z(o.target,o.replacementFunc,n)}return n}function G(e,r){var n=d(e,r=r||{}),i=t.arr.last(n.body);return"ExpressionStatement"===i.type?(n.body.splice(n.body.length-1,1,g(i.expression)),r.asAST?n:o(n)):r.asAST?n:e}function H(e,r){function n(e){return t.arr.detect(e.node.body,function(t){return t.start>e.comment.end})}function a(e){return{type:"unknown",comment:e.comment.text}}function s(e){var r=t.Path(e.path.slice(0,-1)).get(_);return r&&"FunctionDeclaration"===r.type}function u(e){var r=t.Path(e.path.slice(0,-1)).get(_);return{name:r.id?r.id.name:"<error: no name for function>",args:t.arr.pluck(r.params,"name")}}function c(e){return t.arr.equals(e.path.slice(-2),["value","body"])}function l(e){return t.arr.equals(e.path.slice(-2),["right","body"])}function f(e){for(var r=t.Path(e.path.slice(0,-2)).get(_),n=r.key?r.key.name:"<error: no name for method>",i=e.path.slice(),o="<error: no object found for method>";i.length&&"init"!==t.arr.last(i);)i.pop();if(i.length&&(o=t.Path(i.slice(0,-1).concat(["id","name"])).get(_)),t.string.startsWith(o,"<error")){for(i=e.path.slice();i.length&&"right"!==t.arr.last(i);)i.pop();if(i.length){var a=t.Path(i.slice(0,-1).concat(["left"])).get(_);o=w.slice(a.start,a.end)}}if(t.string.startsWith(o,"<error")){i=e.path.slice();var s=t.Path(i.slice(0,-6)).get(_),u=s&&"CallExpression"===s.type&&s.arguments[0];u&&(o=w.slice(u.start,u.end))}return{name:n,args:t.arr.pluck(r.value.params,"name"),objectName:o}}function p(e){var r=t.Path(e.path.slice(0,-1)).get(_);if("FunctionExpression"!==r.type&&"FunctionDeclaration"!==r.type)return{};var n=M(_,r);if("ExpressionStatement"!==n.type||"AssignmentExpression"!==n.expression.type)return{};var i=w.slice(n.expression.left.object.start,n.expression.left.object.end);return{name:w.slice(n.expression.left.property.start,n.expression.left.property.end),objectName:i,args:t.arr.pluck(r.params,"name")}}function h(e){var r=e.path.slice(-5);return t.arr.removeAt(r,1),t.arr.equals(r,["properties","value","callee","body"])}function m(e){var r,n,i;i=e.path.slice(0,-3);var o=t.Path(i).get(_);o&&"Property"===o.type&&(n=t.arr.pluck(o.value.callee.params,"name"),r=o.key?o.key.name:"<error: no name for method>"),r||(i=e.path.slice(0,-2),(o=t.Path(i).get(_))&&"Property"===o.type&&(n=t.arr.pluck(o.value.params,"name"),r=o.key?o.key.name:"<error: no name for method>")),r||(r="<error: no name for method>",n=[],i=e.path);for(var a=t.arr.clone(i),s="<error: no object found for method>";a.length&&"init"!==t.arr.last(a);)a.pop();if(a.length&&(s=t.Path(a.slice(0,-1).concat(["id","name"])).get(_)),t.string.startsWith(s,"<error")){for(a=t.arr.clone(i);a.length&&"right"!==t.arr.last(a);)a.pop();if(a.length){var u=t.Path(a.slice(0,-1).concat(["left"])).get(_);s=w.slice(u.start,u.end)}}if(t.string.startsWith(s,"<error")){var a=t.arr.clone(i),c=t.Path(a.slice(0,-4)).get(_),l=c&&"CallExpression"===c.type&&c.arguments[0];l&&(s=w.slice(l.start,l.end))}return{name:r,args:n,objectName:s}}function v(e){return y(e)&&("ObjectExpression"===e.declarations[0].init.type||b(e.declarations[0].init))}function y(e){return e&&"VariableDeclaration"===e.type&&1===e.declarations.length}function g(e){return{name:e.declarations[0].id.name}}function b(e){return"AssignmentExpression"===e.type&&("ObjectExpression"===e.right.type||"AssignmentExpression"===e.right.type&&b(e.right))}var _="string"==typeof e?d(e,{withComments:!0}):e,w=r||("string"==typeof e?e:o(e)),x=t.arr.sortBy(function(e){var r=[],n=new i;return n.accept=t.fun.wrap(n.accept,function(e,n,i,o){return n.comments&&t.arr.pushAll(r,n.comments.map(function(e){return{path:o,comment:e,node:n}})),e(n,i,o)}),n.accept(e,r,[]),r}(_),function(e){return e.comment.start});return x.map(function(e,r){if(c(e))return t.obj.merge([e,e.comment,{type:"method",comment:e.comment.text},f(e)]);if(h(e))return t.obj.merge([e,e.comment,{type:"method",comment:e.comment.text},m(e)]);if(s(e))return t.obj.merge([e,e.comment,{type:"function",comment:e.comment.text},u(e)]);if(l(e))return t.obj.merge([e,e.comment,{type:"method",comment:e.comment.text},p(e)]);var i=n(e);if(!i)return t.obj.merge([e,e.comment,{followingNode:i},a(e)]);var o=x[r+1];return o&&o.comment.start<=i.start?t.obj.merge([e,e.comment,{followingNode:i},a(e)]):v(i)?t.obj.merge([e,e.comment,{followingNode:i},{type:"object",comment:e.comment.text},g(i)]):y(i)?t.obj.merge([e,e.comment,{followingNode:i},{type:"var",comment:e.comment.text},g(i)]):t.obj.merge([e,e.comment,{followingNode:i},a(e)])})}function J(e,r){r=r||t.obj.merge({hideOneLiners:!1},r),"string"==typeof e&&(e=d(e,{addSource:!0}));var n="Program"===e.type?e.body:e.body.body,i=[],o=(r.hideOneLiners&&e.source,!0),a=!1,s=void 0;try{for(var u,c=n[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var l=u.value,f=ee(l=te(l),r)||Q(l)||X(l)||K(l)||Z(l);if(f){if(r.hideOneLiners)if(e.loc)f=f.filter(function(e){return!e.node.loc||e.node.loc.start.line!==e.node.loc.end.line});else if(e.source){var p=[],h=!0,m=!1,v=void 0;try{for(var y,g=f[Symbol.iterator]();!(h=(y=g.next()).done);h=!0){var b=y.value;(b.parent&&p.includes(b.parent)||(b.node.source||"").includes("\n"))&&p.push(b)}}catch(e){m=!0,v=e}finally{try{!h&&g.return&&g.return()}finally{if(m)throw v}}f=p}i.push.apply(i,he(f))}}}catch(e){a=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(a)throw s}}return i}function K(e){var t;if("ClassDeclaration"!==e.type)return null;var r={type:"class-decl",name:e.id.name,node:e,children:[]};return(t=r.children).push.apply(t,he(e.body.body.map(function(e,t){return Y(e,r,t)}).filter(Boolean))),[r].concat(he(r.children))}function Y(e,t,r){if("MethodDefinition"!==e.type)return null;var n;return"constructor"===e.kind?n="class-constructor":"method"===e.kind?n=e.static?"class-class-method":"class-instance-method":"get"===e.kind?n=e.static?"class-class-getter":"class-instance-getter":"set"===e.kind&&(n=e.static?"class-class-setter":"class-instance-setter"),n?{type:n,parent:t,node:e,name:e.key.name}:null}function Q(e){if("VariableDeclaration"!==e.type)return null;var t=[],r=!0,n=!1,i=void 0;try{for(var o,a=function(){var e=o.value,r=e.id,n=e.node,i={name:r.name,node:n,type:"var-decl"};if(t.push(i),!i.node.init)return"continue";for(var a=i.node.init;"AssignmentExpression"===a.type;)a=a.right;if("ObjectExpression"===a.type)return i.type="object-decl",i.children=re(a).map(function(e){return ue({},e,{type:"object-"+e.type,parent:i})}),t.push.apply(t,he(i.children)),"continue";(u=Z(a,i))&&(i.children=u.map(function(e){return ue({},e,{parent:i})}),t.push.apply(t,he(i.children)))},s=ie(e)[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u;a()}}catch(e){n=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}return t}function X(e){return"FunctionStatement"!==e.type&&"FunctionDeclaration"!==e.type?null:[{name:e.id.name,node:e,type:"function-decl"}]}function Z(e,t){if("ExpressionStatement"===e.type&&(e=e.expression),"CallExpression"!==e.type)return null;var r=e.arguments.find(function(e){return"ObjectExpression"===e.type});return r?re(r,t):null}function ee(e,r){if(!ne(e))return null;var n,i=t.Path("expression.arguments.0").get(e);n=i&&"FunctionExpression"===i.type&&t.string.lines(i.source||"").length>5?J(i,r):J(t.Path("expression.callee").get(e),r);var o={node:e,name:t.Path("expression.callee.id.name").get(e)};return n.forEach(function(e){return e.parent||(e.parent=o)}),n}function te(e){return"ExportNamedDeclaration"!==e.type&&"ExportDefaultDeclaration"!==e.type||!e.declaration?e:e.declaration}function re(e,t){return e.properties.map(function(e){return{name:e.key.name||e.key.value,type:"FunctionExpression"===e.value.type?"method":"property",node:e,parent:t}})}function ne(e){return"CallExpression"===t.Path("expression.type").get(e)&&"FunctionExpression"===t.Path("expression.callee.type").get(e)}function ie(e){return e.declarations.map(function(e){return!e.source&&e.init&&(e.source=e.id.name+" = "+e.init.source),{node:e,id:e.id}})}i.prototype.accept=function(e,t,r){if(!e)throw new Error("Undefined AST node in Visitor.accept:\n  "+r.join(".")+"\n  "+e);if(!e.type)throw new Error("Strangee AST node without type in Visitor.accept:\n  "+r.join(".")+"\n  "+JSON.stringify(e));switch(e.type){case"Node":return this.visitNode(e,t,r);case"SourceLocation":return this.visitSourceLocation(e,t,r);case"Position":return this.visitPosition(e,t,r);case"Program":return this.visitProgram(e,t,r);case"Function":return this.visitFunction(e,t,r);case"Statement":return this.visitStatement(e,t,r);case"SwitchCase":return this.visitSwitchCase(e,t,r);case"CatchClause":return this.visitCatchClause(e,t,r);case"VariableDeclarator":return this.visitVariableDeclarator(e,t,r);case"Expression":return this.visitExpression(e,t,r);case"Property":return this.visitProperty(e,t,r);case"Pattern":return this.visitPattern(e,t,r);case"Super":return this.visitSuper(e,t,r);case"SpreadElement":return this.visitSpreadElement(e,t,r);case"TemplateElement":return this.visitTemplateElement(e,t,r);case"Class":return this.visitClass(e,t,r);case"ClassBody":return this.visitClassBody(e,t,r);case"MethodDefinition":return this.visitMethodDefinition(e,t,r);case"ModuleDeclaration":return this.visitModuleDeclaration(e,t,r);case"ModuleSpecifier":return this.visitModuleSpecifier(e,t,r);case"Identifier":return this.visitIdentifier(e,t,r);case"Literal":return this.visitLiteral(e,t,r);case"ExpressionStatement":return this.visitExpressionStatement(e,t,r);case"BlockStatement":return this.visitBlockStatement(e,t,r);case"EmptyStatement":return this.visitEmptyStatement(e,t,r);case"DebuggerStatement":return this.visitDebuggerStatement(e,t,r);case"WithStatement":return this.visitWithStatement(e,t,r);case"ReturnStatement":return this.visitReturnStatement(e,t,r);case"LabeledStatement":return this.visitLabeledStatement(e,t,r);case"BreakStatement":return this.visitBreakStatement(e,t,r);case"ContinueStatement":return this.visitContinueStatement(e,t,r);case"IfStatement":return this.visitIfStatement(e,t,r);case"SwitchStatement":return this.visitSwitchStatement(e,t,r);case"ThrowStatement":return this.visitThrowStatement(e,t,r);case"TryStatement":return this.visitTryStatement(e,t,r);case"WhileStatement":return this.visitWhileStatement(e,t,r);case"DoWhileStatement":return this.visitDoWhileStatement(e,t,r);case"ForStatement":return this.visitForStatement(e,t,r);case"ForInStatement":return this.visitForInStatement(e,t,r);case"Declaration":return this.visitDeclaration(e,t,r);case"ThisExpression":return this.visitThisExpression(e,t,r);case"ArrayExpression":return this.visitArrayExpression(e,t,r);case"ObjectExpression":return this.visitObjectExpression(e,t,r);case"FunctionExpression":return this.visitFunctionExpression(e,t,r);case"UnaryExpression":return this.visitUnaryExpression(e,t,r);case"UpdateExpression":return this.visitUpdateExpression(e,t,r);case"BinaryExpression":return this.visitBinaryExpression(e,t,r);case"AssignmentExpression":return this.visitAssignmentExpression(e,t,r);case"LogicalExpression":return this.visitLogicalExpression(e,t,r);case"MemberExpression":return this.visitMemberExpression(e,t,r);case"ConditionalExpression":return this.visitConditionalExpression(e,t,r);case"CallExpression":return this.visitCallExpression(e,t,r);case"NewExpression":return this.visitNewExpression(e,t,r);case"SequenceExpression":return this.visitSequenceExpression(e,t,r);case"ArrowFunctionExpression":return this.visitArrowFunctionExpression(e,t,r);case"YieldExpression":return this.visitYieldExpression(e,t,r);case"TemplateLiteral":return this.visitTemplateLiteral(e,t,r);case"TaggedTemplateExpression":return this.visitTaggedTemplateExpression(e,t,r);case"AssignmentProperty":return this.visitAssignmentProperty(e,t,r);case"ObjectPattern":return this.visitObjectPattern(e,t,r);case"ArrayPattern":return this.visitArrayPattern(e,t,r);case"RestElement":return this.visitRestElement(e,t,r);case"AssignmentPattern":return this.visitAssignmentPattern(e,t,r);case"ClassExpression":return this.visitClassExpression(e,t,r);case"MetaProperty":return this.visitMetaProperty(e,t,r);case"ImportDeclaration":return this.visitImportDeclaration(e,t,r);case"ImportSpecifier":return this.visitImportSpecifier(e,t,r);case"ImportDefaultSpecifier":return this.visitImportDefaultSpecifier(e,t,r);case"ImportNamespaceSpecifier":return this.visitImportNamespaceSpecifier(e,t,r);case"ExportNamedDeclaration":return this.visitExportNamedDeclaration(e,t,r);case"ExportSpecifier":return this.visitExportSpecifier(e,t,r);case"ExportDefaultDeclaration":return this.visitExportDefaultDeclaration(e,t,r);case"ExportAllDeclaration":return this.visitExportAllDeclaration(e,t,r);case"AwaitExpression":return this.visitAwaitExpression(e,t,r);case"RegExpLiteral":return this.visitRegExpLiteral(e,t,r);case"FunctionDeclaration":return this.visitFunctionDeclaration(e,t,r);case"VariableDeclaration":return this.visitVariableDeclaration(e,t,r);case"ForOfStatement":return this.visitForOfStatement(e,t,r);case"ClassDeclaration":return this.visitClassDeclaration(e,t,r)}throw new Error("No visit function in AST visitor Visitor for:\n  "+r.join(".")+"\n  "+JSON.stringify(e))},i.prototype.visitNode=function(e,t,r){return e},i.prototype.visitSourceLocation=function(e,t,r){var n=this;return e.start=n.accept(e.start,t,r.concat(["start"])),e.end=n.accept(e.end,t,r.concat(["end"])),e},i.prototype.visitPosition=function(e,t,r){return e},i.prototype.visitProgram=function(e,t,r){for(var n=this,i=[],o=0;o<e.body.length;o++){var a=e.body[o],s=a?n.accept(a,t,r.concat(["body",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.body=i,e},i.prototype.visitFunction=function(e,t,r){var n=this;e.id&&(e.id=n.accept(e.id,t,r.concat(["id"])));for(var i=[],o=0;o<e.params.length;o++){var a=e.params[o],s=a?n.accept(a,t,r.concat(["params",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.params=i,e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitStatement=function(e,t,r){return e},i.prototype.visitSwitchCase=function(e,t,r){var n=this;e.test&&(e.test=n.accept(e.test,t,r.concat(["test"])));for(var i=[],o=0;o<e.consequent.length;o++){var a=e.consequent[o],s=a?n.accept(a,t,r.concat(["consequent",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.consequent=i,e},i.prototype.visitCatchClause=function(e,t,r){var n=this;return e.param=n.accept(e.param,t,r.concat(["param"])),e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitVariableDeclarator=function(e,t,r){var n=this;return e.id=n.accept(e.id,t,r.concat(["id"])),e.init&&(e.init=n.accept(e.init,t,r.concat(["init"]))),e},i.prototype.visitExpression=function(e,t,r){return e},i.prototype.visitProperty=function(e,t,r){var n=this;return e.key=n.accept(e.key,t,r.concat(["key"])),e.value=n.accept(e.value,t,r.concat(["value"])),e},i.prototype.visitPattern=function(e,t,r){return e},i.prototype.visitSuper=function(e,t,r){return e},i.prototype.visitSpreadElement=function(e,t,r){var n=this;return e.argument=n.accept(e.argument,t,r.concat(["argument"])),e},i.prototype.visitTemplateElement=function(e,t,r){return e},i.prototype.visitClass=function(e,t,r){var n=this;return e.id&&(e.id=n.accept(e.id,t,r.concat(["id"]))),e.superClass&&(e.superClass=n.accept(e.superClass,t,r.concat(["superClass"]))),e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitClassBody=function(e,t,r){for(var n=this,i=[],o=0;o<e.body.length;o++){var a=e.body[o],s=a?n.accept(a,t,r.concat(["body",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.body=i,e},i.prototype.visitMethodDefinition=function(e,t,r){var n=this;return e.key=n.accept(e.key,t,r.concat(["key"])),e.value=n.accept(e.value,t,r.concat(["value"])),e},i.prototype.visitModuleDeclaration=function(e,t,r){return e},i.prototype.visitModuleSpecifier=function(e,t,r){var n=this;return e.local=n.accept(e.local,t,r.concat(["local"])),e},i.prototype.visitIdentifier=function(e,t,r){return e},i.prototype.visitLiteral=function(e,t,r){return e},i.prototype.visitExpressionStatement=function(e,t,r){var n=this;return e.expression=n.accept(e.expression,t,r.concat(["expression"])),e},i.prototype.visitBlockStatement=function(e,t,r){for(var n=this,i=[],o=0;o<e.body.length;o++){var a=e.body[o],s=a?n.accept(a,t,r.concat(["body",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.body=i,e},i.prototype.visitEmptyStatement=function(e,t,r){return e},i.prototype.visitDebuggerStatement=function(e,t,r){return e},i.prototype.visitWithStatement=function(e,t,r){var n=this;return e.object=n.accept(e.object,t,r.concat(["object"])),e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitReturnStatement=function(e,t,r){var n=this;return e.argument&&(e.argument=n.accept(e.argument,t,r.concat(["argument"]))),e},i.prototype.visitLabeledStatement=function(e,t,r){var n=this;return e.label=n.accept(e.label,t,r.concat(["label"])),e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitBreakStatement=function(e,t,r){var n=this;return e.label&&(e.label=n.accept(e.label,t,r.concat(["label"]))),e},i.prototype.visitContinueStatement=function(e,t,r){var n=this;return e.label&&(e.label=n.accept(e.label,t,r.concat(["label"]))),e},i.prototype.visitIfStatement=function(e,t,r){var n=this;return e.test=n.accept(e.test,t,r.concat(["test"])),e.consequent=n.accept(e.consequent,t,r.concat(["consequent"])),e.alternate&&(e.alternate=n.accept(e.alternate,t,r.concat(["alternate"]))),e},i.prototype.visitSwitchStatement=function(e,t,r){var n=this;e.discriminant=n.accept(e.discriminant,t,r.concat(["discriminant"]));for(var i=[],o=0;o<e.cases.length;o++){var a=e.cases[o],s=a?n.accept(a,t,r.concat(["cases",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.cases=i,e},i.prototype.visitThrowStatement=function(e,t,r){var n=this;return e.argument=n.accept(e.argument,t,r.concat(["argument"])),e},i.prototype.visitTryStatement=function(e,t,r){var n=this;return e.block=n.accept(e.block,t,r.concat(["block"])),e.handler&&(e.handler=n.accept(e.handler,t,r.concat(["handler"]))),e.finalizer&&(e.finalizer=n.accept(e.finalizer,t,r.concat(["finalizer"]))),e},i.prototype.visitWhileStatement=function(e,t,r){var n=this;return e.test=n.accept(e.test,t,r.concat(["test"])),e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitDoWhileStatement=function(e,t,r){var n=this;return e.body=n.accept(e.body,t,r.concat(["body"])),e.test=n.accept(e.test,t,r.concat(["test"])),e},i.prototype.visitForStatement=function(e,t,r){var n=this;return e.init&&(e.init=n.accept(e.init,t,r.concat(["init"]))),e.test&&(e.test=n.accept(e.test,t,r.concat(["test"]))),e.update&&(e.update=n.accept(e.update,t,r.concat(["update"]))),e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitForInStatement=function(e,t,r){var n=this;return e.left=n.accept(e.left,t,r.concat(["left"])),e.right=n.accept(e.right,t,r.concat(["right"])),e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitDeclaration=function(e,t,r){return e},i.prototype.visitThisExpression=function(e,t,r){return e},i.prototype.visitArrayExpression=function(e,t,r){var n=this;if(e.elements){for(var i=[],o=0;o<e.elements.length;o++){var a=e.elements[o],s=a?n.accept(a,t,r.concat(["elements",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}e.elements=i}return e},i.prototype.visitObjectExpression=function(e,t,r){for(var n=this,i=[],o=0;o<e.properties.length;o++){var a=e.properties[o],s=a?n.accept(a,t,r.concat(["properties",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.properties=i,e},i.prototype.visitFunctionExpression=function(e,t,r){var n=this;e.id&&(e.id=n.accept(e.id,t,r.concat(["id"])));for(var i=[],o=0;o<e.params.length;o++){var a=e.params[o],s=a?n.accept(a,t,r.concat(["params",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.params=i,e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitUnaryExpression=function(e,t,r){var n=this;return e.argument=n.accept(e.argument,t,r.concat(["argument"])),e},i.prototype.visitUpdateExpression=function(e,t,r){var n=this;return e.argument=n.accept(e.argument,t,r.concat(["argument"])),e},i.prototype.visitBinaryExpression=function(e,t,r){var n=this;return e.left=n.accept(e.left,t,r.concat(["left"])),e.right=n.accept(e.right,t,r.concat(["right"])),e},i.prototype.visitAssignmentExpression=function(e,t,r){var n=this;return e.left=n.accept(e.left,t,r.concat(["left"])),e.right=n.accept(e.right,t,r.concat(["right"])),e},i.prototype.visitLogicalExpression=function(e,t,r){var n=this;return e.left=n.accept(e.left,t,r.concat(["left"])),e.right=n.accept(e.right,t,r.concat(["right"])),e},i.prototype.visitMemberExpression=function(e,t,r){var n=this;return e.object=n.accept(e.object,t,r.concat(["object"])),e.property=n.accept(e.property,t,r.concat(["property"])),e},i.prototype.visitConditionalExpression=function(e,t,r){var n=this;return e.test=n.accept(e.test,t,r.concat(["test"])),e.alternate=n.accept(e.alternate,t,r.concat(["alternate"])),e.consequent=n.accept(e.consequent,t,r.concat(["consequent"])),e},i.prototype.visitCallExpression=function(e,t,r){var n=this;e.callee=n.accept(e.callee,t,r.concat(["callee"]));for(var i=[],o=0;o<e.arguments.length;o++){var a=e.arguments[o],s=a?n.accept(a,t,r.concat(["arguments",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.arguments=i,e},i.prototype.visitNewExpression=function(e,t,r){var n=this;e.callee=n.accept(e.callee,t,r.concat(["callee"]));for(var i=[],o=0;o<e.arguments.length;o++){var a=e.arguments[o],s=a?n.accept(a,t,r.concat(["arguments",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.arguments=i,e},i.prototype.visitSequenceExpression=function(e,t,r){for(var n=this,i=[],o=0;o<e.expressions.length;o++){var a=e.expressions[o],s=a?n.accept(a,t,r.concat(["expressions",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.expressions=i,e},i.prototype.visitArrowFunctionExpression=function(e,t,r){var n=this;e.body=n.accept(e.body,t,r.concat(["body"])),e.id&&(e.id=n.accept(e.id,t,r.concat(["id"])));for(var i=[],o=0;o<e.params.length;o++){var a=e.params[o],s=a?n.accept(a,t,r.concat(["params",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.params=i,e},i.prototype.visitYieldExpression=function(e,t,r){var n=this;return e.argument&&(e.argument=n.accept(e.argument,t,r.concat(["argument"]))),e},i.prototype.visitTemplateLiteral=function(e,t,r){for(var n=this,i=[],o=0;o<e.quasis.length;o++){s=(a=e.quasis[o])?n.accept(a,t,r.concat(["quasis",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}e.quasis=i;for(var i=[],o=0;o<e.expressions.length;o++){var a=e.expressions[o],s=a?n.accept(a,t,r.concat(["expressions",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.expressions=i,e},i.prototype.visitTaggedTemplateExpression=function(e,t,r){var n=this;return e.tag=n.accept(e.tag,t,r.concat(["tag"])),e.quasi=n.accept(e.quasi,t,r.concat(["quasi"])),e},i.prototype.visitAssignmentProperty=function(e,t,r){var n=this;return e.value=n.accept(e.value,t,r.concat(["value"])),e.key=n.accept(e.key,t,r.concat(["key"])),e},i.prototype.visitObjectPattern=function(e,t,r){for(var n=this,i=[],o=0;o<e.properties.length;o++){var a=e.properties[o],s=a?n.accept(a,t,r.concat(["properties",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.properties=i,e},i.prototype.visitArrayPattern=function(e,t,r){var n=this;if(e.elements){for(var i=[],o=0;o<e.elements.length;o++){var a=e.elements[o],s=a?n.accept(a,t,r.concat(["elements",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}e.elements=i}return e},i.prototype.visitRestElement=function(e,t,r){var n=this;return e.argument=n.accept(e.argument,t,r.concat(["argument"])),e},i.prototype.visitAssignmentPattern=function(e,t,r){var n=this;return e.left=n.accept(e.left,t,r.concat(["left"])),e.right=n.accept(e.right,t,r.concat(["right"])),e},i.prototype.visitClassExpression=function(e,t,r){var n=this;return e.id&&(e.id=n.accept(e.id,t,r.concat(["id"]))),e.superClass&&(e.superClass=n.accept(e.superClass,t,r.concat(["superClass"]))),e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitMetaProperty=function(e,t,r){var n=this;return e.meta=n.accept(e.meta,t,r.concat(["meta"])),e.property=n.accept(e.property,t,r.concat(["property"])),e},i.prototype.visitImportDeclaration=function(e,t,r){for(var n=this,i=[],o=0;o<e.specifiers.length;o++){var a=e.specifiers[o],s=a?n.accept(a,t,r.concat(["specifiers",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.specifiers=i,e.source=n.accept(e.source,t,r.concat(["source"])),e},i.prototype.visitImportSpecifier=function(e,t,r){var n=this;return e.imported=n.accept(e.imported,t,r.concat(["imported"])),e.local=n.accept(e.local,t,r.concat(["local"])),e},i.prototype.visitImportDefaultSpecifier=function(e,t,r){var n=this;return e.local=n.accept(e.local,t,r.concat(["local"])),e},i.prototype.visitImportNamespaceSpecifier=function(e,t,r){var n=this;return e.local=n.accept(e.local,t,r.concat(["local"])),e},i.prototype.visitExportNamedDeclaration=function(e,t,r){var n=this;e.declaration&&(e.declaration=n.accept(e.declaration,t,r.concat(["declaration"])));for(var i=[],o=0;o<e.specifiers.length;o++){var a=e.specifiers[o],s=a?n.accept(a,t,r.concat(["specifiers",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.specifiers=i,e.source&&(e.source=n.accept(e.source,t,r.concat(["source"]))),e},i.prototype.visitExportSpecifier=function(e,t,r){var n=this;return e.exported=n.accept(e.exported,t,r.concat(["exported"])),e.local=n.accept(e.local,t,r.concat(["local"])),e},i.prototype.visitExportDefaultDeclaration=function(e,t,r){var n=this;return e.declaration=n.accept(e.declaration,t,r.concat(["declaration"])),e},i.prototype.visitExportAllDeclaration=function(e,t,r){var n=this;return e.source=n.accept(e.source,t,r.concat(["source"])),e},i.prototype.visitAwaitExpression=function(e,t,r){var n=this;return e.argument=n.accept(e.argument,t,r.concat(["argument"])),e},i.prototype.visitRegExpLiteral=function(e,t,r){return e},i.prototype.visitFunctionDeclaration=function(e,t,r){var n=this;e.id=n.accept(e.id,t,r.concat(["id"]));for(var i=[],o=0;o<e.params.length;o++){var a=e.params[o],s=a?n.accept(a,t,r.concat(["params",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.params=i,e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitVariableDeclaration=function(e,t,r){for(var n=this,i=[],o=0;o<e.declarations.length;o++){var a=e.declarations[o],s=a?n.accept(a,t,r.concat(["declarations",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.declarations=i,e},i.prototype.visitForOfStatement=function(e,t,r){var n=this;return e.left=n.accept(e.left,t,r.concat(["left"])),e.right=n.accept(e.right,t,r.concat(["right"])),e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitClassDeclaration=function(e,t,r){var n=this;return e.id=n.accept(e.id,t,r.concat(["id"])),e.superClass&&(e.superClass=n.accept(e.superClass,t,r.concat(["superClass"]))),e.body=n.accept(e.body,t,r.concat(["body"])),e};var oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ae=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},se=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),ue=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ce=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},le=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},fe=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},pe=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),de=function(e){return Array.isArray(e)?e:Array.from(e)},he=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},me=function(e){function t(){return ae(this,t),fe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return le(t,e),se(t,[{key:"accept",value:function(e,r,n){var i=n.map(function(e){return"string"==typeof e?"."+e:"["+e+"]"}).join(""),o=[],a=ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,{index:r.index,tree:o},n);return r.tree.push({node:e,path:i,index:r.index++,children:o}),a}}]),t}(i),ve=function(e){function t(){return ae(this,t),fe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return le(t,e),se(t,[{key:"recordNotEqual",value:function(e,t,r,n){r.comparisons.errors.push({node1:e,node2:t,path:r.completePath,msg:n})}},{key:"compareType",value:function(e,t,r){return this.compareField("type",e,t,r)}},{key:"compareField",value:function(e,t,r,n){if(r=lively.lang.Path(n.completePath.join(".")).get(r),t&&r&&t[e]===r[e])return!0;if(t&&"*"===t[e]||r&&"*"===r[e])return!0;var i,o=n.completePath.join(".")+"."+e;return i=t?r?o+" is not equal: "+t[e]+" vs. "+r[e]:"node2 not defined but node1 ("+o+") is: "+t[e]:"node1 on "+o+" not defined",this.recordNotEqual(t,r,n,i),!1}},{key:"accept",value:function(e,t,r,n){var i=lively.lang.Path(n.join(".")).get(t);if("*"!==e&&"*"!==i){var o={completePath:n,comparisons:r.comparisons};this.compareType(e,t,o)&&this["visit"+e.type](e,t,o,n)}}},{key:"visitFunction",value:function(e,r,n,i){return e.generator&&this.compareField("generator",e,r,n),e.expression&&this.compareField("expression",e,r,n),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitFunction",this).call(this,e,r,n,i)}},{key:"visitSwitchStatement",value:function(e,r,n,i){return e.lexical&&this.compareField("lexical",e,r,n),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitSwitchStatement",this).call(this,e,r,n,i)}},{key:"visitForInStatement",value:function(e,r,n,i){return e.each&&this.compareField("each",e,r,n),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitForInStatement",this).call(this,e,r,n,i)}},{key:"visitFunctionDeclaration",value:function(e,r,n,i){return e.generator&&this.compareField("generator",e,r,n),e.expression&&this.compareField("expression",e,r,n),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitFunctionDeclaration",this).call(this,e,r,n,i)}},{key:"visitVariableDeclaration",value:function(e,r,n,i){return this.compareField("kind",e,r,n),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitVariableDeclaration",this).call(this,e,r,n,i)}},{key:"visitUnaryExpression",value:function(e,r,n,i){return this.compareField("operator",e,r,n),e.prefix&&this.compareField("prefix",e,r,n),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitUnaryExpression",this).call(this,e,r,n,i)}},{key:"visitBinaryExpression",value:function(e,r,n,i){return this.compareField("operator",e,r,n),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitBinaryExpression",this).call(this,e,r,n,i)}},{key:"visitAssignmentExpression",value:function(e,r,n,i){return this.compareField("operator",e,r,n),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitAssignmentExpression",this).call(this,e,r,n,i)}},{key:"visitUpdateExpression",value:function(e,r,n,i){return this.compareField("operator",e,r,n),e.prefix&&this.compareField("prefix",e,r,n),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitUpdateExpression",this).call(this,e,r,n,i)}},{key:"visitLogicalExpression",value:function(e,r,n,i){return this.compareField("operator",e,r,n),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitLogicalExpression",this).call(this,e,r,n,i)}},{key:"visitMemberExpression",value:function(e,r,n,i){return e.computed&&this.compareField("computed",e,r,n),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitMemberExpression",this).call(this,e,r,n,i)}},{key:"visitComprehensionBlock",value:function(e,r,n,i){return e.each&&this.compareField("each",e,r,n),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitComprehensionBlock",this).call(this,e,r,n,i)}},{key:"visitIdentifier",value:function(e,r,n,i){return this.compareField("name",e,r,n),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitIdentifier",this).call(this,e,r,n,i)}},{key:"visitLiteral",value:function(e,r,n,i){return this.compareField("value",e,r,n),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitLiteral",this).call(this,e,r,n,i)}},{key:"visitClassDeclaration",value:function(e,r,n,i){return this.compareField("id",e,r,n),e.superClass&&this.compareField("superClass",e,r,n),this.compareField("body",e,r,n),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitClassDeclaration",this).call(this,e,r,n,i)}},{key:"visitClassBody",value:function(e,r,n,i){return this.compareField("body",e,r,n),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitClassBody",this).call(this,e,r,n,i)}},{key:"visitMethodDefinition",value:function(e,r,n,i){return this.compareField("static",e,r,n),this.compareField("computed",e,r,n),this.compareField("kind",e,r,n),this.compareField("key",e,r,n),this.compareField("value",e,r,n),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitMethodDefinition",this).call(this,e,r,n,i)}}]),t}(i),ye=function(e){function t(){return ae(this,t),fe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return le(t,e),se(t,[{key:"newScope",value:function(e,t){var r={node:e,varDecls:[],varDeclPaths:[],funcDecls:[],funcDeclPaths:[],classDecls:[],classDeclPaths:[],classExprs:[],classExprPaths:[],methodDecls:[],methodDeclPaths:[],importSpecifiers:[],importSpecifierPaths:[],exportDecls:[],exportDeclPaths:[],refs:[],thisRefs:[],params:[],catches:[],subScopes:[],resolvedRefMap:new Map};return t&&t.subScopes.push(r),r}},{key:"visitVariableDeclaration",value:function(e,r,n){return r.varDecls.push(e),r.varDeclPaths.push(n),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitVariableDeclaration",this).call(this,e,r,n)}},{key:"visitVariableDeclarator",value:function(e,t,r){var n=this;return e.init&&(e.init=n.accept(e.init,t,r.concat(["init"]))),e}},{key:"visitFunction",value:function(e,t,r){var n=this,i=this.newScope(e,t);return e.params.forEach(function(e,t){"AssignmentPattern"===e.type&&n.accept(e.right,i,r.concat("params",t,"right"))}),i.params=Array.prototype.slice.call(e.params),i}},{key:"visitFunctionDeclaration",value:function(e,t,r){var n=this.visitFunction(e,t,r);t.funcDecls.push(e),t.funcDeclPaths.push(r);var i=this;return e.defaults&&(e.defaults=e.defaults.reduce(function(e,t,o){var a=i.accept(t,n,r.concat(["defaults",o]));return Array.isArray(a)?e.push.apply(e,a):e.push(a),e},[])),e.rest&&(e.rest=i.accept(e.rest,n,r.concat(["rest"]))),e.body=i.accept(e.body,n,r.concat(["body"])),e.loc&&(e.loc=i.accept(e.loc,n,r.concat(["loc"]))),e}},{key:"visitFunctionExpression",value:function(e,t,r){var n=this.visitFunction(e,t,r),i=this;return e.defaults&&(e.defaults=e.defaults.reduce(function(e,t,o){var a=i.accept(t,n,r.concat(["defaults",o]));return Array.isArray(a)?e.push.apply(e,a):e.push(a),e},[])),e.rest&&(e.rest=i.accept(e.rest,n,r.concat(["rest"]))),e.body=i.accept(e.body,n,r.concat(["body"])),e.loc&&(e.loc=i.accept(e.loc,n,r.concat(["loc"]))),e}},{key:"visitArrowFunctionExpression",value:function(e,t,r){var n=this.visitFunction(e,t,r),i=this;return e.defaults&&(e.defaults=e.defaults.reduce(function(e,t,o){var a=i.accept(t,n,r.concat(["defaults",o]));return Array.isArray(a)?e.push.apply(e,a):e.push(a),e},[])),e.rest&&(e.rest=i.accept(e.rest,n,r.concat(["rest"]))),e.body=i.accept(e.body,n,r.concat(["body"])),e.loc&&(e.loc=i.accept(e.loc,n,r.concat(["loc"]))),e.generator,e.expression,e}},{key:"visitIdentifier",value:function(e,r,n){return r.refs.push(e),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitIdentifier",this).call(this,e,r,n)}},{key:"visitMemberExpression",value:function(e,t,r){var n=this;return e.object=n.accept(e.object,t,r.concat(["object"])),e.computed&&(e.property=n.accept(e.property,t,r.concat(["property"]))),e}},{key:"visitProperty",value:function(e,t,r){var n=this;return e.computed&&(e.key=n.accept(e.key,t,r.concat(["key"]))),e.value=n.accept(e.value,t,r.concat(["value"])),e}},{key:"visitThisExpression",value:function(e,r,n){return r.thisRefs.push(e),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitThisExpression",this).call(this,e,r,n)}},{key:"visitTryStatement",value:function(e,t,r){var n=this;return e.block=n.accept(e.block,t,r.concat(["block"])),e.handler&&(e.handler=n.accept(e.handler,t,r.concat(["handler"])),t.catches.push(e.handler.param)),e.finalizer&&(e.finalizer=n.accept(e.finalizer,t,r.concat(["finalizer"]))),e}},{key:"visitLabeledStatement",value:function(e,t,r){var n=this;return e.body=n.accept(e.body,t,r.concat(["body"])),e}},{key:"visitClassDeclaration",value:function(e,t,r){t.classDecls.push(e),t.classDeclPaths.push(r);var n=this;return e.superClass&&(e.superClass=n.accept(e.superClass,t,r.concat(["superClass"]))),e.body=n.accept(e.body,t,r.concat(["body"])),e}},{key:"visitClassExpression",value:function(e,t,r){e.id&&(t.classExprs.push(e),t.classExprPaths.push(r));var n=this;return e.superClass&&(e.superClass=n.accept(e.superClass,t,r.concat(["superClass"]))),e.body=n.accept(e.body,t,r.concat(["body"])),e}},{key:"visitMethodDefinition",value:function(e,t,r){var n=this;return e.value=n.accept(e.value,t,r.concat(["value"])),e}},{key:"visitMetaProperty",value:function(e,t,r){return e}},{key:"visitBreakStatement",value:function(e,t,r){return e}},{key:"visitContinueStatement",value:function(e,t,r){return e}},{key:"visitImportSpecifier",value:function(e,t,r){t.importSpecifiers.push(e.local),t.importSpecifierPaths.push(r);var n=this;return e.local=n.accept(e.local,t,r.concat(["local"])),e}},{key:"visitImportDefaultSpecifier",value:function(e,t,r){t.importSpecifiers.push(e.local),t.importSpecifierPaths.push(r);return e}},{key:"visitImportNamespaceSpecifier",value:function(e,t,r){t.importSpecifiers.push(e.local),t.importSpecifierPaths.push(r);return e}},{key:"visitExportSpecifier",value:function(e,t,r){var n=this;return e.local=n.accept(e.local,t,r.concat(["local"])),e}},{key:"visitExportNamedDeclaration",value:function(e,r,n){return r.exportDecls.push(e),r.exportDeclPaths.push(n),e.source||ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitExportNamedDeclaration",this).call(this,e,r,n),e}},{key:"visitExportDefaultDeclaration",value:function(e,r,n){return r.exportDecls.push(e),r.exportDeclPaths.push(n),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitExportDefaultDeclaration",this).call(this,e,r,n)}},{key:"visitExportAllDeclaration",value:function(e,r,n){return r.exportDecls.push(e),r.exportDeclPaths.push(n),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitExportAllDeclaration",this).call(this,e,r,n)}}]),t}(i),ge=r.escodegen||r,be=acorn.walk,_e=acorn.loose;be.base.AwaitExpression||(be.base.AwaitExpression=function(e,t,r){e.argument&&r(e.argument,t,"Expression")}),be.forEachNode=a,be.matchNodes=function(e,t,r,n){return a(e,function(e,r,n,i){t[e.type]&&t[e.type](e,r,n,i)},r,n)},be.findNodesIncluding=s,be.withParentInfo=function(e,r,n){function i(e){var r={id:t.string.newUUID(),parentScope:e,containingScopes:[]};return e&&e.containingScopes.push(r),r}n=n||{};var o,s=be.make({Function:function(e,t,r){t&&t.scope&&(t.scope=i(t.scope)),r(e.body,t,"ScopeBody")},VariableDeclarator:function(e,t,r){e.init&&r(e.init,t,"Expression")},VariableDeclaration:function(e,t,r){for(var n=0;n<e.declarations.length;++n){var i=e.declarations[n];i&&r(i,t,"VariableDeclarator")}},ObjectExpression:function(e,t,r){for(var n=0;n<e.properties.length;++n){var i=e.properties[n];r(i.key,t,"Expression"),r(i.value,t,"Expression")}},MemberExpression:function(e,t,r){r(e.object,t,"Expression"),r(e.property,t,"Expression")}},be.base),u=[];a(e,function(e){t.arr.withoutAll(Object.keys(e),["end","start","type","source","raw"]).forEach(function(t){if(!e.__lookupGetter__(t)){var r=e[t];e.__defineGetter__(t,function(){return o=t,r}),u.push([e,t,e[t]])}})},null,{visitors:s});var c=[];return Object.keys(s).forEach(function(e){var t=s[e];s[e]=function(i,a,s){return e===i.type||n.visitAllNodes?(c.push(r.call(null,i,{scope:a.scope,depth:a.depth,parent:a.parent,type:e,propertyInParent:o})),t(i,{scope:a.scope,parent:i,depth:a.depth+1},s)):t(i,a,s)}}),be.recursive(e,{scope:i(),parent:null,propertyInParent:"",depth:0},null,s),u.forEach(function(e){delete e[0][e[1]],e[0][e[1]]=e[2]}),c},be.copy=function(e,r){function n(e){return null===e?null:i[e.type](e,n)}var i=t.obj.extend({Program:function(e,t){return{start:e.start,end:e.end,type:"Program",body:e.body.map(t),source:e.source,astIndex:e.astIndex}},FunctionDeclaration:function(e,t){return{start:e.start,end:e.end,type:"FunctionDeclaration",id:t(e.id),params:e.params.map(t),body:t(e.body),source:e.source,astIndex:e.astIndex}},BlockStatement:function(e,t){return{start:e.start,end:e.end,type:"BlockStatement",body:e.body.map(t),source:e.source,astIndex:e.astIndex}},ExpressionStatement:function(e,t){return{start:e.start,end:e.end,type:"ExpressionStatement",expression:t(e.expression),source:e.source,astIndex:e.astIndex}},CallExpression:function(e,t){return{start:e.start,end:e.end,type:"CallExpression",callee:t(e.callee),arguments:e.arguments.map(t),source:e.source,astIndex:e.astIndex}},MemberExpression:function(e,t){return{start:e.start,end:e.end,type:"MemberExpression",object:t(e.object),property:t(e.property),computed:e.computed,source:e.source,astIndex:e.astIndex}},NewExpression:function(e,t){return{start:e.start,end:e.end,type:"NewExpression",callee:t(e.callee),arguments:e.arguments.map(t),source:e.source,astIndex:e.astIndex}},VariableDeclaration:function(e,t){return{start:e.start,end:e.end,type:"VariableDeclaration",declarations:e.declarations.map(t),kind:e.kind,source:e.source,astIndex:e.astIndex}},VariableDeclarator:function(e,t){return{start:e.start,end:e.end,type:"VariableDeclarator",id:t(e.id),init:t(e.init),source:e.source,astIndex:e.astIndex}},FunctionExpression:function(e,t){return{start:e.start,end:e.end,type:"FunctionExpression",id:t(e.id),params:e.params.map(t),body:t(e.body),source:e.source,astIndex:e.astIndex}},IfStatement:function(e,t){return{start:e.start,end:e.end,type:"IfStatement",test:t(e.test),consequent:t(e.consequent),alternate:t(e.alternate),source:e.source,astIndex:e.astIndex}},ConditionalExpression:function(e,t){return{start:e.start,end:e.end,type:"ConditionalExpression",test:t(e.test),consequent:t(e.consequent),alternate:t(e.alternate),source:e.source,astIndex:e.astIndex}},SwitchStatement:function(e,t){return{start:e.start,end:e.end,type:"SwitchStatement",discriminant:t(e.discriminant),cases:e.cases.map(t),source:e.source,astIndex:e.astIndex}},SwitchCase:function(e,t){return{start:e.start,end:e.end,type:"SwitchCase",test:t(e.test),consequent:e.consequent.map(t),source:e.source,astIndex:e.astIndex}},BreakStatement:function(e,t){return{start:e.start,end:e.end,type:"BreakStatement",label:e.label,source:e.source,astIndex:e.astIndex}},ContinueStatement:function(e,t){return{start:e.start,end:e.end,type:"ContinueStatement",label:e.label,source:e.source,astIndex:e.astIndex}},TryStatement:function(e,t){return{start:e.start,end:e.end,type:"TryStatement",block:t(e.block),handler:t(e.handler),finalizer:t(e.finalizer),guardedHandlers:e.guardedHandlers.map(t),source:e.source,astIndex:e.astIndex}},CatchClause:function(e,t){return{start:e.start,end:e.end,type:"CatchClause",param:t(e.param),guard:t(e.guard),body:t(e.body),source:e.source,astIndex:e.astIndex}},ThrowStatement:function(e,t){return{start:e.start,end:e.end,type:"ThrowStatement",argument:t(e.argument),source:e.source,astIndex:e.astIndex}},ForStatement:function(e,t){return{start:e.start,end:e.end,type:"ForStatement",init:t(e.init),test:t(e.test),update:t(e.update),body:t(e.body),source:e.source,astIndex:e.astIndex}},ForInStatement:function(e,t){return{start:e.start,end:e.end,type:"ForInStatement",left:t(e.left),right:t(e.right),body:t(e.body),source:e.source,astIndex:e.astIndex}},WhileStatement:function(e,t){return{start:e.start,end:e.end,type:"WhileStatement",test:t(e.test),body:t(e.body),source:e.source,astIndex:e.astIndex}},DoWhileStatement:function(e,t){return{start:e.start,end:e.end,type:"DoWhileStatement",test:t(e.test),body:t(e.body),source:e.source,astIndex:e.astIndex}},WithStatement:function(e,t){return{start:e.start,end:e.end,type:"WithStatement",object:t(e.object),body:t(e.body),source:e.source,astIndex:e.astIndex}},UnaryExpression:function(e,t){return{start:e.start,end:e.end,type:"UnaryExpression",argument:t(e.argument),operator:e.operator,prefix:e.prefix,source:e.source,astIndex:e.astIndex}},BinaryExpression:function(e,t){return{start:e.start,end:e.end,type:"BinaryExpression",left:t(e.left),operator:e.operator,right:t(e.right),source:e.source,astIndex:e.astIndex}},LogicalExpression:function(e,t){return{start:e.start,end:e.end,type:"LogicalExpression",left:t(e.left),operator:e.operator,right:t(e.right),source:e.source,astIndex:e.astIndex}},AssignmentExpression:function(e,t){return{start:e.start,end:e.end,type:"AssignmentExpression",left:t(e.left),operator:e.operator,right:t(e.right),source:e.source,astIndex:e.astIndex}},UpdateExpression:function(e,t){return{start:e.start,end:e.end,type:"UpdateExpression",argument:t(e.argument),operator:e.operator,prefix:e.prefix,source:e.source,astIndex:e.astIndex}},ReturnStatement:function(e,t){return{start:e.start,end:e.end,type:"ReturnStatement",argument:t(e.argument),source:e.source,astIndex:e.astIndex}},Identifier:function(e,t){return{start:e.start,end:e.end,type:"Identifier",name:e.name,source:e.source,astIndex:e.astIndex}},Literal:function(e,t){return{start:e.start,end:e.end,type:"Literal",value:e.value,raw:e.raw,source:e.source,astIndex:e.astIndex}},ObjectExpression:function(e,t){return{start:e.start,end:e.end,type:"ObjectExpression",properties:e.properties.map(function(e){return{key:t(e.key),value:t(e.value),kind:e.kind}}),source:e.source,astIndex:e.astIndex}},ArrayExpression:function(e,t){return{start:e.start,end:e.end,type:"ArrayExpression",elements:e.elements.map(t),source:e.source,astIndex:e.astIndex}},SequenceExpression:function(e,t){return{start:e.start,end:e.end,type:"SequenceExpression",expressions:e.expressions.map(t),source:e.source,astIndex:e.astIndex}},EmptyStatement:function(e,t){return{start:e.start,end:e.end,type:"EmptyStatement",source:e.source,astIndex:e.astIndex}},ThisExpression:function(e,t){return{start:e.start,end:e.end,type:"ThisExpression",source:e.source,astIndex:e.astIndex}},DebuggerStatement:function(e,t){return{start:e.start,end:e.end,type:"DebuggerStatement",source:e.source,astIndex:e.astIndex}},LabeledStatement:function(e,t){return{start:e.start,end:e.end,type:"LabeledStatement",label:e.label,body:t(e.body),source:e.source,astIndex:e.astIndex}}},r||{});return n(e)},be.findSiblings=function(e,r,n){if(!r)return[];var i=s(e,r.start),o=i.indexOf(r),a=i.slice(0,o),u=t.arr.detect(a.reverse(),function(e){return Array.isArray(e.body)}).body;if(!n)return t.arr.without(u,r);var c=u.indexOf(r);return"before"===n?u.slice(0,c):u.slice(c+1)},be.findNodeByAstIndex=function(e,t,r){r=null==r||!!r,!e.astIndex&&r&&u(e);var n=null;return De(e,null,function(e,r,i){n||r.astIndex<t||(r.astIndex!==t?e():n=r)}),n},be.findStatementOfNode=function(e,r,n){n||(n=r,r=e,e=null),e||(e={}),r.astIndex||u(r);var i,o=!1,a=["EmptyStatement","BlockStatement","ExpressionStatement","IfStatement","LabeledStatement","BreakStatement","ContinueStatement","WithStatement","SwitchStatement","ReturnStatement","ThrowStatement","TryStatement","WhileStatement","DoWhileStatement","ForStatement","ForInStatement","DebuggerStatement","FunctionDeclaration","VariableDeclaration","ClassDeclaration"];return De(r,{},function(s,u,c,l){if(!(o||u.astIndex<n.astIndex)){if(u===n||u.astIndex===n.astIndex)if(o=!0,e.asPath)i=l;else{var f=t.Path(l);do{i=f.get(r),f=f.slice(0,f.size()-1)}while(-1==a.indexOf(i.type)&&f.size()>0)}!o&&s()}}),i},be.addAstIndex=u,be.visitors={stopAtFunctions:be.make({Function:function(){}},be.base),withMemberExpression:be.make({MemberExpression:function(e,t,r){r(e.object,t,"Expression"),r(e.property,t,"Expression")}},be.base)};var we=function(e){function t(){return ae(this,t),fe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return le(t,e),se(t,[{key:"accept",value:function(e,r,n){return this.doFunc(e,r,n),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,r,n)}}],[{key:"run",value:function(e,t,r){var n=new this;return n.doFunc=t,n.accept(e,r,[]),r}}]),t}(i),xe=function(e){function t(){return ae(this,t),fe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return le(t,e),se(t,[{key:"accept",value:function(e,r,n){switch(e.type){case"ArrowFunctionExpression":case"FunctionExpression":return e;case"FunctionDeclaration":return r.unshift({node:e,path:n}),e;default:return ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,r,n)}}}],[{key:"run",value:function(e){var t=[];return(new this).accept(e,t,[]),t}}]),t}(i),ke=Symbol("canBeInlined"),Ee=function(e){function t(){return ae(this,t),fe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return le(t,e),se(t,[{key:"accept",value:function(e,r,n){return this.replacer(ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,r,n))}},{key:"visitBlockStatement",value:function(e,r,n){return c(ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitBlockStatement",this).call(this,e,r,n))}},{key:"visitProgram",value:function(e,r,n){return c(ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitProgram",this).call(this,e,r,n))}}],[{key:"run",value:function(e,t){var r=new this;return r.replacer=t,r.accept(e,null,[])}}]),t}(i),Se=function(e){function t(){return ae(this,t),fe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return le(t,e),se(t,[{key:"accept",value:function(e,r,n){return this.replacer(ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,r,n),n)}}],[{key:"run",value:function(e,t){var r=new this;return r.replacer=t,r.accept(e,null,[])}}]),t}(i);acorn.walk.addSource=l;var Ae={withMozillaAstDo:function(e,t,r){var n=new i,o=n.accept;return n.accept=function(e,i,a){return t=r(function(){o.call(n,e,i,a)},e,i,a),e},n.accept(e,t,[]),t},printAst:function(e,r){var n,i,a=(r=r||{}).printSource||!1,s=r.printPositions||!1,u=r.printIndex||!1,c=[];return"string"==typeof e?(n=e,i=d(e)):(i=e,n=r.source||i.source),a&&!i.source&&(n||(i=d(n=o(i))),l(i,n)),(new me).accept(i,{index:0,tree:c},[]),t.string.printTree(c[0],function(e){var r=e.path+":"+e.node.type,i=[];if(u&&i.push(e.index),s&&i.push(e.node.start+"-"+e.node.end),a){var o=e.node.source||n.slice(e.node.start,e.node.end),c=t.string.print(o.truncate(60).replace(/\n/g,"").replace(/\s+/g," "));i.push(c)}return i.length&&(r+="("+i.join(",")+")"),r},function(e){return e.children},"  ")},compareAst:function(e,t){if(!e||!t)throw new Error("node"+(e?"1":"2")+" not defined");var r={completePath:[],comparisons:{errors:[]}};return(new ve).accept(e,t,r,[]),r.comparisons.errors.length?r.comparisons.errors.pluck("msg"):null},pathToNode:function(e,t,r){r=r||{},e.astIndex||u(e);var n=new i,o=null;return(n.accept=function(e,r,n,i){if(!o){var a=r.concat(i);if(e.astIndex===t){var s=a.map(function(e){return"string"==typeof e?"."+e:"["+e+"]"}).join("");o={pathString:s,path:a,node:e}}return this["visit"+e.type](e,a,n,i)}}).call(n,e,[],{},[]),o},rematchAstWithSource:function(e,r,n,o){var a=d(r,(n=!!n)?{locations:!0}:void 0),s=new i;o&&(a=t.Path(o).get(a)),s.accept=function(t,r,i){var o=(i=i||[]).reduce(function(e,t){return e[t]},e);return o.start=t.start,o.end=t.end,n&&(o.loc=t.loc),this["visit"+t.type](t,r,i)},s.accept(a)}},De=Ae.withMozillaAstDo,Ce=Ae.printAst,Fe=Ae.compareAst,Oe=Ae.pathToNode,je=Ae.rematchAstWithSource,Be=/[_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*$/,Re=Object.freeze({isIdentifier:h,id:m,literal:v,objectLiteral:function(e){for(var t=[],r=0;r<e.length;r+=2){var n=e[r];"string"==typeof n&&(n=m(n)),t.push(D(n,e[r+1]))}return{properties:t,type:"ObjectExpression"}},prop:D,exprStmt:y,returnStmt:g,empty:function(){return{type:"EmptyStatement"}},binaryExpr:function(e,t,r){return{left:e,right:r,operator:t,type:"BinaryExpression"}},funcExpr:b,funcCall:_,varDecl:w,member:x,memberChain:k,assign:function(e,t){return{type:"AssignmentExpression",operator:"=",right:t?"string"==typeof t?m(t):t:m("undefined"),left:"string"==typeof e?m(e):e}},block:E,program:S,tryStmt:A,ifStmt:function(e){return{consequent:arguments.length>1&&void 0!==arguments[1]?arguments[1]:E(),alternate:arguments.length>2&&void 0!==arguments[2]?arguments[2]:E(),test:e,type:"IfStatement"}},forIn:function(e,t,r){return{type:"ForInStatement",left:"string"==typeof e?w(e):e,right:"string"==typeof t?m(t):t,body:r}},conditional:function(e){return{consequent:arguments.length>1&&void 0!==arguments[1]?arguments[1]:m("undefined"),alternate:arguments.length>2&&void 0!==arguments[2]?arguments[2]:m("undefined"),test:e,type:"ConditionalExpression"}},logical:function(e,t,r){return{operator:e,left:t,right:r,type:"LogicalExpression"}}}),Pe={declIds:function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];if(n)if("Identifier"===n.type)t.push(n);else if("RestElement"===n.type)t.push(n.argument);else if("AssignmentPattern"===n.type)t.push.apply(t,he(Pe.declIds([n.left])));else if("ObjectPattern"===n.type)for(var i=0;i<n.properties.length;i++){var o=n.properties[i];t.push.apply(t,he(Pe.declIds([o.value||o])))}else"ArrayPattern"===n.type&&t.push.apply(t,he(Pe.declIds(n.elements)))}return t},varDecls:function(e){return t.arr.flatmap(e.varDecls,function(e){return t.arr.flatmap(e.declarations,function(e){return Pe.declIds([e.id]).map(function(t){return[e,t]})})})},varDeclIds:function(e){return Pe.declIds(e.varDecls.reduce(function(e,t){return e.push.apply(e,t.declarations),e},[]).map(function(e){return e.id}))},objPropertiesAsList:function(e,r,n){return t.arr.flatmap(e.properties,function(e){var i=e.key.name,o=[],a={key:r.concat([i]),value:e.value};switch(e.value.type){case"ArrayExpression":case"ArrayPattern":n||o.push(a),o=o.concat(t.arr.flatmap(e.value.elements,function(e,t){return Pe.objPropertiesAsList(e,r.concat([i,t]),n)}));break;case"ObjectExpression":case"ObjectPattern":n||o.push(a),o=o.concat(Pe.objPropertiesAsList(e.value,r.concat([i]),n));break;case"AssignmentPattern":n||o.push(a),o=o.concat(Pe.objPropertiesAsList(e.left,r.concat([i]),n));break;default:o.push(a)}return o})},isDeclaration:function(e){return"FunctionDeclaration"===e.type||"VariableDeclaration"===e.type||"ClassDeclaration"===e.type}},Te=["true","false","null","undefined","arguments","Object","Function","String","Array","Date","Boolean","Number","RegExp","Symbol","Error","EvalError","RangeError","ReferenceError","SyntaxError","TypeError","URIError","Math","NaN","Infinity","Intl","JSON","Promise","parseFloat","parseInt","isNaN","isFinite","eval","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","navigator","window","document","console","console","$world","setTimeout","clearTimeout","setInterval","clearInterval","requestAnimationFrame","cancelAnimationFrame","lively"],Ie=["EmptyStatement","BlockStatement","ExpressionStatement","IfStatement","BreakStatement","ContinueStatement","WithStatement","ReturnStatement","ThrowStatement","TryStatement","WhileStatement","DoWhileStatement","ForStatement","ForInStatement","ForOfStatement","DebuggerStatement","FunctionDeclaration","VariableDeclaration","ClassDeclaration","ImportDeclaration","ImportDeclaration","ExportNamedDeclaration","ExportDefaultDeclaration","ExportAllDeclaration"],Le=Object.freeze({helpers:Pe,knownGlobals:Te,scopes:C,nodesAtIndex:function(e,t){return De(e,[],function(e,r,n){return r.start<=t&&t<=r.end&&(n.push(r),e()),n})},scopesAtIndex:F,scopeAtIndex:function(e,r){return t.arr.last(F(e,r))},scopesAtPos:function(e,t){return N(e,t).filter(function(e){return"Program"===e.type||"FunctionDeclaration"===e.type||"FunctionExpression"===e.type})},nodesInScopeOf:function(e){return De(e,{root:e,result:[]},function(e,t,r){return r.result.push(t),t===r.root||"Program"!==t.type&&"FunctionDeclaration"!==t.type&&"FunctionExpression"!==t.type?(e(),r):r}).result},declarationsOfScope:O,_declaredVarNames:B,_findJsLintGlobalDeclarations:R,topLevelDeclsAndRefs:L,topLevelFuncDecls:P,findGlobalVarRefs:function(e,t){var r=L(e,t),n=r.declaredNames.concat(Te);return r.refs.filter(function(e){return-1===n.indexOf(e.name)})},findNodesIncludingLines:function(e,r,n,i){if(!r&&!e)throw new Error("Need at least ast or code");return r=r||o(e),e=e&&e.loc?e:d(r,{locations:!0}),De(e,[],function(e,r,i){return n.every(function(e){return t.num.between(e,r.loc.start.line,r.loc.end.line)})&&(t.arr.pushIfNotIncluded(i,r),e()),i})},findReferencesAndDeclsInScope:function(e,r){function n(e){return e.params.concat(t.arr.pluck(e.funcDecls,"id")).concat(t.arr.pluck(e.classDecls,"id")).concat(Pe.varDeclIds(e))}return"this"===r?e.thisRefs:t.arr.flatten(t.tree.map(e,function(e){return e.refs.concat(n(e)).filter(function(e){return e.name===r})},function(e){return e.subScopes.filter(function(e){return n(e).every(function(e){return e.name!==r})})}))},findDeclarationClosestToIndex:function(e,r,n){var i=null;return t.arr.detect(F(e,n).reverse(),function(e){var n=O(e,!0),o=t.arr.pluck(n,"name").indexOf(r);return-1!==o&&(i=n[o],!0)}),i},nodesAt:N,statementOf:M,resolveReferences:I,refWithDeclAt:function(e,t){var r=!0,n=!1,i=void 0;try{for(var o,a=t.resolvedRefMap.values()[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value,u=s.ref,c=u.start,l=u.end;if(c<=e&&e<=l)return s}}catch(e){n=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}},imports:function(e){for(var t=[],r=e.node.body||[],n=0;n<r.length;n++){var i=r[n];if("ImportDeclaration"===i.type)if(0!==i.specifiers.length){var o=i.source?i.source.value:"unknown module";t.push.apply(t,he(i.specifiers.map(function(e){var t;return t="ImportNamespaceSpecifier"===e.type?"*":"ImportDefaultSpecifier"===e.type?"default":"ImportSpecifier"===e.type?e.imported.name:null,{local:e.local?e.local.name:null,imported:t,fromModule:o,node:i}})))}else t.push({local:null,imported:null,fromModule:i.source.value,node:i})}return t},exports:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&I(e);var r=e.exportDecls.reduce(function(t,r){var n=M(e.node,r);if(!n)return t;var i=n.source?n.source.value:null;if("ExportAllDeclaration"===n.type)return t.concat([{local:null,exported:"*",imported:"*",fromModule:i,node:r,type:"all"}]);if("ExportDefaultDeclaration"===n.type){if(Pe.isDeclaration(n.declaration))return t.concat({local:n.declaration.id.name,exported:"default",type:"FunctionDeclaration"===n.declaration.type?"function":"ClassDeclaration"===n.declaration.type?"class":null,fromModule:null,node:r,decl:n.declaration,declId:n.declaration.id});if("Identifier"===n.declaration.type){var o=e.resolvedRefMap.get(n.declaration)||{},a=o.decl,s=o.declId;return t.concat([{local:n.declaration.name,exported:"default",fromModule:null,node:r,type:"id",decl:a,declId:s}])}return t.concat([{local:null,exported:"default",fromModule:null,node:r,type:"expr",decl:n.declaration,declId:n.declaration}])}return n.specifiers&&n.specifiers.length?t.concat(n.specifiers.map(function(t){var n,o;if(i)n=r,o=t.exported;else if(t.local){var a=e.resolvedRefMap.get(t.local);n=a?a.decl:null,o=a?a.declId:null}return{local:!i&&t.local?t.local.name:null,exported:t.exported?t.exported.name:null,imported:i&&t.local?t.local.name:null,fromModule:i||null,type:"id",node:r,decl:n,declId:o}})):n.declaration&&n.declaration.declarations?t.concat(n.declaration.declarations.map(function(e){return{local:e.id.name,exported:e.id.name,type:n.declaration.kind,fromModule:null,node:r,decl:e,declId:e.id}})):n.declaration?t.concat({local:n.declaration.id.name,exported:n.declaration.id.name,type:"FunctionDeclaration"===n.declaration.type?"function":"ClassDeclaration"===n.declaration.type?"class":null,fromModule:null,node:r,decl:n.declaration,declId:n.declaration.id}):t},[]);return t.arr.uniqBy(r,function(e,t){return e.local==t.local&&e.exported==t.exported&&e.fromModule==t.fromModule})}}),Ne=function(e){function t(){return ae(this,t),fe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return le(t,e),se(t,[{key:"accept",value:function(e,r,n){return"ObjectExpression"===e.type&&(e=this.transformSpreadElement(e)),ce(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,r,n)}},{key:"transformSpreadElement",value:function(e){var t=[],r=[t];return e.properties.forEach(function(e){"SpreadElement"!==e.type?t.push(e):(r.push(e),t=[],r.push(t))}),1===r.length?e:(t.length||r.pop(),_.apply(void 0,[x("Object","assign")].concat(he(r.map(function(e){return"SpreadElement"===e.type?e.argument:{properties:e,type:"ObjectExpression"}})))))}}]),t}(i),Me=/^\s*(\{|function\s*\()/,qe=Object.freeze({replaceNode:z,replaceNodes:V,replace:function(e,t,r,n){var i="object"===(void 0===e?"undefined":oe(e))?e:null;return z(t,r,"string"==typeof e?e:i.source||q(i))},_compareNodesForReplacement:U,oneDeclaratorPerVarDecl:function(e){var r="object"===(void 0===e?"undefined":oe(e))?e:d(e),n="string"==typeof e?e:r.source||q(r);return V(function e(r){return t.arr.flatten(r.varDecls.concat(r.subScopes.map(e)))}(C(r)).map(function(e){return{target:e,replacementFunc:function(e,t,r){return r&&(e=d(t).body[0]),e.declarations.map(function(e){return{type:"VariableDeclaration",kind:"var",declarations:[e]}})}}}),n)},oneDeclaratorForVarsInDestructoring:function(e){var r="object"===(void 0===e?"undefined":oe(e))?e:d(e),n="string"==typeof e?e:r.source||q(r);return V(function e(r){return t.arr.flatten(r.varDecls.concat(r.subScopes.map(e)))}(C(r)).map(function(e){return{target:e,replacementFunc:function(e,r,n){return n&&(e=d(r).body[0]),t.arr.flatmap(e.declarations,function(e){var r={type:"Identifier",name:"__temp"},n={type:"VariableDeclaration",kind:"var",declarations:[{type:"VariableDeclarator",id:r,init:e.init}]},i=Pe.objPropertiesAsList(e.id,[],!1).map(function(e){return e.key}).map(function(e){return w(t.arr.last(e),k.apply(void 0,[r.name].concat(he(e))),"var")});return[n].concat(i)})}}}),n)},returnLastStatement:G,wrapInFunction:function(e,t){var r=G(e,t=t||{});return t.asAST?S(b.apply(void 0,[{id:t.id||void 0},[]].concat(he(r.body)))):"function"+(t.id?" "+t.id:"")+"() {\n"+r+"\n}"},wrapInStartEndCall:function(e,r){"string"==typeof e&&(e=d(e)),r=r||{};var n="Program"===e.type,i=r.startFuncNode||m("__start_execution"),o=r.endFuncNode||m("__end_execution"),a=P(e),s=e.body,u=[];a.forEach(function(r){var n=r.node,i=r.path;t.Path(i).set(e,y(n.id)),u.push(n)}),s.unshift(y(_(i)));var c=t.arr.last(s);return"ExpressionStatement"===c.type?(s.pop(),s.push(y(_(o,m("null"),c.expression)))):"VariableDeclaration"===c.type&&"Identifier"===t.arr.last(c.declarations).id.type?s.push(y(_(o,m("null"),t.arr.last(c.declarations).id))):s.push(y(_(o,m("null"),m("undefined")))),u.push(A.apply(void 0,["err",[y(_(o,m("err"),m("undefined")))]].concat(he(s)))),n?S.apply(void 0,u):E.apply(void 0,u)},transformSingleExpression:function(e){if(!Me.test(e)||e.split("\n").length>30)return e;try{var t=p(e);1===t.body.length&&("FunctionDeclaration"===t.body[0].type||"BlockStatement"===t.body[0].type&&"LabeledStatement"===t.body[0].body[0].type)&&(e="("+e.replace(/;\s*$/,"")+")")}catch(e){"undefined"!=typeof $world?$world.logError(e):console.error("Eval preprocess error: %s",e.stack||e)}return e},objectSpreadTransform:function(e){return(new Ne).accept(e,{},[])}}),We=Object.freeze({getCommentPrecedingNode:function(e,r){var n=M(e,r,{asPath:!0}).slice(0,-2),i=t.Path(n).get(e);return i.comments&&i.comments.length?t.chain(H(e)).reversed().detect(function(e){return e.followingNode===r}).value():null},extractComments:H}),$e=Object.freeze({findDecls:J}),Ue=/^(?!(?:do|if|in|for|let|new|try|var|case|default|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc][$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc0-9\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u0669\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u06f0-\u06f9\u0711\u0730-\u074a\u07a6-\u07b0\u07c0-\u07c9\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09cb-\u09cd\u09d7\u09e2\u09e3\u09e6-\u09ef\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d3e-\u0d44\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0d62\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0e50-\u0e59\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102b-\u103e\u1040-\u1049\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4-\u17d3\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u18a9\u1920-\u192b\u1930-\u193b\u1946-\u194f\u19b0-\u19c0\u19c8\u19c9\u19d0-\u19d9\u1a17-\u1a1b\u1a55-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b00-\u1b04\u1b34-\u1b44\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1b82\u1ba1-\u1bad\u1bb0-\u1bb9\u1be6-\u1bf3\u1c24-\u1c37\u1c40-\u1c49\u1c50-\u1c59\u1cd0-\u1cd2\u1cd4-\u1ce8\u1ced\u1cf2-\u1cf4\u1dc0-\u1de6\u1dfc-\u1dff\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua620-\ua629\ua66f\ua674-\ua67d\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua823-\ua827\ua880\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f1\ua900-\ua909\ua926-\ua92d\ua947-\ua953\ua980-\ua983\ua9b3-\ua9c0\ua9d0-\ua9d9\uaa29-\uaa36\uaa43\uaa4c\uaa4d\uaa50-\uaa59\uaa7b\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaeb-\uaaef\uaaf5\uaaf6\uabe3-\uabea\uabec\uabed\uabf0-\uabf9\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f]*$/,ze=d("").constructor;Object.defineProperty(ze.prototype,"__serialize__",{configurable:!0,value:function(){return{__expr__:"("+JSON.stringify(this)+")"}}}),e.escodegen=ge,e.acorn=acorn,e.query=Le,e.transform=qe,e.comments=We,e.categorizer=$e,e.stringify=o,e.nodes=Re,e.isValidIdentifier=function(e){return Ue.test(e)},e.BaseVisitor=i,e.withMozillaAstDo=De,e.printAst=Ce,e.compareAst=Fe,e.pathToNode=Oe,e.rematchAstWithSource=je,e.ReplaceManyVisitor=Ee,e.ReplaceVisitor=Se,e.parse=d,e.parseFunction=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=d("("+e+")",t);return we.run(r,function(r,n,i){r._positionFixed||(r._positionFixed=!0,(r.start||0===r.start)&&(r.start+=-1,r.end+=-1),t.addSource&&!r.source&&(r.source=e.slice(r.start,r.end)))}),r.body[0].expression},e.fuzzyParse=p}(this.lively.ast=this.lively.ast||{},lively.lang,e.escodegen,acorn)}.call(e),"undefined"!=typeof module&&module.exports&&(module.exports=e.lively.ast),t&&(e.define=t)}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;void 0===lively.lang&&(e.livey.lang={})}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(e,t,r){"use strict";function n(e){return e.hasOwnProperty(T)}function i(e){if(n(e)){var t=s(e),r=t.properties,i=t.propertySettings;e[I]={properties:r,propertySettings:i},r&&"object"===(void 0===r?"undefined":S(r))?o(e,i,r):console.warn("Class "+e.name+" indicates it has managed properties but its properties accessor ("+T+") does not return a valid property descriptor map")}}function o(e,t,r){a(e);var n=t.valueStoreProperty,i=t.defaultGetter,o=t.defaultSetter,s=e.prototype;Object.keys(r).forEach(function(e){var t=r[e];if(!(s.hasOwnProperty(e)&&s.__lookupGetter__(e))){var a=t.get||"function"==typeof i&&function(){return i.call(this,e)}||function(){return this[n][e]};s.__defineGetter__(e,a)}if(!(s.hasOwnProperty(e)&&s.__lookupSetter__(e))&&(t.hasOwnProperty("set")||!t.readOnly)){var u=t.set||"function"==typeof o&&function(t){o.call(this,e,t)}||function(t){this[n][e]=t};s.__defineSetter__(e,u)}})}function a(e){Object.defineProperty(e.prototype,"propertiesAndPropertySettings",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.constructor;return e[I]||s(e)}}),Object.defineProperty(e.prototype,"initializeProperties",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.propertiesAndPropertySettings(),r=t.properties;return u(this,t.propertySettings,r,e),this}})}function s(e){for(var r=F({},L),n={},i=t.obj.valuesInPropertyHierarchy(e,"propertySettings"),o=t.obj.valuesInPropertyHierarchy(e,"properties"),a=0;a<i.length;a++){var s=i[a];s&&"object"===(void 0===s?"undefined":S(s))&&Object.assign(r,s)}for(a=0;a<o.length;a++){var u=o[a];if("object"===(void 0===u?"undefined":S(u)))for(var c in u)n.hasOwnProperty(c)?Object.assign(n[c],u[c]):n[c]=u[c];else console.error("[initializeProperties] "+e+" encountered property declaration that is not a JS object: "+u)}return{properties:n,propertySettings:r}}function u(e,r,n,i){var o=r.valueStoreProperty,a=t.obj.sortKeysWithBeforeAndAfterConstraints(n),s=[],u={};e.hasOwnProperty(o)||(e[o]={});for(m=0;m<a.length;m++){var c=a[m],l=n[c],f=l.derived,p=!!l.foldable,d=l.hasOwnProperty("defaultValue")?l.defaultValue:void 0;Array.isArray(d)&&(d=d.slice()),f||p||(e[o][c]=d);var h=void 0;l.hasOwnProperty("initialize")?(h=u[c]={initialize:d},s.push(c)):f&&void 0!==d?(h=u[c]={derived:d},s.push(c)):p&&void 0!==d&&(h=u[c]={folded:d},s.push(c)),i&&c in i&&(l.readOnly?console.warn("Trying to initialize read-only property "+c+" in "+e+", skipping setting value"):(h||(h=u[c]={},s.push(c)),h.value=i[c]))}for(var m=0;m<s.length;m++){var v=s[m],y=u[v],g=y.hasOwnProperty("value");if(y.hasOwnProperty("initialize")){var b=g?y.value:y.initialize;n[v].initialize.call(e,b),g&&(e[v]=y.value)}else y.hasOwnProperty("derived")?e[v]=g?y.value:y.derived:y.hasOwnProperty("folded")?e[v]=g?y.value:y.folded:g&&(e[v]=y.value)}}function c(e,t){var r=t?"function"==typeof t?t:t.value?t.value:Object:Object,n=e&&e[q];return n&&n===r||(d(r),e[q]=r,H(e.prototype,r.prototype),r!==Object&&H(e,r)),r}function l(e,t,r){if(r=Object.assign(r,G),r.value.displayName=r.key,r.needsDeclaringClass){var n=r.value.originalFunction||r.value;r.value=Object.assign(function(){return n.call.apply(n,[this,t].concat(Array.prototype.slice.call(arguments)))},{originalFunction:n,toString:function(){return n.toString()},displayName:r.key})}Object.defineProperty(e,r.key,r)}function f(e,t){t=Object.assign(t,V),Object.defineProperty(e,t.key,t)}function p(e,t,r){r&&r.forEach(function(t){t.value?l(e,e,t):f(e,t)}),t&&t.forEach(function(t){t.value?l(e.prototype,e,t):f(e.prototype,t)}),e.prototype[N]?Object.getOwnPropertySymbols(e.prototype).includes(N)&&e.prototype[N].isDefaultInitializer&&e[q].prototype[N]&&delete e.prototype[N]:(Object.defineProperty(e.prototype,N,{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),e.prototype[N].isDefaultInitializer=!0,e.prototype[N].displayName="lively-initialize");for(var n=t.map(function(e){return e.key}).concat(["constructor","arguments","caller"]),i=Object.getOwnPropertyNames(e.prototype),o=0;o<i.length;o++){var a=i[o];n.includes(a)||delete e.prototype[a]}for(var s=r.map(function(e){return e.key}).concat(["length","name","prototype","arguments","caller"]),u=Object.getOwnPropertyNames(e),c=0;c<u.length;c++){var p=u[c];s.includes(p)||delete e[p]}}function d(e){e===Object||e.prototype[N]||(Object.defineProperty(e.prototype,N,{enumerable:!1,configurable:!0,writable:!0,value:function(){e.apply(this,arguments)}}),e.prototype[N].displayName="lively-initialize-stub")}function h(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments[5],s=arguments[6],u=e.name,l=u&&o.hasOwnProperty(u)&&o[u],f=l&&l[q];l&&"function"==typeof l&&f||(l=e);c(l,t);if(p(l,r,n),l[$]=s,a){var d=a.package(),h=l[W],m=Date.now();l[W]={package:d?{name:d.name,version:d.version}:{},pathInPackage:d?a.pathInPackage():a.id,lastChange:h&&h.lastChange&&m<=h.lastChange?h.lastChange+1:m,lastSuperclassChange:0},t&&t.referencedAs&&(l[U]&&a.unsubscribeFromToplevelDefinitionChanges(l[U]),l[U]=a.subscribeToToplevelDefinitionChanges(function(e,o){if(e===t.referencedAs){var a=o&&o[W],s=l[W];if(a){if(a.lastChange===s.lastSuperclassChange)return;s.lastSuperclassChange=a.lastChange}c(l,o),p(l,r,n),i(l)}}))}return l.toString=function(){var e=String(this.prototype[N]).match(z),t=this.name,r=this[q];return"class "+t+" "+(r?"extends "+r.name:"")+" {\n  constructor"+(e?e[0]:"()")+" { /*...*/ }\n}"},i(l),l}function m(e){return"ArrowFunctionExpression"===e.type||"FunctionExpression"===e.type||"FunctionDeclaration"===e.type}function v(e){return e.replace(ue,"_").replace(ce,"_")}function y(e){return ne({id:e?Q(e):null},["__first_arg__"],ae(oe(Q("__first_arg__"),"&&",Y("__first_arg__",Z(Y("Symbol","for"),ee("lively-instance-restorer")),!0)),se(),se(X(Z(Y(Y("this",Z(Y("Symbol","for"),ee("lively-instance-initialize")),!0),"apply"),Q("this"),Q("arguments"))))))}function g(e,t,n,i){console.assert("Super"===e.type);var o=t.currentMethod;o||console.warn("[lively.classes] Trying to transform es6 class but got super call outside a method! "+r.stringify(e)+" in "+n.join("."));var a=n.slice(-2),s=R(a,2),u=s[0],c=s[1];return"callee"===u&&"object"===c||"callee"===c?e:o&&"static"===o[fe]?Z(Y("Object","getPrototypeOf"),Q(pe)):Z(Y("Object","getPrototypeOf"),Y(Q(pe),"prototype"))}function b(e,t,r,n){return console.assert("CallExpression"===e.type),console.assert("Super"===e.callee.object.type),Z.apply(void 0,[Y(Z(Y(n.functionNode,"_get"),g(e.callee.object,t,r.concat(["callee","object"]),n),ee(e.callee.property.value||e.callee.property.name),Q("this")),"call"),Q("this")].concat(P(e.arguments)))}function _(e,t,r,n){return console.assert("CallExpression"===e.type),console.assert("Super"===e.callee.type),Z.apply(void 0,[Y(Z(Y(n.functionNode,"_get"),g(e.callee,t,r.concat(["callee"]),n),Z(Y("Symbol","for"),ee("lively-instance-initialize")),Q("this")),"call"),Q("this")].concat(P(e.arguments)))}function w(e,t,r,n){return console.assert("MemberExpression"===e.type),console.assert("Super"===e.object.type),Z(Y(n.functionNode,"_get"),g(e.object,t,r.concat(["object"]),n),ee(e.property.value||e.property.name),Q("this"))}function x(e,t,r,n){return console.assert("AssignmentExpression"===e.type),console.assert("Super"===e.left.object.type),Z(Y(n.functionNode,"_set"),g(e.left.object,t,r.concat(["left","object"]),n),ee(e.left.property.value||e.left.property.name),e.right,Q("this"))}function k(e,t,n,i){console.assert("ClassDeclaration"===e.type||"ClassExpression"===e.type);var o=e.body.body,a=e.superClass,s=e.id,u=e.type,c=e.start,l=e.end,f=Q("undefined"),p=Q("undefined"),d=s?s.name:"anonymous_class",h=i.evalId,m=i.sourceAccessorName,g=e["x-lively-object-meta"]||{start:c,end:l};if(o.length){var b=o.reduce(function(e,t){var r,n=t.key,i=t.kind,o=t.value,a=t.static;if("Literal"!==n.type&&"Identifier"!==n.type&&console.warn("Unexpected key in classToFunctionTransform! "+JSON.stringify(n)),"method"===i){var s=Q(d+"_"+v(n.name||n.value)+"_"),u=["key",ee(n.name||n.value),"value",F({},o,C({id:s},fe,a?"static":"proto"))];r=te(u)}else if("get"===i||"set"===i)r=te(["key",ee(n.name||n.value),i,Object.assign({},o,C({id:Q(i)},fe,a?"static":"proto"))]);else if("constructor"===i){var c=["key",Z(Y("Symbol","for"),ee("lively-instance-initialize")),"value",F({},o,C({id:Q(d+"_initialize_")},fe,"proto"))];r=te(c)}else console.warn("[lively.classes] classToFunctionTransform encountered unknown class property with kind "+i+", ignoring it, "+JSON.stringify(t));return(a?e.clazz:e.inst).push(r),e},{inst:[],clazz:[]}),_=b.inst,w=b.clazz;_.length&&(f={type:"ArrayExpression",elements:_}),w.length&&(p={type:"ArrayExpression",elements:w})}var x,k,E=i.scope;if(a&&i.currentModuleAccessor)if(i.classHolder===a.object)k=a,x=a.property.name;else{var S=E&&E.resolvedRefMap&&E.resolvedRefMap.get(a);S&&S.decl&&E.decls&&E.decls.find(function(e){return R(e,1)[0]===S.decl})&&(k=a,x=a.name)}var A=k?te(["referencedAs",ee(x),"value",k]):a||Q("undefined"),D=s&&"ClassDeclaration"===u,O=["start",ee(g.start),"end",ee(g.end)];void 0!==h&&O.push("evalId",ee(h)),m&&O.push("moduleSource",r.nodes.id(m));var j=te(O),B=Z(ne({},["superclass"],re(de,t.classHolder),re(pe,D?{type:"ConditionalExpression",test:oe(Z(Y(de,"hasOwnProperty"),ee(s.name)),"&&",oe({argument:Y(de,s),operator:"typeof",prefix:!0,type:"UnaryExpression"},"===",ee("function"))),consequent:Y(de,s),alternate:K(Y(de,s),y(s.name))}:y(s?s.name:null)),ie(Z(i.functionNode,Q(pe),Q("superclass"),f,p,Q(de),i.currentModuleAccessor||Q("undefined"),j))),A);if("ClassExpression"===u)return B;var P=B;return i.declarationWrapper&&t.classHolder===i.classHolder&&(P=Z(i.declarationWrapper,ee(s.name),ee("class"),P,i.classHolder,j)),P=re(s,P,"var"),P[le]=!0,P}function E(e,t,r,n){return e.declaration&&e.declaration[le]?[e.declaration,{declaration:e.declaration.declarations[0].id,type:"ExportDefaultDeclaration"}]:e}var S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},D=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),C=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},O=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},j=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},B=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},R=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),P=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},T="properties",I=Symbol.for("lively.classes-properties-and-settings"),L={defaultSetter:null,defaultGetter:null,valueStoreProperty:"_state"},N=Symbol.for("lively-instance-initialize"),M=Symbol.for("lively-instance-restorer"),q=Symbol.for("lively-instance-superclass"),W=Symbol.for("lively-module-meta"),$=Symbol.for("lively-object-meta"),U=Symbol.for("lively-klass-changes-subscriber"),z=/\([^\\)]*\)/,V={enumerable:!1,configurable:!0},G={enumerable:!1,configurable:!0,writable:!0},H="function"==typeof Object.setPrototypeOf?function(e,t){return Object.setPrototypeOf(e,t)}:function(e,t){return e.__proto__=t};h._get=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0===a?void 0:a.call(n)},h._set=function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var s=o.set;void 0!==s&&s.call(i,n)}return n};var J=Object.freeze({initializeSymbol:N,instanceRestorerSymbol:M,superclassSymbol:q,moduleMetaSymbol:W,objMetaSymbol:$,moduleSubscribeToToplevelChangesSym:U,setPrototypeOf:H,adoptObject:function(e,t){t!==e.constructor&&(e.constructor=t,H(e,t.prototype))},setSuperclass:c,initializeClass:h}),K=r.nodes.assign,Y=r.nodes.member,Q=r.nodes.id,X=r.nodes.exprStmt,Z=r.nodes.funcCall,ee=r.nodes.literal,te=r.nodes.objectLiteral,re=r.nodes.varDecl,ne=r.nodes.funcExpr,ie=r.nodes.returnStmt,oe=r.nodes.binaryExpr,ae=r.nodes.ifStmt,se=r.nodes.block,ue=/^[^_a-z]/i,ce=/[^_a-z0-9]/gi,le=Symbol(),fe=Symbol(),pe="__lively_class__",de="__lively_classholder__",he=function(e){function t(){return A(this,t),B(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return j(t,e),D(t,[{key:"accept",value:function(e,r,n){return m(e)&&(r=F({},r,{classHolder:te([]),currentMethod:e[fe]?e:r.currentMethod})),"ClassExpression"!==e.type&&"ClassDeclaration"!==e.type||(e=k(e,r,n,r.options)),"Super"===e.type&&(e=g(e,r,n,r.options)),"MemberExpression"===e.type&&e.object&&"Super"===e.object.type&&(e=w(e,r,n,r.options)),"AssignmentExpression"===e.type&&"MemberExpression"===e.left.type&&"Super"===e.left.object.type&&(e=x(e,r,n,r.options)),"CallExpression"===e.type&&"Super"===e.callee.type&&(e=_(e,r,n,r.options)),"CallExpression"===e.type&&e.callee.object&&"Super"===e.callee.object.type&&(e=b(e,r,n,r.options)),e=O(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,r,n),"ExportDefaultDeclaration"===e.type?E(e,r,n,r.options):e}}],[{key:"run",value:function(e,t){var r=new this,n=t.classHolder||te([]);return r.accept(e,{options:t,classHolder:n},[])}}]),t}(r.BaseVisitor);e.runtime=J,e.classToFunctionTransform=function(e,t){var n="string"==typeof e?r.parse(e):e;return t.scope=r.query.resolveReferences(r.query.scopes(n)),he.run(n,t)}}(this.lively.classes=this.lively.classes||{},lively.lang,lively.ast),"undefined"!=typeof module&&module.exports&&(module.exports=e.lively.classes)}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;void 0===lively.lang&&(e.livey.lang={})}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(e,t,r,n){"use strict";function i(e,t){var r=z(e),i=r.refs.filter(function(e){return l(e,r,t)}),o=[],a=n.ReplaceVisitor.run(e,function(e,r){if("Property"===e.type&&i.includes(e.key)&&e.shorthand)return T(N(e.key.name),e.value);if("ExportNamedDeclaration"===e.type){var n=e.declaration,a=e.specifiers;return n&&(n.id?o.push(n.id):n.declarations&&o.push.apply(o,R(n.declarations.map(function(e){return e.id})))),a&&a.forEach(function(e){var t=e.local;return o.push(t)}),e}return"AssignmentExpression"===e.type&&i.includes(e.left)&&t.declarationWrapper?B({},e,{right:j(t.declarationWrapper,null,M(e.left.name),M("assignment"),e.right,t.captureObj,t)}):e});return n.ReplaceVisitor.run(a,function(e,r,n){return i.includes(e)&&!o.includes(e)?P(t.captureObj,e):e})}function o(e,t){var r=z(e);return n.ReplaceManyVisitor.run(e,function(e){if(!r.varDecls.includes(e)||e.declarations.every(function(e){return!c(e,t)}))return e;for(var n=[],i=0;i<e.declarations.length;i++){var o=e.declarations[i];if(c(o,t)){var s=o.init||{operator:"||",type:"LogicalExpression",left:{computed:!1,object:t.captureObj,property:o.id,type:"MemberExpression"},right:{name:"undefined",type:"Identifier"}},u=t.declarationWrapper&&o.id.name?j(t.declarationWrapper,o,M(o.id.name),M(e.kind),s,t.captureObj,t):s;if(o.id.type.includes("Pattern")){var l=a(r.declaredNames,"destructured_1"),f={type:"Identifier",name:l},p={parent:f,declaredNames:r.declaredNames},d=_(o.id,p).map(function(r){return r[G]&&r[G].capture?E(t.captureObj,r.declarations[0].id,t.declarationWrapper?j(t.declarationWrapper,null,M(r.declarations[0].id.name),M(e.kind),r.declarations[0].init,t.captureObj,t):r.declarations[0].init,!1):r});r.declaredNames.push(l),n.push.apply(n,R([I(f,u,e.kind)].concat(d)))}else n.push(E(t.captureObj,o.id,u,!1)),t.keepTopLevelVarDecls&&n.push(I(o.id,P(t.captureObj,o.id)))}else n.push({type:"VariableDeclaration",kind:e.kind||"var",declarations:[o]})}return n})}function a(e,t){for(var r=t,n=1;e.indexOf(r)>-1;){if(n>1e3)throw new Error("Endless loop searching for unique variable "+r);r=r.replace(/_[0-9]+$|$/,"_"+ ++n)}return r}function s(e,r){for(var n=z(e),i=[],o=0;o<n.scope.varDecls.length;o++){var a=n.scope.varDecls[o],s=t.Path(n.scope.varDeclPaths[o]).slice(0,-1).get(e);"ForStatement"!==s.type&&"ForInStatement"!==s.type&&"ForOfStatement"!==s.type&&"ExportNamedDeclaration"!==s.type||i.push.apply(i,R(a.declarations))}return n.scope.catches.map(function(e){return e.name}).concat(i.map(function(e){return e.id.name}))}function u(e,r){for(var n=z(e),i=[],o=0;o<n.scope.varDecls.length;o++){var a=n.scope.varDecls[o],s=t.Path(n.scope.varDeclPaths[o]).slice(0,-1).get(e);"ForStatement"!==s.type&&"ForInStatement"!==s.type&&"ForOfStatement"!==s.type||i.push.apply(i,R(a.declarations))}return n.scope.catches.map(function(e){return e.name}).concat(V.declIds(i.map(function(e){return e.id})).map(function(e){return e.name}))}function c(e,t){return-1===t.excludeDecls.indexOf(e.id.name)&&(!t.includeDecls||t.includeDecls.indexOf(e.id.name)>-1)}function l(e,t,r){if(t.scope.importSpecifiers.includes(e))return!1;for(var n=0;n<t.scope.exportDecls.length;n++){var i=t.scope.exportDecls[n];if(i.declarations&&i.declarations.includes(e))return!1;if(i.declaration===e)return!1}return!r.excludeRefs.includes(e.name)&&!(r.includeRefs&&!r.includeRefs.includes(e.name))}function f(e,t){if(t.classToFunction)return r.classToFunctionTransform(e,t.classToFunction);var n=z(e);if(!n.classDecls.length)return e;for(var i=e.body.length-1;i>=0;i--){var o=e.body[i];n.classDecls.includes(o)&&e.body.splice(i+1,0,E(t.captureObj,o.id,o.id,!1))}return e}function p(e,t){for(var r=e.body,n=e.body=[],i=0;i<r.length;i++){var o=r[i];if("ExportNamedDeclaration"!==o.type||!o.declaration||"VariableDeclaration"!==o.declaration.type||o.declaration.declarations.length<=1)n.push(o);else for(var a=o.declaration.declarations,s=0;s<a.length;s++)n.push({type:"ExportNamedDeclaration",specifiers:[],declaration:I(a[s].id,a[s].init,o.declaration.kind)})}return e}function d(e,t){for(var r=[],n=0;n<e.body.length;n++){var i=e.body[n];r.push(i),"ExportNamedDeclaration"!==i.type&&"ExportDefaultDeclaration"!==i.type||!i.declaration||(i.declaration.declarations?r.push.apply(r,R(i.declaration.declarations.map(function(e){var r=e.id;return t.declarationWrapper&&(e.init.callee&&e.init.callee.name===t.declarationWrapper.name||(r=j(t.declarationWrapper,e,M(e.id.name),M("assignment"),e.id,t.captureObj,t))),E(t.captureObj,e.id,r,!1)}))):"FunctionDeclaration"===i.declaration.type||"ClassDeclaration"===i.declaration.type&&r.push(E(t.captureObj,i.declaration.id,i.declaration.id,!1)))}return e.body=r,e}function h(e,t){return e.body=e.body.reduce(function(e,r){return e.concat("ImportDeclaration"===r.type&&r.specifiers.length?[r].concat(r.specifiers.map(function(e){return E(t.captureObj,e.local,e.local,!1)})):[r])},[]),e}function m(e,r){for(var n=z(e),i=[],o=0;o<e.body.length;o++){var a=e.body[o];"ExportDefaultDeclaration"===a.type&&a.declaration&&-1===a.declaration.type.indexOf("Declaration")?i=i.concat([k(e,{type:"VariableDeclarator",id:a.declaration,init:P(r.captureObj,a.declaration)}),a]):"ExportNamedDeclaration"!==a.type||!a.specifiers.length||a.source?i.push(a):i=i.concat(a.specifiers.map(function(i){return t.arr.include(n.declaredNames,i.local.name)?null:k(e,{type:"VariableDeclarator",id:i.local,init:P(r.captureObj,i.local)})}).filter(Boolean)).concat(a)}return e.body=i,e}function v(e,t){for(var r=[],n=0;n<e.body.length;n++){var i=e.body[n];"ExportDefaultDeclaration"===i.type&&"FunctionDeclaration"===i.declaration.type&&i.declaration.id&&i.declaration.async&&(r.push(i.declaration),i.declaration={type:"Identifier",name:i.declaration.id.name}),r.push(i)}return e.body=r,e}function y(e,t){return e.body=e.body.reduce(function(r,n){var i;if("ExportNamedDeclaration"===n.type)if(n.source){a=s=n.source;i=n.specifiers.map(function(e){return{type:"ExpressionStatement",expression:S({type:"Literal",value:e.exported.name},{type:"Literal",value:e.local.name},s,t.moduleExportFunc,t.moduleImportFunc)}})}else if(n.declaration){var o=n.declaration.declarations;i=o?o.map(function(e){return t.excludeDecls.push(e.id),I(e.id,E(t.captureObj,e.id,t.declarationWrapper?j(t.declarationWrapper,null,M(e.id.name),M(n.declaration.kind),e,t.captureObj,t):e.init,!1),n.declaration.kind)}).concat(o.map(function(e){return O(t.moduleExportFunc,e.id.name,e.id)})):[n.declaration].concat(O(t.moduleExportFunc,n.declaration.id.name,n.declaration.id))}else i=n.specifiers.map(function(e){return O(t.moduleExportFunc,e.exported.name,c({id:e.local},t)?P(t.captureObj,e.local):e.local)});else if("ExportDefaultDeclaration"===n.type)i=n.declaration&&n.declaration.id?[n.declaration].concat(O(t.moduleExportFunc,"default",n.declaration.id)):[O(t.moduleExportFunc,"default",n.declaration)];else if("ExportAllDeclaration"===n.type){var a={name:t.es6ExportFuncId+"__iterator__",type:"Identifier"},s=n.source;i=[{type:"ForInStatement",body:{type:"ExpressionStatement",expression:S(a,a,s,t.moduleExportFunc,t.moduleImportFunc)},left:{type:"VariableDeclaration",kind:"var",declarations:[{type:"VariableDeclarator",id:a,init:null}]},right:D(null,s,t.moduleImportFunc)}],t.excludeRefs.push(a.name),t.excludeDecls.push(a.name)}else i="ImportDeclaration"===n.type?n.specifiers.length?n.specifiers.map(function(r){var i=r.local,o="ImportSpecifier"===r.type&&r.imported.name||"ImportDefaultSpecifier"===r.type&&"default"||null;return A(e,i,o||null,n.source,t.moduleImportFunc)}):C(null,n.source,t.moduleImportFunc):[n];return r.concat(i)},[]),e}function g(e,r){var n=z(e).scope,i=n.funcDecls;if(!i.length)return e;for(var o=[],a=i.length;a--;){var s=i[a];if(c(s,r)){var u=n.funcDeclPaths[a].slice(0,-1),l=t.Path(u).get(n.node),f={type:"Identifier",name:s.id.name},p=r.declarationWrapper?j(r.declarationWrapper,s,M(f.name),M("function"),f,r.captureObj,r):f,d=B({},s);if(Array.isArray(l))l.splice(l.indexOf(s),1,q(s.id));else if("ExportNamedDeclaration"===l.type){var h=n.node.body.indexOf(l);h>-1&&n.node.body.splice(h,1,{type:"ExportNamedDeclaration",specifiers:[{type:"ExportSpecifier",exported:s.id,local:s.id}]})}else"ExportDefaultDeclaration"===l.type&&(l.declaration=s.id);o.unshift(E(r.captureObj,f,p,!1)),o.unshift(d)}}return e.body=o.concat(e.body),e}function b(e,r){var n=z(e);return t.chain(n.scope.varDecls).pluck("declarations").flatten().value().concat(n.scope.funcDecls).reduce(function(e,t){return e[t.id.name]||(e[t.id.name]=[]),e[t.id.name].push({type:t.type,start:t.start,end:t.end}),e},{})}function _(e,t){return"ArrayPattern"===e.type?w(e,t):"ObjectPattern"===e.type?x(e,t):[]}function w(e,t){for(var r=t.declaredNames,n=G,i=[],o=0;o<e.elements.length;o++){var s=e.elements[o];if("Identifier"===s.type)(u=I(s,P(t.parent,N(o),!0)))[n]={capture:!0},i.push(u);else if("RestElement"===s.type)(u=I(s.argument,{type:"CallExpression",arguments:[{type:"Literal",value:o}],callee:P(t.parent,N("slice"),!1)}))[n]={capture:!0},i.push(u);else if("AssignmentPattern"==s.type){var u=I(s.left,W($(P(t.parent,N(o),!0),"===",N("undefined")),s.right,P(t.parent,N(o),!0)));u[n]={capture:!0},i.push(u)}else{var c=N(a(r,t.parent.name+"$"+o)),l=I(c,P(t.parent,o));r.push(c.name),i.push(l),i.push.apply(i,R(_(s,{parent:c,declaredNames:r})))}}return i}function x(e,t){for(var r=t.declaredNames,i=G,o=[],s=0;s<e.properties.length;s++){var u=e.properties[s];if("RestElement"==u.type){var c=e.properties.map(function(e){return e.key&&e.key.name}).filter(Boolean),l=n.nodes.varDecl(u.argument.name,n.nodes.objectLiteral([])),f=n.nodes.varDecl(u.argument.name,N(u.argument.name)),p=n.nodes.exprStmt(n.nodes.funcCall(n.nodes.funcExpr({},[],n.nodes.forIn("__key",t.parent,n.nodes.block.apply(n.nodes,R(c.length?c.map(function(e){return n.nodes.ifStmt(n.nodes.binaryExpr(n.nodes.id("__key"),"===",n.nodes.literal(e)),{type:"ContinueStatement",label:null},null)}):[]).concat([n.nodes.exprStmt(n.nodes.assign(n.nodes.member(u.argument.name,n.nodes.id("__key"),!0),n.nodes.member(t.parent,n.nodes.id("__key"),!0)))]))))));f[i]={capture:!0},o.push(l,f,p)}else if("Identifier"==u.value.type)(l=I(u.value,P(t.parent,u.key)))[i]={capture:!0},o.push(l);else if("AssignmentPattern"==u.value.type)(l=I(u.value.left,W($(P(t.parent,u.key),"===",N("undefined")),u.value.right,P(t.parent,u.key))))[i]={capture:!0},o.push(l);else{var d=N(a(r,t.parent.name+"$"+u.key.name)),h=I(d,P(t.parent,u.key));h[i]={capture:!1},r.push(d.name),o.push.apply(o,R([h].concat(_(u.value,{parent:d,declaredNames:r}))))}}return o}function k(e,t,r){var n=z(e),i=t.id.name;return n.declaredNames.indexOf(i)>-1?q(L(t.id,t.init)):{declarations:[t],kind:r||"var",type:"VariableDeclaration"}}function E(e,t,r,n){return q(L(P(e,t,n),r||N("undefined")))}function S(e,t,r,n,i){return F(n,e,D(t,r,i))}function A(e,t,r,n,i){return I(t,D(r,n,i))}function D(e,t,r){return"string"==typeof e&&(e=M(e)),{arguments:[t].concat(e||[]),callee:r,type:"CallExpression"}}function C(e,t,r){return q(D(e,t,r))}function F(e,r,n){return"string"==typeof r&&(r=M(r)),n=t.obj.deepCopy(n),U(e,r,n)}function O(e,t,r){return q(F(e,t,r))}function j(e,t,r,i,o,a,s){if(t){var u=[],c=!1;if(t["x-lively-object-meta"]){var l=t["x-lively-object-meta"],f=l.start,p=l.end,d=l.evalId,h=l.sourceAccessorName;c=!0,u.push("start",n.nodes.literal(f),"end",n.nodes.literal(p))}if(void 0===d&&s.hasOwnProperty("evalId")&&(d=s.evalId,c=!0),void 0===h&&s.hasOwnProperty("sourceAccessorName")&&(h=s.sourceAccessorName,c=!0),void 0!==d&&u.push("evalId",n.nodes.literal(d)),h&&u.push("moduleSource",n.nodes.id(h)),c)return U(e,r,i,o,a,n.nodes.objectLiteral(u))}return U(e,r,i,o,a)}var B=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},R=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},P=n.nodes.member,T=n.nodes.prop,I=n.nodes.varDecl,L=n.nodes.assign,N=n.nodes.id,M=n.nodes.literal,q=n.nodes.exprStmt,W=n.nodes.conditional,$=n.nodes.binaryExpr,U=n.nodes.funcCall,z=n.query.topLevelDeclsAndRefs,V=n.query.helpers,G=Symbol("lively.ast-destructuring-transform"),H=Object.freeze({rewriteToCaptureTopLevelVariables:function(e,r,n){r||(r={type:"Identifier",name:"__rec"});var a=e;if((n=B({ignoreUndeclaredExcept:null,includeRefs:null,excludeRefs:n&&n.exclude||[],includeDecls:null,excludeDecls:n&&n.exclude||[],recordDefRanges:!1,es6ExportFuncId:null,es6ImportFuncId:null,captureObj:r,moduleExportFunc:{name:n&&n.es6ExportFuncId||"_moduleExport",type:"Identifier"},moduleImportFunc:{name:n&&n.es6ImportFuncId||"_moduleImport",type:"Identifier"},declarationWrapper:void 0,classToFunction:n&&n.hasOwnProperty("classToFunction")?n.classToFunction:{classHolder:r,functionNode:{type:"Identifier",name:"_createOrExtendClass"},declarationWrapper:n&&n.declarationWrapper,evalId:n&&n.evalId,sourceAccessorName:n&&n.sourceAccessorName}},n)).ignoreUndeclaredExcept){var c=z(e);n.excludeRefs=t.arr.withoutAll(c.undeclaredNames,n.ignoreUndeclaredExcept).concat(n.excludeRefs),n.excludeDecls=t.arr.withoutAll(c.undeclaredNames,n.ignoreUndeclaredExcept).concat(n.excludeDecls)}n.excludeRefs=n.excludeRefs.concat(n.captureObj.name),n.excludeDecls=n.excludeDecls.concat(n.captureObj.name);n.recordDefRanges&&b(a,n);return n.excludeRefs=n.excludeRefs.concat(u(e,n)),n.excludeDecls=n.excludeDecls.concat(s(e,n)),a=v(a,n),n.es6ExportFuncId&&(n.excludeRefs.push(n.es6ExportFuncId),n.excludeRefs.push(n.es6ImportFuncId),a=y(a,n)),a=i(a,n),a=o(a,n),a=f(a,n),a=p(a,n),a=d(a,n),a=h(a,n),a=m(a,n),a=g(a,n)},rewriteToRegisterModuleToCaptureSetters:function(e,r,i){i=B({captureObj:r||{type:"Identifier",name:"__rec"},exclude:[],declarationWrapper:void 0},i);var o=t.Path("body.0.expression").get(e);if("System"!==o.callee.object.name)throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call: "+n.stringify(e).slice(0,300)+"...");if("register"!==o.callee.property.name)throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call: "+n.stringify(e).slice(0,300)+"...");var a=t.Path("arguments.1.body.body").get(o),s=t.arr.last(a);if("ReturnStatement"!==s.type)throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call, at return statement: "+n.stringify(e).slice(0,300)+"...");var u=s.argument.properties.find(function(e){return"setters"===e.key.name});if(!u)throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call, at finding setters: "+n.stringify(e).slice(0,300)+"...");var c=s.argument.properties.find(function(e){return"execute"===e.key.name});if(!c)throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call, at finding execute: "+n.stringify(e).slice(0,300)+"...");u.value.elements.forEach(function(e){return e.body.body=e.body.body.map(function(e){if("ExpressionStatement"!==e.type||"AssignmentExpression"!==e.expression.type||"Identifier"!==e.expression.left.type||t.arr.include(i.exclude,e.expression.left.name))return e;var r=e.expression.left,n=i.declarationWrapper?j(i.declarationWrapper,null,M(r.name),M("var"),e.expression,i.captureObj,i):e.expression;return q(L(P(i.captureObj,r),n))})});var l=c.value.body.body.find(function(e){return"ExpressionStatement"===e.type&&"AssignmentExpression"==e.expression.type&&e.expression.left.name===i.captureObj.name});if(l||(l=c.value.body.body.find(function(e){return"VariableDeclaration"===e.type&&e.declarations[0].id&&e.declarations[0].id.name===i.captureObj.name})),l&&(t.arr.remove(c.value.body.body,l),t.arr.pushAt(a,l,a.length-1)),i.sourceAccessorName){var f=c.value.body.body.find(function(e){return"ExpressionStatement"===e.type&&"AssignmentExpression"==e.expression.type&&e.expression.left.name===i.sourceAccessorName});f||(f=c.value.body.body.find(function(e){return"VariableDeclaration"===e.type&&e.declarations[0].id&&e.declarations[0].id.name===i.sourceAccessorName})),f&&(t.arr.remove(c.value.body.body,f),t.arr.pushAt(a,f,a.length-1))}return e}});e.capturing=H,e.stringifyFunctionWithoutToplevelRecorder=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"__lvVarRecorder";"function"==typeof e&&(e=String(e));var r="string"==typeof e?n.parseFunction(e):e,i=n.ReplaceVisitor.run(r,function(e){return"MemberExpression"===e.type&&"Identifier"===e.object.type&&e.object.name===t?e.property:e});return n.stringify(i)}}(this.lively.sourceTransform=this.lively.sourceTransform||{},lively.lang,lively.classes,lively.ast),"undefined"!=typeof module&&module.exports&&(module.exports=e.lively.sourceTransform)}(),function(){var GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(exports,lively_lang,lively_ast,lively_sourceTransform,lively_classes,lively_notifications){"use strict";function getGlobal(){return"undefined"!=typeof System?System.global:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof Global?Global:"undefined"!=typeof self?self:function(){return this}()}function signatureOf(e,t){var r=String(t).match(/function\s*[a-zA-Z0-9_$]*\s*\(([^\)]*)\)/);return e+"("+(r&&r[1]||"")+")"}function pluck(e,t){return e.map(function(e){return e[t]})}function printSymbol(e){if(Symbol.keyFor(e))return'Symbol.for("'+Symbol.keyFor(e)+'")';if(knownSymbols.get(e))return knownSymbols.get(e);String(e).match(symMatcher);return String(e)}function safeToString(e){if(!e)return String(e);if(Array.isArray(e))return"["+e.map(safeToString).join(",")+"]";if("symbol"===(void 0===e?"undefined":_typeof(e)))return printSymbol(e);try{return String(e)}catch(e){throw new Error("Cannot print object: "+e.stack)}}function printEvalResult(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.value,n=e.isError,i=e.isPromise,o=e.promisedValue,a=e.promiseStatus;if(n||r instanceof Error)return String(r.stack||r);if(i){var s=lively_lang.string.print(a),u="pending"===a?void 0:printEvalResult({value:o},t);return"Promise({status: "+s+", "+(void 0===r?"":"value: "+u)+"})"}return r instanceof Promise?'Promise({status: "unknown"})':t.inspect?printInspectEvalValue(r,t.inspectDepth||2):String(r)}function getObjectForCompletion(e,t){var r="";return Promise.resolve().then(function(){var n=t.lastIndexOf(".");return n>=0?(r=t.slice(n+1),t=t.slice(0,n)):(r=t,t='(typeof window === "undefined" ? global : window)'),e(t)}).then(function(e){return{evalResult:e,startLetters:r,code:t}})}function propertyExtract(e,t,r){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t).map(printSymbol)).filter(function(t){return-1===e.indexOf(t)}).map(r).filter(function(e){return!!e}).sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})}function getMethodsOf(e,t){return propertyExtract(e,t,function(e){return t.__lookupGetter__&&t.__lookupGetter__(e)||"function"!=typeof t[e]?null:{name:e,completion:signatureOf(e,t[e])}})}function getAttributesOf(e,t){return propertyExtract(e,t,function(e){return t.__lookupGetter__&&!t.__lookupGetter__(e)&&"function"==typeof t[e]?null:{name:e,completion:e}})}function getProtoChain(e){for(var t=[];e;)t.push(e),e=e.__proto__;return t}function getDescriptorOf(e,t){function r(e,t){return e.length>t&&(e=e.slice(0,t)+"..."),e.replace(/\n/g,"").replace(/\s+/g," ")}if(e===t){if("function"!=typeof e)return r(safeToString(e),50);var n=e.toString(),i=r(n.slice(n.indexOf("{")+1,n.lastIndexOf("}")),50);return signatureOf(e.displayName||e.name||"function",e)+" {"+i+"}"}var o=t.hasOwnProperty("constructor")&&t.constructor;return o?"string"==typeof o.type&&o.type.length?r(o.type,50):"string"==typeof o.name&&o.name.length?r(o.name,50):"anonymous class":"prototype"}function descriptorsOfObjAndProtoProperties(e){var t=[];return getProtoChain(e).map(function(r){var n=getDescriptorOf(e,r),i=getMethodsOf(t,r).concat(getAttributesOf(t,r));return t=t.concat(pluck(i,"name")),[n,pluck(i,"completion")]})}function getCompletions(e,t,r){var n=getObjectForCompletion(e,t).then(function(e){var t=e.evalResult,r={completions:descriptorsOfObjAndProtoProperties(t&&t.isEvalResult?t.value:t),startLetters:e.startLetters,code:e.code};return t&&t.isPromise&&("fulfilled"===t.promiseStatus?r.promiseResolvedCompletions=descriptorsOfObjAndProtoProperties(t.promisedValue):"rejected"===t.promiseStatus&&(r.promiseRejectedCompletions=descriptorsOfObjAndProtoProperties(t.promisedValue))),r});return"function"==typeof r&&n.then(function(e){return r(null,e)}).catch(function(e){return r(e)}),n}function processInlineCodeTransformOptions(parsed,options){if(!parsed.comments)return options;var livelyComment=parsed.comments.find(function(e){return e.text.startsWith("lively.vm ")});if(!livelyComment)return options;try{var inlineOptions=eval("inlineOptions = {"+livelyComment.text.slice("lively.vm ".length)+"};");return Object.assign(options,inlineOptions)}catch(e){return options}}function evalCodeTransform(e,t){e=lively_ast.transform.transformSingleExpression(e);var r=lively_ast.parse(e,{withComments:!0});t=processInlineCodeTransformOptions(r,t);var n=lively_ast.query.topLevelDeclsAndRefs(r),i=n.classDecls,o=n.funcDecls,a=n.varDecls,s={};if(t.hasOwnProperty("evalId")&&(s.evalId=t.evalId),t.sourceAccessorName&&(s.sourceAccessorName=t.sourceAccessorName),[].concat(toConsumableArray(i),toConsumableArray(o)).forEach(function(e){return e["x-lively-object-meta"]=_extends({},s,{start:e.start,end:e.end})}),a.forEach(function(e){return e.declarations.forEach(function(e){return e["x-lively-object-meta"]=_extends({},s,{start:e.start,end:e.end})})}),r=lively_ast.transform.objectSpreadTransform(r),!t.topLevelVarRecorder&&t.topLevelVarRecorderName){var u=getGlobal();"GLOBAL"===t.topLevelVarRecorderName?t.topLevelVarRecorder=getGlobal():t.topLevelVarRecorder=lively_lang.Path(t.topLevelVarRecorderName).get(u)}if(t.topLevelVarRecorder){var c=(t.dontTransform||[]).concat(["arguments"]),l=t.recordGlobals?null:lively_lang.arr.withoutAll(Object.keys(t.topLevelVarRecorder),c),f=id(t.varRecorderName||"__lvVarRecorder"),p=void 0;if(t.declarationWrapperName||"function"==typeof t.declarationCallback){var d=t.declarationWrapperName||defaultDeclarationWrapperName;t.declarationWrapper=member(id(t.varRecorderName||"__lvVarRecorder"),literal(d),!0),t.declarationCallback&&(t.topLevelVarRecorder[d]=t.declarationCallback)}(!t.hasOwnProperty("transformES6Classes")||t.transformES6Classes)&&(defaultClassToFunctionConverterName in t.topLevelVarRecorder||(t.topLevelVarRecorder[defaultClassToFunctionConverterName]=lively_classes.runtime.initializeClass),p={currentModuleAccessor:t.currentModuleAccessor,classHolder:f,functionNode:member(f,defaultClassToFunctionConverterName),declarationWrapper:t.declarationWrapper,evalId:t.evalId,sourceAccessorName:t.sourceAccessorName}),r=lively_sourceTransform.capturing.rewriteToCaptureTopLevelVariables(r,f,{es6ImportFuncId:t.es6ImportFuncId,es6ExportFuncId:t.es6ExportFuncId,ignoreUndeclaredExcept:l,exclude:c,declarationWrapper:t.declarationWrapper||void 0,classToFunction:p,evalId:t.evalId,sourceAccessorName:t.sourceAccessorName,keepTopLevelVarDecls:t.keepTopLevelVarDecls})}t.wrapInStartEndCall&&(r=lively_ast.transform.wrapInStartEndCall(r,{startFuncNode:t.startFuncNode,endFuncNode:t.endFuncNode}));var h=lively_ast.stringify(r);return t.sourceURL&&(h+="\n//# sourceURL="+t.sourceURL.replace(/\s/g,"_")),h}function evalCodeTransformOfSystemRegisterSetters(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t.topLevelVarRecorder)return e;if("function"==typeof t.declarationCallback||t.declarationWrapperName){var r=t.declarationWrapperName||defaultDeclarationWrapperName;t.declarationWrapper=member(id(t.varRecorderName),literal(r),!0),t.declarationCallback&&(t.topLevelVarRecorder[r]=t.declarationCallback)}var n=lively_ast.parse(e),i=(t.dontTransform||[]).concat(["arguments"]),o=(t.recordGlobals||lively_lang.arr.withoutAll(Object.keys(t.topLevelVarRecorder),i),lively_sourceTransform.capturing.rewriteToRegisterModuleToCaptureSetters(n,id(t.varRecorderName||"__lvVarRecorder"),_extends({exclude:i},t)));return lively_ast.stringify(o)}function _normalizeEvalOptions(e){if(e||(e={}),(e=_extends({targetModule:null,sourceURL:e.targetModule,runtime:null,context:getGlobal(),varRecorderName:defaultTopLevelVarRecorderName,dontTransform:[],recordGlobals:null,returnPromise:!0,promiseTimeout:200,waitForPromise:!0,wrapInStartEndCall:!1,onStartEval:null,onEndEval:null},e)).targetModule){var t=e.runtime&&e.runtime.modules&&e.runtime.modules[e.targetModule];t&&(e=Object.assign(e,t))}return e.wrapInStartEndCall&&(e.startFuncNode={type:"MemberExpression",object:{type:"Identifier",name:e.varRecorderName},property:{type:"Literal",value:startEvalFunctionName},computed:!0},e.endFuncNode={type:"MemberExpression",object:{type:"Identifier",name:e.varRecorderName},property:{type:"Literal",value:endEvalFunctionName},computed:!0}),e}function _eval(__lvEvalStatement,__lvVarRecorder,__lvOriginalCode){return eval(__lvEvalStatement)}function runEval$1(e,t,r){"function"==typeof t&&2===arguments.length&&(r=t,t=null);var n,i,o=new EvalResult,a=!1,s=!1;t=_normalizeEvalOptions(t);var u=lively_lang.promise.deferred(),c=t.topLevelVarRecorder||getGlobal(),l=e;t.wrapInStartEndCall&&(c[startEvalFunctionName]&&console.warn(o.addWarning("startEvalFunctionName "+startEvalFunctionName+" already exists in recorder!")),c[endEvalFunctionName]&&console.warn(o.addWarning("endEvalFunctionName "+endEvalFunctionName+" already exists in recorder!")),c[startEvalFunctionName]=function(){a?console.warn(o.addWarning("onEvalStartCalled multiple times!")):(a=!0,"function"==typeof t.onStartEval&&t.onStartEval())},c[endEvalFunctionName]=function(e,n){s?console.warn(o.addWarning("onEvalEndCalled multiple times!")):(s=!0,finishEval(e,n,o,t,c,u,r))});try{e=evalCodeTransform(e,t),t.header&&(e=t.header+e),t.footer&&(e+=t.footer),t.transpiler&&(e=t.transpiler(e,t.transpilerOptions))}catch(e){console.warn(o.addWarning("lively.vm evalCodeTransform not working: "+(e.stack||e)))}try{"undefined"!=typeof $world&&$world.get("log")&&($world.get("log").textString=e),i=_eval.call(t.context,e,t.topLevelVarRecorder,t.originalSource||l)}catch(e){n=e}return t.wrapInStartEndCall?n&&!s&&c[endEvalFunctionName](n,void 0):finishEval(n,n||i,o,t,c,u,r),t.sync?o:u.promise}function finishEval(e,t,r,n,i,o,a){n.wrapInStartEndCall&&(delete i[startEvalFunctionName],delete i[endEvalFunctionName]),e?(r.isError=!0,r.value=e):r.value=t,r.value instanceof Promise&&(r.isPromise=!0),n.sync?(r.processSync(n),"function"==typeof n.onEndEval&&n.onEndEval(e,t)):r.process(n).then(function(){return"function"==typeof a&&a(null,r),"function"==typeof n.onEndEval&&n.onEndEval(e,t),r},function(e){return"function"==typeof a&&a(e,void 0),"function"==typeof n.onEndEval&&n.onEndEval(e,void 0),r}).then(o.resolve,o.reject)}function syncEval$1(e,t){return t=Object.assign(t||{},{sync:!0}),runEval$1(e,t)}function tryToWaitForPromise(e,t){console.assert(e.isPromise,"no promise in tryToWaitForPromise???");var r={},n=new Promise(function(e){return setTimeout(e,t,r)});return Promise.race([n,e.value]).then(function(t){return Object.assign(e,t!==r?{promiseStatus:"fulfilled",promisedValue:t}:{promiseStatus:"pending"})}).catch(function(t){return Object.assign(e,{promiseStatus:"rejected",promisedValue:t})})}function ensureImportsAreImported(e,t,r){var n=lively_ast.parse(t).body.filter(function(e){return"ImportDeclaration"===e.type});return Promise.all(n.map(function(t){return e.normalize(t.source.value,r).then(function(t){return e.get(t)||e.import(t)})})).catch(function(e){throw console.error("Error ensuring imports: "+e.message),e})}function hasUnimportedImports(e,t,r){var n=lively.ast.parse(t).body.filter(function(e){return"ImportDeclaration"===e.type});return lively_lang.arr.uniq(n.map(function(e){return e.source.value})).filter(Boolean).filter(function(t){return!e.get(e.decanonicalize(t,r))}).length>0}function babelTranspilerForAsyncAwaitCode(e,t,r,n){return function(e,n){n=Object.assign({sourceMap:void 0,inputSourceMap:void 0,filename:r,code:!0,ast:!1},n);var i="(async function(__rec) {\n"+e+"\n}).call(this);",o=t.transform(i,n).code;return o=o.replace(/\}\)\.call\(undefined\);$/,"}).call(this)")}}function babelPluginTranspilerForAsyncAwaitCode(e,t,r,n){return function(n,i){var o=e.babelOptions||{},a=[];a.push(t.presetES2015),o.stage3&&a.push({plugins:t.pluginsStage3}),o.stage2&&a.push({plugins:t.pluginsStage2}),o.stage1&&a.push({plugins:t.pluginsStage1}),i=Object.assign({sourceMap:void 0,inputSourceMap:void 0,filename:r,babelrc:!1,presets:a,moduleIds:!1,code:!0,ast:!1},i);var s="(async function(__rec) {\n"+n+"\n}).call(this);",u=t.babel.transform(s,i).code;return u=u.replace(/\}\)\.call\(undefined\);$/,"}).call(this)")}}function getEs6Transpiler(e,t,r){if(t.transpiler)return t.transpiler;if(!t.es6Transpile)return null;if("babel"===e.transpiler){var n=e.global[e.transpiler]||e.get(e.decanonicalize(e.transpiler));return n?babelTranspilerForAsyncAwaitCode(e,n,t.targetModule,r):e.import(e.transpiler).then(function(n){return babelTranspilerForAsyncAwaitCode(e,n,t.targetModule,r)})}if("plugin-babel"===e.transpiler){var i=e.decanonicalize("plugin-babel").split("/").slice(0,-1).concat("systemjs-babel-browser.js").join("/"),o=e.get(i);return o?babelPluginTranspilerForAsyncAwaitCode(e,o,t.targetModule,r):e.import(i).then(function(n){return babelPluginTranspilerForAsyncAwaitCode(e,n,t.targetModule,r)})}if("lively.transpiler"===e.transpiler){var a=new(0,e.get(e.decanonicalize("lively.transpiler")).default)(e,t.targetModule,r);return function(e,t){return a.transpileDoit(e,t)}}throw new Error("Sorry, currently only babel is supported as es6 transpiler for runEval!")}function runEval$2(e,t,r){r=_extends({targetModule:null,parentModule:null,es6Transpile:!0,transpiler:null,transpilerOptions:null,format:"esm"},r);var n=t;e.debug&&console.log("[lively.module] runEval: "+t.slice(0,100).replace(/\n/gm," ")+"...");var i=r,o=i.format,a=i.targetModule,s=i.parentModule;if(a=e.decanonicalize(a||"*scratch*",s),r.targetModule=a,o){var u=e.getConfig().meta[a];u||(u={}),u[a]||(u[a]={}),u[a].format||(u[a].format=o,e.config(u))}var c=e.get("@lively-env").moduleEnv(a),l=c.recorder,f=c.recorderName,p=c.dontTransform,d=getEs6Transpiler(e,r,c),h="var _moduleExport = "+f+"._moduleExport,\n    _moduleImport = "+f+"._moduleImport;\n";if(!(r=_extends({waitForPromise:!0,sync:!1,evalId:r.evalId||c.nextEvalId(),sourceAccessorName:!r.hasOwnProperty("embedOriginalCode")||r.embedOriginalCode?"__lvOriginalCode":void 0,originalSource:n},r,{header:h,recordGlobals:!0,dontTransform:p,varRecorderName:f,topLevelVarRecorder:l,sourceURL:r.sourceURL||r.targetModule,context:r.context||l,wrapInStartEndCall:!0,es6ExportFuncId:"_moduleExport",es6ImportFuncId:"_moduleImport",transpiler:d,declarationWrapperName:c.varDefinitionCallbackName,currentModuleAccessor:funcCall(member$1(funcCall(member$1(member$1("__lvVarRecorder","System"),"get"),literal$1("@lively-env")),"moduleEnv"),literal$1(r.targetModule))})).sync&&!r.importsEnsured&&hasUnimportedImports(e,t,a))return ensureImportsAreImported(e,t,a).then(function(){return runEval$2(e,n,_extends({},r,{importsEnsured:!0}))});if(!c.record()){if(!r.sync&&!r._moduleImported)return e.import(a).catch(function(e){return null}).then(function(){return runEval$2(e,n,_extends({},r,{_moduleImported:!0}))});c.ensureRecord()}if(r.es6Transpile&&r.transpiler instanceof Promise){if(!r.sync&&!r._transpilerLoaded)return r.transpiler.catch(function(e){return console.error(e)}).then(function(t){return runEval$2(e,n,_extends({},r,{transpiler:t,_transpilerLoaded:!0}))});console.warn("[lively.vm] sync eval requested but transpiler is not yet loaded, will continue without transpilation!"),r.transpiler=null}e.debug&&console.log("[lively.module] runEval in module "+a+" started"),lively_notifications.emit("lively.vm/doitrequest",{code:n,waitForPromise:r.waitForPromise,targetModule:r.targetModule},Date.now(),e),e.get("@lively-env").evaluationStart(a);var m=runEval$1(t,r);return r.sync?evalEnd(e,n,r,m):Promise.resolve(m).then(function(t){return evalEnd(e,n,r,t)})}function evalEnd(e,t,r,n){return e.get("@lively-env").evaluationEnd(r.targetModule),e.debug&&console.log("[lively.module] runEval in module "+r.targetModule+" done"),lively_notifications.emit("lively.vm/doitresult",{code:t,result:n,waitForPromise:r.waitForPromise,targetModule:r.targetModule},Date.now(),e),n}function runEval$$1(e,t){var r=t=_extends({format:"esm",System:null,targetModule:null},t),n=r.format,i=r.System,o=r.targetModule;return i||"undefined"==typeof System||(i=System),!i&&o?Promise.reject(new Error("options to runEval have targetModule but cannot find system loader!")):o&&["esm","es6","register"].includes(n)?runEval$2(i,e,t):runEval$1(e,t)}function syncEval$$1(e,t){return syncEval$1(e,t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},asyncToGenerator=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),defineProperty=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},get$1=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},set=function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var s=o.set;void 0!==s&&s.call(i,n)}return n},slicedToArray=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},knownSymbols=Object.getOwnPropertyNames(Symbol).filter(function(e){return"symbol"===_typeof(Symbol[e])}).reduce(function(e,t){return e.set(Symbol[t],"Symbol."+t)},new Map),symMatcher=/^Symbol\((.*)\)$/,printInspectEvalValue=function(){function e(e,t){if("object"===(void 0===t?"undefined":_typeof(t))&&(t=t.maxDepth||2),!e)return String(e);if("string"==typeof e){var n=e.includes("\n")?"`":'"';return n+e+n}if(e instanceof Error)return e.stack||safeToString(e);if(!lively_lang.obj.isObject(e))return safeToString(e);try{var i=lively_lang.obj.inspect(e,{customPrinter:r,maxDepth:t,printFunctionSource:!0})}catch(e){}return"{}"===i?safeToString(e):i}function t(t,r){if(!("string"!=typeof t&&!Array.isArray(t)&&n&&"function"==typeof t[n]))return r;for(var o,a="function"==typeof t.entries,s=a?t.entries():t[n](),u=[],c=a?"{":"[",l=a?"}":"]",f=t.constructor&&t.constructor.name||"Iterable",p=0;p<i&&!(o=s.next()).done;p++)u.push(o.value);return f+"("+c+u.map(function(t){return a?e(t[0],1)+": "+e(t[1],1):e(t,2)}).join(", ")+l+")"}function r(e,r,n){if(!e)return r;if("symbol"===(void 0===e?"undefined":_typeof(e)))return printSymbol(e);if("string"==typeof e)return lively_lang.string.print(lively_lang.string.truncate(e,o));if(e.isMorph)return safeToString(e);if(e instanceof Promise)return"Promise()";if("undefined"!=typeof Node&&e instanceof Node)return safeToString(e);if("undefined"!=typeof ImageData&&e instanceof ImageData)return safeToString(e);var a=e.length||e.byteLength;if(void 0!==a&&a>i&&e.slice)return"["+("string"==typeof e||e.byteLength?safeToString(e.slice(0,i)):e.slice(0,i).map(n))+",...]";var s=t(e,r);return s!==r?s:r}var n="undefined"!=typeof Symbol&&Symbol.iterator,i=10,o=100;return e}(),completions=Object.freeze({getObjectForCompletion:getObjectForCompletion,getCompletions:getCompletions}),id=lively_ast.nodes.id,literal=lively_ast.nodes.literal,member=lively_ast.nodes.member,defaultDeclarationWrapperName="lively.capturing-declaration-wrapper",defaultClassToFunctionConverterName="initializeES6ClassForLively",defaultTopLevelVarRecorderName="__lvVarRecorder",startEvalFunctionName="lively.vm-on-eval-start",endEvalFunctionName="lively.vm-on-eval-end",EvalResult=function(){function e(){classCallCheck(this,e),this.isEvalResult=!0,this.value=void 0,this.warnings=[],this.isError=!1,this.isPromise=!1,this.promisedValue=void 0,this.promiseStatus="unknown"}return createClass(e,[{key:"addWarning",value:function(e){return this.warnings.push(e),e}},{key:"printed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.value=printEvalResult(this,e)}},{key:"processSync",value:function(e){return(e.inspect||e.asString)&&(this.value=this.print(this.value,e)),this}},{key:"process",value:function(e){var t=this;return t.isPromise&&e.waitForPromise?tryToWaitForPromise(t,e.promiseTimeout).then(function(){return(e.inspect||e.asString)&&t.printed(e),t}):((e.inspect||e.asString)&&t.printed(e),Promise.resolve(t))}}]),e}(),funcCall=lively_ast.nodes.funcCall,member$1=lively_ast.nodes.member,literal$1=lively_ast.nodes.literal,EvalStrategy=function(){function e(){classCallCheck(this,e)}return createClass(e,[{key:"runEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.reject("runEval(source, options) not yet implemented for "+this.constructor.name));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"keysOfObject",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.reject("keysOfObject(prefix, options) not yet implemented for "+this.constructor.name));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}(),SimpleEvalStrategy=function(_EvalStrategy){function SimpleEvalStrategy(){return classCallCheck(this,SimpleEvalStrategy),possibleConstructorReturn(this,(SimpleEvalStrategy.__proto__||Object.getPrototypeOf(SimpleEvalStrategy)).apply(this,arguments))}return inherits(SimpleEvalStrategy,_EvalStrategy),createClass(SimpleEvalStrategy,[{key:"runEval",value:function(){function runEval(e,t){return _ref3.apply(this,arguments)}var _ref3=asyncToGenerator(regeneratorRuntime.mark(function _callee3(source,options){return regeneratorRuntime.wrap(function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.abrupt("return",Promise.resolve().then(function(){try{return Promise.resolve({value:eval(source)})}catch(e){return{isError:!0,value:e}}}));case 1:case"end":return _context3.stop()}},_callee3,this)}));return runEval}()},{key:"keysOfObject",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lively.vm.completions.getCompletions(function(e){return i.runEval(e,r)},t);case 2:return n=e.sent,e.abrupt("return",{completions:n.completions,prefix:n.startLetters});case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),SimpleEvalStrategy}(EvalStrategy),LivelyVmEvalStrategy=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,e),createClass(t,[{key:"normalizeOptions",value:function(e){if(!e.targetModule)throw new Error("runEval called but options.targetModule not specified!");return Object.assign({sourceURL:e.targetModule+"_doit_"+Date.now()},e)}},{key:"runEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.normalizeOptions(r),(n=r.System||lively.modules.System).config({meta:defineProperty({},r.targetModule,{format:"esm"})}),e.abrupt("return",lively.vm.runEval(t,r));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"keysOfObject",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lively.vm.completions.getCompletions(function(e){return lively.vm.runEval(e,r)},t);case 2:return n=e.sent,e.abrupt("return",{completions:n.completions,prefix:n.startLetters});case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(EvalStrategy),RemoteEvalStrategy=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,e),createClass(t,[{key:"sourceForRemote",value:function(e,t,r){return r=lively_lang.obj.dissoc(r,["systemInterface","System","context"]),"\n(function() {\n  var arg = "+JSON.stringify(t)+",\n      options = "+JSON.stringify(r)+';\n  if (typeof lively === "undefined" || !lively.vm) {\n    return Promise.resolve({\n      isEvalResult: true,\n      isError: true,\n      value: \'lively.vm not available!\'\n    });\n  }\n  var hasSystem = typeof System !== "undefined"\n  options.context = hasSystem\n    ? System.global\n    : typeof window !== "undefined"\n        ? window\n        : typeof global !== "undefined"\n            ? global\n            : typeof self !== "undefined" ? self : this;\n  function evalFunction(source, options) {\n    if (hasSystem) {\n      var conf = {meta: {}}; conf.meta[options.targetModule] = {format: "esm"};\n      System.config(conf);\n    } else {\n      options = Object.assign({topLevelVarRecorderName: "GLOBAL"}, options);\n      delete options.targetModule;\n    }\n    return lively.vm.runEval(source, options);\n  }\n  function keysOfObjectFunction(prefix, options) {\n    return lively.vm.completions.getCompletions(code => evalFunction(code, options), prefix)\n      .then(result => ({isEvalResult: true, completions: result.completions, prefix: result.startLetters}));\n  }\n  return '+("eval"===e?"evalFunction":"keysOfObjectFunction")+"(arg, options)\n    .catch(err => ({isEvalResult: true, isError: true, value: String(err.stack || err)}));\n})();\n"}},{key:"runEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.remoteEval(this.sourceForRemote("eval",t,r),r));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"keysOfObject",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.remoteEval(this.sourceForRemote("keysOfObject",t,r),r));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"remoteEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.basicRemoteEval(t,r);case 3:return n=e.sent,e.abrupt("return","string"==typeof n?JSON.parse(n):n);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{isError:!0,value:"Remote eval failed: "+(n||e.t0)});case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"basicRemoteEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Not yet implemented");case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(LivelyVmEvalStrategy),HttpEvalStrategy=function(e){function t(e){classCallCheck(this,t);var r=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.url=e||r.constructor.defaultURL,r}return inherits(t,e),createClass(t,null,[{key:"defaultURL",get:function(){return"http://localhost:3000/lively"}}]),createClass(t,[{key:"normalizeOptions",value:function(e){return e=get$1(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"normalizeOptions",this).call(this,e),Object.assign({serverEvalURL:this.url},e,{context:null})}},{key:"basicRemoteEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.normalizeOptions(r),n="basicRemoteEval_"+(System.get("@system-env").node?"node":"web"),e.next=4,this[n]({method:"POST",body:t},r.serverEvalURL);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"basicRemoteEval_web",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.match(/[^:]+:\/\/[^\/]+/)||[r],i=slicedToArray(n,1),o=i[0],(a=document.location.origin!==o)&&(t.headers=_extends({},t.headers,{pragma:"no-cache","cache-control":"no-cache","x-lively-proxy-request":r}),r=document.location.origin),e.prev=2,e.next=5,window.fetch(r,t);case 5:s=e.sent,e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(2),new Error("Cannot reach server at "+r+": "+e.t0.message);case 11:if(s.ok){e.next=13;break}throw new Error("Server at "+r+": "+s.statusText);case 13:return e.abrupt("return",s.text());case 14:case"end":return e.stop()}},e,this,[[2,8]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"basicRemoteEval_node",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=System._nodeRequire("url").parse,i=System._nodeRequire("http"),o=Object.assign({method:t.method||"GET"},n(r)),e.abrupt("return",new Promise(function(e,r){var n=i.request(o,function(t){t.setEncoding("utf8");var n="";t.on("data",function(e){return n+=e}),t.on("end",function(){return e(n)}),t.on("error",function(e){return r(e)})});n.on("error",function(e){return r(e)}),n.end(t.body)}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(RemoteEvalStrategy),L2LEvalStrategy=function(e){function t(e,r){classCallCheck(this,t);var n=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.l2lClient=e,n.targetId=r,n}return inherits(t,e),createClass(t,[{key:"basicRemoteEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.l2lClient,i=this.targetId,e.next=4,new Promise(function(e,r){return n.sendTo(i,"remote-eval",{source:t},e)});case 4:return o=e.sent,(a=o.data)&&a.value&&a.value.isEvalResult&&(a=a.value),e.abrupt("return",a);case 8:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(RemoteEvalStrategy),evalStrategies=Object.freeze({RemoteEvalStrategy:RemoteEvalStrategy,EvalStrategy:EvalStrategy,SimpleEvalStrategy:SimpleEvalStrategy,LivelyVmEvalStrategy:LivelyVmEvalStrategy,HttpEvalStrategy:HttpEvalStrategy,L2LEvalStrategy:L2LEvalStrategy});exports.completions=completions,exports.runEval=runEval$$1,exports.syncEval=syncEval$$1,exports.evalStrategies=evalStrategies,exports.defaultTopLevelVarRecorderName=defaultTopLevelVarRecorderName,exports.defaultClassToFunctionConverterName=defaultClassToFunctionConverterName,exports.evalCodeTransform=evalCodeTransform,exports.evalCodeTransformOfSystemRegisterSetters=evalCodeTransformOfSystemRegisterSetters}(this.lively.vm=this.lively.vm||{},lively.lang,lively.ast,lively.sourceTransform,lively.classes,lively.notifications),"undefined"!=typeof module&&module.exports&&(module.exports=GLOBAL.lively.vm)}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(e,t){"use strict";function r(e,t){throw new Error(t+" for "+e.constructor.name+" not yet implemented")}function n(e,t){return Array.isArray(e)?e.reduce(function(e,t){return n(t,e)},t):"string"==typeof e?t.filter(function(t){return t.path()!==e&&t.name()!==e}):e instanceof RegExp?t.filter(function(t){return!e.test(t.path())&&!e.test(t.name())}):"function"==typeof e?t.filter(function(t){return!e(t)}):t}function i(e){var t=e.match(/\/([a-z]+?):multistatus/i);return t?t[1]:"d"}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.tagName.replace(/[^:]+:/,""),n=D[r],i=e.textContent;switch(n){case"lastModified":case"created":i=new Date(i);break;case"size":i=Number(i)}return t[n]=i,t}function a(e){var t=(new DOMParser).parseFromString(e,"text/xml"),r=i(e),n=new A("/"+r+":multistatus/"+r+":response").findAll(t.documentElement),a=new A(r+":href"),s=new A(r+":propstat/"+r+":prop");return n.map(function(e){var t=s.findFirst(e),r=Array.from(t.childNodes).reduce(function(e,t){return o(t,e)},{}),n=a.findFirst(e);return r.url=n.textContent||n.text,r})}function s(){return document.location.origin}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",r=arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=e.url,o=e.useCors,a=e.useProxy,u=e.headers,o=void 0===o||o,c={method:t};return(a=void 0===a||a)&&(Object.assign(n,{pragma:"no-cache","cache-control":"no-cache","x-lively-proxy-request":i}),i=s()),o&&(c.mode="cors"),r&&(c.body=r),c.redirect="follow",c.headers=y({},n,u),fetch(i,c)}function c(e){return function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return new Promise(function(t,n){return e.apply(null,r.concat(function(e,r){return e?n(e):t(r)}))})}}function l(e,t){return!t||("string"==typeof t?!e.url.includes(t):"function"==typeof t?!t(e):!(t instanceof RegExp)||!t.test(e.url))}function f(e,t){if(!e)throw new Error("lively.resource resource constructor: expects url but got "+e);if(e.isResource)return e;e=String(e);for(var r=0;r<$.length;r++)if($[r].matches(e))return new $[r].resourceClass(e,t);throw new Error("Cannot find resource type for url "+e)}function p(e){var t=e.name;$=$.filter(function(e){return e.name!==t}).concat(e)}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}},m=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},v=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},g=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},b=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},_=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},w=/\/+$/,x=/^\/+/,k=/^[a-z0-9-_\.]+:/,E=/^\/\/[^\/]+/,S=function(){function e(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(m(this,e),!t)throw new Error("Cannot create resource without url");this.url=String(t),this.binary=!1,this.lastModified=void 0,this.created=void 0,this.etag=void 0,this.size=void 0,this.type=void 0,this.contentType=void 0,this.user=void 0,this.group=void 0,this.mode=void 0,this._isDirectory=void 0,this._isLink=void 0,this.linkCount=void 0}return v(e,null,[{key:"fromProps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new this(e.url).assignProperties(e)}}]),v(e,[{key:"equals",value:function(e){if(!e||this.constructor!==e.constructor)return!1;var t=this.url,r=e.url;return"/"===t[t.length-1]&&(t=t.slice(0,-1)),"/"===r[r.length-1]&&(r=r.slice(0,-1)),t===r}},{key:"toString",value:function(){return this.constructor.name+'("'+this.url+'")'}},{key:"newResource",value:function(e){return f(e)}},{key:"path",value:function(){var e=this.url.replace(k,"").replace(E,"");return""===e?"/":e}},{key:"name",value:function(){var e=this.path(),t=e.lastIndexOf("?");t>-1&&(e=e.slice(0,t)),e.endsWith("/")&&(e=e.slice(0,-1));var r=e.split("/"),n=r[r.length-1];return decodeURIComponent(n)}},{key:"nameWithoutExt",value:function(){var e=this.name(),t=e.indexOf(".");return t>0&&(e=e.slice(0,t)),e}},{key:"scheme",value:function(){return this.url.split(":")[0]}},{key:"host",value:function(){var e=this.url.indexOf("://");if(-1===e)return null;var t=this.url.slice(e+3),r=t.indexOf("/");return t.slice(0,r>-1?r:t.length)}},{key:"schemeAndHost",value:function(){return this.isRoot()?this.asFile().url:this.url.slice(0,this.url.length-this.path().length)}},{key:"parent",value:function(){return this.isRoot()?null:this.newResource(this.url.replace(w,"").split("/").slice(0,-1).join("/")+"/")}},{key:"parents",value:function(){for(var e=[],t=this.parent();t;)e.unshift(t),t=t.parent();return e}},{key:"isParentOf",value:function(e){var t=this;return e.schemeAndHost()===this.schemeAndHost()&&e.parents().some(function(e){return e.equals(t)})}},{key:"commonDirectory",value:function(e){if(e.schemeAndHost()!==this.schemeAndHost())return null;if(this.isDirectory()&&this.equals(e))return this;if(this.isRoot())return this.asDirectory();if(e.isRoot())return e.asDirectory();for(var t=e.parents(),r=this.parents(),n=this.root(),i=0;i<r.length;i++){var o=r[i],a=t[i];if(!a||!o.equals(a))return n;n=o}return n}},{key:"withRelativePartsResolved",value:function(){var e=this.path(),t=e;do{t=(e=t).replace(/\/[^\/]+\/\.\./,"")}while(t!=e);return t=t.replace(/(^|[^:])[\/]+/g,"$1/"),(t=t.replace(/\/\.\//g,"/"))===this.path()?this:(t.startsWith("/")&&(t=t.slice(1)),this.newResource(this.root().url+t))}},{key:"relativePathFrom",value:function(e){if(e.root().url!=this.root().url)throw new Error("hostname differs in relativePathFrom "+e+" vs "+this);var t=this.withRelativePartsResolved().path(),r=e.withRelativePartsResolved().path();if(t==r)return"";var n=function(e,t){var r=e.split("/"),n=t.split("/");r.shift(),n.shift();for(var i=0;i<n.length&&r[i]&&r[i]==n[i];i++);return"../".repeat(Math.max(0,n.length-i-1))+r.splice(i,r.length).join("/")}(t,r);if(!n)throw new Error("pathname differs in relativePathFrom "+e+" vs "+this);return n}},{key:"join",value:function(e){return this.newResource(this.url.replace(w,"")+"/"+e.replace(x,""))}},{key:"withPath",value:function(e){return(this.isRoot()?this:this.root()).join(e)}},{key:"isRoot",value:function(){return"/"===this.path()}},{key:"isFile",value:function(){return!this.isRoot()&&!this.url.match(w)}},{key:"isDirectory",value:function(){return!this.isFile()}},{key:"asDirectory",value:function(){return this.url.endsWith("/")?this:this.newResource(this.url.replace(w,"")+"/")}},{key:"root",value:function(){if(this.isRoot())return this;var e=this.url.slice(0,-this.path().length);return this.newResource(e+"/")}},{key:"asFile",value:function(){return this.url.endsWith("/")?this.newResource(this.url.replace(w,"")):this}},{key:"assignProperties",value:function(e){for(var t in e)if("url"!==t){var r=t;"isLink"!==t&&"isDirectory"!==t||(r="_"+t),this[r]=e[t]}return this}},{key:"ensureExistance",value:function(){var e=h(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.exists();case 2:if(!e.sent){e.next=4;break}return e.abrupt("return",this);case 4:return e.next=6,this.parent().ensureExistance();case 6:if(!this.isFile()){e.next=11;break}return e.next=9,this.write(t||"");case 9:e.next=13;break;case 11:return e.next=13,this.mkdir();case 13:return e.abrupt("return",this);case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"copyTo",value:function(){var e=h(regeneratorRuntime.mark(function e(t){var r,n,i,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFile()){e.next=10;break}return r=t.isFile()?t:t.join(this.name()),e.t0=r,e.next=5,this.read();case 5:return e.t1=e.sent,e.next=8,e.t0.write.call(e.t0,e.t1);case 8:e.next=22;break;case 10:if(t.isDirectory()){e.next=12;break}throw new Error("Cannot copy a directory to a file!");case 12:return e.next=14,this.dirList("infinity");case 14:return n=e.sent,i=n.map(function(e){return t.join(e.relativePathFrom(o))}),e.next=18,t.ensureExistance();case 18:return e.next=20,n.reduceRight(function(e,t,r){return function(){return Promise.resolve(t.isDirectory()&&i[r].ensureExistance()).then(e)}},function(){return Promise.resolve()})();case 20:return e.next=22,n.reduceRight(function(e,t,r){return function(){return Promise.resolve(t.isFile()&&t.copyTo(i[r])).then(e)}},function(){return Promise.resolve()})();case 22:return e.abrupt("return",this);case 23:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"rename",value:function(){var e=h(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.copyTo(t);case 2:return this.remove(),e.abrupt("return",t);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"beBinary",value:function(e){return this.setBinary(!0)}},{key:"setBinary",value:function(e){return this.binary=e,this}},{key:"read",value:function(){var e=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r(this,"read");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"write",value:function(){var e=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r(this,"write");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"mkdir",value:function(){var e=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r(this,"mkdir");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"exists",value:function(){var e=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r(this,"exists");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r(this,"remove");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"dirList",value:function(){var e=h(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r(this,"dirList");case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"readProperties",value:function(){var e=h(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r(this,"readProperties");case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"writeJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.write(t?JSON.stringify(e,null,2):JSON.stringify(e))}},{key:"readJson",value:function(){var e=h(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,this.read();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"__serialize__",value:function(){return{__expr__:'var r = null; try { r = resource("'+this.url+'");} catch (err) {}; r',bindings:{"lively.resources":["resource"]}}}},{key:"isResource",get:function(){return!0}}]),e}(),A=function(){function e(t){m(this,e),this.expression=t,this.contextNode=null,this.xpe=new XPathEvaluator}return v(e,[{key:"establishContext",value:function(e){if(!this.nsResolver){var t=e.ownerDocument?e.ownerDocument.documentElement:e.documentElement;t!==this.contextNode&&(this.contextNode=t,this.nsResolver=this.xpe.createNSResolver(t))}}},{key:"manualNSLookup",value:function(){return this.nsResolver=function(e){return Namespace[e.toUpperCase()]||null},this}},{key:"findAll",value:function(e,t){this.establishContext(e);for(var r=this.xpe.evaluate(this.expression,e,this.nsResolver,XPathResult.ANY_TYPE,null),n=[],i=null;i=r.iterateNext();)n.push(i);return n.length>0||void 0===t?n:t}},{key:"findFirst",value:function(e){return this.establishContext(e),this.xpe.evaluate(this.expression,e,this.nsResolver,XPathResult.ANY_TYPE,null).iterateNext()}}]),e}(),D={getlastmodified:"lastModified",creationDate:"created",getetag:"etag",getcontentlength:"size",resourcetype:"type",getcontenttype:"contentType"},C={name:"http-webdav-resource",matches:function(e){return e.startsWith("http:")||e.startsWith("https:")},resourceClass:function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};m(this,t);var n=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return n.useProxy=!!r.hasOwnProperty("useProxy")&&r.useProxy,n.useCors=!!r.hasOwnProperty("useCors")&&r.useCors,n.headers=r.headers||{},n}return b(t,e),v(t,[{key:"join",value:function(e){return Object.assign(g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"join",this).call(this,e),{headers:this.headers,useCors:this.useCors,useProxy:this.useProxy})}},{key:"makeProxied",value:function(){return this.useProxy?this:new this.constructor(this.url,{headers:this.headers,useCors:this.useCors,useProxy:!0})}},{key:"read",value:function(){var e=h(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(this);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Cannot read "+this.url+": "+t.statusText+" "+t.status);case 5:if(this.binary){e.next=7;break}return e.abrupt("return",t.text());case 7:if("blob"!==this.binary){e.next=9;break}return e.abrupt("return",t.blob());case 9:if("function"!=typeof t.arrayBuffer){e.next=11;break}return e.abrupt("return",t.arrayBuffer());case 11:if("function"!=typeof t.buffer){e.next=13;break}return e.abrupt("return",t.buffer());case 13:throw new Error("Don't now how to read binary resource "+this+"'");case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"write",value:function(){var e=h(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isFile()){e.next=2;break}throw new Error("Cannot write a non-file: "+this.url);case 2:return e.next=4,u(this,"PUT",t);case 4:if((r=e.sent).ok){e.next=7;break}throw new Error("Cannot write "+this.url+": "+r.statusText+" "+r.status);case 7:return e.abrupt("return",this);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"mkdir",value:function(){var e=h(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFile()){e.next=2;break}throw new Error("Cannot mkdir on a file: "+this.url);case 2:return e.next=4,u(this,"MKCOL");case 4:if((t=e.sent).ok){e.next=7;break}throw new Error("Cannot create directory "+this.url+": "+t.statusText+" "+t.status);case 7:return e.abrupt("return",this);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"exists",value:function(){var e=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isRoot()){e.next=4;break}e.t0=!0,e.next=7;break;case 4:return e.next=6,u(this,"HEAD");case 6:e.t0=!!e.sent.ok;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(this,"DELETE");case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_propfind",value:function(){var e=h(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(this,"PROPFIND",null,{"Content-Type":"text/xml"});case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Error in dirList for "+this.url+": "+t.statusText);case 5:return e.next=7,t.text();case 7:return r=e.sent,n=this.root(),e.abrupt("return",a(r).map(function(e){return n.join(e.url).assignProperties(e)}));case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"dirList",value:function(){var e=h(regeneratorRuntime.mark(function e(){var t,r,i,o,a,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("number"==typeof s||"infinity"===s){e.next=2;break}throw new Error("dirList  invalid depth argument: "+s);case 2:if(t=u.exclude,s<=0&&(s=1),1!==s){e.next=13;break}return e.next=7,this._propfind();case 7:return r=e.sent,i=r.shift(),t&&(r=n(t,r)),e.abrupt("return",r);case 13:return e.next=15,this.dirList(1,u);case 15:return o=e.sent,a=o.filter(function(e){return e.isDirectory()}),e.abrupt("return",Promise.all(a.map(function(e){return e.dirList("number"==typeof s?s-1:s,u)})).then(function(e){return e.reduce(function(e,t){return e.concat(t)},o)}));case 18:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"readProperties",value:function(){var e=h(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._propfind();case 2:return r=e.sent[0],e.abrupt("return",this.assignProperties(r));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(S)},F=c(t.readFile),O=c(t.writeFile),j=function(e){return new Promise(function(r,n){return t.exists(e,function(e){return r(!!e)})})},B=c(t.readdir),R=c(t.mkdir),P=c(t.rmdir),T=c(t.unlink),I=c(t.lstat),L=c(t.rename),N={name:"nodejs-file-resource",matches:function(e){return e.startsWith("file:")},resourceClass:function(e){function t(){return m(this,t),_(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return b(t,e),v(t,[{key:"path",value:function(){return this.url.replace("file://","")}},{key:"stat",value:function(){var e=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",I(this.path()));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"read",value:function(){var e=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",F(this.path()).then(String));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"write",value:function(){var e=h(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isDirectory()){e.next=2;break}throw new Error("Cannot write into a directory: "+this.path());case 2:return e.next=4,O(this.path(),t);case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"mkdir",value:function(){var e=h(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFile()){e.next=2;break}throw new Error("Cannot mkdir on a file: "+this.path());case 2:return e.next=4,R(this.path());case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"exists",value:function(){var e=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!!this.isRoot()||j(this.path()));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"dirList",value:function(){var e=h(regeneratorRuntime.mark(function e(){var t,r,i,o,a,s,u,c,l,f,p,d,h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("number"==typeof h||"infinity"===h){e.next=2;break}throw new Error("dirList  invalid depth argument: "+h);case 2:if(t=m.exclude,h<=0&&(h=1),1!==h){e.next=42;break}return r=[],i=!0,o=!1,a=void 0,e.prev=9,e.next=12,B(this.path());case 12:e.t0=Symbol.iterator,s=e.sent[e.t0]();case 14:if(i=(u=s.next()).done){e.next=26;break}return c=u.value,l=this.join(c),e.next=19,l.stat();case 19:f=e.sent,(l=f.isDirectory()?l.asDirectory():l)._assignPropsFromStat(f),r.push(l);case 23:i=!0,e.next=14;break;case 26:e.next=32;break;case 28:e.prev=28,e.t1=e.catch(9),o=!0,a=e.t1;case 32:e.prev=32,e.prev=33,!i&&s.return&&s.return();case 35:if(e.prev=35,!o){e.next=38;break}throw a;case 38:return e.finish(35);case 39:return e.finish(32);case 40:return t&&(r=n(t,r)),e.abrupt("return",r);case 42:return e.next=44,this.dirList(1,m);case 44:return p=e.sent,d=p.filter(function(e){return e.isDirectory()}),e.abrupt("return",Promise.all(d.map(function(e){return e.dirList("number"==typeof h?h-1:h,m)})).then(function(e){return e.reduce(function(e,t){return e.concat(t)},p)}));case 47:case"end":return e.stop()}},e,this,[[9,28,32,40],[33,,35,39]])}));return function(){return e.apply(this,arguments)}}()},{key:"isEmptyDirectory",value:function(){var e=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dirList();case 2:return e.t0=e.sent.length,e.abrupt("return",0===e.t0);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"rename",value:function(){var e=h(regeneratorRuntime.mark(function e(r){var n,i,o,a,s,u,c,l,f,p,d,h,m,v,y,b,_,w,x,k;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r instanceof this.constructor){e.next=2;break}return e.abrupt("return",g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"rename",this).call(this,r));case 2:if(!this.isFile()){e.next=7;break}r=r.asFile(),L(this.path(),r.path()),e.next=93;break;case 7:return r=r.asDirectory(),e.next=10,r.ensureExistance();case 10:return n=[],i=[],o=!0,a=!1,s=void 0,e.prev=14,e.next=17,this.dirList("infinity");case 17:e.t0=Symbol.iterator,u=e.sent[e.t0]();case 19:if(o=(c=u.next()).done){e.next=25;break}(l=c.value).isDirectory()?i.push(l):n.push(l);case 22:o=!0,e.next=19;break;case 25:e.next=31;break;case 27:e.prev=27,e.t1=e.catch(14),a=!0,s=e.t1;case 31:e.prev=31,e.prev=32,!o&&u.return&&u.return();case 34:if(e.prev=34,!a){e.next=37;break}throw s;case 37:return e.finish(34);case 38:return e.finish(31);case 39:f=!0,p=!1,d=void 0,e.prev=42,h=i[Symbol.iterator]();case 44:if(f=(m=h.next()).done){e.next=51;break}return v=m.value,e.next=48,r.join(v.relativePathFrom(this)).ensureExistance();case 48:f=!0,e.next=44;break;case 51:e.next=57;break;case 53:e.prev=53,e.t2=e.catch(42),p=!0,d=e.t2;case 57:e.prev=57,e.prev=58,!f&&h.return&&h.return();case 60:if(e.prev=60,!p){e.next=63;break}throw d;case 63:return e.finish(60);case 64:return e.finish(57);case 65:y=!0,b=!1,_=void 0,e.prev=68,w=n[Symbol.iterator]();case 70:if(y=(x=w.next()).done){e.next=77;break}return k=x.value,e.next=74,k.rename(r.join(k.relativePathFrom(this)));case 74:y=!0,e.next=70;break;case 77:e.next=83;break;case 79:e.prev=79,e.t3=e.catch(68),b=!0,_=e.t3;case 83:e.prev=83,e.prev=84,!y&&w.return&&w.return();case 86:if(e.prev=86,!b){e.next=89;break}throw _;case 89:return e.finish(86);case 90:return e.finish(83);case 91:return e.next=93,this.remove();case 93:return e.abrupt("return",r);case 94:case"end":return e.stop()}},e,this,[[14,27,31,39],[32,,34,38],[42,53,57,65],[58,,60,64],[68,79,83,91],[84,,86,90]])}));return function(t){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=h(regeneratorRuntime.mark(function e(){var t,r,n,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.exists();case 2:if(e.sent){e.next=5;break}e.next=41;break;case 5:if(!this.isDirectory()){e.next=39;break}return t=!0,r=!1,n=void 0,e.prev=9,e.next=12,this.dirList();case 12:e.t0=Symbol.iterator,i=e.sent[e.t0]();case 14:if(t=(o=i.next()).done){e.next=21;break}return a=o.value,e.next=18,a.remove();case 18:t=!0,e.next=14;break;case 21:e.next=27;break;case 23:e.prev=23,e.t1=e.catch(9),r=!0,n=e.t1;case 27:e.prev=27,e.prev=28,!t&&i.return&&i.return();case 30:if(e.prev=30,!r){e.next=33;break}throw n;case 33:return e.finish(30);case 34:return e.finish(27);case 35:return e.next=37,P(this.path());case 37:e.next=41;break;case 39:return e.next=41,T(this.path());case 41:return e.abrupt("return",this);case 42:case"end":return e.stop()}},e,this,[[9,23,27,35],[28,,30,34]])}));return function(){return e.apply(this,arguments)}}()},{key:"readProperties",value:function(){var e=h(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this.stat();case 3:return e.t1=e.sent,e.abrupt("return",e.t0._assignPropsFromStat.call(e.t0,e.t1));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_assignPropsFromStat",value:function(e){return this.assignProperties({lastModified:e.mtime,created:e.ctime,size:e.size,type:e.isDirectory()?"directory":"file",isLink:e.isSymbolicLink()})}}]),t}(S)},M=/\//g,q=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(m(this,e),!t||"string"!=typeof t)throw new Error("LocalResourceInMemoryBackend needs name!");this.name=t,this._filespec=r}return v(e,null,[{key:"removeHost",value:function(e){delete this.hosts[e]}},{key:"ensure",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.named(r.host);return Promise.resolve().then(function(){return e?U("local://"+n.name,e):null}).then(function(){return t})}},{key:"named",value:function(e){return e||(e="default"),this.hosts[e]||(this.hosts[e]=new this(e))}},{key:"hosts",get:function(){return this._hosts||(this._hosts={})}}]),v(e,[{key:"get",value:function(e){return this._filespec[e]}},{key:"set",value:function(e,t){this._filespec[e]=t}},{key:"write",value:function(e,t){var r=this._filespec[e];r||(r=this._filespec[e]={created:new Date}),r.content=t,r.isDirectory=!1,r.lastModified=new Date}},{key:"read",value:function(e){var t=this._filespec[e];return t&&t.content?t.content:""}},{key:"mkdir",value:function(e){var t=this._filespec[e];t&&t.isDirectory||(t||(t=this._filespec[e]={created:new Date}),t.content&&delete t.content,t.isDirectory=!0,t.lastModified=new Date)}},{key:"partialFilespec",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,r={},n=this.filespec,i=Object.keys(n),o=0;o<i.length;o++){var a=i[o];if(a.startsWith(e)&&e!==a){var s=a.slice(e.length);(s.includes("/")?s.match(M).length+1:1)>t||(r[a]=n[a])}}return r}},{key:"filespec",get:function(){return this._filespec},set:function(e){this._filespec=e}}]),e}(),W={name:"local-resource",matches:function(e){return e.startsWith("local:")},resourceClass:function(e){function t(){return m(this,t),_(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return b(t,e),v(t,[{key:"read",value:function(){return Promise.resolve(this.localBackend.read(this.path()))}},{key:"write",value:function(e){if(this.isDirectory())throw new Error("Cannot write into a directory! ("+this.url+")");var t=this.localBackend.get(this.path());if(t&&t.isDirectory)throw new Error(this.url+" already exists and is a directory (cannot write into it!)");return this.localBackend.write(this.path(),e),Promise.resolve(this)}},{key:"mkdir",value:function(){if(!this.isDirectory())throw new Error("Cannot mkdir a file! ("+this.url+")");var e=this.localBackend.get(this.path());if(e&&e.isDirectory)return Promise.resolve(this);if(e&&!e.isDirectory)throw new Error(this.url+" already exists and is a file (cannot mkdir it!)");return this.localBackend.mkdir(this.path()),Promise.resolve(this)}},{key:"exists",value:function(){return Promise.resolve(this.isRoot()||this.path()in this.localBackend.filespec)}},{key:"remove",value:function(){var e=this,t=this.path();return Object.keys(this.localBackend.filespec).forEach(function(r){return r.startsWith(t)&&delete e.localBackend.filespec[r]}),Promise.resolve(this)}},{key:"readProperties",value:function(){throw new Error("not yet implemented")}},{key:"dirList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isDirectory())return this.asDirectory().dirList(t,r);var n=r.exclude,i=this.path(),o=[],a=Object.keys(this.localBackend.filespec);"infinity"===t&&(t=1/0);for(var s=0;s<a.length;s++){var u=a[s];if(u.startsWith(i)&&i!==u){var c=u.slice(i.length);if(!((c.includes("/")?c.match(M).length+1:1)>t&&"continue"===function(){var r=e.join(c.split("/").slice(0,t).join("/")+"/");return o.some(function(e){return e.equals(r)})||o.push(r),"continue"}())){var f=this.join(c);n&&!l(f,n)||o.push(f)}}}return Promise.resolve(o)}},{key:"localBackend",get:function(){return q.named(this.host())}}]),t}(S)},$=$||[];p(W),p(C),p(N);var U=function(){var e=h(regeneratorRuntime.mark(function e(t,r,n){var i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=f(t,n).asDirectory(),e.next=3,i.ensureExistance();case 3:e.t0=regeneratorRuntime.keys(r);case 4:if((e.t1=e.t0()).done){e.next=18;break}if(o=e.t1.value,r.hasOwnProperty(o)){e.next=8;break}return e.abrupt("continue",4);case 8:if(a=i.join(o),"object"!==d(r[o])){e.next=14;break}return e.next=12,U(a,r[o],n);case 12:e.next=16;break;case 14:return e.next=16,a.write(r[o]);case 16:e.next=4;break;case 18:return e.abrupt("return",i);case 19:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),z=function(){var e=h(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!("fetch"in System.global)){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:if(t=System.decanonicalize("lively.resources"),!System.get("@system-env").node){e.next=16;break}e.prev=4,r=System._nodeRequire("fetch-ponyfill"),e.next=14;break;case 8:return e.prev=8,e.t0=e.catch(4),e.next=12,System.normalize("fetch-ponyfill",t);case 12:n=e.sent.replace("file://",""),r=System._nodeRequire(n);case 14:e.next=19;break;case 16:return e.next=18,System.import("fetch-ponyfill",t);case 18:r=e.sent;case 19:Object.assign(System.global,r());case 20:case"end":return e.stop()}},e,this,[[4,8]])}));return function(){return e.apply(this,arguments)}}();e.resource=f,e.createFiles=U,e.loadViaScript=function(e,t){var r=document.head,n=r.namespaceURI;return new Promise(function(t,i){var o=document.createElementNS(n,"script");o.setAttribute("type","text/ecmascript"),r.appendChild(o),o.setAttributeNS(null,"id",e),"http://www.w3.org/2000/svg"===o.namespaceURI?o.setAttributeNS("http://www.w3.org/1999/xlink","href",e):o.setAttribute("src",e),o.onload=t,o.onerror=i,o.setAttributeNS(null,"async",!0)})},e.ensureFetch=z,e.registerExtension=p,e.unregisterExtension=function(e){var t="string"==typeof e?e:e.name;$=$.filter(function(e){return e.name!==t})},e.Resource=S}(this.lively.resources=this.lively.resources||{},"undefined"!=typeof module&&"function"==typeof module.require?module.require("fs"):{readFile:function(){throw new Error("fs module not available")}}),"undefined"!=typeof module&&module.exports&&(module.exports=e.lively.resources)}(),function(){var e=function(){var e={},t={exports:e};return function(r){if("object"==typeof e&&void 0!==t)t.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).PouchDB=r()}}(function(){return function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){var r=t[a][1][e];return i(r||e)},l,l.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,r){"use strict";t.exports=function(e){return function(){var t=arguments.length;if(t){for(var r=[],n=-1;++n<t;)r[n]=arguments[n];return e.call(this,r)}return e.call(this,[])}}},{}],2:[function(e,t,r){(function(n){function i(){try{return r.storage.debug}catch(e){}if(void 0!==n&&"env"in n)return n.env.DEBUG}(r=t.exports=e(3)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},r.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+r.humanize(this.diff),t){var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,n)}},r.save=function(e){try{null==e?r.storage.removeItem("debug"):r.storage.debug=e}catch(e){}},r.load=i,r.useColors=function(){return!("undefined"==typeof window||!window||void 0===window.process||"renderer"!==window.process.type)||"undefined"!=typeof document&&document&&"WebkitAppearance"in document.documentElement.style||"undefined"!=typeof window&&window&&window.console&&(console.firebug||console.exception&&console.table)||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},r.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),r.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],r.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},r.enable(i())}).call(this,e(9))},{3:3,9:9}],3:[function(e,t,r){function n(e){var t,n=0;for(t in e)n=(n<<5)-n+e.charCodeAt(t),n|=0;return r.colors[Math.abs(n)%r.colors.length]}function i(e){function t(){if(t.enabled){var e=t,n=+new Date,i=n-(o||n);e.diff=i,e.prev=o,e.curr=n,o=n;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=r.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var u=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(t,n){if("%%"===t)return t;u++;var i=r.formatters[n];if("function"==typeof i){var o=a[u];t=i.call(e,o),a.splice(u,1),u--}return t}),r.formatArgs.call(e,a),(t.log||r.log||console.log.bind(console)).apply(e,a)}}return t.namespace=e,t.enabled=r.enabled(e),t.useColors=r.useColors(),t.color=n(e),"function"==typeof r.init&&r.init(t),t}(r=t.exports=i.debug=i.default=i).coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){r.enable("")},r.enable=function(e){r.save(e);for(var t=(e||"").split(/[\s,]+/),n=t.length,i=0;i<n;i++)t[i]&&("-"===(e=t[i].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")))},r.enabled=function(e){var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=e(8),r.names=[],r.skips=[],r.formatters={};var o},{8:8}],4:[function(e,t,r){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"number"==typeof e}function a(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,r,n,o,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(r=this._events[e],s(r))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),r.apply(this,o)}else if(a(r))for(o=Array.prototype.slice.call(arguments,1),n=(c=r.slice()).length,u=0;u<n;u++)c[u].apply(this,o);return!0},n.prototype.addListener=function(e,t){var r;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(r=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var n=!1;return r.listener=t,this.on(e,r),this},n.prototype.removeListener=function(e,t){var r,n,o,s;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],o=r.length,n=-1,r===t||i(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(r)){for(s=o;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){n=s;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],i(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],5:[function(e,t,r){(function(e){"use strict";function r(){c=!0;for(var e,t,r=l.length;r;){for(t=l,l=[],e=-1;++e<r;)t[e]();r=l.length}c=!1}var n,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,a=new i(r),s=e.document.createTextNode("");a.observe(s,{characterData:!0}),n=function(){s.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){r(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(r,0)};else{var u=new e.MessageChannel;u.port1.onmessage=r,n=function(){u.port2.postMessage(0)}}var c,l=[];t.exports=function(e){1!==l.push(e)||c||n()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],7:[function(e,t,r){"use strict";function n(){}function i(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,e!==n&&u(this,e)}function o(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function a(e,t,r){l(function(){var n;try{n=t(r)}catch(t){return f.reject(e,t)}n===e?f.reject(e,new TypeError("Cannot resolve promise with itself")):f.resolve(e,n)})}function s(e){var t=e&&e.then;if(e&&"object"==typeof e&&"function"==typeof t)return function(){t.apply(e,arguments)}}function u(e,t){function r(t){i||(i=!0,f.reject(e,t))}function n(t){i||(i=!0,f.resolve(e,t))}var i=!1,o=c(function(){t(n,r)});"error"===o.status&&r(o.value)}function c(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}var l=e(5),f={},p=["REJECTED"],d=["FULFILLED"],h=["PENDING"];t.exports=i,i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){if("function"!=typeof e&&this.state===d||"function"!=typeof t&&this.state===p)return this;var r=new this.constructor(n);return this.state!==h?a(r,this.state===d?e:t,this.outcome):this.queue.push(new o(r,e,t)),r},o.prototype.callFulfilled=function(e){f.resolve(this.promise,e)},o.prototype.otherCallFulfilled=function(e){a(this.promise,this.onFulfilled,e)},o.prototype.callRejected=function(e){f.reject(this.promise,e)},o.prototype.otherCallRejected=function(e){a(this.promise,this.onRejected,e)},f.resolve=function(e,t){var r=c(s,t);if("error"===r.status)return f.reject(e,r.value);var n=r.value;if(n)u(e,n);else{e.state=d,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},f.reject=function(e,t){e.state=p,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},i.resolve=function(e){return e instanceof this?e:f.resolve(new this(n),e)},i.reject=function(e){var t=new this(n);return f.reject(t,e)},i.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var o=new Array(r),a=0,s=-1,u=new this(n);++s<r;)!function(e,n){t.resolve(e).then(function(e){o[n]=e,++a!==r||i||(i=!0,f.resolve(u,o))},function(e){i||(i=!0,f.reject(u,e))})}(e[s],s);return u},i.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var o=-1,a=new this(n);++o<r;)!function(e){t.resolve(e).then(function(e){i||(i=!0,f.resolve(a,e))},function(e){i||(i=!0,f.reject(a,e))})}(e[o]);return a}},{5:5}],8:[function(e,t,r){function n(e){if(!((e=String(e)).length>1e4)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*f;case"days":case"day":case"d":return r*l;case"hours":case"hour":case"hrs":case"hr":case"h":return r*c;case"minutes":case"minute":case"mins":case"min":case"m":return r*u;case"seconds":case"second":case"secs":case"sec":case"s":return r*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function i(e){return e>=l?Math.round(e/l)+"d":e>=c?Math.round(e/c)+"h":e>=u?Math.round(e/u)+"m":e>=s?Math.round(e/s)+"s":e+"ms"}function o(e){return a(e,l,"day")||a(e,c,"hour")||a(e,u,"minute")||a(e,s,"second")||e+" ms"}function a(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var s=1e3,u=60*s,c=60*u,l=24*c,f=365.25*l;t.exports=function(e,t){t=t||{};var r=typeof e;if("string"===r&&e.length>0)return n(e);if("number"===r&&!1===isNaN(e))return t.long?o(e):i(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],9:[function(e,t,r){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(f===setTimeout)return setTimeout(e,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function a(e){if(p===clearTimeout)return clearTimeout(e);if((p===i||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(e);try{return p(e)}catch(t){try{return p.call(null,e)}catch(t){return p.call(this,e)}}}function s(){v&&h&&(v=!1,h.length?m=h.concat(m):y=-1,m.length&&u())}function u(){if(!v){var e=o(s);v=!0;for(var t=m.length;t;){for(h=m,m=[];++y<t;)h&&h[y].run();y=-1,t=m.length}h=null,v=!1,a(e)}}function c(e,t){this.fun=e,this.array=t}function l(){}var f,p,d=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(e){f=n}try{p="function"==typeof clearTimeout?clearTimeout:i}catch(e){p=i}}();var h,m=[],v=!1,y=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];m.push(new c(e,t)),1!==m.length||v||o(u)},c.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=l,d.addListener=l,d.once=l,d.off=l,d.removeListener=l,d.removeAllListeners=l,d.emit=l,d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],10:[function(e,t,r){(function(){var e={}.hasOwnProperty,r=[].slice;t.exports=function(t,n){var i,o,a,s;o=[],s=[];for(i in n)e.call(n,i)&&(a=n[i],"this"!==i&&(o.push(i),s.push(a)));return Function.apply(null,r.call(o).concat([t])).apply(n.this,s)}}).call(this)},{}],11:[function(e,t,r){!function(e){if("object"==typeof r)t.exports=e();else{var n;try{n=window}catch(e){n=self}n.SparkMD5=e()}}(function(e){"use strict";function t(e,t){var r=e[0],n=e[1],i=e[2],o=e[3];n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&i)+t[1]-389564586|0)<<12|o>>>20)+r|0)&r|~o&n)+t[2]+606105819|0)<<17|i>>>15)+o|0)&o|~i&r)+t[3]-1044525330|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&i)+t[5]+1200080426|0)<<12|o>>>20)+r|0)&r|~o&n)+t[6]-1473231341|0)<<17|i>>>15)+o|0)&o|~i&r)+t[7]-45705983|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&i)+t[9]-1958414417|0)<<12|o>>>20)+r|0)&r|~o&n)+t[10]-42063|0)<<17|i>>>15)+o|0)&o|~i&r)+t[11]-1990404162|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&i)+t[13]-40341101|0)<<12|o>>>20)+r|0)&r|~o&n)+t[14]-1502002290|0)<<17|i>>>15)+o|0)&o|~i&r)+t[15]+1236535329|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[1]-165796510|0)<<5|r>>>27)+n|0)&i|n&~i)+t[6]-1069501632|0)<<9|o>>>23)+r|0)&n|r&~n)+t[11]+643717713|0)<<14|i>>>18)+o|0)&r|o&~r)+t[0]-373897302|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[5]-701558691|0)<<5|r>>>27)+n|0)&i|n&~i)+t[10]+38016083|0)<<9|o>>>23)+r|0)&n|r&~n)+t[15]-660478335|0)<<14|i>>>18)+o|0)&r|o&~r)+t[4]-405537848|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[9]+568446438|0)<<5|r>>>27)+n|0)&i|n&~i)+t[14]-1019803690|0)<<9|o>>>23)+r|0)&n|r&~n)+t[3]-187363961|0)<<14|i>>>18)+o|0)&r|o&~r)+t[8]+1163531501|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[13]-1444681467|0)<<5|r>>>27)+n|0)&i|n&~i)+t[2]-51403784|0)<<9|o>>>23)+r|0)&n|r&~n)+t[7]+1735328473|0)<<14|i>>>18)+o|0)&r|o&~r)+t[12]-1926607734|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[5]-378558|0)<<4|r>>>28)+n|0)^n^i)+t[8]-2022574463|0)<<11|o>>>21)+r|0)^r^n)+t[11]+1839030562|0)<<16|i>>>16)+o|0)^o^r)+t[14]-35309556|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[1]-1530992060|0)<<4|r>>>28)+n|0)^n^i)+t[4]+1272893353|0)<<11|o>>>21)+r|0)^r^n)+t[7]-155497632|0)<<16|i>>>16)+o|0)^o^r)+t[10]-1094730640|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[13]+681279174|0)<<4|r>>>28)+n|0)^n^i)+t[0]-358537222|0)<<11|o>>>21)+r|0)^r^n)+t[3]-722521979|0)<<16|i>>>16)+o|0)^o^r)+t[6]+76029189|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[9]-640364487|0)<<4|r>>>28)+n|0)^n^i)+t[12]-421815835|0)<<11|o>>>21)+r|0)^r^n)+t[15]+530742520|0)<<16|i>>>16)+o|0)^o^r)+t[2]-995338651|0)<<23|n>>>9)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[0]-198630844|0)<<6|r>>>26)+n|0)|~i))+t[7]+1126891415|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[14]-1416354905|0)<<15|i>>>17)+o|0)|~r))+t[5]-57434055|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[12]+1700485571|0)<<6|r>>>26)+n|0)|~i))+t[3]-1894986606|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[10]-1051523|0)<<15|i>>>17)+o|0)|~r))+t[1]-2054922799|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[8]+1873313359|0)<<6|r>>>26)+n|0)|~i))+t[15]-30611744|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[6]-1560198380|0)<<15|i>>>17)+o|0)|~r))+t[13]+1309151649|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[4]-145523070|0)<<6|r>>>26)+n|0)|~i))+t[11]-1120210379|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[2]+718787259|0)<<15|i>>>17)+o|0)|~r))+t[9]-343485551|0)<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0}function r(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function n(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function i(e){var n,i,o,a,s,u,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=c;n+=64)t(l,r(e.substring(n-64,n)));for(i=(e=e.substring(n-64)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<i;n+=1)o[n>>2]|=e.charCodeAt(n)<<(n%4<<3);if(o[n>>2]|=128<<(n%4<<3),n>55)for(t(l,o),n=0;n<16;n+=1)o[n]=0;return a=8*c,a=a.toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),u=parseInt(a[1],16)||0,o[14]=s,o[15]=u,t(l,o),l}function o(e){var r,i,o,a,s,u,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(r=64;r<=c;r+=64)t(l,n(e.subarray(r-64,r)));for(i=(e=r-64<c?e.subarray(r-64):new Uint8Array(0)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<i;r+=1)o[r>>2]|=e[r]<<(r%4<<3);if(o[r>>2]|=128<<(r%4<<3),r>55)for(t(l,o),r=0;r<16;r+=1)o[r]=0;return a=8*c,a=a.toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),u=parseInt(a[1],16)||0,o[14]=s,o[15]=u,t(l,o),l}function a(e){var t,r="";for(t=0;t<4;t+=1)r+=h[e>>8*t+4&15]+h[e>>8*t&15];return r}function s(e){var t;for(t=0;t<e.length;t+=1)e[t]=a(e[t]);return e.join("")}function u(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function c(e,t){var r,n=e.length,i=new ArrayBuffer(n),o=new Uint8Array(i);for(r=0;r<n;r+=1)o[r]=e.charCodeAt(r);return t?o:i}function l(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function f(e,t,r){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e)),n.set(new Uint8Array(t),e.byteLength),r?n:n.buffer}function p(e){var t,r=[],n=e.length;for(t=0;t<n-1;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function d(){this.reset()}var h=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==s(i("hello"))&&function(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r},"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return e=0|e||0,e<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,n){var i,o,a,s,u=this.byteLength,c=t(r,u),l=u;return n!==e&&(l=t(n,u)),c>l?new ArrayBuffer(0):(i=l-c,o=new ArrayBuffer(i),a=new Uint8Array(o),s=new Uint8Array(this,c,i),a.set(s),o)}}(),d.prototype.append=function(e){return this.appendBinary(u(e)),this},d.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var n,i=this._buff.length;for(n=64;n<=i;n+=64)t(this._hash,r(this._buff.substring(n-64,n)));return this._buff=this._buff.substring(n-64),this},d.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(o,i),r=s(this._hash),e&&(r=p(r)),this.reset(),r},d.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},d.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},d.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},d.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},d.prototype._finish=function(e,r){var n,i,o,a=r;if(e[a>>2]|=128<<(a%4<<3),a>55)for(t(this._hash,e),a=0;a<16;a+=1)e[a]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),o=parseInt(n[1],16)||0,e[14]=i,e[15]=o,t(this._hash,e)},d.hash=function(e,t){return d.hashBinary(u(e),t)},d.hashBinary=function(e,t){var r=s(i(e));return t?p(r):r},d.ArrayBuffer=function(){this.reset()},d.ArrayBuffer.prototype.append=function(e){var r,i=f(this._buff.buffer,e,!0),o=i.length;for(this._length+=e.byteLength,r=64;r<=o;r+=64)t(this._hash,n(i.subarray(r-64,r)));return this._buff=r-64<o?new Uint8Array(i.buffer.slice(r-64)):new Uint8Array(0),this},d.ArrayBuffer.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n[t]<<(t%4<<3);return this._finish(o,i),r=s(this._hash),e&&(r=p(r)),this.reset(),r},d.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},d.ArrayBuffer.prototype.getState=function(){var e=d.prototype.getState.call(this);return e.buff=l(e.buff),e},d.ArrayBuffer.prototype.setState=function(e){return e.buff=c(e.buff,!0),d.prototype.setState.call(this,e)},d.ArrayBuffer.prototype.destroy=d.prototype.destroy,d.ArrayBuffer.prototype._finish=d.prototype._finish,d.ArrayBuffer.hash=function(e,t){var r=s(o(new Uint8Array(e)));return t?p(r):r},d})},{}],12:[function(e,t,r){"use strict";function n(e,t,r){var n=r[r.length-1];e===n.element&&(r.pop(),n=r[r.length-1]);var i=n.element,o=n.index;Array.isArray(i)?i.push(e):o===t.length-2?i[t.pop()]=e:t.push(e)}r.stringify=function(e){var t=[];t.push({obj:e});for(var r,n,i,o,a,s,u,c,l,f,p,d="";r=t.pop();)if(n=r.obj,i=r.prefix||"",o=r.val||"",d+=i,o)d+=o;else if("object"!=typeof n)d+=void 0===n?null:JSON.stringify(n);else if(null===n)d+="null";else if(Array.isArray(n)){for(t.push({val:"]"}),a=n.length-1;a>=0;a--)s=0===a?"":",",t.push({obj:n[a],prefix:s});t.push({val:"["})}else{u=[];for(c in n)n.hasOwnProperty(c)&&u.push(c);for(t.push({val:"}"}),a=u.length-1;a>=0;a--)f=n[l=u[a]],p=a>0?",":"",p+=JSON.stringify(l)+":",t.push({obj:f,prefix:p});t.push({val:"{"})}return d},r.parse=function(e){for(var t,r,i,o,a,s,u,c,l,f=[],p=[],d=0;;)if("}"!==(t=e[d++])&&"]"!==t&&void 0!==t)switch(t){case" ":case"\t":case"\n":case":":case",":break;case"n":d+=3,n(null,f,p);break;case"t":d+=3,n(!0,f,p);break;case"f":d+=4,n(!1,f,p);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(r="",d--;;){if(i=e[d++],!/[\d\.\-e\+]/.test(i)){d--;break}r+=i}n(parseFloat(r),f,p);break;case'"':for(o="",a=void 0,s=0;;){if('"'===(u=e[d++])&&("\\"!==a||s%2!=1))break;o+=u,"\\"===(a=u)?s++:s=0}n(JSON.parse('"'+o+'"'),f,p);break;case"[":c={element:[],index:f.length},f.push(c.element),p.push(c);break;case"{":l={element:{},index:f.length},f.push(l.element),p.push(l);break;default:throw new Error("unexpectedly reached end of input: "+t)}else{if(1===f.length)return f.pop();n(f.pop(),f,p)}}},{}],13:[function(e,t,r){(function(r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function i(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer||"undefined"!=typeof Blob&&e instanceof Blob}function o(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),r=new Uint8Array(t),n=new Uint8Array(e);return r.set(n),t}function a(e){if(e instanceof ArrayBuffer)return o(e);var t=e.size,r=e.type;return"function"==typeof e.slice?e.slice(0,t,r):e.webkitSlice(0,t,r)}function s(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var r=t.constructor;return"function"==typeof r&&r instanceof r&&kn.call(r)==En}function u(e){var t,r,n;if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(t=[],r=0,n=e.length;r<n;r++)t[r]=u(e[r]);return t}if(e instanceof Date)return e.toISOString();if(i(e))return a(e);if(!s(e))return e;t={};for(r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=u(e[r]);void 0!==o&&(t[r]=o)}return t}function c(e){var t=!1;return hn(function(r){if(t)throw new Error("once called more than once");t=!0,e.apply(this,r)})}function l(e){return hn(function(t){var r=this,n="function"==typeof(t=u(t))[t.length-1]&&t.pop(),i=new xn(function(n,i){var o;try{var a=c(function(e,t){e?i(e):n(t)});t.push(a),(o=e.apply(r,t))&&"function"==typeof o.then&&n(o)}catch(e){i(e)}});return n&&i.then(function(e){n(null,e)},n),i})}function f(e,t){function r(e,t,r){if(Sn.enabled){for(var n=[e.name,t],i=0;i<r.length-1;i++)n.push(r[i]);Sn.apply(null,n);var o=r[r.length-1];r[r.length-1]=function(r,n){var i=[e.name,t];i=i.concat(r?["error",r]:["success",n]),Sn.apply(null,i),o(r,n)}}}return l(hn(function(n){if(this._closed)return xn.reject(new Error("database is closed"));if(this._destroyed)return xn.reject(new Error("database is destroyed"));var i=this;return r(i,e,n),this.taskqueue.isReady?t.apply(this,n):new xn(function(t,r){i.taskqueue.addTask(function(o){o?r(o):t(i[e].apply(i,n))})})}))}function p(e){return"$"+e}function d(e){return e.substring(1)}function h(){this._store={}}function m(e){if(this._store=new h,e&&Array.isArray(e))for(var t=0,r=e.length;t<r;t++)this.add(e[t])}function v(e,t){for(var r={},n=0,i=t.length;n<i;n++){var o=t[n];o in e&&(r[o]=e[o])}return r}function y(e){return e}function g(e){return[{ok:e}]}function b(e,t,r){function n(){var e=[];p.forEach(function(t){t.docs.forEach(function(r){e.push({id:t.id,docs:[r]})})}),r(null,{results:e})}function i(){++f===l&&n()}function o(e,t,r){p[e]={id:t,docs:r},i()}function a(){if(!(h>=d.length)){var e=Math.min(h+Fn,d.length),t=d.slice(h,e);s(t,h),h+=t.length}}function s(r,n){r.forEach(function(r,i){var s=n+i,u=c.get(r),l=v(u[0],["atts_since","attachments"]);l.open_revs=u.map(function(e){return e.rev}),l.open_revs=l.open_revs.filter(y);var f=y;0===l.open_revs.length&&(delete l.open_revs,f=g),["revs","attachments","binary","ajax","latest"].forEach(function(e){e in t&&(l[e]=t[e])}),e.get(r,l,function(e,t){var n;n=e?[{error:e}]:f(t),o(s,r,n),a()})})}var u=t.docs,c=new Dn;u.forEach(function(e){c.has(e.id)?c.get(e.id).push(e):c.set(e.id,[e])});var l=c.size,f=0,p=new Array(l),d=[];c.forEach(function(e,t){d.push(t)});var h=0;a()}function _(){return"undefined"!=typeof chrome&&void 0!==chrome.storage&&void 0!==chrome.storage.local}function w(){return Cn}function x(e){_()?chrome.storage.onChanged.addListener(function(t){null!=t.db_name&&e.emit(t.dbName.newValue)}):w()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(t){e.emit(t.key)}):window.attachEvent("storage",function(t){e.emit(t.key)}))}function k(){vn.EventEmitter.call(this),this._listeners={},x(this)}function E(e){if("undefined"!==console&&e in console){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function S(e,t){return e=parseInt(e,10)||0,(t=parseInt(t,10))!==t||t<=e?t=(e||1)<<1:t+=1,t>6e5&&(e=3e5,t=6e5),~~((t-e)*Math.random()+e)}function A(e){var t=0;return e||(t=2e3),S(e,t)}function D(e,t){E("info","The above "+e+" is totally normal. "+t)}function C(e,t,r){Error.call(this,r),this.status=e,this.name=t,this.message=r,this.error=!0}function F(e,t){function r(t){for(var r in e)"function"!=typeof e[r]&&(this[r]=e[r]);void 0!==t&&(this.reason=t)}return r.prototype=C.prototype,new r(t)}function O(e){if("object"!=typeof e){var t=e;(e=Nn).data=t}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}function j(e,t,r){try{return!e(t,r)}catch(e){var n="Filter function threw: "+e.toString();return F($n,n)}}function B(e){var t={},r=e.filter&&"function"==typeof e.filter;return t.query=e.query_params,function(n){n.doc||(n.doc={});var i=r&&j(e.filter,n.doc,t);if("object"==typeof i)return i;if(i)return!1;if(e.include_docs){if(!e.attachments)for(var o in n.doc._attachments)n.doc._attachments.hasOwnProperty(o)&&(n.doc._attachments[o].stub=!0)}else delete n.doc;return!0}}function R(e){for(var t=[],r=0,n=e.length;r<n;r++)t=t.concat(e[r]);return t}function P(e){var t;if(e?"string"!=typeof e?t=F(Tn):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=F(Ln)):t=F(In),t)throw t}function T(e,t){return"listenerCount"in e?e.listenerCount(t):vn.EventEmitter.listenerCount(e,t)}function I(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}function L(e){var t=I(e);return t?t.join("/"):null}function N(e){for(var t=Qn.exec(e),r={},n=14;n--;){var i=Jn[n],o=t[n]||"",a=-1!==["user","password"].indexOf(i);r[i]=a?decodeURIComponent(o):o}return r[Kn]={},r[Jn[12]].replace(Yn,function(e,t,n){t&&(r[Kn][t]=n)}),r}function M(e,t,r){return new xn(function(n,i){e.get(t,function(o,a){if(o){if(404!==o.status)return i(o);a={}}var s=a._rev,u=r(a);if(!u)return n({updated:!1,rev:s});u._id=t,u._rev=s,n(q(e,u,r))})})}function q(e,t,r){return e.put(t).then(function(e){return{updated:!0,rev:e.rev}},function(n){if(409!==n.status)throw n;return M(e,t._id,r)})}function W(e){return 0|Math.random()*e}function $(e,t){t=t||Xn.length;var r="",n=-1;if(e){for(;++n<e;)r+=Xn[W(t)];return r}for(;++n<36;)switch(n){case 8:case 13:case 18:case 23:r+="-";break;case 19:r+=Xn[3&W(16)|8];break;default:r+=Xn[W(16)]}return r}function U(e){for(var t,r,n,i,o=e.rev_tree.slice();i=o.pop();){var a=i.ids,s=a[2],u=i.pos;if(s.length)for(var c=0,l=s.length;c<l;c++)o.push({pos:u+1,ids:s[c]});else{var f=!!a[1].deleted,p=a[0];t&&!(n!==f?n:r!==u?r<u:t<p)||(t=p,r=u,n=f)}}return r+"-"+t}function z(e,t){for(var r,n=e.slice();r=n.pop();)for(var i=r.pos,o=r.ids,a=o[2],s=t(0===a.length,i,o[0],r.ctx,o[1]),u=0,c=a.length;u<c;u++)n.push({pos:i+1,ids:a[u],ctx:s})}function V(e,t){return e.pos-t.pos}function G(e){var t=[];z(e,function(e,r,n,i,o){e&&t.push({rev:r+"-"+n,pos:r,opts:o})}),t.sort(V).reverse();for(var r=0,n=t.length;r<n;r++)delete t[r].pos;return t}function H(e){for(var t=U(e),r=G(e.rev_tree),n=[],i=0,o=r.length;i<o;i++){var a=r[i];a.rev===t||a.opts.deleted||n.push(a.rev)}return n}function J(e){var t=[];return z(e.rev_tree,function(e,r,n,i,o){"available"!==o.status||e||(t.push(r+"-"+n),o.status="missing")}),t}function K(e){for(var t,r=[],n=e.slice();t=n.pop();){var i=t.pos,o=t.ids,a=o[0],s=o[1],u=o[2],c=0===u.length,l=t.history?t.history.slice():[];l.push({id:a,opts:s}),c&&r.push({pos:i+1-l.length,ids:l});for(var f=0,p=u.length;f<p;f++)n.push({pos:i+1,ids:u[f],history:l})}return r.reverse()}function Y(e,t){return e.pos-t.pos}function Q(e,t,r){for(var n,i=0,o=e.length;i<o;)r(e[n=i+o>>>1],t)<0?i=n+1:o=n;return i}function X(e,t,r){var n=Q(e,t,r);e.splice(n,0,t)}function Z(e,t){for(var r,n,i=t,o=e.length;i<o;i++){var a=e[i],s=[a.id,a.opts,[]];n?(n[2].push(s),n=s):r=n=s}return r}function ee(e,t){return e[0]<t[0]?-1:1}function te(e,t){for(var r=[{tree1:e,tree2:t}],n=!1;r.length>0;){var i=r.pop(),o=i.tree1,a=i.tree2;(o[1].status||a[1].status)&&(o[1].status="available"===o[1].status||"available"===a[1].status?"available":"missing");for(var s=0;s<a[2].length;s++)if(o[2][0]){for(var u=!1,c=0;c<o[2].length;c++)o[2][c][0]===a[2][s][0]&&(r.push({tree1:o[2][c],tree2:a[2][s]}),u=!0);u||(n="new_branch",X(o[2],a[2][s],ee))}else n="new_leaf",o[2][0]=a[2][s]}return{conflicts:n,tree:e}}function re(e,t,r){var n,i=[],o=!1,a=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var s=0,u=e.length;s<u;s++){var c=e[s];if(c.pos===t.pos&&c.ids[0]===t.ids[0])n=te(c.ids,t.ids),i.push({pos:c.pos,ids:n.tree}),o=o||n.conflicts,a=!0;else if(!0!==r){var l=c.pos<t.pos?c:t,f=c.pos<t.pos?t:c,p=f.pos-l.pos,d=[],h=[];for(h.push({ids:l.ids,diff:p,parent:null,parentIdx:null});h.length>0;){var m=h.pop();if(0!==m.diff)for(var v=m.ids[2],y=0,g=v.length;y<g;y++)h.push({ids:v[y],diff:m.diff-1,parent:m.ids,parentIdx:y});else m.ids[0]===f.ids[0]&&d.push(m)}var b=d[0];b?(n=te(b.ids,f.ids),b.parent[2][b.parentIdx]=n.tree,i.push({pos:l.pos,ids:l.ids}),o=o||n.conflicts,a=!0):i.push(c)}else i.push(c)}return a||i.push(t),i.sort(Y),{tree:i,conflicts:o||"internal_node"}}function ne(e,t){for(var r,n,i=K(e),o=0,a=i.length;o<a;o++){var s,u=i[o],c=u.ids;if(c.length>t){r||(r={});var l=c.length-t;s={pos:u.pos+l,ids:Z(c,l)};for(var f=0;f<l;f++){var p=u.pos+f+"-"+c[f].id;r[p]=!0}}else s={pos:u.pos,ids:Z(c,0)};n=n?re(n,s,!0).tree:[s]}return r&&z(n,function(e,t,n){delete r[t+"-"+n]}),{tree:n,revs:r?Object.keys(r):[]}}function ie(e,t,r){var n=re(e,t),i=ne(n.tree,r);return{tree:i.tree,stemmedRevs:i.revs,conflicts:n.conflicts}}function oe(e,t){for(var r,n=e.slice(),i=t.split("-"),o=parseInt(i[0],10),a=i[1];r=n.pop();){if(r.pos===o&&r.ids[0]===a)return!0;for(var s=r.ids[2],u=0,c=s.length;u<c;u++)n.push({pos:r.pos+1,ids:s[u]})}return!1}function ae(e){return e.ids}function se(e,t){t||(t=U(e));for(var r,n=t.substring(t.indexOf("-")+1),i=e.rev_tree.map(ae);r=i.pop();){if(r[0]===n)return!!r[1].deleted;i=i.concat(r[2])}}function ue(e){return/^_local/.test(e)}function ce(e,t){for(var r,n=t.rev_tree.slice();r=n.pop();){var i=r.pos,o=r.ids,a=o[0],s=o[1],u=o[2],c=0===u.length,l=r.history?r.history.slice():[];if(l.push({id:a,pos:i,opts:s}),c)for(var f=0,p=l.length;f<p;f++){var d=l[f];if(d.pos+"-"+d.id===e)return i+"-"+a}for(var h=0,m=u.length;h<m;h++)n.push({pos:i+1,ids:u[h],history:l})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}function le(e){return bn('"use strict";\nreturn '+e+";",{})}function fe(e){var t=["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+e+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n");return bn(t,{})}function pe(e,t){try{e.emit("change",t)}catch(e){E("error",'Error in .on("change", function):',e)}}function de(e,t,r){function n(){i.cancel()}vn.EventEmitter.call(this);var i=this;this.db=e;var o=(t=t?u(t):{}).complete=c(function(t,r){t?T(i,"error")>0&&i.emit("error",t):i.emit("complete",r),i.removeAllListeners(),e.removeListener("destroyed",n)});r&&(i.on("complete",function(e){r(null,e)}),i.on("error",r)),e.once("destroyed",n),t.onChange=function(e){i.isCancelled||pe(i,e)};var a=new xn(function(e,r){t.complete=function(t,n){t?r(t):e(n)}});i.once("cancel",function(){e.removeListener("destroyed",n),t.complete(null,{status:"cancelled"})}),this.then=a.then.bind(a),this.catch=a.catch.bind(a),this.then(function(e){o(null,e)},o),e.taskqueue.isReady?i.doChanges(t):e.taskqueue.addTask(function(e){e?t.complete(e):i.isCancelled?i.emit("cancel"):i.doChanges(t)})}function he(e,t,r){var n=[{rev:e._rev}];"all_docs"===r.style&&(n=G(t.rev_tree).map(function(e){return{rev:e.rev}}));var i={id:t.id,changes:n,doc:e};return se(t,e._rev)&&(i.deleted=!0),r.conflicts&&(i.doc._conflicts=H(t),i.doc._conflicts.length||delete i.doc._conflicts),i}function me(e,t){return e<t?-1:e>t?1:0}function ve(e){return function(t,r){t||r[0]&&r[0].error?e(t||r[0]):e(null,r.length?r[0]:r)}}function ye(e){for(var t=0;t<e.length;t++){var r=e[t];if(r._deleted)delete r._attachments;else if(r._attachments)for(var n=Object.keys(r._attachments),i=0;i<n.length;i++){var o=n[i];r._attachments[o]=v(r._attachments[o],["data","digest","content_type","length","revpos","stub"])}}}function ge(e,t){var r=me(e._id,t._id);return 0!==r?r:me(e._revisions?e._revisions.start:0,t._revisions?t._revisions.start:0)}function be(e){var t={},r=[];return z(e,function(e,n,i,o){var a=n+"-"+i;return e&&(t[a]=0),void 0!==o&&r.push({from:o,to:a}),a}),r.reverse(),r.forEach(function(e){void 0===t[e.from]?t[e.from]=1+t[e.to]:t[e.from]=Math.min(t[e.from],1+t[e.to])}),t}function _e(e,t,r){var n="limit"in t?t.keys.slice(t.skip,t.limit+t.skip):t.skip>0?t.keys.slice(t.skip):t.keys;if(t.descending&&n.reverse(),!n.length)return e._allDocs({limit:0},r);var i={offset:t.skip};return xn.all(n.map(function(r){var n=jn({key:r,deleted:"ok"},t);return["limit","skip","keys"].forEach(function(e){delete n[e]}),new xn(function(t,o){e._allDocs(n,function(e,n){if(e)return o(e);i.total_rows=n.total_rows,t(n.rows[0]||{key:r,error:"not_found"})})})})).then(function(e){return i.rows=e,i})}function we(e){var t=e._compactionQueue[0],r=t.opts,n=t.callback;e.get("_local/compaction").catch(function(){return!1}).then(function(t){t&&t.last_seq&&(r.last_seq=t.last_seq),e._compact(r,function(t,r){t?n(t):n(null,r),gn(function(){e._compactionQueue.shift(),e._compactionQueue.length&&we(e)})})})}function xe(e){return"_"===e.charAt(0)&&e+" is not a valid attachment name, attachment names cannot start with '_'"}function ke(){vn.EventEmitter.call(this)}function Ee(){this.isReady=!1,this.failed=!1,this.queue=[]}function Se(e,t){var r=e.match(/([a-z\-]*):\/\/(.*)/);if(r)return{name:/https?/.test(r[1])?r[1]+"://"+r[2]:r[2],adapter:r[1]};var n=De.adapters,i=De.preferredAdapters,o=De.prefix,a=t.adapter;if(!a)for(var s=0;s<i.length&&("idb"===(a=i[s])&&"websql"in n&&w()&&localStorage["_pouch__websqldb_"+o+e]);++s)E("log",'PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');var u=n[a];return{name:!(u&&"use_prefix"in u)||u.use_prefix?o+e:e,adapter:a}}function Ae(e){function t(){e.removeListener("closed",r),e.constructor.emit("destroyed",e.name)}function r(){e.removeListener("destroyed",t),n.delete(e.name)}var n=e.constructor._destructionListeners;e.once("destroyed",t),e.once("closed",r),n.has(e.name)||n.set(e.name,[]),n.get(e.name).push(function(){e.removeListener("destroyed",t),e.removeListener("closed",r),e.emit("destroyed")})}function De(e,t){if(!(this instanceof De))return new De(e,t);var r=this;if(t=t||{},e&&"object"==typeof e&&(e=(t=e).name,delete t.name),this.__opts=t=u(t),r.auto_compaction=t.auto_compaction,r.prefix=De.prefix,"string"!=typeof e)throw new Error("Missing/invalid DB name");var n=Se((t.prefix||"")+e,t);if(t.name=n.name,t.adapter=t.adapter||n.adapter,r.name=e,r._adapter=t.adapter,mn("pouchdb:adapter")("Picked adapter: "+t.adapter),!De.adapters[t.adapter]||!De.adapters[t.adapter].valid())throw new Error("Invalid Adapter: "+t.adapter);ke.call(r),r.taskqueue=new Ee,r.adapter=t.adapter,De.adapters[t.adapter].call(r,t,function(e){if(e)return r.taskqueue.fail(e);Ae(r),r.emit("created",r),De.emit("created",r.name),r.taskqueue.ready(r)})}function Ce(e){return e.reduce(function(e,t){return e[t]=!0,e},{})}function Fe(e){if(!/^\d+\-./.test(e))return F(Gn);var t=e.indexOf("-"),r=e.substring(0,t),n=e.substring(t+1);return{prefix:parseInt(r,10),id:n}}function Oe(e,t){for(var r=e.start-e.ids.length+1,n=e.ids,i=[n[0],t,[]],o=1,a=n.length;o<a;o++)i=[n[o],{status:"missing"},[i]];return[{pos:r,ids:i}]}function je(e,t){var r,n,i,o={status:"available"};if(e._deleted&&(o.deleted=!0),t)if(e._id||(e._id=$()),n=$(32,16).toLowerCase(),e._rev){if((i=Fe(e._rev)).error)return i;e._rev_tree=[{pos:i.prefix,ids:[i.id,{status:"missing"},[[n,o,[]]]]}],r=i.prefix+1}else e._rev_tree=[{pos:1,ids:[n,o,[]]}],r=1;else if(e._revisions&&(e._rev_tree=Oe(e._revisions,o),r=e._revisions.start,n=e._revisions.ids[0]),!e._rev_tree){if((i=Fe(e._rev)).error)return i;r=i.prefix,n=i.id,e._rev_tree=[{pos:r,ids:[n,o,[]]}]}P(e._id),e._rev=r+"-"+n;var a={metadata:{},data:{}};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var u="_"===s[0];if(u&&!ti[s]){var c=F(Wn,s);throw c.message=Wn.message+": "+s,c}u&&!ri[s]?a.metadata[s.slice(1)]=e[s]:a.data[s]=e[s]}return a}function Be(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)r.append(e[n]);return r.getBlob(t.type)}}function Re(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),i=0;i<t;i++)n[i]=e.charCodeAt(i);return r}function Pe(e,t){return Be([Re(e)],{type:t})}function Te(e,t){return Pe(ni(e),t)}function Ie(e){for(var t="",r=new Uint8Array(e),n=r.byteLength,i=0;i<n;i++)t+=String.fromCharCode(r[i]);return t}function Le(e,t){if("undefined"==typeof FileReader)return t(Ie((new FileReaderSync).readAsArrayBuffer(e)));var r=new FileReader,n="function"==typeof r.readAsBinaryString;r.onloadend=function(e){var r=e.target.result||"";if(n)return t(r);t(Ie(r))},n?r.readAsBinaryString(e):r.readAsArrayBuffer(e)}function Ne(e,t){Le(e,function(e){t(e)})}function Me(e,t){Ne(e,function(e){t(ii(e))})}function qe(e,t){if("undefined"==typeof FileReader)return t((new FileReaderSync).readAsArrayBuffer(e));var r=new FileReader;r.onloadend=function(e){var r=e.target.result||new ArrayBuffer(0);t(r)},r.readAsArrayBuffer(e)}function We(e){return ii(e)}function $e(e,t,r){return e.webkitSlice?e.webkitSlice(t,r):e.slice(t,r)}function Ue(e,t,r,n,i){(r>0||n<t.size)&&(t=$e(t,r,n)),qe(t,function(t){e.append(t),i()})}function ze(e,t,r,n,i){(r>0||n<t.length)&&(t=t.substring(r,n)),e.appendBinary(t),i()}function Ve(e,t){function r(){oi(i)}function n(){var e=We(l.end(!0));t(e),l.destroy()}function i(){var t=c*s,i=t+s;++c<u?f(l,e,t,i,r):f(l,e,t,i,n)}var o="string"==typeof e,a=o?e.length:e.size,s=Math.min(ai,a),u=Math.ceil(a/s),c=0,l=o?new _n:new _n.ArrayBuffer,f=o?ze:Ue;i()}function Ge(e){return _n.hash(e)}function He(e){try{return ni(e)}catch(e){return{error:F(Mn,"Attachment is not a valid base64 string")}}}function Je(e,t,r){var n=He(e.data);if(n.error)return r(n.error);e.length=n.length,e.data="blob"===t?Pe(n,e.content_type):"base64"===t?ii(n):n,Ve(n,function(t){e.digest="md5-"+t,r()})}function Ke(e,t,r){Ve(e.data,function(n){e.digest="md5-"+n,e.length=e.data.size||e.data.length||0,"binary"===t?Ne(e.data,function(t){e.data=t,r()}):"base64"===t?Me(e.data,function(t){e.data=t,r()}):r()})}function Ye(e,t,r){if(e.stub)return r();"string"==typeof e.data?Je(e,t,r):Ke(e,t,r)}function Qe(e,t,r){function n(){o++,e.length===o&&(i?r(i):r())}if(!e.length)return r();var i,o=0;e.forEach(function(e){var r=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],o=0;if(!r.length)return n();for(var a in e.data._attachments)e.data._attachments.hasOwnProperty(a)&&Ye(e.data._attachments[a],t,function(e){i=e,++o===r.length&&n()})})}function Xe(e,t,r,n,i,o,a,s){if(oe(t.rev_tree,r.metadata.rev))return n[i]=r,o();var u=t.winningRev||U(t),c="deleted"in t?t.deleted:se(t,u),l="deleted"in r.metadata?r.metadata.deleted:se(r.metadata),f=/^1-/.test(r.metadata.rev);if(c&&!l&&s&&f){var p=r.data;p._rev=u,p._id=r.metadata.id,r=je(p,s)}var d=ie(t.rev_tree,r.metadata.rev_tree[0],e);if(s&&(c&&l&&"new_leaf"!==d.conflicts||!c&&"new_leaf"!==d.conflicts||c&&!l&&"new_branch"===d.conflicts)){var h=F(Pn);return n[i]=h,o()}var m=r.metadata.rev;r.metadata.rev_tree=d.tree,r.stemmedRevs=d.stemmedRevs||[],t.rev_map&&(r.metadata.rev_map=t.rev_map);var v=U(r.metadata),y=se(r.metadata,v),g=c===y?0:c<y?-1:1;a(r,v,y,m===v?y:se(r.metadata,m),!0,g,i,o)}function Ze(e){return"missing"===e.metadata.rev_tree[0].ids[1].status}function et(e,t,r,n,i,o,a,s,u){function c(e,t,r){var n=U(e.metadata),i=se(e.metadata,n);if("was_delete"in s&&i)return o[t]=F(Rn,"deleted"),r();if(f&&Ze(e)){var u=F(Pn);return o[t]=u,r()}a(e,n,i,i,!1,i?0:1,t,r)}function l(){++d===h&&u&&u()}e=e||1e3;var f=s.new_edits,p=new Dn,d=0,h=t.length;t.forEach(function(e,t){if(e._id&&ue(e._id)){var n=e._deleted?"_removeLocal":"_putLocal";r[n](e,{ctx:i},function(e,r){o[t]=e||r,l()})}else{var a=e.metadata.id;p.has(a)?(h--,p.get(a).push([e,t])):p.set(a,[[e,t]])}}),p.forEach(function(t,r){function i(){++u<t.length?s():l()}function s(){var s=t[u],l=s[0],p=s[1];if(n.has(r))Xe(e,n.get(r),l,o,p,i,a,f);else{var d=ie([],l.metadata.rev_tree[0],e);l.metadata.rev_tree=d.tree,l.stemmedRevs=d.stemmedRevs||[],c(l,p,i)}}var u=0;s()})}function tt(e){try{return JSON.parse(e)}catch(t){return wn.parse(e)}}function rt(e){try{return JSON.stringify(e)}catch(t){return wn.stringify(e)}}function nt(e){return function(t){var r="unknown_error";t.target&&t.target.error&&(r=t.target.error.name||t.target.error.message),e(F(zn,r,t.type))}}function it(e,t,r){return{data:rt(e),winningRev:t,deletedOrLocal:r?"1":"0",seq:e.seq,id:e.id}}function ot(e){if(!e)return null;var t=tt(e.data);return t.winningRev=e.winningRev,t.deleted="1"===e.deletedOrLocal,t.seq=e.seq,t}function at(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function st(e,t,r,n){r?n(e?"string"!=typeof e?e:Te(e,t):Be([""],{type:t})):e?"string"!=typeof e?Le(e,function(e){n(ii(e))}):n(e):n("")}function ut(e,t,r,n){function i(){++s===a.length&&n&&n()}function o(e,t){var n=e._attachments[t],o=n.digest;r.objectStore(li).get(o).onsuccess=function(e){n.body=e.target.result.body,i()}}var a=Object.keys(e._attachments||{});if(!a.length)return n&&n();var s=0;a.forEach(function(r){t.attachments&&t.include_docs?o(e,r):(e._attachments[r].stub=!0,i())})}function ct(e,t){return xn.all(e.map(function(e){if(e.doc&&e.doc._attachments){var r=Object.keys(e.doc._attachments);return xn.all(r.map(function(r){var n=e.doc._attachments[r];if("body"in n){var i=n.body,o=n.content_type;return new xn(function(a){st(i,o,t,function(t){e.doc._attachments[r]=jn(v(n,["digest","content_type"]),{data:t}),a()})})}}))}}))}function lt(e,t,r){function n(){--c||i()}function i(){o.length&&o.forEach(function(e){u.index("digestSeq").count(IDBKeyRange.bound(e+"::",e+"::",!1,!1)).onsuccess=function(t){t.target.result||s.delete(e)}})}var o=[],a=r.objectStore(ci),s=r.objectStore(li),u=r.objectStore(fi),c=e.length;e.forEach(function(e){var r=a.index("_doc_id_rev"),i=t+"::"+e;r.getKey(i).onsuccess=function(e){var t=e.target.result;if("number"!=typeof t)return n();a.delete(t),u.index("seq").openCursor(IDBKeyRange.only(t)).onsuccess=function(e){var t=e.target.result;if(t){var r=t.value.digestSeq.split("::")[0];o.push(r),u.delete(t.primaryKey),t.continue()}else n()}}})}function ft(e,t,r){try{return{txn:e.transaction(t,r)}}catch(e){return{error:e}}}function pt(e,t,r,n,i,o){function a(){var e=ft(i,[ui,ci,li,di,fi,pi],"readwrite");if(e.error)return o(e.error);(b=e.txn).onabort=nt(o),b.ontimeout=nt(o),b.oncomplete=f,_=b.objectStore(ui),w=b.objectStore(ci),x=b.objectStore(li),k=b.objectStore(fi),(E=b.objectStore(pi)).get(pi).onsuccess=function(e){A=e.target.result,c()},d(function(e){if(e)return I=!0,o(e);l()})}function s(){B=!0,c()}function u(){et(e.revs_limit,D,n,T,b,P,h,r,s)}function c(){A&&B&&(A.docCount+=R,E.put(A))}function l(){function e(){++t===D.length&&u()}if(D.length)for(var t=0,r=0,n=D.length;r<n;r++){var i=D[r];i._id&&ue(i._id)?e():_.get(i.metadata.id).onsuccess=function(t){var r=ot(t.target.result);r&&T.set(r.id,r),e()}}}function f(){I||(mi.notify(n._meta.name),o(null,P))}function p(e,t){x.get(e).onsuccess=function(r){if(r.target.result)t();else{var n=F(Hn,"unknown stub attachment with digest "+e);n.status=412,t(n)}}}function d(e){function t(){++i===r.length&&e(n)}var r=[];if(D.forEach(function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach(function(t){var n=e.data._attachments[t];n.stub&&r.push(n.digest)})}),!r.length)return e();var n,i=0;r.forEach(function(e){p(e,function(e){e&&!n&&(n=e),t()})})}function h(e,t,r,n,i,o,a,s){e.metadata.winningRev=t,e.metadata.deleted=r;var u=e.data;if(u._id=e.metadata.id,u._rev=e.metadata.rev,n&&(u._deleted=!0),u._attachments&&Object.keys(u._attachments).length)return v(e,t,r,i,a,s);R+=o,c(),m(e,t,r,i,a,s)}function m(e,t,r,i,o,a){function s(o){var a=e.stemmedRevs||[];i&&n.auto_compaction&&(a=a.concat(J(e.metadata))),a&&a.length&&lt(a,e.metadata.id,b),l.seq=o.target.result;var s=it(l,t,r);_.put(s).onsuccess=u}function u(){P[o]={ok:!0,id:l.id,rev:l.rev},T.set(e.metadata.id,e.metadata),y(e,l.seq,a)}var c=e.data,l=e.metadata;c._doc_id_rev=l.id+"::"+l.rev,delete c._id,delete c._rev;var f=w.put(c);f.onsuccess=s,f.onerror=function(e){e.preventDefault(),e.stopPropagation(),w.index("_doc_id_rev").getKey(c._doc_id_rev).onsuccess=function(e){w.put(c,e.target.result).onsuccess=s}}}function v(e,t,r,n,i,o){function a(){c===l.length&&m(e,t,r,n,i,o)}function s(){c++,a()}var u=e.data,c=0,l=Object.keys(u._attachments);l.forEach(function(r){var n=e.data._attachments[r];if(n.stub)c++,a();else{var i=n.data;delete n.data,n.revpos=parseInt(t,10),g(n.digest,i,s)}})}function y(e,t,r){function n(){++i===o.length&&r()}var i=0,o=Object.keys(e.data._attachments||{});if(!o.length)return r();for(var a=0;a<o.length;a++)!function(r){var i=e.data._attachments[r].digest,o=k.put({seq:t,digestSeq:i+"::"+t});o.onsuccess=n,o.onerror=function(e){e.preventDefault(),e.stopPropagation(),n()}}(o[a])}function g(e,t,r){x.count(e).onsuccess=function(n){if(n.target.result)return r();var i={digest:e,body:t};x.put(i).onsuccess=r}}for(var b,_,w,x,k,E,S,A,D=t.docs,C=0,O=D.length;C<O;C++){var j=D[C];j._id&&ue(j._id)||(j=D[C]=je(j,r.new_edits)).error&&!S&&(S=j)}if(S)return o(S);var B=!1,R=0,P=new Array(D.length),T=new Dn,I=!1,L=n._meta.blobSupport?"blob":"base64";Qe(D,L,function(e){if(e)return o(e);a()})}function dt(e,t,r,n,i){function o(e){c=e.target.result,u&&i(u,c,l)}function a(e){u=e.target.result,c&&i(u,c,l)}function s(e){var t=e.target.result;if(!t)return i();i([t.key],[t.value],t)}var u,c,l;"function"==typeof e.getAll&&"function"==typeof e.getAllKeys&&n>1&&!r?(l={continue:function(){if(!u.length)return i();var r,s=u[u.length-1];if(t&&t.upper)try{r=IDBKeyRange.bound(s,t.upper,!0,t.upperOpen)}catch(e){if("DataError"===e.name&&0===e.code)return i()}else r=IDBKeyRange.lowerBound(s,!0);t=r,u=null,c=null,e.getAll(t,n).onsuccess=o,e.getAllKeys(t,n).onsuccess=a}},e.getAll(t,n).onsuccess=o,e.getAllKeys(t,n).onsuccess=a):r?e.openCursor(t,"prev").onsuccess=s:e.openCursor(t).onsuccess=s}function ht(e,t,r){if("function"!=typeof e.getAll){var n=[];e.openCursor(t).onsuccess=function(e){var t=e.target.result;t?(n.push(t.value),t.continue()):r({target:{result:n}})}}else e.getAll(t).onsuccess=r}function mt(e,t,r,n,i){try{if(e&&t)return i?IDBKeyRange.bound(t,e,!r,!1):IDBKeyRange.bound(e,t,!1,!r);if(e)return i?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return i?IDBKeyRange.lowerBound(t,!r):IDBKeyRange.upperBound(t,!r);if(n)return IDBKeyRange.only(n)}catch(e){return{error:e}}return null}function vt(e,t,r){function n(t,r,n){var i=t.id+"::"+n;w.get(i).onsuccess=function(n){if(r.doc=at(n.target.result),e.conflicts){var i=H(t);i.length&&(r.doc._conflicts=i)}ut(r.doc,e,v)}}function i(t,r){var i={id:r.id,key:r.id,value:{rev:t}},o=r.deleted;"ok"===e.deleted?(x.push(i),o?(i.value.deleted=!0,i.doc=null):e.include_docs&&n(r,i,t)):!o&&l--<=0&&(x.push(i),e.include_docs&&n(r,i,t))}function o(e){for(var t=0,r=e.length;t<r&&x.length!==f;t++){var n=ot(e[t]);i(n.winningRev,n)}}function a(){r(null,{total_rows:y,offset:e.skip,rows:x})}var s="startkey"in e&&e.startkey,u="endkey"in e&&e.endkey,c="key"in e&&e.key,l=e.skip||0,f="number"==typeof e.limit?e.limit:-1,p=mt(s,u,!1!==e.inclusive_end,c,e.descending),d=p&&p.error;if(d&&("DataError"!==d.name||0!==d.code))return r(F(zn,d.name,d.message));var h=[ui,ci,pi];e.attachments&&h.push(li);var m=ft(t,h,"readonly");if(m.error)return r(m.error);var v=m.txn;v.oncomplete=function(){e.attachments?ct(x,e.binary).then(a):a()},v.onabort=nt(r);var y,g=v.objectStore(ui),b=v.objectStore(ci),_=v.objectStore(pi),w=b.index("_doc_id_rev"),x=[];return _.get(pi).onsuccess=function(e){y=e.target.result.docCount},d||0===f?void 0:-1===f?ht(g,p,function(t){var r=t.target.result;e.descending&&(r=r.reverse()),o(r)}):void dt(g,p,e.descending,f+l,function(e,t,r){r&&(o(t),x.length<f&&r.continue())})}function yt(e){return new xn(function(t){var r=Be([""]);e.objectStore(hi).put(r,"key").onsuccess=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);t(r||!e||parseInt(e[1],10)>=43)},e.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)}}).catch(function(){return!1})}function gt(e,t){e.objectStore(ui).index("deletedOrLocal").count(IDBKeyRange.only("0")).onsuccess=function(e){t(e.target.result)}}function bt(e,t,r,n){try{e(t,r)}catch(t){n.emit("error",t)}}function _t(){!vi&&yi.length&&(vi=!0,yi.shift()())}function wt(e,t,r){yi.push(function(){e(function(e,n){bt(t,e,n,r),vi=!1,gn(function(){_t(r)})})}),_t()}function xt(e,t,r,n){function i(e,t,r,n){if(r.seq!==t)return n();if(r.winningRev===e._rev)return n(r,e);var i=e._id+"::"+r.winningRev;v.get(i).onsuccess=function(e){n(r,at(e.target.result))}}function o(e,t,r){if(c&&!c.has(e._id))return r();var n=_.get(e._id);if(n)return i(e,t,n,r);m.get(e._id).onsuccess=function(o){n=ot(o.target.result),_.set(e._id,n),i(e,t,n,r)}}function a(){e.complete(null,{results:y,last_seq:l})}if((e=u(e)).continuous){var s=r+":"+$();return mi.addListener(r,s,t,e),mi.notify(r),{cancel:function(){mi.removeListener(r,s)}}}var c=e.doc_ids&&new An(e.doc_ids);e.since=e.since||0;var l=e.since,f="limit"in e?e.limit:-1;0===f&&(f=1);var p;p="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var d,h,m,v,y=[],g=0,b=B(e),_=new Dn,w=[ui,ci];e.attachments&&w.push(li);var x=ft(n,w,"readonly");if(x.error)return e.complete(x.error);(d=x.txn).onabort=nt(e.complete),d.oncomplete=function(){!e.continuous&&e.attachments?ct(y).then(a):a()},h=d.objectStore(ci),m=d.objectStore(ui),v=h.index("_doc_id_rev"),dt(h,e.since&&!e.descending?IDBKeyRange.lowerBound(e.since,!0):null,e.descending,f,function(t,r,n){function i(t,r){var n=e.processChange(r,t,e);l=n.seq=t.seq;var i=b(n);if("object"==typeof i)return e.complete(i);i&&(g++,p&&y.push(n),e.attachments&&e.include_docs?ut(r,e,d,function(){ct([n],e.binary).then(function(){e.onChange(n)})}):e.onChange(n))}function a(){for(var e=0,t=s.length;e<t&&g!==f;e++){var r=s[e];r&&i(u[e],r)}g!==f&&n.continue()}if(n&&t.length){var s=new Array(t.length),u=new Array(t.length),c=0;r.forEach(function(e,r){o(at(e),t[r],function(e,n){u[r]=e,s[r]=n,++c===t.length&&a()})})}})}function kt(e,t){var r=this;wt(function(t){Et(r,e,t)},t,r.constructor)}function Et(e,t,r){function n(e){var t=e.createObjectStore(ui,{keyPath:"id"});e.createObjectStore(ci,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.createObjectStore(li,{keyPath:"digest"}),e.createObjectStore(pi,{keyPath:"id",autoIncrement:!1}),e.createObjectStore(hi),t.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),e.createObjectStore(di,{keyPath:"_id"});var r=e.createObjectStore(fi,{autoIncrement:!0});r.createIndex("seq","seq"),r.createIndex("digestSeq","digestSeq",{unique:!0})}function i(e,t){var r=e.objectStore(ui);r.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),r.openCursor().onsuccess=function(e){var n=e.target.result;if(n){var i=n.value,o=se(i);i.deletedOrLocal=o?"1":"0",r.put(i),n.continue()}else t()}}function o(e){e.createObjectStore(di,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function a(e,t){var r=e.objectStore(di),n=e.objectStore(ui),i=e.objectStore(ci);n.openCursor().onsuccess=function(e){var o=e.target.result;if(o){var a=o.value,s=a.id,u=ue(s),c=U(a);if(u){var l=s+"::"+c,f=s+"::",p=s+"::~",d=i.index("_doc_id_rev"),h=IDBKeyRange.bound(f,p,!1,!1),m=d.openCursor(h);m.onsuccess=function(e){if(m=e.target.result){var t=m.value;t._doc_id_rev===l&&r.put(t),i.delete(m.primaryKey),m.continue()}else n.delete(o.primaryKey),o.continue()}}else o.continue()}else t&&t()}}function s(e){var t=e.createObjectStore(fi,{autoIncrement:!0});t.createIndex("seq","seq"),t.createIndex("digestSeq","digestSeq",{unique:!0})}function u(e,t){var r=e.objectStore(ci),n=e.objectStore(li),i=e.objectStore(fi);n.count().onsuccess=function(e){if(!e.target.result)return t();r.openCursor().onsuccess=function(e){var r=e.target.result;if(!r)return t();for(var n=r.value,o=r.primaryKey,a=Object.keys(n._attachments||{}),s={},u=0;u<a.length;u++)s[n._attachments[a[u]].digest]=!0;var c=Object.keys(s);for(u=0;u<c.length;u++){var l=c[u];i.put({seq:o,digestSeq:l+"::"+o})}r.continue()}}}function c(e){function t(e){return e.data?ot(e):(e.deleted="1"===e.deletedOrLocal,e)}var r=e.objectStore(ci),n=e.objectStore(ui);n.openCursor().onsuccess=function(e){function i(){var e=it(a,a.winningRev,a.deleted);n.put(e).onsuccess=function(){o.continue()}}var o=e.target.result;if(o){var a=t(o.value);if(a.winningRev=a.winningRev||U(a),a.seq)return i();!function(){var e=a.id+"::",t=a.id+"::",n=0;r.index("_doc_id_rev").openCursor(IDBKeyRange.bound(e,t)).onsuccess=function(e){var t=e.target.result;if(!t)return a.seq=n,i();var r=t.primaryKey;r>n&&(n=r),t.continue()}}()}}}var f=t.name,p=null;e._meta=null,e.type=function(){return"idb"},e._id=l(function(t){t(null,e._meta.instanceId)}),e._bulkDocs=function(r,n,i){pt(t,r,n,e,p,i)},e._get=function(e,t,r){function n(){r(a,{doc:i,metadata:o,ctx:s})}var i,o,a,s=t.ctx;if(!s){var u=ft(p,[ui,ci,li],"readonly");if(u.error)return r(u.error);s=u.txn}s.objectStore(ui).get(e).onsuccess=function(e){if(!(o=ot(e.target.result)))return a=F(Rn,"missing"),n();var r;if(t.rev)r=t.latest?ce(t.rev,o):t.rev;else if(r=o.winningRev,se(o))return a=F(Rn,"deleted"),n();var u=s.objectStore(ci),c=o.id+"::"+r;u.index("_doc_id_rev").get(c).onsuccess=function(e){if((i=e.target.result)&&(i=at(i)),!i)return a=F(Rn,"missing"),n();n()}}},e._getAttachment=function(e,t,r,n,i){var o;if(n.ctx)o=n.ctx;else{var a=ft(p,[ui,ci,li],"readonly");if(a.error)return i(a.error);o=a.txn}var s=r.digest,u=r.content_type;o.objectStore(li).get(s).onsuccess=function(e){st(e.target.result.body,u,n.binary,function(e){i(null,e)})}},e._info=function(t){var r,n,i=ft(p,[pi,ci],"readonly");if(i.error)return t(i.error);var o=i.txn;o.objectStore(pi).get(pi).onsuccess=function(e){n=e.target.result.docCount},o.objectStore(ci).openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;r=t?t.key:0},o.oncomplete=function(){t(null,{doc_count:n,update_seq:r,idb_attachment_format:e._meta.blobSupport?"binary":"base64"})}},e._allDocs=function(e,t){vt(e,p,t)},e._changes=function(t){xt(t,e,f,p)},e._close=function(e){p.close(),gi.delete(f),e()},e._getRevisionTree=function(e,t){var r=ft(p,[ui],"readonly");if(r.error)return t(r.error);r.txn.objectStore(ui).get(e).onsuccess=function(e){var r=ot(e.target.result);r?t(null,r.rev_tree):t(F(Rn))}},e._doCompaction=function(e,t,r){var n=ft(p,[ui,ci,li,fi],"readwrite");if(n.error)return r(n.error);var i=n.txn;i.objectStore(ui).get(e).onsuccess=function(r){var n=ot(r.target.result);z(n.rev_tree,function(e,r,n,i,o){var a=r+"-"+n;-1!==t.indexOf(a)&&(o.status="missing")}),lt(t,e,i);var o=n.winningRev,a=n.deleted;i.objectStore(ui).put(it(n,o,a))},i.onabort=nt(r),i.oncomplete=function(){r()}},e._getLocal=function(e,t){var r=ft(p,[di],"readonly");if(r.error)return t(r.error);var n=r.txn.objectStore(di).get(e);n.onerror=nt(t),n.onsuccess=function(e){var r=e.target.result;r?(delete r._doc_id_rev,t(null,r)):t(F(Rn))}},e._putLocal=function(e,t,r){"function"==typeof t&&(r=t,t={}),delete e._revisions;var n=e._rev,i=e._id;e._rev=n?"0-"+(parseInt(n.split("-")[1],10)+1):"0-1";var o,a=t.ctx;if(!a){var s=ft(p,[di],"readwrite");if(s.error)return r(s.error);(a=s.txn).onerror=nt(r),a.oncomplete=function(){o&&r(null,o)}}var u,c=a.objectStore(di);n?(u=c.get(i)).onsuccess=function(i){var a=i.target.result;a&&a._rev===n?c.put(e).onsuccess=function(){o={ok:!0,id:e._id,rev:e._rev},t.ctx&&r(null,o)}:r(F(Pn))}:((u=c.add(e)).onerror=function(e){r(F(Pn)),e.preventDefault(),e.stopPropagation()},u.onsuccess=function(){o={ok:!0,id:e._id,rev:e._rev},t.ctx&&r(null,o)})},e._removeLocal=function(e,t,r){"function"==typeof t&&(r=t,t={});var n=t.ctx;if(!n){var i=ft(p,[di],"readwrite");if(i.error)return r(i.error);(n=i.txn).oncomplete=function(){o&&r(null,o)}}var o,a=e._id,s=n.objectStore(di),u=s.get(a);u.onerror=nt(r),u.onsuccess=function(n){var i=n.target.result;i&&i._rev===e._rev?(s.delete(a),o={ok:!0,id:a,rev:"0-0"},t.ctx&&r(null,o)):r(F(Rn))}},e._destroy=function(e,t){mi.removeAllListeners(f);var r=bi.get(f);r&&r.result&&(r.result.close(),gi.delete(f));var n=indexedDB.deleteDatabase(f);n.onsuccess=function(){bi.delete(f),w()&&f in localStorage&&delete localStorage[f],t(null,{ok:!0})},n.onerror=nt(t)};var d=gi.get(f);if(d)return p=d.idb,e._meta=d.global,gn(function(){r(null,e)});var h;h=t.storage?St(f,t.storage):indexedDB.open(f,si),bi.set(f,h),h.onupgradeneeded=function(e){function t(){var e=f[p-1];p++,e&&e(l,t)}var r=e.target.result;if(e.oldVersion<1)return n(r);var l=e.currentTarget.transaction;e.oldVersion<3&&o(r),e.oldVersion<4&&s(r);var f=[i,a,u,c],p=e.oldVersion;t()},h.onsuccess=function(t){function n(){void 0!==s&&l&&(e._meta={name:f,instanceId:u,blobSupport:s},gi.set(f,{idb:p,global:e._meta}),r(null,e))}function i(){if(void 0!==a&&void 0!==o){var e=f+"_id";e in o?u=o[e]:o[e]=u=$(),o.docCount=a,c.objectStore(pi).put(o)}}(p=t.target.result).onversionchange=function(){p.close(),gi.delete(f)},p.onabort=function(e){E("error","Database has a global failure",e.target.error),p.close(),gi.delete(f)};var o,a,s,u,c=p.transaction([pi,hi,ui],"readwrite"),l=!1;c.objectStore(pi).get(pi).onsuccess=function(e){o=e.target.result||{id:pi},i()},gt(c,function(e){a=e,i()}),ei||(ei=yt(c)),ei.then(function(e){s=e,n()}),c.oncomplete=function(){l=!0,n()}},h.onerror=function(){var e="Failed to open indexedDB, are you in private browsing mode?";E("error",e),r(F(zn,e))}}function St(e,t){try{return indexedDB.open(e,{version:si,storage:t})}catch(t){return indexedDB.open(e,si)}}function At(e){return decodeURIComponent(escape(e))}function Dt(e){return e<65?e-48:e-55}function Ct(e,t,r){for(var n="";t<r;)n+=String.fromCharCode(Dt(e.charCodeAt(t++))<<4|Dt(e.charCodeAt(t++)));return n}function Ft(e,t,r){for(var n="";t<r;)n+=String.fromCharCode(Dt(e.charCodeAt(t+2))<<12|Dt(e.charCodeAt(t+3))<<8|Dt(e.charCodeAt(t))<<4|Dt(e.charCodeAt(t+1))),t+=4;return n}function Ot(e,t){return"UTF-8"===t?At(Ct(e,0,e.length)):Ft(e,0,e.length)}function jt(e){return"'"+e+"'"}function Bt(e){return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function Rt(e){return e.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function Pt(e){return delete e._id,delete e._rev,JSON.stringify(e)}function Tt(e,t,r){return e=JSON.parse(e),e._id=t,e._rev=r,e}function It(e){for(var t="(";e--;)t+="?",e&&(t+=",");return t+")"}function Lt(e,t,r,n,i){return"SELECT "+e+" FROM "+("string"==typeof t?t:t.join(" JOIN "))+(r?" ON "+r:"")+(n?" WHERE "+("string"==typeof n?n:n.join(" AND ")):"")+(i?" ORDER BY "+i:"")}function Nt(e,t,r){function n(){++o===e.length&&i()}function i(){if(a.length){var e="SELECT DISTINCT digest AS digest FROM "+Ai+" WHERE seq IN "+It(a.length);r.executeSql(e,a,function(e,t){for(var r=[],n=0;n<t.rows.length;n++)r.push(t.rows.item(n).digest);if(r.length){var i="DELETE FROM "+Ai+" WHERE seq IN ("+a.map(function(){return"?"}).join(",")+")";e.executeSql(i,a,function(e){var t="SELECT digest FROM "+Ai+" WHERE digest IN ("+r.map(function(){return"?"}).join(",")+")";e.executeSql(t,r,function(e,t){for(var n=new An,i=0;i<t.rows.length;i++)n.add(t.rows.item(i).digest);r.forEach(function(t){n.has(t)||(e.executeSql("DELETE FROM "+Ai+" WHERE digest=?",[t]),e.executeSql("DELETE FROM "+ki+" WHERE digest=?",[t]))})})})}})}}if(e.length){var o=0,a=[];e.forEach(function(e){var i="SELECT seq FROM "+xi+" WHERE doc_id=? AND rev=?";r.executeSql(i,[t,e],function(e,t){if(!t.rows.length)return n();var r=t.rows.item(0).seq;a.push(r),e.executeSql("DELETE FROM "+xi+" WHERE seq=?",[r],n)})})}}function Mt(e){return function(t){E("error","WebSQL threw an error",t);var r=t&&t.constructor.toString().match(/function ([^\(]+)/),n=r&&r[1]||t.type,i=t.target||t.message;e(F(Vn,i,n))}}function qt(e){return"size"in e?1e6*e.size:"undefined"!=typeof navigator&&/Android/.test(navigator.userAgent)?5e6:1}function Wt(e,t,r,n,i,o,a){function s(){if(g)return a(g);o.notify(n._name),a(null,b)}function u(e,t){var r="SELECT count(*) as cnt FROM "+ki+" WHERE digest=?";y.executeSql(r,[e],function(r,n){if(0===n.rows.item(0).cnt){var i=F(Hn,"unknown stub attachment with digest "+e);t(i)}else t()})}function c(e){function t(){++i===r.length&&e(n)}var r=[];if(m.forEach(function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach(function(t){var n=e.data._attachments[t];n.stub&&r.push(n.digest)})}),!r.length)return e();var n,i=0;r.forEach(function(e){u(e,function(e){e&&!n&&(n=e),t()})})}function l(e,t,r,i,o,a,s,u){function c(){function t(e,t){function n(){return++i===o.length&&t(),!1}var i=0,o=Object.keys(r._attachments||{});if(!o.length)return t();for(var a=0;a<o.length;a++)!function(t){var i="INSERT INTO "+Ai+" (digest, seq) VALUES (?,?)",o=[r._attachments[t].digest,e];y.executeSql(i,o,n,n)}(o[a])}var r=e.data,n=i?1:0,o=r._id,a=r._rev,s=Pt(r),u="INSERT INTO "+xi+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",c=[o,a,s,n];y.executeSql(u,c,function(e,r){var n=r.insertId;t(n,function(){p(e,n)})},function(){var e=Lt("seq",xi,null,"doc_id=? AND rev=?");return y.executeSql(e,[o,a],function(e,r){var i=r.rows.item(0).seq,u="UPDATE "+xi+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",c=[s,n,o,a];e.executeSql(u,c,function(e){t(i,function(){p(e,i)})})}),!1})}function l(e){h||(e?u(h=e):m===v.length&&c())}function f(e){m++,l(e)}function p(r,i){var a=e.metadata.id,c=e.stemmedRevs||[];o&&n.auto_compaction&&(c=J(e.metadata).concat(c)),c.length&&Nt(c,a,r),e.metadata.seq=i;var l=e.metadata.rev;delete e.metadata.rev;var f=o?"UPDATE "+wi+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+xi+" WHERE doc_id="+wi+".id AND rev=?) WHERE id=?":"INSERT INTO "+wi+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",p=rt(e.metadata),d=o?[p,i,t,a]:[a,i,i,p];r.executeSql(f,d,function(){b[s]={ok:!0,id:e.metadata.id,rev:l},_.set(a,e.metadata),u()})}var h=null,m=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev;var v=Object.keys(e.data._attachments||{});i&&(e.data._deleted=!0),v.forEach(function(r){var n=e.data._attachments[r];if(n.stub)m++,l();else{var i=n.data;delete n.data,n.revpos=parseInt(t,10),d(n.digest,i,f)}}),v.length||c()}function f(){et(e.revs_limit,m,n,_,y,b,l,r)}function p(e){function t(){++r===m.length&&e()}if(!m.length)return e();var r=0;m.forEach(function(e){if(e._id&&ue(e._id))return t();var r=e.metadata.id;y.executeSql("SELECT json FROM "+wi+" WHERE id = ?",[r],function(e,n){if(n.rows.length){var i=tt(n.rows.item(0).json);_.set(r,i)}t()})})}function d(e,t,r){var n="SELECT digest FROM "+ki+" WHERE digest=?";y.executeSql(n,[e],function(i,o){if(o.rows.length)return r();n="INSERT INTO "+ki+" (digest, body, escaped) VALUES (?,?,1)",i.executeSql(n,[e,Bt(t)],function(){r()},function(){return r(),!1})})}var h=r.new_edits,m=t.docs.map(function(e){return e._id&&ue(e._id)?e:je(e,h)}),v=m.filter(function(e){return e.error});if(v.length)return a(v[0]);var y,g,b=new Array(m.length),_=new Dn;Qe(m,"binary",function(e){if(e)return a(e);i.transaction(function(e){y=e,c(function(e){e?g=e:p(f)})},Mt(a),s)})}function $t(e){return e.websql(e.name,e.version,e.description,e.size)}function Ut(e){try{return{db:$t(e)}}catch(e){return{error:e}}}function zt(e){var t=Di.get(e.name);return t||(t=Ut(e),Di.set(e.name,t)),t}function Vt(e,t,r,n,i){function o(){++u===s.length&&i&&i()}function a(e,i){var a=e._attachments[i],s={binary:t.binary,ctx:n};r._getAttachment(e._id,i,a,s,function(t,r){e._attachments[i]=jn(v(a,["digest","content_type"]),{data:r}),o()})}var s=Object.keys(e._attachments||{});if(!s.length)return i&&i();var u=0;s.forEach(function(r){t.attachments&&t.include_docs?a(e,r):(e._attachments[r].stub=!0,o())})}function Gt(e,t){function r(){w()&&(window.localStorage["_pouch__websqldb_"+b._name]=!0),t(null,b)}function n(e,t){e.executeSql(Bi),e.executeSql("ALTER TABLE "+xi+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){e.executeSql(Oi),e.executeSql("ALTER TABLE "+wi+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){e.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+wi+" (local, id)");var r="SELECT "+wi+".winningseq AS seq, "+wi+".json AS metadata FROM "+xi+" JOIN "+wi+" ON "+xi+".seq = "+wi+".winningseq";e.executeSql(r,[],function(e,r){for(var n=[],i=[],o=0;o<r.rows.length;o++){var a=r.rows.item(o),s=a.seq,u=JSON.parse(a.metadata);se(u)&&n.push(s),ue(u.id)&&i.push(u.id)}e.executeSql("UPDATE "+wi+"SET local = 1 WHERE id IN "+It(i.length),i,function(){e.executeSql("UPDATE "+xi+" SET deleted = 1 WHERE seq IN "+It(n.length),n,t)})})})})}function i(e,t){var r="CREATE TABLE IF NOT EXISTS "+Ei+" (id UNIQUE, rev, json)";e.executeSql(r,[],function(){var r="SELECT "+wi+".id AS id, "+xi+".json AS data FROM "+xi+" JOIN "+wi+" ON "+xi+".seq = "+wi+".winningseq WHERE local = 1";e.executeSql(r,[],function(e,r){function n(){if(!i.length)return t(e);var r=i.shift(),o=JSON.parse(r.data)._rev;e.executeSql("INSERT INTO "+Ei+" (id, rev, json) VALUES (?,?,?)",[r.id,o,r.data],function(e){e.executeSql("DELETE FROM "+wi+" WHERE id=?",[r.id],function(e){e.executeSql("DELETE FROM "+xi+" WHERE seq=?",[r.seq],function(){n()})})})}for(var i=[],o=0;o<r.rows.length;o++)i.push(r.rows.item(o));n()})})}function o(e,t){function r(r){function n(){if(!r.length)return t(e);var i=Ot(r.shift().hex,g),o=i.lastIndexOf("::"),a=i.substring(0,o),s=i.substring(o+2),u="UPDATE "+xi+" SET doc_id=?, rev=? WHERE doc_id_rev=?";e.executeSql(u,[a,s,i],function(){n()})}n()}var n="ALTER TABLE "+xi+" ADD COLUMN doc_id";e.executeSql(n,[],function(e){var t="ALTER TABLE "+xi+" ADD COLUMN rev";e.executeSql(t,[],function(e){e.executeSql(ji,[],function(e){var t="SELECT hex(doc_id_rev) as hex FROM "+xi;e.executeSql(t,[],function(e,t){for(var n=[],i=0;i<t.rows.length;i++)n.push(t.rows.item(i));r(n)})})})})}function a(e,t){function r(e){var r="SELECT COUNT(*) AS cnt FROM "+ki;e.executeSql(r,[],function(e,r){function n(){var r=Lt(Ii+", "+wi+".id AS id",[wi,xi],Ti,null,wi+".id ");r+=" LIMIT "+o+" OFFSET "+i,i+=o,e.executeSql(r,[],function(e,r){if(!r.rows.length)return t(e);for(var i={},o=0;o<r.rows.length;o++)for(var a=r.rows.item(o),s=Tt(a.data,a.id,a.rev),u=Object.keys(s._attachments||{}),c=0;c<u.length;c++)!function(e,t){var r=i[e]=i[e]||[];-1===r.indexOf(t)&&r.push(t)}(s._attachments[u[c]].digest,a.seq);var l=[];if(Object.keys(i).forEach(function(e){i[e].forEach(function(t){l.push([e,t])})}),!l.length)return n();var f=0;l.forEach(function(t){var r="INSERT INTO "+Ai+" (digest, seq) VALUES (?,?)";e.executeSql(r,t,function(){++f===l.length&&n()})})})}if(!r.rows.item(0).cnt)return t(e);var i=0,o=10;n()})}var n="CREATE TABLE IF NOT EXISTS "+Ai+" (digest, seq INTEGER)";e.executeSql(n,[],function(e){e.executeSql(Pi,[],function(e){e.executeSql(Ri,[],r)})})}function s(e,t){var r="ALTER TABLE "+ki+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";e.executeSql(r,[],t)}function c(e,t){var r="ALTER TABLE "+wi+" ADD COLUMN max_seq INTEGER";e.executeSql(r,[],function(e){var r="UPDATE "+wi+" SET max_seq=(SELECT MAX(seq) FROM "+xi+" WHERE doc_id=id)";e.executeSql(r,[],function(e){var r="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+wi+" (max_seq)";e.executeSql(r,[],t)})})}function f(e,t){e.executeSql('SELECT HEX("a") AS hex',[],function(e,r){var n=r.rows.item(0).hex;g=2===n.length?"UTF-8":"UTF-16",t()})}function p(){for(;k.length>0;)k.pop()(null,_)}function d(e,t){if(0===t){var r="CREATE TABLE IF NOT EXISTS "+Si+" (dbid, db_version INTEGER)",u="CREATE TABLE IF NOT EXISTS "+ki+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",l="CREATE TABLE IF NOT EXISTS "+Ai+" (digest, seq INTEGER)",f="CREATE TABLE IF NOT EXISTS "+wi+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",d="CREATE TABLE IF NOT EXISTS "+xi+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",h="CREATE TABLE IF NOT EXISTS "+Ei+" (id UNIQUE, rev, json)";e.executeSql(u),e.executeSql(h),e.executeSql(l,[],function(){e.executeSql(Ri),e.executeSql(Pi)}),e.executeSql(f,[],function(){e.executeSql(Bi),e.executeSql(d,[],function(){e.executeSql(Oi),e.executeSql(ji),e.executeSql(r,[],function(){var t="INSERT INTO "+Si+" (db_version, dbid) VALUES (?,?)";_=$();var r=[_i,_];e.executeSql(t,r,function(){p()})})})})}else{var m=[n,i,o,a,s,c,function(){t<_i&&e.executeSql("UPDATE "+Si+" SET db_version = "+_i);var r="SELECT dbid FROM "+Si;e.executeSql(r,[],function(e,t){_=t.rows.item(0).dbid,p()})}],v=t,y=function(e){m[v-1](e,y),v++};y(e)}}function h(e){var t="SELECT sql FROM sqlite_master WHERE tbl_name = "+Si;e.executeSql(t,[],function(e,t){t.rows.length?/db_version/.test(t.rows.item(0).sql)?e.executeSql("SELECT db_version FROM "+Si,[],function(e,t){d(e,t.rows.item(0).db_version)}):e.executeSql("ALTER TABLE "+Si+" ADD COLUMN db_version INTEGER",[],function(){d(e,1)}):d(e,0)})}function m(e,t){var r="SELECT MAX(seq) AS seq FROM "+xi;e.executeSql(r,[],function(e,r){var n=r.rows.item(0).seq||0;t(n)})}function v(e,t){var r=Lt("COUNT("+wi+".id) AS 'num'",[wi,xi],Ti,xi+".deleted=0");e.executeSql(r,[],function(e,r){t(r.rows.item(0).num)})}function y(e,t,r,n,i){var o=Lt(Ii,[wi,xi],Ti,wi+".id=?"),a=[t];e.executeSql(o,a,function(e,t){if(!t.rows.length){var o=F(Rn,"missing");return i(o)}var a=tt(t.rows.item(0).metadata);n(ce(r,a))})}var g,b=this,_=null,x=qt(e),k=[];b._name=e.name;var E=zt(jn({},e,{version:Fi,description:e.name,size:x}));if(E.error)return Mt(t)(E.error);var S=E.db;"function"!=typeof S.readTransaction&&(S.readTransaction=S.transaction),S.transaction(function(e){f(e,function(){h(e)})},Mt(t),r),b.type=function(){return"websql"},b._id=l(function(e){e(null,_)}),b._info=function(e){var t,r;S.readTransaction(function(e){m(e,function(e){t=e}),v(e,function(e){r=e})},Mt(e),function(){e(null,{doc_count:r,update_seq:t,websql_encoding:g})})},b._bulkDocs=function(t,r,n){Wt(e,t,r,b,S,Ci,n)},b._get=function(e,t,r){function n(e){r(e,{doc:i,metadata:o,ctx:a})}var i,o,a=t.ctx;if(!a)return S.readTransaction(function(n){b._get(e,jn({ctx:n},t),r)});var s,u;if(t.rev){if(t.latest)return void y(a,e,t.rev,function(n){t.latest=!1,t.rev=n,b._get(e,t,r)},n);s=Lt(Ii,[wi,xi],wi+".id="+xi+".doc_id",[xi+".doc_id=?",xi+".rev=?"]),u=[e,t.rev]}else s=Lt(Ii,[wi,xi],Ti,wi+".id=?"),u=[e];a.executeSql(s,u,function(e,r){if(!r.rows.length)return n(F(Rn,"missing"));var a=r.rows.item(0);if(o=tt(a.metadata),a.deleted&&!t.rev)return n(F(Rn,"deleted"));i=Tt(a.data,o.id,a.rev),n()})},b._allDocs=function(e,t){var r,n=[],i="startkey"in e&&e.startkey,o="endkey"in e&&e.endkey,a="key"in e&&e.key,s="descending"in e&&e.descending,u="limit"in e?e.limit:-1,c="skip"in e?e.skip:0,l=!1!==e.inclusive_end,f=[],p=[];if(!1!==a)p.push(wi+".id = ?"),f.push(a);else if(!1!==i||!1!==o){if(!1!==i&&(p.push(wi+".id "+(s?"<=":">=")+" ?"),f.push(i)),!1!==o){var d=s?">":"<";l&&(d+="="),p.push(wi+".id "+d+" ?"),f.push(o)}!1!==a&&(p.push(wi+".id = ?"),f.push(a))}"ok"!==e.deleted&&p.push(xi+".deleted = 0"),S.readTransaction(function(t){if(v(t,function(e){r=e}),0!==u){var i=Lt(Ii,[wi,xi],Ti,p,wi+".id "+(s?"DESC":"ASC"));i+=" LIMIT "+u+" OFFSET "+c,t.executeSql(i,f,function(t,r){for(var i=0,o=r.rows.length;i<o;i++){var a=r.rows.item(i),s=tt(a.metadata),u=s.id,c=Tt(a.data,u,a.rev),l=c._rev,f={id:u,key:u,value:{rev:l}};if(e.include_docs){if(f.doc=c,f.doc._rev=l,e.conflicts){var p=H(s);p.length&&(f.doc._conflicts=p)}Vt(f.doc,e,b,t)}if(a.deleted){if("ok"!==e.deleted)continue;f.value.deleted=!0,f.doc=null}n.push(f)}})}},Mt(t),function(){t(null,{total_rows:r,offset:e.skip,rows:n})})},b._changes=function(e){if((e=u(e)).continuous){var t=b._name+":"+$();return Ci.addListener(b._name,t,b,e),Ci.notify(b._name),{cancel:function(){Ci.removeListener(b._name,t)}}}var r=e.descending;e.since=e.since&&!r?e.since:0;var n="limit"in e?e.limit:-1;0===n&&(n=1);var i;i="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var o=[],a=0;!function(){var t=wi+".json AS metadata, "+wi+".max_seq AS maxSeq, "+xi+".json AS winningDoc, "+xi+".rev AS winningRev ",s=wi+" JOIN "+xi,u=wi+".id="+xi+".doc_id AND "+wi+".winningseq="+xi+".seq",c=["maxSeq > ?"],l=[e.since];e.doc_ids&&(c.push(wi+".id IN "+It(e.doc_ids.length)),l=l.concat(e.doc_ids));var f=Lt(t,s,u,c,"maxSeq "+(r?"DESC":"ASC")),p=B(e);e.view||e.filter||(f+=" LIMIT "+n);var d=e.since||0;S.readTransaction(function(t){t.executeSql(f,l,function(t,r){function s(t){return function(){e.onChange(t)}}for(var u=0,c=r.rows.length;u<c;u++){var l=r.rows.item(u),f=tt(l.metadata);d=l.maxSeq;var h=Tt(l.winningDoc,f.id,l.winningRev),m=e.processChange(h,f,e);m.seq=l.maxSeq;var v=p(m);if("object"==typeof v)return e.complete(v);if(v&&(a++,i&&o.push(m),e.attachments&&e.include_docs?Vt(h,e,b,t,s(m)):s(m)()),a===n)break}})},Mt(e.complete),function(){e.continuous||e.complete(null,{results:o,last_seq:d})})}()},b._close=function(e){e()},b._getAttachment=function(e,t,r,n,i){var o,a=n.ctx,s=r.digest,u=r.content_type,c="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+ki+" WHERE digest=?";a.executeSql(c,[s],function(e,t){var r=t.rows.item(0),a=r.escaped?Rt(r.body):Ot(r.body,g);o=n.binary?Pe(a,u):ii(a),i(null,o)})},b._getRevisionTree=function(e,t){S.readTransaction(function(r){var n="SELECT json AS metadata FROM "+wi+" WHERE id = ?";r.executeSql(n,[e],function(e,r){if(r.rows.length){var n=tt(r.rows.item(0).metadata);t(null,n.rev_tree)}else t(F(Rn))})})},b._doCompaction=function(e,t,r){if(!t.length)return r();S.transaction(function(r){var n="SELECT json AS metadata FROM "+wi+" WHERE id = ?";r.executeSql(n,[e],function(r,n){var i=tt(n.rows.item(0).metadata);z(i.rev_tree,function(e,r,n,i,o){var a=r+"-"+n;-1!==t.indexOf(a)&&(o.status="missing")});var o="UPDATE "+wi+" SET json = ? WHERE id = ?";r.executeSql(o,[rt(i),e])}),Nt(t,e,r)},Mt(r),function(){r()})},b._getLocal=function(e,t){S.readTransaction(function(r){var n="SELECT json, rev FROM "+Ei+" WHERE id=?";r.executeSql(n,[e],function(r,n){if(n.rows.length){var i=n.rows.item(0),o=Tt(i.json,e,i.rev);t(null,o)}else t(F(Rn))})})},b._putLocal=function(e,t,r){function n(e){var n,c;o?(n="UPDATE "+Ei+" SET rev=?, json=? WHERE id=? AND rev=?",c=[i,u,a,o]):(n="INSERT INTO "+Ei+" (id, rev, json) VALUES (?,?,?)",c=[a,i,u]),e.executeSql(n,c,function(e,n){n.rowsAffected?(s={ok:!0,id:a,rev:i},t.ctx&&r(null,s)):r(F(Pn))},function(){return r(F(Pn)),!1})}"function"==typeof t&&(r=t,t={}),delete e._revisions;var i,o=e._rev,a=e._id;i=e._rev=o?"0-"+(parseInt(o.split("-")[1],10)+1):"0-1";var s,u=Pt(e);t.ctx?n(t.ctx):S.transaction(n,Mt(r),function(){s&&r(null,s)})},b._removeLocal=function(e,t,r){function n(n){var o="DELETE FROM "+Ei+" WHERE id=? AND rev=?",a=[e._id,e._rev];n.executeSql(o,a,function(n,o){if(!o.rowsAffected)return r(F(Rn));i={ok:!0,id:e._id,rev:"0-0"},t.ctx&&r(null,i)})}"function"==typeof t&&(r=t,t={});var i;t.ctx?n(t.ctx):S.transaction(n,Mt(r),function(){i&&r(null,i)})},b._destroy=function(e,t){Ci.removeAllListeners(b._name),S.transaction(function(e){[wi,xi,ki,Si,Ei,Ai].forEach(function(t){e.executeSql("DROP TABLE IF EXISTS "+t,[])})},Mt(t),function(){w()&&(delete window.localStorage["_pouch__websqldb_"+b._name],delete window.localStorage[b._name]),t(null,{ok:!0})})}}function Ht(){try{return openDatabase("_pouch_validate_websql",1,"",1),!0}catch(e){return!1}}function Jt(){if("undefined"==typeof indexedDB||null===indexedDB||!/iP(hone|od|ad)/.test(navigator.userAgent))return!0;var e=w(),t="_pouch__websqldb_valid_"+navigator.userAgent;if(e&&localStorage[t])return"1"===localStorage[t];var r=Ht();return e&&(localStorage[t]=r?"1":"0"),r}function Kt(e,t,r,n){return openDatabase(e,t,r,n)}function Yt(e,t){var r=jn({websql:Kt},e);Gt.call(this,r,t)}function Qt(){for(var e={},t=new xn(function(t,r){e.resolve=t,e.reject=r}),r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.promise=t,xn.resolve().then(function(){return fetch.apply(null,r)}).then(function(t){e.resolve(t)}).catch(function(t){e.reject(t)}),e}function Xt(e,t){var r,n,i,o=new Headers,a={method:e.method,credentials:"include",headers:o};return e.json&&(o.set("Accept","application/json"),o.set("Content-Type",e.headers["Content-Type"]||"application/json")),e.body&&e.processData&&"string"!=typeof e.body?a.body=JSON.stringify(e.body):a.body="body"in e?e.body:null,Object.keys(e.headers).forEach(function(t){e.headers.hasOwnProperty(t)&&o.set(t,e.headers[t])}),r=Qt(e.url,a),e.timeout>0&&(n=setTimeout(function(){r.reject(new Error("Load timeout for resource: "+e.url))},e.timeout)),r.promise.then(function(t){return i={statusCode:t.status},e.timeout>0&&clearTimeout(n),i.statusCode>=200&&i.statusCode<300?e.binary?t.blob():t.text():t.json()}).then(function(e){i.statusCode>=200&&i.statusCode<300?t(null,i,e):(e.status=i.statusCode,t(e))}).catch(function(e){e||(e=new Error("canceled")),t(e)}),{abort:r.reject}}function Zt(e,t){var r,n,i=!1,o=function(){i=!0,r.abort(),s()},a={abort:function(){r.abort(),s()}},s=function(){clearTimeout(n),a.abort=function(){},r&&(r.onprogress=void 0,r.upload&&(r.upload.onprogress=void 0),r.onreadystatechange=void 0,r=void 0)};r=e.xhr?new e.xhr:new XMLHttpRequest;try{r.open(e.method,e.url)}catch(e){return t(new Error(e.name||"Url is invalid"))}r.withCredentials=!("withCredentials"in e)||e.withCredentials,"GET"===e.method?delete e.headers["Content-Type"]:e.json&&(e.headers.Accept="application/json",e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.body&&e.processData&&"string"!=typeof e.body&&(e.body=JSON.stringify(e.body))),e.binary&&(r.responseType="arraybuffer"),"body"in e||(e.body=null);for(var u in e.headers)e.headers.hasOwnProperty(u)&&r.setRequestHeader(u,e.headers[u]);return e.timeout>0&&(n=setTimeout(o,e.timeout),r.onprogress=function(){clearTimeout(n),4!==r.readyState&&(n=setTimeout(o,e.timeout))},void 0!==r.upload&&(r.upload.onprogress=r.onprogress)),r.onreadystatechange=function(){if(4===r.readyState){var n={statusCode:r.status};if(r.status>=200&&r.status<300){var o;o=e.binary?Be([r.response||""],{type:r.getResponseHeader("Content-Type")}):r.responseText,t(null,n,o)}else{var a={};if(i)(a=new Error("ETIMEDOUT")).code="ETIMEDOUT";else if("string"==typeof r.response)try{a=JSON.parse(r.response)}catch(e){}a.status=r.status,t(a)}s()}},e.body&&e.body instanceof Blob?qe(e.body,function(e){r.send(e)}):r.send(e.body),a}function er(e,t){return Li||e.xhr?Zt(e,t):Xt(e,t)}function tr(){return""}function rr(e,t){function r(t,r,n){if(!e.binary&&e.json&&"string"==typeof t)try{t=JSON.parse(t)}catch(e){return n(e)}Array.isArray(t)&&(t=t.map(function(e){return e.error||e.missing?O(e):e})),e.binary&&Ni(t,r),n(null,t,r)}return e=u(e),(e=jn({method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1},e)).json&&(e.binary||(e.headers.Accept="application/json"),e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json"),e.binary&&(e.encoding=null,e.json=!1),e.processData||(e.json=!1),er(e,function(n,i,o){if(n)return t(O(n));var a,s=i.headers&&i.headers["content-type"],u=o||tr();if(!e.binary&&(e.json||!e.processData)&&"object"!=typeof u&&(/json/.test(s)||/^[\s]*\{/.test(u)&&/\}[\s]*$/.test(u)))try{u=JSON.parse(u.toString())}catch(e){}i.statusCode>=200&&i.statusCode<300?r(u,i,t):((a=O(u)).status=i.statusCode,t(a))})}function nr(e,t){var r=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n=-1!==r.indexOf("safari")&&-1===r.indexOf("chrome"),i=-1!==r.indexOf("msie"),o=-1!==r.indexOf("edge"),a=n||(i||o)&&"GET"===e.method,s=!("cache"in e)||e.cache;if(!/^blob:/.test(e.url)&&(a||!s)){var u=-1!==e.url.indexOf("?");e.url+=(u?"&":"?")+"_nonce="+Date.now()}return rr(e,t)}function ir(e,t){return new xn(function(r,n){function i(){l++,e[f++]().then(a,s)}function o(){++p===d?c?n(c):r():u()}function a(){l--,o()}function s(e){l--,c=c||e,o()}function u(){for(;l<t&&f<d;)i()}var c,l=0,f=0,p=0,d=e.length;u()})}function or(e){var t=e.doc&&e.doc._attachments;t&&Object.keys(t).forEach(function(e){var r=t[e];r.data=Te(r.data,r.content_type)})}function ar(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):/^_local/.test(e)?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function sr(e){return e._attachments&&Object.keys(e._attachments)?xn.all(Object.keys(e._attachments).map(function(t){var r=e._attachments[t];if(r.data&&"string"!=typeof r.data)return new xn(function(e){Me(r.data,e)}).then(function(e){r.data=e})})):xn.resolve()}function ur(e){if(!e.prefix)return!1;var t=N(e.prefix).protocol;return"http"===t||"https"===t}function cr(e,t){if(ur(t)){var r=t.name.substr(t.prefix.length);e=t.prefix+encodeURIComponent(r)}var n=N(e);(n.user||n.password)&&(n.auth={username:n.user,password:n.password});var i=n.path.replace(/(^\/|\/$)/g,"").split("/");return n.db=i.pop(),-1===n.db.indexOf("%")&&(n.db=encodeURIComponent(n.db)),n.path=i.join("/"),n}function lr(e,t){return fr(e,e.db+"/"+t)}function fr(e,t){var r=e.path?"/":"";return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+r+t}function pr(e){return"?"+Object.keys(e).map(function(t){return t+"="+encodeURIComponent(e[t])}).join("&")}function dr(e,t){function r(e,t,r){var n=e.ajax||{},i=jn(u(p),n,t),o=u(p.headers||{});return i.headers=jn(o,n.headers,t.headers||{}),$i(i.method+" "+i.url),s._ajax(i,r)}function n(e,t){return new xn(function(n,i){r(e,t,function(e,t){if(e)return i(e);n(t)})})}function i(e,t){return f(e,hn(function(e){o().then(function(){return t.apply(this,e)}).catch(function(t){e.pop()(t)})}))}function o(){return e.skipSetup||e.skip_setup?xn.resolve():y||((y=n({},{method:"GET",url:l}).catch(function(e){return e&&e.status&&404===e.status?(D(404,"PouchDB is just detecting if the remote exists."),n({},{method:"PUT",url:l})):xn.reject(e)}).catch(function(e){return!(!e||!e.status||412!==e.status)||xn.reject(e)})).catch(function(){y=null}),y)}function a(e){return e.split("/").map(encodeURIComponent).join("/")}var s=this,c=cr(e.name,e),l=lr(c,""),p=(e=u(e)).ajax||{};if(e.auth||c.auth){var d=e.auth||c.auth,h=d.username+":"+d.password,m=ii(unescape(encodeURIComponent(h)));p.headers=p.headers||{},p.headers.Authorization="Basic "+m}s._ajax=nr;var y;gn(function(){t(null,s)}),s.type=function(){return"http"},s.id=i("id",function(e){r({},{method:"GET",url:fr(c,"")},function(t,r){var n=r&&r.uuid?r.uuid+c.db:lr(c,"");e(null,n)})}),s.request=i("request",function(e,t){e.url=lr(c,e.url),r({},e,t)}),s.compact=i("compact",function(e,t){"function"==typeof e&&(t=e,e={}),r(e=u(e),{url:lr(c,"_compact"),method:"POST"},function(){function r(){s.info(function(n,i){i&&!i.compact_running?t(null,{ok:!0}):setTimeout(r,e.interval||200)})}r()})}),s.bulkGet=f("bulkGet",function(e,t){function n(t){var n={};e.revs&&(n.revs=!0),e.attachments&&(n.attachments=!0),e.latest&&(n.latest=!0),r(e,{url:lr(c,"_bulk_get"+pr(n)),method:"POST",body:{docs:e.docs}},t)}function i(){for(var r=qi,n=Math.ceil(e.docs.length/r),i=0,a=new Array(n),s=0;s<n;s++){var u=v(e,["revs","attachments","latest"]);u.ajax=p,u.docs=e.docs.slice(s*r,Math.min(e.docs.length,(s+1)*r)),b(o,u,function(e){return function(r,o){a[e]=o.results,++i===n&&t(null,{results:R(a)})}}(s))}}var o=this,a=fr(c,""),s=Wi[a];"boolean"!=typeof s?n(function(e,r){e?(Wi[a]=!1,D(e.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),i()):(Wi[a]=!0,t(null,r))}):s?n(t):i()}),s._info=function(e){o().then(function(){r({},{method:"GET",url:lr(c,"")},function(t,r){if(t)return e(t);r.host=lr(c,""),e(null,r)})}).catch(e)},s.get=i("get",function(e,t,r){function i(e){function r(r){var o=i[r],s=ar(e._id)+"/"+a(r)+"?rev="+e._rev;return n(t,{method:"GET",url:lr(c,s),binary:!0}).then(function(e){return t.binary?e:new xn(function(t){Me(e,t)})}).then(function(e){delete o.stub,delete o.length,o.data=e})}var i=e._attachments,o=i&&Object.keys(i);if(i&&o.length)return ir(o.map(function(e){return function(){return r(e)}}),5)}function o(e){return Array.isArray(e)?xn.all(e.map(function(e){if(e.ok)return i(e.ok)})):i(e)}"function"==typeof t&&(r=t,t={});var s={};(t=u(t)).revs&&(s.revs=!0),t.revs_info&&(s.revs_info=!0),t.latest&&(s.latest=!0),t.open_revs&&("all"!==t.open_revs&&(t.open_revs=JSON.stringify(t.open_revs)),s.open_revs=t.open_revs),t.rev&&(s.rev=t.rev),t.conflicts&&(s.conflicts=t.conflicts),e=ar(e);var l={method:"GET",url:lr(c,e+pr(s))};n(t,l).then(function(e){return xn.resolve().then(function(){if(t.attachments)return o(e)}).then(function(){r(null,e)})}).catch(r)}),s.remove=i("remove",function(e,t,n,i){var o;"string"==typeof t?(o={_id:e,_rev:t},"function"==typeof n&&(i=n,n={})):(o=e,"function"==typeof t?(i=t,n={}):(i=n,n=t));var a=o._rev||n.rev;r(n,{method:"DELETE",url:lr(c,ar(o._id))+"?rev="+a},i)}),s.getAttachment=i("getAttachment",function(e,t,n,i){"function"==typeof n&&(i=n,n={});var o=n.rev?"?rev="+n.rev:"";r(n,{method:"GET",url:lr(c,ar(e))+"/"+a(t)+o,binary:!0},i)}),s.removeAttachment=i("removeAttachment",function(e,t,n,i){r({},{method:"DELETE",url:lr(c,ar(e)+"/"+a(t))+"?rev="+n},i)}),s.putAttachment=i("putAttachment",function(e,t,n,i,o,s){"function"==typeof o&&(s=o,o=i,i=n,n=null);var u=ar(e)+"/"+a(t),l=lr(c,u);if(n&&(l+="?rev="+n),"string"==typeof i){var f;try{f=ni(i)}catch(e){return s(F(Mn,"Attachment is not a valid base64 string"))}i=f?Pe(f,o):""}r({},{headers:{"Content-Type":o},method:"PUT",url:l,processData:!1,body:i,timeout:p.timeout||6e4},s)}),s._bulkDocs=function(e,t,n){e.new_edits=t.new_edits,o().then(function(){return xn.all(e.docs.map(sr))}).then(function(){r(t,{method:"POST",url:lr(c,"_bulk_docs"),timeout:t.timeout,body:e},function(e,t){if(e)return n(e);t.forEach(function(e){e.ok=!0}),n(null,t)})}).catch(n)},s._put=function(e,t,n){o().then(function(){return sr(e)}).then(function(){r(t,{method:"PUT",url:lr(c,ar(e._id)),body:e},function(e,t){if(e)return n(e);n(null,t)})}).catch(n)},s.allDocs=i("allDocs",function(e,t){"function"==typeof e&&(t=e,e={});var r,i={},o="GET";(e=u(e)).conflicts&&(i.conflicts=!0),e.descending&&(i.descending=!0),e.include_docs&&(i.include_docs=!0),e.attachments&&(i.attachments=!0),e.key&&(i.key=JSON.stringify(e.key)),e.start_key&&(e.startkey=e.start_key),e.startkey&&(i.startkey=JSON.stringify(e.startkey)),e.end_key&&(e.endkey=e.end_key),e.endkey&&(i.endkey=JSON.stringify(e.endkey)),void 0!==e.inclusive_end&&(i.inclusive_end=!!e.inclusive_end),void 0!==e.limit&&(i.limit=e.limit),void 0!==e.skip&&(i.skip=e.skip);var a=pr(i);void 0!==e.keys&&(o="POST",r={keys:e.keys}),n(e,{method:o,url:lr(c,"_all_docs"+a),body:r}).then(function(r){e.include_docs&&e.attachments&&e.binary&&r.rows.forEach(or),t(null,r)}).catch(t)}),s._changes=function(e){var t="batch_size"in e?e.batch_size:Mi;(e=u(e)).timeout="timeout"in e?e.timeout:"timeout"in p?p.timeout:3e4;var n,i=e.timeout?{timeout:e.timeout-5e3}:{},a=void 0!==e.limit&&e.limit;n="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var s=a;if(e.style&&(i.style=e.style),(e.include_docs||e.filter&&"function"==typeof e.filter)&&(i.include_docs=!0),e.attachments&&(i.attachments=!0),e.continuous&&(i.feed="longpoll"),e.conflicts&&(i.conflicts=!0),e.descending&&(i.descending=!0),"heartbeat"in e?e.heartbeat&&(i.heartbeat=e.heartbeat):e.continuous&&(i.heartbeat=1e4),e.filter&&"string"==typeof e.filter&&(i.filter=e.filter),e.view&&"string"==typeof e.view&&(i.filter="_view",i.view=e.view),e.query_params&&"object"==typeof e.query_params)for(var l in e.query_params)e.query_params.hasOwnProperty(l)&&(i[l]=e.query_params[l]);var f,d="GET";e.doc_ids&&(i.filter="_doc_ids",d="POST",f={doc_ids:e.doc_ids});var h,m,v=function(n,u){if(!e.aborted){i.since=n,"object"==typeof i.since&&(i.since=JSON.stringify(i.since)),e.descending?a&&(i.limit=s):i.limit=!a||s>t?t:s;var l={method:d,url:lr(c,"_changes"+pr(i)),timeout:e.timeout,body:f};m=n,e.aborted||o().then(function(){h=r(e,l,u)}).catch(u)}},y={results:[]},g=function(r,i){if(!e.aborted){var o=0;if(i&&i.results)o=i.results.length,y.last_seq=i.last_seq,{}.query=e.query_params,i.results=i.results.filter(function(t){s--;var r=B(e)(t);return r&&(e.include_docs&&e.attachments&&e.binary&&or(t),n&&y.results.push(t),e.onChange(t)),r});else if(r)return e.aborted=!0,void e.complete(r);i&&i.last_seq&&(m=i.last_seq);var u=a&&s<=0||i&&o<t||e.descending;(!e.continuous||a&&s<=0)&&u?e.complete(null,y):gn(function(){v(m,g)})}};return v(e.since||0,g),{cancel:function(){e.aborted=!0,h&&h.abort()}}},s.revsDiff=i("revsDiff",function(e,t,n){"function"==typeof t&&(n=t,t={}),r(t,{method:"POST",url:lr(c,"_revs_diff"),body:e},n)}),s._close=function(e){e()},s._destroy=function(e,t){r(e,{url:lr(c,""),method:"DELETE"},function(e,r){if(e&&e.status&&404!==e.status)return t(e);t(null,r)})}}function hr(e){this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,hr)}catch(e){}}function mr(e){this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,mr)}catch(e){}}function vr(e){this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,vr)}catch(e){}}function yr(e,t){return t&&e.then(function(e){gn(function(){t(null,e)})},function(e){gn(function(){t(e)})}),e}function gr(e){return hn(function(t){var r=t.pop(),n=e.apply(this,t);return"function"==typeof r&&yr(n,r),n})}function br(e,t){return e.then(function(e){return t().then(function(){return e})},function(e){return t().then(function(){throw e})})}function _r(e,t){return function(){var r=arguments,n=this;return e.add(function(){return t.apply(n,r)})}}function wr(e){var t=new An(e),r=new Array(t.size),n=-1;return t.forEach(function(e){r[++n]=e}),r}function xr(e){var t=new Array(e.size),r=-1;return e.forEach(function(e,n){t[++r]=n}),t}function kr(e){return new vr("builtin "+e+" function requires map values to be numbers or number arrays")}function Er(e){for(var t=0,r=0,n=e.length;r<n;r++){var i=e[r];if("number"!=typeof i){if(!Array.isArray(i))throw kr("_sum");t="number"==typeof t?[t]:t;for(var o=0,a=i.length;o<a;o++){var s=i[o];if("number"!=typeof s)throw kr("_sum");void 0===t[o]?t.push(s):t[o]+=s}}else"number"==typeof t?t+=i:t[0]+=i}return t}function Sr(e,t){return bn("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:Er,log:Ui,isArray:zi,toJSON:Vi})}function Ar(e,t,r){for(var n="",i=r-e.length;n.length<i;)n+=t;return n}function Dr(e,t,r){return Ar(e,t,r)+e}function Cr(e,t){if(e===t)return 0;e=Fr(e),t=Fr(t);var r=Nr(e),n=Nr(t);if(r-n!=0)return r-n;switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return Ir(e,t)}return Array.isArray(e)?Tr(e,t):Lr(e,t)}function Fr(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var r=e.length;e=new Array(r);for(var n=0;n<r;n++)e[n]=Fr(t[n])}else{if(e instanceof Date)return e.toJSON();if(null!==e){e={};for(var i in t)if(t.hasOwnProperty(i)){var o=t[i];void 0!==o&&(e[i]=Fr(o))}}}}return e}function Or(e){if(null!==e)switch(typeof e){case"boolean":return e?1:0;case"number":return Mr(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),r=t?e:Object.keys(e),n=-1,i=r.length,o="";if(t)for(;++n<i;)o+=jr(r[n]);else for(;++n<i;){var a=r[n];o+=jr(a)+jr(e[a])}return o}return""}function jr(e){return e=Fr(e),Nr(e)+Ji+Or(e)+"\0"}function Br(e,t){var r,n=t;if("1"===e[t])r=0,t++;else{var i="0"===e[t];t++;var o="",a=e.substring(t,t+Hi),s=parseInt(a,10)+Gi;for(i&&(s=-s),t+=Hi;;){var u=e[t];if("\0"===u)break;o+=u,t++}r=1===(o=o.split(".")).length?parseInt(o,10):parseFloat(o[0]+"."+o[1]),i&&(r-=10),0!==s&&(r=parseFloat(r+"e"+s))}return{num:r,length:t-n}}function Rr(e,t){var r=e.pop();if(t.length){var n=t[t.length-1];r===n.element&&(t.pop(),n=t[t.length-1]);var i=n.element,o=n.index;Array.isArray(i)?i.push(r):o===e.length-2?i[e.pop()]=r:e.push(r)}}function Pr(e){for(var t=[],r=[],n=0;;){var i=e[n++];if("\0"!==i)switch(i){case"1":t.push(null);break;case"2":t.push("1"===e[n]),n++;break;case"3":var o=Br(e,n);t.push(o.num),n+=o.length;break;case"4":for(var a="";;){var s=e[n];if("\0"===s)break;a+=s,n++}a=a.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),t.push(a);break;case"5":var u={element:[],index:t.length};t.push(u.element),r.push(u);break;case"6":var c={element:{},index:t.length};t.push(c.element),r.push(c);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}else{if(1===t.length)return t.pop();Rr(t,r)}}}function Tr(e,t){for(var r=Math.min(e.length,t.length),n=0;n<r;n++){var i=Cr(e[n],t[n]);if(0!==i)return i}return e.length===t.length?0:e.length>t.length?1:-1}function Ir(e,t){return e===t?0:e>t?1:-1}function Lr(e,t){for(var r=Object.keys(e),n=Object.keys(t),i=Math.min(r.length,n.length),o=0;o<i;o++){var a=Cr(r[o],n[o]);if(0!==a)return a;if(0!==(a=Cr(e[r[o]],t[n[o]])))return a}return r.length===n.length?0:r.length>n.length?1:-1}function Nr(e){var t=["boolean","number","string","object"].indexOf(typeof e);return~t?null===e?1:Array.isArray(e)?5:t<3?t+2:t+3:Array.isArray(e)?5:void 0}function Mr(e){if(0===e)return"1";var t=e.toExponential().split(/e\+?/),r=parseInt(t[1],10),n=e<0,i=n?"0":"2",o=Dr(((n?-r:r)-Gi).toString(),"0",Hi);i+=Ji+o;var a=Math.abs(parseFloat(t[0]));n&&(a=10-a);var s=a.toFixed(20);return s=s.replace(/\.?0+$/,""),i+=Ji+s}function qr(){this.promise=new xn(function(e){e()})}function Wr(e,t,r,n,i,o){var a,s=r.toString()+(n&&n.toString())+"undefined";if(!i&&(a=e._cachedViews=e._cachedViews||{})[s])return a[s];var u=e.info().then(function(u){var c=u.db_name+"-mrview-"+(i?"temp":Ge(s));return M(e,"_local/"+o,function(e){e.views=e.views||{};var r=t;-1===r.indexOf("/")&&(r=t+"/"+t);var n=e.views[r]=e.views[r]||{};if(!n[c])return n[c]=!0,e}).then(function(){return e.registerDependentDatabase(c).then(function(t){var i=t.db;i.auto_compaction=!0;var o={name:c,db:i,sourceDB:e,adapter:e.adapter,mapFun:r,reduceFun:n};return o.db.get("_local/lastSeq").catch(function(e){if(404!==e.status)throw e}).then(function(e){return o.seq=e?e.seq:0,a&&o.db.once("destroyed",function(){delete a[s]}),o})})})});return a&&(a[s]=u),u}function $r(e){return-1===e.indexOf("/")?[e,e]:e.split("/")}function Ur(e){return 1===e.length&&/^1-/.test(e[0].rev)}function zr(e,t){try{e.emit("error",t)}catch(e){E("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),E("error",t)}}function Vr(e){return/^1-/.test(e)}function Gr(e,t,r){return!e._attachments||!e._attachments[r]||e._attachments[r].digest!==t._attachments[r].digest}function Hr(e,t){var r=Object.keys(t._attachments);return xn.all(r.map(function(r){return e.getAttachment(t._id,r,{rev:t._rev})}))}function Jr(e,t,r){var n="http"===t.type()&&"http"!==e.type(),i=Object.keys(r._attachments);return n?e.get(r._id).then(function(n){return xn.all(i.map(function(i){return Gr(n,r,i)?t.getAttachment(r._id,i):e.getAttachment(n._id,i)}))}).catch(function(e){if(404!==e.status)throw e;return Hr(t,r)}):Hr(t,r)}function Kr(e){var t=[];return Object.keys(e).forEach(function(r){e[r].missing.forEach(function(e){t.push({id:r,rev:e})})}),{docs:t,revs:!0,latest:!0}}function Yr(e,t,r,n){function i(e){return e._attachments&&Object.keys(e._attachments).length>0}function o(e){return e._conflicts&&e._conflicts.length>0}function a(t){return e.allDocs({keys:t,include_docs:!0,conflicts:!0}).then(function(e){if(n.cancelled)throw new Error("cancelled");e.rows.forEach(function(e){e.deleted||!e.doc||!Vr(e.value.rev)||i(e.doc)||o(e.doc)||(e.doc._conflicts&&delete e.doc._conflicts,s.push(e.doc),delete r[e.id])})})}r=u(r);var s=[],c=!0;return xn.resolve().then(function(){var e=Object.keys(r).filter(function(e){var t=r[e].missing;return 1===t.length&&Vr(t[0])});if(e.length>0)return a(e)}).then(function(){var i=Kr(r);if(i.docs.length)return e.bulkGet(i).then(function(r){if(n.cancelled)throw new Error("cancelled");return xn.all(r.results.map(function(r){return xn.all(r.docs.map(function(r){var n=r.ok;return r.error&&(c=!1),n&&n._attachments?Jr(t,e,n).then(function(e){var t=Object.keys(n._attachments);return e.forEach(function(e,r){var i=n._attachments[t[r]];delete i.stub,delete i.length,i.data=e}),n}):n}))})).then(function(e){s=s.concat(R(e).filter(Boolean))})})}).then(function(){return{ok:c,docs:s}})}function Qr(e,t,r,n,i){return e.get(t).catch(function(r){if(404===r.status)return"http"===e.type()&&D(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:n,_id:t,history:[],replicator:ro,version:to};throw r}).then(function(o){if(!i.cancelled&&o.last_seq!==r)return o.history=(o.history||[]).filter(function(e){return e.session_id!==n}),o.history.unshift({last_seq:r,session_id:n}),o.history=o.history.slice(0,no),o.version=to,o.replicator=ro,o.session_id=n,o.last_seq=r,e.put(o).catch(function(o){if(409===o.status)return Qr(e,t,r,n,i);throw o})})}function Xr(e,t,r,n){this.src=e,this.target=t,this.id=r,this.returnValue=n}function Zr(e,t){return e.session_id===t.session_id?{last_seq:e.last_seq,history:e.history}:en(e.history,t.history)}function en(e,t){var r=e[0],n=e.slice(1),i=t[0],o=t.slice(1);return r&&0!==t.length?tn(r.session_id,t)?{last_seq:r.last_seq,history:e}:tn(i.session_id,n)?{last_seq:i.last_seq,history:o}:en(n,o):{last_seq:io,history:[]}}function tn(e,t){var r=t[0],n=t.slice(1);return!(!e||0===t.length)&&(e===r.session_id||tn(e,n))}function rn(e){return"number"==typeof e.status&&4===Math.floor(e.status/100)}function nn(e,t,r,n){if(!1===e.retry)return t.emit("error",r),void t.removeAllListeners();if("function"!=typeof e.back_off_function&&(e.back_off_function=A),t.emit("requestError",r),"active"===t.state||"pending"===t.state){t.emit("paused",r),t.state="stopped";var i=function(){e.current_back_off=ao},o=function(){t.removeListener("active",i)};t.once("paused",o),t.once("active",i)}e.current_back_off=e.current_back_off||ao,e.current_back_off=e.back_off_function(e.current_back_off),setTimeout(n,e.current_back_off)}function on(e){return Object.keys(e).sort(Cr).reduce(function(t,r){return t[r]=e[r],t},{})}function an(e,t,r){var n=r.doc_ids?r.doc_ids.sort(Cr):"",i=r.filter?r.filter.toString():"",o="",a="";return r.filter&&r.query_params&&(o=JSON.stringify(on(r.query_params))),r.filter&&"_view"===r.filter&&(a=r.view.toString()),xn.all([e.id(),t.id()]).then(function(e){var t=e[0]+e[1]+i+a+o+n;return new xn(function(e){Ve(t,e)})}).then(function(e){return"_local/"+(e=e.replace(/\//g,".").replace(/\+/g,"_"))})}function sn(e,t,r,n,i){function o(){return k?xn.resolve():an(e,t,r).then(function(r){k=new Xr(e,t,x=r,n)})}function a(){if(I=[],0!==w.docs.length){var e=w.docs,o={timeout:r.timeout};return t.bulkDocs({docs:e,new_edits:!1},o).then(function(t){if(n.cancelled)throw h(),new Error("cancelled");var r=Object.create(null);t.forEach(function(e){e.error&&(r[e.id]=e)});var o=Object.keys(r).length;i.doc_write_failures+=o,i.docs_written+=e.length-o,e.forEach(function(e){var t=r[e._id];if(t){if(i.errors.push(t),"unauthorized"!==t.name&&"forbidden"!==t.name)throw t;n.emit("denied",u(t))}else I.push(e)})},function(t){throw i.doc_write_failures+=e.length,t})}}function s(){if(w.error)throw new Error("There was a problem getting docs.");i.last_seq=F=w.seq;var e=u(i);return I.length&&(e.docs=I,n.emit("change",e)),A=!0,k.writeCheckpoint(w.seq,L).then(function(){if(A=!1,n.cancelled)throw h(),new Error("cancelled");w=void 0,g()}).catch(function(e){throw _(e),e})}function c(){var e={};return w.changes.forEach(function(t){"_user/"!==t.id&&(e[t.id]=t.changes.map(function(e){return e.rev}))}),t.revsDiff(e).then(function(e){if(n.cancelled)throw h(),new Error("cancelled");w.diffs=e})}function l(){return Yr(e,t,w.diffs,n).then(function(e){w.error=!e.ok,e.docs.forEach(function(e){delete w.diffs[e._id],i.docs_read++,w.docs.push(e)})})}function f(){n.cancelled||w||(0!==E.length?(w=E.shift(),c().then(l).then(a).then(s).then(f).catch(function(e){d("batch processing terminated with error",e)})):p(!0))}function p(e){0!==S.changes.length?(e||D||S.changes.length>=j)&&(E.push(S),S={seq:0,changes:[],docs:[]},"pending"!==n.state&&"stopped"!==n.state||(n.state="active",n.emit("active")),f()):0!==E.length||w||((O&&N.live||D)&&(n.state="pending",n.emit("paused")),D&&h())}function d(e,t){C||(t.message||(t.message=e),i.ok=!1,i.status="aborting",E=[],S={seq:0,changes:[],docs:[]},h(t))}function h(o){C||n.cancelled&&(i.status="cancelled",A)||(i.status=i.status||"complete",i.end_time=new Date,i.last_seq=F,C=!0,o?(o.result=i,"unauthorized"===o.name||"forbidden"===o.name?(n.emit("error",o),n.removeAllListeners()):nn(r,n,o,function(){sn(e,t,r,n)})):(n.emit("complete",i),n.removeAllListeners()))}function m(e){if(n.cancelled)return h();B(r)(e)&&(S.seq=e.seq,S.changes.push(e),p(0===E.length&&N.live))}function v(e){if(P=!1,n.cancelled)return h();if(e.results.length>0)N.since=e.last_seq,g(),p(!0);else{var t=function(){O?(N.live=!0,g()):D=!0,p(!0)};w||0!==e.results.length?t():(A=!0,k.writeCheckpoint(e.last_seq,L).then(function(){A=!1,i.last_seq=F=e.last_seq,t()}).catch(_))}}function y(e){if(P=!1,n.cancelled)return h();d("changes rejected",e)}function g(){function t(){o.cancel()}function i(){n.removeListener("cancel",t)}if(!P&&!D&&E.length<R){P=!0,n._changes&&(n.removeListener("cancel",n._abortChanges),n._changes.cancel()),n.once("cancel",t);var o=e.changes(N).on("change",m);o.then(i,i),o.then(v).catch(y),r.retry&&(n._changes=o,n._abortChanges=t)}}function b(){o().then(function(){if(!n.cancelled)return k.getCheckpoint().then(function(e){N={since:F=e,limit:j,batch_size:j,style:"all_docs",doc_ids:T,return_docs:!0},r.filter&&("string"!=typeof r.filter?N.include_docs=!0:N.filter=r.filter),"heartbeat"in r&&(N.heartbeat=r.heartbeat),"timeout"in r&&(N.timeout=r.timeout),r.query_params&&(N.query_params=r.query_params),r.view&&(N.view=r.view),g()});h()}).catch(function(e){d("getCheckpoint rejected with ",e)})}function _(e){A=!1,d("writeCheckpoint completed with error",e)}var w,x,k,E=[],S={seq:0,changes:[],docs:[]},A=!1,D=!1,C=!1,F=0,O=r.continuous||r.live||!1,j=r.batch_size||100,R=r.batches_limit||10,P=!1,T=r.doc_ids,I=[],L=$();i=i||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var N={};n.ready(e,t),n.cancelled?h():(n._addedListeners||(n.once("cancel",h),"function"==typeof r.complete&&(n.once("error",r.complete),n.once("complete",function(e){r.complete(null,e)})),n._addedListeners=!0),void 0===r.since?b():o().then(function(){return A=!0,k.writeCheckpoint(r.since,L)}).then(function(){A=!1,n.cancelled?h():(F=r.since,b())}).catch(_))}function un(){vn.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var e=this,t=new xn(function(t,r){e.once("complete",t),e.once("error",r)});e.then=function(e,r){return t.then(e,r)},e.catch=function(e){return t.catch(e)},e.catch(function(){})}function cn(e,t){var r=t.PouchConstructor;return"string"==typeof e?new r(e,t):e}function ln(e,t,r,n){if("function"==typeof r&&(n=r,r={}),void 0===r&&(r={}),r.doc_ids&&!Array.isArray(r.doc_ids))throw F($n,"`doc_ids` filter parameter is not a list.");r.complete=n,(r=u(r)).continuous=r.continuous||r.live,r.retry="retry"in r&&r.retry,r.PouchConstructor=r.PouchConstructor||this;var i=new un(r);return sn(cn(e,r),cn(t,r),r,i),i}function fn(e,t,r,n){return"function"==typeof r&&(n=r,r={}),void 0===r&&(r={}),r=u(r),r.PouchConstructor=r.PouchConstructor||this,e=cn(e,r),t=cn(t,r),new pn(e,t,r,n)}function pn(e,t,r,n){function i(e){h.emit("change",{direction:"pull",change:e})}function o(e){h.emit("change",{direction:"push",change:e})}function a(e){h.emit("denied",{direction:"push",doc:e})}function s(e){h.emit("denied",{direction:"pull",doc:e})}function u(){h.pushPaused=!0,h.pullPaused&&h.emit("paused")}function c(){h.pullPaused=!0,h.pushPaused&&h.emit("paused")}function l(){h.pushPaused=!1,h.pullPaused&&h.emit("active",{direction:"push"})}function f(){h.pullPaused=!1,h.pushPaused&&h.emit("active",{direction:"pull"})}function p(e){return function(t,r){var n="change"===t&&(r===i||r===o),p="denied"===t&&(r===s||r===a),d="paused"===t&&(r===c||r===u),m="active"===t&&(r===f||r===l);(n||p||d||m)&&(t in y||(y[t]={}),y[t][e]=!0,2===Object.keys(y[t]).length&&h.removeAllListeners(t))}}function d(e,t,r){-1==e.listeners(t).indexOf(r)&&e.on(t,r)}var h=this;this.canceled=!1;var m=r.push?jn({},r,r.push):r,v=r.pull?jn({},r,r.pull):r;this.push=ln(e,t,m),this.pull=ln(t,e,v),this.pushPaused=!0,this.pullPaused=!0;var y={};r.live&&(this.push.on("complete",h.pull.cancel.bind(h.pull)),this.pull.on("complete",h.push.cancel.bind(h.push))),this.on("newListener",function(e){"change"===e?(d(h.pull,"change",i),d(h.push,"change",o)):"denied"===e?(d(h.pull,"denied",s),d(h.push,"denied",a)):"active"===e?(d(h.pull,"active",f),d(h.push,"active",l)):"paused"===e&&(d(h.pull,"paused",c),d(h.push,"paused",u))}),this.on("removeListener",function(e){"change"===e?(h.pull.removeListener("change",i),h.push.removeListener("change",o)):"denied"===e?(h.pull.removeListener("denied",s),h.push.removeListener("denied",a)):"active"===e?(h.pull.removeListener("active",f),h.push.removeListener("active",l)):"paused"===e&&(h.pull.removeListener("paused",c),h.push.removeListener("paused",u))}),this.pull.on("removeListener",p("pull")),this.push.on("removeListener",p("push"));var g=xn.all([this.push,this.pull]).then(function(e){var t={push:e[0],pull:e[1]};return h.emit("complete",t),n&&n(null,t),h.removeAllListeners(),t},function(e){if(h.cancel(),n?n(e):h.emit("error",e),h.removeAllListeners(),n)throw e});this.then=function(e,t){return g.then(e,t)},this.catch=function(e){return g.catch(e)}}var dn=n(e(7)),hn=n(e(1)),mn=n(e(2)),vn=e(4),yn=n(e(6)),gn=n(e(5)),bn=n(e(10)),_n=n(e(11)),wn=n(e(12)),xn="function"==typeof Promise?Promise:dn,kn=Function.prototype.toString,En=kn.call(Object),Sn=mn("pouchdb:api");h.prototype.get=function(e){var t=p(e);return this._store[t]},h.prototype.set=function(e,t){var r=p(e);return this._store[r]=t,!0},h.prototype.has=function(e){return p(e)in this._store},h.prototype.delete=function(e){var t=p(e),r=t in this._store;return delete this._store[t],r},h.prototype.forEach=function(e){for(var t=Object.keys(this._store),r=0,n=t.length;r<n;r++){var i=t[r];e(this._store[i],i=d(i))}},Object.defineProperty(h.prototype,"size",{get:function(){return Object.keys(this._store).length}}),m.prototype.add=function(e){return this._store.set(e,!0)},m.prototype.has=function(e){return this._store.has(e)},m.prototype.forEach=function(e){this._store.forEach(function(t,r){e(r)})},Object.defineProperty(m.prototype,"size",{get:function(){return this._store.size}});var An,Dn;!function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}()?(An=m,Dn=h):(An=Set,Dn=Map);var Cn,Fn=6;if(_())Cn=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),Cn=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){Cn=!1}yn(k,vn.EventEmitter),k.prototype.addListener=function(e,t,r,n){function i(){if(o._listeners[t])if(a)a="waiting";else{a=!0;var e=v(n,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);r.changes(e).on("change",function(e){e.seq>n.since&&!n.cancelled&&(n.since=e.seq,n.onChange(e))}).on("complete",function(){"waiting"===a&&gn(i),a=!1}).on("error",function(){a=!1})}}if(!this._listeners[t]){var o=this,a=!1;this._listeners[t]=i,this.on(e,i)}},k.prototype.removeListener=function(e,t){t in this._listeners&&(vn.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},k.prototype.notifyLocalWindows=function(e){_()?chrome.storage.local.set({dbName:e}):w()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},k.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var On,jn=On="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t};yn(C,Error),C.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};new C(401,"unauthorized","Name or password is incorrect.");var Bn=new C(400,"bad_request","Missing JSON list of 'docs'"),Rn=new C(404,"not_found","missing"),Pn=new C(409,"conflict","Document update conflict"),Tn=new C(400,"bad_request","_id field must contain a string"),In=new C(412,"missing_id","_id is required for puts"),Ln=new C(400,"bad_request","Only reserved document ids may start with underscore."),Nn=(new C(412,"precondition_failed","Database not open"),new C(500,"unknown_error","Database encountered an unknown error")),Mn=new C(500,"badarg","Some query argument is invalid"),qn=(new C(400,"invalid_request","Request was invalid"),new C(400,"query_parse_error","Some query parameter is invalid")),Wn=new C(500,"doc_validation","Bad special document member"),$n=new C(400,"bad_request","Something wrong with the request"),Un=new C(400,"bad_request","Document must be a JSON object"),zn=(new C(404,"not_found","Database not found"),new C(500,"indexed_db_went_bad","unknown")),Vn=new C(500,"web_sql_went_bad","unknown"),Gn=(new C(500,"levelDB_went_went_bad","unknown"),new C(403,"forbidden","Forbidden by design doc validate_doc_update function"),new C(400,"bad_request","Invalid rev format")),Hn=(new C(412,"file_exists","The database could not be created, the file already exists."),new C(412,"missing_stub","A pre-existing attachment stub wasn't found"));new C(413,"invalid_url","Provided URL is invalid");var Jn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Kn="queryKey",Yn=/(?:^|&)([^&=]*)=?([^&]*)/g,Qn=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Xn="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");yn(de,vn.EventEmitter),de.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},de.prototype.doChanges=function(e){var t=this,r=e.complete;if("live"in(e=u(e))&&!("continuous"in e)&&(e.continuous=e.live),e.processChange=he,"latest"===e.since&&(e.since="now"),e.since||(e.since=0),"now"!==e.since){if(e.view&&!e.filter&&(e.filter="_view"),e.filter&&"string"==typeof e.filter&&("_view"===e.filter?e.view=L(e.view):e.filter=L(e.filter),"http"!==this.db.type()&&!e.doc_ids))return this.filterChanges(e);"descending"in e||(e.descending=!1),e.limit=0===e.limit?1:e.limit,e.complete=r;var n=this.db._changes(e);if(n&&"function"==typeof n.cancel){var i=t.cancel;t.cancel=hn(function(e){n.cancel(),i.apply(this,e)})}}else this.db.info().then(function(n){t.isCancelled?r(null,{status:"cancelled"}):(e.since=n.update_seq,t.doChanges(e))},r)},de.prototype.filterChanges=function(e){var t=this,r=e.complete;if("_view"===e.filter){if(!e.view||"string"!=typeof e.view){var n=F($n,"`view` filter parameter not found or invalid.");return r(n)}var i=I(e.view);this.db.get("_design/"+i[0],function(n,o){if(t.isCancelled)return r(null,{status:"cancelled"});if(n)return r(O(n));var a=o&&o.views&&o.views[i[1]]&&o.views[i[1]].map;if(!a)return r(F(Rn,o.views?"missing json key: "+i[1]:"missing json key: views"));e.filter=fe(a),t.doChanges(e)})}else{var o=I(e.filter);if(!o)return t.doChanges(e);this.db.get("_design/"+o[0],function(n,i){if(t.isCancelled)return r(null,{status:"cancelled"});if(n)return r(O(n));var a=i&&i.filters&&i.filters[o[1]];if(!a)return r(F(Rn,i&&i.filters?"missing json key: "+o[1]:"missing json key: filters"));e.filter=le(a),t.doChanges(e)})}},yn(ke,vn.EventEmitter),ke.prototype.post=f("post",function(e,t,r){if("function"==typeof t&&(r=t,t={}),"object"!=typeof e||Array.isArray(e))return r(F(Un));this.bulkDocs({docs:[e]},t,ve(r))}),ke.prototype.put=f("put",function(e,t,r){return"function"==typeof t&&(r=t,t={}),"object"!=typeof e||Array.isArray(e)?r(F(Un)):(P(e._id),ue(e._id)&&"function"==typeof this._putLocal?e._deleted?this._removeLocal(e,r):this._putLocal(e,r):void("function"==typeof this._put&&!1!==t.new_edits?this._put(e,t,r):this.bulkDocs({docs:[e]},t,ve(r))))}),ke.prototype.putAttachment=f("putAttachment",function(e,t,r,n,i){function o(e){var r="_rev"in e?parseInt(e._rev,10):0;return e._attachments=e._attachments||{},e._attachments[t]={content_type:i,data:n,revpos:++r},a.put(e)}var a=this;return"function"==typeof i&&(i=n,n=r,r=null),void 0===i&&(i=n,n=r,r=null),i||E("warn","Attachment",t,"on document",e,"is missing content_type"),a.get(e).then(function(e){if(e._rev!==r)throw F(Pn);return o(e)},function(t){if(t.reason===Rn.message)return o({_id:e});throw t})}),ke.prototype.removeAttachment=f("removeAttachment",function(e,t,r,n){var i=this;i.get(e,function(e,o){if(e)n(e);else if(o._rev===r){if(!o._attachments)return n();delete o._attachments[t],0===Object.keys(o._attachments).length&&delete o._attachments,i.put(o,n)}else n(F(Pn))})}),ke.prototype.remove=f("remove",function(e,t,r,n){var i;"string"==typeof t?(i={_id:e,_rev:t},"function"==typeof r&&(n=r,r={})):(i=e,"function"==typeof t?(n=t,r={}):(n=r,r=t)),(r=r||{}).was_delete=!0;var o={_id:i._id,_rev:i._rev||r.rev};if(o._deleted=!0,ue(o._id)&&"function"==typeof this._removeLocal)return this._removeLocal(i,n);this.bulkDocs({docs:[o]},r,ve(n))}),ke.prototype.revsDiff=f("revsDiff",function(e,t,r){function n(e,t){s.has(e)||s.set(e,{missing:[]}),s.get(e).missing.push(t)}function i(t,r){var i=e[t].slice(0);z(r,function(e,r,o,a,s){var u=r+"-"+o,c=i.indexOf(u);-1!==c&&(i.splice(c,1),"available"!==s.status&&n(t,u))}),i.forEach(function(e){n(t,e)})}"function"==typeof t&&(r=t,t={});var o=Object.keys(e);if(!o.length)return r(null,{});var a=0,s=new Dn;o.map(function(t){this._getRevisionTree(t,function(n,u){if(n&&404===n.status&&"missing"===n.message)s.set(t,{missing:e[t]});else{if(n)return r(n);i(t,u)}if(++a===o.length){var c={};return s.forEach(function(e,t){c[t]=e}),r(null,c)}})},this)}),ke.prototype.bulkGet=f("bulkGet",function(e,t){b(this,e,t)}),ke.prototype.compactDocument=f("compactDocument",function(e,t,r){var n=this;this._getRevisionTree(e,function(i,o){if(i)return r(i);var a=be(o),s=[],u=[];Object.keys(a).forEach(function(e){a[e]>t&&s.push(e)}),z(o,function(e,t,r,n,i){var o=t+"-"+r;"available"===i.status&&-1!==s.indexOf(o)&&u.push(o)}),n._doCompaction(e,u,r)})}),ke.prototype.compact=f("compact",function(e,t){"function"==typeof e&&(t=e,e={});var r=this;e=e||{},r._compactionQueue=r._compactionQueue||[],r._compactionQueue.push({opts:e,callback:t}),1===r._compactionQueue.length&&we(r)}),ke.prototype._compact=function(e,t){var r=this,n={return_docs:!1,last_seq:e.last_seq||0},i=[];r.changes(n).on("change",function(e){i.push(r.compactDocument(e.id,0))}).on("complete",function(e){var n=e.last_seq;xn.all(i).then(function(){return M(r,"_local/compaction",function(e){return(!e.last_seq||e.last_seq<n)&&(e.last_seq=n,e)})}).then(function(){t(null,{ok:!0})}).catch(t)}).on("error",t)},ke.prototype.get=f("get",function(e,t,r){function n(){var n=[],a=i.length;if(!a)return r(null,n);i.forEach(function(i){o.get(e,{rev:i,revs:t.revs,latest:t.latest,attachments:t.attachments},function(e,t){if(e)n.push({missing:i});else{for(var o,s=0,u=n.length;s<u;s++)if(n[s].ok&&n[s].ok._rev===t._rev){o=!0;break}o||n.push({ok:t})}--a||r(null,n)})})}if("function"==typeof t&&(r=t,t={}),"string"!=typeof e)return r(F(Tn));if(ue(e)&&"function"==typeof this._getLocal)return this._getLocal(e,r);var i=[],o=this;if(!t.open_revs)return this._get(e,t,function(e,n){if(e)return r(e);var i=n.doc,a=n.metadata,s=n.ctx;if(t.conflicts){var u=H(a);u.length&&(i._conflicts=u)}if(se(a,i._rev)&&(i._deleted=!0),t.revs||t.revs_info){for(var c=i._rev.split("-"),l=parseInt(c[0],10),f=c[1],p=K(a.rev_tree),d=null,h=0;h<p.length;h++){var m=p[h],v=m.ids.map(function(e){return e.id}).indexOf(f);(v===l-1||!d&&-1!==v)&&(d=m)}var y=d.ids.map(function(e){return e.id}).indexOf(i._rev.split("-")[1])+1,g=d.ids.length-y;if(d.ids.splice(y,g),d.ids.reverse(),t.revs&&(i._revisions={start:d.pos+d.ids.length-1,ids:d.ids.map(function(e){return e.id})}),t.revs_info){var b=d.pos+d.ids.length;i._revs_info=d.ids.map(function(e){return b--,{rev:b+"-"+e.id,status:e.opts.status}})}}if(t.attachments&&i._attachments){var _=i._attachments,w=Object.keys(_).length;if(0===w)return r(null,i);Object.keys(_).forEach(function(e){this._getAttachment(i._id,e,_[e],{rev:i._rev,binary:t.binary,ctx:s},function(t,n){var o=i._attachments[e];o.data=n,delete o.stub,delete o.length,--w||r(null,i)})},o)}else{if(i._attachments)for(var x in i._attachments)i._attachments.hasOwnProperty(x)&&(i._attachments[x].stub=!0);r(null,i)}});if("all"===t.open_revs)this._getRevisionTree(e,function(e,t){if(e)return r(e);i=G(t).map(function(e){return e.rev}),n()});else{if(!Array.isArray(t.open_revs))return r(F(Nn,"function_clause"));i=t.open_revs;for(var a=0;a<i.length;a++){var s=i[a];if("string"!=typeof s||!/^\d+-/.test(s))return r(F(Gn))}n()}}),ke.prototype.getAttachment=f("getAttachment",function(e,t,r,n){var i=this;r instanceof Function&&(n=r,r={}),this._get(e,r,function(o,a){return o?n(o):a.doc._attachments&&a.doc._attachments[t]?(r.ctx=a.ctx,r.binary=!0,void i._getAttachment(e,t,a.doc._attachments[t],r,n)):n(F(Rn))})}),ke.prototype.allDocs=f("allDocs",function(e,t){if("function"==typeof e&&(t=e,e={}),e.skip=void 0!==e.skip?e.skip:0,e.start_key&&(e.startkey=e.start_key),e.end_key&&(e.endkey=e.end_key),"keys"in e){if(!Array.isArray(e.keys))return t(new TypeError("options.keys must be an array"));var r=["startkey","endkey","key"].filter(function(t){return t in e})[0];if(r)return void t(F(qn,"Query parameter `"+r+"` is not compatible with multi-get"));if("http"!==this.type())return _e(this,e,t)}return this._allDocs(e,t)}),ke.prototype.changes=function(e,t){return"function"==typeof e&&(t=e,e={}),new de(this,e,t)},ke.prototype.close=f("close",function(e){return this._closed=!0,this.emit("closed"),this._close(e)}),ke.prototype.info=f("info",function(e){var t=this;this._info(function(r,n){if(r)return e(r);n.db_name=n.db_name||t.name,n.auto_compaction=!(!t.auto_compaction||"http"===t.type()),n.adapter=t.type(),e(null,n)})}),ke.prototype.id=f("id",function(e){return this._id(e)}),ke.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},ke.prototype.bulkDocs=f("bulkDocs",function(e,t,r){if("function"==typeof t&&(r=t,t={}),t=t||{},Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return r(F(Bn));for(var n=0;n<e.docs.length;++n)if("object"!=typeof e.docs[n]||Array.isArray(e.docs[n]))return r(F(Un));var i;if(e.docs.forEach(function(e){e._attachments&&Object.keys(e._attachments).forEach(function(t){i=i||xe(t),e._attachments[t].content_type||E("warn","Attachment",t,"on document",e._id,"is missing content_type")})}),i)return r(F($n,i));"new_edits"in t||(t.new_edits=!("new_edits"in e)||e.new_edits);var o=this;t.new_edits||"http"===o.type()||e.docs.sort(ge),ye(e.docs);var a=e.docs.map(function(e){return e._id});return this._bulkDocs(e,t,function(e,n){if(e)return r(e);if(t.new_edits||(n=n.filter(function(e){return e.error})),"http"!==o.type())for(var i=0,s=n.length;i<s;i++)n[i].id=n[i].id||a[i];r(null,n)})}),ke.prototype.registerDependentDatabase=f("registerDependentDatabase",function(e,t){var r=new this.constructor(e,this.__opts);M(this,"_local/_pouch_dependentDbs",function(t){return t.dependentDbs=t.dependentDbs||{},!t.dependentDbs[e]&&(t.dependentDbs[e]=!0,t)}).then(function(){t(null,{db:r})}).catch(t)}),ke.prototype.destroy=f("destroy",function(e,t){function r(){n._destroy(e,function(e,r){if(e)return t(e);n._destroyed=!0,n.emit("destroyed"),t(null,r||{ok:!0})})}"function"==typeof e&&(t=e,e={});var n=this,i=!("use_prefix"in n)||n.use_prefix;if("http"===n.type())return r();n.get("_local/_pouch_dependentDbs",function(e,o){if(e)return 404!==e.status?t(e):r();var a=o.dependentDbs,s=n.constructor,u=Object.keys(a).map(function(e){var t=i?e.replace(new RegExp("^"+s.prefix),""):e;return new s(t,n.__opts).destroy()});xn.all(u).then(r,t)})}),Ee.prototype.execute=function(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()},Ee.prototype.fail=function(e){this.failed=e,this.execute()},Ee.prototype.ready=function(e){this.isReady=!0,this.db=e,this.execute()},Ee.prototype.addTask=function(e){this.queue.push(e),this.failed&&this.execute()},yn(De,ke),De.debug=mn,De.adapters={},De.preferredAdapters=[],De.prefix="_pouch_";var Zn=new vn.EventEmitter;!function(e){Object.keys(vn.EventEmitter.prototype).forEach(function(t){"function"==typeof vn.EventEmitter.prototype[t]&&(e[t]=Zn[t].bind(Zn))});var t=e._destructionListeners=new Dn;e.on("destroyed",function(e){t.get(e).forEach(function(e){e()}),t.delete(e)})}(De),De.adapter=function(e,t,r){t.valid()&&(De.adapters[e]=t,r&&De.preferredAdapters.push(e))},De.plugin=function(e){if("function"==typeof e)e(De);else{if("object"!=typeof e||0===Object.keys(e).length)throw new Error('Invalid plugin: got "'+e+'", expected an object or a function');Object.keys(e).forEach(function(t){De.prototype[t]=e[t]})}return this.__defaults&&(De.__defaults=jn({},this.__defaults)),De},De.defaults=function(e){function t(e,r){if(!(this instanceof t))return new t(e,r);r=r||{},e&&"object"==typeof e&&(e=(r=e).name,delete r.name),r=jn({},t.__defaults,r),De.call(this,e,r)}return yn(t,De),t.preferredAdapters=De.preferredAdapters.slice(),Object.keys(De).forEach(function(e){e in t||(t[e]=De[e])}),t.__defaults=jn({},this.__defaults,e),t};De.version="6.1.2";var ei,ti=Ce(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),ri=Ce(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]),ni=function(e){return atob(e)},ii=function(e){return btoa(e)},oi=r.setImmediate||r.setTimeout,ai=32768,si=5,ui="document-store",ci="by-sequence",li="attach-store",fi="attach-seq-store",pi="meta-store",di="local-store",hi="detect-blob-support",mi=new k,vi=!1,yi=[],gi=new Dn,bi=new Dn;kt.valid=function(){return!("undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform))&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var _i=7,wi=jt("document-store"),xi=jt("by-sequence"),ki=jt("attach-store"),Ei=jt("local-store"),Si=jt("metadata-store"),Ai=jt("attach-seq-store"),Di=new Dn,Ci=new k,Fi=1,Oi="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+xi+" (seq, deleted)",ji="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+xi+" (doc_id, rev)",Bi="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+wi+" (winningseq)",Ri="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+Ai+" (seq)",Pi="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+Ai+" (digest, seq)",Ti=xi+".seq = "+wi+".winningseq",Ii=xi+".seq AS seq, "+xi+".deleted AS deleted, "+xi+".json AS data, "+xi+".rev AS rev, "+wi+".json AS metadata";Yt.valid=function(){return"function"==typeof openDatabase&&Jt()},Yt.use_prefix=!0;var Li=function(){try{return new XMLHttpRequest,!0}catch(e){return!1}}(),Ni=function(){},Mi=25,qi=50,Wi={},$i=mn("pouchdb:http");dr.valid=function(){return!0};yn(hr,Error),yn(mr,Error),yn(vr,Error);var Ui=E.bind(null,"log"),zi=Array.isArray,Vi=JSON.parse,Gi=-324,Hi=3,Ji="";qr.prototype.add=function(e){return this.promise=this.promise.catch(function(){}).then(function(){return e()}),this.promise},qr.prototype.finish=function(){return this.promise};var Ki={},Yi=new qr,Qi=50,Xi={_sum:function(e,t){return Er(t)},_count:function(e,t){return t.length},_stats:function(e,t){return{sum:Er(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:function(e){for(var t=0,r=0,n=e.length;r<n;r++){var i=e[r];t+=i*i}return t}(t)}}},Zi=function(e,t,r,n){function i(e,t,r){try{t(r)}catch(t){zr(e,t)}}function o(e,t,r,n,i){try{return{output:t(r,n,i)}}catch(t){return zr(e,t),{error:t}}}function a(e,t){var r=Cr(e.key,t.key);return 0!==r?r:Cr(e.value,t.value)}function s(e,t,r){return r=r||0,"number"==typeof t?e.slice(r,t+r):r>0?e.slice(r):e}function u(e){var t=e.value;return t&&"object"==typeof t&&t._id||e.id}function c(e){e.rows.forEach(function(e){var t=e.doc&&e.doc._attachments;t&&Object.keys(t).forEach(function(e){var r=t[e];t[e].data=Te(r.data,r.content_type)})})}function l(e){return function(t){return e.include_docs&&e.attachments&&e.binary&&c(t),t}}function f(e,t,r,n){var i=t[e];void 0!==i&&(n&&(i=encodeURIComponent(JSON.stringify(i))),r.push(e+"="+i))}function p(e){if(void 0!==e){var t=Number(e);return isNaN(t)||t!==parseInt(e,10)?e:t}}function d(e){return e.group_level=p(e.group_level),e.limit=p(e.limit),e.skip=p(e.skip),e}function h(e){if(e){if("number"!=typeof e)return new hr('Invalid value for integer: "'+e+'"');if(e<0)return new hr('Invalid value for positive integer: "'+e+'"')}}function m(e,t){var r=e.descending?"endkey":"startkey",n=e.descending?"startkey":"endkey";if(void 0!==e[r]&&void 0!==e[n]&&Cr(e[r],e[n])>0)throw new hr("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(t.reduce&&!1!==e.reduce){if(e.include_docs)throw new hr("{include_docs:true} is invalid for reduce");if(e.keys&&e.keys.length>1&&!e.group&&!e.group_level)throw new hr("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(t){var r=h(e[t]);if(r)throw r})}function v(e,t,r){var n,i=[],o="GET";if(f("reduce",r,i),f("include_docs",r,i),f("attachments",r,i),f("limit",r,i),f("descending",r,i),f("group",r,i),f("group_level",r,i),f("skip",r,i),f("stale",r,i),f("conflicts",r,i),f("startkey",r,i,!0),f("start_key",r,i,!0),f("endkey",r,i,!0),f("end_key",r,i,!0),f("inclusive_end",r,i),f("key",r,i,!0),i=i.join("&"),i=""===i?"":"?"+i,void 0!==r.keys){var a="keys="+encodeURIComponent(JSON.stringify(r.keys));a.length+i.length+1<=2e3?i+=("?"===i[0]?"&":"?")+a:(o="POST","string"==typeof t?n={keys:r.keys}:t.keys=r.keys)}if("string"==typeof t){var s=$r(t);return e.request({method:o,url:"_design/"+s[0]+"/_view/"+s[1]+i,body:n}).then(l(r))}return n=n||{},Object.keys(t).forEach(function(e){Array.isArray(t[e])?n[e]=t[e]:n[e]=t[e].toString()}),e.request({method:"POST",url:"_temp_view"+i,body:n}).then(l(r))}function y(e,t,r){return new xn(function(n,i){e._query(t,r,function(e,t){if(e)return i(e);n(t)})})}function g(e){return new xn(function(t,r){e._viewCleanup(function(e,n){if(e)return r(e);t(n)})})}function b(e){return function(t){if(404===t.status)return e;throw t}}function _(e,t,r){function n(e){return e.keys.length?t.db.allDocs({keys:e.keys,include_docs:!0}):xn.resolve({rows:[]})}function i(e,t){for(var r=[],n=new An,i=0,o=t.rows.length;i<o;i++){var a=t.rows[i].doc;if(a&&(r.push(a),n.add(a._id),a._deleted=!u.has(a._id),!a._deleted)){var s=u.get(a._id);"value"in s&&(a.value=s.value)}}var c=xr(u);return c.forEach(function(e){if(!n.has(e)){var t={_id:e},i=u.get(e);"value"in i&&(t.value=i.value),r.push(t)}}),e.keys=wr(c.concat(e.keys)),r.push(e),r}var o="_local/doc_"+e,a={_id:o,keys:[]},s=r.get(e),u=s[0];return(Ur(s[1])?xn.resolve(a):t.db.get(o).catch(b(a))).then(function(e){return n(e).then(function(t){return i(e,t)})})}function w(e,t,r){return e.db.get("_local/lastSeq").catch(b({_id:"_local/lastSeq",seq:0})).then(function(n){var i=xr(t);return xn.all(i.map(function(r){return _(r,e,t)})).then(function(t){var i=R(t);return n.seq=r,i.push(n),e.db.bulkDocs({docs:i})})})}function x(e){var t="string"==typeof e?e:e.name,r=Ki[t];return r||(r=Ki[t]=new qr),r}function k(e){return _r(x(e),function(){return E(e)})()}function E(e){function r(t,r){return function(){return w(e,t,r)}}function n(){return e.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:p,limit:Qi}).then(o)}function o(e){var t=e.results;if(t.length){var i=s(t);if(d.add(r(i,p)),!(t.length<Qi))return n()}}function s(t){for(var r=new Dn,n=0,o=t.length;n<o;n++){var s=t[n];if("_"!==s.doc._id[0]){c=[],(l=s.doc)._deleted||i(e.sourceDB,f,l),c.sort(a);var d=u(c);r.set(s.doc._id,[d,s.changes])}p=s.seq}return r}function u(e){for(var t,r=new Dn,n=0,i=e.length;n<i;n++){var o=e[n],a=[o.key,o.id];n>0&&0===Cr(o.key,t)&&a.push(n),r.set(jr(a),o),t=o.key}return r}var c,l,f=t(e.mapFun,function(e,t){var r={id:l._id,key:Fr(e)};void 0!==t&&null!==t&&(r.value=Fr(t)),c.push(r)}),p=e.seq||0,d=new qr;return n().then(function(){return d.finish()}).then(function(){e.seq=p})}function S(e,t,n){0===n.group_level&&delete n.group_level;var i=n.group||n.group_level,a=r(e.reduceFun),u=[],c=isNaN(n.group_level)?Number.POSITIVE_INFINITY:n.group_level;t.forEach(function(e){var t=u[u.length-1],r=i?e.key:null;if(i&&Array.isArray(r)&&(r=r.slice(0,c)),t&&0===Cr(t.groupKey,r))return t.keys.push([e.key,e.id]),void t.values.push(e.value);u.push({keys:[[e.key,e.id]],values:[e.value],groupKey:r})}),t=[];for(var l=0,f=u.length;l<f;l++){var p=u[l],d=o(e.sourceDB,a,p.keys,p.values,!1);if(d.error&&d.error instanceof vr)throw d.error;t.push({value:d.error?null:d.output,key:p.groupKey})}return{rows:s(t,n.limit,n.skip)}}function A(e,t){return _r(x(e),function(){return D(e,t)})()}function D(e,t){function r(t){return t.include_docs=!0,e.db.allDocs(t).then(function(e){return i=e.total_rows,e.rows.map(function(e){if("value"in e.doc&&"object"==typeof e.doc.value&&null!==e.doc.value){var t=Object.keys(e.doc.value).sort(),r=["id","key","value"];if(!(t<r||t>r))return e.doc.value}var n=Pr(e.doc._id);return{key:n[0],id:n[1],value:"value"in e.doc?e.doc.value:null}})})}function n(r){var n;if(n=o?S(e,r,t):{total_rows:i,offset:a,rows:r},t.include_docs){var s=wr(r.map(u));return e.sourceDB.allDocs({keys:s,include_docs:!0,conflicts:t.conflicts,attachments:t.attachments,binary:t.binary}).then(function(e){var t=new Dn;return e.rows.forEach(function(e){t.set(e.id,e.doc)}),r.forEach(function(e){var r=u(e),n=t.get(r);n&&(e.doc=n)}),n})}return n}var i,o=e.reduceFun&&!1!==t.reduce,a=t.skip||0;if(void 0===t.keys||t.keys.length||(t.limit=0,delete t.keys),void 0!==t.keys){var s=t.keys.map(function(e){return r({startkey:jr([e]),endkey:jr([e,{}])})});return xn.all(s).then(R).then(n)}var c={descending:t.descending};if(t.start_key&&(t.startkey=t.start_key),t.end_key&&(t.endkey=t.end_key),void 0!==t.startkey&&(c.startkey=jr(t.descending?[t.startkey,{}]:[t.startkey])),void 0!==t.endkey){var l=!1!==t.inclusive_end;t.descending&&(l=!l),c.endkey=jr(l?[t.endkey,{}]:[t.endkey])}if(void 0!==t.key){var f=jr([t.key]),p=jr([t.key,{}]);c.descending?(c.endkey=f,c.startkey=p):(c.startkey=f,c.endkey=p)}return o||("number"==typeof t.limit&&(c.limit=t.limit),c.skip=a),r(c).then(n)}function C(e){return e.request({method:"POST",url:"_view_cleanup"})}function F(t){return t.get("_local/"+e).then(function(e){var r=new Dn;Object.keys(e.views).forEach(function(e){var t=$r(e),n="_design/"+t[0],i=t[1],o=r.get(n);o||(o=new An,r.set(n,o)),o.add(i)});var n={keys:xr(r),include_docs:!0};return t.allDocs(n).then(function(n){var i={};n.rows.forEach(function(t){var n=t.key.substring(8);r.get(t.key).forEach(function(r){var o=n+"/"+r;e.views[o]||(o=r);var a=Object.keys(e.views[o]),s=t.doc&&t.doc.views&&t.doc.views[r];a.forEach(function(e){i[e]=i[e]||s})})});var o=Object.keys(i).filter(function(e){return!i[e]}).map(function(e){return _r(x(e),function(){return new t.constructor(e,t.__opts).destroy()})()});return xn.all(o).then(function(){return{ok:!0}})})},b({ok:!0}))}function O(t,r,i){if("http"===t.type())return v(t,r,i);if("function"==typeof t._query)return y(t,r,i);if("string"!=typeof r)return m(i,r),Yi.add(function(){return Wr(t,"temp_view/temp_view",r.map,r.reduce,!0,e).then(function(e){return br(k(e).then(function(){return A(e,i)}),function(){return e.db.destroy()})})}),Yi.finish();var o=r,a=$r(o),s=a[0],u=a[1];return t.get("_design/"+s).then(function(r){var a=r.views&&r.views[u];if(!a)throw new mr("ddoc "+r._id+" has no view named "+u);return n(r,u),m(i,a),Wr(t,o,a.map,a.reduce,!1,e).then(function(e){return"ok"===i.stale||"update_after"===i.stale?("update_after"===i.stale&&gn(function(){k(e)}),A(e,i)):k(e).then(function(){return A(e,i)})})})}return{query:function(e,t,r){var n=this;"function"==typeof t&&(r=t,t={}),t=t?d(t):{},"function"==typeof e&&(e={map:e});var i=xn.resolve().then(function(){return O(n,e,t)});return yr(i,r),i},viewCleanup:gr(function(){var e=this;return"http"===e.type()?C(e):"function"==typeof e._viewCleanup?g(e):F(e)})}}("mrviews",function(e,t){if("function"==typeof e&&2===e.length){var r=e;return function(e){return r(e,t)}}return Sr(e.toString(),t)},function(e){return Xi[e]?Xi[e]:Sr(e.toString())},function(e,t){var r=e.views&&e.views[t];if("string"!=typeof r.map)throw new mr("ddoc "+e._id+" has no string view named "+t+", instead found object of type: "+typeof r.map)}),eo={query:function(e,t,r){return Zi.query.call(this,e,t,r)},viewCleanup:function(e){return Zi.viewCleanup.call(this,e)}},to=1,ro="pouchdb",no=5,io=0;Xr.prototype.writeCheckpoint=function(e,t){var r=this;return this.updateTarget(e,t).then(function(){return r.updateSource(e,t)})},Xr.prototype.updateTarget=function(e,t){return Qr(this.target,this.id,e,t,this.returnValue)},Xr.prototype.updateSource=function(e,t){var r=this;return this.readOnlySource?xn.resolve(!0):Qr(this.src,this.id,e,t,this.returnValue).catch(function(e){if(rn(e))return r.readOnlySource=!0,!0;throw e})};var oo={undefined:function(e,t){return 0===Cr(e.last_seq,t.last_seq)?t.last_seq:0},1:function(e,t){return Zr(t,e).last_seq}};Xr.prototype.getCheckpoint=function(){var e=this;return e.target.get(e.id).then(function(t){return e.readOnlySource?xn.resolve(t.last_seq):e.src.get(e.id).then(function(e){if(t.version!==e.version)return io;var r;return r=t.version?t.version.toString():"undefined",r in oo?oo[r](t,e):io},function(r){if(404===r.status&&t.last_seq)return e.src.put({_id:e.id,last_seq:io}).then(function(){return io},function(r){return rn(r)?(e.readOnlySource=!0,t.last_seq):io});throw r})}).catch(function(e){if(404!==e.status)throw e;return io})};var ao=0;yn(un,vn.EventEmitter),un.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},un.prototype.ready=function(e,t){function r(){n.cancel()}var n=this;n._readyCalled||(n._readyCalled=!0,e.once("destroyed",r),t.once("destroyed",r),n.once("complete",function(){e.removeListener("destroyed",r),t.removeListener("destroyed",r)}))},yn(pn,vn.EventEmitter),pn.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},De.plugin(function(e){e.adapter("idb",kt,!0)}).plugin(function(e){e.adapter("websql",Yt,!0)}).plugin(function(e){e.adapter("http",dr,!1),e.adapter("https",dr,!1)}).plugin(eo).plugin(function(e){e.replicate=ln,e.sync=fn,Object.defineProperty(e.prototype,"replicate",{get:function(){var e=this;return{from:function(t,r,n){return e.constructor.replicate(t,e,r,n)},to:function(t,r,n){return e.constructor.replicate(e,t,r,n)}}}}),e.prototype.sync=function(e,t,r){return this.constructor.sync(this,e,t,r)}}),t.exports=De}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,11:11,12:12,2:2,4:4,5:5,6:6,7:7}]},{},[13])(13)}),t.exports}(),t=function(){var e={},t={exports:e};return function(r){if("object"==typeof e&&void 0!==t)t.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pouchdbAdapterMemory=r()}}(function(){return function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){var r=t[a][1][e];return i(r||e)},l,l.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,r){"use strict";t.exports=function(e){return function(){var t=arguments.length;if(t){for(var r=[],n=-1;++n<t;)r[n]=arguments[n];return e.call(this,r)}return e.call(this,[])}}},{}],2:[function(e,t,r){"use strict";function n(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function i(e){return a[e>>18&63]+a[e>>12&63]+a[e>>6&63]+a[63&e]}function o(e,t,r){for(var n,o=[],a=t;a<r;a+=3)n=(e[a]<<16)+(e[a+1]<<8)+e[a+2],o.push(i(n));return o.join("")}r.byteLength=function(e){return 3*e.length/4-n(e)},r.toByteArray=function(e){var t,r,i,o,a,c,l=e.length;a=n(e),c=new u(3*l/4-a),i=a>0?l-4:l;var f=0;for(t=0,r=0;t<i;t+=4,r+=3)o=s[e.charCodeAt(t)]<<18|s[e.charCodeAt(t+1)]<<12|s[e.charCodeAt(t+2)]<<6|s[e.charCodeAt(t+3)],c[f++]=o>>16&255,c[f++]=o>>8&255,c[f++]=255&o;return 2===a?(o=s[e.charCodeAt(t)]<<2|s[e.charCodeAt(t+1)]>>4,c[f++]=255&o):1===a&&(o=s[e.charCodeAt(t)]<<10|s[e.charCodeAt(t+1)]<<4|s[e.charCodeAt(t+2)]>>2,c[f++]=o>>8&255,c[f++]=255&o),c},r.fromByteArray=function(e){for(var t,r=e.length,n=r%3,i="",s=[],u=0,c=r-n;u<c;u+=16383)s.push(o(e,u,u+16383>c?c:u+16383));return 1===n?(t=e[r-1],i+=a[t>>2],i+=a[t<<4&63],i+="=="):2===n&&(t=(e[r-2]<<8)+e[r-1],i+=a[t>>10],i+=a[t>>4&63],i+=a[t<<2&63],i+="="),s.push(i),s.join("")};for(var a=[],s=[],u="undefined"!=typeof Uint8Array?Uint8Array:Array,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=0,f=c.length;l<f;++l)a[l]=c[l],s[c.charCodeAt(l)]=l;s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63},{}],3:[function(e,t,r){},{}],4:[function(e,t,r){(function(r){function n(e,t,n){t>>>=0;var i=e.byteLength-t;if(i<0)throw new RangeError("'offset' is out of bounds");if(void 0===n)n=i;else if((n>>>=0)>i)throw new RangeError("'length' is out of bounds");return a?r.from(e.slice(t,t+n)):new r(new Uint8Array(e.slice(t,t+n)))}function i(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!r.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');return a?r.from(e,t):new r(e,t)}var o=e("is-array-buffer-x"),a="function"==typeof r.alloc&&"function"==typeof r.allocUnsafe&&"function"==typeof r.from;t.exports=function(e,t,s){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return o(e)?n(e,t,s):"string"==typeof e?i(e,t):a?r.from(e):new r(e)}}).call(this,e("buffer").Buffer)},{buffer:6,"is-array-buffer-x":28}],5:[function(e,t,r){(function(t){"use strict";var n=e("buffer"),i=n.Buffer,o=n.SlowBuffer,a=n.kMaxLength||2147483647;r.alloc=function(e,t,r){if("function"==typeof i.alloc)return i.alloc(e,t,r);if("number"==typeof r)throw new TypeError("encoding must not be number");if("number"!=typeof e)throw new TypeError("size must be a number");if(e>a)throw new RangeError("size is too large");var n=r,o=t;void 0===o&&(n=void 0,o=0);var s=new i(e);if("string"==typeof o)for(var u=new i(o,n),c=u.length,l=-1;++l<e;)s[l]=u[l%c];else s.fill(o);return s},r.allocUnsafe=function(e){if("function"==typeof i.allocUnsafe)return i.allocUnsafe(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(e>a)throw new RangeError("size is too large");return new i(e)},r.from=function(e,r,n){if("function"==typeof i.from&&(!t.Uint8Array||Uint8Array.from!==i.from))return i.from(e,r,n);if("number"==typeof e)throw new TypeError('"value" argument must not be a number');if("string"==typeof e)return new i(e,r);if("undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer){var o=r;if(1===arguments.length)return new i(e);void 0===o&&(o=0);var a=n;if(void 0===a&&(a=e.byteLength-o),o>=e.byteLength)throw new RangeError("'offset' is out of bounds");if(a>e.byteLength-o)throw new RangeError("'length' is out of bounds");return new i(e.slice(o,o+a))}if(i.isBuffer(e)){var s=new i(e.length);return e.copy(s,0,0,e.length),s}if(e){if(Array.isArray(e)||"undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return new i(e);if("Buffer"===e.type&&Array.isArray(e.data))return new i(e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")},r.allocUnsafeSlow=function(e){if("function"==typeof i.allocUnsafeSlow)return i.allocUnsafeSlow(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(e>=a)throw new RangeError("size is too large");return new o(e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{buffer:6}],6:[function(e,t,r){"use strict";function n(e){if(e>J)throw new RangeError("Invalid typed array length");var t=new Uint8Array(e);return t.__proto__=i.prototype,t}function i(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return u(e)}return o(e,t,r)}function o(e,t,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return e instanceof ArrayBuffer?f(e,t,r):"string"==typeof e?c(e,t):p(e)}function a(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function s(e,t,r){return a(e),e<=0?n(e):void 0!==t?"string"==typeof r?n(e).fill(t,r):n(e).fill(t):n(e)}function u(e){return a(e),n(e<0?0:0|d(e))}function c(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!i.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');var r=0|h(e,t),o=n(r),a=o.write(e,t);return a!==r&&(o=o.slice(0,a)),o}function l(e){for(var t=e.length<0?0:0|d(e.length),r=n(t),i=0;i<t;i+=1)r[i]=255&e[i];return r}function f(e,t,r){if(t<0||e.byteLength<t)throw new RangeError("'offset' is out of bounds");if(e.byteLength<t+(r||0))throw new RangeError("'length' is out of bounds");var n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),n.__proto__=i.prototype,n}function p(e){if(i.isBuffer(e)){var t=0|d(e.length),r=n(t);return 0===r.length?r:(e.copy(r,0,0,t),r)}if(e){if(ArrayBuffer.isView(e)||"length"in e)return"number"!=typeof e.length||V(e.length)?n(0):l(e);if("Buffer"===e.type&&Array.isArray(e.data))return l(e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function d(e){if(e>=J)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+J.toString(16)+" bytes");return 0|e}function h(e,t){if(i.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||e instanceof ArrayBuffer)return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return q(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return U(e).length;default:if(n)return q(e).length;t=(""+t).toLowerCase(),n=!0}}function m(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if(r>>>=0,t>>>=0,r<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return O(this,t,r);case"utf8":case"utf-8":return A(this,t,r);case"ascii":return C(this,t,r);case"latin1":case"binary":return F(this,t,r);case"base64":return S(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return j(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function v(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function y(e,t,r,n,o){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=o?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(o)return-1;r=e.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof t&&(t=i.from(t,n)),i.isBuffer(t))return 0===t.length?-1:g(e,t,r,n,o);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):g(e,[t],r,n,o);throw new TypeError("val must be string, number or Buffer")}function g(e,t,r,n,i){function o(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}var a=1,s=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a=2,s/=2,u/=2,r/=2}var c;if(i){var l=-1;for(c=r;c<s;c++)if(o(e,c)===o(t,-1===l?0:c-l)){if(-1===l&&(l=c),c-l+1===u)return l*a}else-1!==l&&(c-=c-l),l=-1}else for(r+u>s&&(r=s-u),c=r;c>=0;c--){for(var f=!0,p=0;p<u;p++)if(o(e,c+p)!==o(t,p)){f=!1;break}if(f)return c}return-1}function b(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[r+a]=s}return a}function _(e,t,r,n){return z(q(t,e.length-r),e,r,n)}function w(e,t,r,n){return z(W(t),e,r,n)}function x(e,t,r,n){return w(e,t,r,n)}function k(e,t,r,n){return z(U(t),e,r,n)}function E(e,t,r,n){return z($(t,e.length-r),e,r,n)}function S(e,t,r){return 0===t&&r===e.length?G.fromByteArray(e):G.fromByteArray(e.slice(t,r))}function A(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o=e[i],a=null,s=o>239?4:o>223?3:o>191?2:1;if(i+s<=r){var u,c,l,f;switch(s){case 1:o<128&&(a=o);break;case 2:128==(192&(u=e[i+1]))&&(f=(31&o)<<6|63&u)>127&&(a=f);break;case 3:u=e[i+1],c=e[i+2],128==(192&u)&&128==(192&c)&&(f=(15&o)<<12|(63&u)<<6|63&c)>2047&&(f<55296||f>57343)&&(a=f);break;case 4:u=e[i+1],c=e[i+2],l=e[i+3],128==(192&u)&&128==(192&c)&&128==(192&l)&&(f=(15&o)<<18|(63&u)<<12|(63&c)<<6|63&l)>65535&&f<1114112&&(a=f)}}null===a?(a=65533,s=1):a>65535&&(a-=65536,n.push(a>>>10&1023|55296),a=56320|1023&a),n.push(a),i+=s}return D(n)}function D(e){var t=e.length;if(t<=K)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=K));return r}function C(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function F(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function O(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=M(e[o]);return i}function j(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function B(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,r,n,o,a){if(!i.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function P(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function T(e,t,r,n,i){return t=+t,r>>>=0,i||P(e,t,r,4,3.4028234663852886e38,-3.4028234663852886e38),H.write(e,t,r,n,23,4),r+4}function I(e,t,r,n,i){return t=+t,r>>>=0,i||P(e,t,r,8,1.7976931348623157e308,-1.7976931348623157e308),H.write(e,t,r,n,52,8),r+8}function L(e){if((e=N(e).replace(Y,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function N(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function M(e){return e<16?"0"+e.toString(16):e.toString(16)}function q(e,t){t=t||1/0;for(var r,n=e.length,i=null,o=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function W(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function $(e,t){for(var r,n,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=(r=e.charCodeAt(a))>>8,i=r%256,o.push(i),o.push(n);return o}function U(e){return G.toByteArray(L(e))}function z(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function V(e){return e!==e}var G=e("base64-js"),H=e("ieee754");r.Buffer=i,r.SlowBuffer=function(e){return+e!=e&&(e=0),i.alloc(+e)},r.INSPECT_MAX_BYTES=50;var J=2147483647;r.kMaxLength=J,i.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),i.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),"undefined"!=typeof Symbol&&Symbol.species&&i[Symbol.species]===i&&Object.defineProperty(i,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),i.poolSize=8192,i.from=function(e,t,r){return o(e,t,r)},i.prototype.__proto__=Uint8Array.prototype,i.__proto__=Uint8Array,i.alloc=function(e,t,r){return s(e,t,r)},i.allocUnsafe=function(e){return u(e)},i.allocUnsafeSlow=function(e){return u(e)},i.isBuffer=function(e){return null!=e&&!0===e._isBuffer},i.compare=function(e,t){if(!i.isBuffer(e)||!i.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,o=0,a=Math.min(r,n);o<a;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return r<n?-1:n<r?1:0},i.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return i.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=i.allocUnsafe(t),o=0;for(r=0;r<e.length;++r){var a=e[r];if(!i.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,o),o+=a.length}return n},i.byteLength=h,i.prototype._isBuffer=!0,i.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},i.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},i.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},i.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?A(this,0,e):m.apply(this,arguments)},i.prototype.equals=function(e){if(!i.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===i.compare(this,e)},i.prototype.inspect=function(){var e="",t=r.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},i.prototype.compare=function(e,t,r,n,o){if(!i.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),t<0||r>e.length||n<0||o>this.length)throw new RangeError("out of range index");if(n>=o&&t>=r)return 0;if(n>=o)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,o>>>=0,this===e)return 0;for(var a=o-n,s=r-t,u=Math.min(a,s),c=this.slice(n,o),l=e.slice(t,r),f=0;f<u;++f)if(c[f]!==l[f]){a=c[f],s=l[f];break}return a<s?-1:s<a?1:0},i.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},i.prototype.indexOf=function(e,t,r){return y(this,e,t,r,!0)},i.prototype.lastIndexOf=function(e,t,r){return y(this,e,t,r,!1)},i.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return b(this,e,t,r);case"utf8":case"utf-8":return _(this,e,t,r);case"ascii":return w(this,e,t,r);case"latin1":case"binary":return x(this,e,t,r);case"base64":return k(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var K=4096;i.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return n.__proto__=i.prototype,n},i.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||B(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},i.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||B(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},i.prototype.readUInt8=function(e,t){return e>>>=0,t||B(e,1,this.length),this[e]},i.prototype.readUInt16LE=function(e,t){return e>>>=0,t||B(e,2,this.length),this[e]|this[e+1]<<8},i.prototype.readUInt16BE=function(e,t){return e>>>=0,t||B(e,2,this.length),this[e]<<8|this[e+1]},i.prototype.readUInt32LE=function(e,t){return e>>>=0,t||B(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},i.prototype.readUInt32BE=function(e,t){return e>>>=0,t||B(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},i.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||B(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*t)),n},i.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||B(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o},i.prototype.readInt8=function(e,t){return e>>>=0,t||B(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},i.prototype.readInt16LE=function(e,t){e>>>=0,t||B(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},i.prototype.readInt16BE=function(e,t){e>>>=0,t||B(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},i.prototype.readInt32LE=function(e,t){return e>>>=0,t||B(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},i.prototype.readInt32BE=function(e,t){return e>>>=0,t||B(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},i.prototype.readFloatLE=function(e,t){return e>>>=0,t||B(e,4,this.length),H.read(this,e,!0,23,4)},i.prototype.readFloatBE=function(e,t){return e>>>=0,t||B(e,4,this.length),H.read(this,e,!1,23,4)},i.prototype.readDoubleLE=function(e,t){return e>>>=0,t||B(e,8,this.length),H.read(this,e,!0,52,8)},i.prototype.readDoubleBE=function(e,t){return e>>>=0,t||B(e,8,this.length),H.read(this,e,!1,52,8)},i.prototype.writeUIntLE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||R(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},i.prototype.writeUIntBE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||R(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},i.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,1,255,0),this[t]=255&e,t+1},i.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},i.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},i.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},i.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},i.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);R(this,e,t,r,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<r&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},i.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);R(this,e,t,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},i.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},i.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},i.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},i.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},i.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},i.prototype.writeFloatLE=function(e,t,r){return T(this,e,t,!0,r)},i.prototype.writeFloatBE=function(e,t,r){return T(this,e,t,!1,r)},i.prototype.writeDoubleLE=function(e,t,r){return I(this,e,t,!0,r)},i.prototype.writeDoubleBE=function(e,t,r){return I(this,e,t,!1,r)},i.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,o=n-r;if(this===e&&r<t&&t<n)for(i=o-1;i>=0;--i)e[i+t]=this[i+r];else if(o<1e3)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},i.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!i.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0);var a;if("number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var s=i.isBuffer(e)?e:new i(e,n),u=s.length;for(a=0;a<r-t;++a)this[a+t]=s[a%u]}return this};var Y=/[^+/0-9A-Za-z-_]/g},{"base64-js":2,ieee754:25}],7:[function(e,t,r){(function(e){function t(e){return Object.prototype.toString.call(e)}r.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===t(e)},r.isBoolean=function(e){return"boolean"==typeof e},r.isNull=function(e){return null===e},r.isNullOrUndefined=function(e){return null==e},r.isNumber=function(e){return"number"==typeof e},r.isString=function(e){return"string"==typeof e},r.isSymbol=function(e){return"symbol"==typeof e},r.isUndefined=function(e){return void 0===e},r.isRegExp=function(e){return"[object RegExp]"===t(e)},r.isObject=function(e){return"object"==typeof e&&null!==e},r.isDate=function(e){return"[object Date]"===t(e)},r.isError=function(e){return"[object Error]"===t(e)||e instanceof Error},r.isFunction=function(e){return"function"==typeof e},r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},r.isBuffer=e.isBuffer}).call(this,{isBuffer:e("../../is-buffer/index.js")})},{"../../is-buffer/index.js":29}],8:[function(e,t,r){(function(n){function i(){try{return r.storage.debug}catch(e){}if(void 0!==n&&"env"in n)return n.env.DEBUG}(r=t.exports=e("./debug")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},r.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+r.humanize(this.diff),t){var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,n)}},r.save=function(e){try{null==e?r.storage.removeItem("debug"):r.storage.debug=e}catch(e){}},r.load=i,r.useColors=function(){return!("undefined"==typeof window||!window||void 0===window.process||"renderer"!==window.process.type)||"undefined"!=typeof document&&document&&"WebkitAppearance"in document.documentElement.style||"undefined"!=typeof window&&window&&window.console&&(console.firebug||console.exception&&console.table)||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},r.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),r.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],r.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},r.enable(i())}).call(this,e("_process"))},{"./debug":9,_process:75}],9:[function(e,t,r){function n(e){var t,n=0;for(t in e)n=(n<<5)-n+e.charCodeAt(t),n|=0;return r.colors[Math.abs(n)%r.colors.length]}function i(e){function t(){if(t.enabled){var e=t,n=+new Date,i=n-(o||n);e.diff=i,e.prev=o,e.curr=n,o=n;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=r.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var u=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(t,n){if("%%"===t)return t;u++;var i=r.formatters[n];if("function"==typeof i){var o=a[u];t=i.call(e,o),a.splice(u,1),u--}return t}),r.formatArgs.call(e,a),(t.log||r.log||console.log.bind(console)).apply(e,a)}}return t.namespace=e,t.enabled=r.enabled(e),t.useColors=r.useColors(),t.color=n(e),"function"==typeof r.init&&r.init(t),t}(r=t.exports=i.debug=i.default=i).coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){r.enable("")},r.enable=function(e){r.save(e);for(var t=(e||"").split(/[\s,]+/),n=t.length,i=0;i<n;i++)t[i]&&("-"===(e=t[i].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")))},r.enabled=function(e){var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=e("ms"),r.names=[],r.skips=[],r.formatters={};var o},{ms:61}],10:[function(e,t,r){function n(e){o.call(this,e),this._options=e,this._iterator=null,this._operations=[]}var i=e("util"),o=e("abstract-leveldown").AbstractIterator;i.inherits(n,o),n.prototype.setDb=function(e){var t=this._iterator=e.iterator(this._options);this._operations.forEach(function(e){t[e.method].apply(t,e.args)})},n.prototype._operation=function(e,t){if(this._iterator)return this._iterator[e].apply(this._iterator,t);this._operations.push({method:e,args:t})},"next end".split(" ").forEach(function(e){n.prototype["_"+e]=function(){this._operation(e,arguments)}}),t.exports=n},{"abstract-leveldown":15,util:109}],11:[function(e,t,r){(function(r,n){function i(e){a.call(this,"string"==typeof e?e:""),this._db=void 0,this._operations=[],this._iterators=[]}var o=e("util"),a=e("abstract-leveldown").AbstractLevelDOWN,s=e("./deferred-iterator");o.inherits(i,a),i.prototype.setDb=function(e){this._db=e,this._operations.forEach(function(t){e[t.method].apply(e,t.args)}),this._iterators.forEach(function(t){t.setDb(e)})},i.prototype._open=function(e,t){return n.nextTick(t)},i.prototype._operation=function(e,t){if(this._db)return this._db[e].apply(this._db,t);this._operations.push({method:e,args:t})},"put get del batch approximateSize".split(" ").forEach(function(e){i.prototype["_"+e]=function(){this._operation(e,arguments)}}),i.prototype._isBuffer=function(e){return r.isBuffer(e)},i.prototype._iterator=function(e){if(this._db)return this._db.iterator.apply(this._db,arguments);var t=new s(e);return this._iterators.push(t),t},t.exports=i,t.exports.DeferredIterator=s}).call(this,{isBuffer:e("../is-buffer/index.js")},e("_process"))},{"../is-buffer/index.js":29,"./deferred-iterator":10,_process:75,"abstract-leveldown":15,util:109}],12:[function(e,t,r){(function(e){function r(e){this._db=e,this._operations=[],this._written=!1}r.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},r.prototype.put=function(e,t){this._checkWritten();var r=this._db._checkKey(e,"key",this._db._isBuffer);if(r)throw r;return this._db._isBuffer(e)||(e=String(e)),this._db._isBuffer(t)||(t=String(t)),"function"==typeof this._put?this._put(e,t):this._operations.push({type:"put",key:e,value:t}),this},r.prototype.del=function(e){this._checkWritten();var t=this._db._checkKey(e,"key",this._db._isBuffer);if(t)throw t;return this._db._isBuffer(e)||(e=String(e)),"function"==typeof this._del?this._del(e):this._operations.push({type:"del",key:e}),this},r.prototype.clear=function(){return this._checkWritten(),this._operations=[],"function"==typeof this._clear&&this._clear(),this},r.prototype.write=function(t,r){if(this._checkWritten(),"function"==typeof t&&(r=t),"function"!=typeof r)throw new Error("write() requires a callback argument");return"object"!=typeof t&&(t={}),this._written=!0,"function"==typeof this._write?this._write(r):"function"==typeof this._db._batch?this._db._batch(this._operations,t,r):void e.nextTick(r)},t.exports=r}).call(this,e("_process"))},{_process:75}],13:[function(e,t,r){(function(e){function r(e){this.db=e,this._ended=!1,this._nexting=!1}r.prototype.next=function(t){var r=this;if("function"!=typeof t)throw new Error("next() requires a callback argument");return r._ended?t(new Error("cannot call next() after end()")):r._nexting?t(new Error("cannot call next() before previous next() has completed")):(r._nexting=!0,"function"==typeof r._next?r._next(function(){r._nexting=!1,t.apply(null,arguments)}):void e.nextTick(function(){r._nexting=!1,t()}))},r.prototype.end=function(t){if("function"!=typeof t)throw new Error("end() requires a callback argument");return this._ended?t(new Error("end() already called on iterator")):(this._ended=!0,"function"==typeof this._end?this._end(t):void e.nextTick(t))},t.exports=r}).call(this,e("_process"))},{_process:75}],14:[function(e,t,r){(function(r,n){function i(e){if(!arguments.length||void 0===e)throw new Error("constructor requires at least a location argument");if("string"!=typeof e)throw new Error("constructor requires a location string argument");this.location=e,this.status="new"}var o=e("xtend"),a=e("./abstract-iterator"),s=e("./abstract-chained-batch");i.prototype.open=function(e,t){var r=this,i=this.status;if("function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("open() requires a callback argument");"object"!=typeof e&&(e={}),e.createIfMissing=0!=e.createIfMissing,e.errorIfExists=!!e.errorIfExists,"function"==typeof this._open?(this.status="opening",this._open(e,function(e){if(e)return r.status=i,t(e);r.status="open",t()})):(this.status="open",n.nextTick(t))},i.prototype.close=function(e){var t=this,r=this.status;if("function"!=typeof e)throw new Error("close() requires a callback argument");"function"==typeof this._close?(this.status="closing",this._close(function(n){if(n)return t.status=r,e(n);t.status="closed",e()})):(this.status="closed",n.nextTick(e))},i.prototype.get=function(e,t,r){var i;if("function"==typeof t&&(r=t),"function"!=typeof r)throw new Error("get() requires a callback argument");return(i=this._checkKey(e,"key",this._isBuffer))?r(i):(this._isBuffer(e)||(e=String(e)),"object"!=typeof t&&(t={}),t.asBuffer=0!=t.asBuffer,"function"==typeof this._get?this._get(e,t,r):void n.nextTick(function(){r(new Error("NotFound"))}))},i.prototype.put=function(e,t,r,i){var o;if("function"==typeof r&&(i=r),"function"!=typeof i)throw new Error("put() requires a callback argument");return(o=this._checkKey(e,"key",this._isBuffer))?i(o):(this._isBuffer(e)||(e=String(e)),null==t||this._isBuffer(t)||n.browser||(t=String(t)),"object"!=typeof r&&(r={}),"function"==typeof this._put?this._put(e,t,r,i):void n.nextTick(i))},i.prototype.del=function(e,t,r){var i;if("function"==typeof t&&(r=t),"function"!=typeof r)throw new Error("del() requires a callback argument");return(i=this._checkKey(e,"key",this._isBuffer))?r(i):(this._isBuffer(e)||(e=String(e)),"object"!=typeof t&&(t={}),"function"==typeof this._del?this._del(e,t,r):void n.nextTick(r))},i.prototype.batch=function(e,t,r){if(!arguments.length)return this._chainedBatch();if("function"==typeof t&&(r=t),"function"==typeof e&&(r=e),"function"!=typeof r)throw new Error("batch(array) requires a callback argument");if(!Array.isArray(e))return r(new Error("batch(array) requires an array argument"));t&&"object"==typeof t||(t={});for(var i,o,a=0,s=e.length;a<s;a++)if("object"==typeof(i=e[a])){if(o=this._checkKey(i.type,"type",this._isBuffer))return r(o);if(o=this._checkKey(i.key,"key",this._isBuffer))return r(o)}if("function"==typeof this._batch)return this._batch(e,t,r);n.nextTick(r)},i.prototype.approximateSize=function(e,t,r){if(null==e||null==t||"function"==typeof e||"function"==typeof t)throw new Error("approximateSize() requires valid `start`, `end` and `callback` arguments");if("function"!=typeof r)throw new Error("approximateSize() requires a callback argument");if(this._isBuffer(e)||(e=String(e)),this._isBuffer(t)||(t=String(t)),"function"==typeof this._approximateSize)return this._approximateSize(e,t,r);n.nextTick(function(){r(null,0)})},i.prototype._setupIteratorOptions=function(e){var t=this;return e=o(e),["start","end","gt","gte","lt","lte"].forEach(function(r){e[r]&&t._isBuffer(e[r])&&0===e[r].length&&delete e[r]}),e.reverse=!!e.reverse,e.keys=0!=e.keys,e.values=0!=e.values,e.limit="limit"in e?e.limit:-1,e.keyAsBuffer=0!=e.keyAsBuffer,e.valueAsBuffer=0!=e.valueAsBuffer,e},i.prototype.iterator=function(e){return"object"!=typeof e&&(e={}),e=this._setupIteratorOptions(e),"function"==typeof this._iterator?this._iterator(e):new a(this)},i.prototype._chainedBatch=function(){return new s(this)},i.prototype._isBuffer=function(e){return r.isBuffer(e)},i.prototype._checkKey=function(e,t){if(null===e||void 0===e)return new Error(t+" cannot be `null` or `undefined`");if(this._isBuffer(e)){if(0===e.length)return new Error(t+" cannot be an empty Buffer")}else if(""===String(e))return new Error(t+" cannot be an empty String")},t.exports=i}).call(this,{isBuffer:e("../../../is-buffer/index.js")},e("_process"))},{"../../../is-buffer/index.js":29,"./abstract-chained-batch":12,"./abstract-iterator":13,_process:75,xtend:112}],15:[function(e,t,r){r.AbstractLevelDOWN=e("./abstract-leveldown"),r.AbstractIterator=e("./abstract-iterator"),r.AbstractChainedBatch=e("./abstract-chained-batch"),r.isLevelDOWN=e("./is-leveldown")},{"./abstract-chained-batch":12,"./abstract-iterator":13,"./abstract-leveldown":14,"./is-leveldown":16}],16:[function(e,t,r){var n=e("./abstract-leveldown");t.exports=function(e){return!(!e||"object"!=typeof e)&&Object.keys(n.prototype).filter(function(e){return"_"!=e[0]&&"approximateSize"!=e}).every(function(t){return"function"==typeof e[t]})}},{"./abstract-leveldown":14}],17:[function(e,t,r){"use strict";function n(e){if(this._capacity=a(e),this._length=0,this._front=0,s(e)){for(var t=e.length,r=0;r<t;++r)this[r]=e[r];this._length=t}}function i(e,t,r,n,i){for(var o=0;o<i;++o)r[o+n]=e[o+t],e[o+t]=void 0}function o(e){return e>>>=0,e-=1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)+1}function a(e){if("number"!=typeof e){if(!s(e))return 16;e=e.length}return o(Math.min(Math.max(16,e),1073741824))}n.prototype.toArray=function(){for(var e=this._length,t=new Array(e),r=this._front,n=this._capacity,i=0;i<e;++i)t[i]=this[r+i&n-1];return t},n.prototype.push=function(e){var t=arguments.length,r=this._length;if(t>1){var n=this._capacity;if(r+t>n){for(o=0;o<t;++o)this._checkCapacity(r+1),this[i=this._front+r&this._capacity-1]=arguments[o],r++,this._length=r;return r}for(var i=this._front,o=0;o<t;++o)this[i+r&n-1]=arguments[o],i++;return this._length=r+t,r+t}return 0===t?r:(this._checkCapacity(r+1),this[o=this._front+r&this._capacity-1]=e,this._length=r+1,r+1)},n.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,r=this[t];return this[t]=void 0,this._length=e-1,r}},n.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,r=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,r}},n.prototype.unshift=function(e){var t=this._length,r=arguments.length;if(r>1){if(t+r>(a=this._capacity)){for(i=r-1;i>=0;i--){this._checkCapacity(t+1);a=this._capacity;this[o=(this._front-1&a-1^a)-a]=arguments[i],t++,this._length=t,this._front=o}return t}for(var n=this._front,i=r-1;i>=0;i--){var o=(n-1&a-1^a)-a;this[o]=arguments[i],n=o}return this._front=n,this._length=t+r,t+r}if(0===r)return t;this._checkCapacity(t+1);var a=this._capacity;return this[i=(this._front-1&a-1^a)-a]=e,this._length=t+1,this._front=i,t+1},n.prototype.peekBack=function(){var e=this._length;if(0!==e)return this[this._front+e-1&this._capacity-1]},n.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},n.prototype.get=function(e){var t=e;if(t===(0|t)){var r=this._length;if(t<0&&(t+=r),!(t<0||t>=r))return this[this._front+t&this._capacity-1]}},n.prototype.isEmpty=function(){return 0===this._length},n.prototype.clear=function(){for(var e=this._length,t=this._front,r=this._capacity,n=0;n<e;++n)this[t+n&r-1]=void 0;this._length=0,this._front=0},n.prototype.toString=function(){return this.toArray().toString()},n.prototype.valueOf=n.prototype.toString,n.prototype.removeFront=n.prototype.shift,n.prototype.removeBack=n.prototype.pop,n.prototype.insertFront=n.prototype.unshift,n.prototype.insertBack=n.prototype.push,n.prototype.enqueue=n.prototype.push,n.prototype.dequeue=n.prototype.shift,n.prototype.toJSON=n.prototype.toArray,Object.defineProperty(n.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),n.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(a(1.5*this._capacity+16))},n.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var r=this._front,n=this._length;r+n>t&&i(this,0,this,t,r+n&t-1)};var s=Array.isArray;t.exports=n},{}],18:[function(e,t,r){function n(e,t,r){a(this,{type:e,name:e,cause:"string"!=typeof t?t:r,message:t&&"string"!=typeof t?t.message:t},"ewr")}function i(e,t){Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,arguments.callee),n.call(this,"CustomError",e,t)}function o(e,t,r){var o=function(r,i){n.call(this,t,r,i),"FilesystemError"==t&&(this.code=this.cause.code,this.path=this.cause.path,this.errno=this.cause.errno,this.message=(e.errno[this.cause.errno]?e.errno[this.cause.errno].description:this.cause.message)+(this.cause.path?" ["+this.cause.path+"]":"")),Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,arguments.callee)};return o.prototype=r?new r:new i,o}var a=e("prr");i.prototype=new Error,t.exports=function(e){var t=function(t,r){return o(e,t,r)};return{CustomError:i,FilesystemError:t("FilesystemError"),createError:t}}},{prr:20}],19:[function(e,t,r){var n=t.exports.all=[{errno:-2,code:"ENOENT",description:"no such file or directory"},{errno:-1,code:"UNKNOWN",description:"unknown error"},{errno:0,code:"OK",description:"success"},{errno:1,code:"EOF",description:"end of file"},{errno:2,code:"EADDRINFO",description:"getaddrinfo error"},{errno:3,code:"EACCES",description:"permission denied"},{errno:4,code:"EAGAIN",description:"resource temporarily unavailable"},{errno:5,code:"EADDRINUSE",description:"address already in use"},{errno:6,code:"EADDRNOTAVAIL",description:"address not available"},{errno:7,code:"EAFNOSUPPORT",description:"address family not supported"},{errno:8,code:"EALREADY",description:"connection already in progress"},{errno:9,code:"EBADF",description:"bad file descriptor"},{errno:10,code:"EBUSY",description:"resource busy or locked"},{errno:11,code:"ECONNABORTED",description:"software caused connection abort"},{errno:12,code:"ECONNREFUSED",description:"connection refused"},{errno:13,code:"ECONNRESET",description:"connection reset by peer"},{errno:14,code:"EDESTADDRREQ",description:"destination address required"},{errno:15,code:"EFAULT",description:"bad address in system call argument"},{errno:16,code:"EHOSTUNREACH",description:"host is unreachable"},{errno:17,code:"EINTR",description:"interrupted system call"},{errno:18,code:"EINVAL",description:"invalid argument"},{errno:19,code:"EISCONN",description:"socket is already connected"},{errno:20,code:"EMFILE",description:"too many open files"},{errno:21,code:"EMSGSIZE",description:"message too long"},{errno:22,code:"ENETDOWN",description:"network is down"},{errno:23,code:"ENETUNREACH",description:"network is unreachable"},{errno:24,code:"ENFILE",description:"file table overflow"},{errno:25,code:"ENOBUFS",description:"no buffer space available"},{errno:26,code:"ENOMEM",description:"not enough memory"},{errno:27,code:"ENOTDIR",description:"not a directory"},{errno:28,code:"EISDIR",description:"illegal operation on a directory"},{errno:29,code:"ENONET",description:"machine is not on the network"},{errno:31,code:"ENOTCONN",description:"socket is not connected"},{errno:32,code:"ENOTSOCK",description:"socket operation on non-socket"},{errno:33,code:"ENOTSUP",description:"operation not supported on socket"},{errno:34,code:"ENOENT",description:"no such file or directory"},{errno:35,code:"ENOSYS",description:"function not implemented"},{errno:36,code:"EPIPE",description:"broken pipe"},{errno:37,code:"EPROTO",description:"protocol error"},{errno:38,code:"EPROTONOSUPPORT",description:"protocol not supported"},{errno:39,code:"EPROTOTYPE",description:"protocol wrong type for socket"},{errno:40,code:"ETIMEDOUT",description:"connection timed out"},{errno:41,code:"ECHARSET",description:"invalid Unicode character"},{errno:42,code:"EAIFAMNOSUPPORT",description:"address family for hostname not supported"},{errno:44,code:"EAISERVICE",description:"servname not supported for ai_socktype"},{errno:45,code:"EAISOCKTYPE",description:"ai_socktype not supported"},{errno:46,code:"ESHUTDOWN",description:"cannot send after transport endpoint shutdown"},{errno:47,code:"EEXIST",description:"file already exists"},{errno:48,code:"ESRCH",description:"no such process"},{errno:49,code:"ENAMETOOLONG",description:"name too long"},{errno:50,code:"EPERM",description:"operation not permitted"},{errno:51,code:"ELOOP",description:"too many symbolic links encountered"},{errno:52,code:"EXDEV",description:"cross-device link not permitted"},{errno:53,code:"ENOTEMPTY",description:"directory not empty"},{errno:54,code:"ENOSPC",description:"no space left on device"},{errno:55,code:"EIO",description:"i/o error"},{errno:56,code:"EROFS",description:"read-only file system"},{errno:57,code:"ENODEV",description:"no such device"},{errno:58,code:"ESPIPE",description:"invalid seek"},{errno:59,code:"ECANCELED",description:"operation canceled"}];t.exports.errno={},t.exports.code={},n.forEach(function(e){t.exports.errno[e.errno]=e,t.exports.code[e.code]=e}),t.exports.custom=e("./custom")(t.exports),t.exports.create=t.exports.custom.createError},{"./custom":18}],20:[function(e,t,r){!function(e,r,n){void 0!==t&&t.exports?t.exports=n():r.prr=n()}(0,this,function(){var e="function"==typeof Object.defineProperty?function(e,t,r){return Object.defineProperty(e,t,r),e}:function(e,t,r){return e[t]=r.value,e},t=function(e,t){var r="object"==typeof t,n=!r&&"string"==typeof t,i=function(e){return r?!!t[e]:!!n&&t.indexOf(e[0])>-1};return{enumerable:i("enumerable"),configurable:i("configurable"),writable:i("writable"),value:e}};return function(r,n,i,o){var a;if(o=t(i,o),"object"==typeof n){for(a in n)Object.hasOwnProperty.call(n,a)&&(o.value=n[a],e(r,a,o));return r}return e(r,n,o)}})},{}],21:[function(e,t,r){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"number"==typeof e}function a(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,r,n,o,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(r=this._events[e],s(r))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),r.apply(this,o)}else if(a(r))for(o=Array.prototype.slice.call(arguments,1),n=(c=r.slice()).length,u=0;u<n;u++)c[u].apply(this,o);return!0},n.prototype.addListener=function(e,t){var r;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(r=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var n=!1;return r.listener=t,this.on(e,r),this},n.prototype.removeListener=function(e,t){var r,n,o,s;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],o=r.length,n=-1,r===t||i(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(r)){for(s=o;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){n=s;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],i(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],22:[function(e,t,r){"use strict";function n(e,t,r,n,i,o){this._color=e,this.key=t,this.value=r,this.left=n,this.right=i,this._count=o}function i(e){return new n(e._color,e.key,e.value,e.left,e.right,e._count)}function o(e,t){return new n(e,t.key,t.value,t.left,t.right,t._count)}function a(e){e._count=1+(e.left?e.left._count:0)+(e.right?e.right._count:0)}function s(e,t){this._compare=e,this.root=t}function u(e,t){if(t.left&&(r=u(e,t.left)))return r;var r=e(t.key,t.value);return r||(t.right?u(e,t.right):void 0)}function c(e,t,r,n){if(t(e,n.key)<=0){if(n.left&&(i=c(e,t,r,n.left)))return i;var i=r(n.key,n.value);if(i)return i}if(n.right)return c(e,t,r,n.right)}function l(e,t,r,n,i){var o,a=r(e,i.key),s=r(t,i.key);if(a<=0){if(i.left&&(o=l(e,t,r,n,i.left)))return o;if(s>0&&(o=n(i.key,i.value)))return o}if(s>0&&i.right)return l(e,t,r,n,i.right)}function f(e,t){this.tree=e,this._stack=t}function p(e,t){e.key=t.key,e.value=t.value,e.left=t.left,e.right=t.right,e._color=t._color,e._count=t._count}function d(e){for(var t,r,n,s,u=e.length-1;u>=0;--u){if(t=e[u],0===u)return void(t._color=v);if((r=e[u-1]).left===t){if((n=r.right).right&&n.right._color===m)return n=r.right=i(n),s=n.right=i(n.right),r.right=n.left,n.left=r,n.right=s,n._color=r._color,t._color=v,r._color=v,s._color=v,a(r),a(n),u>1&&((c=e[u-2]).left===r?c.left=n:c.right=n),void(e[u-1]=n);if(n.left&&n.left._color===m)return n=r.right=i(n),s=n.left=i(n.left),r.right=s.left,n.left=s.right,s.left=r,s.right=n,s._color=r._color,r._color=v,n._color=v,t._color=v,a(r),a(n),a(s),u>1&&((c=e[u-2]).left===r?c.left=s:c.right=s),void(e[u-1]=s);if(n._color===v){if(r._color===m)return r._color=v,void(r.right=o(m,n));r.right=o(m,n);continue}n=i(n),r.right=n.left,n.left=r,n._color=r._color,r._color=m,a(r),a(n),u>1&&((c=e[u-2]).left===r?c.left=n:c.right=n),e[u-1]=n,e[u]=r,u+1<e.length?e[u+1]=t:e.push(t),u+=2}else{if((n=r.left).left&&n.left._color===m)return n=r.left=i(n),s=n.left=i(n.left),r.left=n.right,n.right=r,n.left=s,n._color=r._color,t._color=v,r._color=v,s._color=v,a(r),a(n),u>1&&((c=e[u-2]).right===r?c.right=n:c.left=n),void(e[u-1]=n);if(n.right&&n.right._color===m)return n=r.left=i(n),s=n.right=i(n.right),r.left=s.right,n.right=s.left,s.right=r,s.left=n,s._color=r._color,r._color=v,n._color=v,t._color=v,a(r),a(n),a(s),u>1&&((c=e[u-2]).right===r?c.right=s:c.left=s),void(e[u-1]=s);if(n._color===v){if(r._color===m)return r._color=v,void(r.left=o(m,n));r.left=o(m,n);continue}if(n=i(n),r.left=n.right,n.right=r,n._color=r._color,r._color=m,a(r),a(n),u>1){var c=e[u-2];c.right===r?c.right=n:c.left=n}e[u-1]=n,e[u]=r,u+1<e.length?e[u+1]=t:e.push(t),u+=2}}}function h(e,t){return e<t?-1:e>t?1:0}t.exports=function(e){return new s(e||h,null)};var m=0,v=1,y=s.prototype;Object.defineProperty(y,"keys",{get:function(){var e=[];return this.forEach(function(t,r){e.push(t)}),e}}),Object.defineProperty(y,"values",{get:function(){var e=[];return this.forEach(function(t,r){e.push(r)}),e}}),Object.defineProperty(y,"length",{get:function(){return this.root?this.root._count:0}}),y.insert=function(e,t){for(var r=this._compare,i=this.root,u=[],c=[];i;){var l=r(e,i.key);u.push(i),c.push(l),i=l<=0?i.left:i.right}u.push(new n(m,e,t,null,null,1));for(f=u.length-2;f>=0;--f){i=u[f];c[f]<=0?u[f]=new n(i._color,i.key,i.value,u[f+1],i.right,i._count+1):u[f]=new n(i._color,i.key,i.value,i.left,u[f+1],i._count+1)}for(var f=u.length-1;f>1;--f){var p=u[f-1],i=u[f];if(p._color===v||i._color===v)break;var d=u[f-2];if(d.left===p)if(p.left===i){if(!(h=d.right)||h._color!==m){d._color=m,d.left=p.right,p._color=v,p.right=d,u[f-2]=p,u[f-1]=i,a(d),a(p),f>=3&&((y=u[f-3]).left===d?y.left=p:y.right=p);break}p._color=v,d.right=o(v,h),d._color=m,f-=1}else{if(!(h=d.right)||h._color!==m){p.right=i.left,d._color=m,d.left=i.right,i._color=v,i.left=p,i.right=d,u[f-2]=i,u[f-1]=p,a(d),a(p),a(i),f>=3&&((y=u[f-3]).left===d?y.left=i:y.right=i);break}p._color=v,d.right=o(v,h),d._color=m,f-=1}else if(p.right===i){if(!(h=d.left)||h._color!==m){d._color=m,d.right=p.left,p._color=v,p.left=d,u[f-2]=p,u[f-1]=i,a(d),a(p),f>=3&&((y=u[f-3]).right===d?y.right=p:y.left=p);break}p._color=v,d.left=o(v,h),d._color=m,f-=1}else{var h=d.left;if(!h||h._color!==m){if(p.left=i.right,d._color=m,d.right=i.left,i._color=v,i.right=p,i.left=d,u[f-2]=i,u[f-1]=p,a(d),a(p),a(i),f>=3){var y=u[f-3];y.right===d?y.right=i:y.left=i}break}p._color=v,d.left=o(v,h),d._color=m,f-=1}}return u[0]._color=v,new s(r,u[0])},y.forEach=function(e,t,r){if(this.root)switch(arguments.length){case 1:return u(e,this.root);case 2:return c(t,this._compare,e,this.root);case 3:if(this._compare(t,r)>=0)return;return l(t,r,this._compare,e,this.root)}},Object.defineProperty(y,"begin",{get:function(){for(var e=[],t=this.root;t;)e.push(t),t=t.left;return new f(this,e)}}),Object.defineProperty(y,"end",{get:function(){for(var e=[],t=this.root;t;)e.push(t),t=t.right;return new f(this,e)}}),y.at=function(e){if(e<0)return new f(this,[]);for(var t=this.root,r=[];;){if(r.push(t),t.left){if(e<t.left._count){t=t.left;continue}e-=t.left._count}if(!e)return new f(this,r);if(e-=1,!t.right)break;if(e>=t.right._count)break;t=t.right}return new f(this,[])},y.ge=function(e){for(var t=this._compare,r=this.root,n=[],i=0;r;){var o=t(e,r.key);n.push(r),o<=0&&(i=n.length),r=o<=0?r.left:r.right}return n.length=i,new f(this,n)},y.gt=function(e){for(var t=this._compare,r=this.root,n=[],i=0;r;){var o=t(e,r.key);n.push(r),o<0&&(i=n.length),r=o<0?r.left:r.right}return n.length=i,new f(this,n)},y.lt=function(e){for(var t=this._compare,r=this.root,n=[],i=0;r;){var o=t(e,r.key);n.push(r),o>0&&(i=n.length),r=o<=0?r.left:r.right}return n.length=i,new f(this,n)},y.le=function(e){for(var t=this._compare,r=this.root,n=[],i=0;r;){var o=t(e,r.key);n.push(r),o>=0&&(i=n.length),r=o<0?r.left:r.right}return n.length=i,new f(this,n)},y.find=function(e){for(var t=this._compare,r=this.root,n=[];r;){var i=t(e,r.key);if(n.push(r),0===i)return new f(this,n);r=i<=0?r.left:r.right}return new f(this,[])},y.remove=function(e){var t=this.find(e);return t?t.remove():this},y.get=function(e){for(var t=this._compare,r=this.root;r;){var n=t(e,r.key);if(0===n)return r.value;r=n<=0?r.left:r.right}};var g=f.prototype;Object.defineProperty(g,"valid",{get:function(){return this._stack.length>0}}),Object.defineProperty(g,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0}),g.clone=function(){return new f(this.tree,this._stack.slice())},g.remove=function(){var e=this._stack;if(0===e.length)return this.tree;var t=new Array(e.length),r=e[e.length-1];t[t.length-1]=new n(r._color,r.key,r.value,r.left,r.right,r._count);for(u=e.length-2;u>=0;--u)(r=e[u]).left===e[u+1]?t[u]=new n(r._color,r.key,r.value,t[u+1],r.right,r._count):t[u]=new n(r._color,r.key,r.value,r.left,t[u+1],r._count);if((r=t[t.length-1]).left&&r.right){var i=t.length;for(r=r.left;r.right;)t.push(r),r=r.right;var o=t[i-1];t.push(new n(r._color,o.key,o.value,r.left,r.right,r._count)),t[i-1].key=r.key,t[i-1].value=r.value;for(u=t.length-2;u>=i;--u)r=t[u],t[u]=new n(r._color,r.key,r.value,r.left,t[u+1],r._count);t[i-1].left=t[i]}if((r=t[t.length-1])._color===m){var a=t[t.length-2];a.left===r?a.left=null:a.right===r&&(a.right=null),t.pop();for(u=0;u<t.length;++u)t[u]._count--;return new s(this.tree._compare,t[0])}if(r.left||r.right){r.left?p(r,r.left):r.right&&p(r,r.right),r._color=v;for(u=0;u<t.length-1;++u)t[u]._count--;return new s(this.tree._compare,t[0])}if(1===t.length)return new s(this.tree._compare,null);for(var u=0;u<t.length;++u)t[u]._count--;var c=t[t.length-2];return d(t),c.left===r?c.left=null:c.right=null,new s(this.tree._compare,t[0])},Object.defineProperty(g,"key",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].key},enumerable:!0}),Object.defineProperty(g,"value",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].value},enumerable:!0}),Object.defineProperty(g,"index",{get:function(){var e=0,t=this._stack;if(0===t.length){var r=this.tree.root;return r?r._count:0}t[t.length-1].left&&(e=t[t.length-1].left._count);for(var n=t.length-2;n>=0;--n)t[n+1]===t[n].right&&(++e,t[n].left&&(e+=t[n].left._count));return e},enumerable:!0}),g.next=function(){var e=this._stack;if(0!==e.length){var t=e[e.length-1];if(t.right)for(t=t.right;t;)e.push(t),t=t.left;else for(e.pop();e.length>0&&e[e.length-1].right===t;)t=e[e.length-1],e.pop()}},Object.defineProperty(g,"hasNext",{get:function(){var e=this._stack;if(0===e.length)return!1;if(e[e.length-1].right)return!0;for(var t=e.length-1;t>0;--t)if(e[t-1].left===e[t])return!0;return!1}}),g.update=function(e){var t=this._stack;if(0===t.length)throw new Error("Can't update empty node!");var r=new Array(t.length),i=t[t.length-1];r[r.length-1]=new n(i._color,i.key,e,i.left,i.right,i._count);for(var o=t.length-2;o>=0;--o)(i=t[o]).left===t[o+1]?r[o]=new n(i._color,i.key,i.value,r[o+1],i.right,i._count):r[o]=new n(i._color,i.key,i.value,i.left,r[o+1],i._count);return new s(this.tree._compare,r[0])},g.prev=function(){var e=this._stack;if(0!==e.length){var t=e[e.length-1];if(t.left)for(t=t.left;t;)e.push(t),t=t.right;else for(e.pop();e.length>0&&e[e.length-1].left===t;)t=e[e.length-1],e.pop()}},Object.defineProperty(g,"hasPrev",{get:function(){var e=this._stack;if(0===e.length)return!1;if(e[e.length-1].left)return!0;for(var t=e.length-1;t>0;--t)if(e[t-1].right===e[t])return!0;return!1}})},{}],23:[function(e,t,r){!function(){"use strict";t.exports="function"==typeof Symbol&&"symbol"==typeof Symbol()}()},{}],24:[function(e,t,r){!function(){"use strict";t.exports=e("has-symbol-support-x")&&"symbol"==typeof Symbol.toStringTag}()},{"has-symbol-support-x":23}],25:[function(e,t,r){r.read=function(e,t,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,c=u>>1,l=-7,f=r?i-1:0,p=r?-1:1,d=e[t+f];for(f+=p,o=d&(1<<-l)-1,d>>=-l,l+=s;l>0;o=256*o+e[t+f],f+=p,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=n;l>0;a=256*a+e[t+f],f+=p,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,n),o-=c}return(d?-1:1)*a*Math.pow(2,o-n)},r.write=function(e,t,r,n,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,f=l>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,h=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+f>=1?p/u:p*Math.pow(2,1-f))*u>=2&&(a++,u/=2),a+f>=l?(s=0,a=l):a+f>=1?(s=(t*u-1)*Math.pow(2,i),a+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,i),a=0));i>=8;e[r+d]=255&s,d+=h,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;e[r+d]=255&a,d+=h,a/=256,c-=8);e[r+d-h]|=128*m}},{}],26:[function(e,t,r){(function(e){"use strict";function r(){c=!0;for(var e,t,r=l.length;r;){for(t=l,l=[],e=-1;++e<r;)t[e]();r=l.length}c=!1}var n,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,a=new i(r),s=e.document.createTextNode("");a.observe(s,{characterData:!0}),n=function(){s.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){r(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(r,0)};else{var u=new e.MessageChannel;u.port1.onmessage=r,n=function(){u.port2.postMessage(0)}}var c,l=[];t.exports=function(e){1!==l.push(e)||c||n()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],27:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],28:[function(e,t,r){!function(){"use strict";var r,n,i,o=e("is-object-like-x"),a="function"==typeof ArrayBuffer;if(a){if(e("has-to-string-tag-x"))try{i=Object.getOwnPropertyDescriptor(ArrayBuffer.prototype,"byteLength").get,i="number"==typeof i.call(new ArrayBuffer(4))&&i}catch(e){i=null}i||(r=e("to-string-tag-x"),n="[object ArrayBuffer]")}t.exports=function(e){if(!a||!o(e))return!1;if(!i)return r(e)===n;try{return"number"==typeof i.call(e)}catch(e){}return!1}}()},{"has-to-string-tag-x":24,"is-object-like-x":31,"to-string-tag-x":105}],29:[function(e,t,r){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function i(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&n(e.slice(0,0))}t.exports=function(e){return null!=e&&(n(e)||i(e)||!!e._isBuffer)}},{}],30:[function(e,t,r){!function(){"use strict";var r=Function.prototype.toString,n=e("to-string-tag-x"),i=e("has-to-string-tag-x"),o=e("is-primitive"),a=function(e){try{return r.call(e),!0}catch(e){}return!1};t.exports=function(e){if(o(e))return!1;if(i)return a(e);var t=n(e);return"[object Function]"===t||"[object GeneratorFunction]"===t}}()},{"has-to-string-tag-x":24,"is-primitive":32,"to-string-tag-x":105}],31:[function(e,t,r){!function(){"use strict";var r=e("is-function-x"),n=e("is-primitive");t.exports=function(e){return!n(e)&&!r(e)}}()},{"is-function-x":30,"is-primitive":32}],32:[function(e,t,r){"use strict";t.exports=function(e){return null==e||"function"!=typeof e&&"object"!=typeof e}},{}],33:[function(e,t,r){var n={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},{}],34:[function(e,t,r){function n(e){this.opts=e||{},this.encodings=i}var i=e("./lib/encodings");t.exports=n,n.prototype._encoding=function(e){return"string"==typeof e&&(e=i[e]),e||(e=i.id),e},n.prototype._keyEncoding=function(e,t){return this._encoding(t&&t.keyEncoding||e&&e.keyEncoding||this.opts.keyEncoding)},n.prototype._valueEncoding=function(e,t){return this._encoding(t&&(t.valueEncoding||t.encoding)||e&&(e.valueEncoding||e.encoding)||this.opts.valueEncoding||this.opts.encoding)},n.prototype.encodeKey=function(e,t,r){return this._keyEncoding(t,r).encode(e)},n.prototype.encodeValue=function(e,t,r){return this._valueEncoding(t,r).encode(e)},n.prototype.decodeKey=function(e,t){return this._keyEncoding(t).decode(e)},n.prototype.decodeValue=function(e,t){return this._valueEncoding(t).decode(e)},n.prototype.encodeBatch=function(e,t){var r=this;return e.map(function(e){var n={type:e.type,key:r.encodeKey(e.key,t,e)};return r.keyAsBuffer(t,e)&&(n.keyEncoding="binary"),e.prefix&&(n.prefix=e.prefix),"value"in e&&(n.value=r.encodeValue(e.value,t,e),r.valueAsBuffer(t,e)&&(n.valueEncoding="binary")),n})};var o=["lt","gt","lte","gte","start","end"];n.prototype.encodeLtgt=function(e){var t=this,r={};return Object.keys(e).forEach(function(n){r[n]=o.indexOf(n)>-1?t.encodeKey(e[n],e):e[n]}),r},n.prototype.createStreamDecoder=function(e){var t=this;return e.keys&&e.values?function(r,n){return{key:t.decodeKey(r,e),value:t.decodeValue(n,e)}}:e.keys?function(r){return t.decodeKey(r,e)}:e.values?function(r,n){return t.decodeValue(n,e)}:function(){}},n.prototype.keyAsBuffer=function(e){return this._keyEncoding(e).buffer},n.prototype.valueAsBuffer=function(e){return this._valueEncoding(e).buffer}},{"./lib/encodings":35}],35:[function(e,t,r){(function(e){function t(t){return void 0===t||null===t||e.isBuffer(t)}r.utf8=r["utf-8"]={encode:function(e){return t(e)?e:String(e)},decode:function(e){return"string"==typeof e?e:String(e)},buffer:!1,type:"utf8"},r.json={encode:JSON.stringify,decode:JSON.parse,buffer:!1,type:"json"},r.binary={encode:function(r){return t(r)?r:new e(r)},decode:function(e){return e},buffer:!0,type:"binary"},r.none={encode:function(e){return e},decode:function(e){return e},buffer:!1,type:"id"},r.id=r.none,["hex","ascii","base64","ucs2","ucs-2","utf16le","utf-16le"].forEach(function(n){r[n]={encode:function(r){return t(r)?r:new e(r,n)},decode:function(e){return e.toString(n)},buffer:!0,type:n}})}).call(this,e("buffer").Buffer)},{buffer:6}],36:[function(e,t,r){var n=e("errno").create,i=n("LevelUPError"),o=n("NotFoundError",i);o.prototype.notFound=!0,o.prototype.status=404,t.exports={LevelUPError:i,InitializationError:n("InitializationError",i),OpenError:n("OpenError",i),ReadError:n("ReadError",i),WriteError:n("WriteError",i),NotFoundError:o,EncodingError:n("EncodingError",i)}},{errno:19}],37:[function(e,t,r){function n(e,t){if(!(this instanceof n))return new n(e,t);o.call(this,a(t,{objectMode:!0})),this._iterator=e,this._destroyed=!1,this._decoder=null,t&&t.decoder&&(this._decoder=t.decoder),this.on("end",this._cleanup.bind(this))}var i=e("inherits"),o=e("readable-stream").Readable,a=e("xtend"),s=e("level-errors").EncodingError;t.exports=n,i(n,o),n.prototype._read=function(){var e=this;this._destroyed||this._iterator.next(function(t,r,n){if(!e._destroyed){if(t)return e.emit("error",t);if(void 0===r&&void 0===n)e.push(null);else{if(!e._decoder)return e.push({key:r,value:n});try{var n=e._decoder(r,n)}catch(t){return e.emit("error",new s(t)),void e.push(null)}e.push(n)}}})},n.prototype.destroy=n.prototype._cleanup=function(){var e=this;this._destroyed||(this._destroyed=!0,this._iterator.end(function(t){if(t)return e.emit("error",t);e.emit("close")}))}},{inherits:27,"level-errors":36,"readable-stream":83,xtend:112}],38:[function(e,t,r){function n(e,t){this._levelup=e,this._codec=t,this.batch=e.db.batch(),this.ops=[],this.length=0}var i=e("./util"),o=e("level-errors").WriteError,a=i.getOptions,s=i.dispatchError;n.prototype.put=function(e,t,r){r=a(r);var n=this._codec.encodeKey(e,r),i=this._codec.encodeValue(t,r);try{this.batch.put(n,i)}catch(e){throw new o(e)}return this.ops.push({type:"put",key:n,value:i}),this.length++,this},n.prototype.del=function(e,t){t=a(t);var r=this._codec.encodeKey(e,t);try{this.batch.del(r)}catch(e){throw new o(e)}return this.ops.push({type:"del",key:r}),this.length++,this},n.prototype.clear=function(){try{this.batch.clear()}catch(e){throw new o(e)}return this.ops=[],this.length=0,this},n.prototype.write=function(e){var t=this._levelup,r=this.ops;try{this.batch.write(function(n){if(n)return s(t,new o(n),e);t.emit("batch",r),e&&e()})}catch(e){throw new o(e)}},t.exports=n},{"./util":40,"level-errors":36}],39:[function(e,t,r){(function(r){function n(e,t){return"function"==typeof e?e:t}function i(e,t,n){if(!(this instanceof i))return new i(e,t,n);var o;if(c.call(this),this.setMaxListeners(1/0),"function"==typeof e?((t="object"==typeof t?t:{}).db=e,e=null):"object"==typeof e&&"function"==typeof e.db&&(t=e,e=null),"function"==typeof t&&(n=t,t={}),(!t||"function"!=typeof t.db)&&"string"!=typeof e){if(o=new x("Must provide a location for the database"),n)return r.nextTick(function(){n(o)});throw o}t=A(t),this.options=p(D,t),this._codec=new S(this.options),this._status="new",d(this,"location",e,"e"),this.open(n)}function o(e,t,r){if(!e._isOpening()&&!e.isOpen())return F(e,new g("Database is not open"),r),!0}function a(e,t,r){F(e,new y(t),r)}function s(e,t,r){F(e,new g(t),r)}function u(e){return function(t,r){C()[e](t,r||function(){})}}var c=e("events").EventEmitter,l=e("util").inherits,f=e("util").deprecate,p=e("xtend"),d=e("prr"),h=e("deferred-leveldown"),m=e("level-iterator-stream"),v=e("level-errors"),y=v.WriteError,g=v.ReadError,b=v.NotFoundError,_=v.OpenError,w=v.EncodingError,x=v.InitializationError,k=e("./util"),E=e("./batch"),S=e("level-codec"),A=k.getOptions,D=k.defaultOptions,C=k.getLevelDOWN,F=k.dispatchError;k.isDefined;l(i,c),i.prototype.open=function(e){var t,n,i=this;return this.isOpen()?(e&&r.nextTick(function(){e(null,i)}),this):this._isOpening()?e&&this.once("open",function(){e(null,i)}):(this.emit("opening"),this._status="opening",this.db=new h(this.location),t=this.options.db||C(),void(n=t(this.location)).open(this.options,function(t){if(t)return F(i,new _(t),e);i.db.setDb(n),i.db=n,i._status="open",e&&e(null,i),i.emit("open"),i.emit("ready")}))},i.prototype.close=function(e){var t=this;if(this.isOpen())this._status="closing",this.db.close(function(){t._status="closed",t.emit("closed"),e&&e.apply(null,arguments)}),this.emit("closing"),this.db=new h(this.location);else{if("closed"==this._status&&e)return r.nextTick(e);"closing"==this._status&&e?this.once("closed",e):this._isOpening()&&this.once("open",function(){t.close(e)})}},i.prototype.isOpen=function(){return"open"==this._status},i.prototype._isOpening=function(){return"opening"==this._status},i.prototype.isClosed=function(){return/^clos/.test(this._status)},i.prototype.get=function(e,t,r){var i,a=this;if(r=n(t,r),!o(this,t,r)){if(null===e||void 0===e||"function"!=typeof r)return s(this,"get() requires key and callback arguments",r);t=k.getOptions(t),i=this._codec.encodeKey(e,t),t.asBuffer=this._codec.valueAsBuffer(t),this.db.get(i,t,function(n,i){if(n)return n=/notfound/i.test(n)||n.notFound?new b("Key not found in database ["+e+"]",n):new g(n),F(a,n,r);if(r){try{i=a._codec.decodeValue(i,t)}catch(e){return r(new w(e))}r(null,i)}})}},i.prototype.put=function(e,t,r,i){var s,u,c=this;if(i=n(r,i),null===e||void 0===e)return a(this,"put() requires a key argument",i);o(this,r,i)||(r=A(r),s=this._codec.encodeKey(e,r),u=this._codec.encodeValue(t,r),this.db.put(s,u,r,function(r){if(r)return F(c,new y(r),i);c.emit("put",e,t),i&&i()}))},i.prototype.del=function(e,t,r){var i,s=this;if(r=n(t,r),null===e||void 0===e)return a(this,"del() requires a key argument",r);o(this,t,r)||(t=A(t),i=this._codec.encodeKey(e,t),this.db.del(i,t,function(t){if(t)return F(s,new y(t),r);s.emit("del",e),r&&r()}))},i.prototype.batch=function(e,t,r){var i,s=this;return arguments.length?(r=n(t,r),Array.isArray(e)?void(o(this,t,r)||(t=A(t),i=(i=s._codec.encodeBatch(e,t)).map(function(e){return e.type||void 0===e.key||void 0===e.value||(e.type="put"),e}),this.db.batch(i,t,function(t){if(t)return F(s,new y(t),r);s.emit("batch",e),r&&r()}))):a(this,"batch() requires an array argument",r)):new E(this,this._codec)},i.prototype.approximateSize=f(function(e,t,r,i){var o,a,u=this;if(i=n(r,i),r=A(r),null===e||void 0===e||null===t||void 0===t||"function"!=typeof i)return s(this,"approximateSize() requires start, end and callback arguments",i);o=this._codec.encodeKey(e,r),a=this._codec.encodeKey(t,r),this.db.approximateSize(o,a,function(e,t){if(e)return F(u,new _(e),i);i&&i(null,t)})},"db.approximateSize() is deprecated. Use db.db.approximateSize() instead"),i.prototype.readStream=i.prototype.createReadStream=function(e){return e=p({keys:!0,values:!0},this.options,e),e.keyEncoding=e.keyEncoding,e.valueEncoding=e.valueEncoding,e=this._codec.encodeLtgt(e),e.keyAsBuffer=this._codec.keyAsBuffer(e),e.valueAsBuffer=this._codec.valueAsBuffer(e),"number"!=typeof e.limit&&(e.limit=-1),new m(this.db.iterator(e),p(e,{decoder:this._codec.createStreamDecoder(e)}))},i.prototype.keyStream=i.prototype.createKeyStream=function(e){return this.createReadStream(p(e,{keys:!0,values:!1}))},i.prototype.valueStream=i.prototype.createValueStream=function(e){return this.createReadStream(p(e,{keys:!1,values:!0}))},i.prototype.toString=function(){return"LevelUP"},t.exports=i,t.exports.errors=e("level-errors"),t.exports.destroy=f(u("destroy"),"levelup.destroy() is deprecated. Use leveldown.destroy() instead"),t.exports.repair=f(u("repair"),"levelup.repair() is deprecated. Use leveldown.repair() instead")}).call(this,e("_process"))},{"./batch":38,"./util":40,_process:75,"deferred-leveldown":11,events:21,"level-codec":41,"level-errors":36,"level-iterator-stream":37,prr:76,util:109,xtend:112}],40:[function(e,t,r){function n(e){return new o(a("Failed to require LevelDOWN (%s). Try `npm install leveldown` if it's missing",e.message))}e("xtend");var i,o=e("level-errors").LevelUPError,a=e("util").format,s={createIfMissing:!0,errorIfExists:!1,keyEncoding:"utf8",valueEncoding:"utf8",compression:!0};t.exports={defaultOptions:s,getOptions:function(e){return"string"==typeof e&&(e={valueEncoding:e}),"object"!=typeof e&&(e={}),e},getLevelDOWN:function(){if(i)return i;var t,r=e("../package.json").devDependencies.leveldown;try{t=e("leveldown/package").version}catch(e){throw n(e)}if(!e("semver").satisfies(t,r))throw new o("Installed version of LevelDOWN ("+t+") does not match required version ("+r+")");try{return i=e("leveldown")}catch(e){throw n(e)}},dispatchError:function(e,t,r){"function"==typeof r?r(t):e.emit("error",t)},isDefined:function(e){return void 0!==e}}},{"../package.json":43,"level-errors":36,leveldown:3,"leveldown/package":3,semver:3,util:109,xtend:112}],41:[function(e,t,r){arguments[4][34][0].apply(r,arguments)},{"./lib/encodings":42,dup:34}],42:[function(e,t,r){(function(e){function t(e){return e}function n(t){return void 0===t||null===t||e.isBuffer(t)}r.utf8=r["utf-8"]={encode:function(e){return n(e)?e:String(e)},decode:t,buffer:!1,type:"utf8"},r.json={encode:JSON.stringify,decode:JSON.parse,buffer:!1,type:"json"},r.binary={encode:function(t){return n(t)?t:new e(t)},decode:t,buffer:!0,type:"binary"},r.id={encode:function(e){return e},decode:function(e){return e},buffer:!1,type:"id"},["hex","ascii","base64","ucs2","ucs-2","utf16le","utf-16le"].forEach(function(t){r[t]={encode:function(r){return n(r)?r:new e(r,t)},decode:function(e){return e.toString(t)},buffer:!0,type:t}})}).call(this,e("buffer").Buffer)},{buffer:6}],43:[function(e,t,r){t.exports={_args:[[{raw:"levelup@1.3.3",scope:null,escapedName:"levelup",name:"levelup",rawSpec:"1.3.3",spec:"1.3.3",type:"version"},"/Users/robert/Lively/lively-dev2/lively.storage/node_modules/pouchdb"]],_from:"levelup@1.3.3",_id:"levelup@1.3.3",_inCache:!0,_location:"/levelup",_nodeVersion:"4.4.7",_npmOperationalInternal:{host:"packages-12-west.internal.npmjs.com",tmp:"tmp/levelup-1.3.3.tgz_1476029541340_0.44339725002646446"},_npmUser:{name:"juliangruber",email:"julian@juliangruber.com"},_npmVersion:"2.15.8",_phantomChildren:{},_requested:{raw:"levelup@1.3.3",scope:null,escapedName:"levelup",name:"levelup",rawSpec:"1.3.3",spec:"1.3.3",type:"version"},_requiredBy:["/pouchdb","/pouchdb-adapter-leveldb-core"],_resolved:"https://registry.npmjs.org/levelup/-/levelup-1.3.3.tgz",_shasum:"bf9db62bdb6188d08eaaa2efcf6cc311916f41fd",_shrinkwrap:null,_spec:"levelup@1.3.3",_where:"/Users/robert/Lively/lively-dev2/lively.storage/node_modules/pouchdb",browser:{leveldown:!1,"leveldown/package":!1,semver:!1},bugs:{url:"https://github.com/level/levelup/issues"},contributors:[{name:"Rod Vagg",email:"r@va.gg",url:"https://github.com/rvagg"},{name:"John Chesley",email:"john@chesl.es",url:"https://github.com/chesles/"},{name:"Jake Verbaten",email:"raynos2@gmail.com",url:"https://github.com/raynos"},{name:"Dominic Tarr",email:"dominic.tarr@gmail.com",url:"https://github.com/dominictarr"},{name:"Max Ogden",email:"max@maxogden.com",url:"https://github.com/maxogden"},{name:"Lars-Magnus Skog",email:"ralphtheninja@riseup.net",url:"https://github.com/ralphtheninja"},{name:"David Bjrklund",email:"david.bjorklund@gmail.com",url:"https://github.com/kesla"},{name:"Julian Gruber",email:"julian@juliangruber.com",url:"https://github.com/juliangruber"},{name:"Paolo Fragomeni",email:"paolo@async.ly",url:"https://github.com/0x00a"},{name:"Anton Whalley",email:"anton.whalley@nearform.com",url:"https://github.com/No9"},{name:"Matteo Collina",email:"matteo.collina@gmail.com",url:"https://github.com/mcollina"},{name:"Pedro Teixeira",email:"pedro.teixeira@gmail.com",url:"https://github.com/pgte"},{name:"James Halliday",email:"mail@substack.net",url:"https://github.com/substack"},{name:"Jarrett Cruger",email:"jcrugzz@gmail.com",url:"https://github.com/jcrugzz"}],dependencies:{"deferred-leveldown":"~1.2.1","level-codec":"~6.1.0","level-errors":"~1.0.3","level-iterator-stream":"~1.3.0",prr:"~1.0.1",semver:"~5.1.0",xtend:"~4.0.0"},description:"Fast & simple storage - a Node.js-style LevelDB wrapper",devDependencies:{async:"~1.5.0",bustermove:"~1.0.0",delayed:"~1.0.1",faucet:"~0.0.1",leveldown:"^1.1.0",memdown:"~1.1.0","msgpack-js":"~0.3.0",referee:"~1.2.0",rimraf:"~2.4.3","slow-stream":"0.0.4",tap:"~2.3.1",tape:"~4.2.1"},directories:{},dist:{shasum:"bf9db62bdb6188d08eaaa2efcf6cc311916f41fd",tarball:"https://registry.npmjs.org/levelup/-/levelup-1.3.3.tgz"},gitHead:"cced27dc9f0095823be5ed388ec601ec2bfe7366",homepage:"https://github.com/level/levelup",keywords:["leveldb","stream","database","db","store","storage","json"],license:"MIT",main:"lib/levelup.js",maintainers:[{name:"rvagg",email:"rod@vagg.org"},{name:"ralphtheninja",email:"ralphtheninja@riseup.net"},{name:"juliangruber",email:"julian@juliangruber.com"}],name:"levelup",optionalDependencies:{},readme:"ERROR: No README data found!",repository:{type:"git",url:"git+https://github.com/level/levelup.git"},scripts:{test:"tape test/*-test.js | faucet"},version:"1.3.3"}},{}],44:[function(e,t,r){"use strict";function n(){}function i(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,e!==n&&u(this,e)}function o(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function a(e,t,r){l(function(){var n;try{n=t(r)}catch(t){return f.reject(e,t)}n===e?f.reject(e,new TypeError("Cannot resolve promise with itself")):f.resolve(e,n)})}function s(e){var t=e&&e.then;if(e&&"object"==typeof e&&"function"==typeof t)return function(){t.apply(e,arguments)}}function u(e,t){function r(t){i||(i=!0,f.reject(e,t))}function n(t){i||(i=!0,f.resolve(e,t))}var i=!1,o=c(function(){t(n,r)});"error"===o.status&&r(o.value)}function c(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}var l=e("immediate"),f={},p=["REJECTED"],d=["FULFILLED"],h=["PENDING"];t.exports=i,i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){if("function"!=typeof e&&this.state===d||"function"!=typeof t&&this.state===p)return this;var r=new this.constructor(n);return this.state!==h?a(r,this.state===d?e:t,this.outcome):this.queue.push(new o(r,e,t)),r},o.prototype.callFulfilled=function(e){f.resolve(this.promise,e)},o.prototype.otherCallFulfilled=function(e){a(this.promise,this.onFulfilled,e)},o.prototype.callRejected=function(e){f.reject(this.promise,e)},o.prototype.otherCallRejected=function(e){a(this.promise,this.onRejected,e)},f.resolve=function(e,t){var r=c(s,t);if("error"===r.status)return f.reject(e,r.value);var n=r.value;if(n)u(e,n);else{e.state=d,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},f.reject=function(e,t){e.state=p,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},i.resolve=function(e){return e instanceof this?e:f.resolve(new this(n),e)},i.reject=function(e){var t=new this(n);return f.reject(t,e)},i.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var o=new Array(r),a=0,s=-1,u=new this(n);++s<r;)!function(e,n){t.resolve(e).then(function(e){o[n]=e,++a!==r||i||(i=!0,f.resolve(u,o))},function(e){i||(i=!0,f.reject(u,e))})}(e[s],s);return u},i.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var o=-1,a=new this(n);++o<r;)!function(e){t.resolve(e).then(function(e){i||(i=!0,f.resolve(a,e))},function(e){i||(i=!0,f.reject(a,e))})}(e[o]);return a}},{immediate:26}],45:[function(e,t,r){t.exports=function(e){return null===e}},{}],46:[function(e,t,r){(function(e){function t(e,t){return Object.hasOwnProperty.call(e,t)}function n(e){return void 0!==e&&""!==e}function t(e,t){return Object.hasOwnProperty.call(e,t)}function i(e,t){return Object.hasOwnProperty.call(e,t)&&t}function o(e){return e}r.compare=function(t,r){if(e.isBuffer(t)){for(var n=Math.min(t.length,r.length),i=0;i<n;i++){var o=t[i]-r[i];if(o)return o}return t.length-r.length}return t<r?-1:t>r?1:0};var a=r.lowerBoundKey=function(e){return i(e,"gt")||i(e,"gte")||i(e,"min")||(e.reverse?i(e,"end"):i(e,"start"))||void 0},s=r.lowerBound=function(e){var t=a(e);return t&&e[t]};r.lowerBoundInclusive=function(e){return!t(e,"gt")},r.upperBoundInclusive=function(e){return!(t(e,"lt")||!e.minEx)};var u=r.lowerBoundExclusive=function(e){return!(!t(e,"gt")&&!e.minEx)},c=r.upperBoundExclusive=function(e){return!!t(e,"lt")},l=r.upperBoundKey=function(e){return i(e,"lt")||i(e,"lte")||i(e,"max")||(e.reverse?i(e,"start"):i(e,"end"))||void 0},f=r.upperBound=function(e){var t=l(e);return t&&e[t]};r.toLtgt=function(e,n,i,a,s){n=n||{},i=i||o;var u=arguments.length>3,c=r.lowerBoundKey(e),l=r.upperBoundKey(e);return c?"gt"===c?n.gt=i(e.gt,!1):n.gte=i(e[c],!1):u&&(n.gte=i(a,!1)),l?"lt"===l?n.lt=i(e.lt,!0):n.lte=i(e[l],!0):u&&(n.lte=i(s,!0)),null!=e.reverse&&(n.reverse=!!e.reverse),t(n,"max")&&delete n.max,t(n,"min")&&delete n.min,t(n,"start")&&delete n.start,t(n,"end")&&delete n.end,n},r.contains=function(e,t,i){i=i||r.compare;var o=s(e);if(n(o)&&((l=i(t,o))<0||0===l&&u(e)))return!1;var a=f(e);if(n(a)){var l=i(t,a);if(l>0||0===l&&c(e))return!1}return!0},r.filter=function(e,t){return function(n){return r.contains(e,n,t)}}}).call(this,{isBuffer:e("../is-buffer/index.js")})},{"../is-buffer/index.js":29}],47:[function(e,t,r){t.exports=e("immediate")},{immediate:54}],48:[function(e,t,r){(function(r){function n(e){return p.compare(e,this._end)>0}function i(e){return p.compare(e,this._end)>=0}function o(e){return p.compare(e,this._end)<0}function a(e){return p.compare(e,this._end)<=0}function s(e,t){f.call(this,e),this._limit=t.limit,-1===this._limit&&(this._limit=1/0);var r=e._store[e._location];this.keyAsBuffer=!1!==t.keyAsBuffer,this.valueAsBuffer=!1!==t.valueAsBuffer,this._reverse=t.reverse,this._options=t,this._done=0,this._reverse?(this._incr="prev",this._start=p.upperBound(t),this._end=p.lowerBound(t),void 0===this._start?this._tree=r.end:p.upperBoundInclusive(t)?this._tree=r.le(this._start):this._tree=r.lt(this._start),this._end&&(p.lowerBoundInclusive(t)?this._test=i:this._test=n)):(this._incr="next",this._start=p.lowerBound(t),this._end=p.upperBound(t),void 0===this._start?this._tree=r.begin:p.lowerBoundInclusive(t)?this._tree=r.ge(this._start):this._tree=r.gt(this._start),this._end&&(p.upperBoundInclusive(t)?this._test=a:this._test=o))}function u(e){if(!(this instanceof u))return new u(e);l.call(this,"string"==typeof e?e:""),this._location=this.location?"$"+this.location:"_tree",this._store=this.location?h:this,this._store[this._location]=this._store[this._location]||d(p.compare)}var c=e("inherits"),l=e("abstract-leveldown").AbstractLevelDOWN,f=e("abstract-leveldown").AbstractIterator,p=e("ltgt"),d=e("functional-red-black-tree"),h={},m=e("./immediate");c(s,f),s.prototype._next=function(e){var t,n;return this._done++>=this._limit?m(e):this._tree.valid?(t=this._tree.key,n=this._tree.value,this._test(t)?(this.keyAsBuffer&&(t=new r(t)),this.valueAsBuffer&&(n=new r(n)),this._tree[this._incr](),void m(function(){e(null,t,n)})):m(e)):m(e)},s.prototype._test=function(){return!0},u.clearGlobalStore=function(e){e?Object.keys(h).forEach(function(e){delete h[e]}):h={}},c(u,l),u.prototype._open=function(e,t){var r=this;m(function(){t(null,r)})},u.prototype._put=function(e,t,r,n){void 0!==t&&null!==t||(t="");var i=this._store[this._location].find(e);i.valid?this._store[this._location]=i.update(t):this._store[this._location]=this._store[this._location].insert(e,t),m(n)},u.prototype._get=function(e,t,n){var i=this._store[this._location].get(e);if(void 0===i)return m(function(){n(new Error("NotFound"))});!1===t.asBuffer||this._isBuffer(i)||(i=new r(String(i))),m(function(){n(null,i)})},u.prototype._del=function(e,t,r){this._store[this._location]=this._store[this._location].remove(e),m(r)},u.prototype._batch=function(e,t,r){for(var n,i,o,a=-1,s=e.length,u=this._store[this._location];++a<s;)e[a]&&(n=this._isBuffer(e[a].key)?e[a].key:String(e[a].key),o=u.find(n),"put"===e[a].type?(i=this._isBuffer(e[a].value)?e[a].value:String(e[a].value),u=o.valid?o.update(i):u.insert(n,i)):u=o.remove());this._store[this._location]=u,m(r)},u.prototype._iterator=function(e){return new s(this,e)},u.prototype._isBuffer=function(e){return r.isBuffer(e)},u.destroy=function(e,t){var r="$"+e;r in h&&delete h[r],m(t)},t.exports=u}).call(this,e("buffer").Buffer)},{"./immediate":47,"abstract-leveldown":52,buffer:6,"functional-red-black-tree":22,inherits:27,ltgt:60}],49:[function(e,t,r){arguments[4][12][0].apply(r,arguments)},{_process:75,dup:12}],50:[function(e,t,r){arguments[4][13][0].apply(r,arguments)},{_process:75,dup:13}],51:[function(e,t,r){arguments[4][14][0].apply(r,arguments)},{"../../../is-buffer/index.js":29,"./abstract-chained-batch":49,"./abstract-iterator":50,_process:75,dup:14,xtend:112}],52:[function(e,t,r){arguments[4][15][0].apply(r,arguments)},{"./abstract-chained-batch":49,"./abstract-iterator":50,"./abstract-leveldown":51,"./is-leveldown":53,dup:15}],53:[function(e,t,r){arguments[4][16][0].apply(r,arguments)},{"./abstract-leveldown":51,dup:16}],54:[function(e,t,r){"use strict";function n(){a&&s&&(a=!1,s.length?f=s.concat(f):l=-1,f.length&&i())}function i(){if(!a){p=!1,a=!0;for(var e=f.length,t=setTimeout(n);e;){for(s=f,f=[];s&&++l<e;)s[l].run();l=-1,e=f.length}s=null,l=-1,a=!1,clearTimeout(t)}}function o(e,t){this.fun=e,this.array=t}for(var a,s,u,c=[e("./nextTick"),e("./mutation.js"),e("./messageChannel"),e("./stateChange"),e("./timeout")],l=-1,f=[],p=!1,d=-1,h=c.length;++d<h;)if(c[d]&&c[d].test&&c[d].test()){u=c[d].install(i);break}o.prototype.run=function(){var e=this.fun,t=this.array;switch(t.length){case 0:return e();case 1:return e(t[0]);case 2:return e(t[0],t[1]);case 3:return e(t[0],t[1],t[2]);default:return e.apply(null,t)}},t.exports=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];f.push(new o(e,t)),p||a||(p=!0,u())}},{"./messageChannel":55,"./mutation.js":56,"./nextTick":57,"./stateChange":58,"./timeout":59}],55:[function(e,t,r){(function(e){"use strict";r.test=function(){return!e.setImmediate&&void 0!==e.MessageChannel},r.install=function(t){var r=new e.MessageChannel;return r.port1.onmessage=t,function(){r.port2.postMessage(0)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],56:[function(e,t,r){(function(e){"use strict";var t=e.MutationObserver||e.WebKitMutationObserver;r.test=function(){return t},r.install=function(r){var n=0,i=new t(r),o=e.document.createTextNode("");return i.observe(o,{characterData:!0}),function(){o.data=n=++n%2}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],57:[function(e,t,r){(function(e){"use strict";r.test=function(){return void 0!==e&&!e.browser},r.install=function(t){return function(){e.nextTick(t)}}}).call(this,e("_process"))},{_process:75}],58:[function(e,t,r){(function(e){"use strict";r.test=function(){return"document"in e&&"onreadystatechange"in e.document.createElement("script")},r.install=function(t){return function(){var r=e.document.createElement("script");return r.onreadystatechange=function(){t(),r.onreadystatechange=null,r.parentNode.removeChild(r),r=null},e.document.documentElement.appendChild(r),t}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],59:[function(e,t,r){"use strict";r.test=function(){return!0},r.install=function(e){return function(){setTimeout(e,0)}}},{}],60:[function(e,t,r){(function(e){function t(e,t){return Object.hasOwnProperty.call(e,t)}function n(e){return void 0!==e&&""!==e}function t(e,t){return Object.hasOwnProperty.call(e,t)}function i(e,t){return Object.hasOwnProperty.call(e,t)&&t}function o(e){return e}r.compare=function(t,r){if(e.isBuffer(t)){for(var n=Math.min(t.length,r.length),i=0;i<n;i++){var o=t[i]-r[i];if(o)return o}return t.length-r.length}return t<r?-1:t>r?1:0};var a=r.lowerBoundKey=function(e){return i(e,"gt")||i(e,"gte")||i(e,"min")||(e.reverse?i(e,"end"):i(e,"start"))||void 0},s=r.lowerBound=function(e){var t=a(e);return t&&e[t]},u=r.lowerBoundInclusive=function(e){return!t(e,"gt")},c=r.upperBoundInclusive=function(e){return!t(e,"lt")},l=r.lowerBoundExclusive=function(e){return!u(e)},f=r.upperBoundExclusive=function(e){return!c(e)},p=r.upperBoundKey=function(e){return i(e,"lt")||i(e,"lte")||i(e,"max")||(e.reverse?i(e,"start"):i(e,"end"))||void 0},d=r.upperBound=function(e){var t=p(e);return t&&e[t]};r.toLtgt=function(e,n,i,a,s){n=n||{},i=i||o;var u=arguments.length>3,c=r.lowerBoundKey(e),l=r.upperBoundKey(e);return c?"gt"===c?n.gt=i(e.gt,!1):n.gte=i(e[c],!1):u&&(n.gte=i(a,!1)),l?"lt"===l?n.lt=i(e.lt,!0):n.lte=i(e[l],!0):u&&(n.lte=i(s,!0)),null!=e.reverse&&(n.reverse=!!e.reverse),t(n,"max")&&delete n.max,t(n,"min")&&delete n.min,t(n,"start")&&delete n.start,t(n,"end")&&delete n.end,n},r.contains=function(e,t,i){i=i||r.compare;var o=s(e);if(n(o)&&((u=i(t,o))<0||0===u&&l(e)))return!1;var a=d(e);if(n(a)){var u=i(t,a);if(u>0||0===u&&f(e))return!1}return!0},r.filter=function(e,t){return function(n){return r.contains(e,n,t)}}}).call(this,{isBuffer:e("../../../is-buffer/index.js")})},{"../../../is-buffer/index.js":29}],61:[function(e,t,r){function n(e){if(!((e=String(e)).length>1e4)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*f;case"days":case"day":case"d":return r*l;case"hours":case"hour":case"hrs":case"hr":case"h":return r*c;case"minutes":case"minute":case"mins":case"min":case"m":return r*u;case"seconds":case"second":case"secs":case"sec":case"s":return r*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function i(e){return e>=l?Math.round(e/l)+"d":e>=c?Math.round(e/c)+"h":e>=u?Math.round(e/u)+"m":e>=s?Math.round(e/s)+"s":e+"ms"}function o(e){return a(e,l,"day")||a(e,c,"hour")||a(e,u,"minute")||a(e,s,"second")||e+" ms"}function a(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var s=1e3,u=60*s,c=60*u,l=24*c,f=365.25*l;t.exports=function(e,t){t=t||{};var r=typeof e;if("string"===r&&e.length>0)return n(e);if("number"===r&&!1===isNaN(e))return t.long?o(e):i(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],62:[function(e,t,r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function i(e,t){var r=new Uint8Array(e);return A.blob([r],{type:t})}function o(e,t){A.readAsBinaryString(e,t)}function a(e){return A.blob([""],{type:e})}function s(e,t){var r=t.prefix()[0],n=e._cache,i=n.get(r);return i||(i=new d.Map,n.set(r,i)),i}function u(){this._batch=[],this._cache=new d.Map}function c(e){return"winningRev"in e?e.winningRev:k.winningRev(e)}function l(e,t){return"deleted"in e?e.deleted:x.isDeleted(e,t)}function f(e,t,r){var n=e.content_type;return new h(function(o,a){t.binaryStore.get(e.digest,function(t,s){var u;if(t){if("NotFoundError"!==t.name)return a(t);u=r.binary?A.binaryStringToBlobOrBuffer("",n):""}else u=r.binary?i(s,n):s.toString("base64");delete e.stub,delete e.length,e.data=u,o()})})}function p(e,t,r){var n=[];return e.forEach(function(e){e.doc&&e.doc._attachments&&Object.keys(e.doc._attachments).forEach(function(t){var r=e.doc._attachments[t];"data"in r||n.push(r)})}),h.all(n.map(function(e){return f(e,t,r)}))}var d=e("pouchdb-collections"),h=n(e("pouchdb-promise")),m=n(e("levelup")),v=n(e("sublevel-pouchdb")),y=e("through2"),g=n(e("argsarray")),b=n(e("double-ended-queue")),_=n(e("buffer-from")),w=e("pouchdb-utils"),x=e("pouchdb-adapter-utils"),k=e("pouchdb-merge"),E=e("pouchdb-json"),S=e("pouchdb-md5"),A=e("pouchdb-binary-utils"),D=e("pouchdb-errors");u.prototype.get=function(e,t,r){var n=s(this,e),i=n.get(t);return i?w.nextTick(function(){r(null,i)}):null===i?w.nextTick(function(){r({name:"NotFoundError"})}):void e.get(t,function(e,i){if(e)return"NotFoundError"===e.name&&n.set(t,null),r(e);n.set(t,i),r(null,i)})},u.prototype.batch=function(e){for(var t=0,r=e.length;t<r;t++){var n=e[t],i=s(this,n.prefix);"put"===n.type?i.set(n.key,n.value):i.set(n.key,null)}this._batch=this._batch.concat(e)},u.prototype.execute=function(e,t){for(var r=new d.Set,n=[],i=this._batch.length-1;i>=0;i--){var o=this._batch[i],a=o.prefix.prefix()[0]+""+o.key;r.has(a)||(r.add(a),n.push(o))}e.batch(n,t)};var C="document-store",F="by-sequence",O="attach-store",j="attach-binary-store",B="local-store",R="meta-store",P=new d.Map,T="_local_last_update_seq",I="_local_doc_count",L="_local_uuid",N="md5-",M={encode:E.safeJsonStringify,decode:E.safeJsonParse,buffer:!1,type:"cheap-json"},q=new w.changesHandler;t.exports=function(e,t){function r(){Q.docStore=K.sublevel(C,{valueEncoding:M}),Q.bySeqStore=K.sublevel(F,{valueEncoding:"json"}),Q.attachmentStore=K.sublevel(O,{valueEncoding:"json"}),Q.binaryStore=K.sublevel(j,{valueEncoding:"binary"}),Q.localStore=K.sublevel(B,{valueEncoding:"json"}),Q.metaStore=K.sublevel(R,{valueEncoding:"json"}),"object"==typeof e.migrate?e.migrate.doMigrationTwo(K,Q,n):n()}function n(){Q.metaStore.get(T,function(e,r){void 0===K._updateSeq&&(K._updateSeq=r||0),Q.metaStore.get(I,function(e,r){K._docCount=e?0:r,Q.metaStore.get(L,function(e,r){J=e?w.uuid():r,Q.metaStore.put(L,J,function(){w.nextTick(function(){t(null,Y)})})})})})}function s(e){return K.isClosed()?e(new Error("database is closed")):e(null,K._docCount)}function f(e,t){try{e.apply(null,t)}catch(e){t[t.length-1](e)}}function E(){var e=K._queue.peekFront();"read"===e.type?W(e):$(e)}function W(e){for(var t=[e],r=1,n=K._queue.get(r);void 0!==n&&"read"===n.type;)t.push(n),r++,n=K._queue.get(r);var i=0;t.forEach(function(e){var r=e.args,n=r[r.length-1];r[r.length-1]=g(function(e){n.apply(null,e),++i===t.length&&w.nextTick(function(){t.forEach(function(){K._queue.shift()}),K._queue.length&&E()})}),f(e.fun,r)})}function $(e){var t=e.args,r=t[t.length-1];t[t.length-1]=g(function(e){r.apply(null,e),w.nextTick(function(){K._queue.shift(),K._queue.length&&E()})}),f(e.fun,t)}function U(e){return g(function(t){K._queue.push({fun:e,args:t,type:"write"}),1===K._queue.length&&w.nextTick(E)})}function z(e){return g(function(t){K._queue.push({fun:e,args:t,type:"read"}),1===K._queue.length&&w.nextTick(E)})}function V(e){return("0000000000000000"+e).slice(-16)}function G(e){return parseInt(e,10)}function H(e,t){te.destroy(e,t)}var J,K,Y=this,Q={},X=(e=w.clone(e)).revs_limit,Z=e.name;void 0===e.createIfMissing&&(e.createIfMissing=!0);var ee,te=e.db,re=w.functionName(te);P.has(re)?ee=P.get(re):(ee=new d.Map,P.set(re,ee)),ee.has(Z)?(K=ee.get(Z),r()):ee.set(Z,v(m(Z,e,function(n){if(n)return ee.delete(Z),t(n);(K=ee.get(Z))._docCount=-1,K._queue=new b,"object"==typeof e.migrate?e.migrate.doMigrationOne(Z,K,r):r()}))),Y.type=function(){return"leveldb"},Y._id=function(e){e(null,J)},Y._info=function(e){var t={doc_count:K._docCount,update_seq:K._updateSeq,backend_adapter:w.functionName(te)};return w.nextTick(function(){e(null,t)})},Y._get=z(function(e,t,r){t=w.clone(t),Q.docStore.get(e,function(e,n){if(e||!n)return r(D.createError(D.MISSING_DOC,"missing"));var i;if(t.rev)i=t.latest?k.latest(t.rev,n):t.rev;else if(i=c(n),l(n,i))return r(D.createError(D.MISSING_DOC,"deleted"));var o=n.rev_map[i];Q.bySeqStore.get(V(o),function(e,t){if(!t)return r(D.createError(D.MISSING_DOC));if("_id"in t&&t._id!==n.id)return r(new Error("wrong doc returned"));if(t._id=n.id,"_rev"in t){if(t._rev!==i)return r(new Error("wrong doc returned"))}else t._rev=i;return r(null,{doc:t,metadata:n})})})}),Y._getAttachment=function(e,t,r,n,o){var s=r.digest,u=r.content_type;Q.binaryStore.get(s,function(e,t){if(e)return"NotFoundError"!==e.name?o(e):o(null,n.binary?a(u):"");n.binary?o(null,i(t,u)):o(null,t.toString("base64"))})},Y._bulkDocs=U(function(e,t,r){function n(e,t){E.get(Q.attachmentStore,e,function(r){if(r){var n=D.createError(D.MISSING_STUB,"unknown stub attachment with digest "+e);t(n)}else t()})}function i(e){function t(){if(++n===O.length)return e(r)}var r,n=0;O.forEach(function(e){if(e._id&&x.isLocalId(e._id))return t();E.get(Q.docStore,e._id,function(n,i){n?"NotFoundError"!==n.name&&(r=n):g.set(e._id,i),t()})})}function a(e,t){var r=h.resolve();e.forEach(function(e,t){r=r.then(function(){return new h(function(r,n){Y._doCompactionNoLock(t,e,{ctx:E},function(e){if(e)return n(e);r()})})})}),r.then(function(){t()},t)}function s(e){var t=new d.Map;g.forEach(function(e,r){t.set(r,k.compactTree(e))}),a(t,e)}function c(){a(b,function(e){if(e&&m(e),Y.auto_compaction)return s(m);m()})}function l(e,t,n,i,a,s,u,c){function l(e){_++,v||(e?c(v=e):_===w.length&&m())}function d(e,t,r,n){return function(i){p(e,N+i,t,r,n)}}function h(e,t,r){return function(n){S.binaryMd5(n,d(e,t,n,r))}}function m(){var t=e.metadata.rev_map[e.metadata.rev];if(t)return c();t=++F,e.metadata.rev_map[e.metadata.rev]=e.metadata.seq=t;var r=[{key:V(t),value:e.data,prefix:Q.bySeqStore,type:"put"},{key:e.metadata.id,value:e.metadata,prefix:Q.docStore,type:"put"}];E.batch(r),y[u]={ok:!0,id:e.metadata.id,rev:e.metadata.rev},g.set(e.metadata.id,e.metadata),c()}C+=s;var v=null,_=0;e.metadata.winningRev=t,e.metadata.deleted=n,e.data._id=e.metadata.id,e.data._rev=e.metadata.rev,i&&(e.data._deleted=!0),e.stemmedRevs.length&&b.set(e.metadata.id,e.stemmedRevs);for(var w=e.data._attachments?Object.keys(e.data._attachments):[],x=0;x<w.length;x++){var k=w[x],O=e.data._attachments[k];if(O.stub)f(e.data._id,e.data._rev,O.digest,l);else{var j;if("string"==typeof O.data){try{j=A.atob(O.data)}catch(e){return void r(D.createError(D.BAD_ARG,"Attachment is not a valid base64 string"))}h(e,k,l)(j)}else o(O.data,h(e,k,l))}}w.length||m()}function f(e,t,r,n){function i(){return new h(function(e,t){E.get(Q.attachmentStore,r,function(r,n){if(r&&"NotFoundError"!==r.name)return t(r);e(n)})})}function o(n){var i=[e,t].join("@"),o={};return n?n.refs&&(o.refs=n.refs,o.refs[i]=!0):(o.refs={},o.refs[i]=!0),new h(function(e){E.batch([{type:"put",prefix:Q.attachmentStore,key:r,value:o}]),e(!n)})}var a=R[r]||h.resolve();R[r]=a.then(function(){return i().then(o).then(function(e){n(null,e)},n)})}function p(e,t,r,n,i){var o=e.data._attachments[r];delete o.data,o.digest=t,o.length=n.length;var a=e.metadata.id,s=e.metadata.rev;o.revpos=parseInt(s,10),f(a,s,t,function(e,r){return e?i(e):0===n.length?i(e):r?(E.batch([{type:"put",prefix:Q.binaryStore,key:t,value:_(n,"binary")}]),void i()):i(e)})}function m(e){if(e)return w.nextTick(function(){r(e)});E.batch([{prefix:Q.metaStore,type:"put",key:T,value:F},{prefix:Q.metaStore,type:"put",key:I,value:K._docCount+C}]),E.execute(K,function(e){if(e)return r(e);K._docCount+=C,K._updateSeq=F,q.notify(Z),w.nextTick(function(){r(null,y)})})}var v=t.new_edits,y=new Array(e.docs.length),g=new d.Map,b=new d.Map,E=new u,C=0,F=K._updateSeq,O=e.docs,j=O.map(function(e){if(e._id&&x.isLocalId(e._id))return e;var t=x.parseDoc(e,v);return t.metadata&&!t.metadata.rev_map&&(t.metadata.rev_map={}),t}),B=j.filter(function(e){return e.error});if(B.length)return r(B[0]);var R={};if(!j.length)return r(null,[]);!function(e){var t=[];if(O.forEach(function(e){e&&e._attachments&&Object.keys(e._attachments).forEach(function(r){var n=e._attachments[r];n.stub&&t.push(n.digest)})}),!t.length)return e();var r,i=0;t.forEach(function(o){n(o,function(n){n&&!r&&(r=n),++i===t.length&&e(r)})})}(function(e){if(e)return r(e);i(function(e){if(e)return r(e);x.processDocs(X,j,Y,g,E,y,l,t,c)})})}),Y._allDocs=z(function(e,t){e=w.clone(e),s(function(r,n){if(r)return t(r);var i={},o=e.skip||0;if(e.startkey&&(i.gte=e.startkey),e.endkey&&(i.lte=e.endkey),e.key&&(i.gte=i.lte=e.key),e.descending){i.reverse=!0;var a=i.lte;i.lte=i.gte,i.gte=a}var s;if("number"==typeof e.limit&&(s=e.limit),0===s||"start"in i&&"end"in i&&i.start>i.end)return t(null,{total_rows:n,offset:e.skip,rows:[]});var u=[],f=Q.docStore.readStream(i),d=y.obj(function(t,r,n){function i(t){var r={id:a.id,key:a.id,value:{rev:p}};if(e.include_docs){if(r.doc=t,r.doc._rev=r.value.rev,e.conflicts){var i=k.collectConflicts(a);i.length&&(r.doc._conflicts=i)}for(var o in r.doc._attachments)r.doc._attachments.hasOwnProperty(o)&&(r.doc._attachments[o].stub=!0)}if(!1===e.inclusive_end&&a.id===e.endkey)return n();if(d){if("ok"!==e.deleted)return n();r.value.deleted=!0,r.doc=null}u.push(r),n()}var a=t.value,p=c(a),d=l(a,p);if(d){if("ok"!==e.deleted)return void n()}else{if(o-- >0)return void n();if("number"==typeof s&&s--<=0)return f.unpipe(),f.destroy(),void n()}if(e.include_docs){var h=a.rev_map[p];Q.bySeqStore.get(V(h),function(e,t){i(t)})}else i()},function(r){h.resolve().then(function(){if(e.include_docs&&e.attachments)return p(u,Q,e)}).then(function(){t(null,{total_rows:n,offset:e.skip,rows:u})},t),r()}).on("unpipe",function(){d.end()});f.on("error",t),f.pipe(d)})}),Y._changes=function(e){function t(){e.done=!0,l&&e.limit&&e.limit<o.length&&(o.length=e.limit),v.unpipe(g),v.destroy(),e.continuous||e.cancelled||(e.include_docs&&e.attachments?p(o,Q,e).then(function(){e.complete(null,{results:o,last_seq:a})}):e.complete(null,{results:o,last_seq:a}))}if((e=w.clone(e)).continuous){var r=Z+":"+w.uuid();return q.addListener(Z,r,Y,e),q.notify(Z),{cancel:function(){q.removeListener(Z,r)}}}var n,i=e.descending,o=[],a=e.since||0,s=0,u={reverse:i};"limit"in e&&e.limit>0&&(n=e.limit),u.reverse||(u.start=V(e.since||0));var l,f=e.doc_ids&&new d.Set(e.doc_ids),h=w.filterChange(e),m=new d.Map;l="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var v=Q.bySeqStore.readStream(u),g=y.obj(function(r,u,d){function v(t){function r(r){var n=e.processChange(r,t,e);n.seq=t.seq;var i=h(n);if("object"==typeof i)return e.complete(i);i&&(s++,e.attachments&&e.include_docs?p([n],Q,e).then(function(){e.onChange(n)}):e.onChange(n),l&&o.push(n)),d()}var n=c(t);if(t.seq!==y)return d();if(a=y,n===g._rev)return r(g);var i=t.rev_map[n];Q.bySeqStore.get(V(i),function(e,t){r(t)})}if(n&&s>=n)return t(),d();if(e.cancelled||e.done)return d();var y=G(r.key),g=r.value;if(y===e.since&&!i)return d();if(f&&!f.has(g._id))return d();var b;if(b=m.get(g._id))return v(b);Q.docStore.get(g._id,function(t,r){if(e.cancelled||e.done||K.isClosed()||x.isLocalId(r.id))return d();m.set(g._id,r),v(r)})},function(t){if(e.cancelled)return t();l&&e.limit&&e.limit<o.length&&(o.length=e.limit),t()}).on("unpipe",function(){g.end(),t()});return v.pipe(g),{cancel:function(){e.cancelled=!0,t()}}},Y._close=function(e){if(K.isClosed())return e(D.createError(D.NOT_OPEN));K.close(function(t){t?e(t):(ee.delete(Z),e())})},Y._getRevisionTree=function(e,t){Q.docStore.get(e,function(e,r){e?t(D.createError(D.MISSING_DOC)):t(null,r.rev_tree)})},Y._doCompaction=U(function(e,t,r,n){Y._doCompactionNoLock(e,t,r,n)}),Y._doCompactionNoLock=function(e,t,r,n){if("function"==typeof r&&(n=r,r={}),!t.length)return n();var i=r.ctx||new u;i.get(Q.docStore,e,function(o,a){function s(e){if(e&&(p=e),++m===t.length){if(p)return n(p);c()}}function u(e){return e?n(e):(i.batch(f),r.ctx?n():void i.execute(K,n))}function c(){function r(e){e&&(o=e),++a===n.length&&u(o)}var n=Object.keys(h);if(!n.length)return u();var o,a=0,s=new d.Map;t.forEach(function(t){s.set(e+"@"+t,!0)}),n.forEach(function(e){i.get(Q.attachmentStore,e,function(t,n){if(t)return"NotFoundError"===t.name?r():r(t);var i=Object.keys(n.refs||{}).filter(function(e){return!s.has(e)}),o={};i.forEach(function(e){o[e]=!0}),i.length?f.push({key:e,type:"put",value:{refs:o},prefix:Q.attachmentStore}):f=f.concat([{key:e,type:"del",prefix:Q.attachmentStore},{key:e,type:"del",prefix:Q.binaryStore}]),r()})})}if(o)return n(o);var l=t.map(function(e){var t=a.rev_map[e];return delete a.rev_map[e],t});k.traverseRevTree(a.rev_tree,function(e,r,n,i,o){var a=r+"-"+n;-1!==t.indexOf(a)&&(o.status="missing")});var f=[];f.push({key:a.id,value:a,type:"put",prefix:Q.docStore});var p,h={},m=0;l.forEach(function(e){f.push({key:V(e),type:"del",prefix:Q.bySeqStore}),i.get(Q.bySeqStore,V(e),function(e,t){if(e)return"NotFoundError"===e.name?s():s(e);Object.keys(t._attachments||{}).forEach(function(e){var r=t._attachments[e].digest;h[r]=!0}),s()})})})},Y._getLocal=function(e,t){Q.localStore.get(e,function(e,r){e?t(D.createError(D.MISSING_DOC)):t(null,r)})},Y._putLocal=function(e,t,r){"function"==typeof t&&(r=t,t={}),t.ctx?Y._putLocalNoLock(e,t,r):Y._putLocalWithLock(e,t,r)},Y._putLocalWithLock=U(function(e,t,r){Y._putLocalNoLock(e,t,r)}),Y._putLocalNoLock=function(e,t,r){delete e._revisions;var n=e._rev,i=e._id,o=t.ctx||new u;o.get(Q.localStore,i,function(a,s){if(a&&n)return r(D.createError(D.REV_CONFLICT));if(s&&s._rev!==n)return r(D.createError(D.REV_CONFLICT));e._rev=n?"0-"+(parseInt(n.split("-")[1],10)+1):"0-1";var u=[{type:"put",prefix:Q.localStore,key:i,value:e}];o.batch(u);var c={ok:!0,id:e._id,rev:e._rev};if(t.ctx)return r(null,c);o.execute(K,function(e){if(e)return r(e);r(null,c)})})},Y._removeLocal=function(e,t,r){"function"==typeof t&&(r=t,t={}),t.ctx?Y._removeLocalNoLock(e,t,r):Y._removeLocalWithLock(e,t,r)},Y._removeLocalWithLock=U(function(e,t,r){Y._removeLocalNoLock(e,t,r)}),Y._removeLocalNoLock=function(e,t,r){var n=t.ctx||new u;n.get(Q.localStore,e._id,function(i,o){if(i)return r("NotFoundError"!==i.name?i:D.createError(D.MISSING_DOC));if(o._rev!==e._rev)return r(D.createError(D.REV_CONFLICT));n.batch([{prefix:Q.localStore,type:"del",key:e._id}]);var a={ok:!0,id:e._id,rev:"0-0"};if(t.ctx)return r(null,a);n.execute(K,function(e){if(e)return r(e);r(null,a)})})},Y._destroy=function(e,t){var r,n=w.functionName(te);if(!P.has(n))return H(Z,t);(r=P.get(n)).has(Z)?(q.removeAllListeners(Z),r.get(Z).close(function(){r.delete(Z),H(Z,t)})):H(Z,t)}}},{argsarray:1,"buffer-from":4,"double-ended-queue":17,levelup:39,"pouchdb-adapter-utils":65,"pouchdb-binary-utils":66,"pouchdb-collections":67,"pouchdb-errors":68,"pouchdb-json":69,"pouchdb-md5":70,"pouchdb-merge":71,"pouchdb-promise":63,"pouchdb-utils":72,"sublevel-pouchdb":98,through2:104}],63:[function(e,t,r){"use strict";var n=function(e){return e&&"object"==typeof e&&"default"in e?e.default:e}(e("lie")),i="function"==typeof Promise?Promise:n;t.exports=i},{lie:44}],64:[function(e,t,r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function i(e,t){var r=o.assign({db:s},e);a.call(this,r,t)}var o=e("pouchdb-utils"),a=n(e("pouchdb-adapter-leveldb-core")),s=n(e("memdown"));i.valid=function(){return!0},i.use_prefix=!1;t.exports=function(e){e.adapter("memory",i,!0)}},{memdown:48,"pouchdb-adapter-leveldb-core":62,"pouchdb-utils":72}],65:[function(e,t,r){"use strict";function n(e){return e.reduce(function(e,t){return e[t]=!0,e},{})}function i(e){if(!/^\d+\-./.test(e))return h.createError(h.INVALID_REV);var t=e.indexOf("-"),r=e.substring(0,t),n=e.substring(t+1);return{prefix:parseInt(r,10),id:n}}function o(e,t){for(var r=e.start-e.ids.length+1,n=e.ids,i=[n[0],t,[]],o=1,a=n.length;o<a;o++)i=[n[o],{status:"missing"},[i]];return[{pos:r,ids:i}]}function a(e,t){var r,n,a,s={status:"available"};if(e._deleted&&(s.deleted=!0),t)if(e._id||(e._id=d.uuid()),n=d.uuid(32,16).toLowerCase(),e._rev){if((a=i(e._rev)).error)return a;e._rev_tree=[{pos:a.prefix,ids:[a.id,{status:"missing"},[[n,s,[]]]]}],r=a.prefix+1}else e._rev_tree=[{pos:1,ids:[n,s,[]]}],r=1;else if(e._revisions&&(e._rev_tree=o(e._revisions,s),r=e._revisions.start,n=e._revisions.ids[0]),!e._rev_tree){if((a=i(e._rev)).error)return a;r=a.prefix,n=a.id,e._rev_tree=[{pos:r,ids:[n,s,[]]}]}d.invalidIdError(e._id),e._rev=r+"-"+n;var u={metadata:{},data:{}};for(var c in e)if(Object.prototype.hasOwnProperty.call(e,c)){var l="_"===c[0];if(l&&!b[c]){var f=h.createError(h.DOC_VALIDATION,c);throw f.message=h.DOC_VALIDATION.message+": "+c,f}l&&!_[c]?u.metadata[c.slice(1)]=e[c]:u.data[c]=e[c]}return u}function s(e){try{return v.atob(e)}catch(e){return{error:h.createError(h.BAD_ARG,"Attachment is not a valid base64 string")}}}function u(e,t,r){var n=s(e.data);if(n.error)return r(n.error);e.length=n.length,e.data="blob"===t?v.binaryStringToBlobOrBuffer(n,e.content_type):"base64"===t?v.btoa(n):n,y.binaryMd5(n,function(t){e.digest="md5-"+t,r()})}function c(e,t,r){y.binaryMd5(e.data,function(n){e.digest="md5-"+n,e.length=e.data.size||e.data.length||0,"binary"===t?v.blobOrBufferToBinaryString(e.data,function(t){e.data=t,r()}):"base64"===t?v.blobOrBufferToBase64(e.data,function(t){e.data=t,r()}):r()})}function l(e,t,r){if(e.stub)return r();"string"==typeof e.data?u(e,t,r):c(e,t,r)}function f(e,t,r,n,i,o,s,u){if(m.revExists(t.rev_tree,r.metadata.rev))return n[i]=r,o();var c=t.winningRev||m.winningRev(t),l="deleted"in t?t.deleted:m.isDeleted(t,c),f="deleted"in r.metadata?r.metadata.deleted:m.isDeleted(r.metadata),p=/^1-/.test(r.metadata.rev);if(l&&!f&&u&&p){var d=r.data;d._rev=c,d._id=r.metadata.id,r=a(d,u)}var v=m.merge(t.rev_tree,r.metadata.rev_tree[0],e);if(u&&(l&&f&&"new_leaf"!==v.conflicts||!l&&"new_leaf"!==v.conflicts||l&&!f&&"new_branch"===v.conflicts)){var y=h.createError(h.REV_CONFLICT);return n[i]=y,o()}var g=r.metadata.rev;r.metadata.rev_tree=v.tree,r.stemmedRevs=v.stemmedRevs||[],t.rev_map&&(r.metadata.rev_map=t.rev_map);var b=m.winningRev(r.metadata),_=m.isDeleted(r.metadata,b),w=l===_?0:l<_?-1:1;s(r,b,_,g===b?_:m.isDeleted(r.metadata,g),!0,w,i,o)}function p(e){return"missing"===e.metadata.rev_tree[0].ids[1].status}Object.defineProperty(r,"__esModule",{value:!0});var d=e("pouchdb-utils"),h=e("pouchdb-errors"),m=e("pouchdb-merge"),v=e("pouchdb-binary-utils"),y=e("pouchdb-md5"),g=e("pouchdb-collections"),b=n(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),_=n(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);r.invalidIdError=d.invalidIdError,r.isDeleted=m.isDeleted,r.isLocalId=m.isLocalId,r.normalizeDdocFunctionName=d.normalizeDdocFunctionName,r.parseDdocFunctionName=d.parseDdocFunctionName,r.parseDoc=a,r.preprocessAttachments=function(e,t,r){function n(){o++,e.length===o&&(i?r(i):r())}if(!e.length)return r();var i,o=0;e.forEach(function(e){var r=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],o=0;if(!r.length)return n();for(var a in e.data._attachments)e.data._attachments.hasOwnProperty(a)&&l(e.data._attachments[a],t,function(e){i=e,++o===r.length&&n()})})},r.processDocs=function(e,t,r,n,i,o,a,s,u){function c(e,t,r){var n=m.winningRev(e.metadata),i=m.isDeleted(e.metadata,n);if("was_delete"in s&&i)return o[t]=h.createError(h.MISSING_DOC,"deleted"),r();if(d&&p(e)){var u=h.createError(h.REV_CONFLICT);return o[t]=u,r()}a(e,n,i,i,!1,i?0:1,t,r)}function l(){++y===b&&u&&u()}e=e||1e3;var d=s.new_edits,v=new g.Map,y=0,b=t.length;t.forEach(function(e,t){if(e._id&&m.isLocalId(e._id)){var n=e._deleted?"_removeLocal":"_putLocal";r[n](e,{ctx:i},function(e,r){o[t]=e||r,l()})}else{var a=e.metadata.id;v.has(a)?(b--,v.get(a).push([e,t])):v.set(a,[[e,t]])}}),v.forEach(function(t,r){function i(){++u<t.length?s():l()}function s(){var s=t[u],l=s[0],p=s[1];if(n.has(r))f(e,n.get(r),l,o,p,i,a,d);else{var h=m.merge([],l.metadata.rev_tree[0],e);l.metadata.rev_tree=h.tree,l.stemmedRevs=h.stemmedRevs||[],c(l,p,i)}}var u=0;s()})},r.updateDoc=f},{"pouchdb-binary-utils":66,"pouchdb-collections":67,"pouchdb-errors":68,"pouchdb-md5":70,"pouchdb-merge":71,"pouchdb-utils":72}],66:[function(e,t,r){"use strict";function n(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)r.append(e[n]);return r.getBlob(t.type)}}function i(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),i=0;i<t;i++)n[i]=e.charCodeAt(i);return r}function o(e,t){return n([i(e)],{type:t})}function a(e){for(var t="",r=new Uint8Array(e),n=r.byteLength,i=0;i<n;i++)t+=String.fromCharCode(r[i]);return t}function s(e,t){if("undefined"==typeof FileReader)return t(a((new FileReaderSync).readAsArrayBuffer(e)));var r=new FileReader,n="function"==typeof r.readAsBinaryString;r.onloadend=function(e){var r=e.target.result||"";if(n)return t(r);t(a(r))},n?r.readAsBinaryString(e):r.readAsArrayBuffer(e)}function u(e,t){s(e,function(e){t(e)})}Object.defineProperty(r,"__esModule",{value:!0});var c=function(e){return atob(e)},l=function(e){return btoa(e)};r.atob=c,r.btoa=l,r.base64StringToBlobOrBuffer=function(e,t){return o(c(e),t)},r.binaryStringToArrayBuffer=i,r.binaryStringToBlobOrBuffer=o,r.blob=n,r.blobOrBufferToBase64=function(e,t){u(e,function(e){t(l(e))})},r.blobOrBufferToBinaryString=u,r.readAsArrayBuffer=function(e,t){if("undefined"==typeof FileReader)return t((new FileReaderSync).readAsArrayBuffer(e));var r=new FileReader;r.onloadend=function(e){var r=e.target.result||new ArrayBuffer(0);t(r)},r.readAsArrayBuffer(e)},r.readAsBinaryString=s,r.typedBuffer=function(){}},{}],67:[function(e,t,r){"use strict";function n(e){return"$"+e}function i(e){return e.substring(1)}function o(){this._store={}}function a(e){if(this._store=new o,e&&Array.isArray(e))for(var t=0,r=e.length;t<r;t++)this.add(e[t])}Object.defineProperty(r,"__esModule",{value:!0}),o.prototype.get=function(e){var t=n(e);return this._store[t]},o.prototype.set=function(e,t){var r=n(e);return this._store[r]=t,!0},o.prototype.has=function(e){return n(e)in this._store},o.prototype.delete=function(e){var t=n(e),r=t in this._store;return delete this._store[t],r},o.prototype.forEach=function(e){for(var t=Object.keys(this._store),r=0,n=t.length;r<n;r++){var o=t[r];e(this._store[o],o=i(o))}},Object.defineProperty(o.prototype,"size",{get:function(){return Object.keys(this._store).length}}),a.prototype.add=function(e){return this._store.set(e,!0)},a.prototype.has=function(e){return this._store.has(e)},a.prototype.forEach=function(e){this._store.forEach(function(t,r){e(r)})},Object.defineProperty(a.prototype,"size",{get:function(){return this._store.size}}),!function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}()?(r.Set=a,r.Map=o):(r.Set=Set,r.Map=Map)},{}],68:[function(e,t,r){"use strict";function n(e,t,r){Error.call(this,r),this.status=e,this.name=t,this.message=r,this.error=!0}Object.defineProperty(r,"__esModule",{value:!0}),function(e){return e&&"object"==typeof e&&"default"in e?e.default:e}(e("inherits"))(n,Error),n.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var i=new n(401,"unauthorized","Name or password is incorrect."),o=new n(400,"bad_request","Missing JSON list of 'docs'"),a=new n(404,"not_found","missing"),s=new n(409,"conflict","Document update conflict"),u=new n(400,"bad_request","_id field must contain a string"),c=new n(412,"missing_id","_id is required for puts"),l=new n(400,"bad_request","Only reserved document ids may start with underscore."),f=new n(412,"precondition_failed","Database not open"),p=new n(500,"unknown_error","Database encountered an unknown error"),d=new n(500,"badarg","Some query argument is invalid"),h=new n(400,"invalid_request","Request was invalid"),m=new n(400,"query_parse_error","Some query parameter is invalid"),v=new n(500,"doc_validation","Bad special document member"),y=new n(400,"bad_request","Something wrong with the request"),g=new n(400,"bad_request","Document must be a JSON object"),b=new n(404,"not_found","Database not found"),_=new n(500,"indexed_db_went_bad","unknown"),w=new n(500,"web_sql_went_bad","unknown"),x=new n(500,"levelDB_went_went_bad","unknown"),k=new n(403,"forbidden","Forbidden by design doc validate_doc_update function"),E=new n(400,"bad_request","Invalid rev format"),S=new n(412,"file_exists","The database could not be created, the file already exists."),A=new n(412,"missing_stub","A pre-existing attachment stub wasn't found"),D=new n(413,"invalid_url","Provided URL is invalid");r.UNAUTHORIZED=i,r.MISSING_BULK_DOCS=o,r.MISSING_DOC=a,r.REV_CONFLICT=s,r.INVALID_ID=u,r.MISSING_ID=c,r.RESERVED_ID=l,r.NOT_OPEN=f,r.UNKNOWN_ERROR=p,r.BAD_ARG=d,r.INVALID_REQUEST=h,r.QUERY_PARSE_ERROR=m,r.DOC_VALIDATION=v,r.BAD_REQUEST=y,r.NOT_AN_OBJECT=g,r.DB_MISSING=b,r.WSQ_ERROR=w,r.LDB_ERROR=x,r.FORBIDDEN=k,r.INVALID_REV=E,r.FILE_EXISTS=S,r.MISSING_STUB=A,r.IDB_ERROR=_,r.INVALID_URL=D,r.createError=function(e,t){function r(t){for(var r in e)"function"!=typeof e[r]&&(this[r]=e[r]);void 0!==t&&(this.reason=t)}return r.prototype=n.prototype,new r(t)},r.generateErrorFromResponse=function(e){if("object"!=typeof e){var t=e;(e=p).data=t}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}},{inherits:27}],69:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(e){return e&&"object"==typeof e&&"default"in e?e.default:e}(e("vuvuzela"));r.safeJsonParse=function(e){try{return JSON.parse(e)}catch(t){return n.parse(e)}},r.safeJsonStringify=function(e){try{return JSON.stringify(e)}catch(t){return n.stringify(e)}}},{vuvuzela:111}],70:[function(e,t,r){(function(t){"use strict";function n(e){return s.btoa(e)}function i(e,t,r){return e.webkitSlice?e.webkitSlice(t,r):e.slice(t,r)}function o(e,t,r,n,o){(r>0||n<t.size)&&(t=i(t,r,n)),s.readAsArrayBuffer(t,function(t){e.append(t),o()})}function a(e,t,r,n,i){(r>0||n<t.length)&&(t=t.substring(r,n)),e.appendBinary(t),i()}Object.defineProperty(r,"__esModule",{value:!0});var s=e("pouchdb-binary-utils"),u=function(e){return e&&"object"==typeof e&&"default"in e?e.default:e}(e("spark-md5")),c=t.setImmediate||t.setTimeout,l=32768;r.binaryMd5=function(e,t){function r(){c(s)}function i(){var e=n(v.end(!0));t(e),v.destroy()}function s(){var t=m*d,n=t+d;++m<h?y(v,e,t,n,r):y(v,e,t,n,i)}var f="string"==typeof e,p=f?e.length:e.size,d=Math.min(l,p),h=Math.ceil(p/d),m=0,v=f?new u:new u.ArrayBuffer,y=f?a:o;s()},r.stringMd5=function(e){return u.hash(e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"pouchdb-binary-utils":66,"spark-md5":84}],71:[function(e,t,r){"use strict";function n(e){for(var t,r,n,i,o=e.rev_tree.slice();i=o.pop();){var a=i.ids,s=a[2],u=i.pos;if(s.length)for(var c=0,l=s.length;c<l;c++)o.push({pos:u+1,ids:s[c]});else{var f=!!a[1].deleted,p=a[0];t&&!(n!==f?n:r!==u?r<u:t<p)||(t=p,r=u,n=f)}}return r+"-"+t}function i(e,t){for(var r,n=e.slice();r=n.pop();)for(var i=r.pos,o=r.ids,a=o[2],s=t(0===a.length,i,o[0],r.ctx,o[1]),u=0,c=a.length;u<c;u++)n.push({pos:i+1,ids:a[u],ctx:s})}function o(e,t){return e.pos-t.pos}function a(e){var t=[];i(e,function(e,r,n,i,o){e&&t.push({rev:r+"-"+n,pos:r,opts:o})}),t.sort(o).reverse();for(var r=0,n=t.length;r<n;r++)delete t[r].pos;return t}function s(e){for(var t,r=[],n=e.slice();t=n.pop();){var i=t.pos,o=t.ids,a=o[0],s=o[1],u=o[2],c=0===u.length,l=t.history?t.history.slice():[];l.push({id:a,opts:s}),c&&r.push({pos:i+1-l.length,ids:l});for(var f=0,p=u.length;f<p;f++)n.push({pos:i+1,ids:u[f],history:l})}return r.reverse()}function u(e,t){return e.pos-t.pos}function c(e,t,r){for(var n,i=0,o=e.length;i<o;)r(e[n=i+o>>>1],t)<0?i=n+1:o=n;return i}function l(e,t,r){var n=c(e,t,r);e.splice(n,0,t)}function f(e,t){for(var r,n,i=t,o=e.length;i<o;i++){var a=e[i],s=[a.id,a.opts,[]];n?(n[2].push(s),n=s):r=n=s}return r}function p(e,t){return e[0]<t[0]?-1:1}function d(e,t){for(var r=[{tree1:e,tree2:t}],n=!1;r.length>0;){var i=r.pop(),o=i.tree1,a=i.tree2;(o[1].status||a[1].status)&&(o[1].status="available"===o[1].status||"available"===a[1].status?"available":"missing");for(var s=0;s<a[2].length;s++)if(o[2][0]){for(var u=!1,c=0;c<o[2].length;c++)o[2][c][0]===a[2][s][0]&&(r.push({tree1:o[2][c],tree2:a[2][s]}),u=!0);u||(n="new_branch",l(o[2],a[2][s],p))}else n="new_leaf",o[2][0]=a[2][s]}return{conflicts:n,tree:e}}function h(e,t,r){var n,i=[],o=!1,a=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var s=0,c=e.length;s<c;s++){var l=e[s];if(l.pos===t.pos&&l.ids[0]===t.ids[0])n=d(l.ids,t.ids),i.push({pos:l.pos,ids:n.tree}),o=o||n.conflicts,a=!0;else if(!0!==r){var f=l.pos<t.pos?l:t,p=l.pos<t.pos?t:l,h=p.pos-f.pos,m=[],v=[];for(v.push({ids:f.ids,diff:h,parent:null,parentIdx:null});v.length>0;){var y=v.pop();if(0!==y.diff)for(var g=y.ids[2],b=0,_=g.length;b<_;b++)v.push({ids:g[b],diff:y.diff-1,parent:y.ids,parentIdx:b});else y.ids[0]===p.ids[0]&&m.push(y)}var w=m[0];w?(n=d(w.ids,p.ids),w.parent[2][w.parentIdx]=n.tree,i.push({pos:f.pos,ids:f.ids}),o=o||n.conflicts,a=!0):i.push(l)}else i.push(l)}return a||i.push(t),i.sort(u),{tree:i,conflicts:o||"internal_node"}}function m(e,t){for(var r,n,o=s(e),a=0,u=o.length;a<u;a++){var c,l=o[a],p=l.ids;if(p.length>t){r||(r={});var d=p.length-t;c={pos:l.pos+d,ids:f(p,d)};for(var m=0;m<d;m++){var v=l.pos+m+"-"+p[m].id;r[v]=!0}}else c={pos:l.pos,ids:f(p,0)};n=n?h(n,c,!0).tree:[c]}return r&&i(n,function(e,t,n){delete r[t+"-"+n]}),{tree:n,revs:r?Object.keys(r):[]}}function v(e){return e.ids}Object.defineProperty(r,"__esModule",{value:!0}),r.collectConflicts=function(e){for(var t=n(e),r=a(e.rev_tree),i=[],o=0,s=r.length;o<s;o++){var u=r[o];u.rev===t||u.opts.deleted||i.push(u.rev)}return i},r.collectLeaves=a,r.compactTree=function(e){var t=[];return i(e.rev_tree,function(e,r,n,i,o){"available"!==o.status||e||(t.push(r+"-"+n),o.status="missing")}),t},r.isDeleted=function(e,t){t||(t=n(e));for(var r,i=t.substring(t.indexOf("-")+1),o=e.rev_tree.map(v);r=o.pop();){if(r[0]===i)return!!r[1].deleted;o=o.concat(r[2])}},r.isLocalId=function(e){return/^_local/.test(e)},r.merge=function(e,t,r){var n=h(e,t),i=m(n.tree,r);return{tree:i.tree,stemmedRevs:i.revs,conflicts:n.conflicts}},r.revExists=function(e,t){for(var r,n=e.slice(),i=t.split("-"),o=parseInt(i[0],10),a=i[1];r=n.pop();){if(r.pos===o&&r.ids[0]===a)return!0;for(var s=r.ids[2],u=0,c=s.length;u<c;u++)n.push({pos:r.pos+1,ids:s[u]})}return!1},r.rootToLeaf=s,r.traverseRevTree=i,r.winningRev=n,r.latest=function(e,t){for(var r,n=t.rev_tree.slice();r=n.pop();){var i=r.pos,o=r.ids,a=o[0],s=o[1],u=o[2],c=0===u.length,l=r.history?r.history.slice():[];if(l.push({id:a,pos:i,opts:s}),c)for(var f=0,p=l.length;f<p;f++){var d=l[f];if(d.pos+"-"+d.id===e)return i+"-"+a}for(var h=0,m=u.length;h<m;h++)n.push({pos:i+1,ids:u[h],history:l})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}},{}],72:[function(e,t,r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function i(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer||"undefined"!=typeof Blob&&e instanceof Blob}function o(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),r=new Uint8Array(t),n=new Uint8Array(e);return r.set(n),t}function a(e){if(e instanceof ArrayBuffer)return o(e);var t=e.size,r=e.type;return"function"==typeof e.slice?e.slice(0,t,r):e.webkitSlice(0,t,r)}function s(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var r=t.constructor;return"function"==typeof r&&r instanceof r&&T.call(r)==I}function u(e){var t,r,n;if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(t=[],r=0,n=e.length;r<n;r++)t[r]=u(e[r]);return t}if(e instanceof Date)return e.toISOString();if(i(e))return a(e);if(!s(e))return e;t={};for(r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=u(e[r]);void 0!==o&&(t[r]=o)}return t}function c(e){var t=!1;return D(function(r){if(t)throw new Error("once called more than once");t=!0,e.apply(this,r)})}function l(e){return D(function(t){var r=this,n="function"==typeof(t=u(t))[t.length-1]&&t.pop(),i=new A(function(n,i){var o;try{var a=c(function(e,t){e?i(e):n(t)});t.push(a),(o=e.apply(r,t))&&"function"==typeof o.then&&n(o)}catch(e){i(e)}});return n&&i.then(function(e){n(null,e)},n),i})}function f(e,t){for(var r={},n=0,i=t.length;n<i;n++){var o=t[n];o in e&&(r[o]=e[o])}return r}function p(e){return e}function d(e){return[{ok:e}]}function h(){return"undefined"!=typeof chrome&&void 0!==chrome.storage&&void 0!==chrome.storage.local}function m(){return S}function v(e){h()?chrome.storage.onChanged.addListener(function(t){null!=t.db_name&&e.emit(t.dbName.newValue)}):m()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(t){e.emit(t.key)}):window.attachEvent("storage",function(t){e.emit(t.key)}))}function y(){O.EventEmitter.call(this),this._listeners={},v(this)}function g(e){if("undefined"!==console&&e in console){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function b(e,t){return e=parseInt(e,10)||0,(t=parseInt(t,10))!==t||t<=e?t=(e||1)<<1:t+=1,t>6e5&&(e=3e5,t=6e5),~~((t-e)*Math.random()+e)}function _(e,t,r){try{return!e(t,r)}catch(e){var n="Filter function threw: "+e.toString();return R.createError(R.BAD_REQUEST,n)}}function w(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}function x(e,t,r){return new A(function(n,i){e.get(t,function(o,a){if(o){if(404!==o.status)return i(o);a={}}var s=a._rev,u=r(a);if(!u)return n({updated:!1,rev:s});u._id=t,u._rev=s,n(k(e,u,r))})})}function k(e,t,r){return e.put(t).then(function(e){return{updated:!0,rev:e.rev}},function(n){if(409!==n.status)throw n;return x(e,t._id,r)})}function E(e){return 0|Math.random()*e}Object.defineProperty(r,"__esModule",{value:!0});var S,A=n(e("pouchdb-promise")),D=n(e("argsarray")),C=n(e("debug")),F=e("pouchdb-collections"),O=e("events"),j=n(e("inherits")),B=e("pouchdb-utils"),R=e("pouchdb-errors"),P=n(e("immediate")),T=Function.prototype.toString,I=T.call(Object),L=C("pouchdb:api"),N=6;if(h())S=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),S=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){S=!1}j(y,O.EventEmitter),y.prototype.addListener=function(e,t,r,n){function i(){if(o._listeners[t])if(a)a="waiting";else{a=!0;var e=f(n,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);r.changes(e).on("change",function(e){e.seq>n.since&&!n.cancelled&&(n.since=e.seq,n.onChange(e))}).on("complete",function(){"waiting"===a&&B.nextTick(i),a=!1}).on("error",function(){a=!1})}}if(!this._listeners[t]){var o=this,a=!1;this._listeners[t]=i,this.on(e,i)}},y.prototype.removeListener=function(e,t){t in this._listeners&&(O.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},y.prototype.notifyLocalWindows=function(e){h()?chrome.storage.local.set({dbName:e}):m()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},y.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var M,q,W=M="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},$=q=function(){}.name?function(e){return e.name}:function(e){return e.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]},U=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],z="queryKey",V=/(?:^|&)([^&=]*)=?([^&]*)/g,G=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,H="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");r.adapterFun=function(e,t){function r(e,t,r){if(L.enabled){for(var n=[e.name,t],i=0;i<r.length-1;i++)n.push(r[i]);L.apply(null,n);var o=r[r.length-1];r[r.length-1]=function(r,n){var i=[e.name,t];i=i.concat(r?["error",r]:["success",n]),L.apply(null,i),o(r,n)}}}return l(D(function(n){if(this._closed)return A.reject(new Error("database is closed"));if(this._destroyed)return A.reject(new Error("database is destroyed"));var i=this;return r(i,e,n),this.taskqueue.isReady?t.apply(this,n):new A(function(t,r){i.taskqueue.addTask(function(o){o?r(o):t(i[e].apply(i,n))})})}))},r.bulkGetShim=function(e,t,r){function n(){var e=[];m.forEach(function(t){t.docs.forEach(function(r){e.push({id:t.id,docs:[r]})})}),r(null,{results:e})}function i(){++h===l&&n()}function o(e,t,r){m[e]={id:t,docs:r},i()}function a(){if(!(y>=v.length)){var e=Math.min(y+N,v.length),t=v.slice(y,e);s(t,y),y+=t.length}}function s(r,n){r.forEach(function(r,i){var s=n+i,u=c.get(r),l=f(u[0],["atts_since","attachments"]);l.open_revs=u.map(function(e){return e.rev}),l.open_revs=l.open_revs.filter(p);var h=p;0===l.open_revs.length&&(delete l.open_revs,h=d),["revs","attachments","binary","ajax","latest"].forEach(function(e){e in t&&(l[e]=t[e])}),e.get(r,l,function(e,t){var n;n=e?[{error:e}]:h(t),o(s,r,n),a()})})}var u=t.docs,c=new F.Map;u.forEach(function(e){c.has(e.id)?c.get(e.id).push(e):c.set(e.id,[e])});var l=c.size,h=0,m=new Array(l),v=[];c.forEach(function(e,t){v.push(t)});var y=0;a()},r.changesHandler=y,r.clone=u,r.defaultBackOff=function(e){var t=0;return e||(t=2e3),b(e,t)},r.explainError=function(e,t){g("info","The above "+e+" is totally normal. "+t)},r.assign=W,r.filterChange=function(e){var t={},r=e.filter&&"function"==typeof e.filter;return t.query=e.query_params,function(n){n.doc||(n.doc={});var i=r&&_(e.filter,n.doc,t);if("object"==typeof i)return i;if(i)return!1;if(e.include_docs){if(!e.attachments)for(var o in n.doc._attachments)n.doc._attachments.hasOwnProperty(o)&&(n.doc._attachments[o].stub=!0)}else delete n.doc;return!0}},r.flatten=function(e){for(var t=[],r=0,n=e.length;r<n;r++)t=t.concat(e[r]);return t},r.functionName=$,r.guardedConsole=g,r.hasLocalStorage=m,r.invalidIdError=function(e){var t;if(e?"string"!=typeof e?t=R.createError(R.INVALID_ID):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=R.createError(R.RESERVED_ID)):t=R.createError(R.MISSING_ID),t)throw t},r.isChromeApp=h,r.isCordova=function(){return"undefined"!=typeof cordova||"undefined"!=typeof PhoneGap||"undefined"!=typeof phonegap},r.listenerCount=function(e,t){return"listenerCount"in e?e.listenerCount(t):O.EventEmitter.listenerCount(e,t)},r.nextTick=P,r.normalizeDdocFunctionName=function(e){var t=w(e);return t?t.join("/"):null},r.once=c,r.parseDdocFunctionName=w,r.parseUri=function(e){for(var t=G.exec(e),r={},n=14;n--;){var i=U[n],o=t[n]||"",a=-1!==["user","password"].indexOf(i);r[i]=a?decodeURIComponent(o):o}return r[z]={},r[U[12]].replace(V,function(e,t,n){t&&(r[z][t]=n)}),r},r.pick=f,r.toPromise=l,r.upsert=x,r.uuid=function(e,t){t=t||H.length;var r="",n=-1;if(e){for(;++n<e;)r+=H[E(t)];return r}for(;++n<36;)switch(n){case 8:case 13:case 18:case 23:r+="-";break;case 19:r+=H[3&E(16)|8];break;default:r+=H[E(16)]}return r}},{argsarray:1,debug:8,events:21,immediate:26,inherits:27,"pouchdb-collections":67,"pouchdb-errors":68,"pouchdb-promise":73,"pouchdb-utils":72}],73:[function(e,t,r){arguments[4][63][0].apply(r,arguments)},{dup:63,lie:44}],74:[function(e,t,r){(function(e){"use strict";!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports=function(t,r,n,i){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var o,a,s=arguments.length;switch(s){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick(function(){t.call(null,r)});case 3:return e.nextTick(function(){t.call(null,r,n)});case 4:return e.nextTick(function(){t.call(null,r,n,i)});default:for(o=new Array(s-1),a=0;a<o.length;)o[a++]=arguments[a];return e.nextTick(function(){t.apply(null,o)})}}:t.exports=e.nextTick}).call(this,e("_process"))},{_process:75}],75:[function(e,t,r){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(f===setTimeout)return setTimeout(e,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function a(e){if(p===clearTimeout)return clearTimeout(e);if((p===i||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(e);try{return p(e)}catch(t){try{return p.call(null,e)}catch(t){return p.call(this,e)}}}function s(){v&&h&&(v=!1,h.length?m=h.concat(m):y=-1,m.length&&u())}function u(){if(!v){var e=o(s);v=!0;for(var t=m.length;t;){for(h=m,m=[];++y<t;)h&&h[y].run();y=-1,t=m.length}h=null,v=!1,a(e)}}function c(e,t){this.fun=e,this.array=t}function l(){}var f,p,d=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(e){f=n}try{p="function"==typeof clearTimeout?clearTimeout:i}catch(e){p=i}}();var h,m=[],v=!1,y=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];m.push(new c(e,t)),1!==m.length||v||o(u)},c.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=l,d.addListener=l,d.once=l,d.off=l,d.removeListener=l,d.removeAllListeners=l,d.emit=l,d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],76:[function(e,t,r){arguments[4][20][0].apply(r,arguments)},{dup:20}],77:[function(e,t,r){(function(r){function n(e){if(!(this instanceof n))return new n(e);s.call(this,e),u.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",i)}function i(){this.allowHalfOpen||this._writableState.ended||r.nextTick(this.end.bind(this))}t.exports=n;var o=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t},a=e("core-util-is");a.inherits=e("inherits");var s=e("./_stream_readable"),u=e("./_stream_writable");a.inherits(n,s),function(e,t){for(var r=0,n=e.length;r<n;r++)t(e[r],r)}(o(u.prototype),function(e){n.prototype[e]||(n.prototype[e]=u.prototype[e])})}).call(this,e("_process"))},{"./_stream_readable":79,"./_stream_writable":81,_process:75,"core-util-is":7,inherits:27}],78:[function(e,t,r){function n(e){if(!(this instanceof n))return new n(e);i.call(this,e)}t.exports=n;var i=e("./_stream_transform"),o=e("core-util-is");o.inherits=e("inherits"),o.inherits(n,i),n.prototype._transform=function(e,t,r){r(null,e)}},{"./_stream_transform":80,"core-util-is":7,inherits:27}],79:[function(e,t,r){(function(r){function n(t,r){var n=(t=t||{}).highWaterMark;this.highWaterMark=n||0===n?n:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!t.objectMode,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(C||(C=e("string_decoder/").StringDecoder),this.decoder=new C(t.encoding),this.encoding=t.encoding)}function i(e){if(!(this instanceof i))return new i(e);this._readableState=new n(e,this),this.readable=!0,A.call(this)}function o(e,t,r,n,i){var o=c(t,r);if(o)e.emit("error",o);else if(null===r||void 0===r)t.reading=!1,t.ended||l(e,t);else if(t.objectMode||r&&r.length>0)if(t.ended&&!i){s=new Error("stream.push() after EOF");e.emit("error",s)}else if(t.endEmitted&&i){var s=new Error("stream.unshift() after end event");e.emit("error",s)}else!t.decoder||i||n||(r=t.decoder.write(r)),t.length+=t.objectMode?1:r.length,i?t.buffer.unshift(r):(t.reading=!1,t.buffer.push(r)),t.needReadable&&f(e),d(e,t);else i||(t.reading=!1);return a(t)}function a(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function s(e){if(e>=F)e=F;else{e--;for(var t=1;t<32;t<<=1)e|=e>>t;e++}return e}function u(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:null===e||isNaN(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:e<=0?0:(e>t.highWaterMark&&(t.highWaterMark=s(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function c(e,t){var r=null;return E.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk")),r}function l(e,t){if(t.decoder&&!t.ended){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.length>0?f(e):_(e)}function f(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,t.sync?r.nextTick(function(){p(e)}):p(e))}function p(e){e.emit("readable")}function d(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(function(){h(e,t)}))}function h(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function m(e){return function(){var t=e._readableState;0===--t.awaitDrain&&v(e)}}function v(e){function t(e,t,i){!1===e.write(r)&&n.awaitDrain++}var r,n=e._readableState;for(n.awaitDrain=0;n.pipesCount&&null!==(r=e.read());)if(1===n.pipesCount?t(n.pipes,0,null):w(n.pipes,t),e.emit("data",r),n.awaitDrain>0)return;if(0===n.pipesCount)return n.flowing=!1,void(S.listenerCount(e,"data")>0&&g(e));n.ranOut=!0}function y(){this._readableState.ranOut&&(this._readableState.ranOut=!1,v(this))}function g(e,t){if(e._readableState.flowing)throw new Error("Cannot switch to old mode now.");var n=t||!1,i=!1;e.readable=!0,e.pipe=A.prototype.pipe,e.on=e.addListener=A.prototype.on,e.on("readable",function(){i=!0;for(var t;!n&&null!==(t=e.read());)e.emit("data",t);null===t&&(i=!1,e._readableState.needReadable=!0)}),e.pause=function(){n=!0,this.emit("pause")},e.resume=function(){n=!1,i?r.nextTick(function(){e.emit("readable")}):this.read(0),this.emit("resume")},e.emit("readable")}function b(e,t){var r,n=t.buffer,i=t.length,o=!!t.decoder,a=!!t.objectMode;if(0===n.length)return null;if(0===i)r=null;else if(a)r=n.shift();else if(!e||e>=i)r=o?n.join(""):E.concat(n,i),n.length=0;else if(e<n[0].length)r=(l=n[0]).slice(0,e),n[0]=l.slice(e);else if(e===n[0].length)r=n.shift();else{r=o?"":new E(e);for(var s=0,u=0,c=n.length;u<c&&s<e;u++){var l=n[0],f=Math.min(e-s,l.length);o?r+=l.slice(0,f):l.copy(r,s,0,f),f<l.length?n[0]=l.slice(f):n.shift(),s+=f}}return r}function _(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");!t.endEmitted&&t.calledRead&&(t.ended=!0,r.nextTick(function(){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}))}function w(e,t){for(var r=0,n=e.length;r<n;r++)t(e[r],r)}function x(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}t.exports=i;var k=e("isarray"),E=e("buffer").Buffer;i.ReadableState=n;var S=e("events").EventEmitter;S.listenerCount||(S.listenerCount=function(e,t){return e.listeners(t).length});var A=e("stream"),D=e("core-util-is");D.inherits=e("inherits");var C;D.inherits(i,A),i.prototype.push=function(e,t){var r=this._readableState;return"string"!=typeof e||r.objectMode||(t=t||r.defaultEncoding)!==r.encoding&&(e=new E(e,t),t=""),o(this,r,e,t,!1)},i.prototype.unshift=function(e){return o(this,this._readableState,e,"",!0)},i.prototype.setEncoding=function(t){C||(C=e("string_decoder/").StringDecoder),this._readableState.decoder=new C(t),this._readableState.encoding=t};var F=8388608;i.prototype.read=function(e){var t=this._readableState;t.calledRead=!0;var r,n=e;if(("number"!=typeof e||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f(this),null;if(0===(e=u(e,t))&&t.ended)return r=null,t.length>0&&t.decoder&&(r=b(e,t),t.length-=r.length),0===t.length&&_(this),r;var i=t.needReadable;return t.length-e<=t.highWaterMark&&(i=!0),(t.ended||t.reading)&&(i=!1),i&&(t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),i&&!t.reading&&(e=u(n,t)),null===(r=e>0?b(e,t):null)&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),t.ended&&!t.endEmitted&&0===t.length&&_(this),r},i.prototype._read=function(e){this.emit("error",new Error("not implemented"))},i.prototype.pipe=function(e,t){function n(e){e===l&&o()}function i(){e.end()}function o(){e.removeListener("close",s),e.removeListener("finish",u),e.removeListener("drain",d),e.removeListener("error",a),e.removeListener("unpipe",n),l.removeListener("end",i),l.removeListener("end",o),e._writableState&&!e._writableState.needDrain||d()}function a(t){c(),e.removeListener("error",a),0===S.listenerCount(e,"error")&&e.emit("error",t)}function s(){e.removeListener("finish",u),c()}function u(){e.removeListener("close",s),c()}function c(){l.unpipe(e)}var l=this,f=this._readableState;switch(f.pipesCount){case 0:f.pipes=e;break;case 1:f.pipes=[f.pipes,e];break;default:f.pipes.push(e)}f.pipesCount+=1;var p=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?i:o;f.endEmitted?r.nextTick(p):l.once("end",p),e.on("unpipe",n);var d=m(l);return e.on("drain",d),e._events&&e._events.error?k(e._events.error)?e._events.error.unshift(a):e._events.error=[a,e._events.error]:e.on("error",a),e.once("close",s),e.once("finish",u),e.emit("pipe",l),f.flowing||(this.on("readable",y),f.flowing=!0,r.nextTick(function(){v(l)})),e},i.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,this.removeListener("readable",y),t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var r=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,this.removeListener("readable",y),t.flowing=!1;for(var i=0;i<n;i++)r[i].emit("unpipe",this);return this}return-1===(i=x(t.pipes,e))?this:(t.pipes.splice(i,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},i.prototype.on=function(e,t){var r=A.prototype.on.call(this,e,t);if("data"!==e||this._readableState.flowing||g(this),"readable"===e&&this.readable){var n=this._readableState;n.readableListening||(n.readableListening=!0,n.emittedReadable=!1,n.needReadable=!0,n.reading?n.length&&f(this):this.read(0))}return r},i.prototype.addListener=i.prototype.on,i.prototype.resume=function(){g(this),this.read(0),this.emit("resume")},i.prototype.pause=function(){g(this,!0),this.emit("pause")},i.prototype.wrap=function(e){var t=this._readableState,r=!1,n=this;e.on("end",function(){if(t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&n.push(e)}n.push(null)}),e.on("data",function(i){t.decoder&&(i=t.decoder.write(i)),(!t.objectMode||null!==i&&void 0!==i)&&(t.objectMode||i&&i.length)&&(n.push(i)||(r=!0,e.pause()))});for(var i in e)"function"==typeof e[i]&&void 0===this[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));return w(["error","close","destroy","pause","resume"],function(t){e.on(t,n.emit.bind(n,t))}),n._read=function(t){r&&(r=!1,e.resume())},n},i._fromList=b}).call(this,e("_process"))},{_process:75,buffer:6,"core-util-is":7,events:21,inherits:27,isarray:82,stream:85,"string_decoder/":97}],80:[function(e,t,r){function n(e,t){this.afterTransform=function(e,r){return i(t,e,r)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function i(e,t,r){var n=e._transformState;n.transforming=!1;var i=n.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));n.writechunk=null,n.writecb=null,null!==r&&void 0!==r&&e.push(r),i&&i(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}function o(e){if(!(this instanceof o))return new o(e);s.call(this,e);this._transformState=new n(e,this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",function(){"function"==typeof this._flush?this._flush(function(e){a(t,e)}):a(t)})}function a(e,t){if(t)return e.emit("error",t);var r=e._writableState,n=(e._readableState,e._transformState);if(r.length)throw new Error("calling transform done when ws.length != 0");if(n.transforming)throw new Error("calling transform done when still transforming");return e.push(null)}t.exports=o;var s=e("./_stream_duplex"),u=e("core-util-is");u.inherits=e("inherits"),u.inherits(o,s),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,s.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,r){throw new Error("not implemented")},o.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},{"./_stream_duplex":77,"core-util-is":7,inherits:27}],81:[function(e,t,r){(function(r){function n(e,t,r){this.chunk=e,this.encoding=t,this.callback=r}function i(e,t){var r=(e=e||{}).highWaterMark;this.highWaterMark=r||0===r?r:16384,this.objectMode=!!e.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var n=!1===e.decodeStrings;this.decodeStrings=!n,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){d(t,e)},this.writecb=null,this.writelen=0,this.buffer=[],this.errorEmitted=!1}function o(t){var r=e("./_stream_duplex");if(!(this instanceof o||this instanceof r))return new o(t);this._writableState=new i(t,this),this.writable=!0,x.call(this)}function a(e,t,n){var i=new Error("write after end");e.emit("error",i),r.nextTick(function(){n(i)})}function s(e,t,n,i){var o=!0;if(!_.isBuffer(n)&&"string"!=typeof n&&null!==n&&void 0!==n&&!t.objectMode){var a=new TypeError("Invalid non-string/buffer chunk");e.emit("error",a),r.nextTick(function(){i(a)}),o=!1}return o}function u(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=new _(t,r)),t}function c(e,t,r,i,o){r=u(t,r,i),_.isBuffer(r)&&(i="buffer");var a=t.objectMode?1:r.length;t.length+=a;var s=t.length<t.highWaterMark;return s||(t.needDrain=!0),t.writing?t.buffer.push(new n(r,i,o)):l(e,t,a,r,i,o),s}function l(e,t,r,n,i,o){t.writelen=r,t.writecb=o,t.writing=!0,t.sync=!0,e._write(n,i,t.onwrite),t.sync=!1}function f(e,t,n,i,o){n?r.nextTick(function(){o(i)}):o(i),e._writableState.errorEmitted=!0,e.emit("error",i)}function p(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function d(e,t){var n=e._writableState,i=n.sync,o=n.writecb;if(p(n),t)f(e,n,i,t,o);else{var a=y(e,n);a||n.bufferProcessing||!n.buffer.length||v(e,n),i?r.nextTick(function(){h(e,n,a,o)}):h(e,n,a,o)}}function h(e,t,r,n){r||m(e,t),n(),r&&g(e,t)}function m(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function v(e,t){t.bufferProcessing=!0;for(var r=0;r<t.buffer.length;r++){var n=t.buffer[r],i=n.chunk,o=n.encoding,a=n.callback;if(l(e,t,t.objectMode?1:i.length,i,o,a),t.writing){r++;break}}t.bufferProcessing=!1,r<t.buffer.length?t.buffer=t.buffer.slice(r):t.buffer.length=0}function y(e,t){return t.ending&&0===t.length&&!t.finished&&!t.writing}function g(e,t){var r=y(e,t);return r&&(t.finished=!0,e.emit("finish")),r}function b(e,t,n){t.ending=!0,g(e,t),n&&(t.finished?r.nextTick(n):e.once("finish",n)),t.ended=!0}t.exports=o;var _=e("buffer").Buffer;o.WritableState=i;var w=e("core-util-is");w.inherits=e("inherits");var x=e("stream");w.inherits(o,x),o.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},o.prototype.write=function(e,t,r){var n=this._writableState,i=!1;return"function"==typeof t&&(r=t,t=null),_.isBuffer(e)?t="buffer":t||(t=n.defaultEncoding),"function"!=typeof r&&(r=function(){}),n.ended?a(this,n,r):s(this,n,e,r)&&(i=c(this,n,e,t,r)),i},o.prototype._write=function(e,t,r){r(new Error("not implemented"))},o.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),void 0!==e&&null!==e&&this.write(e,t),n.ending||n.finished||b(this,n,r)}}).call(this,e("_process"))},{"./_stream_duplex":77,_process:75,buffer:6,"core-util-is":7,inherits:27,stream:85}],82:[function(e,t,r){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],83:[function(e,t,r){var n=e("stream");(r=t.exports=e("./lib/_stream_readable.js")).Stream=n,r.Readable=r,r.Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":77,"./lib/_stream_passthrough.js":78,"./lib/_stream_readable.js":79,"./lib/_stream_transform.js":80,"./lib/_stream_writable.js":81,stream:85}],84:[function(e,t,r){!function(e){if("object"==typeof r)t.exports=e();else{var n;try{n=window}catch(e){n=self}n.SparkMD5=e()}}(function(e){"use strict";function t(e,t){var r=e[0],n=e[1],i=e[2],o=e[3];n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&i)+t[1]-389564586|0)<<12|o>>>20)+r|0)&r|~o&n)+t[2]+606105819|0)<<17|i>>>15)+o|0)&o|~i&r)+t[3]-1044525330|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&i)+t[5]+1200080426|0)<<12|o>>>20)+r|0)&r|~o&n)+t[6]-1473231341|0)<<17|i>>>15)+o|0)&o|~i&r)+t[7]-45705983|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&i)+t[9]-1958414417|0)<<12|o>>>20)+r|0)&r|~o&n)+t[10]-42063|0)<<17|i>>>15)+o|0)&o|~i&r)+t[11]-1990404162|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&i)+t[13]-40341101|0)<<12|o>>>20)+r|0)&r|~o&n)+t[14]-1502002290|0)<<17|i>>>15)+o|0)&o|~i&r)+t[15]+1236535329|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[1]-165796510|0)<<5|r>>>27)+n|0)&i|n&~i)+t[6]-1069501632|0)<<9|o>>>23)+r|0)&n|r&~n)+t[11]+643717713|0)<<14|i>>>18)+o|0)&r|o&~r)+t[0]-373897302|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[5]-701558691|0)<<5|r>>>27)+n|0)&i|n&~i)+t[10]+38016083|0)<<9|o>>>23)+r|0)&n|r&~n)+t[15]-660478335|0)<<14|i>>>18)+o|0)&r|o&~r)+t[4]-405537848|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[9]+568446438|0)<<5|r>>>27)+n|0)&i|n&~i)+t[14]-1019803690|0)<<9|o>>>23)+r|0)&n|r&~n)+t[3]-187363961|0)<<14|i>>>18)+o|0)&r|o&~r)+t[8]+1163531501|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[13]-1444681467|0)<<5|r>>>27)+n|0)&i|n&~i)+t[2]-51403784|0)<<9|o>>>23)+r|0)&n|r&~n)+t[7]+1735328473|0)<<14|i>>>18)+o|0)&r|o&~r)+t[12]-1926607734|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[5]-378558|0)<<4|r>>>28)+n|0)^n^i)+t[8]-2022574463|0)<<11|o>>>21)+r|0)^r^n)+t[11]+1839030562|0)<<16|i>>>16)+o|0)^o^r)+t[14]-35309556|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[1]-1530992060|0)<<4|r>>>28)+n|0)^n^i)+t[4]+1272893353|0)<<11|o>>>21)+r|0)^r^n)+t[7]-155497632|0)<<16|i>>>16)+o|0)^o^r)+t[10]-1094730640|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[13]+681279174|0)<<4|r>>>28)+n|0)^n^i)+t[0]-358537222|0)<<11|o>>>21)+r|0)^r^n)+t[3]-722521979|0)<<16|i>>>16)+o|0)^o^r)+t[6]+76029189|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[9]-640364487|0)<<4|r>>>28)+n|0)^n^i)+t[12]-421815835|0)<<11|o>>>21)+r|0)^r^n)+t[15]+530742520|0)<<16|i>>>16)+o|0)^o^r)+t[2]-995338651|0)<<23|n>>>9)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[0]-198630844|0)<<6|r>>>26)+n|0)|~i))+t[7]+1126891415|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[14]-1416354905|0)<<15|i>>>17)+o|0)|~r))+t[5]-57434055|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[12]+1700485571|0)<<6|r>>>26)+n|0)|~i))+t[3]-1894986606|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[10]-1051523|0)<<15|i>>>17)+o|0)|~r))+t[1]-2054922799|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[8]+1873313359|0)<<6|r>>>26)+n|0)|~i))+t[15]-30611744|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[6]-1560198380|0)<<15|i>>>17)+o|0)|~r))+t[13]+1309151649|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[4]-145523070|0)<<6|r>>>26)+n|0)|~i))+t[11]-1120210379|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[2]+718787259|0)<<15|i>>>17)+o|0)|~r))+t[9]-343485551|0)<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0}function r(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function n(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function i(e){var n,i,o,a,s,u,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=c;n+=64)t(l,r(e.substring(n-64,n)));for(i=(e=e.substring(n-64)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<i;n+=1)o[n>>2]|=e.charCodeAt(n)<<(n%4<<3);if(o[n>>2]|=128<<(n%4<<3),n>55)for(t(l,o),n=0;n<16;n+=1)o[n]=0;return a=8*c,a=a.toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),u=parseInt(a[1],16)||0,o[14]=s,o[15]=u,t(l,o),l}function o(e){var r,i,o,a,s,u,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(r=64;r<=c;r+=64)t(l,n(e.subarray(r-64,r)));for(i=(e=r-64<c?e.subarray(r-64):new Uint8Array(0)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<i;r+=1)o[r>>2]|=e[r]<<(r%4<<3);if(o[r>>2]|=128<<(r%4<<3),r>55)for(t(l,o),r=0;r<16;r+=1)o[r]=0;return a=8*c,a=a.toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),u=parseInt(a[1],16)||0,o[14]=s,o[15]=u,t(l,o),l}function a(e){var t,r="";for(t=0;t<4;t+=1)r+=h[e>>8*t+4&15]+h[e>>8*t&15];return r}function s(e){var t;for(t=0;t<e.length;t+=1)e[t]=a(e[t]);return e.join("")}function u(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function c(e,t){var r,n=e.length,i=new ArrayBuffer(n),o=new Uint8Array(i);for(r=0;r<n;r+=1)o[r]=e.charCodeAt(r);return t?o:i}function l(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function f(e,t,r){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e)),n.set(new Uint8Array(t),e.byteLength),r?n:n.buffer}function p(e){var t,r=[],n=e.length;for(t=0;t<n-1;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function d(){this.reset()}var h=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==s(i("hello"))&&function(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r},"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return e=0|e||0,e<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,n){var i,o,a,s,u=this.byteLength,c=t(r,u),l=u;return n!==e&&(l=t(n,u)),c>l?new ArrayBuffer(0):(i=l-c,o=new ArrayBuffer(i),a=new Uint8Array(o),s=new Uint8Array(this,c,i),a.set(s),o)}}(),d.prototype.append=function(e){return this.appendBinary(u(e)),this},d.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var n,i=this._buff.length;for(n=64;n<=i;n+=64)t(this._hash,r(this._buff.substring(n-64,n)));return this._buff=this._buff.substring(n-64),this},d.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(o,i),r=s(this._hash),e&&(r=p(r)),this.reset(),r},d.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},d.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},d.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},d.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},d.prototype._finish=function(e,r){var n,i,o,a=r;if(e[a>>2]|=128<<(a%4<<3),a>55)for(t(this._hash,e),a=0;a<16;a+=1)e[a]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),o=parseInt(n[1],16)||0,e[14]=i,e[15]=o,t(this._hash,e)},d.hash=function(e,t){return d.hashBinary(u(e),t)},d.hashBinary=function(e,t){var r=s(i(e));return t?p(r):r},d.ArrayBuffer=function(){this.reset()},d.ArrayBuffer.prototype.append=function(e){var r,i=f(this._buff.buffer,e,!0),o=i.length;for(this._length+=e.byteLength,r=64;r<=o;r+=64)t(this._hash,n(i.subarray(r-64,r)));return this._buff=r-64<o?new Uint8Array(i.buffer.slice(r-64)):new Uint8Array(0),this},d.ArrayBuffer.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n[t]<<(t%4<<3);return this._finish(o,i),r=s(this._hash),e&&(r=p(r)),this.reset(),r},d.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},d.ArrayBuffer.prototype.getState=function(){var e=d.prototype.getState.call(this);return e.buff=l(e.buff),e},d.ArrayBuffer.prototype.setState=function(e){return e.buff=c(e.buff,!0),d.prototype.setState.call(this,e)},d.ArrayBuffer.prototype.destroy=d.prototype.destroy,d.ArrayBuffer.prototype._finish=d.prototype._finish,d.ArrayBuffer.hash=function(e,t){var r=s(o(new Uint8Array(e)));return t?p(r):r},d})},{}],85:[function(e,t,r){function n(){i.call(this)}t.exports=n;var i=e("events").EventEmitter;e("inherits")(n,i),n.Readable=e("readable-stream/readable.js"),n.Writable=e("readable-stream/writable.js"),n.Duplex=e("readable-stream/duplex.js"),n.Transform=e("readable-stream/transform.js"),n.PassThrough=e("readable-stream/passthrough.js"),n.Stream=n,n.prototype.pipe=function(e,t){function r(t){e.writable&&!1===e.write(t)&&c.pause&&c.pause()}function n(){c.readable&&c.resume&&c.resume()}function o(){l||(l=!0,e.end())}function a(){l||(l=!0,"function"==typeof e.destroy&&e.destroy())}function s(e){if(u(),0===i.listenerCount(this,"error"))throw e}function u(){c.removeListener("data",r),e.removeListener("drain",n),c.removeListener("end",o),c.removeListener("close",a),c.removeListener("error",s),e.removeListener("error",s),c.removeListener("end",u),c.removeListener("close",u),e.removeListener("close",u)}var c=this;c.on("data",r),e.on("drain",n),e._isStdio||t&&!1===t.end||(c.on("end",o),c.on("close",a));var l=!1;return c.on("error",s),e.on("error",s),c.on("end",u),c.on("close",u),e.on("close",u),e.emit("pipe",c),e}},{events:21,inherits:27,"readable-stream/duplex.js":86,"readable-stream/passthrough.js":93,"readable-stream/readable.js":94,"readable-stream/transform.js":95,"readable-stream/writable.js":96}],86:[function(e,t,r){t.exports=e("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":87}],87:[function(e,t,r){"use strict";function n(e){if(!(this instanceof n))return new n(e);c.call(this,e),l.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",i)}function i(){this.allowHalfOpen||this._writableState.ended||s(o,this)}function o(e){e.end()}var a=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};t.exports=n;var s=e("process-nextick-args"),u=e("core-util-is");u.inherits=e("inherits");var c=e("./_stream_readable"),l=e("./_stream_writable");u.inherits(n,c);for(var f=a(l.prototype),p=0;p<f.length;p++){var d=f[p];n.prototype[d]||(n.prototype[d]=l.prototype[d])}},{"./_stream_readable":89,"./_stream_writable":91,"core-util-is":7,inherits:27,"process-nextick-args":74}],88:[function(e,t,r){"use strict";function n(e){if(!(this instanceof n))return new n(e);i.call(this,e)}t.exports=n;var i=e("./_stream_transform"),o=e("core-util-is");o.inherits=e("inherits"),o.inherits(n,i),n.prototype._transform=function(e,t,r){r(null,e)}},{"./_stream_transform":90,"core-util-is":7,inherits:27}],89:[function(e,t,r){(function(r){"use strict";function n(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?j(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}function i(t,r){F=F||e("./_stream_duplex"),t=t||{},this.objectMode=!!t.objectMode,r instanceof F&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var n=t.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:i,this.highWaterMark=~~this.highWaterMark,this.buffer=new q,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(M||(M=e("string_decoder/").StringDecoder),this.decoder=new M(t.encoding),this.encoding=t.encoding)}function o(t){if(F=F||e("./_stream_duplex"),!(this instanceof o))return new o(t);this._readableState=new i(t,this),this.readable=!0,t&&"function"==typeof t.read&&(this._read=t.read),B.call(this)}function a(e,t,r,n,i){var o=l(t,r);if(o)e.emit("error",o);else if(null===r)t.reading=!1,f(e,t);else if(t.objectMode||r&&r.length>0)if(t.ended&&!i){var a=new Error("stream.push() after EOF");e.emit("error",a)}else if(t.endEmitted&&i){var u=new Error("stream.unshift() after end event");e.emit("error",u)}else{var c;!t.decoder||i||n||(r=t.decoder.write(r),c=!t.objectMode&&0===r.length),i||(t.reading=!1),c||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,i?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&p(e))),h(e,t)}else i||(t.reading=!1);return s(t)}function s(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function u(e){return e>=W?e=W:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function c(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=u(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function l(e,t){var r=null;return P.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk")),r}function f(e,t){if(!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,p(e)}}function p(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(N("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?O(d,e):d(e))}function d(e){N("emit readable"),e.emit("readable"),_(e)}function h(e,t){t.readingMore||(t.readingMore=!0,O(m,e,t))}function m(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(N("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function v(e){return function(){var t=e._readableState;N("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&R(e,"data")&&(t.flowing=!0,_(e))}}function y(e){N("readable nexttick read 0"),e.read(0)}function g(e,t){t.resumeScheduled||(t.resumeScheduled=!0,O(b,e,t))}function b(e,t){t.reading||(N("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),_(e),t.flowing&&!t.reading&&e.read(0)}function _(e){var t=e._readableState;for(N("flow",t.flowing);t.flowing&&null!==e.read(););}function w(e,t){if(0===t.length)return null;var r;return t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=x(e,t.buffer,t.decoder),r}function x(e,t,r){var n;return e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?k(e,t):E(e,t),n}function k(e,t){var r=t.head,n=1,i=r.data;for(e-=i.length;r=r.next;){var o=r.data,a=e>o.length?o.length:e;if(a===o.length?i+=o:i+=o.slice(0,e),0===(e-=a)){a===o.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(a));break}++n}return t.length-=n,i}function E(e,t){var r=T.allocUnsafe(e),n=t.head,i=1;for(n.data.copy(r),e-=n.data.length;n=n.next;){var o=n.data,a=e>o.length?o.length:e;if(o.copy(r,r.length-e,0,a),0===(e-=a)){a===o.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(a));break}++i}return t.length-=i,r}function S(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,O(A,t,e))}function A(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function D(e,t){for(var r=0,n=e.length;r<n;r++)t(e[r],r)}function C(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}t.exports=o;var F,O=e("process-nextick-args"),j=e("isarray");o.ReadableState=i;e("events").EventEmitter;var B,R=function(e,t){return e.listeners(t).length};!function(){try{B=e("stream")}catch(e){}finally{B||(B=e("events").EventEmitter)}}();var P=e("buffer").Buffer,T=e("buffer-shims"),I=e("core-util-is");I.inherits=e("inherits");var L=e("util"),N=void 0;N=L&&L.debuglog?L.debuglog("stream"):function(){};var M,q=e("./internal/streams/BufferList");I.inherits(o,B),o.prototype.push=function(e,t){var r=this._readableState;return r.objectMode||"string"!=typeof e||(t=t||r.defaultEncoding)!==r.encoding&&(e=T.from(e,t),t=""),a(this,r,e,t,!1)},o.prototype.unshift=function(e){return a(this,this._readableState,e,"",!0)},o.prototype.isPaused=function(){return!1===this._readableState.flowing},o.prototype.setEncoding=function(t){return M||(M=e("string_decoder/").StringDecoder),this._readableState.decoder=new M(t),this._readableState.encoding=t,this};var W=8388608;o.prototype.read=function(e){N("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return N("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?S(this):p(this),null;if(0===(e=c(e,t))&&t.ended)return 0===t.length&&S(this),null;var n=t.needReadable;N("need readable",n),(0===t.length||t.length-e<t.highWaterMark)&&N("length less than watermark",n=!0),t.ended||t.reading?N("reading or ended",n=!1):n&&(N("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=c(r,t)));var i;return i=e>0?w(e,t):null,null===i?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&S(this)),null!==i&&this.emit("data",i),i},o.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},o.prototype.pipe=function(e,t){function i(e){N("onunpipe"),e===p&&a()}function o(){N("onend"),e.end()}function a(){N("cleanup"),e.removeListener("close",c),e.removeListener("finish",l),e.removeListener("drain",m),e.removeListener("error",u),e.removeListener("unpipe",i),p.removeListener("end",o),p.removeListener("end",a),p.removeListener("data",s),y=!0,!d.awaitDrain||e._writableState&&!e._writableState.needDrain||m()}function s(t){N("ondata"),g=!1,!1!==e.write(t)||g||((1===d.pipesCount&&d.pipes===e||d.pipesCount>1&&-1!==C(d.pipes,e))&&!y&&(N("false write response, pause",p._readableState.awaitDrain),p._readableState.awaitDrain++,g=!0),p.pause())}function u(t){N("onerror",t),f(),e.removeListener("error",u),0===R(e,"error")&&e.emit("error",t)}function c(){e.removeListener("finish",l),f()}function l(){N("onfinish"),e.removeListener("close",c),f()}function f(){N("unpipe"),p.unpipe(e)}var p=this,d=this._readableState;switch(d.pipesCount){case 0:d.pipes=e;break;case 1:d.pipes=[d.pipes,e];break;default:d.pipes.push(e)}d.pipesCount+=1,N("pipe count=%d opts=%j",d.pipesCount,t);var h=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?o:a;d.endEmitted?O(h):p.once("end",h),e.on("unpipe",i);var m=v(p);e.on("drain",m);var y=!1,g=!1;return p.on("data",s),n(e,"error",u),e.once("close",c),e.once("finish",l),e.emit("pipe",p),d.flowing||(N("pipe resume"),p.resume()),e},o.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var r=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<n;i++)r[i].emit("unpipe",this);return this}var o=C(t.pipes,e);return-1===o?this:(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},o.prototype.on=function(e,t){var r=B.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&p(this):O(y,this))}return r},o.prototype.addListener=o.prototype.on,o.prototype.resume=function(){var e=this._readableState;return e.flowing||(N("resume"),e.flowing=!0,g(this,e)),this},o.prototype.pause=function(){return N("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(N("pause"),this._readableState.flowing=!1,this.emit("pause")),this},o.prototype.wrap=function(e){var t=this._readableState,r=!1,n=this;e.on("end",function(){if(N("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&n.push(e)}n.push(null)}),e.on("data",function(i){N("wrapped data"),t.decoder&&(i=t.decoder.write(i)),(!t.objectMode||null!==i&&void 0!==i)&&(t.objectMode||i&&i.length)&&(n.push(i)||(r=!0,e.pause()))});for(var i in e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));return D(["error","close","destroy","pause","resume"],function(t){e.on(t,n.emit.bind(n,t))}),n._read=function(t){N("wrapped _read",t),r&&(r=!1,e.resume())},n},o._fromList=w}).call(this,e("_process"))},{"./_stream_duplex":87,"./internal/streams/BufferList":92,_process:75,buffer:6,"buffer-shims":5,"core-util-is":7,events:21,inherits:27,isarray:33,"process-nextick-args":74,"string_decoder/":97,util:3}],90:[function(e,t,r){"use strict";function n(e){this.afterTransform=function(t,r){return i(e,t,r)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function i(e,t,r){var n=e._transformState;n.transforming=!1;var i=n.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));n.writechunk=null,n.writecb=null,null!==r&&void 0!==r&&e.push(r),i(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}function o(e){if(!(this instanceof o))return new o(e);s.call(this,e),this._transformState=new n(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(e,r){a(t,e,r)}):a(t)})}function a(e,t,r){if(t)return e.emit("error",t);null!==r&&void 0!==r&&e.push(r);var n=e._writableState,i=e._transformState;if(n.length)throw new Error("Calling transform done when ws.length != 0");if(i.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}t.exports=o;var s=e("./_stream_duplex"),u=e("core-util-is");u.inherits=e("inherits"),u.inherits(o,s),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,s.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,r){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},{"./_stream_duplex":87,"core-util-is":7,inherits:27}],91:[function(e,t,r){(function(r){"use strict";function n(){}function i(e,t,r){this.chunk=e,this.encoding=t,this.callback=r,this.next=null}function o(t,r){k=k||e("./_stream_duplex"),t=t||{},this.objectMode=!!t.objectMode,r instanceof k&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var n=t.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:i,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var o=!1===t.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){h(r,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new x(this)}function a(t){if(k=k||e("./_stream_duplex"),!(j.call(a,this)||this instanceof k))return new a(t);this._writableState=new o(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev)),D.call(this)}function s(e,t){var r=new Error("write after end");e.emit("error",r),E(t,r)}function u(e,t,r,n){var i=!0,o=!1;return null===r?o=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),E(n,o),i=!1),i}function c(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=O.from(t,r)),t}function l(e,t,r,n,o,a){r||(n=c(t,n,o),F.isBuffer(n)&&(o="buffer"));var s=t.objectMode?1:n.length;t.length+=s;var u=t.length<t.highWaterMark;if(u||(t.needDrain=!0),t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest=new i(n,o,a),l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else f(e,t,!1,s,n,o,a);return u}function f(e,t,r,n,i,o,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function p(e,t,r,n,i){--t.pendingcb,r?E(i,n):i(n),e._writableState.errorEmitted=!0,e.emit("error",n)}function d(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function h(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if(d(r),t)p(e,r,n,t,i);else{var o=g(r);o||r.corked||r.bufferProcessing||!r.bufferedRequest||y(e,r),n?S(m,e,r,o,i):m(e,r,o,i)}}function m(e,t,r,n){r||v(e,t),t.pendingcb--,n(),_(e,t)}function v(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function y(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),o=t.corkedRequestsFree;o.entry=r;for(var a=0;r;)i[a]=r,r=r.next,a+=1;f(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new x(t)}else{for(;r;){var s=r.chunk,u=r.encoding,c=r.callback;if(f(e,t,!1,t.objectMode?1:s.length,s,u,c),r=r.next,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=r,t.bufferProcessing=!1}function g(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function b(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function _(e,t){var r=g(t);return r&&(0===t.pendingcb?(b(e,t),t.finished=!0,e.emit("finish")):b(e,t)),r}function w(e,t,r){t.ending=!0,_(e,t),r&&(t.finished?E(r):e.once("finish",r)),t.ended=!0,e.writable=!1}function x(e){var t=this;this.next=null,this.entry=null,this.finish=function(r){var n=t.entry;for(t.entry=null;n;){var i=n.callback;e.pendingcb--,i(r),n=n.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}t.exports=a;var k,E=e("process-nextick-args"),S=!r.browser&&["v0.10","v0.9."].indexOf(r.version.slice(0,5))>-1?setImmediate:E;a.WritableState=o;var A=e("core-util-is");A.inherits=e("inherits");var D,C={deprecate:e("util-deprecate")};!function(){try{D=e("stream")}catch(e){}finally{D||(D=e("events").EventEmitter)}}();var F=e("buffer").Buffer,O=e("buffer-shims");A.inherits(a,D),o.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(o.prototype,"buffer",{get:C.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(e){}}();var j;"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(j=Function.prototype[Symbol.hasInstance],Object.defineProperty(a,Symbol.hasInstance,{value:function(e){return!!j.call(this,e)||e&&e._writableState instanceof o}})):j=function(e){return e instanceof this},a.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},a.prototype.write=function(e,t,r){var i=this._writableState,o=!1,a=F.isBuffer(e);return"function"==typeof t&&(r=t,t=null),a?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof r&&(r=n),i.ended?s(this,r):(a||u(this,i,e,r))&&(i.pendingcb++,o=l(this,i,a,e,t,r)),o},a.prototype.cork=function(){this._writableState.corked++},a.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||y(this,e))},a.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},a.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},a.prototype._writev=null,a.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!==e&&void 0!==e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||w(this,n,r)}}).call(this,e("_process"))},{"./_stream_duplex":87,_process:75,buffer:6,"buffer-shims":5,"core-util-is":7,events:21,inherits:27,"process-nextick-args":74,"util-deprecate":106}],92:[function(e,t,r){"use strict";function n(){this.head=null,this.tail=null,this.length=0}e("buffer").Buffer;var i=e("buffer-shims");t.exports=n,n.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},n.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},n.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},n.prototype.clear=function(){this.head=this.tail=null,this.length=0},n.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},n.prototype.concat=function(e){if(0===this.length)return i.alloc(0);if(1===this.length)return this.head.data;for(var t=i.allocUnsafe(e>>>0),r=this.head,n=0;r;)r.data.copy(t,n),n+=r.data.length,r=r.next;return t}},{buffer:6,"buffer-shims":5}],93:[function(e,t,r){t.exports=e("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":88}],94:[function(e,t,r){(function(n){var i=function(){try{return e("stream")}catch(e){}}();(r=t.exports=e("./lib/_stream_readable.js")).Stream=i||r,r.Readable=r,r.Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js"),!n.browser&&"disable"===n.env.READABLE_STREAM&&i&&(t.exports=i)}).call(this,e("_process"))},{"./lib/_stream_duplex.js":87,"./lib/_stream_passthrough.js":88,"./lib/_stream_readable.js":89,"./lib/_stream_transform.js":90,"./lib/_stream_writable.js":91,_process:75}],95:[function(e,t,r){t.exports=e("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":90}],96:[function(e,t,r){t.exports=e("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":91}],97:[function(e,t,r){function n(e){if(e&&!u(e))throw new Error("Unknown encoding: "+e)}function i(e){return e.toString(this.encoding)}function o(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function a(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}var s=e("buffer").Buffer,u=s.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},c=r.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),n(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=o;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=a;break;default:return void(this.write=i)}this.charBuffer=new s(6),this.charReceived=0,this.charLength=0};c.prototype.write=function(e){for(var t="";this.charLength;){var r=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,r),this.charReceived+=r,this.charReceived<this.charLength)return"";if(e=e.slice(r,e.length),!((i=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&i<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);n=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,n),n-=this.charReceived);var n=(t+=e.toString(this.encoding,0,n)).length-1,i=t.charCodeAt(n);if(i>=55296&&i<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,n)}return t},c.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var r=e[e.length-t];if(1==t&&r>>5==6){this.charLength=2;break}if(t<=2&&r>>4==14){this.charLength=3;break}if(t<=3&&r>>3==30){this.charLength=4;break}}this.charReceived=t},c.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var r=this.charReceived,n=this.charBuffer,i=this.encoding;t+=n.slice(0,r).toString(i)}return t}},{buffer:6}],98:[function(e,t,r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function i(e){return"function"==typeof e}function o(e){return i(e.prefix)?e.prefix():e}function a(e){var t={};for(var r in e)t[r]=e[r];return t}function s(e,t,r){function n(e,n,i,o){return t.encode([e,r.encodeKey(n,i,o)])}function i(e,t){return t&&t.options&&(e.keyEncoding=e.keyEncoding||t.options.keyEncoding,e.valueEncoding=e.valueEncoding||t.options.valueEncoding),e}return e.open(function(){}),{apply:function(t,a,s){a=a||{};for(var u=[],c=-1,l=t.length;++c<l;){var f=t[c];i(f,f.prefix),f.prefix=o(f.prefix),u.push({key:n(f.prefix,f.key,a,f),value:"del"!==f.type&&r.encodeValue(f.value,a,f),type:f.type})}e.db.batch(u,a,s)},get:function(t,i,o,a){return o.asBuffer=r.valueAsBuffer(o),e.db.get(n(i,t,o),o,function(e,t){e?a(e):a(null,r.decodeValue(t,o))})},createDecoder:function(e){return function(n,i){return{key:r.decodeKey(t.decode(n)[1],e),value:r.decodeValue(i,e)}}},isClosed:function(){return e.isClosed()},close:function(t){return e.close(t)},iterator:function(i){var o=a(i||{}),s=i.prefix||[];return l.toLtgt(i,o,function(e){return n(s,e,o,{})},t.lowerBound,t.upperBound),o.prefix=null,o.keyAsBuffer=o.valueAsBuffer=!1,"number"!=typeof o.limit&&(o.limit=-1),o.keyAsBuffer=t.buffer,o.valueAsBuffer=r.valueAsBuffer(o),function(e){return{next:function(t){return e.next(t)},end:function(t){e.end(t)}}}(e.db.iterator(o))}}}function u(){Error.call(this)}function c(e,t){if(!(this instanceof c))return new c(e,t);g.call(this,{objectMode:!0,highWaterMark:e.highWaterMark}),this._waiting=!1,this._options=e,this._makeData=t}var l=n(e("ltgt")),f=n(e("events")),p=n(e("inherits")),d=n(e("level-codec")),h=n(e("readable-stream"));p(u,Error),u.prototype.name="NotFoundError";var m=f.EventEmitter,v=new u,y=function(e,t,r,n){function i(e){var t,r={};if(n)for(t in n)void 0!==n[t]&&(r[t]=n[t]);if(e)for(t in e)void 0!==e[t]&&(r[t]=e[t]);return r}var o=new m;return o.sublevels={},o.options=n,o.version="6.5.4",o.methods={},t=t||[],o.put=function(r,n,a,s){"function"==typeof a&&(s=a,a={}),e.apply([{key:r,value:n,prefix:t.slice(),type:"put"}],i(a),function(e){if(e)return s(e);o.emit("put",r,n),s(null)})},o.prefix=function(){return t.slice()},o.batch=function(r,n,a){"function"==typeof n&&(a=n,n={}),r=r.map(function(e){return{key:e.key,value:e.value,prefix:e.prefix||t,keyEncoding:e.keyEncoding,valueEncoding:e.valueEncoding,type:e.type}}),e.apply(r,i(n),function(e){if(e)return a(e);o.emit("batch",r),a(null)})},o.get=function(r,n,o){"function"==typeof n&&(o=n,n={}),e.get(r,t,i(n),function(e,t){e?o(v):o(null,t)})},o.sublevel=function(n,a){return o.sublevels[n]=o.sublevels[n]||y(e,t.concat(n),r,i(a))},o.readStream=o.createReadStream=function(n){(n=i(n)).prefix=t;var o,a=e.iterator(n);return(o=r(n,e.createDecoder(n))).setIterator(a),o},o.close=function(t){e.close(t)},o.isOpen=e.isOpen,o.isClosed=e.isClosed,o},g=h.Readable;p(c,g),c.prototype.setIterator=function(e){return this._iterator=e,this._destroyed?e.end(function(){}):this._waiting?(this._waiting=!1,this._read()):this},c.prototype._read=function(){var e=this;if(!e._destroyed)return e._iterator?void e._iterator.next(function(t,r,n){if(t||void 0===r&&void 0===n)return t||e._destroyed||e.push(null),e._cleanup(t);n=e._makeData(r,n),e._destroyed||e.push(n)}):this._waiting=!0},c.prototype._cleanup=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;e&&t.emit("error",e),t._iterator?t._iterator.end(function(){t._iterator=null,t.emit("close")}):t.emit("close")}},c.prototype.destroy=function(){this._cleanup()};var b={encode:function(e){return""+e[0]+""+e[1]},decode:function(e){var t=e.toString(),r=t.indexOf("",1);return[t.substring(1,r),t.substring(r+1)]},lowerBound:"\0",upperBound:""},_=new d;t.exports=function(e){return y(s(e,b,_),[],c,e.options)}},{events:21,inherits:27,"level-codec":34,ltgt:46,"readable-stream":83}],99:[function(e,t,r){arguments[4][87][0].apply(r,arguments)},{"./_stream_readable":100,"./_stream_writable":102,"core-util-is":7,dup:87,inherits:27,"process-nextick-args":74}],100:[function(e,t,r){(function(r){"use strict";function n(t,r){P=P||e("./_stream_duplex"),t=t||{},this.objectMode=!!t.objectMode,r instanceof P&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var n=t.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:i,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(R||(R=e("string_decoder/").StringDecoder),this.decoder=new R(t.encoding),this.encoding=t.encoding)}function i(t){if(P=P||e("./_stream_duplex"),!(this instanceof i))return new i(t);this._readableState=new n(t,this),this.readable=!0,t&&"function"==typeof t.read&&(this._read=t.read),C.call(this)}function o(e,t,r,n,i){var o=c(t,r);if(o)e.emit("error",o);else if(null===r)t.reading=!1,l(e,t);else if(t.objectMode||r&&r.length>0)if(t.ended&&!i){s=new Error("stream.push() after EOF");e.emit("error",s)}else if(t.endEmitted&&i){var s=new Error("stream.unshift() after end event");e.emit("error",s)}else{var u;!t.decoder||i||n||(r=t.decoder.write(r),u=!t.objectMode&&0===r.length),i||(t.reading=!1),u||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,i?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&f(e))),d(e,t)}else i||(t.reading=!1);return a(t)}function a(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function s(e){return e>=T?e=T:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function u(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:null===e||isNaN(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:e<=0?0:(e>t.highWaterMark&&(t.highWaterMark=s(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function c(e,t){var r=null;return D.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk")),r}function l(e,t){if(!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,f(e)}}function f(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(B("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?S(p,e):p(e))}function p(e){B("emit readable"),e.emit("readable"),b(e)}function d(e,t){t.readingMore||(t.readingMore=!0,S(h,e,t))}function h(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(B("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function m(e){return function(){var t=e._readableState;B("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&F(e,"data")&&(t.flowing=!0,b(e))}}function v(e){B("readable nexttick read 0"),e.read(0)}function y(e,t){t.resumeScheduled||(t.resumeScheduled=!0,S(g,e,t))}function g(e,t){t.reading||(B("resume read 0"),e.read(0)),t.resumeScheduled=!1,e.emit("resume"),b(e),t.flowing&&!t.reading&&e.read(0)}function b(e){var t=e._readableState;if(B("flow",t.flowing),t.flowing)do{var r=e.read()}while(null!==r&&t.flowing)}function _(e,t){var r,n=t.buffer,i=t.length,o=!!t.decoder,a=!!t.objectMode;if(0===n.length)return null;if(0===i)r=null;else if(a)r=n.shift();else if(!e||e>=i)r=o?n.join(""):1===n.length?n[0]:D.concat(n,i),n.length=0;else if(e<n[0].length)r=(l=n[0]).slice(0,e),n[0]=l.slice(e);else if(e===n[0].length)r=n.shift();else{r=o?"":new D(e);for(var s=0,u=0,c=n.length;u<c&&s<e;u++){var l=n[0],f=Math.min(e-s,l.length);o?r+=l.slice(0,f):l.copy(r,s,0,f),f<l.length?n[0]=l.slice(f):n.shift(),s+=f}}return r}function w(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");t.endEmitted||(t.ended=!0,S(x,t,e))}function x(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function k(e,t){for(var r=0,n=e.length;r<n;r++)t(e[r],r)}function E(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}t.exports=i;var S=e("process-nextick-args"),A=e("isarray"),D=e("buffer").Buffer;i.ReadableState=n;e("events");var C,F=function(e,t){return e.listeners(t).length};!function(){try{C=e("stream")}catch(e){}finally{C||(C=e("events").EventEmitter)}}();var D=e("buffer").Buffer,O=e("core-util-is");O.inherits=e("inherits");var j=e("util"),B=void 0;B=j&&j.debuglog?j.debuglog("stream"):function(){};var R;O.inherits(i,C);var P;i.prototype.push=function(e,t){var r=this._readableState;return r.objectMode||"string"!=typeof e||(t=t||r.defaultEncoding)!==r.encoding&&(e=new D(e,t),t=""),o(this,r,e,t,!1)},i.prototype.unshift=function(e){return o(this,this._readableState,e,"",!0)},i.prototype.isPaused=function(){return!1===this._readableState.flowing},i.prototype.setEncoding=function(t){return R||(R=e("string_decoder/").StringDecoder),this._readableState.decoder=new R(t),this._readableState.encoding=t,this};var T=8388608;i.prototype.read=function(e){B("read",e);var t=this._readableState,r=e;if(("number"!=typeof e||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return B("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?w(this):f(this),null;if(0===(e=u(e,t))&&t.ended)return 0===t.length&&w(this),null;var n=t.needReadable;B("need readable",n),(0===t.length||t.length-e<t.highWaterMark)&&B("length less than watermark",n=!0),(t.ended||t.reading)&&B("reading or ended",n=!1),n&&(B("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),n&&!t.reading&&(e=u(r,t));var i;return null===(i=e>0?_(e,t):null)&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),r!==e&&t.ended&&0===t.length&&w(this),null!==i&&this.emit("data",i),i},i.prototype._read=function(e){this.emit("error",new Error("not implemented"))},i.prototype.pipe=function(e,t){function n(e){B("onunpipe"),e===f&&o()}function i(){B("onend"),e.end()}function o(){B("cleanup"),e.removeListener("close",u),e.removeListener("finish",c),e.removeListener("drain",h),e.removeListener("error",s),e.removeListener("unpipe",n),f.removeListener("end",i),f.removeListener("end",o),f.removeListener("data",a),v=!0,!p.awaitDrain||e._writableState&&!e._writableState.needDrain||h()}function a(t){B("ondata"),!1===e.write(t)&&(1!==p.pipesCount||p.pipes[0]!==e||1!==f.listenerCount("data")||v||(B("false write response, pause",f._readableState.awaitDrain),f._readableState.awaitDrain++),f.pause())}function s(t){B("onerror",t),l(),e.removeListener("error",s),0===F(e,"error")&&e.emit("error",t)}function u(){e.removeListener("finish",c),l()}function c(){B("onfinish"),e.removeListener("close",u),l()}function l(){B("unpipe"),f.unpipe(e)}var f=this,p=this._readableState;switch(p.pipesCount){case 0:p.pipes=e;break;case 1:p.pipes=[p.pipes,e];break;default:p.pipes.push(e)}p.pipesCount+=1,B("pipe count=%d opts=%j",p.pipesCount,t);var d=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?i:o;p.endEmitted?S(d):f.once("end",d),e.on("unpipe",n);var h=m(f);e.on("drain",h);var v=!1;return f.on("data",a),e._events&&e._events.error?A(e._events.error)?e._events.error.unshift(s):e._events.error=[s,e._events.error]:e.on("error",s),e.once("close",u),e.once("finish",c),e.emit("pipe",f),p.flowing||(B("pipe resume"),f.resume()),e},i.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var r=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<n;i++)r[i].emit("unpipe",this);return this}var o=E(t.pipes,e);return-1===o?this:(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},i.prototype.on=function(e,t){var r=C.prototype.on.call(this,e,t);if("data"===e&&!1!==this._readableState.flowing&&this.resume(),"readable"===e&&!this._readableState.endEmitted){var n=this._readableState;n.readableListening||(n.readableListening=!0,n.emittedReadable=!1,n.needReadable=!0,n.reading?n.length&&f(this):S(v,this))}return r},i.prototype.addListener=i.prototype.on,i.prototype.resume=function(){var e=this._readableState;return e.flowing||(B("resume"),e.flowing=!0,y(this,e)),this},i.prototype.pause=function(){return B("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(B("pause"),this._readableState.flowing=!1,this.emit("pause")),this},i.prototype.wrap=function(e){var t=this._readableState,r=!1,n=this;e.on("end",function(){if(B("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&n.push(e)}n.push(null)}),e.on("data",function(i){B("wrapped data"),t.decoder&&(i=t.decoder.write(i)),(!t.objectMode||null!==i&&void 0!==i)&&(t.objectMode||i&&i.length)&&(n.push(i)||(r=!0,e.pause()))});for(var i in e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));return k(["error","close","destroy","pause","resume"],function(t){e.on(t,n.emit.bind(n,t))}),n._read=function(t){B("wrapped _read",t),r&&(r=!1,e.resume())},n},i._fromList=_}).call(this,e("_process"))},{"./_stream_duplex":99,_process:75,buffer:6,"core-util-is":7,events:21,inherits:27,isarray:33,"process-nextick-args":74,"string_decoder/":97,util:3}],101:[function(e,t,r){"use strict";function n(e){this.afterTransform=function(t,r){return i(e,t,r)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function i(e,t,r){var n=e._transformState;n.transforming=!1;var i=n.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));n.writechunk=null,n.writecb=null,null!==r&&void 0!==r&&e.push(r),i(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}function o(e){if(!(this instanceof o))return new o(e);s.call(this,e),this._transformState=new n(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(e){a(t,e)}):a(t)})}function a(e,t){if(t)return e.emit("error",t);var r=e._writableState,n=e._transformState;if(r.length)throw new Error("calling transform done when ws.length != 0");if(n.transforming)throw new Error("calling transform done when still transforming");return e.push(null)}t.exports=o;var s=e("./_stream_duplex"),u=e("core-util-is");u.inherits=e("inherits"),u.inherits(o,s),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,s.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,r){throw new Error("not implemented")},o.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},{"./_stream_duplex":99,"core-util-is":7,inherits:27}],102:[function(e,t,r){(function(r){"use strict";function n(){}function i(e,t,r){this.chunk=e,this.encoding=t,this.callback=r,this.next=null}function o(t,r){F=F||e("./_stream_duplex"),t=t||{},this.objectMode=!!t.objectMode,r instanceof F&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var n=t.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:i,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var o=!1===t.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){h(r,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new x(this),this.corkedRequestsFree.next=new x(this)}function a(t){if(F=F||e("./_stream_duplex"),!(this instanceof a||this instanceof F))return new a(t);this._writableState=new o(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev)),D.call(this)}function s(e,t){var r=new Error("write after end");e.emit("error",r),k(t,r)}function u(e,t,r,n){var i=!0;if(!S.isBuffer(r)&&"string"!=typeof r&&null!==r&&void 0!==r&&!t.objectMode){var o=new TypeError("Invalid non-string/buffer chunk");e.emit("error",o),k(n,o),i=!1}return i}function c(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=new S(t,r)),t}function l(e,t,r,n,o){r=c(t,r,n),S.isBuffer(r)&&(n="buffer");var a=t.objectMode?1:r.length;t.length+=a;var s=t.length<t.highWaterMark;if(s||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest=new i(r,n,o),u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else f(e,t,!1,a,r,n,o);return s}function f(e,t,r,n,i,o,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function p(e,t,r,n,i){--t.pendingcb,r?k(i,n):i(n),e._writableState.errorEmitted=!0,e.emit("error",n)}function d(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function h(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if(d(r),t)p(e,r,n,t,i);else{var o=g(r);o||r.corked||r.bufferProcessing||!r.bufferedRequest||y(e,r),n?E(m,e,r,o,i):m(e,r,o,i)}}function m(e,t,r,n){r||v(e,t),t.pendingcb--,n(),_(e,t)}function v(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function y(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),o=t.corkedRequestsFree;o.entry=r;for(var a=0;r;)i[a]=r,r=r.next,a+=1;f(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,t.corkedRequestsFree=o.next,o.next=null}else{for(;r;){var s=r.chunk,u=r.encoding,c=r.callback;if(f(e,t,!1,t.objectMode?1:s.length,s,u,c),r=r.next,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=r,t.bufferProcessing=!1}function g(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function b(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function _(e,t){var r=g(t);return r&&(0===t.pendingcb?(b(e,t),t.finished=!0,e.emit("finish")):b(e,t)),r}function w(e,t,r){t.ending=!0,_(e,t),r&&(t.finished?k(r):e.once("finish",r)),t.ended=!0,e.writable=!1}function x(e){var t=this;this.next=null,this.entry=null,this.finish=function(r){var n=t.entry;for(t.entry=null;n;){var i=n.callback;e.pendingcb--,i(r),n=n.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}t.exports=a;var k=e("process-nextick-args"),E=!r.browser&&["v0.10","v0.9."].indexOf(r.version.slice(0,5))>-1?setImmediate:k,S=e("buffer").Buffer;a.WritableState=o;var A=e("core-util-is");A.inherits=e("inherits");var D,C={deprecate:e("util-deprecate")};!function(){try{D=e("stream")}catch(e){}finally{D||(D=e("events").EventEmitter)}}();S=e("buffer").Buffer;A.inherits(a,D);o.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(o.prototype,"buffer",{get:C.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(e){}}();var F;a.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},a.prototype.write=function(e,t,r){var i=this._writableState,o=!1;return"function"==typeof t&&(r=t,t=null),S.isBuffer(e)?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof r&&(r=n),i.ended?s(this,r):u(this,i,e,r)&&(i.pendingcb++,o=l(this,i,e,t,r)),o},a.prototype.cork=function(){this._writableState.corked++},a.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||y(this,e))},a.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);this._writableState.defaultEncoding=e},a.prototype._write=function(e,t,r){r(new Error("not implemented"))},a.prototype._writev=null,a.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!==e&&void 0!==e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||w(this,n,r)}}).call(this,e("_process"))},{"./_stream_duplex":99,_process:75,buffer:6,"core-util-is":7,events:21,inherits:27,"process-nextick-args":74,"util-deprecate":106}],103:[function(e,t,r){arguments[4][95][0].apply(r,arguments)},{"./lib/_stream_transform.js":101,dup:95}],104:[function(e,t,r){(function(r){function n(e){a.call(this,e),this._destroyed=!1}function i(e,t,r){r(null,e)}function o(e){return function(t,r,n){return"function"==typeof t&&(n=r,r=t,t={}),"function"!=typeof r&&(r=i),"function"!=typeof n&&(n=null),e(t,r,n)}}var a=e("readable-stream/transform"),s=e("util").inherits,u=e("xtend");s(n,a),n.prototype.destroy=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;r.nextTick(function(){e&&t.emit("error",e),t.emit("close")})}},t.exports=o(function(e,t,r){var i=new n(e);return i._transform=t,r&&(i._flush=r),i}),t.exports.ctor=o(function(e,t,r){function i(t){if(!(this instanceof i))return new i(t);this.options=u(e,t),n.call(this,this.options)}return s(i,n),i.prototype._transform=t,r&&(i.prototype._flush=r),i}),t.exports.obj=o(function(e,t,r){var i=new n(u({objectMode:!0,highWaterMark:16},e));return i._transform=t,r&&(i._flush=r),i})}).call(this,e("_process"))},{_process:75,"readable-stream/transform":103,util:109,xtend:112}],105:[function(e,t,r){!function(){"use strict";var r=Object.prototype.toString,n=e("lodash.isnull"),i=e("validate.io-undefined");t.exports=function(e){return n(e)?"[object Null]":i(e)?"[object Undefined]":r.call(e)}}()},{"lodash.isnull":45,"validate.io-undefined":110}],106:[function(e,t,r){(function(e){function r(t){try{if(!e.localStorage)return!1}catch(e){return!1}var r=e.localStorage[t];return null!=r&&"true"===String(r).toLowerCase()}t.exports=function(e,t){if(r("noDeprecation"))return e;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],107:[function(e,t,r){arguments[4][27][0].apply(r,arguments)},{dup:27}],108:[function(e,t,r){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],109:[function(e,t,r){(function(t,n){function i(e,t){var n={seen:[],stylize:a};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),m(t)?n.showHidden=t:t&&r._extend(n,t),b(n.showHidden)&&(n.showHidden=!1),b(n.depth)&&(n.depth=2),b(n.colors)&&(n.colors=!1),b(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=o),u(n,e,n.depth)}function o(e,t){var r=i.styles[t];return r?"["+i.colors[r][0]+"m"+e+"["+i.colors[r][1]+"m":e}function a(e,t){return e}function s(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}function u(e,t,n){if(e.customInspect&&t&&E(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(n,e);return g(i)||(i=u(e,i,n)),i}var o=c(e,t);if(o)return o;var a=Object.keys(t),m=s(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),k(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return l(t);if(0===a.length){if(E(t)){var v=t.name?": "+t.name:"";return e.stylize("[Function"+v+"]","special")}if(_(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(x(t))return e.stylize(Date.prototype.toString.call(t),"date");if(k(t))return l(t)}var y="",b=!1,w=["{","}"];if(h(t)&&(b=!0,w=["[","]"]),E(t)&&(y=" [Function"+(t.name?": "+t.name:"")+"]"),_(t)&&(y=" "+RegExp.prototype.toString.call(t)),x(t)&&(y=" "+Date.prototype.toUTCString.call(t)),k(t)&&(y=" "+l(t)),0===a.length&&(!b||0==t.length))return w[0]+y+w[1];if(n<0)return _(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var S;return S=b?f(e,t,n,m,a):a.map(function(r){return p(e,t,n,m,r,b)}),e.seen.pop(),d(S,y,w)}function c(e,t){if(b(t))return e.stylize("undefined","undefined");if(g(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return y(t)?e.stylize(""+t,"number"):m(t)?e.stylize(""+t,"boolean"):v(t)?e.stylize("null","null"):void 0}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,r,n,i){for(var o=[],a=0,s=t.length;a<s;++a)C(t,String(a))?o.push(p(e,t,r,n,String(a),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(p(e,t,r,n,i,!0))}),o}function p(e,t,r,n,i,o){var a,s,c;if(c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]},c.get?s=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(s=e.stylize("[Setter]","special")),C(n,i)||(a="["+i+"]"),s||(e.seen.indexOf(c.value)<0?(s=v(r)?u(e,c.value,null):u(e,c.value,r-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),b(a)){if(o&&i.match(/^\d+$/))return s;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function d(e,t,r){var n=0;return e.reduce(function(e,t){return n++,t.indexOf("\n")>=0&&n++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}function h(e){return Array.isArray(e)}function m(e){return"boolean"==typeof e}function v(e){return null===e}function y(e){return"number"==typeof e}function g(e){return"string"==typeof e}function b(e){return void 0===e}function _(e){return w(e)&&"[object RegExp]"===S(e)}function w(e){return"object"==typeof e&&null!==e}function x(e){return w(e)&&"[object Date]"===S(e)}function k(e){return w(e)&&("[object Error]"===S(e)||e instanceof Error)}function E(e){return"function"==typeof e}function S(e){return Object.prototype.toString.call(e)}function A(e){return e<10?"0"+e.toString(10):e.toString(10)}function D(){var e=new Date,t=[A(e.getHours()),A(e.getMinutes()),A(e.getSeconds())].join(":");return[e.getDate(),B[e.getMonth()],t].join(" ")}function C(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var F=/%[sdj%]/g;r.format=function(e){if(!g(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(i(arguments[r]));return t.join(" ")}for(var r=1,n=arguments,o=n.length,a=String(e).replace(F,function(e){if("%%"===e)return"%";if(r>=o)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),s=n[r];r<o;s=n[++r])v(s)||!w(s)?a+=" "+s:a+=" "+i(s);return a},r.deprecate=function(e,i){if(b(n.process))return function(){return r.deprecate(e,i).apply(this,arguments)};if(!0===t.noDeprecation)return e;var o=!1;return function(){if(!o){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),o=!0}return e.apply(this,arguments)}};var O,j={};r.debuglog=function(e){if(b(O)&&(O=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!j[e])if(new RegExp("\\b"+e+"\\b","i").test(O)){var n=t.pid;j[e]=function(){var t=r.format.apply(r,arguments);console.error("%s %d: %s",e,n,t)}}else j[e]=function(){};return j[e]},r.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=h,r.isBoolean=m,r.isNull=v,r.isNullOrUndefined=function(e){return null==e},r.isNumber=y,r.isString=g,r.isSymbol=function(e){return"symbol"==typeof e},r.isUndefined=b,r.isRegExp=_,r.isObject=w,r.isDate=x,r.isError=k,r.isFunction=E,r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},r.isBuffer=e("./support/isBuffer");var B=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];r.log=function(){console.log("%s - %s",D(),r.format.apply(r,arguments))},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!w(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":108,_process:75,inherits:107}],110:[function(e,t,r){"use strict";t.exports=function(e){return void 0===e}},{}],111:[function(e,t,r){"use strict";function n(e,t,r){var n=r[r.length-1];e===n.element&&(r.pop(),n=r[r.length-1]);var i=n.element,o=n.index;Array.isArray(i)?i.push(e):o===t.length-2?i[t.pop()]=e:t.push(e)}r.stringify=function(e){var t=[];t.push({obj:e});for(var r,n,i,o,a,s,u,c,l,f,p,d="";r=t.pop();)if(n=r.obj,i=r.prefix||"",o=r.val||"",d+=i,o)d+=o;else if("object"!=typeof n)d+=void 0===n?null:JSON.stringify(n);else if(null===n)d+="null";else if(Array.isArray(n)){for(t.push({val:"]"}),a=n.length-1;a>=0;a--)s=0===a?"":",",t.push({obj:n[a],prefix:s});t.push({val:"["})}else{u=[];for(c in n)n.hasOwnProperty(c)&&u.push(c);for(t.push({val:"}"}),a=u.length-1;a>=0;a--)f=n[l=u[a]],p=a>0?",":"",p+=JSON.stringify(l)+":",t.push({obj:f,prefix:p});t.push({val:"{"})}return d},r.parse=function(e){for(var t,r,i,o,a,s,u,c,l,f=[],p=[],d=0;;)if("}"!==(t=e[d++])&&"]"!==t&&void 0!==t)switch(t){case" ":case"\t":case"\n":case":":case",":break;case"n":d+=3,n(null,f,p);break;case"t":d+=3,n(!0,f,p);break;case"f":d+=4,n(!1,f,p);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(r="",d--;;){if(i=e[d++],!/[\d\.\-e\+]/.test(i)){d--;break}r+=i}n(parseFloat(r),f,p);break;case'"':for(o="",a=void 0,s=0;;){if('"'===(u=e[d++])&&("\\"!==a||s%2!=1))break;o+=u,"\\"===(a=u)?s++:s=0}n(JSON.parse('"'+o+'"'),f,p);break;case"[":c={element:[],index:f.length},f.push(c.element),p.push(c);break;case"{":l={element:{},index:f.length},f.push(l.element),p.push(l);break;default:throw new Error("unexpectedly reached end of input: "+t)}else{if(1===f.length)return f.pop();n(f.pop(),f,p)}}},{}],112:[function(e,t,r){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var i in r)n.call(r,i)&&(e[i]=r[i])}return e};var n=Object.prototype.hasOwnProperty},{}]},{},[64])(64)}),t.exports}();!function(){var r="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;void 0===r.lively&&(r.lively={}),"undefined"==typeof btoa&&(r.btoa=function(e){return new Buffer(e).toString("base64")}),"undefined"==typeof atob&&(r.atob=function(e){return new Buffer(e,"base64").toString()}),function(){this.lively=this.lively||{},function(e,t,r,n){"use strict";function i(e){if(!y)throw new Error("nodejsRequire can only be used in nodejs!");return"undefined"!=typeof System?System._nodeRequire(e):require("module")._load(e)}function o(e){if(e.startsWith("/"))return e;if(e.match(/[^\/]+:\/\//))return e.startsWith("file:")&&(e=e.replace(/^file:\/\//,"")),e;if(!y)throw new Error("nodejs_leveldbPath called under non-nodejs environment");var t=v.process.cwd(),r=i("path").join,n=i("fs"),o=n.mkdirSync,a=n.existsSync,s=(n.readdirSync,n.readFileSync);try{var u=s(r(t,"../package.json")),c=JSON.parse(u);if("lively.web"===c.name||"lively.next"===c.name){var l=r(t,"../.livelydbs");return a(l)||o(l),r(l,e)}}catch(e){}var f=r(t,".livelydbs");return a(f)||o(f),r(f,e)}function a(){if(!y)throw new Error("nodejs_attemptToLoadProperPouchDB called under non-nodejs environment");if("undefined"!=typeof System){var e=System._nodeRequire("path").join,t=System.normalizeSync("lively.storage/index.js"),n=e(System.normalizeSync("pouchdb",t).replace(/file:\/\//,""),"../../lib/index.js");try{return(g=System._nodeRequire(n)).plugin(r),!0}catch(e){return!1}}try{return(g=require("pouchdb")).plugin(r),!0}catch(e){return!1}}function s(e,t){return!t||("string"==typeof t?!e.url.includes(t):"function"==typeof t?!t(e):!(t instanceof RegExp)||!t.test(e.url))}t="default"in t?t.default:t,r="default"in r?r.default:r;var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}},l=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},f=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},d=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},h=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},m=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},v="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:void 0,y="undefined"!=typeof global&&"undefined"!=typeof process,g=t;g.plugin(r);var b=y?function(){var e=!1,t=!1;return function(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e||(e=!0,t=a()),n.adapter||(n.adapter=r.startsWith("http")?"http":t?"leveldb":"memory"),"leveldb"==n.adapter&&(r=o(r)),n=p({},n,{name:r}),new g(n)}}():function(e,t){return new g(p({name:e},t))},_=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};l(this,e),this.name=t,this.options=r,this._pouchdb=null}return f(e,null,[{key:"findDB",value:function(e){return this.databases.get(e)}},{key:"ensureDB",value:function(e,t){var r=this.findDB(e);return r||(r=new this(e,t),this.databases.set(e,r),r)}},{key:"PouchDB",get:function(){return g},set:function(e){g=e}},{key:"databases",get:function(){return this._databases||(this._databases=new Map)}}]),f(e,[{key:"close",value:function(){this._pouchdb&&(this._pouchdb.close(),delete this._pouchdb)}},{key:"isDestroyed",value:function(){return!!this.pouchdb._destroyed}},{key:"destroy",value:function(e){return this.constructor.databases.delete(this.name),this.isDestroyed()?{ok:!0}:this.pouchdb.destroy(e)}},{key:"update",value:function(){var e=c(regeneratorRuntime.mark(function e(t,r,n){var i,o,a,s,c,l,f,p,d,h,m,v,y,g,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=n||{},i=n,o=i.ensure,a=void 0===o||o,s=i.retryOnConflict,c=void 0===s||s,l=i.maxUpdateAttempts,f=void 0===l?10:l,p={latest:!0},d=this.pouchdb,h=void 0,m=void 0,e.prev=2,e.next=5,d.get(t,p);case 5:h=e.sent,e.next=12;break;case 8:if(e.prev=8,e.t0=e.catch(2),"not_found"===e.t0.name&&a){e.next=12;break}throw e.t0;case 12:return e.next=14,r(h);case 14:if((m=e.sent)&&"object"===(void 0===m?"undefined":u(m))){e.next=17;break}return e.abrupt("return",null);case 17:return m._id!==t&&(m._id=t),h&&m._rev!==h._rev&&(m._rev=h._rev),e.prev=19,e.next=22,d.put(m);case 22:return v=e.sent,y=v.id,g=v.rev,e.abrupt("return",Object.assign(m,{_rev:g}));case 28:if(e.prev=28,e.t1=e.catch(19),!("conflict"===e.t1.name&&c&&b<f)){e.next=32;break}return e.abrupt("return",this.update(t,r,n,b+1));case 32:throw e.t1;case 33:case"end":return e.stop()}},e,this,[[2,8],[19,28]])}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"mixin",value:function(){var e=c(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.update(t,function(e){return Object.assign(e||{_id:t},r)},n));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"set",value:function(){var e=c(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.update(t,function(e){return r},n));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=c(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.pouchdb.get(t);case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),"not_found"!==e.t0.name){e.next=10;break}return e.abrupt("return",void 0);case 10:throw e.t0;case 11:case"end":return e.stop()}},e,this,[[0,6]])}));return function(t){return e.apply(this,arguments)}}()},{key:"has",value:function(){var e=c(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return e.abrupt("return",!!e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"add",value:function(){var e=c(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.pouchdb.post(t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"docList",value:function(){var e=c(regeneratorRuntime.mark(function e(){var t,r,n,i,o,a,s,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.allDocs(u);case 2:for(t=e.sent,r=t.rows,n=[],i=0;i<r.length;i++)o=r[i],a=o.id,s=o.value.rev,n.push({id:a,rev:s});return e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"revList",value:function(){var e=c(regeneratorRuntime.mark(function e(t){var r,n,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.get(t,{revs:!0});case 2:return r=e.sent,n=r._id,i=r._revisions,o=i.start,a=i.ids,e.abrupt("return",a.map(function(e){return o--+"-"+e}));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllRevisions",value:function(){var e=c(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.skip,n=void 0===r?0:r,i=u.limit,o=void 0===i?0:i,e.next=6,this.revList(t);case 6:return a=e.sent,n>0&&(a=a.slice(n)),o>0&&(a=a.slice(0,o)),s=a.map(function(e){return{rev:e,id:t}}),e.next=12,this.getDocuments(s);case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAll",value:function(){var e=c(regeneratorRuntime.mark(function e(){var t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.allDocs(p({},n,{include_docs:!0}));case 2:return t=e.sent,r=t.rows,e.abrupt("return",r.map(function(e){return e.doc}));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setDocuments",value:function(){var e=c(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,s,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.bulkDocs(t,r);case 2:n=e.sent,i=0;case 4:if(!(i<n.length)){e.next=16;break}if(o=t[i],(a=n[i]).ok||"conflict"!==a.name||o._rev){e.next=13;break}return e.next=9,this.set(o._id,o);case 9:s=e.sent,u=s._id,c=s._rev,n[i]={ok:!0,id:u,rev:c};case 13:i++,e.next=4;break;case 16:return e.abrupt("return",n);case 17:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getDocuments",value:function(){var e=c(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l,f,p,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=d.ignoreErrors,n=void 0===r||r,e.next=4,this.pouchdb.bulkGet({docs:t});case 4:i=e.sent,o=i.results,a=[],s=0;case 8:if(!(s<o.length)){e.next=23;break}u=o[s],c=u.docs,l=u.id,console.assert(1===c.length,"getDocuments: expected only one doc for "+l),f=0;case 12:if(!(f<c.length)){e.next=20;break}if(p=c[f],!n||p.ok){e.next=16;break}return e.abrupt("continue",17);case 16:a.push(p.ok||p.error||p);case 17:f++,e.next=12;break;case 20:s++,e.next=8;break;case 23:return e.abrupt("return",a);case 24:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=c(regeneratorRuntime.mark(function e(t,r,n){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===r){e.next=4;break}e.t0={_id:t,_rev:r},e.next=7;break;case 4:return e.next=6,this.get(t);case 6:e.t0=e.sent;case 7:return i=e.t0,e.abrupt("return",i?this.pouchdb.remove(i):void 0);case 9:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"removeAll",value:function(){var e=c(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.pouchdb,e.next=3,t.allDocs();case 3:return r=e.sent,e.next=6,Promise.all(r.rows.map(function(e){return t.remove(e.id,e.value.rev)}));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"replicateTo",value:function(t,r){return t instanceof e&&(t=t.pouchdb),this.pouchdb.replicate.to(t,r)}},{key:"replicateFrom",value:function(t,r){return t instanceof e&&(t=t.pouchdb),this.pouchdb.replicate.from(t,r)}},{key:"sync",value:function(t,r){return t instanceof e&&(t=t.pouchdb),this.pouchdb.sync(t,r)}},{key:"getConflicts",value:function(){var e=c(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.query({map:"function(doc) { if (doc._conflicts) emit(doc._id); }"},{reduce:!1,include_docs:!0,conflicts:!0});case 2:return t=e.sent,r=t.rows,e.abrupt("return",r.map(function(e){return e.doc}));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"resolveConflicts",value:function(){var e=c(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,s,u,c,l,f,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.get("doc",{conflicts:!0});case 2:return n=e.sent,i=n._conflicts.map(function(e){return{id:t,rev:e}}),e.next=6,this.getDocuments(i);case 6:o=e.sent,a=n,s=!0,u=!1,c=void 0,e.prev=11,l=o[Symbol.iterator]();case 13:if(s=(f=l.next()).done){e.next=28;break}return p=f.value,e.next=17,r(a,p);case 17:if(a=e.sent){e.next=20;break}return e.abrupt("return",null);case 20:return e.next=22,this.set(t,a);case 22:return a=e.sent,e.next=25,this.pouchdb.remove(p);case 25:s=!0,e.next=13;break;case 28:e.next=34;break;case 30:e.prev=30,e.t0=e.catch(11),u=!0,c=e.t0;case 34:e.prev=34,e.prev=35,!s&&l.return&&l.return();case 37:if(e.prev=37,!u){e.next=40;break}throw c;case 40:return e.finish(37);case 41:return e.finish(34);case 42:return e.abrupt("return",a);case 43:case"end":return e.stop()}},e,this,[[11,30,34,42],[35,,37,41]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"dump",value:function(){var e=c(regeneratorRuntime.mark(function e(){var t,r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.name,r=this.pouchdb,e.t0=t,e.t1=r.type(),e.t2=(new Date).toJSON(),e.next=7,r.info();case 7:return e.t3=e.sent,n={name:e.t0,db_type:e.t1,start_time:e.t2,db_info:e.t3},e.next=11,this.getAll({attachments:!0});case 11:return i=e.sent,e.abrupt("return",{header:n,docs:i});case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"backup",value:function(){var e=c(regeneratorRuntime.mark(function e(){var t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.name+"_backup_"+n,r=this.constructor.ensureDB(t),e.next=3,this.replicateTo(r);case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"migrate",value:function(){var e=c(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAll();case 2:r=e.sent,n=[],i=[],o=0;case 5:if(!(o<r.length)){e.next=16;break}if(a=r[o],s=t(a,o)){e.next=10;break}return i.push(a),e.abrupt("continue",13);case 10:s.hasOwnProperty("_id")||(s._id=a._id),s.hasOwnProperty("_rev")&&delete s._rev,n.push(s);case 13:o++,e.next=5;break;case 16:return e.next=18,this.setDocuments(n);case 18:return e.abrupt("return",{migrated:n.length,unchanged:i.length});case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"pouchdb",get:function(){if(this._pouchdb)return this._pouchdb;var e=this.name,t=this.options;return this._pouchdb=b(e,t)}}],[{key:"loadDump",value:function(){var e=c(regeneratorRuntime.mark(function e(t){var r,n,i,o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.header,n=t.docs,i=a.name||r.name,o=this.ensureDB(i),e.next=3,o.setDocuments(n,{new_edits:!1});case 3:return e.abrupt("return",o);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),w=/\//g,x=function(e){function t(){return l(this,t),m(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return h(t,e),f(t,null,[{key:"ensureDB",value:function(e,r){return d(t.__proto__||Object.getPrototypeOf(t),"ensureDB",this).call(this,"lively.storage-"+e,r)}}]),t}(_),k={name:"lively.storage",matches:function(e){return e.startsWith("lively.storage:")},resourceClass:function(e){function t(){return l(this,t),m(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return h(t,e),f(t,[{key:"read",value:function(){var e=c(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,this.db.get(this.path());case 3:return t=e.sent,r=t&&t.content,e.abrupt("return",r?"string"==typeof r?r:JSON.stringify(r):"");case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"readJson",value:function(){var e=c(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.read();case 2:return t=e.sent,e.abrupt("return","string"==typeof t?JSON.parse(t):t);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"write",value:function(){var e=c(regeneratorRuntime.mark(function e(t){var r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t||(t=""),!this.isDirectory()){e.next=4;break}throw new Error("Cannot write into a directory! ("+this.url+")");case 4:return e.next=6,this.db.update(this.path(),function(e){if(e&&e.isDirectory)throw new Error(r.url+" already exists and is a directory (cannot write into it!)");var n=Date.now();return e?p({},e,{lastModified:n,size:t.length,content:t}):{etag:void 0,type:void 0,contentType:void 0,user:void 0,group:void 0,mode:void 0,lastModified:n,created:n,size:"string"==typeof t?t.length:0,content:t}});case 6:return e.abrupt("return",this);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"writeJson",value:function(e){return this.write(e)}},{key:"mkdir",value:function(){var e=c(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDirectory()){e.next=3;break}throw new Error("Cannot mkdir a file! ("+this.url+")");case 3:return e.next=5,this.db.get(this.path());case 5:if(!(t=e.sent)){e.next=10;break}if(t.isDirectory){e.next=9;break}throw new Error(this.url+" already exists and is a file (cannot mkdir it!)");case 9:return e.abrupt("return",this);case 10:return r=Date.now(),e.next=13,this.db.set(this.path(),{etag:void 0,type:void 0,contentType:void 0,user:void 0,group:void 0,mode:void 0,lastModified:r,created:r,isDirectory:!0});case 13:return e.abrupt("return",this);case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"exists",value:function(){var e=c(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.isRoot(),e.t0){e.next=6;break}return e.next=5,this.db.get(this.path());case 5:e.t0=!!e.sent;case 6:return e.abrupt("return",e.t0);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=c(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.path(),r=this.db,e.next=5,r.docList({startkey:t,endkey:t+""});case 5:return n=e.sent,e.next=8,r.setDocuments(n.map(function(e){return{_id:e.id,_rev:e.rev,_deleted:!0}}));case 8:return e.abrupt("return",this);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"readProperties",value:function(){return this.db.get(this.path())}},{key:"dirList",value:function(){var e=c(regeneratorRuntime.mark(function e(){var t,r,n,i,o,a,u,c,l,f,p,d,h,m,v,y=this,g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDirectory()){e.next=3;break}return e.abrupt("return",this.asDirectory().dirList(g,b));case 3:return t=b.exclude,r=this.path(),n=[],e.next=8,this.db.getAll({startkey:r,endkey:r+""});case 8:i=e.sent,"infinity"===g&&(g=1/0),o=0;case 11:if(!(o<i.length)){e.next=29;break}if(a=i[o],u=a._id,c=a.isDirectory,u.startsWith(r)&&r!==u){e.next=15;break}return e.abrupt("continue",26);case 15:if(l=u.slice(r.length),!((f=l.includes("/")?l.match(w).length+1:1)>g)){e.next=20;break}if("continue"!==(p=function(){var e=y.join(l.split("/").slice(0,g).join("/")+"/");return n.some(function(t){return t.equals(e)})||n.push(e),"continue"}())){e.next=20;break}return e.abrupt("continue",26);case 20:if(d=this.join(l),!t||s(d,t)){e.next=23;break}return e.abrupt("continue",26);case 23:for(n.push(d),h=["created","lastModified","mode","group","user","contentType","type","etag","size"],m={},v=0;v<h.length;v++)d[h[v]]=a[h[v]];case 26:o++,e.next=11;break;case 29:return e.abrupt("return",n);case 30:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"db",get:function(){return this._db||(this._db=x.ensureDB(this.host()))}}]),t}(n.Resource)};n.registerExtension(k),e.Database=_}(this.lively.storage=this.lively.storage||{},e,t,lively.resources)}.call(r),"undefined"!=typeof module&&module.exports&&(module.exports=r.lively.storage)}()}(),function configure(){function decideAboutTranspiler(e){return e.supportsAsyncAwait?"lively.transpiler":"plugin-babel"}function setupLivelyTranspiler(e){function t(e,t,r){this.System=e,this.moduleId=t,this.env=r}if(e.isBrowser){if("undefined"!=typeof Babel&&(System.global.babel=Babel,delete System.global.Babel),!System.global.babel)return void console.error("[lively.modules] in browser environments babel is required to be loaded before lively.modules!")}else System.global.babel=loadBabel_node();console.log("[lively.modules] SystemJS configured with lively.transpiler & babel"),t.prototype.transpileDoit=function(e,t){var r=this.System,e="(async function(__rec) {\n"+e.replace(/(\/\/# sourceURL=.+)$|$/,"\n}).call(this);\n$1"),n=r.babelOptions;return n.plugins&&n.plugins.length||n.presets&&n.presets.length?r.global.babel.transform(e,n).code:e},t.prototype.transpileModule=function(e,t){var r=this.System,n=Object.assign({},r.babelOptions);return n.plugins=n.plugins?n.plugins.slice():[],n.plugins.push("transform-es2015-modules-systemjs"),r.global.babel.transform(e,n).code},System.set("lively.transpiler",System.newModule({default:t})),System._loader.transpilerPromise=Promise.resolve({translate:function(e,r){return new t(this,e.name,{}).transpileModule(e.source,{})}}),System.config({transpiler:"lively.transpiler",babelOptions:{sourceMaps:!1,compact:"auto",comments:"true",presets:e.supportsAsyncAwait?[]:["es2015"]}})}function setupPluginBabelTranspiler(e){var t=System.get("@system-env").browser?findSystemJSPluginBabel_browser():findSystemJSPluginBabel_node(),r=System.global.babel;t||r?t?(console.log("[lively.modules] SystemJS configured with systemjs-plugin-babel transpiler from "+t),System.config({map:{"plugin-babel":t+"/plugin-babel.js","systemjs-babel-build":t+"/systemjs-babel-browser.js"},transpiler:"plugin-babel",babelOptions:Object.assign({sourceMaps:"inline",stage3:!0,es2015:!0,modularRuntime:!0},System.babelOptions)})):(console.warn("[lively.modules] Could not find path to systemjs-plugin-babel but babel! Will fallback but there might be features in lively.modules that won't work!"),System.config({transpiler:"babel"})):console.error("[lively.modules] Could not find path to systemjs-plugin-babel nor a babel global! This will likely break lively.modules!")}function featureTest(){var isBrowser=System.get("@system-env").browser,supportsAsyncAwait=!1;try{eval("async function foo() {}"),supportsAsyncAwait=!0}catch(e){}return{supportsAsyncAwait:supportsAsyncAwait,isBrowser:isBrowser}}function loadBabel_node(){if(global.Babel&&!global.babel&&(global.babel=global.Babel),global.babel)return global.babel;var e;try{e=require.cache[require.resolve("lively.modules")]}catch(e){}try{e=require.cache[require.resolve(__dirname+"/../")]}catch(e){}if(!e)throw new Error("Cannot find batch to babel-standalone module");var t=require("module").Module._resolveFilename("babel-standalone",e);global.window=global,global.navigator={};var r=require(t);return delete global.navigator,delete global.window,r}function urlQuery(){return"undefined"!=typeof document&&document.location?(document.location.search||"").replace(/^\?/,"").split("&").reduce(function(query,ea){var split=ea.split("="),key=split[0],value=split[1];return"true"===value||"false"===value?value=eval(value):isNaN(Number(value))||(value=Number(value)),query[key]=value,query},{}):{}}function findSystemJSPluginBabel_browser(){for(var e,t=[].slice.call(document.getElementsByTagName("script")),r=t.length-1;r>=0;r--){var n=t[r].src,i=n.indexOf("lively.modules/");if(i>-1){e=n.slice(0,i)+"lively.next-node_modules/systemjs-plugin-babel";break}var o=n.indexOf("systemjs/dist/system");if(o>-1){e=n.slice(0,o)+"systemjs-plugin-babel";break}var a=n.indexOf("core/lively/bootstrap.js");if(a>-1){e=n.slice(0,a)+"node_modules/lively.modules/node_modules/systemjs-plugin-babel";break}var s=n.match(/(.*)generated\/[^\/]+\/combinedModules.js/);if(s){e=s[1]+"node_modules/lively.modules/node_modules/systemjs-plugin-babel";break}}return e}function findSystemJSPluginBabel_node(){if(global.systemjsPluginBabel)return global.systemjsPluginBabel;try{var e=require.cache[require.resolve("lively.modules")];if(t=require("module").Module._resolveFilename("systemjs-plugin-babel",e))return require("path").dirname(t)}catch(e){}try{var t=require.resolve("systemjs-plugin-babel");if(t)return require("path").dirname(t)}catch(e){}return null}if(System.useModuleTranslationCache=!urlQuery().noModuleCache,System.get("lively.transpiler")||System.map["plugin-babel"]&&System.map["systemjs-plugin-babel"])console.log("[lively.modules] System seems already to be configured");else{var features=featureTest(),transpiler=decideAboutTranspiler(features);"lively.transpiler"===transpiler?setupLivelyTranspiler(features):"plugin-babel"===transpiler?setupPluginBabelTranspiler(features):console.error(`[lively.modules] could not find System transpiler for platform!`)}}(),function(){var semver;!function(e,t){function r(e,t){if(e instanceof n)return e;if("string"!=typeof e)return null;if(e.length>O)return null;if(!(t?B[K]:B[G]).test(e))return null;try{return new n(e,t)}catch(e){return null}}function n(e,t){if(e instanceof n){if(e.loose===t)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>O)throw new TypeError("version is longer than "+O+" characters");if(!(this instanceof n))return new n(e,t);F("SemVer",e,t),this.loose=t;var r=e.trim().match(t?B[K]:B[G]);if(!r)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>j||this.major<0)throw new TypeError("Invalid major version");if(this.minor>j||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>j||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<j)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}function i(e,t){var r=ge.test(e),n=ge.test(t);return r&&n&&(e=+e,t=+t),r&&!n?-1:n&&!r?1:e<t?-1:e>t?1:0}function o(e,t,r){return new n(e,r).compare(t)}function a(e,t,r){return o(t,e,r)}function s(e,t,r){return o(e,t,r)>0}function u(e,t,r){return o(e,t,r)<0}function c(e,t,r){return 0===o(e,t,r)}function l(e,t,r){return 0!==o(e,t,r)}function f(e,t,r){return o(e,t,r)>=0}function p(e,t,r){return o(e,t,r)<=0}function d(e,t,r,n){var i;switch(t){case"===":"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),i=e===r;break;case"!==":"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),i=e!==r;break;case"":case"=":case"==":i=c(e,r,n);break;case"!=":i=l(e,r,n);break;case">":i=s(e,r,n);break;case">=":i=f(e,r,n);break;case"<":i=u(e,r,n);break;case"<=":i=p(e,r,n);break;default:throw new TypeError("Invalid operator: "+t)}return i}function h(e,t){if(e instanceof h){if(e.loose===t)return e;e=e.value}if(!(this instanceof h))return new h(e,t);F("comparator",e,t),this.loose=t,this.parse(e),this.semver===be?this.value="":this.value=this.operator+this.semver.version,F("comp",this)}function m(e,t){if(e instanceof m&&e.loose===t)return e;if(!(this instanceof m))return new m(e,t);if(this.loose=t,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(function(e){return this.parseRange(e.trim())},this).filter(function(e){return e.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function v(e,t){return F("comp",e),e=_(e,t),F("caret",e),e=g(e,t),F("tildes",e),e=x(e,t),F("xrange",e),e=E(e,t),F("stars",e),e}function y(e){return!e||"x"===e.toLowerCase()||"*"===e}function g(e,t){return e.trim().split(/\s+/).map(function(e){return b(e,t)}).join(" ")}function b(e,t){var r=t?B[ae]:B[oe];return e.replace(r,function(t,r,n,i,o){F("tilde",e,t,r,n,i,o);var a;return y(r)?a="":y(n)?a=">="+r+".0.0 <"+(+r+1)+".0.0":y(i)?a=">="+r+"."+n+".0 <"+r+"."+(+n+1)+".0":o?(F("replaceTilde pr",o),"-"!==o.charAt(0)&&(o="-"+o),a=">="+r+"."+n+"."+i+o+" <"+r+"."+(+n+1)+".0"):a=">="+r+"."+n+"."+i+" <"+r+"."+(+n+1)+".0",F("tilde return",a),a})}function _(e,t){return e.trim().split(/\s+/).map(function(e){return w(e,t)}).join(" ")}function w(e,t){F("caret",e,t);var r=t?B[le]:B[ce];return e.replace(r,function(t,r,n,i,o){F("caret",e,t,r,n,i,o);var a;return y(r)?a="":y(n)?a=">="+r+".0.0 <"+(+r+1)+".0.0":y(i)?a="0"===r?">="+r+"."+n+".0 <"+r+"."+(+n+1)+".0":">="+r+"."+n+".0 <"+(+r+1)+".0.0":o?(F("replaceCaret pr",o),"-"!==o.charAt(0)&&(o="-"+o),a="0"===r?"0"===n?">="+r+"."+n+"."+i+o+" <"+r+"."+n+"."+(+i+1):">="+r+"."+n+"."+i+o+" <"+r+"."+(+n+1)+".0":">="+r+"."+n+"."+i+o+" <"+(+r+1)+".0.0"):(F("no pr"),a="0"===r?"0"===n?">="+r+"."+n+"."+i+" <"+r+"."+n+"."+(+i+1):">="+r+"."+n+"."+i+" <"+r+"."+(+n+1)+".0":">="+r+"."+n+"."+i+" <"+(+r+1)+".0.0"),F("caret return",a),a})}function x(e,t){return F("replaceXRanges",e,t),e.split(/\s+/).map(function(e){return k(e,t)}).join(" ")}function k(e,t){e=e.trim();var r=t?B[re]:B[te];return e.replace(r,function(t,r,n,i,o,a){F("xRange",e,t,r,n,i,o,a);var s=y(n),u=s||y(i),c=u||y(o),l=c;return"="===r&&l&&(r=""),s?t=">"===r||"<"===r?"<0.0.0":"*":r&&l?(u&&(i=0),c&&(o=0),">"===r?(r=">=",u?(n=+n+1,i=0,o=0):c&&(i=+i+1,o=0)):"<="===r&&(r="<",u?n=+n+1:i=+i+1),t=r+n+"."+i+"."+o):u?t=">="+n+".0.0 <"+(+n+1)+".0.0":c&&(t=">="+n+"."+i+".0 <"+n+"."+(+i+1)+".0"),F("xRange return",t),t})}function E(e,t){return F("replaceStars",e,t),e.trim().replace(B[ve],"")}function S(e,t,r,n,i,o,a,s,u,c,l,f,p){return t=y(r)?"":y(n)?">="+r+".0.0":y(i)?">="+r+"."+n+".0":">="+t,s=y(u)?"":y(c)?"<"+(+u+1)+".0.0":y(l)?"<"+u+"."+(+c+1)+".0":f?"<="+u+"."+c+"."+l+"-"+f:"<="+s,(t+" "+s).trim()}function A(e,t){for(r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length){for(var r=0;r<e.length;r++)if(F(e[r].semver),e[r].semver!==be&&e[r].semver.prerelease.length>0){var n=e[r].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0}function D(e,t,r){try{t=new m(t,r)}catch(e){return!1}return t.test(e)}function C(e,t,r,i){e=new n(e,i),t=new m(t,i);var o,a,c,l,d;switch(r){case">":o=s,a=p,c=u,l=">",d=">=";break;case"<":o=u,a=f,c=s,l="<",d="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(D(e,t,i))return!1;for(var v=0;v<t.set.length;++v){var y=null,g=null;if(t.set[v].forEach(function(e){e.semver===be&&(e=new h(">=0.0.0")),y=y||e,g=g||e,o(e.semver,y.semver,i)?y=e:c(e.semver,g.semver,i)&&(g=e)}),y.operator===l||y.operator===d)return!1;if((!g.operator||g.operator===l)&&a(e,g.semver))return!1;if(g.operator===d&&c(e,g.semver))return!1}return!0}e=t.exports=n;var F;F="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:function(){},e.SEMVER_SPEC_VERSION="2.0.0";var O=256,j=Number.MAX_SAFE_INTEGER||9007199254740991,B=e.re=[],R=e.src=[],P=0,T=P++;R[T]="0|[1-9]\\d*";var I=P++;R[I]="[0-9]+";var L=P++;R[L]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var N=P++;R[N]="("+R[T]+")\\.("+R[T]+")\\.("+R[T]+")";var M=P++;R[M]="("+R[I]+")\\.("+R[I]+")\\.("+R[I]+")";var q=P++;R[q]="(?:"+R[T]+"|"+R[L]+")";var W=P++;R[W]="(?:"+R[I]+"|"+R[L]+")";var $=P++;R[$]="(?:-("+R[q]+"(?:\\."+R[q]+")*))";var U=P++;R[U]="(?:-?("+R[W]+"(?:\\."+R[W]+")*))";var z=P++;R[z]="[0-9A-Za-z-]+";var V=P++;R[V]="(?:\\+("+R[z]+"(?:\\."+R[z]+")*))";var G=P++,H="v?"+R[N]+R[$]+"?"+R[V]+"?";R[G]="^"+H+"$";var J="[v=\\s]*"+R[M]+R[U]+"?"+R[V]+"?",K=P++;R[K]="^"+J+"$";var Y=P++;R[Y]="((?:<|>)?=?)";var Q=P++;R[Q]=R[I]+"|x|X|\\*";var X=P++;R[X]=R[T]+"|x|X|\\*";var Z=P++;R[Z]="[v=\\s]*("+R[X]+")(?:\\.("+R[X]+")(?:\\.("+R[X]+")(?:"+R[$]+")?"+R[V]+"?)?)?";var ee=P++;R[ee]="[v=\\s]*("+R[Q]+")(?:\\.("+R[Q]+")(?:\\.("+R[Q]+")(?:"+R[U]+")?"+R[V]+"?)?)?";var te=P++;R[te]="^"+R[Y]+"\\s*"+R[Z]+"$";var re=P++;R[re]="^"+R[Y]+"\\s*"+R[ee]+"$";var ne=P++;R[ne]="(?:~>?)";var ie=P++;R[ie]="(\\s*)"+R[ne]+"\\s+",B[ie]=new RegExp(R[ie],"g");var oe=P++;R[oe]="^"+R[ne]+R[Z]+"$";var ae=P++;R[ae]="^"+R[ne]+R[ee]+"$";var se=P++;R[se]="(?:\\^)";var ue=P++;R[ue]="(\\s*)"+R[se]+"\\s+",B[ue]=new RegExp(R[ue],"g");var ce=P++;R[ce]="^"+R[se]+R[Z]+"$";var le=P++;R[le]="^"+R[se]+R[ee]+"$";var fe=P++;R[fe]="^"+R[Y]+"\\s*("+J+")$|^$";var pe=P++;R[pe]="^"+R[Y]+"\\s*("+H+")$|^$";var de=P++;R[de]="(\\s*)"+R[Y]+"\\s*("+J+"|"+R[Z]+")",B[de]=new RegExp(R[de],"g");var he=P++;R[he]="^\\s*("+R[Z]+")\\s+-\\s+("+R[Z]+")\\s*$";var me=P++;R[me]="^\\s*("+R[ee]+")\\s+-\\s+("+R[ee]+")\\s*$";var ve=P++;R[ve]="(<|>)?=?\\s*\\*";for(var ye=0;ye<P;ye++)F(ye,R[ye]),B[ye]||(B[ye]=new RegExp(R[ye]));e.parse=r,e.valid=function(e,t){var n=r(e,t);return n?n.version:null},e.clean=function(e,t){var n=r(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null},e.SemVer=n,n.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},n.prototype.toString=function(){return this.version},n.prototype.compare=function(e){return F("SemVer.compare",this.version,this.loose,e),e instanceof n||(e=new n(e,this.loose)),this.compareMain(e)||this.comparePre(e)},n.prototype.compareMain=function(e){return e instanceof n||(e=new n(e,this.loose)),i(this.major,e.major)||i(this.minor,e.minor)||i(this.patch,e.patch)},n.prototype.comparePre=function(e){if(e instanceof n||(e=new n(e,this.loose)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var r=this.prerelease[t],o=e.prerelease[t];if(F("prerelease compare",t,r,o),void 0===r&&void 0===o)return 0;if(void 0===o)return 1;if(void 0===r)return-1;if(r!==o)return i(r,o)}while(++t)},n.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var r=this.prerelease.length;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);-1===r&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},e.inc=function(e,t,r,i){"string"==typeof r&&(i=r,r=void 0);try{return new n(e,r).inc(t,i).version}catch(e){return null}},e.diff=function(e,t){if(c(e,t))return null;var n=r(e),i=r(t);if(n.prerelease.length||i.prerelease.length){for(var o in n)if(("major"===o||"minor"===o||"patch"===o)&&n[o]!==i[o])return"pre"+o;return"prerelease"}for(var o in n)if(("major"===o||"minor"===o||"patch"===o)&&n[o]!==i[o])return o},e.compareIdentifiers=i;var ge=/^[0-9]+$/;e.rcompareIdentifiers=function(e,t){return i(t,e)},e.major=function(e,t){return new n(e,t).major},e.minor=function(e,t){return new n(e,t).minor},e.patch=function(e,t){return new n(e,t).patch},e.compare=o,e.compareLoose=function(e,t){return o(e,t,!0)},e.rcompare=a,e.sort=function(t,r){return t.sort(function(t,n){return e.compare(t,n,r)})},e.rsort=function(t,r){return t.sort(function(t,n){return e.rcompare(t,n,r)})},e.gt=s,e.lt=u,e.eq=c,e.neq=l,e.gte=f,e.lte=p,e.cmp=d,e.Comparator=h;var be={};h.prototype.parse=function(e){var t=this.loose?B[fe]:B[pe],r=e.match(t);if(!r)throw new TypeError("Invalid comparator: "+e);this.operator=r[1],"="===this.operator&&(this.operator=""),r[2]?this.semver=new n(r[2],this.loose):this.semver=be},h.prototype.toString=function(){return this.value},h.prototype.test=function(e){return F("Comparator.test",e,this.loose),this.semver===be||("string"==typeof e&&(e=new n(e,this.loose)),d(e,this.operator,this.semver,this.loose))},e.Range=m,m.prototype.format=function(){return this.range=this.set.map(function(e){return e.join(" ").trim()}).join("||").trim(),this.range},m.prototype.toString=function(){return this.range},m.prototype.parseRange=function(e){var t=this.loose;e=e.trim(),F("range",e,t);var r=t?B[me]:B[he];e=e.replace(r,S),F("hyphen replace",e),e=e.replace(B[de],"$1$2$3"),F("comparator trim",e,B[de]),e=(e=(e=e.replace(B[ie],"$1~")).replace(B[ue],"$1^")).split(/\s+/).join(" ");var n=t?B[fe]:B[pe],i=e.split(" ").map(function(e){return v(e,t)}).join(" ").split(/\s+/);return this.loose&&(i=i.filter(function(e){return!!e.match(n)})),i=i.map(function(e){return new h(e,t)})},e.toComparators=function(e,t){return new m(e,t).set.map(function(e){return e.map(function(e){return e.value}).join(" ").trim().split(" ")})},m.prototype.test=function(e){if(!e)return!1;"string"==typeof e&&(e=new n(e,this.loose));for(var t=0;t<this.set.length;t++)if(A(this.set[t],e))return!0;return!1},e.satisfies=D,e.maxSatisfying=function(e,t,r){return e.filter(function(e){return D(e,t,r)}).sort(function(e,t){return a(e,t,r)})[0]||null},e.minSatisfying=function(e,t,r){return e.filter(function(e){return D(e,t,r)}).sort(function(e,t){return o(e,t,r)})[0]||null},e.validRange=function(e,t){try{return new m(e,t).range||"*"}catch(e){return null}},e.ltr=function(e,t,r){return C(e,t,"<",r)},e.gtr=function(e,t,r){return C(e,t,">",r)},e.outside=C,e.prerelease=function(e,t){var n=r(e,t);return n&&n.prerelease.length?n.prerelease:null},semver=e}({},{});var GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(exports,lively_lang,lively_ast,lively_notifications,lively_vm,lively_resources,lively_classes,semver){"use strict";function install(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.name;(e[t]=lively_lang.fun.wrap(e[t],r)).hookFunc=r,r.hookName=n}function remove$1(e,t,r){for(var n=[],i=e[t];i;)n.push(i),i=i.originalFunction;var o="string"==typeof r?n.find(function(e){return e.hookFunc&&e.hookFunc.hookName===r}):n.find(function(e){return e.hookFunc===r});return!!o&&(lively_lang.arr.remove(n,o),e[t]=n.reduceRight(function(e,t){return lively_lang.fun.wrap(e,t.hookFunc||t)}),!0)}function isInstalled(e,t,r){for(var n=e[t];n;){if(n.hookFunc){if("string"==typeof r&&n.hookFunc.hookName===r)return!0;if(n.hookFunc===r)return!0}n=n.originalFunction}return!1}function computeRequireMap(e){if(e.loads){var t=e.loads;return lively_lang.arr.uniq(Object.keys(loadedModules$1(e)).concat(Object.keys(t))).reduce(function(e,r){var n=t[r]?t[r].depMap:{};return e[r]=Object.keys(n).map(function(e){var t=n[e];return"@empty"===t?t+"/"+e:t}),e},{})}return Object.keys(e._loader.moduleRecords).reduce(function(t,r){return t[r]=e._loader.moduleRecords[r].dependencies.filter(Boolean).map(function(e){return e.name}),t},{})}function prepareNodejsCaching(){var e=System._nodeRequire("fs"),t=System._nodeRequire("path");nodejsCacheDir="/"===process.cwd()?t.join(process.env.HOME,".lively.next"):process.cwd(),e.existsSync(nodejsCacheDir)||e.mkdirSync(nodejsCacheDir)}function prepareCodeForCustomCompile(e,t,r,n,i){t=String(t);var o=n.sourceAccessorName,a=n.recorder,s=n.recorderName,u={topLevelVarRecorder:a,varRecorderName:s,sourceAccessorName:o=o,dontTransform:n.dontTransform,recordGlobals:!0,keepPreviouslyDeclaredValues:!0,declarationWrapperName:n.varDefinitionCallbackName,evalId:n.nextEvalId(),currentModuleAccessor:funcCall(member(funcCall(member(member("__lvVarRecorder","System"),"get"),literal("@lively-env")),"moduleEnv"),literal(r))},c="System.global"===s,l=i?'console.log("[lively.modules] executing module '+r+'");\n':"",f="";c?delete u.declarationWrapperName:(l+='System.get("@lively-env").evaluationStart("'+r+'");\nvar '+s+' = System.get("@lively-env").moduleEnv("'+r+'").recorder;\n\nvar '+o+" = "+JSON.stringify(t)+";\n",f+='\nSystem.get("@lively-env").evaluationEnd("'+r+'");');try{var p=l+lively_vm.evalCodeTransform(t,u)+f;return i&&"undefined"!=typeof $world&&$world.get("log")&&$world.get("log").isText&&($world.get("log").textString=p),{source:p,options:u}}catch(e){return console.error("Error in prepareCodeForCustomCompile of "+r+" "+e.stack),{source:t,options:u}}}function prepareTranslatedCodeForSetterCapture(e,t,r,n,i,o){t=String(t);var a=_extends({},i,{topLevelVarRecorder:n.recorder,varRecorderName:n.recorderName,dontTransform:n.dontTransform,recordGlobals:!0,declarationWrapperName:n.varDefinitionCallbackName,currentModuleAccessor:funcCall(member(funcCall(member(member("__lvVarRecorder","System"),"get"),literal("@lively-env")),"moduleEnv"),literal(r))});n.recorderName;try{var s=lively_vm.evalCodeTransformOfSystemRegisterSetters(t,a);return o&&"undefined"!=typeof $world&&$world.get("log")&&$world.get("log").isText&&($world.get("log").textString+=s),s}catch(e){return console.error("Error in prepareTranslatedCodeForSetterCapture",e.stack),t}}function getCachedNodejsModule(e,t){try{var r=e._nodeRequire("module").Module,n=r._resolveFilename(t.name.replace(/^file:\/\//,""));return r._cache[n]}catch(r){e.debug&&console.log("[lively.modules getCachedNodejsModule] %s unknown to nodejs",t.name)}return null}function addNodejsWrapperSource(e,t){var r=getCachedNodejsModule(e,t);return r?(t.metadata.format="esm",t.source="var exports = System._nodeRequire('"+r.id+"'); export default exports;\n"+lively_lang.properties.allOwnPropertiesOrFunctions(r.exports).map(function(e){return lively_ast.isValidIdentifier(e)?"export var "+e+" = exports['"+e+"'];":'/*ignoring export "'+e+'" b/c it is not a valid identifier*/'}).join("\n"),e.debug&&console.log("[lively.modules customTranslate] loading %s from nodejs module cache",t.name),!0):(e.debug&&console.log("[lively.modules customTranslate] %s not yet in nodejs module cache",t.name),!1)}function instrumentSourceOfEsmModuleLoad(System,load){return System.translate(load).then(function(translated){var parsed=lively_ast.parse(translated),callExpression=parsed.body.find(function(e){return e.expression&&"CallExpression"===e.expression.type&&"register"===e.expression.callee.property.name});if(!callExpression)throw new Error("Cannot find register call in translated source of "+load.name);var registerCall=callExpression.expression,depNames=registerCall.arguments[0].elements.map(function(e){return e.value}),declareFuncNode=registerCall.arguments[1],declareFuncSource=translated.slice(declareFuncNode.start,declareFuncNode.end),declare=eval('var __moduleName = "'+load.name+'";('+declareFuncSource+");\n//# sourceURL="+load.name+"\n");return System.debug&&"undefined"!==$world&&$world.get("log")&&$world.get("log").isText&&($world.get("log").textString=declare),{localDeps:depNames,declare:declare}})}function instrumentSourceOfGlobalModuleLoad(e,t){return e.translate(t).then(function(e){return{translated:e}})}function wrapModuleLoad$1(e){isInstalled(e,"translate","lively_modules_translate_hook")||install(e,"translate",function(t,r){return customTranslate.call(e,t,r)})}function unwrapModuleLoad$1(e){remove$1(e,"translate","lively_modules_translate_hook")}function scheduleModuleExportsChange(e,t,r,n,i){var o=e.get("@lively-env").pendingExportChanges,a=module$2(e,t).record();a&&(r in a.exports||i)&&((o[t]||(o[t]={}))[r]=n)}function runScheduledExportChanges(e,t){var r=e.get("@lively-env").pendingExportChanges[t];r&&(clearPendingModuleExportChanges(e,t),updateModuleExports(e,t,r))}function clearPendingModuleExportChanges(e,t){delete e.get("@lively-env").pendingExportChanges[t]}function updateModuleExports(e,t,r){var n=e.debug;module$2(e,t).updateRecord(function(i){var o=[],a=[];if(Object.keys(r).forEach(function(e){var s=r[e];n&&console.log("[lively.vm es6 updateModuleExports] %s export %s = %s",t,e,String(s).slice(0,30).replace(/\n/g,"")+"...");var u=!(e in i.exports);u&&(i.__lively_modules__.evalOnlyExport[e]=!0),i.exports[e]=s,u?o.push(e):a.push(e)}),o.length){var s=e.get(t);Object.isFrozen(s)?(console.warn("[lively.vm es6 updateModuleExports] Since module %s is frozen a new module object was installed in the system. Note that only(!) exisiting module bindings are updated. New exports that were added will only be available in already loaded modules after those are reloaded!",t),e.set(t,e.newModule(i.exports))):(n&&console.log("[lively.vm es6 updateModuleExports] adding new exports to %s",t),o.forEach(function(e){Object.defineProperty(s,e,{configurable:!1,enumerable:!0,get:function(){return i.exports[e]},set:function(){throw new Error("exports cannot be changed from the outside")}})}))}if(a.length){n&&console.log("[lively.vm es6 updateModuleExports] updating %s dependents of %s",i.importers.length,t);for(var u=0,c=i.importers.length;u<c;u++){var l=i.importers[u];if(!l.locked){var f;if(l.dependencies.some(function(e,t){return f=t,e&&e.name===i.name})){if(n){var p=module$2(e,l.name);console.log("[lively.vm es6 updateModuleExports] calling setters of "+p.package().name+"/"+p.pathInPackage())}module$2(e,l.name).evaluationStart(),l.setters[f](i.exports),module$2(e,l.name).evaluationEnd()}}}}})}function doInstantiateGlobalModule(e,t){var r={name:null,deps:null,originalIndices:null,declare:null,execute:null,executingRequire:!1,declarative:!1,normalizedDeps:null,groupIndex:null,evaluated:!1,module:null,esModule:null,esmExports:!1};r.name=t.name,r.esmExports=!0,t.metadata.entry=r,r.deps=[];for(var n in t.metadata.globals){var i=t.metadata.globals[n];i&&r.deps.push(i)}return r.execute=function(r,n,i){var o=module$2(e,i.id).metadata();(n=o&&o.entry&&o.entry.module&&o.entry.module.exports)&&Object.keys(n).forEach(function(t){try{delete e.global[t]}catch(e){console.warn('[lively.modules] executeGlobalModule: Cannot delete global["'+t+'"]')}});var a;if(t.metadata.globals){a={};for(var s in t.metadata.globals)t.metadata.globals[s]&&(a[s]=r(t.metadata.globals[s]))}var u=t.metadata.exports;u&&(t.source+='\nSystem.global["'+u+'"] = '+u+";");var c=e.get("@@global-helpers").prepareGlobal(module$2.id,u,a);return __evaluateGlobalLoadSource(e,t),c()},runExecuteOfGlobalModule(e,r)}function __createEntry(){return{name:null,deps:null,originalIndices:null,declare:null,execute:null,executingRequire:!1,declarative:!1,normalizedDeps:null,groupIndex:null,evaluated:!1,module:null,esModule:null,esmExports:!1}}function __evaluateGlobalLoadSource(e,t){function r(e,t){0==a++&&(o=s.System),s.System=s.SystemJS=e}function n(){0==--a&&(s.System=s.SystemJS=o),i=void 0}var i,o,a=0,s=e.global;return function(e){try{r(this,e),i=e,(0,eval)(e.source),n()}catch(t){throw n(),new Error("Error evaluating "+e.address+":\n"+t.stack)}}.call(e,t)}function runExecuteOfGlobalModule(e,t){var r={},n=t.module={exports:r,id:t.name};t.evaluated=!0;var i=t.execute.call(e.global,function(r){var n=t.deps.find(function(e){return e===r}),i=n&&e.get(t.normalizedDeps[t.deps.indexOf(n)])||e.get(e.decanonicalize(r,t.name));if(i)return i;throw new Error("Module "+r+" not declared as a dependency of "+t.name)},r,n);i&&(n.exports=i),r=n.exports;var o=e.get("@system-env").constructor;return r&&(r.__esModule||r instanceof o)?t.esModule=r:t.esmExports&&r!==e.global?t.esModule=e.newModule(r):t.esModule={default:r},t}function isURL(e){return/^[^:\\]+:\/\//.test(e)}function urlResolve(e){var t=e.match(/^([^:]+:\/\/)(.*)/);if(!t)return e;var r=t[1],n=t[2],i=n;do{i=(n=i).replace(/\/[^\/]+\/\.\./,"")}while(i!=n);return i=i.replace(/(^|[^:])[\/]+/g,"$1/"),i=i.replace(/\/\.\//g,"/"),r+i}function isAbsolute(e){return e.startsWith("/")||e.startsWith("http:")||e.startsWith("https:")||e.startsWith("file:")||e.match(urlStartRe)}function ensureResource(e){return e.isResource?e:lively_resources.resource(e)}function normalizePackageURL(e,t){if((arguments.length>2&&void 0!==arguments[2]?arguments[2]:[]).some(function(e){return e===t}))return t;var r=e.decanonicalize(t.replace(/[\/]+$/,"")+"/");if(!isURL(r))throw new Error("Strange package URL: "+r+" is not a valid URL");return(r=r.match(/\.js/)?r.indexOf(r+".js")>-1?r.replace(/\.js$/,""):r.split("/").slice(0,-1).join("/"):r).match(/\.js$/)&&console.warn("packageURL is expected to point to a directory but seems to be a .js file: "+r),String(r).replace(/\/$/,"")}function lookupPackage(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=PackageRegistry$$1.ofSystem(e),i=n.allPackageURLs(),o=r?t:normalizePackageURL(e,t,i);return{pkg:n.findPackageWithURL(o),url:o,allPackageURLs:i,registry:n}}function ensurePackage$1(e,t){var r=lookupPackage(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),n=r.pkg,i=r.url,o=r.registry;return n||o.addPackageAt(i,"devPackageDirs")}function getPackage$1(e,t){var r=lookupPackage(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),n=r.pkg,i=r.url;if(n)return n;throw new Error("[getPackage] package "+t+" (as "+i+") not found")}function applyConfig$1(e,t,r){return getPackage$1(e,r).updateConfig(t)}function importPackage$1(e,t){return Promise.resolve(ensurePackage$1(e,t)).then(function(e){return e.import()})}function removePackage$2(e,t){return getPackage$1(e,t).remove()}function reloadPackage$1(e,t,r){return getPackage$1(e,t).reload(r)}function registerPackage$1(e,t,r){return Promise.resolve(ensurePackage$1(e,t)).then(function(e){return e.register(r)})}function getPackageSpecs(e){return Package.allPackages(e).map(function(e){return e.asSpec()})}function module$2(e,t,r){var n=livelySystemEnv(e),i=e.decanonicalize(t,r);return n.loadedModules[i]||(n.loadedModules[i]=new ModuleInterface(e,i))}function isModuleLoaded$1(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=livelySystemEnv(e);return(r?t:e.normalizeSync(t))in n.loadedModules}function livelyProtocol(e,t){var r=t.match(livelyURLRe);if(!r)return e(t);var n=slicedToArray(r,3),i=(n[0],n[1],n[2]);return{read:function(){var e="undefined"!=typeof $world&&$world.getMorphWithId(i);return Promise.resolve(e?e.textString:"/*Could not locate "+i+"*/")},write:function(e){var t="undefined"!=typeof $world&&$world.getMorphWithId(i);return t?(t.textString=e,Promise.resolve(this)):Promise.reject("Could not save morph "+i)}}}function wrapResource(e){e.resource=lively_resources.resource,isInstalled(e,"fetch",fetchResource)&&remove$1(e,"fetch","fetchResource"),install(e,"fetch",fetchResource),isInstalled(e,"resource","livelyProtocol")&&remove$1(e,"fetch","livelyProtocol"),install(e,"resource",livelyProtocol)}function livelySystemEnv(e){return{moduleEnv:function(t){return module$2(e,t)},get itself(){return e.get(e.decanonicalize("lively.modules/index.js"))},evaluationStart:function(t){module$2(e,t).evaluationStart()},evaluationEnd:function(t){module$2(e,t).evaluationEnd()},dumpConfig:function(){return JSON.stringify({baseURL:e.baseURL,transpiler:e.transpiler,defaultJSExtensions:e.defaultJSExtensions,map:e.map,meta:e.meta,packages:e.packages,paths:e.paths,packageConfigPaths:e.packageConfigPaths},null,2)},get packageRegistry(){return e["__lively.modules__packageRegistry"]},set packageRegistry(t){e["__lively.modules__packageRegistry"]=t},packages:e["__lively.modules__packages"]||(e["__lively.modules__packages"]={}),loadedModules:e["__lively.modules__loadedModules"]||(e["__lively.modules__loadedModules"]={}),pendingExportChanges:e["__lively.modules__pendingExportChanges"]||(e["__lively.modules__pendingExportChanges"]={}),notifications:e["__lively.modules__notifications"]||(e["__lively.modules__notifications"]=[]),notificationSubscribers:e["__lively.modules__notificationSubscribers"]||(e["__lively.modules__notificationSubscribers"]={}),options:e["__lively.modules__options"]||(e["__lively.modules__options"]=lively_lang.obj.deepCopy(defaultOptions)),onLoadCallbacks:e["__lively.modules__onLoadCallbacks"]||(e["__lively.modules__onLoadCallbacks"]=[]),modulePackageMapCache:e["__lively.modules__modulePackageMapCache"]}}function systems(){return SystemClass.systems}function nameOfSystem(e){return Object.keys(systems()).detect(function(t){return systems()[t]===e})}function getSystem(e,t){return e&&"string"!=typeof e?e:systems()[e]||(systems()[e]=makeSystem(t))}function removeSystem(e){var t=e&&"string"!=typeof e?nameOfSystem(e):e;delete systems()[t]}function makeSystem(e){return prepareSystem(new SystemClass,e)}function prepareSystem(e,t){e.trace=!0;var r=(t=t||{}).hasOwnProperty("useModuleTranslationCache")?t.useModuleTranslationCache:!urlQuery().noModuleCache;e.useModuleTranslationCache=r,e.set("@lively-env",e.newModule(livelySystemEnv(e)));var n="undefined"!=typeof process&&process.versions&&process.versions.electron;if(n&&e.set("@system-env",e.newModule(_extends({electron:n},e.get("@system-env")))),wrapResource(e),wrapModuleLoad$1(e),isInstalled(e,"normalizeHook")||install(e,"normalize",normalizeHook),isInstalled(e,"decanonicalize","decanonicalizeHook")||install(e,"decanonicalize",decanonicalizeHook),isInstalled(e,"normalizeSync","decanonicalizeHook")||install(e,"normalizeSync",decanonicalizeHook),isInstalled(e,"newModule","newModule_volatile")||install(e,"newModule",newModule_volatile),isInstalled(e,"instantiate","instantiate_triggerOnLoadCallbacks")||install(e,"instantiate",instantiate_triggerOnLoadCallbacks),n){i=["electron"].reduce(function(e,t){return e[t]="@node/"+t,e},{});t.map=lively_lang.obj.merge(i,t.map)}if(isNode){var i=["addons","assert","buffer","child_process","cluster","console","crypto","dgram","dns","domain","events","fs","http","https","module","net","os","path","punycode","querystring","readline","repl","stream","stringdecoder","timers","tls","tty","url","util","v8","vm","zlib"].reduce(function(e,t){return e[t]="@node/"+t,e},{});t.map=lively_lang.obj.merge(i,t.map)}return t.packageConfigPaths=t.packageConfigPaths||["./node_modules/*/package.json"],t.transpiler||"traceur"!==e.transpiler||("lively.transpiler"===initialSystem.transpiler?(e.set("lively.transpiler",initialSystem.get("lively.transpiler")),e._loader.transpilerPromise=initialSystem._loader.transpilerPromise,e.config({transpiler:"lively.transpiler",babelOptions:Object.assign(initialSystem.babelOptions||{},t.babelOptions)})):e.config({map:{"plugin-babel":initialSystem.map["plugin-babel"],"systemjs-babel-build":initialSystem.map["systemjs-babel-build"]},transpiler:initialSystem.transpiler,babelOptions:Object.assign(initialSystem.babelOptions||{},t.babelOptions)})),e.config(t),e}function urlQuery(){return"undefined"!=typeof document&&document.location?(document.location.search||"").replace(/^\?/,"").split("&").reduce(function(query$$1,ea){var split=ea.split("="),key=split[0],value=split[1];return"true"===value||"false"===value?value=eval(value):isNaN(Number(value))||(value=Number(value)),query$$1[key]=value,query$$1},{}):{}}function preNormalize(e,t,r){".."===t&&(t="../index.js"),t=t.replace(doubleSlashRe,function(e){return":"===e[0]?e:e[0]+"/"});var n=e.get("@lively-env").packageRegistry;if(n){var i=r&&n.findPackageHavingURL(r);if(i){var o=i.map,a=i.url,s=o&&o[t]||e.map[t];s&&("object"===(void 0===s?"undefined":_typeof(s))&&(s=normalize_doMapWithObject(s,i,e)),"string"==typeof s&&""!==s&&(t=s),t.startsWith(".")&&(t=urlResolve(join(a,t))))}}if(n){var u=n.resolvePath(t,r);u&&(u.endsWith("/")&&!t.endsWith("/")&&(u=u.slice(0,-1)),!u.endsWith("/")&&t.endsWith("/")&&(u+="/"),t=u)}return t}function postNormalize(e,t,r){var n=t.replace(jsExtRe,"");if(t.endsWith("/"))return t;var i=e.get("@lively-env").packageRegistry;if(i){var o=i.findPackageWithURL(n);if(o){var a=(o.main||"index.js").replace(dotSlashStartRe,"");return s=n.replace(trailingSlashRe,"")+"/"+a}}else if(n in e.packages&&(a=e.packages[n].main)){var s=n.replace(trailingSlashRe,"")+"/"+a.replace(dotSlashStartRe,"");return s}var u=t.match(jsonJsExtRe);return u?u[1]:t}function normalizeHook(e,t,r,n){var i=this,o=preNormalize(i,t,r);return e(o,r,n).then(function(e){var r=postNormalize(i,e||o,!1);return i.debug&&console.log("[normalize] "+t+" => "+r),r})}function decanonicalizeHook(e,t,r,n){var i=this,o=postNormalize(i,e(preNormalize(i,t,r),r,n),!0);return i.debug&&console.log("[normalizeSync] "+t+" => "+o),o}function normalize_doMapWithObject(e,t,r){var n,i=r.get(t.map["@env"]||"@system-env");for(var o in e){var a="~"==o[0],s=function(e,t){for(var r=e.split(".");r.length;)t=t[r.shift()];return t}(a?o.substr(1):o,i);if(!a&&s||a&&!s){n=e[o];break}}if(n&&"string"!=typeof n)throw new Error("Unable to map a package conditional to a package conditional.");return n}function newModule_volatile(e,t){var r=Object.freeze;Object.freeze=function(e){return e};var n=e(t);return Object.freeze=r,n}function printSystemConfig$1(e){var t={baseURL:(e=getSystem(e)).baseURL,transpiler:e.transpiler,defaultJSExtensions:e.defaultJSExtensions,defaultExtension:e.defaultExtension,map:e.map,meta:e.meta,packages:e.packages,paths:e.paths,packageConfigPaths:e.packageConfigPaths,bundles:e.bundles};return JSON.stringify(t,null,2)}function instantiate_triggerOnLoadCallbacks(e,t){var r=this;return e(t).then(function(e){var n={};return lively_lang.promise.waitFor(6e4,function(){return r.get(t.name)},n).then(function(e){if(e!==n){for(var i=t.name,o=module$2(r,i),a=r.get("@lively-env").onLoadCallbacks,s=a.length;s--;){var u=a[s],c=u.moduleName,l=u.resolved,f=u.callback;if((l?c:r.decanonicalize(c))===i){a.splice(s,1);try{f(o)}catch(e){console.error(e)}}}lively_notifications.emit("lively.modules/moduleloaded",{module:t.name},Date.now(),r)}else console.warn("[lively.modules] instantiate_triggerOnLoadCallbacks for "+t.name+" timed out")}),e})}function whenLoaded$2(e,t,r){var n=e.decanonicalize(t);if(e.get(n))try{r(module$2(e,n))}catch(e){console.error(e)}else e.get("@lively-env").onLoadCallbacks.push({moduleName:t,resolved:!1,callback:r})}function loadedModules$1(e){return e.get("@lively-env").loadedModules}function knownModuleNames(e){var t=e.loads?Object.keys(e.loads):Object.keys(e._loader.moduleRecords);return lively_lang.arr.uniq(t.concat(Object.keys(loadedModules$1(e))))}function resolvePackageDependencies(e,t){var r=_extends({},e.dependencies,e.devDependencies);return Object.keys(r).reduce(function(e,n){var i=r[n],o=lively_lang.obj.values(t).find(function(e){var t=e.name,r=e.version;return t===n&&lively.modules.semver.satisfies(r,i)})||{},a=o.name,s=o.version;return e[n]=a?a+"@"+s:void 0,e},{})}function dependencyGraph(e){function t(e,t){var i=e+"@"+t;if(i in n)return n[i];var o=r.find(function(r){var n=r.name,i=r.version;return n===e&&lively.modules.semver.satisfies(i,t)})||{},a=o.name,s=o.version;return n[i]=a?a+"@"+s:void 0}var r=lively_lang.obj.values(e),n={};return Object.keys(e).reduce(function(r,n){var i=e[n],o=_extends({},i.dependencies,i.devDependencies);return r[n]=Object.keys(o).map(function(e){return t(e,o[e])}).filter(function(e){return!!e}),r},{})}function changeSystem(e,t){return exports.System=e,t&&(GLOBAL.System=e),e}function loadedModules$$1(){return Object.keys(requireMap())}function module$1(e){return module$2(exports.System,e)}function isModuleLoaded$$1(e,t){return isModuleLoaded$1(exports.System,e,t)}function doesModuleExist$$1(e,t){return doesModuleExist$1(exports.System,e,t)}function printSystemConfig$$1(){return printSystemConfig$1(exports.System)}function whenLoaded$1(e,t){return whenLoaded$2(exports.System,e,t)}function importPackage$$1(e){return importPackage$1(exports.System,e)}function registerPackage$$1(e,t){return registerPackage$1(exports.System,e,t)}function removePackage$1(e){return removePackage$2(exports.System,e)}function reloadPackage$$1(e,t){return reloadPackage$1(exports.System,e,t)}function getPackages(){return getPackageSpecs(exports.System)}function getPackage$$1(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return getPackage$1(exports.System,e,t)}function getPackageOfModule(e){return Package.forModuleId(exports.System,e)}function ensurePackage$$1(e){return ensurePackage$1(exports.System,e)}function applyPackageConfig(e,t){return applyConfig$1(exports.System,e,t)}function moduleSourceChange$$1(e,t,r){return moduleSourceChange$1(exports.System,e,t,r)}function requireMap(){return computeRequireMap(exports.System)}function isHookInstalled(e,t){return isInstalled(exports.System,e,t)}function installHook(e,t){return install(exports.System,e,t)}function removeHook(e,t){return remove$1(exports.System,e,t)}function wrapModuleLoad$$1(){wrapModuleLoad$1(exports.System)}function unwrapModuleLoad$$1(){unwrapModuleLoad$1(exports.System)}semver="default"in semver?semver.default:semver;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},asyncToGenerator=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),defineProperty=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},get$1=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},set$1=function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var s=o.set;void 0!==s&&s.call(i,n)}return n},slicedToArray=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),customTranslate=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,s,u,c,l,f,p,d,h,m,v,y,g,b,_,w,x,k=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this,i=n.debug,o=r.metadata,!(a=o&&o.hasOwnProperty("instrument")&&!o.instrument||exceptions.some(function(e){return e(r.name)}))){e.next=4;break}return i&&console.log("[lively.modules customTranslate ignoring] %s",r.name),e.abrupt("return",t(r));case 4:if(!isNode$1||!addNodejsWrapperSource(n,r)){e.next=7;break}return i&&console.log("[lively.modules] loaded %s from nodejs cache",r.name),e.abrupt("return",t(r));case 7:if(s=Date.now(),u=detectModuleFormat(r.source,o),c=module$2(n,r.name),l=!1,f="esm"===u,p="cjs"===u,d="global"===u,c.setSource(r.source),e.prev=10,h=n.useModuleTranslationCache,m=n.global.indexedDB,v=h&&String(lively_lang.string.hashCode(r.source)),!(h&&m&&f)){e.next=25;break}return y=n._livelyModulesTranslationCache||(n._livelyModulesTranslationCache=new BrowserModuleTranslationCache),e.next=16,y.fetchStoredModuleSource(r.name);case 16:if(!((g=e.sent)&&g.hash==v&&g.timestamp>=BrowserModuleTranslationCache.earliestDate)){e.next=23;break}if(!g.source){e.next=23;break}return o.format="register",o.deps=[],i&&console.log("[lively.modules customTranslate] loaded %s from browser cache after %sms",r.name,Date.now()-s),e.abrupt("return",Promise.resolve(g.source));case 23:e.next=36;break;case 25:if(!(isNode$1&&h&&f)){e.next=36;break}return y=n._livelyModulesTranslationCache||(n._livelyModulesTranslationCache=new NodeModuleTranslationCache),e.next=29,y.fetchStoredModuleSource(r.name);case 29:if(!((g=e.sent)&&g.hash==v&&g.timestamp>=NodeModuleTranslationCache.earliestDate)){e.next=36;break}if(!g.source){e.next=36;break}return o.format="register",o.deps=[],i&&console.log("[lively.modules customTranslate] loaded %s from filesystem cache after %sms",r.name,Date.now()-s),e.abrupt("return",Promise.resolve(g.source));case 36:e.next=41;break;case 38:e.prev=38,e.t0=e.catch(10),console.error("[lively.modules customTranslate] error reading module translation cache: "+e.t0.stack);case 41:return b={},f?(c.recorderName="__lvVarRecorder",c.recorder===n.global&&c.unloadEnv(),r.metadata.format="esm",_=prepareCodeForCustomCompile(n,r.source,r.name,c,i),b=_.options,w=_.source,r.source=w,r.metadata["lively.modules instrumented"]=!0,l=!0,i&&console.log("[lively.modules] loaded %s as es6 module",r.name)):"global"===r.metadata.format&&(c.recorderName="System.global",c.recorder=n.global,r.metadata.format="global",x=prepareCodeForCustomCompile(n,r.source,r.name,c,i),b=x.options,w=x.source,r.source=w,r.metadata["lively.modules instrumented"]=!0,l=!0,i&&console.log("[lively.modules] loaded %s as instrumented global module",r.name)),l||i&&console.log("[lively.modules] customTranslate ignoring %s b/c don't know how to handle format %s",r.name,r.metadata.format),e.abrupt("return",t(r).then(function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0===t.indexOf("System.register(")&&(i&&console.log("[lively.modules customTranslate] Installing System.register setter captures for %s",r.name),t=prepareTranslatedCodeForSetterCapture(n,t,r.name,c,b,i)),!(isNode$1&&h&&f)){e.next=14;break}return o=n._livelyModulesTranslationCache||(n._livelyModulesTranslationCache=new NodeModuleTranslationCache),e.prev=3,e.next=6,o.cacheModuleSource(r.name,v,t);case 6:i&&console.log("[lively.modules customTranslate] stored cached version in filesystem for %s",r.name),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),console.error("[lively.modules customTranslate] failed storing module cache: "+e.t0.stack);case 12:e.next=25;break;case 14:if(!(h&&m&&f)){e.next=25;break}return o=n._livelyModulesTranslationCache||(n._livelyModulesTranslationCache=new BrowserModuleTranslationCache),e.prev=16,e.next=19,o.cacheModuleSource(r.name,v,t);case 19:i&&console.log("[lively.modules customTranslate] stored cached version for %s",r.name),e.next=25;break;case 22:e.prev=22,e.t1=e.catch(16),console.error("[lively.modules customTranslate] failed storing module cache: "+e.t1.stack);case 25:return i&&console.log("[lively.modules customTranslate] done %s after %sms",r.name,Date.now()-s),e.abrupt("return",t);case 27:case"end":return e.stop()}},e,k,[[3,9],[16,22]])}));return function(t){return e.apply(this,arguments)}}()));case 45:case"end":return e.stop()}},e,this,[[10,38]])}));return function(t,r){return e.apply(this,arguments)}}(),funcCall=lively_ast.nodes.funcCall,member=lively_ast.nodes.member,literal=lively_ast.nodes.literal,isNode$1=System.get("@system-env").node,ModuleTranslationCache=function(){function e(){classCallCheck(this,e)}return createClass(e,[{key:"cacheModuleSource",value:function(e,t,r){throw new Error("not yet implemented")}},{key:"fetchStoredModuleSource",value:function(e){throw new Error("not yet implemented")}},{key:"deleteCachedData",value:function(e){throw new Error("not yet implemented")}}],[{key:"earliestDate",get:function(){return+new Date("Sun Nov 06 2016 16:00:00 GMT-0800 (PST)")}}]),e}(),nodejsCacheDir=null,NodeModuleTranslationCache=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,e),createClass(t,[{key:"ensurePath",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.moduleCacheDir.join(t).exists();case 2:if(!e.sent){e.next=4;break}return e.abrupt("return");case 4:r="",o=!0,a=!1,s=void 0,e.prev=8,u=t.split("/")[Symbol.iterator]();case 10:if(o=(c=u.next()).done){e.next=38;break}return l=c.value,r+=l+"/",n=this.moduleCacheDir.join(r),e.next=16,n.exists();case 16:if(e.sent){e.next=26;break}return e.prev=17,e.next=20,n.mkdir();case 20:e.next=26;break;case 22:if(e.prev=22,e.t0=e.catch(17),"EEXIST"==e.t0.code){e.next=26;break}throw e.t0;case 26:return n=lively_resources.resource("file://"+r+"/package.json"),e.next=29,n.exists();case 29:if(!e.sent){e.next=35;break}return e.next=32,n.read();case 32:return i=e.sent,e.next=35,this.moduleCacheDir.join(r+"/package.json").write(i);case 35:o=!0,e.next=10;break;case 38:e.next=44;break;case 40:e.prev=40,e.t1=e.catch(8),a=!0,s=e.t1;case 44:e.prev=44,e.prev=45,!o&&u.return&&u.return();case 47:if(e.prev=47,!a){e.next=50;break}throw s;case 50:return e.finish(47);case 51:return e.finish(44);case 52:case"end":return e.stop()}},e,this,[[8,40,44,52],[17,22],[45,,47,51]])}));return function(t){return e.apply(this,arguments)}}()},{key:"dumpModuleCache",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=regeneratorRuntime.keys(System._nodeRequire("module").Module._cache);case 1:if((e.t1=e.t0()).done){e.next=16;break}return t=e.t1.value,r=lively_resources.resource("file://"+t),e.next=6,r.exists();case 6:if(!e.sent){e.next=14;break}return e.t2=this,e.t3=t,e.next=11,r.read();case 11:return e.t4=e.sent,e.next=14,e.t2.cacheModuleSource.call(e.t2,e.t3,"NO_HASH",e.t4);case 14:e.next=1;break;case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fetchStoredModuleSource",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t.replace("file://",""),r=t.match(/([^\/]*.)\.js/)[0],n=t.replace(r,""),i=this.moduleCacheDir.join(t),e.next=3,i.exists();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return e.next=7,i.stat();case 7:return o=e.sent,a=o.birthtime,e.next=11,i.read();case 11:return s=e.sent,e.next=14,this.moduleCacheDir.join(n+"/.hash_"+r).read();case 14:return u=e.sent,e.abrupt("return",{source:s,timestamp:a,hash:u});case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cacheModuleSource",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t.replace("file://",""),i=t.match(/([^\/]*.)\.js/)[0],o=t.replace(i,""),e.next=3,this.ensurePath(o);case 3:return e.next=5,this.moduleCacheDir.join(t).write(n);case 5:return e.next=7,this.moduleCacheDir.join(o+"/.hash_"+i).write(r);case 7:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"deleteCachedData",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t.replace("file://",""),r=t.match(/([^\/]*.)\.js/)[0],n=t.replace(r,""),i=this.moduleCacheDir.join(t),e.next=4,i.exists();case 4:if(e.sent){e.next=6;break}return e.abrupt("return",!1);case 6:return e.next=8,i.remove();case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"moduleCacheDir",get:function(){return nodejsCacheDir||prepareNodejsCaching(),lively_resources.resource("file://"+nodejsCacheDir+"/.module_cache/")}}]),t}(ModuleTranslationCache),BrowserModuleTranslationCache=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"lively.modules-module-translation-cache";classCallCheck(this,t);var r=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.version=2,r.sourceCodeCacheStoreName="sourceCodeStore",r.dbName=e,r.db=r.openDb(),r}return inherits(t,e),createClass(t,[{key:"openDb",value:function(){var e=this,t=System.global.indexedDB.open(this.version);return new Promise(function(r,n){t.onsuccess=function(e){r(this.result)},t.onerror=function(e){return n(e.target)},t.onupgradeneeded=function(t){return t.currentTarget.result.createObjectStore(e.sourceCodeCacheStoreName,{keyPath:"moduleId"})}})}},{key:"deleteDb",value:function(){var e=System.global.indexedDB.deleteDatabase(this.dbName);return new Promise(function(t,r){e.onerror=function(e){return r(e.target)},e.onsuccess=function(e){return t(e)}})}},{key:"closeDb",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return t=e.sent,r=t.close(),e.abrupt("return",new Promise(function(e,t){r.onsuccess=function(t){e(this.result)},r.onerror=function(e){return t(e.target.errorCode)}}));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"cacheModuleSource",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var i,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return i=e.sent,e.abrupt("return",new Promise(function(e,a){var s=i.transaction([o.sourceCodeCacheStoreName],"readwrite"),u=s.objectStore(o.sourceCodeCacheStoreName),c=Date.now();u.put({moduleId:t,hash:r,source:n,timestamp:c}),s.oncomplete=e,s.onerror=a}));case 4:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"fetchStoredModuleSource",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return r=e.sent,e.abrupt("return",new Promise(function(e,i){var o=r.transaction([n.sourceCodeCacheStoreName]).objectStore(n.sourceCodeCacheStoreName).get(t);o.onerror=i,o.onsuccess=function(t){return e(o.result)}}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"deleteCachedData",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return r=e.sent,e.abrupt("return",new Promise(function(e,i){var o=r.transaction([n.sourceCodeCacheStoreName],"readwrite").objectStore(n.sourceCodeCacheStoreName).delete(t);o.onerror=i,o.onsuccess=function(t){return e(o.result)}}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(ModuleTranslationCache),node_modulesDir=System.decanonicalize("lively.modules/node_modules/"),exceptions=[function(e){return!e.endsWith(".js")},function(e){return e.endsWith("dist/acorn.js")||e.endsWith("dist/escodegen.browser.js")||e.endsWith("bowser.js")||e.endsWith("TweenMax.min.js")},function(e){return e.endsWith("babel-core/browser.js")||e.endsWith("system.src.js")||e.includes("systemjs-plugin-babel")}],moduleSourceChange$1=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n,i,o){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.debug&&console.log("[module change] "+r+" "+n.slice(0,50).replace(/\n/g,"")+" "+i),i&&"es6"!==i&&"esm"!==i&&"register"!==i&&"defined"!==i){e.next=8;break}return e.next=5,moduleSourceChangeEsm(t,r,n,o);case 5:a=e.sent,e.next=15;break;case 8:if("global"!==i){e.next=14;break}return e.next=11,moduleSourceChangeGlobal(t,r,n,o);case 11:a=e.sent,e.next=15;break;case 14:throw new Error("moduleSourceChange is not supported for module "+r+" with format "+i);case 15:return lively_notifications.emit("lively.modules/modulechanged",{module:r,newSource:n,options:o},Date.now(),t),e.abrupt("return",a);case 19:throw e.prev=19,e.t0=e.catch(0),lively_notifications.emit("lively.modules/modulechanged",{module:r,newSource:n,error:e.t0,options:o},Date.now(),t),e.t0;case 23:case"end":return e.stop()}},e,this,[[0,19]])}));return function(t,r,n,i,o){return e.apply(this,arguments)}}(),moduleSourceChangeEsm=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n,i){var o,a,s,u,c,l,f,p,d,h,m,v,y,g,b,_,w,x;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.debug,a={status:"loading",source:n,name:r,address:r,linkSets:[],dependencies:[],metadata:{format:"esm"}},e.next=3,instrumentSourceOfEsmModuleLoad(t,a);case 3:s=e.sent,u=function(e,r){return scheduleModuleExportsChange(t,a.name,e,r,!0)},c=s.declare(u),o&&console.log("[lively.vm es6] sourceChange of %s with deps",a.name,s.localDeps),l=[],f=!0,p=!1,d=void 0,e.prev=10,h=s.localDeps[Symbol.iterator]();case 12:if(f=(m=h.next()).done){e.next=25;break}return v=m.value,e.next=16,t.normalize(v,a.name);case 16:return y=e.sent,g=module$2(t,y),e.next=20,g.load();case 20:b=e.sent,l.push({name:v,fullname:y,module:g,exports:b});case 22:f=!0,e.next=12;break;case 25:e.next=31;break;case 27:e.prev=27,e.t0=e.catch(10),p=!0,d=e.t0;case 31:e.prev=31,e.prev=32,!f&&h.return&&h.return();case 34:if(e.prev=34,!p){e.next=37;break}throw d;case 37:return e.finish(34);case 38:return e.finish(31);case 39:return(_=t.loads&&t.loads[a.name])&&(_.deps=l.map(function(e){return e.name}),_.depMap=l.reduce(function(e,t){return e[t.name]=t.fullname,e},{}),_.metadata&&_.metadata.entry&&(_.metadata.entry.deps=_.deps,_.metadata.entry.normalizedDeps=l.map(function(e){return e.fullname}),_.metadata.entry.declare=s.declare)),w=module$2(t,a.name),x=w.record(),l.forEach(function(e,t){return w.addDependencyToModuleRecord(e.module,c.setters[t])}),x&&(x.execute=c.execute),l.forEach(function(e,t){return c.setters[t](e.exports)}),e.abrupt("return",c.execute());case 46:case"end":return e.stop()}},e,this,[[10,27,31,39],[32,,34,38]])}));return function(t,r,n,i){return e.apply(this,arguments)}}(),moduleSourceChangeGlobal=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n,i){var o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o={status:"loading",source:n,name:r,address:r,linkSets:[],dependencies:[],metadata:{format:"global"}},t.get(r)){e.next=4;break}return e.next=4,t.import(r);case 4:return e.next=6,instrumentSourceOfGlobalModuleLoad(t,o);case 6:return a=e.sent,o.source=a.translated,s=doInstantiateGlobalModule(t,o),t.delete(r),t.set(s.name,s.esModule),e.abrupt("return",s.module);case 12:case"end":return e.stop()}},e,this)}));return function(t,r,n,i){return e.apply(this,arguments)}}(),ModulePackageMapping=function(){function e(t){classCallCheck(this,e),this.System=t,this._notificationHandlers=null,this.clearCache(),this.subscribeToSystemChanges()}return createClass(e,null,[{key:"forSystem",value:function(e){var t=e["__lively.modules__modulePackageMapCache"];if(t)return t;var r=new this(e);return e["__lively.modules__modulePackageMapCache"]=r,r}}]),createClass(e,[{key:"subscribeToSystemChanges",value:function(){var e=this;if(!this._notificationHandlers){var t=this.System;this._notificationHandlers=[lively_notifications.subscribe("lively.modules/moduleloaded",function(t){return e.addModuleIdToCache(t.module)},t),lively_notifications.subscribe("lively.modules/moduleunloaded",function(t){return e.removeModuleFromCache(t.module)},t),lively_notifications.subscribe("lively.modules/packageregistered",function(t){return e.clearCache()},t),lively_notifications.subscribe("lively.modules/packageremoved",function(t){return e.clearCache()},t)]}}},{key:"unsubscribeFromSystemChanges",value:function(){if(this._notificationHandlers){var e=this.System;lively_notifications.unsubscribe("lively.modules/moduleloaded",this._notificationHandlers[0],e),lively_notifications.unsubscribe("lively.modules/moduleunloaded",this._notificationHandlers[1],e),lively_notifications.unsubscribe("lively.modules/packageregistered",this._notificationHandlers[2],e),lively_notifications.unsubscribe("lively.modules/packageremoved",this._notificationHandlers[3],e),this._notificationHandlers=null}}},{key:"clearCache",value:function(){this._cacheInitialized=!1,this.packageToModule={},this.modulesToPackage={},this.modulesWithoutPackage={}}},{key:"ensureCache",value:function(){var e=this.System,t=this._cacheInitialized,r=this.packageToModule,n=this.modulesToPackage,i=this.modulesWithoutPackage;if(t)return this;for(var o=Package.allPackageURLs(e),a=0;a<o.length;a++)r[o[a]]=[];for(var s=knownModuleNames(e),u=0;u<s.length;u++){for(var c=s[u],l=void 0,f=0;f<o.length;f++){var p=o[f];c.startsWith(p)&&(!l||l.length<p.length)&&(l=p)}l?(r[l].push(c),n[c]=l):i[c]={}}return this._cacheInitialized=!0,this}},{key:"addModuleIdToCache",value:function(e){this.ensureCache();var t=this.packageToModule,r=this.modulesToPackage,n=this.modulesWithoutPackage;if(r[e])return r[e];if(n[e])return null;for(var i=Object.keys(t),o=void 0,a=0;a<i.length;a++){var s=i[a];e.startsWith(s)&&(!o||o.length<s.length)&&(o=s)}return o?((t[o]||(t[o]=[])).push(e),r[e]=o):(n[e]={},null)}},{key:"removeModuleFromCache",value:function(e){if(this._cacheInitialized){var t=this.packageToModule,r=this.modulesToPackage,n=this.modulesWithoutPackage;if(n.hasOwnProperty(e))delete n[e];else{var i=r[e];i&&(delete r[e],t[i]&&lively_lang.arr.remove(t[i],e))}}}},{key:"getPackageURLForModuleId",value:function(e){return this.modulesToPackage[e]||this.addModuleIdToCache(e)}},{key:"getModuleIdsForPackageURL",value:function(e){return this.ensureCache(),this.packageToModule[e]||[]}}]),e}(),join=lively_lang.string.joinPath,PackageConfiguration=function(){function PackageConfiguration(e){classCallCheck(this,PackageConfiguration),this.pkg=e}return createClass(PackageConfiguration,[{key:"applyConfig",value:function(e){var t=this.System,r=this.packageURL,n=this.pkg,i=(e=lively_lang.obj.deepMerge(n.config,e)).name||r.split("/").slice(-1)[0],o=e.version,a=e.systemjs||{},s=e.lively,u=e.main||"index.js";t.config({map:defineProperty({},i,r),packages:defineProperty({},r,_extends({},a,{meta:_extends({"package.json":{format:"json"}},a.meta),configured:!0}))}),t.packages[r].configured=!0;var c=t.getConfig().packages[r]||{};return c.map||(c.map={}),a&&(s&&s.main?u=s.main:a.main&&(u=a.main),this.applySystemJSConfig(a)),u.match(/\.[^\/\.]+/)||(u+=".js"),c.main=u,n.version=o,n.config=e,n._name=i,n.mergeWithConfig(c),s?this.applyLivelyConfig(s):{subPackages:[]}}},{key:"applySystemJSConfig",value:function(e){var t=this.System;e.packageConfigPaths&&(t.packageConfigPaths=lively_lang.arr.uniq(t.packageConfigPaths.concat(e.packageConfigPaths))),e.packages&&t.config({packages:e.packages})}},{key:"applyLivelyConfig",value:function(e){this.applyLivelyConfigMeta(e),this.applyLivelyConfigHooks(e),this.applyLivelyConfigBundles(e)}},{key:"applyLivelyConfigHooks",value:function applyLivelyConfigHooks(livelyConfig){var _this=this;(livelyConfig.hooks||[]).forEach(function(h){try{var f=eval("("+h.source+")");f.name&&isInstalled(_this.System,h.target,f.name)||install(_this.System,h.target,f)}catch(e){console.error("Error installing hook for %s: %s",_this.packageURL,e,h)}})}},{key:"applyLivelyConfigBundles",value:function(e){var t=this;if(!e.bundles)return Promise.resolve();var r=Object.keys(e.bundles).reduce(function(r,n){var i=t.packageURL+"/"+n,o=e.bundles[n].map(function(e){return t.System.decanonicalize(e,t.packageURL+"/")});return r[i]=o,r},{});return this.System.config({bundles:r}),Promise.resolve()}},{key:"applyLivelyConfigMeta",value:function(e){if(e.meta){var t=this.System.getConfig().packages[this.packageURL]||{},r={meta:{},packages:defineProperty({},this.packageURL,t)};Object.keys(e.meta).forEach(function(n){var i=e.meta[n];isURL(n)?r.meta[n]=i:(t.meta||(t.meta={}),t.meta[n]=i)}),this.System.config(r)}}},{key:"System",get:function(){return this.pkg.System}},{key:"packageURL",get:function(){return this.pkg.url}}]),PackageConfiguration}(),urlStartRe=/^[a-z\.-_\+]+:/i,PackageRegistry$$1=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};classCallCheck(this,e),this.System=t,this.packageBaseDirs=r.packageBaseDirs||[],this.devPackageDirs=r.devPackageDirs||[],this.individualPackageDirs=r.individualPackageDirs||[],this._readyPromise=null,this.packageMap={},this._byURL=null}return createClass(e,null,[{key:"ofSystem",value:function(e){var t=e.get("@lively-env").packageRegistry;return t||(t=e["__lively.modules__packageRegistry"]=new this(e)),t}},{key:"forDirectory",value:function(e,t){return new this(e,{packageBaseDirs:[ensureResource(t)]})}},{key:"fromJSON",value:function(e,t){return new this(e).fromJSON(t)}}]),createClass(e,[{key:"resetByURL",value:function(){this._byURL=null}},{key:"allPackageURLs",value:function(){return Object.keys(this.byURL)}},{key:"toJSON",value:function(){function e(e){var r=e.url;return r.startsWith(t.baseURL)?r.slice(t.baseURL.length).replace(/^\//,""):r}var t=this.System,r=this.packageMap,n=this.individualPackageDirs,i=this.devPackageDirs,o=this.packageBaseDirs,a={};for(var s in r){var u=r[s];a[s]={},a[s].latest=u.latest,a[s].versions={};for(var c in u.versions)a[s].versions[c]=u.versions[c].toJSON()}return{packageMap:a,individualPackageDirs:n.map(e),devPackageDirs:i.map(e),packageBaseDirs:o.map(e)}}},{key:"fromJSON",value:function(e){function t(e){return isURL(e)?lively_resources.resource(e):lively_resources.resource(n.baseURL).join(e)}var r={},n=this.System,i=lively_resources.resource(n.baseURL);for(var o in e.packageMap){var a=e.packageMap[o];r[o]={},r[o].latest=a.latest,r[o].versions={};for(var s in a.versions){var u=a.versions[s],c=u.url;isAbsolute(c)||(c=i.join(c).url);var l=new Package.fromJSON(n,_extends({},u,{url:c}));r[o].versions[s]=l}}return this.packageMap=r,this.individualPackageDirs=e.individualPackageDirs.map(t),this.devPackageDirs=e.devPackageDirs.map(t),this.packageBaseDirs=e.packageBaseDirs.map(t),this.resetByURL(),ModulePackageMapping.forSystem(n).clearCache(),this}},{key:"whenReady",value:function(){return this._readyPromise||Promise.resolve()}},{key:"isReady",value:function(){return!this._readyPromise}},{key:"withPackagesDo",value:function(e){for(var t in this.packageMap){var r=this.packageMap[t].versions;for(var n in r)e(r[n])}}},{key:"findPackage",value:function(e){for(var t in this.packageMap){var r=this.packageMap[t].versions;for(var n in r){var i=r[n];if(e(i))return i}}return null}},{key:"filterPackages",value:function(e){var t=[];return this.withPackagesDo(function(r){return e(r)&&t.push(r)}),t}},{key:"allPackages",value:function(){var e=[];for(var t in this.packageMap){var r=this.packageMap[t].versions;for(var n in r)e.push(r[n])}return e}},{key:"sortPackagesByVersion",value:function(e){return e.sort(function(e,t){return semver.compare(e.version,t.version,!0)})}},{key:"matches",value:function(e,t,r){var n=e.name,i=e.version;return n===t&&(!r||!(!semver.validRange(i||"",!0)||!semver.satisfies(i,r,!0)))}},{key:"coversDirectory",value:function(e){e=ensureResource(e).asDirectory();var t=this.packageBaseDirs,r=this.devPackageDirs;if(this.individualPackageDirs.some(function(t){return t.equals(e)}))return"individualPackageDirs";if(r.some(function(t){return t.equals(e)}))return"devPackageDirs";var n=e.parent().parent();return t.some(function(e){return e.equals(n)})?this.allPackages().find(function(t){return ensureResource(t.url).equals(e)})?"packageCollectionDirs":"maybe packageCollectionDirs":null}},{key:"lookup",value:function(e,t){var r=this,n=this.packageMap[e];if(!n)return null;if(!t||"latest"===t)return n.versions[n.latest];if(!semver.validRange(t,!0))throw new Error("PackageRegistry>>lookup of "+e+": Invalid version - "+t);var i=lively_lang.obj.values(n.versions).filter(function(n){return r.matches(n,e,t)});return i.length<=1?i[0]:lively_lang.arr.last(this.sortPackagesByVersion(i))}},{key:"findPackageDependency",value:function(e,t,r){return r||(r=e.dependencies[t]||e.devDependencies[t]),semver.validRange(r,!0)||(r=null),this.lookup(t,r)}},{key:"findPackageWithURL",value:function(e){return e.isResource&&(e=e.url),e.endsWith("/")&&(e=e.slice(0,-1)),this.byURL[e]}},{key:"findPackageHavingURL",value:function(e){e.isResource&&(e=e.url),e.endsWith("/")&&(e=e.slice(0,-1));var t=1/0,r=null,n=this.byURL;for(var i in n)if(0===e.indexOf(i)){var o=e.slice(i.length).length;o>=t||(t=o,r=n[i])}return r}},{key:"findPackageForPath",value:function(e,t){if(isAbsolute(e))return this.findPackageHavingURL(e);if(e.startsWith("."))return null;var r=e.split("/"),n=slicedToArray(r,1)[0];if(!n)return null;var i=n.indexOf("@"),o=void 0;return i>-1&&(o=n.slice(i+1),n=n.slice(0,i)),!o&&t?this.findPackageDependency(t,n):this.lookup(n,o)}},{key:"resolvePath",value:function(e,t){if(isAbsolute(e))return e;var r=t&&t.isPackage||null;if(!r&&t){if(e.startsWith(".")){var n=lively_resources.resource(t);return n.isDirectory()||(n=n.parent()),n.join(e).withRelativePartsResolved().url}r=this.findPackageHavingURL(t)}var i=this.findPackageForPath(e,r);if(!i)return null;var o=e.indexOf("/"),a=-1===o||o===e.length-1?"":e.slice(o);return a?lively_resources.resource(i.url).join(a).url:i.url}},{key:"update",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,i,o,a,s,u,c,l,f,p,d,h,m,v,y,g,b,_,w,x,k,E,S,A,D,C,F,O,j,B,R,P,T,I,L,N=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isReady()){e.next=2;break}return e.abrupt("return",this.whenReady().then(function(){return N.update()}));case 2:t=lively_lang.promise.deferred(),this._readyPromise=t.promise,this.packageBaseDirs=this.packageBaseDirs.map(function(e){return e.asDirectory()}),this.individualPackageDirs=this.individualPackageDirs.map(function(e){return e.asDirectory()}),this.devPackageDirs=this.devPackageDirs.map(function(e){return e.asDirectory()}),r={},e.prev=8,n=!0,i=!1,o=void 0,e.prev=12,a=this.packageBaseDirs[Symbol.iterator]();case 14:if(n=(s=a.next()).done){e.next=77;break}return u=s.value,c=!0,l=!1,f=void 0,e.prev=19,e.next=22,u.dirList(1);case 22:e.t0=Symbol.iterator,p=e.sent[e.t0]();case 24:if(c=(d=p.next()).done){e.next=60;break}return h=d.value,m=!0,v=!1,y=void 0,e.prev=29,e.next=32,h.dirList(1);case 32:e.t1=function(e){return e.isDirectory()},e.t2=Symbol.iterator,g=e.sent.filter(e.t1)[e.t2]();case 35:if(m=(b=g.next()).done){e.next=43;break}return _=b.value,e.next=39,this._discoverPackagesIn(_,r,"packageCollectionDirs");case 39:r=e.sent;case 40:m=!0,e.next=35;break;case 43:e.next=49;break;case 45:e.prev=45,e.t3=e.catch(29),v=!0,y=e.t3;case 49:e.prev=49,e.prev=50,!m&&g.return&&g.return();case 52:if(e.prev=52,!v){e.next=55;break}throw y;case 55:return e.finish(52);case 56:return e.finish(49);case 57:c=!0,e.next=24;break;case 60:e.next=66;break;case 62:e.prev=62,e.t4=e.catch(19),l=!0,f=e.t4;case 66:e.prev=66,e.prev=67,!c&&p.return&&p.return();case 69:if(e.prev=69,!l){e.next=72;break}throw f;case 72:return e.finish(69);case 73:return e.finish(66);case 74:n=!0,e.next=14;break;case 77:e.next=83;break;case 79:e.prev=79,e.t5=e.catch(12),i=!0,o=e.t5;case 83:e.prev=83,e.prev=84,!n&&a.return&&a.return();case 86:if(e.prev=86,!i){e.next=89;break}throw o;case 89:return e.finish(86);case 90:return e.finish(83);case 91:w=!0,x=!1,k=void 0,e.prev=94,E=this.individualPackageDirs[Symbol.iterator]();case 96:if(w=(S=E.next()).done){e.next=104;break}return A=S.value,e.next=100,this._discoverPackagesIn(A,r,"individualPackageDirs");case 100:r=e.sent;case 101:w=!0,e.next=96;break;case 104:e.next=110;break;case 106:e.prev=106,e.t6=e.catch(94),x=!0,k=e.t6;case 110:e.prev=110,e.prev=111,!w&&E.return&&E.return();case 113:if(e.prev=113,!x){e.next=116;break}throw k;case 116:return e.finish(113);case 117:return e.finish(110);case 118:D=!0,C=!1,F=void 0,e.prev=121,O=this.devPackageDirs[Symbol.iterator]();case 123:if(D=(j=O.next()).done){e.next=131;break}return B=j.value,e.next=127,this._discoverPackagesIn(B,r,"devPackageDirs");case 127:r=e.sent;case 128:D=!0,e.next=123;break;case 131:e.next=137;break;case 133:e.prev=133,e.t7=e.catch(121),C=!0,F=e.t7;case 137:e.prev=137,e.prev=138,!D&&O.return&&O.return();case 140:if(e.prev=140,!C){e.next=143;break}throw F;case 143:return e.finish(140);case 144:return e.finish(137);case 145:for(R in r)P=r[R],T=P.pkg,I=P.config,L=P.covered,this.System.debug&&console.log("[PackageRegistry] Adding discovered package "+R+" (from "+L+")"),this._addPackageWithConfig(T,I,R+"/",L);this._updateLatestPackages(),t.resolve(),e.next=153;break;case 150:e.prev=150,e.t8=e.catch(8),t.reject(e.t8);case 153:return e.prev=153,this._readyPromise=null,this.resetByURL(),ModulePackageMapping.forSystem(this.System).clearCache(),e.finish(153);case 158:return e.abrupt("return",this);case 159:case"end":return e.stop()}},e,this,[[8,150,153,158],[12,79,83,91],[19,62,66,74],[29,45,49,57],[50,,52,56],[67,,69,73],[84,,86,90],[94,106,110,118],[111,,113,117],[121,133,137,145],[138,,140,144]])}));return function(){return e.apply(this,arguments)}}()},{key:"addPackageAt",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"individualPackageDirs",l=arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((r=t.isResource?t.url:t).endsWith("/")&&r.slice(0,-1),!this.byURL[r]){e.next=4;break}throw new Error("package in "+r+" already added to registry");case 4:return e.next=6,this._discoverPackagesIn(ensureResource(t).asDirectory(),{},void 0,l);case 6:n=e.sent,e.t0=regeneratorRuntime.keys(n);case 8:if((e.t1=e.t0()).done){e.next=16;break}if(i=e.t1.value,!this.byURL[i]){e.next=12;break}return e.abrupt("continue",8);case 12:o=n[i],a=o.pkg,s=o.config,u=this._addPackageDir(i,c,!0),this._addPackageWithConfig(a,s,i+"/",u),e.next=8;break;case 16:return this.resetByURL(),ModulePackageMapping.forSystem(this.System).clearCache(),this._updateLatestPackages(),e.abrupt("return",this.findPackageWithURL(t));case 20:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"removePackage",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e.url,n=e.name,i=e.version,o=ensureResource(r),a=this.coversDirectory(o);"devPackageDirs"===a?this.devPackageDirs=this.devPackageDirs.filter(function(e){return!e.equals(o)}):"individualPackageDirs"===a&&(this.individualPackageDirs=this.individualPackageDirs.filter(function(e){return!e.equals(o)}));var s=this.packageMap;s[n]&&(delete s[n].versions[i],0===Object.keys(s[n].versions).length&&delete s[n]),this.resetByURL(),ModulePackageMapping.forSystem(this.System).clearCache(),t&&this._updateLatestPackages(e.name)}},{key:"updateNameAndVersionOf",value:function(e,t,r,n,i){var o=this.packageMap;o[t]?o[t].versions[r]||console.warn("[PackageRegistry>>updateNameAndVersionOf] No version entry "+r+" of "+t+" found in registry ("+e.url+")"):console.warn("[PackageRegistry>>updateNameAndVersionOf] "+t+"@"+r+" not found in registry ("+e.url+")"),this._addToPackageMap(e,n,i),o[t]&&o[t].versions[r]&&(delete o[t].versions[r],0===Object.keys(o[t].versions).length&&delete o[t]),this._updateLatestPackages(e.name)}},{key:"_updateLatestPackages",value:function(e){var t=this.packageMap;if(e&&t[e])t[e].latest=lively_lang.arr.last(semver.sort(Object.keys(t[e].versions),!0));else for(var r in t)t[r].latest=lively_lang.arr.last(semver.sort(Object.keys(t[r].versions),!0))}},{key:"_discoverPackagesIn",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var i,o,a,s,u,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isDirectory()){e.next=2;break}return e.abrupt("return",r);case 2:if(i=t.asFile().url,!r.hasOwnProperty(i)){e.next=5;break}return e.abrupt("return",r);case 5:return e.prev=5,o=c&&c[i]||new Package(this.System,i),e.next=9,o.tryToLoadPackageConfig();case 9:return a=e.sent,o.setConfig(a),r[i]={pkg:o,config:a,covered:n},this.System.debug&&(s=a.name,u=a.version,console.log("[lively.modules] package "+s+"@"+u+" discovered in "+t.url)),e.abrupt("return",r);case 16:return e.prev=16,e.t0=e.catch(5),e.abrupt("return",r);case 19:case"end":return e.stop()}},e,this,[[5,16]])}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_addToPackageMap",value:function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!t)throw new Error("Cannot add package without name");r||(r="0.0.0");var i=this.packageMap,o=i[t]||(i[t]={versions:{},latest:null});if(o.versions[r]){var a="Redefining version "+r+" of package "+e.url;if(!n)throw new Error(a+" not allowed");console.warn(a)}o.versions[r]=e}},{key:"_addPackageWithConfig",value:function(e,t,r){return(arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)||this._addPackageDir(r,"individualPackageDirs",!0),e.registerWithConfig(t),this._addToPackageMap(e,e.name,e.version),e}},{key:"_addPackageDir",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"individualPackageDirs",r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e=ensureResource(e).asDirectory(),("packageCollectionDirs"===t||"maybe packageCollectionDirs"===t)&&(this.coversDirectory(e)||"").includes("packageCollectionDirs"))return"packageCollectionDirs";var n=t,i=this[n].concat(e);return this[n]=r?lively_lang.arr.uniqBy(i,function(e,t){return e.equals(t)}):i,n}},{key:"byURL",get:function(){if(!this._byURL){this._byURL={};var e=!0,t=!1,r=void 0;try{for(var n,i=this.allPackages()[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;this._byURL[o.url]=o}}catch(e){t=!0,r=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}}return this._byURL}}]),e}(),Package=function(){function e(t,r,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};classCallCheck(this,e),this.System=t,this.url=r,this.registerProcess=null,this.map={},this.setConfig(o)}return createClass(e,null,[{key:"allPackages",value:function(e){return lively_lang.obj.values(PackageRegistry$$1.ofSystem(e).byURL)}},{key:"allPackageURLs",value:function(e){return PackageRegistry$$1.ofSystem(e).allPackageURLs()}},{key:"forModule",value:function(e,t){return this.forModuleId(e,t.id)}},{key:"forModuleId",value:function(e,t){var r=ModulePackageMapping.forSystem(e).getPackageURLForModuleId(t);return r?getPackage$1(e,r,!0):null}},{key:"fromJSON",value:function(t,r){return new e(t).fromJSON(r)}}]),createClass(e,[{key:"setConfig",value:function(e){this._name=e.name,this.version=e.version,this.dependencies=e.dependencies||{},this.devDependencies=e.devDependencies||{},this.main=e.main||"index.js",this.systemjs=e.systemjs}},{key:"toJSON",value:function(){var e=this.System,t=lively_lang.obj.select(this,["url","_name","version","map","dependencies","devDependencies","main","systemjs"]);return t.url.startsWith(e.baseURL)&&(t.url=t.url.slice(e.baseURL.length).replace(/^\//,"")),t}},{key:"fromJSON",value:function(e){var t=this.System;return this.url=e.url,this._name=e._name,this.version=e.version,this.map=e.map||{},this.main=e.main,this.dependencies=e.dependencies||{},this.devDependencies=e.devDependencies||{},this.systemjs=e.systemjs,isURL(this.url)||(this.url=join(t.baseURL,this.url)),this.registerWithConfig(),this}},{key:"asSpec",value:function(){return _extends({},lively_lang.obj.select(this,["name","main","map","meta","url","address","version"]),{lively:this.config?this.config.lively:void 0,modules:this.modules().map(function(e){return{name:e.id,deps:e.directRequirements().map(function(e){return e.id})}})})}},{key:"path",value:function(){var e=this.System.baseURL;return 0===this.url.indexOf(e)?this.url.slice(e.length):this.url}},{key:"modules",value:function(){var e=this.url,t=this.System;return ModulePackageMapping.forSystem(t).getModuleIdsForPackageURL(e).map(function(e){return module$2(t,e)})}},{key:"resources",value:function(){var t=asyncToGenerator(regeneratorRuntime.mark(function t(r){var n,i,o,a,s,u,c,l=this,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[".git","node_modules",".module_cache","lively.next-node_modules"];return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.System,i=this.url,o=e.allPackageURLs(n),a=o.filter(function(e){return e!==i&&!i.startsWith(e)}),t.next=6,lively_resources.resource(i).dirList("infinity",{exclude:f});case 6:return s=t.sent,u=s.filter(function(e){return!e.isDirectory()&&!a.some(function(t){return e.url.startsWith(t)})}).map(function(e){return e.url}),c=lively_lang.arr.pluck(this.modules(),"id"),r&&(u=u.filter(r)),t.abrupt("return",u.map(function(e){var t=e.replace(i,"").replace(/^\//,"");return{isLoaded:c.includes(e),url:e,nameInPackage:t,package:l}}));case 11:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"hasResource",value:function(e){this.System;var t=this.url;return(e.startsWith(t)?lively_resources.resource(e):lively_resources.resource(t).join(e)).exists()}},{key:"toString",value:function(){return"Package("+this.name+" - "+this.path()+"/)"}},{key:"mergeWithConfig",value:function(e){var t=e=_extends({},e),r=t.name,n=t.map;return r&&(delete e.name,this._name=r),n&&(delete e.map,Object.assign(this.map,n)),Object.assign(this,e),this}},{key:"addMapping",value:function(e,t){this.map[e]=t,this.System.config({packages:defineProperty({},this.url,{map:defineProperty({},e,t)})})}},{key:"tryToLoadPackageConfig",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.System,r=this.url,n=r+"/package.json",t.config({meta:defineProperty({},n,{format:"json"}),packages:defineProperty({},r,{meta:{"package.json":{format:"json"}}})}),t.debug&&console.log("[lively.modules package reading config] %s",n),e.prev=3,e.t0=t.get(n),e.t0){e.next=9;break}return e.next=8,t.import(n);case 8:e.t0=e.sent;case 9:return i=e.t0,lively_lang.arr.pushIfNotIncluded(t.packageConfigPaths,n),e.abrupt("return",i);case 14:return e.prev=14,e.t1=e.catch(3),console.log("[lively.modules package] Unable loading package config %s for package: ",n,e.t1),delete t.meta[n],o=r.split("/").slice(-1)[0],e.abrupt("return",{name:o});case 20:case"end":return e.stop()}},e,this,[[3,14]])}));return function(){return e.apply(this,arguments)}}()},{key:"import",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.register();case 2:return t=this.url,r=this.System,e.t0=module$2,e.t1=r,e.next=8,r.normalize(t);case 8:return e.t2=e.sent,n=(0,e.t0)(e.t1,e.t2),e.next=12,r.import(n.id);case 12:return i=e.sent,e.next=15,lively_lang.promise.waitFor(1e3,function(){return n.isLoaded()});case 15:return e.abrupt("return",i);case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"isRegistering",value:function(){return!!this.registerProcess}},{key:"register",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isRegistering()){e.next=2;break}return e.abrupt("return",this.registerProcess.promise);case 2:if(r=this.System,n=this.url,this.registerProcess=lively_lang.promise.deferred(),i=this.registerProcess.promise,r.debug&&console.log("[lively.modules package register] %s",n),e.prev=6,e.t0=t,e.t0){e.next=12;break}return e.next=11,this.tryToLoadPackageConfig();case 11:e.t0=e.sent;case 12:o=e.t0,a=this.registerWithConfig(o),this.registerProcess.resolve(o),e.next=21;break;case 17:throw e.prev=17,e.t1=e.catch(6),this.registerProcess.reject(e.t1),e.t1;case 21:return e.prev=21,delete this.registerProcess,e.finish(21);case 24:return e.abrupt("return",i);case 25:case"end":return e.stop()}},e,this,[[6,17,21,24]])}));return function(t){return e.apply(this,arguments)}}()},{key:"updateConfig",value:function(e){e=_extends({},this.runtimeConfig,e);var t=this.name,r=this.version,n=e,i=n.name,o=n.version;new PackageConfiguration(this).applyConfig(e),t===e.name&&r===e.version||(console.log("[lively.modules] Updating registry "+t+"@"+r+" => "+i+"@"+o),PackageRegistry$$1.ofSystem(this.System).updateNameAndVersionOf(this,t,r,i,o))}},{key:"registerWithConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.runtimeConfig,t=this.System,r=this.url,n=new PackageConfiguration(this).applyConfig(e),i=join(r,"package.json");return t.get(i)||t.set(i,t.newModule(_extends({},e,{default:e}))),lively_notifications.emit("lively.modules/packageregistered",{package:r},Date.now(),t),n}},{key:"remove",value:function(e){e=_extends({forgetEnv:!0,forgetDeps:!1,unloadModules:!0},e);var t=this.System,r=this.url;r=r.replace(/\/$/,""),e.unloadModules&&this.modules().forEach(function(t){return t.unload(e)}),PackageRegistry$$1.ofSystem(t).removePackage(this);var n=t.getConfig(),i=r+"/package.json";t.delete(String(i)),lively_lang.arr.remove(n.packageConfigPaths||[],i),t.config({meta:defineProperty({},i,{}),packages:defineProperty({},r,{}),packageConfigPaths:n.packageConfigPaths}),delete t.packages[r],lively_notifications.emit("lively.modules/packageremoved",{package:this.url},Date.now(),t)}},{key:"reload",value:function(e){var t=this.System,r=this.url,n=PackageRegistry$$1.ofSystem(t),i=n.coversDirectory(r);return this.remove(e),n.addPackageAt(r,i||"devPackageDirs",defineProperty({},r,this)),this.import()}},{key:"fork",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r||(r=lively_resources.resource(this.url).join("../"+t).withRelativePartsResolved().url),e.next=3,this.changeAddress(r,t,!1);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"rename",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=lively_resources.resource(this.url).join("../"+t).withRelativePartsResolved().url,e.next=3,this.changeAddress(r,t,!0);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"changeAddress",value:function(){var t=asyncToGenerator(regeneratorRuntime.mark(function t(r){var n,i,o,a,s,u,c,l,f,p,d,h,m,v,y,g,b,_,w,x,k,E,S,A,D,C,F,O,j,B,R,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=r.replace(/\/?/,""),n=this.System,i=this.url,o=this.name,a=this.version,t.next=7,this.runtimeConfig;case 7:return s=t.sent,u=lively_resources.resource(i).asDirectory(),c=new e(n,r),t.next=12,lively_resources.resource(r).asDirectory();case 12:return l=t.sent,s.name=P||this.name,f=PackageRegistry$$1.ofSystem(n),p=f.coversDirectory(i),ModulePackageMapping.forSystem(n).clearCache(),n.packages[i]&&(n.packages[r]=n.packages[i],T&&delete n.packages[i]),Object.assign(c,lively_lang.obj.select(this,["_name","map","config"])),t.next=20,l.ensureExistance();case 20:return t.next=22,this.resources(void 0,[]);case 22:t.t0=function(e){return e.url},d=t.sent.map(t.t0),h=this.modules(),m=!0,v=!1,y=void 0,t.prev=28,g=h[Symbol.iterator]();case 30:if(m=(b=g.next()).done){t.next=45;break}if(_=b.value,w=l.join(_.pathInPackage()).url,!T){t.next=38;break}return t.next=36,_.renameTo(w);case 36:t.next=40;break;case 38:return t.next=40,_.copyTo(w);case 40:(x=d.indexOf(_.id))>-1&&d.splice(x,1);case 42:m=!0,t.next=30;break;case 45:t.next=51;break;case 47:t.prev=47,t.t1=t.catch(28),v=!0,y=t.t1;case 51:t.prev=51,t.prev=52,!m&&g.return&&g.return();case 54:if(t.prev=54,!v){t.next=57;break}throw y;case 57:return t.finish(54);case 58:return t.finish(51);case 59:k=!0,E=!1,S=void 0,t.prev=62,A=d[Symbol.iterator]();case 64:if(k=(D=A.next()).done){t.next=72;break}return C=D.value,F=lively_resources.resource(C),O=F.relativePathFrom(u),t.next=69,F.copyTo(l.join(O));case 69:k=!0,t.next=64;break;case 72:t.next=78;break;case 74:t.prev=74,t.t2=t.catch(62),E=!0,S=t.t2;case 78:t.prev=78,t.prev=79,!k&&A.return&&A.return();case 81:if(t.prev=81,!E){t.next=84;break}throw S;case 84:return t.finish(81);case 85:return t.finish(78);case 86:if(!T){t.next=91;break}return t.next=89,this.remove({forgetEnv:!0,forgetDeps:!1});case 89:return t.next=91,u.remove();case 91:if(!P){t.next=112;break}return c.name=P,c.config.name=P,j=lively_resources.resource(r).join("package.json"),t.prev=95,t.next=98,j.exists();case 98:if(!t.sent){t.next=108;break}return t.next=101,j.readJson();case 101:if((B=t.sent).name!==this.name){t.next=106;break}return B.name=P,t.next=106,j.writeJson(B,!0);case 106:(R=n.get(j.url))&&n.set(j.url,n.newModule(_extends({},R,{name:P})));case 108:t.next=112;break;case 110:t.prev=110,t.t3=t.catch(95);case 112:return"individualPackageDirs"!==(p=p||"individualPackageDirs")&&"devPackageDirs"!==p||f._addPackageDir(r,p,!0),f._addPackageWithConfig(c,s,r,p),f.resetByURL(),f._updateLatestPackages(),t.abrupt("return",c);case 118:case"end":return t.stop()}},t,this,[[28,47,51,59],[52,,54,58],[62,74,78,86],[79,,81,85],[95,110]])}));return function(e){return t.apply(this,arguments)}}()},{key:"search",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!i.includeUnloaded){e.next=7;break}return e.next=3,this.resources(function(e){return e.endsWith(".js")},[".git","node_modules","dist",".module_cache","lively.next-node_modules"]);case 3:e.t1=function(e){var t=e.url;return module$2(n.System,t)},e.t0=e.sent.map(e.t1),e.next=8;break;case 7:e.t0=this.modules().filter(function(e){return e.isLoaded()});case 8:return r=e.t0,e.abrupt("return",Promise.all(r.map(function(e){return e.search(t,i).catch(function(t){return console.error("Error searching module "+e.name+":\n"+t.stack),[]})})).then(function(e){return lively_lang.arr.flatten(e,1)}));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"isPackage",get:function(){return!0}},{key:"name",get:function(){if(this._name)return this._name;var e=this.System.get(this.url+"/package.json");return e&&e.name?e.name:lively_lang.arr.last(this.url.replace(/[\/]+$/,"").split("/"))},set:function(e){return this._name=e}},{key:"nameAndVersion",get:function(){return this.name+"@"+this.version}},{key:"address",get:function(){return this.url},set:function(e){return this.url=e}},{key:"runtimeConfig",get:function(){var e=this.name,t=this.version,r=this.dependencies,n=this.devDependencies,i=this.main,o=this.systemjs,a={name:e,version:t,dependencies:r||{},devDependencies:n||{}};return i&&(a.main=i),o&&(a.systemjs=o),a}}]),e}(),ImportInjector=function(){function e(t,r,n,i,o,a,s){classCallCheck(this,e),this.System=t,this.intoModuleId=r,this.intoPackage=n,this.intoModuleSource=i,this.fromModuleId=o.moduleId,this.importData=o,this.alias=a,this.parsed=s||lively_ast.fuzzyParse(i)}return createClass(e,null,[{key:"run",value:function(e,t,r,n,i){return new this(e,t,r,n,i,arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0).run()}}]),createClass(e,[{key:"run",value:function(){var e=this.generateImportStatement(),t=e.standaloneImport,r=e.importedVarName,n=this.existingImportsOfFromModule(),i=n.imports,o=n.importsOfFromModule,a=n.importsOfVar;if(o=this.importsToBeReused(o,a,e),a.length)return{status:"not modified",newSource:this.intoModuleSource,generated:"",importedVarName:"",standaloneImport:t,from:a[0].start,to:a[0].end};if(o.length){var s=this.modifyExistingImport(o,t);if(s)return s}var u=lively_lang.arr.last(i),c=u?u.end:0;return this.insertNewImport(o,t,r,c)}},{key:"importsToBeReused",value:function(e,t,r){return r.isDefault&&(e=e.filter(function(e){return!e.specifiers.some(function(e){return"ImportDefaultSpecifier"==e.type})})),e}},{key:"generateImportStatement",value:function(){var e=this.intoModuleId,t=this.fromModuleId,r=this.importData,n=this.intoPackage,i=this.alias,o="default"===r.exported,a=i||(o?r.local:r.exported),s=!o&&r.exported!==a,u=n&&n.name,c=t,l=r.packageName,f=r.pathInPackage;if(r.isMain)c=l;else if(u===l)try{(c=lively_resources.resource(t).relativePathFrom(lively_resources.resource(e))).startsWith(".")||(c="./"+c)}catch(e){l&&"no group"!==l&&f&&(c=l+"/"+f)}else l&&"no group"!==l&&f&&(c=l+"/"+f);return{isDefault:o,standaloneImport:o?"import "+a+' from "'+c+'";':"import { "+r.exported+(s?" as "+a:"")+' } from "'+c+'";',importedVarName:a}}},{key:"existingImportsOfFromModule",value:function(){var e=this.System,t=this.fromModuleId,r=this.intoModuleId,n=this.importData,i=n.exported,o=n.local,a=this.parsed,s=this.alias,u="default"===i,c=a.body.filter(function(e){return"ImportDeclaration"===e.type}),l=u?s||o:s||i,f=c.filter(function(n){if(!n.source||"string"!=typeof n.source.value)return null;var i=e.decanonicalize(n.source.value,r);return t===i});return{imports:c,importsOfFromModule:f,importsOfVar:f.filter(function(e){return(e.specifiers||[]).some(function(e){return u?"ImportDefaultSpecifier"===e.type&&e.local.name===l:lively_lang.Path("imported.name").get(e)===i&&lively_lang.Path("local.name").get(e)===l})})}}},{key:"modifyExistingImport",value:function(e,t){var r=lively_lang.arr.flatmap(e,function(e){return e.specifiers||[]});if(!r.length)return null;var n=lively_lang.arr.partition(r,function(e){return"ImportDefaultSpecifier"===e.type}),i=slicedToArray(n,2),o=slicedToArray(i[0],1)[0],a=slicedToArray(i[1],1)[0],s=this.alias,u=this.intoModuleSource,c=this.importData,l=c.exported,f=c.local,p="default"===l;if(p?console.assert(!!a,"no ImportSpecifier found"):console.assert(a||o,"at least one kine of specifier is expected"),p){if((v=u.slice(0,a.start).lastIndexOf("{")-1)<0)return null;var d=(s||f)+",",h=u.slice(0,v),m=u.slice(v);return h.endsWith(" ")&&h.endsWith("\n")||(d=" "+d),m.startsWith(" ")||(d+=" "),{status:"modified",newSource:""+h+d+m,generated:d,standaloneImport:t,importedVarName:s||f,from:v,to:v+d.length}}var v=a?a.end:o.end,y=s&&s!==l,g=y?l+" as "+s:l;return d=a?", "+g:", { "+g+" }",{status:"modified",newSource:""+u.slice(0,v)+d+u.slice(v),generated:d,standaloneImport:t,importedVarName:y?s:l,from:v,to:v+d.length}}},{key:"insertNewImport",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e&&e.length&&(n=lively_lang.arr.last(e).end);var i=this.intoModuleSource,o=i.slice(0,n),a=i.slice(n),s=t;return o.length&&!o.endsWith("\n")&&(s="\n"+s),a.length&&!a.startsWith("\n")&&(s+="\n"),{status:"modified",newSource:o+s+a,generated:s,standaloneImport:t,importedVarName:r,from:n,to:n+s.length}}}]),e}(),GlobalInjector=function(){function e(){classCallCheck(this,e)}return createClass(e,null,[{key:"run",value:function(e,t,r){var n=r||lively_ast.fuzzyParse(e,{withComments:!0}),i=n.comments?n.comments.find(function(e){return e.isBlock&&e.text.startsWith("global")}):null,o=i?i.text.replace(/^global\s*/,"").split(",").map(function(e){return e.trim()}).filter(Boolean):[],a=t.filter(function(e){return!o.includes(e)});if(!a.length)return{status:"not modified",newSource:e,generated:"",from:0,to:0};if(!i){var s="/*global "+a.join(",")+"*/\n";return{status:"modified",newSource:s+e,generated:s,from:0,to:s.length}}var u=i.start+"/*".length+i.text.length,c=a.join(",");o.length?c=","+c:i.text.startsWith("global ")||(c=" "+c);var l=u+c.length;return{status:"modified",newSource:e.slice(0,u)+c+e.slice(u),generated:c,from:u,to:l}}}]),e}(),ImportRemover=function(){function e(){classCallCheck(this,e)}return createClass(e,null,[{key:"removeImports",value:function(e,t,r){var n=r||lively_ast.fuzzyParse(e),i=lively_lang.arr.flatmap(n.body,function(e){return"ImportDeclaration"===e.type&&e.specifiers.length?e.specifiers.map(function(t){return{local:t.local,importStmt:e}}):[]}).filter(function(e){return t.some(function(t){return t.local===e.local.name})}),o=i.map(function(e){return{local:e.local.name,from:e.importStmt.source.value}}),a=lively_lang.arr.uniq(i.map(function(e){var t=e.importStmt.specifiers.find(function(t){return e.local===t.local});return lively_lang.arr.remove(e.importStmt.specifiers,t),e.importStmt})).slice().reverse().reduce(function(e,t){var r=e.source,n=e.changes,i=t.start,o=t.end,a=t.specifiers,s=r.slice(0,i),u=r.slice(o),c=r.slice(i,o),l=a.length?lively_ast.stringify(t):"";return l&&l.includes("\n")&&!c.includes("\n")&&(l=l.replace(/\s+/g," ")),r=s+l+u,n=n.concat({replacement:l,start:i,end:o}),{source:r,changes:n}},{source:e,changes:[]});return _extends({},a,{removedImports:o})}},{key:"findUnusedImports",value:function(e){var t="string"==typeof e?lively_ast.fuzzyParse(e):e,r=lively_lang.arr.flatmap(t.body,function(e){return"ImportDeclaration"===e.type&&e.specifiers.length?e.specifiers.map(function(t){return{local:t.local,from:e.source?e.source.value:"",importStmt:e}}):[]}),n=r.map(function(e){return e.local}),i=lively_ast.query.resolveReferences(lively_ast.query.scopes(t)),o=Array.from(i.resolvedRefMap.keys()).filter(function(e){return!n.includes(e)}),a=lively_lang.arr.uniq(o.map(function(e){return e.name}));return r.filter(function(e){return!a.includes(e.local.name)}).map(function(e){return _extends({},e,{local:e.local.name})})}},{key:"removeUnusedImports",value:function(e){var t=lively_ast.fuzzyParse(e);return this.removeImports(e,this.findUnusedImports(t),t)}}]),e}(),detectModuleFormat=function(){var e=/['"]format (esm|es6)['"];/,t=/['"]format cjs['"];/,r=/(^\s*|[}\);\n]\s*)(import\s+(['"]|(\*\s+as\s+)?[^"'\(\)\n;]+\s+from\s+['"]|\{)|export\s+\*\s+from\s+["']|export\s+(\{|default|function|class|var|const|let|async\s+function))/;return function(n,i){return i&&i.format?("es6"==i.format&&i.format,i.format):e.test(n.slice(0,5e3))||!t.test(n.slice(0,5e3))&&r.test(n)?"esm":"global"}}(),doesModuleExist$1=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=livelySystemEnv(t),i=a?r:t.normalizeSync(r),!isModuleLoaded$1(t,i,!0)){e.next=3;break}return e.abrupt("return",!0);case 3:if((o=Package.forModuleId(t,i))&&"no group"!==o.name){e.next=8;break}e.t0=t.resource(i).exists(),e.next=11;break;case 8:return e.next=10,o.hasResource(i);case 10:e.t0=e.sent;case 11:return e.abrupt("return",e.t0);case 12:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),ModuleInterface=function(){function e(t,r){var n=this;if(classCallCheck(this,e),!isURL(r)&&!/^@/.test(r))throw new Error("ModuleInterface constructor called with "+r+" that does not seem to be a fully normalized module id.");this.System=t,this.id=r,this.recorderName="__lvVarRecorder",this.sourceAccessorName="__lvOriginalCode",this._recorder=null,this._source=null,this._ast=null,this._scope=null,this._observersOfTopLevelState=[],this._evaluationsInProgress=0,this._evalId=1,lively_notifications.subscribe("lively.modules/modulechanged",function(e){e.module===n.id&&n.reset()})}return createClass(e,[{key:"fullName",value:function(){return this.id}},{key:"shortName",value:function(){return this.package().name+"/"+this.pathInPackage()}},{key:"source",value:function(){var e=this;return"@empty"===this.id?Promise.resolve(""):this._source?Promise.resolve(this._source):this.System.resource(this.id).read().then(function(t){return e._source=t})}},{key:"setSource",value:function(e){this._source!==e&&(this.reset(),this._source=e)}},{key:"ast",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._ast){e.next=2;break}return e.abrupt("return",this._ast);case 2:return e.t0=lively_ast.parse,e.next=5,this.source();case 5:return e.t1=e.sent,e.abrupt("return",this._ast=(0,e.t0)(e.t1));case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"scope",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._scope){e.next=2;break}return e.abrupt("return",this._scope);case 2:return e.next=4,this.ast();case 4:return t=e.sent,e.abrupt("return",this._scope=lively_ast.query.topLevelDeclsAndRefs(t).scope);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"resolvedScope",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=lively_ast.query,e.next=3,this.scope();case 3:return e.t1=e.sent,e.abrupt("return",this._scope=e.t0.resolveReferences.call(e.t0,e.t1));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"metadata",value:function(){var e=this.System.loads?this.System.loads[this.id]:null;return e?e.metadata:null}},{key:"addMetadata",value:function(e){var t=this.System,r=this.id,n=this.metadata(),i=n?Object.assign(n,e):e;return t.config({meta:defineProperty({},r,i)}),t.meta[r]}},{key:"format",value:function(){var e=this.metadata();return e&&e.format?e.format:this._source?detectModuleFormat(this._source):"global"}},{key:"setFormat",value:function(e){return this.addMetadata({format:e})}},{key:"reset",value:function(){this._source=null,this._ast=null,this._scope=null}},{key:"get",value:function(){var e=this.id;return this.System.get(e)}},{key:"load",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.id,n=this.System,t&&this.addMetadata(t),e.t0=n.get(r),e.t0){e.next=7;break}return e.next=6,n.import(r);case 6:e.t0=e.sent;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"isLoaded",value:function(){return!!this.System.get(this.id)}},{key:"unloadEnv",value:function(){this._recorder=null,this._observersOfTopLevelState=[],delete livelySystemEnv(this.System).loadedModules[this.id]}},{key:"unloadDeps",value:function(e){var t=this;e=lively_lang.obj.merge({forgetDeps:!0,forgetEnv:!0},e),this.dependents().forEach(function(r){t.System.delete(r.id),t.System.loads&&delete t.System.loads[r.id],e.forgetEnv&&r.unloadEnv()})}},{key:"unload",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=_extends({reset:!0,forgetDeps:!0,forgetEnv:!0},t),r=this.System,n=this.id,t.reset&&this.reset(),t.forgetDeps&&this.unloadDeps(t),this.System.delete(n),r.loads&&delete r.loads[n],r.meta&&delete r.meta[n],t.forgetEnv&&this.unloadEnv(),!(i=r._livelyModulesTranslationCache)){e.next=12;break}return e.next=12,i.deleteCachedData(n);case 12:lively_notifications.emit("lively.modules/moduleunloaded",{module:this.id},Date.now(),this.System);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"reload",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=lively_lang.obj.merge({reloadDeps:!0,resetEnv:!0},t),r=[this],t.reloadDeps&&(r=this.dependents().concat(r)),e.next=5,this.unload({forgetDeps:t.reloadDeps,forgetEnv:t.resetEnv});case 5:return e.next=7,Promise.all(r.map(function(e){return e.id!==n.id&&e.load()}));case 7:return e.next=9,this.load();case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"copyTo",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this.System.resource(t),e.next=3,this.source();case 3:return e.t1=e.sent,e.next=6,e.t0.write.call(e.t0,e.t1);case 6:return r=this.System,n=this.recorderName,i=this.sourceAccessorName,o=this._recorder,a=this._source,s=this._ast,u=this._scope,c=this._observersOfTopLevelState,l=module$2(r,t),f=lively_lang.obj.select(this,["_observersOfTopLevelState","_scope","_ast","_source","_recorder","sourceAccessorName","recorderName"]),Object.assign(l,f),r.set(t,r.newModule(r.get(this.id))),e.abrupt("return",l);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"renameTo",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.unload,n=void 0===r||r,i=s.removeFile,o=void 0===i||i,e.next=6,this.copyTo(t);case 6:if(a=e.sent,!n){e.next=10;break}return e.next=10,this.unload({reset:!0,forgetDeps:!1,forgetEnv:!0});case 10:if(!o){e.next=13;break}return e.next=13,this.System.resource(this.id).remove();case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"whenLoaded",value:function(e){if(this.isLoaded())try{e(this)}catch(e){console.error(e)}else livelySystemEnv(this.System).onLoadCallbacks.push({moduleName:this.id,resolved:!0,callback:e})}},{key:"changeSourceAction",value:function(e){var t=this;return Promise.resolve(this.source()).then(function(t){return e(t)}).then(function(e){return t.changeSource(e)})}},{key:"changeSource",value:function(e,t){t=_extends({doSave:!0,doEval:!0},t);var r=this.System,n=this.id,i=this.format(),o=void 0;return this.reset(),Promise.all([t.doSave&&this.System.resource(n).write(e),t.doEval&&moduleSourceChange$1(r,n,e,i,t).then(function(e){return o=e})]).then(function(){return o})}},{key:"addDependencyToModuleRecord",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=this.record(),i=e.record();if(n&&i){var o,a=n.dependencies.some(function(t,r){if(t)return o=r,t&&t.name===e.id});a?i!==n.dependencies[o]&&n.dependencies.splice(o,1,i):n.dependencies.push(i),a&&n.setters[o]||(n.setters[a?o:n.dependencies.length-1]=r);var s;i.importers.some(function(e,r){if(e)return s=r,e&&e.name===t.id})?n!==i.importers[s]&&i.importers.splice(s,1,n):i.importers.push(n)}}},{key:"dependents",value:function(){var e=this;return lively_lang.graph.hull(lively_lang.graph.invert(computeRequireMap(this.System)),this.id).map(function(t){return module$2(e.System,t)})}},{key:"requirements",value:function(){var e=this;return lively_lang.graph.hull(computeRequireMap(this.System),this.id).map(function(t){return module$2(e.System,t)})}},{key:"directRequirements",value:function(){var e=this,t=(this.record()||{}).dependencies||[];return lively_lang.arr.pluck(t.filter(Boolean),"name").map(function(t){return module$2(e.System,t)})}},{key:"define",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments[3],i=this.System,o=this.id,a=this.recorder,s=Symbol.for("lively-object-meta"),u=Symbol.for("lively-module-meta");if("function"!=typeof t||!n||"function"!==n.kind&&"class"!==n.kind||(t[s]=n),t&&t[s]&&!t[u]){var c=this.pathInPackage(),l=this.package();t[u]={package:l?{name:l.name,version:l.version}:{},pathInPackage:c}}return a[e]=t,scheduleModuleExportsChange(i,o,e,t,!1),this.notifyTopLevelObservers(e),(r=r||!this.isEvalutionInProgress())&&runScheduledExportChanges(i,o),t}},{key:"undefine",value:function(e){delete this.recorder[e]}},{key:"subscribeToToplevelDefinitionChanges",value:function(e){return this._observersOfTopLevelState.push(e),e}},{key:"notifyTopLevelObservers",value:function(e){var t=["createOrExtendES6ClassForLively","lively.capturing-declaration-wrapper"],r=this.recorder;lively_lang.arr.include(t,e)||this._observersOfTopLevelState.forEach(function(t){return t(e,r[e])})}},{key:"unsubscribeFromToplevelDefinitionChanges",value:function(e){this._observersOfTopLevelState="string"==typeof e?this._observersOfTopLevelState.filter(function(t){return t.name!==e}):this._observersOfTopLevelState.filter(function(t){return t!==e})}},{key:"evaluationStart",value:function(){this._evaluationsInProgress++}},{key:"evaluationEnd",value:function(){this._evaluationsInProgress--,runScheduledExportChanges(this.System,this.id)}},{key:"nextEvalId",value:function(){return this._evalId++}},{key:"isEvalutionInProgress",value:function(){return this._evaluationsInProgress>0}},{key:"env",value:function(){return this}},{key:"package",value:function(){return Package.forModule(this.System,this)}},{key:"pathInPackage",value:function(){var e=this.package();return e&&0===this.id.indexOf(e.address)?this.id.slice(e.address.length).replace(/^\//,""):this.id}},{key:"imports",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=lively_ast.query,e.next=3,this.scope();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.imports.call(e.t0,e.t1));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"exports",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=lively_ast.query,e.next=3,this.scope();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.exports.call(e.t0,e.t1));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"addImports",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l,f,p,d,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.source();case 2:for(r=e.sent,n=!0,i=!1,o=void 0,e.prev=6,a=t[Symbol.iterator]();!(n=(s=a.next()).done);n=!0)u=s.value,c=module$2(this.System,u.from||u.moduleId),l=c.package(),f={exported:u.exported||u.local,moduleId:c.id,packageName:l.name,packageURL:l.url,pathInPackage:c.pathInPackage()},p=u.local,d=ImportInjector.run(this.System,this.id,this.package(),r,f,p),r=d.newSource,h=d.standAloneImport;e.next=14;break;case 10:e.prev=10,e.t0=e.catch(6),i=!0,o=e.t0;case 14:e.prev=14,e.prev=15,!n&&a.return&&a.return();case 17:if(e.prev=17,!i){e.next=20;break}throw o;case 20:return e.finish(17);case 21:return e.finish(14);case 22:return e.next=24,this.changeSource(r);case 24:case"end":return e.stop()}},e,this,[[6,10,14,22],[15,,17,21]])}));return function(t){return e.apply(this,arguments)}}()},{key:"addGlobalDeclaration",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.source();case 2:if(r=e.sent,n=GlobalInjector.run(r,t),i=n.status,o=n.newSource,!(a="modified"===i)){e.next=10;break}return e.next=10,this.changeSource(o);case 10:return e.abrupt("return",a);case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"removeImports",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.source();case 4:return r=e.sent,e.next=7,ImportRemover.removeImports(r,t);case 7:return n=e.sent,i=n.source,o=n.removedImports,e.next=12,this.changeSource(i);case 12:o.forEach(function(e){return delete a.recorder[e.local]});case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_localDeclForRefAt",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolvedScope();case 2:return r=e.sent,n=lively_ast.query.refWithDeclAt(t,r),e.abrupt("return",n&&{decl:n.decl,id:n.declId,declModule:this});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_localDeclForName",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolvedScope();case 2:r=e.sent,n=void 0,i=!0,o=!1,a=void 0,e.prev=7,s=r.resolvedRefMap.values()[Symbol.iterator]();case 9:if(i=(u=s.next()).done){e.next=18;break}if(c=u.value,l=c.ref.name,t!==l){e.next=15;break}return n=c,e.abrupt("break",18);case 15:i=!0,e.next=9;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(7),o=!0,a=e.t0;case 24:e.prev=24,e.prev=25,!i&&s.return&&s.return();case 27:if(e.prev=27,!o){e.next=30;break}throw a;case 30:return e.finish(27);case 31:return e.finish(24);case 32:return e.abrupt("return",n&&{decl:n.decl,id:n.declId,declModule:this});case 33:case"end":return e.stop()}},e,this,[[7,20,24,32],[25,,27,31]])}));return function(t){return e.apply(this,arguments)}}()},{key:"_importForNSRefAt",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolvedScope();case 2:if(r=e.sent,n=r.node,!((i=lively_ast.query.nodesAtIndex(n,t)).length<2)){e.next=7;break}return e.abrupt("return",[null,null]);case 7:if(o=i[i.length-1],a=i[i.length-2],"Identifier"==o.type&&"MemberExpression"==a.type&&!a.computed&&"Identifier"===a.object.type){e.next=10;break}return e.abrupt("return",[null,null]);case 10:if(s=r.resolvedRefMap.get(a.object)||{},(u=s.decl)&&"ImportDeclaration"===u.type){e.next=13;break}return e.abrupt("return",[null,null]);case 13:return c=a.object.name,l=u.specifiers.find(function(e){return e.local.name===c}),e.abrupt("return","ImportNamespaceSpecifier"!==l.type?[null,null]:[u,l.local,o.name]);case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_resolveImportedDecl",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",[]);case 2:return r=t.id,n=r.start,i=r.name,o=r.type,e.next=8,this.imports();case 8:if(a=e.sent,!(s=a.find(function(e){return e.local==i}))){e.next=17;break}return u=module$2(this.System,s.fromModule,this.id),e.t0=[t],e.next=15,u.bindingPathForExport(s.imported);case 15:return e.t1=e.sent,e.abrupt("return",e.t0.concat.call(e.t0,e.t1));case 17:return e.abrupt("return",[t]);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"bindingPathFor",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._localDeclForName(t);case 2:if(!(r=e.sent)){e.next=7;break}return e.next=6,this._resolveImportedDecl(r);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"bindingPathForExport",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolvedScope();case 2:return e.next=4,this.exports();case 4:if(r=e.sent,!(n=r.find(function(e){return e.exported===t})).fromModule){e.next=17;break}return i=module$2(this.System,n.fromModule,this.id),o={decl:n.node,id:n.declId},o.declModule=this,e.t0=[o],e.next=13,i.bindingPathForExport(n.imported);case 13:return e.t1=e.sent,e.abrupt("return",e.t0.concat.call(e.t0,e.t1));case 17:return e.abrupt("return",this._resolveImportedDecl({decl:n.decl,id:n.declId,declModule:n&&n.decl?this:null}));case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"bindingPathForRefAt",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._localDeclForRefAt(t);case 2:if(!(r=e.sent)){e.next=7;break}return e.next=6,this._resolveImportedDecl(r);case 6:return e.abrupt("return",e.sent);case 7:return e.next=9,this._importForNSRefAt(t);case 9:if(n=e.sent,i=slicedToArray(n,3),o=i[0],a=i[1],s=i[2],o){e.next=16;break}return e.abrupt("return",[]);case 16:return u=module$2(this.System,o.source.value,this.id),e.t0=[{decl:o,declModule:this,id:a}],e.next=20,u.bindingPathForExport(s);case 20:return e.t1=e.sent,e.abrupt("return",e.t0.concat.call(e.t0,e.t1));case 22:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"definitionForRefAt",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bindingPathForRefAt(t);case 2:return r=e.sent,e.abrupt("return",r.length<1?null:r[r.length-1].decl);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"ensureRecord",value:function(){var e=this.System,t=e._loader.moduleRecords;return t[this.id]?t[this.id]:t[this.id]={name:this.id,exports:e.newModule({}),dependencies:[],importers:[],setters:[]}}},{key:"record",value:function(){var e=this.System._loader.moduleRecords[this.id];return e?(e.hasOwnProperty("__lively_modules__")||(e.__lively_modules__={evalOnlyExport:{}}),e):null}},{key:"updateRecord",value:function(e){var t=this.record();if(!t)throw new Error("es6 environment global of "+this.id+": module not loaded, cannot get export object!");t.locked=!0;try{return e(t)}finally{t.locked=!1}}},{key:"search",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,s,u,c,l,f,p,d,h,m,v,y=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=_extends({excludedModules:[]},r)).excludedModules.some(function(e){return"string"==typeof e?e===y.id:e instanceof RegExp?e.test(y.id):"function"==typeof e&&e(y.id)})){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,this.source();case 5:for(n=e.sent,i=void 0,t instanceof RegExp?(o="g",t.ignoreCase&&(o+="i"),t.multiline&&(o+="m"),i=RegExp(t.source,o)):i=RegExp(t,"g"),a=void 0,s=[];null!==(a=i.exec(n));)s.push([a.index,a[0].length]);u=0,c=0,l=1,f=0;case 11:if(!(u<n.length&&c<s.length)){e.next=24;break}if("\n"==n[u]&&(l++,f=u+1),p=slicedToArray(s[c],2),d=p[0],h=p[1],u===d){e.next=16;break}return e.abrupt("continue",21);case 16:-1===(m=n.slice(f).indexOf("\n"))?m=n.length:m+=f,v=this.package(),s[c]={moduleId:this.id,packageName:v?v.name:void 0,pathInPackage:v?this.pathInPackage():this.id,isLoaded:this.isLoaded(),length:h,line:l,column:u-f,lineString:n.slice(f,m)},c++;case 21:u++,e.next=11;break;case 24:return e.abrupt("return",s);case 25:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"toString",value:function(){return"module("+this.id+")"}},{key:"dontTransform",get:function(){return[this.recorderName,this.sourceAccessorName,"global","self","_moduleExport","_moduleImport","localStorage","prompt","alert","fetch","getComputedStyle"].concat(lively_ast.query.knownGlobals)}},{key:"recorder",set:function(e){return this._recorder=e},get:function(){var e;if(this._recorder)return this._recorder;var t=this.System,r=this;return this._recorder=Object.create(t.global,(e={System:{configurable:!0,writable:!0,value:t},__currentLivelyModule:{value:r}},defineProperty(e,lively_vm.defaultClassToFunctionConverterName,{configurable:!0,writable:!0,value:lively_classes.runtime.initializeClass}),defineProperty(e,this.varDefinitionCallbackName,{value:function(e,t,n,i,o){return o=o||{},o.kind=t,r.define(e,n,!1,o)}}),defineProperty(e,"_moduleExport",{value:function(e,n){scheduleModuleExportsChange(t,r.id,e,n,!0)}}),defineProperty(e,"_moduleImport",{value:function(e,n){var i=t.decanonicalize(e,r.id),o=t.get(i);if(o)return r.addDependencyToModuleRecord(module$2(t,i),function(e){return Object.assign(r.recorder,e)}),void 0==n?o:(o.hasOwnProperty(n)||console.warn("import from "+o+": Has no export "+n+"!"),o[n]);console.warn("import of "+n+" failed: "+e+" (tried as "+r.id+") is not loaded!")}}),e))}},{key:"varDefinitionCallbackName",get:function(){return"defVar_"+this.id}}]),e}(),fetchResource=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this,i=n.resource(r.name)){e.next=3;break}return e.abrupt("return",t(r));case 3:return e.prev=3,e.next=6,i.read();case 6:o=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),a=e.t0;case 12:if(!a||!n.get("@system-env").browser){e.next=24;break}if(s=i.url.startsWith("http"),u=!i.url.startsWith(document.location.origin),!s||!u){e.next=24;break}return e.prev=15,e.next=18,i.makeProxied().read();case 18:o=e.sent,a=null,e.next=24;break;case 22:e.prev=22,e.t1=e.catch(15);case 24:if(!a){e.next=26;break}throw a;case 26:return e.abrupt("return",o);case 27:case"end":return e.stop()}},e,this,[[3,9],[15,22]])}));return function(t,r){return e.apply(this,arguments)}}(),livelyURLRe=/^lively:\/\/([^\/]+)\/(.*)$/,isNode=System.get("@system-env").node,initialSystem=initialSystem||System,SystemClass=System.constructor;SystemClass.systems||(SystemClass.systems={});var defaultOptions={notificationLimit:null},dotSlashStartRe=/^\.?\//,trailingSlashRe=/\/$/,jsExtRe=/\.js$/,jsonJsExtRe=/\.json\.js$/i,doubleSlashRe=/.\/{2,}/g,ExportLookup=function(){function e(t){classCallCheck(this,e),this.System=t,this.subscribeToSystemChanges()}return createClass(e,null,[{key:"forSystem",value:function(e){this._forSystemMap||(this._forSystemMap=new WeakMap);var t=this._forSystemMap.get(e);return t||(t=new this(e),this._forSystemMap.set(e,t),t)}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:System,t=arguments[1];return this.forSystem(e).systemExports(t)}},{key:"findExportOfValue",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:System;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.run(n);case 2:return r=e.sent,e.abrupt("return",r.find(function(e){var r=e.local,i=e.moduleId,o=module$2(n,i),a=o.recorder||n.get(o.id)||{};try{return a[r]===t}catch(e){return!1}}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),createClass(e,[{key:"subscribeToSystemChanges",value:function(){var e=this;if(!this._notificationHandlers){var t=this.System;this._notificationHandlers=[lively_notifications.subscribe("lively.modules/moduleloaded",function(t){return e.clearCacheFor(t.module)},t),lively_notifications.subscribe("lively.modules/modulechanged",function(t){return e.clearCacheFor(t.module)},t),lively_notifications.subscribe("lively.vm/doitresult",function(t){return e.clearCacheFor(t.targetModule)},t)]}}},{key:"unsubscribeFromSystemChanges",value:function(){if(this._notificationHandlers){var e=this.System;lively_notifications.unsubscribe("lively.modules/moduleloaded",this._notificationHandlers[0],e),lively_notifications.unsubscribe("lively.modules/modulechanged",this._notificationHandlers[1],e),lively_notifications.unsubscribe("lively.vm/doitresult",this._notificationHandlers[2],e),this._notificationHandlers=null}}},{key:"clearCacheFor",value:function(e){this.exportByModuleCache[e]=null}},{key:"systemExports",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.rawExportsByModule(t);case 2:return r=e.sent,Object.keys(r).forEach(function(e){return n.resolveExportsOfModule(e,r)}),e.abrupt("return",lively_lang.arr.flatmap(Object.keys(r),function(e){return r[e].resolvedExports||r[e].rawExports}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"rawExportsByModule",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},r=this.System,n=r.get("@lively-env")||{},i=Object.keys(n.loadedModules||{}),o=this.exportByModuleCache,a={},e.next=4,Promise.all(i.map(function(e){return s.rawExportsOfModule(e,t,a).then(function(t){return t?a[e]=t:null})}));case 4:return e.abrupt("return",a);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"rawExportsOfModule",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l,f,p,d,h,m,v,y,g,b,_,w,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.System,n=this.exportByModuleCache,i=x.excludedPackages||[],o=x.excludedURLs||(x.excludedURLs=i.filter(function(e){return"string"==typeof e})),a=x.excludeFns||(x.excludeFns=i.filter(function(e){return"function"==typeof e})),s=x.excludedPackageURLs||(x.excludedPackageURLs=o.concat(o.map(function(e){return r.decanonicalize(e.replace(/\/?$/,"/")).replace(/\/$/,"")}))),u=x.livelyEnv||(x.livelyEnv=r.get("@lively-env")||{}),c=x.modes||(x.modes=Object.keys(u.loadedModules||{})),!n[t]){e.next=4;break}return l=n[t].rawExports,e.abrupt("return",s.includes(l.packageURL)||a.some(function(e){return e(l.packageURL)})?null:n[t]);case 4:if(f=module$2(r,t),p=f.pathInPackage(),d=f.package(),h=d&&d.main&&p===d.main,m=d?d.url:"",v=d?d.name:"",y=d?d.version:"",g={moduleId:t,isMain:h,pathInPackage:p,packageName:v,packageURL:m,packageVersion:y,exports:[]},!s.includes(m)&&!a.some(function(e){return e(m)})){e.next=7;break}return e.abrupt("return",null);case 7:if(e.prev=7,b=f.format(),!["register","es6","esm"].includes(b)){e.next=15;break}return e.next=12,f.exports();case 12:g.exports=e.sent,e.next=27;break;case 15:return e.next=17,f.load();case 17:_=e.sent,g.exports=[],e.t0=regeneratorRuntime.keys(_);case 20:if((e.t1=e.t0()).done){e.next=27;break}if("__useDefault"!==(w=e.t1.value)&&"default"!==w){e.next=24;break}return e.abrupt("continue",20);case 24:g.exports.push({exported:w,local:w,type:"id"}),e.next=20;break;case 27:e.next=32;break;case 29:e.prev=29,e.t2=e.catch(7),g.error=e.t2;case 32:return e.abrupt("return",n[t]={rawExports:g});case 33:case"end":return e.stop()}},e,this,[[7,29]])}));return function(t){return e.apply(this,arguments)}}()},{key:"resolveExportsOfModule",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!n[e]){n[e]=!0;var i=t[e];if(i&&!i.resolvedExports){var o=this.System,a=lively_lang.obj.select(i.rawExports,["moduleId","isMain","packageName","packageURL","packageVersion","pathInPackage"]);i.resolvedExports=lively_lang.arr.flatmap(i.rawExports.exports,function(i){var s=i.type,u=i.exported,c=i.local,l=i.fromModule;if("all"!==s)return[_extends({},a,{type:s,exported:u,local:c,fromModule:l})];var f=o.decanonicalize(l,e);return r.resolveExportsOfModule(f,t,n),(t[f].resolvedExports||[]).map(function(e){var t=e.type,r=e.exported,n=e.local,i=e.fromModule;return _extends({},a,{type:t,exported:r,local:n,fromModule:i||l})})}),n[e]=!1}}}},{key:"exportByModuleCache",get:function(){return this._exportByModuleCache||(this._exportByModuleCache={})}}]),e}(),buildPackageMap=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l,f,p,d,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{maxDepth:0,excludes:[]},m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=h.maxDepth,n=h.excludes,!(r>0&&v>r)){e.next=3;break}return e.abrupt("return",m);case 3:return e.prev=3,e.t0=JSON,e.next=7,lively_resources.resource(t).join("package.json").read();case 7:if(e.t1=e.sent,i=e.t0.parse.call(e.t0,e.t1),o=i.name+"@"+i.version,!m[o]&&!n.includes(i.name)){e.next=12;break}return e.abrupt("return",m);case 12:m[o]=_extends({url:t},lively_lang.obj.select(i,["name","version","dependencies","devDependencies","main"])),e.next=18;break;case 15:return e.prev=15,e.t2=e.catch(3),e.abrupt("return",m);case 18:return e.prev=18,e.next=21,lively_resources.resource(t).join("node_modules").dirList(1);case 21:a=e.sent,e.next=27;break;case 24:return e.prev=24,e.t3=e.catch(18),e.abrupt("return",m);case 27:s=!0,u=!1,c=void 0,e.prev=30,l=a[Symbol.iterator]();case 32:if(s=(f=l.next()).done){e.next=41;break}return p=f.value,d=p.url,e.next=37,buildPackageMap(d,h,m,v+1);case 37:m=e.sent;case 38:s=!0,e.next=32;break;case 41:e.next=47;break;case 43:e.prev=43,e.t4=e.catch(30),u=!0,c=e.t4;case 47:e.prev=47,e.prev=48,!s&&l.return&&l.return();case 50:if(e.prev=50,!u){e.next=53;break}throw c;case 53:return e.finish(50);case 54:return e.finish(47);case 55:return e.abrupt("return",m);case 56:case"end":return e.stop()}},e,this,[[3,15],[18,24],[30,43,47,55],[48,,50,54]])}));return function(t){return e.apply(this,arguments)}}(),dependencies=Object.freeze({buildPackageMap:buildPackageMap,resolvePackageDependencies:resolvePackageDependencies,dependencyGraph:dependencyGraph}),GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:void 0;exports.System=exports.System||prepareSystem(GLOBAL.System),exports.getSystem=getSystem,exports.removeSystem=removeSystem,exports.loadedModules=loadedModules$$1,exports.printSystemConfig=printSystemConfig$$1,exports.whenLoaded=whenLoaded$1,exports.changeSystem=changeSystem,exports.module=module$1,exports.doesModuleExist=doesModuleExist$$1,exports.isModuleLoaded=isModuleLoaded$$1,exports.importPackage=importPackage$$1,exports.registerPackage=registerPackage$$1,exports.removePackage=removePackage$1,exports.reloadPackage=reloadPackage$$1,exports.getPackages=getPackages,exports.getPackage=getPackage$$1,exports.getPackageOfModule=getPackageOfModule,exports.ensurePackage=ensurePackage$$1,exports.applyPackageConfig=applyPackageConfig,exports.moduleSourceChange=moduleSourceChange$$1,exports.requireMap=requireMap,exports.isHookInstalled=isHookInstalled,exports.installHook=installHook,exports.removeHook=removeHook,exports.wrapModuleLoad=wrapModuleLoad$$1,exports.unwrapModuleLoad=unwrapModuleLoad$$1,exports.cjs=dependencies,exports.PackageRegistry=PackageRegistry$$1,exports.ExportLookup=ExportLookup,exports.semver=semver}(this.lively.modules=this.lively.modules||{},lively.lang,lively.ast,lively.notifications,lively.vm,lively.resources,lively.classes,semver),"undefined"!=typeof module&&"function"==typeof require&&(module.exports=GLOBAL.lively.modules)}();