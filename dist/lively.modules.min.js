!function(e){"use strict";function t(e,t,r,i){var o=Object.create((t||n).prototype),a=new p(i||[]);return o._invoke=c(e,r,a),o}function r(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function n(){}function i(){}function o(){}function a(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function s(e){this.arg=e}function u(e){function t(t,r){var o=e[t](r),a=o.value;return a instanceof s?Promise.resolve(a.arg).then(n,i):Promise.resolve(a).then(function(e){return o.value=e,o})}"object"==typeof process&&process.domain&&(t=process.domain.bind(t));var r,n=t.bind(e,"next"),i=t.bind(e,"throw");t.bind(e,"return");this._invoke=function(e,n){function i(){return t(e,n)}return r=r?r.then(i,i):new Promise(function(e){e(i())})}}function c(e,t,n){var i=_;return function(o,a){if(i===w)throw new Error("Generator is already running");if(i===k){if("throw"===o)throw a;return d()}for(;;){var s=n.delegate;if(s){if("return"===o||"throw"===o&&s.iterator[o]===m){n.delegate=null;var u=s.iterator.return;if(u&&"throw"===(c=r(u,s.iterator,a)).type){o="throw",a=c.arg;continue}if("return"===o)continue}if("throw"===(c=r(s.iterator[o],s.iterator,a)).type){n.delegate=null,o="throw",a=c.arg;continue}if(o="next",a=m,!(l=c.arg).done)return i=x,l;n[s.resultName]=l.value,n.next=s.nextLoc,n.delegate=null}if("next"===o)n._sent=a,n.sent=i===x?a:m;else if("throw"===o){if(i===_)throw i=k,a;n.dispatchException(a)&&(o="next",a=m)}else"return"===o&&n.abrupt("return",a);i=w;var c=r(e,t,n);if("normal"===c.type){i=n.done?k:x;var l={value:c.arg,done:n.done};if(c.arg!==E)return l;n.delegate&&"next"===o&&(a=m)}else"throw"===c.type&&(i=k,o="throw",a=c.arg)}}}function l(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function f(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function p(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(l,this),this.reset(!0)}function h(e){if(e){var t=e[y];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(v.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=m,t.done=!0,t};return n.next=n}}return{next:d}}function d(){return{value:m,done:!0}}var m,v=Object.prototype.hasOwnProperty,y="function"==typeof Symbol&&Symbol.iterator||"@@iterator",g="object"==typeof module,b=e.regeneratorRuntime;if(b)g&&(module.exports=b);else{(b=e.regeneratorRuntime=g?module.exports:{}).wrap=t;var _="suspendedStart",x="suspendedYield",w="executing",k="completed",E={},S=o.prototype=n.prototype;i.prototype=S.constructor=o,o.constructor=i,i.displayName="GeneratorFunction",b.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===i||"GeneratorFunction"===(t.displayName||t.name))},b.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,o):e.__proto__=o,e.prototype=Object.create(S),e},b.awrap=function(e){return new s(e)},a(u.prototype),b.async=function(e,r,n,i){var o=new u(t(e,r,n,i));return b.isGeneratorFunction(r)?o:o.next().then(function(e){return e.done?e.value:o.next()})},a(S),S[y]=function(){return this},S.toString=function(){return"[object Generator]"},b.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},b.values=h,p.prototype={constructor:p,reset:function(e){if(this.prev=0,this.next=0,this.sent=m,this.done=!1,this.delegate=null,this.tryEntries.forEach(f),!e)for(var t in this)"t"===t.charAt(0)&&v.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=m)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,n){return o.type="throw",o.arg=e,r.next=t,!!n}if(this.done)throw e;for(var r=this,n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var a=v.call(i,"catchLoc"),s=v.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&v.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?this.next=i.finallyLoc:this.complete(o),E},complete:function(e,t){if("throw"===e.type)throw e.arg;"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=e.arg,this.next="end"):"normal"===e.type&&t&&(this.next=t)},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),f(r),E}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;f(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:h(e),resultName:t,nextLoc:r},E}}}}("object"==typeof global?global:"object"==typeof window?window:"object"==typeof self?self:this),function(){var GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;void 0===GLOBAL.lively&&(GLOBAL.lively={}),function(){this.lively=this.lively||{},function(exports){"use strict";function Empty(){return function(){}}function K(){return function(e){return e}}function Null(){return function(){return null}}function False(){return function(){return!1}}function True(){return function(){return!0}}function notYetImplemented(){return function(){throw new Error("Not yet implemented")}}function all(e){var t=[];for(var r in e)e.__lookupGetter__(r)||"function"!=typeof e[r]||t.push(r);return t}function own(e){var t=[];for(var r in e)!e.__lookupGetter__(r)&&e.hasOwnProperty(r)&&"function"==typeof e[r]&&t.push(r);return t}function argumentNames(e){if(e.superclass)return[];var t=e.toString(),r="",n=t.match(/(?:\(([^\)]*)\)|([^\(\)-+!]+))\s*=>/);if(n)r=n[1]||n[2]||"";else{var i=t.match(/^[\s\(]*function[^(]*\(([^)]*)\)/);i&&i[1]&&(r=i[1])}return r.replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",").map(function(e){return e.trim()}).filter(function(e){return!!e})}function qualifiedMethodName(e){var t="";return e.declaredClass?t+=e.declaredClass+">>":e.declaredObject&&(t+=e.declaredObject+"."),t+(e.methodName||e.displayName||e.name||"anonymous")}function extractBody(e){for(var t=String(e).replace(/^function[^\{]+\{\s*/,"").replace(/\}$/,"").trim(),r=t.split(/\n|\r/),n=void 0,i=0;i<r.length;i++){var o=r[i].match(/^(\s+)[^\s]/);o&&(void 0===n||o[1].length<n.length)&&(n=o[1])}return n?t.replace(new RegExp("^"+n,"gm"),""):t}function timeToRun(e){var t=Date.now();return e(),Date.now()-t}function timeToRunN$1(e,t){for(var r=Date.now(),n=0;n<t;n++)e();return(Date.now()-r)/t}function delay(e,t){var r=Array.prototype.slice.call(arguments),n=r.shift(),t=1e3*r.shift();return setTimeout(function(){return n.apply(n,r)},t)}function throttle(e,t){var r,n,i,o,a,s,u=debounce(t,function(){a=o=!1});return function(){r=this,n=arguments;return i||(i=setTimeout(function(){i=null,a&&e.apply(r,n),u()},t)),o?a=!0:s=e.apply(r,n),u(),o=!0,s}}function debounce(e,t,r){var n;return function(){var i=this,o=arguments;r&&!n&&t.apply(i,o),clearTimeout(n),n=setTimeout(function(){n=null,r||t.apply(i,o)},e)}}function throttleNamed(e,t,r){var n=_throttledByName;return n[e]?n[e]:n[e]=throttle(function(){debounceNamed(e,t,function(){delete n[e]})(),r.apply(this,arguments)},t)}function debounceNamed(e,t,r,n){var i=_debouncedByName;return i[e]?i[e]:i[e]=debounce(t,function(){delete i[e],r.apply(this,arguments)},n)}function createQueue(e,t){var r=_queues,n=r[e]||(r[e]={_workerActive:!1,worker:t,tasks:[],drain:null,push:function(e){n.tasks.push(e),n.activateWorker()},pushAll:function(e){e.forEach(function(e){n.tasks.push(e)}),n.activateWorker()},pushNoActivate:function(e){n.tasks.push(e)},handleError:function(e){e&&console.error("Error in queue: "+e)},activateWorker:function(){function t(e){n.handleError(e),n.activateWorker()}var i=n.tasks,o=n._workerActive;if(0===i.length)o&&(n._workerActive=!1,"function"==typeof n.drain&&n.drain()),delete r[e];else{o||(n._workerActive=!0);try{n.worker(i.shift(),t)}catch(e){t(e)}}}});return n}function workerWithCallbackQueue(e,t,r){function n(){c&&clearTimeout(c),s=!0,delete o[e]}function i(t){s||(n(),a.callbacks.forEach(function(r){try{r.apply(null,t)}catch(t){console.error("Error when invoking callbacks in queueUntil ["+e+"]:\n"+String(t.stack||t))}}))}var o=_queueUntilCallbacks,a=o[e];if(!!a)return a;var s=!1,u=!1;if(r)var c=setTimeout(function(){s||i([new Error("timeout")])},r);return a=o[e]={callbacks:[],cancel:function(){u=!0,n()},whenDone:function(e){return a.callbacks.push(e),a}},setTimeout(function(){if(!u)try{t(function(){i(arguments)})}catch(e){i([e])}},0),a}function _composeAsyncDefaultEndCallback(e,t){e&&console.error("lively.lang.composeAsync error",e)}function composeAsync(){var e,t,r=Array.prototype.slice,n=r.call(arguments),i=_composeAsyncDefaultEndCallback,o=i,a=new Promise(function(r,n){e=r,t=n});return n.reverse().reduce(function(e,s,u){var c=!1;return function(){function l(){c=!0;var n=r.call(arguments),i=n.shift();i?(o(i),t(i)):e.apply(null,n)}var f=r.call(arguments);if(o===i&&u===n.length-1){for(;f.length&&"function"!=typeof f[f.length-1];)f.pop();"function"==typeof f[f.length-1]&&(o=f.pop())}if("function"==typeof s)try{var p=s.apply(this,f.concat([l]));p&&"function"==typeof p.then&&"function"==typeof p.catch&&p.then(function(e){return l(null,e)}).catch(function(e){return l(e)})}catch(e){console.error("composeAsync: ",e.stack||e),c||(o(e),t(e))}else if(s&&"function"==typeof s.then&&"function"==typeof s.catch)s.then(function(e){l(null,e)}).catch(function(e){l(e)});else{var h=new Error("Invalid argument to composeAsync: "+s);o(h),t(h)}return a}},function(){var t=r.call(arguments);o.apply(null,[null].concat(t)),e(t[0])})}function compose(){return Array.prototype.slice.call(arguments).reverse().reduce(function(e,t){return function(){return e(t.apply(this,arguments))}},function(e){return e})}function flip(e){return function(){var t=Array.prototype.slice.call(arguments),r=[t[1],t[0]].concat(t.slice(2));return e.apply(null,r)}}function withNull(e){return e=e||function(){},function(){var t=lively.lang.arr.from(arguments);e.apply(null,[null].concat(t))}}function waitFor(e,t,r){var n=Date.now(),i=50;r||(r=t,t=e,e=void 0),function o(){if(t())return r();if(e){var a=Date.now()-n,s=e-a;if(s<=0)return r(new Error("timeout"));s<i&&(i=s)}setTimeout(o,i)}()}function waitForAll(e,t,r){function n(e,t,n,a){if(o.length){var s=null,u=o.indexOf(e);u>-1&&o.splice(u,1),n?(o.length=0,s=new Error("in waitForAll at"+("number"==typeof t?" "+t:"")+": \n"+(n.stack||String(n)))):a&&(i[t]=a),o.length||setTimeout(function(){r(s,i)},0)}}r||(r=t,t=e,e=null),e=e||{};var i=t.map(function(){return null});if(t.length){var o=Array.prototype.slice.call(t);t.forEach(function(e,t){try{e(function(){var r=Array.prototype.slice.call(arguments),i=r.shift();n(e,t,i,r)})}catch(r){n(e,t,r,null)}}),e.timeout&&setTimeout(function(){if(o.length){var e=i.map(function(e,t){return null===e&&t}).filter(function(e){return"number"==typeof e}).join(", ");n(null,null,new Error("waitForAll timed out, functions at "+e+" not done"),null)}},e.timeout)}else r(null,i)}function curry(e,t,r,n){function i(){return e.apply(this,o.concat(Array.prototype.slice.call(arguments)))}if(arguments.length<=1)return arguments[0];var o=Array.prototype.slice.call(arguments),e=o.shift();return i.isWrapper=!0,i.originalFunction=e,i}function wrap(e,t){var r=e,n=function(){var e=Array.prototype.slice.call(arguments),n=t.isWrapper?e:[r.bind(this)].concat(e);return t.apply(this,n)};return n.isWrapper=!0,n.originalFunction=r,n}function getOriginal(e){for(;e.originalFunction;)e=e.originalFunction;return e}function wrapperChain(e){var t=[];do{t.push(e),e=e.originalFunction}while(e);return t}function replaceMethodForOneCall(e,t,r){r.originalFunction=e[t];var n=e.hasOwnProperty(t);return e[t]=function(){return n?e[t]=r.originalFunction:delete e[t],r.apply(this,arguments)},e}function once(e){if(e){if("function"!=typeof e)throw new Error("once() expecting a function");var t,r=!1;return function(){return r?t:(r=!0,t=e.apply(this,arguments))}}}function either(){var e=!1;return Array.prototype.slice.call(arguments).map(function(t){return function(){if(!e)return e=!0,t.apply(this,arguments)}})}function eitherNamed(e,t){var r=Array.prototype.slice.call(arguments),n=_eitherNameRegistry,e=r.shift(),i=n[e]||(n[e]={wasCalled:!1,callsLeft:0});return i.callsLeft++,function(){if(i.callsLeft--,i.callsLeft<=0&&delete n[e],!i.wasCalled)return i.wasCalled=!0,t.apply(this,arguments)}}function evalJS(src){return eval(src)}function fromString(e){return evalJS("("+e.toString()+");")}function asScript(e,t){return Closure.fromFunction(e,t).recreateFunc()}function asScriptOf(e,t,r,n){var i=r||e.name;if(!i)throw Error("Function that wants to be a script needs a name: "+this);var o=Object.getPrototypeOf(t),a={this:t};if(n&&(a=merge([a,n])),o&&o[i]){var s=function(){try{return Object.getPrototypeOf(t)[i].apply(t,arguments)}catch(e){return void 0!==("undefined"==typeof $world?"undefined":_typeof($world))?$world.logError(e,"Error in $super call"):console.error("Error in $super call: "+e+"\n"+e.stack),null}};a.$super=Closure.fromFunction(s,{obj:t,name:i}).recreateFunc()}return addToObject(asScript(e,a),t,i)}function addToObject(e,t,r){e.displayName=r;var n=t.attributeConnections?t.attributeConnections.filter(function(e){return"update"===e.getSourceAttrName()}):[];return n&&n.forEach(function(e){e.disconnect()}),t[r]=e,(void 0===t?"undefined":_typeof(t))&&(e.declaredObject=safeToString(t)),"undefined"!=typeof lively&&t&&lively.Tracing&&lively.Tracing.stackTracingEnabled&&lively.Tracing.instrumentMethod(t,r,{declaredObject:safeToString(t)}),n&&n.forEach(function(e){e.connect()}),e}function binds(e,t){return Closure.fromFunction(e,t||{}).recreateFunc()}function setLocalVarValue(e,t,r){e.hasLivelyClosure&&(e.livelyClosure.funcProperties[t]=r)}function getVarMapping(e){return e.hasLivelyClosure?e.livelyClosure.varMapping:e.isWrapper?e.originalFunction.varMapping:e.varMapping?e.varMapping:{}}function setProperty(e,t,r){e[t]=r,e.hasLivelyClosure&&(e.livelyClosure.funcProperties[t]=r)}function functionNames(e){for(var t=[],r=e.prototype;r;)t=Object.keys(r).reduce(function(e,t){return"function"==typeof r[t]&&-1===e.indexOf(t)&&e.push(t),e},t),r=Object.getPrototypeOf(r);return t}function localFunctionNames(e){return Object.keys(e.prototype).filter(function(t){return"function"==typeof e.prototype[t]})}function logErrors(e,t){var r=function(r){var n=Array.prototype.slice.call(arguments);n.shift();try{return r.apply(e,n)}catch(r){if("undefined"!=typeof lively&&lively.morphic&&lively.morphic.World&&lively.morphic.World.current())throw lively.morphic.World.current().logError(r),r;throw t?console.warn("ERROR: %s.%s(%s): err: %s %s",e,t,n,r,r.stack||""):console.warn("ERROR: %s %s",r,r.stack||""),r}};r.methodName="$logErrorsAdvice";var n=wrap(e,r);return n.originalFunction=e,n.methodName="$logErrorsWrapper",n}function logCompletion(e,t){var r=function(r){var n=Array.prototype.slice.call(arguments);n.shift();try{var i=r.apply(e,n)}catch(e){throw console.warn("failed to load "+t+": "+e),"undefined"!=typeof lively&&lively.lang.Execution&&lively.lang.Execution.showStack(),e}return console.log("completed "+t),i};r.methodName="$logCompletionAdvice::"+t;var n=wrap(e,r);return n.methodName="$logCompletionWrapper::"+t,n.originalFunction=e,n}function logCalls(e,t){var r=e,n=function(n){var o=Array.prototype.slice.call(arguments);return o.shift(),i=n.apply(e,o),t?console.warn("%s(%s) -> %s",qualifiedMethodName(r),o,i):console.log("%s(%s) -> %s",qualifiedMethodName(r),o,i),i};n.methodName="$logCallsAdvice::"+qualifiedMethodName(e);var i=wrap(e,n);return i.originalFunction=e,i.methodName="$logCallsWrapper::"+qualifiedMethodName(e),i}function traceCalls(e,t){return wrap(e,function(r){var n=Array.prototype.slice.call(arguments);n.shift(),t.push(n);var i=r.apply(e,n);return t.pop(),i})}function webkitStack(){try{throw new Error}catch(e){return String(e.stack).split(/\n/).slice(2).map(function(e){return e.replace(/^\s*at\s*([^\s]+).*/,"$1")}).join("\n")}}function range(e,t,r){r=r||0;var n=[];if(e<=t){r<=0&&(r=-r||1);for(i=e;i<=t;i+=r)n.push(i)}else{r>=0&&(r=-r||-1);for(var i=e;i>=t;i+=r)n.push(i)}return n}function withN(e,t){for(var r=new Array(e);e>0;)r[--e]=t;return r}function genN(e,t){for(var r=new Array(e);e>0;)r[--e]=t(e);return r}function filter(e,t,r){return e.filter(t,r)}function findAndGet(e,t){var r;return e.find(function(e,n){return r=t(e,n)}),r}function filterByKey(e,t){return e.filter(function(e){return!!e[t]})}function grep(e,t,r){return"string"==typeof t&&(t=new RegExp(t,"i")),e.filter(t.test.bind(t))}function mask(e,t){return e.filter(function(e,r){return!!t[r]})}function reject(e,t,r){return e.filter(function(e,n){return!t.call(r,e,n)})}function rejectByKey(e,t){return e.filter(function(e){return!e[t]})}function without(e,t){return e.filter(function(e){return e!==t})}function withoutAll(e,t){return e.filter(function(e){return-1===t.indexOf(e)})}function uniq(e,t){if(!e.length)return e;var r=[e[0]];if(t)for(var n=1;n<e.length;n++){var i=e[n];i!==r[r.length]&&r.push(i)}else for(var o=1;o<e.length;o++){var a=e[o];-1===r.indexOf(a)&&r.push(a)}return r}function uniqBy(e,t,r){for(var n=e.slice(),i=n.length;i--;)for(var o=e[i],a=i+1;a<n.length;a++)t.call(r,o,n[a])&&n.splice(a--,1);return n}function uniqByKey(e,t){for(var r={},n=[],i=0;i<e.length;i++){var o=e[i];r[o[t]]||(r[o[t]]=!0,n.push(o))}return n}function compact(e){return e.filter(Boolean)}function mutableCompact(e){for(var t=0,r=0,n=e.length;t<n;)e.hasOwnProperty(t)&&(e[r++]=e[t]),t++;for(;r++<n;)e.pop();return e}function forEach$1(e,t,r){return e.forEach(t,r)}function zip(){var e=Array.from(arguments),t=e.shift(),r="function"==typeof last(e)?e.pop():function(e){return e},n=[t].concat(e).map(function(e){return Array.from(e)});return t.map(function(e,t){return r(pluck(n,t),t)})}function flatten(e,t){if("number"==typeof t){if(t<=0)return e;t--}return e.reduce(function(e,r){return e.concat(Array.isArray(r)?flatten(r,t):[r])},[])}function flatmap(e,t,r){for(var n=[],i=0;i<e.length;i++)n.push.apply(n,t.call(r,e[i],i));return n}function interpose(e,t){return e.reduce(function(e,r){return e.length>0&&e.push(t),e.push(r),e},[])}function delimWith(e,t){return interpose(e,t)}function map$1(e,t,r){return e.map(t,r)}function invoke(e,t,r,n,i,o,a,s){return e.map(function(e){return e[t](r,n,i,o,a,s)})}function pluck(e,t){return e.map(function(e){return e[t]})}function reduce(e,t,r,n){return e.reduce(t,r,n)}function reduceRight(e,t,r,n){return e.reduceRight(t,r,n)}function some(e,t,r){return e.some(t,r)}function every(e,t,r){return e.every(t,r)}function equals$2(e,t){var r=e.length;if(!t||r!==t.length)return!1;for(var n=0;n<r;n++){if(e[n]&&t[n]&&e[n].equals&&t[n].equals){if(e[n].equals(t[n]))continue;return!1}if(e[n]!=t[n])return!1}return!0}function deepEquals(e,t){var r=e.length;if(!t||r!==t.length)return!1;for(var n=0;n<r;n++)if(!equals$1(e[n],t[n]))return!1;return!0}function isSorted(e,t){if(t){for(r=1;r<e.length;r++)if(e[r-1]<e[r])return!1}else for(var r=1;r<e.length;r++)if(e[r-1]>e[r])return!1;return!0}function sort(e,t){return e.sort(t)}function sortBy(e,t,r){return pluck(e.map(function(e,n){return{value:e,criteria:t.call(r,e,n)}}).sort(function(e,t){var r=e.criteria,n=t.criteria;return r<n?-1:r>n?1:0}),"value")}function sortByKey(e,t){return sortBy(e,function(e){return e[t]})}function reverse(e){return e.reverse()}function reversed(e){return e.slice().reverse()}function reMatches$1(e,t,r){return r=r||String,e.map(function(e){return r(e).match(t)})}function first(e){return e[0]}function last(e){return e[e.length-1]}function intersect(e,t){return uniq(e).filter(function(e){return t.indexOf(e)>-1})}function union(e,t){for(var r=e.slice(),n=0;n<t.length;n++){var i=t[n];-1===r.indexOf(i)&&r.push(i)}return r}function pushAt(e,t,r){e.splice(r,0,t)}function removeAt(e,t){e.splice(t,1)}function remove(e,t){var r=e.indexOf(t);return r>=0&&removeAt(e,r),t}function pushAll$1(e,t){return e.push.apply(e,t),e}function pushAllAt(e,t,r){e.splice.apply(e,[r,0].concat(t))}function pushIfNotIncluded(e,t){e.includes(t)||e.push(t)}function replaceAt(e,t,r){e.splice(r,1,t)}function clear(e){return e.length=0,e}function isSubset(e,t){for(var r=0;r<e.length;r++)if(!t.includes(e[r]))return!1;return!0}function doAndContinue(e,t,r,n){return r=r||Null,n=n||GLOBAL$1,t=t||function(e,t,r){t.call(n,e,r)},e.reduceRight(function(e,r,i){return function(){t.call(n,e,r,i)}},r)()}function nestedDelay(e,t,r,n,i,o){return n=n||function(){},e.clone().reverse().reduce(function(e,n,a){return function(){t.call(i||GLOBAL$1,n,a),o&&a%o!=0?e():e.delay(r)}},n)()}function forEachShowingProgress(){var e,t,r,n,i,o=Array.from(arguments),a=o.shift(),s=a.length,u=!1;if(1===o.length?(e=o[0].progressBar,t=o[0].iterator,r=o[0].labelFunction,n=o[0].whenDone,i=o[0].context):(e=o[0],t=o[1],r=o[2],n=o[3],i=o[4]),i||(i="undefined"!=typeof window?window:global),r||(r=function(e){return e}),!e){u=!0;var c=("undefined"!=typeof window?window:global).lively&&lively.morphic&&lively.morphic.World.current();e=c?c.addProgressBar():{setValue:function(e){},setLabel:function(){},remove:function(){}}}return e.setValue(0),a.reduceRight(function(n,o,a){return function(){try{e.setValue(a/s),r&&e.setLabel(r.call(i,o,a)),t.call(i,o,a)}catch(e){console.error("Error in forEachShowingProgress at %s (%s)\n%s\n%s",a,o,e,e.stack)}n.delay(0)}},function(){e.setValue(1),u&&function(){e.remove()}.delay(0),n&&n.call(i)})(),a}function swap(e,t,r){t<0&&(t=e.length+t),r<0&&(r=e.length+r);var n=e[t];return e[t]=e[r],e[r]=n,e}function rotate(e,t){return t=t||1,e.slice(t).concat(e.slice(0,t))}function groupBy(e,t,r){return Group.fromArray(e,t,r)}function groupByKey(e,t){return groupBy(e,function(e){return e[t]})}function partition(e,t,r){t=t||function(e){return e};var n=[],i=[];return e.forEach(function(e,o){(t.call(r,e,o)?n:i).push(e)}),[n,i]}function batchify(e,t,r){function n(e,i){if(!i.length)return[e,[]];var o=i[0],a=i.slice(1),s=e.concat([o]);if(t.call(r,s))return n(s,a);var u=n(e,a);return[u[0],[o].concat(u[1])]}function i(e,t){if(!t.length)return e;var r=n([],t);if(!r[0].length)throw new Error("Batchify constrained does not ensure consumption of at least one item per batch!");return i(e.concat([r[0]]),r[1])}return i([],e)}function toTuples(e,t){return t=t||1,range(0,Math.ceil(e.length/t)-1).map(function(r){return e.slice(r*t,r*t+t)},e)}function combinationsPick(e,t){for(var r=e.map(function(e,r){return e[t[r]]}),n=t.slice(),i=e.length;i--;i>=0){var o=e[i],a=n[i]+1;if(o[a]){n[i]=a;break}if(0===i){n=void 0;break}n[i]=0}return[r,n]}function combinations(e){for(var t=e.reduce(function(e,t){return e*t.length},1),r=e.map(function(e){return 0}),n=new Array(t),i=0;i<t;i++){var o=combinationsPick(e,r);n[i]=o[0],r=o[1]}return n}function take(e,t){return e.slice(0,t)}function drop(e,t){return e.slice(t)}function takeWhile(e,t,r){for(var n=0;n<e.length&&t.call(r,e[n],n);n++);return e.slice(0,n)}function dropWhile(e,t,r){for(var n=0;n<e.length&&t.call(r,e[n],n);n++);return e.slice(n)}function shuffle(e){for(var t=range(0,e.length-1),r=Array(e.length),n=0;n<e.length;n++)r[t.splice(Math.round(Math.random()*(t.length-1)),1)]=e[n];return r}function max(e,t,r){t=t||function(e){return e};var n;return e.reduce(function(e,i,o){var a=t.call(r,i,o);return"number"!=typeof a||a<=e?e:(n=i,a)},-1/0),n}function min(e,t,r){return t=t||function(e){return e},max(e,function(e,n){return-t.call(r,e,n)})}function sum(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}function count$1(e,t){return e.reduce(function(e,r){return r===t?e+1:e},0)}function size$1(e){return e.length}function histogram(e,t){if(void 0===t||"number"==typeof t){var r=t||Math.ceil(Math.log(e.length)/Math.log(2)+1),n=Math.ceil(Math.round(e.length/r));return range(0,r-1).map(function(t){return e.slice(t*n,(t+1)*n)})}if(t instanceof Array){var i=t;return e.reduce(function(e,t){if(t<i[1])return e[0].push(t),e;for(var r=1;r<i.length;r++)if(t>=i[r]&&(!i[r+1]||t<=i[r+1]))return e[r].push(t),e;throw new Error("Histogram creation: Cannot group data "+t+" into thresholds "+i)},range(1,i.length).map(function(){return[]}))}}function clone$1(e){return[].concat(e)}function toArray$3(e){return from(e)}function each(e,t,r){return e.forEach(t,r)}function all$1(e,t,r){return e.every(t,r)}function any(e,t,r){return e.some(t,r)}function collect(e,t,r){return e.map(t,r)}function findAll(e,t,r){return e.filter(t,r)}function inject(e,t,r,n){return n&&(r=r.bind(n)),e.reduce(r,t)}function mapAsyncSeries(e,t,r){function n(e,t){if(!o&&(e||t)){o=!0;try{r(e,i)}catch(e){console.error("Error in mapAsyncSeries - callback invocation error:\n"+(e.stack||e))}}}var i=[],o=!1;return e.reduceRight(function(e,r,a){if(!o)return function(o,s){if(o)return n(o);a>0&&i.push(s);try{t(r,a,once(e))}catch(e){n(e)}}},function(e,t){i.push(t),n(e,!0)})()}function mapAsync(e,t,r,n){function i(){for(;l<t.parallel&&c<e.length;)f[c++]()}function o(t,r){if(!(s.indexOf(t)>-1||(s.push(t),l--,u)))if(!r&&s.length<e.length)i();else{u=!0;try{n&&n(r,a)}catch(e){console.error("Error in mapAsync - main callback invocation error:\n"+(e.stack||e))}}}if("function"==typeof t&&(n=r,r=t,t=null),t=t||{},!e.length)return n&&n(null,[]);t.parallel||(t.parallel=1/0);var a=[],s=[],u=!1,c=0,l=0,f=e.map(function(e,t){return function(){l++;try{r(e,t,once(function(e,r){a[t]=e||r,o(t,e)}))}catch(e){o(t,e)}}});return i()}function print$1(e){if(e&&Array.isArray(e))return"["+e.map(print$1)+"]";if("string"!=typeof e)return String(e);var t=String(e);return t=t.replace(/\n/g,"\\n\\\n"),t=t.replace(/(")/g,"\\$1"),t='"'+t+'"'}function indent$1(e,t,r){if(!r||r<=0)return e;for(;r>0;)r--,e=t+e;return e}function isArray$$1(e){return Array.isArray(e)}function isElement(e){return e&&1==e.nodeType}function isFunction(e){return e instanceof Function}function isBoolean(e){return"boolean"==typeof e}function isString(e){return"string"==typeof e}function isNumber(e){return"number"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return e instanceof RegExp}function isObject(e){return"object"==(void 0===e?"undefined":_typeof(e))}function isPrimitive(e){if(!e)return!0;switch(void 0===e?"undefined":_typeof(e)){case"string":case"number":case"boolean":return!0}return!1}function isEmpty(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function equals$1(e,t){if(e===t)return!0;if(!e||!t)return e==t;if(Array.isArray(e))return deepEquals(e,t);switch(e.constructor){case String:case Date:case Boolean:case Number:return e==t}if("function"==typeof e.isEqualNode)return e.isEqualNode(t);if("function"==typeof e.equals)return e.equals(t);var r=[];for(var n in e)if(r.push(n),"function"!=typeof e[n]&&!equals$1(e[n],t[n]))return!1;for(var n in t)if(-1===r.indexOf(n)&&"function"!=typeof t[n]&&!equals$1(t[n],e[n]))return!1;return!0}function values(e){return e?Object.keys(e).map(function(t){return e[t]}):[]}function select(e,t){for(var r={},n=0;n<t.length;n++)r[t[n]]=e[t[n]];return r}function dissoc(e,t){for(var r=getOwnPropertyDescriptors(e=e||{}),n=0;n<t.length;n++)t[n]in r&&delete r[t[n]];return Object.defineProperties({},r)}function addScript(e,t,r,n){return asScriptOf(fromString(t),e,r,n)}function extend(e,t){for(var r=null,n=1;n<arguments.length;n++)if("string"!=typeof arguments[n]){var t=arguments[n];for(var i in t){var o=t.__lookupGetter__(i),a=t.__lookupSetter__(i);if(o&&e.__defineGetter__(i,o),a&&e.__defineSetter__(i,a),!o&&!a){var s=t[i];e[i]=s,r&&r.push(i),"function"==typeof s&&(s.displayName||(s.displayName=i),"undefined"!=typeof lively&&lively.Module&&lively.Module.current&&(s.sourceModule=lively.Module.current()))}}}else{var u=arguments[n];e.categories||(e.categories={}),e.categories[u]||(e.categories[u]=[]),r=e.categories[u]}return e}function clone$$1(e){if(isPrimitive(e))return e;if(Array.isArray(e))return Array.prototype.slice.call(e);var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}function extract(e,t,r){for(var n={},i=0;i<t.length;i++)t[i]in e&&(n[t[i]]=r?r(t[i],e[t[i]]):e[t[i]]);return n}function inspect(e,t,r){if(t=t||{},r=r||0,t.customPrinter){var n=t._ignoreSignal||(t._ignoreSignal={}),i=function(e){return inspect(e,t,r+1)},o=t.customPrinter(e,n,i);if(o!==n)return o}if(!e)return print$1(e);if("function"==typeof e)return t.printFunctionSource?String(e):"function"+(e.name?" "+e.name:"")+"("+argumentNames(e).join(",")+") {/*...*/}";switch(e.constructor){case String:case Boolean:case RegExp:case Number:return print$1(e)}if("function"==typeof e.serializeExpr)return e.serializeExpr();var a=e&&Array.isArray(e),s=a?"[":"{",u=a?"]":"}";if(t.maxDepth&&r>=t.maxDepth)return s+"/*...*/"+u;var c=[];if(0===(c=a?e.map(function(e){return inspect(e,t,r+1)}):Object.keys(e).sort(function(t,r){var n="function"==typeof e[t];return n===("function"==typeof e[r])?t<r?-1:t>r?1:0:n?1:-1}).map(function(n,i){a&&inspect(e[n],t,r+1);var o=inspect(e[n],t,r+1);return t.escapeKeys?JSON.stringify(n):n+": "+o})).length)return s+u;var l=c.join(", "),f=(!a||t.newLineInArrays)&&(!t.minLengthForNewLine||l.length>=t.minLengthForNewLine),p=indent$1("",t.indent||"  ",r),h=indent$1("",t.indent||"  ",r+1),d=f&&!a?"\n"+h:"",m=f?"\n"+h:"",v=f&&!a?"\n"+p:"";return f&&(l=c.join(","+m)),s+d+l+v+u}function merge(e){return arguments.length>1?merge(Array.prototype.slice.call(arguments)):Array.isArray(e[0])?Array.prototype.concat.apply([],e):e.reduce(function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},{})}function deepMerge(e,t){if(!e)return t;if(!t)return e;if(Array.isArray(e)){if(!Array.isArray(t))return t;var r=e.map(function(e,r){return deepMerge(e,t[r])});return t.length>e.length&&(r=r.concat(t.slice(e.length))),r}return"object"!==(void 0===e?"undefined":_typeof(e))||"object"!==(void 0===t?"undefined":_typeof(t))?t:Object.keys(e).concat(Object.keys(t)).reduce(function(r,n){return e[n]?t[n]?"object"!==_typeof(e[n])||"object"!==_typeof(t[n])?r[n]=t[n]:r[n]=deepMerge(e[n],t[n]):r[n]=e[n]:r[n]=t[n],r},{})}function sortKeysWithBeforeAndAfterConstraints(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=[],r=[],n=[];for(var i in e){var o=e[i],a=o.hasOwnProperty("before")?o.before:o.before=[],s=o.hasOwnProperty("after")?o.after:o.after=[];t.push(i),r.push(o);for(var u=a.length;u--;){var c=a[u],l=e[c];l?(l.hasOwnProperty("after")||(l.after=[]),l.after.push(i)):(console.warn("[initializeProperties] "+this+" sortProperties: Property "+i+" requires to be initialized before "+c+" but that property cannot be found."),a.splice(u,1))}for(var f=s.length;f--;){var p=s[f];e[p]||(console.warn("[initializeProperties] "+this+" sortProperties: Property "+i+" requires to be initialized after "+p+" but that property cannot be found."),s.splice(f,1))}n.push(i)}for(var h=[],d=[],m=n.length+1;n.length;){if(m===n.length)throw new Error("Circular dependencies in handler order, could not resolve properties "+n.map(function(t){var r=e[t].before,n=e[t].after;if(!(r&&r.length||n&&n.length))return"";var i=t+"\n";return r&&r.length&&(i+="  - before "+r.join(",")+"\n"),n&&n.length&&(i+="  - after "+n.join(",")+"\n"),i}).join(""));m=n.length;for(var v=[],y=n.length;y--;){var g=n[y];isSubset(e[g].after,d)&&(n.splice(y,1),d.push(g),v.push(g))}h.push(v)}return flatten(h,1)}function inherit(e){return Object.create(e)}function valuesInPropertyHierarchy(e,t){for(var r=[],n=e;n;)n.hasOwnProperty(t)&&r.unshift(n[t]),n=Object.getPrototypeOf(n);return r}function mergePropertyInHierarchy(e,t){return merge(valuesInPropertyHierarchy(e,t))}function deepCopy(e){if(!e||"object"!==(void 0===e?"undefined":_typeof(e))||e instanceof RegExp)return e;var t=Array.isArray(e)?Array(e.length):{};for(var r in e)e.hasOwnProperty(r)&&(t[r]=deepCopy(e[r]));return t}function typeStringOf(e){return null===e?"null":void 0===e?"undefined":e.constructor.name}function shortPrintStringOf(e){function t(e,t,n,i){e.constructor.name===t&&(r+=n,(e.length||Object.keys(e).length)&&(r+="..."),r+=i)}if(!isMutableType(e))return safeToString(e);if("Object"!==e.constructor.name&&!Array.isArray(e)&&e.constructor.name)return e.constructor.name?e.constructor.name:Object.prototype.toString.call(e).split(" ")[1].split("]")[0];var r="";return t(e,"Object","{","}"),t(e,"Array","[","]"),r}function isMutableType(e){return-1===["null","undefined","Boolean","Number","String"].indexOf(typeStringOf(e))}function safeToString(e){try{return(e?e.toString():String(e)).replace("\n","")}catch(e){return"<error printing object>"}}function asObject(e){switch(void 0===e?"undefined":_typeof(e)){case"string":return new String(e);case"boolean":return new Boolean(e);case"number":return new Number(e);default:return e}}function newKeyIn(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"_",n=1;do{t=r+"-"+n++}while(t in e);return t}function format(){return formatFromArray(Array.prototype.slice.call(arguments))}function formatFromArray(e){function t(e,t){return""+e}function r(e,t){return e.toString()}function n(e,t){return inspect(e)}var i=e.shift();i||console.log("Error in Strings>>formatFromArray, first arg is undefined");for(var o={s:t,d:r,i:r,f:function(e,t,r){return r>-1?e.toFixed(r):e.toString()},o:n},a=/((^%|[^\\]%)(\d+)?(\.)([a-zA-Z]))|((^%|[^\\]%)([a-zA-Z]))/,s=function(e){for(var t=[],r=a.exec(e);r;r=a.exec(e)){var i=r[8]||r[5],s=i in o?o[i]:n,u=r[3]?parseInt(r[3]):"."==r[4]?-1:0;t.push(e.substr(0,"%"==r[0][0]?r.index:r.index+1)),t.push({appender:s,precision:u}),e=e.substr(r.index+r[0].length)}return e&&t.push(e.toString()),t}(i),u="",c=0,l=0;l<s.length;++l){var f=s[l];if(f&&"object"==(void 0===f?"undefined":_typeof(f))){var p=e[c++];u+=(f.appender||t)(p,u,f.precision)}else u+=t(f)}return u}function indent(e,t,r){if(!r||r<=0)return e;for(var n="";r>0;)r--,n+=t;return lines(e).map(function(e){return n+e}).join("\n")}function minIndent(e,t){t||(t="  ");var r=new RegExp("^("+t+")*","gm");return min(e.match(r).map(function(e){return Math.floor(e.length/t.length)}))}function changeIndent(e,t,r){t||(t="  "),r||(r=0);var n=minIndent(e,t);if(n===r)return e;if(n<r)return indent(e,t,r-n);var i=t.repeat(n-r);return lines(e).map(function(e){return e.slice(i.length)}).join("\n")}function quote(e){return'"'+e.replace(/"/g,'\\"')+'"'}function print(e){if(e&&Array.isArray(e))return"["+e.map(print)+"]";if("string"!=typeof e)return String(e);var t=String(e);return t=t.replace(/\n/g,"\\n\\\n"),t=t.replace(/(")/g,"\\$1"),t='"'+t+'"'}function printNested(e,t){return t=t||0,e.reduce(function(e,r){return e+=Array.isArray(r)?printNested(r,t+1):indent(r+"\n","  ",t)},"")}function pad(e,t,r){return r?" ".repeat(t)+e:e+" ".repeat(t)}function printTable(e,t){function r(e){return!o&&(!!a||t&&Array.isArray(t.align)&&"right"===t.align[e])}var n=[],i=t&&t.separator||" ",o=!t||!t.align||"left"===t.align,a=t&&"right"===t.align;return e.forEach(function(e){e.forEach(function(e,t){void 0===n[t]&&(n[t]=0),n[t]=Math.max(n[t],String(e).length)})}),e.map(function(e){return e.map(function(e,t){var i=String(e);return pad(i,n[t]-i.length,r(t))}).join(i)}).join("\n")}function printTree(e,t,r,n){function i(e,a,s){o[a]=n.repeat(e)+t(s,e);var u=r(s,e),c=a+1;if(!u||!u.length)return c;var l=c,f=u.length-1;return u.forEach(function(t,r){c=i(e+1,c,t);for(var a=f===r,s=o[l].split(""),u=e*n.length+1,p=e*n.length+n.length,r=u;r<p;r++)s[r]="-";a&&(s[e*n.length]="\\"),o[l]=s.join(""),a||o.slice(l,c).forEach(function(t,r){var i=t.split("");i[e*n.length]="|",o[l+r]=i.join("")}),l=c}),c}var o=[];return n=n||"  ",i(0,0,e),o.join("\n")}function toArray$1(e){return e.split("")}function lines(e){return e.split(/\n\r?/)}function paragraphs(e,t){function r(e){return/^\s*$/.test(e)}var n=t?t.sep:"\n\n";return t&&t.keepEmptyLines?e.split("\n").concat("").reduce(function(e,t){var n=e[0],i=e[1];return r(i)===r(t)?i+="\n"+t:(i.length&&n.push(i),i=t),[n,i]},[[],""])[0]:e.split(new RegExp(n+"+"))}function nonEmptyLines(e){return lines(e).compact()}function tokens(e,t){return e.split(t||/\s+/).filter(function(e){return!/^\s*$/.test(e)})}function tableize(e,t){for(var r=(t=t||{}).cellSplitter||/\s+/,n=/^\s*$/,i=!t.hasOwnProperty("convertTypes")||!!t.convertTypes,o=lines(e),a=[],s=0;s<o.length;s++){var u=tokens(o[s],r);i&&(u=u.map(function(e){if(e.match(n))return e;var t=Number(e);if(!isNaN(t))return t;var r=new Date(e);return isNaN(+r)?e.trim():r})),u.length>0&&a.push(u)}return a}function unescapeCharacterEntities(e){if("undefined"==typeof document)throw new Error("Cannot unescapeCharacterEntities");var t=document.createElement("div");return t.innerHTML=e,t.textContent}function toQueryParams(e,t){var r=e.trim().match(/([^?#]*)(#.*)?$/);return r?r[1].split(t||"&").inject({},function(e,t){if((t=t.split("="))[0]){var r=decodeURIComponent(t.shift()),n=t.length>1?t.join("="):t[0];void 0!=n&&(n=decodeURIComponent(n)),r in e?(Array.isArray(e[r])||(e[r]=[e[r]]),e[r].push(n)):e[r]=n}return e}):{}}function normalizePath$1(e){var t=e.match(urlStartRe),r=t?t[0]:null,n=r?e.slice(r.length):e;do{n=(e=n).replace(pathDoubleDotRe,"")}while(n!=e);return n=n.replace(pathDoubleSlashRe,"$1/"),n=n.replace(pathDotRe,"/"),r&&(n=r+n),n}function joinPath(){return normalizePath$1(Array.prototype.slice.call(arguments).reduce(function(e,t){return"string"==typeof t?e.replace(/\/*$/,"")+"/"+t.replace(/^\/*/,""):e}))}function newUUID(){return newUUIDTemplate.replace(newUUIDRe,newUUIDReplacer).toUpperCase()}function createDataURI(e,t){return"data:"+(t=t||"text/plain")+";base64,"+btoa(e)}function hashCode(e){var t=0,r=e.length;if(0==r)return t;for(var n=0;n<r;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t}function md5(e){function t(e,t,r,n,i,o){return t=c(c(t,e),c(n,o)),c(t<<i|t>>>32-i,r)}function r(e,r,n,i,o,a,s){return t(r&n|~r&i,e,r,o,a,s)}function n(e,r,n,i,o,a,s){return t(r&i|n&~i,e,r,o,a,s)}function i(e,r,n,i,o,a,s){return t(r^n^i,e,r,o,a,s)}function o(e,r,n,i,o,a,s){return t(n^(r|~i),e,r,o,a,s)}function a(e,t){var a=e[0],s=e[1],u=e[2],l=e[3];s=o(s=o(s=o(s=o(s=i(s=i(s=i(s=i(s=n(s=n(s=n(s=n(s=r(s=r(s=r(s=r(s,u=r(u,l=r(l,a=r(a,s,u,l,t[0],7,-680876936),s,u,t[1],12,-389564586),a,s,t[2],17,606105819),l,a,t[3],22,-1044525330),u=r(u,l=r(l,a=r(a,s,u,l,t[4],7,-176418897),s,u,t[5],12,1200080426),a,s,t[6],17,-1473231341),l,a,t[7],22,-45705983),u=r(u,l=r(l,a=r(a,s,u,l,t[8],7,1770035416),s,u,t[9],12,-1958414417),a,s,t[10],17,-42063),l,a,t[11],22,-1990404162),u=r(u,l=r(l,a=r(a,s,u,l,t[12],7,1804603682),s,u,t[13],12,-40341101),a,s,t[14],17,-1502002290),l,a,t[15],22,1236535329),u=n(u,l=n(l,a=n(a,s,u,l,t[1],5,-165796510),s,u,t[6],9,-1069501632),a,s,t[11],14,643717713),l,a,t[0],20,-373897302),u=n(u,l=n(l,a=n(a,s,u,l,t[5],5,-701558691),s,u,t[10],9,38016083),a,s,t[15],14,-660478335),l,a,t[4],20,-405537848),u=n(u,l=n(l,a=n(a,s,u,l,t[9],5,568446438),s,u,t[14],9,-1019803690),a,s,t[3],14,-187363961),l,a,t[8],20,1163531501),u=n(u,l=n(l,a=n(a,s,u,l,t[13],5,-1444681467),s,u,t[2],9,-51403784),a,s,t[7],14,1735328473),l,a,t[12],20,-1926607734),u=i(u,l=i(l,a=i(a,s,u,l,t[5],4,-378558),s,u,t[8],11,-2022574463),a,s,t[11],16,1839030562),l,a,t[14],23,-35309556),u=i(u,l=i(l,a=i(a,s,u,l,t[1],4,-1530992060),s,u,t[4],11,1272893353),a,s,t[7],16,-155497632),l,a,t[10],23,-1094730640),u=i(u,l=i(l,a=i(a,s,u,l,t[13],4,681279174),s,u,t[0],11,-358537222),a,s,t[3],16,-722521979),l,a,t[6],23,76029189),u=i(u,l=i(l,a=i(a,s,u,l,t[9],4,-640364487),s,u,t[12],11,-421815835),a,s,t[15],16,530742520),l,a,t[2],23,-995338651),u=o(u,l=o(l,a=o(a,s,u,l,t[0],6,-198630844),s,u,t[7],10,1126891415),a,s,t[14],15,-1416354905),l,a,t[5],21,-57434055),u=o(u,l=o(l,a=o(a,s,u,l,t[12],6,1700485571),s,u,t[3],10,-1894986606),a,s,t[10],15,-1051523),l,a,t[1],21,-2054922799),u=o(u,l=o(l,a=o(a,s,u,l,t[8],6,1873313359),s,u,t[15],10,-30611744),a,s,t[6],15,-1560198380),l,a,t[13],21,1309151649),u=o(u,l=o(l,a=o(a,s,u,l,t[4],6,-145523070),s,u,t[11],10,-1120210379),a,s,t[2],15,718787259),l,a,t[9],21,-343485551),e[0]=c(a,e[0]),e[1]=c(s,e[1]),e[2]=c(u,e[2]),e[3]=c(l,e[3])}function s(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function u(e){for(var t="",r=0;r<4;r++)t+=l[e>>8*r+4&15]+l[e>>8*r&15];return t}var c=function(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r},l="0123456789abcdef".split("");return function(e){for(var t=e.length,r=0;r<t;r++)e[r]=u(e[r]);return e.join("")}(function(e){var t,r=e.length,n=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=r;t+=64)a(n,s(e.substring(t-64,t)));var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=(e=e.substring(t-64)).length;for(t=0;t<o;t++)i[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(a(n,i),t=16;t--;)i[t]=0;return i[14]=8*r,a(n,i),n}(e))}function reMatches$$1(e,t){var r=[];return e.replace(t,function(e,t){r.push({match:e,start:t,end:t+e.length})}),r}function stringMatch(e,t,r){function n(e,t,r,n,i){return n=n||0,i=i||0,[e.slice(0,t),e.slice(t+n,r-i),e.slice(r)]}function i(e,t){if(t.constructor!==RegExp){if(0===e.indexOf(t))return{match:t,rest:e.slice(t.length)};for(var r=0;r<t.length;r++)if(t[r]!=e[r])return{match:null,pos:r};return{match:null}}var n=reMatches$$1(e,t);return n&&n.length&&0===n[0].start?{match:n[0].match,rest:e.slice(n[0].end)}:{match:null}}function o(e,t){for(var r=0,n=0;n<t.length;n++){var o=t[n],a=i(e,o);if(!a.match)return{matched:!1,pos:r+(a.pos||0),pattern:o};r+=a.match.length,e=a.rest}return e.length?{matched:!1,pos:r}:{matched:!0}}function a(e){var t=reMatches$$1(e,/__\//g),r=reMatches$$1(e,/\/__/g);if(t.length!==r.length)throw new Error("pattern invalid: "+e+" cannot be split into __/.../__ embedded RegExps\nstarts: "+JSON.stringify(t)+"\nvs ends:\n"+JSON.stringify(r));var i=0;return t.reduce(function(e,t,o){var a=r[o],s=n(e.pop(),t.start-i,a.end-i,3,3);s[0].length&&(e.push(s[0]),i+=s[0].length);try{s[1].length&&(e.push(new RegExp(s[1])),i+=s[1].length+3+3)}catch(e){throw new Error("Cannot create pattern re from: "+inspect(s))}return s[2].length&&e.push(s[2]),e},[e])}return(r=r||{}).normalizeWhiteSpace&&(e=e.replace(/\s+/g," ")),r.ignoreIndent&&(e=e.replace(/^\s+/gm,""),t=t.replace(/^\s+/gm,"")),e==t?{matched:!0}:function(e,t){var r=o(e,a(t));return r.matched?r:(r.error=e.slice(0,r.pos)+"<--UNMATCHED--\x3e"+e.slice(r.pos),r)}(e,t)}function peekRight(e,t,r){if(e=e.slice(t),"string"==typeof r){var n=e.indexOf(r);return-1===n?null:n+t}if(r.constructor===RegExp){var i=reMatches$$1(e,r);return i[0]?i[0].start:null}return null}function peekLeft(e,t,r){if(e=e.slice(0,t),"string"==typeof r){var n=e.lastIndexOf(r);return-1===n?null:n}if(r.constructor===RegExp){var i=reMatches$$1(e,r);return last(i)?last(i).start:null}return null}function lineIndexComputer(e){var t=lineRanges(e);return function(e){for(var r=0;r<t.length;r++){var n=t[r];if(e>=n[0]&&e<n[1])return r}return-1}}function lineNumberToIndexesComputer(e){return function(t){return lineRanges(e)[t]}}function lineRanges(e){for(var t=0,r=0,n=lines(e),i=[],o=0;o<n.length;o++)r=t+n[o].length+1,i.push([t,r]),t=r;return i}function findLineWithIndexInLineRanges(e,t){var r=e.length;if(0===r)return-1;for(var n=0,i=r;;){var o=n+Math.floor((i-n)/2),a=slicedToArray(e[o],2),s=a[0],u=a[1];if(t<s){if(0===o)return-1;i=o}else{if(!(t>u))return o;n=o}}return-1}function regexIndexOf(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.substring(r||0).search(t);return n>=0?n+(r||0):n}function regexLastIndexOf(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length;t=t.global?t:new RegExp(t.source,"g"+(t.ignoreCase?"i":"")+(t.multiLine?"m":""));for(var n,i=this.substring(0,r+1),o=-1,a=0;null!=(n=t.exec(i));)o=n.index,t.lastIndex=++a;return o}function diff(e,t){return"undefined"==typeof JsDiff?"diff not supported":JsDiff.convertChangesToXML(JsDiff.diffWordsWithSpace(e,t))}function empty(e){return""==e}function startsWithVowel(e){var t=e[0];return"A"===t||"E"===t||"I"===t||"O"===t||"U"===t||"a"===t||"e"===t||"i"===t||"o"===t||"u"===t||!1}function withDecimalPrecision(e,t){var r=parseFloat(e);return isNaN(r)?e:r.toFixed(t)}function capitalize(e){return e.length?e.charAt(0).toUpperCase()+e.slice(1):e}function camelCaseString(e){return e.split(" ").invoke("capitalize").join("")}function camelize(e){var t=e.split("-"),r=t.length;if(1==r)return t[0];for(var n="-"==e.charAt(0)?t[0].charAt(0).toUpperCase()+t[0].substring(1):t[0],i=1;i<r;i++)n+=t[i].charAt(0).toUpperCase()+t[i].substring(1);return n}function truncate(e,t,r){return t=t||30,r=void 0===r?"...":r,e.length>t?e.slice(0,t-r.length)+r:String(e)}function truncateLeft(e,t,r){return t=t||30,r=void 0===r?"...":r,e.length>t?r+e.slice(-t):String(e)}function regExpEscape(e){return e.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")}function succ(e){return e.slice(0,e.length-1)+String.fromCharCode(e.charCodeAt(e.length-1)+1)}function digitValue(e){return e.charCodeAt(0)-"0".charCodeAt(0)}function longestCommonSubstring(e,t){for(var r=[],n=0;n<e.length;n++){r[n]=[];for(var i=0;i<t.length;i++)r[n][i]=0}for(var o=0;o<e.length;o++)r[o][0]=0;for(var a=1;a<e.length;a++)for(var s=1;s<t.length;s++)r[a][s]=e[a-1]==t[s-1]?r[a-1][s-1]+1:0;for(var u=-1,c=-1,l=-1,f=0;f<e.length;f++)for(var p=0;p<t.length;p++){var h=r[f][p];u<h&&(u=h,c=f-h,l=p-h)}return{length:u,indexA:c,indexB:l,string:u>0?e.slice(c,c+u):""}}function applyChange(e,t){return"insert"===t.action?e.slice(0,t.start)+t.lines.join("\n")+e.slice(t.start):"remove"===t.action?e.slice(0,t.start)+e.slice(t.end):e}function applyChanges(e,t){return t.reduce(function(t,r){return applyChange(e,r)},e)}function levenshtein(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;var r,n,i,o,a,s;for(e.length>t.length&&(r=e,e=t,t=r),s=Array(e.length+1),n=0;n<=e.length;n++)s[n]=n;for(n=1;n<=t.length;n++){for(o=n,i=1;i<=e.length;i++)a=t[n-1]===e[i-1]?s[i-1]:Math.min(s[i-1]+1,Math.min(o+1,s[i]+1)),s[i-1]=o,o=a;s[e.length]=o}return s[e.length]}function random(e,t){return e=e||0,t=t||100,Math.round(Math.random()*(t-e)+e)}function randomSmallerInteger(e){return Math.floor(Math.random()*e)}function humanReadableByteSize(e){function t(e){return Math.round(100*e)/100}return e<1e3?String(t(e))+"B":(e/=1024)<1e3?String(t(e))+"KB":(e/=1024,String(t(e))+"MB")}function average(e){return e.reduce(function(e,t){return e+t},0)/e.length}function averageInc(e,t,r){return(e-t)/r+t}function median(e){var t=e.sort(function(e,t){return t-e}),r=e.length;return r%2==0?.5*(t[r/2-1]+t[r/2]):t[(r-1)/2]}function between(e,t,r,n){n=n||0;var i,o;return t<r?(i=t,o=r):(o=t,i=r),o-e+n>=0&&i-e-n<=0}function sort$1(e){return e.sort(function(e,t){return e-t})}function parseLength(e,t){t=t||"px";var r=e.match(/([0-9\.]+)\s*(.*)/);if(r&&r[1]){var n=parseFloat(r[1]),i=r[2];return convertLength(n,i,t)}}function roundTo(e,t){return t=1/t,Math.round(e*t)/t}function detent(e,t,r,n){var i=roundTo(e,r);return Math.abs(e-i)<t/2?i:n?e:i+(e-(e<i?i-t/2:i+t/2))*r/(r-t)}function toDegrees(e){return 180*e/Math.PI%360}function toRadians(e){return e/180*Math.PI}function backoff(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4,n=Math.min(r,t*Math.pow(2,e)),i=n/2+Math.round(Math.random()*(n/2));return Math.min(r,t+Math.random()*(3*i-t))}function all$2(e,t){var r=[];for(var n in e)!e.__lookupGetter__(n)&&"function"==typeof e[n]||t&&!t(n,e)||r.push(n);return r}function allOwnPropertiesOrFunctions(e,t){return Object.getOwnPropertyNames(e).reduce(function(r,n){return t&&!t(e,n)||r.push(n),r},[])}function own$1(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&(e.__lookupGetter__(r)||"function"!==e[r])&&t.push(r);return t}function forEachOwn(e,t,r){var n=[];for(var i in e)if(e.hasOwnProperty(i)){var o=e[i];"function"!==o&&n.push(t.call(r||this,i,o))}return n}function nameFor(e,t){for(var r in e)if(e[r]===t)return r}function values$1(e){var t=[];for(var r in e)t.push(e[r]);return t}function ownValues(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(e[r]);return t}function any$1(e,t){for(var r in e)if(t(e,r))return!0;return!1}function allProperties(e,t){var r=[];for(var n in e)t&&!t(e,n)||r.push(n);return r}function hash(e){return Object.keys(e).sort().join("").hashCode()}function format$1(e,t,r){return dateFormat(e,t,r)}function equals$3(e,t){return t&&t instanceof Date&&t.getTime()===e.getTime()}function relativeTo(e,t){if(!(t instanceof Date))return"";if(t<e)return"";if(t===e)return"now";var r="min",n="sec",i="hour",o="day",a=t-e,s=Math.round(a/1e3),u=s%60,c=Math.floor(s/60)%60,l=Math.floor(s/60/60)%24,f=Math.floor(s/60/60/24),p=[];return f>0&&(p.push(f),f>1&&(o+="s"),p.push(o)),l>0&&f<2&&(p.push(l),l>1&&(i+="s"),p.push(i)),c>0&&l<3&&0===f&&(p.push(c),c>1&&(r+="s"),p.push(r)),u>0&&c<3&&0===l&&0===f&&(p.push(u),u>1&&(n+="s"),p.push(n)),p.join(" ")}function promise(e){return"function"==typeof e?promise.convertCallbackFun(e):Promise.resolve(e)}function delay$1(e,t){return new Promise(function(r){return setTimeout(r,e,t)})}function delayReject(e,t){return new Promise(function(r,n){return setTimeout(n,e,t)})}function timeout(e,t){return new Promise(function(r,n){var i=!1;setTimeout(function(){return!i&&(i=!0)&&n(new Error("Promise timed out"))},e),t.then(function(e){return!i&&(i=!0)&&r(e)},function(e){return!i&&(i=!0)&&n(e)})})}function waitFor$1(e,t,r){return"function"==typeof e&&(t=e,e=void 0),new Promise(function(n,i){var o=!1,a=!1,s=void 0,u=void 0,c=setInterval(function(){if(o)return clearInterval(c);try{u=t()}catch(e){s=e}if(u||s||a)return o=!0,clearInterval(c),s?i(s):a?void 0===r?i(new Error("timeout")):n(r):n(u)},10);"number"==typeof e&&setTimeout(function(){return a=!0},e)})}function deferred(){var e,t,r=new Promise(function(r,n){e=r,t=n});return{resolve:e,reject:t,promise:r}}function convertCallbackFun(e){return function(){var t=Array.from(arguments),r=this;return new Promise(function(n,i){t.push(function(e,t){return e?i(e):n(t)}),e.apply(r,t)})}}function convertCallbackFunWithManyArgs(e){return function(){var t=Array.from(arguments),r=this;return new Promise(function(n,i){t.push(function(){var e=Array.from(arguments),t=e.shift();return t?i(t):n(e)}),e.apply(r,t)})}}function _chainResolveNext(e,t,r,n,i){var o=e.shift();if(o)try{Promise.resolve(o(t,r)).then(function(t){return _chainResolveNext(e,t,r,n,i)}).catch(function(e){i(e)})}catch(e){i(e)}else n(t)}function chain$1(e){return new Promise(function(t,r){return _chainResolveNext(e.slice(),void 0,{},t,r)})}function promise_finally(e,t){return Promise.resolve(e).then(function(e){try{t()}catch(e){console.error("Error in promise finally: "+e.stack||e)}return e}).catch(function(e){try{t()}catch(e){console.error("Error in promise finally: "+e.stack||e)}throw e})}function parallel(e){function t(){n--;try{var t=a++;e[t]().then(function(e){n++,i[t]=e,0==--s?u():r()}).catch(function(e){return c(e)})}catch(e){c(e)}}function r(){for(;!o&&s>0&&a<e.length&&n>0;)t()}var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;if(!e.length)return Promise.resolve([]);var i=[],o=null,a=0,s=e.length,u=void 0,c=void 0;return new Promise(function(e,t){u=function(){return e(i)},c=function(e){return t(o=e)},r()})}function Path(e,t){return e instanceof Path?e:this instanceof Path?(this.setSplitter(t||"."),void this.fromPath(e)):new Path(e,t)}function clone$2(e){var t={};for(var r in e)t[r]=e[r].slice();return t}function without$1(e,t){var r={};for(var n in e)if(!t.includes(n)){r[n]=[];for(var i=e[n],o=0;o<i.length;o++){var a=i[o];t.includes(a)||r[n].push(a)}}return r}function hull(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;if(!Array.isArray(e[t]))return[];for(var i=[],o={},a={},s=0;s<r.length;s++)a[r[s]]=!0;for(var u=e[t].slice(),c={},l=u.length;l--;){var f=u[l];f in a?u.splice(l,1):c[f]=1}if(r)for(;;){if(0===u.length)break;for(var p=0;p<u.length;p++){var h=u.shift();if(!(h in o||h in a)){var d=c[h]||0;if(!(d>n)){i.push(h),o[h]=!0;var m=e[h];if(m)for(var v=0;v<m.length;v++){var y=m[v];y in o||y in c||(c[y]=d+1,u.push(y))}}}}}return i}function subgraphReachableBy(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;r&&(e=without$1(e,r));for(var i=[t],o=0,a={};i.length&&o++<n;){var s=i.shift();if(!a[s]){var u=e[s]||[];a[s]=u,i.push.apply(i,toConsumableArray(u))}}return a}function invert(e){var t={};for(var r in e)for(var n=e[r],i=0;i<n.length;i++){var o=n[i];t[o]?t[o].push(r):t[o]=[r]}return t}function sortByReference(e,t){var r=[],n={},i={},o={};for(var a in e){n.hasOwnProperty(a)||(n[a]=!0,r.push(a));var s=e[a],u={};if(s){i[a]=[];var c=!0,l=!1,f=void 0;try{for(var p,h=s[Symbol.iterator]();!(c=(p=h.next()).done);c=!0){var d=p.value;if(!u.hasOwnProperty(d)&&a!==d){var m=o[d]||(o[d]=[]);m.includes(a)||m.push(a),u[d]=!0,i[a].push(d),n.hasOwnProperty(d)||(n[d]=!0,r.push(d))}}}catch(e){l=!0,f=e}finally{try{!c&&h.return&&h.return()}finally{if(l)throw f}}}}for(var v=[];r.length;){for(var y=1/0,g=[],b=[],_=[],x=0;x<r.length;x++){var w=i[F=r[x]]||[];if(!(w.length>y))if(w.length!==y||w.some(function(e){return g.includes(e)}))y=w.length,g=[F],b=[x],_=(o[F]||[]).slice();else{var k;g.push(F),b.push(x),(k=_).push.apply(k,toConsumableArray(o[F]||[]))}}for(x=b.length;x--;)o[F=r[b[x]]]=[],r.splice(b[x],1);var E=!0,S=!1,A=void 0;try{for(var D,C=_[Symbol.iterator]();!(E=(D=C.next()).done);E=!0){var F=D.value;i[F]=i[F].filter(function(e){return!g.includes(e)})}}catch(e){S=!0,A=e}finally{try{!E&&C.return&&C.return()}finally{if(S)throw A}}v.push(g)}return v}function reduce$1(e,t,r,n,i,o){function a(r){s.indexOf(r)>-1||(n=e.call(o,n,r,u++),s=s.concat([r]),withoutAll(t[r]||[],s).forEach(function(e){return a(e)}))}var s=i||[],u=0;return a(r),n}function random$1(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t={},r=range(1,e).map(String),n=0;n<r.length;n++){var i=Math.floor(Math.random()*e);t[r[n]]=shuffle(r).slice(0,i)}return t}function isInterval(e){return Array.isArray(e)&&e.length>=2&&e[0]<=e[1]}function sort$2(e){return e.sort(compare)}function compare(e,t){return e[0]<t[0]?e[1]<t[0]?-3:e[1]===t[0]?-2:-1:e[0]===t[0]?e[1]===t[1]?0:e[1]<t[1]?-1:1:-1*compare(t,e)}function coalesce(e,t,r){switch(this.compare(e,t)){case-3:case 3:return null;case 0:return r&&r(e,t,e),e;case 2:case 1:var n=e;e=t,t=n;case-2:case-1:var i=[e[0],Math.max(e[1],t[1])];return r&&r(e,t,i),i;default:throw new Error("Interval compare failed")}}function coalesceOverlapping(e,t){for(var r=[],n=e.length;n>0;){var i=e.shift();n--;for(var o=0;o<n;o++){var a=coalesce(i,e[o],t);a&&(i=a,e.splice(o,1),n--,o--)}r.push(i)}return this.sort(r)}function mergeOverlapping(e,t,r){for(var n=[];e.length>0;){var i=e.shift(),o=t.map(function(e){var t=compare(i,e);return-1===t||0===t||1===t});n.push(r(i,o[0])),n.push(i)}return n}function intervalsInRangeDo(e,t,r,n,i,o){o=o||GLOBAL$2,r=this.sort(r);for(var a,s=[];a=r.shift();)if(!(a[1]<e)){a[0]<e&&((a=Array.prototype.slice.call(a))[0]=e);var u=t<a[0]?t:a[0];if(e<u&&s.push(n.call(o,[e,u],!0)),t<a[1]&&((a=Array.prototype.slice.call(a))[1]=t),a[0]===a[1]){var c;i&&(c=s.slice(-1)[0])&&i.call(o,c,a,c)}else s.push(n.call(o,a,!1));if((e=a[1])>=t)break}return e<t&&s.push(n.call(o,[e,t],!0)),s}function intervalsInbetween(e,t,r){return intervalsInRangeDo(e,t,coalesceOverlapping(Array.prototype.slice.call(r)),function(e,t){return t?e:null}).filter(Boolean)}function mapToMatchingIndexes(e,t){var r,n,i=0;return t.map(function(t){for(;(n=e[i])&&n[0]<t[0];)i++;if(n&&n[0]===t[0]){for(r=i;(n=e[r])&&n[1]<t[1];)r++;if(n&&n[1]===t[1])return range(i,r)}return[]})}function create(e,t,r){var n=r||0;return n+t>e.length&&(n-=n+t-e.length),{array:e,from:n,to:n+t}}function toArray$4(e){return e.array.slice(e.from,e.to)}function originalToProjectedIndex(e,t){return t<e.from||t>=e.to?null:t-e.from}function projectedToOriginalIndex(e,t){return t<0||t>e.to-e.from?null:e.from+t}function transformToIncludeIndex(e,t){if(!(t in e.array))return null;var r=0;return t<e.from&&(r=-e.from+t),t>=e.to&&(r=t-e.to+1),0===r?e:create(e.array,e.to-e.from,e.from+r)}function get$2(e,t,r){var n=e[t];return n?n[r]:void 0}function set$2(e,t,r,n){var i=e[t];return i&&(i[r]=n),n}function getRow(e,t){return e[t]}function setRow(e,t,r){return e[t]=r}function getCol(e,t){return e.reduce(function(e,r){return e.push(r[t]),e},[])}function setCol(e,t,r){return e.map(function(e,n){return e[t]?e[t]=r[n]:void 0})}function create$1(e,t,r){for(var n=new Array(e);e>0;)n[--e]=withN(t,r);return n}function mapCreate(e,t,r,n){for(var i=new Array(e),o=0;o<e;o++){i[o]=new Array(t);for(var a=0;a<t;a++)i[o][a]=r.call(n||this,o,a)}return i}function forEach$2(e,t,r){e.forEach(function(e,n){e.forEach(function(e,i){t.call(r||this,e,n,i)})})}function map$2(e,t,r){var n=new Array(e.length);return e.forEach(function(e,i){n[i]=new Array(e.length),e.forEach(function(e,o){n[i][o]=t.call(r||this,e,i,o)})}),n}function toObjects(e){for(var t=e[0],r=new Array(e.length-1),n=1;n<e.length;n++)for(var i=r[n-1]={},o=0;o<t.length;o++)i[t[o]]=e[n][o];return r}function tableFromObjects(e,t){Array.isArray(e)||(e=[e]);var r=[[]],n=r[0],i=e.reduce(function(e,t){return e.concat([Object.keys(t).reduce(function(e,r){var i=n.indexOf(r);return-1===i&&(i=n.length,n.push(r)),e[i]=t[r],e},[])])},[]);return t=1===arguments.length?null:t,i.forEach(function(e){for(var r=0;r<n.length;r++)e[r]||(e[r]=t)}),r.concat(i)}function prewalk(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{i:0},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=n.i++;t(e,o,i),(r(e,o,i)||[]).forEach(function(e){return prewalk(e,t,r,n,i+1)})}function postwalk(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{i:0},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=n.i++;(r(e,o,i)||[]).forEach(function(e){return postwalk(e,t,r,n,i)}),t(e,o,i)}function find(e,t,r){if(t(e))return e;var n=r(e);if(n&&n.length)for(var i=0;i<n.length;i++){var o=find(n[i],t,r);if(o)return o}}function filter$1(e,t,r){var n=[];return t(e)&&n.push(e),n.concat(flatten((r(e)||[]).map(function(e){return filter$1(e,t,r)})))}function map$3(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return[t(e,n)].concat(flatten((r(e)||[]).map(function(e){return map$3(e,t,r,n+1)})))}function mapTree(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=(r(e)||[]).map(function(e){return mapTree(e,t,r,n+1)});return t(e,i,n)}function create$2(e){var t=[{name:"send",args:["msg","callback"]},{name:"listen",args:["messenger","callback"]},{name:"close",args:["messenger","callback"]},{name:"isOnline",args:[]}],r=t.map(function(e){return e.name}).concat(["id","sendHeartbeat","heartbeatInterval","ignoreUnknownMessages","allowConcurrentSends","sendTimeout","services"]);t.forEach(function(t){if(!e[t.name]){var r="message implementation needs function "+t.name+"("+t.args.join(",")+")";throw new Error(r)}});var n=e.sendHeartbeat&&(e.heartbeatInterval||1e3),i=!!e.hasOwnProperty("ignoreUnknownMessages")&&e.ignoreUnknownMessages,o={_outgoing:[],_inflight:[],_id:e.id||newUUID(),_ignoreUnknownMessages:i,_services:{},_messageCounter:0,_messageResponseCallbacks:{},_whenOnlineCallbacks:[],_statusWatcherProc:null,_startHeartbeatProcessProc:null,_listenInProgress:null,_heartbeatInterval:n,_status:OFFLINE,_runWhenOnlineCallbacks:function(){var e=o._whenOnlineCallbacks.slice();o._whenOnlineCallbacks=[],e.forEach(function(e){try{e.call(null,null,o)}catch(e){console.error("error in _runWhenOnlineCallbacks: %s",e)}})},_ensureStatusWatcher:function(){o._statusWatcherProc||(o._statusWatcherProc=setInterval(function(){o.isOnline()&&o._whenOnlineCallbacks.length&&o._runWhenOnlineCallbacks();var e=o._status;o._status=o.isOnline()?ONLINE:OFFLINE,o._status!==ONLINE&&o._statusWatcherProc&&o.reconnect(),o._status!==e&&o.onStatusChange&&o.onStatusChange()},20))},_addMissingData:function(e){if(!e.target)throw new Error("Message needs target!");if(!e.action)throw new Error("Message needs action!");return e.data||(e.data=null),e.messageId||(e.messageId=newUUID()),e.sender=o.id(),e.messageIndex=o._messageCounter++,e},_queueSend:function(e,t){if(t&&"function"!=typeof t)throw new Error("Expecing a when send callback, got: "+t);o._outgoing.push([e,t])},_deliverMessageQueue:function(){function t(t){if(-1!==o._inflight.indexOf(t)){var n=t[0],i=t[1];i&&(o._messageResponseCallbacks[n.messageId]=i),e.send.call(o,n,function(e){remove(o._inflight,t),e&&r(e,t),o._deliverMessageQueue()})}}function r(e,t){var r=t[0],n=t[1];delete o._messageResponseCallbacks[r.messageId],console.error(e),n&&n(e)}if(e.allowConcurrentSends||!o._inflight.length){var n=o._outgoing.shift();n&&(o._inflight.push(n),o.isOnline()?t(n):o.whenOnline(function(){t(n)}),function(t){"number"==typeof e.sendTimeout&&setTimeout(function(){-1!==o._inflight.indexOf(t)&&(remove(o._inflight,t),r(new Error("Timeout sending message"),t),o._deliverMessageQueue())},e.sendTimeout)}(n),e.allowConcurrentSends&&o._outgoing.length&&o._deliverMessageQueue())}},_startHeartbeatProcess:function(){o._startHeartbeatProcessProc||(o._startHeartbeatProcessProc=setTimeout(function(){e.sendHeartbeat.call(o,function(e,t){o._startHeartbeatProcessProc=null,o._startHeartbeatProcess()})},o._heartbeatInterval))},id:function(){return o._id},isOnline:function(){return e.isOnline.call(o)},heartbeatEnabled:function(){return"number"==typeof o._heartbeatInterval},listen:function(t){if(!o._listenInProgress)return o._listenInProgress=!0,o._ensureStatusWatcher(),e.listen.call(o,function(e){o._listenInProgress=null,t&&t(e),o.heartbeatEnabled()&&o._startHeartbeatProcess()})},reconnect:function(){if(o._status!==ONLINE)return o.listen(),o},send:function(e,t){return o._addMissingData(e),o._queueSend(e,t),o._deliverMessageQueue(),e},sendTo:function(e,t,r,n){var i={target:e,action:t,data:r};return o.send(i,n)},onMessage:function(e){if(o.emit("message",e),e.inResponseTo){var t=o._messageResponseCallbacks[e.inResponseTo];t&&!e.expectMoreResponses&&delete o._messageResponseCallbacks[e.inResponseTo],t&&t(null,e)}else{var r=o._services[e.action];if(r)try{r.call(null,e,o)}catch(t){var n=String(t.stack||t);console.error("Error invoking service: "+n),o.answer(e,{error:n})}else if(!o._ignoreUnknownMessages){var i=new Error("messageNotUnderstood: "+e.action);o.answer(e,{error:String(i)})}}},answer:function(e,t,r,n){"function"==typeof r&&(n=r,r=!1);var i={target:e.sender,action:e.action+"Result",inResponseTo:e.messageId,data:t};return r&&(i.expectMoreResponses=!0),o.send(i,n)},close:function(t){return clearInterval(o._statusWatcherProc),o._statusWatcherProc=null,e.close.call(o,function(e){o._status=OFFLINE,t&&t(e)}),o},whenOnline:function(e){return o._whenOnlineCallbacks.push(e),o.isOnline()&&o._runWhenOnlineCallbacks(),o},outgoingMessages:function(){return pluck(o._inflight.concat(o._outgoing),0)},addServices:function(e){return Object.assign(o._services,e),o}};e.services&&o.addServices(e.services),makeEmitter(o);for(var a in e)-1===r.indexOf(a)&&e.hasOwnProperty(a)&&(o[a]=e[a]);return o}function fork(e,t,r){r||(r=t,t=e,e=null);var n=(e=e||{}).args||[],i=create$3(e);return i.run.apply(i,[t].concat(n).concat(r)),i}function create$3(e){(e=e||{}).useMessenger=!0;var t=e.workerId||newUUID(),r=create$2({sendTimeout:5e3,send:function(e,t){r.worker.postMessage(e),t()},listen:function(t){var n=r.worker=isNodejs?NodejsWorker.create(e):BrowserWorker.create(e);n.on("message",function(e){r.onMessage(e)}),n.on("ready",function(){NodejsWorker.debug&&console.log("WORKER READY!!!")}),n.on("close",function(){NodejsWorker.debug&&console.log("WORKER CLOSED...!!!")}),n.once("ready",t)},close:function(e){return r.worker.ready?r.sendTo(t,"close",{},function(t,n){if((t=t||n.data.error)&&console.error("Error in worker messenger close: "+t.stack||t),t)e(t);else{var i=!1;r.worker.once("close",function(){i=!0}),waitFor(1e3,function(){return!!i},e)}}):e(null)},isOnline:function(){return r.worker&&r.worker.ready}});return Object.assign(r,{eval:function(e,n){r.sendTo(t,"remoteEval",{expr:e},function(e,t){n(e,t?t.data.result:null)})},run:function(){var e=Array.prototype.slice.call(arguments),n=e.shift(),i=e.pop();if("function"!=typeof n)throw new Error("run: no function that should run in worker passed");if("function"!=typeof i)throw new Error("run: no callback passed");return r.sendTo(t,"run",{func:String(n),args:e},function(e,t){i(e||t.data.error,t?t.data.result:null)})}}),r.listen(),r}function createLivelyLangObject(){return{chain:chain$$1,noConflict:noConflict,installGlobals:installGlobals,uninstallGlobals:uninstallGlobals,globalInterfaceSpec:globalInterfaceSpec,toString:function(){return"[object lively.lang]"}}}function chain$$1(e){if(!e)return e;if(Array.isArray(e))return createChain(arr,e);if("Date"===e.constructor.name)return createChain(date,e);switch(void 0===e?"undefined":_typeof(e)){case"string":return createChain(string,e);case"object":return createChain(obj,e);case"function":return createChain(fun,e);case"number":return createChain(num,e)}throw new Error("Chain for object "+e+" ("+e.constructor.name+") no supported")}function createChain(e,t){return Object.keys(e).reduce(function(r,n){return r[n]=function(){var r=Array.prototype.slice.call(arguments);return chain$$1(e[n].apply(null,[t].concat(r)))},r},{value:function(){return t}})}function noConflict(){return isNode||(livelyLang._prevLivelyGlobal?delete GLOBAL.lively.lang:delete GLOBAL.lively),livelyLang}function installGlobals(){Object.assign(livelyLang,{worker:worker,messenger:messenger,events:events,tree:tree,grid:grid,arrayProjection:arrayProjection,interval:interval,graph:graph,date:date,properties:properties,obj:obj,arr:arr,fun:fun,num:num,string:string,Closure:Closure,promise:promise,Path:Path,Group:Group}),globalInterfaceSpec.forEach(function(e){if("installMethods"===e.action){(r=Path(e.target)).isIn(GLOBAL)||r.set(GLOBAL,{},!0);var t=Path(e.sources[0]);e.methods.forEach(function(e){installProperty(t.concat([e]),r.concat([e]))}),e.alias&&e.alias.forEach(function(e){installProperty(t.concat([e[1]]),r.concat([e[0]]))})}else{if("installObject"!==e.action)throw new Error("Cannot deal with global setup action: "+e.action);var r=Path(e.target),n=Path(e.source).get(livelyLang);r.set(GLOBAL,n,!0)}})}function installProperty(e,t){if(!e.isIn(livelyLang)){var r=new Error("property not provided by lively.lang: "+e);throw console.error(r.stack||r),r}var n=e.get(livelyLang);if("function"==typeof n&&"prototype"===t.slice(-2,-1).toString()){var i=n;(n=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this),i.apply(null,e)}).toString=function(){return i.toString()}}t.set(GLOBAL,n,!0)}function uninstallGlobals(){globalInterfaceSpec.forEach(function(e){if("installMethods"===e.action){var t=Path(e.target),r=Path(e.source).get(livelyLang),n=t.get(GLOBAL);if(!n)return;e.methods.filter(function(e){return r===n[e]}).forEach(function(e){delete n[e]}),e.alias&&e.alias.filter(function(e){return r===n[e]}).forEach(function(e){delete n[e[0]]})}else{if("installObject"!==e.action)throw new Error("Cannot deal with global setup action: "+e.action);(t=Path(e.target)).del(GLOBAL)}})}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),get$1=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},set$1=function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var s=o.set;void 0!==s&&s.call(i,n)}return n},slicedToArray=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},parameterRegex=/function[^\(]*\(([^\)]*)\)|\(?([^\)=]*)\)?\s*=>/,Closure=function(){function e(t,r,n,i){classCallCheck(this,e),this.originalFunc=t,this.varMapping=r||{},this.setFuncSource(n||t),this.setFuncProperties(t||i)}return createClass(e,null,[{key:"fromFunction",value:function(e,t){return new this(e,t||{})}},{key:"fromSource",value:function(e,t){return new this(null,t||{},e)}}]),createClass(e,[{key:"setFuncSource",value:function(e){return e="undefined"!=typeof lively&&lively.sourceTransform&&"function"==typeof lively.sourceTransform.stringifyFunctionWithoutToplevelRecorder?lively.sourceTransform.stringifyFunctionWithoutToplevelRecorder(e):String(e),this.source=e}},{key:"getFuncSource",value:function(){return this.source||this.setFuncSource(this.originalFunc)}},{key:"hasFuncSource",value:function(){return this.source&&!0}},{key:"getFunc",value:function(){return this.originalFunc||this.recreateFunc()}},{key:"getFuncProperties",value:function(){return this.funcProperties||(this.funcProperties={})}},{key:"setFuncProperties",value:function(e){var t=this.getFuncProperties();for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])}},{key:"lookup",value:function(e){return this.varMapping[e]}},{key:"parameterNames",value:function(e){if("undefined"!=typeof lively&&lively.ast)return(lively.ast.parseFunction(e).params||[]).map(function(e){return"Identifier"===e.type?e.name:e.left&&"Identifier"===e.left.type?e.left.name:null}).filter(Boolean);var t=parameterRegex.exec(e);return t?(t[1]||t[2]||"").split(",").map(function(e){return e.trim()}):[]}},{key:"firstParameter",value:function(e){return this.parameterNames(e)[0]||null}},{key:"recreateFunc",value:function(){return this.recreateFuncFromSource(this.getFuncSource(),this.originalFunc)}},{key:"recreateFuncFromSource",value:function(e,t){var r=[],n="$super"===this.firstParameter(e);for(var i in this.varMapping)this.varMapping.hasOwnProperty(i)&&("this"!=i?r.push("var "+i+" = this.varMapping."+i+";\n"):!0);var o="";r.length>0&&(o+=r.join("\n")),n&&(o+="(function superWrapperForClosure() { return "),o+="("+e+")",n&&(o+=".apply(this, [$super.bind(this)].concat(Array.from(arguments))) })");try{var a=evalJS.call(this,o)||this.couldNotCreateFunc(o);return this.addFuncProperties(a),this.originalFunc=a,a}catch(e){var s="Cannot create function "+e+" src: "+o;throw console.error(s),new Error(s)}}},{key:"addFuncProperties",value:function(e){var t=this.getFuncProperties();for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);this.addClosureInformation(e)}},{key:"couldNotCreateFunc",value:function(e){var t="Could not recreate closure from source: \n"+e;return console.error(t),function(){throw new Error(t)}}},{key:"asFunction",value:function(){return this.recreateFunc()}},{key:"addClosureInformation",value:function(e){return e.hasLivelyClosure=!0,e.livelyClosure=this,e}},{key:"isLivelyClosure",get:function(){return!0}},{key:"doNotSerialize",get:function(){return["originalFunc"]}}]),e}(),_throttledByName={},_debouncedByName={},_queues={},_queueUntilCallbacks={},_eitherNameRegistry={},fun=Object.freeze({Empty:Empty,K:K,Null:Null,False:False,True:True,notYetImplemented:notYetImplemented,withNull:withNull,all:all,own:own,argumentNames:argumentNames,qualifiedMethodName:qualifiedMethodName,extractBody:extractBody,timeToRun:timeToRun,timeToRunN:timeToRunN$1,delay:delay,throttle:throttle,debounce:debounce,throttleNamed:throttleNamed,debounceNamed:debounceNamed,createQueue:createQueue,workerWithCallbackQueue:workerWithCallbackQueue,composeAsync:composeAsync,compose:compose,waitFor:waitFor,waitForAll:waitForAll,flip:flip,curry:curry,wrap:wrap,binds:binds,getOriginal:getOriginal,wrapperChain:wrapperChain,replaceMethodForOneCall:replaceMethodForOneCall,once:once,either:either,eitherNamed:eitherNamed,evalJS:evalJS,fromString:fromString,asScript:asScript,asScriptOf:asScriptOf,addToObject:addToObject,setLocalVarValue:setLocalVarValue,getVarMapping:getVarMapping,setProperty:setProperty,functionNames:functionNames,localFunctionNames:localFunctionNames,logErrors:logErrors,logCompletion:logCompletion,logCalls:logCalls,traceCalls:traceCalls,webkitStack:webkitStack}),Group=function(){function e(){classCallCheck(this,e)}return createClass(e,[{key:"toArray",value:function(){return this.reduceGroups(function(e,t,r){return e.concat([r])},[])}},{key:"forEach",value:function(e,t){var r=this;return Object.keys(r).forEach(function(n){r[n].forEach(e.bind(t,n))}),r}},{key:"forEachGroup",value:function(e,t){var r=this;return Object.keys(r).forEach(function(n){e.call(t,n,r[n])}),r}},{key:"map",value:function(t,r){var n=new e;return this.forEachGroup(function(e,i){n[e]=i.map(t.bind(r,e))}),n}},{key:"mapGroups",value:function(t,r){var n=new e;return this.forEachGroup(function(e,i){n[e]=t.call(r,e,i)}),n}},{key:"keys",value:function(){return Object.keys(this)}},{key:"reduceGroups",value:function(e,t,r){return this.forEachGroup(function(n,i){t=e.call(r,t,n,i)}),t}},{key:"count",value:function(){return this.reduceGroups(function(e,t,r){return e[t]=r.length,e},{})}}],[{key:"fromArray",value:function(t,r,n){for(var i=new e,o=0,a=t.length;o<a;o++){var s=r.call(n,t[o],o);i[s]||(i[s]=[]),i[s].push(t[o])}return i}},{key:"by",get:function(){return groupBy}}]),e}(),GLOBAL$1="undefined"!=typeof System?System.global:"undefined"!=typeof window?window:global,features$1={from:!!Array.from,filter:!!Array.prototype.filter,find:!!Array.prototype.find,findIndex:!!Array.prototype.findIndex,includes:!!Array.prototype.includes},from=features$1.from?Array.from:function(e){if(!e)return[];if(Array.isArray(e))return e;if(e.toArray)return e.toArray();for(var t=e.length,r=new Array(t);t--;)r[t]=e[t];return r},detect=features$1.find?function(e,t,r){return e.find(t,r)}:function(e,t,r){for(var n,i=0,o=e.length;i<o;i++)if(n=e[i],t.call(r,n,i))return n},findIndex=features$1.findIndex?function(e,t,r){return e.findIndex(t,r)}:function(e,t,r){var n=-1;return e.find(function(e,i){return n=i,t.call(e,r)})?n:-1},isArray$1=Array.isArray,includes$1=features$1.includes?function(e,t){return e.includes(t)}:function(e,t){return-1!==e.indexOf(t)},include$1=includes$1,permutations=function(){function e(t,r){return t.length?flatmap(t,function(n,i){return e(t.slice(0,i).concat(t.slice(i+1)),r.concat([n]))}):[r]}return function(t){return e(t,[])}}();features$1.from||(Array.from=from),features$1.filter||(Array.prototype.filter=function(e,t){return filter(this,e,t)}),features$1.find||(Array.prototype.find=function(e,t){return detect(this,e,t)}),features$1.findIndex||(Array.prototype.findIndex=function(e,t){return findIndex(this,e,t)}),features$1.includes||(Array.prototype.includes=function(e){return includes$1(this,e)});var arr=Object.freeze({range:range,from:from,withN:withN,genN:genN,filter:filter,detect:detect,findIndex:findIndex,findAndGet:findAndGet,filterByKey:filterByKey,grep:grep,mask:mask,reject:reject,rejectByKey:rejectByKey,without:without,withoutAll:withoutAll,uniq:uniq,uniqBy:uniqBy,uniqByKey:uniqByKey,compact:compact,mutableCompact:mutableCompact,forEach:forEach$1,zip:zip,flatten:flatten,flatmap:flatmap,interpose:interpose,delimWith:delimWith,map:map$1,invoke:invoke,pluck:pluck,reduce:reduce,reduceRight:reduceRight,isArray:isArray$1,includes:includes$1,include:include$1,some:some,every:every,equals:equals$2,deepEquals:deepEquals,isSorted:isSorted,sort:sort,sortBy:sortBy,sortByKey:sortByKey,reverse:reverse,reversed:reversed,reMatches:reMatches$1,first:first,last:last,intersect:intersect,union:union,pushAt:pushAt,removeAt:removeAt,remove:remove,pushAll:pushAll$1,pushAllAt:pushAllAt,pushIfNotIncluded:pushIfNotIncluded,replaceAt:replaceAt,clear:clear,isSubset:isSubset,doAndContinue:doAndContinue,nestedDelay:nestedDelay,forEachShowingProgress:forEachShowingProgress,swap:swap,rotate:rotate,groupBy:groupBy,groupByKey:groupByKey,partition:partition,batchify:batchify,toTuples:toTuples,permutations:permutations,combinationsPick:combinationsPick,combinations:combinations,take:take,drop:drop,takeWhile:takeWhile,dropWhile:dropWhile,shuffle:shuffle,max:max,min:min,sum:sum,count:count$1,size:size$1,histogram:histogram,clone:clone$1,toArray:toArray$3,each:each,all:all$1,any:any,collect:collect,findAll:findAll,inject:inject,mapAsyncSeries:mapAsyncSeries,mapAsync:mapAsync}),getOwnPropertyDescriptors="function"==typeof Object.prototype.getOwnPropertyDescriptors?Object.prototype.getOwnPropertyDescriptors:function(e){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&Object.defineProperty(t,r,{configurable:!0,enumerable:!0,writable:!0,value:Object.getOwnPropertyDescriptor(e,r)});return t},keys$1=Object.keys,obj=Object.freeze({isArray:isArray$$1,isElement:isElement,isFunction:isFunction,isBoolean:isBoolean,isString:isString,isNumber:isNumber,isUndefined:isUndefined,isRegExp:isRegExp,isObject:isObject,isPrimitive:isPrimitive,isEmpty:isEmpty,equals:equals$1,keys:keys$1,values:values,select:select,dissoc:dissoc,addScript:addScript,extend:extend,clone:clone$$1,extract:extract,inspect:inspect,merge:merge,deepMerge:deepMerge,inherit:inherit,valuesInPropertyHierarchy:valuesInPropertyHierarchy,mergePropertyInHierarchy:mergePropertyInHierarchy,sortKeysWithBeforeAndAfterConstraints:sortKeysWithBeforeAndAfterConstraints,deepCopy:deepCopy,typeStringOf:typeStringOf,shortPrintStringOf:shortPrintStringOf,isMutableType:isMutableType,safeToString:safeToString,asObject:asObject,newKeyIn:newKeyIn}),features={repeat:!!String.prototype.repeat,includes:!!String.prototype.includes,startsWith:!!String.prototype.startsWith,endsWith:!!String.prototype.endsWith},pathDotRe=/\/\.\//g,pathDoubleDotRe=/\/[^\/]+\/\.\./,pathDoubleSlashRe=/(^|[^:])[\/]+/g,urlStartRe=/^[a-z0-9-_\.]+:\/\//,newUUIDTemplate="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",newUUIDRe=/[xy]/g,newUUIDReplacer=function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)},includes$$1=features.includes?function(e,t){return e.includes(t)}:function(e,t){return e.indexOf(t)>-1},include$$1=includes$$1,startsWith=features.startsWith?function(e,t){return e.startsWith(t)}:function(e,t){return 0===e.indexOf(t)},endsWith=features.endsWith?function(e,t){return e.endsWith(t)}:function(e,t){var r=e.length-t.length;return r>=0&&e.lastIndexOf(t)===r},times=features.repeat?function(e,t){return e.repeat(t)}:function(e,t){return t<1?"":new Array(t+1).join(e)},string=Object.freeze({format:format,formatFromArray:formatFromArray,indent:indent,minIndent:minIndent,changeIndent:changeIndent,quote:quote,print:print,printNested:printNested,pad:pad,printTable:printTable,printTree:printTree,toArray:toArray$1,lines:lines,paragraphs:paragraphs,nonEmptyLines:nonEmptyLines,tokens:tokens,tableize:tableize,unescapeCharacterEntities:unescapeCharacterEntities,toQueryParams:toQueryParams,normalizePath:normalizePath$1,joinPath:joinPath,newUUID:newUUID,createDataURI:createDataURI,hashCode:hashCode,md5:md5,reMatches:reMatches$$1,stringMatch:stringMatch,peekRight:peekRight,peekLeft:peekLeft,lineIndexComputer:lineIndexComputer,lineNumberToIndexesComputer:lineNumberToIndexesComputer,findLineWithIndexInLineRanges:findLineWithIndexInLineRanges,regexIndexOf:regexIndexOf,regexLastIndexOf:regexLastIndexOf,lineRanges:lineRanges,diff:diff,empty:empty,includes:includes$$1,include:include$$1,startsWith:startsWith,startsWithVowel:startsWithVowel,endsWith:endsWith,withDecimalPrecision:withDecimalPrecision,capitalize:capitalize,camelCaseString:camelCaseString,camelize:camelize,truncate:truncate,truncateLeft:truncateLeft,regExpEscape:regExpEscape,succ:succ,digitValue:digitValue,times:times,longestCommonSubstring:longestCommonSubstring,applyChange:applyChange,applyChanges:applyChanges,levenshtein:levenshtein}),normalRandom=function(e,t){var r,n=!1;return function(e,t){if(n)return n=!1,r*t+e;var i,o,a;do{a=(i=2*Math.random()-1)*i+(o=2*Math.random()-1)*o}while(a>=1||0==a);var s=Math.sqrt(-2*Math.log(a)/a);return r=o*s,n=!0,e+t*i*s}}(),convertLength=function(){function e(t,r){return"cm"===r?t:"mm"===r?.1*t:"in"===r?2.54*t:"px"===r?t*e(1/96,"in"):"pt"===r?t*e(1/72,"in"):"pc"===r?t*e(12,"pt"):void 0}return function t(r,n,i){return n===i?r:"cm"===i?e(r,n):"cm"===n?r/e(1,i):t(t(r,n,"cm"),"cm",i)}}(),num=Object.freeze({random:random,normalRandom:normalRandom,randomSmallerInteger:randomSmallerInteger,humanReadableByteSize:humanReadableByteSize,average:average,averageInc:averageInc,median:median,between:between,sort:sort$1,parseLength:parseLength,convertLength:convertLength,roundTo:roundTo,detent:detent,toDegrees:toDegrees,toRadians:toRadians,backoff:backoff}),properties=Object.freeze({all:all$2,allOwnPropertiesOrFunctions:allOwnPropertiesOrFunctions,own:own$1,forEachOwn:forEachOwn,nameFor:nameFor,values:values$1,ownValues:ownValues,any:any$1,allProperties:allProperties,hash:hash}),dateFormat=function(){var e=function(){var t=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,r=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,i=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e};return function(o,a,s){var u=e;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(o)||/\d/.test(o)||(a=o,o=void 0),o=o?new Date(o):new Date,isNaN(o))throw SyntaxError("invalid date");"UTC:"==(a=String(u.masks[a]||a||u.masks.default)).slice(0,4)&&(a=a.slice(4),s=!0);var c=s?"getUTC":"get",l=o[c+"Date"](),f=o[c+"Day"](),p=o[c+"Month"](),h=o[c+"FullYear"](),d=o[c+"Hours"](),m=o[c+"Minutes"](),v=o[c+"Seconds"](),y=o[c+"Milliseconds"](),g=s?0:o.getTimezoneOffset(),b={d:l,dd:i(l),ddd:u.i18n.dayNames[f],dddd:u.i18n.dayNames[f+7],m:p+1,mm:i(p+1),mmm:u.i18n.monthNames[p],mmmm:u.i18n.monthNames[p+12],yy:String(h).slice(2),yyyy:h,h:d%12||12,hh:i(d%12||12),H:d,HH:i(d),M:m,MM:i(m),s:v,ss:i(v),l:i(y,3),L:i(y>99?Math.round(y/10):y),t:d<12?"a":"p",tt:d<12?"am":"pm",T:d<12?"A":"P",TT:d<12?"AM":"PM",Z:s?"UTC":(String(o).match(r)||[""]).pop().replace(n,""),o:(g>0?"-":"+")+i(100*Math.floor(Math.abs(g)/60)+Math.abs(g)%60,4),S:["th","st","nd","rd"][l%10>3?0:(l%100-l%10!=10)*l%10]};return a.replace(t,function(e){return e in b?b[e]:e.slice(1,e.length-1)})}}();return e.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},e.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},e}(),date=Object.freeze({format:format$1,equals:equals$3,relativeTo:relativeTo});Object.assign(promise,{delay:delay$1,delayReject:delayReject,timeout:timeout,waitFor:waitFor$1,deferred:deferred,convertCallbackFun:convertCallbackFun,convertCallbackFunWithManyArgs:convertCallbackFunWithManyArgs,chain:chain$1,finally:promise_finally,parallel:parallel}),Object.assign(Path.prototype,{get isPathAccessor(){return!0},fromPath:function(e){return"string"==typeof e&&""!==e&&e!==this.splitter?(this._parts=e.split(this.splitter),this._path=e):Array.isArray(e)?(this._parts=[].concat(e),this._path=e.join(this.splitter)):(this._parts=[],this._path=""),this},setSplitter:function(e){return e&&(this.splitter=e),this},parts:function(){return this._parts},size:function(){return this._parts.length},slice:function(e,t){return Path(this.parts().slice(e,t))},normalizePath:function(){return this._path},isRoot:function(e){return 0===this._parts.length},isIn:function(e){if(this.isRoot())return!0;var t=this.get(e,-1);return t&&t.hasOwnProperty(this._parts[this._parts.length-1])},equals:function(e){return e&&e.isPathAccessor&&this.parts().equals(e.parts())},isParentPathOf:function(e){e=e&&e.isPathAccessor?e:Path(e);for(var t=this.parts(),r=e.parts(),n=0;n<t.length;n++)if(t[n]!=r[n])return!1;return!0},relativePathTo:function(e){return e=Path(e),this.isParentPathOf(e)?e.slice(this.size(),e.size()):void 0},del:function(e){if(this.isRoot())return!1;for(var t=e,r=0;r<this._parts.length-1;r++){var n=this._parts[r];if(!t.hasOwnProperty(n))return!1;t=t[n]}return delete t[this._parts[this._parts.length-1]]},withParentAndKeyDo:function(e,t,r){if(this.isRoot())return r(null,null);for(var n=e,i=0;i<this._parts.length-1;i++){var o=this._parts[i];if(!n.hasOwnProperty(o)||"object"!==_typeof(n[o])&&"function"!=typeof n[o]){if(!t)return r(null,o);n=n[o]={}}else n=n[o]}return r(n,this._parts[this._parts.length-1])},set:function(e,t,r){return this.withParentAndKeyDo(e,r,function(e,r){return e?e[r]=t:void 0})},defineProperty:function(e,t,r){return this.withParentAndKeyDo(e,r,function(e,r){return e?Object.defineProperty(e,r,t):void 0})},get:function(e,t){return(t?this._parts.slice(0,t):this._parts).reduce(function(e,t){return e?e[t]:e},e)},concat:function(e,t){return Path(this.parts().concat(Path(e,t).parts()))},toString:function(){return this.normalizePath()},serializeExpr:function(){return"lively.lang.Path("+inspect(this.parts())+")"},watch:function(e){if(e&&!this.isRoot()){var t=e.target,r=this.get(t,-1),n=this.parts().slice(-1)[0],i="propertyWatcher$"+n,o=r&&r.hasOwnProperty(i),a=e.uninstall,s=(e.haltWhenChanged,e.showStack),u=r.__lookupGetter__(n),c=r.__lookupSetter__(n);if(t&&n&&r)if(a){if(!o)return;delete r[n],r[n]=r[i],delete r[i];l="Watcher for "+r+"."+n+" uninstalled";show(l)}else if(o){l="Watcher for "+r+"."+n+" already installed";show(l)}else{if(u||c){l=r+'["'+n+'"] is a getter/setter, watching not support';return console.log(l),void("undefined"==typeof show&&show(l))}r[i]=r[n],r.__defineSetter__(n,function(t){var o=r[i];e.onSet&&e.onSet(t,o);var a=r+"."+n+" changed: "+o+" -> "+t;return s&&(a+="\n"+("undefined"!=typeof lively?lively.printStack():console.trace())),e.verbose&&(console.log(a),"undefined"!=typeof show&&show(a)),r[i]=t}),r.__defineGetter__(n,function(){return e.onGet&&e.onGet(r[i]),r[i]});var l="Watcher for "+r+"."+n+" installed";console.log(l),"undefined"!=typeof show&&show(l)}}},debugFunctionWrapper:function(e){var t=e.target,r=this.get(t,-1),n=this.parts().slice(-1)[0],i=e.uninstall,o=(void 0===e.haltWhenChanged||e.haltWhenChanged,e.showStack),a=r&&n&&r[n],s=a&&a.isDebugFunctionWrapper;if(t&&n&&a&&r){if(i){if(!s)return;r[n]=r[n].debugTargetFunction;c="Uninstalled debugFunctionWrapper for "+r+"."+n;return console.log(c),"undefined"!=typeof show&&show(c),void show(c)}if(s){c="debugFunctionWrapper for "+r+"."+n+" already installed";return console.log(c),void("undefined"!=typeof show&&show(c))}var u=r[n]=a.wrap(function(t){var i=Array.from(arguments);return o&&show(lively.printStack()),e.verbose&&show(n+" called"),i.shift().apply(r,i)});u.isDebugFunctionWrapper=!0,u.debugTargetFunction=a;var c="debugFunctionWrapper for "+r+"."+n+" installed";console.log(c),"undefined"!=typeof show&&show(c)}}});var graph=Object.freeze({clone:clone$2,without:without$1,hull:hull,subgraphReachableBy:subgraphReachableBy,invert:invert,sortByReference:sortByReference,reduce:reduce$1,random:random$1}),GLOBAL$2="undefined"!=typeof System?System.global:"undefined"!=typeof window?window:global,interval=Object.freeze({isInterval:isInterval,sort:sort$2,compare:compare,coalesce:coalesce,coalesceOverlapping:coalesceOverlapping,mergeOverlapping:mergeOverlapping,intervalsInRangeDo:intervalsInRangeDo,intervalsInbetween:intervalsInbetween,mapToMatchingIndexes:mapToMatchingIndexes}),arrayProjection=Object.freeze({create:create,toArray:toArray$4,originalToProjectedIndex:originalToProjectedIndex,projectedToOriginalIndex:projectedToOriginalIndex,transformToIncludeIndex:transformToIncludeIndex}),grid=Object.freeze({get:get$2,set:set$2,getRow:getRow,setRow:setRow,getCol:getCol,setCol:setCol,create:create$1,mapCreate:mapCreate,forEach:forEach$2,map:map$2,toObjects:toObjects,tableFromObjects:tableFromObjects}),detect$1=find,tree=Object.freeze({prewalk:prewalk,postwalk:postwalk,find:find,detect:detect$1,filter:filter$1,map:map$3,mapTree:mapTree}),isNode$1="undefined"!=typeof process&&process.versions&&process.versions.node,makeEmitter=isNode$1?function(e,t){if(e.on&&e.removeListener)return e;var r="undefined"!=typeof System?System._nodeRequire("events"):require("events");return Object.assign(e,r.EventEmitter.prototype),r.EventEmitter.call(e),t&&t.maxListenerLimit&&e.setMaxListeners(t.maxListenerLimit),e}:function(e){return e.on&&e.removeListener?e:(e.listeners={},e.on=function(t,r){r&&(e.listeners[t]||(e.listeners[t]=[]),e.listeners[t].push(r))},e.once=function(t,r){function n(){e.removeListener(t,n),r.apply(this,arguments)}r&&e.on(t,n)},e.removeListener=function(t,r){e.listeners[t]&&(e.listeners[t]=e.listeners[t].filter(function(e){return e!==r}))},e.removeAllListeners=function(t){e.listeners[t]&&(e.listeners[t]=[])},e.emit=function(){var t=Array.prototype.slice.call(arguments),r=t.shift(),n=e.listeners[r];n&&n.length&&n.forEach(function(e){try{e.apply(null,t)}catch(e){console.error("Error in event handler: %s",e.stack||String(e))}})},e)},events=Object.freeze({makeEmitter:makeEmitter}),OFFLINE="offline",ONLINE="online",messenger=Object.freeze({create:create$2}),isNodejs="undefined"!=typeof require&&"undefined"!=typeof process,WorkerSetup={loadDependenciesBrowser:function(e){var t="undefined"!=typeof self?self:this;importScripts.apply(t,e.scriptsToLoad||[])},loadDependenciesNodejs:function(e){(global.lively||(global.lively={})).lang=require(require("path").join(e.libLocation,"index"))},initBrowserGlobals:function(e){remoteWorker.send=function(e){postMessage(e)};var t="undefined"!=typeof self?self:this,r=t.Global=t;r.window=r,r.console=r.console||function(){var e={};return["log","error","warn"].forEach(function(t){e[t]=function(){for(var e=arguments[0],r=1;r<arguments.length;r++)e=e.replace("%s",arguments[r]);remoteWorker.send({type:t,message:["[",t.toUpperCase(),"] ",e].join("")})}}),e}()},initOnMessageHandler:function(e){function t(e){if(e=e.data.data?e.data:e,remoteWorker.messenger)remoteWorker.messenger.onMessage(e);else if("close"==e.action)return remoteWorker.send({type:"closed",workerReady:!1}),void remoteWorker.close()}remoteWorker.on?remoteWorker.on("message",t):remoteWorker.onmessage=t},initWorkerInterface:function initWorkerInterface(options){remoteWorker.callStringifiedFunction=function(stringifiedFunc,args,thenDo){var func;try{func=eval("("+stringifiedFunc+")")}catch(e){return void thenDo(new Error("Cannot create function from string: "+e.stack||e))}var usesCallback=func.length===args.length+1,whenDone=lively.lang.fun.once(function(e,t){remoteWorker.isBusy=!1,thenDo(e,t)});remoteWorker.isBusy=!0,usesCallback&&args.push(whenDone);try{var result=func.apply(remoteWorker,args.concat([whenDone]))}catch(e){return void whenDone(e,null)}usesCallback||whenDone(null,result)},remoteWorker.httpRequest=function(e){if(e.url){var t=new XMLHttpRequest,r=e.method||"GET";t.onreadystatechange=function(){4===t.readyState&&e.done&&e.done(t)},t.open(r,e.url),t.send()}else console.log("Error, httpRequest needs url")},remoteWorker.terminateIfNotBusyIn=function(e){setTimeout(function(){remoteWorker.isBusy?remoteWorker.terminateIfNotBusyIn(e):(remoteWorker.send({type:"closed",workerReady:!1}),remoteWorker.close())},e)}},initWorkerMessenger:function initWorkerMessenger(options){if(!options.useMessenger)return null;if(!lively.lang.messenger)throw new Error("worker.create requires messenger.js to be loaded!");if(!lively.lang.events)throw new Error("worker.create requires events.js to be loaded!");return remoteWorker.messenger=lively.lang.messenger.create({services:{remoteEval:function remoteEval(msg,messenger){var result;try{result=eval(msg.data.expr)}catch(e){result=e.stack||e}messenger.answer(msg,{result:String(result)})},run:function(e,t){var r=e.data.func,n=e.data.args;r?remoteWorker.callStringifiedFunction(r,n,function(r,n){t.answer(e,{error:r?String(r):null,result:n})}):t.answer(e,{error:"no funcString"})},close:function(e,t){t.answer(e,{status:"OK"}),remoteWorker.send({type:"closed",workerReady:!1}),remoteWorker.close()}},isOnline:function(){return!0},send:function(e,t){remoteWorker.send(e),t()},listen:function(e){e()},close:function(e){remoteWorker.send({type:"closed",workerReady:!1}),remoteWorker.close()}})}},BrowserWorker={create:function(e){if(!(e=e||{}).libLocation&&!e.scriptsToLoad){var t=document.querySelector('script[src$="worker.js"]');if(!t)throw new Error('Cannot find library path to start worker. Use worker.create({libLocation: "..."}) to explicitly define the path!');e.libLocation=t.src.replace(/worker.js$/,"")}var r="("+String(function(){self.onmessage=function(e){if("setup"!==e.data.action)throw new Error("expected setup to be first message but got "+JSON.stringify(e.data));var t=e.data.options||{};initBrowserGlobals(t),loadDependenciesBrowser(t),initOnMessageHandler(t),initWorkerInterface(t),initWorkerMessenger(t),postMessage({workerReady:!0})},__FUNCTIONDECLARATIONS__}).replace("__FUNCTIONDECLARATIONS__",[WorkerSetup.initBrowserGlobals,WorkerSetup.loadDependenciesBrowser,WorkerSetup.initOnMessageHandler,WorkerSetup.initWorkerInterface,WorkerSetup.initWorkerMessenger].join("\n"))+")();",n=new Worker(function(e){var t;try{t=new Blob([e],{type:"text/javascript"})}catch(r){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,(t=new BlobBuilder).append(e),t=t.getBlob()}return("undefined"!=typeof webkitURL?webkitURL:URL).createObjectURL(t)}(r));return function(e,t){makeEmitter(t),e.scriptsToLoad||(e.scriptsToLoad=["base.js","events.js","object.js","collection.js","function.js","string.js","number.js","date.js","messenger.js","worker.js"].map(function(t){return e.libLocation+t}));var r=Object.keys(e).reduce(function(t,r){return"function"!=typeof e[r]&&(t[r]=e[r]),t},{});t.onmessage=function(e){void 0!==e.data.workerReady?(t.ready=!!e.data.workerReady,t.ready?t.emit("ready"):t.emit("close")):t.emit("message",e.data)},t.errors=[],t.onerror=function(e){console.error(e),t.errors.push(e),t.emit("error",e)},t.postMessage({action:"setup",options:r})}(e,n),n}},NodejsWorker={debug:!1,initCodeFileCreated:!1,create:function(e){e=e||{};var t,r=makeEmitter({ready:!1,errors:[],postMessage:function(e){t?r.ready?t.send(e):r.emit("error",new Error("nodejs worker process not ready or already closed")):r.emit("error",new Error("nodejs worker process not yet created"))}});return NodejsWorker.startWorker(e,function(e,n){if(e)return r.ready=!1,void r.emit("error",e);(t=n).on("message",function(e){NodejsWorker.debug&&console.log("[WORKER PARENT] got message:",e),r.emit("message",e)}),t.on("close",function(){console.log("[WORKER PARENT] worker closed"),r.emit("close")}),t.on("error",function(e){console.log("[WORKER PARENT] error ",e),r.errors.push(e),r.emit("error",e)}),r.ready=!0,r.emit("ready")}),r},workerSetupFunction:function(){var e=process;console.log("[WORKER] Starting init"),e.on("message",function(t){if("setup"!==t.action)throw new Error("expected setup to be first message but got "+JSON.stringify(t.data));e.removeAllListeners("message");var r=t.data.options||{};console.log("[WORKER] running setup with options",r),loadDependenciesNodejs(r),initOnMessageHandler(r),initWorkerInterface(r),initWorkerMessenger(r),e.send({workerReady:!0})}),__FUNCTIONDECLARATIONS__},ensureInitCodeFile:function(e,t,r){var n=require("path"),i=require("os"),o=require("fs"),a=n.join(i.tmpDir(),"lively-nodejs-workers/"),s=n.join(a,"nodejs-worker-init.js");NodejsWorker.initCodeFileCreated?o.exists(s,function(n){n?r(null,s):NodejsWorker.createWorkerCodeFile(e,s,t,r)}):NodejsWorker.createWorkerCodeFile(e,s,t,r)},createWorkerCodeFile:function(e,t,r,n){var i=require("path"),o=require("fs");(0,require("child_process").exec)("mkdir -p "+i.dirname(t),function(e,i,a){e?n(new Error(["[WORKER PARENT] Could not create worker temp dir:",i,a].join("\n"))):o.writeFile(t,r,function(e){NodejsWorker.debug&&console.log("worker code file %s created",t),NodejsWorker.initCodeFileCreated=!0,n(e,t)})})},startWorker:function(e,t){var r=require("util"),n=require("child_process").fork,i=String(NodejsWorker.workerSetupFunction).replace("__FUNCTIONDECLARATIONS__",[WorkerSetup.loadDependenciesNodejs,WorkerSetup.initOnMessageHandler,WorkerSetup.initWorkerInterface,WorkerSetup.initWorkerMessenger].join("\n")),o=r.format("(%s)();\n",i);NodejsWorker.ensureInitCodeFile(e,o,function(r,i){if(r)return t(r);var o=n(i,{});NodejsWorker.debug&&console.log("worker forked"),o.on("message",function(e){"pong"===e.action?console.log("[WORKER pong] ",e):"log"===e.action&&console.log("[Message from WORKER] ",e.data)}),o.once("message",function(e){NodejsWorker.debug&&console.log("worker setup done"),t(null,o,e)}),o.on("close",function(){NodejsWorker.debug&&console.log("[WORKER PARENT] worker closed")}),o.send({action:"setup",data:{options:e}}),global.WORKER=o})}},worker=Object.freeze({fork:fork,create:create$3}),GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:void 0,isNode="undefined"!=typeof process&&process.env&&"function"==typeof process.exit,globalInterfaceSpec=[{action:"installMethods",target:"Array",sources:["arr"],methods:["from","genN","range","withN"]},{action:"installMethods",target:"Array.prototype",sources:["arr"],methods:["all","any","batchify","clear","clone","collect","compact","delimWith","detect","doAndContinue","each","equals","filterByKey","findAll","first","flatten","forEachShowingProgress","grep","groupBy","groupByKey","histogram","include","inject","intersect","invoke","last","mapAsync","mapAsyncSeries","mask","max","min","mutableCompact","nestedDelay","partition","pluck","pushAll","pushAllAt","pushAt","pushIfNotIncluded","reMatches","reject","rejectByKey","remove","removeAt","replaceAt","rotate","shuffle","size","sortBy","sortByKey","sum","swap","toArray","toTuples","union","uniq","uniqBy","without","withoutAll","zip"],alias:[["select","filter"]]},{action:"installMethods",target:"Date",sources:["date"],methods:[]},{action:"installMethods",target:"Date.prototype",sources:["date"],methods:["equals","format","relativeTo"]},{action:"installMethods",target:"Function",sources:["fun"],methods:["fromString"]},{action:"installMethods",target:"Function.prototype",sources:["fun"],methods:["addToObject","argumentNames","asScript","asScriptOf","binds","curry","delay","functionNames","localFunctionNames","getOriginal","getVarMapping","logCalls","logCompletion","logErrors","qualifiedMethodName","setProperty","traceCalls","wrap"]},{action:"installMethods",target:"Number",sources:["num"],methods:[]},{action:"installMethods",target:"Number.prototype",sources:["num"],methods:["detent","randomSmallerInteger","roundTo","toDegrees","toRadians"]},{action:"installMethods",target:"Object",sources:["obj"],methods:["addScript","clone","deepCopy","extend","inherit","isArray","isBoolean","isElement","isEmpty","isFunction","isNumber","isObject","isRegExp","isString","isUndefined","merge","mergePropertyInHierarchy","values","valuesInPropertyHierarchy"]},{action:"installMethods",target:"Object.prototype",sources:["obj"],methods:[]},{action:"installMethods",target:"String.prototype",sources:["string"],methods:["camelize","capitalize","digitValue","empty","hashCode","include","pad","regExpEscape","startsWithVowel","succ","times","toArray","toQueryParams","truncate"]},{action:"installObject",target:"Numbers",source:"num",methods:["average","between","convertLength","humanReadableByteSize","median","normalRandom","parseLength","random","sort"]},{action:"installObject",target:"Properties",source:"properties",methods:["all","allOwnPropertiesOrFunctions","allProperties","any","forEachOwn","hash","nameFor","own","ownValues","values"]},{action:"installObject",target:"Strings",source:"string",methods:["camelCaseString","createDataURI","diff","format","formatFromArray","indent","lineIndexComputer","lines","md5","newUUID","nonEmptyLines","pad","paragraphs","peekLeft","peekRight","print","printNested","printTable","printTree","quote","reMatches","stringMatch","tableize","tokens","unescapeCharacterEntities","withDecimalPrecision"]},{action:"installObject",target:"Objects",source:"obj",methods:["asObject","equals","inspect","isMutableType","safeToString","shortPrintStringOf","typeStringOf"]},{action:"installObject",target:"Functions",source:"fun",methods:["all","compose","composeAsync","createQueue","debounce","debounceNamed","either","extractBody","flip","notYetImplemented","once","own","throttle","throttleNamed","timeToRun","timeToRunN","waitFor","workerWithCallbackQueue","wrapperChain"]},{action:"installObject",target:"Grid",source:"grid"},{action:"installObject",target:"Interval",source:"interval"},{action:"installObject",target:"lively.ArrayProjection",source:"arrayProjection"},{action:"installObject",target:"lively.Closure",source:"Closure"},{action:"installObject",target:"lively.Grouping",source:"Group"},{action:"installObject",target:"lively.PropertyPath",source:"Path"},{action:"installObject",target:"lively.Worker",source:"worker"},{action:"installObject",target:"lively.Class",source:"classHelper"}],livelyLang=createLivelyLangObject();exports.worker=worker,exports.messenger=messenger,exports.events=events,exports.tree=tree,exports.grid=grid,exports.arrayProjection=arrayProjection,exports.interval=interval,exports.graph=graph,exports.date=date,exports.properties=properties,exports.obj=obj,exports.arr=arr,exports.fun=fun,exports.num=num,exports.string=string,exports.Closure=Closure,exports.promise=promise,exports.Path=Path,exports.Group=Group,exports.livelyLang=livelyLang,exports.chain=chain$$1,exports.noConflict=noConflict,exports.installGlobals=installGlobals,exports.uninstallGlobals=uninstallGlobals}(this.lively.lang=this.lively.lang||{})}.call(GLOBAL),"undefined"!=typeof module&&module.exports&&(module.exports=GLOBAL.lively.lang)}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(e,t){"use strict";function r(e){if(void 0===e){if("undefined"==typeof System)return void 0!==o?o:o||(o={emitter:t.events.makeEmitter({},{maxListenerLimit:1e4}),notifications:[]});e=System}var r=e.get("@lively-env");r||e.set("@lively-env",e.newModule({options:{}}));var n=r.options;if(!n)throw new Error("@lively-env registered read-only");return n.emitter||Object.assign(n,{emitter:e["__lively.notifications_emitter"]||(e["__lively.notifications_emitter"]=t.events.makeEmitter({},{maxListenerLimit:1e4})),notifications:e["__lively.notifications_notifications"]||(e["__lively.notifications_notifications"]=[])}),{emitter:n.emitter,notifications:n.notifications}}function n(e,t){e.push(t),e.limit&&e.splice(0,e.length-e.limit)}function i(e){var r=e.type+" ".repeat(Math.max(0,32-e.type.length));console.log(r+" "+t.obj.inspect(e,{maxDepth:2}))}var o=void 0;e.subscribe=function(e,t,n){return r(n).emitter.on(e,t),t},e.subscribeOnce=function(e,t,n){return r(n).emitter.once(e,t),t},e.emit=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),a=arguments[3],s=Object.assign({type:e,time:o},t),u=r(a),c=u.emitter,l=u.notifications;return c.emit(e,s),c.isLogging&&i(s),c.isRecording&&n(l,s),s},e.unsubscribe=function(e,t,n){return r(n).emitter.removeListener(e,t),t},e.unsubscribeAll=function(e,t){r(t).emitter.removeAllListeners(e)},e.startRecording=function(e){r(e).emitter.isRecording=!0},e.stopRecording=function(e){r(e).emitter.isRecording=!1},e.clearRecord=function(e){var t=r(e).notifications;t.splice(0,t.length)},e.getRecord=function(e){return r(e).notifications},e.startLogging=function(e){r(e).emitter.isLogging=!0},e.stopLogging=function(e){r(e).emitter.isLogging=!1}}(this.lively.notifications=this.lively.notifications||{},lively.lang),"undefined"!=typeof module&&module.exports&&(module.exports=e.lively.classes)}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;if(e.define){var t=e;delete e.define}!function(){var e=void 0;!function(){var e=void 0;(function(t,r){"function"==typeof e&&e.amd?e(["exports"],r):r(t.acorn=t.acorn||{})})(this,function(e){"use strict";function t(e,t){for(var r=65536,n=0;n<t.length;n+=2){if((r+=t[n])>e)return!1;if((r+=t[n+1])>=e)return!0}}function r(e,r){return e<65?36===e:e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&x.test(String.fromCharCode(e)):!1!==r&&t(e,k)))}function n(e,r){return e<48?36===e:e<58||!(e<65)&&(e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&w.test(String.fromCharCode(e)):!1!==r&&(t(e,k)||t(e,E)))))}function i(e,t){return new S(e,{beforeExpr:!0,binop:t})}function o(e,t){return void 0===t&&(t={}),t.keyword=e,C[e]=new S(e,t)}function a(e){return 10===e||13===e||8232===e||8233===e}function s(e,t){return P.call(e,t)}function u(e,t){for(var r=1,n=0;;){T.lastIndex=n;var i=T.exec(e);if(!(i&&i.index<t))return new N(r,t-n);++r,n=i.index+i[0].length}}function c(e){var t={};for(var r in q)t[r]=e&&s(e,r)?e[r]:q[r];if(t.ecmaVersion>=2015&&(t.ecmaVersion-=2009),null==t.allowReserved&&(t.allowReserved=t.ecmaVersion<5),L(t.onToken)){var n=t.onToken;t.onToken=function(e){return n.push(e)}}return L(t.onComment)&&(t.onComment=l(t,t.onComment)),t}function l(e,t){return function(r,n,i,o,a,s){var u={type:r?"Block":"Line",value:n,start:i,end:o};e.locations&&(u.loc=new M(this,a,s)),e.ranges&&(u.range=[i,o]),t.push(u)}}function f(e){return new RegExp("^(?:"+e.replace(/ /g,"|")+")$")}function p(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=-1}function h(e,t,r,n){return e.type=t,e.end=r,this.options.locations&&(e.loc.end=n),this.options.ranges&&(e.range[1]=r),e}function d(e,t,r,n){try{return new RegExp(e,t)}catch(e){if(void 0!==r)throw e instanceof SyntaxError&&n.raise(r,"Error parsing regular expression: "+e.message),e}}function m(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}var v={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},y="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",g={5:y,6:y+" const class extends export import super"},b="-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",_="-------------------------------------------------------------------------------------------------------------------------------------------------",x=new RegExp("["+b+"]"),w=new RegExp("["+b+_+"]");b=_=null;var k=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,17,26,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,26,45,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,785,52,76,44,33,24,27,35,42,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,54,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,86,25,391,63,32,0,449,56,264,8,2,36,18,0,50,29,881,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,881,68,12,0,67,12,65,0,32,6124,20,754,9486,1,3071,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,4149,196,60,67,1213,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42710,42,4148,12,221,3,5761,10591,541],E=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,1306,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,52,0,13,2,49,13,10,2,4,9,83,11,7,0,161,11,6,9,7,3,57,0,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,87,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,423,9,838,7,2,7,17,9,57,21,2,13,19882,9,135,4,60,6,26,9,1016,45,17,3,19723,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,2214,6,110,6,6,9,792487,239],S=function(e,t){void 0===t&&(t={}),this.label=e,this.keyword=t.keyword,this.beforeExpr=!!t.beforeExpr,this.startsExpr=!!t.startsExpr,this.isLoop=!!t.isLoop,this.isAssign=!!t.isAssign,this.prefix=!!t.prefix,this.postfix=!!t.postfix,this.binop=t.binop||null,this.updateContext=null},A={beforeExpr:!0},D={startsExpr:!0},C={},F={num:new S("num",D),regexp:new S("regexp",D),string:new S("string",D),name:new S("name",D),eof:new S("eof"),bracketL:new S("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new S("]"),braceL:new S("{",{beforeExpr:!0,startsExpr:!0}),braceR:new S("}"),parenL:new S("(",{beforeExpr:!0,startsExpr:!0}),parenR:new S(")"),comma:new S(",",A),semi:new S(";",A),colon:new S(":",A),dot:new S("."),question:new S("?",A),arrow:new S("=>",A),template:new S("template"),invalidTemplate:new S("invalidTemplate"),ellipsis:new S("...",A),backQuote:new S("`",D),dollarBraceL:new S("${",{beforeExpr:!0,startsExpr:!0}),eq:new S("=",{beforeExpr:!0,isAssign:!0}),assign:new S("_=",{beforeExpr:!0,isAssign:!0}),incDec:new S("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new S("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:i("||",1),logicalAND:i("&&",2),bitwiseOR:i("|",3),bitwiseXOR:i("^",4),bitwiseAND:i("&",5),equality:i("==/!=/===/!==",6),relational:i("</>/<=/>=",7),bitShift:i("<</>>/>>>",8),plusMin:new S("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:i("%",10),star:i("*",10),slash:i("/",10),starstar:new S("**",{beforeExpr:!0}),_break:o("break"),_case:o("case",A),_catch:o("catch"),_continue:o("continue"),_debugger:o("debugger"),_default:o("default",A),_do:o("do",{isLoop:!0,beforeExpr:!0}),_else:o("else",A),_finally:o("finally"),_for:o("for",{isLoop:!0}),_function:o("function",D),_if:o("if"),_return:o("return",A),_switch:o("switch"),_throw:o("throw",A),_try:o("try"),_var:o("var"),_const:o("const"),_while:o("while",{isLoop:!0}),_with:o("with"),_new:o("new",{beforeExpr:!0,startsExpr:!0}),_this:o("this",D),_super:o("super",D),_class:o("class",D),_extends:o("extends",A),_export:o("export"),_import:o("import"),_null:o("null",D),_true:o("true",D),_false:o("false",D),_in:o("in",{beforeExpr:!0,binop:7}),_instanceof:o("instanceof",{beforeExpr:!0,binop:7}),_typeof:o("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:o("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:o("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},j=/\r\n?|\n|\u2028|\u2029/,T=new RegExp(j.source,"g"),O=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,R=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,B=Object.prototype,P=B.hasOwnProperty,I=B.toString,L=Array.isArray||function(e){return"[object Array]"===I.call(e)},N=function(e,t){this.line=e,this.column=t};N.prototype.offset=function(e){return new N(this.line,this.column+e)};var M=function(e,t,r){this.start=t,this.end=r,null!==e.sourceFile&&(this.source=e.sourceFile)},q={ecmaVersion:7,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1,plugins:{}},$={},W=function(e,t,r){this.options=e=c(e),this.sourceFile=e.sourceFile,this.keywords=f(g[e.ecmaVersion>=6?6:5]);var n="";if(!e.allowReserved){for(var i=e.ecmaVersion;!(n=v[i]);i--);"module"==e.sourceType&&(n+=" await")}this.reservedWords=f(n);var o=(n?n+" ":"")+v.strict;this.reservedWordsStrict=f(o),this.reservedWordsStrictBind=f(o+" "+v.strictBind),this.input=String(t),this.containsEsc=!1,this.loadPlugins(e.plugins),r?(this.pos=r,this.lineStart=this.input.lastIndexOf("\n",r-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(j).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=F.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===e.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.inFunction=this.inGenerator=this.inAsync=!1,this.yieldPos=this.awaitPos=0,this.labels=[],0===this.pos&&e.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterFunctionScope()};W.prototype.isKeyword=function(e){return this.keywords.test(e)},W.prototype.isReservedWord=function(e){return this.reservedWords.test(e)},W.prototype.extend=function(e,t){this[e]=t(this[e])},W.prototype.loadPlugins=function(e){var t=this;for(var r in e){var n=$[r];if(!n)throw new Error("Plugin '"+r+"' not found");n(t,e[r])}},W.prototype.parse=function(){var e=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(e)};var U=W.prototype,G=/^(?:'((?:\\.|[^'])*?)'|"((?:\\.|[^"])*?)"|;)/;U.strictDirective=function(e){for(var t=this;;){R.lastIndex=e,e+=R.exec(t.input)[0].length;var r=G.exec(t.input.slice(e));if(!r)return!1;if("use strict"==(r[1]||r[2]))return!0;e+=r[0].length}},U.eat=function(e){return this.type===e&&(this.next(),!0)},U.isContextual=function(e){return this.type===F.name&&this.value===e},U.eatContextual=function(e){return this.value===e&&this.eat(F.name)},U.expectContextual=function(e){this.eatContextual(e)||this.unexpected()},U.canInsertSemicolon=function(){return this.type===F.eof||this.type===F.braceR||j.test(this.input.slice(this.lastTokEnd,this.start))},U.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},U.semicolon=function(){this.eat(F.semi)||this.insertSemicolon()||this.unexpected()},U.afterTrailingComma=function(e,t){if(this.type==e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),t||this.next(),!0},U.expect=function(e){this.eat(e)||this.unexpected()},U.unexpected=function(e){this.raise(null!=e?e:this.start,"Unexpected token")},U.checkPatternErrors=function(e,t){if(e){e.trailingComma>-1&&this.raiseRecoverable(e.trailingComma,"Comma is not permitted after the rest element");var r=t?e.parenthesizedAssign:e.parenthesizedBind;r>-1&&this.raiseRecoverable(r,"Parenthesized pattern")}},U.checkExpressionErrors=function(e,t){var r=e?e.shorthandAssign:-1;if(!t)return r>=0;r>-1&&this.raise(r,"Shorthand property assignments are valid only in destructuring patterns")},U.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},U.isSimpleAssignTarget=function(e){return"ParenthesizedExpression"===e.type?this.isSimpleAssignTarget(e.expression):"Identifier"===e.type||"MemberExpression"===e.type};var z=W.prototype;z.parseTopLevel=function(e){var t=this,r={};for(e.body||(e.body=[]);this.type!==F.eof;){var n=t.parseStatement(!0,!0,r);e.body.push(n)}return this.adaptDirectivePrologue(e.body),this.next(),this.options.ecmaVersion>=6&&(e.sourceType=this.options.sourceType),this.finishNode(e,"Program")};var V={kind:"loop"},J={kind:"switch"};z.isLet=function(){if(this.type!==F.name||this.options.ecmaVersion<6||"let"!=this.value)return!1;R.lastIndex=this.pos;var e=R.exec(this.input),t=this.pos+e[0].length,i=this.input.charCodeAt(t);if(91===i||123==i)return!0;if(r(i,!0)){for(var o=t+1;n(this.input.charCodeAt(o),!0);)++o;var a=this.input.slice(t,o);if(!this.isKeyword(a))return!0}return!1},z.isAsyncFunction=function(){if(this.type!==F.name||this.options.ecmaVersion<8||"async"!=this.value)return!1;R.lastIndex=this.pos;var e=R.exec(this.input),t=this.pos+e[0].length;return!(j.test(this.input.slice(this.pos,t))||"function"!==this.input.slice(t,t+8)||t+8!=this.input.length&&n(this.input.charAt(t+8)))},z.parseStatement=function(e,t,r){var n,i=this.type,o=this.startNode();switch(this.isLet()&&(i=F._var,n="let"),i){case F._break:case F._continue:return this.parseBreakContinueStatement(o,i.keyword);case F._debugger:return this.parseDebuggerStatement(o);case F._do:return this.parseDoStatement(o);case F._for:return this.parseForStatement(o);case F._function:return!e&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(o,!1);case F._class:return e||this.unexpected(),this.parseClass(o,!0);case F._if:return this.parseIfStatement(o);case F._return:return this.parseReturnStatement(o);case F._switch:return this.parseSwitchStatement(o);case F._throw:return this.parseThrowStatement(o);case F._try:return this.parseTryStatement(o);case F._const:case F._var:return n=n||this.value,e||"var"==n||this.unexpected(),this.parseVarStatement(o,n);case F._while:return this.parseWhileStatement(o);case F._with:return this.parseWithStatement(o);case F.braceL:return this.parseBlock();case F.semi:return this.parseEmptyStatement(o);case F._export:case F._import:return this.options.allowImportExportEverywhere||(t||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===F._import?this.parseImport(o):this.parseExport(o,r);default:if(this.isAsyncFunction()&&e)return this.next(),this.parseFunctionStatement(o,!0);var a=this.value,s=this.parseExpression();return i===F.name&&"Identifier"===s.type&&this.eat(F.colon)?this.parseLabeledStatement(o,a,s):this.parseExpressionStatement(o,s)}},z.parseBreakContinueStatement=function(e,t){var r=this,n="break"==t;this.next(),this.eat(F.semi)||this.insertSemicolon()?e.label=null:this.type!==F.name?this.unexpected():(e.label=this.parseIdent(),this.semicolon());for(var i=0;i<this.labels.length;++i){var o=r.labels[i];if(null==e.label||o.name===e.label.name){if(null!=o.kind&&(n||"loop"===o.kind))break;if(e.label&&n)break}}return i===this.labels.length&&this.raise(e.start,"Unsyntactic "+t),this.finishNode(e,n?"BreakStatement":"ContinueStatement")},z.parseDebuggerStatement=function(e){return this.next(),this.semicolon(),this.finishNode(e,"DebuggerStatement")},z.parseDoStatement=function(e){return this.next(),this.labels.push(V),e.body=this.parseStatement(!1),this.labels.pop(),this.expect(F._while),e.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(F.semi):this.semicolon(),this.finishNode(e,"DoWhileStatement")},z.parseForStatement=function(e){if(this.next(),this.labels.push(V),this.enterLexicalScope(),this.expect(F.parenL),this.type===F.semi)return this.parseFor(e,null);var t=this.isLet();if(this.type===F._var||this.type===F._const||t){var r=this.startNode(),n=t?"let":this.value;return this.next(),this.parseVar(r,!0,n),this.finishNode(r,"VariableDeclaration"),!(this.type===F._in||this.options.ecmaVersion>=6&&this.isContextual("of"))||1!==r.declarations.length||"var"!==n&&r.declarations[0].init?this.parseFor(e,r):this.parseForIn(e,r)}var i=new p,o=this.parseExpression(!0,i);return this.type===F._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.toAssignable(o),this.checkLVal(o),this.checkPatternErrors(i,!0),this.parseForIn(e,o)):(this.checkExpressionErrors(i,!0),this.parseFor(e,o))},z.parseFunctionStatement=function(e,t){return this.next(),this.parseFunction(e,!0,!1,t)},z.isFunction=function(){return this.type===F._function||this.isAsyncFunction()},z.parseIfStatement=function(e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement(!this.strict&&this.isFunction()),e.alternate=this.eat(F._else)?this.parseStatement(!this.strict&&this.isFunction()):null,this.finishNode(e,"IfStatement")},z.parseReturnStatement=function(e){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(F.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,"ReturnStatement")},z.parseSwitchStatement=function(e){var t=this;this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(F.braceL),this.labels.push(J),this.enterLexicalScope();for(var r,n=!1;this.type!=F.braceR;)if(t.type===F._case||t.type===F._default){var i=t.type===F._case;r&&t.finishNode(r,"SwitchCase"),e.cases.push(r=t.startNode()),r.consequent=[],t.next(),i?r.test=t.parseExpression():(n&&t.raiseRecoverable(t.lastTokStart,"Multiple default clauses"),n=!0,r.test=null),t.expect(F.colon)}else r||t.unexpected(),r.consequent.push(t.parseStatement(!0));return this.exitLexicalScope(),r&&this.finishNode(r,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(e,"SwitchStatement")},z.parseThrowStatement=function(e){return this.next(),j.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,"ThrowStatement")};var H=[];z.parseTryStatement=function(e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===F._catch){var t=this.startNode();this.next(),this.expect(F.parenL),t.param=this.parseBindingAtom(),this.enterLexicalScope(),this.checkLVal(t.param,"let"),this.expect(F.parenR),t.body=this.parseBlock(!1),this.exitLexicalScope(),e.handler=this.finishNode(t,"CatchClause")}return e.finalizer=this.eat(F._finally)?this.parseBlock():null,e.handler||e.finalizer||this.raise(e.start,"Missing catch or finally clause"),this.finishNode(e,"TryStatement")},z.parseVarStatement=function(e,t){return this.next(),this.parseVar(e,!1,t),this.semicolon(),this.finishNode(e,"VariableDeclaration")},z.parseWhileStatement=function(e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(V),e.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(e,"WhileStatement")},z.parseWithStatement=function(e){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement(!1),this.finishNode(e,"WithStatement")},z.parseEmptyStatement=function(e){return this.next(),this.finishNode(e,"EmptyStatement")},z.parseLabeledStatement=function(e,t,r){for(var n=this,i=0,o=n.labels;i<o.length;i+=1)o[i].name===t&&n.raise(r.start,"Label '"+t+"' is already declared");for(var a=this.type.isLoop?"loop":this.type===F._switch?"switch":null,s=this.labels.length-1;s>=0;s--){var u=n.labels[s];if(u.statementStart!=e.start)break;u.statementStart=n.start,u.kind=a}return this.labels.push({name:t,kind:a,statementStart:this.start}),e.body=this.parseStatement(!0),("ClassDeclaration"==e.body.type||"VariableDeclaration"==e.body.type&&"var"!=e.body.kind||"FunctionDeclaration"==e.body.type&&(this.strict||e.body.generator))&&this.raiseRecoverable(e.body.start,"Invalid labeled declaration"),this.labels.pop(),e.label=r,this.finishNode(e,"LabeledStatement")},z.parseExpressionStatement=function(e,t){return e.expression=t,this.semicolon(),this.finishNode(e,"ExpressionStatement")},z.parseBlock=function(e){var t=this;void 0===e&&(e=!0);var r=this.startNode();for(r.body=[],this.expect(F.braceL),e&&this.enterLexicalScope();!this.eat(F.braceR);){var n=t.parseStatement(!0);r.body.push(n)}return e&&this.exitLexicalScope(),this.finishNode(r,"BlockStatement")},z.parseFor=function(e,t){return e.init=t,this.expect(F.semi),e.test=this.type===F.semi?null:this.parseExpression(),this.expect(F.semi),e.update=this.type===F.parenR?null:this.parseExpression(),this.expect(F.parenR),this.exitLexicalScope(),e.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(e,"ForStatement")},z.parseForIn=function(e,t){var r=this.type===F._in?"ForInStatement":"ForOfStatement";return this.next(),e.left=t,e.right=this.parseExpression(),this.expect(F.parenR),this.exitLexicalScope(),e.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(e,r)},z.parseVar=function(e,t,r){var n=this;for(e.declarations=[],e.kind=r;;){var i=n.startNode();if(n.parseVarId(i,r),n.eat(F.eq)?i.init=n.parseMaybeAssign(t):"const"!==r||n.type===F._in||n.options.ecmaVersion>=6&&n.isContextual("of")?"Identifier"==i.id.type||t&&(n.type===F._in||n.isContextual("of"))?i.init=null:n.raise(n.lastTokEnd,"Complex binding patterns require an initialization value"):n.unexpected(),e.declarations.push(n.finishNode(i,"VariableDeclarator")),!n.eat(F.comma))break}return e},z.parseVarId=function(e,t){e.id=this.parseBindingAtom(t),this.checkLVal(e.id,t,!1)},z.parseFunction=function(e,t,r,n){this.initFunction(e),this.options.ecmaVersion>=6&&!n&&(e.generator=this.eat(F.star)),this.options.ecmaVersion>=8&&(e.async=!!n),t&&(e.id="nullableID"===t&&this.type!=F.name?null:this.parseIdent(),e.id&&this.checkLVal(e.id,"var"));var i=this.inGenerator,o=this.inAsync,a=this.yieldPos,s=this.awaitPos,u=this.inFunction;return this.inGenerator=e.generator,this.inAsync=e.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,this.enterFunctionScope(),t||(e.id=this.type==F.name?this.parseIdent():null),this.parseFunctionParams(e),this.parseFunctionBody(e,r),this.inGenerator=i,this.inAsync=o,this.yieldPos=a,this.awaitPos=s,this.inFunction=u,this.finishNode(e,t?"FunctionDeclaration":"FunctionExpression")},z.parseFunctionParams=function(e){this.expect(F.parenL),e.params=this.parseBindingList(F.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},z.parseClass=function(e,t){var r=this;this.next(),this.parseClassId(e,t),this.parseClassSuper(e);var n=this.startNode(),i=!1;for(n.body=[],this.expect(F.braceL);!this.eat(F.braceR);)if(!r.eat(F.semi)){var o=r.startNode(),a=r.eat(F.star),s=!1,u=r.type===F.name&&"static"===r.value;r.parsePropertyName(o),o.static=u&&r.type!==F.parenL,o.static&&(a&&r.unexpected(),a=r.eat(F.star),r.parsePropertyName(o)),r.options.ecmaVersion>=8&&!a&&!o.computed&&"Identifier"===o.key.type&&"async"===o.key.name&&r.type!==F.parenL&&!r.canInsertSemicolon()&&(s=!0,r.parsePropertyName(o)),o.kind="method";var c=!1;if(!o.computed){var l=o.key;a||s||"Identifier"!==l.type||r.type===F.parenL||"get"!==l.name&&"set"!==l.name||(c=!0,o.kind=l.name,l=r.parsePropertyName(o)),!o.static&&("Identifier"===l.type&&"constructor"===l.name||"Literal"===l.type&&"constructor"===l.value)&&(i&&r.raise(l.start,"Duplicate constructor in the same class"),c&&r.raise(l.start,"Constructor can't have get/set modifier"),a&&r.raise(l.start,"Constructor can't be a generator"),s&&r.raise(l.start,"Constructor can't be an async method"),o.kind="constructor",i=!0)}if(r.parseClassMethod(n,o,a,s),c){var f="get"===o.kind?0:1;if(o.value.params.length!==f){var p=o.value.start;"get"===o.kind?r.raiseRecoverable(p,"getter should have no params"):r.raiseRecoverable(p,"setter should have exactly one param")}else"set"===o.kind&&"RestElement"===o.value.params[0].type&&r.raiseRecoverable(o.value.params[0].start,"Setter cannot use rest params")}}return e.body=this.finishNode(n,"ClassBody"),this.finishNode(e,t?"ClassDeclaration":"ClassExpression")},z.parseClassMethod=function(e,t,r,n){t.value=this.parseMethod(r,n),e.body.push(this.finishNode(t,"MethodDefinition"))},z.parseClassId=function(e,t){e.id=this.type===F.name?this.parseIdent():!0===t?this.unexpected():null},z.parseClassSuper=function(e){e.superClass=this.eat(F._extends)?this.parseExprSubscripts():null},z.parseExport=function(e,t){var r=this;if(this.next(),this.eat(F.star))return this.expectContextual("from"),e.source=this.type===F.string?this.parseExprAtom():this.unexpected(),this.semicolon(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(F._default)){this.checkExport(t,"default",this.lastTokStart);var n;if(this.type===F._function||(n=this.isAsyncFunction())){var i=this.startNode();this.next(),n&&this.next(),e.declaration=this.parseFunction(i,"nullableID",!1,n)}else if(this.type===F._class){var o=this.startNode();e.declaration=this.parseClass(o,"nullableID")}else e.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(e,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())e.declaration=this.parseStatement(!0),"VariableDeclaration"===e.declaration.type?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id.name,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual("from"))e.source=this.type===F.string?this.parseExprAtom():this.unexpected();else{for(var a=0,s=e.specifiers;a<s.length;a+=1){var u=s[a];r.checkUnreserved(u.local)}e.source=null}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")},z.checkExport=function(e,t,r){e&&(s(e,t)&&this.raiseRecoverable(r,"Duplicate export '"+t+"'"),e[t]=!0)},z.checkPatternExport=function(e,t){var r=this,n=t.type;if("Identifier"==n)this.checkExport(e,t.name,t.start);else if("ObjectPattern"==n)for(var i=0,o=t.properties;i<o.length;i+=1){var a=o[i];r.checkPatternExport(e,a.value)}else if("ArrayPattern"==n)for(var s=0,u=t.elements;s<u.length;s+=1){var c=u[s];c&&r.checkPatternExport(e,c)}else"AssignmentPattern"==n?this.checkPatternExport(e,t.left):"ParenthesizedExpression"==n&&this.checkPatternExport(e,t.expression)},z.checkVariableExport=function(e,t){var r=this;if(e)for(var n=0,i=t;n<i.length;n+=1){var o=i[n];r.checkPatternExport(e,o.id)}},z.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},z.parseExportSpecifiers=function(e){var t=this,r=[],n=!0;for(this.expect(F.braceL);!this.eat(F.braceR);){if(n)n=!1;else if(t.expect(F.comma),t.afterTrailingComma(F.braceR))break;var i=t.startNode();i.local=t.parseIdent(!0),i.exported=t.eatContextual("as")?t.parseIdent(!0):i.local,t.checkExport(e,i.exported.name,i.exported.start),r.push(t.finishNode(i,"ExportSpecifier"))}return r},z.parseImport=function(e){return this.next(),this.type===F.string?(e.specifiers=H,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===F.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(e,"ImportDeclaration")},z.parseImportSpecifiers=function(){var e=this,t=[],r=!0;if(this.type===F.name){var n=this.startNode();if(n.local=this.parseIdent(),this.checkLVal(n.local,"let"),t.push(this.finishNode(n,"ImportDefaultSpecifier")),!this.eat(F.comma))return t}if(this.type===F.star){var i=this.startNode();return this.next(),this.expectContextual("as"),i.local=this.parseIdent(),this.checkLVal(i.local,"let"),t.push(this.finishNode(i,"ImportNamespaceSpecifier")),t}for(this.expect(F.braceL);!this.eat(F.braceR);){if(r)r=!1;else if(e.expect(F.comma),e.afterTrailingComma(F.braceR))break;var o=e.startNode();o.imported=e.parseIdent(!0),e.eatContextual("as")?o.local=e.parseIdent():(e.checkUnreserved(o.imported),o.local=o.imported),e.checkLVal(o.local,"let"),t.push(e.finishNode(o,"ImportSpecifier"))}return t},z.adaptDirectivePrologue=function(e){for(var t=0;t<e.length&&this.isDirectiveCandidate(e[t]);++t)e[t].directive=e[t].expression.raw.slice(1,-1)},z.isDirectiveCandidate=function(e){return"ExpressionStatement"===e.type&&"Literal"===e.expression.type&&"string"==typeof e.expression.value&&('"'===this.input[e.start]||"'"===this.input[e.start])};var X=W.prototype;X.toAssignable=function(e,t){var r=this;if(this.options.ecmaVersion>=6&&e)switch(e.type){case"Identifier":this.inAsync&&"await"===e.name&&this.raise(e.start,"Can not use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":break;case"ObjectExpression":e.type="ObjectPattern";for(var n=0,i=e.properties;n<i.length;n+=1){var o=i[n];"init"!==o.kind&&r.raise(o.key.start,"Object pattern can't contain getter or setter"),r.toAssignable(o.value,t)}break;case"ArrayExpression":e.type="ArrayPattern",this.toAssignableList(e.elements,t);break;case"AssignmentExpression":if("="!==e.operator){this.raise(e.left.end,"Only '=' operator can be used for specifying default value.");break}e.type="AssignmentPattern",delete e.operator,this.toAssignable(e.left,t);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(e.expression,t);break;case"MemberExpression":if(!t)break;default:this.raise(e.start,"Assigning to rvalue")}return e},X.toAssignableList=function(e,t){var r=this,n=e.length;if(n){var i=e[n-1];if(i&&"RestElement"==i.type)--n;else if(i&&"SpreadElement"==i.type){i.type="RestElement";var o=i.argument;this.toAssignable(o,t),--n}6===this.options.ecmaVersion&&t&&i&&"RestElement"===i.type&&"Identifier"!==i.argument.type&&this.unexpected(i.argument.start)}for(var a=0;a<n;a++){var s=e[a];s&&r.toAssignable(s,t)}return e},X.parseSpread=function(e){var t=this.startNode();return this.next(),t.argument=this.parseMaybeAssign(!1,e),this.finishNode(t,"SpreadElement")},X.parseRestBinding=function(){var e=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==F.name&&this.unexpected(),e.argument=this.parseBindingAtom(),this.finishNode(e,"RestElement")},X.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case F.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(F.bracketR,!0,!0),this.finishNode(e,"ArrayPattern");case F.braceL:return this.parseObj(!0)}return this.parseIdent()},X.parseBindingList=function(e,t,r){for(var n=this,i=[],o=!0;!this.eat(e);)if(o?o=!1:n.expect(F.comma),t&&n.type===F.comma)i.push(null);else{if(r&&n.afterTrailingComma(e))break;if(n.type===F.ellipsis){var a=n.parseRestBinding();n.parseBindingListItem(a),i.push(a),n.type===F.comma&&n.raise(n.start,"Comma is not permitted after the rest element"),n.expect(e);break}var s=n.parseMaybeDefault(n.start,n.startLoc);n.parseBindingListItem(s),i.push(s)}return i},X.parseBindingListItem=function(e){return e},X.parseMaybeDefault=function(e,t,r){if(r=r||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(F.eq))return r;var n=this.startNodeAt(e,t);return n.left=r,n.right=this.parseMaybeAssign(),this.finishNode(n,"AssignmentPattern")},X.checkLVal=function(e,t,r){var n=this;switch(e.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(t?"Binding ":"Assigning to ")+e.name+" in strict mode"),r&&(s(r,e.name)&&this.raiseRecoverable(e.start,"Argument name clash"),r[e.name]=!0),t&&"none"!==t&&(("var"===t&&!this.canDeclareVarName(e.name)||"var"!==t&&!this.canDeclareLexicalName(e.name))&&this.raiseRecoverable(e.start,"Identifier '"+e.name+"' has already been declared"),"var"===t?this.declareVarName(e.name):this.declareLexicalName(e.name));break;case"MemberExpression":t&&this.raiseRecoverable(e.start,(t?"Binding":"Assigning to")+" member expression");break;case"ObjectPattern":for(var i=0,o=e.properties;i<o.length;i+=1){var a=o[i];n.checkLVal(a.value,t,r)}break;case"ArrayPattern":for(var u=0,c=e.elements;u<c.length;u+=1){var l=c[u];l&&n.checkLVal(l,t,r)}break;case"AssignmentPattern":this.checkLVal(e.left,t,r);break;case"RestElement":this.checkLVal(e.argument,t,r);break;case"ParenthesizedExpression":this.checkLVal(e.expression,t,r);break;default:this.raise(e.start,(t?"Binding":"Assigning to")+" rvalue")}};var K=W.prototype;K.checkPropClash=function(e,t){if(!(this.options.ecmaVersion>=6&&(e.computed||e.method||e.shorthand))){var r,n=e.key;switch(n.type){case"Identifier":r=n.name;break;case"Literal":r=String(n.value);break;default:return}var i=e.kind;if(this.options.ecmaVersion>=6)"__proto__"===r&&"init"===i&&(t.proto&&this.raiseRecoverable(n.start,"Redefinition of __proto__ property"),t.proto=!0);else{var o=t[r="$"+r];if(o){("init"===i?this.strict&&o.init||o.get||o.set:o.init||o[i])&&this.raiseRecoverable(n.start,"Redefinition of property")}else o=t[r]={init:!1,get:!1,set:!1};o[i]=!0}}},K.parseExpression=function(e,t){var r=this,n=this.start,i=this.startLoc,o=this.parseMaybeAssign(e,t);if(this.type===F.comma){var a=this.startNodeAt(n,i);for(a.expressions=[o];this.eat(F.comma);)a.expressions.push(r.parseMaybeAssign(e,t));return this.finishNode(a,"SequenceExpression")}return o},K.parseMaybeAssign=function(e,t,r){if(this.inGenerator&&this.isContextual("yield"))return this.parseYield();var n=!1,i=-1,o=-1;t?(i=t.parenthesizedAssign,o=t.trailingComma,t.parenthesizedAssign=t.trailingComma=-1):(t=new p,n=!0);var a=this.start,s=this.startLoc;this.type!=F.parenL&&this.type!=F.name||(this.potentialArrowAt=this.start);var u=this.parseMaybeConditional(e,t);if(r&&(u=r.call(this,u,a,s)),this.type.isAssign){this.checkPatternErrors(t,!0),n||p.call(t);var c=this.startNodeAt(a,s);return c.operator=this.value,c.left=this.type===F.eq?this.toAssignable(u):u,t.shorthandAssign=-1,this.checkLVal(u),this.next(),c.right=this.parseMaybeAssign(e),this.finishNode(c,"AssignmentExpression")}return n&&this.checkExpressionErrors(t,!0),i>-1&&(t.parenthesizedAssign=i),o>-1&&(t.trailingComma=o),u},K.parseMaybeConditional=function(e,t){var r=this.start,n=this.startLoc,i=this.parseExprOps(e,t);if(this.checkExpressionErrors(t))return i;if(this.eat(F.question)){var o=this.startNodeAt(r,n);return o.test=i,o.consequent=this.parseMaybeAssign(),this.expect(F.colon),o.alternate=this.parseMaybeAssign(e),this.finishNode(o,"ConditionalExpression")}return i},K.parseExprOps=function(e,t){var r=this.start,n=this.startLoc,i=this.parseMaybeUnary(t,!1);return this.checkExpressionErrors(t)?i:i.start==r&&"ArrowFunctionExpression"===i.type?i:this.parseExprOp(i,r,n,-1,e)},K.parseExprOp=function(e,t,r,n,i){var o=this.type.binop;if(null!=o&&(!i||this.type!==F._in)&&o>n){var a=this.type===F.logicalOR||this.type===F.logicalAND,s=this.value;this.next();var u=this.start,c=this.startLoc,l=this.parseExprOp(this.parseMaybeUnary(null,!1),u,c,o,i),f=this.buildBinary(t,r,e,l,s,a);return this.parseExprOp(f,t,r,n,i)}return e},K.buildBinary=function(e,t,r,n,i,o){var a=this.startNodeAt(e,t);return a.left=r,a.operator=i,a.right=n,this.finishNode(a,o?"LogicalExpression":"BinaryExpression")},K.parseMaybeUnary=function(e,t){var r,n=this,i=this.start,o=this.startLoc;if(this.inAsync&&this.isContextual("await"))r=this.parseAwait(),t=!0;else if(this.type.prefix){var a=this.startNode(),s=this.type===F.incDec;a.operator=this.value,a.prefix=!0,this.next(),a.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(e,!0),s?this.checkLVal(a.argument):this.strict&&"delete"===a.operator&&"Identifier"===a.argument.type?this.raiseRecoverable(a.start,"Deleting local variable in strict mode"):t=!0,r=this.finishNode(a,s?"UpdateExpression":"UnaryExpression")}else{if(r=this.parseExprSubscripts(e),this.checkExpressionErrors(e))return r;for(;this.type.postfix&&!this.canInsertSemicolon();){var u=n.startNodeAt(i,o);u.operator=n.value,u.prefix=!1,u.argument=r,n.checkLVal(r),n.next(),r=n.finishNode(u,"UpdateExpression")}}return!t&&this.eat(F.starstar)?this.buildBinary(i,o,r,this.parseMaybeUnary(null,!1),"**",!1):r},K.parseExprSubscripts=function(e){var t=this.start,r=this.startLoc,n=this.parseExprAtom(e),i="ArrowFunctionExpression"===n.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd);if(this.checkExpressionErrors(e)||i)return n;var o=this.parseSubscripts(n,t,r);return e&&"MemberExpression"===o.type&&(e.parenthesizedAssign>=o.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=o.start&&(e.parenthesizedBind=-1)),o},K.parseSubscripts=function(e,t,r,n){for(var i=this,o=this.options.ecmaVersion>=8&&"Identifier"===e.type&&"async"===e.name&&this.lastTokEnd==e.end&&!this.canInsertSemicolon(),a=void 0;;)if((a=i.eat(F.bracketL))||i.eat(F.dot)){var s=i.startNodeAt(t,r);s.object=e,s.property=a?i.parseExpression():i.parseIdent(!0),s.computed=!!a,a&&i.expect(F.bracketR),e=i.finishNode(s,"MemberExpression")}else if(!n&&i.eat(F.parenL)){var u=new p,c=i.yieldPos,l=i.awaitPos;i.yieldPos=0,i.awaitPos=0;var f=i.parseExprList(F.parenR,i.options.ecmaVersion>=8,!1,u);if(o&&!i.canInsertSemicolon()&&i.eat(F.arrow))return i.checkPatternErrors(u,!1),i.checkYieldAwaitInDefaultParams(),i.yieldPos=c,i.awaitPos=l,i.parseArrowExpression(i.startNodeAt(t,r),f,!0);i.checkExpressionErrors(u,!0),i.yieldPos=c||i.yieldPos,i.awaitPos=l||i.awaitPos;var h=i.startNodeAt(t,r);h.callee=e,h.arguments=f,e=i.finishNode(h,"CallExpression")}else{if(i.type!==F.backQuote)return e;var d=i.startNodeAt(t,r);d.tag=e,d.quasi=i.parseTemplate({isTagged:!0}),e=i.finishNode(d,"TaggedTemplateExpression")}},K.parseExprAtom=function(e){var t,r=this.potentialArrowAt==this.start;switch(this.type){case F._super:return this.inFunction||this.raise(this.start,"'super' outside of function or class"),t=this.startNode(),this.next(),this.type!==F.dot&&this.type!==F.bracketL&&this.type!==F.parenL&&this.unexpected(),this.finishNode(t,"Super");case F._this:return t=this.startNode(),this.next(),this.finishNode(t,"ThisExpression");case F.name:var n=this.start,i=this.startLoc,o=this.parseIdent(this.type!==F.name);if(this.options.ecmaVersion>=8&&"async"===o.name&&!this.canInsertSemicolon()&&this.eat(F._function))return this.parseFunction(this.startNodeAt(n,i),!1,!1,!0);if(r&&!this.canInsertSemicolon()){if(this.eat(F.arrow))return this.parseArrowExpression(this.startNodeAt(n,i),[o],!1);if(this.options.ecmaVersion>=8&&"async"===o.name&&this.type===F.name)return o=this.parseIdent(),!this.canInsertSemicolon()&&this.eat(F.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(n,i),[o],!0)}return o;case F.regexp:var a=this.value;return t=this.parseLiteral(a.value),t.regex={pattern:a.pattern,flags:a.flags},t;case F.num:case F.string:return this.parseLiteral(this.value);case F._null:case F._true:case F._false:return t=this.startNode(),t.value=this.type===F._null?null:this.type===F._true,t.raw=this.type.keyword,this.next(),this.finishNode(t,"Literal");case F.parenL:var s=this.start,u=this.parseParenAndDistinguishExpression(r);return e&&(e.parenthesizedAssign<0&&!this.isSimpleAssignTarget(u)&&(e.parenthesizedAssign=s),e.parenthesizedBind<0&&(e.parenthesizedBind=s)),u;case F.bracketL:return t=this.startNode(),this.next(),t.elements=this.parseExprList(F.bracketR,!0,!0,e),this.finishNode(t,"ArrayExpression");case F.braceL:return this.parseObj(!1,e);case F._function:return t=this.startNode(),this.next(),this.parseFunction(t,!1);case F._class:return this.parseClass(this.startNode(),!1);case F._new:return this.parseNew();case F.backQuote:return this.parseTemplate();default:this.unexpected()}},K.parseLiteral=function(e){var t=this.startNode();return t.value=e,t.raw=this.input.slice(this.start,this.end),this.next(),this.finishNode(t,"Literal")},K.parseParenExpression=function(){this.expect(F.parenL);var e=this.parseExpression();return this.expect(F.parenR),e},K.parseParenAndDistinguishExpression=function(e){var t,r=this,n=this.start,i=this.startLoc,o=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var a,s,u=this.start,c=this.startLoc,l=[],f=!0,h=!1,d=new p,m=this.yieldPos,v=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==F.parenR;){if(f?f=!1:r.expect(F.comma),o&&r.afterTrailingComma(F.parenR,!0)){h=!0;break}if(r.type===F.ellipsis){a=r.start,l.push(r.parseParenItem(r.parseRestBinding())),r.type===F.comma&&r.raise(r.start,"Comma is not permitted after the rest element");break}r.type!==F.parenL||s||(s=r.start),l.push(r.parseMaybeAssign(!1,d,r.parseParenItem))}var y=this.start,g=this.startLoc;if(this.expect(F.parenR),e&&!this.canInsertSemicolon()&&this.eat(F.arrow))return this.checkPatternErrors(d,!1),this.checkYieldAwaitInDefaultParams(),s&&this.unexpected(s),this.yieldPos=m,this.awaitPos=v,this.parseParenArrowList(n,i,l);l.length&&!h||this.unexpected(this.lastTokStart),a&&this.unexpected(a),this.checkExpressionErrors(d,!0),this.yieldPos=m||this.yieldPos,this.awaitPos=v||this.awaitPos,l.length>1?((t=this.startNodeAt(u,c)).expressions=l,this.finishNodeAt(t,"SequenceExpression",y,g)):t=l[0]}else t=this.parseParenExpression();if(this.options.preserveParens){var b=this.startNodeAt(n,i);return b.expression=t,this.finishNode(b,"ParenthesizedExpression")}return t},K.parseParenItem=function(e){return e},K.parseParenArrowList=function(e,t,r){return this.parseArrowExpression(this.startNodeAt(e,t),r)};var Q=[];K.parseNew=function(){var e=this.startNode(),t=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(F.dot))return e.meta=t,e.property=this.parseIdent(!0),"target"!==e.property.name&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is new.target"),this.inFunction||this.raiseRecoverable(e.start,"new.target can only be used in functions"),this.finishNode(e,"MetaProperty");var r=this.start,n=this.startLoc;return e.callee=this.parseSubscripts(this.parseExprAtom(),r,n,!0),this.eat(F.parenL)?e.arguments=this.parseExprList(F.parenR,this.options.ecmaVersion>=8,!1):e.arguments=Q,this.finishNode(e,"NewExpression")},K.parseTemplateElement=function(e){var t=e.isTagged,r=this.startNode();return this.type===F.invalidTemplate?(t||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),r.value={raw:this.value,cooked:null}):r.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),r.tail=this.type===F.backQuote,this.finishNode(r,"TemplateElement")},K.parseTemplate=function(e){var t=this;void 0===e&&(e={});var r=e.isTagged;void 0===r&&(r=!1);var n=this.startNode();this.next(),n.expressions=[];var i=this.parseTemplateElement({isTagged:r});for(n.quasis=[i];!i.tail;)t.expect(F.dollarBraceL),n.expressions.push(t.parseExpression()),t.expect(F.braceR),n.quasis.push(i=t.parseTemplateElement({isTagged:r}));return this.next(),this.finishNode(n,"TemplateLiteral")},K.isAsyncProp=function(e){return!e.computed&&"Identifier"===e.key.type&&"async"===e.key.name&&(this.type===F.name||this.type===F.num||this.type===F.string||this.type===F.bracketL||this.type.keyword)&&!j.test(this.input.slice(this.lastTokEnd,this.start))},K.parseObj=function(e,t){var r=this,n=this.startNode(),i=!0,o={};for(n.properties=[],this.next();!this.eat(F.braceR);){if(i)i=!1;else if(r.expect(F.comma),r.afterTrailingComma(F.braceR))break;var a=r.parseProperty(e,t);r.checkPropClash(a,o),n.properties.push(a)}return this.finishNode(n,e?"ObjectPattern":"ObjectExpression")},K.parseProperty=function(e,t){var r,n,i,o,a=this.startNode();return this.options.ecmaVersion>=6&&(a.method=!1,a.shorthand=!1,(e||t)&&(i=this.start,o=this.startLoc),e||(r=this.eat(F.star))),this.parsePropertyName(a),!e&&this.options.ecmaVersion>=8&&!r&&this.isAsyncProp(a)?(n=!0,this.parsePropertyName(a,t)):n=!1,this.parsePropertyValue(a,e,r,n,i,o,t),this.finishNode(a,"Property")},K.parsePropertyValue=function(e,t,r,n,i,o,a){if((r||n)&&this.type===F.colon&&this.unexpected(),this.eat(F.colon))e.value=t?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),e.kind="init";else if(this.options.ecmaVersion>=6&&this.type===F.parenL)t&&this.unexpected(),e.kind="init",e.method=!0,e.value=this.parseMethod(r,n);else if(t||!(this.options.ecmaVersion>=5)||e.computed||"Identifier"!==e.key.type||"get"!==e.key.name&&"set"!==e.key.name||this.type==F.comma||this.type==F.braceR)this.options.ecmaVersion>=6&&!e.computed&&"Identifier"===e.key.type?(this.checkUnreserved(e.key),e.kind="init",t?e.value=this.parseMaybeDefault(i,o,e.key):this.type===F.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),e.value=this.parseMaybeDefault(i,o,e.key)):e.value=e.key,e.shorthand=!0):this.unexpected();else{(r||n)&&this.unexpected(),e.kind=e.key.name,this.parsePropertyName(e),e.value=this.parseMethod(!1);var s="get"===e.kind?0:1;if(e.value.params.length!==s){var u=e.value.start;"get"===e.kind?this.raiseRecoverable(u,"getter should have no params"):this.raiseRecoverable(u,"setter should have exactly one param")}else"set"===e.kind&&"RestElement"===e.value.params[0].type&&this.raiseRecoverable(e.value.params[0].start,"Setter cannot use rest params")}},K.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(F.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(F.bracketR),e.key;e.computed=!1}return e.key=this.type===F.num||this.type===F.string?this.parseExprAtom():this.parseIdent(!0)},K.initFunction=function(e){e.id=null,this.options.ecmaVersion>=6&&(e.generator=!1,e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)},K.parseMethod=function(e,t){var r=this.startNode(),n=this.inGenerator,i=this.inAsync,o=this.yieldPos,a=this.awaitPos,s=this.inFunction;return this.initFunction(r),this.options.ecmaVersion>=6&&(r.generator=e),this.options.ecmaVersion>=8&&(r.async=!!t),this.inGenerator=r.generator,this.inAsync=r.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,this.enterFunctionScope(),this.expect(F.parenL),r.params=this.parseBindingList(F.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(r,!1),this.inGenerator=n,this.inAsync=i,this.yieldPos=o,this.awaitPos=a,this.inFunction=s,this.finishNode(r,"FunctionExpression")},K.parseArrowExpression=function(e,t,r){var n=this.inGenerator,i=this.inAsync,o=this.yieldPos,a=this.awaitPos,s=this.inFunction;return this.enterFunctionScope(),this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!r),this.inGenerator=!1,this.inAsync=e.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,e.params=this.toAssignableList(t,!0),this.parseFunctionBody(e,!0),this.inGenerator=n,this.inAsync=i,this.yieldPos=o,this.awaitPos=a,this.inFunction=s,this.finishNode(e,"ArrowFunctionExpression")},K.parseFunctionBody=function(e,t){var r=t&&this.type!==F.braceL,n=this.strict,i=!1;if(r)e.body=this.parseMaybeAssign(),e.expression=!0,this.checkParams(e,!1);else{var o=this.options.ecmaVersion>=7&&!this.isSimpleParamList(e.params);n&&!o||(i=this.strictDirective(this.end))&&o&&this.raiseRecoverable(e.start,"Illegal 'use strict' directive in function with non-simple parameter list");var a=this.labels;this.labels=[],i&&(this.strict=!0),this.checkParams(e,!n&&!i&&!t&&this.isSimpleParamList(e.params)),e.body=this.parseBlock(!1),e.expression=!1,this.adaptDirectivePrologue(e.body.body),this.labels=a}this.exitFunctionScope(),this.strict&&e.id&&this.checkLVal(e.id,"none"),this.strict=n},K.isSimpleParamList=function(e){for(var t=0,r=e;t<r.length;t+=1)if("Identifier"!==r[t].type)return!1;return!0},K.checkParams=function(e,t){for(var r=this,n={},i=0,o=e.params;i<o.length;i+=1){var a=o[i];r.checkLVal(a,"var",t?null:n)}},K.parseExprList=function(e,t,r,n){for(var i=this,o=[],a=!0;!this.eat(e);){if(a)a=!1;else if(i.expect(F.comma),t&&i.afterTrailingComma(e))break;var s=void 0;r&&i.type===F.comma?s=null:i.type===F.ellipsis?(s=i.parseSpread(n),n&&i.type===F.comma&&n.trailingComma<0&&(n.trailingComma=i.start)):s=i.parseMaybeAssign(!1,n),o.push(s)}return o},K.checkUnreserved=function(e){var t=e.start,r=e.end,n=e.name;this.inGenerator&&"yield"===n&&this.raiseRecoverable(t,"Can not use 'yield' as identifier inside a generator"),this.inAsync&&"await"===n&&this.raiseRecoverable(t,"Can not use 'await' as identifier inside an async function"),this.isKeyword(n)&&this.raise(t,"Unexpected keyword '"+n+"'"),this.options.ecmaVersion<6&&-1!=this.input.slice(t,r).indexOf("\\")||(this.strict?this.reservedWordsStrict:this.reservedWords).test(n)&&this.raiseRecoverable(t,"The keyword '"+n+"' is reserved")},K.parseIdent=function(e,t){var r=this.startNode();return e&&"never"==this.options.allowReserved&&(e=!1),this.type===F.name?r.name=this.value:this.type.keyword?(r.name=this.type.keyword,"class"!==r.name&&"function"!==r.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop()):this.unexpected(),this.next(),this.finishNode(r,"Identifier"),e||this.checkUnreserved(r),r},K.parseYield=function(){this.yieldPos||(this.yieldPos=this.start);var e=this.startNode();return this.next(),this.type==F.semi||this.canInsertSemicolon()||this.type!=F.star&&!this.type.startsExpr?(e.delegate=!1,e.argument=null):(e.delegate=this.eat(F.star),e.argument=this.parseMaybeAssign()),this.finishNode(e,"YieldExpression")},K.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!0),this.finishNode(e,"AwaitExpression")};var Y=W.prototype;Y.raise=function(e,t){var r=u(this.input,e);t+=" ("+r.line+":"+r.column+")";var n=new SyntaxError(t);throw n.pos=e,n.loc=r,n.raisedAt=this.pos,n},Y.raiseRecoverable=Y.raise,Y.curPosition=function(){if(this.options.locations)return new N(this.curLine,this.pos-this.lineStart)};var Z=W.prototype,ee=Object.assign||function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var n=0,i=t;n<i.length;n+=1){var o=i[n];for(var a in o)s(o,a)&&(e[a]=o[a])}return e};Z.enterFunctionScope=function(){this.scopeStack.push({var:{},lexical:{},childVar:{},parentLexical:{}})},Z.exitFunctionScope=function(){this.scopeStack.pop()},Z.enterLexicalScope=function(){var e=this.scopeStack[this.scopeStack.length-1],t={var:{},lexical:{},childVar:{},parentLexical:{}};this.scopeStack.push(t),ee(t.parentLexical,e.lexical,e.parentLexical)},Z.exitLexicalScope=function(){var e=this.scopeStack.pop(),t=this.scopeStack[this.scopeStack.length-1];ee(t.childVar,e.var,e.childVar)},Z.canDeclareVarName=function(e){var t=this.scopeStack[this.scopeStack.length-1];return!s(t.lexical,e)&&!s(t.parentLexical,e)},Z.canDeclareLexicalName=function(e){var t=this.scopeStack[this.scopeStack.length-1];return!s(t.lexical,e)&&!s(t.var,e)&&!s(t.childVar,e)},Z.declareVarName=function(e){this.scopeStack[this.scopeStack.length-1].var[e]=!0},Z.declareLexicalName=function(e){this.scopeStack[this.scopeStack.length-1].lexical[e]=!0};var te=function(e,t,r){this.type="",this.start=t,this.end=0,e.options.locations&&(this.loc=new M(e,r)),e.options.directSourceFile&&(this.sourceFile=e.options.directSourceFile),e.options.ranges&&(this.range=[t,0])},re=W.prototype;re.startNode=function(){return new te(this,this.start,this.startLoc)},re.startNodeAt=function(e,t){return new te(this,e,t)},re.finishNode=function(e,t){return h.call(this,e,t,this.lastTokEnd,this.lastTokEndLoc)},re.finishNodeAt=function(e,t,r,n){return h.call(this,e,t,r,n)};var ne=function(e,t,r,n,i){this.token=e,this.isExpr=!!t,this.preserveSpace=!!r,this.override=n,this.generator=!!i},ie={b_stat:new ne("{",!1),b_expr:new ne("{",!0),b_tmpl:new ne("${",!1),p_stat:new ne("(",!1),p_expr:new ne("(",!0),q_tmpl:new ne("`",!0,!0,function(e){return e.tryReadTemplateToken()}),f_stat:new ne("function",!1),f_expr:new ne("function",!0),f_expr_gen:new ne("function",!0,!1,null,!0),f_gen:new ne("function",!1,!1,null,!0)},oe=W.prototype;oe.initialContext=function(){return[ie.b_stat]},oe.braceIsBlock=function(e){var t=this.curContext();return t===ie.f_expr||t===ie.f_stat||(e!==F.colon||t!==ie.b_stat&&t!==ie.b_expr?e===F._return||e==F.name&&this.exprAllowed?j.test(this.input.slice(this.lastTokEnd,this.start)):e===F._else||e===F.semi||e===F.eof||e===F.parenR||e==F.arrow||(e==F.braceL?t===ie.b_stat:e!=F._var&&e!=F.name&&!this.exprAllowed):!t.isExpr)},oe.inGeneratorContext=function(){for(var e=this,t=this.context.length-1;t>=1;t--){var r=e.context[t];if("function"===r.token)return r.generator}return!1},oe.updateContext=function(e){var t,r=this.type;r.keyword&&e==F.dot?this.exprAllowed=!1:(t=r.updateContext)?t.call(this,e):this.exprAllowed=r.beforeExpr},F.parenR.updateContext=F.braceR.updateContext=function(){if(1!=this.context.length){var e=this.context.pop();e===ie.b_stat&&"function"===this.curContext().token&&(e=this.context.pop()),this.exprAllowed=!e.isExpr}else this.exprAllowed=!0},F.braceL.updateContext=function(e){this.context.push(this.braceIsBlock(e)?ie.b_stat:ie.b_expr),this.exprAllowed=!0},F.dollarBraceL.updateContext=function(){this.context.push(ie.b_tmpl),this.exprAllowed=!0},F.parenL.updateContext=function(e){var t=e===F._if||e===F._for||e===F._with||e===F._while;this.context.push(t?ie.p_stat:ie.p_expr),this.exprAllowed=!0},F.incDec.updateContext=function(){},F._function.updateContext=F._class.updateContext=function(e){e.beforeExpr&&e!==F.semi&&e!==F._else&&(e!==F.colon&&e!==F.braceL||this.curContext()!==ie.b_stat)?this.context.push(ie.f_expr):this.context.push(ie.f_stat),this.exprAllowed=!1},F.backQuote.updateContext=function(){this.curContext()===ie.q_tmpl?this.context.pop():this.context.push(ie.q_tmpl),this.exprAllowed=!1},F.star.updateContext=function(e){if(e==F._function){var t=this.context.length-1;this.context[t]===ie.f_expr?this.context[t]=ie.f_expr_gen:this.context[t]=ie.f_gen}this.exprAllowed=!0},F.name.updateContext=function(e){var t=!1;this.options.ecmaVersion>=6&&("of"==this.value&&!this.exprAllowed||"yield"==this.value&&this.inGeneratorContext())&&(t=!0),this.exprAllowed=t};var ae=function(e){this.type=e.type,this.value=e.value,this.start=e.start,this.end=e.end,e.options.locations&&(this.loc=new M(e,e.startLoc,e.endLoc)),e.options.ranges&&(this.range=[e.start,e.end])},se=W.prototype,ue="object"==typeof Packages&&"[object JavaPackage]"==Object.prototype.toString.call(Packages);se.next=function(){this.options.onToken&&this.options.onToken(new ae(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},se.getToken=function(){return this.next(),new ae(this)},"undefined"!=typeof Symbol&&(se[Symbol.iterator]=function(){var e=this;return{next:function(){var t=e.getToken();return{done:t.type===F.eof,value:t}}}}),se.curContext=function(){return this.context[this.context.length-1]},se.nextToken=function(){var e=this.curContext();return e&&e.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(F.eof):e.override?e.override(this):void this.readToken(this.fullCharCodeAtPos())},se.readToken=function(e){return r(e,this.options.ecmaVersion>=6)||92===e?this.readWord():this.getTokenFromCode(e)},se.fullCharCodeAtPos=function(){var e=this.input.charCodeAt(this.pos);return e<=55295||e>=57344?e:(e<<10)+this.input.charCodeAt(this.pos+1)-56613888},se.skipBlockComment=function(){var e=this,t=this.options.onComment&&this.curPosition(),r=this.pos,n=this.input.indexOf("*/",this.pos+=2);if(-1===n&&this.raise(this.pos-2,"Unterminated comment"),this.pos=n+2,this.options.locations){T.lastIndex=r;for(var i;(i=T.exec(this.input))&&i.index<this.pos;)++e.curLine,e.lineStart=i.index+i[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(r+2,n),r,this.pos,t,this.curPosition())},se.skipLineComment=function(e){for(var t=this,r=this.pos,n=this.options.onComment&&this.curPosition(),i=this.input.charCodeAt(this.pos+=e);this.pos<this.input.length&&!a(i);)i=t.input.charCodeAt(++t.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(r+e,this.pos),r,this.pos,n,this.curPosition())},se.skipSpace=function(){var e=this;e:for(;this.pos<this.input.length;){var t=e.input.charCodeAt(e.pos);switch(t){case 32:case 160:++e.pos;break;case 13:10===e.input.charCodeAt(e.pos+1)&&++e.pos;case 10:case 8232:case 8233:++e.pos,e.options.locations&&(++e.curLine,e.lineStart=e.pos);break;case 47:switch(e.input.charCodeAt(e.pos+1)){case 42:e.skipBlockComment();break;case 47:e.skipLineComment(2);break;default:break e}break;default:if(!(t>8&&t<14||t>=5760&&O.test(String.fromCharCode(t))))break e;++e.pos}}},se.finishToken=function(e,t){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var r=this.type;this.type=e,this.value=t,this.updateContext(r)},se.readToken_dot=function(){var e=this.input.charCodeAt(this.pos+1);if(e>=48&&e<=57)return this.readNumber(!0);var t=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===e&&46===t?(this.pos+=3,this.finishToken(F.ellipsis)):(++this.pos,this.finishToken(F.dot))},se.readToken_slash=function(){var e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===e?this.finishOp(F.assign,2):this.finishOp(F.slash,1)},se.readToken_mult_modulo_exp=function(e){var t=this.input.charCodeAt(this.pos+1),r=1,n=42===e?F.star:F.modulo;return this.options.ecmaVersion>=7&&42==e&&42===t&&(++r,n=F.starstar,t=this.input.charCodeAt(this.pos+2)),61===t?this.finishOp(F.assign,r+1):this.finishOp(n,r)},se.readToken_pipe_amp=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?this.finishOp(124===e?F.logicalOR:F.logicalAND,2):61===t?this.finishOp(F.assign,2):this.finishOp(124===e?F.bitwiseOR:F.bitwiseAND,1)},se.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(F.assign,2):this.finishOp(F.bitwiseXOR,1)},se.readToken_plus_min=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?45!=t||this.inModule||62!=this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!j.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(F.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===t?this.finishOp(F.assign,2):this.finishOp(F.plusMin,1)},se.readToken_lt_gt=function(e){var t=this.input.charCodeAt(this.pos+1),r=1;return t===e?(r=62===e&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+r)?this.finishOp(F.assign,r+1):this.finishOp(F.bitShift,r)):33!=t||60!=e||this.inModule||45!=this.input.charCodeAt(this.pos+2)||45!=this.input.charCodeAt(this.pos+3)?(61===t&&(r=2),this.finishOp(F.relational,r)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},se.readToken_eq_excl=function(e){var t=this.input.charCodeAt(this.pos+1);return 61===t?this.finishOp(F.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===e&&62===t&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(F.arrow)):this.finishOp(61===e?F.eq:F.prefix,1)},se.getTokenFromCode=function(e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(F.parenL);case 41:return++this.pos,this.finishToken(F.parenR);case 59:return++this.pos,this.finishToken(F.semi);case 44:return++this.pos,this.finishToken(F.comma);case 91:return++this.pos,this.finishToken(F.bracketL);case 93:return++this.pos,this.finishToken(F.bracketR);case 123:return++this.pos,this.finishToken(F.braceL);case 125:return++this.pos,this.finishToken(F.braceR);case 58:return++this.pos,this.finishToken(F.colon);case 63:return++this.pos,this.finishToken(F.question);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(F.backQuote);case 48:var t=this.input.charCodeAt(this.pos+1);if(120===t||88===t)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===t||79===t)return this.readRadixNumber(8);if(98===t||66===t)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 126:return this.finishOp(F.prefix,1)}this.raise(this.pos,"Unexpected character '"+m(e)+"'")},se.finishOp=function(e,t){var r=this.input.slice(this.pos,this.pos+t);return this.pos+=t,this.finishToken(e,r)};var ce=!!d("","u");se.readRegexp=function(){for(var e,t,r=this,n=this.pos;;){r.pos>=r.input.length&&r.raise(n,"Unterminated regular expression");var i=r.input.charAt(r.pos);if(j.test(i)&&r.raise(n,"Unterminated regular expression"),e)e=!1;else{if("["===i)t=!0;else if("]"===i&&t)t=!1;else if("/"===i&&!t)break;e="\\"===i}++r.pos}var o=this.input.slice(n,this.pos);++this.pos;var a=this.readWord1(),s=o,u="";if(a){var c=/^[gim]*$/;this.options.ecmaVersion>=6&&(c=/^[gimuy]*$/),c.test(a)||this.raise(n,"Invalid regular expression flag"),a.indexOf("u")>=0&&(ce?u="u":(s=(s=s.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(e,t,i){return(t=Number("0x"+t))>1114111&&r.raise(n+i+3,"Code point out of bounds"),"x"})).replace(/\\u([a-fA-F0-9]{4})|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"),u=u.replace("u","")))}var l=null;return ue||(d(s,u,n,this),l=d(o,a)),this.finishToken(F.regexp,{pattern:o,flags:a,value:l})},se.readInt=function(e,t){for(var r=this,n=this.pos,i=0,o=0,a=null==t?1/0:t;o<a;++o){var s=r.input.charCodeAt(r.pos),u=void 0;if((u=s>=97?s-97+10:s>=65?s-65+10:s>=48&&s<=57?s-48:1/0)>=e)break;++r.pos,i=i*e+u}return this.pos===n||null!=t&&this.pos-n!==t?null:i},se.readRadixNumber=function(e){this.pos+=2;var t=this.readInt(e);return null==t&&this.raise(this.start+2,"Expected number in radix "+e),r(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(F.num,t)},se.readNumber=function(e){var t=this.pos,n=!1,i=48===this.input.charCodeAt(this.pos);e||null!==this.readInt(10)||this.raise(t,"Invalid number"),i&&this.pos==t+1&&(i=!1);var o=this.input.charCodeAt(this.pos);46!==o||i||(++this.pos,this.readInt(10),n=!0,o=this.input.charCodeAt(this.pos)),69!==o&&101!==o||i||(43!==(o=this.input.charCodeAt(++this.pos))&&45!==o||++this.pos,null===this.readInt(10)&&this.raise(t,"Invalid number"),n=!0),r(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var a,s=this.input.slice(t,this.pos);return n?a=parseFloat(s):i&&1!==s.length?this.strict?this.raise(t,"Invalid number"):a=/[89]/.test(s)?parseInt(s,10):parseInt(s,8):a=parseInt(s,10),this.finishToken(F.num,a)},se.readCodePoint=function(){var e;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var t=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,e>1114111&&this.invalidStringToken(t,"Code point out of bounds")}else e=this.readHexChar(4);return e},se.readString=function(e){for(var t=this,r="",n=++this.pos;;){t.pos>=t.input.length&&t.raise(t.start,"Unterminated string constant");var i=t.input.charCodeAt(t.pos);if(i===e)break;92===i?(r+=t.input.slice(n,t.pos),r+=t.readEscapedChar(!1),n=t.pos):(a(i)&&t.raise(t.start,"Unterminated string constant"),++t.pos)}return r+=this.input.slice(n,this.pos++),this.finishToken(F.string,r)};var le={};se.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(e){if(e!==le)throw e;this.readInvalidTemplateToken()}this.inTemplateElement=!1},se.invalidStringToken=function(e,t){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw le;this.raise(e,t)},se.readTmplToken=function(){for(var e=this,t="",r=this.pos;;){e.pos>=e.input.length&&e.raise(e.start,"Unterminated template");var n=e.input.charCodeAt(e.pos);if(96===n||36===n&&123===e.input.charCodeAt(e.pos+1))return e.pos!==e.start||e.type!==F.template&&e.type!==F.invalidTemplate?(t+=e.input.slice(r,e.pos),e.finishToken(F.template,t)):36===n?(e.pos+=2,e.finishToken(F.dollarBraceL)):(++e.pos,e.finishToken(F.backQuote));if(92===n)t+=e.input.slice(r,e.pos),t+=e.readEscapedChar(!0),r=e.pos;else if(a(n)){switch(t+=e.input.slice(r,e.pos),++e.pos,n){case 13:10===e.input.charCodeAt(e.pos)&&++e.pos;case 10:t+="\n";break;default:t+=String.fromCharCode(n)}e.options.locations&&(++e.curLine,e.lineStart=e.pos),r=e.pos}else++e.pos}},se.readInvalidTemplateToken=function(){for(var e=this;this.pos<this.input.length;this.pos++)switch(e.input[e.pos]){case"\\":++e.pos;break;case"$":if("{"!==e.input[e.pos+1])break;case"`":return e.finishToken(F.invalidTemplate,e.input.slice(e.start,e.pos))}this.raise(this.start,"Unterminated template")},se.readEscapedChar=function(e){var t=this.input.charCodeAt(++this.pos);switch(++this.pos,t){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return m(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";default:if(t>=48&&t<=55){var r=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],n=parseInt(r,8);return n>255&&(r=r.slice(0,-1),n=parseInt(r,8)),"0"!==r&&(this.strict||e)&&this.invalidStringToken(this.pos-2,"Octal literal in strict mode"),this.pos+=r.length-1,String.fromCharCode(n)}return String.fromCharCode(t)}},se.readHexChar=function(e){var t=this.pos,r=this.readInt(16,e);return null===r&&this.invalidStringToken(t,"Bad character escape sequence"),r},se.readWord1=function(){var e=this;this.containsEsc=!1;for(var t="",i=!0,o=this.pos,a=this.options.ecmaVersion>=6;this.pos<this.input.length;){var s=e.fullCharCodeAtPos();if(n(s,a))e.pos+=s<=65535?1:2;else{if(92!==s)break;e.containsEsc=!0,t+=e.input.slice(o,e.pos);var u=e.pos;117!=e.input.charCodeAt(++e.pos)&&e.invalidStringToken(e.pos,"Expecting Unicode escape sequence \\uXXXX"),++e.pos;var c=e.readCodePoint();(i?r:n)(c,a)||e.invalidStringToken(u,"Invalid Unicode escape"),t+=m(c),o=e.pos}i=!1}return t+this.input.slice(o,this.pos)},se.readWord=function(){var e=this.readWord1(),t=F.name;return this.keywords.test(e)&&(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+e),t=C[e]),this.finishToken(t,e)};e.version="5.2.1",e.parse=function(e,t){return new W(t,e).parse()},e.parseExpressionAt=function(e,t,r){var n=new W(r,e,t);return n.nextToken(),n.parseExpression()},e.tokenizer=function(e,t){return new W(t,e)},e.addLooseExports=function(t,r,n){e.parse_dammit=t,e.LooseParser=r,e.pluginsLoose=n},e.Parser=W,e.plugins=$,e.defaultOptions=q,e.Position=N,e.SourceLocation=M,e.getLineInfo=u,e.Node=te,e.TokenType=S,e.tokTypes=F,e.keywordTypes=C,e.TokContext=ne,e.tokContexts=ie,e.isIdentifierChar=n,e.isIdentifierStart=r,e.Token=ae,e.isNewLine=a,e.lineBreak=j,e.lineBreakG=T,e.nonASCIIwhitespace=O,Object.defineProperty(e,"__esModule",{value:!0})}),function(t,r){"function"==typeof e&&e.amd?e(["exports"],r):r((t.acorn=t.acorn||{},t.acorn.walk=t.acorn.walk||{}))}(this,function(e){"use strict";function t(e){return"string"==typeof e?function(t){return t==e}:e||function(){return!0}}function r(e,t,r){r(e,t)}function n(e,t,r){}var i=function(e,t){this.node=e,this.state=t},o=Object.create||function(e){function t(){}return t.prototype=e,new t},a={};a.Program=a.BlockStatement=function(e,t,r){for(var n=0,i=e.body;n<i.length;n+=1)r(i[n],t,"Statement")},a.Statement=r,a.EmptyStatement=n,a.ExpressionStatement=a.ParenthesizedExpression=function(e,t,r){return r(e.expression,t,"Expression")},a.IfStatement=function(e,t,r){r(e.test,t,"Expression"),r(e.consequent,t,"Statement"),e.alternate&&r(e.alternate,t,"Statement")},a.LabeledStatement=function(e,t,r){return r(e.body,t,"Statement")},a.BreakStatement=a.ContinueStatement=n,a.WithStatement=function(e,t,r){r(e.object,t,"Expression"),r(e.body,t,"Statement")},a.SwitchStatement=function(e,t,r){r(e.discriminant,t,"Expression");for(var n=0,i=e.cases;n<i.length;n+=1){var o=i[n];o.test&&r(o.test,t,"Expression");for(var a=0,s=o.consequent;a<s.length;a+=1)r(s[a],t,"Statement")}},a.ReturnStatement=a.YieldExpression=a.AwaitExpression=function(e,t,r){e.argument&&r(e.argument,t,"Expression")},a.ThrowStatement=a.SpreadElement=function(e,t,r){return r(e.argument,t,"Expression")},a.TryStatement=function(e,t,r){r(e.block,t,"Statement"),e.handler&&r(e.handler,t),e.finalizer&&r(e.finalizer,t,"Statement")},a.CatchClause=function(e,t,r){r(e.param,t,"Pattern"),r(e.body,t,"ScopeBody")},a.WhileStatement=a.DoWhileStatement=function(e,t,r){r(e.test,t,"Expression"),r(e.body,t,"Statement")},a.ForStatement=function(e,t,r){e.init&&r(e.init,t,"ForInit"),e.test&&r(e.test,t,"Expression"),e.update&&r(e.update,t,"Expression"),r(e.body,t,"Statement")},a.ForInStatement=a.ForOfStatement=function(e,t,r){r(e.left,t,"ForInit"),r(e.right,t,"Expression"),r(e.body,t,"Statement")},a.ForInit=function(e,t,r){"VariableDeclaration"==e.type?r(e,t):r(e,t,"Expression")},a.DebuggerStatement=n,a.FunctionDeclaration=function(e,t,r){return r(e,t,"Function")},a.VariableDeclaration=function(e,t,r){for(var n=0,i=e.declarations;n<i.length;n+=1)r(i[n],t)},a.VariableDeclarator=function(e,t,r){r(e.id,t,"Pattern"),e.init&&r(e.init,t,"Expression")},a.Function=function(e,t,r){e.id&&r(e.id,t,"Pattern");for(var n=0,i=e.params;n<i.length;n+=1)r(i[n],t,"Pattern");r(e.body,t,e.expression?"ScopeExpression":"ScopeBody")},a.ScopeBody=function(e,t,r){return r(e,t,"Statement")},a.ScopeExpression=function(e,t,r){return r(e,t,"Expression")},a.Pattern=function(e,t,r){"Identifier"==e.type?r(e,t,"VariablePattern"):"MemberExpression"==e.type?r(e,t,"MemberPattern"):r(e,t)},a.VariablePattern=n,a.MemberPattern=r,a.RestElement=function(e,t,r){return r(e.argument,t,"Pattern")},a.ArrayPattern=function(e,t,r){for(var n=0,i=e.elements;n<i.length;n+=1){var o=i[n];o&&r(o,t,"Pattern")}},a.ObjectPattern=function(e,t,r){for(var n=0,i=e.properties;n<i.length;n+=1)r(i[n].value,t,"Pattern")},a.Expression=r,a.ThisExpression=a.Super=a.MetaProperty=n,a.ArrayExpression=function(e,t,r){for(var n=0,i=e.elements;n<i.length;n+=1){var o=i[n];o&&r(o,t,"Expression")}},a.ObjectExpression=function(e,t,r){for(var n=0,i=e.properties;n<i.length;n+=1)r(i[n],t)},a.FunctionExpression=a.ArrowFunctionExpression=a.FunctionDeclaration,a.SequenceExpression=a.TemplateLiteral=function(e,t,r){for(var n=0,i=e.expressions;n<i.length;n+=1)r(i[n],t,"Expression")},a.UnaryExpression=a.UpdateExpression=function(e,t,r){r(e.argument,t,"Expression")},a.BinaryExpression=a.LogicalExpression=function(e,t,r){r(e.left,t,"Expression"),r(e.right,t,"Expression")},a.AssignmentExpression=a.AssignmentPattern=function(e,t,r){r(e.left,t,"Pattern"),r(e.right,t,"Expression")},a.ConditionalExpression=function(e,t,r){r(e.test,t,"Expression"),r(e.consequent,t,"Expression"),r(e.alternate,t,"Expression")},a.NewExpression=a.CallExpression=function(e,t,r){if(r(e.callee,t,"Expression"),e.arguments)for(var n=0,i=e.arguments;n<i.length;n+=1)r(i[n],t,"Expression")},a.MemberExpression=function(e,t,r){r(e.object,t,"Expression"),e.computed&&r(e.property,t,"Expression")},a.ExportNamedDeclaration=a.ExportDefaultDeclaration=function(e,t,r){e.declaration&&r(e.declaration,t,"ExportNamedDeclaration"==e.type||e.declaration.id?"Statement":"Expression"),e.source&&r(e.source,t,"Expression")},a.ExportAllDeclaration=function(e,t,r){r(e.source,t,"Expression")},a.ImportDeclaration=function(e,t,r){for(var n=0,i=e.specifiers;n<i.length;n+=1)r(i[n],t);r(e.source,t,"Expression")},a.ImportSpecifier=a.ImportDefaultSpecifier=a.ImportNamespaceSpecifier=a.Identifier=a.Literal=n,a.TaggedTemplateExpression=function(e,t,r){r(e.tag,t,"Expression"),r(e.quasi,t)},a.ClassDeclaration=a.ClassExpression=function(e,t,r){return r(e,t,"Class")},a.Class=function(e,t,r){e.id&&r(e.id,t,"Pattern"),e.superClass&&r(e.superClass,t,"Expression");for(var n=0,i=e.body.body;n<i.length;n+=1)r(i[n],t)},a.MethodDefinition=a.Property=function(e,t,r){e.computed&&r(e.key,t,"Expression"),r(e.value,t,"Expression")},e.simple=function(t,r,n,i,o){n||(n=e.base),function e(t,i,o){var a=o||t.type,s=r[a];n[a](t,i,e),s&&s(t,i)}(t,i,o)},e.ancestor=function(t,r,n,i){n||(n=e.base);var o=[];!function e(t,i,a){var s=a||t.type,u=r[s],c=t!=o[o.length-1];c&&o.push(t),n[s](t,i,e),u&&u(t,i||o,o),c&&o.pop()}(t,i)},e.recursive=function(t,r,n,i,o){var a=n?e.make(n,i):i;!function e(t,r,n){a[n||t.type](t,r,e)}(t,r,o)},e.full=function(t,r,n,i,o){n||(n=e.base),function e(t,i,o){var a=o||t.type;n[a](t,i,e),o||r(t,i,a)}(t,i,o)},e.fullAncestor=function(t,r,n,i){n||(n=e.base);var o=[];!function e(t,i,a){var s=a||t.type,u=t!=o[o.length-1];u&&o.push(t),n[s](t,i,e),a||r(t,i||o,o,s),u&&o.pop()}(t,i)},e.findNodeAt=function(r,n,o,a,s,u){a=t(a),s||(s=e.base);try{!function e(t,r,u){var c=u||t.type;if((null==n||t.start<=n)&&(null==o||t.end>=o)&&s[c](t,r,e),(null==n||t.start==n)&&(null==o||t.end==o)&&a(c,t))throw new i(t,r)}(r,u)}catch(e){if(e instanceof i)return e;throw e}},e.findNodeAround=function(r,n,o,a,s){o=t(o),a||(a=e.base);try{!function e(t,r,s){var u=s||t.type;if(!(t.start>n||t.end<n)&&(a[u](t,r,e),o(u,t)))throw new i(t,r)}(r,s)}catch(e){if(e instanceof i)return e;throw e}},e.findNodeAfter=function(r,n,o,a,s){o=t(o),a||(a=e.base);try{!function e(t,r,s){if(!(t.end<n)){var u=s||t.type;if(t.start>=n&&o(u,t))throw new i(t,r);a[u](t,r,e)}}(r,s)}catch(e){if(e instanceof i)return e;throw e}},e.findNodeBefore=function(r,n,o,a,s){o=t(o),a||(a=e.base);var u;return function e(t,r,s){if(!(t.start>n)){var c=s||t.type;t.end<=n&&(!u||u.node.end<t.end)&&o(c,t)&&(u=new i(t,r)),a[c](t,r,e)}}(r,s),u},e.make=function(t,r){r||(r=e.base);var n=o(r);for(var i in t)n[i]=t[i];return n},e.base=a,Object.defineProperty(e,"__esModule",{value:!0})}),function(t,r){"function"==typeof e&&e.amd?e(["exports","./acorn"],r):r((t.acorn=t.acorn||{},t.acorn.loose=t.acorn.loose||{}),t.acorn)}(this,function(e,t){"use strict";function r(e){return e<14&&e>8||32===e||160===e||t.isNewLine(e)}function n(e){return""==e.name}function i(e,t){return new a(e,t).parse()}var o={},a=function(e,r){if(void 0===r&&(r={}),this.toks=t.tokenizer(e,r),this.options=this.toks.options,this.input=this.toks.input,this.tok=this.last={type:t.tokTypes.eof,start:0,end:0},this.options.locations){var n=this.toks.curPosition();this.tok.loc=new t.SourceLocation(this.toks,n,n)}this.ahead=[],this.context=[],this.curIndent=0,this.curLineStart=0,this.nextLineStart=this.lineEnd(this.curLineStart)+1,this.inAsync=!1,this.options.pluginsLoose=r.pluginsLoose||{},this.loadPlugins(this.options.pluginsLoose)};a.prototype.startNode=function(){return new t.Node(this.toks,this.tok.start,this.options.locations?this.tok.loc.start:null)},a.prototype.storeCurrentPos=function(){return this.options.locations?[this.tok.start,this.tok.loc.start]:this.tok.start},a.prototype.startNodeAt=function(e){return this.options.locations?new t.Node(this.toks,e[0],e[1]):new t.Node(this.toks,e)},a.prototype.finishNode=function(e,t){return e.type=t,e.end=this.last.end,this.options.locations&&(e.loc.end=this.last.loc.end),this.options.ranges&&(e.range[1]=this.last.end),e},a.prototype.dummyNode=function(e){var r=this.startNode();return r.type=e,r.end=r.start,this.options.locations&&(r.loc.end=r.loc.start),this.options.ranges&&(r.range[1]=r.start),this.last={type:t.tokTypes.name,start:r.start,end:r.start,loc:r.loc},r},a.prototype.dummyIdent=function(){var e=this.dummyNode("Identifier");return e.name="",e},a.prototype.dummyString=function(){var e=this.dummyNode("Literal");return e.value=e.raw="",e},a.prototype.eat=function(e){return this.tok.type===e&&(this.next(),!0)},a.prototype.isContextual=function(e){return this.tok.type===t.tokTypes.name&&this.tok.value===e},a.prototype.eatContextual=function(e){return this.tok.value===e&&this.eat(t.tokTypes.name)},a.prototype.canInsertSemicolon=function(){return this.tok.type===t.tokTypes.eof||this.tok.type===t.tokTypes.braceR||t.lineBreak.test(this.input.slice(this.last.end,this.tok.start))},a.prototype.semicolon=function(){return this.eat(t.tokTypes.semi)},a.prototype.expect=function(e){var t=this;if(this.eat(e))return!0;for(var r=1;r<=2;r++)if(t.lookAhead(r).type==e){for(var n=0;n<r;n++)t.next();return!0}},a.prototype.pushCx=function(){this.context.push(this.curIndent)},a.prototype.popCx=function(){this.curIndent=this.context.pop()},a.prototype.lineEnd=function(e){for(;e<this.input.length&&!t.isNewLine(this.input.charCodeAt(e));)++e;return e},a.prototype.indentationAfter=function(e){for(var t=this,r=0;;++e){var n=t.input.charCodeAt(e);if(32===n)++r;else{if(9!==n)return r;r+=t.options.tabSize}}},a.prototype.closes=function(e,r,n,i){return this.tok.type===e||this.tok.type===t.tokTypes.eof||n!=this.curLineStart&&this.curIndent<r&&this.tokenStartsLine()&&(!i||this.nextLineStart>=this.input.length||this.indentationAfter(this.nextLineStart)<r)},a.prototype.tokenStartsLine=function(){for(var e=this,t=this.tok.start-1;t>=this.curLineStart;--t){var r=e.input.charCodeAt(t);if(9!==r&&32!==r)return!1}return!0},a.prototype.extend=function(e,t){this[e]=t(this[e])},a.prototype.loadPlugins=function(e){var t=this;for(var r in e){var n=o[r];if(!n)throw new Error("Plugin '"+r+"' not found");n(t,e[r])}},a.prototype.parse=function(){return this.next(),this.parseTopLevel()};var s=a.prototype;s.next=function(){var e=this;if(this.last=this.tok,this.ahead.length?this.tok=this.ahead.shift():this.tok=this.readToken(),this.tok.start>=this.nextLineStart){for(;this.tok.start>=this.nextLineStart;)e.curLineStart=e.nextLineStart,e.nextLineStart=e.lineEnd(e.curLineStart)+1;this.curIndent=this.indentationAfter(this.curLineStart)}},s.readToken=function(){for(var e=this;;)try{return e.toks.next(),e.toks.type===t.tokTypes.dot&&"."===e.input.substr(e.toks.end,1)&&e.options.ecmaVersion>=6&&(e.toks.end++,e.toks.type=t.tokTypes.ellipsis),new t.Token(e.toks)}catch(u){if(!(u instanceof SyntaxError))throw u;var n=u.message,i=u.raisedAt,o=!0;if(/unterminated/i.test(n))if(i=e.lineEnd(u.pos+1),/string/.test(n))o={start:u.pos,end:i,type:t.tokTypes.string,value:e.input.slice(u.pos+1,i)};else if(/regular expr/i.test(n)){var a=e.input.slice(u.pos,i);try{a=new RegExp(a)}catch(e){}o={start:u.pos,end:i,type:t.tokTypes.regexp,value:a}}else o=!!/template/.test(n)&&{start:u.pos,end:i,type:t.tokTypes.template,value:e.input.slice(u.pos,i)};else if(/invalid (unicode|regexp|number)|expecting unicode|octal literal|is reserved|directly after number|expected number in radix/i.test(n))for(;i<this.input.length&&!r(this.input.charCodeAt(i));)++i;else if(/character escape|expected hexadecimal/i.test(n))for(;i<this.input.length;){var s=e.input.charCodeAt(i++);if(34===s||39===s||t.isNewLine(s))break}else if(/unexpected character/i.test(n))i++,o=!1;else{if(!/regular expression/i.test(n))throw u;o=!0}if(e.resetTo(i),!0===o&&(o={start:i,end:i,type:t.tokTypes.name,value:""}),o)return e.options.locations&&(o.loc=new t.SourceLocation(e.toks,t.getLineInfo(e.input,o.start),t.getLineInfo(e.input,o.end))),o}},s.resetTo=function(e){var r=this;this.toks.pos=e;var n=this.input.charAt(e-1);if(this.toks.exprAllowed=!n||/[[{(,;:?/*=+\-~!|&%^<>]/.test(n)||/[enwfd]/.test(n)&&/\b(keywords|case|else|return|throw|new|in|(instance|type)of|delete|void)$/.test(this.input.slice(e-10,e)),this.options.locations){this.toks.curLine=1,this.toks.lineStart=t.lineBreakG.lastIndex=0;for(var i;(i=t.lineBreakG.exec(this.input))&&i.index<e;)++r.toks.curLine,r.toks.lineStart=i.index+i[0].length}},s.lookAhead=function(e){for(var t=this;e>this.ahead.length;)t.ahead.push(t.readToken());return this.ahead[e-1]};var u=a.prototype;u.parseTopLevel=function(){var e=this,r=this.startNodeAt(this.options.locations?[0,t.getLineInfo(this.input,0)]:0);for(r.body=[];this.tok.type!==t.tokTypes.eof;)r.body.push(e.parseStatement());return this.toks.adaptDirectivePrologue(r.body),this.last=this.tok,this.options.ecmaVersion>=6&&(r.sourceType=this.options.sourceType),this.finishNode(r,"Program")},u.parseStatement=function(){var e,r=this,i=this.tok.type,o=this.startNode();switch(this.toks.isLet()&&(i=t.tokTypes._var,e="let"),i){case t.tokTypes._break:case t.tokTypes._continue:this.next();var a=i===t.tokTypes._break;return this.semicolon()||this.canInsertSemicolon()?o.label=null:(o.label=this.tok.type===t.tokTypes.name?this.parseIdent():null,this.semicolon()),this.finishNode(o,a?"BreakStatement":"ContinueStatement");case t.tokTypes._debugger:return this.next(),this.semicolon(),this.finishNode(o,"DebuggerStatement");case t.tokTypes._do:return this.next(),o.body=this.parseStatement(),o.test=this.eat(t.tokTypes._while)?this.parseParenExpression():this.dummyIdent(),this.semicolon(),this.finishNode(o,"DoWhileStatement");case t.tokTypes._for:if(this.next(),this.pushCx(),this.expect(t.tokTypes.parenL),this.tok.type===t.tokTypes.semi)return this.parseFor(o,null);var s=this.toks.isLet();if(s||this.tok.type===t.tokTypes._var||this.tok.type===t.tokTypes._const){var u=this.parseVar(!0,s?"let":this.tok.value);return 1!==u.declarations.length||this.tok.type!==t.tokTypes._in&&!this.isContextual("of")?this.parseFor(o,u):this.parseForIn(o,u)}var c=this.parseExpression(!0);return this.tok.type===t.tokTypes._in||this.isContextual("of")?this.parseForIn(o,this.toAssignable(c)):this.parseFor(o,c);case t.tokTypes._function:return this.next(),this.parseFunction(o,!0);case t.tokTypes._if:return this.next(),o.test=this.parseParenExpression(),o.consequent=this.parseStatement(),o.alternate=this.eat(t.tokTypes._else)?this.parseStatement():null,this.finishNode(o,"IfStatement");case t.tokTypes._return:return this.next(),this.eat(t.tokTypes.semi)||this.canInsertSemicolon()?o.argument=null:(o.argument=this.parseExpression(),this.semicolon()),this.finishNode(o,"ReturnStatement");case t.tokTypes._switch:var l=this.curIndent,f=this.curLineStart;this.next(),o.discriminant=this.parseParenExpression(),o.cases=[],this.pushCx(),this.expect(t.tokTypes.braceL);for(var p;!this.closes(t.tokTypes.braceR,l,f,!0);)if(r.tok.type===t.tokTypes._case||r.tok.type===t.tokTypes._default){var h=r.tok.type===t.tokTypes._case;p&&r.finishNode(p,"SwitchCase"),o.cases.push(p=r.startNode()),p.consequent=[],r.next(),p.test=h?r.parseExpression():null,r.expect(t.tokTypes.colon)}else p||(o.cases.push(p=r.startNode()),p.consequent=[],p.test=null),p.consequent.push(r.parseStatement());return p&&this.finishNode(p,"SwitchCase"),this.popCx(),this.eat(t.tokTypes.braceR),this.finishNode(o,"SwitchStatement");case t.tokTypes._throw:return this.next(),o.argument=this.parseExpression(),this.semicolon(),this.finishNode(o,"ThrowStatement");case t.tokTypes._try:if(this.next(),o.block=this.parseBlock(),o.handler=null,this.tok.type===t.tokTypes._catch){var d=this.startNode();this.next(),this.expect(t.tokTypes.parenL),d.param=this.toAssignable(this.parseExprAtom(),!0),this.expect(t.tokTypes.parenR),d.body=this.parseBlock(),o.handler=this.finishNode(d,"CatchClause")}return o.finalizer=this.eat(t.tokTypes._finally)?this.parseBlock():null,o.handler||o.finalizer?this.finishNode(o,"TryStatement"):o.block;case t.tokTypes._var:case t.tokTypes._const:return this.parseVar(!1,e||this.tok.value);case t.tokTypes._while:return this.next(),o.test=this.parseParenExpression(),o.body=this.parseStatement(),this.finishNode(o,"WhileStatement");case t.tokTypes._with:return this.next(),o.object=this.parseParenExpression(),o.body=this.parseStatement(),this.finishNode(o,"WithStatement");case t.tokTypes.braceL:return this.parseBlock();case t.tokTypes.semi:return this.next(),this.finishNode(o,"EmptyStatement");case t.tokTypes._class:return this.parseClass(!0);case t.tokTypes._import:return this.parseImport();case t.tokTypes._export:return this.parseExport();default:if(this.toks.isAsyncFunction())return this.next(),this.next(),this.parseFunction(o,!0,!0);var m=this.parseExpression();return n(m)?(this.next(),this.tok.type===t.tokTypes.eof?this.finishNode(o,"EmptyStatement"):this.parseStatement()):i===t.tokTypes.name&&"Identifier"===m.type&&this.eat(t.tokTypes.colon)?(o.body=this.parseStatement(),o.label=m,this.finishNode(o,"LabeledStatement")):(o.expression=m,this.semicolon(),this.finishNode(o,"ExpressionStatement"))}},u.parseBlock=function(){var e=this,r=this.startNode();this.pushCx(),this.expect(t.tokTypes.braceL);var n=this.curIndent,i=this.curLineStart;for(r.body=[];!this.closes(t.tokTypes.braceR,n,i,!0);)r.body.push(e.parseStatement());return this.popCx(),this.eat(t.tokTypes.braceR),this.finishNode(r,"BlockStatement")},u.parseFor=function(e,r){return e.init=r,e.test=e.update=null,this.eat(t.tokTypes.semi)&&this.tok.type!==t.tokTypes.semi&&(e.test=this.parseExpression()),this.eat(t.tokTypes.semi)&&this.tok.type!==t.tokTypes.parenR&&(e.update=this.parseExpression()),this.popCx(),this.expect(t.tokTypes.parenR),e.body=this.parseStatement(),this.finishNode(e,"ForStatement")},u.parseForIn=function(e,r){var n=this.tok.type===t.tokTypes._in?"ForInStatement":"ForOfStatement";return this.next(),e.left=r,e.right=this.parseExpression(),this.popCx(),this.expect(t.tokTypes.parenR),e.body=this.parseStatement(),this.finishNode(e,n)},u.parseVar=function(e,r){var n=this,i=this.startNode();i.kind=r,this.next(),i.declarations=[];do{var o=n.startNode();o.id=n.options.ecmaVersion>=6?n.toAssignable(n.parseExprAtom(),!0):n.parseIdent(),o.init=n.eat(t.tokTypes.eq)?n.parseMaybeAssign(e):null,i.declarations.push(n.finishNode(o,"VariableDeclarator"))}while(this.eat(t.tokTypes.comma));if(!i.declarations.length){var a=this.startNode();a.id=this.dummyIdent(),i.declarations.push(this.finishNode(a,"VariableDeclarator"))}return e||this.semicolon(),this.finishNode(i,"VariableDeclaration")},u.parseClass=function(e){var r=this,i=this.startNode();this.next(),this.tok.type===t.tokTypes.name?i.id=this.parseIdent():i.id=!0===e?this.dummyIdent():null,i.superClass=this.eat(t.tokTypes._extends)?this.parseExpression():null,i.body=this.startNode(),i.body.body=[],this.pushCx();var o=this.curIndent+1,a=this.curLineStart;for(this.eat(t.tokTypes.braceL),this.curIndent+1<o&&(o=this.curIndent,a=this.curLineStart);!this.closes(t.tokTypes.braceR,o,a);)if(!r.semicolon()){var s=r.startNode(),u=void 0,c=void 0;r.options.ecmaVersion>=6&&(s.static=!1,u=r.eat(t.tokTypes.star)),r.parsePropertyName(s),n(s.key)?(n(r.parseMaybeAssign())&&r.next(),r.eat(t.tokTypes.comma)):("Identifier"!==s.key.type||s.computed||"static"!==s.key.name||r.tok.type==t.tokTypes.parenL||r.tok.type==t.tokTypes.braceL?s.static=!1:(s.static=!0,u=r.eat(t.tokTypes.star),r.parsePropertyName(s)),s.computed||"Identifier"!==s.key.type||"async"!==s.key.name||r.tok.type===t.tokTypes.parenL||r.canInsertSemicolon()?c=!1:(r.parsePropertyName(s),c=!0),r.options.ecmaVersion>=5&&"Identifier"===s.key.type&&!s.computed&&("get"===s.key.name||"set"===s.key.name)&&r.tok.type!==t.tokTypes.parenL&&r.tok.type!==t.tokTypes.braceL?(s.kind=s.key.name,r.parsePropertyName(s),s.value=r.parseMethod(!1)):(s.computed||s.static||u||c||!("Identifier"===s.key.type&&"constructor"===s.key.name||"Literal"===s.key.type&&"constructor"===s.key.value)?s.kind="method":s.kind="constructor",s.value=r.parseMethod(u,c)),i.body.body.push(r.finishNode(s,"MethodDefinition")))}return this.popCx(),this.eat(t.tokTypes.braceR)||(this.last.end=this.tok.start,this.options.locations&&(this.last.loc.end=this.tok.loc.start)),this.semicolon(),this.finishNode(i.body,"ClassBody"),this.finishNode(i,e?"ClassDeclaration":"ClassExpression")},u.parseFunction=function(e,r,n){var i=this.inAsync;return this.initFunction(e),this.options.ecmaVersion>=6&&(e.generator=this.eat(t.tokTypes.star)),this.options.ecmaVersion>=8&&(e.async=!!n),this.tok.type===t.tokTypes.name?e.id=this.parseIdent():!0===r&&(e.id=this.dummyIdent()),this.inAsync=e.async,e.params=this.parseFunctionParams(),e.body=this.parseBlock(),this.toks.adaptDirectivePrologue(e.body.body),this.inAsync=i,this.finishNode(e,r?"FunctionDeclaration":"FunctionExpression")},u.parseExport=function(){var e=this.startNode();if(this.next(),this.eat(t.tokTypes.star))return e.source=this.eatContextual("from")?this.parseExprAtom():this.dummyString(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(t.tokTypes._default)){var r;if(this.tok.type===t.tokTypes._function||(r=this.toks.isAsyncFunction())){var n=this.startNode();this.next(),r&&this.next(),e.declaration=this.parseFunction(n,"nullableID",r)}else this.tok.type===t.tokTypes._class?e.declaration=this.parseClass("nullableID"):(e.declaration=this.parseMaybeAssign(),this.semicolon());return this.finishNode(e,"ExportDefaultDeclaration")}return this.tok.type.keyword||this.toks.isLet()||this.toks.isAsyncFunction()?(e.declaration=this.parseStatement(),e.specifiers=[],e.source=null):(e.declaration=null,e.specifiers=this.parseExportSpecifierList(),e.source=this.eatContextual("from")?this.parseExprAtom():null,this.semicolon()),this.finishNode(e,"ExportNamedDeclaration")},u.parseImport=function(){var e=this.startNode();if(this.next(),this.tok.type===t.tokTypes.string)e.specifiers=[],e.source=this.parseExprAtom();else{var r;this.tok.type===t.tokTypes.name&&"from"!==this.tok.value&&((r=this.startNode()).local=this.parseIdent(),this.finishNode(r,"ImportDefaultSpecifier"),this.eat(t.tokTypes.comma)),e.specifiers=this.parseImportSpecifierList(),e.source=this.eatContextual("from")&&this.tok.type==t.tokTypes.string?this.parseExprAtom():this.dummyString(),r&&e.specifiers.unshift(r)}return this.semicolon(),this.finishNode(e,"ImportDeclaration")},u.parseImportSpecifierList=function(){var e=this,r=[];if(this.tok.type===t.tokTypes.star){var i=this.startNode();this.next(),i.local=this.eatContextual("as")?this.parseIdent():this.dummyIdent(),r.push(this.finishNode(i,"ImportNamespaceSpecifier"))}else{var o=this.curIndent,a=this.curLineStart,s=this.nextLineStart;for(this.pushCx(),this.eat(t.tokTypes.braceL),this.curLineStart>s&&(s=this.curLineStart);!this.closes(t.tokTypes.braceR,o+(this.curLineStart<=s?1:0),a);){var u=e.startNode();if(e.eat(t.tokTypes.star))u.local=e.eatContextual("as")?e.parseIdent():e.dummyIdent(),e.finishNode(u,"ImportNamespaceSpecifier");else{if(e.isContextual("from"))break;if(u.imported=e.parseIdent(),n(u.imported))break;u.local=e.eatContextual("as")?e.parseIdent():u.imported,e.finishNode(u,"ImportSpecifier")}r.push(u),e.eat(t.tokTypes.comma)}this.eat(t.tokTypes.braceR),this.popCx()}return r},u.parseExportSpecifierList=function(){var e=this,r=[],i=this.curIndent,o=this.curLineStart,a=this.nextLineStart;for(this.pushCx(),this.eat(t.tokTypes.braceL),this.curLineStart>a&&(a=this.curLineStart);!this.closes(t.tokTypes.braceR,i+(this.curLineStart<=a?1:0),o)&&!e.isContextual("from");){var s=e.startNode();if(s.local=e.parseIdent(),n(s.local))break;s.exported=e.eatContextual("as")?e.parseIdent():s.local,e.finishNode(s,"ExportSpecifier"),r.push(s),e.eat(t.tokTypes.comma)}return this.eat(t.tokTypes.braceR),this.popCx(),r};var c=a.prototype;c.checkLVal=function(e){if(!e)return e;switch(e.type){case"Identifier":case"MemberExpression":return e;case"ParenthesizedExpression":return e.expression=this.checkLVal(e.expression),e;default:return this.dummyIdent()}},c.parseExpression=function(e){var r=this,n=this.storeCurrentPos(),i=this.parseMaybeAssign(e);if(this.tok.type===t.tokTypes.comma){var o=this.startNodeAt(n);for(o.expressions=[i];this.eat(t.tokTypes.comma);)o.expressions.push(r.parseMaybeAssign(e));return this.finishNode(o,"SequenceExpression")}return i},c.parseParenExpression=function(){this.pushCx(),this.expect(t.tokTypes.parenL);var e=this.parseExpression();return this.popCx(),this.expect(t.tokTypes.parenR),e},c.parseMaybeAssign=function(e){if(this.toks.isContextual("yield")){var r=this.startNode();return this.next(),this.semicolon()||this.canInsertSemicolon()||this.tok.type!=t.tokTypes.star&&!this.tok.type.startsExpr?(r.delegate=!1,r.argument=null):(r.delegate=this.eat(t.tokTypes.star),r.argument=this.parseMaybeAssign()),this.finishNode(r,"YieldExpression")}var n=this.storeCurrentPos(),i=this.parseMaybeConditional(e);if(this.tok.type.isAssign){var o=this.startNodeAt(n);return o.operator=this.tok.value,o.left=this.tok.type===t.tokTypes.eq?this.toAssignable(i):this.checkLVal(i),this.next(),o.right=this.parseMaybeAssign(e),this.finishNode(o,"AssignmentExpression")}return i},c.parseMaybeConditional=function(e){var r=this.storeCurrentPos(),n=this.parseExprOps(e);if(this.eat(t.tokTypes.question)){var i=this.startNodeAt(r);return i.test=n,i.consequent=this.parseMaybeAssign(),i.alternate=this.expect(t.tokTypes.colon)?this.parseMaybeAssign(e):this.dummyIdent(),this.finishNode(i,"ConditionalExpression")}return n},c.parseExprOps=function(e){var t=this.storeCurrentPos(),r=this.curIndent,n=this.curLineStart;return this.parseExprOp(this.parseMaybeUnary(!1),t,-1,e,r,n)},c.parseExprOp=function(e,r,n,i,o,a){if(this.curLineStart!=a&&this.curIndent<o&&this.tokenStartsLine())return e;var s=this.tok.type.binop;if(null!=s&&(!i||this.tok.type!==t.tokTypes._in)&&s>n){var u=this.startNodeAt(r);if(u.left=e,u.operator=this.tok.value,this.next(),this.curLineStart!=a&&this.curIndent<o&&this.tokenStartsLine())u.right=this.dummyIdent();else{var c=this.storeCurrentPos();u.right=this.parseExprOp(this.parseMaybeUnary(!1),c,s,i,o,a)}return this.finishNode(u,/&&|\|\|/.test(u.operator)?"LogicalExpression":"BinaryExpression"),this.parseExprOp(u,r,n,i,o,a)}return e},c.parseMaybeUnary=function(e){var r,n=this,i=this.storeCurrentPos();if(this.options.ecmaVersion>=8&&this.inAsync&&this.toks.isContextual("await"))r=this.parseAwait(),e=!0;else if(this.tok.type.prefix){var o=this.startNode(),a=this.tok.type===t.tokTypes.incDec;a||(e=!0),o.operator=this.tok.value,o.prefix=!0,this.next(),o.argument=this.parseMaybeUnary(!0),a&&(o.argument=this.checkLVal(o.argument)),r=this.finishNode(o,a?"UpdateExpression":"UnaryExpression")}else if(this.tok.type===t.tokTypes.ellipsis){var s=this.startNode();this.next(),s.argument=this.parseMaybeUnary(e),r=this.finishNode(s,"SpreadElement")}else for(r=this.parseExprSubscripts();this.tok.type.postfix&&!this.canInsertSemicolon();){var u=n.startNodeAt(i);u.operator=n.tok.value,u.prefix=!1,u.argument=n.checkLVal(r),n.next(),r=n.finishNode(u,"UpdateExpression")}if(!e&&this.eat(t.tokTypes.starstar)){var c=this.startNodeAt(i);return c.operator="**",c.left=r,c.right=this.parseMaybeUnary(!1),this.finishNode(c,"BinaryExpression")}return r},c.parseExprSubscripts=function(){var e=this.storeCurrentPos();return this.parseSubscripts(this.parseExprAtom(),e,!1,this.curIndent,this.curLineStart)},c.parseSubscripts=function(e,r,n,i,o){for(var a=this;;){if(a.curLineStart!=o&&a.curIndent<=i&&a.tokenStartsLine()){if(a.tok.type!=t.tokTypes.dot||a.curIndent!=i)return e;--i}var s="Identifier"===e.type&&"async"===e.name&&!a.canInsertSemicolon();if(a.eat(t.tokTypes.dot)){var u=a.startNodeAt(r);u.object=e,a.curLineStart!=o&&a.curIndent<=i&&a.tokenStartsLine()?u.property=a.dummyIdent():u.property=a.parsePropertyAccessor()||a.dummyIdent(),u.computed=!1,e=a.finishNode(u,"MemberExpression")}else if(a.tok.type==t.tokTypes.bracketL){a.pushCx(),a.next();var c=a.startNodeAt(r);c.object=e,c.property=a.parseExpression(),c.computed=!0,a.popCx(),a.expect(t.tokTypes.bracketR),e=a.finishNode(c,"MemberExpression")}else if(n||a.tok.type!=t.tokTypes.parenL){if(a.tok.type!=t.tokTypes.backQuote)return e;var l=a.startNodeAt(r);l.tag=e,l.quasi=a.parseTemplate(),e=a.finishNode(l,"TaggedTemplateExpression")}else{var f=a.parseExprList(t.tokTypes.parenR);if(s&&a.eat(t.tokTypes.arrow))return a.parseArrowExpression(a.startNodeAt(r),f,!0);var p=a.startNodeAt(r);p.callee=e,p.arguments=f,e=a.finishNode(p,"CallExpression")}}},c.parseExprAtom=function(){var e;switch(this.tok.type){case t.tokTypes._this:case t.tokTypes._super:var r=this.tok.type===t.tokTypes._this?"ThisExpression":"Super";return e=this.startNode(),this.next(),this.finishNode(e,r);case t.tokTypes.name:var i=this.storeCurrentPos(),o=this.parseIdent(),a=!1;if("async"===o.name&&!this.canInsertSemicolon()){if(this.eat(t.tokTypes._function))return this.parseFunction(this.startNodeAt(i),!1,!0);this.tok.type===t.tokTypes.name&&(o=this.parseIdent(),a=!0)}return this.eat(t.tokTypes.arrow)?this.parseArrowExpression(this.startNodeAt(i),[o],a):o;case t.tokTypes.regexp:e=this.startNode();var s=this.tok.value;return e.regex={pattern:s.pattern,flags:s.flags},e.value=s.value,e.raw=this.input.slice(this.tok.start,this.tok.end),this.next(),this.finishNode(e,"Literal");case t.tokTypes.num:case t.tokTypes.string:return e=this.startNode(),e.value=this.tok.value,e.raw=this.input.slice(this.tok.start,this.tok.end),this.next(),this.finishNode(e,"Literal");case t.tokTypes._null:case t.tokTypes._true:case t.tokTypes._false:return e=this.startNode(),e.value=this.tok.type===t.tokTypes._null?null:this.tok.type===t.tokTypes._true,e.raw=this.tok.type.keyword,this.next(),this.finishNode(e,"Literal");case t.tokTypes.parenL:var u=this.storeCurrentPos();this.next();var c=this.parseExpression();if(this.expect(t.tokTypes.parenR),this.eat(t.tokTypes.arrow)){var l=c.expressions||[c];return l.length&&n(l[l.length-1])&&l.pop(),this.parseArrowExpression(this.startNodeAt(u),l)}if(this.options.preserveParens){var f=this.startNodeAt(u);f.expression=c,c=this.finishNode(f,"ParenthesizedExpression")}return c;case t.tokTypes.bracketL:return e=this.startNode(),e.elements=this.parseExprList(t.tokTypes.bracketR,!0),this.finishNode(e,"ArrayExpression");case t.tokTypes.braceL:return this.parseObj();case t.tokTypes._class:return this.parseClass(!1);case t.tokTypes._function:return e=this.startNode(),this.next(),this.parseFunction(e,!1);case t.tokTypes._new:return this.parseNew();case t.tokTypes.backQuote:return this.parseTemplate();default:return this.dummyIdent()}},c.parseNew=function(){var e=this.startNode(),r=this.curIndent,n=this.curLineStart,i=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(t.tokTypes.dot))return e.meta=i,e.property=this.parseIdent(!0),this.finishNode(e,"MetaProperty");var o=this.storeCurrentPos();return e.callee=this.parseSubscripts(this.parseExprAtom(),o,!0,r,n),this.tok.type==t.tokTypes.parenL?e.arguments=this.parseExprList(t.tokTypes.parenR):e.arguments=[],this.finishNode(e,"NewExpression")},c.parseTemplateElement=function(){var e=this.startNode();return this.tok.type===t.tokTypes.invalidTemplate?e.value={raw:this.tok.value,cooked:null}:e.value={raw:this.input.slice(this.tok.start,this.tok.end).replace(/\r\n?/g,"\n"),cooked:this.tok.value},this.next(),e.tail=this.tok.type===t.tokTypes.backQuote,this.finishNode(e,"TemplateElement")},c.parseTemplate=function(){var e=this,r=this.startNode();this.next(),r.expressions=[];var n=this.parseTemplateElement();for(r.quasis=[n];!n.tail;)e.next(),r.expressions.push(e.parseExpression()),e.expect(t.tokTypes.braceR)?n=e.parseTemplateElement():((n=e.startNode()).value={cooked:"",raw:""},n.tail=!0,e.finishNode(n,"TemplateElement")),r.quasis.push(n);return this.expect(t.tokTypes.backQuote),this.finishNode(r,"TemplateLiteral")},c.parseObj=function(){var e=this,r=this.startNode();r.properties=[],this.pushCx();var i=this.curIndent+1,o=this.curLineStart;for(this.eat(t.tokTypes.braceL),this.curIndent+1<i&&(i=this.curIndent,o=this.curLineStart);!this.closes(t.tokTypes.braceR,i,o);){var a=e.startNode(),s=void 0,u=void 0,c=void 0;if(e.options.ecmaVersion>=6&&(c=e.storeCurrentPos(),a.method=!1,a.shorthand=!1,s=e.eat(t.tokTypes.star)),e.parsePropertyName(a),e.toks.isAsyncProp(a)?(e.parsePropertyName(a),u=!0):u=!1,n(a.key))n(e.parseMaybeAssign())&&e.next(),e.eat(t.tokTypes.comma);else{if(e.eat(t.tokTypes.colon))a.kind="init",a.value=e.parseMaybeAssign();else if(e.options.ecmaVersion>=6&&(e.tok.type===t.tokTypes.parenL||e.tok.type===t.tokTypes.braceL))a.kind="init",a.method=!0,a.value=e.parseMethod(s,u);else if(e.options.ecmaVersion>=5&&"Identifier"===a.key.type&&!a.computed&&("get"===a.key.name||"set"===a.key.name)&&e.tok.type!=t.tokTypes.comma&&e.tok.type!=t.tokTypes.braceR&&e.tok.type!=t.tokTypes.eq)a.kind=a.key.name,e.parsePropertyName(a),a.value=e.parseMethod(!1);else{if(a.kind="init",e.options.ecmaVersion>=6)if(e.eat(t.tokTypes.eq)){var l=e.startNodeAt(c);l.operator="=",l.left=a.key,l.right=e.parseMaybeAssign(),a.value=e.finishNode(l,"AssignmentExpression")}else a.value=a.key;else a.value=e.dummyIdent();a.shorthand=!0}r.properties.push(e.finishNode(a,"Property")),e.eat(t.tokTypes.comma)}}return this.popCx(),this.eat(t.tokTypes.braceR)||(this.last.end=this.tok.start,this.options.locations&&(this.last.loc.end=this.tok.loc.start)),this.finishNode(r,"ObjectExpression")},c.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(t.tokTypes.bracketL))return e.computed=!0,e.key=this.parseExpression(),void this.expect(t.tokTypes.bracketR);e.computed=!1}var r=this.tok.type===t.tokTypes.num||this.tok.type===t.tokTypes.string?this.parseExprAtom():this.parseIdent();e.key=r||this.dummyIdent()},c.parsePropertyAccessor=function(){if(this.tok.type===t.tokTypes.name||this.tok.type.keyword)return this.parseIdent()},c.parseIdent=function(){var e=this.tok.type===t.tokTypes.name?this.tok.value:this.tok.type.keyword;if(!e)return this.dummyIdent();var r=this.startNode();return this.next(),r.name=e,this.finishNode(r,"Identifier")},c.initFunction=function(e){e.id=null,e.params=[],this.options.ecmaVersion>=6&&(e.generator=!1,e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)},c.toAssignable=function(e,t){var r=this;if(!e||"Identifier"==e.type||"MemberExpression"==e.type&&!t);else if("ParenthesizedExpression"==e.type)this.toAssignable(e.expression,t);else{if(this.options.ecmaVersion<6)return this.dummyIdent();if("ObjectExpression"==e.type){e.type="ObjectPattern";for(var n=0,i=e.properties;n<i.length;n+=1){var o=i[n];r.toAssignable(o.value,t)}}else if("ArrayExpression"==e.type)e.type="ArrayPattern",this.toAssignableList(e.elements,t);else if("SpreadElement"==e.type)e.type="RestElement",this.toAssignable(e.argument,t);else{if("AssignmentExpression"!=e.type)return this.dummyIdent();e.type="AssignmentPattern",delete e.operator}}return e},c.toAssignableList=function(e,t){for(var r=this,n=0,i=e;n<i.length;n+=1){var o=i[n];r.toAssignable(o,t)}return e},c.parseFunctionParams=function(e){return e=this.parseExprList(t.tokTypes.parenR),this.toAssignableList(e,!0)},c.parseMethod=function(e,t){var r=this.startNode(),n=this.inAsync;return this.initFunction(r),this.options.ecmaVersion>=6&&(r.generator=!!e),this.options.ecmaVersion>=8&&(r.async=!!t),this.inAsync=r.async,r.params=this.parseFunctionParams(),r.body=this.parseBlock(),this.toks.adaptDirectivePrologue(r.body.body),this.inAsync=n,this.finishNode(r,"FunctionExpression")},c.parseArrowExpression=function(e,r,n){var i=this.inAsync;return this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!n),this.inAsync=e.async,e.params=this.toAssignableList(r,!0),e.expression=this.tok.type!==t.tokTypes.braceL,e.expression?e.body=this.parseMaybeAssign():(e.body=this.parseBlock(),this.toks.adaptDirectivePrologue(e.body.body)),this.inAsync=i,this.finishNode(e,"ArrowFunctionExpression")},c.parseExprList=function(e,r){var i=this;this.pushCx();var o=this.curIndent,a=this.curLineStart,s=[];for(this.next();!this.closes(e,o+1,a);)if(i.eat(t.tokTypes.comma))s.push(r?null:i.dummyIdent());else{var u=i.parseMaybeAssign();if(n(u)){if(i.closes(e,o,a))break;i.next()}else s.push(u);i.eat(t.tokTypes.comma)}return this.popCx(),this.eat(e)||(this.last.end=this.tok.start,this.options.locations&&(this.last.loc.end=this.tok.loc.start)),s},c.parseAwait=function(){var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(),this.finishNode(e,"AwaitExpression")},t.defaultOptions.tabSize=4,t.addLooseExports(i,a,o),e.parse_dammit=i,e.LooseParser=a,e.pluginsLoose=o,Object.defineProperty(e,"__esModule",{value:!0})}),function(e){function t(e,t){return e.lineStart>=t}function r(e,t,r){var n=t.input.slice(t.start);return r&&(n=n.replace(s,"$1 $3")),e.test(n)}function n(e,t,r){var n=new e.constructor(e.options,e.input,t);if(r)for(var i in r)n[i]=r[i];var o=e,a=n;return["inFunction","inAsync","inGenerator","inModule"].forEach(function(e){e in o&&(a[e]=o[e])}),n.nextToken(),n}var i={exports:{}},o=/^async[\t ]+(return|throw)/,a=/^\s*[):;]/,s=/([^\n])\/\*(\*(?!\/)|[^\n*])*\*\/([^\n])/g;i.exports=function(e,i){i&&"object"==typeof i||(i={}),e.extend("parse",function(t){return function(){return this.inAsync=i.inAsyncFunction,i.awaitAnywhere&&i.inAsyncFunction&&e.raise(node.start,"The options awaitAnywhere and inAsyncFunction are mutually exclusive"),t.apply(this,arguments)}}),e.extend("parseStatement",function(e){return function(t,n){var a=this.start,s=this.startLoc;if("name"===this.type.label&&i.asyncExits&&r(o,this)){this.next();var u=this.parseStatement(t,n);return u.async=!0,u.start=a,u.loc&&(u.loc.start=s),u.range&&(u.range[0]=a),u}return e.apply(this,arguments)}}),e.extend("parseIdent",function(e){return function(t){return"module"===this.options.sourceType&&this.options.ecmaVersion>=8&&i.awaitAnywhere?e.call(this,!0):e.apply(this,arguments)}}),e.extend("parseExprAtom",function(e){var t={};return function(r){var o,a=this.start,s=(this.startLoc,e.apply(this,arguments));if("Identifier"===s.type&&"await"===s.name&&!this.inAsync&&i.awaitAnywhere){var u=this.startNodeAt(s.start,s.loc&&s.loc.start);a=this.start;var c={raise:function(){try{return pp.raise.apply(this,arguments)}catch(e){throw t}}};try{if((o=n(this,a-4,c).parseExprSubscripts()).end<=a)return o=n(this,a,c).parseExprSubscripts(),u.argument=o,u=this.finishNodeAt(u,"AwaitExpression",o.end,o.loc&&o.loc.end),this.pos=o.end,this.end=o.end,this.endLoc=o.endLoc,this.next(),u}catch(e){if(e===t)return s;throw e}}return s}});var s={undefined:!0,get:!0,set:!0,static:!0,async:!0,constructor:!0};e.extend("parsePropertyName",function(e){return function(r){var n=r.key&&r.key.name,i=e.apply(this,arguments);return"get"===this.value&&(r.__maybeStaticAsyncGetter=!0),s[this.value]?i:("Identifier"!==i.type||"async"!==i.name&&"async"!==n||t(this,i.end)||this.input.slice(i.end).match(a)?delete r.__maybeStaticAsyncGetter:"set"===r.kind||"set"===i.name?this.raise(i.start,"'set <member>(value)' cannot be be async"):(this.__isAsyncProp=!0,"Identifier"===(i=e.apply(this,arguments)).type&&"set"===i.name&&this.raise(i.start,"'set <member>(value)' cannot be be async")),i)}}),e.extend("parseClassMethod",function(e){return function(t,r,n){var i=e.apply(this,arguments);return r.__maybeStaticAsyncGetter&&(delete r.__maybeStaticAsyncGetter,"get"!==r.key.name&&(r.kind="get")),i}}),e.extend("parseFunctionBody",function(e){return function(t,r){var n=this.inAsync;this.__isAsyncProp&&(t.async=!0,this.inAsync=!0,delete this.__isAsyncProp);var i=e.apply(this,arguments);return this.inAsync=n,i}})},e.plugins.asyncawait=i.exports}(this.acorn),function(e){var t={exports:{}};t.exports=function(e){function t(e,t){var n=this.startNode(),i=!0,o={};for(n.properties=[],this.next();!this.eat(r.braceR);){if(i)i=!1;else if(this.expect(r.comma),this.afterTrailingComma(r.braceR))break;var a,s,u,c,l=this.startNode();if(this.options.ecmaVersion>=6){if(this.type===r.ellipsis){e?(this.next(),l.argument=this.parseIdent(),this.finishNode(l,"RestElement")):l=this.parseSpread(t),n.properties.push(l),this.type===r.comma&&(e?this.raise(this.start,"Comma is not permitted after the rest element"):t&&t.trailingComma<0&&(t.trailingComma=this.start));continue}l.method=!1,l.shorthand=!1,(e||t)&&(u=this.start,c=this.startLoc),e||(a=this.eat(r.star))}this.parsePropertyName(l),!e&&this.options.ecmaVersion>=8&&!a&&this.isAsyncProp(l)?(s=!0,this.parsePropertyName(l,t)):s=!1,this.parsePropertyValue(l,e,a,s,u,c,t),e||this.checkPropClash(l,o),n.properties.push(this.finishNode(l,"Property"))}return this.finishNode(n,e?"ObjectPattern":"ObjectExpression")}if("5"!==e.version.substr(0,1))throw new Error("Unsupported acorn version "+e.version+", please use acorn 5");var r=e.tokTypes,n=e.Parser.prototype;const i=e=>(function(t,r,n){if("ObjectPattern"!=t.type)return"Property"===t.type?this.checkLVal(t.value,r,n):e.apply(this,arguments);for(var i of t.properties)this.checkLVal(i,r,n)});return e.plugins.objectSpread=function(e){n.parseObj=t,e.extend("checkLVal",i),e.extend("toAssignable",e=>(function(t,r){if(this.options.ecmaVersion>=6&&t){if("ObjectExpression"==t.type){t.type="ObjectPattern";for(var n of t.properties)this.toAssignable(n,r);return t}if("Property"===t.type)return"init"!==t.kind&&this.raise(t.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(t.value,r);if("SpreadElement"===t.type)return t.type="RestElement",this.toAssignable(t.argument,r)}return e.apply(this,arguments)})),e.extend("checkPatternExport",e=>(function(t,r){if("ObjectPattern"!=r.type)return"Property"===r.type?this.checkPatternExport(t,r.value):"RestElement"===r.type?this.checkPatternExport(t,r.argument):void e.apply(this,arguments);for(var n of r.properties)this.checkPatternExport(t,n)}))},e},t.exports(e)}(this.acorn),function(e){var t={exports:{}},r={quot:'"',amp:"&",apos:"'",lt:"<",gt:">",nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",fnof:"",circ:"",tilde:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",bull:"",hellip:"",permil:"",prime:"",Prime:"",lsaquo:"",rsaquo:"",oline:"",frasl:"",euro:"",image:"",weierp:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",lang:"",rang:"",loz:"",spades:"",clubs:"",hearts:"",diams:""},n=/^[\da-fA-F]+$/,i=/^\d+$/;t.exports=function(e){function t(e){return e?"JSXIdentifier"===e.type?e.name:"JSXNamespacedName"===e.type?e.namespace.name+":"+e.name.name:"JSXMemberExpression"===e.type?t(e.object)+"."+t(e.property):void 0:e}var o=e.tokTypes,a=e.tokContexts;a.j_oTag=new e.TokContext("<tag",!1),a.j_cTag=new e.TokContext("</tag",!1),a.j_expr=new e.TokContext("<tag>...</tag>",!0,!0),o.jsxName=new e.TokenType("jsxName"),o.jsxText=new e.TokenType("jsxText",{beforeExpr:!0}),o.jsxTagStart=new e.TokenType("jsxTagStart"),o.jsxTagEnd=new e.TokenType("jsxTagEnd"),o.jsxTagStart.updateContext=function(){this.context.push(a.j_expr),this.context.push(a.j_oTag),this.exprAllowed=!1},o.jsxTagEnd.updateContext=function(e){var t=this.context.pop();t===a.j_oTag&&e===o.slash||t===a.j_cTag?(this.context.pop(),this.exprAllowed=this.curContext()===a.j_expr):this.exprAllowed=!0};var s=e.Parser.prototype;return s.jsx_readToken=function(){for(var t="",r=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated JSX contents");var n=this.input.charCodeAt(this.pos);switch(n){case 60:case 123:return this.pos===this.start?60===n&&this.exprAllowed?(++this.pos,this.finishToken(o.jsxTagStart)):this.getTokenFromCode(n):(t+=this.input.slice(r,this.pos),this.finishToken(o.jsxText,t));case 38:t+=this.input.slice(r,this.pos),t+=this.jsx_readEntity(),r=this.pos;break;default:e.isNewLine(n)?(t+=this.input.slice(r,this.pos),t+=this.jsx_readNewLine(!0),r=this.pos):++this.pos}}},s.jsx_readNewLine=function(e){var t,r=this.input.charCodeAt(this.pos);return++this.pos,13===r&&10===this.input.charCodeAt(this.pos)?(++this.pos,t=e?"\n":"\r\n"):t=String.fromCharCode(r),this.options.locations&&(++this.curLine,this.lineStart=this.pos),t},s.jsx_readString=function(t){for(var r="",n=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var i=this.input.charCodeAt(this.pos);if(i===t)break;38===i?(r+=this.input.slice(n,this.pos),r+=this.jsx_readEntity(),n=this.pos):e.isNewLine(i)?(r+=this.input.slice(n,this.pos),r+=this.jsx_readNewLine(!1),n=this.pos):++this.pos}return r+=this.input.slice(n,this.pos++),this.finishToken(o.string,r)},s.jsx_readEntity=function(){var e,t="",o=0,a=this.input[this.pos];"&"!==a&&this.raise(this.pos,"Entity must start with an ampersand");for(var s=++this.pos;this.pos<this.input.length&&o++<10;){if(";"===(a=this.input[this.pos++])){"#"===t[0]?"x"===t[1]?(t=t.substr(2),n.test(t)&&(e=String.fromCharCode(parseInt(t,16)))):(t=t.substr(1),i.test(t)&&(e=String.fromCharCode(parseInt(t,10)))):e=r[t];break}t+=a}return e||(this.pos=s,"&")},s.jsx_readWord=function(){var t,r=this.pos;do{t=this.input.charCodeAt(++this.pos)}while(e.isIdentifierChar(t)||45===t);return this.finishToken(o.jsxName,this.input.slice(r,this.pos))},s.jsx_parseIdentifier=function(){var e=this.startNode();return this.type===o.jsxName?e.name=this.value:this.type.keyword?e.name=this.type.keyword:this.unexpected(),this.next(),this.finishNode(e,"JSXIdentifier")},s.jsx_parseNamespacedName=function(){var e=this.start,t=this.startLoc,r=this.jsx_parseIdentifier();if(!this.options.plugins.jsx.allowNamespaces||!this.eat(o.colon))return r;var n=this.startNodeAt(e,t);return n.namespace=r,n.name=this.jsx_parseIdentifier(),this.finishNode(n,"JSXNamespacedName")},s.jsx_parseElementName=function(){if(this.type===o.jsxTagEnd)return"";var e=this.start,t=this.startLoc,r=this.jsx_parseNamespacedName();for(this.type!==o.dot||"JSXNamespacedName"!==r.type||this.options.plugins.jsx.allowNamespacedObjects||this.unexpected();this.eat(o.dot);){var n=this.startNodeAt(e,t);n.object=r,n.property=this.jsx_parseIdentifier(),r=this.finishNode(n,"JSXMemberExpression")}return r},s.jsx_parseAttributeValue=function(){switch(this.type){case o.braceL:var e=this.jsx_parseExpressionContainer();return"JSXEmptyExpression"===e.expression.type&&this.raise(e.start,"JSX attributes must only be assigned a non-empty expression"),e;case o.jsxTagStart:case o.string:return this.parseExprAtom();default:this.raise(this.start,"JSX value should be either an expression or a quoted JSX text")}},s.jsx_parseEmptyExpression=function(){var e=this.startNodeAt(this.lastTokEnd,this.lastTokEndLoc);return this.finishNodeAt(e,"JSXEmptyExpression",this.start,this.startLoc)},s.jsx_parseExpressionContainer=function(){var e=this.startNode();return this.next(),e.expression=this.type===o.braceR?this.jsx_parseEmptyExpression():this.parseExpression(),this.expect(o.braceR),this.finishNode(e,"JSXExpressionContainer")},s.jsx_parseAttribute=function(){var e=this.startNode();return this.eat(o.braceL)?(this.expect(o.ellipsis),e.argument=this.parseMaybeAssign(),this.expect(o.braceR),this.finishNode(e,"JSXSpreadAttribute")):(e.name=this.jsx_parseNamespacedName(),e.value=this.eat(o.eq)?this.jsx_parseAttributeValue():null,this.finishNode(e,"JSXAttribute"))},s.jsx_parseOpeningElementAt=function(e,t){var r=this.startNodeAt(e,t);for(r.attributes=[],r.name=this.jsx_parseElementName();this.type!==o.slash&&this.type!==o.jsxTagEnd;)r.attributes.push(this.jsx_parseAttribute());return r.selfClosing=this.eat(o.slash),this.expect(o.jsxTagEnd),this.finishNode(r,"JSXOpeningElement")},s.jsx_parseClosingElementAt=function(e,t){var r=this.startNodeAt(e,t);return r.name=this.jsx_parseElementName(),this.expect(o.jsxTagEnd),this.finishNode(r,"JSXClosingElement")},s.jsx_parseElementAt=function(e,r){var n=this.startNodeAt(e,r),i=[],a=this.jsx_parseOpeningElementAt(e,r),s=null;if(!a.selfClosing){e:for(;;)switch(this.type){case o.jsxTagStart:if(e=this.start,r=this.startLoc,this.next(),this.eat(o.slash)){s=this.jsx_parseClosingElementAt(e,r);break e}i.push(this.jsx_parseElementAt(e,r));break;case o.jsxText:i.push(this.parseExprAtom());break;case o.braceL:i.push(this.jsx_parseExpressionContainer());break;default:this.unexpected()}t(s.name)!==t(a.name)&&this.raise(s.start,"Expected corresponding JSX closing tag for <"+t(a.name)+">")}return n.openingElement=a,n.closingElement=s,n.children=i,this.type===o.relational&&"<"===this.value&&this.raise(this.start,"Adjacent JSX elements must be wrapped in an enclosing tag"),this.finishNode(n,a.name?"JSXElement":"JSXFragment")},s.jsx_parseText=function(e){var t=this.parseLiteral(e);return t.type="JSXText",t},s.jsx_parseElement=function(){var e=this.start,t=this.startLoc;return this.next(),this.jsx_parseElementAt(e,t)},e.plugins.jsx=function(t,r){r&&("object"!=typeof r&&(r={}),t.options.plugins.jsx={allowNamespaces:!1!==r.allowNamespaces,allowNamespacedObjects:!!r.allowNamespacedObjects},t.extend("parseExprAtom",function(e){return function(t){return this.type===o.jsxText?this.jsx_parseText(this.value):this.type===o.jsxTagStart?this.jsx_parseElement():e.call(this,t)}}),t.extend("readToken",function(t){return function(r){var n=this.curContext();if(n===a.j_expr)return this.jsx_readToken();if(n===a.j_oTag||n===a.j_cTag){if(e.isIdentifierStart(r))return this.jsx_readWord();if(62==r)return++this.pos,this.finishToken(o.jsxTagEnd);if((34===r||39===r)&&n==a.j_oTag)return this.jsx_readString(r)}return 60===r&&this.exprAllowed&&33!==this.input.charCodeAt(this.pos+1)?(++this.pos,this.finishToken(o.jsxTagStart)):t.call(this,r)}}),t.extend("updateContext",function(e){return function(t){if(this.type==o.braceL){var r=this.curContext();r==a.j_oTag?this.context.push(a.b_expr):r==a.j_expr?this.context.push(a.b_tmpl):e.call(this,t),this.exprAllowed=!0}else{if(this.type!==o.slash||t!==o.jsxTagStart)return e.call(this,t);this.context.length-=2,this.context.push(a.j_cTag),this.exprAllowed=!1}}}))},e},t.exports(e)}(this.acorn),this.acorn}(),function(t){(function(r){function n(e,t){if({}.hasOwnProperty.call(n.cache,e))return n.cache[e];var r=n.resolve(e);if(!r)throw new Error("Failed to resolve module "+e);var i={id:e,require:n,filename:e,exports:{},loaded:!1,parent:t,children:[]};t&&t.children.push(i);var o=e.slice(0,e.lastIndexOf("/")+1);return n.cache[e]=i.exports,r.call(i.exports,i,i.exports,o,e),i.loaded=!0,n.cache[e]=i.exports}n.modules={},n.cache={},n.resolve=function(e){return{}.hasOwnProperty.call(n.modules,e)?n.modules[e]:void 0},n.define=function(e,t){n.modules[e]=t};var i=function(){var e="/";return{title:"browser",version:"v8.6.0",browser:!0,env:{},argv:[],nextTick:r.setImmediate||function(e){setTimeout(e,0)},cwd:function(){return e},chdir:function(t){e=t}}}();n.define("/tools/entry-point.js",function(e,i,o,a){!function(){"use strict";r.escodegen=n("/escodegen.js",e),t.escodegen.browser=!0}()}),n.define("/escodegen.js",function(e,t,i,o){!function(){"use strict";function i(e){return R.Expression.hasOwnProperty(e.type)}function o(e){return R.Statement.hasOwnProperty(e.type)}function a(){return{indent:null,base:null,parse:null,comment:!1,format:{indent:{style:"    ",base:0,adjustMultilineComment:!1},newline:"\n",space:" ",json:!1,renumber:!1,hexadecimal:!1,quotes:"single",escapeless:!1,compact:!1,parentheses:!0,semicolons:!0,safeConcatenation:!1,preserveBlankLines:!1},moz:{comprehensionExpressionStartsWithAssignment:!1,starlessGenerator:!1},sourceMap:null,sourceMapRoot:null,sourceMapWithCode:!1,directive:!1,raw:!0,verbatim:null,sourceCode:null}}function s(e,t){var r="";for(t|=0;t>0;t>>>=1,e+=e)1&t&&(r+=e);return r}function u(e){return/[\r\n]/g.test(e)}function c(e){var t=e.length;return t&&z.code.isLineTerminator(e.charCodeAt(t-1))}function l(e,t){var r;for(r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}function f(e,t){function r(e){return"object"==typeof e&&e instanceof Object&&!(e instanceof RegExp)}var n,i;for(n in t)t.hasOwnProperty(n)&&(r(i=t[n])?r(e[n])?f(e[n],i):e[n]=f({},i):e[n]=i);return e}function p(e){var t,r,n,i,o;if(e!==e)throw new Error("Numeric literal whose value is NaN");if(e<0||0===e&&1/e<0)throw new Error("Numeric literal whose value is negative");if(e===1/0)return X?"null":K?"1e400":"1e+400";if(t=""+e,!K||t.length<3)return t;for(r=t.indexOf("."),X||48!==t.charCodeAt(0)||1!==r||(r=0,t=t.slice(1)),n=t,t=t.replace("e+","e"),i=0,(o=n.indexOf("e"))>0&&(i=+n.slice(o+1),n=n.slice(0,o)),r>=0&&(i-=n.length-r-1,n=+(n.slice(0,r)+n.slice(r+1))+""),o=0;48===n.charCodeAt(n.length+o-1);)--o;return 0!==o&&(i-=o,n=n.slice(0,o)),0!==i&&(n+="e"+i),(n.length<t.length||Q&&e>1e12&&Math.floor(e)===e&&(n="0x"+e.toString(16)).length<t.length)&&+n===e&&(t=n),t}function h(e,t){return 8232==(-2&e)?(t?"u":"\\u")+(8232===e?"2028":"2029"):10===e||13===e?(t?"":"\\")+(10===e?"n":"r"):String.fromCharCode(e)}function d(e){var t,r,n,i,o,a,s,u;if(r=e.toString(),e.source){if(!(t=r.match(/\/([^\/]*)$/)))return r;for(n=t[1],r="",s=!1,u=!1,i=0,o=e.source.length;i<o;++i)a=e.source.charCodeAt(i),u?(r+=h(a,u),u=!1):(s?93===a&&(s=!1):47===a?r+="\\":91===a&&(s=!0),r+=h(a,u),u=92===a);return"/"+r+"/"+n}return r}function m(e,t){var r;return 8===e?"\\b":12===e?"\\f":9===e?"\\t":(r=e.toString(16).toUpperCase(),X||e>255?"\\u"+"0000".slice(r.length)+r:0!==e||z.code.isDecimalDigit(t)?11===e?"\\x0B":"\\x"+"00".slice(r.length)+r:"\\0")}function v(e){if(92===e)return"\\\\";if(10===e)return"\\n";if(13===e)return"\\r";if(8232===e)return"\\u2028";if(8233===e)return"\\u2029";throw new Error("Incorrectly classified character")}function y(e){var t,r,n,i;for(i="double"===Y?'"':"'",t=0,r=e.length;t<r;++t){if(39===(n=e.charCodeAt(t))){i='"';break}if(34===n){i="'";break}92===n&&++t}return i+e+i}function g(e){var t,r,n,i,o,a="",s=0,u=0;for(t=0,r=e.length;t<r;++t){if(39===(n=e.charCodeAt(t)))++s;else if(34===n)++u;else if(47===n&&X)a+="\\";else{if(z.code.isLineTerminator(n)||92===n){a+=v(n);continue}if(!z.code.isIdentifierPartES5(n)&&(X&&n<32||!X&&!Z&&(n<32||n>126))){a+=m(n,e.charCodeAt(t+1));continue}}a+=String.fromCharCode(n)}if(i=!("double"===Y||"auto"===Y&&u<s),o=i?"'":'"',!(i?s:u))return o+a+o;for(e=a,a=o,t=0,r=e.length;t<r;++t)(39===(n=e.charCodeAt(t))&&i||34===n&&!i)&&(a+="\\"),a+=String.fromCharCode(n);return a+o}function b(e){var t,r,n,i="";for(t=0,r=e.length;t<r;++t)n=e[t],i+=V(n)?b(n):n;return i}function _(e,t){if(!ue)return V(e)?b(e):e;if(null==t){if(e instanceof U)return e;t={}}return null==t.loc?new U(null,null,ue,e,t.name||null):new U(t.loc.start.line,t.loc.start.column,!0===ue?t.loc.source||null:ue,e,t.name||null)}function x(){return te||" "}function w(e,t){var r,n,i,o;return 0===(r=_(e).toString()).length?[t]:0===(n=_(t).toString()).length?[e]:(i=r.charCodeAt(r.length-1),o=n.charCodeAt(0),(43===i||45===i)&&i===o||z.code.isIdentifierPartES5(i)&&z.code.isIdentifierPartES5(o)||47===i&&105===o?[e,x(),t]:z.code.isWhiteSpace(i)||z.code.isLineTerminator(i)||z.code.isWhiteSpace(o)||z.code.isLineTerminator(o)?[e,t]:[e,te,t])}function k(e){return[J,e]}function E(e){var t;t=J,e(J+=H),J=t}function S(e){var t;for(t=e.length-1;t>=0&&!z.code.isLineTerminator(e.charCodeAt(t));--t);return e.length-1-t}function A(e,t){var r,n,i,o,a,s,u,c;for(r=e.split(/\r\n|[\r\n]/),s=Number.MAX_VALUE,n=1,i=r.length;n<i;++n){for(o=r[n],a=0;a<o.length&&z.code.isWhiteSpace(o.charCodeAt(a));)++a;s>a&&(s=a)}for(void 0!==t?(u=J,"*"===r[1][s]&&(t+=" "),J=t):(1&s&&--s,u=J),n=1,i=r.length;n<i;++n)c=_(k(r[n].slice(s))),r[n]=ue?c.join(""):c;return J=u,r.join("\n")}function D(e,t){if("Line"===e.type){if(c(e.value))return"//"+e.value;var r="//"+e.value;return le||(r+="\n"),r}return ae.format.indent.adjustMultilineComment&&/[\n\r]/.test(e.value)?A("/*"+e.value+"*/",t):"/*"+e.value+"*/"}function C(e,t){var r,n,i,o,a,u,l,f,p,h,d,m;if(e.leadingComments&&e.leadingComments.length>0){if(o=t,le){for(t=[],f=(i=e.leadingComments[0]).extendedRange,p=i.range,(m=((d=ce.substring(f[0],p[0])).match(/\n/g)||[]).length)>0?(t.push(s("\n",m)),t.push(k(D(i)))):(t.push(d),t.push(D(i))),h=p,r=1,n=e.leadingComments.length;r<n;r++)p=(i=e.leadingComments[r]).range,m=(ce.substring(h[1],p[0]).match(/\n/g)||[]).length,t.push(s("\n",m)),t.push(k(D(i))),h=p;m=(ce.substring(p[1],f[1]).match(/\n/g)||[]).length,t.push(s("\n",m))}else for(i=e.leadingComments[0],t=[],ie&&e.type===q.Program&&0===e.body.length&&t.push("\n"),t.push(D(i)),c(_(t).toString())||t.push("\n"),r=1,n=e.leadingComments.length;r<n;++r)c(_(l=[D(i=e.leadingComments[r])]).toString())||l.push("\n"),t.push(k(l));t.push(k(o))}if(e.trailingComments)if(le)f=(i=e.trailingComments[0]).extendedRange,p=i.range,(m=((d=ce.substring(f[0],p[0])).match(/\n/g)||[]).length)>0?(t.push(s("\n",m)),t.push(k(D(i)))):(t.push(d),t.push(D(i)));else for(a=!c(_(t).toString()),u=s(" ",S(_([J,t,H]).toString())),r=0,n=e.trailingComments.length;r<n;++r)i=e.trailingComments[r],a?(t=0===r?[t,H]:[t,u]).push(D(i,u)):t=[t,k(D(i))],r===n-1||c(_(t).toString())||(t=[t,"\n"]);return t}function F(e,t,r){var n,i=0;for(n=e;n<t;n++)"\n"===ce[n]&&i++;for(n=1;n<i;n++)r.push(ee)}function j(e,t,r){return t<r?["(",e,")"]:e}function T(e){var t,r,n;for(t=1,r=(n=e.split(/\r\n|\n/)).length;t<r;t++)n[t]=ee+J+n[t];return n}function O(e,t){var r,n;return r=e[ae.verbatim],n="string"==typeof r?j(T(r),$.Sequence,t):j(n=T(r.content),null!=r.precedence?r.precedence:$.Sequence,t),_(n,e)}function R(){}function B(e){return _(e.name,e)}function P(e,t){return e.async?"async"+(t?x():te):""}function I(e){return e.generator&&!ae.moz.starlessGenerator?"*"+te:""}function L(e){var t=e.value;return t.async?P(t,!e.computed):I(t)?"*":""}function N(e){var t;if(t=new R,o(e))return t.generateStatement(e,de);if(i(e))return t.generateExpression(e,$.Sequence,he);throw new Error("Unknown node type: "+e.type)}function M(e,t){return e.indexOf('"')>=0||e.indexOf("'")>=0?t:"double"===Y?'"'+e+'"':"'"+e+"'"}var q,$,W,U,G,z,V,J,H,X,K,Q,Y,Z,ee,te,re,ne,ie,oe,ae,se,ue,ce,le,fe,pe;G=n("/node_modules/estraverse/estraverse.js",e),z=n("/node_modules/esutils/lib/utils.js",e),q=G.Syntax,W={"||":($={Sequence:0,Yield:1,Await:1,Assignment:1,Conditional:2,ArrowFunction:2,LogicalOR:3,LogicalAND:4,BitwiseOR:5,BitwiseXOR:6,BitwiseAND:7,Equality:8,Relational:9,BitwiseSHIFT:10,Additive:11,Multiplicative:12,Exponentiation:13,Unary:14,Postfix:15,Call:16,New:17,TaggedTemplate:18,Member:19,Primary:20}).LogicalOR,"&&":$.LogicalAND,"|":$.BitwiseOR,"^":$.BitwiseXOR,"&":$.BitwiseAND,"==":$.Equality,"!=":$.Equality,"===":$.Equality,"!==":$.Equality,is:$.Equality,isnt:$.Equality,"<":$.Relational,">":$.Relational,"<=":$.Relational,">=":$.Relational,in:$.Relational,instanceof:$.Relational,"<<":$.BitwiseSHIFT,">>":$.BitwiseSHIFT,">>>":$.BitwiseSHIFT,"+":$.Additive,"-":$.Additive,"*":$.Multiplicative,"%":$.Multiplicative,"/":$.Multiplicative,"**":$.Exponentiation};var he=7,de=1;(V=Array.isArray)||(V=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),R.prototype.maybeBlock=function(e,t){var r,n,i=this;return n=!ae.comment||!e.leadingComments,e.type===q.BlockStatement&&n?[te,this.generateStatement(e,t)]:e.type===q.EmptyStatement&&n?";":(E(function(){r=[ee,k(i.generateStatement(e,t))]}),r)},R.prototype.maybeBlockSuffix=function(e,t){var r=c(_(t).toString());return e.type!==q.BlockStatement||ae.comment&&e.leadingComments||r?r?[t,J]:[t,ee,J]:[t,te]},R.prototype.generatePattern=function(e,t,r){return e.type===q.Identifier?B(e):this.generateExpression(e,t,r)},R.prototype.generateFunctionParams=function(e){var t,r,n,i;if(i=!1,e.type!==q.ArrowFunctionExpression||e.rest||e.defaults&&0!==e.defaults.length||1!==e.params.length||e.params[0].type!==q.Identifier){for((n=e.type===q.ArrowFunctionExpression?[P(e,!1)]:[]).push("("),e.defaults&&(i=!0),t=0,r=e.params.length;t<r;++t)i&&e.defaults[t]?n.push(this.generateAssignment(e.params[t],e.defaults[t],"=",$.Assignment,he)):n.push(this.generatePattern(e.params[t],$.Assignment,he)),t+1<r&&n.push(","+te);e.rest&&(e.params.length&&n.push(","+te),n.push("..."),n.push(B(e.rest))),n.push(")")}else n=[P(e,!0),B(e.params[0])];return n},R.prototype.generateFunctionBody=function(e){var t,r;return t=this.generateFunctionParams(e),e.type===q.ArrowFunctionExpression&&(t.push(te),t.push("=>")),e.expression?(t.push(te),"{"===(r=this.generateExpression(e.body,$.Assignment,he)).toString().charAt(0)&&(r=["(",r,")"]),t.push(r)):t.push(this.maybeBlock(e.body,9)),t},R.prototype.generateIterationForStatement=function(e,t,r){var n=["for"+te+"("],i=this;return E(function(){t.left.type===q.VariableDeclaration?E(function(){n.push(t.left.kind+x()),n.push(i.generateStatement(t.left.declarations[0],0))}):n.push(i.generateExpression(t.left,$.Call,he)),n=w(n,e),n=[w(n,i.generateExpression(t.right,$.Sequence+("of"===e?1:0),he)),")"]}),n.push(this.maybeBlock(t.body,r)),n},R.prototype.generatePropertyKey=function(e,t){var r=[];return t&&r.push("["),r.push(this.generateExpression(e,$.Sequence,he)),t&&r.push("]"),r},R.prototype.generateAssignment=function(e,t,r,n,i){return $.Assignment<n&&(i|=1),j([this.generateExpression(e,$.Call,i),te+r+te,this.generateExpression(t,$.Assignment,i)],$.Assignment,n)},R.prototype.semicolon=function(e){return!ne&&32&e?"":";"},R.Statement={BlockStatement:function(e,t){var r,n,i=["{",ee],o=this;return E(function(){0===e.body.length&&le&&(r=e.range)[1]-r[0]>2&&("\n"===(n=ce.substring(r[0]+1,r[1]-1))[0]&&(i=["{"]),i.push(n));var a,s,u,l;for(l=de,8&t&&(l|=16),a=0,s=e.body.length;a<s;++a)le&&(0===a&&(e.body[0].leadingComments&&(r=e.body[0].leadingComments[0].extendedRange,"\n"===(n=ce.substring(r[0],r[1]))[0]&&(i=["{"])),e.body[0].leadingComments||F(e.range[0],e.body[0].range[0],i)),a>0&&(e.body[a-1].trailingComments||e.body[a].leadingComments||F(e.body[a-1].range[1],e.body[a].range[0],i))),a===s-1&&(l|=32),u=e.body[a].leadingComments&&le?o.generateStatement(e.body[a],l):k(o.generateStatement(e.body[a],l)),i.push(u),c(_(u).toString())||(le&&a<s-1?e.body[a+1].leadingComments||i.push(ee):i.push(ee)),le&&a===s-1&&(e.body[a].trailingComments||F(e.body[a].range[1],e.range[1],i))}),i.push(k("}")),i},BreakStatement:function(e,t){return e.label?"break "+e.label.name+this.semicolon(t):"break"+this.semicolon(t)},ContinueStatement:function(e,t){return e.label?"continue "+e.label.name+this.semicolon(t):"continue"+this.semicolon(t)},ClassBody:function(e,t){var r=["{",ee],n=this;return E(function(t){var i,o;for(i=0,o=e.body.length;i<o;++i)r.push(t),r.push(n.generateExpression(e.body[i],$.Sequence,he)),i+1<o&&r.push(ee)}),c(_(r).toString())||r.push(ee),r.push(J),r.push("}"),r},ClassDeclaration:function(e,t){var r;return r=["class"],e.id&&(r=w(r,this.generateExpression(e.id,$.Sequence,he))),e.superClass&&(r=w(r,w("extends",this.generateExpression(e.superClass,$.Assignment,he)))),r.push(te),r.push(this.generateStatement(e.body,33)),r},DirectiveStatement:function(e,t){return ae.raw&&e.raw?e.raw+this.semicolon(t):y(e.directive)+this.semicolon(t)},DoWhileStatement:function(e,t){var r=w("do",this.maybeBlock(e.body,de));return r=this.maybeBlockSuffix(e.body,r),w(r,["while"+te+"(",this.generateExpression(e.test,$.Sequence,he),")"+this.semicolon(t)])},CatchClause:function(e,t){var r,n=this;return E(function(){var t;r=["catch"+te+"(",n.generateExpression(e.param,$.Sequence,he),")"],e.guard&&(t=n.generateExpression(e.guard,$.Sequence,he),r.splice(2,0," if ",t))}),r.push(this.maybeBlock(e.body,de)),r},DebuggerStatement:function(e,t){return"debugger"+this.semicolon(t)},EmptyStatement:function(e,t){return";"},ExportDefaultDeclaration:function(e,t){var r,n=["export"];return r=32&t?33:de,n=w(n,"default"),n=o(e.declaration)?w(n,this.generateStatement(e.declaration,r)):w(n,this.generateExpression(e.declaration,$.Assignment,he)+this.semicolon(t))},ExportNamedDeclaration:function(e,t){var r,n=["export"],i=this;return r=32&t?33:de,e.declaration?w(n,this.generateStatement(e.declaration,r)):(e.specifiers&&(0===e.specifiers.length?n=w(n,"{"+te+"}"):e.specifiers[0].type===q.ExportBatchSpecifier?n=w(n,this.generateExpression(e.specifiers[0],$.Sequence,he)):(n=w(n,"{"),E(function(t){var r,o;for(n.push(ee),r=0,o=e.specifiers.length;r<o;++r)n.push(t),n.push(i.generateExpression(e.specifiers[r],$.Sequence,he)),r+1<o&&n.push(","+ee)}),c(_(n).toString())||n.push(ee),n.push(J+"}")),e.source?n=w(n,["from"+te,this.generateExpression(e.source,$.Sequence,he),this.semicolon(t)]):n.push(this.semicolon(t))),n)},ExportAllDeclaration:function(e,t){return["export"+te,"*"+te,"from"+te,this.generateExpression(e.source,$.Sequence,he),this.semicolon(t)]},ExpressionStatement:function(e,t){var r,n;return r=[this.generateExpression(e.expression,$.Sequence,256|he)],123===(n=_(r).toString()).charCodeAt(0)||function(e){var t;return"class"===e.slice(0,5)&&(123===(t=e.charCodeAt(5))||z.code.isWhiteSpace(t)||z.code.isLineTerminator(t))}(n)||function(e){var t;return"function"===e.slice(0,8)&&(40===(t=e.charCodeAt(8))||z.code.isWhiteSpace(t)||42===t||z.code.isLineTerminator(t))}(n)||function(e){var t,r,n;if("async"!==e.slice(0,5))return!1;if(!z.code.isWhiteSpace(e.charCodeAt(5)))return!1;for(r=6,n=e.length;r<n&&z.code.isWhiteSpace(e.charCodeAt(r));++r);return r!==n&&"function"===e.slice(r,r+8)&&(40===(t=e.charCodeAt(r+8))||z.code.isWhiteSpace(t)||42===t||z.code.isLineTerminator(t))}(n)||oe&&16&t&&e.expression.type===q.Literal&&"string"==typeof e.expression.value?r=["(",r,")"+this.semicolon(t)]:r.push(this.semicolon(t)),r},ImportDeclaration:function(e,t){var r,n,i=this;return 0===e.specifiers.length?["import",te,this.generateExpression(e.source,$.Sequence,he),this.semicolon(t)]:(r=["import"],n=0,e.specifiers[n].type===q.ImportDefaultSpecifier&&(r=w(r,[this.generateExpression(e.specifiers[n],$.Sequence,he)]),++n),e.specifiers[n]&&(0!==n&&r.push(","),e.specifiers[n].type===q.ImportNamespaceSpecifier?r=w(r,[te,this.generateExpression(e.specifiers[n],$.Sequence,he)]):(r.push(te+"{"),e.specifiers.length-n==1?(r.push(te),r.push(this.generateExpression(e.specifiers[n],$.Sequence,he)),r.push(te+"}"+te)):(E(function(t){var o,a;for(r.push(ee),o=n,a=e.specifiers.length;o<a;++o)r.push(t),r.push(i.generateExpression(e.specifiers[o],$.Sequence,he)),o+1<a&&r.push(","+ee)}),c(_(r).toString())||r.push(ee),r.push(J+"}"+te)))),r=w(r,["from"+te,this.generateExpression(e.source,$.Sequence,he),this.semicolon(t)]))},VariableDeclarator:function(e,t){var r=1&t?he:6;return e.init?[this.generateExpression(e.id,$.Assignment,r),te,"=",te,this.generateExpression(e.init,$.Assignment,r)]:this.generatePattern(e.id,$.Assignment,r)},VariableDeclaration:function(e,t){function r(){for(a=e.declarations[0],ae.comment&&a.leadingComments?(n.push("\n"),n.push(k(u.generateStatement(a,s)))):(n.push(x()),n.push(u.generateStatement(a,s))),i=1,o=e.declarations.length;i<o;++i)a=e.declarations[i],ae.comment&&a.leadingComments?(n.push(","+ee),n.push(k(u.generateStatement(a,s)))):(n.push(","+te),n.push(u.generateStatement(a,s)))}var n,i,o,a,s,u=this;return n=[e.kind],s=1&t?de:0,e.declarations.length>1?E(r):r(),n.push(this.semicolon(t)),n},ThrowStatement:function(e,t){return[w("throw",this.generateExpression(e.argument,$.Sequence,he)),this.semicolon(t)]},TryStatement:function(e,t){var r,n,i,o;if(r=["try",this.maybeBlock(e.block,de)],r=this.maybeBlockSuffix(e.block,r),e.handlers)for(n=0,i=e.handlers.length;n<i;++n)r=w(r,this.generateStatement(e.handlers[n],de)),(e.finalizer||n+1!==i)&&(r=this.maybeBlockSuffix(e.handlers[n].body,r));else{for(n=0,i=(o=e.guardedHandlers||[]).length;n<i;++n)r=w(r,this.generateStatement(o[n],de)),(e.finalizer||n+1!==i)&&(r=this.maybeBlockSuffix(o[n].body,r));if(e.handler)if(V(e.handler))for(n=0,i=e.handler.length;n<i;++n)r=w(r,this.generateStatement(e.handler[n],de)),(e.finalizer||n+1!==i)&&(r=this.maybeBlockSuffix(e.handler[n].body,r));else r=w(r,this.generateStatement(e.handler,de)),e.finalizer&&(r=this.maybeBlockSuffix(e.handler.body,r))}return e.finalizer&&(r=w(r,["finally",this.maybeBlock(e.finalizer,de)])),r},SwitchStatement:function(e,t){var r,n,i,o,a,s=this;if(E(function(){r=["switch"+te+"(",s.generateExpression(e.discriminant,$.Sequence,he),")"+te+"{"+ee]}),e.cases)for(a=de,i=0,o=e.cases.length;i<o;++i)i===o-1&&(a|=32),n=k(this.generateStatement(e.cases[i],a)),r.push(n),c(_(n).toString())||r.push(ee);return r.push(k("}")),r},SwitchCase:function(e,t){var r,n,i,o,a,s=this;return E(function(){for(r=e.test?[w("case",s.generateExpression(e.test,$.Sequence,he)),":"]:["default:"],i=0,(o=e.consequent.length)&&e.consequent[0].type===q.BlockStatement&&(n=s.maybeBlock(e.consequent[0],de),r.push(n),i=1),i===o||c(_(r).toString())||r.push(ee),a=de;i<o;++i)i===o-1&&32&t&&(a|=32),n=k(s.generateStatement(e.consequent[i],a)),r.push(n),i+1===o||c(_(n).toString())||r.push(ee)}),r},IfStatement:function(e,t){var r,n,i,o=this;return E(function(){r=["if"+te+"(",o.generateExpression(e.test,$.Sequence,he),")"]}),i=32&t,n=de,i&&(n|=32),e.alternate?(r.push(this.maybeBlock(e.consequent,de)),r=this.maybeBlockSuffix(e.consequent,r),r=e.alternate.type===q.IfStatement?w(r,["else ",this.generateStatement(e.alternate,n)]):w(r,w("else",this.maybeBlock(e.alternate,n)))):r.push(this.maybeBlock(e.consequent,n)),r},ForStatement:function(e,t){var r,n=this;return E(function(){r=["for"+te+"("],e.init?e.init.type===q.VariableDeclaration?r.push(n.generateStatement(e.init,0)):(r.push(n.generateExpression(e.init,$.Sequence,6)),r.push(";")):r.push(";"),e.test?(r.push(te),r.push(n.generateExpression(e.test,$.Sequence,he)),r.push(";")):r.push(";"),e.update?(r.push(te),r.push(n.generateExpression(e.update,$.Sequence,he)),r.push(")")):r.push(")")}),r.push(this.maybeBlock(e.body,32&t?33:de)),r},ForInStatement:function(e,t){return this.generateIterationForStatement("in",e,32&t?33:de)},ForOfStatement:function(e,t){return this.generateIterationForStatement("of",e,32&t?33:de)},LabeledStatement:function(e,t){return[e.label.name+":",this.maybeBlock(e.body,32&t?33:de)]},Program:function(e,t){var r,n,i,o,a;for(o=e.body.length,r=[ie&&o>0?"\n":""],a=17,i=0;i<o;++i)ie||i!==o-1||(a|=32),le&&(0===i&&(e.body[0].leadingComments||F(e.range[0],e.body[i].range[0],r)),i>0&&(e.body[i-1].trailingComments||e.body[i].leadingComments||F(e.body[i-1].range[1],e.body[i].range[0],r))),n=k(this.generateStatement(e.body[i],a)),r.push(n),i+1<o&&!c(_(n).toString())&&(le?e.body[i+1].leadingComments||r.push(ee):r.push(ee)),le&&i===o-1&&(e.body[i].trailingComments||F(e.body[i].range[1],e.range[1],r));return r},FunctionDeclaration:function(e,t){return[P(e,!0),"function",I(e)||x(),e.id?B(e.id):"",this.generateFunctionBody(e)]},ReturnStatement:function(e,t){return e.argument?[w("return",this.generateExpression(e.argument,$.Sequence,he)),this.semicolon(t)]:["return"+this.semicolon(t)]},WhileStatement:function(e,t){var r,n=this;return E(function(){r=["while"+te+"(",n.generateExpression(e.test,$.Sequence,he),")"]}),r.push(this.maybeBlock(e.body,32&t?33:de)),r},WithStatement:function(e,t){var r,n=this;return E(function(){r=["with"+te+"(",n.generateExpression(e.object,$.Sequence,he),")"]}),r.push(this.maybeBlock(e.body,32&t?33:de)),r}},l(R.prototype,R.Statement),R.Expression={SequenceExpression:function(e,t,r){var n,i,o;for($.Sequence<t&&(r|=1),n=[],i=0,o=e.expressions.length;i<o;++i)n.push(this.generateExpression(e.expressions[i],$.Assignment,r)),i+1<o&&n.push(","+te);return j(n,$.Sequence,t)},AssignmentExpression:function(e,t,r){return this.generateAssignment(e.left,e.right,e.operator,t,r)},ArrowFunctionExpression:function(e,t,r){return j(this.generateFunctionBody(e),$.ArrowFunction,t)},ConditionalExpression:function(e,t,r){return $.Conditional<t&&(r|=1),j([this.generateExpression(e.test,$.LogicalOR,r),te+"?"+te,this.generateExpression(e.consequent,$.Assignment,r),te+":"+te,this.generateExpression(e.alternate,$.Assignment,r)],$.Conditional,t)},LogicalExpression:function(e,t,r){return this.BinaryExpression(e,t,r)},BinaryExpression:function(e,t,r){var n,i,o,a;return(i=W[e.operator])<t&&(r|=1),o=this.generateExpression(e.left,i,r),a=o.toString(),n=47===a.charCodeAt(a.length-1)&&z.code.isIdentifierPartES5(e.operator.charCodeAt(0))?[o,x(),e.operator]:w(o,e.operator),o=this.generateExpression(e.right,i+1,r),"/"===e.operator&&"/"===o.toString().charAt(0)||"<"===e.operator.slice(-1)&&"!--"===o.toString().slice(0,3)?(n.push(x()),n.push(o)):n=w(n,o),"in"!==e.operator||1&r?j(n,i,t):["(",n,")"]},CallExpression:function(e,t,r){var n,i,o;for((n=[this.generateExpression(e.callee,$.Call,3)]).push("("),i=0,o=e.arguments.length;i<o;++i)n.push(this.generateExpression(e.arguments[i],$.Assignment,512|he)),i+1<o&&n.push(","+te);return n.push(")"),2&r?j(n,$.Call,t):["(",n,")"]},NewExpression:function(e,t,r){var n,i,o,a,s;if(i=e.arguments.length,s=4&r&&!re&&0===i?5:1,n=w("new",this.generateExpression(e.callee,$.New,s)),!(4&r)||re||i>0){for(n.push("("),o=0,a=i;o<a;++o)n.push(this.generateExpression(e.arguments[o],$.Assignment,he)),o+1<a&&n.push(","+te);n.push(")")}return j(n,$.New,t)},MemberExpression:function(e,t,r){var n,i;return n=[this.generateExpression(e.object,$.Call,2&r?3:1)],e.computed?(n.push("["),n.push(this.generateExpression(e.property,$.Sequence,2&r?he:5)),n.push("]")):(e.object.type===q.Literal&&"number"==typeof e.object.value&&(i=_(n).toString()).indexOf(".")<0&&!/[eExX]/.test(i)&&z.code.isDecimalDigit(i.charCodeAt(i.length-1))&&!(i.length>=2&&48===i.charCodeAt(0))&&n.push("."),n.push("."),n.push(B(e.property))),j(n,$.Member,t)},MetaProperty:function(e,t,r){var n,i,o;return i=e.meta&&"string"==typeof e.meta.type&&e.meta.type===q.Identifier?e.meta.name:e.meta,o=e.property&&"string"==typeof e.property.type&&e.property.type===q.Identifier?e.property.name:e.property,n=[i,".",o],j(n,$.Member,t)},UnaryExpression:function(e,t,r){var n,i,o,a,s;return i=this.generateExpression(e.argument,$.Unary,he),""===te?n=w(e.operator,i):(n=[e.operator],e.operator.length>2?n=w(n,i):(s=(a=_(n).toString()).charCodeAt(a.length-1),o=i.toString().charCodeAt(0),(43===s||45===s)&&s===o||z.code.isIdentifierPartES5(s)&&z.code.isIdentifierPartES5(o)?(n.push(x()),n.push(i)):n.push(i))),j(n,$.Unary,t)},YieldExpression:function(e,t,r){var n;return n=e.delegate?"yield*":"yield",e.argument&&(n=w(n,this.generateExpression(e.argument,$.Yield,he))),j(n,$.Yield,t)},AwaitExpression:function(e,t,r){return j(w(e.all?"await*":"await",this.generateExpression(e.argument,$.Await,he)),$.Await,t)},UpdateExpression:function(e,t,r){return e.prefix?j([e.operator,this.generateExpression(e.argument,$.Unary,he)],$.Unary,t):j([this.generateExpression(e.argument,$.Postfix,he),e.operator],$.Postfix,t)},FunctionExpression:function(e,t,r){var n=[P(e,!0),"function"];return e.id?(n.push(I(e)||x()),n.push(B(e.id))):n.push(I(e)||te),n.push(this.generateFunctionBody(e)),n},ArrayPattern:function(e,t,r){return this.ArrayExpression(e,t,r,!0)},ArrayExpression:function(e,t,r,n){var i,o,a=this;return e.elements.length?(o=!n&&e.elements.length>1,i=["[",o?ee:""],E(function(t){var r,n;for(r=0,n=e.elements.length;r<n;++r)e.elements[r]?(i.push(o?t:""),i.push(a.generateExpression(e.elements[r],$.Assignment,768|he))):(o&&i.push(t),r+1===n&&i.push(",")),r+1<n&&i.push(","+(o?ee:te))}),o&&!c(_(i).toString())&&i.push(ee),i.push(o?J:""),i.push("]"),i):"[]"},ClassExpression:function(e,t,r){var n;return n=["class"],e.id&&(n=w(n,this.generateExpression(e.id,$.Sequence,he))),e.superClass&&(n=w(n,w("extends",this.generateExpression(e.superClass,$.Assignment,he)))),n.push(te),n.push(this.generateStatement(e.body,33)),n},MethodDefinition:function(e,t,r){var n,i;return n=e.static?["static"+te]:[],i="get"===e.kind||"set"===e.kind?[w(e.kind,this.generatePropertyKey(e.key,e.computed)),this.generateFunctionBody(e.value)]:[L(e),this.generatePropertyKey(e.key,e.computed),this.generateFunctionBody(e.value)],w(n,i)},Property:function(e,t,r){return"get"===e.kind||"set"===e.kind?[e.kind,x(),this.generatePropertyKey(e.key,e.computed),this.generateFunctionBody(e.value)]:"init"===e.kind&&!e.method&&e.shorthand?this.generatePattern(e.value,$.Assignment,he):e.shorthand?this.generatePropertyKey(e.key,e.computed):e.method?[L(e),this.generatePropertyKey(e.key,e.computed),this.generateFunctionBody(e.value)]:[this.generatePropertyKey(e.key,e.computed),":"+te,this.generateExpression(e.value,$.Assignment,he)]},ObjectExpression:function(e,t,r){var n,i,o,a=this;return e.properties.length?(n=e.properties.length>1,E(function(){o=a.generateExpression(e.properties[0],$.Sequence,he)}),n||u(_(o).toString())?(E(function(t){var r,s;if(i=["{",ee,t,o],n)for(i.push(","+ee),r=1,s=e.properties.length;r<s;++r)i.push(t),i.push(a.generateExpression(e.properties[r],$.Sequence,he)),r+1<s&&i.push(","+ee)}),c(_(i).toString())||i.push(ee),i.push(J),i.push("}"),i):["{",te,o,te,"}"]):"{}"},AssignmentPattern:function(e,t,r){return this.generateAssignment(e.left,e.right,"=",t,r)},ObjectPattern:function(e,t,r){var n,i,o,a,s,u=this;if(!e.properties.length)return"{}";if(a=!1,1===e.properties.length)(s=e.properties[0]).value&&s.value.type!==q.Identifier&&(a=!0);else for(i=0,o=e.properties.length;i<o;++i)if(!(s=e.properties[i]).shorthand){a=!0;break}return n=["{",a?ee:""],E(function(t){var r,i;for(r=0,i=e.properties.length;r<i;++r)n.push(a?t:""),n.push(u.generateExpression(e.properties[r],$.Sequence,he)),r+1<i&&n.push(","+(a?ee:te))}),a&&!c(_(n).toString())&&n.push(ee),n.push(a?J:""),n.push("}"),n},ThisExpression:function(e,t,r){return"this"},Super:function(e,t,r){return"super"},Identifier:function(e,t,r){return B(e)},Import:function(e,t,r){return"import"},ImportDefaultSpecifier:function(e,t,r){return B(e.id||e.local)},ImportNamespaceSpecifier:function(e,t,r){var n=["*"],i=e.id||e.local;return i&&n.push(te+"as"+x()+B(i)),n},ImportSpecifier:function(e,t,r){var n=e.imported,i=[n.name],o=e.local;return o&&o.name!==n.name&&i.push(x()+"as"+x()+B(o)),i},ExportSpecifier:function(e,t,r){var n=e.local,i=[n.name],o=e.exported;return o&&o.name!==n.name&&i.push(x()+"as"+x()+B(o)),i},Literal:function(e,t,r){var n;if(e.hasOwnProperty("raw")&&se&&ae.raw)try{if((n=se(e.raw).body[0].expression).type===q.Literal&&n.value===e.value)return e.raw}catch(e){}return null===e.value?"null":"string"==typeof e.value?g(e.value):"number"==typeof e.value?p(e.value):"boolean"==typeof e.value?e.value?"true":"false":d(e.value)},GeneratorExpression:function(e,t,r){return this.ComprehensionExpression(e,t,r)},ComprehensionExpression:function(e,t,r){var n,i,o,a,s=this;return n=e.type===q.GeneratorExpression?["("]:["["],ae.moz.comprehensionExpressionStartsWithAssignment&&(a=this.generateExpression(e.body,$.Assignment,he),n.push(a)),e.blocks&&E(function(){for(i=0,o=e.blocks.length;i<o;++i)a=s.generateExpression(e.blocks[i],$.Sequence,he),i>0||ae.moz.comprehensionExpressionStartsWithAssignment?n=w(n,a):n.push(a)}),e.filter&&(n=w(n,"if"+te),a=this.generateExpression(e.filter,$.Sequence,he),n=w(n,["(",a,")"])),ae.moz.comprehensionExpressionStartsWithAssignment||(a=this.generateExpression(e.body,$.Assignment,he),n=w(n,a)),n.push(e.type===q.GeneratorExpression?")":"]"),n},ComprehensionBlock:function(e,t,r){var n;return n=e.left.type===q.VariableDeclaration?[e.left.kind,x(),this.generateStatement(e.left.declarations[0],0)]:this.generateExpression(e.left,$.Call,he),n=w(n,e.of?"of":"in"),n=w(n,this.generateExpression(e.right,$.Sequence,he)),["for"+te+"(",n,")"]},SpreadElement:function(e,t,r){return["...",this.generateExpression(e.argument,$.Assignment,he)]},RestElement:function(e,t,r){return["...",this.generatePattern(e.argument,$.Assignment,he)]},SpreadProperty:function(e,t,r){return["...",this.generateExpression(e.argument,$.Assignment,he)]},RestProperty:function(e,t,r){return["...",this.generatePattern(e.argument,$.Assignment,he)]},TaggedTemplateExpression:function(e,t,r){var n=3;return 2&r||(n=1),j([this.generateExpression(e.tag,$.Call,n),this.generateExpression(e.quasi,$.Primary,4)],$.TaggedTemplate,t)},TemplateElement:function(e,t,r){return e.value.raw},TemplateLiteral:function(e,t,r){var n,i,o;for(n=["`"],i=0,o=e.quasis.length;i<o;++i)n.push(this.generateExpression(e.quasis[i],$.Primary,he)),i+1<o&&(n.push("${"+te),n.push(this.generateExpression(e.expressions[i],$.Sequence,he)),n.push(te+"}"));return n.push("`"),n},ModuleSpecifier:function(e,t,r){return this.Literal(e,t,r)},JSXText:function(e,t,r){return e.hasOwnProperty("raw")?e.raw:String(e.value)},JSXAttribute:function(e,t,r){var n=[],i=this.generateExpression(e.name,$.Sequence,{allowIn:!0,allowCall:!0});return n.push(i),e.value&&(n.push("="),i=e.value.type===q.Literal?M(e.value.value,e.value.raw):this.generateExpression(e.value,$.Sequence,{allowIn:!0,allowCall:!0}),n.push(i)),n},JSXClosingElement:function(e,t,r){return["</",this.generateExpression(e.name,$.Sequence,0),">"]},JSXElement:function(e,t,r){var n=[],i=this;256&r||(J+=H);var o=this.generateExpression(e.openingElement,$.JSXElement,{allowIn:!0,allowCall:!0});n.push(o);var a,s,c=[];return E(function(t){for(a=0,s=e.children.length;a<s;++a)e.children[a].type!==q.Literal?(o=i.generateExpression(e.children[a],$.JSXElement,259),c.push(o)):(o=e.children[a].raw)&&c.push(o);for(a=0,s=c.length;a<s;++a)n.push(c[a])}),e.closingElement&&(o=i.generateExpression(e.closingElement,$.JSXElement,0),n.push(o)),256&r||(J=J.slice(0,J.length-H.length),u(_(n).toString())&&(n=512&r?[ee+J+H,n]:["("+ee+J+H,n,ee+J+")"])),n},JSXExpressionContainer:function(e,t,r){return["{",this.generateExpression(e.expression,$.Sequence,3),"}"]},JSXIdentifier:function(e,t,r){return e.name},JSXMemberExpression:function(e,t,r){return[this.generateExpression(e.object,$.Sequence,1),".",this.generateExpression(e.property,$.Sequence,0)]},JSXNamespacedName:function(e,t,r){return[this.generateExpression(e.namespace,$.Sequence,0),":",this.generateExpression(e.name,$.Sequence,0)]},JSXOpeningElement:function(e,t,r){var n=["<"],i=this,o=this.generateExpression(e.name,$.Sequence,0);n.push(o);for(var a=[],s=0,c=e.attributes.length;s<c;++s)o=i.generateExpression(e.attributes[s],$.Sequence,3),a.push({expr:e.attributes[s],name:e.attributes[s].name&&e.attributes[s].name.name,fragment:o,multiline:u(_(o).toString())}),e.attributes.length>3&&e.attributes[s].value&&e.attributes[s].value.type!==q.Literal&&(a[a.length-1].multiline=!0);return E(function(e){for(var t=0,r=a.length;t<r;++t)t>0&&t%3==0||a[t].multiline?n.push(ee+e):n.push(" "),n.push(i.generateExpression(a[t].expr,$.Sequence,3))}),n.push(e.selfClosing?"/>":">"),n},JSXSpreadAttribute:function(e,t,r){return["{...",this.generateExpression(e.argument,$.Sequence,{allowIn:!0,allowCall:!0}),"}"]}},l(R.prototype,R.Expression),R.prototype.generateExpression=function(e,t,r){var n,i;return i=e.type||q.Property,ae.verbatim&&e.hasOwnProperty(ae.verbatim)?O(e,t):(n=this[i](e,t,r),ae.comment&&(n=C(e,n)),_(n,e))},R.prototype.generateStatement=function(e,t){var r,n;return r=this[e.type](e,t),ae.comment&&(r=C(e,r)),n=_(r).toString(),e.type!==q.Program||ie||""!==ee||"\n"!==n.charAt(n.length-1)||(r=ue?_(r).replaceRight(/\s+$/,""):n.replace(/\s+$/,"")),_(r,e)},fe={indent:{style:"",base:0},renumber:!0,hexadecimal:!0,quotes:"auto",escapeless:!0,compact:!0,parentheses:!1,semicolons:!1},pe=a().format,t.version=n("/package.json",e).version,t.generate=function(i,o){var u,c,l=a();return null!=o?("string"==typeof o.indent&&(l.format.indent.style=o.indent),"number"==typeof o.base&&(l.format.indent.base=o.base),o=f(l,o),H=o.format.indent.style,J="string"==typeof o.base?o.base:s(H,o.format.indent.base)):(H=(o=l).format.indent.style,J=s(H,o.format.indent.base)),X=o.format.json,K=o.format.renumber,Q=!X&&o.format.hexadecimal,Y=X?"double":o.format.quotes,Z=o.format.escapeless,ee=o.format.newline,te=o.format.space,o.format.compact&&(ee=te=H=J=""),re=o.format.parentheses,ne=o.format.semicolons,ie=o.format.safeConcatenation,oe=o.directive,se=X?null:o.parse,ue=o.sourceMap,ce=o.sourceCode,le=o.format.preserveBlankLines&&null!==ce,ae=o,ue&&(U=t.browser?r.sourceMap.SourceNode:n("/node_modules/source-map/lib/source-map.js",e).SourceNode),u=N(i),ue?(c=u.toStringWithSourceMap({file:o.file,sourceRoot:o.sourceMapRoot}),o.sourceContent&&c.map.setSourceContent(o.sourceMap,o.sourceContent),o.sourceMapWithCode?c:c.map.toString()):(c={code:u.toString(),map:null},o.sourceMapWithCode?c:c.code)},t.attachComments=G.attachComments,t.Precedence=f({},$),t.browser=!1,t.FORMAT_MINIFY=fe,t.FORMAT_DEFAULTS=pe}()}),n.define("/package.json",function(e,t,r,n){e.exports={name:"escodegen-wallaby",description:"ECMAScript code generator with JSX support",homepage:"http://github.com/wallabyjs/escodegen",main:"escodegen.js",bin:{esgenerate:"./bin/esgenerate.js",escodegen:"./bin/escodegen.js"},files:["LICENSE.BSD","LICENSE.source-map","README.md","bin","escodegen.js","package.json"],version:"1.6.12",engines:{node:">=0.10.0"},maintainers:[{name:"Artem Govorov",email:"artem.govorov@gmail.com",web:"http://dm.gl"}],repository:{type:"git",url:"http://github.com/wallabyjs/escodegen.git"},dependencies:{estraverse:"^1.9.1",esutils:"^2.0.2",esprima:"^2.7.1",optionator:"^0.8.1"},optionalDependencies:{"source-map":"~0.2.0"},devDependencies:{acorn:"^2.7.0","acorn-babel":"^0.11.1-38",bluebird:"^2.3.11","bower-registry-client":"^0.2.1",chai:"^1.10.0","commonjs-everywhere":"^0.9.7",gulp:"^3.8.10","gulp-eslint":"^0.2.0","gulp-mocha":"^2.0.0",semver:"^5.1.0"},licenses:[{type:"BSD",url:"http://github.com/wallabyjs/escodegen/raw/master/LICENSE.BSD"}],scripts:{test:"gulp travis","unit-test":"gulp test",lint:"gulp lint",release:"node tools/release.js","build-min":"./node_modules/.bin/cjsify -ma path: tools/entry-point.js > escodegen.browser.min.js",build:"./node_modules/.bin/cjsify -a path: tools/entry-point.js > escodegen.browser.js"}}}),n.define("/node_modules/source-map/lib/source-map.js",function(e,t,r,i){t.SourceMapGenerator=n("/node_modules/source-map/lib/source-map/source-map-generator.js",e).SourceMapGenerator,t.SourceMapConsumer=n("/node_modules/source-map/lib/source-map/source-map-consumer.js",e).SourceMapConsumer,t.SourceNode=n("/node_modules/source-map/lib/source-map/source-node.js",e).SourceNode}),n.define("/node_modules/source-map/lib/source-map/source-node.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e,t,r,n,i){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==r?null:r,this.name=null==i?null:i,this[s]=!0,null!=n&&this.add(n)}var i=e("/node_modules/source-map/lib/source-map/source-map-generator.js",r).SourceMapGenerator,o=e("/node_modules/source-map/lib/source-map/util.js",r),a=/(\r?\n)/,s="$$$isSourceNode$$$";n.fromStringWithSourceMap=function(e,t,r){function i(e,t){if(null===e||void 0===e.source)s.add(t);else{var i=r?o.join(r,e.source):e.source;s.add(new n(e.originalLine,e.originalColumn,i,t,e.name))}}var s=new n,u=e.split(a),c=function(){return u.shift()+(u.shift()||"")},l=1,f=0,p=null;return t.eachMapping(function(e){if(null!==p){if(!(l<e.generatedLine)){t=(r=u[0]).substr(0,e.generatedColumn-f);return u[0]=r.substr(e.generatedColumn-f),f=e.generatedColumn,i(p,t),void(p=e)}var t="";i(p,c()),l++,f=0}for(;l<e.generatedLine;)s.add(c()),l++;if(f<e.generatedColumn){var r=u[0];s.add(r.substr(0,e.generatedColumn)),u[0]=r.substr(e.generatedColumn),f=e.generatedColumn}p=e},this),u.length>0&&(p&&i(p,c()),s.add(u.join(""))),t.sources.forEach(function(e){var n=t.sourceContentFor(e);null!=n&&(null!=r&&(e=o.join(r,e)),s.setSourceContent(e,n))}),s},n.prototype.add=function(e){if(Array.isArray(e))e.forEach(function(e){this.add(e)},this);else{if(!e[s]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this},n.prototype.prepend=function(e){if(Array.isArray(e))for(var t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[s]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this},n.prototype.walk=function(e){for(var t,r=0,n=this.children.length;r<n;r++)(t=this.children[r])[s]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})},n.prototype.join=function(e){var t,r,n=this.children.length;if(n>0){for(t=[],r=0;r<n-1;r++)t.push(this.children[r]),t.push(e);t.push(this.children[r]),this.children=t}return this},n.prototype.replaceRight=function(e,t){var r=this.children[this.children.length-1];return r[s]?r.replaceRight(e,t):"string"==typeof r?this.children[this.children.length-1]=r.replace(e,t):this.children.push("".replace(e,t)),this},n.prototype.setSourceContent=function(e,t){this.sourceContents[o.toSetString(e)]=t},n.prototype.walkSourceContents=function(e){for(var t=0,r=this.children.length;t<r;t++)this.children[t][s]&&this.children[t].walkSourceContents(e);for(var n=Object.keys(this.sourceContents),t=0,r=n.length;t<r;t++)e(o.fromSetString(n[t]),this.sourceContents[n[t]])},n.prototype.toString=function(){var e="";return this.walk(function(t){e+=t}),e},n.prototype.toStringWithSourceMap=function(e){var t={code:"",line:1,column:0},r=new i(e),n=!1,o=null,a=null,s=null,u=null;return this.walk(function(e,i){t.code+=e,null!==i.source&&null!==i.line&&null!==i.column?(o===i.source&&a===i.line&&s===i.column&&u===i.name||r.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:t.line,column:t.column},name:i.name}),o=i.source,a=i.line,s=i.column,u=i.name,n=!0):n&&(r.addMapping({generated:{line:t.line,column:t.column}}),o=null,n=!1);for(var c=0,l=e.length;c<l;c++)10===e.charCodeAt(c)?(t.line++,t.column=0,c+1===l?(o=null,n=!1):n&&r.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:t.line,column:t.column},name:i.name})):t.column++}),this.walkSourceContents(function(e,t){r.setSourceContent(e,t)}),{code:t.code,map:r}},t.SourceNode=n})}),n.define("/node_modules/source-map/lib/source-map/util.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e){var t=e.match(s);return t?{scheme:t[1],auth:t[2],host:t[3],port:t[4],path:t[5]}:null}function i(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function o(e){var t=e,r=n(e);if(r){if(!r.path)return e;t=r.path}for(var o,a="/"===t.charAt(0),s=t.split(/\/+/),u=0,c=s.length-1;c>=0;c--)"."===(o=s[c])?s.splice(c,1):".."===o?u++:u>0&&(""===o?(s.splice(c+1,u),u=0):(s.splice(c,2),u--));return""===(t=s.join("/"))&&(t=a?"/":"."),r?(r.path=t,i(r)):t}function a(e,t){var r=e||"",n=t||"";return(r>n)-(r<n)}t.getArg=function(e,t,r){if(t in e)return e[t];if(3===arguments.length)return r;throw new Error('"'+t+'" is a required argument.')};var s=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/,u=/^data:.+\,.+$/;t.urlParse=n,t.urlGenerate=i,t.normalize=o,t.join=function(e,t){""===e&&(e="."),""===t&&(t=".");var r=n(t),a=n(e);if(a&&(e=a.path||"/"),r&&!r.scheme)return a&&(r.scheme=a.scheme),i(r);if(r||t.match(u))return t;if(a&&!a.host&&!a.path)return a.host=t,i(a);var s="/"===t.charAt(0)?t:o(e.replace(/\/+$/,"")+"/"+t);return a?(a.path=s,i(a)):s},t.relative=function(e,t){""===e&&(e=".");var r=n(e=e.replace(/\/$/,""));return"/"==t.charAt(0)&&r&&"/"==r.path?t.slice(1):0===t.indexOf(e+"/")?t.substr(e.length+1):t},t.toSetString=function(e){return"$"+e},t.fromSetString=function(e){return e.substr(1)},t.compareByOriginalPositions=function(e,t,r){var n;return(n=a(e.source,t.source))?n:(n=e.originalLine-t.originalLine)?n:(n=e.originalColumn-t.originalColumn)||r?n:(n=a(e.name,t.name))?n:(n=e.generatedLine-t.generatedLine)||e.generatedColumn-t.generatedColumn},t.compareByGeneratedPositions=function(e,t,r){var n;return(n=e.generatedLine-t.generatedLine)?n:(n=e.generatedColumn-t.generatedColumn)||r?n:(n=a(e.source,t.source))?n:(n=e.originalLine-t.originalLine)?n:(n=e.originalColumn-t.originalColumn)||a(e.name,t.name)}})}),n.define("/node_modules/amdefine/amdefine.js",function(e,t,r,o){"use strict";e.exports=function(e,t){function r(e){var t,r;for(t=0;e[t];t+=1)if("."===(r=e[t]))e.splice(t,1),t-=1;else if(".."===r){if(1===t&&(".."===e[2]||".."===e[0]))break;t>0&&(e.splice(t-1,2),t-=2)}}function a(e,t){var n;return e&&"."===e.charAt(0)&&t&&(r(n=(n=(n=t.split("/")).slice(0,n.length-1)).concat(e.split("/"))),e=n.join("/")),e}function s(e){return function(t){return a(t,e)}}function u(e){function t(t){d[e]=t}return t.fromText=function(e,t){throw new Error("amdefine does not implement load.fromText")},t}function c(r,n,i){var a,s,u,c;if(r)s=d[r]={},a=f(t,s,u={id:r,uri:o,exports:s},r);else{if(m)throw new Error("amdefine with no module ID cannot be called more than once per file.");m=!0,s=e.exports,a=f(t,s,u=e,e.id)}n&&(n=n.map(function(e){return a(e)})),void 0!==(c="function"==typeof i?i.apply(u.exports,n):i)&&(u.exports=c,r&&(d[r]=u.exports))}function l(e,t,r){Array.isArray(e)?(r=t,t=e,e=void 0):"string"!=typeof e&&(r=e,e=t=void 0),t&&!Array.isArray(t)&&(r=t,t=void 0),t||(t=["require","exports","module"]),e?h[e]=[e,t,r]:c(e,t,r)}var f,p,h={},d={},m=!1,v=n("path",e);return f=function(e,t,r,n){function o(o,a){if("string"==typeof o)return p(e,t,r,o,n);o=o.map(function(i){return p(e,t,r,i,n)}),a&&i.nextTick(function(){a.apply(null,o)})}return o.toUrl=function(e){return 0===e.indexOf(".")?a(e,v.dirname(r.filename)):e},o},t=t||function(){return e.require.apply(e,arguments)},p=function(e,t,r,n,i){var o,l,m=n.indexOf("!"),v=n;if(-1===m){if("require"===(n=a(n,i)))return f(e,t,r,i);if("exports"===n)return t;if("module"===n)return r;if(d.hasOwnProperty(n))return d[n];if(h[n])return c.apply(null,h[n]),d[n];if(e)return e(v);throw new Error("No module with ID: "+n)}return o=n.substring(0,m),n=n.substring(m+1,n.length),l=p(e,t,r,o,i),n=l.normalize?l.normalize(n,s(i)):a(n,i),d[n]?d[n]:(l.load(n,f(e,t,r,i),u(n),{}),d[n])},l.require=function(e){return d[e]?d[e]:h[e]?(c.apply(null,h[e]),d[e]):void 0},l.amd={},l}}),n.define("/node_modules/source-map/lib/source-map/source-map-generator.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e){e||(e={}),this._file=o.getArg(e,"file",null),this._sourceRoot=o.getArg(e,"sourceRoot",null),this._skipValidation=o.getArg(e,"skipValidation",!1),this._sources=new a,this._names=new a,this._mappings=new s,this._sourcesContents=null}var i=e("/node_modules/source-map/lib/source-map/base64-vlq.js",r),o=e("/node_modules/source-map/lib/source-map/util.js",r),a=e("/node_modules/source-map/lib/source-map/array-set.js",r).ArraySet,s=e("/node_modules/source-map/lib/source-map/mapping-list.js",r).MappingList;n.prototype._version=3,n.fromSourceMap=function(e){var t=e.sourceRoot,r=new n({file:e.file,sourceRoot:t});return e.eachMapping(function(e){var n={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(n.source=e.source,null!=t&&(n.source=o.relative(t,n.source)),n.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(n.name=e.name)),r.addMapping(n)}),e.sources.forEach(function(t){var n=e.sourceContentFor(t);null!=n&&r.setSourceContent(t,n)}),r},n.prototype.addMapping=function(e){var t=o.getArg(e,"generated"),r=o.getArg(e,"original",null),n=o.getArg(e,"source",null),i=o.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,r,n,i),null==n||this._sources.has(n)||this._sources.add(n),null==i||this._names.has(i)||this._names.add(i),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:null!=r&&r.line,originalColumn:null!=r&&r.column,source:n,name:i})},n.prototype.setSourceContent=function(e,t){var r=e;null!=this._sourceRoot&&(r=o.relative(this._sourceRoot,r)),null!=t?(this._sourcesContents||(this._sourcesContents={}),this._sourcesContents[o.toSetString(r)]=t):this._sourcesContents&&(delete this._sourcesContents[o.toSetString(r)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},n.prototype.applySourceMap=function(e,t,r){var n=t;if(null==t){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');n=e.file}var i=this._sourceRoot;null!=i&&(n=o.relative(i,n));var s=new a,u=new a;this._mappings.unsortedForEach(function(t){if(t.source===n&&null!=t.originalLine){var a=e.originalPositionFor({line:t.originalLine,column:t.originalColumn});null!=a.source&&(t.source=a.source,null!=r&&(t.source=o.join(r,t.source)),null!=i&&(t.source=o.relative(i,t.source)),t.originalLine=a.line,t.originalColumn=a.column,null!=a.name&&(t.name=a.name))}var c=t.source;null==c||s.has(c)||s.add(c);var l=t.name;null==l||u.has(l)||u.add(l)},this),this._sources=s,this._names=u,e.sources.forEach(function(t){var n=e.sourceContentFor(t);null!=n&&(null!=r&&(t=o.join(r,t)),null!=i&&(t=o.relative(i,t)),this.setSourceContent(t,n))},this)},n.prototype._validateMapping=function(e,t,r,n){if((!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0)||t||r||n)&&!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:t,name:n}))},n.prototype._serializeMappings=function(){for(var e,t=0,r=1,n=0,a=0,s=0,u=0,c="",l=this._mappings.toArray(),f=0,p=l.length;f<p;f++){if((e=l[f]).generatedLine!==r)for(t=0;e.generatedLine!==r;)c+=";",r++;else if(f>0){if(!o.compareByGeneratedPositions(e,l[f-1]))continue;c+=","}c+=i.encode(e.generatedColumn-t),t=e.generatedColumn,null!=e.source&&(c+=i.encode(this._sources.indexOf(e.source)-u),u=this._sources.indexOf(e.source),c+=i.encode(e.originalLine-1-a),a=e.originalLine-1,c+=i.encode(e.originalColumn-n),n=e.originalColumn,null!=e.name&&(c+=i.encode(this._names.indexOf(e.name)-s),s=this._names.indexOf(e.name)))}return c},n.prototype._generateSourcesContent=function(e,t){return e.map(function(e){if(!this._sourcesContents)return null;null!=t&&(e=o.relative(t,e));var r=o.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,r)?this._sourcesContents[r]:null},this)},n.prototype.toJSON=function(){var e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e},n.prototype.toString=function(){return JSON.stringify(this)},t.SourceMapGenerator=n})}),n.define("/node_modules/source-map/lib/source-map/mapping-list.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e,t){var r=e.generatedLine,n=t.generatedLine,i=e.generatedColumn,a=t.generatedColumn;return n>r||n==r&&a>=i||o.compareByGeneratedPositions(e,t)<=0}function i(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}var o=e("/node_modules/source-map/lib/source-map/util.js",r);i.prototype.unsortedForEach=function(e,t){this._array.forEach(e,t)},i.prototype.add=function(e){n(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))},i.prototype.toArray=function(){return this._sorted||(this._array.sort(o.compareByGeneratedPositions),this._sorted=!0),this._array},t.MappingList=i})}),n.define("/node_modules/source-map/lib/source-map/array-set.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(){this._array=[],this._set={}}var i=e("/node_modules/source-map/lib/source-map/util.js",r);n.fromArray=function(e,t){for(var r=new n,i=0,o=e.length;i<o;i++)r.add(e[i],t);return r},n.prototype.add=function(e,t){var r=this.has(e),n=this._array.length;r&&!t||this._array.push(e),r||(this._set[i.toSetString(e)]=n)},n.prototype.has=function(e){return Object.prototype.hasOwnProperty.call(this._set,i.toSetString(e))},n.prototype.indexOf=function(e){if(this.has(e))return this._set[i.toSetString(e)];throw new Error('"'+e+'" is not in the set.')},n.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},n.prototype.toArray=function(){return this._array.slice()},t.ArraySet=n})}),n.define("/node_modules/source-map/lib/source-map/base64-vlq.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e){return e<0?1+(-e<<1):0+(e<<1)}function i(e){var t=e>>1;return 1==(1&e)?-t:t}var o=e("/node_modules/source-map/lib/source-map/base64.js",r);t.encode=function(e){var t,r="",i=n(e);do{t=31&i,(i>>>=5)>0&&(t|=32),r+=o.encode(t)}while(i>0);return r},t.decode=function(e,t){var r,n,a=0,s=e.length,u=0,c=0;do{if(a>=s)throw new Error("Expected more digits in base 64 VLQ value.");r=!!(32&(n=o.decode(e.charAt(a++)))),u+=(n&=31)<<c,c+=5}while(r);t.value=i(u),t.rest=e.slice(a)}})}),n.define("/node_modules/source-map/lib/source-map/base64.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){var n={},i={};"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("").forEach(function(e,t){n[e]=t,i[t]=e}),t.encode=function(e){if(e in i)return i[e];throw new TypeError("Must be between 0 and 63: "+e)},t.decode=function(e){if(e in n)return n[e];throw new TypeError("Not a valid base 64 digit: "+e)}})}),n.define("/node_modules/source-map/lib/source-map/source-map-consumer.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(t){var n=t;return"string"==typeof t&&(n=JSON.parse(t.replace(/^\)\]\}'/,""))),null!=n.sections?new(e("/node_modules/source-map/lib/source-map/indexed-source-map-consumer.js",r).IndexedSourceMapConsumer)(n):new(e("/node_modules/source-map/lib/source-map/basic-source-map-consumer.js",r).BasicSourceMapConsumer)(n)}var i=e("/node_modules/source-map/lib/source-map/util.js",r);n.fromSourceMap=function(t){return e("/node_modules/source-map/lib/source-map/basic-source-map-consumer.js",r).BasicSourceMapConsumer.fromSourceMap(t)},n.prototype._version=3,n.prototype.__generatedMappings=null,Object.defineProperty(n.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||(this.__generatedMappings=[],this.__originalMappings=[],this._parseMappings(this._mappings,this.sourceRoot)),this.__generatedMappings}}),n.prototype.__originalMappings=null,Object.defineProperty(n.prototype,"_originalMappings",{get:function(){return this.__originalMappings||(this.__generatedMappings=[],this.__originalMappings=[],this._parseMappings(this._mappings,this.sourceRoot)),this.__originalMappings}}),n.prototype._nextCharIsMappingSeparator=function(e){var t=e.charAt(0);return";"===t||","===t},n.prototype._parseMappings=function(e,t){throw new Error("Subclasses must implement _parseMappings")},n.GENERATED_ORDER=1,n.ORIGINAL_ORDER=2,n.prototype.eachMapping=function(e,t,r){var o,a=t||null;switch(r||n.GENERATED_ORDER){case n.GENERATED_ORDER:o=this._generatedMappings;break;case n.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var s=this.sourceRoot;o.map(function(e){var t=e.source;return null!=t&&null!=s&&(t=i.join(s,t)),{source:t,generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:e.name}}).forEach(e,a)},n.prototype.allGeneratedPositionsFor=function(e){var t={source:i.getArg(e,"source"),originalLine:i.getArg(e,"line"),originalColumn:1/0};null!=this.sourceRoot&&(t.source=i.relative(this.sourceRoot,t.source));var r=[],n=this._findMapping(t,this._originalMappings,"originalLine","originalColumn",i.compareByOriginalPositions);if(n>=0)for(var o=this._originalMappings[n];o&&o.originalLine===t.originalLine;)r.push({line:i.getArg(o,"generatedLine",null),column:i.getArg(o,"generatedColumn",null),lastColumn:i.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[--n];return r.reverse()},t.SourceMapConsumer=n})}),n.define("/node_modules/source-map/lib/source-map/basic-source-map-consumer.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var r=i.getArg(t,"version"),n=i.getArg(t,"sources"),o=i.getArg(t,"names",[]),s=i.getArg(t,"sourceRoot",null),u=i.getArg(t,"sourcesContent",null),c=i.getArg(t,"mappings"),l=i.getArg(t,"file",null);if(r!=this._version)throw new Error("Unsupported version: "+r);n=n.map(i.normalize),this._names=a.fromArray(o,!0),this._sources=a.fromArray(n,!0),this.sourceRoot=s,this.sourcesContent=u,this._mappings=c,this.file=l}var i=e("/node_modules/source-map/lib/source-map/util.js",r),o=e("/node_modules/source-map/lib/source-map/binary-search.js",r),a=e("/node_modules/source-map/lib/source-map/array-set.js",r).ArraySet,s=e("/node_modules/source-map/lib/source-map/base64-vlq.js",r),u=e("/node_modules/source-map/lib/source-map/source-map-consumer.js",r).SourceMapConsumer;(n.prototype=Object.create(u.prototype)).consumer=u,n.fromSourceMap=function(e){var t=Object.create(n.prototype);return t._names=a.fromArray(e._names.toArray(),!0),t._sources=a.fromArray(e._sources.toArray(),!0),t.sourceRoot=e._sourceRoot,t.sourcesContent=e._generateSourcesContent(t._sources.toArray(),t.sourceRoot),t.file=e._file,t.__generatedMappings=e._mappings.toArray().slice(),t.__originalMappings=e._mappings.toArray().slice().sort(i.compareByOriginalPositions),t},n.prototype._version=3,Object.defineProperty(n.prototype,"sources",{get:function(){return this._sources.toArray().map(function(e){return null!=this.sourceRoot?i.join(this.sourceRoot,e):e},this)}}),n.prototype._parseMappings=function(e,t){for(var r,n=1,o=0,a=0,u=0,c=0,l=0,f=e,p={};f.length>0;)if(";"===f.charAt(0))n++,f=f.slice(1),o=0;else if(","===f.charAt(0))f=f.slice(1);else{if(r={},r.generatedLine=n,s.decode(f,p),r.generatedColumn=o+p.value,o=r.generatedColumn,(f=p.rest).length>0&&!this._nextCharIsMappingSeparator(f)){if(s.decode(f,p),r.source=this._sources.at(c+p.value),c+=p.value,0===(f=p.rest).length||this._nextCharIsMappingSeparator(f))throw new Error("Found a source, but no line and column");if(s.decode(f,p),r.originalLine=a+p.value,a=r.originalLine,r.originalLine+=1,0===(f=p.rest).length||this._nextCharIsMappingSeparator(f))throw new Error("Found a source and line, but no column");s.decode(f,p),r.originalColumn=u+p.value,u=r.originalColumn,(f=p.rest).length>0&&!this._nextCharIsMappingSeparator(f)&&(s.decode(f,p),r.name=this._names.at(l+p.value),l+=p.value,f=p.rest)}this.__generatedMappings.push(r),"number"==typeof r.originalLine&&this.__originalMappings.push(r)}this.__generatedMappings.sort(i.compareByGeneratedPositions),this.__originalMappings.sort(i.compareByOriginalPositions)},n.prototype._findMapping=function(e,t,r,n,i){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[n]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[n]);return o.search(e,t,i)},n.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var r=this._generatedMappings[e+1];if(t.generatedLine===r.generatedLine){t.lastGeneratedColumn=r.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},n.prototype.originalPositionFor=function(e){var t={generatedLine:i.getArg(e,"line"),generatedColumn:i.getArg(e,"column")},r=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",i.compareByGeneratedPositions);if(r>=0){var n=this._generatedMappings[r];if(n.generatedLine===t.generatedLine){var o=i.getArg(n,"source",null);return null!=o&&null!=this.sourceRoot&&(o=i.join(this.sourceRoot,o)),{source:o,line:i.getArg(n,"originalLine",null),column:i.getArg(n,"originalColumn",null),name:i.getArg(n,"name",null)}}}return{source:null,line:null,column:null,name:null}},n.prototype.sourceContentFor=function(e,t){if(!this.sourcesContent)return null;if(null!=this.sourceRoot&&(e=i.relative(this.sourceRoot,e)),this._sources.has(e))return this.sourcesContent[this._sources.indexOf(e)];var r;if(null!=this.sourceRoot&&(r=i.urlParse(this.sourceRoot))){var n=e.replace(/^file:\/\//,"");if("file"==r.scheme&&this._sources.has(n))return this.sourcesContent[this._sources.indexOf(n)];if((!r.path||"/"==r.path)&&this._sources.has("/"+e))return this.sourcesContent[this._sources.indexOf("/"+e)]}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},n.prototype.generatedPositionFor=function(e){var t={source:i.getArg(e,"source"),originalLine:i.getArg(e,"line"),originalColumn:i.getArg(e,"column")};null!=this.sourceRoot&&(t.source=i.relative(this.sourceRoot,t.source));var r=this._findMapping(t,this._originalMappings,"originalLine","originalColumn",i.compareByOriginalPositions);if(r>=0){var n=this._originalMappings[r];return{line:i.getArg(n,"generatedLine",null),column:i.getArg(n,"generatedColumn",null),lastColumn:i.getArg(n,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},t.BasicSourceMapConsumer=n})}),n.define("/node_modules/source-map/lib/source-map/binary-search.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e,t,r,i,o){var a=Math.floor((t-e)/2)+e,s=o(r,i[a],!0);return 0===s?a:s>0?t-a>1?n(a,t,r,i,o):a:a-e>1?n(e,a,r,i,o):e<0?-1:e}t.search=function(e,t,r){return 0===t.length?-1:n(-1,t.length,e,t,r)}})}),n.define("/node_modules/source-map/lib/source-map/indexed-source-map-consumer.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var r=i.getArg(t,"version"),n=i.getArg(t,"sections");if(r!=this._version)throw new Error("Unsupported version: "+r);var o={line:-1,column:0};this._sections=n.map(function(e){if(e.url)throw new Error("Support for url field in sections not implemented.");var t=i.getArg(e,"offset"),r=i.getArg(t,"line"),n=i.getArg(t,"column");if(r<o.line||r===o.line&&n<o.column)throw new Error("Section offsets must be ordered and non-overlapping.");return o=t,{generatedOffset:{generatedLine:r+1,generatedColumn:n+1},consumer:new a(i.getArg(e,"map"))}})}var i=e("/node_modules/source-map/lib/source-map/util.js",r),o=e("/node_modules/source-map/lib/source-map/binary-search.js",r),a=e("/node_modules/source-map/lib/source-map/source-map-consumer.js",r).SourceMapConsumer;e("/node_modules/source-map/lib/source-map/basic-source-map-consumer.js",r).BasicSourceMapConsumer;(n.prototype=Object.create(a.prototype)).constructor=a,n.prototype._version=3,Object.defineProperty(n.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var r=0;r<this._sections[t].consumer.sources.length;r++)e.push(this._sections[t].consumer.sources[r]);return e}}),n.prototype.originalPositionFor=function(e){var t={generatedLine:i.getArg(e,"line"),generatedColumn:i.getArg(e,"column")},r=o.search(t,this._sections,function(e,t){var r=e.generatedLine-t.generatedOffset.generatedLine;return r||e.generatedColumn-t.generatedOffset.generatedColumn}),n=this._sections[r];return n?n.consumer.originalPositionFor({line:t.generatedLine-(n.generatedOffset.generatedLine-1),column:t.generatedColumn-(n.generatedOffset.generatedLine===t.generatedLine?n.generatedOffset.generatedColumn-1:0)}):{source:null,line:null,column:null,name:null}},n.prototype.sourceContentFor=function(e,t){for(var r=0;r<this._sections.length;r++){var n=this._sections[r].consumer.sourceContentFor(e,!0);if(n)return n}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},n.prototype.generatedPositionFor=function(e){for(var t=0;t<this._sections.length;t++){var r=this._sections[t];if(-1!==r.consumer.sources.indexOf(i.getArg(e,"source"))){var n=r.consumer.generatedPositionFor(e);if(n)return{line:n.line+(r.generatedOffset.generatedLine-1),column:n.column+(r.generatedOffset.generatedLine===n.line?r.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},n.prototype._parseMappings=function(e,t){this.__generatedMappings=[],this.__originalMappings=[];for(var r=0;r<this._sections.length;r++)for(var n=this._sections[r],o=n.consumer._generatedMappings,a=0;a<o.length;a++){var s=o[r],u=s.source,c=n.consumer.sourceRoot;null!=u&&null!=c&&(u=i.join(c,u));var l={source:u,generatedLine:s.generatedLine+(n.generatedOffset.generatedLine-1),generatedColumn:s.column+(n.generatedOffset.generatedLine===s.generatedLine)?n.generatedOffset.generatedColumn-1:0,originalLine:s.originalLine,originalColumn:s.originalColumn,name:s.name};this.__generatedMappings.push(l),"number"==typeof l.originalLine&&this.__originalMappings.push(l)}this.__generatedMappings.sort(i.compareByGeneratedPositions),this.__originalMappings.sort(i.compareByOriginalPositions)},t.IndexedSourceMapConsumer=n})}),n.define("/node_modules/esutils/lib/utils.js",function(e,t,r,i){!function(){"use strict";t.ast=n("/node_modules/esutils/lib/ast.js",e),t.code=n("/node_modules/esutils/lib/code.js",e),t.keyword=n("/node_modules/esutils/lib/keyword.js",e)}()}),n.define("/node_modules/esutils/lib/keyword.js",function(e,t,r,i){!function(){"use strict";function t(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"let":return!0;default:return!1}}function r(e,t){return!(!t&&"yield"===e)&&i(e,t)}function i(e,r){if(r&&t(e))return!0;switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}}function o(e,t){return"null"===e||"true"===e||"false"===e||r(e,t)}function a(e,t){return"null"===e||"true"===e||"false"===e||i(e,t)}function s(e){var t,r,n;if(0===e.length)return!1;if(n=e.charCodeAt(0),!l.isIdentifierStartES5(n))return!1;for(t=1,r=e.length;t<r;++t)if(n=e.charCodeAt(t),!l.isIdentifierPartES5(n))return!1;return!0}function u(e,t){return 1024*(e-55296)+(t-56320)+65536}function c(e){var t,r,n,i,o;if(0===e.length)return!1;for(o=l.isIdentifierStartES6,t=0,r=e.length;t<r;++t){if(55296<=(n=e.charCodeAt(t))&&n<=56319){if(++t>=r)return!1;if(!(56320<=(i=e.charCodeAt(t))&&i<=57343))return!1;n=u(n,i)}if(!o(n))return!1;o=l.isIdentifierPartES6}return!0}var l=n("/node_modules/esutils/lib/code.js",e);e.exports={isKeywordES5:r,isKeywordES6:i,isReservedWordES5:o,isReservedWordES6:a,isRestrictedWord:function(e){return"eval"===e||"arguments"===e},isIdentifierNameES5:s,isIdentifierNameES6:c,isIdentifierES5:function(e,t){return s(e)&&!o(e,t)},isIdentifierES6:function(e,t){return c(e)&&!a(e,t)}}}()}),n.define("/node_modules/esutils/lib/code.js",function(e,t,r,n){!function(){"use strict";function t(e){return e<=65535?String.fromCharCode(e):String.fromCharCode(Math.floor((e-65536)/1024)+55296)+String.fromCharCode((e-65536)%1024+56320)}var r,n,i,o,a,s;for(n={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,NonAsciiIdentifierPart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/},r={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDE00-\uDE11\uDE13-\uDE2B\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDE00-\uDE2F\uDE44\uDE80-\uDEAA]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDD0-\uDDDA\uDE00-\uDE11\uDE13-\uDE37\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF01-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/},i=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279],o=new Array(128),s=0;s<128;++s)o[s]=s>=97&&s<=122||s>=65&&s<=90||36===s||95===s;for(a=new Array(128),s=0;s<128;++s)a[s]=s>=97&&s<=122||s>=65&&s<=90||s>=48&&s<=57||36===s||95===s;e.exports={isDecimalDigit:function(e){return 48<=e&&e<=57},isHexDigit:function(e){return 48<=e&&e<=57||97<=e&&e<=102||65<=e&&e<=70},isOctalDigit:function(e){return e>=48&&e<=55},isWhiteSpace:function(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&i.indexOf(e)>=0},isLineTerminator:function(e){return 10===e||13===e||8232===e||8233===e},isIdentifierStartES5:function(e){return e<128?o[e]:n.NonAsciiIdentifierStart.test(t(e))},isIdentifierPartES5:function(e){return e<128?a[e]:n.NonAsciiIdentifierPart.test(t(e))},isIdentifierStartES6:function(e){return e<128?o[e]:r.NonAsciiIdentifierStart.test(t(e))},isIdentifierPartES6:function(e){return e<128?a[e]:r.NonAsciiIdentifierPart.test(t(e))}}}()}),n.define("/node_modules/esutils/lib/ast.js",function(e,t,r,n){!function(){"use strict";function t(e){if(null==e)return!1;switch(e.type){case"BlockStatement":case"BreakStatement":case"ContinueStatement":case"DebuggerStatement":case"DoWhileStatement":case"EmptyStatement":case"ExpressionStatement":case"ForInStatement":case"ForStatement":case"IfStatement":case"LabeledStatement":case"ReturnStatement":case"SwitchStatement":case"ThrowStatement":case"TryStatement":case"VariableDeclaration":case"WhileStatement":case"WithStatement":return!0}return!1}function r(e){switch(e.type){case"IfStatement":return null!=e.alternate?e.alternate:e.consequent;case"LabeledStatement":case"ForStatement":case"ForInStatement":case"WhileStatement":case"WithStatement":return e.body}return null}e.exports={isExpression:function(e){if(null==e)return!1;switch(e.type){case"ArrayExpression":case"AssignmentExpression":case"BinaryExpression":case"CallExpression":case"ConditionalExpression":case"FunctionExpression":case"Identifier":case"Literal":case"LogicalExpression":case"MemberExpression":case"NewExpression":case"ObjectExpression":case"SequenceExpression":case"ThisExpression":case"UnaryExpression":case"UpdateExpression":return!0}return!1},isStatement:t,isIterationStatement:function(e){if(null==e)return!1;switch(e.type){case"DoWhileStatement":case"ForInStatement":case"ForStatement":case"WhileStatement":return!0}return!1},isSourceElement:function(e){return t(e)||null!=e&&"FunctionDeclaration"===e.type},isProblematicIfStatement:function(e){var t;if("IfStatement"!==e.type)return!1;if(null==e.alternate)return!1;t=e.consequent;do{if("IfStatement"===t.type&&null==t.alternate)return!0;t=r(t)}while(t);return!1},trailingStatement:r}}()}),n.define("/node_modules/estraverse/estraverse.js",function(t,r,n,i){!function(t,n){"use strict";"function"==typeof e&&e.amd?e(["exports"],n):n(void 0!==r?r:t.estraverse={})}(this,function e(t){"use strict";function r(){}function n(e){var t,r,i={};for(t in e)e.hasOwnProperty(t)&&(r=e[t],i[t]="object"==typeof r&&null!==r?n(r):r);return i}function i(e,t){var r,n,i,o;for(n=e.length,i=0;n;)t(e[o=i+(r=n>>>1)])?n=r:(i=o+1,n-=r+1);return i}function o(e,t){var r,n,i,o=g(t);for(n=0,i=o.length;n<i;n+=1)e[r=o[n]]=t[r];return e}function a(e,t){this.parent=e,this.key=t}function s(e,t,r,n){this.node=e,this.path=t,this.wrap=r,this.ref=n}function u(){}function c(e){return null!=e&&("object"==typeof e&&"string"==typeof e.type)}function l(e,t){return(e===h.ObjectExpression||e===h.ObjectPattern)&&"properties"===t}function f(e,t){return(new u).traverse(e,t)}function p(e,t){var r;return r=i(t,function(t){return t.range[0]>e.range[0]}),e.extendedRange=[e.range[0],e.range[1]],r!==t.length&&(e.extendedRange[1]=t[r].range[0]),(r-=1)>=0&&(e.extendedRange[0]=t[r].range[1]),e}var h,d,m,v,y,g,b,_,x;return(d=Array.isArray)||(d=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),r(),r(),y=Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}(),g=Object.keys||function(e){var t,r=[];for(t in e)r.push(t);return r},h={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportBatchSpecifier:"ExportBatchSpecifier",ExportDeclaration:"ExportDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",GeneratorExpression:"GeneratorExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MethodDefinition:"MethodDefinition",ModuleSpecifier:"ModuleSpecifier",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"},v={AssignmentExpression:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","defaults","rest","body"],AwaitExpression:["argument"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ClassBody:["body"],ClassDeclaration:["id","body","superClass"],ClassExpression:["id","body","superClass"],ComprehensionBlock:["left","right"],ComprehensionExpression:["blocks","filter","body"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExportBatchSpecifier:[],ExportDeclaration:["declaration","specifiers","source"],ExportSpecifier:["id","name"],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","defaults","rest","body"],FunctionExpression:["id","params","defaults","rest","body"],GeneratorExpression:["blocks","filter","body"],Identifier:[],IfStatement:["test","consequent","alternate"],ImportDeclaration:["specifiers","source"],ImportDefaultSpecifier:["id"],ImportNamespaceSpecifier:["id"],ImportSpecifier:["id","name"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MethodDefinition:["key","value"],ModuleSpecifier:[],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],Program:["body"],Property:["key","value"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SpreadElement:["argument"],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],TaggedTemplateExpression:["tag","quasi"],TemplateElement:[],TemplateLiteral:["quasis","expressions"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handlers","handler","guardedHandlers","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]},b={},_={},x={},m={Break:b,Skip:_,Remove:x},a.prototype.replace=function(e){this.parent[this.key]=e},a.prototype.remove=function(){return d(this.parent)?(this.parent.splice(this.key,1),!0):(this.replace(null),!1)},u.prototype.path=function(){function e(e,t){if(d(t))for(n=0,i=t.length;n<i;++n)e.push(t[n]);else e.push(t)}var t,r,n,i,o;if(!this.__current.path)return null;for(o=[],t=2,r=this.__leavelist.length;t<r;++t)e(o,this.__leavelist[t].path);return e(o,this.__current.path),o},u.prototype.type=function(){return this.current().type||this.__current.wrap},u.prototype.parents=function(){var e,t,r;for(r=[],e=1,t=this.__leavelist.length;e<t;++e)r.push(this.__leavelist[e].node);return r},u.prototype.current=function(){return this.__current.node},u.prototype.__execute=function(e,t){var r,n;return n=void 0,r=this.__current,this.__current=t,this.__state=null,e&&(n=e.call(this,t.node,this.__leavelist[this.__leavelist.length-1].node)),this.__current=r,n},u.prototype.notify=function(e){this.__state=e},u.prototype.skip=function(){this.notify(_)},u.prototype.break=function(){this.notify(b)},u.prototype.remove=function(){this.notify(x)},u.prototype.__initialize=function(e,t){this.visitor=t,this.root=e,this.__worklist=[],this.__leavelist=[],this.__current=null,this.__state=null,this.__fallback="iteration"===t.fallback,this.__keys=v,t.keys&&(this.__keys=o(y(this.__keys),t.keys))},u.prototype.traverse=function(e,t){var r,n,i,o,a,u,f,p,h,m,v,y;for(this.__initialize(e,t),y={},r=this.__worklist,n=this.__leavelist,r.push(new s(e,null,null,null)),n.push(new s(null,null,null,null));r.length;)if((i=r.pop())!==y){if(i.node){if(u=this.__execute(t.enter,i),this.__state===b||u===b)return;if(r.push(y),n.push(i),this.__state===_||u===_)continue;if(o=i.node,a=i.wrap||o.type,!(m=this.__keys[a])){if(!this.__fallback)throw new Error("Unknown node type "+a+".");m=g(o)}for(p=m.length;(p-=1)>=0;)if(f=m[p],v=o[f])if(d(v)){for(h=v.length;(h-=1)>=0;)if(v[h]){if(l(a,m[p]))i=new s(v[h],[f,h],"Property",null);else{if(!c(v[h]))continue;i=new s(v[h],[f,h],null,null)}r.push(i)}}else c(v)&&r.push(new s(v,f,null,null))}}else if(i=n.pop(),u=this.__execute(t.leave,i),this.__state===b||u===b)return},u.prototype.replace=function(e,t){function r(e){var t,r,i,o;if(e.ref.remove())for(r=e.ref.key,o=e.ref.parent,t=n.length;t--;)if((i=n[t]).ref&&i.ref.parent===o){if(i.ref.key<r)break;--i.ref.key}}var n,i,o,u,f,p,h,m,v,y,w,k,E;for(this.__initialize(e,t),w={},n=this.__worklist,i=this.__leavelist,p=new s(e,null,null,new a(k={root:e},"root")),n.push(p),i.push(p);n.length;)if((p=n.pop())!==w){if(void 0!==(f=this.__execute(t.enter,p))&&f!==b&&f!==_&&f!==x&&(p.ref.replace(f),p.node=f),this.__state!==x&&f!==x||(r(p),p.node=null),this.__state===b||f===b)return k.root;if((o=p.node)&&(n.push(w),i.push(p),this.__state!==_&&f!==_)){if(u=p.wrap||o.type,!(v=this.__keys[u])){if(!this.__fallback)throw new Error("Unknown node type "+u+".");v=g(o)}for(h=v.length;(h-=1)>=0;)if(E=v[h],y=o[E])if(d(y)){for(m=y.length;(m-=1)>=0;)if(y[m]){if(l(u,v[h]))p=new s(y[m],[E,m],"Property",new a(y,m));else{if(!c(y[m]))continue;p=new s(y[m],[E,m],null,new a(y,m))}n.push(p)}}else c(y)&&n.push(new s(y,E,null,new a(o,E)))}}else if(p=i.pop(),void 0!==(f=this.__execute(t.leave,p))&&f!==b&&f!==_&&f!==x&&p.ref.replace(f),this.__state!==x&&f!==x||r(p),this.__state===b||f===b)return k.root;return k.root},t.version="1.8.1-dev",t.Syntax=h,t.traverse=f,t.replace=function(e,t){return(new u).replace(e,t)},t.attachComments=function(e,t,r){var i,o,a,s,u=[];if(!e.range)throw new Error("attachComments needs range information");if(!r.length){if(t.length){for(a=0,o=t.length;a<o;a+=1)(i=n(t[a])).extendedRange=[0,e.range[0]],u.push(i);e.leadingComments=u}return e}for(a=0,o=t.length;a<o;a+=1)u.push(p(n(t[a]),r));return s=0,f(e,{enter:function(e){for(var t;s<u.length&&!((t=u[s]).extendedRange[1]>e.range[0]);)t.extendedRange[1]===e.range[0]?(e.leadingComments||(e.leadingComments=[]),e.leadingComments.push(t),u.splice(s,1)):s+=1;return s===u.length?m.Break:u[s].extendedRange[0]>e.range[1]?m.Skip:void 0}}),s=0,f(e,{leave:function(e){for(var t;s<u.length&&(t=u[s],!(e.range[1]<t.extendedRange[0]));)e.range[1]===t.extendedRange[0]?(e.trailingComments||(e.trailingComments=[]),e.trailingComments.push(t),u.splice(s,1)):s+=1;return s===u.length?m.Break:u[s].extendedRange[0]>e.range[1]?m.Skip:void 0}}),e},t.VisitorKeys=v,t.VisitorOption=m,t.Controller=u,t.cloneEnvironment=function(){return e({})},t})}),n("/tools/entry-point.js")}).call(t,t)}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this)}(),function(){this.lively=this.lively||{},function(e,t,r,n){"use strict";function i(){}function o(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={style:"  ",base:0,adjustMultilineComment:!1,optsIndent:r&&r.format&&r.format.indent||{}},i=r&&r.format||{},o=fe({indent:n,quotes:"double"},t.obj.dissoc(i,["indent"]));return r=fe({format:o,comment:!1},t.obj.dissoc(r,["format"])),xe.generate(e,r)}function a(e,r,n,i){var o=(i=i||{}).traversal||"preorder",a=t.obj.clone(i.visitors?i.visitors:we.make(we.visitors.withMemberExpression)),s="preorder"===o?function(e,t,i,o,a){return r(i,n,o,t),e(i,o+1,a)}:function(e,t,i,o,a){var s=e(i,o+1,a);return r(i,n,o,t),s};return Object.keys(a).forEach(function(e){var t=a[e];a[e]=function(r,n,i){return s(t,e,r,n,i)}}),we.recursive(e,0,null,a),e}function s(e,r,n,i){var o=[];return i=i||we.make(we.visitors.withMemberExpression),Object.keys(we.base).forEach(function(e){var r=i[e];i[e]=function(e,n,i){return t.arr.pushIfNotIncluded(o,e),r(e,n,i)}}),i.Property=function(e,r,n){t.arr.pushIfNotIncluded(o,e),n(e.key,r,"Expression"),n(e.value,r,"Expression")},i.LabeledStatement=function(e,t,r){e.label&&r(e.label,t,"Expression"),r(e.body,t,"Statement")},we.findNodeAround(e,r,n,i),o}function u(e){return je(e,{index:0},function(e,t,r){e(),t.astIndex=r.index++}),e}function c(e){if(Array.isArray(e.body))for(var t=e.body.length-1;t>=0;t--){var r=e.body[t];"BlockStatement"===r.type&&r[Ae]&&e.body.splice.apply(e.body,[t,1].concat(r.body))}return e}function l(e,t){return"string"==typeof e&&(t=e,e=h(e)),t&&Ee.run(e,function(e,r,n){return!e.source&&(e.source=t.slice(e.start,e.end))}),e}function f(e,t){return t="string"==typeof t?this.parse(t):t,s(t,e)}function p(e,t){(t=t||{}).ecmaVersion=t.ecmaVersion||8,t.sourceType=t.sourceType||"module",t.plugins=t.plugins||{},t.plugins.jsx=!t.plugins.hasOwnProperty("jsx")||t.plugins.jsx,t.plugins.asyncawait=t.plugins.hasOwnProperty("asyncawait")?t.plugins.asyncawait:{inAsyncFunction:!0},t.plugins.objectSpread=!t.plugins.hasOwnProperty("objectSpread")||t.plugins.objectSpread;var r,n,i;"LabeledStatement"===t.type&&(n="$={"+e+"}");try{r=h(n||e,t),n?r=null:t.addSource&&l(r,e)}catch(e){i=e}if(i&&void 0!==i.raisedAt){n&&(i.pos-=3,i.raisedAt-=3,i.loc.column-=3);var o="";o+=e.slice(i.raisedAt-20,i.raisedAt),o+="<-error->",o+=e.slice(i.raisedAt,i.raisedAt+20),t.verbose&&show("parse error: "+o),i.parseErrorSource=o}else i&&t.verbose&&show(""+i+i.stack);return r||(r=ke.parse_dammit(e,t),t.addSource&&l(r,e),r.isFuzzy=!0,r.parseError=i),r}function h(e,r){function n(e){return o.forEach(function(r){var n=t.arr.detect(f(r.start,a).reverse(),function(e){return"BlockStatement"===e.type||"Program"===e.type});n||(n=a),n.comments||(n.comments=[]),n.comments.push(r),e.nodesWithComments.push(n)}),e}function i(r){return r.nodesWithComments.forEach(function(n){t.arr.clone(n.comments).reduce(function(i,o){if(o.isBlock)return i.lastComment=null,i;if(!i.lastComment)return i.lastComment=o,i;var a=i.lastComment;if(t.arr.detect(n.body,function(e){return e.start>=a.end&&e.end<=o.start}))return i.lastComment=o,i;var s=e.slice(a.end,o.start);return/[\n\r][\n\r]+/.test(s)?(i.lastComment=o,i):(a.text+="\n"+o.text,a.end=o.end,t.arr.remove(n.comments,o),t.arr.remove(r.comments,o),i)},{lastComment:null})}),r}if(r=r||{},r.ecmaVersion=r.ecmaVersion||8,r.sourceType=r.sourceType||"module",r.hasOwnProperty("allowImportExportEverywhere")||(r.allowImportExportEverywhere=!0),r.plugins=r.plugins||{},r.plugins.jsx=!r.plugins.hasOwnProperty("jsx")||r.plugins.jsx,r.plugins.asyncawait=r.plugins.hasOwnProperty("asyncawait")?r.plugins.asyncawait:{inAsyncFunction:!0},r.plugins.objectSpread=!r.plugins.hasOwnProperty("objectSpread")||r.plugins.objectSpread,r.withComments){delete r.withComments;var o=[];r.onComment=function(e,t,r,n,i,a){o.push({isBlock:e,text:t,node:null,start:r,end:n,line:i,column:a})}}try{var a=acorn.parse(e,r)}catch(t){if("undefined"!=typeof SyntaxError&&t instanceof SyntaxError&&t.loc){var s=e.split("\n"),c=t.message,p=t.loc,h=p.line,d=p.column,m=t.pos,v=s[h-1],y="Syntax error at line "+h+" column "+d+" (index "+m+') "'+c+'"\nsource: '+v.slice(0,d)+"<--SyntaxError--\x3e"+v.slice(d),g=new SyntaxError(y);throw g.loc={line:h,column:d},g.pos=m,g}throw t}return r.addSource&&l(a,e),r.addAstIndex&&!a.hasOwnProperty("astIndex")&&u(a),a&&o&&function(e){e=i(n(e)),a.allComments=e.comments}({ast:a,comments:o,nodesWithComments:[]}),a}function d(e){return Pe.test(e)&&-1===e.indexOf("-")}function m(e){return"this"===e?{type:"ThisExpression"}:{name:String(e),type:"Identifier"}}function v(e){return{type:"Literal",value:e}}function y(e){return{type:"ExpressionStatement",expression:e}}function g(e){return{type:"ReturnStatement",argument:e}}function b(e){for(var t=arguments.length,r=Array(t>2?t-2:0),n=2;n<t;n++)r[n-2]=arguments[n];var i=e.arrow,o=e.id,a=e.expression,s=e.generator,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return u=u.map(function(e){return"string"==typeof e?m(e):e}),{type:(i?"Arrow":"")+"FunctionExpression",id:o?"string"==typeof o?m(o):o:void 0,params:u,body:a&&1===r.length?r[0]:{body:r,type:"BlockStatement"},expression:a||!1,generator:s||!1}}function _(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return"string"==typeof e&&(e=m(e)),{type:"CallExpression",callee:e,arguments:r}}function x(e,t,r){return"string"==typeof e&&(e={name:e,type:"Identifier"}),{type:"VariableDeclaration",kind:r||"var",declarations:[{type:"VariableDeclarator",id:e,init:t}]}}function w(e,t,r){return"string"==typeof e&&(e=m(e)),"string"==typeof t?(r||d(t)||(r=!0),t=r?v(t):m(t)):"number"==typeof t?(t=v(t),r=!0):"Literal"===t.type&&(r=!0),{type:"MemberExpression",computed:!!r,object:e,property:t}}function k(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return r.reduce(function(e,t){return w(e,t)},"object"===(void 0===e?"undefined":ue(e))?e:m(e))}function E(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return{body:Array.isArray(t[0])?t[0]:t,type:"BlockStatement"}}function S(){return Object.assign(E.apply(void 0,arguments),{sourceType:"module",type:"Program"})}function A(e,t,r){for(var n=arguments.length,i=Array(n>3?n-3:0),o=3;o<n;o++)i[o-3]=arguments[o];return Array.isArray(r)||(i.unshift(r),r=null),{block:E(i),finalizer:r?E(r):null,handler:{body:E(t),param:m(e),type:"CatchClause"},type:"TryStatement"}}function D(e,t){return{type:"Property",key:e,computed:"Identifier"!==e.type,shorthand:!1,value:t}}function C(e){var t=new _e,r=t.newScope(e,null);return t.accept(e,r,[]),r}function F(e,r){return t.tree.filter(C(e),function(e){var t=e.node,n=t.start,i=t.end;return"FunctionDeclaration"===t.type&&(n=t.params.length?t.params[0].start:t.body.start,i=t.body.end),n<=r&&r<=i},function(e){return e.subScopes})}function j(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];t&&e.node.id&&e.node.id.name&&r.push(e.node.id),Le.declIds(e.params,r);for(n=0;n<e.funcDecls.length;n++)(i=e.funcDecls[n].id)&&r.push(i);Le.varDeclIds(e,r),r.push.apply(r,ye(e.catches));for(var n=0;n<e.classDecls.length;n++){var i=e.classDecls[n].id;i&&r.push(i)}return r.push.apply(r,ye(e.importSpecifiers)),r}function T(e){var t=Le.declIds(e.params).concat(e.catches),r=(e.node.id&&e.node.id.name?[e.node]:[]).concat(e.funcDecls.filter(function(e){return e.id})).concat(e.classDecls.filter(function(e){return e.id}));return t.map(function(e){return[e,e]}).concat(r.map(function(e){return[e,e.id]})).concat(Le.varDecls(e)).concat(e.importSpecifiers.map(function(t){return[$(e.node,t),t]}))}function O(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=j(e,!0)[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;r.push(u.name)}}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return t&&R("Program"===e.node.type?e.node:e.node.body,r),r}function R(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e||!e.comments)return t;var r=!0,n=!1,i=void 0;try{for(var o,a=e.comments[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value.text.trim();if(s.startsWith("global")){var u=!0,c=!1,l=void 0;try{for(var f,p=s.replace(Me,"").split(",")[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var h=f.value;t.push(h.trim())}}catch(e){c=!0,l=e}finally{try{!u&&p.return&&p.return()}finally{if(c)throw l}}}}}catch(e){n=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return t}function B(e){return Se.run(e)}function P(e,t){if(0==t.length)return[null,null];var r=ve(t),n=r[0],i=r.slice(1),o=n.decls||T(n);return n.decls=o,o.find(function(t){var r=me(t,2);r[0];return r[1].name==e})||P(e,i)}function I(e){function t(e,n){var i=[e].concat(n);e.refs.forEach(function(e){var t=P(e.name,i),n=me(t,2),o=n[0],a=n[1];r.set(e,{decl:o,declId:a,ref:e})}),e.subScopes.forEach(function(e){return t(e,i)})}if(e.referencesResolvedSafely)return e;var r=e.resolvedRefMap||(e.resolvedRefMap=new Map);return t(e,[]),e.referencesResolvedSafely=!0,e}function L(e,r){function n(e){var t=O(e,o);return e.subScopes.map(n).reduce(function(e,t){return e.concat(t)},e.refs).filter(function(e){return-1===t.indexOf(e.name)})}(r=r||{}).withComments=!0,"string"==typeof e&&(e=h(e,r));var i=C(e),o=!!r.jslintGlobalComment,a=O(i,o),s=i.refs.concat(t.arr.flatten(i.subScopes.map(n))),u=t.arr.withoutAll(s.map(function(e){return e.name}),a);return{scope:i,varDecls:i.varDecls,funcDecls:i.funcDecls.filter(function(e){return e.id}),classDecls:i.classDecls.filter(function(e){return e.id}),declaredNames:a,undeclaredNames:u,refs:s,thisRefs:i.thisRefs}}function N(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e.params[Symbol.iterator]();!(n=(a=s.next()).done);n=!0)(C=a.value).name===t&&r.push(C)}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}var u=!0,c=!1,l=void 0;try{for(var f,p=e.funcDecls[Symbol.iterator]();!(u=(f=p.next()).done);u=!0)(C=f.value).id&&C.id.name===t&&r.push(C.id)}catch(e){c=!0,l=e}finally{try{!u&&p.return&&p.return()}finally{if(c)throw l}}var h=!0,d=!1,m=void 0;try{for(var v,y=e.classDecls[Symbol.iterator]();!(h=(v=y.next()).done);h=!0)(C=v.value).id&&C.id.name===t&&r.push(C.id)}catch(e){d=!0,m=e}finally{try{!h&&y.return&&y.return()}finally{if(d)throw m}}var g=!0,b=!1,_=void 0;try{for(var x,w=e.importSpecifiers[Symbol.iterator]();!(g=(x=w.next()).done);g=!0)(C=x.value).name===t&&r.push(C)}catch(e){b=!0,_=e}finally{try{!g&&w.return&&w.return()}finally{if(b)throw _}}var k=!0,E=!1,S=void 0;try{for(var A,D=Le.varDeclIds(e)[Symbol.iterator]();!(k=(A=D.next()).done);k=!0){var C=A.value;C.name===t&&r.push(C)}}catch(e){E=!0,S=e}finally{try{!k&&D.return&&D.return()}finally{if(E)throw S}}return r}function M(e,t){var r,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{refs:[],decls:[]};if("this"===t){var o;return(o=i.refs).push.apply(o,ye(e.thisRefs)),i}var a=N(e,t);if(!n&&a.length)return i;var s=!0,u=!1,c=void 0;try{for(var l,f=e.refs[Symbol.iterator]();!(s=(l=f.next()).done);s=!0){var p=l.value;p.name===t&&i.refs.push(p)}}catch(e){u=!0,c=e}finally{try{!s&&f.return&&f.return()}finally{if(u)throw c}}(r=i.decls).push.apply(r,ye(a));var h=!0,d=!1,m=void 0;try{for(var v,y=e.subScopes[Symbol.iterator]();!(h=(v=y.next()).done);h=!0)M(v.value,t,!1,i)}catch(e){d=!0,m=e}finally{try{!h&&y.return&&y.return()}finally{if(d)throw m}}return i}function q(e,t){return t="string"==typeof t?h(t):t,acorn.walk.findNodesIncluding(t,e)}function $(e,r,n){var o=q(r.start,e).reverse().find(function(e){return t.arr.include(qe,e.type)});if(n&&n.asPath){var a=new i,s=void 0;a.accept=t.fun.wrap(a.accept,function(e,t,r,n){if(t===o)throw s=n,new Error("stop search");return e(t,r,n)});try{a.accept(e,{},[])}catch(e){}return s}return o}function W(e){return e.source||o(e)}function U(e,r){var n=t.string.peekLeft(e,r,/\s+$/),i="number"==typeof n?e.slice(n,r):"";return"\n"===i[0]&&(i=i.slice(1)),i}function G(e,r){for(var n=0;n<e.length;n++){var i=e[n];if("del"===i.type)r=r.slice(0,i.pos)+r.slice(i.pos+i.length);else{if("add"!==i.type)throw new Error("Unexpected change "+t.obj.inspect(i));r=r.slice(0,i.pos)+i.string+r.slice(i.pos)}}return r}function z(e,t){if(e.start===t.start&&e.end===t.end)return 0;if(e.end<=t.start)return-1;if(e.start>=t.end)return 1;if(e.start<=t.start&&e.end>=t.end)return 1;if(t.start<=e.start&&t.end>=e.end)return-1;throw new Error("Comparing nodes")}function V(e,r,n){var i="object"===(void 0===n?"undefined":ue(n))?n:{changes:[],source:n},o=!1,a=i.changes.reduce(function(e,r){if(e.end<r.pos)return e;var n=r.pos<e.start;if(o=o||r.pos>=e.start&&r.pos<=e.end,"add"===r.type)return{start:n?e.start+r.string.length:e.start,end:e.end+r.string.length};if("del"===r.type)return{start:n?e.start-r.length:e.start,end:e.end-r.length};throw new Error("Cannot deal with change "+t.obj.inspect(r))},{start:e.start,end:e.end}),s=i.source,u=r(e,s.slice(a.start,a.end),o),c="string"==typeof u?u:Array.isArray(u)?u.map(W).join("\n"+U(s,a.start)):c=W(u),l=[{type:"del",pos:a.start,length:a.end-a.start},{type:"add",pos:a.start,string:c}];return{changes:i.changes.concat(l),source:G(l,s)}}function J(e,t){for(var r=e.sort(function(e,t){return z(e.target,t.target)}),n="object"===(void 0===t?"undefined":ue(t))?t:{changes:[],source:t},i=0;i<r.length;i++){var o=r[i];n=V(o.target,o.replacementFunc,n)}return n}function H(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];t.push.apply(t,ye(e.varDecls));var r=!0,n=!1,i=void 0;try{for(var o,a=e.subScopes[Symbol.iterator]();!(r=(o=a.next()).done);r=!0)H(o.value,t)}catch(e){n=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return t}function X(e,r){var n=h(e,r=r||{}),i=t.arr.last(n.body);return"ExpressionStatement"!==i.type?r.asAST?n:e:(n.body.splice(n.body.length-1,1,g(i.expression)),r.asAST?n:o(n))}function K(e,r){function n(e){return t.arr.detect(e.node.body,function(t){return t.start>e.comment.end})}function a(e){return{type:"unknown",comment:e.comment.text}}function s(e){var r=t.Path(e.path.slice(0,-1)).get(_);return r&&"FunctionDeclaration"===r.type}function u(e){var r=t.Path(e.path.slice(0,-1)).get(_);return{name:r.id?r.id.name:"<error: no name for function>",args:t.arr.pluck(r.params,"name")}}function c(e){return t.arr.equals(e.path.slice(-2),["value","body"])}function l(e){return t.arr.equals(e.path.slice(-2),["right","body"])}function f(e){for(var r=t.Path(e.path.slice(0,-2)).get(_),n=r.key?r.key.name:"<error: no name for method>",i=e.path.slice(),o="<error: no object found for method>";i.length&&"init"!==t.arr.last(i);)i.pop();if(i.length&&(o=t.Path(i.slice(0,-1).concat(["id","name"])).get(_)),t.string.startsWith(o,"<error")){for(i=e.path.slice();i.length&&"right"!==t.arr.last(i);)i.pop();if(i.length){var a=t.Path(i.slice(0,-1).concat(["left"])).get(_);o=x.slice(a.start,a.end)}}if(t.string.startsWith(o,"<error")){i=e.path.slice();var s=t.Path(i.slice(0,-6)).get(_),u=s&&"CallExpression"===s.type&&s.arguments[0];u&&(o=x.slice(u.start,u.end))}return{name:n,args:t.arr.pluck(r.value.params,"name"),objectName:o}}function p(e){var r=t.Path(e.path.slice(0,-1)).get(_);if("FunctionExpression"!==r.type&&"FunctionDeclaration"!==r.type)return{};var n=$(_,r);if("ExpressionStatement"!==n.type||"AssignmentExpression"!==n.expression.type)return{};var i=x.slice(n.expression.left.object.start,n.expression.left.object.end);return{name:x.slice(n.expression.left.property.start,n.expression.left.property.end),objectName:i,args:t.arr.pluck(r.params,"name")}}function d(e){var r=e.path.slice(-5);return t.arr.removeAt(r,1),t.arr.equals(r,["properties","value","callee","body"])}function m(e){var r,n,i;i=e.path.slice(0,-3);var o=t.Path(i).get(_);o&&"Property"===o.type&&(n=t.arr.pluck(o.value.callee.params,"name"),r=o.key?o.key.name:"<error: no name for method>"),r||(i=e.path.slice(0,-2),(o=t.Path(i).get(_))&&"Property"===o.type&&(n=t.arr.pluck(o.value.params,"name"),r=o.key?o.key.name:"<error: no name for method>")),r||(r="<error: no name for method>",n=[],i=e.path);for(var a=t.arr.clone(i),s="<error: no object found for method>";a.length&&"init"!==t.arr.last(a);)a.pop();if(a.length&&(s=t.Path(a.slice(0,-1).concat(["id","name"])).get(_)),t.string.startsWith(s,"<error")){for(a=t.arr.clone(i);a.length&&"right"!==t.arr.last(a);)a.pop();if(a.length){var u=t.Path(a.slice(0,-1).concat(["left"])).get(_);s=x.slice(u.start,u.end)}}if(t.string.startsWith(s,"<error")){var a=t.arr.clone(i),c=t.Path(a.slice(0,-4)).get(_),l=c&&"CallExpression"===c.type&&c.arguments[0];l&&(s=x.slice(l.start,l.end))}return{name:r,args:n,objectName:s}}function v(e){return y(e)&&("ObjectExpression"===e.declarations[0].init.type||b(e.declarations[0].init))}function y(e){return e&&"VariableDeclaration"===e.type&&1===e.declarations.length}function g(e){return{name:e.declarations[0].id.name}}function b(e){return"AssignmentExpression"===e.type&&("ObjectExpression"===e.right.type||"AssignmentExpression"===e.right.type&&b(e.right))}var _="string"==typeof e?h(e,{withComments:!0}):e,x=r||("string"==typeof e?e:o(e)),w=t.arr.sortBy(function(e){var r=[],n=new i;return n.accept=t.fun.wrap(n.accept,function(e,n,i,o){return n.comments&&t.arr.pushAll(r,n.comments.map(function(e){return{path:o,comment:e,node:n}})),e(n,i,o)}),n.accept(e,r,[]),r}(_),function(e){return e.comment.start});return w.map(function(e,r){if(c(e))return t.obj.merge([e,e.comment,{type:"method",comment:e.comment.text},f(e)]);if(d(e))return t.obj.merge([e,e.comment,{type:"method",comment:e.comment.text},m(e)]);if(s(e))return t.obj.merge([e,e.comment,{type:"function",comment:e.comment.text},u(e)]);if(l(e))return t.obj.merge([e,e.comment,{type:"method",comment:e.comment.text},p(e)]);var i=n(e);if(!i)return t.obj.merge([e,e.comment,{followingNode:i},a(e)]);var o=w[r+1];return o&&o.comment.start<=i.start?t.obj.merge([e,e.comment,{followingNode:i},a(e)]):v(i)?t.obj.merge([e,e.comment,{followingNode:i},{type:"object",comment:e.comment.text},g(i)]):y(i)?t.obj.merge([e,e.comment,{followingNode:i},{type:"var",comment:e.comment.text},g(i)]):t.obj.merge([e,e.comment,{followingNode:i},a(e)])})}function Q(e,r){r=r||t.obj.merge({hideOneLiners:!1},r),"string"==typeof e&&(e=h(e,{addSource:!0}));var n="Program"===e.type?e.body:e.body.body,i=[],o=(r.hideOneLiners&&e.source,!0),a=!1,s=void 0;try{for(var u,c=n[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var l=u.value,f=ne(l=ie(l),r)||ee(l)||te(l)||Y(l)||re(l);if(f){if(r.hideOneLiners)if(e.loc)f=f.filter(function(e){return!e.node.loc||e.node.loc.start.line!==e.node.loc.end.line});else if(e.source){var p=[],d=!0,m=!1,v=void 0;try{for(var y,g=f[Symbol.iterator]();!(d=(y=g.next()).done);d=!0){var b=y.value;(b.parent&&p.includes(b.parent)||(b.node.source||"").includes("\n"))&&p.push(b)}}catch(e){m=!0,v=e}finally{try{!d&&g.return&&g.return()}finally{if(m)throw v}}f=p}i.push.apply(i,ye(f))}}}catch(e){a=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(a)throw s}}return i}function Y(e){var t;if("ClassDeclaration"!==e.type)return null;var r={type:"class-decl",name:e.id.name,node:e,children:[]};return(t=r.children).push.apply(t,ye(e.body.body.map(function(e,t){return Z(e,r,t)}).filter(Boolean))),[r].concat(ye(r.children))}function Z(e,t,r){if("MethodDefinition"!==e.type)return null;var n;return"constructor"===e.kind?n="class-constructor":"method"===e.kind?n=e.static?"class-class-method":"class-instance-method":"get"===e.kind?n=e.static?"class-class-getter":"class-instance-getter":"set"===e.kind&&(n=e.static?"class-class-setter":"class-instance-setter"),n?{type:n,parent:t,node:e,name:e.key.name}:null}function ee(e){if("VariableDeclaration"!==e.type)return null;var t=[],r=!0,n=!1,i=void 0;try{for(var o,a=function(){var e=o.value,r=e.id,n=e.node,i={name:r.name,node:n,type:"var-decl"};if(t.push(i),!i.node.init)return"continue";for(var a=i.node.init;"AssignmentExpression"===a.type;)a=a.right;if("ObjectExpression"===a.type)return i.type="object-decl",i.children=oe(a).map(function(e){return fe({},e,{type:"object-"+e.type,parent:i})}),t.push.apply(t,ye(i.children)),"continue";(u=re(a,i))&&(i.children=u.map(function(e){return fe({},e,{parent:i})}),t.push.apply(t,ye(i.children)))},s=se(e)[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u;a()}}catch(e){n=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}return t}function te(e){return"FunctionStatement"!==e.type&&"FunctionDeclaration"!==e.type?null:[{name:e.id.name,node:e,type:"function-decl"}]}function re(e,t){if("ExpressionStatement"===e.type&&(e=e.expression),"CallExpression"!==e.type)return null;var r=e.arguments.find(function(e){return"ObjectExpression"===e.type});return r?oe(r,t):null}function ne(e,r){if(!ae(e))return null;var n,i=t.Path("expression.arguments.0").get(e);n=i&&"FunctionExpression"===i.type&&t.string.lines(i.source||"").length>5?Q(i,r):Q(t.Path("expression.callee").get(e),r);var o={node:e,name:t.Path("expression.callee.id.name").get(e)};return n.forEach(function(e){return e.parent||(e.parent=o)}),n}function ie(e){return"ExportNamedDeclaration"!==e.type&&"ExportDefaultDeclaration"!==e.type||!e.declaration?e:e.declaration}function oe(e,t){return e.properties.map(function(e){return{name:e.key.name||e.key.value,type:"FunctionExpression"===e.value.type?"method":"property",node:e,parent:t}})}function ae(e){return"CallExpression"===t.Path("expression.type").get(e)&&"FunctionExpression"===t.Path("expression.callee.type").get(e)}function se(e){return e.declarations.map(function(e){return!e.source&&e.init&&(e.source=e.id.name+" = "+e.init.source),{node:e,id:e.id}})}i.prototype.accept=function(e,t,r){if(!e)throw new Error("Undefined AST node in Visitor.accept:\n  "+r.join(".")+"\n  "+e);if(!e.type)throw new Error("Strangee AST node without type in Visitor.accept:\n  "+r.join(".")+"\n  "+JSON.stringify(e));switch(e.type){case"Node":return this.visitNode(e,t,r);case"SourceLocation":return this.visitSourceLocation(e,t,r);case"Position":return this.visitPosition(e,t,r);case"Program":return this.visitProgram(e,t,r);case"Function":return this.visitFunction(e,t,r);case"Statement":return this.visitStatement(e,t,r);case"Directive":return this.visitDirective(e,t,r);case"SwitchCase":return this.visitSwitchCase(e,t,r);case"CatchClause":return this.visitCatchClause(e,t,r);case"VariableDeclarator":return this.visitVariableDeclarator(e,t,r);case"Expression":return this.visitExpression(e,t,r);case"Property":return this.visitProperty(e,t,r);case"Pattern":return this.visitPattern(e,t,r);case"Super":return this.visitSuper(e,t,r);case"SpreadElement":return this.visitSpreadElement(e,t,r);case"TemplateElement":return this.visitTemplateElement(e,t,r);case"Class":return this.visitClass(e,t,r);case"ClassBody":return this.visitClassBody(e,t,r);case"MethodDefinition":return this.visitMethodDefinition(e,t,r);case"ModuleDeclaration":return this.visitModuleDeclaration(e,t,r);case"ModuleSpecifier":return this.visitModuleSpecifier(e,t,r);case"JSXEmptyExpression":return this.visitJSXEmptyExpression(e,t,r);case"JSXExpressionContainer":return this.visitJSXExpressionContainer(e,t,r);case"JSXSpreadChild":return this.visitJSXSpreadChild(e,t,r);case"JSXBoundaryElement":return this.visitJSXBoundaryElement(e,t,r);case"JSXAttribute":return this.visitJSXAttribute(e,t,r);case"JSXText":return this.visitJSXText(e,t,r);case"JSXOpeningFragment":return this.visitJSXOpeningFragment(e,t,r);case"JSXClosingFragment":return this.visitJSXClosingFragment(e,t,r);case"Identifier":return this.visitIdentifier(e,t,r);case"Literal":return this.visitLiteral(e,t,r);case"ExpressionStatement":return this.visitExpressionStatement(e,t,r);case"BlockStatement":return this.visitBlockStatement(e,t,r);case"EmptyStatement":return this.visitEmptyStatement(e,t,r);case"DebuggerStatement":return this.visitDebuggerStatement(e,t,r);case"WithStatement":return this.visitWithStatement(e,t,r);case"ReturnStatement":return this.visitReturnStatement(e,t,r);case"LabeledStatement":return this.visitLabeledStatement(e,t,r);case"BreakStatement":return this.visitBreakStatement(e,t,r);case"ContinueStatement":return this.visitContinueStatement(e,t,r);case"IfStatement":return this.visitIfStatement(e,t,r);case"SwitchStatement":return this.visitSwitchStatement(e,t,r);case"ThrowStatement":return this.visitThrowStatement(e,t,r);case"TryStatement":return this.visitTryStatement(e,t,r);case"WhileStatement":return this.visitWhileStatement(e,t,r);case"DoWhileStatement":return this.visitDoWhileStatement(e,t,r);case"ForStatement":return this.visitForStatement(e,t,r);case"ForInStatement":return this.visitForInStatement(e,t,r);case"Declaration":return this.visitDeclaration(e,t,r);case"ThisExpression":return this.visitThisExpression(e,t,r);case"ArrayExpression":return this.visitArrayExpression(e,t,r);case"ObjectExpression":return this.visitObjectExpression(e,t,r);case"FunctionExpression":return this.visitFunctionExpression(e,t,r);case"UnaryExpression":return this.visitUnaryExpression(e,t,r);case"UpdateExpression":return this.visitUpdateExpression(e,t,r);case"BinaryExpression":return this.visitBinaryExpression(e,t,r);case"AssignmentExpression":return this.visitAssignmentExpression(e,t,r);case"LogicalExpression":return this.visitLogicalExpression(e,t,r);case"MemberExpression":return this.visitMemberExpression(e,t,r);case"ConditionalExpression":return this.visitConditionalExpression(e,t,r);case"CallExpression":return this.visitCallExpression(e,t,r);case"NewExpression":return this.visitNewExpression(e,t,r);case"SequenceExpression":return this.visitSequenceExpression(e,t,r);case"ArrowFunctionExpression":return this.visitArrowFunctionExpression(e,t,r);case"YieldExpression":return this.visitYieldExpression(e,t,r);case"TemplateLiteral":return this.visitTemplateLiteral(e,t,r);case"TaggedTemplateExpression":return this.visitTaggedTemplateExpression(e,t,r);case"AssignmentProperty":return this.visitAssignmentProperty(e,t,r);case"ObjectPattern":return this.visitObjectPattern(e,t,r);case"ArrayPattern":return this.visitArrayPattern(e,t,r);case"RestElement":return this.visitRestElement(e,t,r);case"AssignmentPattern":return this.visitAssignmentPattern(e,t,r);case"ClassExpression":return this.visitClassExpression(e,t,r);case"MetaProperty":return this.visitMetaProperty(e,t,r);case"ImportDeclaration":return this.visitImportDeclaration(e,t,r);case"ImportSpecifier":return this.visitImportSpecifier(e,t,r);case"ImportDefaultSpecifier":return this.visitImportDefaultSpecifier(e,t,r);case"ImportNamespaceSpecifier":return this.visitImportNamespaceSpecifier(e,t,r);case"ExportNamedDeclaration":return this.visitExportNamedDeclaration(e,t,r);case"ExportSpecifier":return this.visitExportSpecifier(e,t,r);case"ExportDefaultDeclaration":return this.visitExportDefaultDeclaration(e,t,r);case"ExportAllDeclaration":return this.visitExportAllDeclaration(e,t,r);case"AwaitExpression":return this.visitAwaitExpression(e,t,r);case"JSXMemberExpression":return this.visitJSXMemberExpression(e,t,r);case"JSXNamespacedName":return this.visitJSXNamespacedName(e,t,r);case"JSXOpeningElement":return this.visitJSXOpeningElement(e,t,r);case"JSXClosingElement":return this.visitJSXClosingElement(e,t,r);case"JSXSpreadAttribute":return this.visitJSXSpreadAttribute(e,t,r);case"JSXElement":return this.visitJSXElement(e,t,r);case"JSXFragment":return this.visitJSXFragment(e,t,r);case"RegExpLiteral":return this.visitRegExpLiteral(e,t,r);case"FunctionBody":return this.visitFunctionBody(e,t,r);case"FunctionDeclaration":return this.visitFunctionDeclaration(e,t,r);case"VariableDeclaration":return this.visitVariableDeclaration(e,t,r);case"ForOfStatement":return this.visitForOfStatement(e,t,r);case"ClassDeclaration":return this.visitClassDeclaration(e,t,r);case"JSXIdentifier":return this.visitJSXIdentifier(e,t,r)}throw new Error("No visit function in AST visitor Visitor for:\n  "+r.join(".")+"\n  "+JSON.stringify(e))},i.prototype.visitNode=function(e,t,r){return e},i.prototype.visitSourceLocation=function(e,t,r){var n=this;return e.start=n.accept(e.start,t,r.concat(["start"])),e.end=n.accept(e.end,t,r.concat(["end"])),e},i.prototype.visitPosition=function(e,t,r){return e},i.prototype.visitProgram=function(e,t,r){for(var n=this,i=[],o=0;o<e.body.length;o++){var a=e.body[o],s=a?n.accept(a,t,r.concat(["body",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.body=i,e},i.prototype.visitFunction=function(e,t,r){var n=this;e.id&&(e.id=n.accept(e.id,t,r.concat(["id"])));for(var i=[],o=0;o<e.params.length;o++){var a=e.params[o],s=a?n.accept(a,t,r.concat(["params",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.params=i,e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitStatement=function(e,t,r){return e},i.prototype.visitDirective=function(e,t,r){var n=this;return e.expression=n.accept(e.expression,t,r.concat(["expression"])),e},i.prototype.visitSwitchCase=function(e,t,r){var n=this;e.test&&(e.test=n.accept(e.test,t,r.concat(["test"])));for(var i=[],o=0;o<e.consequent.length;o++){var a=e.consequent[o],s=a?n.accept(a,t,r.concat(["consequent",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.consequent=i,e},i.prototype.visitCatchClause=function(e,t,r){var n=this;return e.param=n.accept(e.param,t,r.concat(["param"])),e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitVariableDeclarator=function(e,t,r){var n=this;return e.id=n.accept(e.id,t,r.concat(["id"])),e.init&&(e.init=n.accept(e.init,t,r.concat(["init"]))),e},i.prototype.visitExpression=function(e,t,r){return e},i.prototype.visitProperty=function(e,t,r){var n=this;return e.key=n.accept(e.key,t,r.concat(["key"])),e.value=n.accept(e.value,t,r.concat(["value"])),e},i.prototype.visitPattern=function(e,t,r){return e},i.prototype.visitSuper=function(e,t,r){return e},i.prototype.visitSpreadElement=function(e,t,r){var n=this;return e.argument=n.accept(e.argument,t,r.concat(["argument"])),e},i.prototype.visitTemplateElement=function(e,t,r){return e},i.prototype.visitClass=function(e,t,r){var n=this;return e.id&&(e.id=n.accept(e.id,t,r.concat(["id"]))),e.superClass&&(e.superClass=n.accept(e.superClass,t,r.concat(["superClass"]))),e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitClassBody=function(e,t,r){for(var n=this,i=[],o=0;o<e.body.length;o++){var a=e.body[o],s=a?n.accept(a,t,r.concat(["body",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.body=i,e},i.prototype.visitMethodDefinition=function(e,t,r){var n=this;return e.key=n.accept(e.key,t,r.concat(["key"])),e.value=n.accept(e.value,t,r.concat(["value"])),e},i.prototype.visitModuleDeclaration=function(e,t,r){return e},i.prototype.visitModuleSpecifier=function(e,t,r){var n=this;return e.local=n.accept(e.local,t,r.concat(["local"])),e},i.prototype.visitJSXEmptyExpression=function(e,t,r){return e},i.prototype.visitJSXExpressionContainer=function(e,t,r){var n=this;return e.expression=n.accept(e.expression,t,r.concat(["expression"])),e},i.prototype.visitJSXSpreadChild=function(e,t,r){var n=this;return e.expression=n.accept(e.expression,t,r.concat(["expression"])),e},i.prototype.visitJSXBoundaryElement=function(e,t,r){var n=this;return e.name=n.accept(e.name,t,r.concat(["name"])),e},i.prototype.visitJSXAttribute=function(e,t,r){var n=this;return e.name=n.accept(e.name,t,r.concat(["name"])),e.value&&(e.value=n.accept(e.value,t,r.concat(["value"]))),e},i.prototype.visitJSXText=function(e,t,r){return e},i.prototype.visitJSXOpeningFragment=function(e,t,r){return e},i.prototype.visitJSXClosingFragment=function(e,t,r){return e},i.prototype.visitIdentifier=function(e,t,r){return e},i.prototype.visitLiteral=function(e,t,r){return e},i.prototype.visitExpressionStatement=function(e,t,r){var n=this;return e.expression=n.accept(e.expression,t,r.concat(["expression"])),e},i.prototype.visitBlockStatement=function(e,t,r){for(var n=this,i=[],o=0;o<e.body.length;o++){var a=e.body[o],s=a?n.accept(a,t,r.concat(["body",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.body=i,e},i.prototype.visitEmptyStatement=function(e,t,r){return e},i.prototype.visitDebuggerStatement=function(e,t,r){return e},i.prototype.visitWithStatement=function(e,t,r){var n=this;return e.object=n.accept(e.object,t,r.concat(["object"])),e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitReturnStatement=function(e,t,r){var n=this;return e.argument&&(e.argument=n.accept(e.argument,t,r.concat(["argument"]))),e},i.prototype.visitLabeledStatement=function(e,t,r){var n=this;return e.label=n.accept(e.label,t,r.concat(["label"])),e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitBreakStatement=function(e,t,r){var n=this;return e.label&&(e.label=n.accept(e.label,t,r.concat(["label"]))),e},i.prototype.visitContinueStatement=function(e,t,r){var n=this;return e.label&&(e.label=n.accept(e.label,t,r.concat(["label"]))),e},i.prototype.visitIfStatement=function(e,t,r){var n=this;return e.test=n.accept(e.test,t,r.concat(["test"])),e.consequent=n.accept(e.consequent,t,r.concat(["consequent"])),e.alternate&&(e.alternate=n.accept(e.alternate,t,r.concat(["alternate"]))),e},i.prototype.visitSwitchStatement=function(e,t,r){var n=this;e.discriminant=n.accept(e.discriminant,t,r.concat(["discriminant"]));for(var i=[],o=0;o<e.cases.length;o++){var a=e.cases[o],s=a?n.accept(a,t,r.concat(["cases",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.cases=i,e},i.prototype.visitThrowStatement=function(e,t,r){var n=this;return e.argument=n.accept(e.argument,t,r.concat(["argument"])),e},i.prototype.visitTryStatement=function(e,t,r){var n=this;return e.block=n.accept(e.block,t,r.concat(["block"])),e.handler&&(e.handler=n.accept(e.handler,t,r.concat(["handler"]))),e.finalizer&&(e.finalizer=n.accept(e.finalizer,t,r.concat(["finalizer"]))),e},i.prototype.visitWhileStatement=function(e,t,r){var n=this;return e.test=n.accept(e.test,t,r.concat(["test"])),e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitDoWhileStatement=function(e,t,r){var n=this;return e.body=n.accept(e.body,t,r.concat(["body"])),e.test=n.accept(e.test,t,r.concat(["test"])),e},i.prototype.visitForStatement=function(e,t,r){var n=this;return e.init&&(e.init=n.accept(e.init,t,r.concat(["init"]))),e.test&&(e.test=n.accept(e.test,t,r.concat(["test"]))),e.update&&(e.update=n.accept(e.update,t,r.concat(["update"]))),e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitForInStatement=function(e,t,r){var n=this;return e.left=n.accept(e.left,t,r.concat(["left"])),e.right=n.accept(e.right,t,r.concat(["right"])),e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitDeclaration=function(e,t,r){return e},i.prototype.visitThisExpression=function(e,t,r){return e},i.prototype.visitArrayExpression=function(e,t,r){var n=this;if(e.elements){for(var i=[],o=0;o<e.elements.length;o++){var a=e.elements[o],s=a?n.accept(a,t,r.concat(["elements",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}e.elements=i}return e},i.prototype.visitObjectExpression=function(e,t,r){for(var n=this,i=[],o=0;o<e.properties.length;o++){var a=e.properties[o],s=a?n.accept(a,t,r.concat(["properties",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.properties=i,e},i.prototype.visitFunctionExpression=function(e,t,r){var n=this;e.id&&(e.id=n.accept(e.id,t,r.concat(["id"])));for(var i=[],o=0;o<e.params.length;o++){var a=e.params[o],s=a?n.accept(a,t,r.concat(["params",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.params=i,e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitUnaryExpression=function(e,t,r){var n=this;return e.argument=n.accept(e.argument,t,r.concat(["argument"])),e},i.prototype.visitUpdateExpression=function(e,t,r){var n=this;return e.argument=n.accept(e.argument,t,r.concat(["argument"])),e},i.prototype.visitBinaryExpression=function(e,t,r){var n=this;return e.left=n.accept(e.left,t,r.concat(["left"])),e.right=n.accept(e.right,t,r.concat(["right"])),e},i.prototype.visitAssignmentExpression=function(e,t,r){var n=this;return e.left=n.accept(e.left,t,r.concat(["left"])),e.right=n.accept(e.right,t,r.concat(["right"])),e},i.prototype.visitLogicalExpression=function(e,t,r){var n=this;return e.left=n.accept(e.left,t,r.concat(["left"])),e.right=n.accept(e.right,t,r.concat(["right"])),e},i.prototype.visitMemberExpression=function(e,t,r){var n=this;return e.object=n.accept(e.object,t,r.concat(["object"])),e.property=n.accept(e.property,t,r.concat(["property"])),e},i.prototype.visitConditionalExpression=function(e,t,r){var n=this;return e.test=n.accept(e.test,t,r.concat(["test"])),e.alternate=n.accept(e.alternate,t,r.concat(["alternate"])),e.consequent=n.accept(e.consequent,t,r.concat(["consequent"])),e},i.prototype.visitCallExpression=function(e,t,r){var n=this;e.callee=n.accept(e.callee,t,r.concat(["callee"]));for(var i=[],o=0;o<e.arguments.length;o++){var a=e.arguments[o],s=a?n.accept(a,t,r.concat(["arguments",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.arguments=i,e},i.prototype.visitNewExpression=function(e,t,r){var n=this;e.callee=n.accept(e.callee,t,r.concat(["callee"]));for(var i=[],o=0;o<e.arguments.length;o++){var a=e.arguments[o],s=a?n.accept(a,t,r.concat(["arguments",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.arguments=i,e},i.prototype.visitSequenceExpression=function(e,t,r){for(var n=this,i=[],o=0;o<e.expressions.length;o++){var a=e.expressions[o],s=a?n.accept(a,t,r.concat(["expressions",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.expressions=i,e},i.prototype.visitArrowFunctionExpression=function(e,t,r){var n=this;e.body=n.accept(e.body,t,r.concat(["body"])),e.id&&(e.id=n.accept(e.id,t,r.concat(["id"])));for(var i=[],o=0;o<e.params.length;o++){var a=e.params[o],s=a?n.accept(a,t,r.concat(["params",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.params=i,e},i.prototype.visitYieldExpression=function(e,t,r){var n=this;return e.argument&&(e.argument=n.accept(e.argument,t,r.concat(["argument"]))),e},i.prototype.visitTemplateLiteral=function(e,t,r){for(var n=this,i=[],o=0;o<e.quasis.length;o++){s=(a=e.quasis[o])?n.accept(a,t,r.concat(["quasis",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}e.quasis=i;for(var i=[],o=0;o<e.expressions.length;o++){var a=e.expressions[o],s=a?n.accept(a,t,r.concat(["expressions",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.expressions=i,e},i.prototype.visitTaggedTemplateExpression=function(e,t,r){var n=this;return e.tag=n.accept(e.tag,t,r.concat(["tag"])),e.quasi=n.accept(e.quasi,t,r.concat(["quasi"])),e},i.prototype.visitAssignmentProperty=function(e,t,r){var n=this;return e.value=n.accept(e.value,t,r.concat(["value"])),e.key=n.accept(e.key,t,r.concat(["key"])),e},i.prototype.visitObjectPattern=function(e,t,r){for(var n=this,i=[],o=0;o<e.properties.length;o++){var a=e.properties[o],s=a?n.accept(a,t,r.concat(["properties",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.properties=i,e},i.prototype.visitArrayPattern=function(e,t,r){var n=this;if(e.elements){for(var i=[],o=0;o<e.elements.length;o++){var a=e.elements[o],s=a?n.accept(a,t,r.concat(["elements",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}e.elements=i}return e},i.prototype.visitRestElement=function(e,t,r){var n=this;return e.argument=n.accept(e.argument,t,r.concat(["argument"])),e},i.prototype.visitAssignmentPattern=function(e,t,r){var n=this;return e.left=n.accept(e.left,t,r.concat(["left"])),e.right=n.accept(e.right,t,r.concat(["right"])),e},i.prototype.visitClassExpression=function(e,t,r){var n=this;return e.id&&(e.id=n.accept(e.id,t,r.concat(["id"]))),e.superClass&&(e.superClass=n.accept(e.superClass,t,r.concat(["superClass"]))),e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitMetaProperty=function(e,t,r){var n=this;return e.meta=n.accept(e.meta,t,r.concat(["meta"])),e.property=n.accept(e.property,t,r.concat(["property"])),e},i.prototype.visitImportDeclaration=function(e,t,r){for(var n=this,i=[],o=0;o<e.specifiers.length;o++){var a=e.specifiers[o],s=a?n.accept(a,t,r.concat(["specifiers",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.specifiers=i,e.source=n.accept(e.source,t,r.concat(["source"])),e},i.prototype.visitImportSpecifier=function(e,t,r){var n=this;return e.imported=n.accept(e.imported,t,r.concat(["imported"])),e.local=n.accept(e.local,t,r.concat(["local"])),e},i.prototype.visitImportDefaultSpecifier=function(e,t,r){var n=this;return e.local=n.accept(e.local,t,r.concat(["local"])),e},i.prototype.visitImportNamespaceSpecifier=function(e,t,r){var n=this;return e.local=n.accept(e.local,t,r.concat(["local"])),e},i.prototype.visitExportNamedDeclaration=function(e,t,r){var n=this;e.declaration&&(e.declaration=n.accept(e.declaration,t,r.concat(["declaration"])));for(var i=[],o=0;o<e.specifiers.length;o++){var a=e.specifiers[o],s=a?n.accept(a,t,r.concat(["specifiers",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.specifiers=i,e.source&&(e.source=n.accept(e.source,t,r.concat(["source"]))),e},i.prototype.visitExportSpecifier=function(e,t,r){var n=this;return e.exported=n.accept(e.exported,t,r.concat(["exported"])),e.local=n.accept(e.local,t,r.concat(["local"])),e},i.prototype.visitExportDefaultDeclaration=function(e,t,r){var n=this;return e.declaration=n.accept(e.declaration,t,r.concat(["declaration"])),e},i.prototype.visitExportAllDeclaration=function(e,t,r){var n=this;return e.source=n.accept(e.source,t,r.concat(["source"])),e},i.prototype.visitAwaitExpression=function(e,t,r){var n=this;return e.argument=n.accept(e.argument,t,r.concat(["argument"])),e},i.prototype.visitJSXMemberExpression=function(e,t,r){var n=this;return e.object=n.accept(e.object,t,r.concat(["object"])),e.property=n.accept(e.property,t,r.concat(["property"])),e},i.prototype.visitJSXNamespacedName=function(e,t,r){var n=this;return e.namespace=n.accept(e.namespace,t,r.concat(["namespace"])),e.name=n.accept(e.name,t,r.concat(["name"])),e},i.prototype.visitJSXOpeningElement=function(e,t,r){for(var n=this,i=[],o=0;o<e.attributes.length;o++){var a=e.attributes[o],s=a?n.accept(a,t,r.concat(["attributes",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.attributes=i,e.name=n.accept(e.name,t,r.concat(["name"])),e},i.prototype.visitJSXClosingElement=function(e,t,r){var n=this;return e.name=n.accept(e.name,t,r.concat(["name"])),e},i.prototype.visitJSXSpreadAttribute=function(e,t,r){var n=this;return e.argument=n.accept(e.argument,t,r.concat(["argument"])),e},i.prototype.visitJSXElement=function(e,t,r){var n=this;e.openingElement=n.accept(e.openingElement,t,r.concat(["openingElement"]));for(var i=[],o=0;o<e.children.length;o++){var a=e.children[o],s=a?n.accept(a,t,r.concat(["children",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.children=i,e.closingElement&&(e.closingElement=n.accept(e.closingElement,t,r.concat(["closingElement"]))),e},i.prototype.visitJSXFragment=function(e,t,r){var n=this;e.openingFragment=n.accept(e.openingFragment,t,r.concat(["openingFragment"]));for(var i=[],o=0;o<e.children.length;o++){var a=e.children[o],s=a?n.accept(a,t,r.concat(["children",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.children=i,e.closingFragment=n.accept(e.closingFragment,t,r.concat(["closingFragment"])),e},i.prototype.visitRegExpLiteral=function(e,t,r){return e},i.prototype.visitFunctionBody=function(e,t,r){for(var n=this,i=[],o=0;o<e.body.length;o++){var a=e.body[o],s=a?n.accept(a,t,r.concat(["body",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.body=i,e},i.prototype.visitFunctionDeclaration=function(e,t,r){var n=this;e.id&&(e.id=n.accept(e.id,t,r.concat(["id"])));for(var i=[],o=0;o<e.params.length;o++){var a=e.params[o],s=a?n.accept(a,t,r.concat(["params",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.params=i,e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitVariableDeclaration=function(e,t,r){for(var n=this,i=[],o=0;o<e.declarations.length;o++){var a=e.declarations[o],s=a?n.accept(a,t,r.concat(["declarations",o])):a;Array.isArray(s)?i.push.apply(i,s):i.push(s)}return e.declarations=i,e},i.prototype.visitForOfStatement=function(e,t,r){var n=this;return e.left=n.accept(e.left,t,r.concat(["left"])),e.right=n.accept(e.right,t,r.concat(["right"])),e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitClassDeclaration=function(e,t,r){var n=this;return e.id&&(e.id=n.accept(e.id,t,r.concat(["id"]))),e.superClass&&(e.superClass=n.accept(e.superClass,t,r.concat(["superClass"]))),e.body=n.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitJSXIdentifier=function(e,t,r){return e};var ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ce=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},le=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),fe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},pe=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},he=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},de=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},me=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),ve=function(e){return Array.isArray(e)?e:Array.from(e)},ye=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},ge=function(e){function t(){return ce(this,t),de(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return he(t,i),le(t,[{key:"accept",value:function(e,r,n){var i=n.map(function(e){return"string"==typeof e?"."+e:"["+e+"]"}).join(""),o=[],a=pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,{index:r.index,tree:o},n);return r.tree.push({node:e,path:i,index:r.index++,children:o}),a}}]),t}(),be=function(e){function t(){return ce(this,t),de(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return he(t,i),le(t,[{key:"recordNotEqual",value:function(e,t,r,n){r.comparisons.errors.push({node1:e,node2:t,path:r.completePath,msg:n})}},{key:"compareType",value:function(e,t,r){return this.compareField("type",e,t,r)}},{key:"compareField",value:function(e,t,r,n){if(r=lively.lang.Path(n.completePath.join(".")).get(r),t&&r&&t[e]===r[e])return!0;if(t&&"*"===t[e]||r&&"*"===r[e])return!0;var i,o=n.completePath.join(".")+"."+e;return i=t?r?o+" is not equal: "+t[e]+" vs. "+r[e]:"node2 not defined but node1 ("+o+") is: "+t[e]:"node1 on "+o+" not defined",this.recordNotEqual(t,r,n,i),!1}},{key:"accept",value:function(e,t,r,n){var i=lively.lang.Path(n.join(".")).get(t);if("*"!==e&&"*"!==i){var o={completePath:n,comparisons:r.comparisons};this.compareType(e,t,o)&&this["visit"+e.type](e,t,o,n)}}},{key:"visitFunction",value:function(e,r,n,i){return e.generator&&this.compareField("generator",e,r,n),e.expression&&this.compareField("expression",e,r,n),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitFunction",this).call(this,e,r,n,i)}},{key:"visitSwitchStatement",value:function(e,r,n,i){return e.lexical&&this.compareField("lexical",e,r,n),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitSwitchStatement",this).call(this,e,r,n,i)}},{key:"visitForInStatement",value:function(e,r,n,i){return e.each&&this.compareField("each",e,r,n),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitForInStatement",this).call(this,e,r,n,i)}},{key:"visitFunctionDeclaration",value:function(e,r,n,i){return e.generator&&this.compareField("generator",e,r,n),e.expression&&this.compareField("expression",e,r,n),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitFunctionDeclaration",this).call(this,e,r,n,i)}},{key:"visitVariableDeclaration",value:function(e,r,n,i){return this.compareField("kind",e,r,n),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitVariableDeclaration",this).call(this,e,r,n,i)}},{key:"visitUnaryExpression",value:function(e,r,n,i){return this.compareField("operator",e,r,n),e.prefix&&this.compareField("prefix",e,r,n),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitUnaryExpression",this).call(this,e,r,n,i)}},{key:"visitBinaryExpression",value:function(e,r,n,i){return this.compareField("operator",e,r,n),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitBinaryExpression",this).call(this,e,r,n,i)}},{key:"visitAssignmentExpression",value:function(e,r,n,i){return this.compareField("operator",e,r,n),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitAssignmentExpression",this).call(this,e,r,n,i)}},{key:"visitUpdateExpression",value:function(e,r,n,i){return this.compareField("operator",e,r,n),e.prefix&&this.compareField("prefix",e,r,n),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitUpdateExpression",this).call(this,e,r,n,i)}},{key:"visitLogicalExpression",value:function(e,r,n,i){return this.compareField("operator",e,r,n),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitLogicalExpression",this).call(this,e,r,n,i)}},{key:"visitMemberExpression",value:function(e,r,n,i){return e.computed&&this.compareField("computed",e,r,n),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitMemberExpression",this).call(this,e,r,n,i)}},{key:"visitComprehensionBlock",value:function(e,r,n,i){return e.each&&this.compareField("each",e,r,n),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitComprehensionBlock",this).call(this,e,r,n,i)}},{key:"visitIdentifier",value:function(e,r,n,i){return this.compareField("name",e,r,n),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitIdentifier",this).call(this,e,r,n,i)}},{key:"visitLiteral",value:function(e,r,n,i){return this.compareField("value",e,r,n),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitLiteral",this).call(this,e,r,n,i)}},{key:"visitClassDeclaration",value:function(e,r,n,i){return this.compareField("id",e,r,n),e.superClass&&this.compareField("superClass",e,r,n),this.compareField("body",e,r,n),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitClassDeclaration",this).call(this,e,r,n,i)}},{key:"visitClassBody",value:function(e,r,n,i){return this.compareField("body",e,r,n),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitClassBody",this).call(this,e,r,n,i)}},{key:"visitMethodDefinition",value:function(e,r,n,i){return this.compareField("static",e,r,n),this.compareField("computed",e,r,n),this.compareField("kind",e,r,n),this.compareField("key",e,r,n),this.compareField("value",e,r,n),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitMethodDefinition",this).call(this,e,r,n,i)}}]),t}(),_e=function(e){function t(){return ce(this,t),de(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return he(t,i),le(t,[{key:"newScope",value:function(e,t){var r={node:e,varDecls:[],varDeclPaths:[],funcDecls:[],funcDeclPaths:[],classDecls:[],classDeclPaths:[],classExprs:[],classExprPaths:[],methodDecls:[],methodDeclPaths:[],importSpecifiers:[],importSpecifierPaths:[],exportDecls:[],exportDeclPaths:[],refs:[],thisRefs:[],params:[],catches:[],subScopes:[],resolvedRefMap:new Map};return t&&t.subScopes.push(r),r}},{key:"visitVariableDeclaration",value:function(e,r,n){return r.varDecls.push(e),r.varDeclPaths.push(n),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitVariableDeclaration",this).call(this,e,r,n)}},{key:"visitVariableDeclarator",value:function(e,t,r){var n=this;return e.init&&(e.init=n.accept(e.init,t,r.concat(["init"]))),e}},{key:"visitFunction",value:function(e,t,r){var n=this,i=this.newScope(e,t);return e.params.forEach(function(e,t){"AssignmentPattern"===e.type&&n.accept(e.right,i,r.concat("params",t,"right"))}),i.params=Array.prototype.slice.call(e.params),i}},{key:"visitFunctionDeclaration",value:function(e,t,r){var n=this.visitFunction(e,t,r);t.funcDecls.push(e),t.funcDeclPaths.push(r);var i=this;return e.defaults&&(e.defaults=e.defaults.reduce(function(e,t,o){var a=i.accept(t,n,r.concat(["defaults",o]));return Array.isArray(a)?e.push.apply(e,a):e.push(a),e},[])),e.rest&&(e.rest=i.accept(e.rest,n,r.concat(["rest"]))),e.body=i.accept(e.body,n,r.concat(["body"])),e.loc&&(e.loc=i.accept(e.loc,n,r.concat(["loc"]))),e}},{key:"visitFunctionExpression",value:function(e,t,r){var n=this.visitFunction(e,t,r),i=this;return e.defaults&&(e.defaults=e.defaults.reduce(function(e,t,o){var a=i.accept(t,n,r.concat(["defaults",o]));return Array.isArray(a)?e.push.apply(e,a):e.push(a),e},[])),e.rest&&(e.rest=i.accept(e.rest,n,r.concat(["rest"]))),e.body=i.accept(e.body,n,r.concat(["body"])),e.loc&&(e.loc=i.accept(e.loc,n,r.concat(["loc"]))),e}},{key:"visitArrowFunctionExpression",value:function(e,t,r){var n=this.visitFunction(e,t,r),i=this;return e.defaults&&(e.defaults=e.defaults.reduce(function(e,t,o){var a=i.accept(t,n,r.concat(["defaults",o]));return Array.isArray(a)?e.push.apply(e,a):e.push(a),e},[])),e.rest&&(e.rest=i.accept(e.rest,n,r.concat(["rest"]))),e.body=i.accept(e.body,n,r.concat(["body"])),e.loc&&(e.loc=i.accept(e.loc,n,r.concat(["loc"]))),e.generator,e.expression,e}},{key:"visitIdentifier",value:function(e,r,n){return r.refs.push(e),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitIdentifier",this).call(this,e,r,n)}},{key:"visitMemberExpression",value:function(e,t,r){var n=this;return e.object=n.accept(e.object,t,r.concat(["object"])),e.computed&&(e.property=n.accept(e.property,t,r.concat(["property"]))),e}},{key:"visitProperty",value:function(e,t,r){var n=this;return e.computed&&(e.key=n.accept(e.key,t,r.concat(["key"]))),e.value=n.accept(e.value,t,r.concat(["value"])),e}},{key:"visitThisExpression",value:function(e,r,n){return r.thisRefs.push(e),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitThisExpression",this).call(this,e,r,n)}},{key:"visitTryStatement",value:function(e,t,r){var n=this;return e.block=n.accept(e.block,t,r.concat(["block"])),e.handler&&(e.handler=n.accept(e.handler,t,r.concat(["handler"])),t.catches.push(e.handler.param)),e.finalizer&&(e.finalizer=n.accept(e.finalizer,t,r.concat(["finalizer"]))),e}},{key:"visitLabeledStatement",value:function(e,t,r){var n=this;return e.body=n.accept(e.body,t,r.concat(["body"])),e}},{key:"visitClassDeclaration",value:function(e,t,r){t.classDecls.push(e),t.classDeclPaths.push(r);var n=this;return e.superClass&&(e.superClass=n.accept(e.superClass,t,r.concat(["superClass"]))),e.body=n.accept(e.body,t,r.concat(["body"])),e}},{key:"visitClassExpression",value:function(e,t,r){e.id&&(t.classExprs.push(e),t.classExprPaths.push(r));var n=this;return e.superClass&&(e.superClass=n.accept(e.superClass,t,r.concat(["superClass"]))),e.body=n.accept(e.body,t,r.concat(["body"])),e}},{key:"visitMethodDefinition",value:function(e,t,r){var n=this;return e.value=n.accept(e.value,t,r.concat(["value"])),e}},{key:"visitMetaProperty",value:function(e,t,r){return e}},{key:"visitBreakStatement",value:function(e,t,r){return e}},{key:"visitContinueStatement",value:function(e,t,r){return e}},{key:"visitImportSpecifier",value:function(e,t,r){t.importSpecifiers.push(e.local),t.importSpecifierPaths.push(r);return e}},{key:"visitImportDefaultSpecifier",value:function(e,t,r){t.importSpecifiers.push(e.local),t.importSpecifierPaths.push(r);return e}},{key:"visitImportNamespaceSpecifier",value:function(e,t,r){t.importSpecifiers.push(e.local),t.importSpecifierPaths.push(r);return e}},{key:"visitExportSpecifier",value:function(e,t,r){var n=this;return e.local=n.accept(e.local,t,r.concat(["local"])),e}},{key:"visitExportNamedDeclaration",value:function(e,r,n){return r.exportDecls.push(e),r.exportDeclPaths.push(n),e.source||pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitExportNamedDeclaration",this).call(this,e,r,n),e}},{key:"visitExportDefaultDeclaration",value:function(e,r,n){return r.exportDecls.push(e),r.exportDeclPaths.push(n),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitExportDefaultDeclaration",this).call(this,e,r,n)}},{key:"visitExportAllDeclaration",value:function(e,r,n){return r.exportDecls.push(e),r.exportDeclPaths.push(n),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitExportAllDeclaration",this).call(this,e,r,n)}}]),t}(),xe=r.escodegen||r,we=acorn.walk,ke=acorn.loose;we.base.AwaitExpression||(we.base.AwaitExpression=function(e,t,r){e.argument&&r(e.argument,t,"Expression")}),we.forEachNode=a,we.matchNodes=function(e,t,r,n){return a(e,function(e,r,n,i){t[e.type]&&t[e.type](e,r,n,i)},r,n)},we.findNodesIncluding=s,we.withParentInfo=function(e,r,n){function i(e){var r={id:t.string.newUUID(),parentScope:e,containingScopes:[]};return e&&e.containingScopes.push(r),r}n=n||{};var o,s=we.make({Function:function(e,t,r){t&&t.scope&&(t.scope=i(t.scope)),r(e.body,t,"ScopeBody")},VariableDeclarator:function(e,t,r){e.init&&r(e.init,t,"Expression")},VariableDeclaration:function(e,t,r){for(var n=0;n<e.declarations.length;++n){var i=e.declarations[n];i&&r(i,t,"VariableDeclarator")}},ObjectExpression:function(e,t,r){for(var n=0;n<e.properties.length;++n){var i=e.properties[n];r(i.key,t,"Expression"),r(i.value,t,"Expression")}},MemberExpression:function(e,t,r){r(e.object,t,"Expression"),r(e.property,t,"Expression")}},we.base),u=[];a(e,function(e){t.arr.withoutAll(Object.keys(e),["end","start","type","source","raw"]).forEach(function(t){if(!e.__lookupGetter__(t)){var r=e[t];e.__defineGetter__(t,function(){return o=t,r}),u.push([e,t,e[t]])}})},null,{visitors:s});var c=[];return Object.keys(s).forEach(function(e){var t=s[e];s[e]=function(i,a,s){return e===i.type||n.visitAllNodes?(c.push(r.call(null,i,{scope:a.scope,depth:a.depth,parent:a.parent,type:e,propertyInParent:o})),t(i,{scope:a.scope,parent:i,depth:a.depth+1},s)):t(i,a,s)}}),we.recursive(e,{scope:i(),parent:null,propertyInParent:"",depth:0},null,s),u.forEach(function(e){delete e[0][e[1]],e[0][e[1]]=e[2]}),c},we.copy=function(e,r){function n(e){return null===e?null:i[e.type](e,n)}var i=t.obj.extend({Program:function(e,t){return{start:e.start,end:e.end,type:"Program",body:e.body.map(t),source:e.source,astIndex:e.astIndex}},FunctionDeclaration:function(e,t){return{start:e.start,end:e.end,type:"FunctionDeclaration",id:t(e.id),params:e.params.map(t),body:t(e.body),source:e.source,astIndex:e.astIndex}},BlockStatement:function(e,t){return{start:e.start,end:e.end,type:"BlockStatement",body:e.body.map(t),source:e.source,astIndex:e.astIndex}},ExpressionStatement:function(e,t){return{start:e.start,end:e.end,type:"ExpressionStatement",expression:t(e.expression),source:e.source,astIndex:e.astIndex}},CallExpression:function(e,t){return{start:e.start,end:e.end,type:"CallExpression",callee:t(e.callee),arguments:e.arguments.map(t),source:e.source,astIndex:e.astIndex}},MemberExpression:function(e,t){return{start:e.start,end:e.end,type:"MemberExpression",object:t(e.object),property:t(e.property),computed:e.computed,source:e.source,astIndex:e.astIndex}},NewExpression:function(e,t){return{start:e.start,end:e.end,type:"NewExpression",callee:t(e.callee),arguments:e.arguments.map(t),source:e.source,astIndex:e.astIndex}},VariableDeclaration:function(e,t){return{start:e.start,end:e.end,type:"VariableDeclaration",declarations:e.declarations.map(t),kind:e.kind,source:e.source,astIndex:e.astIndex}},VariableDeclarator:function(e,t){return{start:e.start,end:e.end,type:"VariableDeclarator",id:t(e.id),init:t(e.init),source:e.source,astIndex:e.astIndex}},FunctionExpression:function(e,t){return{start:e.start,end:e.end,type:"FunctionExpression",id:t(e.id),params:e.params.map(t),body:t(e.body),source:e.source,astIndex:e.astIndex}},IfStatement:function(e,t){return{start:e.start,end:e.end,type:"IfStatement",test:t(e.test),consequent:t(e.consequent),alternate:t(e.alternate),source:e.source,astIndex:e.astIndex}},ConditionalExpression:function(e,t){return{start:e.start,end:e.end,type:"ConditionalExpression",test:t(e.test),consequent:t(e.consequent),alternate:t(e.alternate),source:e.source,astIndex:e.astIndex}},SwitchStatement:function(e,t){return{start:e.start,end:e.end,type:"SwitchStatement",discriminant:t(e.discriminant),cases:e.cases.map(t),source:e.source,astIndex:e.astIndex}},SwitchCase:function(e,t){return{start:e.start,end:e.end,type:"SwitchCase",test:t(e.test),consequent:e.consequent.map(t),source:e.source,astIndex:e.astIndex}},BreakStatement:function(e,t){return{start:e.start,end:e.end,type:"BreakStatement",label:e.label,source:e.source,astIndex:e.astIndex}},ContinueStatement:function(e,t){return{start:e.start,end:e.end,type:"ContinueStatement",label:e.label,source:e.source,astIndex:e.astIndex}},TryStatement:function(e,t){return{start:e.start,end:e.end,type:"TryStatement",block:t(e.block),handler:t(e.handler),finalizer:t(e.finalizer),guardedHandlers:e.guardedHandlers.map(t),source:e.source,astIndex:e.astIndex}},CatchClause:function(e,t){return{start:e.start,end:e.end,type:"CatchClause",param:t(e.param),guard:t(e.guard),body:t(e.body),source:e.source,astIndex:e.astIndex}},ThrowStatement:function(e,t){return{start:e.start,end:e.end,type:"ThrowStatement",argument:t(e.argument),source:e.source,astIndex:e.astIndex}},ForStatement:function(e,t){return{start:e.start,end:e.end,type:"ForStatement",init:t(e.init),test:t(e.test),update:t(e.update),body:t(e.body),source:e.source,astIndex:e.astIndex}},ForInStatement:function(e,t){return{start:e.start,end:e.end,type:"ForInStatement",left:t(e.left),right:t(e.right),body:t(e.body),source:e.source,astIndex:e.astIndex}},WhileStatement:function(e,t){return{start:e.start,end:e.end,type:"WhileStatement",test:t(e.test),body:t(e.body),source:e.source,astIndex:e.astIndex}},DoWhileStatement:function(e,t){return{start:e.start,end:e.end,type:"DoWhileStatement",test:t(e.test),body:t(e.body),source:e.source,astIndex:e.astIndex}},WithStatement:function(e,t){return{start:e.start,end:e.end,type:"WithStatement",object:t(e.object),body:t(e.body),source:e.source,astIndex:e.astIndex}},UnaryExpression:function(e,t){return{start:e.start,end:e.end,type:"UnaryExpression",argument:t(e.argument),operator:e.operator,prefix:e.prefix,source:e.source,astIndex:e.astIndex}},BinaryExpression:function(e,t){return{start:e.start,end:e.end,type:"BinaryExpression",left:t(e.left),operator:e.operator,right:t(e.right),source:e.source,astIndex:e.astIndex}},LogicalExpression:function(e,t){return{start:e.start,end:e.end,type:"LogicalExpression",left:t(e.left),operator:e.operator,right:t(e.right),source:e.source,astIndex:e.astIndex}},AssignmentExpression:function(e,t){return{start:e.start,end:e.end,type:"AssignmentExpression",left:t(e.left),operator:e.operator,right:t(e.right),source:e.source,astIndex:e.astIndex}},UpdateExpression:function(e,t){return{start:e.start,end:e.end,type:"UpdateExpression",argument:t(e.argument),operator:e.operator,prefix:e.prefix,source:e.source,astIndex:e.astIndex}},ReturnStatement:function(e,t){return{start:e.start,end:e.end,type:"ReturnStatement",argument:t(e.argument),source:e.source,astIndex:e.astIndex}},Identifier:function(e,t){return{start:e.start,end:e.end,type:"Identifier",name:e.name,source:e.source,astIndex:e.astIndex}},Literal:function(e,t){return{start:e.start,end:e.end,type:"Literal",value:e.value,raw:e.raw,source:e.source,astIndex:e.astIndex}},ObjectExpression:function(e,t){return{start:e.start,end:e.end,type:"ObjectExpression",properties:e.properties.map(function(e){return{key:t(e.key),value:t(e.value),kind:e.kind}}),source:e.source,astIndex:e.astIndex}},ArrayExpression:function(e,t){return{start:e.start,end:e.end,type:"ArrayExpression",elements:e.elements.map(t),source:e.source,astIndex:e.astIndex}},SequenceExpression:function(e,t){return{start:e.start,end:e.end,type:"SequenceExpression",expressions:e.expressions.map(t),source:e.source,astIndex:e.astIndex}},EmptyStatement:function(e,t){return{start:e.start,end:e.end,type:"EmptyStatement",source:e.source,astIndex:e.astIndex}},ThisExpression:function(e,t){return{start:e.start,end:e.end,type:"ThisExpression",source:e.source,astIndex:e.astIndex}},DebuggerStatement:function(e,t){return{start:e.start,end:e.end,type:"DebuggerStatement",source:e.source,astIndex:e.astIndex}},LabeledStatement:function(e,t){return{start:e.start,end:e.end,type:"LabeledStatement",label:e.label,body:t(e.body),source:e.source,astIndex:e.astIndex}}},r||{});return n(e)},we.findSiblings=function(e,r,n){if(!r)return[];var i=s(e,r.start),o=i.indexOf(r),a=i.slice(0,o),u=t.arr.detect(a.reverse(),function(e){return Array.isArray(e.body)}).body;if(!n)return t.arr.without(u,r);var c=u.indexOf(r);return"before"===n?u.slice(0,c):u.slice(c+1)},we.findNodeByAstIndex=function(e,t,r){r=null==r||!!r,!e.astIndex&&r&&u(e);var n=null;return je(e,null,function(e,r,i){n||r.astIndex<t||(r.astIndex!==t?e():n=r)}),n},we.findStatementOfNode=function(e,r,n){n||(n=r,r=e,e=null),e||(e={}),r.astIndex||u(r);var i,o=!1,a=["EmptyStatement","BlockStatement","ExpressionStatement","IfStatement","LabeledStatement","BreakStatement","ContinueStatement","WithStatement","SwitchStatement","ReturnStatement","ThrowStatement","TryStatement","WhileStatement","DoWhileStatement","ForStatement","ForInStatement","DebuggerStatement","FunctionDeclaration","VariableDeclaration","ClassDeclaration"];return je(r,{},function(s,u,c,l){if(!(o||u.astIndex<n.astIndex)){if(u===n||u.astIndex===n.astIndex)if(o=!0,e.asPath)i=l;else{var f=t.Path(l);do{i=f.get(r),f=f.slice(0,f.size()-1)}while(-1==a.indexOf(i.type)&&f.size()>0)}!o&&s()}}),i},we.addAstIndex=u,we.visitors={stopAtFunctions:we.make({Function:function(){}},we.base),withMemberExpression:we.make({MemberExpression:function(e,t,r){r(e.object,t,"Expression"),r(e.property,t,"Expression")}},we.base)};var Ee=function(e){function t(){return ce(this,t),de(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return he(t,i),le(t,[{key:"accept",value:function(e,r,n){return this.doFunc(e,r,n),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,r,n)}}],[{key:"run",value:function(e,t,r){var n=new this;return n.doFunc=t,n.accept(e,r,[]),r}}]),t}(),Se=function(e){function t(){return ce(this,t),de(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return he(t,i),le(t,[{key:"accept",value:function(e,r,n){switch(e.type){case"ArrowFunctionExpression":case"FunctionExpression":return e;case"FunctionDeclaration":return r.unshift({node:e,path:n}),e;default:return pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,r,n)}}}],[{key:"run",value:function(e){var t=[];return(new this).accept(e,t,[]),t}}]),t}(),Ae=Symbol("canBeInlined"),De=function(e){function t(){return ce(this,t),de(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return he(t,i),le(t,[{key:"accept",value:function(e,r,n){return this.replacer(pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,r,n))}},{key:"visitBlockStatement",value:function(e,r,n){return c(pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitBlockStatement",this).call(this,e,r,n))}},{key:"visitProgram",value:function(e,r,n){return c(pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitProgram",this).call(this,e,r,n))}}],[{key:"run",value:function(e,t){var r=new this;return r.replacer=t,r.accept(e,null,[])}}]),t}(),Ce=function(e){function t(){return ce(this,t),de(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return he(t,i),le(t,[{key:"accept",value:function(e,r,n){return this.replacer(pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,r,n),n)}}],[{key:"run",value:function(e,t){var r=new this;return r.replacer=t,r.accept(e,null,[])}}]),t}();acorn.walk.addSource=l;var Fe={withMozillaAstDo:function(e,t,r){var n=new i,o=n.accept;return n.accept=function(e,i,a){return t=r(function(){o.call(n,e,i,a)},e,i,a),e},n.accept(e,t,[]),t},printAst:function(e,r){var n,i,a=(r=r||{}).printSource||!1,s=r.printPositions||!1,u=r.printIndex||!1,c=[];return"string"==typeof e?(n=e,i=h(e)):(i=e,n=r.source||i.source),a&&!i.source&&(n||(i=h(n=o(i))),l(i,n)),(new ge).accept(i,{index:0,tree:c},[]),t.string.printTree(c[0],function(e){var r=e.path+":"+e.node.type,i=[];if(u&&i.push(e.index),s&&i.push(e.node.start+"-"+e.node.end),a){var o=e.node.source||n.slice(e.node.start,e.node.end),c=t.string.print(o.truncate(60).replace(/\n/g,"").replace(/\s+/g," "));i.push(c)}return i.length&&(r+="("+i.join(",")+")"),r},function(e){return e.children},"  ")},compareAst:function(e,t){if(!e||!t)throw new Error("node"+(e?"1":"2")+" not defined");var r={completePath:[],comparisons:{errors:[]}};return(new be).accept(e,t,r,[]),r.comparisons.errors.length?r.comparisons.errors.pluck("msg"):null},pathToNode:function(e,t,r){r=r||{},e.astIndex||u(e);var n=new i,o=null;return(n.accept=function(e,r,n,i){if(!o){var a=r.concat(i);if(e.astIndex===t){var s=a.map(function(e){return"string"==typeof e?"."+e:"["+e+"]"}).join("");o={pathString:s,path:a,node:e}}return this["visit"+e.type](e,a,n,i)}}).call(n,e,[],{},[]),o},rematchAstWithSource:function(e,r,n,o){var a=h(r,(n=!!n)?{locations:!0}:void 0),s=new i;o&&(a=t.Path(o).get(a)),s.accept=function(t,r,i){var o=(i=i||[]).reduce(function(e,t){return e[t]},e);return o.start=t.start,o.end=t.end,n&&(o.loc=t.loc),this["visit"+t.type](t,r,i)},s.accept(a)}},je=Fe.withMozillaAstDo,Te=Fe.printAst,Oe=Fe.compareAst,Re=Fe.pathToNode,Be=Fe.rematchAstWithSource,Pe=/[_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*$/,Ie=Object.freeze({isIdentifier:d,id:m,literal:v,objectLiteral:function(e){for(var t=[],r=0;r<e.length;r+=2){var n=e[r];"string"==typeof n&&(n=m(n)),t.push(D(n,e[r+1]))}return{properties:t,type:"ObjectExpression"}},prop:D,exprStmt:y,returnStmt:g,empty:function(){return{type:"EmptyStatement"}},binaryExpr:function(e,t,r){return{left:e,right:r,operator:t,type:"BinaryExpression"}},funcExpr:b,funcCall:_,varDecl:x,member:w,memberChain:k,assign:function(e,t){return{type:"AssignmentExpression",operator:"=",right:t?"string"==typeof t?m(t):t:m("undefined"),left:"string"==typeof e?m(e):e}},block:E,program:S,tryStmt:A,ifStmt:function(e){return{consequent:arguments.length>1&&void 0!==arguments[1]?arguments[1]:E(),alternate:arguments.length>2&&void 0!==arguments[2]?arguments[2]:E(),test:e,type:"IfStatement"}},forIn:function(e,t,r){return{type:"ForInStatement",left:"string"==typeof e?x(e):e,right:"string"==typeof t?m(t):t,body:r}},conditional:function(e){return{consequent:arguments.length>1&&void 0!==arguments[1]?arguments[1]:m("undefined"),alternate:arguments.length>2&&void 0!==arguments[2]?arguments[2]:m("undefined"),test:e,type:"ConditionalExpression"}},logical:function(e,t,r){return{operator:e,left:t,right:r,type:"LogicalExpression"}}}),Le={declIds:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=0;r<e.length;r++){var n=e[r];if(n)if("Identifier"===n.type)t.push(n);else if("RestElement"===n.type)t.push(n.argument);else if("AssignmentPattern"===n.type)Le.declIds([n.left],t);else if("ObjectPattern"===n.type)for(var i=0;i<n.properties.length;i++){var o=n.properties[i];Le.declIds([o.value||o],t)}else"ArrayPattern"===n.type&&Le.declIds(n.elements,t)}return t},varDecls:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=!0,n=!1,i=void 0;try{for(var o,a=e.varDecls[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value,u=!0,c=!1,l=void 0;try{for(var f,p=s.declarations[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var h=f.value,d=!0,m=!1,v=void 0;try{for(var y,g=Le.declIds([h.id])[Symbol.iterator]();!(d=(y=g.next()).done);d=!0){var b=y.value;t.push([h,b])}}catch(e){m=!0,v=e}finally{try{!d&&g.return&&g.return()}finally{if(m)throw v}}}}catch(e){c=!0,l=e}finally{try{!u&&p.return&&p.return()}finally{if(c)throw l}}}}catch(e){n=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return t},varDeclIds:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=!0,n=!1,i=void 0;try{for(var o,a=e.varDecls[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value,u=!0,c=!1,l=void 0;try{for(var f,p=s.declarations[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var h=f.value;Le.declIds([h.id],t)}}catch(e){c=!0,l=e}finally{try{!u&&p.return&&p.return()}finally{if(c)throw l}}}}catch(e){n=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return t},objPropertiesAsList:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=!0,o=!1,a=void 0;try{for(var s,u=e.properties[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value,l=c.key.name,f={key:t.concat([l]),value:c.value};switch(c.value.type){case"ArrayExpression":case"ArrayPattern":r||n.push(f);for(var p=0;p<c.value.elements.length;p++){var h=c.value.elements[p];Le.objPropertiesAsList(h,t.concat([l,p]),r,n)}break;case"ObjectExpression":case"ObjectPattern":r||n.push(f),Le.objPropertiesAsList(c.value,t.concat([l]),r,n);break;case"AssignmentPattern":r||n.push(f),Le.objPropertiesAsList(c.left,t.concat([l]),r,n);break;default:n.push(f)}}}catch(e){o=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return n},isDeclaration:function(e){return"FunctionDeclaration"===e.type||"VariableDeclaration"===e.type||"ClassDeclaration"===e.type}},Ne=["true","false","null","undefined","arguments","Object","Function","Array","Number","parseFloat","parseInt","Infinity","NaN","Boolean","String","Symbol","Date","Promise","RegExp","Error","EvalError","RangeError","ReferenceError","SyntaxError","TypeError","URIError","JSON","Math","console","ArrayBuffer","Uint8Array","Int8Array","Uint16Array","Int16Array","Uint32Array","Int32Array","Float32Array","Float64Array","Uint8ClampedArray","DataView","Map","Set","WeakMap","WeakSet","Proxy","Reflect","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","unescape","eval","isFinite","isNaN","Intl","navigator","window","document","Blob","setTimeout","clearTimeout","setInterval","clearInterval","requestAnimationFrame","cancelAnimationFrame","btoa","atob","sessionStorage","localStorage","$world","lively"],Me=/^\s*global\s*/,qe=["EmptyStatement","BlockStatement","ExpressionStatement","IfStatement","BreakStatement","ContinueStatement","WithStatement","ReturnStatement","ThrowStatement","TryStatement","WhileStatement","DoWhileStatement","ForStatement","ForInStatement","ForOfStatement","DebuggerStatement","FunctionDeclaration","VariableDeclaration","ClassDeclaration","ImportDeclaration","ImportDeclaration","ExportNamedDeclaration","ExportDefaultDeclaration","ExportAllDeclaration"],$e=Object.freeze({helpers:Le,knownGlobals:Ne,scopes:C,nodesAtIndex:function(e,t){return je(e,[],function(e,r,n){return r.start<=t&&t<=r.end&&(n.push(r),e()),n})},scopesAtIndex:F,scopeAtIndex:function(e,r){return t.arr.last(F(e,r))},scopesAtPos:function(e,t){return q(e,t).filter(function(e){return"Program"===e.type||"FunctionDeclaration"===e.type||"FunctionExpression"===e.type})},nodesInScopeOf:function(e){return je(e,{root:e,result:[]},function(e,t,r){return r.result.push(t),t===r.root||"Program"!==t.type&&"FunctionDeclaration"!==t.type&&"FunctionExpression"!==t.type?(e(),r):r}).result},declarationsOfScope:j,_declaredVarNames:O,_findJsLintGlobalDeclarations:R,topLevelDeclsAndRefs:L,topLevelFuncDecls:B,findGlobalVarRefs:function(e,t){var r=L(e,t),n=r.declaredNames.concat(Ne);return r.refs.filter(function(e){return-1===n.indexOf(e.name)})},findNodesIncludingLines:function(e,r,n,i){if(!r&&!e)throw new Error("Need at least ast or code");return r=r||o(e),e=e&&e.loc?e:h(r,{locations:!0}),je(e,[],function(e,r,i){return n.every(function(e){return t.num.between(e,r.loc.start.line,r.loc.end.line)})&&(t.arr.pushIfNotIncluded(i,r),e()),i})},findReferencesAndDeclsInScope:M,findDeclarationClosestToIndex:function(e,r,n){var i=null;return t.arr.detect(F(e,n).reverse(),function(e){var n=j(e,!0),o=t.arr.pluck(n,"name").indexOf(r);return-1!==o&&(i=n[o],!0)}),i},nodesAt:q,statementOf:$,resolveReferences:I,refWithDeclAt:function(e,t){var r=!0,n=!1,i=void 0;try{for(var o,a=t.resolvedRefMap.values()[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value,u=s.ref,c=u.start,l=u.end;if(c<=e&&e<=l)return s}}catch(e){n=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}},imports:function(e){for(var t=[],r=e.node.body||[],n=0;n<r.length;n++){var i=r[n];if("ImportDeclaration"===i.type)if(0!==i.specifiers.length){var o=i.source?i.source.value:"unknown module";t.push.apply(t,ye(i.specifiers.map(function(e){var t;return t="ImportNamespaceSpecifier"===e.type?"*":"ImportDefaultSpecifier"===e.type?"default":"ImportSpecifier"===e.type?e.imported.name:null,{local:e.local?e.local.name:null,imported:t,fromModule:o,node:i}})))}else t.push({local:null,imported:null,fromModule:i.source.value,node:i})}return t},exports:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&I(e);var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=function(){var t=a.value;if(!(c=$(e.node,t)))return"continue";if(l=c.source?c.source.value:null,"ExportAllDeclaration"===c.type)return r.push({local:null,exported:"*",imported:"*",fromModule:l,node:t,type:"all"}),"continue";if("ExportDefaultDeclaration"===c.type){if(Le.isDeclaration(c.declaration))return r.push({local:c.declaration.id?c.declaration.id.name:null,exported:"default",type:"FunctionDeclaration"===c.declaration.type?"function":"ClassDeclaration"===c.declaration.type?"class":null,fromModule:null,node:t,decl:c.declaration,declId:c.declaration.id}),"continue";if("Identifier"===c.declaration.type){var n=e.resolvedRefMap.get(c.declaration)||{};return f=n.decl,p=n.declId,r.push({local:c.declaration.name,exported:"default",fromModule:null,node:t,type:"id",decl:f,declId:p}),"continue"}return r.push({local:null,exported:"default",fromModule:null,node:t,type:"expr",decl:c.declaration,declId:c.declaration}),"continue"}return c.specifiers&&c.specifiers.length?(r.push.apply(r,ye(c.specifiers.map(function(r){var n,i;if(l)n=t,i=r.exported;else if(r.local){var o=e.resolvedRefMap.get(r.local);n=o?o.decl:null,i=o?o.declId:null}return{local:!l&&r.local?r.local.name:null,exported:r.exported?r.exported.name:null,imported:l&&r.local?r.local.name:null,fromModule:l||null,type:"id",node:t,decl:n,declId:i}}))),"continue"):c.declaration&&c.declaration.declarations?(r.push.apply(r,ye(c.declaration.declarations.map(function(e){return{local:e.id?e.id.name:"default",exported:e.id?e.id.name:"default",type:c.declaration.kind,fromModule:null,node:t,decl:e,declId:e.id}}))),"continue"):c.declaration?(r.push({local:c.declaration.id?c.declaration.id.name:"default",exported:c.declaration.id?c.declaration.id.name:"default",type:"FunctionDeclaration"===c.declaration.type?"function":"ClassDeclaration"===c.declaration.type?"class":null,fromModule:null,node:t,decl:c.declaration,declId:c.declaration.id}),"continue"):void 0},u=e.exportDecls[Symbol.iterator]();!(n=(a=u.next()).done);n=!0){var c,l,f,p;s()}}catch(e){i=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return t.arr.uniqBy(r,function(e,t){return e.local==t.local&&e.exported==t.exported&&e.fromModule==t.fromModule})}}),We=function(e){function t(){return ce(this,t),de(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return he(t,i),le(t,[{key:"accept",value:function(e,r,n){return"ObjectExpression"===e.type&&(e=this.transformSpreadElement(e)),pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,r,n)}},{key:"transformSpreadElement",value:function(e){var t=[],r=[t];return e.properties.forEach(function(e){"SpreadElement"!==e.type?t.push(e):(r.push(e),t=[],r.push(t))}),1===r.length?e:(t.length||r.pop(),_.apply(void 0,[w("Object","assign")].concat(ye(r.map(function(e){return"SpreadElement"===e.type?e.argument:{properties:e,type:"ObjectExpression"}})))))}}]),t}(),Ue=/^\s*(\{|function\s*\()/,Ge=Object.freeze({replaceNode:V,replaceNodes:J,replace:function(e,t,r,n){var i="object"===(void 0===e?"undefined":ue(e))?e:null;return V(t,r,"string"==typeof e?e:i.source||W(i))},_compareNodesForReplacement:z,oneDeclaratorPerVarDecl:function(e){var t="object"===(void 0===e?"undefined":ue(e))?e:h(e),r="string"==typeof e?e:t.source||W(t),n=H(C(t)),i=[],o=!0,a=!1,s=void 0;try{for(var u,c=n[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var l=u.value;i.push({target:l,replacementFunc:function(e,t,r){return r&&(e=h(t).body[0]),e.declarations.map(function(e){return{type:"VariableDeclaration",kind:"var",declarations:[e]}})}})}}catch(e){a=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(a)throw s}}return J(i,r)},oneDeclaratorForVarsInDestructoring:function(e){var t="object"===(void 0===e?"undefined":ue(e))?e:h(e),r="string"==typeof e?e:t.source||W(t),n=H(C(t)),i=[],o=!0,a=!1,s=void 0;try{for(var u,c=n[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var l=u.value;i.push({target:l,replacementFunc:function(e,t,r){r&&(e=h(t).body[0]);var n=[],i=!0,o=!1,a=void 0;try{for(var s,u=e.declarations[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value,l={type:"Identifier",name:"__temp"},f={type:"VariableDeclaration",kind:"var",declarations:[{type:"VariableDeclarator",id:l,init:c.init}]};n.push(f);var p=!0,d=!1,m=void 0;try{for(var v,y=Le.objPropertiesAsList(c.id,[],!1)[Symbol.iterator]();!(p=(v=y.next()).done);p=!0){var g=v.value.key;n.push(x(g[g.length-2],k.apply(void 0,[l.name].concat(ye(g))),"var"))}}catch(e){d=!0,m=e}finally{try{!p&&y.return&&y.return()}finally{if(d)throw m}}}}catch(e){o=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return n}})}}catch(e){a=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(a)throw s}}return J(i,r)},returnLastStatement:X,wrapInFunction:function(e,t){var r=X(e,t=t||{});return t.asAST?S(b.apply(void 0,[{id:t.id||void 0},[]].concat(ye(r.body)))):"function"+(t.id?" "+t.id:"")+"() {\n"+r+"\n}"},wrapInStartEndCall:function(e,r){"string"==typeof e&&(e=h(e)),r=r||{};var n="Program"===e.type,i=r.startFuncNode||m("__start_execution"),o=r.endFuncNode||m("__end_execution"),a=B(e),s=e.body,u=[];a.forEach(function(r){var n=r.node,i=r.path;t.Path(i).set(e,y(n.id)),u.push(n)}),s.unshift(y(_(i)));var c=t.arr.last(s);return"ExpressionStatement"===c.type?(s.pop(),s.push(y(_(o,m("null"),c.expression)))):"VariableDeclaration"===c.type&&"Identifier"===t.arr.last(c.declarations).id.type?s.push(y(_(o,m("null"),t.arr.last(c.declarations).id))):s.push(y(_(o,m("null"),m("undefined")))),u.push(A.apply(void 0,["err",[y(_(o,m("err"),m("undefined")))]].concat(ye(s)))),n?S.apply(void 0,u):E.apply(void 0,u)},transformSingleExpression:function(e){if(!Ue.test(e)||e.split("\n").length>30)return e;try{var t=p(e);1===t.body.length&&("FunctionDeclaration"===t.body[0].type||"BlockStatement"===t.body[0].type&&"LabeledStatement"===t.body[0].body[0].type)&&(e="("+e.replace(/;\s*$/,"")+")")}catch(e){"undefined"!=typeof $world?$world.logError(e):console.error("Eval preprocess error: %s",e.stack||e)}return e},objectSpreadTransform:function(e){return(new We).accept(e,{},[])}}),ze=Object.freeze({getCommentPrecedingNode:function(e,r){var n=$(e,r,{asPath:!0}).slice(0,-2),i=t.Path(n).get(e);return i.comments&&i.comments.length?t.chain(K(e)).reversed().detect(function(e){return e.followingNode===r}).value():null},extractComments:K}),Ve=Object.freeze({findDecls:Q}),Je=/^(?!(?:do|if|in|for|let|new|try|var|case|default|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc][$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc0-9\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u0669\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u06f0-\u06f9\u0711\u0730-\u074a\u07a6-\u07b0\u07c0-\u07c9\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09cb-\u09cd\u09d7\u09e2\u09e3\u09e6-\u09ef\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d3e-\u0d44\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0d62\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0e50-\u0e59\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102b-\u103e\u1040-\u1049\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4-\u17d3\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u18a9\u1920-\u192b\u1930-\u193b\u1946-\u194f\u19b0-\u19c0\u19c8\u19c9\u19d0-\u19d9\u1a17-\u1a1b\u1a55-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b00-\u1b04\u1b34-\u1b44\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1b82\u1ba1-\u1bad\u1bb0-\u1bb9\u1be6-\u1bf3\u1c24-\u1c37\u1c40-\u1c49\u1c50-\u1c59\u1cd0-\u1cd2\u1cd4-\u1ce8\u1ced\u1cf2-\u1cf4\u1dc0-\u1de6\u1dfc-\u1dff\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua620-\ua629\ua66f\ua674-\ua67d\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua823-\ua827\ua880\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f1\ua900-\ua909\ua926-\ua92d\ua947-\ua953\ua980-\ua983\ua9b3-\ua9c0\ua9d0-\ua9d9\uaa29-\uaa36\uaa43\uaa4c\uaa4d\uaa50-\uaa59\uaa7b\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaeb-\uaaef\uaaf5\uaaf6\uabe3-\uabea\uabec\uabed\uabf0-\uabf9\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f]*$/,He=h("").constructor;Object.defineProperty(He.prototype,"__serialize__",{configurable:!0,value:function(){return{__expr__:"("+JSON.stringify(this)+")"}}}),e.escodegen=xe,e.acorn=acorn,e.query=$e,e.transform=Ge,e.comments=ze,e.categorizer=Ve,e.stringify=o,e.nodes=Ie,e.isValidIdentifier=function(e){return Je.test(e)},e.BaseVisitor=i,e.withMozillaAstDo=je,e.printAst=Te,e.compareAst=Oe,e.pathToNode=Re,e.rematchAstWithSource=Be,e.ReplaceManyVisitor=De,e.ReplaceVisitor=Ce,e.parse=h,e.parseFunction=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=h("("+e+")",t);return Ee.run(r,function(r,n,i){r._positionFixed||(r._positionFixed=!0,(r.start||0===r.start)&&(r.start+=-1,r.end+=-1),t.addSource&&!r.source&&(r.source=e.slice(r.start,r.end)))}),r.body[0].expression},e.fuzzyParse=p}(this.lively.ast=this.lively.ast||{},lively.lang,e.escodegen,acorn)}.call(e),"undefined"!=typeof module&&module.exports&&(module.exports=e.lively.ast),t&&(e.define=t)}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;void 0===lively.lang&&(e.livey.lang={})}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(e,t,r){"use strict";function n(e){return e.hasOwnProperty(P)}function i(e){if(n(e)){var t=s(e),r=t.properties,i=t.propertySettings;e[I]={properties:r,propertySettings:i},r&&"object"===(void 0===r?"undefined":S(r))?o(e,i,r):console.warn("Class "+e.name+" indicates it has managed properties but its properties accessor ("+P+") does not return a valid property descriptor map")}}function o(e,t,r){a(e);var n=t.valueStoreProperty,i=t.defaultGetter,o=t.defaultSetter,s=e.prototype;Object.keys(r).forEach(function(e){var t=r[e];if(!(s.hasOwnProperty(e)&&s.__lookupGetter__(e))){var a=t.get||"function"==typeof i&&function(){return i.call(this,e)}||function(){return this[n][e]};s.__defineGetter__(e,a)}if(!(s.hasOwnProperty(e)&&s.__lookupSetter__(e))&&(t.hasOwnProperty("set")||!t.readOnly)){var u=t.set||"function"==typeof o&&function(t){o.call(this,e,t)}||function(t){this[n][e]=t};s.__defineSetter__(e,u)}})}function a(e){Object.defineProperty(e.prototype,"propertiesAndPropertySettings",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.constructor;return e[I]||s(e)}}),Object.defineProperty(e.prototype,"initializeProperties",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.propertiesAndPropertySettings(),r=t.properties;return u(this,t.propertySettings,r,e),this}})}function s(e){for(var r=F({},L),n={},i=t.obj.valuesInPropertyHierarchy(e,"propertySettings"),o=t.obj.valuesInPropertyHierarchy(e,"properties"),a=0;a<i.length;a++){var s=i[a];s&&"object"===(void 0===s?"undefined":S(s))&&Object.assign(r,s)}for(a=0;a<o.length;a++){var u=o[a];if("object"===(void 0===u?"undefined":S(u)))for(var c in u)n.hasOwnProperty(c)?Object.assign(n[c],u[c]):n[c]=u[c];else console.error("[initializeProperties] "+e+" encountered property declaration that is not a JS object: "+u)}return{properties:n,propertySettings:r}}function u(e,r,n,i){var o=r.valueStoreProperty,a=t.obj.sortKeysWithBeforeAndAfterConstraints(n),s=[],u={};e.hasOwnProperty(o)||(e[o]={});for(m=0;m<a.length;m++){var c=a[m],l=n[c],f=l.derived,p=!!l.foldable,h=l.hasOwnProperty("defaultValue")?l.defaultValue:void 0;Array.isArray(h)&&(h=h.slice()),f||p||(e[o][c]=h);var d=void 0;l.hasOwnProperty("initialize")?(d=u[c]={initialize:h},s.push(c)):f&&void 0!==h?(d=u[c]={derived:h},s.push(c)):p&&void 0!==h&&(d=u[c]={folded:h},s.push(c)),i&&c in i&&(l.readOnly?console.warn("Trying to initialize read-only property "+c+" in "+e+", skipping setting value"):(d||(d=u[c]={},s.push(c)),d.value=i[c]))}for(var m=0;m<s.length;m++){var v=s[m],y=u[v],g=y.hasOwnProperty("value");if(y.hasOwnProperty("initialize")){var b=g?y.value:y.initialize;n[v].initialize.call(e,b),g&&(e[v]=y.value)}else y.hasOwnProperty("derived")?e[v]=g?y.value:y.derived:y.hasOwnProperty("folded")?e[v]=g?y.value:y.folded:g&&(e[v]=y.value)}}function c(e,t){var r=t?"function"==typeof t?t:t.value?t.value:Object:Object,n=e&&e[q];return n&&n===r||(h(r),e[q]=r,J(e.prototype,r.prototype),r!==Object&&J(e,r)),r}function l(e,t,r){if(r=Object.assign(r,V),r.value.displayName=r.key,r.needsDeclaringClass){var n=r.value.originalFunction||r.value;r.value=Object.assign(function(){return n.call.apply(n,[this,t].concat(Array.prototype.slice.call(arguments)))},{originalFunction:n,toString:function(){return n.toString()},displayName:r.key})}Object.defineProperty(e,r.key,r)}function f(e,t){t=Object.assign(t,z),Object.defineProperty(e,t.key,t)}function p(e,t,r){r&&r.forEach(function(t){t.value?l(e,e,t):f(e,t)}),t&&t.forEach(function(t){t.value?l(e.prototype,e,t):f(e.prototype,t)}),e.prototype[N]?Object.getOwnPropertySymbols(e.prototype).includes(N)&&e.prototype[N].isDefaultInitializer&&e[q].prototype[N]&&delete e.prototype[N]:(Object.defineProperty(e.prototype,N,{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),e.prototype[N].isDefaultInitializer=!0,e.prototype[N].displayName="lively-initialize");for(var n=t.map(function(e){return e.key}).concat(["constructor","arguments","caller"]),i=Object.getOwnPropertyNames(e.prototype),o=0;o<i.length;o++){var a=i[o];n.includes(a)||delete e.prototype[a]}for(var s=r.map(function(e){return e.key}).concat(["length","name","prototype","arguments","caller"]),u=Object.getOwnPropertyNames(e),c=0;c<u.length;c++){var p=u[c];s.includes(p)||delete e[p]}}function h(e){e===Object||e.prototype[N]||(Object.defineProperty(e.prototype,N,{enumerable:!1,configurable:!0,writable:!0,value:function(){e.apply(this,arguments)}}),e.prototype[N].displayName="lively-initialize-stub")}function d(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments[5],s=arguments[6],u=e.name,l=u&&o.hasOwnProperty(u)&&o[u],f=l&&l[q];l&&"function"==typeof l&&f||(l=e);c(l,t);if(p(l,r,n),l[W]=s,a){var h=a.package(),d=l[$],m=Date.now();l[$]={package:h?{name:h.name,version:h.version}:{},pathInPackage:h?a.pathInPackage():a.id,lastChange:d&&d.lastChange&&m<=d.lastChange?d.lastChange+1:m,lastSuperclassChange:0},t&&t.referencedAs&&(l.hasOwnProperty(U)&&a.unsubscribeFromToplevelDefinitionChanges(l[U]),l[U]=a.subscribeToToplevelDefinitionChanges(function(e,o){if(e===t.referencedAs){var a=o&&o[$],s=l[$];if(a){if(a.lastChange===s.lastSuperclassChange)return;s.lastSuperclassChange=a.lastChange}c(l,o),p(l,r,n),i(l)}}))}return l.toString=function(){var e=String(this.prototype[N]).match(G),t=this.name,r=this[q];return"class "+t+" "+(r?"extends "+r.name:"")+" {\n  constructor"+(e?e[0]:"()")+" { /*...*/ }\n}"},i(l),l}function m(e){return"ArrowFunctionExpression"===e.type||"FunctionExpression"===e.type||"FunctionDeclaration"===e.type}function v(e){return e.replace(ue,"_").replace(ce,"_")}function y(e){return ne({id:e?Q(e):null},["__first_arg__"],ae(oe(Q("__first_arg__"),"&&",K("__first_arg__",Z(K("Symbol","for"),ee("lively-instance-restorer")),!0)),se(),se(Y(Z(K(K("this",Z(K("Symbol","for"),ee("lively-instance-initialize")),!0),"apply"),Q("this"),Q("arguments"))))))}function g(e,t,n,i){console.assert("Super"===e.type);var o=t.currentMethod;o||console.warn("[lively.classes] Trying to transform es6 class but got super call outside a method! "+r.stringify(e)+" in "+n.join("."));var a=n.slice(-2),s=R(a,2),u=s[0],c=s[1];return"callee"===u&&"object"===c||"callee"===c?e:o&&"static"===o[fe]?Z(K("Object","getPrototypeOf"),Q(pe)):Z(K("Object","getPrototypeOf"),K(Q(pe),"prototype"))}function b(e,t,r,n){return console.assert("CallExpression"===e.type),console.assert("Super"===e.callee.object.type),Z.apply(void 0,[K(Z(K(n.functionNode,"_get"),g(e.callee.object,t,r.concat(["callee","object"]),n),ee(e.callee.property.value||e.callee.property.name),Q("this")),"call"),Q("this")].concat(B(e.arguments)))}function _(e,t,r,n){return console.assert("CallExpression"===e.type),console.assert("Super"===e.callee.type),Z.apply(void 0,[K(Z(K(n.functionNode,"_get"),g(e.callee,t,r.concat(["callee"]),n),Z(K("Symbol","for"),ee("lively-instance-initialize")),Q("this")),"call"),Q("this")].concat(B(e.arguments)))}function x(e,t,r,n){return console.assert("MemberExpression"===e.type),console.assert("Super"===e.object.type),Z(K(n.functionNode,"_get"),g(e.object,t,r.concat(["object"]),n),ee(e.property.value||e.property.name),Q("this"))}function w(e,t,r,n){return console.assert("AssignmentExpression"===e.type),console.assert("Super"===e.left.object.type),Z(K(n.functionNode,"_set"),g(e.left.object,t,r.concat(["left","object"]),n),ee(e.left.property.value||e.left.property.name),e.right,Q("this"))}function k(e,t,n,i){console.assert("ClassDeclaration"===e.type||"ClassExpression"===e.type);var o=e.body.body,a=e.superClass,s=e.id,u=e.type,c=e.start,l=e.end,f=Q("undefined"),p=Q("undefined"),h=s?s.name:"anonymous_class",d=i.evalId,m=i.sourceAccessorName,g=e["x-lively-object-meta"]||{start:c,end:l};if(o.length){var b=o.reduce(function(e,t){var r,n=t.key,i=t.kind,o=t.value,a=t.static;if("Literal"!==n.type&&"Identifier"!==n.type&&console.warn("Unexpected key in classToFunctionTransform! "+JSON.stringify(n)),"method"===i){var s=Q(h+"_"+v(n.name||n.value)+"_"),u=["key",ee(n.name||n.value),"value",F({},o,C({id:s},fe,a?"static":"proto"))];r=te(u)}else if("get"===i||"set"===i)r=te(["key",ee(n.name||n.value),i,Object.assign({},o,C({id:Q(i)},fe,a?"static":"proto"))]);else if("constructor"===i){var c=["key",Z(K("Symbol","for"),ee("lively-instance-initialize")),"value",F({},o,C({id:Q(h+"_initialize_")},fe,"proto"))];r=te(c)}else console.warn("[lively.classes] classToFunctionTransform encountered unknown class property with kind "+i+", ignoring it, "+JSON.stringify(t));return(a?e.clazz:e.inst).push(r),e},{inst:[],clazz:[]}),_=b.inst,x=b.clazz;_.length&&(f={type:"ArrayExpression",elements:_}),x.length&&(p={type:"ArrayExpression",elements:x})}var w,k,E=i.scope;if(a&&i.currentModuleAccessor)if(i.classHolder===a.object)k=a,w=a.property.name;else{var S=E&&E.resolvedRefMap&&E.resolvedRefMap.get(a);S&&S.decl&&E.decls&&E.decls.find(function(e){return R(e,1)[0]===S.decl})&&(k=a,w=a.name)}var A=k?te(["referencedAs",ee(w),"value",k]):a||Q("undefined"),D=s&&"ClassDeclaration"===u,j=["start",ee(g.start),"end",ee(g.end)];void 0!==d&&j.push("evalId",ee(d)),m&&j.push("moduleSource",r.nodes.id(m));var T=te(j),O=Z(ne({},["superclass"],re(he,t.classHolder),re(pe,D?{type:"ConditionalExpression",test:oe(Z(K(he,"hasOwnProperty"),ee(s.name)),"&&",oe({argument:K(he,s),operator:"typeof",prefix:!0,type:"UnaryExpression"},"===",ee("function"))),consequent:K(he,s),alternate:X(K(he,s),y(s.name))}:y(s?s.name:null)),ie(Z(i.functionNode,Q(pe),Q("superclass"),f,p,Q(he),i.currentModuleAccessor||Q("undefined"),T))),A);if("ClassExpression"===u)return O;var B=O;return i.declarationWrapper&&t.classHolder===i.classHolder&&(B=Z(i.declarationWrapper,ee(s.name),ee("class"),B,i.classHolder,T)),B=re(s,B,"var"),B[le]=!0,B}function E(e,t,r,n){return e.declaration&&e.declaration[le]?[e.declaration,{declaration:e.declaration.declarations[0].id,type:"ExportDefaultDeclaration"}]:e}var S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},D=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),C=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},j=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},T=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},O=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},R=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),B=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},P="properties",I=Symbol.for("lively.classes-properties-and-settings"),L={defaultSetter:null,defaultGetter:null,valueStoreProperty:"_state"},N=Symbol.for("lively-instance-initialize"),M=Symbol.for("lively-instance-restorer"),q=Symbol.for("lively-instance-superclass"),$=Symbol.for("lively-module-meta"),W=Symbol.for("lively-object-meta"),U=Symbol.for("lively-klass-changes-subscriber"),G=/\([^\\)]*\)/,z={enumerable:!1,configurable:!0},V={enumerable:!1,configurable:!0,writable:!0},J="function"==typeof Object.setPrototypeOf?function(e,t){return Object.setPrototypeOf(e,t)}:function(e,t){return e.__proto__=t};d._get=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0===a?void 0:a.call(n)},d._set=function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var s=o.set;void 0!==s&&s.call(i,n)}return n};var H=Object.freeze({initializeSymbol:N,instanceRestorerSymbol:M,superclassSymbol:q,moduleMetaSymbol:$,objMetaSymbol:W,moduleSubscribeToToplevelChangesSym:U,setPrototypeOf:J,adoptObject:function(e,t){t!==e.constructor&&(e.constructor=t,J(e,t.prototype))},setSuperclass:c,initializeClass:d}),X=r.nodes.assign,K=r.nodes.member,Q=r.nodes.id,Y=r.nodes.exprStmt,Z=r.nodes.funcCall,ee=r.nodes.literal,te=r.nodes.objectLiteral,re=r.nodes.varDecl,ne=r.nodes.funcExpr,ie=r.nodes.returnStmt,oe=r.nodes.binaryExpr,ae=r.nodes.ifStmt,se=r.nodes.block,ue=/^[^_a-z]/i,ce=/[^_a-z0-9]/gi,le=Symbol(),fe=Symbol(),pe="__lively_class__",he="__lively_classholder__",de=function(e){function t(){return A(this,t),O(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return T(t,e),D(t,[{key:"accept",value:function(e,r,n){return m(e)&&(r=F({},r,{classHolder:te([]),currentMethod:e[fe]?e:r.currentMethod})),"ClassExpression"!==e.type&&"ClassDeclaration"!==e.type||(e=k(e,r,0,r.options)),"Super"===e.type&&(e=g(e,r,n,r.options)),"MemberExpression"===e.type&&e.object&&"Super"===e.object.type&&(e=x(e,r,n,r.options)),"AssignmentExpression"===e.type&&"MemberExpression"===e.left.type&&"Super"===e.left.object.type&&(e=w(e,r,n,r.options)),"CallExpression"===e.type&&"Super"===e.callee.type&&(e=_(e,r,n,r.options)),"CallExpression"===e.type&&e.callee.object&&"Super"===e.callee.object.type&&(e=b(e,r,n,r.options)),"ExportDefaultDeclaration"===(e=j(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,r,n)).type?E(e,0,0,r.options):e}}],[{key:"run",value:function(e,t){var r=new this,n=t.classHolder||te([]);return r.accept(e,{options:t,classHolder:n},[])}}]),t}(r.BaseVisitor);e.runtime=H,e.classToFunctionTransform=function(e,t){var n="string"==typeof e?r.parse(e):e;return t.scope=r.query.resolveReferences(r.query.scopes(n)),de.run(n,t)}}(this.lively.classes=this.lively.classes||{},lively.lang,lively.ast),"undefined"!=typeof module&&module.exports&&(module.exports=e.lively.classes)}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;void 0===lively.lang&&(e.livey.lang={})}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(e,t,r,n){"use strict";function i(e,t){var r=G(e),i=r.refs.filter(function(e){return l(e,r,t)}),o=[],a=n.ReplaceVisitor.run(e,function(e,r){if("Property"===e.type&&i.includes(e.key)&&e.shorthand)return P(N(e.key.name),e.value);if("ExportNamedDeclaration"===e.type){var n=e.declaration,a=e.specifiers;return n&&(n.id?o.push(n.id):n.declarations&&o.push.apply(o,R(n.declarations.map(function(e){return e.id})))),a&&a.forEach(function(e){var t=e.local;return o.push(t)}),e}return"AssignmentExpression"===e.type&&i.includes(e.left)&&t.declarationWrapper?O({},e,{right:T(t.declarationWrapper,null,M(e.left.name),M("assignment"),e.right,t.captureObj,t)}):e});return n.ReplaceVisitor.run(a,function(e,r,n){return i.includes(e)&&!o.includes(e)?B(t.captureObj,e):e})}function o(e,t){var r=G(e);return n.ReplaceManyVisitor.run(e,function(e){if(!r.varDecls.includes(e)||e.declarations.every(function(e){return!c(e,t)}))return e;for(var n=[],i=0;i<e.declarations.length;i++){var o=e.declarations[i];if(c(o,t)){var s=o.init||{operator:"||",type:"LogicalExpression",left:{computed:!1,object:t.captureObj,property:o.id,type:"MemberExpression"},right:{name:"undefined",type:"Identifier"}},u=t.declarationWrapper&&o.id.name?T(t.declarationWrapper,o,M(o.id.name),M(e.kind),s,t.captureObj,t):s;if(o.id.type.includes("Pattern")){var l=a(r.declaredNames,"destructured_1"),f={type:"Identifier",name:l},p={parent:f,declaredNames:r.declaredNames},h=_(o.id,p).map(function(r){return r[V]&&r[V].capture?E(t.captureObj,r.declarations[0].id,t.declarationWrapper?T(t.declarationWrapper,null,M(r.declarations[0].id.name),M(e.kind),r.declarations[0].init,t.captureObj,t):r.declarations[0].init,!1):r});r.declaredNames.push(l),n.push.apply(n,R([I(f,u,e.kind)].concat(h)))}else n.push(E(t.captureObj,o.id,u,!1)),t.keepTopLevelVarDecls&&n.push(I(o.id,B(t.captureObj,o.id)))}else n.push({type:"VariableDeclaration",kind:e.kind||"var",declarations:[o]})}return n})}function a(e,t){for(var r=t,n=1;e.indexOf(r)>-1;){if(n>1e3)throw new Error("Endless loop searching for unique variable "+r);r=r.replace(/_[0-9]+$|$/,"_"+ ++n)}return r}function s(e,r){for(var n=G(e),i=[],o=0;o<n.scope.varDecls.length;o++){var a=n.scope.varDecls[o],s=t.Path(n.scope.varDeclPaths[o]).slice(0,-1).get(e);"ForStatement"!==s.type&&"ForInStatement"!==s.type&&"ForOfStatement"!==s.type&&"ExportNamedDeclaration"!==s.type||i.push.apply(i,R(a.declarations))}return n.scope.catches.map(function(e){return e.name}).concat(i.map(function(e){return e.id.name}))}function u(e,r){for(var n=G(e),i=[],o=0;o<n.scope.varDecls.length;o++){var a=n.scope.varDecls[o],s=t.Path(n.scope.varDeclPaths[o]).slice(0,-1).get(e);"ForStatement"!==s.type&&"ForInStatement"!==s.type&&"ForOfStatement"!==s.type||i.push.apply(i,R(a.declarations))}return n.scope.catches.map(function(e){return e.name}).concat(z.declIds(i.map(function(e){return e.id})).map(function(e){return e.name}))}function c(e,t){return-1===t.excludeDecls.indexOf(e.id.name)&&(!t.includeDecls||t.includeDecls.indexOf(e.id.name)>-1)}function l(e,t,r){if(t.scope.importSpecifiers.includes(e))return!1;for(var n=0;n<t.scope.exportDecls.length;n++){var i=t.scope.exportDecls[n];if(i.declarations&&i.declarations.includes(e))return!1;if(i.declaration===e)return!1}return!r.excludeRefs.includes(e.name)&&!(r.includeRefs&&!r.includeRefs.includes(e.name))}function f(e,t){if(t.classToFunction)return r.classToFunctionTransform(e,t.classToFunction);var n=G(e);if(!n.classDecls.length)return e;for(var i=e.body.length-1;i>=0;i--){var o=e.body[i];o.id&&n.classDecls.includes(o)&&e.body.splice(i+1,0,E(t.captureObj,o.id,o.id,!1))}return e}function p(e,t){for(var r=e.body,n=e.body=[],i=0;i<r.length;i++){var o=r[i];if("ExportNamedDeclaration"!==o.type||!o.declaration||"VariableDeclaration"!==o.declaration.type||o.declaration.declarations.length<=1)n.push(o);else for(var a=o.declaration.declarations,s=0;s<a.length;s++)n.push({type:"ExportNamedDeclaration",specifiers:[],declaration:I(a[s].id,a[s].init,o.declaration.kind)})}return e}function h(e,r){for(var n=[],i=0;i<e.body.length;i++){var o=e.body[i];if(n.push(o),"ExportNamedDeclaration"!==o.type&&"ExportDefaultDeclaration"!==o.type||!o.declaration);else if("ExportDefaultDeclaration"===o.type&&"Literal"===o.declaration.type){var s=o.declaration,u=(s.raw,a(G(e).declaredNames,"$"+s.raw.split('"').join("")));o.declaration=N(u),t.arr.pushAt(n,E(r.captureObj,u,s.raw,!1),n.indexOf(o))}else o.declaration.declarations?n.push.apply(n,R(o.declaration.declarations.map(function(e){var t=e.id;return r.declarationWrapper&&(e.init.callee&&e.init.callee.name===r.declarationWrapper.name||(t=T(r.declarationWrapper,e,M(e.id.name),M("assignment"),e.id,r.captureObj,r))),E(r.captureObj,e.id,t,!1)}))):"FunctionDeclaration"===o.declaration.type||"ClassDeclaration"===o.declaration.type&&n.push(E(r.captureObj,o.declaration.id,o.declaration.id,!1))}return e.body=n,e}function d(e,t){return e.body=e.body.reduce(function(e,r){return e.concat("ImportDeclaration"===r.type&&r.specifiers.length?[r].concat(r.specifiers.map(function(e){return E(t.captureObj,e.local,e.local,!1)})):[r])},[]),e}function m(e,t){for(var r=G(e),n=[],i=0;i<e.body.length;i++){var o=e.body[i];"ExportDefaultDeclaration"!==o.type||!o.declaration||o.declaration.type.includes("Declaration")||"Identifier"!==o.declaration.type&&!o.declaration.id?"ExportNamedDeclaration"!==o.type||!o.specifiers.length||o.source?n.push(o):n=n.concat(o.specifiers.map(function(n){return r.declaredNames.includes(n.local.name)?null:k(e,{type:"VariableDeclarator",id:n.local,init:B(t.captureObj,n.local)})}).filter(Boolean)).concat(o):n=n.concat([k(e,{type:"VariableDeclarator",id:o.declaration,init:B(t.captureObj,o.declaration)}),o])}return e.body=n,e}function v(e,t){for(var r=[],n=0;n<e.body.length;n++){var i=e.body[n];"ExportDefaultDeclaration"===i.type&&"FunctionDeclaration"===i.declaration.type&&i.declaration.id&&i.declaration.async&&(r.push(i.declaration),i.declaration={type:"Identifier",name:i.declaration.id.name}),r.push(i)}return e.body=r,e}function y(e,t){return e.body=e.body.reduce(function(r,n){var i;if("ExportNamedDeclaration"===n.type)if(n.source){a=s=n.source;i=n.specifiers.map(function(e){return{type:"ExpressionStatement",expression:S({type:"Literal",value:e.exported.name},{type:"Literal",value:e.local.name},s,t.moduleExportFunc,t.moduleImportFunc)}})}else if(n.declaration){var o=n.declaration.declarations;i=o?o.map(function(e){return t.excludeDecls.push(e.id),I(e.id,E(t.captureObj,e.id,t.declarationWrapper?T(t.declarationWrapper,null,M(e.id.name),M(n.declaration.kind),e,t.captureObj,t):e.init,!1),n.declaration.kind)}).concat(o.map(function(e){return j(t.moduleExportFunc,e.id.name,e.id)})):[n.declaration].concat(j(t.moduleExportFunc,n.declaration.id.name,n.declaration.id))}else i=n.specifiers.map(function(e){return j(t.moduleExportFunc,e.exported.name,c({id:e.local},t)?B(t.captureObj,e.local):e.local)});else if("ExportDefaultDeclaration"===n.type)i=n.declaration&&n.declaration.id?[n.declaration].concat(j(t.moduleExportFunc,"default",n.declaration.id)):[j(t.moduleExportFunc,"default",n.declaration)];else if("ExportAllDeclaration"===n.type){var a={name:t.es6ExportFuncId+"__iterator__",type:"Identifier"},s=n.source;i=[{type:"ForInStatement",body:{type:"ExpressionStatement",expression:S(a,a,s,t.moduleExportFunc,t.moduleImportFunc)},left:{type:"VariableDeclaration",kind:"var",declarations:[{type:"VariableDeclarator",id:a,init:null}]},right:D(null,s,t.moduleImportFunc)}],t.excludeRefs.push(a.name),t.excludeDecls.push(a.name)}else i="ImportDeclaration"===n.type?n.specifiers.length?n.specifiers.map(function(r){var i=r.local,o="ImportSpecifier"===r.type&&r.imported.name||"ImportDefaultSpecifier"===r.type&&"default"||null;return A(e,i,o||null,n.source,t.moduleImportFunc)}):C(null,n.source,t.moduleImportFunc):[n];return r.concat(i)},[]),e}function g(e,r){var n=G(e).scope,i=n.funcDecls;if(!i.length)return e;for(var o=[],a=i.length;a--;){var s=i[a];if(s.id&&c(s,r)){var u=n.funcDeclPaths[a].slice(0,-1),l=t.Path(u).get(n.node),f={type:"Identifier",name:s.id.name},p=r.declarationWrapper?T(r.declarationWrapper,s,M(f.name),M("function"),f,r.captureObj,r):f,h=O({},s);if(Array.isArray(l))l.splice(l.indexOf(s),1,q(s.id));else if("ExportNamedDeclaration"===l.type){var d=n.node.body.indexOf(l);d>-1&&n.node.body.splice(d,1,{type:"ExportNamedDeclaration",specifiers:[{type:"ExportSpecifier",exported:s.id,local:s.id}]})}else"ExportDefaultDeclaration"===l.type&&(l.declaration=s.id);o.unshift(E(r.captureObj,f,p,!1)),o.unshift(h)}}return e.body=o.concat(e.body),e}function b(e,r){var n=G(e);return t.chain(n.scope.varDecls).pluck("declarations").flatten().value().concat(n.scope.funcDecls.filter(function(e){return e.id})).reduce(function(e,t){return e[t.id.name]||(e[t.id.name]=[]),e[t.id.name].push({type:t.type,start:t.start,end:t.end}),e},{})}function _(e,t){return"ArrayPattern"===e.type?x(e,t):"ObjectPattern"===e.type?w(e,t):[]}function x(e,t){for(var r=t.declaredNames,n=V,i=[],o=0;o<e.elements.length;o++){var s=e.elements[o];if("Identifier"===s.type)(u=I(s,B(t.parent,N(o),!0)))[n]={capture:!0},i.push(u);else if("RestElement"===s.type)(u=I(s.argument,{type:"CallExpression",arguments:[{type:"Literal",value:o}],callee:B(t.parent,N("slice"),!1)}))[n]={capture:!0},i.push(u);else if("AssignmentPattern"==s.type){var u=I(s.left,$(W(B(t.parent,N(o),!0),"===",N("undefined")),s.right,B(t.parent,N(o),!0)));u[n]={capture:!0},i.push(u)}else{var c=N(a(r,t.parent.name+"$"+o)),l=I(c,B(t.parent,o));r.push(c.name),i.push(l),i.push.apply(i,R(_(s,{parent:c,declaredNames:r})))}}return i}function w(e,t){for(var r=t.declaredNames,i=V,o=[],s=0;s<e.properties.length;s++){var u=e.properties[s];if("RestElement"==u.type){var c=e.properties.map(function(e){return e.key&&e.key.name}).filter(Boolean),l=n.nodes.varDecl(u.argument.name,n.nodes.objectLiteral([])),f=n.nodes.varDecl(u.argument.name,N(u.argument.name)),p=n.nodes.exprStmt(n.nodes.funcCall(n.nodes.funcExpr({},[],n.nodes.forIn("__key",t.parent,n.nodes.block.apply(n.nodes,R(c.length?c.map(function(e){return n.nodes.ifStmt(n.nodes.binaryExpr(n.nodes.id("__key"),"===",n.nodes.literal(e)),{type:"ContinueStatement",label:null},null)}):[]).concat([n.nodes.exprStmt(n.nodes.assign(n.nodes.member(u.argument.name,n.nodes.id("__key"),!0),n.nodes.member(t.parent,n.nodes.id("__key"),!0)))]))))));f[i]={capture:!0},o.push(l,f,p)}else if("Identifier"==u.value.type)(l=I(u.value,B(t.parent,u.key)))[i]={capture:!0},o.push(l);else if("AssignmentPattern"==u.value.type)(l=I(u.value.left,$(W(B(t.parent,u.key),"===",N("undefined")),u.value.right,B(t.parent,u.key))))[i]={capture:!0},o.push(l);else{var h=N(a(r,t.parent.name+"$"+u.key.name)),d=I(h,B(t.parent,u.key));d[i]={capture:!1},r.push(h.name),o.push.apply(o,R([d].concat(_(u.value,{parent:h,declaredNames:r}))))}}return o}function k(e,t,r){var n=G(e),i=t.id.name;return n.declaredNames.indexOf(i)>-1?q(L(t.id,t.init)):{declarations:[t],kind:r||"var",type:"VariableDeclaration"}}function E(e,t,r,n){return q(L(B(e,t,n),r||N("undefined")))}function S(e,t,r,n,i){return F(n,e,D(t,r,i))}function A(e,t,r,n,i){return I(t,D(r,n,i))}function D(e,t,r){return"string"==typeof e&&(e=M(e)),{arguments:[t].concat(e||[]),callee:r,type:"CallExpression"}}function C(e,t,r){return q(D(e,t,r))}function F(e,r,n){return"string"==typeof r&&(r=M(r)),n=t.obj.deepCopy(n),U(e,r,n)}function j(e,t,r){return q(F(e,t,r))}function T(e,t,r,i,o,a,s){if(t){var u=[],c=!1;if(t["x-lively-object-meta"]){var l=t["x-lively-object-meta"],f=l.start,p=l.end,h=l.evalId,d=l.sourceAccessorName;c=!0,u.push("start",n.nodes.literal(f),"end",n.nodes.literal(p))}if(void 0===h&&s.hasOwnProperty("evalId")&&(h=s.evalId,c=!0),void 0===d&&s.hasOwnProperty("sourceAccessorName")&&(d=s.sourceAccessorName,c=!0),void 0!==h&&u.push("evalId",n.nodes.literal(h)),d&&u.push("moduleSource",n.nodes.id(d)),c)return U(e,r,i,o,a,n.nodes.objectLiteral(u))}return U(e,r,i,o,a)}var O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},R=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},B=n.nodes.member,P=n.nodes.prop,I=n.nodes.varDecl,L=n.nodes.assign,N=n.nodes.id,M=n.nodes.literal,q=n.nodes.exprStmt,$=n.nodes.conditional,W=n.nodes.binaryExpr,U=n.nodes.funcCall,G=n.query.topLevelDeclsAndRefs,z=n.query.helpers,V=Symbol("lively.ast-destructuring-transform"),J=Object.freeze({rewriteToCaptureTopLevelVariables:function(e,r,n){r||(r={type:"Identifier",name:"__rec"});var a=e;if((n=O({ignoreUndeclaredExcept:null,includeRefs:null,excludeRefs:n&&n.exclude||[],includeDecls:null,excludeDecls:n&&n.exclude||[],recordDefRanges:!1,es6ExportFuncId:null,es6ImportFuncId:null,captureObj:r,moduleExportFunc:{name:n&&n.es6ExportFuncId||"_moduleExport",type:"Identifier"},moduleImportFunc:{name:n&&n.es6ImportFuncId||"_moduleImport",type:"Identifier"},declarationWrapper:void 0,classToFunction:n&&n.hasOwnProperty("classToFunction")?n.classToFunction:{classHolder:r,functionNode:{type:"Identifier",name:"_createOrExtendClass"},declarationWrapper:n&&n.declarationWrapper,evalId:n&&n.evalId,sourceAccessorName:n&&n.sourceAccessorName}},n)).ignoreUndeclaredExcept){var c=G(e);n.excludeRefs=t.arr.withoutAll(c.undeclaredNames,n.ignoreUndeclaredExcept).concat(n.excludeRefs),n.excludeDecls=t.arr.withoutAll(c.undeclaredNames,n.ignoreUndeclaredExcept).concat(n.excludeDecls)}n.excludeRefs=n.excludeRefs.concat(n.captureObj.name),n.excludeDecls=n.excludeDecls.concat(n.captureObj.name);n.recordDefRanges&&b(a);return n.excludeRefs=n.excludeRefs.concat(u(e)),n.excludeDecls=n.excludeDecls.concat(s(e)),a=v(a),n.es6ExportFuncId&&(n.excludeRefs.push(n.es6ExportFuncId),n.excludeRefs.push(n.es6ImportFuncId),a=y(a,n)),a=i(a,n),a=o(a,n),a=f(a,n),a=p(a),a=h(a,n),a=d(a,n),a=m(a,n),a=g(a,n)},rewriteToRegisterModuleToCaptureSetters:function(e,r,i){i=O({captureObj:r||{type:"Identifier",name:"__rec"},exclude:[],declarationWrapper:void 0},i);var o=t.Path("body.0.expression").get(e);if("System"!==o.callee.object.name)throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call: "+n.stringify(e).slice(0,300)+"...");if("register"!==o.callee.property.name)throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call: "+n.stringify(e).slice(0,300)+"...");var a=t.Path("arguments.1.body.body").get(o),s=t.arr.last(a);if("ReturnStatement"!==s.type)throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call, at return statement: "+n.stringify(e).slice(0,300)+"...");var u=s.argument.properties.find(function(e){return"setters"===e.key.name});if(!u)throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call, at finding setters: "+n.stringify(e).slice(0,300)+"...");var c=s.argument.properties.find(function(e){return"execute"===e.key.name});if(!c)throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call, at finding execute: "+n.stringify(e).slice(0,300)+"...");u.value.elements.forEach(function(e){return e.body.body=e.body.body.map(function(e){if("ExpressionStatement"!==e.type||"AssignmentExpression"!==e.expression.type||"Identifier"!==e.expression.left.type||t.arr.include(i.exclude,e.expression.left.name))return e;var r=e.expression.left,n=i.declarationWrapper?T(i.declarationWrapper,null,M(r.name),M("var"),e.expression,i.captureObj,i):e.expression;return q(L(B(i.captureObj,r),n))})});var l=c.value.body.body.find(function(e){return"ExpressionStatement"===e.type&&"AssignmentExpression"==e.expression.type&&e.expression.left.name===i.captureObj.name});if(l||(l=c.value.body.body.find(function(e){return"VariableDeclaration"===e.type&&e.declarations[0].id&&e.declarations[0].id.name===i.captureObj.name})),l&&(t.arr.remove(c.value.body.body,l),t.arr.pushAt(a,l,a.length-1)),i.sourceAccessorName){var f=c.value.body.body.find(function(e){return"ExpressionStatement"===e.type&&"AssignmentExpression"==e.expression.type&&e.expression.left.name===i.sourceAccessorName});f||(f=c.value.body.body.find(function(e){return"VariableDeclaration"===e.type&&e.declarations[0].id&&e.declarations[0].id.name===i.sourceAccessorName})),f&&(t.arr.remove(c.value.body.body,f),t.arr.pushAt(a,f,a.length-1))}return e}});e.capturing=J,e.stringifyFunctionWithoutToplevelRecorder=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"__lvVarRecorder";"function"==typeof e&&(e=String(e));var r="string"==typeof e?n.parseFunction(e):e,i=n.ReplaceVisitor.run(r,function(e){return"MemberExpression"===e.type&&"Identifier"===e.object.type&&e.object.name===t?e.property:e});return n.stringify(i)}}(this.lively.sourceTransform=this.lively.sourceTransform||{},lively.lang,lively.classes,lively.ast),"undefined"!=typeof module&&module.exports&&(module.exports=e.lively.sourceTransform)}(),function(){var GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(exports,lively_lang,lively_ast,lively_sourceTransform,lively_classes,lively_notifications){"use strict";function getGlobal(){return"undefined"!=typeof System?System.global:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof Global?Global:"undefined"!=typeof self?self:function(){return this}()}function signatureOf(e,t){var r=String(t).match(/function\s*[a-zA-Z0-9_$]*\s*\(([^\)]*)\)/);return e+"("+(r&&r[1]||"")+")"}function pluck(e,t){return e.map(function(e){return e[t]})}function printSymbol(e){if(Symbol.keyFor(e))return'Symbol.for("'+Symbol.keyFor(e)+'")';if(knownSymbols.get(e))return knownSymbols.get(e);String(e).match(symMatcher);return String(e)}function safeToString(e){if(!e)return String(e);if(Array.isArray(e))return"["+e.map(safeToString).join(",")+"]";if("symbol"===(void 0===e?"undefined":_typeof(e)))return printSymbol(e);try{return String(e)}catch(e){throw new Error("Cannot print object: "+e.stack)}}function printEvalResult(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.value,n=e.isError,i=e.isPromise,o=e.promisedValue,a=e.promiseStatus;if(n||r instanceof Error){var s=r,u=String(s),c=s.stack||"";return c&&s.message!==s.stack&&(0===(c=String(c)).indexOf(u)&&(c=c.slice(u.length)),u+="\n"+c),u}if(i){var l=lively_lang.string.print(a),f="pending"===a?void 0:printEvalResult({value:o},t);return"Promise({status: "+l+", "+(void 0===r?"":"value: "+f)+"})"}return r instanceof Promise?'Promise({status: "unknown"})':t.inspect?printInspectEvalValue(r,t.inspectDepth||2):String(r)}function getObjectForCompletion(e,t){var r="";return Promise.resolve().then(function(){var n=t.lastIndexOf(".");return n>=0?(r=t.slice(n+1),t=t.slice(0,n)):(r=t,t='(typeof window === "undefined" ? global : window)'),e(t)}).then(function(e){return{evalResult:e,startLetters:r,code:t}})}function propertyExtract(e,t,r){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t).map(printSymbol)).filter(function(t){return-1===e.indexOf(t)}).map(r).filter(function(e){return!!e}).sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})}function getMethodsOf(e,t){return propertyExtract(e,t,function(e){return t.__lookupGetter__&&t.__lookupGetter__(e)||"function"!=typeof t[e]?null:{name:e,completion:signatureOf(e,t[e])}})}function getAttributesOf(e,t){return propertyExtract(e,t,function(e){return t.__lookupGetter__&&!t.__lookupGetter__(e)&&"function"==typeof t[e]?null:{name:e,completion:e}})}function getProtoChain(e){for(var t=[];e;)t.push(e),e=e.__proto__;return t}function getDescriptorOf(e,t){function r(e,t){return e.length>t&&(e=e.slice(0,t)+"..."),e.replace(/\n/g,"").replace(/\s+/g," ")}if(e===t){if("function"!=typeof e)return r(safeToString(e),50);var n=e.toString(),i=r(n.slice(n.indexOf("{")+1,n.lastIndexOf("}")),50);return signatureOf(e.displayName||e.name||"function",e)+" {"+i+"}"}var o=t.hasOwnProperty("constructor")&&t.constructor;return o?"string"==typeof o.type&&o.type.length?r(o.type,50):"string"==typeof o.name&&o.name.length?r(o.name,50):"anonymous class":"prototype"}function descriptorsOfObjAndProtoProperties(e){var t=[];return getProtoChain(e).map(function(r){var n=getDescriptorOf(e,r),i=getMethodsOf(t,r).concat(getAttributesOf(t,r));return t=t.concat(pluck(i,"name")),[n,pluck(i,"completion")]})}function getCompletions(e,t,r){var n=getObjectForCompletion(e,t).then(function(e){var t=e.evalResult,r={completions:descriptorsOfObjAndProtoProperties(t&&t.isEvalResult?t.value:t),startLetters:e.startLetters,code:e.code};return t&&t.isPromise&&("fulfilled"===t.promiseStatus?r.promiseResolvedCompletions=descriptorsOfObjAndProtoProperties(t.promisedValue):"rejected"===t.promiseStatus&&(r.promiseRejectedCompletions=descriptorsOfObjAndProtoProperties(t.promisedValue))),r});return"function"==typeof r&&n.then(function(e){return r(null,e)}).catch(function(e){return r(e)}),n}function processInlineCodeTransformOptions(parsed,options){if(!parsed.comments)return options;var livelyComment=parsed.comments.find(function(e){return e.text.startsWith("lively.vm ")});if(!livelyComment)return options;try{var inlineOptions=eval("inlineOptions = {"+livelyComment.text.slice("lively.vm ".length)+"};");return Object.assign(options,inlineOptions)}catch(e){return options}}function evalCodeTransform(e,t){e=lively_ast.transform.transformSingleExpression(e);var r=lively_ast.parse(e,{withComments:!0});t=processInlineCodeTransformOptions(r,t);var n=lively_ast.query.topLevelDeclsAndRefs(r),i=n.classDecls,o=n.funcDecls,a=n.varDecls,s={};if(t.hasOwnProperty("evalId")&&(s.evalId=t.evalId),t.sourceAccessorName&&(s.sourceAccessorName=t.sourceAccessorName),[].concat(toConsumableArray(i),toConsumableArray(o)).forEach(function(e){return e["x-lively-object-meta"]=_extends({},s,{start:e.start,end:e.end})}),a.forEach(function(e){return e.declarations.forEach(function(e){return e["x-lively-object-meta"]=_extends({},s,{start:e.start,end:e.end})})}),r=lively_ast.transform.objectSpreadTransform(r),!t.topLevelVarRecorder&&t.topLevelVarRecorderName){var u=getGlobal();"GLOBAL"===t.topLevelVarRecorderName?t.topLevelVarRecorder=getGlobal():t.topLevelVarRecorder=lively_lang.Path(t.topLevelVarRecorderName).get(u)}if(t.topLevelVarRecorder){var c=(t.dontTransform||[]).concat(["arguments"]),l=t.recordGlobals?null:lively_lang.arr.withoutAll(Object.keys(t.topLevelVarRecorder),c),f=id(t.varRecorderName||"__lvVarRecorder"),p=void 0;if(t.declarationWrapperName||"function"==typeof t.declarationCallback){var h=t.declarationWrapperName||defaultDeclarationWrapperName;t.declarationWrapper=member(id(t.varRecorderName||"__lvVarRecorder"),literal(h),!0),t.declarationCallback&&(t.topLevelVarRecorder[h]=t.declarationCallback)}(!t.hasOwnProperty("transformES6Classes")||t.transformES6Classes)&&(defaultClassToFunctionConverterName in t.topLevelVarRecorder||(t.topLevelVarRecorder[defaultClassToFunctionConverterName]=lively_classes.runtime.initializeClass),p={currentModuleAccessor:t.currentModuleAccessor,classHolder:f,functionNode:member(f,defaultClassToFunctionConverterName),declarationWrapper:t.declarationWrapper,evalId:t.evalId,sourceAccessorName:t.sourceAccessorName}),r=lively_sourceTransform.capturing.rewriteToCaptureTopLevelVariables(r,f,{es6ImportFuncId:t.es6ImportFuncId,es6ExportFuncId:t.es6ExportFuncId,ignoreUndeclaredExcept:l,exclude:c,declarationWrapper:t.declarationWrapper||void 0,classToFunction:p,evalId:t.evalId,sourceAccessorName:t.sourceAccessorName,keepTopLevelVarDecls:t.keepTopLevelVarDecls})}t.wrapInStartEndCall&&(r=lively_ast.transform.wrapInStartEndCall(r,{startFuncNode:t.startFuncNode,endFuncNode:t.endFuncNode}));var d=lively_ast.stringify(r);return t.sourceURL&&(d+="\n//# sourceURL="+t.sourceURL.replace(/\s/g,"_")),d}function evalCodeTransformOfSystemRegisterSetters(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t.topLevelVarRecorder)return e;if("function"==typeof t.declarationCallback||t.declarationWrapperName){var r=t.declarationWrapperName||defaultDeclarationWrapperName;t.declarationWrapper=member(id(t.varRecorderName),literal(r),!0),t.declarationCallback&&(t.topLevelVarRecorder[r]=t.declarationCallback)}var n=lively_ast.parse(e),i=(t.dontTransform||[]).concat(["arguments"]),o=(t.recordGlobals||lively_lang.arr.withoutAll(Object.keys(t.topLevelVarRecorder),i),lively_sourceTransform.capturing.rewriteToRegisterModuleToCaptureSetters(n,id(t.varRecorderName||"__lvVarRecorder"),_extends({exclude:i},t)));return lively_ast.stringify(o)}function _normalizeEvalOptions(e){if(e||(e={}),(e=_extends({targetModule:null,sourceURL:e.targetModule,runtime:null,context:getGlobal(),varRecorderName:defaultTopLevelVarRecorderName,dontTransform:[],recordGlobals:null,returnPromise:!0,promiseTimeout:200,waitForPromise:!0,wrapInStartEndCall:!1,onStartEval:null,onEndEval:null},e)).targetModule){var t=e.runtime&&e.runtime.modules&&e.runtime.modules[e.targetModule];t&&(e=Object.assign(e,t))}return e.wrapInStartEndCall&&(e.startFuncNode={type:"MemberExpression",object:{type:"Identifier",name:e.varRecorderName},property:{type:"Literal",value:startEvalFunctionName},computed:!0},e.endFuncNode={type:"MemberExpression",object:{type:"Identifier",name:e.varRecorderName},property:{type:"Literal",value:endEvalFunctionName},computed:!0}),e}function _eval(__lvEvalStatement,__lvVarRecorder,__lvOriginalCode){return eval(__lvEvalStatement)}function runEval$1(e,t,r){"function"==typeof t&&2===arguments.length&&(r=t,t=null);var n,i,o=new EvalResult,a=!1,s=!1;t=_normalizeEvalOptions(t);var u=lively_lang.promise.deferred(),c=t.topLevelVarRecorder||getGlobal(),l=e;t.wrapInStartEndCall&&(c[startEvalFunctionName]&&console.warn(o.addWarning("startEvalFunctionName "+startEvalFunctionName+" already exists in recorder!")),c[endEvalFunctionName]&&console.warn(o.addWarning("endEvalFunctionName "+endEvalFunctionName+" already exists in recorder!")),c[startEvalFunctionName]=function(){a?console.warn(o.addWarning("onEvalStartCalled multiple times!")):(a=!0,"function"==typeof t.onStartEval&&t.onStartEval())},c[endEvalFunctionName]=function(e,n){s?console.warn(o.addWarning("onEvalEndCalled multiple times!")):(s=!0,finishEval(e,n,o,t,c,u,r))});try{e=evalCodeTransform(e,t),t.header&&(e=t.header+e),t.footer&&(e+=t.footer),t.transpiler&&(e=t.transpiler(e,t.transpilerOptions))}catch(e){console.warn(o.addWarning("lively.vm evalCodeTransform not working: "+e))}try{"undefined"!=typeof $world&&$world.get("log")&&($world.get("log").textString=e),i=_eval.call(t.context,e,t.topLevelVarRecorder,t.originalSource||l)}catch(e){n=e}return t.wrapInStartEndCall?n&&!s&&c[endEvalFunctionName](n,void 0):finishEval(n,n||i,o,t,c,u,r),t.sync?o:u.promise}function finishEval(e,t,r,n,i,o,a){n.wrapInStartEndCall&&(delete i[startEvalFunctionName],delete i[endEvalFunctionName]),e?(r.isError=!0,r.value=e):r.value=t,r.value instanceof Promise&&(r.isPromise=!0),n.sync?(r.processSync(n),"function"==typeof n.onEndEval&&n.onEndEval(e,t)):r.process(n).then(function(){return"function"==typeof a&&a(null,r),"function"==typeof n.onEndEval&&n.onEndEval(e,t),r},function(e){return"function"==typeof a&&a(e,void 0),"function"==typeof n.onEndEval&&n.onEndEval(e,void 0),r}).then(o.resolve,o.reject)}function syncEval$1(e,t){return t=Object.assign(t||{},{sync:!0}),runEval$1(e,t)}function tryToWaitForPromise(e,t){console.assert(e.isPromise,"no promise in tryToWaitForPromise???");var r={},n=new Promise(function(e){return setTimeout(e,t,r)});return Promise.race([n,e.value]).then(function(t){return Object.assign(e,t!==r?{promiseStatus:"fulfilled",promisedValue:t}:{promiseStatus:"pending"})}).catch(function(t){return Object.assign(e,{promiseStatus:"rejected",promisedValue:t})})}function ensureImportsAreImported(e,t,r){var n=lively_ast.parse(t).body.filter(function(e){return"ImportDeclaration"===e.type});return Promise.all(n.map(function(t){return e.normalize(t.source.value,r).then(function(t){return e.get(t)||e.import(t)})})).catch(function(e){throw console.error("Error ensuring imports: "+e.message),e})}function hasUnimportedImports(e,t,r){var n=lively.ast.parse(t).body.filter(function(e){return"ImportDeclaration"===e.type});return lively_lang.arr.uniq(n.map(function(e){return e.source.value})).filter(Boolean).filter(function(t){return!e.get(e.decanonicalize(t,r))}).length>0}function babelTranspilerForAsyncAwaitCode(e,t,r,n){return function(e,n){n=Object.assign({sourceMap:void 0,inputSourceMap:void 0,filename:r,code:!0,ast:!1},n);var i="(async function(__rec) {\n"+e+"\n}).call(this);",o=t.transform(i,n).code;return o=o.replace(/\}\)\.call\(undefined\);$/,"}).call(this)")}}function babelPluginTranspilerForAsyncAwaitCode(e,t,r,n){return function(n,i){var o=e.babelOptions||{},a=[];a.push(t.presetES2015),o.stage3&&a.push({plugins:t.pluginsStage3}),o.stage2&&a.push({plugins:t.pluginsStage2}),o.stage1&&a.push({plugins:t.pluginsStage1}),i=Object.assign({sourceMap:void 0,inputSourceMap:void 0,filename:r,babelrc:!1,presets:a,moduleIds:!1,code:!0,ast:!1},i);var s="(async function(__rec) {\n"+n+"\n}).call(this);",u=t.babel.transform(s,i).code;return u=u.replace(/\}\)\.call\(undefined\);$/,"}).call(this)")}}function getEs6Transpiler(e,t,r){if(t.transpiler)return t.transpiler;if(!t.es6Transpile)return null;if("babel"===e.transpiler){var n=e.global[e.transpiler]||e.get(e.decanonicalize(e.transpiler));return n?babelTranspilerForAsyncAwaitCode(e,n,t.targetModule,r):e.import(e.transpiler).then(function(n){return babelTranspilerForAsyncAwaitCode(e,n,t.targetModule,r)})}if("plugin-babel"===e.transpiler){var i=e.decanonicalize("plugin-babel").split("/").slice(0,-1).concat("systemjs-babel-browser.js").join("/"),o=e.get(i);return o?babelPluginTranspilerForAsyncAwaitCode(e,o,t.targetModule,r):e.import(i).then(function(n){return babelPluginTranspilerForAsyncAwaitCode(e,n,t.targetModule,r)})}if("lively.transpiler"===e.transpiler){var a=new(0,e.get(e.decanonicalize("lively.transpiler")).default)(e,t.targetModule,r);return function(e,t){return a.transpileDoit(e,t)}}throw new Error("Sorry, currently only babel is supported as es6 transpiler for runEval!")}function runEval$2(e,t,r){r=_extends({targetModule:null,parentModule:null,es6Transpile:!0,transpiler:null,transpilerOptions:null,format:"esm"},r);var n=t;e.debug&&console.log("[lively.module] runEval: "+t.slice(0,100).replace(/\n/gm," ")+"...");var i=r,o=i.format,a=i.targetModule,s=i.parentModule;if(a=e.decanonicalize(a||"*scratch*",s),r.targetModule=a,o){var u=e.getConfig().meta[a];u||(u={}),u[a]||(u[a]={}),u[a].format||(u[a].format=o,e.config(u))}var c=e.get("@lively-env").moduleEnv(a),l=c.recorder,f=c.recorderName,p=c.dontTransform,h=getEs6Transpiler(e,r,c),d="var _moduleExport = "+f+"._moduleExport,\n    _moduleImport = "+f+"._moduleImport;\n";if(!(r=_extends({waitForPromise:!0,sync:!1,evalId:r.evalId||c.nextEvalId(),sourceAccessorName:!r.hasOwnProperty("embedOriginalCode")||r.embedOriginalCode?"__lvOriginalCode":void 0,originalSource:n},r,{header:d,recordGlobals:!0,dontTransform:p,varRecorderName:f,topLevelVarRecorder:l,sourceURL:r.sourceURL||r.targetModule,context:r.context||l,wrapInStartEndCall:!0,es6ExportFuncId:"_moduleExport",es6ImportFuncId:"_moduleImport",transpiler:h,declarationWrapperName:c.varDefinitionCallbackName,currentModuleAccessor:funcCall(member$1(funcCall(member$1(member$1("__lvVarRecorder","System"),"get"),literal$1("@lively-env")),"moduleEnv"),literal$1(r.targetModule))})).sync&&!r.importsEnsured&&hasUnimportedImports(e,t,a))return ensureImportsAreImported(e,t,a).then(function(){return runEval$2(e,n,_extends({},r,{importsEnsured:!0}))});if(!c.record()){if(!r.sync&&!r._moduleImported)return e.import(a).catch(function(e){return null}).then(function(){return runEval$2(e,n,_extends({},r,{_moduleImported:!0}))});c.ensureRecord()}if(r.es6Transpile&&r.transpiler instanceof Promise){if(!r.sync&&!r._transpilerLoaded)return r.transpiler.catch(function(e){return console.error(e)}).then(function(t){return runEval$2(e,n,_extends({},r,{transpiler:t,_transpilerLoaded:!0}))});console.warn("[lively.vm] sync eval requested but transpiler is not yet loaded, will continue without transpilation!"),r.transpiler=null}e.debug&&console.log("[lively.module] runEval in module "+a+" started"),lively_notifications.emit("lively.vm/doitrequest",{code:n,waitForPromise:r.waitForPromise,targetModule:r.targetModule},Date.now(),e),e.get("@lively-env").evaluationStart(a);var m=runEval$1(t,r);return r.sync?evalEnd(e,n,r,m):Promise.resolve(m).then(function(t){return evalEnd(e,n,r,t)})}function evalEnd(e,t,r,n){return e.get("@lively-env").evaluationEnd(r.targetModule),e.debug&&console.log("[lively.module] runEval in module "+r.targetModule+" done"),lively_notifications.emit("lively.vm/doitresult",{code:t,result:n,waitForPromise:r.waitForPromise,targetModule:r.targetModule},Date.now(),e),n}function runEval$$1(e,t){var r=t=_extends({format:"esm",System:null,targetModule:null},t),n=r.format,i=r.System,o=r.targetModule;return i||"undefined"==typeof System||(i=System),!i&&o?Promise.reject(new Error("options to runEval have targetModule but cannot find system loader!")):o&&["esm","es6","register"].includes(n)?runEval$2(i,e,t):runEval$1(e,t)}function syncEval$$1(e,t){return syncEval$1(e,t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},asyncToGenerator=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),defineProperty=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},get$1=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},set=function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var s=o.set;void 0!==s&&s.call(i,n)}return n},slicedToArray=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},knownSymbols=Object.getOwnPropertyNames(Symbol).filter(function(e){return"symbol"===_typeof(Symbol[e])}).reduce(function(e,t){return e.set(Symbol[t],"Symbol."+t)},new Map),symMatcher=/^Symbol\((.*)\)$/,printInspectEvalValue=function(){function e(e,t){if("object"===(void 0===t?"undefined":_typeof(t))&&(t=t.maxDepth||2),!e)return String(e);if("string"==typeof e){var n=e.includes("\n")?"`":'"';return n+e+n}if(e instanceof Error)return e.stack||safeToString(e);if(!lively_lang.obj.isObject(e))return safeToString(e);try{var i=lively_lang.obj.inspect(e,{customPrinter:r,maxDepth:t,printFunctionSource:!0})}catch(e){}return"{}"===i?safeToString(e):i}function t(t,r){if(!("string"!=typeof t&&!Array.isArray(t)&&n&&"function"==typeof t[n]))return r;for(var o,a="function"==typeof t.entries,s=a?t.entries():t[n](),u=[],c=a?"{":"[",l=a?"}":"]",f=t.constructor&&t.constructor.name||"Iterable",p=0;p<i&&!(o=s.next()).done;p++)u.push(o.value);return f+"("+c+u.map(function(t){return a?String(t[0])+": "+String(t[1]):e(t,2)}).join(", ")+l+")"}function r(e,r,n){if(!e)return r;if("symbol"===(void 0===e?"undefined":_typeof(e)))return printSymbol(e);if("string"==typeof e)return lively_lang.string.print(lively_lang.string.truncate(e,o));if(e.isMorph)return safeToString(e);if(e instanceof Promise)return"Promise()";if("undefined"!=typeof Node&&e instanceof Node)return safeToString(e);if("undefined"!=typeof ImageData&&e instanceof ImageData)return safeToString(e);var a=e.length||e.byteLength;if(void 0!==a&&a>i&&e.slice)return"["+("string"==typeof e||e.byteLength?safeToString(e.slice(0,i)):e.slice(0,i).map(n))+",...]";var s=t(e,r);return s!==r?s:r}var n="undefined"!=typeof Symbol&&Symbol.iterator,i=10,o=100;return e}(),completions=Object.freeze({getObjectForCompletion:getObjectForCompletion,getCompletions:getCompletions}),id=lively_ast.nodes.id,literal=lively_ast.nodes.literal,member=lively_ast.nodes.member,defaultDeclarationWrapperName="lively.capturing-declaration-wrapper",defaultClassToFunctionConverterName="initializeES6ClassForLively",defaultTopLevelVarRecorderName="__lvVarRecorder",startEvalFunctionName="lively.vm-on-eval-start",endEvalFunctionName="lively.vm-on-eval-end",EvalResult=function(){function e(){classCallCheck(this,e),this.isEvalResult=!0,this.value=void 0,this.warnings=[],this.isError=!1,this.isPromise=!1,this.promisedValue=void 0,this.promiseStatus="unknown"}return createClass(e,[{key:"addWarning",value:function(e){return this.warnings.push(e),e}},{key:"printed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.value=printEvalResult(this,e)}},{key:"processSync",value:function(e){return(e.inspect||e.asString)&&(this.value=this.print(this.value,e)),this}},{key:"process",value:function(e){var t=this;return t.isPromise&&e.waitForPromise?tryToWaitForPromise(t,e.promiseTimeout).then(function(){return(e.inspect||e.asString)&&t.printed(e),t}):((e.inspect||e.asString)&&t.printed(e),Promise.resolve(t))}}]),e}(),funcCall=lively_ast.nodes.funcCall,member$1=lively_ast.nodes.member,literal$1=lively_ast.nodes.literal,EvalStrategy=function(){function e(){classCallCheck(this,e)}return createClass(e,[{key:"runEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.reject("runEval(source, options) not yet implemented for "+this.constructor.name));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"keysOfObject",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.reject("keysOfObject(prefix, options) not yet implemented for "+this.constructor.name));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}(),SimpleEvalStrategy=function(_EvalStrategy){function SimpleEvalStrategy(){return classCallCheck(this,SimpleEvalStrategy),possibleConstructorReturn(this,(SimpleEvalStrategy.__proto__||Object.getPrototypeOf(SimpleEvalStrategy)).apply(this,arguments))}return inherits(SimpleEvalStrategy,_EvalStrategy),createClass(SimpleEvalStrategy,[{key:"runEval",value:function(){function runEval(e,t){return _ref3.apply(this,arguments)}var _ref3=asyncToGenerator(regeneratorRuntime.mark(function _callee3(source,options){return regeneratorRuntime.wrap(function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.abrupt("return",Promise.resolve().then(function(){try{return Promise.resolve({value:eval(source)})}catch(e){return{isError:!0,value:e}}}));case 1:case"end":return _context3.stop()}},_callee3,this)}));return runEval}()},{key:"keysOfObject",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lively.vm.completions.getCompletions(function(e){return i.runEval(e,r)},t);case 2:return n=e.sent,e.abrupt("return",{completions:n.completions,prefix:n.startLetters});case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),SimpleEvalStrategy}(EvalStrategy),LivelyVmEvalStrategy=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,EvalStrategy),createClass(t,[{key:"normalizeOptions",value:function(e){if(!e.targetModule)throw new Error("runEval called but options.targetModule not specified!");return Object.assign({sourceURL:e.targetModule+"_doit_"+Date.now()},e)}},{key:"runEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.normalizeOptions(r),(n=r.System||lively.modules.System).config({meta:defineProperty({},r.targetModule,{format:"esm"})}),e.abrupt("return",lively.vm.runEval(t,r));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"keysOfObject",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lively.vm.completions.getCompletions(function(e){return lively.vm.runEval(e,r)},t);case 2:return n=e.sent,e.abrupt("return",{completions:n.completions,prefix:n.startLetters});case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(),RemoteEvalStrategy=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,LivelyVmEvalStrategy),createClass(t,[{key:"sourceForRemote",value:function(e,t,r){return r=lively_lang.obj.dissoc(r,["systemInterface","System","context"]),"\n(function() {\n  var arg = "+JSON.stringify(t)+",\n      options = "+JSON.stringify(r)+';\n  if (typeof lively === "undefined" || !lively.vm) {\n    return Promise.resolve({\n      isEvalResult: true,\n      isError: true,\n      value: \'lively.vm not available!\'\n    });\n  }\n  var hasSystem = typeof System !== "undefined"\n  options.context = hasSystem\n    ? System.global\n    : typeof window !== "undefined"\n        ? window\n        : typeof global !== "undefined"\n            ? global\n            : typeof self !== "undefined" ? self : this;\n  function evalFunction(source, options) {\n    if (hasSystem) {\n      var conf = {meta: {}}; conf.meta[options.targetModule] = {format: "esm"};\n      System.config(conf);\n    } else {\n      options = Object.assign({topLevelVarRecorderName: "GLOBAL"}, options);\n      delete options.targetModule;\n    }\n    return lively.vm.runEval(source, options);\n  }\n  function keysOfObjectFunction(prefix, options) {\n    return lively.vm.completions.getCompletions(code => evalFunction(code, options), prefix)\n      .then(result => ({isEvalResult: true, completions: result.completions, prefix: result.startLetters}));\n  }\n  return '+("eval"===e?"evalFunction":"keysOfObjectFunction")+"(arg, options)\n    .catch(err => ({isEvalResult: true, isError: true, value: String(err.stack || err)}));\n})();\n"}},{key:"runEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.remoteEval(this.sourceForRemote("eval",t,r),r));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"keysOfObject",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.remoteEval(this.sourceForRemote("keysOfObject",t,r),r));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"remoteEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.basicRemoteEval(t,r);case 3:return n=e.sent,e.abrupt("return","string"==typeof n?JSON.parse(n):n);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{isError:!0,value:"Remote eval failed: "+(n||e.t0)});case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"basicRemoteEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Not yet implemented");case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(),HttpEvalStrategy=function(e){function t(e){classCallCheck(this,t);var r=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.url=e||r.constructor.defaultURL,r}return inherits(t,RemoteEvalStrategy),createClass(t,null,[{key:"defaultURL",get:function(){return"http://localhost:3000/lively"}}]),createClass(t,[{key:"normalizeOptions",value:function(e){return e=get$1(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"normalizeOptions",this).call(this,e),Object.assign({serverEvalURL:this.url},e,{context:null})}},{key:"basicRemoteEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.normalizeOptions(r),n="basicRemoteEval_"+(System.get("@system-env").node?"node":"web"),e.next=4,this[n]({method:"POST",body:t},r.serverEvalURL);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"basicRemoteEval_web",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.match(/[^:]+:\/\/[^\/]+/)||[r],i=slicedToArray(n,1),o=i[0],(a=document.location.origin!==o)&&(t.headers=_extends({},t.headers,{pragma:"no-cache","cache-control":"no-cache","x-lively-proxy-request":r}),r=document.location.origin),e.prev=2,e.next=5,window.fetch(r,t);case 5:s=e.sent,e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(2),new Error("Cannot reach server at "+r+": "+e.t0.message);case 11:if(s.ok){e.next=13;break}throw new Error("Server at "+r+": "+s.statusText);case 13:return e.abrupt("return",s.text());case 14:case"end":return e.stop()}},e,this,[[2,8]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"basicRemoteEval_node",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=System._nodeRequire("url").parse,i=System._nodeRequire(r.startsWith("https:")?"https":"http"),o=Object.assign({method:t.method||"GET"},n(r)),e.abrupt("return",new Promise(function(e,r){var n=i.request(o,function(t){t.setEncoding("utf8");var n="";t.on("data",function(e){return n+=e}),t.on("end",function(){return e(n)}),t.on("error",function(e){return r(e)})});n.on("error",function(e){return r(e)}),n.end(t.body)}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(),L2LEvalStrategy=function(e){function t(e,r){classCallCheck(this,t);var n=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.l2lClient=e,n.targetId=r,n}return inherits(t,RemoteEvalStrategy),createClass(t,[{key:"basicRemoteEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.l2lClient,i=this.targetId,e.next=4,new Promise(function(e,r){return n.sendTo(i,"remote-eval",{source:t},e)});case 4:return o=e.sent,(a=o.data)&&a.value&&a.value.isEvalResult&&(a=a.value),e.abrupt("return",a);case 8:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(),evalStrategies=Object.freeze({RemoteEvalStrategy:RemoteEvalStrategy,EvalStrategy:EvalStrategy,SimpleEvalStrategy:SimpleEvalStrategy,LivelyVmEvalStrategy:LivelyVmEvalStrategy,HttpEvalStrategy:HttpEvalStrategy,L2LEvalStrategy:L2LEvalStrategy});exports.completions=completions,exports.runEval=runEval$$1,exports.syncEval=syncEval$$1,exports.evalStrategies=evalStrategies,exports.defaultTopLevelVarRecorderName=defaultTopLevelVarRecorderName,exports.defaultClassToFunctionConverterName=defaultClassToFunctionConverterName,exports.evalCodeTransform=evalCodeTransform,exports.evalCodeTransformOfSystemRegisterSetters=evalCodeTransformOfSystemRegisterSetters}(this.lively.vm=this.lively.vm||{},lively.lang,lively.ast,lively.sourceTransform,lively.classes,lively.notifications),"undefined"!=typeof module&&module.exports&&(module.exports=GLOBAL.lively.vm)}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(e,t){"use strict";function r(e,t){return Array.isArray(e)?e.reduce(function(e,t){return r(t,e)},t):"string"==typeof e?t.filter(function(t){return t.path()!==e&&t.name()!==e}):e instanceof RegExp?t.filter(function(t){return!e.test(t.path())&&!e.test(t.name())}):"function"==typeof e?t.filter(function(t){return!e(t)}):t}function n(e){var t=(e=e).split("?"),r=S(t,2),n=(r[0],r[1]),i={};if(!n)return i;var o=n.split("&");if(o)for(var a=0;a<o.length;a++){var s=o[a].split("="),u=s[0],c=!0;if(s.length>1)if("undefined"===(c=decodeURIComponent(s.slice(1).join("="))))c=void 0;else if(c.match(/^(true|false|null|[0-9"[{].*)$/))try{c=JSON.parse(c)}catch(e){"["===c[0]&&(c=c.slice(1,-1).split(","))}i[u]=c}return i}function i(e){var t=e,r=t;do{r=(t=r).replace(C,"")}while(r!=t);return r=r.replace(F,"$1/"),r=r.replace(D,"/")}function o(e,t){e.startsWith("/")&&(e=e.slice(1)),t.startsWith("/")&&(t=t.slice(1));for(var r=e.split("/"),n=t.split("/"),i=0;i<n.length&&(r[i]&&r[i]==n[i]);i++);return"../".repeat(Math.max(0,n.length-i-1))+r.splice(i,r.length).join("/")}function a(e,t){var r=e.match(A),n=t.match(A),a=void 0,s=void 0,u=void 0,c=void 0,l=!0;if((r&&!n||!r&&n)&&(l=!1),r&&n&&(a=r[1],s=r[2],u=n[1],c=n[2],a!==u?l=!1:s!==c?l=!1:(e=r[3],t=n[3])),!l)throw new Error("[relativePathBetween] incompatible paths: "+e+" vs. "+t);if(e=i(e),t=i(t),e==t)return"";var f=o(t,e);if(!f)throw new Error("pathname differs in relativePathFrom "+e+" vs "+t);return f}function s(e,t){throw new Error(t+" for "+e.constructor.name+" not yet implemented")}function u(e){var t=e.match(/\/([a-z]+?):multistatus/i);return t?t[1]:"d"}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.tagName.replace(/[^:]+:/,""),n=I[r],i=e.textContent;switch(n){case"lastModified":case"created":i=new Date(i);break;case"size":i=Number(i)}return t[n]=i,t}function l(e){var t=(new DOMParser).parseFromString(e,"text/xml"),r=u(e),n=new P("/"+r+":multistatus/"+r+":response").findAll(t.documentElement),i=new P(r+":href"),o=new P(r+":propstat/"+r+":prop");return n.map(function(e){var t=o.findFirst(e),r=Array.from(t.childNodes).reduce(function(e,t){return c(t,e)},{}),n=i.findFirst(e);return r.url=n.textContent||n.text,r})}function f(){return document.location.origin}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",r=arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=e.url,o=e.useCors,a=e.useProxy,s=e.headers,o=void 0===o||o,u={method:t};return(a=void 0===a||a)&&(Object.assign(n,{pragma:"no-cache","cache-control":"no-cache","x-lively-proxy-request":i}),i=f()),o&&(u.mode="cors"),r&&(u.body=r),u.redirect="follow",u.headers=x({},n,s),fetch(i,u)}function h(e){return function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return new Promise(function(t,n){return e.apply(null,r.concat(function(e,r){return e?n(e):t(r)}))})}}function d(e,t){return!t||("string"==typeof t?!e.url.includes(t):"function"==typeof t?!t(e):!(t instanceof RegExp)||!t.test(e.url))}function m(e,t){if(!e)throw new Error("lively.resource resource constructor: expects url but got "+e);if(e.isResource)return e;e=String(e);for(var r=0;r<Z.length;r++)if(Z[r].matches(e))return new Z[r].resourceClass(e,t);throw new Error("Cannot find resource type for url "+e)}function v(e){var t=e.name;Z=Z.filter(function(e){return e.name!==t}).concat(e)}var y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}},b=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},_=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},w=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},k=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},E=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},S=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),A=/^([^:\/]+):\/\/([^\/]*)(.*)/,D=/\/\.\//g,C=/\/[^\/]+\/\.\./,F=/(^|[^:])[\/]+/g,j=/\/+$/,T=/^\/+/,O=/^[a-z0-9-_\.]+:/,R=/^\/\/[^\/]+/,B=function(){function e(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(b(this,e),!t)throw new Error("Cannot create resource without url");this.url=String(t),this.binary=!1,this.lastModified=void 0,this.created=void 0,this.etag=void 0,this.size=void 0,this.type=void 0,this.contentType=void 0,this.user=void 0,this.group=void 0,this.mode=void 0,this._isDirectory=void 0,this._isLink=void 0,this.linkCount=void 0}return _(e,null,[{key:"fromProps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new this(e.url).assignProperties(e)}}]),_(e,[{key:"equals",value:function(e){if(!e||this.constructor!==e.constructor)return!1;var t=this.url,r=e.url;return"/"===t[t.length-1]&&(t=t.slice(0,-1)),"/"===r[r.length-1]&&(r=r.slice(0,-1)),t===r}},{key:"toString",value:function(){return this.constructor.name+'("'+this.url+'")'}},{key:"newResource",value:function(e){return m(e)}},{key:"path",value:function(){var e=this.url.replace(O,"").replace(R,"");return""===e?"/":e}},{key:"pathWithoutQuery",value:function(){return this.path().split("?")[0]}},{key:"name",value:function(){var e=this.path(),t=e.lastIndexOf("?");t>-1&&(e=e.slice(0,t)),e.endsWith("/")&&(e=e.slice(0,-1));var r=e.split("/"),n=r[r.length-1];return decodeURIComponent(n)}},{key:"ext",value:function(){var e=this.url;if(e.endsWith("/"))return"";var t=e.match(/\.([^\/\.]+$)/)||["",""],r=S(t,2),n=(r[0],r[1]);return n.toLowerCase()}},{key:"nameWithoutExt",value:function(){var e=this.name(),t=e.lastIndexOf(".");return t>0&&(e=e.slice(0,t)),e}},{key:"scheme",value:function(){return this.url.split(":")[0]}},{key:"host",value:function(){var e=this.url.indexOf("://");if(-1===e)return null;var t=this.url.slice(e+3),r=t.indexOf("/");return t.slice(0,r>-1?r:t.length)}},{key:"schemeAndHost",value:function(){return this.isRoot()?this.asFile().url:this.url.slice(0,this.url.length-this.path().length)}},{key:"parent",value:function(){return this.isRoot()?null:this.newResource(this.url.replace(j,"").split("/").slice(0,-1).join("/")+"/")}},{key:"parents",value:function(){for(var e=[],t=this.parent();t;)e.unshift(t),t=t.parent();return e}},{key:"isParentOf",value:function(e){var t=this;return e.schemeAndHost()===this.schemeAndHost()&&e.parents().some(function(e){return e.equals(t)})}},{key:"query",value:function(){return n(this.url)}},{key:"withQuery",value:function(e){var t=x({},this.query(),e),r=this.url.split("?"),n=S(r,1)[0],i=Object.keys(t).map(function(e){return e+"="+encodeURIComponent(String(t[e]))}).join("&");return this.newResource(n+"?"+i)}},{key:"commonDirectory",value:function(e){if(e.schemeAndHost()!==this.schemeAndHost())return null;if(this.isDirectory()&&this.equals(e))return this;if(this.isRoot())return this.asDirectory();if(e.isRoot())return e.asDirectory();for(var t=e.parents(),r=this.parents(),n=this.root(),i=0;i<r.length;i++){var o=r[i],a=t[i];if(!a||!o.equals(a))return n;n=o}return n}},{key:"withRelativePartsResolved",value:function(){var e=this.path(),t=i(e);return t===e?this:(t.startsWith("/")&&(t=t.slice(1)),this.newResource(this.root().url+t))}},{key:"relativePathFrom",value:function(e){return a(e.url,this.url)}},{key:"withPath",value:function(e){return(this.isRoot()?this:this.root()).join(e)}},{key:"join",value:function(e){return this.newResource(this.url.replace(j,"")+"/"+e.replace(T,""))}},{key:"isRoot",value:function(){return"/"===this.path()}},{key:"isFile",value:function(){return!this.isRoot()&&!this.url.match(j)}},{key:"isDirectory",value:function(){return!this.isFile()}},{key:"asDirectory",value:function(){return this.url.endsWith("/")?this:this.newResource(this.url.replace(j,"")+"/")}},{key:"root",value:function(){if(this.isRoot())return this;var e=this.url.slice(0,-this.path().length);return this.newResource(e+"/")}},{key:"asFile",value:function(){return this.url.endsWith("/")?this.newResource(this.url.replace(j,"")):this}},{key:"assignProperties",value:function(e){for(var t in e)if("url"!==t){var r=t;"isLink"!==t&&"isDirectory"!==t||(r="_"+t),this[r]=e[t]}return this}},{key:"ensureExistance",value:function(){var e=g(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.exists();case 2:if(!e.sent){e.next=4;break}return e.abrupt("return",this);case 4:return e.next=6,this.parent().ensureExistance();case 6:if(!this.isFile()){e.next=11;break}return e.next=9,this.write(t||"");case 9:e.next=13;break;case 11:return e.next=13,this.mkdir();case 13:return e.abrupt("return",this);case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"copyTo",value:function(){var e=g(regeneratorRuntime.mark(function e(t){var r,n,i,o=this,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFile()){e.next=13;break}if(r=t.isFile()?t:t.join(this.name()),!a){e.next=5;break}return e.next=5,r.parent().ensureExistance();case 5:return e.t0=r,e.next=8,this.read();case 8:return e.t1=e.sent,e.next=11,e.t0.write.call(e.t0,e.t1);case 11:e.next=25;break;case 13:if(t.isDirectory()){e.next=15;break}throw new Error("Cannot copy a directory to a file!");case 15:return e.next=17,this.dirList("infinity");case 17:return n=e.sent,i=n.map(function(e){return t.join(e.relativePathFrom(o))}),e.next=21,t.ensureExistance();case 21:return e.next=23,n.reduceRight(function(e,t,r){return function(){return Promise.resolve(t.isDirectory()&&i[r].ensureExistance()).then(e)}},function(){return Promise.resolve()})();case 23:return e.next=25,n.reduceRight(function(e,t,r){return function(){return Promise.resolve(t.isFile()&&t.copyTo(i[r],!1)).then(e)}},function(){return Promise.resolve()})();case 25:return e.abrupt("return",this);case 26:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"rename",value:function(){var e=g(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.copyTo(t);case 2:return this.remove(),e.abrupt("return",t);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"beBinary",value:function(e){return this.setBinary(!0)}},{key:"setBinary",value:function(e){return this.binary=e,this}},{key:"read",value:function(){var e=g(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s(this,"read");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"write",value:function(){var e=g(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s(this,"write");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"mkdir",value:function(){var e=g(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s(this,"mkdir");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"exists",value:function(){var e=g(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s(this,"exists");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=g(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s(this,"remove");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"dirList",value:function(){var e=g(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s(this,"dirList");case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"readProperties",value:function(){var e=g(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s(this,"readProperties");case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"writeJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.write(t?JSON.stringify(e,null,2):JSON.stringify(e))}},{key:"readJson",value:function(){var e=g(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,this.read();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"__serialize__",value:function(){return{__expr__:'var r = null; try { r = resource("'+this.url+'");} catch (err) {}; r',bindings:{"lively.resources":["resource"]}}}},{key:"isResource",get:function(){return!0}},{key:"canDealWithJSON",get:function(){return!1}}]),e}(),P=function(){function e(t){b(this,e),this.expression=t,this.contextNode=null,this.xpe=new XPathEvaluator}return _(e,[{key:"establishContext",value:function(e){if(!this.nsResolver){var t=e.ownerDocument?e.ownerDocument.documentElement:e.documentElement;t!==this.contextNode&&(this.contextNode=t,this.nsResolver=this.xpe.createNSResolver(t))}}},{key:"manualNSLookup",value:function(){return this.nsResolver=function(e){return Namespace[e.toUpperCase()]||null},this}},{key:"findAll",value:function(e,t){this.establishContext(e);for(var r=this.xpe.evaluate(this.expression,e,this.nsResolver,XPathResult.ANY_TYPE,null),n=[],i=null;i=r.iterateNext();)n.push(i);return n.length>0||void 0===t?n:t}},{key:"findFirst",value:function(e){return this.establishContext(e),this.xpe.evaluate(this.expression,e,this.nsResolver,XPathResult.ANY_TYPE,null).iterateNext()}}]),e}(),I={getlastmodified:"lastModified",creationDate:"created",getetag:"etag",getcontentlength:"size",resourcetype:"type",getcontenttype:"contentType"},L=["3ds","3g2","3gp","7z","a","aac","adp","ai","aif","aiff","alz","ape","apk","ar","arj","asf","au","avi","bak","bh","bin","bk","bmp","btif","bz2","bzip2","cab","caf","cgm","class","cmx","cpio","cr2","csv","cur","dat","deb","dex","djvu","dll","dmg","dng","doc","docm","docx","dot","dotm","dra","DS_Store","dsk","dts","dtshd","dvb","dwg","dxf","ecelp4800","ecelp7470","ecelp9600","egg","eol","eot","epub","exe","f4v","fbs","fh","fla","flac","fli","flv","fpx","fst","fvt","g3","gif","graffle","gz","gzip","h261","h263","h264","icns","ico","ief","img","ipa","iso","jar","jpeg","jpg","jpgv","jpm","jxr","key","ktx","lha","lvp","lz","lzh","lzma","lzo","m3u","m4a","m4v","mar","mdi","mht","mid","midi","mj2","mka","mkv","mmr","mng","mobi","mov","movie","mp3","mp4","mp4a","mpeg","mpg","mpga","mxu","nef","npx","numbers","o","oga","ogg","ogv","otf","pages","pbm","pcx","pdf","pea","pgm","pic","png","pnm","pot","potm","potx","ppa","ppam","ppm","pps","ppsm","ppsx","ppt","pptm","pptx","psd","pya","pyc","pyo","pyv","qt","rar","ras","raw","rgb","rip","rlc","rmf","rmvb","rtf","rz","s3m","s7z","scpt","sgi","shar","sil","sketch","slk","smv","so","sub","swf","tar","tbz","tbz2","tga","tgz","thmx","tif","tiff","tlz","ttc","ttf","txz","udf","uvh","uvi","uvm","uvp","uvs","uvu","viv","vob","war","wav","wax","wbmp","wdp","weba","webm","webp","whl","wim","wm","wma","wmv","wmx","woff","woff2","wvx","xbm","xif","xla","xlam","xls","xlsb","xlsm","xlsx","xlt","xltm","xltx","xm","xmind","xpi","xpm","xwd","xz","z","zip","zipx"],N="undefined"!=typeof System?System.get("@system-env").node:"undefined"!=typeof global&&"undefined"!=typeof process,M={name:"http-webdav-resource",matches:function(e){return e.startsWith("http:")||e.startsWith("https:")},resourceClass:function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};b(this,t);var n=E(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return n.useProxy=!!r.hasOwnProperty("useProxy")&&r.useProxy,n.useCors=!!r.hasOwnProperty("useCors")&&r.useCors,n.headers=r.headers||{},n.binary=!!n.isFile()&&L.includes(n.ext()),n.errorOnHTTPStatusCodes=!r.hasOwnProperty("errorOnHTTPStatusCodes")||r.errorOnHTTPStatusCodes,n}return k(t,B),_(t,[{key:"join",value:function(e){return Object.assign(w(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"join",this).call(this,e),{headers:this.headers,useCors:this.useCors,useProxy:this.useProxy})}},{key:"makeProxied",value:function(){return this.useProxy?this:new this.constructor(this.url,{headers:this.headers,useCors:this.useCors,useProxy:!0})}},{key:"noErrorOnHTTPStatusCodes",value:function(){return this.errorOnHTTPStatusCodes=!1,this}},{key:"read",value:function(){var e=g(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(this);case 2:if((t=e.sent).ok||!this.errorOnHTTPStatusCodes){e.next=5;break}throw new Error("Cannot read "+this.url+": "+t.statusText+" "+t.status);case 5:if(this.binary){e.next=7;break}return e.abrupt("return",t.text());case 7:if("blob"!==this.binary){e.next=9;break}return e.abrupt("return",t.blob());case 9:if("function"!=typeof t.arrayBuffer){e.next=11;break}return e.abrupt("return",t.arrayBuffer());case 11:if("function"!=typeof t.buffer){e.next=13;break}return e.abrupt("return",t.buffer());case 13:throw new Error("Don't now how to read binary resource "+this+"'");case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"write",value:function(){var e=g(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isFile()){e.next=2;break}throw new Error("Cannot write a non-file: "+this.url);case 2:return e.next=4,p(this,"PUT",t);case 4:if((r=e.sent).ok||!this.errorOnHTTPStatusCodes){e.next=7;break}throw new Error("Cannot write "+this.url+": "+r.statusText+" "+r.status);case 7:return e.abrupt("return",this);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"mkdir",value:function(){var e=g(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFile()){e.next=2;break}throw new Error("Cannot mkdir on a file: "+this.url);case 2:return e.next=4,p(this,"MKCOL");case 4:if((t=e.sent).ok||!this.errorOnHTTPStatusCodes){e.next=7;break}throw new Error("Cannot create directory "+this.url+": "+t.statusText+" "+t.status);case 7:return e.abrupt("return",this);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"exists",value:function(){var e=g(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isRoot()){e.next=4;break}e.t0=!0,e.next=7;break;case 4:return e.next=6,p(this,"HEAD");case 6:e.t0=!!e.sent.ok;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=g(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(this,"DELETE");case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_propfind",value:function(){var e=g(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(this,"PROPFIND",null,{"Content-Type":"text/xml"});case 2:if((t=e.sent).ok||!this.errorOnHTTPStatusCodes){e.next=5;break}throw new Error("Error in dirList for "+this.url+": "+t.statusText);case 5:return e.next=7,t.text();case 7:return r=e.sent,n=this.root(),e.abrupt("return",l(r).map(function(e){return n.join(e.url).assignProperties(e)}));case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"dirList",value:function(){var e=g(regeneratorRuntime.mark(function e(){var t,n,i,o,a,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("number"==typeof s||"infinity"===s){e.next=2;break}throw new Error("dirList  invalid depth argument: "+s);case 2:if(t=u.exclude,s<=0&&(s=1),1!==s){e.next=13;break}return e.next=7,this._propfind();case 7:return n=e.sent,i=n.shift(),t&&(n=r(t,n)),e.abrupt("return",n);case 13:return e.next=15,this.dirList(1,u);case 15:return o=e.sent,a=o.filter(function(e){return e.isDirectory()}),e.abrupt("return",Promise.all(a.map(function(e){return e.dirList("number"==typeof s?s-1:s,u)})).then(function(e){return e.reduce(function(e,t){return e.concat(t)},o)}));case 18:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"readProperties",value:function(){var e=g(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._propfind();case 2:return r=e.sent[0],e.abrupt("return",this.assignProperties(r));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"post",value:function(){var e=g(regeneratorRuntime.mark(function e(){var t,r,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"string"!=typeof i&&(i=JSON.stringify(i)),e.next=3,p(this,"POST",i,{});case 3:return t=e.sent,r=void 0,n=void 0,e.prev=6,e.next=9,t.text();case 9:r=e.sent,e.next=14;break;case 12:e.prev=12,e.t0=e.catch(6);case 14:if(r&&"application/json"===t.headers.get("content-type"))try{n=JSON.parse(r)}catch(e){}if(t.ok||!this.errorOnHTTPStatusCodes){e.next=19;break}throw new Error("Error in POST "+this.url+": "+(r||t.statusText));case 19:return e.abrupt("return",n||r);case 20:case"end":return e.stop()}},e,this,[[6,12]])}));return function(){return e.apply(this,arguments)}}()},{key:"copyTo",value:function(){var e=g(regeneratorRuntime.mark(function e(r){var n,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFile()){e.next=7;break}if(n=r.isFile()?r:r.join(this.name()),!N){e.next=7;break}if(!n.isHTTPResource){e.next=5;break}return e.abrupt("return",this._copyTo_file_nodejs_http(n,i));case 5:if(!n.isNodeJSFileResource){e.next=7;break}return e.abrupt("return",this._copyTo_file_nodejs_fs(n,i));case 7:return e.abrupt("return",w(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"copyTo",this).call(this,r,i));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_copyFrom_file_nodejs_fs",value:function(){var e=g(regeneratorRuntime.mark(function e(t){var r,n,i,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!o){e.next=3;break}return e.next=3,this.parent().ensureExistance();case 3:return r=void 0,(n=t._createReadStream()).on("error",function(e){return r=e}),e.next=8,p(this,"PUT",n);case 8:if(i=e.sent,!r){e.next=11;break}throw r;case 11:if(i.ok||!this.errorOnHTTPStatusCodes){e.next=13;break}throw new Error("copyTo: Cannot GET: "+i.statusText+" "+i.status);case 13:return e.abrupt("return",this);case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_copyTo_file_nodejs_fs",value:function(){var e=g(regeneratorRuntime.mark(function e(t){var r,n,i=this,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!o){e.next=3;break}return e.next=3,t.parent().ensureExistance();case 3:return e.next=5,p(this,"GET");case 5:if((r=e.sent).ok||!this.errorOnHTTPStatusCodes){e.next=8;break}throw new Error("copyTo: Cannot GET: "+r.statusText+" "+r.status);case 8:return n=void 0,e.abrupt("return",new Promise(function(e,o){return r.body.pipe(t._createWriteStream()).on("error",function(e){return n=e}).on("finish",function(){return n?o(n):e(i)})}));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_copyTo_file_nodejs_http",value:function(){var e=g(regeneratorRuntime.mark(function e(t){var r,n,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!i){e.next=3;break}return e.next=3,t.parent().ensureExistance();case 3:return e.next=5,p(this,"GET");case 5:if((r=e.sent).ok||!this.errorOnHTTPStatusCodes){e.next=8;break}throw new Error("copyTo: Cannot GET: "+r.statusText+" "+r.status);case 8:return e.next=10,p(t,"PUT",r.body);case 10:if(n=e.sent,r.ok||!this.errorOnHTTPStatusCodes){e.next=13;break}throw new Error("copyTo: Cannot PUT: "+n.statusText+" "+n.status);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"isHTTPResource",get:function(){return!0}}]),t}()},q=h(t.readFile),$=h(t.writeFile),W=function(e){return new Promise(function(r,n){return t.exists(e,function(e){return r(!!e)})})},U=h(t.readdir),G=h(t.mkdir),z=h(t.rmdir),V=h(t.unlink),J=h(t.lstat),H=h(t.rename),X={name:"nodejs-file-resource",matches:function(e){return e.startsWith("file:")},resourceClass:function(e){function n(){return b(this,n),E(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return k(n,B),_(n,[{key:"path",value:function(){return this.url.replace("file://","")}},{key:"stat",value:function(){var e=g(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",J(this.path()));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"read",value:function(){var e=g(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=q(this.path()),e.abrupt("return",this.binary?t:t.then(String));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"write",value:function(){var e=g(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isDirectory()){e.next=2;break}throw new Error("Cannot write into a directory: "+this.path());case 2:return e.next=4,$(this.path(),t);case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"mkdir",value:function(){var e=g(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFile()){e.next=2;break}throw new Error("Cannot mkdir on a file: "+this.path());case 2:return e.next=4,G(this.path());case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"exists",value:function(){var e=g(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!!this.isRoot()||W(this.path()));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"dirList",value:function(){var e=g(regeneratorRuntime.mark(function e(){var t,n,i,o,a,s,u,c,l,f,p,h,d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("number"==typeof d||"infinity"===d){e.next=2;break}throw new Error("dirList  invalid depth argument: "+d);case 2:if(t=m.exclude,d<=0&&(d=1),1!==d){e.next=42;break}return n=[],i=!0,o=!1,a=void 0,e.prev=9,e.next=12,U(this.path());case 12:e.t0=Symbol.iterator,s=e.sent[e.t0]();case 14:if(i=(u=s.next()).done){e.next=26;break}return c=u.value,l=this.join(c),e.next=19,l.stat();case 19:f=e.sent,(l=f.isDirectory()?l.asDirectory():l)._assignPropsFromStat(f),n.push(l);case 23:i=!0,e.next=14;break;case 26:e.next=32;break;case 28:e.prev=28,e.t1=e.catch(9),o=!0,a=e.t1;case 32:e.prev=32,e.prev=33,!i&&s.return&&s.return();case 35:if(e.prev=35,!o){e.next=38;break}throw a;case 38:return e.finish(35);case 39:return e.finish(32);case 40:return t&&(n=r(t,n)),e.abrupt("return",n);case 42:return e.next=44,this.dirList(1,m);case 44:return p=e.sent,h=p.filter(function(e){return e.isDirectory()}),e.abrupt("return",Promise.all(h.map(function(e){return e.dirList("number"==typeof d?d-1:d,m)})).then(function(e){return e.reduce(function(e,t){return e.concat(t)},p)}));case 47:case"end":return e.stop()}},e,this,[[9,28,32,40],[33,,35,39]])}));return function(){return e.apply(this,arguments)}}()},{key:"isEmptyDirectory",value:function(){var e=g(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dirList();case 2:return e.t0=e.sent.length,e.abrupt("return",0===e.t0);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"rename",value:function(){var e=g(regeneratorRuntime.mark(function e(t){var r,i,o,a,s,u,c,l,f,p,h,d,m,v,y,g,b,_,x,k;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof this.constructor){e.next=2;break}return e.abrupt("return",w(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"rename",this).call(this,t));case 2:if(!this.isFile()){e.next=7;break}t=t.asFile(),H(this.path(),t.path()),e.next=93;break;case 7:return t=t.asDirectory(),e.next=10,t.ensureExistance();case 10:return r=[],i=[],o=!0,a=!1,s=void 0,e.prev=14,e.next=17,this.dirList("infinity");case 17:e.t0=Symbol.iterator,u=e.sent[e.t0]();case 19:if(o=(c=u.next()).done){e.next=25;break}(l=c.value).isDirectory()?i.push(l):r.push(l);case 22:o=!0,e.next=19;break;case 25:e.next=31;break;case 27:e.prev=27,e.t1=e.catch(14),a=!0,s=e.t1;case 31:e.prev=31,e.prev=32,!o&&u.return&&u.return();case 34:if(e.prev=34,!a){e.next=37;break}throw s;case 37:return e.finish(34);case 38:return e.finish(31);case 39:f=!0,p=!1,h=void 0,e.prev=42,d=i[Symbol.iterator]();case 44:if(f=(m=d.next()).done){e.next=51;break}return v=m.value,e.next=48,t.join(v.relativePathFrom(this)).ensureExistance();case 48:f=!0,e.next=44;break;case 51:e.next=57;break;case 53:e.prev=53,e.t2=e.catch(42),p=!0,h=e.t2;case 57:e.prev=57,e.prev=58,!f&&d.return&&d.return();case 60:if(e.prev=60,!p){e.next=63;break}throw h;case 63:return e.finish(60);case 64:return e.finish(57);case 65:y=!0,g=!1,b=void 0,e.prev=68,_=r[Symbol.iterator]();case 70:if(y=(x=_.next()).done){e.next=77;break}return k=x.value,e.next=74,k.rename(t.join(k.relativePathFrom(this)));case 74:y=!0,e.next=70;break;case 77:e.next=83;break;case 79:e.prev=79,e.t3=e.catch(68),g=!0,b=e.t3;case 83:e.prev=83,e.prev=84,!y&&_.return&&_.return();case 86:if(e.prev=86,!g){e.next=89;break}throw b;case 89:return e.finish(86);case 90:return e.finish(83);case 91:return e.next=93,this.remove();case 93:return e.abrupt("return",t);case 94:case"end":return e.stop()}},e,this,[[14,27,31,39],[32,,34,38],[42,53,57,65],[58,,60,64],[68,79,83,91],[84,,86,90]])}));return function(t){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=g(regeneratorRuntime.mark(function e(){var t,r,n,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.exists();case 2:if(e.sent){e.next=5;break}e.next=41;break;case 5:if(!this.isDirectory()){e.next=39;break}return t=!0,r=!1,n=void 0,e.prev=9,e.next=12,this.dirList();case 12:e.t0=Symbol.iterator,i=e.sent[e.t0]();case 14:if(t=(o=i.next()).done){e.next=21;break}return a=o.value,e.next=18,a.remove();case 18:t=!0,e.next=14;break;case 21:e.next=27;break;case 23:e.prev=23,e.t1=e.catch(9),r=!0,n=e.t1;case 27:e.prev=27,e.prev=28,!t&&i.return&&i.return();case 30:if(e.prev=30,!r){e.next=33;break}throw n;case 33:return e.finish(30);case 34:return e.finish(27);case 35:return e.next=37,z(this.path());case 37:e.next=41;break;case 39:return e.next=41,V(this.path());case 41:return e.abrupt("return",this);case 42:case"end":return e.stop()}},e,this,[[9,23,27,35],[28,,30,34]])}));return function(){return e.apply(this,arguments)}}()},{key:"readProperties",value:function(){var e=g(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this.stat();case 3:return e.t1=e.sent,e.abrupt("return",e.t0._assignPropsFromStat.call(e.t0,e.t1));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"copyTo",value:function(){var e=g(regeneratorRuntime.mark(function e(t){var r,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFile()){e.next=4;break}if(!(r=t.isFile()?t:t.join(this.name())).isHTTPResource){e.next=4;break}return e.abrupt("return",r._copyFrom_file_nodejs_fs(this,i=!0));case 4:return e.abrupt("return",w(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"copyTo",this).call(this,t,i));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_assignPropsFromStat",value:function(e){return this.assignProperties({lastModified:e.mtime,created:e.ctime,size:e.size,type:e.isDirectory()?"directory":"file",isLink:e.isSymbolicLink()})}},{key:"_createWriteStream",value:function(){return t.createWriteStream(this.path())}},{key:"_createReadStream",value:function(){return t.createReadStream(this.path())}},{key:"isNodeJSFileResource",get:function(){return!0}}]),n}()},K=/\//g,Q=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(b(this,e),!t||"string"!=typeof t)throw new Error("LocalResourceInMemoryBackend needs name!");this.name=t,this._filespec=r}return _(e,null,[{key:"removeHost",value:function(e){delete this.hosts[e]}},{key:"ensure",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.named(r.host);return Promise.resolve().then(function(){return e?ee("local://"+n.name,e):null}).then(function(){return t})}},{key:"named",value:function(e){return e||(e="default"),this.hosts[e]||(this.hosts[e]=new this(e))}},{key:"hosts",get:function(){return this._hosts||(this._hosts={})}}]),_(e,[{key:"get",value:function(e){return this._filespec[e]}},{key:"set",value:function(e,t){this._filespec[e]=t}},{key:"write",value:function(e,t){var r=this._filespec[e];r||(r=this._filespec[e]={created:new Date}),r.content=t,r.isDirectory=!1,r.lastModified=new Date}},{key:"read",value:function(e){var t=this._filespec[e];return t&&t.content?t.content:""}},{key:"mkdir",value:function(e){var t=this._filespec[e];t&&t.isDirectory||(t||(t=this._filespec[e]={created:new Date}),t.content&&delete t.content,t.isDirectory=!0,t.lastModified=new Date)}},{key:"partialFilespec",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,r={},n=this.filespec,i=Object.keys(n),o=0;o<i.length;o++){var a=i[o];if(a.startsWith(e)&&e!==a){var s=a.slice(e.length);(s.includes("/")?s.match(K).length+1:1)>t||(r[a]=n[a])}}return r}},{key:"filespec",get:function(){return this._filespec},set:function(e){this._filespec=e}}]),e}(),Y={name:"local-resource",matches:function(e){return e.startsWith("local:")},resourceClass:function(e){function t(){return b(this,t),E(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return k(t,B),_(t,[{key:"read",value:function(){return Promise.resolve(this.localBackend.read(this.path()))}},{key:"write",value:function(e){if(this.isDirectory())throw new Error("Cannot write into a directory! ("+this.url+")");var t=this.localBackend.get(this.path());if(t&&t.isDirectory)throw new Error(this.url+" already exists and is a directory (cannot write into it!)");return this.localBackend.write(this.path(),e),Promise.resolve(this)}},{key:"mkdir",value:function(){if(!this.isDirectory())throw new Error("Cannot mkdir a file! ("+this.url+")");var e=this.localBackend.get(this.path());if(e&&e.isDirectory)return Promise.resolve(this);if(e&&!e.isDirectory)throw new Error(this.url+" already exists and is a file (cannot mkdir it!)");return this.localBackend.mkdir(this.path()),Promise.resolve(this)}},{key:"exists",value:function(){return Promise.resolve(this.isRoot()||this.path()in this.localBackend.filespec)}},{key:"remove",value:function(){var e=this,t=this.path();return Object.keys(this.localBackend.filespec).forEach(function(r){return r.startsWith(t)&&delete e.localBackend.filespec[r]}),Promise.resolve(this)}},{key:"readProperties",value:function(){throw new Error("not yet implemented")}},{key:"dirList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isDirectory())return this.asDirectory().dirList(t,r);var n=r.exclude,i=this.path(),o=[],a=Object.keys(this.localBackend.filespec);"infinity"===t&&(t=1/0);for(var s=0;s<a.length;s++){var u=a[s];if(u.startsWith(i)&&i!==u){var c=u.slice(i.length);if(!((c.includes("/")?c.match(K).length+1:1)>t&&"continue"===function(){var r=e.join(c.split("/").slice(0,t).join("/")+"/");return o.some(function(e){return e.equals(r)})||o.push(r),"continue"}())){var l=this.join(c);n&&!d(l,n)||o.push(l)}}}return Promise.resolve(o)}},{key:"localBackend",get:function(){return Q.named(this.host())}}]),t}()},Z=Z||[];v(Y),v(M),v(X);var ee=function(){var e=g(regeneratorRuntime.mark(function e(t,r,n){var i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=m(t,n).asDirectory(),e.next=3,i.ensureExistance();case 3:e.t0=regeneratorRuntime.keys(r);case 4:if((e.t1=e.t0()).done){e.next=18;break}if(o=e.t1.value,r.hasOwnProperty(o)){e.next=8;break}return e.abrupt("continue",4);case 8:if(a=i.join(o),"object"!==y(r[o])){e.next=14;break}return e.next=12,ee(a,r[o],n);case 12:e.next=16;break;case 14:return e.next=16,a.write(r[o]);case 16:e.next=4;break;case 18:return e.abrupt("return",i);case 19:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),te=function(){var e=g(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l,f,p,h,d,m,v,y,g,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"infinity",_=arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.dirList(b,_);case 2:r=e.sent,n={},i=!0,o=!1,a=void 0,e.prev=7,s=r[Symbol.iterator]();case 9:if(i=(u=s.next()).done){e.next=44;break}if(!(c=u.value).isDirectory()){e.next=15;break}e.t0={},e.next=18;break;case 15:return e.next=17,c.read();case 17:e.t0=e.sent;case 18:for(l=e.t0,f=c.asFile().relativePathFrom(t).split("/"),p=n,h=!0,d=!1,m=void 0,e.prev=24,v=f.slice(0,-1)[Symbol.iterator]();!(h=(y=v.next()).done);h=!0)g=y.value,p[g]||(p[g]={}),p=p[g];e.next=32;break;case 28:e.prev=28,e.t1=e.catch(24),d=!0,m=e.t1;case 32:e.prev=32,e.prev=33,!h&&v.return&&v.return();case 35:if(e.prev=35,!d){e.next=38;break}throw m;case 38:return e.finish(35);case 39:return e.finish(32);case 40:p[f[f.length-1]]=l;case 41:i=!0,e.next=9;break;case 44:e.next=50;break;case 46:e.prev=46,e.t2=e.catch(7),o=!0,a=e.t2;case 50:e.prev=50,e.prev=51,!i&&s.return&&s.return();case 53:if(e.prev=53,!o){e.next=56;break}throw a;case 56:return e.finish(53);case 57:return e.finish(50);case 58:return e.abrupt("return",n);case 59:case"end":return e.stop()}},e,this,[[7,46,50,58],[24,28,32,40],[33,,35,39],[51,,53,57]])}));return function(t){return e.apply(this,arguments)}}(),re=function(){var e=g(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!("fetch"in System.global&&"Headers"in System.global)){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:if(t=System.decanonicalize("lively.resources"),!System.get("@system-env").node){e.next=16;break}e.prev=4,r=System._nodeRequire("fetch-ponyfill"),e.next=14;break;case 8:return e.prev=8,e.t0=e.catch(4),e.next=12,System.normalize("fetch-ponyfill",t);case 12:n=e.sent.replace("file://",""),r=System._nodeRequire(n);case 14:e.next=19;break;case 16:return e.next=18,System.import("fetch-ponyfill",t);case 18:r=e.sent;case 19:Object.assign(System.global,r());case 20:case"end":return e.stop()}},e,this,[[4,8]])}));return function(){return e.apply(this,arguments)}}();e.resource=m,e.createFiles=ee,e.createFileSpec=te,e.loadViaScript=function(e,t){var r=document.head,n=r.namespaceURI;return new Promise(function(t,i){var o=document.createElementNS(n,"script");o.setAttribute("type","text/ecmascript"),r.appendChild(o),o.setAttributeNS(null,"id",e),"http://www.w3.org/2000/svg"===o.namespaceURI?o.setAttributeNS("http://www.w3.org/1999/xlink","href",e):o.setAttribute("src",e),o.onload=t,o.onerror=i,o.setAttributeNS(null,"async",!0)})},e.ensureFetch=re,e.registerExtension=v,e.unregisterExtension=function(e){var t="string"==typeof e?e:e.name;Z=Z.filter(function(e){return e.name!==t})},e.Resource=B,e.parseQuery=n}(this.lively.resources=this.lively.resources||{},"undefined"!=typeof module&&"function"==typeof module.require?module.require("fs"):{readFile:function(){throw new Error("fs module not available")}}),"undefined"!=typeof module&&module.exports&&(module.exports=e.lively.resources)}(),function(){var PouchDB=function(){var e={},t={exports:e};return function(r){if("object"==typeof e&&void 0!==t)t.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).PouchDB=r()}}(function(){return function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){var r=t[a][1][e];return i(r||e)},l,l.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,r){"use strict";t.exports=function(e){return function(){var t=arguments.length;if(t){for(var r=[],n=-1;++n<t;)r[n]=arguments[n];return e.call(this,r)}return e.call(this,[])}}},{}],2:[function(e,t,r){(function(n){function i(){var e;try{e=r.storage.debug}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e}(r=t.exports=e(3)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},r.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+r.humanize(this.diff),t){var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,n)}},r.save=function(e){try{null==e?r.storage.removeItem("debug"):r.storage.debug=e}catch(e){}},r.load=i,r.useColors=function(){return!("undefined"==typeof window||!window||void 0===window.process||"renderer"!==window.process.type)||"undefined"!=typeof document&&document&&"WebkitAppearance"in document.documentElement.style||"undefined"!=typeof window&&window&&window.console&&(console.firebug||console.exception&&console.table)||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},r.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),r.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],r.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},r.enable(i())}).call(this,e(9))},{3:3,9:9}],3:[function(e,t,r){function n(e){var t,n=0;for(t in e)n=(n<<5)-n+e.charCodeAt(t),n|=0;return r.colors[Math.abs(n)%r.colors.length]}function i(e){function t(){if(t.enabled){var e=t,n=+new Date,i=n-(o||n);e.diff=i,e.prev=o,e.curr=n,o=n;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=r.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var u=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(t,n){if("%%"===t)return t;u++;var i=r.formatters[n];if("function"==typeof i){var o=a[u];t=i.call(e,o),a.splice(u,1),u--}return t}),r.formatArgs.call(e,a),(t.log||r.log||console.log.bind(console)).apply(e,a)}}return t.namespace=e,t.enabled=r.enabled(e),t.useColors=r.useColors(),t.color=n(e),"function"==typeof r.init&&r.init(t),t}(r=t.exports=i.debug=i.default=i).coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){r.enable("")},r.enable=function(e){r.save(e),r.names=[],r.skips=[];for(var t=("string"==typeof e?e:"").split(/[\s,]+/),n=t.length,i=0;i<n;i++)t[i]&&("-"===(e=t[i].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")))},r.enabled=function(e){var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=e(8),r.names=[],r.skips=[],r.formatters={};var o},{8:8}],4:[function(e,t,r){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"number"==typeof e}function a(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,r,n,o,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(r=this._events[e],s(r))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),r.apply(this,o)}else if(a(r))for(o=Array.prototype.slice.call(arguments,1),n=(c=r.slice()).length,u=0;u<n;u++)c[u].apply(this,o);return!0},n.prototype.addListener=function(e,t){var r;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(r=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var n=!1;return r.listener=t,this.on(e,r),this},n.prototype.removeListener=function(e,t){var r,n,o,s;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],o=r.length,n=-1,r===t||i(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(r)){for(s=o;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){n=s;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],i(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],5:[function(e,t,r){(function(e){"use strict";function r(){c=!0;for(var e,t,r=l.length;r;){for(t=l,l=[],e=-1;++e<r;)t[e]();r=l.length}c=!1}var n,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,a=new i(r),s=e.document.createTextNode("");a.observe(s,{characterData:!0}),n=function(){s.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){r(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(r,0)};else{var u=new e.MessageChannel;u.port1.onmessage=r,n=function(){u.port2.postMessage(0)}}var c,l=[];t.exports=function(e){1!==l.push(e)||c||n()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],7:[function(e,t,r){"use strict";function n(){}function i(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=d,this.queue=[],this.outcome=void 0,e!==n&&u(this,e)}function o(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function a(e,t,r){l(function(){var n;try{n=t(r)}catch(t){return f.reject(e,t)}n===e?f.reject(e,new TypeError("Cannot resolve promise with itself")):f.resolve(e,n)})}function s(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function u(e,t){function r(t){i||(i=!0,f.reject(e,t))}function n(t){i||(i=!0,f.resolve(e,t))}var i=!1,o=c(function(){t(n,r)});"error"===o.status&&r(o.value)}function c(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}var l=e(5),f={},p=["REJECTED"],h=["FULFILLED"],d=["PENDING"];t.exports=i,i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){if("function"!=typeof e&&this.state===h||"function"!=typeof t&&this.state===p)return this;var r=new this.constructor(n);return this.state!==d?a(r,this.state===h?e:t,this.outcome):this.queue.push(new o(r,e,t)),r},o.prototype.callFulfilled=function(e){f.resolve(this.promise,e)},o.prototype.otherCallFulfilled=function(e){a(this.promise,this.onFulfilled,e)},o.prototype.callRejected=function(e){f.reject(this.promise,e)},o.prototype.otherCallRejected=function(e){a(this.promise,this.onRejected,e)},f.resolve=function(e,t){var r=c(s,t);if("error"===r.status)return f.reject(e,r.value);var n=r.value;if(n)u(e,n);else{e.state=h,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},f.reject=function(e,t){e.state=p,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},i.resolve=function(e){return e instanceof this?e:f.resolve(new this(n),e)},i.reject=function(e){var t=new this(n);return f.reject(t,e)},i.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var o=new Array(r),a=0,s=-1,u=new this(n);++s<r;)!function(e,n){t.resolve(e).then(function(e){o[n]=e,++a!==r||i||(i=!0,f.resolve(u,o))},function(e){i||(i=!0,f.reject(u,e))})}(e[s],s);return u},i.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var o=-1,a=new this(n);++o<r;)!function(e){t.resolve(e).then(function(e){i||(i=!0,f.resolve(a,e))},function(e){i||(i=!0,f.reject(a,e))})}(e[o]);return a}},{5:5}],8:[function(e,t,r){function n(e){if(!((e=String(e)).length>1e4)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*f;case"days":case"day":case"d":return r*l;case"hours":case"hour":case"hrs":case"hr":case"h":return r*c;case"minutes":case"minute":case"mins":case"min":case"m":return r*u;case"seconds":case"second":case"secs":case"sec":case"s":return r*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function i(e){return e>=l?Math.round(e/l)+"d":e>=c?Math.round(e/c)+"h":e>=u?Math.round(e/u)+"m":e>=s?Math.round(e/s)+"s":e+"ms"}function o(e){return a(e,l,"day")||a(e,c,"hour")||a(e,u,"minute")||a(e,s,"second")||e+" ms"}function a(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var s=1e3,u=60*s,c=60*u,l=24*c,f=365.25*l;t.exports=function(e,t){t=t||{};var r=typeof e;if("string"===r&&e.length>0)return n(e);if("number"===r&&!1===isNaN(e))return t.long?o(e):i(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],9:[function(e,t,r){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(f===setTimeout)return setTimeout(e,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function a(e){if(p===clearTimeout)return clearTimeout(e);if((p===i||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(e);try{return p(e)}catch(t){try{return p.call(null,e)}catch(t){return p.call(this,e)}}}function s(){v&&d&&(v=!1,d.length?m=d.concat(m):y=-1,m.length&&u())}function u(){if(!v){var e=o(s);v=!0;for(var t=m.length;t;){for(d=m,m=[];++y<t;)d&&d[y].run();y=-1,t=m.length}d=null,v=!1,a(e)}}function c(e,t){this.fun=e,this.array=t}function l(){}var f,p,h=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(e){f=n}try{p="function"==typeof clearTimeout?clearTimeout:i}catch(e){p=i}}();var d,m=[],v=!1,y=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];m.push(new c(e,t)),1!==m.length||v||o(u)},c.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=l,h.addListener=l,h.once=l,h.off=l,h.removeListener=l,h.removeAllListeners=l,h.emit=l,h.prependListener=l,h.prependOnceListener=l,h.listeners=function(e){return[]},h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],10:[function(e,t,r){!function(e){if("object"==typeof r)t.exports=e();else{var n;try{n=window}catch(e){n=self}n.SparkMD5=e()}}(function(e){"use strict";function t(e,t){var r=e[0],n=e[1],i=e[2],o=e[3];n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&i)+t[1]-389564586|0)<<12|o>>>20)+r|0)&r|~o&n)+t[2]+606105819|0)<<17|i>>>15)+o|0)&o|~i&r)+t[3]-1044525330|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&i)+t[5]+1200080426|0)<<12|o>>>20)+r|0)&r|~o&n)+t[6]-1473231341|0)<<17|i>>>15)+o|0)&o|~i&r)+t[7]-45705983|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&i)+t[9]-1958414417|0)<<12|o>>>20)+r|0)&r|~o&n)+t[10]-42063|0)<<17|i>>>15)+o|0)&o|~i&r)+t[11]-1990404162|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&i)+t[13]-40341101|0)<<12|o>>>20)+r|0)&r|~o&n)+t[14]-1502002290|0)<<17|i>>>15)+o|0)&o|~i&r)+t[15]+1236535329|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[1]-165796510|0)<<5|r>>>27)+n|0)&i|n&~i)+t[6]-1069501632|0)<<9|o>>>23)+r|0)&n|r&~n)+t[11]+643717713|0)<<14|i>>>18)+o|0)&r|o&~r)+t[0]-373897302|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[5]-701558691|0)<<5|r>>>27)+n|0)&i|n&~i)+t[10]+38016083|0)<<9|o>>>23)+r|0)&n|r&~n)+t[15]-660478335|0)<<14|i>>>18)+o|0)&r|o&~r)+t[4]-405537848|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[9]+568446438|0)<<5|r>>>27)+n|0)&i|n&~i)+t[14]-1019803690|0)<<9|o>>>23)+r|0)&n|r&~n)+t[3]-187363961|0)<<14|i>>>18)+o|0)&r|o&~r)+t[8]+1163531501|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[13]-1444681467|0)<<5|r>>>27)+n|0)&i|n&~i)+t[2]-51403784|0)<<9|o>>>23)+r|0)&n|r&~n)+t[7]+1735328473|0)<<14|i>>>18)+o|0)&r|o&~r)+t[12]-1926607734|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[5]-378558|0)<<4|r>>>28)+n|0)^n^i)+t[8]-2022574463|0)<<11|o>>>21)+r|0)^r^n)+t[11]+1839030562|0)<<16|i>>>16)+o|0)^o^r)+t[14]-35309556|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[1]-1530992060|0)<<4|r>>>28)+n|0)^n^i)+t[4]+1272893353|0)<<11|o>>>21)+r|0)^r^n)+t[7]-155497632|0)<<16|i>>>16)+o|0)^o^r)+t[10]-1094730640|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[13]+681279174|0)<<4|r>>>28)+n|0)^n^i)+t[0]-358537222|0)<<11|o>>>21)+r|0)^r^n)+t[3]-722521979|0)<<16|i>>>16)+o|0)^o^r)+t[6]+76029189|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[9]-640364487|0)<<4|r>>>28)+n|0)^n^i)+t[12]-421815835|0)<<11|o>>>21)+r|0)^r^n)+t[15]+530742520|0)<<16|i>>>16)+o|0)^o^r)+t[2]-995338651|0)<<23|n>>>9)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[0]-198630844|0)<<6|r>>>26)+n|0)|~i))+t[7]+1126891415|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[14]-1416354905|0)<<15|i>>>17)+o|0)|~r))+t[5]-57434055|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[12]+1700485571|0)<<6|r>>>26)+n|0)|~i))+t[3]-1894986606|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[10]-1051523|0)<<15|i>>>17)+o|0)|~r))+t[1]-2054922799|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[8]+1873313359|0)<<6|r>>>26)+n|0)|~i))+t[15]-30611744|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[6]-1560198380|0)<<15|i>>>17)+o|0)|~r))+t[13]+1309151649|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[4]-145523070|0)<<6|r>>>26)+n|0)|~i))+t[11]-1120210379|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[2]+718787259|0)<<15|i>>>17)+o|0)|~r))+t[9]-343485551|0)<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0}function r(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function n(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function i(e){var n,i,o,a,s,u,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=c;n+=64)t(l,r(e.substring(n-64,n)));for(i=(e=e.substring(n-64)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<i;n+=1)o[n>>2]|=e.charCodeAt(n)<<(n%4<<3);if(o[n>>2]|=128<<(n%4<<3),n>55)for(t(l,o),n=0;n<16;n+=1)o[n]=0;return a=8*c,a=a.toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),u=parseInt(a[1],16)||0,o[14]=s,o[15]=u,t(l,o),l}function o(e){var r,i,o,a,s,u,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(r=64;r<=c;r+=64)t(l,n(e.subarray(r-64,r)));for(i=(e=r-64<c?e.subarray(r-64):new Uint8Array(0)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<i;r+=1)o[r>>2]|=e[r]<<(r%4<<3);if(o[r>>2]|=128<<(r%4<<3),r>55)for(t(l,o),r=0;r<16;r+=1)o[r]=0;return a=8*c,a=a.toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),u=parseInt(a[1],16)||0,o[14]=s,o[15]=u,t(l,o),l}function a(e){var t,r="";for(t=0;t<4;t+=1)r+=d[e>>8*t+4&15]+d[e>>8*t&15];return r}function s(e){var t;for(t=0;t<e.length;t+=1)e[t]=a(e[t]);return e.join("")}function u(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function c(e,t){var r,n=e.length,i=new ArrayBuffer(n),o=new Uint8Array(i);for(r=0;r<n;r+=1)o[r]=e.charCodeAt(r);return t?o:i}function l(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function f(e,t,r){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e)),n.set(new Uint8Array(t),e.byteLength),r?n:n.buffer}function p(e){var t,r=[],n=e.length;for(t=0;t<n-1;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function h(){this.reset()}var d=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==s(i("hello"))&&function(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r},"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,n){var i,o,a,s,u=this.byteLength,c=t(r,u),l=u;return n!==e&&(l=t(n,u)),c>l?new ArrayBuffer(0):(i=l-c,o=new ArrayBuffer(i),a=new Uint8Array(o),s=new Uint8Array(this,c,i),a.set(s),o)}}(),h.prototype.append=function(e){return this.appendBinary(u(e)),this},h.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var n,i=this._buff.length;for(n=64;n<=i;n+=64)t(this._hash,r(this._buff.substring(n-64,n)));return this._buff=this._buff.substring(n-64),this},h.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(o,i),r=s(this._hash),e&&(r=p(r)),this.reset(),r},h.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},h.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},h.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},h.prototype._finish=function(e,r){var n,i,o,a=r;if(e[a>>2]|=128<<(a%4<<3),a>55)for(t(this._hash,e),a=0;a<16;a+=1)e[a]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),o=parseInt(n[1],16)||0,e[14]=i,e[15]=o,t(this._hash,e)},h.hash=function(e,t){return h.hashBinary(u(e),t)},h.hashBinary=function(e,t){var r=s(i(e));return t?p(r):r},h.ArrayBuffer=function(){this.reset()},h.ArrayBuffer.prototype.append=function(e){var r,i=f(this._buff.buffer,e,!0),o=i.length;for(this._length+=e.byteLength,r=64;r<=o;r+=64)t(this._hash,n(i.subarray(r-64,r)));return this._buff=r-64<o?new Uint8Array(i.buffer.slice(r-64)):new Uint8Array(0),this},h.ArrayBuffer.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n[t]<<(t%4<<3);return this._finish(o,i),r=s(this._hash),e&&(r=p(r)),this.reset(),r},h.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.ArrayBuffer.prototype.getState=function(){var e=h.prototype.getState.call(this);return e.buff=l(e.buff),e},h.ArrayBuffer.prototype.setState=function(e){return e.buff=c(e.buff,!0),h.prototype.setState.call(this,e)},h.ArrayBuffer.prototype.destroy=h.prototype.destroy,h.ArrayBuffer.prototype._finish=h.prototype._finish,h.ArrayBuffer.hash=function(e,t){var r=s(o(new Uint8Array(e)));return t?p(r):r},h})},{}],11:[function(e,t,r){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);t.exports=function(e,t){var r=t||0,i=n;return i[e[r++]]+i[e[r++]]+i[e[r++]]+i[e[r++]]+"-"+i[e[r++]]+i[e[r++]]+"-"+i[e[r++]]+i[e[r++]]+"-"+i[e[r++]]+i[e[r++]]+"-"+i[e[r++]]+i[e[r++]]+i[e[r++]]+i[e[r++]]+i[e[r++]]+i[e[r++]]}},{}],12:[function(e,t,r){(function(e){var r,n=e.crypto||e.msCrypto;if(n&&n.getRandomValues){var i=new Uint8Array(16);r=function(){return n.getRandomValues(i),i}}if(!r){var o=new Array(16);r=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],13:[function(e,t,r){var n=e(12),i=e(11);t.exports=function(e,t,r){var o=t&&r||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||n)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[o+s]=a[s];return t||i(a)}},{11:11,12:12}],14:[function(e,t,r){"use strict";function n(e,t,r){var n=r[r.length-1];e===n.element&&(r.pop(),n=r[r.length-1]);var i=n.element,o=n.index;Array.isArray(i)?i.push(e):o===t.length-2?i[t.pop()]=e:t.push(e)}r.stringify=function(e){var t=[];t.push({obj:e});for(var r,n,i,o,a,s,u,c,l,f,p,h="";r=t.pop();)if(n=r.obj,i=r.prefix||"",o=r.val||"",h+=i,o)h+=o;else if("object"!=typeof n)h+=void 0===n?null:JSON.stringify(n);else if(null===n)h+="null";else if(Array.isArray(n)){for(t.push({val:"]"}),a=n.length-1;a>=0;a--)s=0===a?"":",",t.push({obj:n[a],prefix:s});t.push({val:"["})}else{u=[];for(c in n)n.hasOwnProperty(c)&&u.push(c);for(t.push({val:"}"}),a=u.length-1;a>=0;a--)f=n[l=u[a]],p=a>0?",":"",p+=JSON.stringify(l)+":",t.push({obj:f,prefix:p});t.push({val:"{"})}return h},r.parse=function(e){for(var t,r,i,o,a,s,u,c,l,f=[],p=[],h=0;;)if("}"!==(t=e[h++])&&"]"!==t&&void 0!==t)switch(t){case" ":case"\t":case"\n":case":":case",":break;case"n":h+=3,n(null,f,p);break;case"t":h+=3,n(!0,f,p);break;case"f":h+=4,n(!1,f,p);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(r="",h--;;){if(i=e[h++],!/[\d\.\-e\+]/.test(i)){h--;break}r+=i}n(parseFloat(r),f,p);break;case'"':for(o="",a=void 0,s=0;;){if('"'===(u=e[h++])&&("\\"!==a||s%2!=1))break;o+=u,"\\"===(a=u)?s++:s=0}n(JSON.parse('"'+o+'"'),f,p);break;case"[":c={element:[],index:f.length},f.push(c.element),p.push(c);break;case"{":l={element:{},index:f.length},f.push(l.element),p.push(l);break;default:throw new Error("unexpectedly reached end of input: "+t)}else{if(1===f.length)return f.pop();n(f.pop(),f,p)}}},{}],15:[function(e,t,r){(function(r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function i(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer||"undefined"!=typeof Blob&&e instanceof Blob}function o(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),r=new Uint8Array(t),n=new Uint8Array(e);return r.set(n),t}function a(e){if(e instanceof ArrayBuffer)return o(e);var t=e.size,r=e.type;return"function"==typeof e.slice?e.slice(0,t,r):e.webkitSlice(0,t,r)}function s(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var r=t.constructor;return"function"==typeof r&&r instanceof r&&oi.call(r)==ai}function u(e){var t,r,n;if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(t=[],r=0,n=e.length;r<n;r++)t[r]=u(e[r]);return t}if(e instanceof Date)return e.toISOString();if(i(e))return a(e);if(!s(e))return e;t={};for(r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=u(e[r]);void 0!==o&&(t[r]=o)}return t}function c(e){var t=!1;return Kn(function(r){if(t)throw new Error("once called more than once");t=!0,e.apply(this,r)})}function l(e){return Kn(function(t){var r=this,n="function"==typeof(t=u(t))[t.length-1]&&t.pop(),i=new ii(function(n,i){var o;try{var a=c(function(e,t){e?i(e):n(t)});t.push(a),(o=e.apply(r,t))&&"function"==typeof o.then&&n(o)}catch(e){i(e)}});return n&&i.then(function(e){n(null,e)},n),i})}function f(e,t,r){if(e.constructor.listeners("debug").length){for(var n=["api",e.name,t],i=0;i<r.length-1;i++)n.push(r[i]);e.constructor.emit("debug",n);var o=r[r.length-1];r[r.length-1]=function(r,n){var i=["api",e.name,t];i=i.concat(r?["error",r]:["success",n]),e.constructor.emit("debug",i),o(r,n)}}}function p(e,t){return l(Kn(function(r){if(this._closed)return ii.reject(new Error("database is closed"));if(this._destroyed)return ii.reject(new Error("database is destroyed"));var n=this;return f(n,e,r),this.taskqueue.isReady?t.apply(this,r):new ii(function(t,i){n.taskqueue.addTask(function(o){o?i(o):t(n[e].apply(n,r))})})}))}function h(e){return"$"+e}function d(e){return e.substring(1)}function m(){this._store={}}function v(e){if(this._store=new m,e&&Array.isArray(e))for(var t=0,r=e.length;t<r;t++)this.add(e[t])}function y(e,t){for(var r={},n=0,i=t.length;n<i;n++){var o=t[n];o in e&&(r[o]=e[o])}return r}function g(e){return e}function b(e){return[{ok:e}]}function _(e,t,r){function n(){var e=[];p.forEach(function(t){t.docs.forEach(function(r){e.push({id:t.id,docs:[r]})})}),r(null,{results:e})}function i(){++f===l&&n()}function o(e,t,r){p[e]={id:t,docs:r},i()}function a(){if(!(d>=h.length)){var e=Math.min(d+li,h.length),t=h.slice(d,e);s(t,d),d+=t.length}}function s(r,n){r.forEach(function(r,i){var s=n+i,u=c.get(r),l=y(u[0],["atts_since","attachments"]);l.open_revs=u.map(function(e){return e.rev}),l.open_revs=l.open_revs.filter(g);var f=g;0===l.open_revs.length&&(delete l.open_revs,f=b),["revs","attachments","binary","ajax","latest"].forEach(function(e){e in t&&(l[e]=t[e])}),e.get(r,l,function(e,t){var n;n=e?[{error:e}]:f(t),o(s,r,n),a()})})}var u=t.docs,c=new ui;u.forEach(function(e){c.has(e.id)?c.get(e.id).push(e):c.set(e.id,[e])});var l=c.size,f=0,p=new Array(l),h=[];c.forEach(function(e,t){h.push(t)});var d=0;a()}function x(){return"undefined"!=typeof chrome&&void 0!==chrome.storage&&void 0!==chrome.storage.local}function w(){return ci}function k(e){x()?chrome.storage.onChanged.addListener(function(t){null!=t.db_name&&e.emit(t.dbName.newValue)}):w()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(t){e.emit(t.key)}):window.attachEvent("storage",function(t){e.emit(t.key)}))}function E(){Qn.EventEmitter.call(this),this._listeners={},k(this)}function S(e){if("undefined"!==console&&e in console){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function A(e,t){return e=parseInt(e,10)||0,(t=parseInt(t,10))!==t||t<=e?t=(e||1)<<1:t+=1,t>6e5&&(e=3e5,t=6e5),~~((t-e)*Math.random()+e)}function D(e){var t=0;return e||(t=2e3),A(e,t)}function C(e,t){S("info","The above "+e+" is totally normal. "+t)}function F(e,t,r){Error.call(this,r),this.status=e,this.name=t,this.message=r,this.error=!0}function j(e,t){function r(t){for(var r in e)"function"!=typeof e[r]&&(this[r]=e[r]);void 0!==t&&(this.reason=t)}return r.prototype=F.prototype,new r(t)}function T(e){if("object"!=typeof e){var t=e;(e=bi).data=t}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}function O(e,t,r){try{return!e(t,r)}catch(e){var n="Filter function threw: "+e.toString();return j(ki,n)}}function R(e){var t={},r=e.filter&&"function"==typeof e.filter;return t.query=e.query_params,function(n){n.doc||(n.doc={});var i=r&&O(e.filter,n.doc,t);if("object"==typeof i)return i;if(i)return!1;if(e.include_docs){if(!e.attachments)for(var o in n.doc._attachments)n.doc._attachments.hasOwnProperty(o)&&(n.doc._attachments[o].stub=!0)}else delete n.doc;return!0}}function B(e){for(var t=[],r=0,n=e.length;r<n;r++)t=t.concat(e[r]);return t}function P(e){var t;if(e?"string"!=typeof e?t=j(vi):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=j(gi)):t=j(yi),t)throw t}function I(e){return"boolean"==typeof e._remote?e._remote:"function"==typeof e.type&&(S("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===e.type())}function L(e,t){return"listenerCount"in e?e.listenerCount(t):Qn.EventEmitter.listenerCount(e,t)}function N(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}function M(e){var t=N(e);return t?t.join("/"):null}function q(e){for(var t=Oi.exec(e),r={},n=14;n--;){var i=Fi[n],o=t[n]||"",a=-1!==["user","password"].indexOf(i);r[i]=a?decodeURIComponent(o):o}return r[ji]={},r[Fi[12]].replace(Ti,function(e,t,n){t&&(r[ji][t]=n)}),r}function $(e,t){var r=[],n=[];for(var i in t)t.hasOwnProperty(i)&&(r.push(i),n.push(t[i]));return r.push(e),Function.apply(null,r).apply(null,n)}function W(e,t,r){return new ii(function(n,i){e.get(t,function(o,a){if(o){if(404!==o.status)return i(o);a={}}var s=a._rev,u=r(a);if(!u)return n({updated:!1,rev:s});u._id=t,u._rev=s,n(U(e,u,r))})})}function U(e,t,r){return e.put(t).then(function(e){return{updated:!0,rev:e.rev}},function(n){if(409!==n.status)throw n;return W(e,t._id,r)})}function G(){return ei().replace(/-/g,"").toLowerCase()}function z(e){for(var t,r,n,i,o=e.rev_tree.slice();i=o.pop();){var a=i.ids,s=a[2],u=i.pos;if(s.length)for(var c=0,l=s.length;c<l;c++)o.push({pos:u+1,ids:s[c]});else{var f=!!a[1].deleted,p=a[0];t&&!(n!==f?n:r!==u?r<u:t<p)||(t=p,r=u,n=f)}}return r+"-"+t}function V(e,t){for(var r,n=e.slice();r=n.pop();)for(var i=r.pos,o=r.ids,a=o[2],s=t(0===a.length,i,o[0],r.ctx,o[1]),u=0,c=a.length;u<c;u++)n.push({pos:i+1,ids:a[u],ctx:s})}function J(e,t){return e.pos-t.pos}function H(e){var t=[];V(e,function(e,r,n,i,o){e&&t.push({rev:r+"-"+n,pos:r,opts:o})}),t.sort(J).reverse();for(var r=0,n=t.length;r<n;r++)delete t[r].pos;return t}function X(e){for(var t=z(e),r=H(e.rev_tree),n=[],i=0,o=r.length;i<o;i++){var a=r[i];a.rev===t||a.opts.deleted||n.push(a.rev)}return n}function K(e){var t=[];return V(e.rev_tree,function(e,r,n,i,o){"available"!==o.status||e||(t.push(r+"-"+n),o.status="missing")}),t}function Q(e){for(var t,r=[],n=e.slice();t=n.pop();){var i=t.pos,o=t.ids,a=o[0],s=o[1],u=o[2],c=0===u.length,l=t.history?t.history.slice():[];l.push({id:a,opts:s}),c&&r.push({pos:i+1-l.length,ids:l});for(var f=0,p=u.length;f<p;f++)n.push({pos:i+1,ids:u[f],history:l})}return r.reverse()}function Y(e,t){return e.pos-t.pos}function Z(e,t,r){for(var n,i=0,o=e.length;i<o;)r(e[n=i+o>>>1],t)<0?i=n+1:o=n;return i}function ee(e,t,r){var n=Z(e,t,r);e.splice(n,0,t)}function te(e,t){for(var r,n,i=t,o=e.length;i<o;i++){var a=e[i],s=[a.id,a.opts,[]];n?(n[2].push(s),n=s):r=n=s}return r}function re(e,t){return e[0]<t[0]?-1:1}function ne(e,t){for(var r=[{tree1:e,tree2:t}],n=!1;r.length>0;){var i=r.pop(),o=i.tree1,a=i.tree2;(o[1].status||a[1].status)&&(o[1].status="available"===o[1].status||"available"===a[1].status?"available":"missing");for(var s=0;s<a[2].length;s++)if(o[2][0]){for(var u=!1,c=0;c<o[2].length;c++)o[2][c][0]===a[2][s][0]&&(r.push({tree1:o[2][c],tree2:a[2][s]}),u=!0);u||(n="new_branch",ee(o[2],a[2][s],re))}else n="new_leaf",o[2][0]=a[2][s]}return{conflicts:n,tree:e}}function ie(e,t,r){var n,i=[],o=!1,a=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var s=0,u=e.length;s<u;s++){var c=e[s];if(c.pos===t.pos&&c.ids[0]===t.ids[0])n=ne(c.ids,t.ids),i.push({pos:c.pos,ids:n.tree}),o=o||n.conflicts,a=!0;else if(!0!==r){var l=c.pos<t.pos?c:t,f=c.pos<t.pos?t:c,p=f.pos-l.pos,h=[],d=[];for(d.push({ids:l.ids,diff:p,parent:null,parentIdx:null});d.length>0;){var m=d.pop();if(0!==m.diff)for(var v=m.ids[2],y=0,g=v.length;y<g;y++)d.push({ids:v[y],diff:m.diff-1,parent:m.ids,parentIdx:y});else m.ids[0]===f.ids[0]&&h.push(m)}var b=h[0];b?(n=ne(b.ids,f.ids),b.parent[2][b.parentIdx]=n.tree,i.push({pos:l.pos,ids:l.ids}),o=o||n.conflicts,a=!0):i.push(c)}else i.push(c)}return a||i.push(t),i.sort(Y),{tree:i,conflicts:o||"internal_node"}}function oe(e,t){for(var r,n,i=Q(e),o=0,a=i.length;o<a;o++){var s,u=i[o],c=u.ids;if(c.length>t){r||(r={});var l=c.length-t;s={pos:u.pos+l,ids:te(c,l)};for(var f=0;f<l;f++){var p=u.pos+f+"-"+c[f].id;r[p]=!0}}else s={pos:u.pos,ids:te(c,0)};n=n?ie(n,s,!0).tree:[s]}return r&&V(n,function(e,t,n){delete r[t+"-"+n]}),{tree:n,revs:r?Object.keys(r):[]}}function ae(e,t,r){var n=ie(e,t),i=oe(n.tree,r);return{tree:i.tree,stemmedRevs:i.revs,conflicts:n.conflicts}}function se(e,t){for(var r,n=e.slice(),i=t.split("-"),o=parseInt(i[0],10),a=i[1];r=n.pop();){if(r.pos===o&&r.ids[0]===a)return!0;for(var s=r.ids[2],u=0,c=s.length;u<c;u++)n.push({pos:r.pos+1,ids:s[u]})}return!1}function ue(e){return e.ids}function ce(e,t){t||(t=z(e));for(var r,n=t.substring(t.indexOf("-")+1),i=e.rev_tree.map(ue);r=i.pop();){if(r[0]===n)return!!r[1].deleted;i=i.concat(r[2])}}function le(e){return/^_local/.test(e)}function fe(e,t){for(var r,n=t.rev_tree.slice();r=n.pop();){var i=r.pos,o=r.ids,a=o[0],s=o[1],u=o[2],c=0===u.length,l=r.history?r.history.slice():[];if(l.push({id:a,pos:i,opts:s}),c)for(var f=0,p=l.length;f<p;f++){var h=l[f];if(h.pos+"-"+h.id===e)return i+"-"+a}for(var d=0,m=u.length;d<m;d++)n.push({pos:i+1,ids:u[d],history:l})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}function pe(e,t){try{e.emit("change",t)}catch(e){S("error",'Error in .on("change", function):',e)}}function he(e,t,r){function n(){i.cancel()}Qn.EventEmitter.call(this);var i=this;this.db=e;var o=(t=t?u(t):{}).complete=c(function(t,r){t?L(i,"error")>0&&i.emit("error",t):i.emit("complete",r),i.removeAllListeners(),e.removeListener("destroyed",n)});r&&(i.on("complete",function(e){r(null,e)}),i.on("error",r)),e.once("destroyed",n),t.onChange=function(e){i.isCancelled||pe(i,e)};var a=new ii(function(e,r){t.complete=function(t,n){t?r(t):e(n)}});i.once("cancel",function(){e.removeListener("destroyed",n),t.complete(null,{status:"cancelled"})}),this.then=a.then.bind(a),this.catch=a.catch.bind(a),this.then(function(e){o(null,e)},o),e.taskqueue.isReady?i.validateChanges(t):e.taskqueue.addTask(function(e){e?t.complete(e):i.isCancelled?i.emit("cancel"):i.validateChanges(t)})}function de(e,t,r){var n=[{rev:e._rev}];"all_docs"===r.style&&(n=H(t.rev_tree).map(function(e){return{rev:e.rev}}));var i={id:t.id,changes:n,doc:e};return ce(t,e._rev)&&(i.deleted=!0),r.conflicts&&(i.doc._conflicts=X(t),i.doc._conflicts.length||delete i.doc._conflicts),i}function me(e,t){return e<t?-1:e>t?1:0}function ve(e,t){return function(r,n){r||n[0]&&n[0].error?((r=r||n[0]).docId=t,e(r)):e(null,n.length?n[0]:n)}}function ye(e){for(var t=0;t<e.length;t++){var r=e[t];if(r._deleted)delete r._attachments;else if(r._attachments)for(var n=Object.keys(r._attachments),i=0;i<n.length;i++){var o=n[i];r._attachments[o]=y(r._attachments[o],["data","digest","content_type","length","revpos","stub"])}}}function ge(e,t){var r=me(e._id,t._id);return 0!==r?r:me(e._revisions?e._revisions.start:0,t._revisions?t._revisions.start:0)}function be(e){var t={},r=[];return V(e,function(e,n,i,o){var a=n+"-"+i;return e&&(t[a]=0),void 0!==o&&r.push({from:o,to:a}),a}),r.reverse(),r.forEach(function(e){void 0===t[e.from]?t[e.from]=1+t[e.to]:t[e.from]=Math.min(t[e.from],1+t[e.to])}),t}function _e(e,t,r){var n="limit"in t?t.keys.slice(t.skip,t.limit+t.skip):t.skip>0?t.keys.slice(t.skip):t.keys;if(t.descending&&n.reverse(),!n.length)return e._allDocs({limit:0},r);var i={offset:t.skip};return ii.all(n.map(function(r){var n=pi({key:r,deleted:"ok"},t);return["limit","skip","keys"].forEach(function(e){delete n[e]}),new ii(function(t,o){e._allDocs(n,function(e,n){if(e)return o(e);i.total_rows=n.total_rows,t(n.rows[0]||{key:r,error:"not_found"})})})})).then(function(e){return i.rows=e,i})}function xe(e){var t=e._compactionQueue[0],r=t.opts,n=t.callback;e.get("_local/compaction").catch(function(){return!1}).then(function(t){t&&t.last_seq&&(r.last_seq=t.last_seq),e._compact(r,function(t,r){t?n(t):n(null,r),Zn(function(){e._compactionQueue.shift(),e._compactionQueue.length&&xe(e)})})})}function we(e){return"_"===e.charAt(0)&&e+" is not a valid attachment name, attachment names cannot start with '_'"}function ke(){Qn.EventEmitter.call(this)}function Ee(){this.isReady=!1,this.failed=!1,this.queue=[]}function Se(e,t){var r=e.match(/([a-z-]*):\/\/(.*)/);if(r)return{name:/https?/.test(r[1])?r[1]+"://"+r[2]:r[2],adapter:r[1]};var n=De.adapters,i=De.preferredAdapters,o=De.prefix,a=t.adapter;if(!a)for(var s=0;s<i.length&&("idb"===(a=i[s])&&"websql"in n&&w()&&localStorage["_pouch__websqldb_"+o+e]);++s)S("log",'PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');var u=n[a];return{name:!(u&&"use_prefix"in u)||u.use_prefix?o+e:e,adapter:a}}function Ae(e){function t(t){e.removeListener("closed",r),t||e.constructor.emit("destroyed",e.name)}function r(){e.removeListener("destroyed",t),e.constructor.emit("unref",e)}e.once("destroyed",t),e.once("closed",r),e.constructor.emit("ref",e)}function De(e,t){if(!(this instanceof De))return new De(e,t);var r=this;if(t=t||{},e&&"object"==typeof e&&(e=(t=e).name,delete t.name),this.__opts=t=u(t),r.auto_compaction=t.auto_compaction,r.prefix=De.prefix,"string"!=typeof e)throw new Error("Missing/invalid DB name");var n=Se((t.prefix||"")+e,t);if(t.name=n.name,t.adapter=t.adapter||n.adapter,r.name=e,r._adapter=t.adapter,De.emit("debug",["adapter","Picked adapter: ",t.adapter]),!De.adapters[t.adapter]||!De.adapters[t.adapter].valid())throw new Error("Invalid Adapter: "+t.adapter);ke.call(r),r.taskqueue=new Ee,r.adapter=t.adapter,De.adapters[t.adapter].call(r,t,function(e){if(e)return r.taskqueue.fail(e);Ae(r),r.emit("created",r),De.emit("created",r.name),r.taskqueue.ready(r)})}function Ce(e,t){for(var r=e,n=0,i=t.length;n<i&&(r=r[t[n]]);n++);return r}function Fe(e,t){return e<t?-1:e>t?1:0}function je(e){for(var t=[],r="",n=0,i=e.length;n<i;n++){var o=e[n];"."===o?n>0&&"\\"===e[n-1]?r=r.substring(0,r.length-1)+".":(t.push(r),r=""):r+=o}return t.push(r),t}function Te(e){return Pi.indexOf(e)>-1}function Oe(e){return Object.keys(e)[0]}function Re(e){return e[Oe(e)]}function Be(e){var t={};return e.forEach(function(e){Object.keys(e).forEach(function(r){var n=e[r];if("object"!=typeof n&&(n={$eq:n}),Te(r))n instanceof Array?t[r]=n.map(function(e){return Be([e])}):t[r]=Be([n]);else{var i=t[r]=t[r]||{};Object.keys(n).forEach(function(e){var t=n[e];return"$gt"===e||"$gte"===e?Pe(e,t,i):"$lt"===e||"$lte"===e?Ie(e,t,i):"$ne"===e?Le(t,i):"$eq"===e?Ne(t,i):void(i[e]=t)})}})}),t}function Pe(e,t,r){void 0===r.$eq&&(void 0!==r.$gte?"$gte"===e?t>r.$gte&&(r.$gte=t):t>=r.$gte&&(delete r.$gte,r.$gt=t):void 0!==r.$gt?"$gte"===e?t>r.$gt&&(delete r.$gt,r.$gte=t):t>r.$gt&&(r.$gt=t):r[e]=t)}function Ie(e,t,r){void 0===r.$eq&&(void 0!==r.$lte?"$lte"===e?t<r.$lte&&(r.$lte=t):t<=r.$lte&&(delete r.$lte,r.$lt=t):void 0!==r.$lt?"$lte"===e?t<r.$lt&&(delete r.$lt,r.$lte=t):t<r.$lt&&(r.$lt=t):r[e]=t)}function Le(e,t){"$ne"in t?t.$ne.push(e):t.$ne=[e]}function Ne(e,t){delete t.$gt,delete t.$gte,delete t.$lt,delete t.$lte,delete t.$ne,t.$eq=e}function Me(e){var t=u(e),r=!1;"$and"in t&&(t=Be(t.$and),r=!0),["$or","$nor"].forEach(function(e){e in t&&t[e].forEach(function(e){for(var t=Object.keys(e),r=0;r<t.length;r++){var n=t[r],i=e[n];"object"==typeof i&&null!==i||(e[n]={$eq:i})}})}),"$not"in t&&(t.$not=Be([t.$not]));for(var n=Object.keys(t),i=0;i<n.length;i++){var o=n[i],a=t[o];"object"!=typeof a||null===a?a={$eq:a}:"$ne"in a&&!r&&(a.$ne=[a.$ne]),t[o]=a}return t}function qe(e,t,r){for(var n="",i=r-e.length;n.length<i;)n+=t;return n}function $e(e,t,r){return qe(e,t,r)+e}function We(e,t){if(e===t)return 0;e=Ue(e),t=Ue(t);var r=Ye(e),n=Ye(t);if(r-n!=0)return r-n;switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return Ke(e,t)}return Array.isArray(e)?Xe(e,t):Qe(e,t)}function Ue(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var r=e.length;e=new Array(r);for(var n=0;n<r;n++)e[n]=Ue(t[n])}else{if(e instanceof Date)return e.toJSON();if(null!==e){e={};for(var i in t)if(t.hasOwnProperty(i)){var o=t[i];void 0!==o&&(e[i]=Ue(o))}}}}return e}function Ge(e){if(null!==e)switch(typeof e){case"boolean":return e?1:0;case"number":return Ze(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),r=t?e:Object.keys(e),n=-1,i=r.length,o="";if(t)for(;++n<i;)o+=ze(r[n]);else for(;++n<i;){var a=r[n];o+=ze(a)+ze(e[a])}return o}return""}function ze(e){return e=Ue(e),Ye(e)+Ni+Ge(e)+"\0"}function Ve(e,t){var r,n=t;if("1"===e[t])r=0,t++;else{var i="0"===e[t];t++;var o="",a=e.substring(t,t+Li),s=parseInt(a,10)+Ii;for(i&&(s=-s),t+=Li;;){var u=e[t];if("\0"===u)break;o+=u,t++}r=1===(o=o.split(".")).length?parseInt(o,10):parseFloat(o[0]+"."+o[1]),i&&(r-=10),0!==s&&(r=parseFloat(r+"e"+s))}return{num:r,length:t-n}}function Je(e,t){var r=e.pop();if(t.length){var n=t[t.length-1];r===n.element&&(t.pop(),n=t[t.length-1]);var i=n.element,o=n.index;Array.isArray(i)?i.push(r):o===e.length-2?i[e.pop()]=r:e.push(r)}}function He(e){for(var t=[],r=[],n=0;;){var i=e[n++];if("\0"!==i)switch(i){case"1":t.push(null);break;case"2":t.push("1"===e[n]),n++;break;case"3":var o=Ve(e,n);t.push(o.num),n+=o.length;break;case"4":for(var a="";;){var s=e[n];if("\0"===s)break;a+=s,n++}a=a.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),t.push(a);break;case"5":var u={element:[],index:t.length};t.push(u.element),r.push(u);break;case"6":var c={element:{},index:t.length};t.push(c.element),r.push(c);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}else{if(1===t.length)return t.pop();Je(t,r)}}}function Xe(e,t){for(var r=Math.min(e.length,t.length),n=0;n<r;n++){var i=We(e[n],t[n]);if(0!==i)return i}return e.length===t.length?0:e.length>t.length?1:-1}function Ke(e,t){return e===t?0:e>t?1:-1}function Qe(e,t){for(var r=Object.keys(e),n=Object.keys(t),i=Math.min(r.length,n.length),o=0;o<i;o++){var a=We(r[o],n[o]);if(0!==a)return a;if(0!==(a=We(e[r[o]],t[n[o]])))return a}return r.length===n.length?0:r.length>n.length?1:-1}function Ye(e){var t=["boolean","number","string","object"].indexOf(typeof e);return~t?null===e?1:Array.isArray(e)?5:t<3?t+2:t+3:Array.isArray(e)?5:void 0}function Ze(e){if(0===e)return"1";var t=e.toExponential().split(/e\+?/),r=parseInt(t[1],10),n=e<0,i=n?"0":"2",o=$e(((n?-r:r)-Ii).toString(),"0",Li);i+=Ni+o;var a=Math.abs(parseFloat(t[0]));n&&(a=10-a);var s=a.toFixed(20);return s=s.replace(/\.?0+$/,""),i+=Ni+s}function et(e){function t(t){return e.map(function(e){var r=je(Oe(e));return Ce(t,r)})}return function(e,r){var n=We(t(e.doc),t(r.doc));return 0!==n?n:Fe(e.doc._id,r.doc._id)}}function tt(e,t,r){if(e=e.filter(function(e){return rt(e.doc,t.selector,r)}),t.sort){var n=et(t.sort);e=e.sort(n),"string"!=typeof t.sort[0]&&"desc"===Re(t.sort[0])&&(e=e.reverse())}if("limit"in t||"skip"in t){var i=t.skip||0,o=("limit"in t?t.limit:e.length)+i;e=e.slice(i,o)}return e}function rt(e,t,r){return r.every(function(r){var n=t[r],i=je(r),o=Ce(e,i);return Te(r)?it(r,n,e):nt(n,e,i,o)})}function nt(e,t,r,n){return!e||Object.keys(e).every(function(i){var o=e[i];return ot(i,t,o,r,n)})}function it(e,t,r){return"$or"===e?t.some(function(e){return rt(r,e,Object.keys(e))}):"$not"===e?!rt(r,t,Object.keys(t)):!t.find(function(e){return rt(r,e,Object.keys(e))})}function ot(e,t,r,n,i){if(!Mi[e])throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return Mi[e](t,r,n,i)}function at(e){return void 0!==e&&null!==e}function st(e){return void 0!==e}function ut(e,t){var r=t[0],n=t[1];if(0===r)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(r,10)!==r)throw new Error("Divisor is not an integer");if(parseInt(n,10)!==n)throw new Error("Modulus is not an integer");return parseInt(e,10)===e&&e%r===n}function ct(e,t){return t.some(function(t){return e instanceof Array?e.indexOf(t)>-1:e===t})}function lt(e,t){return t.every(function(t){return e.indexOf(t)>-1})}function ft(e,t){return e.length===t}function pt(e,t){return new RegExp(t).test(e)}function ht(e,t){switch(t){case"null":return null===e;case"boolean":return"boolean"==typeof e;case"number":return"number"==typeof e;case"string":return"string"==typeof e;case"array":return e instanceof Array;case"object":return"[object Object]"==={}.toString.call(e)}throw new Error(t+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}function dt(e,t){if("object"!=typeof t)throw new Error("Selector error: expected a JSON object");var r=tt([{doc:e}],{selector:t=Me(t)},Object.keys(t));return r&&1===r.length}function mt(e){return $('"use strict";\nreturn '+e+";",{})}function vt(e){return $(["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+e+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n"),{})}function yt(e,t){if(e.selector&&e.filter&&"_selector"!==e.filter){var r="string"==typeof e.filter?e.filter:"function";return t(new Error('selector invalid for filter "'+r+'"'))}t()}function gt(e){e.view&&!e.filter&&(e.filter="_view"),e.selector&&!e.filter&&(e.filter="_selector"),e.filter&&"string"==typeof e.filter&&("_view"===e.filter?e.view=M(e.view):e.filter=M(e.filter))}function bt(e,t){return t.filter&&"string"==typeof t.filter&&!t.doc_ids&&!I(e.db)}function _t(e,t){var r=t.complete;if("_view"===t.filter){if(!t.view||"string"!=typeof t.view){var n=j(ki,"`view` filter parameter not found or invalid.");return r(n)}var i=N(t.view);e.db.get("_design/"+i[0],function(n,o){if(e.isCancelled)return r(null,{status:"cancelled"});if(n)return r(T(n));var a=o&&o.views&&o.views[i[1]]&&o.views[i[1]].map;if(!a)return r(j(di,o.views?"missing json key: "+i[1]:"missing json key: views"));t.filter=vt(a),e.doChanges(t)})}else if(t.selector)t.filter=function(e){return dt(e,t.selector)},e.doChanges(t);else{var o=N(t.filter);e.db.get("_design/"+o[0],function(n,i){if(e.isCancelled)return r(null,{status:"cancelled"});if(n)return r(T(n));var a=i&&i.filters&&i.filters[o[1]];if(!a)return r(j(di,i&&i.filters?"missing json key: "+o[1]:"missing json key: filters"));t.filter=mt(a),e.doChanges(t)})}}function xt(e){return e.reduce(function(e,t){return e[t]=!0,e},{})}function wt(e){if(!/^\d+-./.test(e))return j(Di);var t=e.indexOf("-"),r=e.substring(0,t),n=e.substring(t+1);return{prefix:parseInt(r,10),id:n}}function kt(e,t){for(var r=e.start-e.ids.length+1,n=e.ids,i=[n[0],t,[]],o=1,a=n.length;o<a;o++)i=[n[o],{status:"missing"},[i]];return[{pos:r,ids:i}]}function Et(e,t){var r,n,i,o={status:"available"};if(e._deleted&&(o.deleted=!0),t)if(e._id||(e._id=Ri()),n=G(),e._rev){if((i=wt(e._rev)).error)return i;e._rev_tree=[{pos:i.prefix,ids:[i.id,{status:"missing"},[[n,o,[]]]]}],r=i.prefix+1}else e._rev_tree=[{pos:1,ids:[n,o,[]]}],r=1;else if(e._revisions&&(e._rev_tree=kt(e._revisions,o),r=e._revisions.start,n=e._revisions.ids[0]),!e._rev_tree){if((i=wt(e._rev)).error)return i;r=i.prefix,n=i.id,e._rev_tree=[{pos:r,ids:[n,o,[]]}]}P(e._id),e._rev=r+"-"+n;var a={metadata:{},data:{}};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var u="_"===s[0];if(u&&!$i[s]){var c=j(wi,s);throw c.message=wi.message+": "+s,c}u&&!Wi[s]?a.metadata[s.slice(1)]=e[s]:a.data[s]=e[s]}return a}function St(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)r.append(e[n]);return r.getBlob(t.type)}}function At(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),i=0;i<t;i++)n[i]=e.charCodeAt(i);return r}function Dt(e,t){return St([At(e)],{type:t})}function Ct(e,t){return Dt(Ui(e),t)}function Ft(e){for(var t="",r=new Uint8Array(e),n=r.byteLength,i=0;i<n;i++)t+=String.fromCharCode(r[i]);return t}function jt(e,t){if("undefined"==typeof FileReader)return t(Ft((new FileReaderSync).readAsArrayBuffer(e)));var r=new FileReader,n="function"==typeof r.readAsBinaryString;r.onloadend=function(e){var r=e.target.result||"";if(n)return t(r);t(Ft(r))},n?r.readAsBinaryString(e):r.readAsArrayBuffer(e)}function Tt(e,t){jt(e,function(e){t(e)})}function Ot(e,t){Tt(e,function(e){t(Gi(e))})}function Rt(e,t){if("undefined"==typeof FileReader)return t((new FileReaderSync).readAsArrayBuffer(e));var r=new FileReader;r.onloadend=function(e){var r=e.target.result||new ArrayBuffer(0);t(r)},r.readAsArrayBuffer(e)}function Bt(e){return Gi(e)}function Pt(e,t,r){return e.webkitSlice?e.webkitSlice(t,r):e.slice(t,r)}function It(e,t,r,n,i){(r>0||n<t.size)&&(t=Pt(t,r,n)),Rt(t,function(t){e.append(t),i()})}function Lt(e,t,r,n,i){(r>0||n<t.length)&&(t=t.substring(r,n)),e.appendBinary(t),i()}function Nt(e,t){function r(){zi(i)}function n(){var e=Bt(l.end(!0));t(e),l.destroy()}function i(){var t=c*s,i=t+s;++c<u?f(l,e,t,i,r):f(l,e,t,i,n)}var o="string"==typeof e,a=o?e.length:e.size,s=Math.min(Vi,a),u=Math.ceil(a/s),c=0,l=o?new ri:new ri.ArrayBuffer,f=o?Lt:It;i()}function Mt(e){return ri.hash(e)}function qt(e){try{return Ui(e)}catch(e){return{error:j(_i,"Attachment is not a valid base64 string")}}}function $t(e,t,r){var n=qt(e.data);if(n.error)return r(n.error);e.length=n.length,e.data="blob"===t?Dt(n,e.content_type):"base64"===t?Gi(n):n,Nt(n,function(t){e.digest="md5-"+t,r()})}function Wt(e,t,r){Nt(e.data,function(n){e.digest="md5-"+n,e.length=e.data.size||e.data.length||0,"binary"===t?Tt(e.data,function(t){e.data=t,r()}):"base64"===t?Ot(e.data,function(t){e.data=t,r()}):r()})}function Ut(e,t,r){if(e.stub)return r();"string"==typeof e.data?$t(e,t,r):Wt(e,t,r)}function Gt(e,t,r){function n(){o++,e.length===o&&(i?r(i):r())}if(!e.length)return r();var i,o=0;e.forEach(function(e){var r=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],o=0;if(!r.length)return n();for(var a in e.data._attachments)e.data._attachments.hasOwnProperty(a)&&Ut(e.data._attachments[a],t,function(e){i=e,++o===r.length&&n()})})}function zt(e,t,r,n,i,o,a,s){if(se(t.rev_tree,r.metadata.rev))return n[i]=r,o();var u=t.winningRev||z(t),c="deleted"in t?t.deleted:ce(t,u),l="deleted"in r.metadata?r.metadata.deleted:ce(r.metadata),f=/^1-/.test(r.metadata.rev);if(c&&!l&&s&&f){var p=r.data;p._rev=u,p._id=r.metadata.id,r=Et(p,s)}var h=ae(t.rev_tree,r.metadata.rev_tree[0],e);if(s&&(c&&l&&"new_leaf"!==h.conflicts||!c&&"new_leaf"!==h.conflicts||c&&!l&&"new_branch"===h.conflicts)){var d=j(mi);return n[i]=d,o()}var m=r.metadata.rev;r.metadata.rev_tree=h.tree,r.stemmedRevs=h.stemmedRevs||[],t.rev_map&&(r.metadata.rev_map=t.rev_map);var v=z(r.metadata),y=ce(r.metadata,v),g=c===y?0:c<y?-1:1;a(r,v,y,m===v?y:ce(r.metadata,m),!0,g,i,o)}function Vt(e){return"missing"===e.metadata.rev_tree[0].ids[1].status}function Jt(e,t,r,n,i,o,a,s,u){function c(e,t,r){var n=z(e.metadata),i=ce(e.metadata,n);if("was_delete"in s&&i)return o[t]=j(di,"deleted"),r();if(f&&Vt(e)){var u=j(mi);return o[t]=u,r()}a(e,n,i,i,!1,i?0:1,t,r)}function l(){++h===d&&u&&u()}e=e||1e3;var f=s.new_edits,p=new ui,h=0,d=t.length;t.forEach(function(e,t){if(e._id&&le(e._id)){var n=e._deleted?"_removeLocal":"_putLocal";r[n](e,{ctx:i},function(e,r){o[t]=e||r,l()})}else{var a=e.metadata.id;p.has(a)?(d--,p.get(a).push([e,t])):p.set(a,[[e,t]])}}),p.forEach(function(t,r){function i(){++u<t.length?s():l()}function s(){var s=t[u],l=s[0],p=s[1];if(n.has(r))zt(e,n.get(r),l,o,p,i,a,f);else{var h=ae([],l.metadata.rev_tree[0],e);l.metadata.rev_tree=h.tree,l.stemmedRevs=h.stemmedRevs||[],c(l,p,i)}}var u=0;s()})}function Ht(e){try{return JSON.parse(e)}catch(t){return ni.parse(e)}}function Xt(e){try{return JSON.stringify(e)}catch(t){return ni.stringify(e)}}function Kt(e){return function(t){var r="unknown_error";t.target&&t.target.error&&(r=t.target.error.name||t.target.error.message),e(j(Si,r,t.type))}}function Qt(e,t,r){return{data:Xt(e),winningRev:t,deletedOrLocal:r?"1":"0",seq:e.seq,id:e.id}}function Yt(e){if(!e)return null;var t=Ht(e.data);return t.winningRev=e.winningRev,t.deleted="1"===e.deletedOrLocal,t.seq=e.seq,t}function Zt(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function er(e,t,r,n){r?n(e?"string"!=typeof e?e:Ct(e,t):St([""],{type:t})):e?"string"!=typeof e?jt(e,function(e){n(Gi(e))}):n(e):n("")}function tr(e,t,r,n){function i(){++s===a.length&&n&&n()}function o(e,t){var n=e._attachments[t],o=n.digest;r.objectStore(Ki).get(o).onsuccess=function(e){n.body=e.target.result.body,i()}}var a=Object.keys(e._attachments||{});if(!a.length)return n&&n();var s=0;a.forEach(function(r){t.attachments&&t.include_docs?o(e,r):(e._attachments[r].stub=!0,i())})}function rr(e,t){return ii.all(e.map(function(e){if(e.doc&&e.doc._attachments){var r=Object.keys(e.doc._attachments);return ii.all(r.map(function(r){var n=e.doc._attachments[r];if("body"in n){var i=n.body,o=n.content_type;return new ii(function(a){er(i,o,t,function(t){e.doc._attachments[r]=pi(y(n,["digest","content_type"]),{data:t}),a()})})}}))}}))}function nr(e,t,r){function n(){--c||i()}function i(){o.length&&o.forEach(function(e){u.index("digestSeq").count(IDBKeyRange.bound(e+"::",e+"::",!1,!1)).onsuccess=function(t){t.target.result||s.delete(e)}})}var o=[],a=r.objectStore(Xi),s=r.objectStore(Ki),u=r.objectStore(Qi),c=e.length;e.forEach(function(e){var r=a.index("_doc_id_rev"),i=t+"::"+e;r.getKey(i).onsuccess=function(e){var t=e.target.result;if("number"!=typeof t)return n();a.delete(t),u.index("seq").openCursor(IDBKeyRange.only(t)).onsuccess=function(e){var t=e.target.result;if(t){var r=t.value.digestSeq.split("::")[0];o.push(r),u.delete(t.primaryKey),t.continue()}else n()}}})}function ir(e,t,r){try{return{txn:e.transaction(t,r)}}catch(e){return{error:e}}}function or(e,t,r,n,i,o){function a(){var e=ir(i,[Hi,Xi,Ki,Zi,Qi,Yi],"readwrite");if(e.error)return o(e.error);(b=e.txn).onabort=Kt(o),b.ontimeout=Kt(o),b.oncomplete=f,_=b.objectStore(Hi),x=b.objectStore(Xi),w=b.objectStore(Ki),k=b.objectStore(Qi),(E=b.objectStore(Yi)).get(Yi).onsuccess=function(e){A=e.target.result,c()},h(function(e){if(e)return I=!0,o(e);l()})}function s(){O=!0,c()}function u(){Jt(e.revs_limit,D,n,P,b,B,d,r,s)}function c(){A&&O&&(A.docCount+=R,E.put(A))}function l(){function e(){++t===D.length&&u()}if(D.length)for(var t=0,r=0,n=D.length;r<n;r++){var i=D[r];i._id&&le(i._id)?e():_.get(i.metadata.id).onsuccess=function(t){var r=Yt(t.target.result);r&&P.set(r.id,r),e()}}}function f(){I||(to.notify(n._meta.name),o(null,B))}function p(e,t){w.get(e).onsuccess=function(r){if(r.target.result)t();else{var n=j(Ci,"unknown stub attachment with digest "+e);n.status=412,t(n)}}}function h(e){function t(){++i===r.length&&e(n)}var r=[];if(D.forEach(function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach(function(t){var n=e.data._attachments[t];n.stub&&r.push(n.digest)})}),!r.length)return e();var n,i=0;r.forEach(function(e){p(e,function(e){e&&!n&&(n=e),t()})})}function d(e,t,r,n,i,o,a,s){e.metadata.winningRev=t,e.metadata.deleted=r;var u=e.data;if(u._id=e.metadata.id,u._rev=e.metadata.rev,n&&(u._deleted=!0),u._attachments&&Object.keys(u._attachments).length)return v(e,t,r,i,a,s);R+=o,c(),m(e,t,r,i,a,s)}function m(e,t,r,i,o,a){function s(o){var a=e.stemmedRevs||[];i&&n.auto_compaction&&(a=a.concat(K(e.metadata))),a&&a.length&&nr(a,e.metadata.id,b),l.seq=o.target.result;var s=Qt(l,t,r);_.put(s).onsuccess=u}function u(){B[o]={ok:!0,id:l.id,rev:l.rev},P.set(e.metadata.id,e.metadata),y(e,l.seq,a)}var c=e.data,l=e.metadata;c._doc_id_rev=l.id+"::"+l.rev,delete c._id,delete c._rev;var f=x.put(c);f.onsuccess=s,f.onerror=function(e){e.preventDefault(),e.stopPropagation(),x.index("_doc_id_rev").getKey(c._doc_id_rev).onsuccess=function(e){x.put(c,e.target.result).onsuccess=s}}}function v(e,t,r,n,i,o){function a(){c===l.length&&m(e,t,r,n,i,o)}function s(){c++,a()}var u=e.data,c=0,l=Object.keys(u._attachments);l.forEach(function(r){var n=e.data._attachments[r];if(n.stub)c++,a();else{var i=n.data;delete n.data,n.revpos=parseInt(t,10),g(n.digest,i,s)}})}function y(e,t,r){function n(){++i===o.length&&r()}var i=0,o=Object.keys(e.data._attachments||{});if(!o.length)return r();for(var a=0;a<o.length;a++)!function(r){var i=e.data._attachments[r].digest,o=k.put({seq:t,digestSeq:i+"::"+t});o.onsuccess=n,o.onerror=function(e){e.preventDefault(),e.stopPropagation(),n()}}(o[a])}function g(e,t,r){w.count(e).onsuccess=function(n){if(n.target.result)return r();var i={digest:e,body:t};w.put(i).onsuccess=r}}for(var b,_,x,w,k,E,S,A,D=t.docs,C=0,F=D.length;C<F;C++){var T=D[C];T._id&&le(T._id)||(T=D[C]=Et(T,r.new_edits)).error&&!S&&(S=T)}if(S)return o(S);var O=!1,R=0,B=new Array(D.length),P=new ui,I=!1,L=n._meta.blobSupport?"blob":"base64";Gt(D,L,function(e){if(e)return o(e);a()})}function ar(e,t,r,n,i){function o(e){c=e.target.result,u&&i(u,c,l)}function a(e){u=e.target.result,c&&i(u,c,l)}function s(e){var t=e.target.result;if(!t)return i();i([t.key],[t.value],t)}var u,c,l;"function"==typeof e.getAll&&"function"==typeof e.getAllKeys&&n>1&&!r?(l={continue:function(){if(!u.length)return i();var r,s=u[u.length-1];if(t&&t.upper)try{r=IDBKeyRange.bound(s,t.upper,!0,t.upperOpen)}catch(e){if("DataError"===e.name&&0===e.code)return i()}else r=IDBKeyRange.lowerBound(s,!0);t=r,u=null,c=null,e.getAll(t,n).onsuccess=o,e.getAllKeys(t,n).onsuccess=a}},e.getAll(t,n).onsuccess=o,e.getAllKeys(t,n).onsuccess=a):r?e.openCursor(t,"prev").onsuccess=s:e.openCursor(t).onsuccess=s}function sr(e,t,r){if("function"!=typeof e.getAll){var n=[];e.openCursor(t).onsuccess=function(e){var t=e.target.result;t?(n.push(t.value),t.continue()):r({target:{result:n}})}}else e.getAll(t).onsuccess=r}function ur(e,t,r,n,i){try{if(e&&t)return i?IDBKeyRange.bound(t,e,!r,!1):IDBKeyRange.bound(e,t,!1,!r);if(e)return i?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return i?IDBKeyRange.lowerBound(t,!r):IDBKeyRange.upperBound(t,!r);if(n)return IDBKeyRange.only(n)}catch(e){return{error:e}}return null}function cr(e,t,r){function n(t,r,n){var i=t.id+"::"+n;x.get(i).onsuccess=function(n){if(r.doc=Zt(n.target.result),e.conflicts){var i=X(t);i.length&&(r.doc._conflicts=i)}tr(r.doc,e,v)}}function i(t,r){var i={id:r.id,key:r.id,value:{rev:t}},o=r.deleted;"ok"===e.deleted?(w.push(i),o?(i.value.deleted=!0,i.doc=null):e.include_docs&&n(r,i,t)):!o&&l--<=0&&(w.push(i),e.include_docs&&n(r,i,t))}function o(e){for(var t=0,r=e.length;t<r&&w.length!==f;t++){var n=Yt(e[t]);i(n.winningRev,n)}}function a(){r(null,{total_rows:y,offset:e.skip,rows:w})}var s="startkey"in e&&e.startkey,u="endkey"in e&&e.endkey,c="key"in e&&e.key,l=e.skip||0,f="number"==typeof e.limit?e.limit:-1,p=ur(s,u,!1!==e.inclusive_end,c,e.descending),h=p&&p.error;if(h&&("DataError"!==h.name||0!==h.code))return r(j(Si,h.name,h.message));var d=[Hi,Xi,Yi];e.attachments&&d.push(Ki);var m=ir(t,d,"readonly");if(m.error)return r(m.error);var v=m.txn;v.oncomplete=function(){e.attachments?rr(w,e.binary).then(a):a()},v.onabort=Kt(r);var y,g=v.objectStore(Hi),b=v.objectStore(Xi),_=v.objectStore(Yi),x=b.index("_doc_id_rev"),w=[];return _.get(Yi).onsuccess=function(e){y=e.target.result.docCount},h||0===f?void 0:-1===f?sr(g,p,function(t){var r=t.target.result;e.descending&&(r=r.reverse()),o(r)}):void ar(g,p,e.descending,f+l,function(e,t,r){r&&(o(t),w.length<f&&r.continue())})}function lr(e){return new ii(function(t){var r=St([""]);e.objectStore(eo).put(r,"key").onsuccess=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);t(r||!e||parseInt(e[1],10)>=43)},e.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)}}).catch(function(){return!1})}function fr(e,t){e.objectStore(Hi).index("deletedOrLocal").count(IDBKeyRange.only("0")).onsuccess=function(e){t(e.target.result)}}function pr(e,t,r,n){try{e(t,r)}catch(t){n.emit("error",t)}}function hr(){!ro&&no.length&&(ro=!0,no.shift()())}function dr(e,t,r){no.push(function(){e(function(e,n){pr(t,e,n,r),ro=!1,Zn(function(){hr(r)})})}),hr()}function mr(e,t,r,n){function i(e,t,r,n){if(r.seq!==t)return n();if(r.winningRev===e._rev)return n(r,e);var i=e._id+"::"+r.winningRev;v.get(i).onsuccess=function(e){n(r,Zt(e.target.result))}}function o(e,t,r){if(c&&!c.has(e._id))return r();var n=_.get(e._id);if(n)return i(e,t,n,r);m.get(e._id).onsuccess=function(o){n=Yt(o.target.result),_.set(e._id,n),i(e,t,n,r)}}function a(){e.complete(null,{results:y,last_seq:l})}if((e=u(e)).continuous){var s=r+":"+Ri();return to.addListener(r,s,t,e),to.notify(r),{cancel:function(){to.removeListener(r,s)}}}var c=e.doc_ids&&new si(e.doc_ids);e.since=e.since||0;var l=e.since,f="limit"in e?e.limit:-1;0===f&&(f=1);var p;p="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var h,d,m,v,y=[],g=0,b=R(e),_=new ui,x=[Hi,Xi];e.attachments&&x.push(Ki);var w=ir(n,x,"readonly");if(w.error)return e.complete(w.error);(h=w.txn).onabort=Kt(e.complete),h.oncomplete=function(){!e.continuous&&e.attachments?rr(y).then(a):a()},d=h.objectStore(Xi),m=h.objectStore(Hi),v=d.index("_doc_id_rev"),ar(d,e.since&&!e.descending?IDBKeyRange.lowerBound(e.since,!0):null,e.descending,f,function(t,r,n){function i(t,r){var n=e.processChange(r,t,e);l=n.seq=t.seq;var i=b(n);if("object"==typeof i)return e.complete(i);i&&(g++,p&&y.push(n),e.attachments&&e.include_docs?tr(r,e,h,function(){rr([n],e.binary).then(function(){e.onChange(n)})}):e.onChange(n))}function a(){for(var e=0,t=s.length;e<t&&g!==f;e++){var r=s[e];r&&i(u[e],r)}g!==f&&n.continue()}if(n&&t.length){var s=new Array(t.length),u=new Array(t.length),c=0;r.forEach(function(e,r){o(Zt(e),t[r],function(e,n){u[r]=e,s[r]=n,++c===t.length&&a()})})}})}function vr(e,t){var r=this;dr(function(t){yr(r,e,t)},t,r.constructor)}function yr(e,t,r){function n(e){var t=e.createObjectStore(Hi,{keyPath:"id"});e.createObjectStore(Xi,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.createObjectStore(Ki,{keyPath:"digest"}),e.createObjectStore(Yi,{keyPath:"id",autoIncrement:!1}),e.createObjectStore(eo),t.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),e.createObjectStore(Zi,{keyPath:"_id"});var r=e.createObjectStore(Qi,{autoIncrement:!0});r.createIndex("seq","seq"),r.createIndex("digestSeq","digestSeq",{unique:!0})}function i(e,t){var r=e.objectStore(Hi);r.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),r.openCursor().onsuccess=function(e){var n=e.target.result;if(n){var i=n.value,o=ce(i);i.deletedOrLocal=o?"1":"0",r.put(i),n.continue()}else t()}}function o(e){e.createObjectStore(Zi,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function a(e,t){var r=e.objectStore(Zi),n=e.objectStore(Hi),i=e.objectStore(Xi);n.openCursor().onsuccess=function(e){var o=e.target.result;if(o){var a=o.value,s=a.id,u=le(s),c=z(a);if(u){var l=s+"::"+c,f=s+"::",p=s+"::~",h=i.index("_doc_id_rev"),d=IDBKeyRange.bound(f,p,!1,!1),m=h.openCursor(d);m.onsuccess=function(e){if(m=e.target.result){var t=m.value;t._doc_id_rev===l&&r.put(t),i.delete(m.primaryKey),m.continue()}else n.delete(o.primaryKey),o.continue()}}else o.continue()}else t&&t()}}function s(e){var t=e.createObjectStore(Qi,{autoIncrement:!0});t.createIndex("seq","seq"),t.createIndex("digestSeq","digestSeq",{unique:!0})}function u(e,t){var r=e.objectStore(Xi),n=e.objectStore(Ki),i=e.objectStore(Qi);n.count().onsuccess=function(e){if(!e.target.result)return t();r.openCursor().onsuccess=function(e){var r=e.target.result;if(!r)return t();for(var n=r.value,o=r.primaryKey,a=Object.keys(n._attachments||{}),s={},u=0;u<a.length;u++)s[n._attachments[a[u]].digest]=!0;var c=Object.keys(s);for(u=0;u<c.length;u++){var l=c[u];i.put({seq:o,digestSeq:l+"::"+o})}r.continue()}}}function c(e){function t(e){return e.data?Yt(e):(e.deleted="1"===e.deletedOrLocal,e)}var r=e.objectStore(Xi),n=e.objectStore(Hi);n.openCursor().onsuccess=function(e){function i(){var e=Qt(a,a.winningRev,a.deleted);n.put(e).onsuccess=function(){o.continue()}}var o=e.target.result;if(o){var a=t(o.value);if(a.winningRev=a.winningRev||z(a),a.seq)return i();!function(){var e=a.id+"::",t=a.id+"::",n=0;r.index("_doc_id_rev").openCursor(IDBKeyRange.bound(e,t)).onsuccess=function(e){var t=e.target.result;if(!t)return a.seq=n,i();var r=t.primaryKey;r>n&&(n=r),t.continue()}}()}}}var f=t.name,p=null;e._meta=null,e._remote=!1,e.type=function(){return"idb"},e._id=l(function(t){t(null,e._meta.instanceId)}),e._bulkDocs=function(r,n,i){or(t,r,n,e,p,i)},e._get=function(e,t,r){function n(){r(a,{doc:i,metadata:o,ctx:s})}var i,o,a,s=t.ctx;if(!s){var u=ir(p,[Hi,Xi,Ki],"readonly");if(u.error)return r(u.error);s=u.txn}s.objectStore(Hi).get(e).onsuccess=function(e){if(!(o=Yt(e.target.result)))return a=j(di,"missing"),n();var r;if(t.rev)r=t.latest?fe(t.rev,o):t.rev;else if(r=o.winningRev,ce(o))return a=j(di,"deleted"),n();var u=s.objectStore(Xi),c=o.id+"::"+r;u.index("_doc_id_rev").get(c).onsuccess=function(e){if((i=e.target.result)&&(i=Zt(i)),!i)return a=j(di,"missing"),n();n()}}},e._getAttachment=function(e,t,r,n,i){var o;if(n.ctx)o=n.ctx;else{var a=ir(p,[Hi,Xi,Ki],"readonly");if(a.error)return i(a.error);o=a.txn}var s=r.digest,u=r.content_type;o.objectStore(Ki).get(s).onsuccess=function(e){er(e.target.result.body,u,n.binary,function(e){i(null,e)})}},e._info=function(t){var r,n,i=ir(p,[Yi,Xi],"readonly");if(i.error)return t(i.error);var o=i.txn;o.objectStore(Yi).get(Yi).onsuccess=function(e){n=e.target.result.docCount},o.objectStore(Xi).openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;r=t?t.key:0},o.oncomplete=function(){t(null,{doc_count:n,update_seq:r,idb_attachment_format:e._meta.blobSupport?"binary":"base64"})}},e._allDocs=function(e,t){cr(e,p,t)},e._changes=function(t){return mr(t,e,f,p)},e._close=function(e){p.close(),io.delete(f),e()},e._getRevisionTree=function(e,t){var r=ir(p,[Hi],"readonly");if(r.error)return t(r.error);r.txn.objectStore(Hi).get(e).onsuccess=function(e){var r=Yt(e.target.result);r?t(null,r.rev_tree):t(j(di))}},e._doCompaction=function(e,t,r){var n=ir(p,[Hi,Xi,Ki,Qi],"readwrite");if(n.error)return r(n.error);var i=n.txn;i.objectStore(Hi).get(e).onsuccess=function(r){var n=Yt(r.target.result);V(n.rev_tree,function(e,r,n,i,o){var a=r+"-"+n;-1!==t.indexOf(a)&&(o.status="missing")}),nr(t,e,i);var o=n.winningRev,a=n.deleted;i.objectStore(Hi).put(Qt(n,o,a))},i.onabort=Kt(r),i.oncomplete=function(){r()}},e._getLocal=function(e,t){var r=ir(p,[Zi],"readonly");if(r.error)return t(r.error);var n=r.txn.objectStore(Zi).get(e);n.onerror=Kt(t),n.onsuccess=function(e){var r=e.target.result;r?(delete r._doc_id_rev,t(null,r)):t(j(di))}},e._putLocal=function(e,t,r){"function"==typeof t&&(r=t,t={}),delete e._revisions;var n=e._rev,i=e._id;e._rev=n?"0-"+(parseInt(n.split("-")[1],10)+1):"0-1";var o,a=t.ctx;if(!a){var s=ir(p,[Zi],"readwrite");if(s.error)return r(s.error);(a=s.txn).onerror=Kt(r),a.oncomplete=function(){o&&r(null,o)}}var u,c=a.objectStore(Zi);n?(u=c.get(i)).onsuccess=function(i){var a=i.target.result;a&&a._rev===n?c.put(e).onsuccess=function(){o={ok:!0,id:e._id,rev:e._rev},t.ctx&&r(null,o)}:r(j(mi))}:((u=c.add(e)).onerror=function(e){r(j(mi)),e.preventDefault(),e.stopPropagation()},u.onsuccess=function(){o={ok:!0,id:e._id,rev:e._rev},t.ctx&&r(null,o)})},e._removeLocal=function(e,t,r){"function"==typeof t&&(r=t,t={});var n=t.ctx;if(!n){var i=ir(p,[Zi],"readwrite");if(i.error)return r(i.error);(n=i.txn).oncomplete=function(){o&&r(null,o)}}var o,a=e._id,s=n.objectStore(Zi),u=s.get(a);u.onerror=Kt(r),u.onsuccess=function(n){var i=n.target.result;i&&i._rev===e._rev?(s.delete(a),o={ok:!0,id:a,rev:"0-0"},t.ctx&&r(null,o)):r(j(di))}},e._destroy=function(e,t){to.removeAllListeners(f);var r=oo.get(f);r&&r.result&&(r.result.close(),io.delete(f));var n=indexedDB.deleteDatabase(f);n.onsuccess=function(){oo.delete(f),w()&&f in localStorage&&delete localStorage[f],t(null,{ok:!0})},n.onerror=Kt(t)};var h=io.get(f);if(h)return p=h.idb,e._meta=h.global,Zn(function(){r(null,e)});var d;d=t.storage?gr(f,t.storage):indexedDB.open(f,Ji),oo.set(f,d),d.onupgradeneeded=function(e){function t(){var e=f[p-1];p++,e&&e(l,t)}var r=e.target.result;if(e.oldVersion<1)return n(r);var l=e.currentTarget.transaction;e.oldVersion<3&&o(r),e.oldVersion<4&&s(r);var f=[i,a,u,c],p=e.oldVersion;t()},d.onsuccess=function(t){function n(){void 0!==s&&l&&(e._meta={name:f,instanceId:u,blobSupport:s},io.set(f,{idb:p,global:e._meta}),r(null,e))}function i(){if(void 0!==a&&void 0!==o){var e=f+"_id";e in o?u=o[e]:o[e]=u=Ri(),o.docCount=a,c.objectStore(Yi).put(o)}}(p=t.target.result).onversionchange=function(){p.close(),io.delete(f)},p.onabort=function(e){S("error","Database has a global failure",e.target.error),p.close(),io.delete(f)};var o,a,s,u,c=p.transaction([Yi,eo,Hi],"readwrite"),l=!1;c.objectStore(Yi).get(Yi).onsuccess=function(e){o=e.target.result||{id:Yi},i()},fr(c,function(e){a=e,i()}),qi||(qi=lr(c)),qi.then(function(e){s=e,n()}),c.oncomplete=function(){l=!0,n()}},d.onerror=function(){var e="Failed to open indexedDB, are you in private browsing mode?";S("error",e),r(j(Si,e))}}function gr(e,t){try{return indexedDB.open(e,{version:Ji,storage:t})}catch(t){return indexedDB.open(e,Ji)}}function br(e){return decodeURIComponent(escape(e))}function _r(e){return e<65?e-48:e-55}function xr(e,t,r){for(var n="";t<r;)n+=String.fromCharCode(_r(e.charCodeAt(t++))<<4|_r(e.charCodeAt(t++)));return n}function wr(e,t,r){for(var n="";t<r;)n+=String.fromCharCode(_r(e.charCodeAt(t+2))<<12|_r(e.charCodeAt(t+3))<<8|_r(e.charCodeAt(t))<<4|_r(e.charCodeAt(t+1))),t+=4;return n}function kr(e,t){return"UTF-8"===t?br(xr(e,0,e.length)):wr(e,0,e.length)}function Er(e){return"'"+e+"'"}function Sr(e){return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function Ar(e){return e.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function Dr(e){return delete e._id,delete e._rev,JSON.stringify(e)}function Cr(e,t,r){return e=JSON.parse(e),e._id=t,e._rev=r,e}function Fr(e){for(var t="(";e--;)t+="?",e&&(t+=",");return t+")"}function jr(e,t,r,n,i){return"SELECT "+e+" FROM "+("string"==typeof t?t:t.join(" JOIN "))+(r?" ON "+r:"")+(n?" WHERE "+("string"==typeof n?n:n.join(" AND ")):"")+(i?" ORDER BY "+i:"")}function Tr(e,t,r){function n(){++o===e.length&&i()}function i(){if(a.length){var e="SELECT DISTINCT digest AS digest FROM "+po+" WHERE seq IN "+Fr(a.length);r.executeSql(e,a,function(e,t){for(var r=[],n=0;n<t.rows.length;n++)r.push(t.rows.item(n).digest);if(r.length){var i="DELETE FROM "+po+" WHERE seq IN ("+a.map(function(){return"?"}).join(",")+")";e.executeSql(i,a,function(e){var t="SELECT digest FROM "+po+" WHERE digest IN ("+r.map(function(){return"?"}).join(",")+")";e.executeSql(t,r,function(e,t){for(var n=new si,i=0;i<t.rows.length;i++)n.add(t.rows.item(i).digest);r.forEach(function(t){n.has(t)||(e.executeSql("DELETE FROM "+po+" WHERE digest=?",[t]),e.executeSql("DELETE FROM "+co+" WHERE digest=?",[t]))})})})}})}}if(e.length){var o=0,a=[];e.forEach(function(e){var i="SELECT seq FROM "+uo+" WHERE doc_id=? AND rev=?";r.executeSql(i,[t,e],function(e,t){if(!t.rows.length)return n();var r=t.rows.item(0).seq;a.push(r),e.executeSql("DELETE FROM "+uo+" WHERE seq=?",[r],n)})})}}function Or(e){return function(t){S("error","WebSQL threw an error",t);var r=t&&t.constructor.toString().match(/function ([^(]+)/),n=r&&r[1]||t.type,i=t.target||t.message;e(j(Ai,i,n))}}function Rr(e){return"size"in e?1e6*e.size:"undefined"!=typeof navigator&&/Android/.test(navigator.userAgent)?5e6:1}function Br(e,t,r,n,i,o,a){function s(){if(g)return a(g);o.notify(n._name),a(null,b)}function u(e,t){var r="SELECT count(*) as cnt FROM "+co+" WHERE digest=?";y.executeSql(r,[e],function(r,n){if(0===n.rows.item(0).cnt){var i=j(Ci,"unknown stub attachment with digest "+e);t(i)}else t()})}function c(e){function t(){++i===r.length&&e(n)}var r=[];if(m.forEach(function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach(function(t){var n=e.data._attachments[t];n.stub&&r.push(n.digest)})}),!r.length)return e();var n,i=0;r.forEach(function(e){u(e,function(e){e&&!n&&(n=e),t()})})}function l(e,t,r,i,o,a,s,u){function c(){function t(e,t){function n(){return++i===o.length&&t(),!1}var i=0,o=Object.keys(r._attachments||{});if(!o.length)return t();for(var a=0;a<o.length;a++)!function(t){var i="INSERT INTO "+po+" (digest, seq) VALUES (?,?)",o=[r._attachments[t].digest,e];y.executeSql(i,o,n,n)}(o[a])}var r=e.data,n=i?1:0,o=r._id,a=r._rev,s=Dr(r),u="INSERT INTO "+uo+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",c=[o,a,s,n];y.executeSql(u,c,function(e,r){var n=r.insertId;t(n,function(){p(e,n)})},function(){var e=jr("seq",uo,null,"doc_id=? AND rev=?");return y.executeSql(e,[o,a],function(e,r){var i=r.rows.item(0).seq,u="UPDATE "+uo+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",c=[s,n,o,a];e.executeSql(u,c,function(e){t(i,function(){p(e,i)})})}),!1})}function l(e){d||(e?u(d=e):m===v.length&&c())}function f(e){m++,l(e)}function p(r,i){var a=e.metadata.id,c=e.stemmedRevs||[];o&&n.auto_compaction&&(c=K(e.metadata).concat(c)),c.length&&Tr(c,a,r),e.metadata.seq=i;var l=e.metadata.rev;delete e.metadata.rev;var f=o?"UPDATE "+so+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+uo+" WHERE doc_id="+so+".id AND rev=?) WHERE id=?":"INSERT INTO "+so+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",p=Xt(e.metadata),h=o?[p,i,t,a]:[a,i,i,p];r.executeSql(f,h,function(){b[s]={ok:!0,id:e.metadata.id,rev:l},_.set(a,e.metadata),u()})}var d=null,m=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev;var v=Object.keys(e.data._attachments||{});i&&(e.data._deleted=!0),v.forEach(function(r){var n=e.data._attachments[r];if(n.stub)m++,l();else{var i=n.data;delete n.data,n.revpos=parseInt(t,10),h(n.digest,i,f)}}),v.length||c()}function f(){Jt(e.revs_limit,m,n,_,y,b,l,r)}function p(e){function t(){++r===m.length&&e()}if(!m.length)return e();var r=0;m.forEach(function(e){if(e._id&&le(e._id))return t();var r=e.metadata.id;y.executeSql("SELECT json FROM "+so+" WHERE id = ?",[r],function(e,n){if(n.rows.length){var i=Ht(n.rows.item(0).json);_.set(r,i)}t()})})}function h(e,t,r){var n="SELECT digest FROM "+co+" WHERE digest=?";y.executeSql(n,[e],function(i,o){if(o.rows.length)return r();n="INSERT INTO "+co+" (digest, body, escaped) VALUES (?,?,1)",i.executeSql(n,[e,Sr(t)],function(){r()},function(){return r(),!1})})}var d=r.new_edits,m=t.docs.map(function(e){return e._id&&le(e._id)?e:Et(e,d)}),v=m.filter(function(e){return e.error});if(v.length)return a(v[0]);var y,g,b=new Array(m.length),_=new ui;Gt(m,"binary",function(e){if(e)return a(e);i.transaction(function(e){y=e,c(function(e){e?g=e:p(f)})},Or(a),s)})}function Pr(e){return e.websql(e.name,e.version,e.description,e.size)}function Ir(e){try{return{db:Pr(e)}}catch(e){return{error:e}}}function Lr(e){var t=ho.get(e.name);return t||(t=Ir(e),ho.set(e.name,t)),t}function Nr(e,t,r,n,i){function o(){++u===s.length&&i&&i()}function a(e,i){var a=e._attachments[i],s={binary:t.binary,ctx:n};r._getAttachment(e._id,i,a,s,function(t,r){e._attachments[i]=pi(y(a,["digest","content_type"]),{data:r}),o()})}var s=Object.keys(e._attachments||{});if(!s.length)return i&&i();var u=0;s.forEach(function(r){t.attachments&&t.include_docs?a(e,r):(e._attachments[r].stub=!0,o())})}function Mr(e,t){function r(){w()&&(window.localStorage["_pouch__websqldb_"+b._name]=!0),t(null,b)}function n(e,t){e.executeSql(bo),e.executeSql("ALTER TABLE "+uo+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){e.executeSql(yo),e.executeSql("ALTER TABLE "+so+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){e.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+so+" (local, id)");var r="SELECT "+so+".winningseq AS seq, "+so+".json AS metadata FROM "+uo+" JOIN "+so+" ON "+uo+".seq = "+so+".winningseq";e.executeSql(r,[],function(e,r){for(var n=[],i=[],o=0;o<r.rows.length;o++){var a=r.rows.item(o),s=a.seq,u=JSON.parse(a.metadata);ce(u)&&n.push(s),le(u.id)&&i.push(u.id)}e.executeSql("UPDATE "+so+"SET local = 1 WHERE id IN "+Fr(i.length),i,function(){e.executeSql("UPDATE "+uo+" SET deleted = 1 WHERE seq IN "+Fr(n.length),n,t)})})})})}function i(e,t){var r="CREATE TABLE IF NOT EXISTS "+lo+" (id UNIQUE, rev, json)";e.executeSql(r,[],function(){var r="SELECT "+so+".id AS id, "+uo+".json AS data FROM "+uo+" JOIN "+so+" ON "+uo+".seq = "+so+".winningseq WHERE local = 1";e.executeSql(r,[],function(e,r){function n(){if(!i.length)return t(e);var r=i.shift(),o=JSON.parse(r.data)._rev;e.executeSql("INSERT INTO "+lo+" (id, rev, json) VALUES (?,?,?)",[r.id,o,r.data],function(e){e.executeSql("DELETE FROM "+so+" WHERE id=?",[r.id],function(e){e.executeSql("DELETE FROM "+uo+" WHERE seq=?",[r.seq],function(){n()})})})}for(var i=[],o=0;o<r.rows.length;o++)i.push(r.rows.item(o));n()})})}function o(e,t){function r(r){function n(){if(!r.length)return t(e);var i=kr(r.shift().hex,g),o=i.lastIndexOf("::"),a=i.substring(0,o),s=i.substring(o+2),u="UPDATE "+uo+" SET doc_id=?, rev=? WHERE doc_id_rev=?";e.executeSql(u,[a,s,i],function(){n()})}n()}var n="ALTER TABLE "+uo+" ADD COLUMN doc_id";e.executeSql(n,[],function(e){var t="ALTER TABLE "+uo+" ADD COLUMN rev";e.executeSql(t,[],function(e){e.executeSql(go,[],function(e){var t="SELECT hex(doc_id_rev) as hex FROM "+uo;e.executeSql(t,[],function(e,t){for(var n=[],i=0;i<t.rows.length;i++)n.push(t.rows.item(i));r(n)})})})})}function a(e,t){function r(e){var r="SELECT COUNT(*) AS cnt FROM "+co;e.executeSql(r,[],function(e,r){function n(){var r=jr(ko+", "+so+".id AS id",[so,uo],wo,null,so+".id ");r+=" LIMIT "+o+" OFFSET "+i,i+=o,e.executeSql(r,[],function(e,r){if(!r.rows.length)return t(e);for(var i={},o=0;o<r.rows.length;o++)for(var a=r.rows.item(o),s=Cr(a.data,a.id,a.rev),u=Object.keys(s._attachments||{}),c=0;c<u.length;c++)!function(e,t){var r=i[e]=i[e]||[];-1===r.indexOf(t)&&r.push(t)}(s._attachments[u[c]].digest,a.seq);var l=[];if(Object.keys(i).forEach(function(e){i[e].forEach(function(t){l.push([e,t])})}),!l.length)return n();var f=0;l.forEach(function(t){var r="INSERT INTO "+po+" (digest, seq) VALUES (?,?)";e.executeSql(r,t,function(){++f===l.length&&n()})})})}if(!r.rows.item(0).cnt)return t(e);var i=0,o=10;n()})}var n="CREATE TABLE IF NOT EXISTS "+po+" (digest, seq INTEGER)";e.executeSql(n,[],function(e){e.executeSql(xo,[],function(e){e.executeSql(_o,[],r)})})}function s(e,t){var r="ALTER TABLE "+co+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";e.executeSql(r,[],t)}function c(e,t){var r="ALTER TABLE "+so+" ADD COLUMN max_seq INTEGER";e.executeSql(r,[],function(e){var r="UPDATE "+so+" SET max_seq=(SELECT MAX(seq) FROM "+uo+" WHERE doc_id=id)";e.executeSql(r,[],function(e){var r="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+so+" (max_seq)";e.executeSql(r,[],t)})})}function f(e,t){e.executeSql('SELECT HEX("a") AS hex',[],function(e,r){var n=r.rows.item(0).hex;g=2===n.length?"UTF-8":"UTF-16",t()})}function p(){for(;k.length>0;)k.pop()(null,_)}function h(e,t){if(0===t){var r="CREATE TABLE IF NOT EXISTS "+fo+" (dbid, db_version INTEGER)",u="CREATE TABLE IF NOT EXISTS "+co+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",l="CREATE TABLE IF NOT EXISTS "+po+" (digest, seq INTEGER)",f="CREATE TABLE IF NOT EXISTS "+so+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",h="CREATE TABLE IF NOT EXISTS "+uo+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",d="CREATE TABLE IF NOT EXISTS "+lo+" (id UNIQUE, rev, json)";e.executeSql(u),e.executeSql(d),e.executeSql(l,[],function(){e.executeSql(_o),e.executeSql(xo)}),e.executeSql(f,[],function(){e.executeSql(bo),e.executeSql(h,[],function(){e.executeSql(yo),e.executeSql(go),e.executeSql(r,[],function(){var t="INSERT INTO "+fo+" (db_version, dbid) VALUES (?,?)";_=Ri();var r=[ao,_];e.executeSql(t,r,function(){p()})})})})}else{var m=[n,i,o,a,s,c,function(){t<ao&&e.executeSql("UPDATE "+fo+" SET db_version = "+ao);var r="SELECT dbid FROM "+fo;e.executeSql(r,[],function(e,t){_=t.rows.item(0).dbid,p()})}],v=t,y=function(e){m[v-1](e,y),v++};y(e)}}function d(e){var t="SELECT sql FROM sqlite_master WHERE tbl_name = "+fo;e.executeSql(t,[],function(e,t){t.rows.length?/db_version/.test(t.rows.item(0).sql)?e.executeSql("SELECT db_version FROM "+fo,[],function(e,t){h(e,t.rows.item(0).db_version)}):e.executeSql("ALTER TABLE "+fo+" ADD COLUMN db_version INTEGER",[],function(){h(e,1)}):h(e,0)})}function m(e,t){var r="SELECT MAX(seq) AS seq FROM "+uo;e.executeSql(r,[],function(e,r){var n=r.rows.item(0).seq||0;t(n)})}function v(e,t){var r=jr("COUNT("+so+".id) AS 'num'",[so,uo],wo,uo+".deleted=0");e.executeSql(r,[],function(e,r){t(r.rows.item(0).num)})}function y(e,t,r,n,i){var o=jr(ko,[so,uo],wo,so+".id=?"),a=[t];e.executeSql(o,a,function(e,t){if(!t.rows.length){var o=j(di,"missing");return i(o)}var a=Ht(t.rows.item(0).metadata);n(fe(r,a))})}var g,b=this,_=null,x=Rr(e),k=[];b._name=e.name;var E=Lr(pi({},e,{version:vo,description:e.name,size:x}));if(E.error)return Or(t)(E.error);var S=E.db;"function"!=typeof S.readTransaction&&(S.readTransaction=S.transaction),S.transaction(function(e){f(e,function(){d(e)})},Or(t),r),b._remote=!1,b.type=function(){return"websql"},b._id=l(function(e){e(null,_)}),b._info=function(e){var t,r;S.readTransaction(function(e){m(e,function(e){t=e}),v(e,function(e){r=e})},Or(e),function(){e(null,{doc_count:r,update_seq:t,websql_encoding:g})})},b._bulkDocs=function(t,r,n){Br(e,t,r,b,S,mo,n)},b._get=function(e,t,r){function n(e){r(e,{doc:i,metadata:o,ctx:a})}var i,o,a=t.ctx;if(!a)return S.readTransaction(function(n){b._get(e,pi({ctx:n},t),r)});var s,u;if(t.rev){if(t.latest)return void y(a,e,t.rev,function(n){t.latest=!1,t.rev=n,b._get(e,t,r)},n);s=jr(ko,[so,uo],so+".id="+uo+".doc_id",[uo+".doc_id=?",uo+".rev=?"]),u=[e,t.rev]}else s=jr(ko,[so,uo],wo,so+".id=?"),u=[e];a.executeSql(s,u,function(e,r){if(!r.rows.length)return n(j(di,"missing"));var a=r.rows.item(0);if(o=Ht(a.metadata),a.deleted&&!t.rev)return n(j(di,"deleted"));i=Cr(a.data,o.id,a.rev),n()})},b._allDocs=function(e,t){var r,n=[],i="startkey"in e&&e.startkey,o="endkey"in e&&e.endkey,a="key"in e&&e.key,s="descending"in e&&e.descending,u="limit"in e?e.limit:-1,c="skip"in e?e.skip:0,l=!1!==e.inclusive_end,f=[],p=[];if(!1!==a)p.push(so+".id = ?"),f.push(a);else if(!1!==i||!1!==o){if(!1!==i&&(p.push(so+".id "+(s?"<=":">=")+" ?"),f.push(i)),!1!==o){var h=s?">":"<";l&&(h+="="),p.push(so+".id "+h+" ?"),f.push(o)}!1!==a&&(p.push(so+".id = ?"),f.push(a))}"ok"!==e.deleted&&p.push(uo+".deleted = 0"),S.readTransaction(function(t){if(v(t,function(e){r=e}),0!==u){var i=jr(ko,[so,uo],wo,p,so+".id "+(s?"DESC":"ASC"));i+=" LIMIT "+u+" OFFSET "+c,t.executeSql(i,f,function(t,r){for(var i=0,o=r.rows.length;i<o;i++){var a=r.rows.item(i),s=Ht(a.metadata),u=s.id,c=Cr(a.data,u,a.rev),l=c._rev,f={id:u,key:u,value:{rev:l}};if(e.include_docs){if(f.doc=c,f.doc._rev=l,e.conflicts){var p=X(s);p.length&&(f.doc._conflicts=p)}Nr(f.doc,e,b,t)}if(a.deleted){if("ok"!==e.deleted)continue;f.value.deleted=!0,f.doc=null}n.push(f)}})}},Or(t),function(){t(null,{total_rows:r,offset:e.skip,rows:n})})},b._changes=function(e){if((e=u(e)).continuous){var t=b._name+":"+Ri();return mo.addListener(b._name,t,b,e),mo.notify(b._name),{cancel:function(){mo.removeListener(b._name,t)}}}var r=e.descending;e.since=e.since&&!r?e.since:0;var n="limit"in e?e.limit:-1;0===n&&(n=1);var i;i="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var o=[],a=0;!function(){var t=so+".json AS metadata, "+so+".max_seq AS maxSeq, "+uo+".json AS winningDoc, "+uo+".rev AS winningRev ",s=so+" JOIN "+uo,u=so+".id="+uo+".doc_id AND "+so+".winningseq="+uo+".seq",c=["maxSeq > ?"],l=[e.since];e.doc_ids&&(c.push(so+".id IN "+Fr(e.doc_ids.length)),l=l.concat(e.doc_ids));var f=jr(t,s,u,c,"maxSeq "+(r?"DESC":"ASC")),p=R(e);e.view||e.filter||(f+=" LIMIT "+n);var h=e.since||0;S.readTransaction(function(t){t.executeSql(f,l,function(t,r){function s(t){return function(){e.onChange(t)}}for(var u=0,c=r.rows.length;u<c;u++){var l=r.rows.item(u),f=Ht(l.metadata);h=l.maxSeq;var d=Cr(l.winningDoc,f.id,l.winningRev),m=e.processChange(d,f,e);m.seq=l.maxSeq;var v=p(m);if("object"==typeof v)return e.complete(v);if(v&&(a++,i&&o.push(m),e.attachments&&e.include_docs?Nr(d,e,b,t,s(m)):s(m)()),a===n)break}})},Or(e.complete),function(){e.continuous||e.complete(null,{results:o,last_seq:h})})}()},b._close=function(e){e()},b._getAttachment=function(e,t,r,n,i){var o,a=n.ctx,s=r.digest,u=r.content_type,c="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+co+" WHERE digest=?";a.executeSql(c,[s],function(e,t){var r=t.rows.item(0),a=r.escaped?Ar(r.body):kr(r.body,g);o=n.binary?Dt(a,u):Gi(a),i(null,o)})},b._getRevisionTree=function(e,t){S.readTransaction(function(r){var n="SELECT json AS metadata FROM "+so+" WHERE id = ?";r.executeSql(n,[e],function(e,r){if(r.rows.length){var n=Ht(r.rows.item(0).metadata);t(null,n.rev_tree)}else t(j(di))})})},b._doCompaction=function(e,t,r){if(!t.length)return r();S.transaction(function(r){var n="SELECT json AS metadata FROM "+so+" WHERE id = ?";r.executeSql(n,[e],function(r,n){var i=Ht(n.rows.item(0).metadata);V(i.rev_tree,function(e,r,n,i,o){var a=r+"-"+n;-1!==t.indexOf(a)&&(o.status="missing")});var o="UPDATE "+so+" SET json = ? WHERE id = ?";r.executeSql(o,[Xt(i),e])}),Tr(t,e,r)},Or(r),function(){r()})},b._getLocal=function(e,t){S.readTransaction(function(r){var n="SELECT json, rev FROM "+lo+" WHERE id=?";r.executeSql(n,[e],function(r,n){if(n.rows.length){var i=n.rows.item(0),o=Cr(i.json,e,i.rev);t(null,o)}else t(j(di))})})},b._putLocal=function(e,t,r){function n(e){var n,c;o?(n="UPDATE "+lo+" SET rev=?, json=? WHERE id=? AND rev=?",c=[i,u,a,o]):(n="INSERT INTO "+lo+" (id, rev, json) VALUES (?,?,?)",c=[a,i,u]),e.executeSql(n,c,function(e,n){n.rowsAffected?(s={ok:!0,id:a,rev:i},t.ctx&&r(null,s)):r(j(mi))},function(){return r(j(mi)),!1})}"function"==typeof t&&(r=t,t={}),delete e._revisions;var i,o=e._rev,a=e._id;i=e._rev=o?"0-"+(parseInt(o.split("-")[1],10)+1):"0-1";var s,u=Dr(e);t.ctx?n(t.ctx):S.transaction(n,Or(r),function(){s&&r(null,s)})},b._removeLocal=function(e,t,r){function n(n){var o="DELETE FROM "+lo+" WHERE id=? AND rev=?",a=[e._id,e._rev];n.executeSql(o,a,function(n,o){if(!o.rowsAffected)return r(j(di));i={ok:!0,id:e._id,rev:"0-0"},t.ctx&&r(null,i)})}"function"==typeof t&&(r=t,t={});var i;t.ctx?n(t.ctx):S.transaction(n,Or(r),function(){i&&r(null,i)})},b._destroy=function(e,t){mo.removeAllListeners(b._name),S.transaction(function(e){[so,uo,co,fo,lo,po].forEach(function(t){e.executeSql("DROP TABLE IF EXISTS "+t,[])})},Or(t),function(){w()&&(delete window.localStorage["_pouch__websqldb_"+b._name],delete window.localStorage[b._name]),t(null,{ok:!0})})}}function qr(){try{return openDatabase("_pouch_validate_websql",1,"",1),!0}catch(e){return!1}}function $r(){if("undefined"==typeof indexedDB||null===indexedDB||!/iP(hone|od|ad)/.test(navigator.userAgent))return!0;var e=w(),t="_pouch__websqldb_valid_"+navigator.userAgent;if(e&&localStorage[t])return"1"===localStorage[t];var r=qr();return e&&(localStorage[t]=r?"1":"0"),r}function Wr(e,t,r,n){return openDatabase(e,t,r,n)}function Ur(e,t){var r=pi({websql:Wr},e);Mr.call(this,r,t)}function Gr(){for(var e={},t=new ii(function(t,r){e.resolve=t,e.reject=r}),r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.promise=t,ii.resolve().then(function(){return fetch.apply(null,r)}).then(function(t){e.resolve(t)}).catch(function(t){e.reject(t)}),e}function zr(e,t){var r,n,i,o=new Headers,a={method:e.method,credentials:"include",headers:o};return e.json&&(o.set("Accept","application/json"),o.set("Content-Type",e.headers["Content-Type"]||"application/json")),e.body&&e.processData&&"string"!=typeof e.body?a.body=JSON.stringify(e.body):a.body="body"in e?e.body:null,Object.keys(e.headers).forEach(function(t){e.headers.hasOwnProperty(t)&&o.set(t,e.headers[t])}),r=Gr(e.url,a),e.timeout>0&&(n=setTimeout(function(){r.reject(new Error("Load timeout for resource: "+e.url))},e.timeout)),r.promise.then(function(t){return i={statusCode:t.status},e.timeout>0&&clearTimeout(n),i.statusCode>=200&&i.statusCode<300?e.binary?t.blob():t.text():t.json()}).then(function(e){i.statusCode>=200&&i.statusCode<300?t(null,i,e):(e.status=i.statusCode,t(e))}).catch(function(e){e||(e=new Error("canceled")),t(e)}),{abort:r.reject}}function Vr(e,t){var r,n,i=!1,o=function(){i=!0,r.abort(),s()},a={abort:function(){r.abort(),s()}},s=function(){clearTimeout(n),a.abort=function(){},r&&(r.onprogress=void 0,r.upload&&(r.upload.onprogress=void 0),r.onreadystatechange=void 0,r=void 0)};r=e.xhr?new e.xhr:new XMLHttpRequest;try{r.open(e.method,e.url)}catch(e){return t(new Error(e.name||"Url is invalid"))}r.withCredentials=!("withCredentials"in e)||e.withCredentials,"GET"===e.method?delete e.headers["Content-Type"]:e.json&&(e.headers.Accept="application/json",e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.body&&e.processData&&"string"!=typeof e.body&&(e.body=JSON.stringify(e.body))),e.binary&&(r.responseType="arraybuffer"),"body"in e||(e.body=null);for(var u in e.headers)e.headers.hasOwnProperty(u)&&r.setRequestHeader(u,e.headers[u]);return e.timeout>0&&(n=setTimeout(o,e.timeout),r.onprogress=function(){clearTimeout(n),4!==r.readyState&&(n=setTimeout(o,e.timeout))},void 0!==r.upload&&(r.upload.onprogress=r.onprogress)),r.onreadystatechange=function(){if(4===r.readyState){var n={statusCode:r.status};if(r.status>=200&&r.status<300){var o;o=e.binary?St([r.response||""],{type:r.getResponseHeader("Content-Type")}):r.responseText,t(null,n,o)}else{var a={};if(i)(a=new Error("ETIMEDOUT")).code="ETIMEDOUT";else if("string"==typeof r.response)try{a=JSON.parse(r.response)}catch(e){}a.status=r.status,t(a)}s()}},e.body&&e.body instanceof Blob?Rt(e.body,function(e){r.send(e)}):r.send(e.body),a}function Jr(e,t){return Eo||e.xhr?Vr(e,t):zr(e,t)}function Hr(){return""}function Xr(e,t){function r(t,r,n){if(!e.binary&&e.json&&"string"==typeof t)try{t=JSON.parse(t)}catch(e){return n(e)}Array.isArray(t)&&(t=t.map(function(e){return e.error||e.missing?T(e):e})),e.binary&&So(t,r),n(null,t,r)}return e=u(e),(e=pi({method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1},e)).json&&(e.binary||(e.headers.Accept="application/json"),e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json"),e.binary&&(e.encoding=null,e.json=!1),e.processData||(e.json=!1),Jr(e,function(n,i,o){if(n)return t(T(n));var a,s=i.headers&&i.headers["content-type"],u=o||Hr();if(!e.binary&&(e.json||!e.processData)&&"object"!=typeof u&&(/json/.test(s)||/^[\s]*\{/.test(u)&&/\}[\s]*$/.test(u)))try{u=JSON.parse(u.toString())}catch(e){}i.statusCode>=200&&i.statusCode<300?r(u,i,t):((a=T(u)).status=i.statusCode,t(a))})}function Kr(e,t){var r=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n=-1!==r.indexOf("safari")&&-1===r.indexOf("chrome"),i=-1!==r.indexOf("msie"),o=-1!==r.indexOf("edge"),a=n||(i||o)&&"GET"===e.method,s=!("cache"in e)||e.cache;if(!/^blob:/.test(e.url)&&(a||!s)){var u=-1!==e.url.indexOf("?");e.url+=(u?"&":"?")+"_nonce="+Date.now()}return Xr(e,t)}function Qr(e,t){return new ii(function(r,n){function i(){l++,e[f++]().then(a,s)}function o(){++p===h?c?n(c):r():u()}function a(){l--,o()}function s(e){l--,c=c||e,o()}function u(){for(;l<t&&f<h;)i()}var c,l=0,f=0,p=0,h=e.length;u()})}function Yr(e){var t=e.doc&&e.doc._attachments;t&&Object.keys(t).forEach(function(e){var r=t[e];r.data=Ct(r.data,r.content_type)})}function Zr(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):/^_local/.test(e)?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function en(e){return e._attachments&&Object.keys(e._attachments)?ii.all(Object.keys(e._attachments).map(function(t){var r=e._attachments[t];if(r.data&&"string"!=typeof r.data)return new ii(function(e){Ot(r.data,e)}).then(function(e){r.data=e})})):ii.resolve()}function tn(e){if(!e.prefix)return!1;var t=q(e.prefix).protocol;return"http"===t||"https"===t}function rn(e,t){if(tn(t)){var r=t.name.substr(t.prefix.length);e=t.prefix+encodeURIComponent(r)}var n=q(e);(n.user||n.password)&&(n.auth={username:n.user,password:n.password});var i=n.path.replace(/(^\/|\/$)/g,"").split("/");return n.db=i.pop(),-1===n.db.indexOf("%")&&(n.db=encodeURIComponent(n.db)),n.path=i.join("/"),n}function nn(e,t){return on(e,e.db+"/"+t)}function on(e,t){var r=e.path?"/":"";return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+r+t}function an(e){return"?"+Object.keys(e).map(function(t){return t+"="+encodeURIComponent(e[t])}).join("&")}function sn(e,t){function r(e,t,r){var n=e.ajax||{},i=pi(u(f),n,t),o=u(f.headers||{});return i.headers=pi(o,n.headers,t.headers||{}),s.constructor.listeners("debug").length&&s.constructor.emit("debug",["http",i.method,i.url]),s._ajax(i,r)}function n(e,t){return new ii(function(n,i){r(e,t,function(e,t){if(e)return i(e);n(t)})})}function i(e,t){return p(e,Kn(function(e){o().then(function(){return t.apply(this,e)}).catch(function(t){e.pop()(t)})}))}function o(){return e.skipSetup||e.skip_setup?ii.resolve():v||((v=n({},{method:"GET",url:l}).catch(function(e){return e&&e.status&&404===e.status?(C(404,"PouchDB is just detecting if the remote exists."),n({},{method:"PUT",url:l})):ii.reject(e)}).catch(function(e){return!(!e||!e.status||412!==e.status)||ii.reject(e)})).catch(function(){v=null}),v)}function a(e){return e.split("/").map(encodeURIComponent).join("/")}var s=this,c=rn(e.name,e),l=nn(c,""),f=(e=u(e)).ajax||{};if(e.auth||c.auth){var h=e.auth||c.auth,d=h.username+":"+h.password,m=Gi(unescape(encodeURIComponent(d)));f.headers=f.headers||{},f.headers.Authorization="Basic "+m}s._ajax=Kr;var v;Zn(function(){t(null,s)}),s._remote=!0,s.type=function(){return"http"},s.id=i("id",function(e){r({},{method:"GET",url:on(c,"")},function(t,r){var n=r&&r.uuid?r.uuid+c.db:nn(c,"");e(null,n)})}),s.request=i("request",function(e,t){e.url=nn(c,e.url),r({},e,t)}),s.compact=i("compact",function(e,t){"function"==typeof e&&(t=e,e={}),r(e=u(e),{url:nn(c,"_compact"),method:"POST"},function(){function r(){s.info(function(n,i){i&&!i.compact_running?t(null,{ok:!0}):setTimeout(r,e.interval||200)})}r()})}),s.bulkGet=p("bulkGet",function(e,t){function n(t){var n={};e.revs&&(n.revs=!0),e.attachments&&(n.attachments=!0),e.latest&&(n.latest=!0),r(e,{url:nn(c,"_bulk_get"+an(n)),method:"POST",body:{docs:e.docs}},t)}function i(){for(var r=Do,n=Math.ceil(e.docs.length/r),i=0,a=new Array(n),s=0;s<n;s++){var u=y(e,["revs","attachments","latest"]);u.ajax=f,u.docs=e.docs.slice(s*r,Math.min(e.docs.length,(s+1)*r)),_(o,u,function(e){return function(r,o){a[e]=o.results,++i===n&&t(null,{results:B(a)})}}(s))}}var o=this,a=on(c,""),s=jo[a];"boolean"!=typeof s?n(function(e,r){e?(jo[a]=!1,C(e.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),i()):(jo[a]=!0,t(null,r))}):s?n(t):i()}),s._info=function(e){o().then(function(){r({},{method:"GET",url:nn(c,"")},function(t,r){if(t)return e(t);r.host=nn(c,""),e(null,r)})}).catch(e)},s.get=i("get",function(e,t,r){function i(e){function r(r){var o=i[r],s=Zr(e._id)+"/"+a(r)+"?rev="+e._rev;return n(t,{method:"GET",url:nn(c,s),binary:!0}).then(function(e){return t.binary?e:new ii(function(t){Ot(e,t)})}).then(function(e){delete o.stub,delete o.length,o.data=e})}var i=e._attachments,o=i&&Object.keys(i);if(i&&o.length)return Qr(o.map(function(e){return function(){return r(e)}}),5)}function o(e){return Array.isArray(e)?ii.all(e.map(function(e){if(e.ok)return i(e.ok)})):i(e)}"function"==typeof t&&(r=t,t={});var s={};(t=u(t)).revs&&(s.revs=!0),t.revs_info&&(s.revs_info=!0),t.latest&&(s.latest=!0),t.open_revs&&("all"!==t.open_revs&&(t.open_revs=JSON.stringify(t.open_revs)),s.open_revs=t.open_revs),t.rev&&(s.rev=t.rev),t.conflicts&&(s.conflicts=t.conflicts),e=Zr(e);var l={method:"GET",url:nn(c,e+an(s))};n(t,l).then(function(e){return ii.resolve().then(function(){if(t.attachments)return o(e)}).then(function(){r(null,e)})}).catch(function(t){t.docId=e,r(t)})}),s.remove=i("remove",function(e,t,n,i){var o;"string"==typeof t?(o={_id:e,_rev:t},"function"==typeof n&&(i=n,n={})):(o=e,"function"==typeof t?(i=t,n={}):(i=n,n=t));var a=o._rev||n.rev;r(n,{method:"DELETE",url:nn(c,Zr(o._id))+"?rev="+a},i)}),s.getAttachment=i("getAttachment",function(e,t,n,i){"function"==typeof n&&(i=n,n={});var o=n.rev?"?rev="+n.rev:"";r(n,{method:"GET",url:nn(c,Zr(e))+"/"+a(t)+o,binary:!0},i)}),s.removeAttachment=i("removeAttachment",function(e,t,n,i){r({},{method:"DELETE",url:nn(c,Zr(e)+"/"+a(t))+"?rev="+n},i)}),s.putAttachment=i("putAttachment",function(e,t,n,i,o,s){"function"==typeof o&&(s=o,o=i,i=n,n=null);var u=Zr(e)+"/"+a(t),l=nn(c,u);if(n&&(l+="?rev="+n),"string"==typeof i){var p;try{p=Ui(i)}catch(e){return s(j(_i,"Attachment is not a valid base64 string"))}i=p?Dt(p,o):""}r({},{headers:{"Content-Type":o},method:"PUT",url:l,processData:!1,body:i,timeout:f.timeout||6e4},s)}),s._bulkDocs=function(e,t,n){e.new_edits=t.new_edits,o().then(function(){return ii.all(e.docs.map(en))}).then(function(){r(t,{method:"POST",url:nn(c,"_bulk_docs"),timeout:t.timeout,body:e},function(e,t){if(e)return n(e);t.forEach(function(e){e.ok=!0}),n(null,t)})}).catch(n)},s._put=function(e,t,n){o().then(function(){return en(e)}).then(function(){r(t,{method:"PUT",url:nn(c,Zr(e._id)),body:e},function(t,r){if(t)return t.docId=e&&e._id,n(t);n(null,r)})}).catch(n)},s.allDocs=i("allDocs",function(e,t){"function"==typeof e&&(t=e,e={});var r,i={},o="GET";(e=u(e)).conflicts&&(i.conflicts=!0),e.descending&&(i.descending=!0),e.include_docs&&(i.include_docs=!0),e.attachments&&(i.attachments=!0),e.key&&(i.key=JSON.stringify(e.key)),e.start_key&&(e.startkey=e.start_key),e.startkey&&(i.startkey=JSON.stringify(e.startkey)),e.end_key&&(e.endkey=e.end_key),e.endkey&&(i.endkey=JSON.stringify(e.endkey)),void 0!==e.inclusive_end&&(i.inclusive_end=!!e.inclusive_end),void 0!==e.limit&&(i.limit=e.limit),void 0!==e.skip&&(i.skip=e.skip);var a=an(i);void 0!==e.keys&&(o="POST",r={keys:e.keys}),n(e,{method:o,url:nn(c,"_all_docs"+a),body:r}).then(function(r){e.include_docs&&e.attachments&&e.binary&&r.rows.forEach(Yr),t(null,r)}).catch(t)}),s._changes=function(e){var t="batch_size"in e?e.batch_size:Ao;!(e=u(e)).continuous||"heartbeat"in e||(e.heartbeat=Fo);var n="timeout"in e?e.timeout:"timeout"in f?f.timeout:3e4;"timeout"in e&&e.timeout&&n-e.timeout<Co&&(n=e.timeout+Co),"heartbeat"in e&&e.heartbeat&&n-e.heartbeat<Co&&(n=e.heartbeat+Co);var i={};"timeout"in e&&e.timeout&&(i.timeout=e.timeout);var a,s=void 0!==e.limit&&e.limit;a="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var l=s;if(e.style&&(i.style=e.style),(e.include_docs||e.filter&&"function"==typeof e.filter)&&(i.include_docs=!0),e.attachments&&(i.attachments=!0),e.continuous&&(i.feed="longpoll"),e.conflicts&&(i.conflicts=!0),e.descending&&(i.descending=!0),"heartbeat"in e&&e.heartbeat&&(i.heartbeat=e.heartbeat),e.filter&&"string"==typeof e.filter&&(i.filter=e.filter),e.view&&"string"==typeof e.view&&(i.filter="_view",i.view=e.view),e.query_params&&"object"==typeof e.query_params)for(var p in e.query_params)e.query_params.hasOwnProperty(p)&&(i[p]=e.query_params[p]);var h,d="GET";e.doc_ids?(i.filter="_doc_ids",d="POST",h={doc_ids:e.doc_ids}):e.selector&&(i.filter="_selector",d="POST",h={selector:e.selector});var m,v,y=function(a,u){if(!e.aborted){i.since=a,"object"==typeof i.since&&(i.since=JSON.stringify(i.since)),e.descending?s&&(i.limit=l):i.limit=!s||l>t?t:l;var f={method:d,url:nn(c,"_changes"+an(i)),timeout:n,body:h};v=a,e.aborted||o().then(function(){m=r(e,f,u)}).catch(u)}},g={results:[]},b=function(r,n){if(!e.aborted){var i=0;if(n&&n.results)i=n.results.length,g.last_seq=n.last_seq,{}.query=e.query_params,n.results=n.results.filter(function(t){l--;var r=R(e)(t);return r&&(e.include_docs&&e.attachments&&e.binary&&Yr(t),a&&g.results.push(t),e.onChange(t)),r});else if(r)return e.aborted=!0,void e.complete(r);n&&n.last_seq&&(v=n.last_seq);var o=s&&l<=0||n&&i<t||e.descending;(!e.continuous||s&&l<=0)&&o?e.complete(null,g):Zn(function(){y(v,b)})}};return y(e.since||0,b),{cancel:function(){e.aborted=!0,m&&m.abort()}}},s.revsDiff=i("revsDiff",function(e,t,n){"function"==typeof t&&(n=t,t={}),r(t,{method:"POST",url:nn(c,"_revs_diff"),body:e},n)}),s._close=function(e){e()},s._destroy=function(e,t){r(e,{url:nn(c,""),method:"DELETE"},function(e,r){if(e&&e.status&&404!==e.status)return t(e);t(null,r)})}}function un(e){this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,un)}catch(e){}}function cn(e){this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,cn)}catch(e){}}function ln(e){this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,ln)}catch(e){}}function fn(e,t){return t&&e.then(function(e){Zn(function(){t(null,e)})},function(e){Zn(function(){t(e)})}),e}function pn(e){return Kn(function(t){var r=t.pop(),n=e.apply(this,t);return"function"==typeof r&&fn(n,r),n})}function hn(e,t){return e.then(function(e){return t().then(function(){return e})},function(e){return t().then(function(){throw e})})}function dn(e,t){return function(){var r=arguments,n=this;return e.add(function(){return t.apply(n,r)})}}function mn(e){var t=new si(e),r=new Array(t.size),n=-1;return t.forEach(function(e){r[++n]=e}),r}function vn(e){var t=new Array(e.size),r=-1;return e.forEach(function(e,n){t[++r]=n}),t}function yn(e){return new ln("builtin "+e+" function requires map values to be numbers or number arrays")}function gn(e){for(var t=0,r=0,n=e.length;r<n;r++){var i=e[r];if("number"!=typeof i){if(!Array.isArray(i))throw yn("_sum");t="number"==typeof t?[t]:t;for(var o=0,a=i.length;o<a;o++){var s=i[o];if("number"!=typeof s)throw yn("_sum");void 0===t[o]?t.push(s):t[o]+=s}}else"number"==typeof t?t+=i:t[0]+=i}return t}function bn(e,t){return $("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:gn,log:To,isArray:Oo,toJSON:Ro})}function _n(){this.promise=new ii(function(e){e()})}function xn(e){if(!e)return"undefined";switch(typeof e){case"function":case"string":return e.toString();default:return JSON.stringify(e)}}function wn(e,t){return xn(e)+xn(t)+"undefined"}function kn(e,t,r,n,i,o){var a,s=wn(r,n);if(!i&&(a=e._cachedViews=e._cachedViews||{})[s])return a[s];var u=e.info().then(function(u){var c=u.db_name+"-mrview-"+(i?"temp":Mt(s));return W(e,"_local/"+o,function(e){e.views=e.views||{};var r=t;-1===r.indexOf("/")&&(r=t+"/"+t);var n=e.views[r]=e.views[r]||{};if(!n[c])return n[c]=!0,e}).then(function(){return e.registerDependentDatabase(c).then(function(t){var i=t.db;i.auto_compaction=!0;var o={name:c,db:i,sourceDB:e,adapter:e.adapter,mapFun:r,reduceFun:n};return o.db.get("_local/lastSeq").catch(function(e){if(404!==e.status)throw e}).then(function(e){return o.seq=e?e.seq:0,a&&o.db.once("destroyed",function(){delete a[s]}),o})})})});return a&&(a[s]=u),u}function En(e){return-1===e.indexOf("/")?[e,e]:e.split("/")}function Sn(e){return 1===e.length&&/^1-/.test(e[0].rev)}function An(e,t){try{e.emit("error",t)}catch(e){S("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),S("error",t)}}function Dn(e){if(/^_sum/.test(e))return Lo._sum;if(/^_count/.test(e))return Lo._count;if(/^_stats/.test(e))return Lo._stats;if(/^_/.test(e))throw new Error(e+" is not a supported reduce function.")}function Cn(e){return/^1-/.test(e)}function Fn(e,t,r){return!e._attachments||!e._attachments[r]||e._attachments[r].digest!==t._attachments[r].digest}function jn(e,t){var r=Object.keys(t._attachments);return ii.all(r.map(function(r){return e.getAttachment(t._id,r,{rev:t._rev})}))}function Tn(e,t,r){var n=I(t)&&!I(e),i=Object.keys(r._attachments);return n?e.get(r._id).then(function(n){return ii.all(i.map(function(i){return Fn(n,r,i)?t.getAttachment(r._id,i):e.getAttachment(n._id,i)}))}).catch(function(e){if(404!==e.status)throw e;return jn(t,r)}):jn(t,r)}function On(e){var t=[];return Object.keys(e).forEach(function(r){e[r].missing.forEach(function(e){t.push({id:r,rev:e})})}),{docs:t,revs:!0,latest:!0}}function Rn(e,t,r,n){function i(e){return e._attachments&&Object.keys(e._attachments).length>0}function o(e){return e._conflicts&&e._conflicts.length>0}function a(t){return e.allDocs({keys:t,include_docs:!0,conflicts:!0}).then(function(e){if(n.cancelled)throw new Error("cancelled");e.rows.forEach(function(e){e.deleted||!e.doc||!Cn(e.value.rev)||i(e.doc)||o(e.doc)||(e.doc._conflicts&&delete e.doc._conflicts,s.push(e.doc),delete r[e.id])})})}r=u(r);var s=[],c=!0;return ii.resolve().then(function(){var e=Object.keys(r).filter(function(e){var t=r[e].missing;return 1===t.length&&Cn(t[0])});if(e.length>0)return a(e)}).then(function(){var i=On(r);if(i.docs.length)return e.bulkGet(i).then(function(r){if(n.cancelled)throw new Error("cancelled");return ii.all(r.results.map(function(r){return ii.all(r.docs.map(function(r){var n=r.ok;return r.error&&(c=!1),n&&n._attachments?Tn(t,e,n).then(function(e){var t=Object.keys(n._attachments);return e.forEach(function(e,r){var i=n._attachments[t[r]];delete i.stub,delete i.length,i.data=e}),n}):n}))})).then(function(e){s=s.concat(B(e).filter(Boolean))})})}).then(function(){return{ok:c,docs:s}})}function Bn(e,t,r,n,i){return e.get(t).catch(function(r){if(404===r.status)return"http"!==e.adapter&&"https"!==e.adapter||C(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:n,_id:t,history:[],replicator:$o,version:qo};throw r}).then(function(o){if(!i.cancelled&&o.last_seq!==r)return o.history=(o.history||[]).filter(function(e){return e.session_id!==n}),o.history.unshift({last_seq:r,session_id:n}),o.history=o.history.slice(0,Wo),o.version=qo,o.replicator=$o,o.session_id=n,o.last_seq=r,e.put(o).catch(function(o){if(409===o.status)return Bn(e,t,r,n,i);throw o})})}function Pn(e,t,r,n,i){this.src=e,this.target=t,this.id=r,this.returnValue=n,this.opts=i}function In(e,t){return e.session_id===t.session_id?{last_seq:e.last_seq,history:e.history}:Ln(e.history,t.history)}function Ln(e,t){var r=e[0],n=e.slice(1),i=t[0],o=t.slice(1);return r&&0!==t.length?Nn(r.session_id,t)?{last_seq:r.last_seq,history:e}:Nn(i.session_id,n)?{last_seq:i.last_seq,history:o}:Ln(n,o):{last_seq:Uo,history:[]}}function Nn(e,t){var r=t[0],n=t.slice(1);return!(!e||0===t.length)&&(e===r.session_id||Nn(e,n))}function Mn(e){return"number"==typeof e.status&&4===Math.floor(e.status/100)}function qn(e,t,r,n){if(!1===e.retry)return t.emit("error",r),void t.removeAllListeners();if("function"!=typeof e.back_off_function&&(e.back_off_function=D),t.emit("requestError",r),"active"===t.state||"pending"===t.state){t.emit("paused",r),t.state="stopped";var i=function(){e.current_back_off=zo},o=function(){t.removeListener("active",i)};t.once("paused",o),t.once("active",i)}e.current_back_off=e.current_back_off||zo,e.current_back_off=e.back_off_function(e.current_back_off),setTimeout(n,e.current_back_off)}function $n(e){return Object.keys(e).sort(We).reduce(function(t,r){return t[r]=e[r],t},{})}function Wn(e,t,r){var n=r.doc_ids?r.doc_ids.sort(We):"",i=r.filter?r.filter.toString():"",o="",a="",s="";return r.selector&&(s=JSON.stringify(r.selector)),r.filter&&r.query_params&&(o=JSON.stringify($n(r.query_params))),r.filter&&"_view"===r.filter&&(a=r.view.toString()),ii.all([e.id(),t.id()]).then(function(e){var t=e[0]+e[1]+i+a+o+n+s;return new ii(function(e){Nt(t,e)})}).then(function(e){return"_local/"+(e=e.replace(/\//g,".").replace(/\+/g,"_"))})}function Un(e,t,r,n,i){function o(){return k?ii.resolve():Wn(e,t,r).then(function(i){w=i;var o={};o=!1===r.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:"source"===r.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:"target"===r.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},k=new Pn(e,t,w,n,o)})}function a(){if(N=[],0!==x.docs.length){var e=x.docs,o={timeout:r.timeout};return t.bulkDocs({docs:e,new_edits:!1},o).then(function(t){if(n.cancelled)throw d(),new Error("cancelled");var r=Object.create(null);t.forEach(function(e){e.error&&(r[e.id]=e)});var o=Object.keys(r).length;i.doc_write_failures+=o,i.docs_written+=e.length-o,e.forEach(function(e){var t=r[e._id];if(t){if(i.errors.push(t),"unauthorized"!==t.name&&"forbidden"!==t.name)throw t;n.emit("denied",u(t))}else N.push(e)})},function(t){throw i.doc_write_failures+=e.length,t})}}function s(){if(x.error)throw new Error("There was a problem getting docs.");i.last_seq=F=x.seq;var e=u(i);return N.length&&(e.docs=N,n.emit("change",e)),A=!0,k.writeCheckpoint(x.seq,M).then(function(){if(A=!1,n.cancelled)throw d(),new Error("cancelled");x=void 0,g()}).catch(function(e){throw _(e),e})}function c(){var e={};return x.changes.forEach(function(t){"_user/"!==t.id&&(e[t.id]=t.changes.map(function(e){return e.rev}))}),t.revsDiff(e).then(function(e){if(n.cancelled)throw d(),new Error("cancelled");x.diffs=e})}function l(){return Rn(e,t,x.diffs,n).then(function(e){x.error=!e.ok,e.docs.forEach(function(e){delete x.diffs[e._id],i.docs_read++,x.docs.push(e)})})}function f(){n.cancelled||x||(0!==E.length?(x=E.shift(),c().then(l).then(a).then(s).then(f).catch(function(e){h("batch processing terminated with error",e)})):p(!0))}function p(e){0!==S.changes.length?(e||D||S.changes.length>=O)&&(E.push(S),S={seq:0,changes:[],docs:[]},"pending"!==n.state&&"stopped"!==n.state||(n.state="active",n.emit("active")),f()):0!==E.length||x||((T&&q.live||D)&&(n.state="pending",n.emit("paused")),D&&d())}function h(e,t){C||(t.message||(t.message=e),i.ok=!1,i.status="aborting",E=[],S={seq:0,changes:[],docs:[]},d(t))}function d(o){C||n.cancelled&&(i.status="cancelled",A)||(i.status=i.status||"complete",i.end_time=new Date,i.last_seq=F,C=!0,o?((o=j(o)).result=i,"unauthorized"===o.name||"forbidden"===o.name?(n.emit("error",o),n.removeAllListeners()):qn(r,n,o,function(){Un(e,t,r,n)})):(n.emit("complete",i),n.removeAllListeners()))}function m(e){if(n.cancelled)return d();R(r)(e)&&(S.seq=e.seq,S.changes.push(e),p(0===E.length&&q.live))}function v(e){if(P=!1,n.cancelled)return d();if(e.results.length>0)q.since=e.last_seq,g(),p(!0);else{var t=function(){T?(q.live=!0,g()):D=!0,p(!0)};x||0!==e.results.length?t():(A=!0,k.writeCheckpoint(e.last_seq,M).then(function(){A=!1,i.last_seq=F=e.last_seq,t()}).catch(_))}}function y(e){if(P=!1,n.cancelled)return d();h("changes rejected",e)}function g(){function t(){o.cancel()}function i(){n.removeListener("cancel",t)}if(!P&&!D&&E.length<B){P=!0,n._changes&&(n.removeListener("cancel",n._abortChanges),n._changes.cancel()),n.once("cancel",t);var o=e.changes(q).on("change",m);o.then(i,i),o.then(v).catch(y),r.retry&&(n._changes=o,n._abortChanges=t)}}function b(){o().then(function(){if(!n.cancelled)return k.getCheckpoint().then(function(e){q={since:F=e,limit:O,batch_size:O,style:"all_docs",doc_ids:I,selector:L,return_docs:!0},r.filter&&("string"!=typeof r.filter?q.include_docs=!0:q.filter=r.filter),"heartbeat"in r&&(q.heartbeat=r.heartbeat),"timeout"in r&&(q.timeout=r.timeout),r.query_params&&(q.query_params=r.query_params),r.view&&(q.view=r.view),g()});d()}).catch(function(e){h("getCheckpoint rejected with ",e)})}function _(e){A=!1,h("writeCheckpoint completed with error",e)}var x,w,k,E=[],S={seq:0,changes:[],docs:[]},A=!1,D=!1,C=!1,F=0,T=r.continuous||r.live||!1,O=r.batch_size||100,B=r.batches_limit||10,P=!1,I=r.doc_ids,L=r.selector,N=[],M=Ri();i=i||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var q={};n.ready(e,t),n.cancelled?d():(n._addedListeners||(n.once("cancel",d),"function"==typeof r.complete&&(n.once("error",r.complete),n.once("complete",function(e){r.complete(null,e)})),n._addedListeners=!0),void 0===r.since?b():o().then(function(){return A=!0,k.writeCheckpoint(r.since,M)}).then(function(){A=!1,n.cancelled?d():(F=r.since,b())}).catch(_))}function Gn(){Qn.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var e=this,t=new ii(function(t,r){e.once("complete",t),e.once("error",r)});e.then=function(e,r){return t.then(e,r)},e.catch=function(e){return t.catch(e)},e.catch(function(){})}function zn(e,t){var r=t.PouchConstructor;return"string"==typeof e?new r(e,t):e}function Vn(e,t,r,n){if("function"==typeof r&&(n=r,r={}),void 0===r&&(r={}),r.doc_ids&&!Array.isArray(r.doc_ids))throw j(ki,"`doc_ids` filter parameter is not a list.");r.complete=n,(r=u(r)).continuous=r.continuous||r.live,r.retry="retry"in r&&r.retry,r.PouchConstructor=r.PouchConstructor||this;var i=new Gn(r);return Un(zn(e,r),zn(t,r),r,i),i}function Jn(e,t,r,n){return"function"==typeof r&&(n=r,r={}),void 0===r&&(r={}),r=u(r),r.PouchConstructor=r.PouchConstructor||this,e=zn(e,r),t=zn(t,r),new Hn(e,t,r,n)}function Hn(e,t,r,n){function i(e){d.emit("change",{direction:"pull",change:e})}function o(e){d.emit("change",{direction:"push",change:e})}function a(e){d.emit("denied",{direction:"push",doc:e})}function s(e){d.emit("denied",{direction:"pull",doc:e})}function u(){d.pushPaused=!0,d.pullPaused&&d.emit("paused")}function c(){d.pullPaused=!0,d.pushPaused&&d.emit("paused")}function l(){d.pushPaused=!1,d.pullPaused&&d.emit("active",{direction:"push"})}function f(){d.pullPaused=!1,d.pushPaused&&d.emit("active",{direction:"pull"})}function p(e){return function(t,r){var n="change"===t&&(r===i||r===o),p="denied"===t&&(r===s||r===a),h="paused"===t&&(r===c||r===u),m="active"===t&&(r===f||r===l);(n||p||h||m)&&(t in y||(y[t]={}),y[t][e]=!0,2===Object.keys(y[t]).length&&d.removeAllListeners(t))}}function h(e,t,r){-1==e.listeners(t).indexOf(r)&&e.on(t,r)}var d=this;this.canceled=!1;var m=r.push?pi({},r,r.push):r,v=r.pull?pi({},r,r.pull):r;this.push=Vn(e,t,m),this.pull=Vn(t,e,v),this.pushPaused=!0,this.pullPaused=!0;var y={};r.live&&(this.push.on("complete",d.pull.cancel.bind(d.pull)),this.pull.on("complete",d.push.cancel.bind(d.push))),this.on("newListener",function(e){"change"===e?(h(d.pull,"change",i),h(d.push,"change",o)):"denied"===e?(h(d.pull,"denied",s),h(d.push,"denied",a)):"active"===e?(h(d.pull,"active",f),h(d.push,"active",l)):"paused"===e&&(h(d.pull,"paused",c),h(d.push,"paused",u))}),this.on("removeListener",function(e){"change"===e?(d.pull.removeListener("change",i),d.push.removeListener("change",o)):"denied"===e?(d.pull.removeListener("denied",s),d.push.removeListener("denied",a)):"active"===e?(d.pull.removeListener("active",f),d.push.removeListener("active",l)):"paused"===e&&(d.pull.removeListener("paused",c),d.push.removeListener("paused",u))}),this.pull.on("removeListener",p("pull")),this.push.on("removeListener",p("push"));var g=ii.all([this.push,this.pull]).then(function(e){var t={push:e[0],pull:e[1]};return d.emit("complete",t),n&&n(null,t),d.removeAllListeners(),t},function(e){if(d.cancel(),n?n(e):d.emit("error",e),d.removeAllListeners(),n)throw e});this.then=function(e,t){return g.then(e,t)},this.catch=function(e){return g.catch(e)}}var Xn=n(e(7)),Kn=n(e(1)),Qn=e(4),Yn=n(e(6)),Zn=n(e(5)),ei=n(e(13)),ti=n(e(2)),ri=n(e(10)),ni=n(e(14)),ii="function"==typeof Promise?Promise:Xn,oi=Function.prototype.toString,ai=oi.call(Object);m.prototype.get=function(e){var t=h(e);return this._store[t]},m.prototype.set=function(e,t){var r=h(e);return this._store[r]=t,!0},m.prototype.has=function(e){return h(e)in this._store},m.prototype.delete=function(e){var t=h(e),r=t in this._store;return delete this._store[t],r},m.prototype.forEach=function(e){for(var t=Object.keys(this._store),r=0,n=t.length;r<n;r++){var i=t[r];e(this._store[i],i=d(i))}},Object.defineProperty(m.prototype,"size",{get:function(){return Object.keys(this._store).length}}),v.prototype.add=function(e){return this._store.set(e,!0)},v.prototype.has=function(e){return this._store.has(e)},v.prototype.forEach=function(e){this._store.forEach(function(t,r){e(r)})},Object.defineProperty(v.prototype,"size",{get:function(){return this._store.size}});var si,ui;!function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}()?(si=v,ui=m):(si=Set,ui=Map);var ci,li=6;if(x())ci=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),ci=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){ci=!1}Yn(E,Qn.EventEmitter),E.prototype.addListener=function(e,t,r,n){function i(){if(o._listeners[t])if(a)a="waiting";else{a=!0;var e=y(n,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);r.changes(e).on("change",function(e){e.seq>n.since&&!n.cancelled&&(n.since=e.seq,n.onChange(e))}).on("complete",function(){"waiting"===a&&Zn(i),a=!1}).on("error",function(){a=!1})}}if(!this._listeners[t]){var o=this,a=!1;this._listeners[t]=i,this.on(e,i)}},E.prototype.removeListener=function(e,t){t in this._listeners&&(Qn.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},E.prototype.notifyLocalWindows=function(e){x()?chrome.storage.local.set({dbName:e}):w()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},E.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var fi,pi=fi="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t};Yn(F,Error),F.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};new F(401,"unauthorized","Name or password is incorrect.");var hi=new F(400,"bad_request","Missing JSON list of 'docs'"),di=new F(404,"not_found","missing"),mi=new F(409,"conflict","Document update conflict"),vi=new F(400,"bad_request","_id field must contain a string"),yi=new F(412,"missing_id","_id is required for puts"),gi=new F(400,"bad_request","Only reserved document ids may start with underscore."),bi=(new F(412,"precondition_failed","Database not open"),new F(500,"unknown_error","Database encountered an unknown error")),_i=new F(500,"badarg","Some query argument is invalid"),xi=(new F(400,"invalid_request","Request was invalid"),new F(400,"query_parse_error","Some query parameter is invalid")),wi=new F(500,"doc_validation","Bad special document member"),ki=new F(400,"bad_request","Something wrong with the request"),Ei=new F(400,"bad_request","Document must be a JSON object"),Si=(new F(404,"not_found","Database not found"),new F(500,"indexed_db_went_bad","unknown")),Ai=new F(500,"web_sql_went_bad","unknown"),Di=(new F(500,"levelDB_went_went_bad","unknown"),new F(403,"forbidden","Forbidden by design doc validate_doc_update function"),new F(400,"bad_request","Invalid rev format")),Ci=(new F(412,"file_exists","The database could not be created, the file already exists."),new F(412,"missing_stub","A pre-existing attachment stub wasn't found"));new F(413,"invalid_url","Provided URL is invalid");var Fi=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],ji="queryKey",Ti=/(?:^|&)([^&=]*)=?([^&]*)/g,Oi=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Ri=ei;Yn(he,Qn.EventEmitter),he.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},he.prototype.validateChanges=function(e){var t=e.complete,r=this;De._changesFilterPlugin?De._changesFilterPlugin.validate(e,function(n){if(n)return t(n);r.doChanges(e)}):r.doChanges(e)},he.prototype.doChanges=function(e){var t=this,r=e.complete;if("live"in(e=u(e))&&!("continuous"in e)&&(e.continuous=e.live),e.processChange=de,"latest"===e.since&&(e.since="now"),e.since||(e.since=0),"now"!==e.since){if(De._changesFilterPlugin){if(De._changesFilterPlugin.normalize(e),De._changesFilterPlugin.shouldFilter(this,e))return De._changesFilterPlugin.filter(this,e)}else["doc_ids","filter","selector","view"].forEach(function(t){t in e&&S("warn",'The "'+t+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in e||(e.descending=!1),e.limit=0===e.limit?1:e.limit,e.complete=r;var n=this.db._changes(e);if(n&&"function"==typeof n.cancel){var i=t.cancel;t.cancel=Kn(function(e){n.cancel(),i.apply(this,e)})}}else this.db.info().then(function(n){t.isCancelled?r(null,{status:"cancelled"}):(e.since=n.update_seq,t.doChanges(e))},r)},Yn(ke,Qn.EventEmitter),ke.prototype.post=p("post",function(e,t,r){if("function"==typeof t&&(r=t,t={}),"object"!=typeof e||Array.isArray(e))return r(j(Ei));this.bulkDocs({docs:[e]},t,ve(r,e._id))}),ke.prototype.put=p("put",function(e,t,r){function n(r){"function"==typeof i._put&&!1!==t.new_edits?i._put(e,t,r):i.bulkDocs({docs:[e]},t,ve(r,e._id))}if("function"==typeof t&&(r=t,t={}),"object"!=typeof e||Array.isArray(e))return r(j(Ei));if(P(e._id),le(e._id)&&"function"==typeof this._putLocal)return e._deleted?this._removeLocal(e,r):this._putLocal(e,r);var i=this;t.force&&e._rev?(!function(){var r=e._rev.split("-"),n=r[1],i=parseInt(r[0],10)+1,o=G();e._revisions={start:i,ids:[o,n]},e._rev=i+"-"+o,t.new_edits=!1}(),n(function(t){var n=t?null:{ok:!0,id:e._id,rev:e._rev};r(t,n)})):n(r)}),ke.prototype.putAttachment=p("putAttachment",function(e,t,r,n,i){function o(e){var r="_rev"in e?parseInt(e._rev,10):0;return e._attachments=e._attachments||{},e._attachments[t]={content_type:i,data:n,revpos:++r},a.put(e)}var a=this;return"function"==typeof i&&(i=n,n=r,r=null),void 0===i&&(i=n,n=r,r=null),i||S("warn","Attachment",t,"on document",e,"is missing content_type"),a.get(e).then(function(e){if(e._rev!==r)throw j(mi);return o(e)},function(t){if(t.reason===di.message)return o({_id:e});throw t})}),ke.prototype.removeAttachment=p("removeAttachment",function(e,t,r,n){var i=this;i.get(e,function(e,o){if(e)n(e);else if(o._rev===r){if(!o._attachments)return n();delete o._attachments[t],0===Object.keys(o._attachments).length&&delete o._attachments,i.put(o,n)}else n(j(mi))})}),ke.prototype.remove=p("remove",function(e,t,r,n){var i;"string"==typeof t?(i={_id:e,_rev:t},"function"==typeof r&&(n=r,r={})):(i=e,"function"==typeof t?(n=t,r={}):(n=r,r=t)),(r=r||{}).was_delete=!0;var o={_id:i._id,_rev:i._rev||r.rev};if(o._deleted=!0,le(o._id)&&"function"==typeof this._removeLocal)return this._removeLocal(i,n);this.bulkDocs({docs:[o]},r,ve(n,o._id))}),ke.prototype.revsDiff=p("revsDiff",function(e,t,r){function n(e,t){s.has(e)||s.set(e,{missing:[]}),s.get(e).missing.push(t)}function i(t,r){var i=e[t].slice(0);V(r,function(e,r,o,a,s){var u=r+"-"+o,c=i.indexOf(u);-1!==c&&(i.splice(c,1),"available"!==s.status&&n(t,u))}),i.forEach(function(e){n(t,e)})}"function"==typeof t&&(r=t,t={});var o=Object.keys(e);if(!o.length)return r(null,{});var a=0,s=new ui;o.map(function(t){this._getRevisionTree(t,function(n,u){if(n&&404===n.status&&"missing"===n.message)s.set(t,{missing:e[t]});else{if(n)return r(n);i(t,u)}if(++a===o.length){var c={};return s.forEach(function(e,t){c[t]=e}),r(null,c)}})},this)}),ke.prototype.bulkGet=p("bulkGet",function(e,t){_(this,e,t)}),ke.prototype.compactDocument=p("compactDocument",function(e,t,r){var n=this;this._getRevisionTree(e,function(i,o){if(i)return r(i);var a=be(o),s=[],u=[];Object.keys(a).forEach(function(e){a[e]>t&&s.push(e)}),V(o,function(e,t,r,n,i){var o=t+"-"+r;"available"===i.status&&-1!==s.indexOf(o)&&u.push(o)}),n._doCompaction(e,u,r)})}),ke.prototype.compact=p("compact",function(e,t){"function"==typeof e&&(t=e,e={});var r=this;e=e||{},r._compactionQueue=r._compactionQueue||[],r._compactionQueue.push({opts:e,callback:t}),1===r._compactionQueue.length&&xe(r)}),ke.prototype._compact=function(e,t){var r=this,n={return_docs:!1,last_seq:e.last_seq||0},i=[];r.changes(n).on("change",function(e){i.push(r.compactDocument(e.id,0))}).on("complete",function(e){var n=e.last_seq;ii.all(i).then(function(){return W(r,"_local/compaction",function(e){return(!e.last_seq||e.last_seq<n)&&(e.last_seq=n,e)})}).then(function(){t(null,{ok:!0})}).catch(t)}).on("error",t)},ke.prototype.get=p("get",function(e,t,r){function n(){var n=[],a=i.length;if(!a)return r(null,n);i.forEach(function(i){o.get(e,{rev:i,revs:t.revs,latest:t.latest,attachments:t.attachments},function(e,t){if(e)n.push({missing:i});else{for(var o,s=0,u=n.length;s<u;s++)if(n[s].ok&&n[s].ok._rev===t._rev){o=!0;break}o||n.push({ok:t})}--a||r(null,n)})})}if("function"==typeof t&&(r=t,t={}),"string"!=typeof e)return r(j(vi));if(le(e)&&"function"==typeof this._getLocal)return this._getLocal(e,r);var i=[],o=this;if(!t.open_revs)return this._get(e,t,function(n,i){if(n)return n.docId=e,r(n);var a=i.doc,s=i.metadata,u=i.ctx;if(t.conflicts){var c=X(s);c.length&&(a._conflicts=c)}if(ce(s,a._rev)&&(a._deleted=!0),t.revs||t.revs_info){for(var l=a._rev.split("-"),f=parseInt(l[0],10),p=l[1],h=Q(s.rev_tree),d=null,m=0;m<h.length;m++){var v=h[m],y=v.ids.map(function(e){return e.id}).indexOf(p);(y===f-1||!d&&-1!==y)&&(d=v)}var g=d.ids.map(function(e){return e.id}).indexOf(a._rev.split("-")[1])+1,b=d.ids.length-g;if(d.ids.splice(g,b),d.ids.reverse(),t.revs&&(a._revisions={start:d.pos+d.ids.length-1,ids:d.ids.map(function(e){return e.id})}),t.revs_info){var _=d.pos+d.ids.length;a._revs_info=d.ids.map(function(e){return _--,{rev:_+"-"+e.id,status:e.opts.status}})}}if(t.attachments&&a._attachments){var x=a._attachments,w=Object.keys(x).length;if(0===w)return r(null,a);Object.keys(x).forEach(function(e){this._getAttachment(a._id,e,x[e],{rev:a._rev,binary:t.binary,ctx:u},function(t,n){var i=a._attachments[e];i.data=n,delete i.stub,delete i.length,--w||r(null,a)})},o)}else{if(a._attachments)for(var k in a._attachments)a._attachments.hasOwnProperty(k)&&(a._attachments[k].stub=!0);r(null,a)}});if("all"===t.open_revs)this._getRevisionTree(e,function(e,t){if(e)return r(e);i=H(t).map(function(e){return e.rev}),n()});else{if(!Array.isArray(t.open_revs))return r(j(bi,"function_clause"));i=t.open_revs;for(var a=0;a<i.length;a++){var s=i[a];if("string"!=typeof s||!/^\d+-/.test(s))return r(j(Di))}n()}}),ke.prototype.getAttachment=p("getAttachment",function(e,t,r,n){var i=this;r instanceof Function&&(n=r,r={}),this._get(e,r,function(o,a){return o?n(o):a.doc._attachments&&a.doc._attachments[t]?(r.ctx=a.ctx,r.binary=!0,void i._getAttachment(e,t,a.doc._attachments[t],r,n)):n(j(di))})}),ke.prototype.allDocs=p("allDocs",function(e,t){if("function"==typeof e&&(t=e,e={}),e.skip=void 0!==e.skip?e.skip:0,e.start_key&&(e.startkey=e.start_key),e.end_key&&(e.endkey=e.end_key),"keys"in e){if(!Array.isArray(e.keys))return t(new TypeError("options.keys must be an array"));var r=["startkey","endkey","key"].filter(function(t){return t in e})[0];if(r)return void t(j(xi,"Query parameter `"+r+"` is not compatible with multi-get"));if(!I(this))return _e(this,e,t)}return this._allDocs(e,t)}),ke.prototype.changes=function(e,t){return"function"==typeof e&&(t=e,e={}),new he(this,e,t)},ke.prototype.close=p("close",function(e){return this._closed=!0,this.emit("closed"),this._close(e)}),ke.prototype.info=p("info",function(e){var t=this;this._info(function(r,n){if(r)return e(r);n.db_name=n.db_name||t.name,n.auto_compaction=!(!t.auto_compaction||I(t)),n.adapter=t.adapter,e(null,n)})}),ke.prototype.id=p("id",function(e){return this._id(e)}),ke.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},ke.prototype.bulkDocs=p("bulkDocs",function(e,t,r){if("function"==typeof t&&(r=t,t={}),t=t||{},Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return r(j(hi));for(var n=0;n<e.docs.length;++n)if("object"!=typeof e.docs[n]||Array.isArray(e.docs[n]))return r(j(Ei));var i;if(e.docs.forEach(function(e){e._attachments&&Object.keys(e._attachments).forEach(function(t){i=i||we(t),e._attachments[t].content_type||S("warn","Attachment",t,"on document",e._id,"is missing content_type")})}),i)return r(j(ki,i));"new_edits"in t||(t.new_edits=!("new_edits"in e)||e.new_edits);var o=this;t.new_edits||I(o)||e.docs.sort(ge),ye(e.docs);var a=e.docs.map(function(e){return e._id});return this._bulkDocs(e,t,function(e,n){if(e)return r(e);if(t.new_edits||(n=n.filter(function(e){return e.error})),!I(o))for(var i=0,s=n.length;i<s;i++)n[i].id=n[i].id||a[i];r(null,n)})}),ke.prototype.registerDependentDatabase=p("registerDependentDatabase",function(e,t){var r=new this.constructor(e,this.__opts);W(this,"_local/_pouch_dependentDbs",function(t){return t.dependentDbs=t.dependentDbs||{},!t.dependentDbs[e]&&(t.dependentDbs[e]=!0,t)}).then(function(){t(null,{db:r})}).catch(t)}),ke.prototype.destroy=p("destroy",function(e,t){function r(){n._destroy(e,function(e,r){if(e)return t(e);n._destroyed=!0,n.emit("destroyed"),t(null,r||{ok:!0})})}"function"==typeof e&&(t=e,e={});var n=this,i=!("use_prefix"in n)||n.use_prefix;if(I(n))return r();n.get("_local/_pouch_dependentDbs",function(e,o){if(e)return 404!==e.status?t(e):r();var a=o.dependentDbs,s=n.constructor,u=Object.keys(a).map(function(e){var t=i?e.replace(new RegExp("^"+s.prefix),""):e;return new s(t,n.__opts).destroy()});ii.all(u).then(r,t)})}),Ee.prototype.execute=function(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()},Ee.prototype.fail=function(e){this.failed=e,this.execute()},Ee.prototype.ready=function(e){this.isReady=!0,this.db=e,this.execute()},Ee.prototype.addTask=function(e){this.queue.push(e),this.failed&&this.execute()},Yn(De,ke),De.adapters={},De.preferredAdapters=[],De.prefix="_pouch_";var Bi=new Qn.EventEmitter;!function(e){Object.keys(Qn.EventEmitter.prototype).forEach(function(t){"function"==typeof Qn.EventEmitter.prototype[t]&&(e[t]=Bi[t].bind(Bi))});var t=e._destructionListeners=new ui;e.on("ref",function(e){t.has(e.name)||t.set(e.name,[]),t.get(e.name).push(e)}),e.on("unref",function(e){if(t.has(e.name)){var r=t.get(e.name),n=r.indexOf(e);n<0||(r.splice(n,1),r.length>1?t.set(e.name,r):t.delete(e.name))}}),e.on("destroyed",function(e){if(t.has(e)){var r=t.get(e);t.delete(e),r.forEach(function(e){e.emit("destroyed",!0)})}})}(De),De.adapter=function(e,t,r){t.valid()&&(De.adapters[e]=t,r&&De.preferredAdapters.push(e))},De.plugin=function(e){if("function"==typeof e)e(De);else{if("object"!=typeof e||0===Object.keys(e).length)throw new Error('Invalid plugin: got "'+e+'", expected an object or a function');Object.keys(e).forEach(function(t){De.prototype[t]=e[t]})}return this.__defaults&&(De.__defaults=pi({},this.__defaults)),De},De.defaults=function(e){function t(e,r){if(!(this instanceof t))return new t(e,r);r=r||{},e&&"object"==typeof e&&(e=(r=e).name,delete r.name),r=pi({},t.__defaults,r),De.call(this,e,r)}return Yn(t,De),t.preferredAdapters=De.preferredAdapters.slice(),Object.keys(De).forEach(function(e){e in t||(t[e]=De[e])}),t.__defaults=pi({},this.__defaults,e),t};var Pi=["$or","$nor","$not"],Ii=-324,Li=3,Ni="",Mi={$elemMatch:function(e,t,r,n){return!!Array.isArray(n)&&(0!==n.length&&("object"==typeof n[0]?n.some(function(e){return rt(e,t,Object.keys(t))}):n.some(function(n){return nt(t,e,r,n)})))},$allMatch:function(e,t,r,n){return!!Array.isArray(n)&&(0!==n.length&&("object"==typeof n[0]?n.every(function(e){return rt(e,t,Object.keys(t))}):n.every(function(n){return nt(t,e,r,n)})))},$eq:function(e,t,r,n){return st(n)&&0===We(n,t)},$gte:function(e,t,r,n){return st(n)&&We(n,t)>=0},$gt:function(e,t,r,n){return st(n)&&We(n,t)>0},$lte:function(e,t,r,n){return st(n)&&We(n,t)<=0},$lt:function(e,t,r,n){return st(n)&&We(n,t)<0},$exists:function(e,t,r,n){return t?st(n):!st(n)},$mod:function(e,t,r,n){return at(n)&&ut(n,t)},$ne:function(e,t,r,n){return t.every(function(e){return 0!==We(n,e)})},$in:function(e,t,r,n){return at(n)&&ct(n,t)},$nin:function(e,t,r,n){return at(n)&&!ct(n,t)},$size:function(e,t,r,n){return at(n)&&ft(n,t)},$all:function(e,t,r,n){return Array.isArray(n)&&lt(n,t)},$regex:function(e,t,r,n){return at(n)&&pt(n,t)},$type:function(e,t,r,n){return ht(n,t)}};De.plugin(function(e){e.debug=ti;var t={};e.on("debug",function(e){var r=e[0],n=e.slice(1);t[r]||(t[r]=ti("pouchdb:"+r)),t[r].apply(null,n)})}),De.plugin(function(e){e._changesFilterPlugin={validate:yt,normalize:gt,shouldFilter:bt,filter:_t}}),De.version="6.3.2";var qi,$i=xt(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),Wi=xt(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]),Ui=function(e){return atob(e)},Gi=function(e){return btoa(e)},zi=r.setImmediate||r.setTimeout,Vi=32768,Ji=5,Hi="document-store",Xi="by-sequence",Ki="attach-store",Qi="attach-seq-store",Yi="meta-store",Zi="local-store",eo="detect-blob-support",to=new E,ro=!1,no=[],io=new ui,oo=new ui;vr.valid=function(){return!("undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform))&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var ao=7,so=Er("document-store"),uo=Er("by-sequence"),co=Er("attach-store"),lo=Er("local-store"),fo=Er("metadata-store"),po=Er("attach-seq-store"),ho=new ui,mo=new E,vo=1,yo="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+uo+" (seq, deleted)",go="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+uo+" (doc_id, rev)",bo="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+so+" (winningseq)",_o="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+po+" (seq)",xo="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+po+" (digest, seq)",wo=uo+".seq = "+so+".winningseq",ko=uo+".seq AS seq, "+uo+".deleted AS deleted, "+uo+".json AS data, "+uo+".rev AS rev, "+so+".json AS metadata";Ur.valid=function(){return"function"==typeof openDatabase&&$r()},Ur.use_prefix=!0;var Eo=function(){try{return new XMLHttpRequest,!0}catch(e){return!1}}(),So=function(){},Ao=25,Do=50,Co=5e3,Fo=1e4,jo={};sn.valid=function(){return!0};Yn(un,Error),Yn(cn,Error),Yn(ln,Error);var To=S.bind(null,"log"),Oo=Array.isArray,Ro=JSON.parse;_n.prototype.add=function(e){return this.promise=this.promise.catch(function(){}).then(function(){return e()}),this.promise},_n.prototype.finish=function(){return this.promise};var Bo={},Po=new _n,Io=50,Lo={_sum:function(e,t){return gn(t)},_count:function(e,t){return t.length},_stats:function(e,t){return{sum:gn(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:function(e){for(var t=0,r=0,n=e.length;r<n;r++){var i=e[r];t+=i*i}return t}(t)}}},No=function(e,t,r,n){function i(e,t,r){try{t(r)}catch(t){An(e,t)}}function o(e,t,r,n,i){try{return{output:t(r,n,i)}}catch(t){return An(e,t),{error:t}}}function a(e,t){var r=We(e.key,t.key);return 0!==r?r:We(e.value,t.value)}function s(e,t,r){return r=r||0,"number"==typeof t?e.slice(r,t+r):r>0?e.slice(r):e}function u(e){var t=e.value;return t&&"object"==typeof t&&t._id||e.id}function c(e){e.rows.forEach(function(e){var t=e.doc&&e.doc._attachments;t&&Object.keys(t).forEach(function(e){var r=t[e];t[e].data=Ct(r.data,r.content_type)})})}function l(e){return function(t){return e.include_docs&&e.attachments&&e.binary&&c(t),t}}function f(e,t,r,n){var i=t[e];void 0!==i&&(n&&(i=encodeURIComponent(JSON.stringify(i))),r.push(e+"="+i))}function p(e){if(void 0!==e){var t=Number(e);return isNaN(t)||t!==parseInt(e,10)?e:t}}function h(e){return e.group_level=p(e.group_level),e.limit=p(e.limit),e.skip=p(e.skip),e}function d(e){if(e){if("number"!=typeof e)return new un('Invalid value for integer: "'+e+'"');if(e<0)return new un('Invalid value for positive integer: "'+e+'"')}}function m(e,t){var r=e.descending?"endkey":"startkey",n=e.descending?"startkey":"endkey";if(void 0!==e[r]&&void 0!==e[n]&&We(e[r],e[n])>0)throw new un("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(t.reduce&&!1!==e.reduce){if(e.include_docs)throw new un("{include_docs:true} is invalid for reduce");if(e.keys&&e.keys.length>1&&!e.group&&!e.group_level)throw new un("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(t){var r=d(e[t]);if(r)throw r})}function v(e,t,r){var n,i=[],o="GET";if(f("reduce",r,i),f("include_docs",r,i),f("attachments",r,i),f("limit",r,i),f("descending",r,i),f("group",r,i),f("group_level",r,i),f("skip",r,i),f("stale",r,i),f("conflicts",r,i),f("startkey",r,i,!0),f("start_key",r,i,!0),f("endkey",r,i,!0),f("end_key",r,i,!0),f("inclusive_end",r,i),f("key",r,i,!0),i=i.join("&"),i=""===i?"":"?"+i,void 0!==r.keys){var a="keys="+encodeURIComponent(JSON.stringify(r.keys));a.length+i.length+1<=2e3?i+=("?"===i[0]?"&":"?")+a:(o="POST","string"==typeof t?n={keys:r.keys}:t.keys=r.keys)}if("string"==typeof t){var s=En(t);return e.request({method:o,url:"_design/"+s[0]+"/_view/"+s[1]+i,body:n}).then(function(e){return e.rows.forEach(function(e){if(e.value&&e.value.error&&"builtin_reduce_error"===e.value.error)throw new Error(e.reason)}),e}).then(l(r))}return n=n||{},Object.keys(t).forEach(function(e){Array.isArray(t[e])?n[e]=t[e]:n[e]=t[e].toString()}),e.request({method:"POST",url:"_temp_view"+i,body:n}).then(l(r))}function y(e,t,r){return new ii(function(n,i){e._query(t,r,function(e,t){if(e)return i(e);n(t)})})}function g(e){return new ii(function(t,r){e._viewCleanup(function(e,n){if(e)return r(e);t(n)})})}function b(e){return function(t){if(404===t.status)return e;throw t}}function _(e,t,r){function n(e){return e.keys.length?t.db.allDocs({keys:e.keys,include_docs:!0}):ii.resolve({rows:[]})}function i(e,t){for(var r=[],n=new si,i=0,o=t.rows.length;i<o;i++){var a=t.rows[i].doc;if(a&&(r.push(a),n.add(a._id),a._deleted=!u.has(a._id),!a._deleted)){var s=u.get(a._id);"value"in s&&(a.value=s.value)}}var c=vn(u);return c.forEach(function(e){if(!n.has(e)){var t={_id:e},i=u.get(e);"value"in i&&(t.value=i.value),r.push(t)}}),e.keys=mn(c.concat(e.keys)),r.push(e),r}var o="_local/doc_"+e,a={_id:o,keys:[]},s=r.get(e),u=s[0];return(Sn(s[1])?ii.resolve(a):t.db.get(o).catch(b(a))).then(function(e){return n(e).then(function(t){return i(e,t)})})}function x(e,t,r){return e.db.get("_local/lastSeq").catch(b({_id:"_local/lastSeq",seq:0})).then(function(n){var i=vn(t);return ii.all(i.map(function(r){return _(r,e,t)})).then(function(t){var i=B(t);return n.seq=r,i.push(n),e.db.bulkDocs({docs:i})})})}function w(e){var t="string"==typeof e?e:e.name,r=Bo[t];return r||(r=Bo[t]=new _n),r}function k(e){return dn(w(e),function(){return E(e)})()}function E(e){function r(t,r){return function(){return x(e,t,r)}}function n(){return e.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:p,limit:Io}).then(o)}function o(e){var t=e.results;if(t.length){var i=s(t);if(h.add(r(i,p)),!(t.length<Io))return n()}}function s(t){for(var r=new ui,n=0,o=t.length;n<o;n++){var s=t[n];if("_"!==s.doc._id[0]){c=[],(l=s.doc)._deleted||i(e.sourceDB,f,l),c.sort(a);var h=u(c);r.set(s.doc._id,[h,s.changes])}p=s.seq}return r}function u(e){for(var t,r=new ui,n=0,i=e.length;n<i;n++){var o=e[n],a=[o.key,o.id];n>0&&0===We(o.key,t)&&a.push(n),r.set(ze(a),o),t=o.key}return r}var c,l,f=t(e.mapFun,function(e,t){var r={id:l._id,key:Ue(e)};void 0!==t&&null!==t&&(r.value=Ue(t)),c.push(r)}),p=e.seq||0,h=new _n;return n().then(function(){return h.finish()}).then(function(){e.seq=p})}function S(e,t,n){0===n.group_level&&delete n.group_level;var i=n.group||n.group_level,a=r(e.reduceFun),u=[],c=isNaN(n.group_level)?Number.POSITIVE_INFINITY:n.group_level;t.forEach(function(e){var t=u[u.length-1],r=i?e.key:null;if(i&&Array.isArray(r)&&(r=r.slice(0,c)),t&&0===We(t.groupKey,r))return t.keys.push([e.key,e.id]),void t.values.push(e.value);u.push({keys:[[e.key,e.id]],values:[e.value],groupKey:r})}),t=[];for(var l=0,f=u.length;l<f;l++){var p=u[l],h=o(e.sourceDB,a,p.keys,p.values,!1);if(h.error&&h.error instanceof ln)throw h.error;t.push({value:h.error?null:h.output,key:p.groupKey})}return{rows:s(t,n.limit,n.skip)}}function A(e,t){return dn(w(e),function(){return D(e,t)})()}function D(e,t){function r(t){return t.include_docs=!0,e.db.allDocs(t).then(function(e){return i=e.total_rows,e.rows.map(function(e){if("value"in e.doc&&"object"==typeof e.doc.value&&null!==e.doc.value){var t=Object.keys(e.doc.value).sort(),r=["id","key","value"];if(!(t<r||t>r))return e.doc.value}var n=He(e.doc._id);return{key:n[0],id:n[1],value:"value"in e.doc?e.doc.value:null}})})}function n(r){var n;if(n=o?S(e,r,t):{total_rows:i,offset:a,rows:r},t.include_docs){var s=mn(r.map(u));return e.sourceDB.allDocs({keys:s,include_docs:!0,conflicts:t.conflicts,attachments:t.attachments,binary:t.binary}).then(function(e){var t=new ui;return e.rows.forEach(function(e){t.set(e.id,e.doc)}),r.forEach(function(e){var r=u(e),n=t.get(r);n&&(e.doc=n)}),n})}return n}var i,o=e.reduceFun&&!1!==t.reduce,a=t.skip||0;if(void 0===t.keys||t.keys.length||(t.limit=0,delete t.keys),void 0!==t.keys){var s=t.keys.map(function(e){return r({startkey:ze([e]),endkey:ze([e,{}])})});return ii.all(s).then(B).then(n)}var c,l,f={descending:t.descending};if("start_key"in t&&(c=t.start_key),"startkey"in t&&(c=t.startkey),"end_key"in t&&(l=t.end_key),"endkey"in t&&(l=t.endkey),void 0!==c&&(f.startkey=ze(t.descending?[c,{}]:[c])),void 0!==l){var p=!1!==t.inclusive_end;t.descending&&(p=!p),f.endkey=ze(p?[l,{}]:[l])}if(void 0!==t.key){var h=ze([t.key]),d=ze([t.key,{}]);f.descending?(f.endkey=h,f.startkey=d):(f.startkey=h,f.endkey=d)}return o||("number"==typeof t.limit&&(f.limit=t.limit),f.skip=a),r(f).then(n)}function C(e){return e.request({method:"POST",url:"_view_cleanup"})}function F(t){return t.get("_local/"+e).then(function(e){var r=new ui;Object.keys(e.views).forEach(function(e){var t=En(e),n="_design/"+t[0],i=t[1],o=r.get(n);o||(o=new si,r.set(n,o)),o.add(i)});var n={keys:vn(r),include_docs:!0};return t.allDocs(n).then(function(n){var i={};n.rows.forEach(function(t){var n=t.key.substring(8);r.get(t.key).forEach(function(r){var o=n+"/"+r;e.views[o]||(o=r);var a=Object.keys(e.views[o]),s=t.doc&&t.doc.views&&t.doc.views[r];a.forEach(function(e){i[e]=i[e]||s})})});var o=Object.keys(i).filter(function(e){return!i[e]}).map(function(e){return dn(w(e),function(){return new t.constructor(e,t.__opts).destroy()})()});return ii.all(o).then(function(){return{ok:!0}})})},b({ok:!0}))}function j(t,r,i){if("function"==typeof t._query)return y(t,r,i);if(I(t))return v(t,r,i);if("string"!=typeof r)return m(i,r),Po.add(function(){return kn(t,"temp_view/temp_view",r.map,r.reduce,!0,e).then(function(e){return hn(k(e).then(function(){return A(e,i)}),function(){return e.db.destroy()})})}),Po.finish();var o=r,a=En(o),s=a[0],u=a[1];return t.get("_design/"+s).then(function(r){var a=r.views&&r.views[u];if(!a)throw new cn("ddoc "+r._id+" has no view named "+u);return n(r,u),m(i,a),kn(t,o,a.map,a.reduce,!1,e).then(function(e){return"ok"===i.stale||"update_after"===i.stale?("update_after"===i.stale&&Zn(function(){k(e)}),A(e,i)):k(e).then(function(){return A(e,i)})})})}return{query:function(e,t,r){var n=this;"function"==typeof t&&(r=t,t={}),t=t?h(t):{},"function"==typeof e&&(e={map:e});var i=ii.resolve().then(function(){return j(n,e,t)});return fn(i,r),i},viewCleanup:pn(function(){var e=this;return"function"==typeof e._viewCleanup?g(e):I(e)?C(e):F(e)})}}("mrviews",function(e,t){if("function"==typeof e&&2===e.length){var r=e;return function(e){return r(e,t)}}return bn(e.toString(),t)},function(e){var t=e.toString(),r=Dn(t);return r||bn(t)},function(e,t){var r=e.views&&e.views[t];if("string"!=typeof r.map)throw new cn("ddoc "+e._id+" has no string view named "+t+", instead found object of type: "+typeof r.map)}),Mo={query:function(e,t,r){return No.query.call(this,e,t,r)},viewCleanup:function(e){return No.viewCleanup.call(this,e)}},qo=1,$o="pouchdb",Wo=5,Uo=0;Pn.prototype.writeCheckpoint=function(e,t){var r=this;return this.updateTarget(e,t).then(function(){return r.updateSource(e,t)})},Pn.prototype.updateTarget=function(e,t){return this.opts.writeTargetCheckpoint?Bn(this.target,this.id,e,t,this.returnValue):ii.resolve(!0)},Pn.prototype.updateSource=function(e,t){if(this.opts.writeSourceCheckpoint){var r=this;return this.readOnlySource?ii.resolve(!0):Bn(this.src,this.id,e,t,this.returnValue).catch(function(e){if(Mn(e))return r.readOnlySource=!0,!0;throw e})}return ii.resolve(!0)};var Go={undefined:function(e,t){return 0===We(e.last_seq,t.last_seq)?t.last_seq:0},1:function(e,t){return In(t,e).last_seq}};Pn.prototype.getCheckpoint=function(){var e=this;return e.target.get(e.id).then(function(t){return e.readOnlySource?ii.resolve(t.last_seq):e.src.get(e.id).then(function(e){if(t.version!==e.version)return Uo;var r;return(r=t.version?t.version.toString():"undefined")in Go?Go[r](t,e):Uo},function(r){if(404===r.status&&t.last_seq)return e.src.put({_id:e.id,last_seq:Uo}).then(function(){return Uo},function(r){return Mn(r)?(e.readOnlySource=!0,t.last_seq):Uo});throw r})}).catch(function(e){if(404!==e.status)throw e;return Uo})};var zo=0;Yn(Gn,Qn.EventEmitter),Gn.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},Gn.prototype.ready=function(e,t){function r(){n.cancel()}var n=this;n._readyCalled||(n._readyCalled=!0,e.once("destroyed",r),t.once("destroyed",r),n.once("complete",function(){e.removeListener("destroyed",r),t.removeListener("destroyed",r)}))},Yn(Hn,Qn.EventEmitter),Hn.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},De.plugin(function(e){e.adapter("idb",vr,!0)}).plugin(function(e){e.adapter("websql",Ur,!0)}).plugin(function(e){e.adapter("http",sn,!1),e.adapter("https",sn,!1)}).plugin(Mo).plugin(function(e){e.replicate=Vn,e.sync=Jn,Object.defineProperty(e.prototype,"replicate",{get:function(){var e=this;return{from:function(t,r,n){return e.constructor.replicate(t,e,r,n)},to:function(t,r,n){return e.constructor.replicate(e,t,r,n)}}}}),e.prototype.sync=function(e,t,r){return this.constructor.sync(this,e,t,r)}}),t.exports=De}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,13:13,14:14,2:2,4:4,5:5,6:6,7:7}]},{},[15])(15)}),t.exports}(),pouchdbAdapterMem=function(){var e={},t={exports:e};return function(r){if("object"==typeof e&&void 0!==t)t.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pouchdbAdapterMemory=r()}}(function(){return function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){var r=t[a][1][e];return i(r||e)},l,l.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,r){"use strict";t.exports=function(e){return function(){var t=arguments.length;if(t){for(var r=[],n=-1;++n<t;)r[n]=arguments[n];return e.call(this,r)}return e.call(this,[])}}},{}],2:[function(e,t,r){"use strict";function n(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function i(e){return a[e>>18&63]+a[e>>12&63]+a[e>>6&63]+a[63&e]}function o(e,t,r){for(var n,o=[],a=t;a<r;a+=3)n=(e[a]<<16)+(e[a+1]<<8)+e[a+2],o.push(i(n));return o.join("")}r.byteLength=function(e){return 3*e.length/4-n(e)},r.toByteArray=function(e){var t,r,i,o,a,c=e.length;o=n(e),a=new u(3*c/4-o),r=o>0?c-4:c;var l=0;for(t=0;t<r;t+=4)i=s[e.charCodeAt(t)]<<18|s[e.charCodeAt(t+1)]<<12|s[e.charCodeAt(t+2)]<<6|s[e.charCodeAt(t+3)],a[l++]=i>>16&255,a[l++]=i>>8&255,a[l++]=255&i;return 2===o?(i=s[e.charCodeAt(t)]<<2|s[e.charCodeAt(t+1)]>>4,a[l++]=255&i):1===o&&(i=s[e.charCodeAt(t)]<<10|s[e.charCodeAt(t+1)]<<4|s[e.charCodeAt(t+2)]>>2,a[l++]=i>>8&255,a[l++]=255&i),a},r.fromByteArray=function(e){for(var t,r=e.length,n=r%3,i="",s=[],u=0,c=r-n;u<c;u+=16383)s.push(o(e,u,u+16383>c?c:u+16383));return 1===n?(t=e[r-1],i+=a[t>>2],i+=a[t<<4&63],i+="=="):2===n&&(t=(e[r-2]<<8)+e[r-1],i+=a[t>>10],i+=a[t>>4&63],i+=a[t<<2&63],i+="="),s.push(i),s.join("")};for(var a=[],s=[],u="undefined"!=typeof Uint8Array?Uint8Array:Array,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=0,f=c.length;l<f;++l)a[l]=c[l],s[c.charCodeAt(l)]=l;s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63},{}],3:[function(e,t,r){},{}],4:[function(e,t,r){(function(r){function n(e,t,n){t>>>=0;var i=e.byteLength-t;if(i<0)throw new RangeError("'offset' is out of bounds");if(void 0===n)n=i;else if((n>>>=0)>i)throw new RangeError("'length' is out of bounds");return a?r.from(e.slice(t,t+n)):new r(new Uint8Array(e.slice(t,t+n)))}function i(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!r.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');return a?r.from(e,t):new r(e,t)}var o=e("is-array-buffer-x"),a="function"==typeof r.alloc&&"function"==typeof r.allocUnsafe&&"function"==typeof r.from;t.exports=function(e,t,s){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return o(e)?n(e,t,s):"string"==typeof e?i(e,t):a?r.from(e):new r(e)}}).call(this,e("buffer").Buffer)},{buffer:5,"is-array-buffer-x":25}],5:[function(e,t,r){"use strict";function n(e){if(e>H)throw new RangeError("Invalid typed array length");var t=new Uint8Array(e);return t.__proto__=i.prototype,t}function i(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return u(e)}return o(e,t,r)}function o(e,t,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return e instanceof ArrayBuffer?f(e,t,r):"string"==typeof e?c(e,t):p(e)}function a(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function s(e,t,r){return a(e),e<=0?n(e):void 0!==t?"string"==typeof r?n(e).fill(t,r):n(e).fill(t):n(e)}function u(e){return a(e),n(e<0?0:0|h(e))}function c(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!i.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');var r=0|d(e,t),o=n(r),a=o.write(e,t);return a!==r&&(o=o.slice(0,a)),o}function l(e){for(var t=e.length<0?0:0|h(e.length),r=n(t),i=0;i<t;i+=1)r[i]=255&e[i];return r}function f(e,t,r){if(t<0||e.byteLength<t)throw new RangeError("'offset' is out of bounds");if(e.byteLength<t+(r||0))throw new RangeError("'length' is out of bounds");var n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),n.__proto__=i.prototype,n}function p(e){if(i.isBuffer(e)){var t=0|h(e.length),r=n(t);return 0===r.length?r:(e.copy(r,0,0,t),r)}if(e){if(G(e)||"length"in e)return"number"!=typeof e.length||z(e.length)?n(0):l(e);if("Buffer"===e.type&&Array.isArray(e.data))return l(e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function h(e){if(e>=H)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+H.toString(16)+" bytes");return 0|e}function d(e,t){if(i.isBuffer(e))return e.length;if(G(e)||e instanceof ArrayBuffer)return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return M(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return W(e).length;default:if(n)return M(e).length;t=(""+t).toLowerCase(),n=!0}}function m(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if(r>>>=0,t>>>=0,r<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return j(this,t,r);case"utf8":case"utf-8":return A(this,t,r);case"ascii":return C(this,t,r);case"latin1":case"binary":return F(this,t,r);case"base64":return S(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function v(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function y(e,t,r,n,o){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,z(r)&&(r=o?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(o)return-1;r=e.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof t&&(t=i.from(t,n)),i.isBuffer(t))return 0===t.length?-1:g(e,t,r,n,o);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):g(e,[t],r,n,o);throw new TypeError("val must be string, number or Buffer")}function g(e,t,r,n,i){function o(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}var a=1,s=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a=2,s/=2,u/=2,r/=2}var c;if(i){var l=-1;for(c=r;c<s;c++)if(o(e,c)===o(t,-1===l?0:c-l)){if(-1===l&&(l=c),c-l+1===u)return l*a}else-1!==l&&(c-=c-l),l=-1}else for(r+u>s&&(r=s-u),c=r;c>=0;c--){for(var f=!0,p=0;p<u;p++)if(o(e,c+p)!==o(t,p)){f=!1;break}if(f)return c}return-1}function b(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(t.substr(2*a,2),16);if(z(s))return a;e[r+a]=s}return a}function _(e,t,r,n){return U(M(t,e.length-r),e,r,n)}function x(e,t,r,n){return U(q(t),e,r,n)}function w(e,t,r,n){return x(e,t,r,n)}function k(e,t,r,n){return U(W(t),e,r,n)}function E(e,t,r,n){return U($(t,e.length-r),e,r,n)}function S(e,t,r){return 0===t&&r===e.length?V.fromByteArray(e):V.fromByteArray(e.slice(t,r))}function A(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o=e[i],a=null,s=o>239?4:o>223?3:o>191?2:1;if(i+s<=r){var u,c,l,f;switch(s){case 1:o<128&&(a=o);break;case 2:128==(192&(u=e[i+1]))&&(f=(31&o)<<6|63&u)>127&&(a=f);break;case 3:u=e[i+1],c=e[i+2],128==(192&u)&&128==(192&c)&&(f=(15&o)<<12|(63&u)<<6|63&c)>2047&&(f<55296||f>57343)&&(a=f);break;case 4:u=e[i+1],c=e[i+2],l=e[i+3],128==(192&u)&&128==(192&c)&&128==(192&l)&&(f=(15&o)<<18|(63&u)<<12|(63&c)<<6|63&l)>65535&&f<1114112&&(a=f)}}null===a?(a=65533,s=1):a>65535&&(a-=65536,n.push(a>>>10&1023|55296),a=56320|1023&a),n.push(a),i+=s}return D(n)}function D(e){var t=e.length;if(t<=X)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=X));return r}function C(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function F(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function j(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=N(e[o]);return i}function T(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function O(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,r,n,o,a){if(!i.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function B(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function P(e,t,r,n,i){return t=+t,r>>>=0,i||B(e,t,r,4,3.4028234663852886e38,-3.4028234663852886e38),J.write(e,t,r,n,23,4),r+4}function I(e,t,r,n,i){return t=+t,r>>>=0,i||B(e,t,r,8,1.7976931348623157e308,-1.7976931348623157e308),J.write(e,t,r,n,52,8),r+8}function L(e){if((e=e.trim().replace(K,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function N(e){return e<16?"0"+e.toString(16):e.toString(16)}function M(e,t){t=t||1/0;for(var r,n=e.length,i=null,o=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function q(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function $(e,t){for(var r,n,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=(r=e.charCodeAt(a))>>8,i=r%256,o.push(i),o.push(n);return o}function W(e){return V.toByteArray(L(e))}function U(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function G(e){return"function"==typeof ArrayBuffer.isView&&ArrayBuffer.isView(e)}function z(e){return e!==e}var V=e("base64-js"),J=e("ieee754");r.Buffer=i,r.SlowBuffer=function(e){return+e!=e&&(e=0),i.alloc(+e)},r.INSPECT_MAX_BYTES=50;var H=2147483647;r.kMaxLength=H,i.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),i.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),"undefined"!=typeof Symbol&&Symbol.species&&i[Symbol.species]===i&&Object.defineProperty(i,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),i.poolSize=8192,i.from=function(e,t,r){return o(e,t,r)},i.prototype.__proto__=Uint8Array.prototype,i.__proto__=Uint8Array,i.alloc=function(e,t,r){return s(e,t,r)},i.allocUnsafe=function(e){return u(e)},i.allocUnsafeSlow=function(e){return u(e)},i.isBuffer=function(e){return null!=e&&!0===e._isBuffer},i.compare=function(e,t){if(!i.isBuffer(e)||!i.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,o=0,a=Math.min(r,n);o<a;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return r<n?-1:n<r?1:0},i.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return i.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=i.allocUnsafe(t),o=0;for(r=0;r<e.length;++r){var a=e[r];if(!i.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,o),o+=a.length}return n},i.byteLength=d,i.prototype._isBuffer=!0,i.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},i.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},i.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},i.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?A(this,0,e):m.apply(this,arguments)},i.prototype.equals=function(e){if(!i.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===i.compare(this,e)},i.prototype.inspect=function(){var e="",t=r.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},i.prototype.compare=function(e,t,r,n,o){if(!i.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),t<0||r>e.length||n<0||o>this.length)throw new RangeError("out of range index");if(n>=o&&t>=r)return 0;if(n>=o)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,o>>>=0,this===e)return 0;for(var a=o-n,s=r-t,u=Math.min(a,s),c=this.slice(n,o),l=e.slice(t,r),f=0;f<u;++f)if(c[f]!==l[f]){a=c[f],s=l[f];break}return a<s?-1:s<a?1:0},i.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},i.prototype.indexOf=function(e,t,r){return y(this,e,t,r,!0)},i.prototype.lastIndexOf=function(e,t,r){return y(this,e,t,r,!1)},i.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return b(this,e,t,r);case"utf8":case"utf-8":return _(this,e,t,r);case"ascii":return x(this,e,t,r);case"latin1":case"binary":return w(this,e,t,r);case"base64":return k(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var X=4096;i.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return n.__proto__=i.prototype,n},i.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},i.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},i.prototype.readUInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),this[e]},i.prototype.readUInt16LE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]|this[e+1]<<8},i.prototype.readUInt16BE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]<<8|this[e+1]},i.prototype.readUInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},i.prototype.readUInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},i.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*t)),n},i.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o},i.prototype.readInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},i.prototype.readInt16LE=function(e,t){e>>>=0,t||O(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},i.prototype.readInt16BE=function(e,t){e>>>=0,t||O(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},i.prototype.readInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},i.prototype.readInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},i.prototype.readFloatLE=function(e,t){return e>>>=0,t||O(e,4,this.length),J.read(this,e,!0,23,4)},i.prototype.readFloatBE=function(e,t){return e>>>=0,t||O(e,4,this.length),J.read(this,e,!1,23,4)},i.prototype.readDoubleLE=function(e,t){return e>>>=0,t||O(e,8,this.length),J.read(this,e,!0,52,8)},i.prototype.readDoubleBE=function(e,t){return e>>>=0,t||O(e,8,this.length),J.read(this,e,!1,52,8)},i.prototype.writeUIntLE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||R(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},i.prototype.writeUIntBE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||R(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},i.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,1,255,0),this[t]=255&e,t+1},i.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},i.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},i.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},i.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},i.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);R(this,e,t,r,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<r&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},i.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);R(this,e,t,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},i.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},i.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},i.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},i.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},i.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},i.prototype.writeFloatLE=function(e,t,r){return P(this,e,t,!0,r)},i.prototype.writeFloatBE=function(e,t,r){return P(this,e,t,!1,r)},i.prototype.writeDoubleLE=function(e,t,r){return I(this,e,t,!0,r)},i.prototype.writeDoubleBE=function(e,t,r){return I(this,e,t,!1,r)},i.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,o=n-r;if(this===e&&r<t&&t<n)for(i=o-1;i>=0;--i)e[i+t]=this[i+r];else if(o<1e3)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},i.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!i.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0);var a;if("number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var s=i.isBuffer(e)?e:new i(e,n),u=s.length;for(a=0;a<r-t;++a)this[a+t]=s[a%u]}return this};var K=/[^+/0-9A-Za-z-_]/g},{"base64-js":2,ieee754:22}],6:[function(e,t,r){(function(e){function t(e){return Object.prototype.toString.call(e)}r.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===t(e)},r.isBoolean=function(e){return"boolean"==typeof e},r.isNull=function(e){return null===e},r.isNullOrUndefined=function(e){return null==e},r.isNumber=function(e){return"number"==typeof e},r.isString=function(e){return"string"==typeof e},r.isSymbol=function(e){return"symbol"==typeof e},r.isUndefined=function(e){return void 0===e},r.isRegExp=function(e){return"[object RegExp]"===t(e)},r.isObject=function(e){return"object"==typeof e&&null!==e},r.isDate=function(e){return"[object Date]"===t(e)},r.isError=function(e){return"[object Error]"===t(e)||e instanceof Error},r.isFunction=function(e){return"function"==typeof e},r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},r.isBuffer=e.isBuffer}).call(this,{isBuffer:e("../../is-buffer/index.js")})},{"../../is-buffer/index.js":26}],7:[function(e,t,r){function n(e){o.call(this,e),this._options=e,this._iterator=null,this._operations=[]}var i=e("util"),o=e("abstract-leveldown").AbstractIterator;i.inherits(n,o),n.prototype.setDb=function(e){var t=this._iterator=e.iterator(this._options);this._operations.forEach(function(e){t[e.method].apply(t,e.args)})},n.prototype._operation=function(e,t){if(this._iterator)return this._iterator[e].apply(this._iterator,t);this._operations.push({method:e,args:t})},"next end".split(" ").forEach(function(e){n.prototype["_"+e]=function(){this._operation(e,arguments)}}),t.exports=n},{"abstract-leveldown":12,util:114}],8:[function(e,t,r){(function(r,n){function i(e){a.call(this,"string"==typeof e?e:""),this._db=void 0,this._operations=[],this._iterators=[]}var o=e("util"),a=e("abstract-leveldown").AbstractLevelDOWN,s=e("./deferred-iterator");o.inherits(i,a),i.prototype.setDb=function(e){this._db=e,this._operations.forEach(function(t){e[t.method].apply(e,t.args)}),this._iterators.forEach(function(t){t.setDb(e)})},i.prototype._open=function(e,t){return n.nextTick(t)},i.prototype._operation=function(e,t){if(this._db)return this._db[e].apply(this._db,t);this._operations.push({method:e,args:t})},"put get del batch approximateSize".split(" ").forEach(function(e){i.prototype["_"+e]=function(){this._operation(e,arguments)}}),i.prototype._isBuffer=function(e){return r.isBuffer(e)},i.prototype._iterator=function(e){if(this._db)return this._db.iterator.apply(this._db,arguments);var t=new s(e);return this._iterators.push(t),t},t.exports=i,t.exports.DeferredIterator=s}).call(this,{isBuffer:e("../is-buffer/index.js")},e("_process"))},{"../is-buffer/index.js":26,"./deferred-iterator":7,_process:70,"abstract-leveldown":12,util:114}],9:[function(e,t,r){(function(e){function r(e){this._db=e,this._operations=[],this._written=!1}r.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},r.prototype.put=function(e,t){this._checkWritten();var r=this._db._checkKey(e,"key",this._db._isBuffer);if(r)throw r;return this._db._isBuffer(e)||(e=String(e)),this._db._isBuffer(t)||(t=String(t)),"function"==typeof this._put?this._put(e,t):this._operations.push({type:"put",key:e,value:t}),this},r.prototype.del=function(e){this._checkWritten();var t=this._db._checkKey(e,"key",this._db._isBuffer);if(t)throw t;return this._db._isBuffer(e)||(e=String(e)),"function"==typeof this._del?this._del(e):this._operations.push({type:"del",key:e}),this},r.prototype.clear=function(){return this._checkWritten(),this._operations=[],"function"==typeof this._clear&&this._clear(),this},r.prototype.write=function(t,r){if(this._checkWritten(),"function"==typeof t&&(r=t),"function"!=typeof r)throw new Error("write() requires a callback argument");return"object"!=typeof t&&(t={}),this._written=!0,"function"==typeof this._write?this._write(r):"function"==typeof this._db._batch?this._db._batch(this._operations,t,r):void e.nextTick(r)},t.exports=r}).call(this,e("_process"))},{_process:70}],10:[function(e,t,r){(function(e){function r(e){this.db=e,this._ended=!1,this._nexting=!1}r.prototype.next=function(t){var r=this;if("function"!=typeof t)throw new Error("next() requires a callback argument");return r._ended?t(new Error("cannot call next() after end()")):r._nexting?t(new Error("cannot call next() before previous next() has completed")):(r._nexting=!0,"function"==typeof r._next?r._next(function(){r._nexting=!1,t.apply(null,arguments)}):void e.nextTick(function(){r._nexting=!1,t()}))},r.prototype.end=function(t){if("function"!=typeof t)throw new Error("end() requires a callback argument");return this._ended?t(new Error("end() already called on iterator")):(this._ended=!0,"function"==typeof this._end?this._end(t):void e.nextTick(t))},t.exports=r}).call(this,e("_process"))},{_process:70}],11:[function(e,t,r){(function(r,n){function i(e){if(!arguments.length||void 0===e)throw new Error("constructor requires at least a location argument");if("string"!=typeof e)throw new Error("constructor requires a location string argument");this.location=e,this.status="new"}var o=e("xtend"),a=e("./abstract-iterator"),s=e("./abstract-chained-batch");i.prototype.open=function(e,t){var r=this,i=this.status;if("function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("open() requires a callback argument");"object"!=typeof e&&(e={}),e.createIfMissing=0!=e.createIfMissing,e.errorIfExists=!!e.errorIfExists,"function"==typeof this._open?(this.status="opening",this._open(e,function(e){if(e)return r.status=i,t(e);r.status="open",t()})):(this.status="open",n.nextTick(t))},i.prototype.close=function(e){var t=this,r=this.status;if("function"!=typeof e)throw new Error("close() requires a callback argument");"function"==typeof this._close?(this.status="closing",this._close(function(n){if(n)return t.status=r,e(n);t.status="closed",e()})):(this.status="closed",n.nextTick(e))},i.prototype.get=function(e,t,r){var i;if("function"==typeof t&&(r=t),"function"!=typeof r)throw new Error("get() requires a callback argument");return(i=this._checkKey(e,"key",this._isBuffer))?r(i):(this._isBuffer(e)||(e=String(e)),"object"!=typeof t&&(t={}),t.asBuffer=0!=t.asBuffer,"function"==typeof this._get?this._get(e,t,r):void n.nextTick(function(){r(new Error("NotFound"))}))},i.prototype.put=function(e,t,r,i){var o;if("function"==typeof r&&(i=r),"function"!=typeof i)throw new Error("put() requires a callback argument");return(o=this._checkKey(e,"key",this._isBuffer))?i(o):(this._isBuffer(e)||(e=String(e)),null==t||this._isBuffer(t)||n.browser||(t=String(t)),"object"!=typeof r&&(r={}),"function"==typeof this._put?this._put(e,t,r,i):void n.nextTick(i))},i.prototype.del=function(e,t,r){var i;if("function"==typeof t&&(r=t),"function"!=typeof r)throw new Error("del() requires a callback argument");return(i=this._checkKey(e,"key",this._isBuffer))?r(i):(this._isBuffer(e)||(e=String(e)),"object"!=typeof t&&(t={}),"function"==typeof this._del?this._del(e,t,r):void n.nextTick(r))},i.prototype.batch=function(e,t,r){if(!arguments.length)return this._chainedBatch();if("function"==typeof t&&(r=t),"function"==typeof e&&(r=e),"function"!=typeof r)throw new Error("batch(array) requires a callback argument");if(!Array.isArray(e))return r(new Error("batch(array) requires an array argument"));t&&"object"==typeof t||(t={});for(var i,o,a=0,s=e.length;a<s;a++)if("object"==typeof(i=e[a])){if(o=this._checkKey(i.type,"type",this._isBuffer))return r(o);if(o=this._checkKey(i.key,"key",this._isBuffer))return r(o)}if("function"==typeof this._batch)return this._batch(e,t,r);n.nextTick(r)},i.prototype.approximateSize=function(e,t,r){if(null==e||null==t||"function"==typeof e||"function"==typeof t)throw new Error("approximateSize() requires valid `start`, `end` and `callback` arguments");if("function"!=typeof r)throw new Error("approximateSize() requires a callback argument");if(this._isBuffer(e)||(e=String(e)),this._isBuffer(t)||(t=String(t)),"function"==typeof this._approximateSize)return this._approximateSize(e,t,r);n.nextTick(function(){r(null,0)})},i.prototype._setupIteratorOptions=function(e){var t=this;return e=o(e),["start","end","gt","gte","lt","lte"].forEach(function(r){e[r]&&t._isBuffer(e[r])&&0===e[r].length&&delete e[r]}),e.reverse=!!e.reverse,e.keys=0!=e.keys,e.values=0!=e.values,e.limit="limit"in e?e.limit:-1,e.keyAsBuffer=0!=e.keyAsBuffer,e.valueAsBuffer=0!=e.valueAsBuffer,e},i.prototype.iterator=function(e){return"object"!=typeof e&&(e={}),e=this._setupIteratorOptions(e),"function"==typeof this._iterator?this._iterator(e):new a(this)},i.prototype._chainedBatch=function(){return new s(this)},i.prototype._isBuffer=function(e){return r.isBuffer(e)},i.prototype._checkKey=function(e,t){if(null===e||void 0===e)return new Error(t+" cannot be `null` or `undefined`");if(this._isBuffer(e)){if(0===e.length)return new Error(t+" cannot be an empty Buffer")}else if(""===String(e))return new Error(t+" cannot be an empty String")},t.exports=i}).call(this,{isBuffer:e("../../../is-buffer/index.js")},e("_process"))},{"../../../is-buffer/index.js":26,"./abstract-chained-batch":9,"./abstract-iterator":10,_process:70,xtend:120}],12:[function(e,t,r){r.AbstractLevelDOWN=e("./abstract-leveldown"),r.AbstractIterator=e("./abstract-iterator"),r.AbstractChainedBatch=e("./abstract-chained-batch"),r.isLevelDOWN=e("./is-leveldown")},{"./abstract-chained-batch":9,"./abstract-iterator":10,"./abstract-leveldown":11,"./is-leveldown":13}],13:[function(e,t,r){var n=e("./abstract-leveldown");t.exports=function(e){return!(!e||"object"!=typeof e)&&Object.keys(n.prototype).filter(function(e){return"_"!=e[0]&&"approximateSize"!=e}).every(function(t){return"function"==typeof e[t]})}},{"./abstract-leveldown":11}],14:[function(e,t,r){"use strict";function n(e){if(this._capacity=a(e),this._length=0,this._front=0,s(e)){for(var t=e.length,r=0;r<t;++r)this[r]=e[r];this._length=t}}function i(e,t,r,n,i){for(var o=0;o<i;++o)r[o+n]=e[o+t],e[o+t]=void 0}function o(e){return e>>>=0,e-=1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)+1}function a(e){if("number"!=typeof e){if(!s(e))return 16;e=e.length}return o(Math.min(Math.max(16,e),1073741824))}n.prototype.toArray=function(){for(var e=this._length,t=new Array(e),r=this._front,n=this._capacity,i=0;i<e;++i)t[i]=this[r+i&n-1];return t},n.prototype.push=function(e){var t=arguments.length,r=this._length;if(t>1){var n=this._capacity;if(r+t>n){for(o=0;o<t;++o)this._checkCapacity(r+1),this[i=this._front+r&this._capacity-1]=arguments[o],r++,this._length=r;return r}for(var i=this._front,o=0;o<t;++o)this[i+r&n-1]=arguments[o],i++;return this._length=r+t,r+t}return 0===t?r:(this._checkCapacity(r+1),this[o=this._front+r&this._capacity-1]=e,this._length=r+1,r+1)},n.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,r=this[t];return this[t]=void 0,this._length=e-1,r}},n.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,r=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,r}},n.prototype.unshift=function(e){var t=this._length,r=arguments.length;if(r>1){if(t+r>(a=this._capacity)){for(i=r-1;i>=0;i--){this._checkCapacity(t+1);a=this._capacity;this[o=(this._front-1&a-1^a)-a]=arguments[i],t++,this._length=t,this._front=o}return t}for(var n=this._front,i=r-1;i>=0;i--){var o=(n-1&a-1^a)-a;this[o]=arguments[i],n=o}return this._front=n,this._length=t+r,t+r}if(0===r)return t;this._checkCapacity(t+1);var a=this._capacity;return this[i=(this._front-1&a-1^a)-a]=e,this._length=t+1,this._front=i,t+1},n.prototype.peekBack=function(){var e=this._length;if(0!==e)return this[this._front+e-1&this._capacity-1]},n.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},n.prototype.get=function(e){var t=e;if(t===(0|t)){var r=this._length;if(t<0&&(t+=r),!(t<0||t>=r))return this[this._front+t&this._capacity-1]}},n.prototype.isEmpty=function(){return 0===this._length},n.prototype.clear=function(){for(var e=this._length,t=this._front,r=this._capacity,n=0;n<e;++n)this[t+n&r-1]=void 0;this._length=0,this._front=0},n.prototype.toString=function(){return this.toArray().toString()},n.prototype.valueOf=n.prototype.toString,n.prototype.removeFront=n.prototype.shift,n.prototype.removeBack=n.prototype.pop,n.prototype.insertFront=n.prototype.unshift,n.prototype.insertBack=n.prototype.push,n.prototype.enqueue=n.prototype.push,n.prototype.dequeue=n.prototype.shift,n.prototype.toJSON=n.prototype.toArray,Object.defineProperty(n.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),n.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(a(1.5*this._capacity+16))},n.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var r=this._front,n=this._length;r+n>t&&i(this,0,this,t,r+n&t-1)};var s=Array.isArray;t.exports=n},{}],15:[function(e,t,r){function n(e,t,r){a(this,{type:e,name:e,cause:"string"!=typeof t?t:r,message:t&&"string"!=typeof t?t.message:t},"ewr")}function i(e,t){Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,arguments.callee),n.call(this,"CustomError",e,t)}function o(e,t,r){var o=function(r,i){n.call(this,t,r,i),"FilesystemError"==t&&(this.code=this.cause.code,this.path=this.cause.path,this.errno=this.cause.errno,this.message=(e.errno[this.cause.errno]?e.errno[this.cause.errno].description:this.cause.message)+(this.cause.path?" ["+this.cause.path+"]":"")),Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,arguments.callee)};return o.prototype=r?new r:new i,o}var a=e("prr");i.prototype=new Error,t.exports=function(e){var t=function(t,r){return o(e,t,r)};return{CustomError:i,FilesystemError:t("FilesystemError"),createError:t}}},{prr:17}],16:[function(e,t,r){var n=t.exports.all=[{errno:-2,code:"ENOENT",description:"no such file or directory"},{errno:-1,code:"UNKNOWN",description:"unknown error"},{errno:0,code:"OK",description:"success"},{errno:1,code:"EOF",description:"end of file"},{errno:2,code:"EADDRINFO",description:"getaddrinfo error"},{errno:3,code:"EACCES",description:"permission denied"},{errno:4,code:"EAGAIN",description:"resource temporarily unavailable"},{errno:5,code:"EADDRINUSE",description:"address already in use"},{errno:6,code:"EADDRNOTAVAIL",description:"address not available"},{errno:7,code:"EAFNOSUPPORT",description:"address family not supported"},{errno:8,code:"EALREADY",description:"connection already in progress"},{errno:9,code:"EBADF",description:"bad file descriptor"},{errno:10,code:"EBUSY",description:"resource busy or locked"},{errno:11,code:"ECONNABORTED",description:"software caused connection abort"},{errno:12,code:"ECONNREFUSED",description:"connection refused"},{errno:13,code:"ECONNRESET",description:"connection reset by peer"},{errno:14,code:"EDESTADDRREQ",description:"destination address required"},{errno:15,code:"EFAULT",description:"bad address in system call argument"},{errno:16,code:"EHOSTUNREACH",description:"host is unreachable"},{errno:17,code:"EINTR",description:"interrupted system call"},{errno:18,code:"EINVAL",description:"invalid argument"},{errno:19,code:"EISCONN",description:"socket is already connected"},{errno:20,code:"EMFILE",description:"too many open files"},{errno:21,code:"EMSGSIZE",description:"message too long"},{errno:22,code:"ENETDOWN",description:"network is down"},{errno:23,code:"ENETUNREACH",description:"network is unreachable"},{errno:24,code:"ENFILE",description:"file table overflow"},{errno:25,code:"ENOBUFS",description:"no buffer space available"},{errno:26,code:"ENOMEM",description:"not enough memory"},{errno:27,code:"ENOTDIR",description:"not a directory"},{errno:28,code:"EISDIR",description:"illegal operation on a directory"},{errno:29,code:"ENONET",description:"machine is not on the network"},{errno:31,code:"ENOTCONN",description:"socket is not connected"},{errno:32,code:"ENOTSOCK",description:"socket operation on non-socket"},{errno:33,code:"ENOTSUP",description:"operation not supported on socket"},{errno:34,code:"ENOENT",description:"no such file or directory"},{errno:35,code:"ENOSYS",description:"function not implemented"},{errno:36,code:"EPIPE",description:"broken pipe"},{errno:37,code:"EPROTO",description:"protocol error"},{errno:38,code:"EPROTONOSUPPORT",description:"protocol not supported"},{errno:39,code:"EPROTOTYPE",description:"protocol wrong type for socket"},{errno:40,code:"ETIMEDOUT",description:"connection timed out"},{errno:41,code:"ECHARSET",description:"invalid Unicode character"},{errno:42,code:"EAIFAMNOSUPPORT",description:"address family for hostname not supported"},{errno:44,code:"EAISERVICE",description:"servname not supported for ai_socktype"},{errno:45,code:"EAISOCKTYPE",description:"ai_socktype not supported"},{errno:46,code:"ESHUTDOWN",description:"cannot send after transport endpoint shutdown"},{errno:47,code:"EEXIST",description:"file already exists"},{errno:48,code:"ESRCH",description:"no such process"},{errno:49,code:"ENAMETOOLONG",description:"name too long"},{errno:50,code:"EPERM",description:"operation not permitted"},{errno:51,code:"ELOOP",description:"too many symbolic links encountered"},{errno:52,code:"EXDEV",description:"cross-device link not permitted"},{errno:53,code:"ENOTEMPTY",description:"directory not empty"},{errno:54,code:"ENOSPC",description:"no space left on device"},{errno:55,code:"EIO",description:"i/o error"},{errno:56,code:"EROFS",description:"read-only file system"},{errno:57,code:"ENODEV",description:"no such device"},{errno:58,code:"ESPIPE",description:"invalid seek"},{errno:59,code:"ECANCELED",description:"operation canceled"}];t.exports.errno={},t.exports.code={},n.forEach(function(e){t.exports.errno[e.errno]=e,t.exports.code[e.code]=e}),t.exports.custom=e("./custom")(t.exports),t.exports.create=t.exports.custom.createError},{"./custom":15}],17:[function(e,t,r){!function(e,r,n){void 0!==t&&t.exports?t.exports=n():r.prr=n()}(0,this,function(){var e="function"==typeof Object.defineProperty?function(e,t,r){return Object.defineProperty(e,t,r),e}:function(e,t,r){return e[t]=r.value,e},t=function(e,t){var r="object"==typeof t,n=!r&&"string"==typeof t,i=function(e){return r?!!t[e]:!!n&&t.indexOf(e[0])>-1};return{enumerable:i("enumerable"),configurable:i("configurable"),writable:i("writable"),value:e}};return function(r,n,i,o){var a;if(o=t(i,o),"object"==typeof n){for(a in n)Object.hasOwnProperty.call(n,a)&&(o.value=n[a],e(r,a,o));return r}return e(r,n,o)}})},{}],18:[function(e,t,r){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"number"==typeof e}function a(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,r,n,o,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(r=this._events[e],s(r))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),r.apply(this,o)}else if(a(r))for(o=Array.prototype.slice.call(arguments,1),n=(c=r.slice()).length,u=0;u<n;u++)c[u].apply(this,o);return!0},n.prototype.addListener=function(e,t){var r;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(r=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var n=!1;return r.listener=t,this.on(e,r),this},n.prototype.removeListener=function(e,t){var r,n,o,s;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],o=r.length,n=-1,r===t||i(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(r)){for(s=o;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){n=s;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],i(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],19:[function(e,t,r){"use strict";function n(e,t,r,n,i,o){this._color=e,this.key=t,this.value=r,this.left=n,this.right=i,this._count=o}function i(e){return new n(e._color,e.key,e.value,e.left,e.right,e._count)}function o(e,t){return new n(e,t.key,t.value,t.left,t.right,t._count)}function a(e){e._count=1+(e.left?e.left._count:0)+(e.right?e.right._count:0)}function s(e,t){this._compare=e,this.root=t}function u(e,t){if(t.left&&(r=u(e,t.left)))return r;var r=e(t.key,t.value);return r||(t.right?u(e,t.right):void 0)}function c(e,t,r,n){if(t(e,n.key)<=0){if(n.left&&(i=c(e,t,r,n.left)))return i;var i=r(n.key,n.value);if(i)return i}if(n.right)return c(e,t,r,n.right)}function l(e,t,r,n,i){var o,a=r(e,i.key),s=r(t,i.key);if(a<=0){if(i.left&&(o=l(e,t,r,n,i.left)))return o;if(s>0&&(o=n(i.key,i.value)))return o}if(s>0&&i.right)return l(e,t,r,n,i.right)}function f(e,t){this.tree=e,this._stack=t}function p(e,t){e.key=t.key,e.value=t.value,e.left=t.left,e.right=t.right,e._color=t._color,e._count=t._count}function h(e){for(var t,r,n,s,u=e.length-1;u>=0;--u){if(t=e[u],0===u)return void(t._color=v);if((r=e[u-1]).left===t){if((n=r.right).right&&n.right._color===m)return n=r.right=i(n),s=n.right=i(n.right),r.right=n.left,n.left=r,n.right=s,n._color=r._color,t._color=v,r._color=v,s._color=v,a(r),a(n),u>1&&((c=e[u-2]).left===r?c.left=n:c.right=n),void(e[u-1]=n);if(n.left&&n.left._color===m)return n=r.right=i(n),s=n.left=i(n.left),r.right=s.left,n.left=s.right,s.left=r,s.right=n,s._color=r._color,r._color=v,n._color=v,t._color=v,a(r),a(n),a(s),u>1&&((c=e[u-2]).left===r?c.left=s:c.right=s),void(e[u-1]=s);if(n._color===v){if(r._color===m)return r._color=v,void(r.right=o(m,n));r.right=o(m,n);continue}n=i(n),r.right=n.left,n.left=r,n._color=r._color,r._color=m,a(r),a(n),u>1&&((c=e[u-2]).left===r?c.left=n:c.right=n),e[u-1]=n,e[u]=r,u+1<e.length?e[u+1]=t:e.push(t),u+=2}else{if((n=r.left).left&&n.left._color===m)return n=r.left=i(n),s=n.left=i(n.left),r.left=n.right,n.right=r,n.left=s,n._color=r._color,t._color=v,r._color=v,s._color=v,a(r),a(n),u>1&&((c=e[u-2]).right===r?c.right=n:c.left=n),void(e[u-1]=n);if(n.right&&n.right._color===m)return n=r.left=i(n),s=n.right=i(n.right),r.left=s.right,n.right=s.left,s.right=r,s.left=n,s._color=r._color,r._color=v,n._color=v,t._color=v,a(r),a(n),a(s),u>1&&((c=e[u-2]).right===r?c.right=s:c.left=s),void(e[u-1]=s);if(n._color===v){if(r._color===m)return r._color=v,void(r.left=o(m,n));r.left=o(m,n);continue}if(n=i(n),r.left=n.right,n.right=r,n._color=r._color,r._color=m,a(r),a(n),u>1){var c=e[u-2];c.right===r?c.right=n:c.left=n}e[u-1]=n,e[u]=r,u+1<e.length?e[u+1]=t:e.push(t),u+=2}}}function d(e,t){return e<t?-1:e>t?1:0}t.exports=function(e){return new s(e||d,null)};var m=0,v=1,y=s.prototype;Object.defineProperty(y,"keys",{get:function(){var e=[];return this.forEach(function(t,r){e.push(t)}),e}}),Object.defineProperty(y,"values",{get:function(){var e=[];return this.forEach(function(t,r){e.push(r)}),e}}),Object.defineProperty(y,"length",{get:function(){return this.root?this.root._count:0}}),y.insert=function(e,t){for(var r=this._compare,i=this.root,u=[],c=[];i;){var l=r(e,i.key);u.push(i),c.push(l),i=l<=0?i.left:i.right}u.push(new n(m,e,t,null,null,1));for(f=u.length-2;f>=0;--f){i=u[f];c[f]<=0?u[f]=new n(i._color,i.key,i.value,u[f+1],i.right,i._count+1):u[f]=new n(i._color,i.key,i.value,i.left,u[f+1],i._count+1)}for(var f=u.length-1;f>1;--f){var p=u[f-1],i=u[f];if(p._color===v||i._color===v)break;var h=u[f-2];if(h.left===p)if(p.left===i){if(!(d=h.right)||d._color!==m){h._color=m,h.left=p.right,p._color=v,p.right=h,u[f-2]=p,u[f-1]=i,a(h),a(p),f>=3&&((y=u[f-3]).left===h?y.left=p:y.right=p);break}p._color=v,h.right=o(v,d),h._color=m,f-=1}else{if(!(d=h.right)||d._color!==m){p.right=i.left,h._color=m,h.left=i.right,i._color=v,i.left=p,i.right=h,u[f-2]=i,u[f-1]=p,a(h),a(p),a(i),f>=3&&((y=u[f-3]).left===h?y.left=i:y.right=i);break}p._color=v,h.right=o(v,d),h._color=m,f-=1}else if(p.right===i){if(!(d=h.left)||d._color!==m){h._color=m,h.right=p.left,p._color=v,p.left=h,u[f-2]=p,u[f-1]=i,a(h),a(p),f>=3&&((y=u[f-3]).right===h?y.right=p:y.left=p);break}p._color=v,h.left=o(v,d),h._color=m,f-=1}else{var d=h.left;if(!d||d._color!==m){if(p.left=i.right,h._color=m,h.right=i.left,i._color=v,i.right=p,i.left=h,u[f-2]=i,u[f-1]=p,a(h),a(p),a(i),f>=3){var y=u[f-3];y.right===h?y.right=i:y.left=i}break}p._color=v,h.left=o(v,d),h._color=m,f-=1}}return u[0]._color=v,new s(r,u[0])},y.forEach=function(e,t,r){if(this.root)switch(arguments.length){case 1:return u(e,this.root);case 2:return c(t,this._compare,e,this.root);case 3:if(this._compare(t,r)>=0)return;return l(t,r,this._compare,e,this.root)}},Object.defineProperty(y,"begin",{get:function(){for(var e=[],t=this.root;t;)e.push(t),t=t.left;return new f(this,e)}}),Object.defineProperty(y,"end",{get:function(){for(var e=[],t=this.root;t;)e.push(t),t=t.right;return new f(this,e)}}),y.at=function(e){if(e<0)return new f(this,[]);for(var t=this.root,r=[];;){if(r.push(t),t.left){if(e<t.left._count){t=t.left;continue}e-=t.left._count}if(!e)return new f(this,r);if(e-=1,!t.right)break;if(e>=t.right._count)break;t=t.right}return new f(this,[])},y.ge=function(e){for(var t=this._compare,r=this.root,n=[],i=0;r;){var o=t(e,r.key);n.push(r),o<=0&&(i=n.length),r=o<=0?r.left:r.right}return n.length=i,new f(this,n)},y.gt=function(e){for(var t=this._compare,r=this.root,n=[],i=0;r;){var o=t(e,r.key);n.push(r),o<0&&(i=n.length),r=o<0?r.left:r.right}return n.length=i,new f(this,n)},y.lt=function(e){for(var t=this._compare,r=this.root,n=[],i=0;r;){var o=t(e,r.key);n.push(r),o>0&&(i=n.length),r=o<=0?r.left:r.right}return n.length=i,new f(this,n)},y.le=function(e){for(var t=this._compare,r=this.root,n=[],i=0;r;){var o=t(e,r.key);n.push(r),o>=0&&(i=n.length),r=o<0?r.left:r.right}return n.length=i,new f(this,n)},y.find=function(e){for(var t=this._compare,r=this.root,n=[];r;){var i=t(e,r.key);if(n.push(r),0===i)return new f(this,n);r=i<=0?r.left:r.right}return new f(this,[])},y.remove=function(e){var t=this.find(e);return t?t.remove():this},y.get=function(e){for(var t=this._compare,r=this.root;r;){var n=t(e,r.key);if(0===n)return r.value;r=n<=0?r.left:r.right}};var g=f.prototype;Object.defineProperty(g,"valid",{get:function(){return this._stack.length>0}}),Object.defineProperty(g,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0}),g.clone=function(){return new f(this.tree,this._stack.slice())},g.remove=function(){var e=this._stack;if(0===e.length)return this.tree;var t=new Array(e.length),r=e[e.length-1];t[t.length-1]=new n(r._color,r.key,r.value,r.left,r.right,r._count);for(u=e.length-2;u>=0;--u)(r=e[u]).left===e[u+1]?t[u]=new n(r._color,r.key,r.value,t[u+1],r.right,r._count):t[u]=new n(r._color,r.key,r.value,r.left,t[u+1],r._count);if((r=t[t.length-1]).left&&r.right){var i=t.length;for(r=r.left;r.right;)t.push(r),r=r.right;var o=t[i-1];t.push(new n(r._color,o.key,o.value,r.left,r.right,r._count)),t[i-1].key=r.key,t[i-1].value=r.value;for(u=t.length-2;u>=i;--u)r=t[u],t[u]=new n(r._color,r.key,r.value,r.left,t[u+1],r._count);t[i-1].left=t[i]}if((r=t[t.length-1])._color===m){var a=t[t.length-2];a.left===r?a.left=null:a.right===r&&(a.right=null),t.pop();for(u=0;u<t.length;++u)t[u]._count--;return new s(this.tree._compare,t[0])}if(r.left||r.right){r.left?p(r,r.left):r.right&&p(r,r.right),r._color=v;for(u=0;u<t.length-1;++u)t[u]._count--;return new s(this.tree._compare,t[0])}if(1===t.length)return new s(this.tree._compare,null);for(var u=0;u<t.length;++u)t[u]._count--;var c=t[t.length-2];return h(t),c.left===r?c.left=null:c.right=null,new s(this.tree._compare,t[0])},Object.defineProperty(g,"key",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].key},enumerable:!0}),Object.defineProperty(g,"value",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].value},enumerable:!0}),Object.defineProperty(g,"index",{get:function(){var e=0,t=this._stack;if(0===t.length){var r=this.tree.root;return r?r._count:0}t[t.length-1].left&&(e=t[t.length-1].left._count);for(var n=t.length-2;n>=0;--n)t[n+1]===t[n].right&&(++e,t[n].left&&(e+=t[n].left._count));return e},enumerable:!0}),g.next=function(){var e=this._stack;if(0!==e.length){var t=e[e.length-1];if(t.right)for(t=t.right;t;)e.push(t),t=t.left;else for(e.pop();e.length>0&&e[e.length-1].right===t;)t=e[e.length-1],e.pop()}},Object.defineProperty(g,"hasNext",{get:function(){var e=this._stack;if(0===e.length)return!1;if(e[e.length-1].right)return!0;for(var t=e.length-1;t>0;--t)if(e[t-1].left===e[t])return!0;return!1}}),g.update=function(e){var t=this._stack;if(0===t.length)throw new Error("Can't update empty node!");var r=new Array(t.length),i=t[t.length-1];r[r.length-1]=new n(i._color,i.key,e,i.left,i.right,i._count);for(var o=t.length-2;o>=0;--o)(i=t[o]).left===t[o+1]?r[o]=new n(i._color,i.key,i.value,r[o+1],i.right,i._count):r[o]=new n(i._color,i.key,i.value,i.left,r[o+1],i._count);return new s(this.tree._compare,r[0])},g.prev=function(){var e=this._stack;if(0!==e.length){var t=e[e.length-1];if(t.left)for(t=t.left;t;)e.push(t),t=t.right;else for(e.pop();e.length>0&&e[e.length-1].left===t;)t=e[e.length-1],e.pop()}},Object.defineProperty(g,"hasPrev",{get:function(){var e=this._stack;if(0===e.length)return!1;if(e[e.length-1].left)return!0;for(var t=e.length-1;t>0;--t)if(e[t-1].right===e[t])return!0;return!1}})},{}],20:[function(e,t,r){"use strict";t.exports="function"==typeof Symbol&&"symbol"==typeof Symbol("")},{}],21:[function(e,t,r){"use strict";t.exports=e("has-symbol-support-x")&&"symbol"==typeof Symbol.toStringTag},{"has-symbol-support-x":20}],22:[function(e,t,r){r.read=function(e,t,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,c=u>>1,l=-7,f=r?i-1:0,p=r?-1:1,h=e[t+f];for(f+=p,o=h&(1<<-l)-1,h>>=-l,l+=s;l>0;o=256*o+e[t+f],f+=p,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=n;l>0;a=256*a+e[t+f],f+=p,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,n),o-=c}return(h?-1:1)*a*Math.pow(2,o-n)},r.write=function(e,t,r,n,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,f=l>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:o-1,d=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+f>=1?p/u:p*Math.pow(2,1-f))*u>=2&&(a++,u/=2),a+f>=l?(s=0,a=l):a+f>=1?(s=(t*u-1)*Math.pow(2,i),a+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,i),a=0));i>=8;e[r+h]=255&s,h+=d,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;e[r+h]=255&a,h+=d,a/=256,c-=8);e[r+h-d]|=128*m}},{}],23:[function(e,t,r){(function(e){"use strict";function r(){c=!0;for(var e,t,r=l.length;r;){for(t=l,l=[],e=-1;++e<r;)t[e]();r=l.length}c=!1}var n,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,a=new i(r),s=e.document.createTextNode("");a.observe(s,{characterData:!0}),n=function(){s.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){r(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(r,0)};else{var u=new e.MessageChannel;u.port1.onmessage=r,n=function(){u.port2.postMessage(0)}}var c,l=[];t.exports=function(e){1!==l.push(e)||c||n()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],24:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],25:[function(e,t,r){"use strict";var n,i,o,a=e("is-object-like-x"),s="function"==typeof ArrayBuffer;if(s){if(e("has-to-string-tag-x"))try{o=Object.getOwnPropertyDescriptor(ArrayBuffer.prototype,"byteLength").get,o="number"==typeof o.call(new ArrayBuffer(4))&&o}catch(e){}!1===Boolean(o)&&(n=e("to-string-tag-x"),i="[object ArrayBuffer]")}t.exports=function(e){if(!1===s||!1===a(e))return!1;if(!1===Boolean(o))return n(e)===i;try{return"number"==typeof o.call(e)}catch(e){}return!1}},{"has-to-string-tag-x":21,"is-object-like-x":28,"to-string-tag-x":110}],26:[function(e,t,r){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function i(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&n(e.slice(0,0))}t.exports=function(e){return null!=e&&(n(e)||i(e)||!!e._isBuffer)}},{}],27:[function(e,t,r){"use strict";var n=Function.prototype.toString,i=e("to-string-tag-x"),o=e("has-to-string-tag-x"),a=e("is-primitive"),s=/^\s*class /,u=function(e){try{var t=n.call(e).replace(/\/\/.*\n/g,"").replace(/\/\*[.\s\S]*\*\//g,"").replace(/\n/gm," ").replace(/ {2}/g," ");return s.test(t)}catch(e){}return!1},c=function(e){try{return!u(e)&&(n.call(e),!0)}catch(e){}return!1};t.exports=function(e){if(a(e))return!1;if(o)return c(e);if(u(e))return!1;var t=i(e);return"[object Function]"===t||"[object GeneratorFunction]"===t||"[object AsyncFunction]"===t}},{"has-to-string-tag-x":21,"is-primitive":29,"to-string-tag-x":110}],28:[function(e,t,r){"use strict";var n=e("is-function-x"),i=e("is-primitive");t.exports=function(e){return!1===i(e)&&!1===n(e)}},{"is-function-x":27,"is-primitive":29}],29:[function(e,t,r){"use strict";t.exports=function(e){return null==e||"function"!=typeof e&&"object"!=typeof e}},{}],30:[function(e,t,r){var n={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},{}],31:[function(e,t,r){function n(e){this.opts=e||{},this.encodings=i}var i=e("./lib/encodings");t.exports=n,n.prototype._encoding=function(e){return"string"==typeof e&&(e=i[e]),e||(e=i.id),e},n.prototype._keyEncoding=function(e,t){return this._encoding(t&&t.keyEncoding||e&&e.keyEncoding||this.opts.keyEncoding)},n.prototype._valueEncoding=function(e,t){return this._encoding(t&&(t.valueEncoding||t.encoding)||e&&(e.valueEncoding||e.encoding)||this.opts.valueEncoding||this.opts.encoding)},n.prototype.encodeKey=function(e,t,r){return this._keyEncoding(t,r).encode(e)},n.prototype.encodeValue=function(e,t,r){return this._valueEncoding(t,r).encode(e)},n.prototype.decodeKey=function(e,t){return this._keyEncoding(t).decode(e)},n.prototype.decodeValue=function(e,t){return this._valueEncoding(t).decode(e)},n.prototype.encodeBatch=function(e,t){var r=this;return e.map(function(e){var n={type:e.type,key:r.encodeKey(e.key,t,e)};return r.keyAsBuffer(t,e)&&(n.keyEncoding="binary"),e.prefix&&(n.prefix=e.prefix),"value"in e&&(n.value=r.encodeValue(e.value,t,e),r.valueAsBuffer(t,e)&&(n.valueEncoding="binary")),n})};var o=["lt","gt","lte","gte","start","end"];n.prototype.encodeLtgt=function(e){var t=this,r={};return Object.keys(e).forEach(function(n){r[n]=o.indexOf(n)>-1?t.encodeKey(e[n],e):e[n]}),r},n.prototype.createStreamDecoder=function(e){var t=this;return e.keys&&e.values?function(r,n){return{key:t.decodeKey(r,e),value:t.decodeValue(n,e)}}:e.keys?function(r){return t.decodeKey(r,e)}:e.values?function(r,n){return t.decodeValue(n,e)}:function(){}},n.prototype.keyAsBuffer=function(e){return this._keyEncoding(e).buffer},n.prototype.valueAsBuffer=function(e){return this._valueEncoding(e).buffer}},{"./lib/encodings":32}],32:[function(e,t,r){(function(e){function t(t){return void 0===t||null===t||e.isBuffer(t)}r.utf8=r["utf-8"]={encode:function(e){return t(e)?e:String(e)},decode:function(e){return"string"==typeof e?e:String(e)},buffer:!1,type:"utf8"},r.json={encode:JSON.stringify,decode:JSON.parse,buffer:!1,type:"json"},r.binary={encode:function(r){return t(r)?r:new e(r)},decode:function(e){return e},buffer:!0,type:"binary"},r.none={encode:function(e){return e},decode:function(e){return e},buffer:!1,type:"id"},r.id=r.none,["hex","ascii","base64","ucs2","ucs-2","utf16le","utf-16le"].forEach(function(n){r[n]={encode:function(r){return t(r)?r:new e(r,n)},decode:function(e){return e.toString(n)},buffer:!0,type:n}})}).call(this,e("buffer").Buffer)},{buffer:5}],33:[function(e,t,r){var n=e("errno").create,i=n("LevelUPError"),o=n("NotFoundError",i);o.prototype.notFound=!0,o.prototype.status=404,t.exports={LevelUPError:i,InitializationError:n("InitializationError",i),OpenError:n("OpenError",i),ReadError:n("ReadError",i),WriteError:n("WriteError",i),NotFoundError:o,EncodingError:n("EncodingError",i)}},{errno:16}],34:[function(e,t,r){function n(e,t){if(!(this instanceof n))return new n(e,t);o.call(this,a(t,{objectMode:!0})),this._iterator=e,this._destroyed=!1,this._decoder=null,t&&t.decoder&&(this._decoder=t.decoder),this.on("end",this._cleanup.bind(this))}var i=e("inherits"),o=e("readable-stream").Readable,a=e("xtend"),s=e("level-errors").EncodingError;t.exports=n,i(n,o),n.prototype._read=function(){var e=this;this._destroyed||this._iterator.next(function(t,r,n){if(!e._destroyed){if(t)return e.emit("error",t);if(void 0===r&&void 0===n)e.push(null);else{if(!e._decoder)return e.push({key:r,value:n});try{var n=e._decoder(r,n)}catch(t){return e.emit("error",new s(t)),void e.push(null)}e.push(n)}}})},n.prototype.destroy=n.prototype._cleanup=function(){var e=this;this._destroyed||(this._destroyed=!0,this._iterator.end(function(t){if(t)return e.emit("error",t);e.emit("close")}))}},{inherits:24,"level-errors":33,"readable-stream":78,xtend:120}],35:[function(e,t,r){function n(e,t){this._levelup=e,this._codec=t,this.batch=e.db.batch(),this.ops=[],this.length=0}var i=e("./util"),o=e("level-errors").WriteError,a=i.getOptions,s=i.dispatchError;n.prototype.put=function(e,t,r){r=a(r);var n=this._codec.encodeKey(e,r),i=this._codec.encodeValue(t,r);try{this.batch.put(n,i)}catch(e){throw new o(e)}return this.ops.push({type:"put",key:n,value:i}),this.length++,this},n.prototype.del=function(e,t){t=a(t);var r=this._codec.encodeKey(e,t);try{this.batch.del(r)}catch(e){throw new o(e)}return this.ops.push({type:"del",key:r}),this.length++,this},n.prototype.clear=function(){try{this.batch.clear()}catch(e){throw new o(e)}return this.ops=[],this.length=0,this},n.prototype.write=function(e){var t=this._levelup,r=this.ops;try{this.batch.write(function(n){if(n)return s(t,new o(n),e);t.emit("batch",r),e&&e()})}catch(e){throw new o(e)}},t.exports=n},{"./util":37,"level-errors":33}],36:[function(e,t,r){(function(r){function n(e,t){return"function"==typeof e?e:t}function i(e,t,n){if(!(this instanceof i))return new i(e,t,n);var o;if(c.call(this),this.setMaxListeners(1/0),"function"==typeof e?((t="object"==typeof t?t:{}).db=e,e=null):"object"==typeof e&&"function"==typeof e.db&&(t=e,e=null),"function"==typeof t&&(n=t,t={}),(!t||"function"!=typeof t.db)&&"string"!=typeof e){if(o=new w("Must provide a location for the database"),n)return r.nextTick(function(){n(o)});throw o}t=D(t),this.options=p(C,t),this._codec=new A(this.options),this._status="new",h(this,"location",e,"e"),this.open(n)}function o(e,t,r){if(!e._isOpening()&&!e.isOpen())return j(e,new g("Database is not open"),r),!0}function a(e,t,r){j(e,new y(t),r)}function s(e,t,r){j(e,new g(t),r)}function u(e){return function(t,r){F()[e](t,r||function(){})}}var c=e("events").EventEmitter,l=e("util").inherits,f=e("util").deprecate,p=e("xtend"),h=e("prr"),d=e("deferred-leveldown"),m=e("level-iterator-stream"),v=e("level-errors"),y=v.WriteError,g=v.ReadError,b=v.NotFoundError,_=v.OpenError,x=v.EncodingError,w=v.InitializationError,k=v.LevelUPError,E=e("./util"),S=e("./batch"),A=e("level-codec"),D=E.getOptions,C=E.defaultOptions,F=e("./leveldown"),j=E.dispatchError;E.isDefined;l(i,c),i.prototype.open=function(e){var t,n,i=this;if(this.isOpen())return e&&r.nextTick(function(){e(null,i)}),this;if(this._isOpening())return e&&this.once("open",function(){e(null,i)});if(this.emit("opening"),this._status="opening",this.db=new d(this.location),"function"!=typeof this.options.db&&"function"!=typeof F)throw new k("missing db factory, you need to set options.db");t=this.options.db||F(),(n=t(this.location)).open(this.options,function(t){if(t)return j(i,new _(t),e);i.db.setDb(n),i.db=n,i._status="open",e&&e(null,i),i.emit("open"),i.emit("ready")})},i.prototype.close=function(e){var t=this;if(this.isOpen())this._status="closing",this.db.close(function(){t._status="closed",t.emit("closed"),e&&e.apply(null,arguments)}),this.emit("closing"),this.db=new d(this.location);else{if("closed"==this._status&&e)return r.nextTick(e);"closing"==this._status&&e?this.once("closed",e):this._isOpening()&&this.once("open",function(){t.close(e)})}},i.prototype.isOpen=function(){return"open"==this._status},i.prototype._isOpening=function(){return"opening"==this._status},i.prototype.isClosed=function(){return/^clos/.test(this._status)},i.prototype.get=function(e,t,r){var i,a=this;if(r=n(t,r),!o(this,0,r)){if(null===e||void 0===e||"function"!=typeof r)return s(this,"get() requires key and callback arguments",r);t=E.getOptions(t),i=this._codec.encodeKey(e,t),t.asBuffer=this._codec.valueAsBuffer(t),this.db.get(i,t,function(n,i){if(n)return n=/notfound/i.test(n)||n.notFound?new b("Key not found in database ["+e+"]",n):new g(n),j(a,n,r);if(r){try{i=a._codec.decodeValue(i,t)}catch(e){return r(new x(e))}r(null,i)}})}},i.prototype.put=function(e,t,r,i){var s,u,c=this;if(i=n(r,i),null===e||void 0===e)return a(this,"put() requires a key argument",i);o(this,0,i)||(r=D(r),s=this._codec.encodeKey(e,r),u=this._codec.encodeValue(t,r),this.db.put(s,u,r,function(r){if(r)return j(c,new y(r),i);c.emit("put",e,t),i&&i()}))},i.prototype.del=function(e,t,r){var i,s=this;if(r=n(t,r),null===e||void 0===e)return a(this,"del() requires a key argument",r);o(this,0,r)||(t=D(t),i=this._codec.encodeKey(e,t),this.db.del(i,t,function(t){if(t)return j(s,new y(t),r);s.emit("del",e),r&&r()}))},i.prototype.batch=function(e,t,r){var i,s=this;return arguments.length?(r=n(t,r),Array.isArray(e)?void(o(this,0,r)||(t=D(t),i=(i=s._codec.encodeBatch(e,t)).map(function(e){return e.type||void 0===e.key||void 0===e.value||(e.type="put"),e}),this.db.batch(i,t,function(t){if(t)return j(s,new y(t),r);s.emit("batch",e),r&&r()}))):a(this,"batch() requires an array argument",r)):new S(this,this._codec)},i.prototype.approximateSize=f(function(e,t,r,i){var o,a,u=this;if(i=n(r,i),r=D(r),null===e||void 0===e||null===t||void 0===t||"function"!=typeof i)return s(this,"approximateSize() requires start, end and callback arguments",i);o=this._codec.encodeKey(e,r),a=this._codec.encodeKey(t,r),this.db.approximateSize(o,a,function(e,t){if(e)return j(u,new _(e),i);i&&i(null,t)})},"db.approximateSize() is deprecated. Use db.db.approximateSize() instead"),i.prototype.readStream=i.prototype.createReadStream=function(e){return e=p({keys:!0,values:!0},this.options,e),e.keyEncoding=e.keyEncoding,e.valueEncoding=e.valueEncoding,e=this._codec.encodeLtgt(e),e.keyAsBuffer=this._codec.keyAsBuffer(e),e.valueAsBuffer=this._codec.valueAsBuffer(e),"number"!=typeof e.limit&&(e.limit=-1),new m(this.db.iterator(e),p(e,{decoder:this._codec.createStreamDecoder(e)}))},i.prototype.keyStream=i.prototype.createKeyStream=function(e){return this.createReadStream(p(e,{keys:!0,values:!1}))},i.prototype.valueStream=i.prototype.createValueStream=function(e){return this.createReadStream(p(e,{keys:!1,values:!0}))},i.prototype.toString=function(){return"LevelUP"},t.exports=i,t.exports.errors=e("level-errors"),t.exports.destroy=f(u("destroy"),"levelup.destroy() is deprecated. Use leveldown.destroy() instead"),t.exports.repair=f(u("repair"),"levelup.repair() is deprecated. Use leveldown.repair() instead")}).call(this,e("_process"))},{"./batch":35,"./leveldown":3,"./util":37,_process:70,"deferred-leveldown":8,events:18,"level-codec":38,"level-errors":33,"level-iterator-stream":34,prr:71,util:114,xtend:120}],37:[function(e,t,r){e("xtend");var n={createIfMissing:!0,errorIfExists:!1,keyEncoding:"utf8",valueEncoding:"utf8",compression:!0};t.exports={defaultOptions:n,getOptions:function(e){return"string"==typeof e&&(e={valueEncoding:e}),"object"!=typeof e&&(e={}),e},dispatchError:function(e,t,r){"function"==typeof r?r(t):e.emit("error",t)},isDefined:function(e){return void 0!==e}}},{xtend:120}],38:[function(e,t,r){arguments[4][31][0].apply(r,arguments)},{"./lib/encodings":39,dup:31}],39:[function(e,t,r){(function(e){function t(e){return e}function n(t){return void 0===t||null===t||e.isBuffer(t)}r.utf8=r["utf-8"]={encode:function(e){return n(e)?e:String(e)},decode:t,buffer:!1,type:"utf8"},r.json={encode:JSON.stringify,decode:JSON.parse,buffer:!1,type:"json"},r.binary={encode:function(t){return n(t)?t:new e(t)},decode:t,buffer:!0,type:"binary"},r.id={encode:function(e){return e},decode:function(e){return e},buffer:!1,type:"id"},["hex","ascii","base64","ucs2","ucs-2","utf16le","utf-16le"].forEach(function(t){r[t]={encode:function(r){return n(r)?r:new e(r,t)},decode:function(e){return e.toString(t)},buffer:!0,type:t}})}).call(this,e("buffer").Buffer)},{buffer:5}],40:[function(e,t,r){"use strict";function n(){}function i(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=d,this.queue=[],this.outcome=void 0,e!==n&&u(this,e)}function o(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function a(e,t,r){l(function(){var n;try{n=t(r)}catch(t){return f.reject(e,t)}n===e?f.reject(e,new TypeError("Cannot resolve promise with itself")):f.resolve(e,n)})}function s(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function u(e,t){function r(t){i||(i=!0,f.reject(e,t))}function n(t){i||(i=!0,f.resolve(e,t))}var i=!1,o=c(function(){t(n,r)});"error"===o.status&&r(o.value)}function c(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}var l=e("immediate"),f={},p=["REJECTED"],h=["FULFILLED"],d=["PENDING"];t.exports=i,i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){if("function"!=typeof e&&this.state===h||"function"!=typeof t&&this.state===p)return this;var r=new this.constructor(n);return this.state!==d?a(r,this.state===h?e:t,this.outcome):this.queue.push(new o(r,e,t)),r},o.prototype.callFulfilled=function(e){f.resolve(this.promise,e)},o.prototype.otherCallFulfilled=function(e){a(this.promise,this.onFulfilled,e)},o.prototype.callRejected=function(e){f.reject(this.promise,e)},o.prototype.otherCallRejected=function(e){a(this.promise,this.onRejected,e)},f.resolve=function(e,t){var r=c(s,t);if("error"===r.status)return f.reject(e,r.value);var n=r.value;if(n)u(e,n);else{e.state=h,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},f.reject=function(e,t){e.state=p,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},i.resolve=function(e){return e instanceof this?e:f.resolve(new this(n),e)},i.reject=function(e){var t=new this(n);return f.reject(t,e)},i.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var o=new Array(r),a=0,s=-1,u=new this(n);++s<r;)!function(e,n){t.resolve(e).then(function(e){o[n]=e,++a!==r||i||(i=!0,f.resolve(u,o))},function(e){i||(i=!0,f.reject(u,e))})}(e[s],s);return u},i.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var o=-1,a=new this(n);++o<r;)!function(e){t.resolve(e).then(function(e){i||(i=!0,f.resolve(a,e))},function(e){i||(i=!0,f.reject(a,e))})}(e[o]);return a}},{immediate:23}],41:[function(e,t,r){t.exports=function(e){return null===e}},{}],42:[function(e,t,r){(function(e){function t(e,t){return Object.hasOwnProperty.call(e,t)}function n(e){return void 0!==e&&""!==e}function t(e,t){return Object.hasOwnProperty.call(e,t)}function i(e,t){return Object.hasOwnProperty.call(e,t)&&t}function o(e){return e}r.compare=function(t,r){if(e.isBuffer(t)){for(var n=Math.min(t.length,r.length),i=0;i<n;i++){var o=t[i]-r[i];if(o)return o}return t.length-r.length}return t<r?-1:t>r?1:0};var a=r.lowerBoundKey=function(e){return i(e,"gt")||i(e,"gte")||i(e,"min")||(e.reverse?i(e,"end"):i(e,"start"))||void 0},s=r.lowerBound=function(e,t){var r=a(e);return r?e[r]:t},u=r.lowerBoundInclusive=function(e){return!t(e,"gt")},c=r.upperBoundInclusive=function(e){return!t(e,"lt")},l=r.lowerBoundExclusive=function(e){return!u(e)},f=r.upperBoundExclusive=function(e){return!c(e)},p=r.upperBoundKey=function(e){return i(e,"lt")||i(e,"lte")||i(e,"max")||(e.reverse?i(e,"start"):i(e,"end"))||void 0},h=r.upperBound=function(e,t){var r=p(e);return r?e[r]:t};r.start=function(e,t){return e.reverse?h(e,t):s(e,t)},r.end=function(e,t){return e.reverse?s(e,t):h(e,t)},r.startInclusive=function(e){return e.reverse?c(e):u(e)},r.endInclusive=function(e){return e.reverse?u(e):c(e)},r.toLtgt=function(e,n,i,a,s){n=n||{},i=i||o;var u=arguments.length>3,c=r.lowerBoundKey(e),l=r.upperBoundKey(e);return c?"gt"===c?n.gt=i(e.gt,!1):n.gte=i(e[c],!1):u&&(n.gte=i(a,!1)),l?"lt"===l?n.lt=i(e.lt,!0):n.lte=i(e[l],!0):u&&(n.lte=i(s,!0)),null!=e.reverse&&(n.reverse=!!e.reverse),t(n,"max")&&delete n.max,t(n,"min")&&delete n.min,t(n,"start")&&delete n.start,t(n,"end")&&delete n.end,n},r.contains=function(e,t,i){i=i||r.compare;var o=s(e);if(n(o)&&((u=i(t,o))<0||0===u&&l(e)))return!1;var a=h(e);if(n(a)){var u=i(t,a);if(u>0||0===u&&f(e))return!1}return!0},r.filter=function(e,t){return function(n){return r.contains(e,n,t)}}}).call(this,{isBuffer:e("../is-buffer/index.js")})},{"../is-buffer/index.js":26}],43:[function(e,t,r){t.exports=e("immediate")},{immediate:50}],44:[function(e,t,r){(function(r){function n(e){return p.compare(e,this._end)>0}function i(e){return p.compare(e,this._end)>=0}function o(e){return p.compare(e,this._end)<0}function a(e){return p.compare(e,this._end)<=0}function s(e,t){f.call(this,e),this._limit=t.limit,-1===this._limit&&(this._limit=1/0);var r=e._store[e._location];this.keyAsBuffer=!1!==t.keyAsBuffer,this.valueAsBuffer=!1!==t.valueAsBuffer,this._reverse=t.reverse,this._options=t,this._done=0,this._reverse?(this._incr="prev",this._start=p.upperBound(t),this._end=p.lowerBound(t),void 0===this._start?this._tree=r.end:p.upperBoundInclusive(t)?this._tree=r.le(this._start):this._tree=r.lt(this._start),this._end&&(p.lowerBoundInclusive(t)?this._test=i:this._test=n)):(this._incr="next",this._start=p.lowerBound(t),this._end=p.upperBound(t),void 0===this._start?this._tree=r.begin:p.lowerBoundInclusive(t)?this._tree=r.ge(this._start):this._tree=r.gt(this._start),this._end&&(p.upperBoundInclusive(t)?this._test=a:this._test=o))}function u(e){if(!(this instanceof u))return new u(e);l.call(this,"string"==typeof e?e:""),this._location=this.location?"$"+this.location:"_tree",this._store=this.location?d:this,this._store[this._location]=this._store[this._location]||h(p.compare)}var c=e("inherits"),l=e("abstract-leveldown").AbstractLevelDOWN,f=e("abstract-leveldown").AbstractIterator,p=e("ltgt"),h=e("functional-red-black-tree"),d={},m=e("./immediate");c(s,f),s.prototype._next=function(e){var t,n;return this._done++>=this._limit?m(e):this._tree.valid?(t=this._tree.key,n=this._tree.value,this._test(t)?(this.keyAsBuffer&&(t=new r(t)),this.valueAsBuffer&&(n=new r(n)),this._tree[this._incr](),void m(function(){e(null,t,n)})):m(e)):m(e)},s.prototype._test=function(){return!0},u.clearGlobalStore=function(e){e?Object.keys(d).forEach(function(e){delete d[e]}):d={}},c(u,l),u.prototype._open=function(e,t){var r=this;m(function(){t(null,r)})},u.prototype._put=function(e,t,r,n){void 0!==t&&null!==t||(t="");var i=this._store[this._location].find(e);i.valid?this._store[this._location]=i.update(t):this._store[this._location]=this._store[this._location].insert(e,t),m(n)},u.prototype._get=function(e,t,n){var i=this._store[this._location].get(e);if(void 0===i)return m(function(){n(new Error("NotFound"))});!1===t.asBuffer||this._isBuffer(i)||(i=new r(String(i))),m(function(){n(null,i)})},u.prototype._del=function(e,t,r){this._store[this._location]=this._store[this._location].remove(e),m(r)},u.prototype._batch=function(e,t,r){for(var n,i,o,a=-1,s=e.length,u=this._store[this._location];++a<s;)e[a]&&(n=this._isBuffer(e[a].key)?e[a].key:String(e[a].key),o=u.find(n),"put"===e[a].type?(i=this._isBuffer(e[a].value)?e[a].value:String(e[a].value),u=o.valid?o.update(i):u.insert(n,i)):u=o.remove());this._store[this._location]=u,m(r)},u.prototype._iterator=function(e){return new s(this,e)},u.prototype._isBuffer=function(e){return r.isBuffer(e)},u.destroy=function(e,t){var r="$"+e;r in d&&delete d[r],m(t)},t.exports=u}).call(this,e("buffer").Buffer)},{"./immediate":43,"abstract-leveldown":48,buffer:5,"functional-red-black-tree":19,inherits:24,ltgt:56}],45:[function(e,t,r){arguments[4][9][0].apply(r,arguments)},{_process:70,dup:9}],46:[function(e,t,r){arguments[4][10][0].apply(r,arguments)},{_process:70,dup:10}],47:[function(e,t,r){arguments[4][11][0].apply(r,arguments)},{"../../../is-buffer/index.js":26,"./abstract-chained-batch":45,"./abstract-iterator":46,_process:70,dup:11,xtend:120}],48:[function(e,t,r){arguments[4][12][0].apply(r,arguments)},{"./abstract-chained-batch":45,"./abstract-iterator":46,"./abstract-leveldown":47,"./is-leveldown":49,dup:12}],49:[function(e,t,r){arguments[4][13][0].apply(r,arguments)},{"./abstract-leveldown":47,dup:13}],50:[function(e,t,r){"use strict";function n(){a&&s&&(a=!1,s.length?f=s.concat(f):l=-1,f.length&&i())}function i(){if(!a){p=!1,a=!0;for(var e=f.length,t=setTimeout(n);e;){for(s=f,f=[];s&&++l<e;)s[l].run();l=-1,e=f.length}s=null,l=-1,a=!1,clearTimeout(t)}}function o(e,t){this.fun=e,this.array=t}for(var a,s,u,c=[e("./nextTick"),e("./mutation.js"),e("./messageChannel"),e("./stateChange"),e("./timeout")],l=-1,f=[],p=!1,h=-1,d=c.length;++h<d;)if(c[h]&&c[h].test&&c[h].test()){u=c[h].install(i);break}o.prototype.run=function(){var e=this.fun,t=this.array;switch(t.length){case 0:return e();case 1:return e(t[0]);case 2:return e(t[0],t[1]);case 3:return e(t[0],t[1],t[2]);default:return e.apply(null,t)}},t.exports=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];f.push(new o(e,t)),p||a||(p=!0,u())}},{"./messageChannel":51,"./mutation.js":52,"./nextTick":53,"./stateChange":54,"./timeout":55}],51:[function(e,t,r){(function(e){"use strict";r.test=function(){return!e.setImmediate&&void 0!==e.MessageChannel},r.install=function(t){var r=new e.MessageChannel;return r.port1.onmessage=t,function(){r.port2.postMessage(0)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],52:[function(e,t,r){(function(e){"use strict";var t=e.MutationObserver||e.WebKitMutationObserver;r.test=function(){return t},r.install=function(r){var n=0,i=new t(r),o=e.document.createTextNode("");return i.observe(o,{characterData:!0}),function(){o.data=n=++n%2}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],53:[function(e,t,r){(function(e){"use strict";r.test=function(){return void 0!==e&&!e.browser},r.install=function(t){return function(){e.nextTick(t)}}}).call(this,e("_process"))},{_process:70}],54:[function(e,t,r){(function(e){"use strict";r.test=function(){return"document"in e&&"onreadystatechange"in e.document.createElement("script")},r.install=function(t){return function(){var r=e.document.createElement("script");return r.onreadystatechange=function(){t(),r.onreadystatechange=null,r.parentNode.removeChild(r),r=null},e.document.documentElement.appendChild(r),t}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],55:[function(e,t,r){"use strict";r.test=function(){return!0},r.install=function(e){return function(){setTimeout(e,0)}}},{}],56:[function(e,t,r){(function(e){function t(e,t){return Object.hasOwnProperty.call(e,t)}function n(e){return void 0!==e&&""!==e}function t(e,t){return Object.hasOwnProperty.call(e,t)}function i(e,t){return Object.hasOwnProperty.call(e,t)&&t}function o(e){return e}r.compare=function(t,r){if(e.isBuffer(t)){for(var n=Math.min(t.length,r.length),i=0;i<n;i++){var o=t[i]-r[i];if(o)return o}return t.length-r.length}return t<r?-1:t>r?1:0};var a=r.lowerBoundKey=function(e){return i(e,"gt")||i(e,"gte")||i(e,"min")||(e.reverse?i(e,"end"):i(e,"start"))||void 0},s=r.lowerBound=function(e){var t=a(e);return t&&e[t]},u=r.lowerBoundInclusive=function(e){return!t(e,"gt")},c=r.upperBoundInclusive=function(e){return!t(e,"lt")},l=r.lowerBoundExclusive=function(e){return!u(e)},f=r.upperBoundExclusive=function(e){return!c(e)},p=r.upperBoundKey=function(e){return i(e,"lt")||i(e,"lte")||i(e,"max")||(e.reverse?i(e,"start"):i(e,"end"))||void 0},h=r.upperBound=function(e){var t=p(e);return t&&e[t]};r.toLtgt=function(e,n,i,a,s){n=n||{},i=i||o;var u=arguments.length>3,c=r.lowerBoundKey(e),l=r.upperBoundKey(e);return c?"gt"===c?n.gt=i(e.gt,!1):n.gte=i(e[c],!1):u&&(n.gte=i(a,!1)),l?"lt"===l?n.lt=i(e.lt,!0):n.lte=i(e[l],!0):u&&(n.lte=i(s,!0)),null!=e.reverse&&(n.reverse=!!e.reverse),t(n,"max")&&delete n.max,t(n,"min")&&delete n.min,t(n,"start")&&delete n.start,t(n,"end")&&delete n.end,n},r.contains=function(e,t,i){i=i||r.compare;var o=s(e);if(n(o)&&((u=i(t,o))<0||0===u&&l(e)))return!1;var a=h(e);if(n(a)){var u=i(t,a);if(u>0||0===u&&f(e))return!1}return!0},r.filter=function(e,t){return function(n){return r.contains(e,n,t)}}}).call(this,{isBuffer:e("../../../is-buffer/index.js")})},{"../../../is-buffer/index.js":26}],57:[function(e,t,r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function i(e,t){var r=new Uint8Array(e);return A.blob([r],{type:t})}function o(e,t){A.readAsBinaryString(e,t)}function a(e){return A.blob([""],{type:e})}function s(e,t){var r=t.prefix()[0],n=e._cache,i=n.get(r);return i||(i=new h.Map,n.set(r,i)),i}function u(){this._batch=[],this._cache=new h.Map}function c(e){return"winningRev"in e?e.winningRev:k.winningRev(e)}function l(e,t){return"deleted"in e?e.deleted:w.isDeleted(e,t)}function f(e,t,r){var n=e.content_type;return new d(function(o,a){t.binaryStore.get(e.digest,function(t,s){var u;if(t){if("NotFoundError"!==t.name)return a(t);u=r.binary?A.binaryStringToBlobOrBuffer("",n):""}else u=r.binary?i(s,n):s.toString("base64");delete e.stub,delete e.length,e.data=u,o()})})}function p(e,t,r){var n=[];return e.forEach(function(e){e.doc&&e.doc._attachments&&Object.keys(e.doc._attachments).forEach(function(t){var r=e.doc._attachments[t];"data"in r||n.push(r)})}),d.all(n.map(function(e){return f(e,t,r)}))}var h=e("pouchdb-collections"),d=n(e("pouchdb-promise")),m=n(e("levelup")),v=n(e("sublevel-pouchdb")),y=e("through2"),g=n(e("argsarray")),b=n(e("double-ended-queue")),_=n(e("buffer-from")),x=e("pouchdb-utils"),w=e("pouchdb-adapter-utils"),k=e("pouchdb-merge"),E=e("pouchdb-json"),S=e("pouchdb-md5"),A=e("pouchdb-binary-utils"),D=e("pouchdb-errors");u.prototype.get=function(e,t,r){var n=s(this,e),i=n.get(t);return i?x.nextTick(function(){r(null,i)}):null===i?x.nextTick(function(){r({name:"NotFoundError"})}):void e.get(t,function(e,i){if(e)return"NotFoundError"===e.name&&n.set(t,null),r(e);n.set(t,i),r(null,i)})},u.prototype.batch=function(e){for(var t=0,r=e.length;t<r;t++){var n=e[t],i=s(this,n.prefix);"put"===n.type?i.set(n.key,n.value):i.set(n.key,null)}this._batch=this._batch.concat(e)},u.prototype.execute=function(e,t){for(var r=new h.Set,n=[],i=this._batch.length-1;i>=0;i--){var o=this._batch[i],a=o.prefix.prefix()[0]+""+o.key;r.has(a)||(r.add(a),n.push(o))}e.batch(n,t)};var C="document-store",F="by-sequence",j="attach-store",T="attach-binary-store",O="local-store",R="meta-store",B=new h.Map,P="_local_last_update_seq",I="_local_doc_count",L="_local_uuid",N="md5-",M={encode:E.safeJsonStringify,decode:E.safeJsonParse,buffer:!1,type:"cheap-json"},q=new x.changesHandler;t.exports=function(e,t){function r(){Q.docStore=X.sublevel(C,{valueEncoding:M}),Q.bySeqStore=X.sublevel(F,{valueEncoding:"json"}),Q.attachmentStore=X.sublevel(j,{valueEncoding:"json"}),Q.binaryStore=X.sublevel(T,{valueEncoding:"binary"}),Q.localStore=X.sublevel(O,{valueEncoding:"json"}),Q.metaStore=X.sublevel(R,{valueEncoding:"json"}),"object"==typeof e.migrate?e.migrate.doMigrationTwo(X,Q,n):n()}function n(){Q.metaStore.get(P,function(e,r){void 0===X._updateSeq&&(X._updateSeq=r||0),Q.metaStore.get(I,function(e,r){X._docCount=e?0:r,Q.metaStore.get(L,function(e,r){H=e?x.uuid():r,Q.metaStore.put(L,H,function(){x.nextTick(function(){t(null,K)})})})})})}function s(e){return X.isClosed()?e(new Error("database is closed")):e(null,X._docCount)}function f(e,t){try{e.apply(null,t)}catch(e){t[t.length-1](e)}}function E(){var e=X._queue.peekFront();"read"===e.type?$(e):W(e)}function $(e){for(var t=[e],r=1,n=X._queue.get(r);void 0!==n&&"read"===n.type;)t.push(n),r++,n=X._queue.get(r);var i=0;t.forEach(function(e){var r=e.args,n=r[r.length-1];r[r.length-1]=g(function(e){n.apply(null,e),++i===t.length&&x.nextTick(function(){t.forEach(function(){X._queue.shift()}),X._queue.length&&E()})}),f(e.fun,r)})}function W(e){var t=e.args,r=t[t.length-1];t[t.length-1]=g(function(e){r.apply(null,e),x.nextTick(function(){X._queue.shift(),X._queue.length&&E()})}),f(e.fun,t)}function U(e){return g(function(t){X._queue.push({fun:e,args:t,type:"write"}),1===X._queue.length&&x.nextTick(E)})}function G(e){return g(function(t){X._queue.push({fun:e,args:t,type:"read"}),1===X._queue.length&&x.nextTick(E)})}function z(e){return("0000000000000000"+e).slice(-16)}function V(e){return parseInt(e,10)}function J(e,t){te.destroy(e,t)}var H,X,K=this,Q={},Y=(e=x.clone(e)).revs_limit,Z=e.name;void 0===e.createIfMissing&&(e.createIfMissing=!0);var ee,te=e.db,re=x.functionName(te);B.has(re)?ee=B.get(re):(ee=new h.Map,B.set(re,ee)),ee.has(Z)?(X=ee.get(Z),r()):ee.set(Z,v(m(Z,e,function(n){if(n)return ee.delete(Z),t(n);(X=ee.get(Z))._docCount=-1,X._queue=new b,"object"==typeof e.migrate?e.migrate.doMigrationOne(Z,X,r):r()}))),K._remote=!1,K.type=function(){return"leveldb"},K._id=function(e){e(null,H)},K._info=function(e){var t={doc_count:X._docCount,update_seq:X._updateSeq,backend_adapter:x.functionName(te)};return x.nextTick(function(){e(null,t)})},K._get=G(function(e,t,r){t=x.clone(t),Q.docStore.get(e,function(e,n){if(e||!n)return r(D.createError(D.MISSING_DOC,"missing"));var i;if(t.rev)i=t.latest?k.latest(t.rev,n):t.rev;else if(i=c(n),l(n,i))return r(D.createError(D.MISSING_DOC,"deleted"));var o=n.rev_map[i];Q.bySeqStore.get(z(o),function(e,t){if(!t)return r(D.createError(D.MISSING_DOC));if("_id"in t&&t._id!==n.id)return r(new Error("wrong doc returned"));if(t._id=n.id,"_rev"in t){if(t._rev!==i)return r(new Error("wrong doc returned"))}else t._rev=i;return r(null,{doc:t,metadata:n})})})}),K._getAttachment=function(e,t,r,n,o){var s=r.digest,u=r.content_type;Q.binaryStore.get(s,function(e,t){if(e)return"NotFoundError"!==e.name?o(e):o(null,n.binary?a(u):"");n.binary?o(null,i(t,u)):o(null,t.toString("base64"))})},K._bulkDocs=U(function(e,t,r){function n(e,t){E.get(Q.attachmentStore,e,function(r){if(r){var n=D.createError(D.MISSING_STUB,"unknown stub attachment with digest "+e);t(n)}else t()})}function i(e){function t(){if(++n===j.length)return e(r)}var r,n=0;j.forEach(function(e){if(e._id&&w.isLocalId(e._id))return t();E.get(Q.docStore,e._id,function(n,i){n?"NotFoundError"!==n.name&&(r=n):g.set(e._id,i),t()})})}function a(e,t){var r=d.resolve();e.forEach(function(e,t){r=r.then(function(){return new d(function(r,n){K._doCompactionNoLock(t,e,{ctx:E},function(e){if(e)return n(e);r()})})})}),r.then(function(){t()},t)}function s(e){var t=new h.Map;g.forEach(function(e,r){t.set(r,k.compactTree(e))}),a(t,e)}function c(){a(b,function(e){if(e&&m(e),K.auto_compaction)return s(m);m()})}function l(e,t,n,i,a,s,u,c){function l(e){_++,v||(e?c(v=e):_===x.length&&m())}function h(e,t,r,n){return function(i){p(e,N+i,t,r,n)}}function d(e,t,r){return function(n){S.binaryMd5(n,h(e,t,n,r))}}function m(){var t=e.metadata.rev_map[e.metadata.rev];if(t)return c();t=++F,e.metadata.rev_map[e.metadata.rev]=e.metadata.seq=t;var r=[{key:z(t),value:e.data,prefix:Q.bySeqStore,type:"put"},{key:e.metadata.id,value:e.metadata,prefix:Q.docStore,type:"put"}];E.batch(r),y[u]={ok:!0,id:e.metadata.id,rev:e.metadata.rev},g.set(e.metadata.id,e.metadata),c()}C+=s;var v=null,_=0;e.metadata.winningRev=t,e.metadata.deleted=n,e.data._id=e.metadata.id,e.data._rev=e.metadata.rev,i&&(e.data._deleted=!0),e.stemmedRevs.length&&b.set(e.metadata.id,e.stemmedRevs);for(var x=e.data._attachments?Object.keys(e.data._attachments):[],w=0;w<x.length;w++){var k=x[w],j=e.data._attachments[k];if(j.stub)f(e.data._id,e.data._rev,j.digest,l);else{var T;if("string"==typeof j.data){try{T=A.atob(j.data)}catch(e){return void r(D.createError(D.BAD_ARG,"Attachment is not a valid base64 string"))}d(e,k,l)(T)}else o(j.data,d(e,k,l))}}x.length||m()}function f(e,t,r,n){function i(){return new d(function(e,t){E.get(Q.attachmentStore,r,function(r,n){if(r&&"NotFoundError"!==r.name)return t(r);e(n)})})}function o(n){var i=[e,t].join("@"),o={};return n?n.refs&&(o.refs=n.refs,o.refs[i]=!0):(o.refs={},o.refs[i]=!0),new d(function(e){E.batch([{type:"put",prefix:Q.attachmentStore,key:r,value:o}]),e(!n)})}var a=R[r]||d.resolve();R[r]=a.then(function(){return i().then(o).then(function(e){n(null,e)},n)})}function p(e,t,r,n,i){var o=e.data._attachments[r];delete o.data,o.digest=t,o.length=n.length;var a=e.metadata.id,s=e.metadata.rev;o.revpos=parseInt(s,10),f(a,s,t,function(e,r){return e?i(e):0===n.length?i(e):r?(E.batch([{type:"put",prefix:Q.binaryStore,key:t,value:_(n,"binary")}]),void i()):i(e)})}function m(e){if(e)return x.nextTick(function(){r(e)});E.batch([{prefix:Q.metaStore,type:"put",key:P,value:F},{prefix:Q.metaStore,type:"put",key:I,value:X._docCount+C}]),E.execute(X,function(e){if(e)return r(e);X._docCount+=C,X._updateSeq=F,q.notify(Z),x.nextTick(function(){r(null,y)})})}var v=t.new_edits,y=new Array(e.docs.length),g=new h.Map,b=new h.Map,E=new u,C=0,F=X._updateSeq,j=e.docs,T=j.map(function(e){if(e._id&&w.isLocalId(e._id))return e;var t=w.parseDoc(e,v);return t.metadata&&!t.metadata.rev_map&&(t.metadata.rev_map={}),t}),O=T.filter(function(e){return e.error});if(O.length)return r(O[0]);var R={};if(!T.length)return r(null,[]);!function(e){var t=[];if(j.forEach(function(e){e&&e._attachments&&Object.keys(e._attachments).forEach(function(r){var n=e._attachments[r];n.stub&&t.push(n.digest)})}),!t.length)return e();var r,i=0;t.forEach(function(o){n(o,function(n){n&&!r&&(r=n),++i===t.length&&e(r)})})}(function(e){if(e)return r(e);i(function(e){if(e)return r(e);w.processDocs(Y,T,K,g,E,y,l,t,c)})})}),K._allDocs=G(function(e,t){e=x.clone(e),s(function(r,n){if(r)return t(r);var i={},o=e.skip||0;if(e.startkey&&(i.gte=e.startkey),e.endkey&&(i.lte=e.endkey),e.key&&(i.gte=i.lte=e.key),e.descending){i.reverse=!0;var a=i.lte;i.lte=i.gte,i.gte=a}var s;if("number"==typeof e.limit&&(s=e.limit),0===s||"start"in i&&"end"in i&&i.start>i.end)return t(null,{total_rows:n,offset:e.skip,rows:[]});var u=[],f=Q.docStore.readStream(i),h=y.obj(function(t,r,n){function i(t){var r={id:a.id,key:a.id,value:{rev:p}};if(e.include_docs){if(r.doc=t,r.doc._rev=r.value.rev,e.conflicts){var i=k.collectConflicts(a);i.length&&(r.doc._conflicts=i)}for(var o in r.doc._attachments)r.doc._attachments.hasOwnProperty(o)&&(r.doc._attachments[o].stub=!0)}if(!1===e.inclusive_end&&a.id===e.endkey)return n();if(h){if("ok"!==e.deleted)return n();r.value.deleted=!0,r.doc=null}u.push(r),n()}var a=t.value,p=c(a),h=l(a,p);if(h){if("ok"!==e.deleted)return void n()}else{if(o-- >0)return void n();if("number"==typeof s&&s--<=0)return f.unpipe(),f.destroy(),void n()}if(e.include_docs){var d=a.rev_map[p];Q.bySeqStore.get(z(d),function(e,t){i(t)})}else i()},function(r){d.resolve().then(function(){if(e.include_docs&&e.attachments)return p(u,Q,e)}).then(function(){t(null,{total_rows:n,offset:e.skip,rows:u})},t),r()}).on("unpipe",function(){h.end()});f.on("error",t),f.pipe(h)})}),K._changes=function(e){function t(){e.done=!0,l&&e.limit&&e.limit<o.length&&(o.length=e.limit),v.unpipe(g),v.destroy(),e.continuous||e.cancelled||(e.include_docs&&e.attachments?p(o,Q,e).then(function(){e.complete(null,{results:o,last_seq:a})}):e.complete(null,{results:o,last_seq:a}))}if((e=x.clone(e)).continuous){var r=Z+":"+x.uuid();return q.addListener(Z,r,K,e),q.notify(Z),{cancel:function(){q.removeListener(Z,r)}}}var n,i=e.descending,o=[],a=e.since||0,s=0,u={reverse:i};"limit"in e&&e.limit>0&&(n=e.limit),u.reverse||(u.start=z(e.since||0));var l,f=e.doc_ids&&new h.Set(e.doc_ids),d=x.filterChange(e),m=new h.Map;l="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var v=Q.bySeqStore.readStream(u),g=y.obj(function(r,u,h){function v(t){function r(r){var n=e.processChange(r,t,e);n.seq=t.seq;var i=d(n);if("object"==typeof i)return e.complete(i);i&&(s++,e.attachments&&e.include_docs?p([n],Q,e).then(function(){e.onChange(n)}):e.onChange(n),l&&o.push(n)),h()}var n=c(t);if(t.seq!==y)return h();if(a=y,n===g._rev)return r(g);var i=t.rev_map[n];Q.bySeqStore.get(z(i),function(e,t){r(t)})}if(n&&s>=n)return t(),h();if(e.cancelled||e.done)return h();var y=V(r.key),g=r.value;if(y===e.since&&!i)return h();if(f&&!f.has(g._id))return h();var b;if(b=m.get(g._id))return v(b);Q.docStore.get(g._id,function(t,r){if(e.cancelled||e.done||X.isClosed()||w.isLocalId(r.id))return h();m.set(g._id,r),v(r)})},function(t){if(e.cancelled)return t();l&&e.limit&&e.limit<o.length&&(o.length=e.limit),t()}).on("unpipe",function(){g.end(),t()});return v.pipe(g),{cancel:function(){e.cancelled=!0,t()}}},K._close=function(e){if(X.isClosed())return e(D.createError(D.NOT_OPEN));X.close(function(t){t?e(t):(ee.delete(Z),e())})},K._getRevisionTree=function(e,t){Q.docStore.get(e,function(e,r){e?t(D.createError(D.MISSING_DOC)):t(null,r.rev_tree)})},K._doCompaction=U(function(e,t,r,n){K._doCompactionNoLock(e,t,r,n)}),K._doCompactionNoLock=function(e,t,r,n){if("function"==typeof r&&(n=r,r={}),!t.length)return n();var i=r.ctx||new u;i.get(Q.docStore,e,function(o,a){function s(e){if(e&&(p=e),++m===t.length){if(p)return n(p);c()}}function u(e){return e?n(e):(i.batch(f),r.ctx?n():void i.execute(X,n))}function c(){function r(e){e&&(o=e),++a===n.length&&u(o)}var n=Object.keys(d);if(!n.length)return u();var o,a=0,s=new h.Map;t.forEach(function(t){s.set(e+"@"+t,!0)}),n.forEach(function(e){i.get(Q.attachmentStore,e,function(t,n){if(t)return"NotFoundError"===t.name?r():r(t);var i=Object.keys(n.refs||{}).filter(function(e){return!s.has(e)}),o={};i.forEach(function(e){o[e]=!0}),i.length?f.push({key:e,type:"put",value:{refs:o},prefix:Q.attachmentStore}):f=f.concat([{key:e,type:"del",prefix:Q.attachmentStore},{key:e,type:"del",prefix:Q.binaryStore}]),r()})})}if(o)return n(o);var l=t.map(function(e){var t=a.rev_map[e];return delete a.rev_map[e],t});k.traverseRevTree(a.rev_tree,function(e,r,n,i,o){var a=r+"-"+n;-1!==t.indexOf(a)&&(o.status="missing")});var f=[];f.push({key:a.id,value:a,type:"put",prefix:Q.docStore});var p,d={},m=0;l.forEach(function(e){f.push({key:z(e),type:"del",prefix:Q.bySeqStore}),i.get(Q.bySeqStore,z(e),function(e,t){if(e)return"NotFoundError"===e.name?s():s(e);Object.keys(t._attachments||{}).forEach(function(e){var r=t._attachments[e].digest;d[r]=!0}),s()})})})},K._getLocal=function(e,t){Q.localStore.get(e,function(e,r){e?t(D.createError(D.MISSING_DOC)):t(null,r)})},K._putLocal=function(e,t,r){"function"==typeof t&&(r=t,t={}),t.ctx?K._putLocalNoLock(e,t,r):K._putLocalWithLock(e,t,r)},K._putLocalWithLock=U(function(e,t,r){K._putLocalNoLock(e,t,r)}),K._putLocalNoLock=function(e,t,r){delete e._revisions;var n=e._rev,i=e._id,o=t.ctx||new u;o.get(Q.localStore,i,function(a,s){if(a&&n)return r(D.createError(D.REV_CONFLICT));if(s&&s._rev!==n)return r(D.createError(D.REV_CONFLICT));e._rev=n?"0-"+(parseInt(n.split("-")[1],10)+1):"0-1";var u=[{type:"put",prefix:Q.localStore,key:i,value:e}];o.batch(u);var c={ok:!0,id:e._id,rev:e._rev};if(t.ctx)return r(null,c);o.execute(X,function(e){if(e)return r(e);r(null,c)})})},K._removeLocal=function(e,t,r){"function"==typeof t&&(r=t,t={}),t.ctx?K._removeLocalNoLock(e,t,r):K._removeLocalWithLock(e,t,r)},K._removeLocalWithLock=U(function(e,t,r){K._removeLocalNoLock(e,t,r)}),K._removeLocalNoLock=function(e,t,r){var n=t.ctx||new u;n.get(Q.localStore,e._id,function(i,o){if(i)return r("NotFoundError"!==i.name?i:D.createError(D.MISSING_DOC));if(o._rev!==e._rev)return r(D.createError(D.REV_CONFLICT));n.batch([{prefix:Q.localStore,type:"del",key:e._id}]);var a={ok:!0,id:e._id,rev:"0-0"};if(t.ctx)return r(null,a);n.execute(X,function(e){if(e)return r(e);r(null,a)})})},K._destroy=function(e,t){var r,n=x.functionName(te);if(!B.has(n))return J(Z,t);(r=B.get(n)).has(Z)?(q.removeAllListeners(Z),r.get(Z).close(function(){r.delete(Z),J(Z,t)})):J(Z,t)}}},{argsarray:1,"buffer-from":4,"double-ended-queue":14,levelup:36,"pouchdb-adapter-utils":60,"pouchdb-binary-utils":61,"pouchdb-collections":62,"pouchdb-errors":63,"pouchdb-json":64,"pouchdb-md5":65,"pouchdb-merge":66,"pouchdb-promise":58,"pouchdb-utils":67,"sublevel-pouchdb":97,through2:109}],58:[function(e,t,r){"use strict";var n=function(e){return e&&"object"==typeof e&&"default"in e?e.default:e}(e("lie")),i="function"==typeof Promise?Promise:n;t.exports=i},{lie:40}],59:[function(e,t,r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function i(e,t){var r=o.assign({db:s},e);a.call(this,r,t)}var o=e("pouchdb-utils"),a=n(e("pouchdb-adapter-leveldb-core")),s=n(e("memdown"));i.valid=function(){return!0},i.use_prefix=!1;t.exports=function(e){e.adapter("memory",i,!0)}},{memdown:44,"pouchdb-adapter-leveldb-core":57,"pouchdb-utils":67}],60:[function(e,t,r){"use strict";function n(e){return e.reduce(function(e,t){return e[t]=!0,e},{})}function i(e){if(!/^\d+-./.test(e))return d.createError(d.INVALID_REV);var t=e.indexOf("-"),r=e.substring(0,t),n=e.substring(t+1);return{prefix:parseInt(r,10),id:n}}function o(e,t){for(var r=e.start-e.ids.length+1,n=e.ids,i=[n[0],t,[]],o=1,a=n.length;o<a;o++)i=[n[o],{status:"missing"},[i]];return[{pos:r,ids:i}]}function a(e,t){var r,n,a,s={status:"available"};if(e._deleted&&(s.deleted=!0),t)if(e._id||(e._id=h.uuid()),n=h.rev(),e._rev){if((a=i(e._rev)).error)return a;e._rev_tree=[{pos:a.prefix,ids:[a.id,{status:"missing"},[[n,s,[]]]]}],r=a.prefix+1}else e._rev_tree=[{pos:1,ids:[n,s,[]]}],r=1;else if(e._revisions&&(e._rev_tree=o(e._revisions,s),r=e._revisions.start,n=e._revisions.ids[0]),!e._rev_tree){if((a=i(e._rev)).error)return a;r=a.prefix,n=a.id,e._rev_tree=[{pos:r,ids:[n,s,[]]}]}h.invalidIdError(e._id),e._rev=r+"-"+n;var u={metadata:{},data:{}};for(var c in e)if(Object.prototype.hasOwnProperty.call(e,c)){var l="_"===c[0];if(l&&!b[c]){var f=d.createError(d.DOC_VALIDATION,c);throw f.message=d.DOC_VALIDATION.message+": "+c,f}l&&!_[c]?u.metadata[c.slice(1)]=e[c]:u.data[c]=e[c]}return u}function s(e){try{return v.atob(e)}catch(e){return{error:d.createError(d.BAD_ARG,"Attachment is not a valid base64 string")}}}function u(e,t,r){var n=s(e.data);if(n.error)return r(n.error);e.length=n.length,e.data="blob"===t?v.binaryStringToBlobOrBuffer(n,e.content_type):"base64"===t?v.btoa(n):n,y.binaryMd5(n,function(t){e.digest="md5-"+t,r()})}function c(e,t,r){y.binaryMd5(e.data,function(n){e.digest="md5-"+n,e.length=e.data.size||e.data.length||0,"binary"===t?v.blobOrBufferToBinaryString(e.data,function(t){e.data=t,r()}):"base64"===t?v.blobOrBufferToBase64(e.data,function(t){e.data=t,r()}):r()})}function l(e,t,r){if(e.stub)return r();"string"==typeof e.data?u(e,t,r):c(e,t,r)}function f(e,t,r,n,i,o,s,u){if(m.revExists(t.rev_tree,r.metadata.rev))return n[i]=r,o();var c=t.winningRev||m.winningRev(t),l="deleted"in t?t.deleted:m.isDeleted(t,c),f="deleted"in r.metadata?r.metadata.deleted:m.isDeleted(r.metadata),p=/^1-/.test(r.metadata.rev);if(l&&!f&&u&&p){var h=r.data;h._rev=c,h._id=r.metadata.id,r=a(h,u)}var v=m.merge(t.rev_tree,r.metadata.rev_tree[0],e);if(u&&(l&&f&&"new_leaf"!==v.conflicts||!l&&"new_leaf"!==v.conflicts||l&&!f&&"new_branch"===v.conflicts)){var y=d.createError(d.REV_CONFLICT);return n[i]=y,o()}var g=r.metadata.rev;r.metadata.rev_tree=v.tree,r.stemmedRevs=v.stemmedRevs||[],t.rev_map&&(r.metadata.rev_map=t.rev_map);var b=m.winningRev(r.metadata),_=m.isDeleted(r.metadata,b),x=l===_?0:l<_?-1:1;s(r,b,_,g===b?_:m.isDeleted(r.metadata,g),!0,x,i,o)}function p(e){return"missing"===e.metadata.rev_tree[0].ids[1].status}Object.defineProperty(r,"__esModule",{value:!0});var h=e("pouchdb-utils"),d=e("pouchdb-errors"),m=e("pouchdb-merge"),v=e("pouchdb-binary-utils"),y=e("pouchdb-md5"),g=e("pouchdb-collections"),b=n(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),_=n(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);r.invalidIdError=h.invalidIdError,r.isDeleted=m.isDeleted,r.isLocalId=m.isLocalId,r.normalizeDdocFunctionName=h.normalizeDdocFunctionName,r.parseDdocFunctionName=h.parseDdocFunctionName,r.parseDoc=a,r.preprocessAttachments=function(e,t,r){function n(){o++,e.length===o&&(i?r(i):r())}if(!e.length)return r();var i,o=0;e.forEach(function(e){var r=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],o=0;if(!r.length)return n();for(var a in e.data._attachments)e.data._attachments.hasOwnProperty(a)&&l(e.data._attachments[a],t,function(e){i=e,++o===r.length&&n()})})},r.processDocs=function(e,t,r,n,i,o,a,s,u){function c(e,t,r){var n=m.winningRev(e.metadata),i=m.isDeleted(e.metadata,n);if("was_delete"in s&&i)return o[t]=d.createError(d.MISSING_DOC,"deleted"),r();if(h&&p(e)){var u=d.createError(d.REV_CONFLICT);return o[t]=u,r()}a(e,n,i,i,!1,i?0:1,t,r)}function l(){++y===b&&u&&u()}e=e||1e3;var h=s.new_edits,v=new g.Map,y=0,b=t.length;t.forEach(function(e,t){if(e._id&&m.isLocalId(e._id)){var n=e._deleted?"_removeLocal":"_putLocal";r[n](e,{ctx:i},function(e,r){o[t]=e||r,l()})}else{var a=e.metadata.id;v.has(a)?(b--,v.get(a).push([e,t])):v.set(a,[[e,t]])}}),v.forEach(function(t,r){function i(){++u<t.length?s():l()}function s(){var s=t[u],l=s[0],p=s[1];if(n.has(r))f(e,n.get(r),l,o,p,i,a,h);else{var d=m.merge([],l.metadata.rev_tree[0],e);l.metadata.rev_tree=d.tree,l.stemmedRevs=d.stemmedRevs||[],c(l,p,i)}}var u=0;s()})},r.updateDoc=f},{"pouchdb-binary-utils":61,"pouchdb-collections":62,"pouchdb-errors":63,"pouchdb-md5":65,"pouchdb-merge":66,"pouchdb-utils":67}],61:[function(e,t,r){"use strict";function n(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)r.append(e[n]);return r.getBlob(t.type)}}function i(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),i=0;i<t;i++)n[i]=e.charCodeAt(i);return r}function o(e,t){return n([i(e)],{type:t})}function a(e){for(var t="",r=new Uint8Array(e),n=r.byteLength,i=0;i<n;i++)t+=String.fromCharCode(r[i]);return t}function s(e,t){if("undefined"==typeof FileReader)return t(a((new FileReaderSync).readAsArrayBuffer(e)));var r=new FileReader,n="function"==typeof r.readAsBinaryString;r.onloadend=function(e){var r=e.target.result||"";if(n)return t(r);t(a(r))},n?r.readAsBinaryString(e):r.readAsArrayBuffer(e)}function u(e,t){s(e,function(e){t(e)})}Object.defineProperty(r,"__esModule",{value:!0});var c=function(e){return atob(e)},l=function(e){return btoa(e)};r.atob=c,r.btoa=l,r.base64StringToBlobOrBuffer=function(e,t){return o(c(e),t)},r.binaryStringToArrayBuffer=i,r.binaryStringToBlobOrBuffer=o,r.blob=n,r.blobOrBufferToBase64=function(e,t){u(e,function(e){t(l(e))})},r.blobOrBufferToBinaryString=u,r.readAsArrayBuffer=function(e,t){if("undefined"==typeof FileReader)return t((new FileReaderSync).readAsArrayBuffer(e));var r=new FileReader;r.onloadend=function(e){var r=e.target.result||new ArrayBuffer(0);t(r)},r.readAsArrayBuffer(e)},r.readAsBinaryString=s,r.typedBuffer=function(){}},{}],62:[function(e,t,r){"use strict";function n(e){return"$"+e}function i(e){return e.substring(1)}function o(){this._store={}}function a(e){if(this._store=new o,e&&Array.isArray(e))for(var t=0,r=e.length;t<r;t++)this.add(e[t])}Object.defineProperty(r,"__esModule",{value:!0}),o.prototype.get=function(e){var t=n(e);return this._store[t]},o.prototype.set=function(e,t){var r=n(e);return this._store[r]=t,!0},o.prototype.has=function(e){return n(e)in this._store},o.prototype.delete=function(e){var t=n(e),r=t in this._store;return delete this._store[t],r},o.prototype.forEach=function(e){for(var t=Object.keys(this._store),r=0,n=t.length;r<n;r++){var o=t[r];e(this._store[o],o=i(o))}},Object.defineProperty(o.prototype,"size",{get:function(){return Object.keys(this._store).length}}),a.prototype.add=function(e){return this._store.set(e,!0)},a.prototype.has=function(e){return this._store.has(e)},a.prototype.forEach=function(e){this._store.forEach(function(t,r){e(r)})},Object.defineProperty(a.prototype,"size",{get:function(){return this._store.size}}),!function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}()?(r.Set=a,r.Map=o):(r.Set=Set,r.Map=Map)},{}],63:[function(e,t,r){"use strict";function n(e,t,r){Error.call(this,r),this.status=e,this.name=t,this.message=r,this.error=!0}Object.defineProperty(r,"__esModule",{value:!0}),function(e){return e&&"object"==typeof e&&"default"in e?e.default:e}(e("inherits"))(n,Error),n.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var i=new n(401,"unauthorized","Name or password is incorrect."),o=new n(400,"bad_request","Missing JSON list of 'docs'"),a=new n(404,"not_found","missing"),s=new n(409,"conflict","Document update conflict"),u=new n(400,"bad_request","_id field must contain a string"),c=new n(412,"missing_id","_id is required for puts"),l=new n(400,"bad_request","Only reserved document ids may start with underscore."),f=new n(412,"precondition_failed","Database not open"),p=new n(500,"unknown_error","Database encountered an unknown error"),h=new n(500,"badarg","Some query argument is invalid"),d=new n(400,"invalid_request","Request was invalid"),m=new n(400,"query_parse_error","Some query parameter is invalid"),v=new n(500,"doc_validation","Bad special document member"),y=new n(400,"bad_request","Something wrong with the request"),g=new n(400,"bad_request","Document must be a JSON object"),b=new n(404,"not_found","Database not found"),_=new n(500,"indexed_db_went_bad","unknown"),x=new n(500,"web_sql_went_bad","unknown"),w=new n(500,"levelDB_went_went_bad","unknown"),k=new n(403,"forbidden","Forbidden by design doc validate_doc_update function"),E=new n(400,"bad_request","Invalid rev format"),S=new n(412,"file_exists","The database could not be created, the file already exists."),A=new n(412,"missing_stub","A pre-existing attachment stub wasn't found"),D=new n(413,"invalid_url","Provided URL is invalid");r.UNAUTHORIZED=i,r.MISSING_BULK_DOCS=o,r.MISSING_DOC=a,r.REV_CONFLICT=s,r.INVALID_ID=u,r.MISSING_ID=c,r.RESERVED_ID=l,r.NOT_OPEN=f,r.UNKNOWN_ERROR=p,r.BAD_ARG=h,r.INVALID_REQUEST=d,r.QUERY_PARSE_ERROR=m,r.DOC_VALIDATION=v,r.BAD_REQUEST=y,r.NOT_AN_OBJECT=g,r.DB_MISSING=b,r.WSQ_ERROR=x,r.LDB_ERROR=w,r.FORBIDDEN=k,r.INVALID_REV=E,r.FILE_EXISTS=S,r.MISSING_STUB=A,r.IDB_ERROR=_,r.INVALID_URL=D,r.createError=function(e,t){function r(t){for(var r in e)"function"!=typeof e[r]&&(this[r]=e[r]);void 0!==t&&(this.reason=t)}return r.prototype=n.prototype,new r(t)},r.generateErrorFromResponse=function(e){if("object"!=typeof e){var t=e;(e=p).data=t}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}},{inherits:24}],64:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(e){return e&&"object"==typeof e&&"default"in e?e.default:e}(e("vuvuzela"));r.safeJsonParse=function(e){try{return JSON.parse(e)}catch(t){return n.parse(e)}},r.safeJsonStringify=function(e){try{return JSON.stringify(e)}catch(t){return n.stringify(e)}}},{vuvuzela:119}],65:[function(e,t,r){(function(t){"use strict";function n(e){return s.btoa(e)}function i(e,t,r){return e.webkitSlice?e.webkitSlice(t,r):e.slice(t,r)}function o(e,t,r,n,o){(r>0||n<t.size)&&(t=i(t,r,n)),s.readAsArrayBuffer(t,function(t){e.append(t),o()})}function a(e,t,r,n,i){(r>0||n<t.length)&&(t=t.substring(r,n)),e.appendBinary(t),i()}Object.defineProperty(r,"__esModule",{value:!0});var s=e("pouchdb-binary-utils"),u=function(e){return e&&"object"==typeof e&&"default"in e?e.default:e}(e("spark-md5")),c=t.setImmediate||t.setTimeout,l=32768;r.binaryMd5=function(e,t){function r(){c(s)}function i(){var e=n(v.end(!0));t(e),v.destroy()}function s(){var t=m*h,n=t+h;++m<d?y(v,e,t,n,r):y(v,e,t,n,i)}var f="string"==typeof e,p=f?e.length:e.size,h=Math.min(l,p),d=Math.ceil(p/h),m=0,v=f?new u:new u.ArrayBuffer,y=f?a:o;s()},r.stringMd5=function(e){return u.hash(e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"pouchdb-binary-utils":61,"spark-md5":80}],66:[function(e,t,r){"use strict";function n(e){for(var t,r,n,i,o=e.rev_tree.slice();i=o.pop();){var a=i.ids,s=a[2],u=i.pos;if(s.length)for(var c=0,l=s.length;c<l;c++)o.push({pos:u+1,ids:s[c]});else{var f=!!a[1].deleted,p=a[0];t&&!(n!==f?n:r!==u?r<u:t<p)||(t=p,r=u,n=f)}}return r+"-"+t}function i(e,t){for(var r,n=e.slice();r=n.pop();)for(var i=r.pos,o=r.ids,a=o[2],s=t(0===a.length,i,o[0],r.ctx,o[1]),u=0,c=a.length;u<c;u++)n.push({pos:i+1,ids:a[u],ctx:s})}function o(e,t){return e.pos-t.pos}function a(e){var t=[];i(e,function(e,r,n,i,o){e&&t.push({rev:r+"-"+n,pos:r,opts:o})}),t.sort(o).reverse();for(var r=0,n=t.length;r<n;r++)delete t[r].pos;return t}function s(e){for(var t,r=[],n=e.slice();t=n.pop();){var i=t.pos,o=t.ids,a=o[0],s=o[1],u=o[2],c=0===u.length,l=t.history?t.history.slice():[];l.push({id:a,opts:s}),c&&r.push({pos:i+1-l.length,ids:l});for(var f=0,p=u.length;f<p;f++)n.push({pos:i+1,ids:u[f],history:l})}return r.reverse()}function u(e,t){return e.pos-t.pos}function c(e,t,r){for(var n,i=0,o=e.length;i<o;)r(e[n=i+o>>>1],t)<0?i=n+1:o=n;return i}function l(e,t,r){var n=c(e,t,r);e.splice(n,0,t)}function f(e,t){for(var r,n,i=t,o=e.length;i<o;i++){var a=e[i],s=[a.id,a.opts,[]];n?(n[2].push(s),n=s):r=n=s}return r}function p(e,t){return e[0]<t[0]?-1:1}function h(e,t){for(var r=[{tree1:e,tree2:t}],n=!1;r.length>0;){var i=r.pop(),o=i.tree1,a=i.tree2;(o[1].status||a[1].status)&&(o[1].status="available"===o[1].status||"available"===a[1].status?"available":"missing");for(var s=0;s<a[2].length;s++)if(o[2][0]){for(var u=!1,c=0;c<o[2].length;c++)o[2][c][0]===a[2][s][0]&&(r.push({tree1:o[2][c],tree2:a[2][s]}),u=!0);u||(n="new_branch",l(o[2],a[2][s],p))}else n="new_leaf",o[2][0]=a[2][s]}return{conflicts:n,tree:e}}function d(e,t,r){var n,i=[],o=!1,a=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var s=0,c=e.length;s<c;s++){var l=e[s];if(l.pos===t.pos&&l.ids[0]===t.ids[0])n=h(l.ids,t.ids),i.push({pos:l.pos,ids:n.tree}),o=o||n.conflicts,a=!0;else if(!0!==r){var f=l.pos<t.pos?l:t,p=l.pos<t.pos?t:l,d=p.pos-f.pos,m=[],v=[];for(v.push({ids:f.ids,diff:d,parent:null,parentIdx:null});v.length>0;){var y=v.pop();if(0!==y.diff)for(var g=y.ids[2],b=0,_=g.length;b<_;b++)v.push({ids:g[b],diff:y.diff-1,parent:y.ids,parentIdx:b});else y.ids[0]===p.ids[0]&&m.push(y)}var x=m[0];x?(n=h(x.ids,p.ids),x.parent[2][x.parentIdx]=n.tree,i.push({pos:f.pos,ids:f.ids}),o=o||n.conflicts,a=!0):i.push(l)}else i.push(l)}return a||i.push(t),i.sort(u),{tree:i,conflicts:o||"internal_node"}}function m(e,t){for(var r,n,o=s(e),a=0,u=o.length;a<u;a++){var c,l=o[a],p=l.ids;if(p.length>t){r||(r={});var h=p.length-t;c={pos:l.pos+h,ids:f(p,h)};for(var m=0;m<h;m++){var v=l.pos+m+"-"+p[m].id;r[v]=!0}}else c={pos:l.pos,ids:f(p,0)};n=n?d(n,c,!0).tree:[c]}return r&&i(n,function(e,t,n){delete r[t+"-"+n]}),{tree:n,revs:r?Object.keys(r):[]}}function v(e){return e.ids}Object.defineProperty(r,"__esModule",{value:!0}),r.collectConflicts=function(e){for(var t=n(e),r=a(e.rev_tree),i=[],o=0,s=r.length;o<s;o++){var u=r[o];u.rev===t||u.opts.deleted||i.push(u.rev)}return i},r.collectLeaves=a,r.compactTree=function(e){var t=[];return i(e.rev_tree,function(e,r,n,i,o){"available"!==o.status||e||(t.push(r+"-"+n),o.status="missing")}),t},r.isDeleted=function(e,t){t||(t=n(e));for(var r,i=t.substring(t.indexOf("-")+1),o=e.rev_tree.map(v);r=o.pop();){if(r[0]===i)return!!r[1].deleted;o=o.concat(r[2])}},r.isLocalId=function(e){return/^_local/.test(e)},r.merge=function(e,t,r){var n=d(e,t),i=m(n.tree,r);return{tree:i.tree,stemmedRevs:i.revs,conflicts:n.conflicts}},r.revExists=function(e,t){for(var r,n=e.slice(),i=t.split("-"),o=parseInt(i[0],10),a=i[1];r=n.pop();){if(r.pos===o&&r.ids[0]===a)return!0;for(var s=r.ids[2],u=0,c=s.length;u<c;u++)n.push({pos:r.pos+1,ids:s[u]})}return!1},r.rootToLeaf=s,r.traverseRevTree=i,r.winningRev=n,r.latest=function(e,t){for(var r,n=t.rev_tree.slice();r=n.pop();){var i=r.pos,o=r.ids,a=o[0],s=o[1],u=o[2],c=0===u.length,l=r.history?r.history.slice():[];if(l.push({id:a,pos:i,opts:s}),c)for(var f=0,p=l.length;f<p;f++){var h=l[f];if(h.pos+"-"+h.id===e)return i+"-"+a}for(var d=0,m=u.length;d<m;d++)n.push({pos:i+1,ids:u[d],history:l})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}},{}],67:[function(e,t,r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function i(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer||"undefined"!=typeof Blob&&e instanceof Blob}function o(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),r=new Uint8Array(t),n=new Uint8Array(e);return r.set(n),t}function a(e){if(e instanceof ArrayBuffer)return o(e);var t=e.size,r=e.type;return"function"==typeof e.slice?e.slice(0,t,r):e.webkitSlice(0,t,r)}function s(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var r=t.constructor;return"function"==typeof r&&r instanceof r&&B.call(r)==P}function u(e){var t,r,n;if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(t=[],r=0,n=e.length;r<n;r++)t[r]=u(e[r]);return t}if(e instanceof Date)return e.toISOString();if(i(e))return a(e);if(!s(e))return e;t={};for(r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=u(e[r]);void 0!==o&&(t[r]=o)}return t}function c(e){var t=!1;return D(function(r){if(t)throw new Error("once called more than once");t=!0,e.apply(this,r)})}function l(e){return D(function(t){var r=this,n="function"==typeof(t=u(t))[t.length-1]&&t.pop(),i=new A(function(n,i){var o;try{var a=c(function(e,t){e?i(e):n(t)});t.push(a),(o=e.apply(r,t))&&"function"==typeof o.then&&n(o)}catch(e){i(e)}});return n&&i.then(function(e){n(null,e)},n),i})}function f(e,t,r){if(e.constructor.listeners("debug").length){for(var n=["api",e.name,t],i=0;i<r.length-1;i++)n.push(r[i]);e.constructor.emit("debug",n);var o=r[r.length-1];r[r.length-1]=function(r,n){var i=["api",e.name,t];i=i.concat(r?["error",r]:["success",n]),e.constructor.emit("debug",i),o(r,n)}}}function p(e,t){for(var r={},n=0,i=t.length;n<i;n++){var o=t[n];o in e&&(r[o]=e[o])}return r}function h(e){return e}function d(e){return[{ok:e}]}function m(){return"undefined"!=typeof chrome&&void 0!==chrome.storage&&void 0!==chrome.storage.local}function v(){return S}function y(e){m()?chrome.storage.onChanged.addListener(function(t){null!=t.db_name&&e.emit(t.dbName.newValue)}):v()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(t){e.emit(t.key)}):window.attachEvent("storage",function(t){e.emit(t.key)}))}function g(){F.EventEmitter.call(this),this._listeners={},y(this)}function b(e){if("undefined"!==console&&e in console){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function _(e,t){return e=parseInt(e,10)||0,(t=parseInt(t,10))!==t||t<=e?t=(e||1)<<1:t+=1,t>6e5&&(e=3e5,t=6e5),~~((t-e)*Math.random()+e)}function x(e,t,r){try{return!e(t,r)}catch(e){var n="Filter function threw: "+e.toString();return O.createError(O.BAD_REQUEST,n)}}function w(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}function k(e,t,r){return new A(function(n,i){e.get(t,function(o,a){if(o){if(404!==o.status)return i(o);a={}}var s=a._rev,u=r(a);if(!u)return n({updated:!1,rev:s});u._id=t,u._rev=s,n(E(e,u,r))})})}function E(e,t,r){return e.put(t).then(function(e){return{updated:!0,rev:e.rev}},function(n){if(409!==n.status)throw n;return k(e,t._id,r)})}Object.defineProperty(r,"__esModule",{value:!0});var S,A=n(e("pouchdb-promise")),D=n(e("argsarray")),C=e("pouchdb-collections"),F=e("events"),j=n(e("inherits")),T=n(e("immediate")),O=e("pouchdb-errors"),R=n(e("uuid/v4")),B=Function.prototype.toString,P=B.call(Object),I=6;if(m())S=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),S=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){S=!1}j(g,F.EventEmitter),g.prototype.addListener=function(e,t,r,n){function i(){if(o._listeners[t])if(a)a="waiting";else{a=!0;var e=p(n,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);r.changes(e).on("change",function(e){e.seq>n.since&&!n.cancelled&&(n.since=e.seq,n.onChange(e))}).on("complete",function(){"waiting"===a&&T(i),a=!1}).on("error",function(){a=!1})}}if(!this._listeners[t]){var o=this,a=!1;this._listeners[t]=i,this.on(e,i)}},g.prototype.removeListener=function(e,t){t in this._listeners&&(F.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},g.prototype.notifyLocalWindows=function(e){m()?chrome.storage.local.set({dbName:e}):v()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},g.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var L,N,M=L="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},q=N=function(){}.name?function(e){return e.name}:function(e){return e.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]},$=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],W="queryKey",U=/(?:^|&)([^&=]*)=?([^&]*)/g,G=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,z=R;r.adapterFun=function(e,t){return l(D(function(r){if(this._closed)return A.reject(new Error("database is closed"));if(this._destroyed)return A.reject(new Error("database is destroyed"));var n=this;return f(n,e,r),this.taskqueue.isReady?t.apply(this,r):new A(function(t,i){n.taskqueue.addTask(function(o){o?i(o):t(n[e].apply(n,r))})})}))},r.assign=M,r.bulkGetShim=function(e,t,r){function n(){var e=[];m.forEach(function(t){t.docs.forEach(function(r){e.push({id:t.id,docs:[r]})})}),r(null,{results:e})}function i(){++f===l&&n()}function o(e,t,r){m[e]={id:t,docs:r},i()}function a(){if(!(y>=v.length)){var e=Math.min(y+I,v.length),t=v.slice(y,e);s(t,y),y+=t.length}}function s(r,n){r.forEach(function(r,i){var s=n+i,u=c.get(r),l=p(u[0],["atts_since","attachments"]);l.open_revs=u.map(function(e){return e.rev}),l.open_revs=l.open_revs.filter(h);var f=h;0===l.open_revs.length&&(delete l.open_revs,f=d),["revs","attachments","binary","ajax","latest"].forEach(function(e){e in t&&(l[e]=t[e])}),e.get(r,l,function(e,t){var n;n=e?[{error:e}]:f(t),o(s,r,n),a()})})}var u=t.docs,c=new C.Map;u.forEach(function(e){c.has(e.id)?c.get(e.id).push(e):c.set(e.id,[e])});var l=c.size,f=0,m=new Array(l),v=[];c.forEach(function(e,t){v.push(t)});var y=0;a()},r.changesHandler=g,r.clone=u,r.defaultBackOff=function(e){var t=0;return e||(t=2e3),_(e,t)},r.explainError=function(e,t){b("info","The above "+e+" is totally normal. "+t)},r.filterChange=function(e){var t={},r=e.filter&&"function"==typeof e.filter;return t.query=e.query_params,function(n){n.doc||(n.doc={});var i=r&&x(e.filter,n.doc,t);if("object"==typeof i)return i;if(i)return!1;if(e.include_docs){if(!e.attachments)for(var o in n.doc._attachments)n.doc._attachments.hasOwnProperty(o)&&(n.doc._attachments[o].stub=!0)}else delete n.doc;return!0}},r.flatten=function(e){for(var t=[],r=0,n=e.length;r<n;r++)t=t.concat(e[r]);return t},r.functionName=q,r.guardedConsole=b,r.hasLocalStorage=v,r.invalidIdError=function(e){var t;if(e?"string"!=typeof e?t=O.createError(O.INVALID_ID):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=O.createError(O.RESERVED_ID)):t=O.createError(O.MISSING_ID),t)throw t},r.isChromeApp=m,r.isCordova=function(){return"undefined"!=typeof cordova||"undefined"!=typeof PhoneGap||"undefined"!=typeof phonegap},r.isRemote=function(e){return"boolean"==typeof e._remote?e._remote:"function"==typeof e.type&&(b("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===e.type())},r.listenerCount=function(e,t){return"listenerCount"in e?e.listenerCount(t):F.EventEmitter.listenerCount(e,t)},r.nextTick=T,r.normalizeDdocFunctionName=function(e){var t=w(e);return t?t.join("/"):null},r.once=c,r.parseDdocFunctionName=w,r.parseUri=function(e){for(var t=G.exec(e),r={},n=14;n--;){var i=$[n],o=t[n]||"",a=-1!==["user","password"].indexOf(i);r[i]=a?decodeURIComponent(o):o}return r[W]={},r[$[12]].replace(U,function(e,t,n){t&&(r[W][t]=n)}),r},r.pick=p,r.rev=function(){return R().replace(/-/g,"").toLowerCase()},r.scopeEval=function(e,t){var r=[],n=[];for(var i in t)t.hasOwnProperty(i)&&(r.push(i),n.push(t[i]));return r.push(e),Function.apply(null,r).apply(null,n)},r.toPromise=l,r.upsert=k,r.uuid=z},{argsarray:1,events:18,immediate:23,inherits:24,"pouchdb-collections":62,"pouchdb-errors":63,"pouchdb-promise":68,"uuid/v4":117}],68:[function(e,t,r){arguments[4][58][0].apply(r,arguments)},{dup:58,lie:40}],69:[function(e,t,r){(function(e){"use strict";!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports=function(t,r,n,i){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var o,a,s=arguments.length;switch(s){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick(function(){t.call(null,r)});case 3:return e.nextTick(function(){t.call(null,r,n)});case 4:return e.nextTick(function(){t.call(null,r,n,i)});default:for(o=new Array(s-1),a=0;a<o.length;)o[a++]=arguments[a];return e.nextTick(function(){t.apply(null,o)})}}:t.exports=e.nextTick}).call(this,e("_process"))},{_process:70}],70:[function(e,t,r){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(f===setTimeout)return setTimeout(e,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function a(e){if(p===clearTimeout)return clearTimeout(e);if((p===i||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(e);try{return p(e)}catch(t){try{return p.call(null,e)}catch(t){return p.call(this,e)}}}function s(){v&&d&&(v=!1,d.length?m=d.concat(m):y=-1,m.length&&u())}function u(){if(!v){var e=o(s);v=!0;for(var t=m.length;t;){for(d=m,m=[];++y<t;)d&&d[y].run();y=-1,t=m.length}d=null,v=!1,a(e)}}function c(e,t){this.fun=e,this.array=t}function l(){}var f,p,h=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(e){f=n}try{p="function"==typeof clearTimeout?clearTimeout:i}catch(e){p=i}}();var d,m=[],v=!1,y=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];m.push(new c(e,t)),1!==m.length||v||o(u)},c.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=l,h.addListener=l,h.once=l,h.off=l,h.removeListener=l,h.removeAllListeners=l,h.emit=l,h.prependListener=l,h.prependOnceListener=l,h.listeners=function(e){return[]},h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],71:[function(e,t,r){arguments[4][17][0].apply(r,arguments)},{dup:17}],72:[function(e,t,r){(function(r){function n(e){if(!(this instanceof n))return new n(e);s.call(this,e),u.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",i)}function i(){this.allowHalfOpen||this._writableState.ended||r.nextTick(this.end.bind(this))}t.exports=n;var o=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t},a=e("core-util-is");a.inherits=e("inherits");var s=e("./_stream_readable"),u=e("./_stream_writable");a.inherits(n,s),function(e,t){for(var r=0,n=e.length;r<n;r++)t(e[r],r)}(o(u.prototype),function(e){n.prototype[e]||(n.prototype[e]=u.prototype[e])})}).call(this,e("_process"))},{"./_stream_readable":74,"./_stream_writable":76,_process:70,"core-util-is":6,inherits:24}],73:[function(e,t,r){function n(e){if(!(this instanceof n))return new n(e);i.call(this,e)}t.exports=n;var i=e("./_stream_transform"),o=e("core-util-is");o.inherits=e("inherits"),o.inherits(n,i),n.prototype._transform=function(e,t,r){r(null,e)}},{"./_stream_transform":75,"core-util-is":6,inherits:24}],74:[function(e,t,r){(function(r){function n(t,r){var n=(t=t||{}).highWaterMark;this.highWaterMark=n||0===n?n:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!t.objectMode,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(C||(C=e("string_decoder/").StringDecoder),this.decoder=new C(t.encoding),this.encoding=t.encoding)}function i(e){if(!(this instanceof i))return new i(e);this._readableState=new n(e,this),this.readable=!0,A.call(this)}function o(e,t,r,n,i){var o=c(t,r);if(o)e.emit("error",o);else if(null===r||void 0===r)t.reading=!1,t.ended||l(e,t);else if(t.objectMode||r&&r.length>0)if(t.ended&&!i){s=new Error("stream.push() after EOF");e.emit("error",s)}else if(t.endEmitted&&i){var s=new Error("stream.unshift() after end event");e.emit("error",s)}else!t.decoder||i||n||(r=t.decoder.write(r)),t.length+=t.objectMode?1:r.length,i?t.buffer.unshift(r):(t.reading=!1,t.buffer.push(r)),t.needReadable&&f(e),h(e,t);else i||(t.reading=!1);return a(t)}function a(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function s(e){if(e>=F)e=F;else{e--;for(var t=1;t<32;t<<=1)e|=e>>t;e++}return e}function u(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:null===e||isNaN(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:e<=0?0:(e>t.highWaterMark&&(t.highWaterMark=s(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function c(e,t){var r=null;return E.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk")),r}function l(e,t){if(t.decoder&&!t.ended){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.length>0?f(e):_(e)}function f(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,t.sync?r.nextTick(function(){p(e)}):p(e))}function p(e){e.emit("readable")}function h(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(function(){d(e,t)}))}function d(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function m(e){return function(){var t=e._readableState;t.awaitDrain--,0===t.awaitDrain&&v(e)}}function v(e){function t(e,t,i){!1===e.write(r)&&n.awaitDrain++}var r,n=e._readableState;for(n.awaitDrain=0;n.pipesCount&&null!==(r=e.read());)if(1===n.pipesCount?t(n.pipes):x(n.pipes,t),e.emit("data",r),n.awaitDrain>0)return;if(0===n.pipesCount)return n.flowing=!1,void(S.listenerCount(e,"data")>0&&g(e));n.ranOut=!0}function y(){this._readableState.ranOut&&(this._readableState.ranOut=!1,v(this))}function g(e,t){if(e._readableState.flowing)throw new Error("Cannot switch to old mode now.");var n=t||!1,i=!1;e.readable=!0,e.pipe=A.prototype.pipe,e.on=e.addListener=A.prototype.on,e.on("readable",function(){i=!0;for(var t;!n&&null!==(t=e.read());)e.emit("data",t);null===t&&(i=!1,e._readableState.needReadable=!0)}),e.pause=function(){n=!0,this.emit("pause")},e.resume=function(){n=!1,i?r.nextTick(function(){e.emit("readable")}):this.read(0),this.emit("resume")},e.emit("readable")}function b(e,t){var r,n=t.buffer,i=t.length,o=!!t.decoder,a=!!t.objectMode;if(0===n.length)return null;if(0===i)r=null;else if(a)r=n.shift();else if(!e||e>=i)r=o?n.join(""):E.concat(n,i),n.length=0;else if(e<n[0].length)r=(l=n[0]).slice(0,e),n[0]=l.slice(e);else if(e===n[0].length)r=n.shift();else{r=o?"":new E(e);for(var s=0,u=0,c=n.length;u<c&&s<e;u++){var l=n[0],f=Math.min(e-s,l.length);o?r+=l.slice(0,f):l.copy(r,s,0,f),f<l.length?n[0]=l.slice(f):n.shift(),s+=f}}return r}function _(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");!t.endEmitted&&t.calledRead&&(t.ended=!0,r.nextTick(function(){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}))}function x(e,t){for(var r=0,n=e.length;r<n;r++)t(e[r],r)}function w(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}t.exports=i;var k=e("isarray"),E=e("buffer").Buffer;i.ReadableState=n;var S=e("events").EventEmitter;S.listenerCount||(S.listenerCount=function(e,t){return e.listeners(t).length});var A=e("stream"),D=e("core-util-is");D.inherits=e("inherits");var C;D.inherits(i,A),i.prototype.push=function(e,t){var r=this._readableState;return"string"!=typeof e||r.objectMode||(t=t||r.defaultEncoding)!==r.encoding&&(e=new E(e,t),t=""),o(this,r,e,t,!1)},i.prototype.unshift=function(e){return o(this,this._readableState,e,"",!0)},i.prototype.setEncoding=function(t){C||(C=e("string_decoder/").StringDecoder),this._readableState.decoder=new C(t),this._readableState.encoding=t};var F=8388608;i.prototype.read=function(e){var t=this._readableState;t.calledRead=!0;var r,n=e;if(("number"!=typeof e||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f(this),null;if(0===(e=u(e,t))&&t.ended)return r=null,t.length>0&&t.decoder&&(r=b(e,t),t.length-=r.length),0===t.length&&_(this),r;var i=t.needReadable;return t.length-e<=t.highWaterMark&&(i=!0),(t.ended||t.reading)&&(i=!1),i&&(t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),i&&!t.reading&&(e=u(n,t)),null===(r=e>0?b(e,t):null)&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),t.ended&&!t.endEmitted&&0===t.length&&_(this),r},i.prototype._read=function(e){this.emit("error",new Error("not implemented"))},i.prototype.pipe=function(e,t){function n(e){e===l&&o()}function i(){e.end()}function o(){e.removeListener("close",s),e.removeListener("finish",u),e.removeListener("drain",h),e.removeListener("error",a),e.removeListener("unpipe",n),l.removeListener("end",i),l.removeListener("end",o),e._writableState&&!e._writableState.needDrain||h()}function a(t){c(),e.removeListener("error",a),0===S.listenerCount(e,"error")&&e.emit("error",t)}function s(){e.removeListener("finish",u),c()}function u(){e.removeListener("close",s),c()}function c(){l.unpipe(e)}var l=this,f=this._readableState;switch(f.pipesCount){case 0:f.pipes=e;break;case 1:f.pipes=[f.pipes,e];break;default:f.pipes.push(e)}f.pipesCount+=1;var p=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?i:o;f.endEmitted?r.nextTick(p):l.once("end",p),e.on("unpipe",n);var h=m(l);return e.on("drain",h),e._events&&e._events.error?k(e._events.error)?e._events.error.unshift(a):e._events.error=[a,e._events.error]:e.on("error",a),e.once("close",s),e.once("finish",u),e.emit("pipe",l),f.flowing||(this.on("readable",y),f.flowing=!0,r.nextTick(function(){v(l)})),e},i.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,this.removeListener("readable",y),t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var r=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,this.removeListener("readable",y),t.flowing=!1;for(var i=0;i<n;i++)r[i].emit("unpipe",this);return this}return-1===(i=w(t.pipes,e))?this:(t.pipes.splice(i,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},i.prototype.on=function(e,t){var r=A.prototype.on.call(this,e,t);if("data"!==e||this._readableState.flowing||g(this),"readable"===e&&this.readable){var n=this._readableState;n.readableListening||(n.readableListening=!0,n.emittedReadable=!1,n.needReadable=!0,n.reading?n.length&&f(this):this.read(0))}return r},i.prototype.addListener=i.prototype.on,i.prototype.resume=function(){g(this),this.read(0),this.emit("resume")},i.prototype.pause=function(){g(this,!0),this.emit("pause")},i.prototype.wrap=function(e){var t=this._readableState,r=!1,n=this;e.on("end",function(){if(t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&n.push(e)}n.push(null)}),e.on("data",function(i){t.decoder&&(i=t.decoder.write(i)),(!t.objectMode||null!==i&&void 0!==i)&&(t.objectMode||i&&i.length)&&(n.push(i)||(r=!0,e.pause()))});for(var i in e)"function"==typeof e[i]&&void 0===this[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));return x(["error","close","destroy","pause","resume"],function(t){e.on(t,n.emit.bind(n,t))}),n._read=function(t){r&&(r=!1,e.resume())},n},i._fromList=b}).call(this,e("_process"))},{_process:70,buffer:5,"core-util-is":6,events:18,inherits:24,isarray:77,stream:81,"string_decoder/":96}],75:[function(e,t,r){function n(e,t){this.afterTransform=function(e,r){return i(t,e,r)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function i(e,t,r){var n=e._transformState;n.transforming=!1;var i=n.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));n.writechunk=null,n.writecb=null,null!==r&&void 0!==r&&e.push(r),i&&i(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}function o(e){if(!(this instanceof o))return new o(e);s.call(this,e);this._transformState=new n(e,this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",function(){"function"==typeof this._flush?this._flush(function(e){a(t,e)}):a(t)})}function a(e,t){if(t)return e.emit("error",t);var r=e._writableState,n=(e._readableState,e._transformState);if(r.length)throw new Error("calling transform done when ws.length != 0");if(n.transforming)throw new Error("calling transform done when still transforming");return e.push(null)}t.exports=o;var s=e("./_stream_duplex"),u=e("core-util-is");u.inherits=e("inherits"),u.inherits(o,s),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,s.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,r){throw new Error("not implemented")},o.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},{"./_stream_duplex":72,"core-util-is":6,inherits:24}],76:[function(e,t,r){(function(r){function n(e,t,r){this.chunk=e,this.encoding=t,this.callback=r}function i(e,t){var r=(e=e||{}).highWaterMark;this.highWaterMark=r||0===r?r:16384,this.objectMode=!!e.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var n=!1===e.decodeStrings;this.decodeStrings=!n,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){h(t,e)},this.writecb=null,this.writelen=0,this.buffer=[],this.errorEmitted=!1}function o(t){var r=e("./_stream_duplex");if(!(this instanceof o||this instanceof r))return new o(t);this._writableState=new i(t,this),this.writable=!0,w.call(this)}function a(e,t,n){var i=new Error("write after end");e.emit("error",i),r.nextTick(function(){n(i)})}function s(e,t,n,i){var o=!0;if(!_.isBuffer(n)&&"string"!=typeof n&&null!==n&&void 0!==n&&!t.objectMode){var a=new TypeError("Invalid non-string/buffer chunk");e.emit("error",a),r.nextTick(function(){i(a)}),o=!1}return o}function u(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=new _(t,r)),t}function c(e,t,r,i,o){r=u(t,r,i),_.isBuffer(r)&&(i="buffer");var a=t.objectMode?1:r.length;t.length+=a;var s=t.length<t.highWaterMark;return s||(t.needDrain=!0),t.writing?t.buffer.push(new n(r,i,o)):l(e,t,a,r,i,o),s}function l(e,t,r,n,i,o){t.writelen=r,t.writecb=o,t.writing=!0,t.sync=!0,e._write(n,i,t.onwrite),t.sync=!1}function f(e,t,n,i,o){n?r.nextTick(function(){o(i)}):o(i),e._writableState.errorEmitted=!0,e.emit("error",i)}function p(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function h(e,t){var n=e._writableState,i=n.sync,o=n.writecb;if(p(n),t)f(e,n,i,t,o);else{var a=y(e,n);a||n.bufferProcessing||!n.buffer.length||v(e,n),i?r.nextTick(function(){d(e,n,a,o)}):d(e,n,a,o)}}function d(e,t,r,n){r||m(e,t),n(),r&&g(e,t)}function m(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function v(e,t){t.bufferProcessing=!0;for(var r=0;r<t.buffer.length;r++){var n=t.buffer[r],i=n.chunk,o=n.encoding,a=n.callback;if(l(e,t,t.objectMode?1:i.length,i,o,a),t.writing){r++;break}}t.bufferProcessing=!1,r<t.buffer.length?t.buffer=t.buffer.slice(r):t.buffer.length=0}function y(e,t){return t.ending&&0===t.length&&!t.finished&&!t.writing}function g(e,t){var r=y(e,t);return r&&(t.finished=!0,e.emit("finish")),r}function b(e,t,n){t.ending=!0,g(e,t),n&&(t.finished?r.nextTick(n):e.once("finish",n)),t.ended=!0}t.exports=o;var _=e("buffer").Buffer;o.WritableState=i;var x=e("core-util-is");x.inherits=e("inherits");var w=e("stream");x.inherits(o,w),o.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},o.prototype.write=function(e,t,r){var n=this._writableState,i=!1;return"function"==typeof t&&(r=t,t=null),_.isBuffer(e)?t="buffer":t||(t=n.defaultEncoding),"function"!=typeof r&&(r=function(){}),n.ended?a(this,0,r):s(this,n,e,r)&&(i=c(this,n,e,t,r)),i},o.prototype._write=function(e,t,r){r(new Error("not implemented"))},o.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),void 0!==e&&null!==e&&this.write(e,t),n.ending||n.finished||b(this,n,r)}}).call(this,e("_process"))},{"./_stream_duplex":72,_process:70,buffer:5,"core-util-is":6,inherits:24,stream:81}],77:[function(e,t,r){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],78:[function(e,t,r){var n=e("stream");(r=t.exports=e("./lib/_stream_readable.js")).Stream=n,r.Readable=r,r.Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":72,"./lib/_stream_passthrough.js":73,"./lib/_stream_readable.js":74,"./lib/_stream_transform.js":75,"./lib/_stream_writable.js":76,stream:81}],79:[function(e,t,r){function n(e,t){for(var r in e)t[r]=e[r]}function i(e,t,r){return a(e,t,r)}var o=e("buffer"),a=o.Buffer;a.from&&a.alloc&&a.allocUnsafe&&a.allocUnsafeSlow?t.exports=o:(n(o,r),r.Buffer=i),n(a,i),i.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return a(e,t,r)},i.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=a(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},i.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return a(e)},i.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return o.SlowBuffer(e)}},{buffer:5}],80:[function(e,t,r){!function(e){if("object"==typeof r)t.exports=e();else{var n;try{n=window}catch(e){n=self}n.SparkMD5=e()}}(function(e){"use strict";function t(e,t){var r=e[0],n=e[1],i=e[2],o=e[3];n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&i)+t[1]-389564586|0)<<12|o>>>20)+r|0)&r|~o&n)+t[2]+606105819|0)<<17|i>>>15)+o|0)&o|~i&r)+t[3]-1044525330|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&i)+t[5]+1200080426|0)<<12|o>>>20)+r|0)&r|~o&n)+t[6]-1473231341|0)<<17|i>>>15)+o|0)&o|~i&r)+t[7]-45705983|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&i)+t[9]-1958414417|0)<<12|o>>>20)+r|0)&r|~o&n)+t[10]-42063|0)<<17|i>>>15)+o|0)&o|~i&r)+t[11]-1990404162|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&i)+t[13]-40341101|0)<<12|o>>>20)+r|0)&r|~o&n)+t[14]-1502002290|0)<<17|i>>>15)+o|0)&o|~i&r)+t[15]+1236535329|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[1]-165796510|0)<<5|r>>>27)+n|0)&i|n&~i)+t[6]-1069501632|0)<<9|o>>>23)+r|0)&n|r&~n)+t[11]+643717713|0)<<14|i>>>18)+o|0)&r|o&~r)+t[0]-373897302|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[5]-701558691|0)<<5|r>>>27)+n|0)&i|n&~i)+t[10]+38016083|0)<<9|o>>>23)+r|0)&n|r&~n)+t[15]-660478335|0)<<14|i>>>18)+o|0)&r|o&~r)+t[4]-405537848|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[9]+568446438|0)<<5|r>>>27)+n|0)&i|n&~i)+t[14]-1019803690|0)<<9|o>>>23)+r|0)&n|r&~n)+t[3]-187363961|0)<<14|i>>>18)+o|0)&r|o&~r)+t[8]+1163531501|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[13]-1444681467|0)<<5|r>>>27)+n|0)&i|n&~i)+t[2]-51403784|0)<<9|o>>>23)+r|0)&n|r&~n)+t[7]+1735328473|0)<<14|i>>>18)+o|0)&r|o&~r)+t[12]-1926607734|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[5]-378558|0)<<4|r>>>28)+n|0)^n^i)+t[8]-2022574463|0)<<11|o>>>21)+r|0)^r^n)+t[11]+1839030562|0)<<16|i>>>16)+o|0)^o^r)+t[14]-35309556|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[1]-1530992060|0)<<4|r>>>28)+n|0)^n^i)+t[4]+1272893353|0)<<11|o>>>21)+r|0)^r^n)+t[7]-155497632|0)<<16|i>>>16)+o|0)^o^r)+t[10]-1094730640|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[13]+681279174|0)<<4|r>>>28)+n|0)^n^i)+t[0]-358537222|0)<<11|o>>>21)+r|0)^r^n)+t[3]-722521979|0)<<16|i>>>16)+o|0)^o^r)+t[6]+76029189|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[9]-640364487|0)<<4|r>>>28)+n|0)^n^i)+t[12]-421815835|0)<<11|o>>>21)+r|0)^r^n)+t[15]+530742520|0)<<16|i>>>16)+o|0)^o^r)+t[2]-995338651|0)<<23|n>>>9)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[0]-198630844|0)<<6|r>>>26)+n|0)|~i))+t[7]+1126891415|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[14]-1416354905|0)<<15|i>>>17)+o|0)|~r))+t[5]-57434055|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[12]+1700485571|0)<<6|r>>>26)+n|0)|~i))+t[3]-1894986606|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[10]-1051523|0)<<15|i>>>17)+o|0)|~r))+t[1]-2054922799|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[8]+1873313359|0)<<6|r>>>26)+n|0)|~i))+t[15]-30611744|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[6]-1560198380|0)<<15|i>>>17)+o|0)|~r))+t[13]+1309151649|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[4]-145523070|0)<<6|r>>>26)+n|0)|~i))+t[11]-1120210379|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[2]+718787259|0)<<15|i>>>17)+o|0)|~r))+t[9]-343485551|0)<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0}function r(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function n(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function i(e){var n,i,o,a,s,u,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=c;n+=64)t(l,r(e.substring(n-64,n)));for(i=(e=e.substring(n-64)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<i;n+=1)o[n>>2]|=e.charCodeAt(n)<<(n%4<<3);if(o[n>>2]|=128<<(n%4<<3),n>55)for(t(l,o),n=0;n<16;n+=1)o[n]=0;return a=8*c,a=a.toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),u=parseInt(a[1],16)||0,o[14]=s,o[15]=u,t(l,o),l}function o(e){var r,i,o,a,s,u,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(r=64;r<=c;r+=64)t(l,n(e.subarray(r-64,r)));for(i=(e=r-64<c?e.subarray(r-64):new Uint8Array(0)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<i;r+=1)o[r>>2]|=e[r]<<(r%4<<3);if(o[r>>2]|=128<<(r%4<<3),r>55)for(t(l,o),r=0;r<16;r+=1)o[r]=0;return a=8*c,a=a.toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),u=parseInt(a[1],16)||0,o[14]=s,o[15]=u,t(l,o),l}function a(e){var t,r="";for(t=0;t<4;t+=1)r+=d[e>>8*t+4&15]+d[e>>8*t&15];return r}function s(e){var t;for(t=0;t<e.length;t+=1)e[t]=a(e[t]);return e.join("")}function u(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function c(e,t){var r,n=e.length,i=new ArrayBuffer(n),o=new Uint8Array(i);for(r=0;r<n;r+=1)o[r]=e.charCodeAt(r);return t?o:i}function l(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function f(e,t,r){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e)),n.set(new Uint8Array(t),e.byteLength),r?n:n.buffer}function p(e){var t,r=[],n=e.length;for(t=0;t<n-1;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function h(){this.reset()}var d=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==s(i("hello"))&&function(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r},"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,n){var i,o,a,s,u=this.byteLength,c=t(r,u),l=u;return n!==e&&(l=t(n,u)),c>l?new ArrayBuffer(0):(i=l-c,o=new ArrayBuffer(i),a=new Uint8Array(o),s=new Uint8Array(this,c,i),a.set(s),o)}}(),h.prototype.append=function(e){return this.appendBinary(u(e)),this},h.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var n,i=this._buff.length;for(n=64;n<=i;n+=64)t(this._hash,r(this._buff.substring(n-64,n)));return this._buff=this._buff.substring(n-64),this},h.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(o,i),r=s(this._hash),e&&(r=p(r)),this.reset(),r},h.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},h.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},h.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},h.prototype._finish=function(e,r){var n,i,o,a=r;if(e[a>>2]|=128<<(a%4<<3),a>55)for(t(this._hash,e),a=0;a<16;a+=1)e[a]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),o=parseInt(n[1],16)||0,e[14]=i,e[15]=o,t(this._hash,e)},h.hash=function(e,t){return h.hashBinary(u(e),t)},h.hashBinary=function(e,t){var r=s(i(e));return t?p(r):r},h.ArrayBuffer=function(){this.reset()},h.ArrayBuffer.prototype.append=function(e){var r,i=f(this._buff.buffer,e,!0),o=i.length;for(this._length+=e.byteLength,r=64;r<=o;r+=64)t(this._hash,n(i.subarray(r-64,r)));return this._buff=r-64<o?new Uint8Array(i.buffer.slice(r-64)):new Uint8Array(0),this},h.ArrayBuffer.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n[t]<<(t%4<<3);return this._finish(o,i),r=s(this._hash),e&&(r=p(r)),this.reset(),r},h.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.ArrayBuffer.prototype.getState=function(){var e=h.prototype.getState.call(this);return e.buff=l(e.buff),e},h.ArrayBuffer.prototype.setState=function(e){return e.buff=c(e.buff,!0),h.prototype.setState.call(this,e)},h.ArrayBuffer.prototype.destroy=h.prototype.destroy,h.ArrayBuffer.prototype._finish=h.prototype._finish,h.ArrayBuffer.hash=function(e,t){var r=s(o(new Uint8Array(e)));return t?p(r):r},h})},{}],81:[function(e,t,r){function n(){i.call(this)}t.exports=n;var i=e("events").EventEmitter;e("inherits")(n,i),n.Readable=e("readable-stream/readable.js"),n.Writable=e("readable-stream/writable.js"),n.Duplex=e("readable-stream/duplex.js"),n.Transform=e("readable-stream/transform.js"),n.PassThrough=e("readable-stream/passthrough.js"),n.Stream=n,n.prototype.pipe=function(e,t){function r(t){e.writable&&!1===e.write(t)&&c.pause&&c.pause()}function n(){c.readable&&c.resume&&c.resume()}function o(){l||(l=!0,e.end())}function a(){l||(l=!0,"function"==typeof e.destroy&&e.destroy())}function s(e){if(u(),0===i.listenerCount(this,"error"))throw e}function u(){c.removeListener("data",r),e.removeListener("drain",n),c.removeListener("end",o),c.removeListener("close",a),c.removeListener("error",s),e.removeListener("error",s),c.removeListener("end",u),c.removeListener("close",u),e.removeListener("close",u)}var c=this;c.on("data",r),e.on("drain",n),e._isStdio||t&&!1===t.end||(c.on("end",o),c.on("close",a));var l=!1;return c.on("error",s),e.on("error",s),c.on("end",u),c.on("close",u),e.on("close",u),e.emit("pipe",c),e}},{events:18,inherits:24,"readable-stream/duplex.js":82,"readable-stream/passthrough.js":91,"readable-stream/readable.js":92,"readable-stream/transform.js":93,"readable-stream/writable.js":94}],82:[function(e,t,r){t.exports=e("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":83}],83:[function(e,t,r){"use strict";function n(e){if(!(this instanceof n))return new n(e);c.call(this,e),l.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",i)}function i(){this.allowHalfOpen||this._writableState.ended||a(o,this)}function o(e){e.end()}var a=e("process-nextick-args"),s=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};t.exports=n;var u=e("core-util-is");u.inherits=e("inherits");var c=e("./_stream_readable"),l=e("./_stream_writable");u.inherits(n,c);for(var f=s(l.prototype),p=0;p<f.length;p++){var h=f[p];n.prototype[h]||(n.prototype[h]=l.prototype[h])}Object.defineProperty(n.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),n.prototype._destroy=function(e,t){this.push(null),this.end(),a(t,e)}},{"./_stream_readable":85,"./_stream_writable":87,"core-util-is":6,inherits:24,"process-nextick-args":69}],84:[function(e,t,r){"use strict";function n(e){if(!(this instanceof n))return new n(e);i.call(this,e)}t.exports=n;var i=e("./_stream_transform"),o=e("core-util-is");o.inherits=e("inherits"),o.inherits(n,i),n.prototype._transform=function(e,t,r){r(null,e)}},{"./_stream_transform":86,"core-util-is":6,inherits:24}],85:[function(e,t,r){(function(r,n){"use strict";function i(e){return L.from(e)}function o(e){return L.isBuffer(e)||e instanceof N}function a(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?B(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}function s(t,r){R=R||e("./_stream_duplex"),t=t||{},this.objectMode=!!t.objectMode,r instanceof R&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var n=t.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:i,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new U,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(W||(W=e("string_decoder/").StringDecoder),this.decoder=new W(t.encoding),this.encoding=t.encoding)}function u(t){if(R=R||e("./_stream_duplex"),!(this instanceof u))return new u(t);this._readableState=new s(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),I.call(this)}function c(e,t,r,n,o){var a=e._readableState;if(null===t)a.reading=!1,m(e,a);else{var s;o||(s=f(a,t)),s?e.emit("error",s):a.objectMode||t&&t.length>0?("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===L.prototype||(t=i(t)),n?a.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):l(e,a,t,!0):a.ended?e.emit("error",new Error("stream.push() after EOF")):(a.reading=!1,a.decoder&&!r?(t=a.decoder.write(t),a.objectMode||0!==t.length?l(e,a,t,!1):g(e,a)):l(e,a,t,!1))):n||(a.reading=!1)}return p(a)}function l(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&v(e)),g(e,t)}function f(e,t){var r;return o(t)||"string"==typeof t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk")),r}function p(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function h(e){return e>=V?e=V:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function d(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=h(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function m(e,t){if(!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,v(e)}}function v(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||($("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?O(y,e):y(e))}function y(e){$("emit readable"),e.emit("readable"),E(e)}function g(e,t){t.readingMore||(t.readingMore=!0,O(b,e,t))}function b(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&($("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function _(e){return function(){var t=e._readableState;$("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&P(e,"data")&&(t.flowing=!0,E(e))}}function x(e){$("readable nexttick read 0"),e.read(0)}function w(e,t){t.resumeScheduled||(t.resumeScheduled=!0,O(k,e,t))}function k(e,t){t.reading||($("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),E(e),t.flowing&&!t.reading&&e.read(0)}function E(e){var t=e._readableState;for($("flow",t.flowing);t.flowing&&null!==e.read(););}function S(e,t){if(0===t.length)return null;var r;return t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=A(e,t.buffer,t.decoder),r}function A(e,t,r){var n;return e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?D(e,t):C(e,t),n}function D(e,t){var r=t.head,n=1,i=r.data;for(e-=i.length;r=r.next;){var o=r.data,a=e>o.length?o.length:e;if(a===o.length?i+=o:i+=o.slice(0,e),0===(e-=a)){a===o.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(a));break}++n}return t.length-=n,i}function C(e,t){var r=L.allocUnsafe(e),n=t.head,i=1;for(n.data.copy(r),e-=n.data.length;n=n.next;){var o=n.data,a=e>o.length?o.length:e;if(o.copy(r,r.length-e,0,a),0===(e-=a)){a===o.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(a));break}++i}return t.length-=i,r}function F(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,O(j,t,e))}function j(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function T(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}var O=e("process-nextick-args");t.exports=u;var R,B=e("isarray");u.ReadableState=s;e("events").EventEmitter;var P=function(e,t){return e.listeners(t).length},I=e("./internal/streams/stream"),L=e("safe-buffer").Buffer,N=n.Uint8Array||function(){},M=e("core-util-is");M.inherits=e("inherits");var q=e("util"),$=void 0;$=q&&q.debuglog?q.debuglog("stream"):function(){};var W,U=e("./internal/streams/BufferList"),G=e("./internal/streams/destroy");M.inherits(u,I);var z=["error","close","destroy","pause","resume"];Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),u.prototype.destroy=G.destroy,u.prototype._undestroy=G.undestroy,u.prototype._destroy=function(e,t){this.push(null),t(e)},u.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=L.from(e,t),t=""),r=!0),c(this,e,t,!1,r)},u.prototype.unshift=function(e){return c(this,e,null,!0,!1)},u.prototype.isPaused=function(){return!1===this._readableState.flowing},u.prototype.setEncoding=function(t){return W||(W=e("string_decoder/").StringDecoder),this._readableState.decoder=new W(t),this._readableState.encoding=t,this};var V=8388608;u.prototype.read=function(e){$("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return $("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?F(this):v(this),null;if(0===(e=d(e,t))&&t.ended)return 0===t.length&&F(this),null;var n=t.needReadable;$("need readable",n),(0===t.length||t.length-e<t.highWaterMark)&&$("length less than watermark",n=!0),t.ended||t.reading?$("reading or ended",n=!1):n&&($("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=d(r,t)));var i;return null===(i=e>0?S(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&F(this)),null!==i&&this.emit("data",i),i},u.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},u.prototype.pipe=function(e,t){function n(e,t){$("onunpipe"),e===p&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,o())}function i(){$("onend"),e.end()}function o(){$("cleanup"),e.removeListener("close",c),e.removeListener("finish",l),e.removeListener("drain",m),e.removeListener("error",u),e.removeListener("unpipe",n),p.removeListener("end",i),p.removeListener("end",f),p.removeListener("data",s),v=!0,!h.awaitDrain||e._writableState&&!e._writableState.needDrain||m()}function s(t){$("ondata"),y=!1,!1!==e.write(t)||y||((1===h.pipesCount&&h.pipes===e||h.pipesCount>1&&-1!==T(h.pipes,e))&&!v&&($("false write response, pause",p._readableState.awaitDrain),p._readableState.awaitDrain++,y=!0),p.pause())}function u(t){$("onerror",t),f(),e.removeListener("error",u),0===P(e,"error")&&e.emit("error",t)}function c(){e.removeListener("finish",l),f()}function l(){$("onfinish"),e.removeListener("close",c),f()}function f(){$("unpipe"),p.unpipe(e)}var p=this,h=this._readableState;switch(h.pipesCount){case 0:h.pipes=e;break;case 1:h.pipes=[h.pipes,e];break;default:h.pipes.push(e)}h.pipesCount+=1,$("pipe count=%d opts=%j",h.pipesCount,t);var d=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?i:f;h.endEmitted?O(d):p.once("end",d),e.on("unpipe",n);var m=_(p);e.on("drain",m);var v=!1,y=!1;return p.on("data",s),a(e,"error",u),e.once("close",c),e.once("finish",l),e.emit("pipe",p),h.flowing||($("pipe resume"),p.resume()),e},u.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r),this);if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,r);return this}var a=T(t.pipes,e);return-1===a?this:(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r),this)},u.prototype.on=function(e,t){var r=I.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&v(this):O(x,this))}return r},u.prototype.addListener=u.prototype.on,u.prototype.resume=function(){var e=this._readableState;return e.flowing||($("resume"),e.flowing=!0,w(this,e)),this},u.prototype.pause=function(){return $("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&($("pause"),this._readableState.flowing=!1,this.emit("pause")),this},u.prototype.wrap=function(e){var t=this._readableState,r=!1,n=this;e.on("end",function(){if($("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&n.push(e)}n.push(null)}),e.on("data",function(i){$("wrapped data"),t.decoder&&(i=t.decoder.write(i)),(!t.objectMode||null!==i&&void 0!==i)&&(t.objectMode||i&&i.length)&&(n.push(i)||(r=!0,e.pause()))});for(var i in e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<z.length;o++)e.on(z[o],n.emit.bind(n,z[o]));return n._read=function(t){$("wrapped _read",t),r&&(r=!1,e.resume())},n},u._fromList=S}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":83,"./internal/streams/BufferList":88,"./internal/streams/destroy":89,"./internal/streams/stream":90,_process:70,"core-util-is":6,events:18,inherits:24,isarray:30,"process-nextick-args":69,"safe-buffer":79,"string_decoder/":95,util:3}],86:[function(e,t,r){"use strict";function n(e){this.afterTransform=function(t,r){return i(e,t,r)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function i(e,t,r){var n=e._transformState;n.transforming=!1;var i=n.writecb;if(!i)return e.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!==r&&void 0!==r&&e.push(r),i(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}function o(e){if(!(this instanceof o))return new o(e);s.call(this,e),this._transformState=new n(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(e,r){a(t,e,r)}):a(t)})}function a(e,t,r){if(t)return e.emit("error",t);null!==r&&void 0!==r&&e.push(r);var n=e._writableState,i=e._transformState;if(n.length)throw new Error("Calling transform done when ws.length != 0");if(i.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}t.exports=o;var s=e("./_stream_duplex"),u=e("core-util-is");u.inherits=e("inherits"),u.inherits(o,s),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,s.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,r){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},o.prototype._destroy=function(e,t){var r=this;s.prototype._destroy.call(this,e,function(e){t(e),r.emit("close")})}},{"./_stream_duplex":83,"core-util-is":6,inherits:24}],87:[function(e,t,r){(function(r,n){"use strict";function i(e){var t=this;this.next=null,this.entry=null,this.finish=function(){A(t,e)}}function o(e){return R.from(e)}function a(e){return R.isBuffer(e)||e instanceof B}function s(){}function u(t,r){C=C||e("./_stream_duplex"),t=t||{},this.objectMode=!!t.objectMode,r instanceof C&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var n=t.highWaterMark,o=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:o,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var a=!1===t.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){y(r,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new i(this)}function c(t){if(C=C||e("./_stream_duplex"),!(I.call(c,this)||this instanceof C))return new c(t);this._writableState=new u(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),O.call(this)}function l(e,t){var r=new Error("write after end");e.emit("error",r),D(t,r)}function f(e,t,r,n){var i=!0,o=!1;return null===r?o=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),D(n,o),i=!1),i}function p(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=R.from(t,r)),t}function h(e,t,r,n,i,o){if(!r){var a=p(t,n,i);n!==a&&(r=!0,i="buffer",n=a)}var s=t.objectMode?1:n.length;t.length+=s;var u=t.length<t.highWaterMark;if(u||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else d(e,t,!1,s,n,i,o);return u}function d(e,t,r,n,i,o,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function m(e,t,r,n,i){--t.pendingcb,r?(D(i,n),D(E,e,t),e._writableState.errorEmitted=!0,e.emit("error",n)):(i(n),e._writableState.errorEmitted=!0,e.emit("error",n),E(e,t))}function v(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function y(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if(v(r),t)m(e,r,n,t,i);else{var o=x(r);o||r.corked||r.bufferProcessing||!r.bufferedRequest||_(e,r),n?F(g,e,r,o,i):g(e,r,o,i)}}function g(e,t,r,n){r||b(e,t),t.pendingcb--,n(),E(e,t)}function b(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function _(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,o=new Array(n),a=t.corkedRequestsFree;a.entry=r;for(var s=0,u=!0;r;)o[s]=r,r.isBuf||(u=!1),r=r.next,s+=1;o.allBuffers=u,d(e,t,!0,t.length,o,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new i(t)}else{for(;r;){var c=r.chunk,l=r.encoding,f=r.callback;if(d(e,t,!1,t.objectMode?1:c.length,c,l,f),r=r.next,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=r,t.bufferProcessing=!1}function x(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function w(e,t){e._final(function(r){t.pendingcb--,r&&e.emit("error",r),t.prefinished=!0,e.emit("prefinish"),E(e,t)})}function k(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,D(w,e,t)):(t.prefinished=!0,e.emit("prefinish")))}function E(e,t){var r=x(t);return r&&(k(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),r}function S(e,t,r){t.ending=!0,E(e,t),r&&(t.finished?D(r):e.once("finish",r)),t.ended=!0,e.writable=!1}function A(e,t,r){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}var D=e("process-nextick-args");t.exports=c;var C,F=!r.browser&&["v0.10","v0.9."].indexOf(r.version.slice(0,5))>-1?setImmediate:D;c.WritableState=u;var j=e("core-util-is");j.inherits=e("inherits");var T={deprecate:e("util-deprecate")},O=e("./internal/streams/stream"),R=e("safe-buffer").Buffer,B=n.Uint8Array||function(){},P=e("./internal/streams/destroy");j.inherits(c,O),u.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(u.prototype,"buffer",{get:T.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}();var I;"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(I=Function.prototype[Symbol.hasInstance],Object.defineProperty(c,Symbol.hasInstance,{value:function(e){return!!I.call(this,e)||e&&e._writableState instanceof u}})):I=function(e){return e instanceof this},c.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},c.prototype.write=function(e,t,r){var n=this._writableState,i=!1,u=a(e)&&!n.objectMode;return u&&!R.isBuffer(e)&&(e=o(e)),"function"==typeof t&&(r=t,t=null),u?t="buffer":t||(t=n.defaultEncoding),"function"!=typeof r&&(r=s),n.ended?l(this,r):(u||f(this,n,e,r))&&(n.pendingcb++,i=h(this,n,u,e,t,r)),i},c.prototype.cork=function(){this._writableState.corked++},c.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||_(this,e))},c.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},c.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},c.prototype._writev=null,c.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!==e&&void 0!==e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||S(this,n,r)},Object.defineProperty(c.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),c.prototype.destroy=P.destroy,c.prototype._undestroy=P.undestroy,c.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":83,"./internal/streams/destroy":89,"./internal/streams/stream":90,_process:70,"core-util-is":6,inherits:24,"process-nextick-args":69,"safe-buffer":79,"util-deprecate":111}],88:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,r){e.copy(t,r)}var o=e("safe-buffer").Buffer;t.exports=function(){function e(){n(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},e.prototype.concat=function(e){if(0===this.length)return o.alloc(0);if(1===this.length)return this.head.data;for(var t=o.allocUnsafe(e>>>0),r=this.head,n=0;r;)i(r.data,t,n),n+=r.data.length,r=r.next;return t},e}()},{"safe-buffer":79}],89:[function(e,t,r){"use strict";function n(e,t){e.emit("error",t)}var i=e("process-nextick-args");t.exports={destroy:function(e,t){var r=this,o=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;o||a?t?t(e):!e||this._writableState&&this._writableState.errorEmitted||i(n,this,e):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(i(n,r,e),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(e)}))},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},{"process-nextick-args":69}],90:[function(e,t,r){t.exports=e("events").EventEmitter},{events:18}],91:[function(e,t,r){t.exports=e("./readable").PassThrough},{"./readable":92}],92:[function(e,t,r){(r=t.exports=e("./lib/_stream_readable.js")).Stream=r,r.Readable=r,r.Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":83,"./lib/_stream_passthrough.js":84,"./lib/_stream_readable.js":85,"./lib/_stream_transform.js":86,"./lib/_stream_writable.js":87}],93:[function(e,t,r){t.exports=e("./readable").Transform},{"./readable":92}],94:[function(e,t,r){t.exports=e("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":87}],95:[function(e,t,r){"use strict";function n(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}function i(e){var t=n(e);if("string"!=typeof t&&(v.isEncoding===y||!y(e)))throw new Error("Unknown encoding: "+e);return t||e}function o(e){this.encoding=i(e);var t;switch(this.encoding){case"utf16le":this.text=l,this.end=f,t=4;break;case"utf8":this.fillLast=c,t=4;break;case"base64":this.text=p,this.end=h,t=3;break;default:return this.write=d,void(this.end=m)}this.lastNeed=0,this.lastTotal=0,this.lastChar=v.allocUnsafe(t)}function a(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:-1}function s(e,t,r){var n=t.length-1;if(n<r)return 0;var i=a(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r?0:(i=a(t[n]))>=0?(i>0&&(e.lastNeed=i-2),i):--n<r?0:(i=a(t[n]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}function u(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"".repeat(r);if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"".repeat(r+1);if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"".repeat(r+2)}}function c(e){var t=this.lastTotal-this.lastNeed,r=u(this,e,t);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function f(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function p(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function h(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function m(e){return e&&e.length?this.write(e):""}var v=e("safe-buffer").Buffer,y=v.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};r.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"".repeat(this.lastTotal-this.lastNeed):t},o.prototype.text=function(e,t){var r=s(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":79}],96:[function(e,t,r){function n(e){if(e&&!u(e))throw new Error("Unknown encoding: "+e)}function i(e){return e.toString(this.encoding)}function o(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function a(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}var s=e("buffer").Buffer,u=s.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},c=r.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),n(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=o;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=a;break;default:return void(this.write=i)}this.charBuffer=new s(6),this.charReceived=0,this.charLength=0};c.prototype.write=function(e){for(var t="";this.charLength;){var r=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,r),this.charReceived+=r,this.charReceived<this.charLength)return"";if(e=e.slice(r,e.length),!((i=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&i<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);n=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,n),n-=this.charReceived);var n=(t+=e.toString(this.encoding,0,n)).length-1,i=t.charCodeAt(n);if(i>=55296&&i<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,n)}return t},c.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var r=e[e.length-t];if(1==t&&r>>5==6){this.charLength=2;break}if(t<=2&&r>>4==14){this.charLength=3;break}if(t<=3&&r>>3==30){this.charLength=4;break}}this.charReceived=t},c.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var r=this.charReceived,n=this.charBuffer,i=this.encoding;t+=n.slice(0,r).toString(i)}return t}},{buffer:5}],97:[function(e,t,r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function i(e){return"function"==typeof e}function o(e){return i(e.prefix)?e.prefix():e}function a(e){var t={};for(var r in e)t[r]=e[r];return t}function s(e,t,r){function n(e,n,i,o){return t.encode([e,r.encodeKey(n,i,o)])}function i(e,t){return t&&t.options&&(e.keyEncoding=e.keyEncoding||t.options.keyEncoding,e.valueEncoding=e.valueEncoding||t.options.valueEncoding),e}return e.open(function(){}),{apply:function(t,a,s){a=a||{};for(var u=[],c=-1,l=t.length;++c<l;){var f=t[c];i(f,f.prefix),f.prefix=o(f.prefix),u.push({key:n(f.prefix,f.key,a,f),value:"del"!==f.type&&r.encodeValue(f.value,a,f),type:f.type})}e.db.batch(u,a,s)},get:function(t,i,o,a){return o.asBuffer=r.valueAsBuffer(o),e.db.get(n(i,t,o),o,function(e,t){e?a(e):a(null,r.decodeValue(t,o))})},createDecoder:function(e){return function(n,i){return{key:r.decodeKey(t.decode(n)[1],e),value:r.decodeValue(i,e)}}},isClosed:function(){return e.isClosed()},close:function(t){return e.close(t)},iterator:function(i){var o=a(i||{}),s=i.prefix||[];return l.toLtgt(i,o,function(e){return n(s,e,o,{})},t.lowerBound,t.upperBound),o.prefix=null,o.keyAsBuffer=o.valueAsBuffer=!1,"number"!=typeof o.limit&&(o.limit=-1),o.keyAsBuffer=t.buffer,o.valueAsBuffer=r.valueAsBuffer(o),function(e){return{next:function(t){return e.next(t)},end:function(t){e.end(t)}}}(e.db.iterator(o))}}}function u(){Error.call(this)}function c(e,t){if(!(this instanceof c))return new c(e,t);g.call(this,{objectMode:!0,highWaterMark:e.highWaterMark}),this._waiting=!1,this._options=e,this._makeData=t}var l=n(e("ltgt")),f=n(e("events")),p=n(e("inherits")),h=n(e("level-codec")),d=n(e("readable-stream"));p(u,Error),u.prototype.name="NotFoundError";var m=f.EventEmitter,v=new u,y=function(e,t,r,n){function i(e){var t,r={};if(n)for(t in n)void 0!==n[t]&&(r[t]=n[t]);if(e)for(t in e)void 0!==e[t]&&(r[t]=e[t]);return r}var o=new m;return o.sublevels={},o.options=n,o.version="6.5.4",o.methods={},t=t||[],o.put=function(r,n,a,s){"function"==typeof a&&(s=a,a={}),e.apply([{key:r,value:n,prefix:t.slice(),type:"put"}],i(a),function(e){if(e)return s(e);o.emit("put",r,n),s(null)})},o.prefix=function(){return t.slice()},o.batch=function(r,n,a){"function"==typeof n&&(a=n,n={}),r=r.map(function(e){return{key:e.key,value:e.value,prefix:e.prefix||t,keyEncoding:e.keyEncoding,valueEncoding:e.valueEncoding,type:e.type}}),e.apply(r,i(n),function(e){if(e)return a(e);o.emit("batch",r),a(null)})},o.get=function(r,n,o){"function"==typeof n&&(o=n,n={}),e.get(r,t,i(n),function(e,t){e?o(v):o(null,t)})},o.sublevel=function(n,a){return o.sublevels[n]=o.sublevels[n]||y(e,t.concat(n),r,i(a))},o.readStream=o.createReadStream=function(n){(n=i(n)).prefix=t;var o,a=e.iterator(n);return(o=r(n,e.createDecoder(n))).setIterator(a),o},o.close=function(t){e.close(t)},o.isOpen=e.isOpen,o.isClosed=e.isClosed,o},g=d.Readable;p(c,g),c.prototype.setIterator=function(e){return this._iterator=e,this._destroyed?e.end(function(){}):this._waiting?(this._waiting=!1,this._read()):this},c.prototype._read=function(){var e=this;if(!e._destroyed)return e._iterator?void e._iterator.next(function(t,r,n){if(t||void 0===r&&void 0===n)return t||e._destroyed||e.push(null),e._cleanup(t);n=e._makeData(r,n),e._destroyed||e.push(n)}):this._waiting=!0},c.prototype._cleanup=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;e&&t.emit("error",e),t._iterator?t._iterator.end(function(){t._iterator=null,t.emit("close")}):t.emit("close")}},c.prototype.destroy=function(){this._cleanup()};var b={encode:function(e){return""+e[0]+""+e[1]},decode:function(e){var t=e.toString(),r=t.indexOf("",1);return[t.substring(1,r),t.substring(r+1)]},lowerBound:"\0",upperBound:""},_=new h;t.exports=function(e){return y(s(e,b,_),[],c,e.options)}},{events:18,inherits:24,"level-codec":31,ltgt:42,"readable-stream":78}],98:[function(e,t,r){arguments[4][83][0].apply(r,arguments)},{"./_stream_readable":100,"./_stream_writable":102,"core-util-is":6,dup:83,inherits:24,"process-nextick-args":69}],99:[function(e,t,r){arguments[4][84][0].apply(r,arguments)},{"./_stream_transform":101,"core-util-is":6,dup:84,inherits:24}],100:[function(e,t,r){arguments[4][85][0].apply(r,arguments)},{"./_stream_duplex":98,"./internal/streams/BufferList":103,"./internal/streams/destroy":104,"./internal/streams/stream":105,_process:70,"core-util-is":6,dup:85,events:18,inherits:24,isarray:30,"process-nextick-args":69,"safe-buffer":79,"string_decoder/":108,util:3}],101:[function(e,t,r){arguments[4][86][0].apply(r,arguments)},{"./_stream_duplex":98,"core-util-is":6,dup:86,inherits:24}],102:[function(e,t,r){arguments[4][87][0].apply(r,arguments)},{"./_stream_duplex":98,"./internal/streams/destroy":104,"./internal/streams/stream":105,_process:70,"core-util-is":6,dup:87,inherits:24,"process-nextick-args":69,"safe-buffer":79,"util-deprecate":111}],103:[function(e,t,r){arguments[4][88][0].apply(r,arguments)},{dup:88,"safe-buffer":79}],104:[function(e,t,r){arguments[4][89][0].apply(r,arguments)},{dup:89,"process-nextick-args":69}],105:[function(e,t,r){arguments[4][90][0].apply(r,arguments)},{dup:90,events:18}],106:[function(e,t,r){arguments[4][92][0].apply(r,arguments)},{"./lib/_stream_duplex.js":98,"./lib/_stream_passthrough.js":99,"./lib/_stream_readable.js":100,"./lib/_stream_transform.js":101,"./lib/_stream_writable.js":102,dup:92}],107:[function(e,t,r){arguments[4][93][0].apply(r,arguments)},{"./readable":106,dup:93}],108:[function(e,t,r){arguments[4][95][0].apply(r,arguments)},{dup:95,"safe-buffer":79}],109:[function(e,t,r){(function(r){function n(e){a.call(this,e),this._destroyed=!1}function i(e,t,r){r(null,e)}function o(e){return function(t,r,n){return"function"==typeof t&&(n=r,r=t,t={}),"function"!=typeof r&&(r=i),"function"!=typeof n&&(n=null),e(t,r,n)}}var a=e("readable-stream/transform"),s=e("util").inherits,u=e("xtend");s(n,a),n.prototype.destroy=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;r.nextTick(function(){e&&t.emit("error",e),t.emit("close")})}},t.exports=o(function(e,t,r){var i=new n(e);return i._transform=t,r&&(i._flush=r),i}),t.exports.ctor=o(function(e,t,r){function i(t){if(!(this instanceof i))return new i(t);this.options=u(e,t),n.call(this,this.options)}return s(i,n),i.prototype._transform=t,r&&(i.prototype._flush=r),i}),t.exports.obj=o(function(e,t,r){var i=new n(u({objectMode:!0,highWaterMark:16},e));return i._transform=t,r&&(i._flush=r),i})}).call(this,e("_process"))},{_process:70,"readable-stream/transform":107,util:114,xtend:120}],110:[function(e,t,r){"use strict";var n=e("lodash.isnull"),i=e("validate.io-undefined"),o=Object.prototype.toString;t.exports=function(e){return n(e)?"[object Null]":i(e)?"[object Undefined]":o.call(e)}},{"lodash.isnull":41,"validate.io-undefined":118}],111:[function(e,t,r){(function(e){function r(t){try{if(!e.localStorage)return!1}catch(e){return!1}var r=e.localStorage[t];return null!=r&&"true"===String(r).toLowerCase()}t.exports=function(e,t){if(r("noDeprecation"))return e;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],112:[function(e,t,r){arguments[4][24][0].apply(r,arguments)},{dup:24}],113:[function(e,t,r){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],114:[function(e,t,r){(function(t,n){function i(e,t){var n={seen:[],stylize:a};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),m(t)?n.showHidden=t:t&&r._extend(n,t),b(n.showHidden)&&(n.showHidden=!1),b(n.depth)&&(n.depth=2),b(n.colors)&&(n.colors=!1),b(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=o),u(n,e,n.depth)}function o(e,t){var r=i.styles[t];return r?"["+i.colors[r][0]+"m"+e+"["+i.colors[r][1]+"m":e}function a(e,t){return e}function s(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}function u(e,t,n){if(e.customInspect&&t&&E(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(n,e);return g(i)||(i=u(e,i,n)),i}var o=c(e,t);if(o)return o;var a=Object.keys(t),m=s(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),k(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return l(t);if(0===a.length){if(E(t)){var v=t.name?": "+t.name:"";return e.stylize("[Function"+v+"]","special")}if(_(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(w(t))return e.stylize(Date.prototype.toString.call(t),"date");if(k(t))return l(t)}var y="",b=!1,x=["{","}"];if(d(t)&&(b=!0,x=["[","]"]),E(t)&&(y=" [Function"+(t.name?": "+t.name:"")+"]"),_(t)&&(y=" "+RegExp.prototype.toString.call(t)),w(t)&&(y=" "+Date.prototype.toUTCString.call(t)),k(t)&&(y=" "+l(t)),0===a.length&&(!b||0==t.length))return x[0]+y+x[1];if(n<0)return _(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var S;return S=b?f(e,t,n,m,a):a.map(function(r){return p(e,t,n,m,r,b)}),e.seen.pop(),h(S,y,x)}function c(e,t){if(b(t))return e.stylize("undefined","undefined");if(g(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return y(t)?e.stylize(""+t,"number"):m(t)?e.stylize(""+t,"boolean"):v(t)?e.stylize("null","null"):void 0}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,r,n,i){for(var o=[],a=0,s=t.length;a<s;++a)C(t,String(a))?o.push(p(e,t,r,n,String(a),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(p(e,t,r,n,i,!0))}),o}function p(e,t,r,n,i,o){var a,s,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(s=e.stylize("[Setter]","special")),C(n,i)||(a="["+i+"]"),s||(e.seen.indexOf(c.value)<0?(s=v(r)?u(e,c.value,null):u(e,c.value,r-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),b(a)){if(o&&i.match(/^\d+$/))return s;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function h(e,t,r){var n=0;return e.reduce(function(e,t){return n++,t.indexOf("\n")>=0&&n++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}function d(e){return Array.isArray(e)}function m(e){return"boolean"==typeof e}function v(e){return null===e}function y(e){return"number"==typeof e}function g(e){return"string"==typeof e}function b(e){return void 0===e}function _(e){return x(e)&&"[object RegExp]"===S(e)}function x(e){return"object"==typeof e&&null!==e}function w(e){return x(e)&&"[object Date]"===S(e)}function k(e){return x(e)&&("[object Error]"===S(e)||e instanceof Error)}function E(e){return"function"==typeof e}function S(e){return Object.prototype.toString.call(e)}function A(e){return e<10?"0"+e.toString(10):e.toString(10)}function D(){var e=new Date,t=[A(e.getHours()),A(e.getMinutes()),A(e.getSeconds())].join(":");return[e.getDate(),O[e.getMonth()],t].join(" ")}function C(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var F=/%[sdj%]/g;r.format=function(e){if(!g(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(i(arguments[r]));return t.join(" ")}for(var r=1,n=arguments,o=n.length,a=String(e).replace(F,function(e){if("%%"===e)return"%";if(r>=o)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),s=n[r];r<o;s=n[++r])v(s)||!x(s)?a+=" "+s:a+=" "+i(s);return a},r.deprecate=function(e,i){if(b(n.process))return function(){return r.deprecate(e,i).apply(this,arguments)};if(!0===t.noDeprecation)return e;var o=!1;return function(){if(!o){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),o=!0}return e.apply(this,arguments)}};var j,T={};r.debuglog=function(e){if(b(j)&&(j=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!T[e])if(new RegExp("\\b"+e+"\\b","i").test(j)){var n=t.pid;T[e]=function(){var t=r.format.apply(r,arguments);console.error("%s %d: %s",e,n,t)}}else T[e]=function(){};return T[e]},r.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=d,r.isBoolean=m,r.isNull=v,r.isNullOrUndefined=function(e){return null==e},r.isNumber=y,r.isString=g,r.isSymbol=function(e){return"symbol"==typeof e},r.isUndefined=b,r.isRegExp=_,r.isObject=x,r.isDate=w,r.isError=k,r.isFunction=E,r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},r.isBuffer=e("./support/isBuffer");var O=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];r.log=function(){console.log("%s - %s",D(),r.format.apply(r,arguments))},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!x(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":113,_process:70,inherits:112}],115:[function(e,t,r){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);t.exports=function(e,t){var r=t||0,i=n;return i[e[r++]]+i[e[r++]]+i[e[r++]]+i[e[r++]]+"-"+i[e[r++]]+i[e[r++]]+"-"+i[e[r++]]+i[e[r++]]+"-"+i[e[r++]]+i[e[r++]]+"-"+i[e[r++]]+i[e[r++]]+i[e[r++]]+i[e[r++]]+i[e[r++]]+i[e[r++]]}},{}],116:[function(e,t,r){(function(e){var r,n=e.crypto||e.msCrypto;if(n&&n.getRandomValues){var i=new Uint8Array(16);r=function(){return n.getRandomValues(i),i}}if(!r){var o=new Array(16);r=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],117:[function(e,t,r){var n=e("./lib/rng"),i=e("./lib/bytesToUuid");t.exports=function(e,t,r){var o=t&&r||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||n)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[o+s]=a[s];return t||i(a)}},{"./lib/bytesToUuid":115,"./lib/rng":116}],118:[function(e,t,r){"use strict";t.exports=function(e){return void 0===e}},{}],119:[function(e,t,r){"use strict";function n(e,t,r){var n=r[r.length-1];e===n.element&&(r.pop(),n=r[r.length-1]);var i=n.element,o=n.index;Array.isArray(i)?i.push(e):o===t.length-2?i[t.pop()]=e:t.push(e)}r.stringify=function(e){var t=[];t.push({obj:e});for(var r,n,i,o,a,s,u,c,l,f,p,h="";r=t.pop();)if(n=r.obj,i=r.prefix||"",o=r.val||"",h+=i,o)h+=o;else if("object"!=typeof n)h+=void 0===n?null:JSON.stringify(n);else if(null===n)h+="null";else if(Array.isArray(n)){for(t.push({val:"]"}),a=n.length-1;a>=0;a--)s=0===a?"":",",t.push({obj:n[a],prefix:s});t.push({val:"["})}else{u=[];for(c in n)n.hasOwnProperty(c)&&u.push(c);for(t.push({val:"}"}),a=u.length-1;a>=0;a--)f=n[l=u[a]],p=a>0?",":"",p+=JSON.stringify(l)+":",t.push({obj:f,prefix:p});t.push({val:"{"})}return h},r.parse=function(e){for(var t,r,i,o,a,s,u,c,l,f=[],p=[],h=0;;)if("}"!==(t=e[h++])&&"]"!==t&&void 0!==t)switch(t){case" ":case"\t":case"\n":case":":case",":break;case"n":h+=3,n(null,f,p);break;case"t":h+=3,n(!0,f,p);break;case"f":h+=4,n(!1,f,p);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(r="",h--;;){if(i=e[h++],!/[\d\.\-e\+]/.test(i)){h--;break}r+=i}n(parseFloat(r),f,p);break;case'"':for(o="",a=void 0,s=0;;){if('"'===(u=e[h++])&&("\\"!==a||s%2!=1))break;o+=u,"\\"===(a=u)?s++:s=0}n(JSON.parse('"'+o+'"'),f,p);break;case"[":c={element:[],index:f.length},f.push(c.element),p.push(c);break;case"{":l={element:{},index:f.length},f.push(l.element),p.push(l);break;default:throw new Error("unexpectedly reached end of input: "+t)}else{if(1===f.length)return f.pop();n(f.pop(),f,p)}}},{}],120:[function(e,t,r){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var i in r)n.call(r,i)&&(e[i]=r[i])}return e};var n=Object.prototype.hasOwnProperty},{}]},{},[59])(59)}),t.exports}();!function(){var GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;void 0===GLOBAL.lively&&(GLOBAL.lively={}),"undefined"==typeof btoa&&(GLOBAL.btoa=function(e){return new Buffer(e).toString("base64")}),"undefined"==typeof atob&&(GLOBAL.atob=function(e){return new Buffer(e,"base64").toString()}),function(){this.lively=this.lively||{},function(exports,_PouchDB,pouchdbAdapterMem,lively_lang,lively_resources){"use strict";function nodejsRequire(e){if(!isNode)throw new Error("nodejsRequire can only be used in nodejs!");return"undefined"!=typeof System?System._nodeRequire(e):require("module")._load(e)}function nodejs_leveldbPath(e){if(e.startsWith("/"))return e;if(e.match(/[^\/]+:\/\//))return e.startsWith("file:")&&(e=e.replace(/^file:\/\//,"")),e;if(!isNode)throw new Error("nodejs_leveldbPath called under non-nodejs environment");var t="undefined"!=typeof System&&System.baseURL.startsWith("file://")?System.baseURL.replace("file://",""):GLOBAL.process.cwd(),r=nodejsRequire("path").join,n=nodejsRequire("fs"),i=n.mkdirSync,o=n.existsSync,a=(n.readdirSync,n.readFileSync);if(e.includes("/"))return r(t,e);try{var s=a(r(t,"../package.json")),u=JSON.parse(s);if("lively.web"===u.name||"lively.next"===u.name){var c=r(t,"../.livelydbs");return o(c)||i(c),r(c,e)}}catch(e){}var l=r(t,".livelydbs");return o(l)||i(l),r(l,e)}function nodejs_attemptToLoadProperPouchDB(){if(!isNode)throw new Error("nodejs_attemptToLoadProperPouchDB called under non-nodejs environment");if("undefined"!=typeof System){var e=System._nodeRequire("path").join,t=System.normalizeSync("lively.storage/index.js"),r=e(System.normalizeSync("pouchdb",t).replace(/file:\/\//,""),"../../lib/index.js");try{return(PouchDB=System._nodeRequire(r)).plugin(pouchdbAdapterMem),!0}catch(e){return!1}}try{return(PouchDB=require("pouchdb")).plugin(pouchdbAdapterMem),!0}catch(e){return!1}}function isHash(e){return"string"==typeof e&&40===e.length&&e.match(hashRe)}function checkArg(e,t,r){if(void 0===t&&"string"==typeof r&&!r.includes("undefined"))throw new Error("parameter "+e+" is undefined");if(null===t&&"string"==typeof r&&!r.includes("null"))throw new Error("parameter "+e+" is null");if("string"==typeof r){var n=void 0===t?"undefined":_typeof(t),i=t?t.constructor.name:"";if(!r.split("|").some(function(e){return n===e||i===e}))throw new Error('parameter "'+e+'" expected to be of type '+r+" but is "+(i||n))}if("function"==typeof r){var o=r(t);if(o&&o.error)throw new Error('check of parameter "'+e+'" failed: '+o.error)}}function checkArgs(e,t,r){for(var n in t)checkArg(n,e[n],t[n]);if("function"==typeof r){var i=r(e);if(i&&i.error)throw new Error(i.error)}return e}function applyExclude(e,t){return!t||("string"==typeof t?!e.url.includes(t):"function"==typeof t?!t(e):!(t instanceof RegExp)||!t.test(e.url))}_PouchDB="default"in _PouchDB?_PouchDB.default:_PouchDB,pouchdbAdapterMem="default"in pouchdbAdapterMem?pouchdbAdapterMem.default:pouchdbAdapterMem;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jsx=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,r,n,i){var o=t&&t.defaultProps,a=arguments.length-3;if(r||0===a||(r={}),r&&o)for(var s in o)void 0===r[s]&&(r[s]=o[s]);else r||(r=o||{});if(1===a)r.children=i;else if(a>1){for(var u=Array(a),c=0;c<a;c++)u[c]=arguments[c+3];r.children=u}return{$$typeof:e,type:t,key:void 0===n?null:""+n,ref:null,props:r,_owner:null}}}(),asyncIterator=function(e){if("function"==typeof Symbol){if(Symbol.asyncIterator){var t=e[Symbol.asyncIterator];if(null!=t)return t.call(e)}if(Symbol.iterator)return e[Symbol.iterator]()}throw new TypeError("Object is not async iterable")},asyncGenerator=function(){function e(e){this.value=e}function t(t){function r(i,o){try{var a=t[i](o),s=a.value;s instanceof e?Promise.resolve(s.value).then(function(e){r("next",e)},function(e){r("throw",e)}):n(a.done?"return":"normal",a.value)}catch(e){n("throw",e)}}function n(e,t){switch(e){case"return":i.resolve({value:t,done:!0});break;case"throw":i.reject(t);break;default:i.resolve({value:t,done:!1})}(i=i.next)?r(i.key,i.arg):o=null}var i,o;this._invoke=function(e,t){return new Promise(function(n,a){var s={key:e,arg:t,resolve:n,reject:a,next:null};o?o=o.next=s:(i=o=s,r(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),asyncGeneratorDelegate=function(e,t){function r(r,n){return i=!0,n=new Promise(function(t){t(e[r](n))}),{done:!1,value:t(n)}}var n={},i=!1;return"function"==typeof Symbol&&Symbol.iterator&&(n[Symbol.iterator]=function(){return this}),n.next=function(e){return i?(i=!1,e):r("next",e)},"function"==typeof e.throw&&(n.throw=function(e){if(i)throw i=!1,e;return r("throw",e)}),"function"==typeof e.return&&(n.return=function(e){return r("return",e)}),n},asyncToGenerator=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),defineEnumerableProperties=function(e,t){for(var r in t){var n=t[r];n.configurable=n.enumerable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,r,n)}return e},defaults=function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],o=Object.getOwnPropertyDescriptor(t,i);o&&o.configurable&&void 0===e[i]&&Object.defineProperty(e,i,o)}return e},defineProperty=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},get$1=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},_instanceof=function(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t},interopRequireDefault=function(e){return e&&e.__esModule?e:{default:e}},interopRequireWildcard=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},newArrowCheck=function(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")},objectDestructuringEmpty=function(e){if(null==e)throw new TypeError("Cannot destructure undefined")},objectWithoutProperties=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},selfGlobal="undefined"==typeof global?self:global,set$1=function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var s=o.set;void 0!==s&&s.call(i,n)}return n},slicedToArray=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),slicedToArrayLoose=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){for(var r,n=[],i=e[Symbol.iterator]();!(r=i.next()).done&&(n.push(r.value),!t||n.length!==t););return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},taggedTemplateLiteral=function(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))},taggedTemplateLiteralLoose=function(e,t){return e.raw=t,e},temporalRef=function(e,t,r){if(e===r)throw new ReferenceError(t+" is not defined - temporal dead zone");return e},temporalUndefined={},toArray=function(e){return Array.isArray(e)?e:Array.from(e)},toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},babelHelpers$1=Object.freeze({jsx:jsx,asyncIterator:asyncIterator,asyncGenerator:asyncGenerator,asyncGeneratorDelegate:asyncGeneratorDelegate,asyncToGenerator:asyncToGenerator,classCallCheck:classCallCheck,createClass:createClass,defineEnumerableProperties:defineEnumerableProperties,defaults:defaults,defineProperty:defineProperty,get:get$1,inherits:inherits,interopRequireDefault:interopRequireDefault,interopRequireWildcard:interopRequireWildcard,newArrowCheck:newArrowCheck,objectDestructuringEmpty:objectDestructuringEmpty,objectWithoutProperties:objectWithoutProperties,possibleConstructorReturn:possibleConstructorReturn,selfGlobal:selfGlobal,set:set$1,slicedToArray:slicedToArray,slicedToArrayLoose:slicedToArrayLoose,taggedTemplateLiteral:taggedTemplateLiteral,taggedTemplateLiteralLoose:taggedTemplateLiteralLoose,temporalRef:temporalRef,temporalUndefined:temporalUndefined,toArray:toArray,toConsumableArray:toConsumableArray,typeof:_typeof,extends:_extends,instanceof:_instanceof}),GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:void 0,isNode="undefined"!=typeof global&&"undefined"!=typeof process,PouchDB=_PouchDB;PouchDB.plugin(pouchdbAdapterMem);var createPouchDB=isNode?function(){var e=!1,t=!1;return function(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e||(e=!0,t=nodejs_attemptToLoadProperPouchDB()),n.adapter||(n.adapter=r.startsWith("http")?"http":t?"leveldb":"memory"),"leveldb"==n.adapter&&(r=nodejs_leveldbPath(r)),n=_extends({},n,{name:r}),new PouchDB(n)}}():function(e,t){return new PouchDB(_extends({name:e},t))},Database=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};classCallCheck(this,e),this.name=t,this.options=r,this._pouchdb=null}return createClass(e,null,[{key:"findDB",value:function(e){return this.databases.get(e)}},{key:"ensureDB",value:function(e,t){var r=this.findDB(e);return r||(r=new this(e,t),this.databases.set(e,r),e.endsWith("lively.storage-meta")||this.createMetaEntryForDB(e,t),r)}},{key:"knownDBs",value:function(t,r){return e.ensureDB("lively.storage-meta").getAll().then(function(e){return e.map(function(e){return e._id})})}},{key:"createMetaEntryForDB",value:function(t,r){var n=e.ensureDB("lively.storage-meta");n.has(t).then(function(e){return!e&&n.set(t,{created:Date.now(),options:r})})}},{key:"knowsDB",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.ensureDB(t),e.next=3,r.docCount();case 3:if(!((n=e.sent)>0)){e.next=6;break}return e.abrupt("return",!0);case 6:return e.next=8,r.destroy();case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"PouchDB",get:function(){return PouchDB},set:function(e){PouchDB=e}},{key:"databases",get:function(){return this._databases||(this._databases=new Map)}}]),createClass(e,[{key:"close",value:function(){this._pouchdb&&(this._pouchdb.close(),delete this._pouchdb)}},{key:"isDestroyed",value:function(){return!!this.pouchdb._destroyed}},{key:"destroy",value:function(e){return this.constructor.databases.delete(this.name),this.isDestroyed()?{ok:!0}:this.pouchdb.destroy(e)}},{key:"update",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var i,o,a,s,u,c,l,f,p,h,d,m,v,y,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=n||{},i=n,o=i.ensure,a=void 0===o||o,s=i.retryOnConflict,u=void 0===s||s,c=i.maxUpdateAttempts,l=void 0===c?10:c,f={latest:!0},p=this.pouchdb,h=void 0,d=void 0,e.prev=2,e.next=5,p.get(t,f);case 5:h=e.sent,e.next=12;break;case 8:if(e.prev=8,e.t0=e.catch(2),"not_found"===e.t0.name&&a){e.next=12;break}throw e.t0;case 12:return e.next=14,r(h);case 14:if((d=e.sent)&&"object"===(void 0===d?"undefined":_typeof(d))){e.next=17;break}return e.abrupt("return",null);case 17:return d._id!==t&&(d._id=t),h&&d._rev!==h._rev&&(d._rev=h._rev),e.prev=19,e.next=22,p.put(d);case 22:return m=e.sent,v=m.id,y=m.rev,e.abrupt("return",Object.assign(d,{_rev:y}));case 28:if(e.prev=28,e.t1=e.catch(19),!("conflict"===e.t1.name&&u&&g<l)){e.next=32;break}return e.abrupt("return",this.update(t,r,n,g+1));case 32:throw e.t1;case 33:case"end":return e.stop()}},e,this,[[2,8],[19,28]])}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"mixin",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.update(t,function(e){return Object.assign(e||{_id:t},r)},n));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"set",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.update(t,function(e){return r},n));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.pouchdb.get(t,r);case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),"not_found"!==e.t0.name){e.next=10;break}return e.abrupt("return",void 0);case 10:throw e.t0;case 11:case"end":return e.stop()}},e,this,[[0,6]])}));return function(t){return e.apply(this,arguments)}}()},{key:"has",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return e.abrupt("return",!!e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"add",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.pouchdb.post(t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"docList",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,i,o,a,s,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.allDocs(u);case 2:for(t=e.sent,r=t.rows,n=[],i=0;i<r.length;i++)o=r[i],a=o.id,s=o.value.rev,n.push({id:a,rev:s});return e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"docCount",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.allDocs();case 2:return t=e.sent,e.abrupt("return",t.rows.length);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"revList",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.get(t,{revs:!0});case 2:return r=e.sent,n=r._id,i=r._revisions,o=i.start,a=i.ids,e.abrupt("return",a.map(function(e){return o--+"-"+e}));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllRevisions",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.skip,n=void 0===r?0:r,i=u.limit,o=void 0===i?0:i,e.next=6,this.revList(t);case 6:return a=e.sent,n>0&&(a=a.slice(n)),o>0&&(a=a.slice(0,o)),s=a.map(function(e){return{rev:e,id:t}}),e.next=12,this.getDocuments(s);case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAll",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.allDocs(_extends({},n,{include_docs:!0}));case 2:return t=e.sent,r=t.rows,e.abrupt("return",r.map(function(e){return e.doc}));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setDocuments",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,s,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.bulkDocs(t,r);case 2:n=e.sent,i=0;case 4:if(!(i<n.length)){e.next=16;break}if(o=t[i],(a=n[i]).ok||"conflict"!==a.name||o._rev){e.next=13;break}return e.next=9,this.set(o._id,o);case 9:s=e.sent,u=s._id,c=s._rev,n[i]={ok:!0,id:u,rev:c};case 13:i++,e.next=4;break;case 16:return e.abrupt("return",n);case 17:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateDocuments",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var i,o,a,s,u,c,l,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.bulkDocs(t,n);case 2:i=e.sent,o=[],a={},s=0;case 6:if(!(s<i.length)){e.next=18;break}if(u=t[s],c=i[s],a[c._id||u._id]=c,c.ok||"conflict"!==c.name){e.next=15;break}return e.next=12,this.get(u._id);case 12:l=e.sent,(f=r(l,u))&&(f._id||(f._id=u._id),f._rev||(f._rev=l._rev),o.push(f));case 15:s++,e.next=6;break;case 18:if(!o.length){e.next=26;break}return e.t0=babelHelpers$1,e.t1={},e.t2=a,e.next=24,this.updateDocuments(o,r,n);case 24:e.t3=e.sent,a=e.t0.extends.call(e.t0,e.t1,e.t2,e.t3);case 26:return e.abrupt("return",a);case 27:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"getDocuments",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l,f,p,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=h.ignoreErrors,n=void 0===r||r,e.next=4,this.pouchdb.bulkGet({docs:t});case 4:i=e.sent,o=i.results,a=[],s=0;case 8:if(!(s<o.length)){e.next=23;break}u=o[s],c=u.docs,l=u.id,console.assert(1===c.length,"getDocuments: expected only one doc for "+l),f=0;case 12:if(!(f<c.length)){e.next=20;break}if(p=c[f],!n||p.ok){e.next=16;break}return e.abrupt("continue",17);case 16:a.push(p.ok||p.error||p);case 17:f++,e.next=12;break;case 20:s++,e.next=8;break;case 23:return e.abrupt("return",a);case 24:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"query",value:function(e,t){return this.pouchdb.query(e,t)}},{key:"remove",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===r){e.next=4;break}e.t0={_id:t,_rev:r},e.next=7;break;case 4:return e.next=6,this.get(t);case 6:e.t0=e.sent;case 7:return i=e.t0,e.abrupt("return",i?this.pouchdb.remove(i):void 0);case 9:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"removeAll",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.pouchdb,e.next=3,t.allDocs();case 3:return r=e.sent,e.next=6,Promise.all(r.rows.map(function(e){return t.remove(e.id,e.value.rev)}));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"replicateTo",value:function(t,r){return t instanceof e&&(t=t.pouchdb),this.pouchdb.replicate.to(t,r)}},{key:"replicateFrom",value:function(t,r){return t instanceof e&&(t=t.pouchdb),this.pouchdb.replicate.from(t,r)}},{key:"sync",value:function(t,r){return t instanceof e&&(t=t.pouchdb),this.pouchdb.sync(t,r)}},{key:"getConflicts",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.query({map:"function(doc) { if (doc._conflicts) emit(doc._id); }"},_extends({reduce:!1,include_docs:!0,conflicts:!0},t));case 2:return r=e.sent,n=r.rows,e.abrupt("return",n.map(function(e){var t={id:e.id,rev:e.doc._rev,doc:e.doc};return e.doc._conflicts&&(t.conflicts=e.doc._conflicts,delete e.doc._conflicts),t}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"resolveConflicts",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,s,u,c,l,f,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.get(t,{conflicts:!0});case 2:return n=e.sent,i=n._conflicts.map(function(e){return{id:t,rev:e}}),e.next=6,this.getDocuments(i);case 6:o=e.sent,a=n,s=!0,u=!1,c=void 0,e.prev=11,l=o[Symbol.iterator]();case 13:if(s=(f=l.next()).done){e.next=28;break}return p=f.value,e.next=17,r(a,p);case 17:if(a=e.sent){e.next=20;break}return e.abrupt("return",null);case 20:return e.next=22,this.set(t,a);case 22:return a=e.sent,e.next=25,this.pouchdb.remove(p);case 25:s=!0,e.next=13;break;case 28:e.next=34;break;case 30:e.prev=30,e.t0=e.catch(11),u=!0,c=e.t0;case 34:e.prev=34,e.prev=35,!s&&l.return&&l.return();case 37:if(e.prev=37,!u){e.next=40;break}throw c;case 40:return e.finish(37);case 41:return e.finish(34);case 42:return e.abrupt("return",a);case 43:case"end":return e.stop()}},e,this,[[11,30,34,42],[35,,37,41]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"diffWith",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l,f,p,h,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.docList();case 2:return r=e.sent,e.next=5,this.docList();case 5:n=e.sent,i=r.reduce(function(e,t){return Object.assign(e,defineProperty({},t.id,t.rev))},{}),o=n.reduce(function(e,t){return Object.assign(e,defineProperty({},t.id,t.rev))},{}),a=[],s=[],u=[];for(c in i)l=i[c],(f=o[c])?l!=f&&u.push({right:{id:c,rev:l},left:{id:c,rev:f}}):s.push({id:c,rev:l});for(p in o)h=o[p],(d=i[p])||a.push({id:p,rev:h});return e.abrupt("return",{inLeft:a,inRight:s,changed:u});case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"dump",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,i,o,a,s,u,c,l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.filterFn,r=l.name,n=l.type,i=l.dbInfo,o=this.name,a=this.pouchdb,s=r||o,e.t0=s,e.t1=n||a.type(),e.t2=(new Date).toJSON(),e.t3=babelHelpers$1,e.t4={},e.next=14,a.info();case 14:return e.t5=e.sent,e.t6={db_name:s},e.t7=i,e.t8=e.t3.extends.call(e.t3,e.t4,e.t5,e.t6,e.t7),u={name:e.t0,db_type:e.t1,start_time:e.t2,db_info:e.t8},e.next=21,this.getAll({attachments:!0});case 21:return c=e.sent,"function"==typeof t&&(c=t(c,u)),e.abrupt("return",{header:u,docs:c});case 24:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"backup",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.name+"_backup_"+n,r=this.constructor.ensureDB(t),e.next=3,this.replicateTo(r);case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"migrate",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAll();case 2:r=e.sent,n=[],i=[],o=0;case 5:if(!(o<r.length)){e.next=16;break}if(a=r[o],s=t(a,o)){e.next=10;break}return i.push(a),e.abrupt("continue",13);case 10:s.hasOwnProperty("_id")||(s._id=a._id),s.hasOwnProperty("_rev")&&delete s._rev,n.push(s);case 13:o++,e.next=5;break;case 16:return e.next=18,this.setDocuments(n);case 18:return e.abrupt("return",{migrated:n.length,unchanged:i.length});case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createDesignDocs",value:function(e){return e.map(this.createDesignDoc)}},{key:"createDesignDoc",value:function(e){var t=e.name,r=e.mapFn,n=e.reduceFn,i=e.filterFn,o=e.version,a={_id:"_design/"+t,version:void 0===o?1:o};return i&&lively_lang.Path("filters."+t).set(a,i.toString(),!0),r&&lively_lang.Path("views."+t+".map").set(a,r.toString(),!0),n&&lively_lang.Path("views."+t+".reduce").set(a,n.toString(),!0),a}},{key:"addDesignDocs",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i=this,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createDesignDocs(t),e.next=3,this.updateDocuments(r,function(e,t){return e.hasOwnProperty("version")?t.hasOwnProperty("version")&&t.version>e.version?t:null:t});case 3:if(n=e.sent,!o){e.next=7;break}return e.next=7,Promise.all(r.map(function(e){return i.designDocDoQueryStale(e._id)}));case 7:return e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addDesignDoc",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i=t.name,o=t.mapFn,a=t.reduceFn,s=t.version,u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createDesignDoc({name:i,mapFn:o,reduceFn:a,version:s}),e.next=3,this.set(r._id,r);case 3:if(n=e.sent,!u){e.next=7;break}return e.next=7,this.designDocDoQueryStale(r._id);case 7:return e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"removeDesignDoc",value:function(e){return this.remove("_design/"+e)}},{key:"designDocDoQueryStale",value:function(e){var t=e.split("/"),r=slicedToArray(t,2),n=(r[0],r[1]);return this.query(n,{stale:"update_after"})}},{key:"pouchdb",get:function(){if(this._pouchdb)return this._pouchdb;var e=this.name,t=this.options;return this._pouchdb=createPouchDB(e,t)}}],[{key:"loadDump",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.header,n=t.docs,i=a.name||r.name,o=this.ensureDB(i),e.next=3,o.setDocuments(n,{new_edits:!1});case 3:return e.abrupt("return",o);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),sha1=function(){var e,t,r;return"object"==("undefined"==typeof process?"undefined":_typeof(process))&&"object"==_typeof(process.versions)&&process.versions.node&&"renderer"!==process.__atom_type?(r="undefined"!=typeof System?System._nodeRequire("crypto"):require("crypto"),t=function(){var e=r.createHash("sha1");return{update:function(t){return e.update(t)},digest:function(){return e.digest("hex")}}}):(e=new Uint32Array(80),t=function(t){function r(e){var t=e.length;d+=8*t;for(var r=0;r<t;r++)n(e.charCodeAt(r))}function n(e){a[p]|=(255&e)<<h,h?h-=8:(p++,h=24),16===p&&i()}function i(){for(var e=16;e<80;e++){var t=a[e-3]^a[e-8]^a[e-14]^a[e-16];a[e]=t<<1|t>>>31}var r,n,i=s,o=u,h=c,d=l,m=f;for(e=0;e<80;e++){e<20?(r=d^o&(h^d),n=1518500249):e<40?(r=o^h^d,n=1859775393):e<60?(r=o&h|d&(o|h),n=2400959708):(r=o^h^d,n=3395469782);var v=(i<<5|i>>>27)+r+m+n+(0|a[e]);m=d,d=h,h=o<<30|o>>>2,o=i,i=v}for(s=s+i|0,u=u+o|0,c=c+h|0,l=l+d|0,f=f+m|0,p=0,e=0;e<16;e++)a[e]=0}function o(e){for(var t="",r=28;r>=0;r-=4)t+=(e>>r&15).toString(16);return t}var a,s=1732584193,u=4023233417,c=2562383102,l=271733878,f=3285377520,p=0,h=24,d=0;return a=t?e:new Uint32Array(80),{update:function(e){if("string"==typeof e)return r(e);var t=e.length;d+=8*t;for(var i=0;i<t;i++)n(e[i])},digest:function(){n(128),(p>14||14===p&&h<24)&&i(),p=14,h=24,n(0),n(0),n(d>0xffffffffff?d/1099511627776:0),n(d>4294967295?d/4294967296:0);for(var e=24;e>=0;e-=8)n(d>>e);return o(s)+o(u)+o(c)+o(l)+o(f)}}}),function(e){if(void 0===e)return t(!1);var r=t(!0);return r.update(e),r.digest()}}(),hashRe=/^[0-9a-f]+$/i,objectDBs=objectDBs||new Map,ObjectDB=function(){function e(t,r){if(classCallCheck(this,e),this.name=t,!r.snapshotLocation||!r.snapshotLocation.isResource)throw new Error("ObjectDB needs snapshotLocation!");this.snapshotLocation=r.snapshotLocation,this.__commitDB=null,this.__versionDB=null}return createClass(e,null,[{key:"dbList",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Database.ensureDB("internal__objectdb-meta"),e.next=3,t.getAll();case 3:return e.t0=function(e){return e._id},e.abrupt("return",e.sent.map(e.t0));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=objectDBs.get(t))){e.next=3;break}return e.abrupt("return",r);case 3:return n=Database.ensureDB("internal__objectdb-meta"),e.next=6,n.get(t);case 6:if(i=e.sent){e.next=9;break}return e.abrupt("return");case 9:return e.abrupt("return",this.named(t,i));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"named",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=objectDBs.get(e);if(r)return r;if(!t||!t.snapshotLocation)throw new Error("need snapshotLocation");if("string"==typeof t.snapshotLocation)try{t.snapshotLocation=lively_resources.resource(t.snapshotLocation)}catch(e){t.snapshotLocation=lively_resources.resource(System.baseURL).join(t.snapshotLocation)}var n=new this(e,t);return objectDBs.set(e,n),Database.ensureDB("internal__objectdb-meta").set(e,_extends({},t,{snapshotLocation:t.snapshotLocation.url})).catch(function(e){return console.error("error writing objectdb meta:",e)}),n}}]),createClass(e,[{key:"destroy",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=Database.findDB(this.name+"-commits"))){e.next=4;break}return e.next=4,t.destroy();case 4:if(!(r=Database.findDB(this.name+"-version-graph"))){e.next=8;break}return e.next=8,r.destroy();case 8:return objectDBs.delete(this.name),n=Database.ensureDB("internal__objectdb-meta"),e.next=12,n.remove(this.name);case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"snapshotResourceFor",value:function(e){var t=e.content.slice(0,2),r=e.content.slice(2);return this.snapshotLocation.join(t+"/"+r+".json")}},{key:"snapshotObject",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n,i,o,a,s,u){var c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=i||{},c=function(e){return e},e.next=4,c(n,i);case 4:return l=e.sent,e.abrupt("return",this.commit(t,r,l,o,a,s,u));case 6:case"end":return e.stop()}},e,this)}));return function(t,r,n,i,o,a,s,u){return e.apply(this,arguments)}}()},{key:"loadObject",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n,i,o){var a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=n||{},e.next=3,this.loadSnapshot(t,r,i,o);case 3:return a=e.sent,s=function(e){return e},e.abrupt("return",s(a,n));case 6:case"end":return e.stop()}},e,this)}));return function(t,r,n,i,o){return e.apply(this,arguments)}}()},{key:"has",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.objectStats(t,r);case 2:return e.abrupt("return",!!e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"objects",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.objectStats(t);case 2:if(r=e.sent,!t){e.next=5;break}return e.abrupt("return",Object.keys(r||{}));case 5:n={};for(i in r)n[i]=Object.keys(r[i]);return e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"objectStats",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,s,u,c,l,f,p,h,d,m,v,y,g,b,_,x,w,k;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n={},e.t0=this.__commitDB,e.t0){e.next=6;break}return e.next=5,this._commitDB();case 5:e.t0=e.sent;case 6:return i=e.t0,o={reduce:!0,group:!0},t&&r?o.key=t+"\0"+r:t&&(o.startkey=t+"\0",o.endkey=t+""),e.prev=9,e.next=12,i.pouchdb.query("nameWithMaxMinTimestamp_index",o);case 12:for(a=e.sent,s=a.rows,u=!0,c=!1,l=void 0,e.prev=17,f=s[Symbol.iterator]();!(u=(p=f.next()).done);u=!0)h=p.value,d=h.key,m=h.value,v=m.count,y=m.max,g=m.min,b=d.split("\0"),_=slicedToArray(b,2),x=_[0],w=_[1],(k=n[x]||(n[x]={}))[w]={count:v,newest:y,oldest:g};e.next=25;break;case 21:e.prev=21,e.t1=e.catch(17),c=!0,l=e.t1;case 25:e.prev=25,e.prev=26,!u&&f.return&&f.return();case 28:if(e.prev=28,!c){e.next=31;break}throw l;case 31:return e.finish(28);case 32:return e.finish(25);case 33:e.next=39;break;case 35:return e.prev=35,e.t2=e.catch(9),console.error(e.t2),e.abrupt("return",n);case 39:if(!t||!r){e.next=41;break}return e.abrupt("return",(n[t]||{})[r]);case 41:if(!t){e.next=43;break}return e.abrupt("return",n[t]);case 43:return e.abrupt("return",n);case 44:case"end":return e.stop()}},e,this,[[9,35],[17,21,25,33],[26,,28,32]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getCommits",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"HEAD",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._log(t,r,a,s);case 2:if((n=e.sent).length){e.next=5;break}return e.abrupt("return",[]);case 5:if(e.t0=this.__commitDB,e.t0){e.next=10;break}return e.next=9,this._commitDB();case 9:e.t0=e.sent;case 10:return i=e.t0,e.next=13,i.getDocuments(n.map(function(e){return{id:e}}));case 13:return o=e.sent,e.abrupt("return",o);case 15:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getCommit",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.__commitDB,e.t0){e.next=5;break}return e.next=4,this._commitDB();case 4:e.t0=e.sent;case 5:return r=e.t0,e.abrupt("return",r.get(t));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCommitsWithIds",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return",[]);case 2:if(e.t0=this.__commitDB,e.t0){e.next=7;break}return e.next=6,this._commitDB();case 6:e.t0=e.sent;case 7:return r=e.t0,e.abrupt("return",r.getDocuments(t.map(function(e){return{id:e}})));case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getLatestCommit",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,s,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"HEAD",c=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._log(t,r,u,1);case 2:if(n=e.sent,i=slicedToArray(n,1),o=i[0]){e.next=7;break}return e.abrupt("return",null);case 7:if(e.t0=this.__commitDB,e.t0){e.next=12;break}return e.next=11,this._commitDB();case 11:e.t0=e.sent;case 12:return a=e.t0,e.next=15,a.get(o);case 15:if(!(s=e.sent)||!s.deleted||c){e.next=18;break}return e.abrupt("return",null);case 18:return e.abrupt("return",s);case 19:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"commit",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n,i,o){var a,s,u,c,l,f,p,h,d,m,v,y,g,b,_,x,w,k,E,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"HEAD",A=arguments[6];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=i.author,s=i.description,u=void 0===s?"no description":s,c=i.tags,l=void 0===c?[]:c,f=i.timestamp,p=i.message,h=void 0===p?"":p,d=i.metadata,m=i.preview,t){e.next=3;break}throw new Error("object needs a type");case 3:if(r){e.next=5;break}throw new Error("object needs a name");case 5:if(a){e.next=7;break}throw new Error("Cannot commit "+t+"/"+r+" without user");case 7:if(e.t0=this.__versionDB,e.t0){e.next=12;break}return e.next=11,this._versionDB();case 11:e.t0=e.sent;case 12:return v=e.t0,e.next=15,this.versionGraph(t,r);case 15:if(y=e.sent,g=y?y.refs[S]:null,b=g?[g]:[],!A){e.next=23;break}if(y){e.next=21;break}throw new Error('Trying to store "'+t+"/"+r+'" on top of expected version '+A+" but no version entry exists!");case 21:if(g===A){e.next=23;break}throw new Error('Trying to store "'+t+"/"+r+'" on top of expected version '+A+" but ref "+S+" is of version "+g+"!");case 23:if(_=isHash(n),x=_?null:n?JSON.stringify(n):null,w=this._createCommit(t,r,u,l,d,a,f,h,b,_?null:n,x,o||m,_?n:null),!n||_){e.next=35;break}return k=this.snapshotResourceFor(w),e.next=28,k.parent().ensureExistance();case 28:if(!k.canDealWithJSON){e.next=33;break}return e.next=31,k.writeJson(n);case 31:e.next=35;break;case 33:return e.next=35,k.write(x);case 35:if(e.t1=this.__commitDB,e.t1){e.next=40;break}return e.next=39,this._commitDB();case 39:e.t1=e.sent;case 40:return E=e.t1,e.next=43,E.set(w._id,w);case 43:return w=e.sent,y||(y={refs:{},history:{}}),y.refs[S]=w._id,y.history[w._id]=b,e.next=49,v.set(t+"/"+r,y);case 49:return e.abrupt("return",w);case 50:case"end":return e.stop()}},e,this)}));return function(t,r,n,i,o){return e.apply(this,arguments)}}()},{key:"loadSnapshot",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var i,o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"HEAD";return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=void 0,!n||"string"==typeof n){e.next=5;break}i=n,e.next=20;break;case 5:if(!n){e.next=17;break}if(e.t0=this.__commitDB,e.t0){e.next=11;break}return e.next=10,this._commitDB();case 10:e.t0=e.sent;case 11:return o=e.t0,e.next=14,o.get(n);case 14:i=e.sent,e.next=20;break;case 17:return e.next=19,this.getLatestCommit(t,r,a);case 19:i=e.sent;case 20:if(i){e.next=22;break}throw new Error("Cannot find commit to loadSnapshot for "+t+"/"+r+" (using "+n+")");case 22:return e.abrupt("return",this.snapshotResourceFor(i).readJson());case 23:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"revert",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n,i){var o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.__versionDB,e.t0){e.next=5;break}return e.next=4,this._versionDB();case 4:e.t0=e.sent;case 5:return o=e.t0,e.next=8,o.get(t+"/"+r);case 8:return a=e.sent,a.refs[n||"HEAD"]=i,delete a.deleted,e.next=13,o.set(t+"/"+r,a);case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}},e,this)}));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"_createCommit",value:function(e,t,r,n,i,o,a){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[],c=arguments[9],l=arguments[10],f=arguments[11],p=arguments[12];return!f&&c&&c.preview&&(f=c.preview),this._createCommitFromSpec({name:t,type:e,timestamp:a||Date.now(),author:{name:o.name,email:o.email,realm:o.realm},tags:n,description:r,preview:f,message:s,content:p||l&&sha1(l)||null,deleted:!p&&!c,metadata:i,ancestors:u},!0)}},{key:"_createCommitFromSpec",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.name)throw new Error("commit needs name");if(!e.type)throw new Error("commit needs type");if(!e.author)throw new Error("commit needs author");if(!e.author.name)throw new Error("commit needs author.name");e.timestamp||(e.timestamp=Date.now()),e.tags||(e.tags=[]),!t&&e.content&&((t=isHash(e.content))||(e.content=sha1(e.content)));var r=lively_lang.obj.dissoc(e,["preview"]),n=sha1(JSON.stringify(r));return Object.assign(e,{_id:n})}},{key:"_commitDB",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.__commitDB){e.next=2;break}return e.abrupt("return",this.__commitDB);case 2:if(t=this.name+"-commits",!(r=Database.findDB(t))){e.next=5;break}return e.abrupt("return",this.__commitDB=r);case 5:return r=Database.ensureDB(t),e.next=8,r.addDesignDocs(this._commitdb_indexes);case 8:return e.abrupt("return",this.__commitDB=r);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"close",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.__commitDB){e.next=4;break}return e.next=3,this.__commitDB.close();case 3:this.__commitDB=null;case 4:if(!this.__versionDB){e.next=8;break}return e.next=7,this.__versionDB.close();case 7:this.__versionDB=null;case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"versionGraph",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.__versionDB,e.t0){e.next=5;break}return e.next=4,this._versionDB();case 4:e.t0=e.sent;case 5:return n=e.t0,e.next=8,n.get(t+"/"+r);case 8:return i=e.sent,e.abrupt("return",!i||i.deleted||i._deleted?null:i);case 10:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"_log",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n,i,o,a,s,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.versionGraph(t,r);case 2:if((n=e.sent)&&!n.deleted&&!n._deleted){e.next=5;break}return e.abrupt("return",[]);case 5:i=n.refs.HEAD,o=[];case 6:if(!o.includes(i)){e.next=9;break}throw new Error("cyclic version graph???");case 9:if(o.push(i),a=n.history[i]||[],s=slicedToArray(a,1),(i=s[0])&&!(o.length>=u)){e.next=15;break}return e.abrupt("break",17);case 15:e.next=6;break;case 17:return e.abrupt("return",o);case 18:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"_findTimestampedVersionsOfObjectNamed",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l,f,p,h,d,m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=m.include_docs,n=void 0===r||r,i=m.descending,o=void 0===i||i,a=m.startTime,s=void 0===a?"0".repeat(13):a,u=m.endTime,c=void 0===u?"9".repeat(13):u,l=t+"\0"+(o?c:s),f=t+"\0"+(o?s:c),e.t0=this.__commitDB,e.t0){e.next=15;break}return e.next=14,this._commitDB();case 14:e.t0=e.sent;case 15:return p=e.t0,e.next=18,p.pouchdb.query("nameAndTimestamp_index",_extends({},m,{descending:o,include_docs:n,startkey:l,endkey:f}));case 18:return h=e.sent,d=h.rows,e.abrupt("return",n?d.map(function(e){return e.doc}):d.map(function(e){return e.id}));case 21:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_versionDB",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.__versionDB){e.next=2;break}return e.abrupt("return",this.__versionDB);case 2:if(t=this.name+"-version-graph",!(r=Database.findDB(t))){e.next=5;break}return e.abrupt("return",this.__versionDB=r);case 5:return r=Database.ensureDB(t),e.next=8,r.addDesignDocs(this._versiondb_indexes);case 8:return e.abrupt("return",this.__versionDB=r);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"exportToDir",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,s,u,c,l,f,p,h,d,m,v,y,g,b,_,x,w,k,E,S,A,D,C,F,j,T,O,R,B,P=this,I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],L=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t&&(t=lively_resources.resource(t)),e.t0=this.__commitDB,e.t0){e.next=6;break}return e.next=5,this._commitDB();case 5:e.t0=e.sent;case 6:if(n=e.t0,e.t1=this.__versionDB,e.t1){e.next=12;break}return e.next=11,this._versionDB();case 11:e.t1=e.sent;case 12:if(i=e.t1,o=[],r){e.next=58;break}return e.next=17,i.getAll();case 17:a=e.sent,s=!0,u=!1,c=void 0,e.prev=21,l=a[Symbol.iterator]();case 23:if(s=(f=l.next()).done){e.next=42;break}if(p=f.value,h=p.refs,d=p.history,!(m=p._id).startsWith("_")){e.next=28;break}return e.abrupt("continue",39);case 28:return e.next=30,this.getCommit(h.HEAD||Object.keys(d)[0]);case 30:return v=e.sent,y=v.type,g=v.name,b=t.join(y).join(g).asDirectory(),_=Object.keys(d),e.next=37,this.getCommitsWithIds(_);case 37:x=e.sent,o.push({refs:h,history:d,currentExportDir:b,commits:x,name:g,type:y});case 39:s=!0,e.next=23;break;case 42:e.next=48;break;case 44:e.prev=44,e.t2=e.catch(21),u=!0,c=e.t2;case 48:e.prev=48,e.prev=49,!s&&l.return&&l.return();case 51:if(e.prev=51,!u){e.next=54;break}throw c;case 54:return e.finish(51);case 55:return e.finish(48);case 56:e.next=94;break;case 58:w=!0,k=!1,E=void 0,e.prev=61,S=r[Symbol.iterator]();case 63:if(w=(A=S.next()).done){e.next=80;break}return D=A.value,g=D.name,y=D.type,b=t.join(y).join(g).asDirectory(),e.next=69,this.versionGraph(y,g);case 69:return C=e.sent,h=C.refs,d=C.history,_=Object.keys(d),e.next=75,this.getCommitsWithIds(_);case 75:x=e.sent,o.push({refs:h,history:d,currentExportDir:b,commits:x,name:g,type:y});case 77:w=!0,e.next=63;break;case 80:e.next=86;break;case 82:e.prev=82,e.t3=e.catch(61),k=!0,E=e.t3;case 86:e.prev=86,e.prev=87,!w&&S.return&&S.return();case 89:if(e.prev=89,!k){e.next=92;break}throw E;case 92:return e.finish(89);case 93:return e.finish(86);case 94:F=!0,j=!1,T=void 0,e.prev=97,O=regeneratorRuntime.mark(function e(){var t,r,n,i,o,a,s,u,c,l,f,p,h,d,m,v;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=B.value,r=t.refs,n=t.history,i=t.currentExportDir,o=t.commits,a=t.name,s=t.type,L||(o=o.filter(function(e){return!e.deleted})),u=I?o.map(function(e){if(e.deleted||e._deleted||!e.content)return null;delete e._rev;var t=P.snapshotResourceFor(e);return{from:t,to:i.join(t.parent().name()+"/"+t.name())}}).filter(Boolean):[],I||o.forEach(function(e){delete e._rev}),e.next=7,i.ensureExistance();case 7:return e.next=9,i.join("index.json").writeJson({name:a,type:s});case 9:return e.next=11,i.join("commits.json").writeJson(o);case 11:return e.next=13,i.join("history.json").writeJson({refs:r,history:n});case 13:c=!0,l=!1,f=void 0,e.prev=16,p=u[Symbol.iterator]();case 18:if(c=(h=p.next()).done){e.next=26;break}return d=h.value,m=d.from,v=d.to,e.next=23,m.copyTo(v);case 23:c=!0,e.next=18;break;case 26:e.next=32;break;case 28:e.prev=28,e.t0=e.catch(16),l=!0,f=e.t0;case 32:e.prev=32,e.prev=33,!c&&p.return&&p.return();case 35:if(e.prev=35,!l){e.next=38;break}throw f;case 38:return e.finish(35);case 39:return e.finish(32);case 40:case"end":return e.stop()}},e,P,[[16,28,32,40],[33,,35,39]])}),R=o[Symbol.iterator]();case 100:if(F=(B=R.next()).done){e.next=105;break}return e.delegateYield(O(),"t4",102);case 102:F=!0,e.next=100;break;case 105:e.next=111;break;case 107:e.prev=107,e.t5=e.catch(97),j=!0,T=e.t5;case 111:e.prev=111,e.prev=112,!F&&R.return&&R.return();case 114:if(e.prev=114,!j){e.next=117;break}throw T;case 117:return e.finish(114);case 118:return e.finish(111);case 119:case"end":return e.stop()}},e,this,[[21,44,48,56],[49,,51,55],[61,82,86,94],[87,,89,93],[97,107,111,119],[112,,114,118]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"exportToSpecs",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l,f,p,h,d,m,v,y,g,b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],t){e.next=10;break}return t=[],e.next=5,this.objectStats();case 5:if(e.t0=e.sent,e.t0){e.next=8;break}e.t0={};case 8:n=e.t0;for(i in n)for(o in n[i])t.push({type:i,name:o});case 10:a=!0,s=!1,u=void 0,e.prev=13,c=t[Symbol.iterator]();case 15:if(a=(l=c.next()).done){e.next=33;break}return f=l.value,p=f.name,h=f.type,e.next=20,this.versionGraph(h,p);case 20:return d=e.sent,m=d.refs,v=d.history,y=Object.keys(v),e.next=26,this.getCommitsWithIds(y);case 26:g=e.sent,b||(g=g.filter(function(e){return!e.deleted})),g.forEach(function(e){delete e._rev}),r.push({type:h,name:p,commits:g,history:{refs:m,history:v}});case 30:a=!0,e.next=15;break;case 33:e.next=39;break;case 35:e.prev=35,e.t1=e.catch(13),s=!0,u=e.t1;case 39:e.prev=39,e.prev=40,!a&&c.return&&c.return();case 42:if(e.prev=42,!s){e.next=45;break}throw u;case 45:return e.finish(42);case 46:return e.finish(39);case 47:return e.abrupt("return",r);case 48:case"end":return e.stop()}},e,this,[[13,35,39,47],[40,,42,46]])}));return function(t){return e.apply(this,arguments)}}()},{key:"importFromDir",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l,f,p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([t.join("index.json").readJson(),t.join("commits.json").readJson(),t.join("history.json").readJson()]);case 2:if(r=e.sent,n=slicedToArray(r,3),i=n[0],o=i.type,a=i.name,s=n[1],u=n[2],!d){e.next=15;break}return e.next=12,t.dirList(1,{exclude:function(e){return!e.isDirectory()}});case 12:e.t0=e.sent,e.next=16;break;case 15:e.t0=[];case 16:return c=e.t0,e.abrupt("return",{dir:t,type:o,name:a,commits:s,history:u,snapshotDirs:c});case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.dirList(3,{exclude:function(e){return!e.isDirectory()&&"index.json"!==e.name()}});case 2:r=e.sent,r=r.filter(function(e){return"index.json"===e.name()}),n=r.map(function(e){return e.parent()}),i=this.snapshotLocation,o=[],a=!0,s=!1,u=void 0,e.prev=9,c=n[Symbol.iterator]();case 11:if(a=(l=c.next()).done){e.next=21;break}return f=l.value,e.t0=o,e.next=16,h(f);case 16:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 18:a=!0,e.next=11;break;case 21:e.next=27;break;case 23:e.prev=23,e.t2=e.catch(9),s=!0,u=e.t2;case 27:e.prev=27,e.prev=28,!a&&c.return&&c.return();case 30:if(e.prev=30,!s){e.next=33;break}throw u;case 33:return e.finish(30);case 34:return e.finish(27);case 35:return e.abrupt("return",this.importFromSpecs(o,p,d));case 36:case"end":return e.stop()}},e,this,[[9,23,27,35],[28,,30,34]])}));return function(t){return e.apply(this,arguments)}}()},{key:"importFromSpecs",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l,f,p,h,d,m,v,y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],g=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(y){e.next=36;break}if(e.t0=this.__versionDB,e.t0){e.next=6;break}return e.next=5,this._versionDB();case 5:e.t0=e.sent;case 6:r=e.t0,n=!0,i=!1,o=void 0,e.prev=10,a=t[Symbol.iterator]();case 12:if(n=(s=a.next()).done){e.next=22;break}return u=s.value,c=u.type,l=u.name,e.next=17,r.get(c+"/"+l);case 17:if(!e.sent){e.next=19;break}throw new Error("Import failed: object "+c+"/"+l+" already exists and overwrite is not allowed");case 19:n=!0,e.next=12;break;case 22:e.next=28;break;case 24:e.prev=24,e.t1=e.catch(10),i=!0,o=e.t1;case 28:e.prev=28,e.prev=29,!n&&a.return&&a.return();case 31:if(e.prev=31,!i){e.next=34;break}throw o;case 34:return e.finish(31);case 35:return e.finish(28);case 36:f=!0,p=!1,h=void 0,e.prev=39,d=t[Symbol.iterator]();case 41:if(f=(m=d.next()).done){e.next=48;break}return v=m.value,e.next=45,this.importFromSpec(v,!0,g);case 45:f=!0,e.next=41;break;case 48:e.next=54;break;case 50:e.prev=50,e.t2=e.catch(39),p=!0,h=e.t2;case 54:e.prev=54,e.prev=55,!f&&d.return&&d.return();case 57:if(e.prev=57,!p){e.next=60;break}throw h;case 60:return e.finish(57);case 61:return e.finish(54);case 62:return e.abrupt("return",t);case 63:case"end":return e.stop()}},e,this,[[10,24,28,36],[29,,31,35],[39,50,54,62],[55,,57,61]])}));return function(t){return e.apply(this,arguments)}}()},{key:"importFromSpec",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.__versionDB,e.t0){e.next=5;break}return e.next=4,this._versionDB();case 4:e.t0=e.sent;case 5:if(r=e.t0,e.t1=this.__commitDB,e.t1){e.next=11;break}return e.next=10,this._commitDB();case 10:e.t1=e.sent;case 11:if(n=e.t1,i=this.snapshotLocation,o=t.type,a=t.name,s=t.commits,u=t.history,c=t.snapshotDirs,e.t2=!l,!e.t2){e.next=23;break}return e.next=22,r.get(o+"/"+a);case 22:e.t2=e.sent;case 23:if(!e.t2){e.next=25;break}throw new Error("Import failed: object "+o+"/"+a+" already exists and overwrite is not allowed");case 25:return e.next=27,Promise.all([n.setDocuments(s),r.set(o+"/"+a,u)].concat(toConsumableArray(c&&f?c.map(function(e){return e.copyTo(i.join(e.name()).asDirectory())}):[])));case 27:return e.abrupt("return",t);case 28:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"importFromResource",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n,i){var o,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.readJson();case 2:if(o=e.sent,e.t0=a,!e.t0){e.next=8;break}return e.next=7,this.has(t,r);case 7:e.t0=e.sent;case 8:if(!e.t0){e.next=11;break}return e.next=11,this.delete(t,r,!1);case 11:return e.abrupt("return",this.commit(t,r,o,i));case 12:case"end":return e.stop()}},e,this)}));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"replicateTo",value:function(e,t,r,n){return new Synchronization(this,e,t,r,_extends({method:"replicateTo"},n)).start()}},{key:"replicateFrom",value:function(e,t,r,n){return new Synchronization(this,e,t,r,_extends({method:"replicateFrom"},n)).start()}},{key:"sync",value:function(e,t,r,n){return new Synchronization(this,e,t,r,_extends({method:"sync"},n)).start()}},{key:"getConflicts",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(n,i){var o,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getConflicts({include_docs:!0});case 2:return o=e.sent,e.next=5,Promise.all(o.map(function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(o){var s,u,c,l,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=o.id,u=o.rev,c=o.conflicts,l=o.doc,!r||!r[i]||r[i][s]){e.next=3;break}return e.abrupt("return",null);case 3:if(!t){e.next=8;break}return f=c.map(function(e){return{id:s,rev:e}}),e.next=7,n.getDocuments(f);case 7:c=e.sent;case 8:return t?lively_lang.obj.dissoc(l,["_conflicts"]):l=null,e.abrupt("return",{id:s,rev:u,conflicts:c,kind:i,doc:l});case 10:case"end":return e.stop()}},e,a)}));return function(t){return e.apply(this,arguments)}}()));case 5:return e.t0=Boolean,e.abrupt("return",e.sent.filter(e.t0));case 7:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}();return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.__commitDB,e.t0){e.next=5;break}return e.next=4,this._commitDB();case 4:e.t0=e.sent;case 5:if(n=e.t0,e.t1=this.__versionDB,e.t1){e.next=11;break}return e.next=10,this._versionDB();case 10:e.t1=e.sent;case 11:return i=e.t1,e.next=14,o(i,"versions");case 14:return e.t2=e.sent,e.next=17,o(n,"commits");case 17:return e.next=19,e.sent;case 19:return e.t3=e.sent,e.abrupt("return",{versionConflicts:e.t2,commitConflicts:e.t3});case 21:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"resolveConflict",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.resolved,n=t.delete,i=t.kind,o=t.id,a=void 0,"versions"!==i){e.next=10;break}if(e.t0=this.__versionDB,e.t0){e.next=7;break}return e.next=6,this._versionDB();case 6:e.t0=e.sent;case 7:a=e.t0,e.next=20;break;case 10:if("commits"!==i){e.next=19;break}if(e.t1=this.__commitDB,e.t1){e.next=16;break}return e.next=15,this._commitDB();case 15:e.t1=e.sent;case 16:a=e.t1,e.next=20;break;case 19:throw new Error("Unknown conflict kind: "+i);case 20:return e.next=22,a.set(o,r);case 22:return e.next=24,Promise.all(n.map(function(e){return a.pouchdb.remove(o,e)}));case 24:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getDiff",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,s,u,c,l,f,p,h,d,m,v,y,g,b,_,x,w,k,E,S,A,D,C,F,j,T,O,R,B,P=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t,"string"==typeof t&&(n=Database.ensureDB(t+"-commits"),r=Database.ensureDB(t+"-version-graph")),e.t0=this.__commitDB,e.t0){e.next=7;break}return e.next=6,this._commitDB();case 6:e.t0=e.sent;case 7:if(i=e.t0,e.t1=this.__versionDB,e.t1){e.next=13;break}return e.next=12,this._versionDB();case 12:e.t1=e.sent;case 13:return o=e.t1,e.next=16,i.diffWith(n);case 16:return a=e.sent,e.next=19,o.diffWith(r);case 19:return s=e.sent,e.next=22,Promise.all(s.inLeft.map(function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.id,e.next=3,o.get(t.id);case 3:return e.t1=e.sent,e.abrupt("return",{id:e.t0,doc:e.t1});case 5:case"end":return e.stop()}},e,P)}));return function(t){return e.apply(this,arguments)}}()));case 22:return u=e.sent,e.next=25,Promise.all(s.inRight.map(function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.id,e.next=3,r.get(t.id);case 3:return e.t1=e.sent,e.abrupt("return",{id:e.t0,doc:e.t1});case 5:case"end":return e.stop()}},e,P)}));return function(t){return e.apply(this,arguments)}}()));case 25:return c=e.sent,e.next=28,Promise.all(s.changed.map(function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=babelHelpers$1,e.t1={},e.t2=t.left,e.next=5,o.get(t.left.id);case 5:return e.t3=e.sent,e.next=8,r.get(t.right.id);case 8:return e.t4=e.sent,e.t5={docA:e.t3,docB:e.t4},e.abrupt("return",e.t0.extends.call(e.t0,e.t1,e.t2,e.t5));case 11:case"end":return e.stop()}},e,P)}));return function(t){return e.apply(this,arguments)}}()));case 28:l=e.sent,f=[],p=[],h=[],d=!0,m=!1,v=void 0,e.prev=35,y=a.inLeft[Symbol.iterator]();case 37:if(d=(g=y.next()).done){e.next=47;break}return b=g.value,e.t2=f,e.next=42,i.get(b.id);case 42:e.t3=e.sent,e.t2.push.call(e.t2,e.t3);case 44:d=!0,e.next=37;break;case 47:e.next=53;break;case 49:e.prev=49,e.t4=e.catch(35),m=!0,v=e.t4;case 53:e.prev=53,e.prev=54,!d&&y.return&&y.return();case 56:if(e.prev=56,!m){e.next=59;break}throw v;case 59:return e.finish(56);case 60:return e.finish(53);case 61:_=!0,x=!1,w=void 0,e.prev=64,k=a.inRight[Symbol.iterator]();case 66:if(_=(E=k.next()).done){e.next=76;break}return S=E.value,e.t5=p,e.next=71,n.get(S.id);case 71:e.t6=e.sent,e.t5.push.call(e.t5,e.t6);case 73:_=!0,e.next=66;break;case 76:e.next=82;break;case 78:e.prev=78,e.t7=e.catch(64),x=!0,w=e.t7;case 82:e.prev=82,e.prev=83,!_&&k.return&&k.return();case 85:if(e.prev=85,!x){e.next=88;break}throw w;case 88:return e.finish(85);case 89:return e.finish(82);case 90:A=!0,D=!1,C=void 0,e.prev=93,F=a.changed[Symbol.iterator]();case 95:if(A=(j=F.next()).done){e.next=110;break}return T=j.value,e.t8=h,e.next=100,i.get(T.left.id);case 100:return e.t9=e.sent,e.t8.push.call(e.t8,e.t9),e.t10=h,e.next=105,n.get(T.right.id);case 105:e.t11=e.sent,e.t10.push.call(e.t10,e.t11);case 107:A=!0,e.next=95;break;case 110:e.next=116;break;case 112:e.prev=112,e.t12=e.catch(93),D=!0,C=e.t12;case 116:e.prev=116,e.prev=117,!A&&F.return&&F.return();case 119:if(e.prev=119,!D){e.next=122;break}throw C;case 122:return e.finish(119);case 123:return e.finish(116);case 124:return O=f.map(function(e){return lively_lang.obj.select(e,["_id","name","type"])}),R=p.map(function(e){return lively_lang.obj.select(e,["_id","name","type"])}),B=h.map(function(e){return lively_lang.obj.select(e,["_id","name","type"])}),e.abrupt("return",{changed:l,remote:c,local:u,changedCommitTypeAndNames:B,remoteCommitTypeAndNames:R,localCommitTypeAndNames:O});case 126:case"end":return e.stop()}},e,this,[[35,49,53,61],[54,,56,60],[64,78,82,90],[83,,85,89],[93,112,116,124],[117,,119,123]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,s,u,c,l,f,p,h,d,m,v,y,g,b,_,x=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],i=[],e.t0=this.__commitDB,e.t0){e.next=6;break}return e.next=5,this._commitDB();case 5:e.t0=e.sent;case 6:return o=e.t0,a={include_docs:!0,startkey:t+"\0"+r+"\0",endkey:t+"\0"+r+""},e.next=10,o.query("nameAndTimestamp_index",a);case 10:for(s=e.sent,u=s.rows,c=!0,l=!1,f=void 0,e.prev=15,p=u[Symbol.iterator]();!(c=(h=p.next()).done);c=!0)d=h.value,(m=d.doc).deleted||m._deleted||!m.content||n.push(this.snapshotResourceFor(m)),i.push(_extends({},m,{_deleted:!0}));e.next=23;break;case 19:e.prev=19,e.t1=e.catch(15),l=!0,f=e.t1;case 23:e.prev=23,e.prev=24,!c&&p.return&&p.return();case 26:if(e.prev=26,!l){e.next=29;break}throw f;case 29:return e.finish(26);case 30:return e.finish(23);case 31:if(e.t2=this.__versionDB,e.t2){e.next=36;break}return e.next=35,this._versionDB();case 35:e.t2=e.sent;case 36:return v=e.t2,e.next=39,v.get(t+"/"+r);case 39:if(y=e.sent,g=y._id,b=y._rev,_={_id:g,_rev:b,_deleted:!0},x){e.next=49;break}return e.next=46,o.setDocuments(i);case 46:return e.next=48,v.setDocuments([_]);case 48:Promise.all(n.map(function(e){return e.remove()}));case 49:return e.abrupt("return",{commits:i,history:_,resources:n});case 50:case"end":return e.stop()}},e,this,[[15,19,23,31],[24,,26,30]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"deleteCommit",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l,f,p,h,d,m,v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"HEAD";return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=void 0,!t||"string"==typeof t){e.next=5;break}r=t,e.next=15;break;case 5:if(!t){e.next=15;break}if(e.t0=this.__commitDB,e.t0){e.next=11;break}return e.next=10,this._commitDB();case 10:e.t0=e.sent;case 11:return n=e.t0,e.next=14,n.get(t);case 14:r=e.sent;case 15:if(r){e.next=17;break}throw new Error("commit needed!");case 17:if(e.t1=this.__versionDB,e.t1){e.next=22;break}return e.next=21,this._versionDB();case 21:e.t1=e.sent;case 22:if(i=e.t1,e.t2=this.__commitDB,e.t2){e.next=28;break}return e.next=27,this._commitDB();case 27:e.t2=e.sent;case 28:return o=e.t2,a=r,s=a.name,u=a.type,c=a._id,l=r.deleted||r._deleted||!r.content?[]:[this.snapshotResourceFor(r)],f=[_extends({},r,{_deleted:!0})],e.next=37,i.get(u+"/"+s);case 37:if(p=e.sent){e.next=40;break}throw new Error("No history for "+u+"/"+s+"@"+r._id);case 40:if(p.refs[y]){e.next=42;break}throw new Error("Cannot delete commit "+u+"/"+s+"@"+r._id+" b/c it is not where ref "+y+" is pointing!");case 42:if(h=p.history[r._id]||[],d=slicedToArray(h,1),(m=d[0])||!(Object.keys(p.history).length<=1)){e.next=47;break}p._deleted=!0,e.next=53;break;case 47:if(m){e.next=51;break}throw new Error("Cannot delete commit "+u+"/"+s+"@"+r._id+" b/c it has no ancestor but there are still other commits!");case 51:delete p.history[r._id],p.refs[y]=m;case 53:if(v){e.next=60;break}return e.next=56,i.set(u+"/"+s,p);case 56:return e.next=58,o.setDocuments(f);case 58:return e.next=60,Promise.all(l.map(function(e){return e.remove()}));case 60:return e.abrupt("return",{commits:f,history:p,resources:l});case 61:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_commitdb_indexes",get:function(){return[{name:"name_index",version:4,mapFn:'function (doc) { emit(doc.type + "\0" + doc.name); }'},{name:"nameAndTimestamp_index",version:3,mapFn:'function (doc) { emit(doc.type + "\0" + doc.name + "\0" + doc.timestamp + "\0" + doc._id); }'},{name:"nameWithMaxMinTimestamp_index",version:3,mapFn:'function(doc) { emit(doc.type + "\0" + doc.name, doc.timestamp); }',reduceFn:"_stats"},{name:"nameTypeFilter",version:7,filterFn:'function(doc, req) {\n          if (doc._id[0] === "_" || !req || !req.query) return true;\n          if (req.query.onlyIds) return !!req.query.onlyIds[doc._id];\n          if (req.query.onlyTypesAndNames)\n            return !!req.query.onlyTypesAndNames[doc.type + "/" + doc.name];\n          return true;\n        }'}]}},{key:"_versiondb_indexes",get:function(){return[{name:"nameTypeFilter",version:3,filterFn:'function(doc, req) {\n          if (doc._id[0] === "_" || !req || !req.query) return true;\n          if (req.query.onlyIds) return !!req.query.onlyIds[doc._id];\n          if (req.query.onlyTypesAndNames) return !!req.query.onlyTypesAndNames[doc._id];\n          return true;\n        }'}]}}]),e}(),Synchronization=function(){function Synchronization(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};classCallCheck(this,Synchronization),this.options=_extends({debug:!1,live:!1,method:"sync",replicationFilter:void 0},i),this.state="not started",this.method="",this.fromObjectDB=e,this.remoteCommitDB=t,this.remoteVersionDB=r,this.remoteLocation=n,this.deferred=lively_lang.promise.deferred(),this.conflicts=[],this.changes=[],this.errors=[]}return createClass(Synchronization,[{key:"whenPaused",value:function(){var e=this;return Promise.resolve().then(function(){return lively_lang.promise.waitFor(function(){return e.isPaused||e.isComplete})}).then(function(){return e})}},{key:"waitForIt",value:function(){return this.deferred.promise}},{key:"start",value:function(){return this.isSynchonizing||this._startReplicationAndCopy().catch(function(e){return console.error("Error starting synchronization: ",e)}),this}},{key:"_startReplicationAndCopy",value:function(){function _startReplicationAndCopy(){return _ref69.apply(this,arguments)}var _ref69=asyncToGenerator(regeneratorRuntime.mark(function _callee40(){var _this5=this,fromObjectDB,remoteCommitDB,remoteVersionDB,remoteLocation,_options,debug,_options$live,live,_options$retry,retry,method,replicationFilter,_options$pushDesignDo,pushDesignDocToRemote,versionDB,commitDB,_commitdb_indexes,_versiondb_indexes,fromSnapshotLocation,versionChangeListener,commitChangeListener,commitNameTypeFilter,versionNameTypeFilter,opts,commitOpts,versionOpts,commitReplication,versionReplication,snapshotReplication,commitReplicationState,versionReplicationState,updateState,tryToResolve,snapshotPathFor;return regeneratorRuntime.wrap(function _callee40$(_context41){for(;;)switch(_context41.prev=_context41.next){case 0:if(snapshotPathFor=function(e){return e.content?e.content.slice(0,2)+"/"+e.content.slice(2)+".json":null},tryToResolve=function(e,t){if(t.length||"complete"===commitReplicationState&&"complete"===versionReplicationState&&snapshotReplication.isComplete()){versionChangeListener.cancel();var r=void 0;t.length?(e.state="complete",e.errors=t,commitReplication.cancel(),versionReplication.cancel(),(r=new Error("Synchronization error:\n  "+t.join("\n  "))).errors=t,console.log(e+" errored")):console.log(e+" completed"),r?e.deferred.reject(r):e.deferred.resolve(e)}},updateState=function(e){return"paused"===versionReplicationState&&"paused"===commitReplicationState&&snapshotReplication.copyCalls<=0&&snapshotReplication.copyCallsWaiting<=0?e.state="paused":"complete"===versionReplicationState&&"complete"===commitReplicationState&&snapshotReplication.isComplete()?e.state="complete":e.state="running"},fromObjectDB=this.fromObjectDB,remoteCommitDB=this.remoteCommitDB,remoteVersionDB=this.remoteVersionDB,remoteLocation=this.remoteLocation,_options=this.options,debug=_options.debug,_options$live=_options.live,live=void 0!==_options$live&&_options$live,_options$retry=_options.retry,retry=void 0!==_options$retry&&_options$retry,method=_options.method,replicationFilter=_options.replicationFilter,_options$pushDesignDo=_options.pushDesignDocToRemote,pushDesignDocToRemote=void 0!==_options$pushDesignDo&&_options$pushDesignDo,_context41.t0=fromObjectDB.__versionDB,_context41.t0){_context41.next=22;break}return _context41.next=21,fromObjectDB._versionDB();case 21:_context41.t0=_context41.sent;case 22:if(versionDB=_context41.t0,_context41.t1=fromObjectDB.__commitDB,_context41.t1){_context41.next=28;break}return _context41.next=27,fromObjectDB._commitDB();case 27:_context41.t1=_context41.sent;case 28:if(commitDB=_context41.t1,_commitdb_indexes=fromObjectDB._commitdb_indexes,_versiondb_indexes=fromObjectDB._versiondb_indexes,fromSnapshotLocation=fromObjectDB.snapshotLocation,versionChangeListener=void 0,commitChangeListener=void 0,this.method=method,commitNameTypeFilter=_commitdb_indexes.find(function(e){return"nameTypeFilter"===e.name}),versionNameTypeFilter=_versiondb_indexes.find(function(e){return"nameTypeFilter"===e.name}),!pushDesignDocToRemote){_context41.next=43;break}return console.log("adding commitNameTypeFilter"),_context41.next=40,remoteCommitDB.addDesignDoc(commitNameTypeFilter);case 40:return console.log("adding versionNameTypeFilter"),_context41.next=43,remoteVersionDB.addDesignDoc(versionNameTypeFilter);case 43:return opts={live:live,retry:retry},commitOpts=_extends({},opts),versionOpts=_extends({},opts),replicationFilter&&(commitOpts.filter=eval("("+commitNameTypeFilter.filterFn+")"),commitOpts.query_params=replicationFilter,versionOpts.filter=eval("("+versionNameTypeFilter.filterFn+")"),versionOpts.query_params=replicationFilter),commitReplication=commitDB[method](remoteCommitDB,commitOpts),versionReplication=versionDB[method](remoteVersionDB,versionOpts),snapshotReplication={copyCalls:0,copyCallsWaiting:0,nFilesToCopy:0,nFilesCopied:0,stopped:!1,isComplete:function(){return this.stopped||this.copyCalls<=0&&this.copyCallsWaiting<=0}},commitReplicationState="not started",versionReplicationState="not started",this.versionReplication=versionReplication,this.commitReplication=commitReplication,this.snapshotReplication=snapshotReplication,commitChangeListener=remoteCommitDB.pouchdb.changes({include_docs:!0,live:!0,conflicts:!0}),versionChangeListener=remoteVersionDB.pouchdb.changes({include_docs:!0,live:!0,conflicts:!0}),commitChangeListener.on("change",function(e){var t=e.id,r=e.changes,n=e.doc._conflicts;debug&&console.log("commit changes "+t+":",r,n),n&&(console.log("commit conflict "+t+":",r,n),_this5.conflicts.push({db:"commits",id:t,changes:r,conflicts:n}))}),versionChangeListener.on("change",function(e){var t=e.id,r=e.changes,n=e.doc._conflicts;debug&&console.log("version changes "+t+":",r,n),n&&(console.log("version conflict "+t+":",r,n),_this5.conflicts.push({db:"versions",id:t,changes:r,conflicts:n}))}),commitReplication.on("change",function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l,f,p,h,d,m,v;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:"replicateTo"===method?t={direction:"push",change:t}:"replicateFrom"===method&&(t={direction:"pull",change:t}),n=(r=t).direction,i=r.change,o=i.ok,a=i.docs,s=i.errors,console.log(_this5+" "+("push"===n?"send":"received")+" "+a.length+" commits"),e.prev=3,c=[],l=!0,f=!1,p=void 0,e.prev=8,h=a[Symbol.iterator]();case 10:if(l=(d=h.next()).done){e.next=20;break}if(!(m=d.value)._id.startsWith("_")){e.next=14;break}return e.abrupt("continue",17);case 14:_this5.changes.push({direction:n,kind:"commits",id:m._id,type:m.type,name:m.name}),(v=snapshotPathFor(m))&&c.push(v);case 17:l=!0,e.next=10;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(8),f=!0,p=e.t0;case 26:e.prev=26,e.prev=27,!l&&h.return&&h.return();case 29:if(e.prev=29,!f){e.next=32;break}throw p;case 32:return e.finish(29);case 33:return e.finish(26);case 34:if(snapshotReplication.nFilesToCopy+=c.length,!(snapshotReplication.copyCalls>0)){e.next=40;break}return snapshotReplication.copyCallsWaiting++,e.next=39,lively_lang.promise.waitFor(function(){return snapshotReplication.copyCalls<=0});case 39:snapshotReplication.copyCallsWaiting--;case 40:return snapshotReplication.copyCalls++,updateState(_this5),console.log(_this5+" copying "+c.length+" snapshots..."),e.next=45,lively_lang.promise.parallel(c.map(function(e){return function(){var t=("push"===n?fromSnapshotLocation:remoteLocation).join(e),r=("push"===n?remoteLocation:fromSnapshotLocation).join(e);return snapshotReplication.stopped?(console.warn(_this5+" Stopping copying resources b/c synchronization ended ("+snapshotReplication.copyCalls+", "+t.url+" => "+r.url+")"),Promise.resolve()):r.exists().then(function(e){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t.copyTo(r).catch(function(t){if(e>=5)throw t;return n(e+1)})}return e?(debug&&console.log("Skip copying to "+r.url+", already exist"),Promise.resolve()):t.exists().then(function(e){return e?(debug&&console.log(_this5+" Copying "+t.url+" => "+r.url),n(0).then(function(e){return snapshotReplication.nFilesCopied++,snapshotReplication.stopped||snapshotReplication.nFilesCopied%10!=0||console.log(_this5+" copied "+snapshotReplication.nFilesCopied+" of "+snapshotReplication.nFilesToCopy+" snapshots"),e})):(console.warn("Skip copying "+t.url+", does not exist"),Promise.resolve())})})}}),5);case 45:console.log(_this5+" sending files done"),e.next=53;break;case 48:throw e.prev=48,e.t1=e.catch(3),console.error("error in commitReplication onChange",e.t1),u=e.t1,e.t1;case 53:return e.prev=53,snapshotReplication.copyCalls--,updateState(_this5),tryToResolve(_this5,u?[u]:[]),e.finish(53);case 58:case"end":return e.stop()}},e,_this5,[[3,48,53,58],[8,22,26,34],[27,,29,33]])}));return function(t){return e.apply(this,arguments)}}()).on("paused",function(){commitReplicationState="paused",updateState(_this5),debug&&console.log(_this5+" commit replication paused")}).on("active",function(){commitReplicationState="active",updateState(_this5),debug&&console.log(_this5+" commit replication active")}).on("error",function(e){commitReplicationState="complete",updateState(_this5),console.error(_this5+" commit replication error",e),tryToResolve(_this5,[e])}).on("complete",function(e){commitReplicationState="complete",updateState(_this5);var t="sync"===method?e.push.errors.concat(e.pull.errors):e.errors;tryToResolve(_this5,t)}),versionReplication.on("change",function(e){"replicateTo"===method?e={direction:"push",change:e}:"replicateFrom"===method&&(e={direction:"pull",change:e});var t=e,r=t.direction,n=t.change,i=(n.ok,n.docs);n.errors;debug&&console.log(_this5+" "+("push"===r?"send":"received")+" "+i.length+" histories"),i.forEach(function(e){e._id.startsWith("_")||_this5.changes.push({direction:r,kind:"versions",id:e._id})})}).on("paused",function(){versionReplicationState="paused",updateState(_this5),debug&&console.log(_this5+" version replication paused")}).on("active",function(e){versionReplicationState="active",updateState(_this5),debug&&console.log(_this5+" version replication active",e)}).on("error",function(e){versionReplicationState="complete",updateState(_this5),console.error(_this5+" version replication error",e),tryToResolve(_this5,[e])}).on("complete",function(e){versionReplicationState="complete",updateState(_this5);var t="sync"===method?e.push.errors.concat(e.pull.errors):e.errors;tryToResolve(_this5,t)}),this.state="running",_context41.abrupt("return",this);case 57:case"end":return _context41.stop()}},_callee40,this)}));return _startReplicationAndCopy}()},{key:"safeStop",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("not started"!==this.state&&this.isSynchonizing){e.next=2;break}return e.abrupt("return",this);case 2:return e.next=4,this.whenPaused();case 4:return e.abrupt("return",this.stop());case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){return"not started"!==this.state&&this.isSynchonizing?(this.commitReplication.cancel(),this.versionReplication.cancel(),this.snapshotReplication.stopped=!0,this):this}},{key:"toString",value:function(){var e=this.method;return"Synchronization("+this.state+": "+this.fromObjectDB.name+" "+("sync"===e?"<=>":"replicateTo"===e?"=>":"replicateFrom"===e?"<=":"??")+")"}},{key:"isSynchonizing",get:function(){return this.isPaused||this.isRunning}},{key:"isComplete",get:function(){return"complete"===this.state}},{key:"isRunning",get:function(){return"running"===this.state}},{key:"isPaused",get:function(){return"paused"===this.state}},{key:"changesByTypeAndName",get:function(){var e={push:{},pull:{}};return this.changes.forEach(function(t){var r=t.direction,n=t.id,i=t.kind;if("_"!==n[0]){var o=void 0;if("versions"===i)o=e[r][n]||(e[r][n]=[]);else if("commits"===i){var a=t.type+"/"+t.name;o=e[r][a]||(e[r][a]=[])}o.push(t)}}),e}}]),Synchronization}(),ObjectDBInterface={describe:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(a=function(e,t){var r=e.find(function(e){return e.name===t}).node.value.body,n=r.body||[],i=(r.comments||[]).find(function(e){return e.end<n[0].start}),o={name:t,parameters:[],sideEffect:!1,returns:null,description:""};if(i&&i.text.trim()){var a=lively.lang.string.changeIndent(i.text," ",0).split("\n"),s=!0,u=!1,c=void 0;try{for(var l,f=a[Symbol.iterator]();!(s=(l=f.next()).done);s=!0){var p=l.value;if(p.startsWith("ignore-in-doc")){o.description="";break}p.startsWith("side effect:")?o.sideEffect=JSON.parse(p.split(":")[1]):p.startsWith("returns:")?o.returns=p.split(":")[1].trim():o.description+=p+"\n"}}catch(e){u=!0,c=e}finally{try{!s&&f.return&&f.return()}finally{if(u)throw c}}}var h=!0,d=!1,m=void 0;try{for(var v,y=n[Symbol.iterator]();!(h=(v=y.next()).done);h=!0){var g=v.value;if("checkArgs"===lively.lang.Path("declarations.0.init.callee.name").get(g)){var b=lively.lang.Path("declarations.0.id.properties").get(g);b&&(o.parameters=b.map(function(e){return e.key.name}))}}}catch(e){d=!0,m=e}finally{try{!h&&y.return&&y.return()}finally{if(d)throw m}}return o},r.prev=1,t._methodSpecs){r.next=9;break}return r.next=5,lively.modules.module("lively.storage/objectdb.js").source();case 5:n=r.sent,i=lively.ast.parse(n,{withComments:!0}),o=lively.ast.categorizer.findDecls(i),t._methodSpecs=o.filter(function(e){return e.parent&&"ObjectDBInterface"===e.parent.name});case 9:return r.abrupt("return",e?a(t._methodSpecs,e):t._methodSpecs.map(function(e){return a(t._methodSpecs,e.name)}).filter(Boolean));case 12:return r.prev=12,r.t0=r.catch(1),r.abrupt("return","Error in describe "+r.t0);case 15:case"end":return r.stop()}},r,t,[[1,12]])}))()},ensureDB:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",snapshotLocation:"string|Resource"}),i=n.db,o=n.snapshotLocation,t.next=5,ObjectDB.find(i);case 5:if(!(a=t.sent)){t.next=8;break}return t.abrupt("return",!1);case 8:return ObjectDB.named(i,{snapshotLocation:o}),t.abrupt("return",!0);case 10:case"end":return t.stop()}},r,t)}))()},destroyDB:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string"}),i=n.db,t.next=4,ObjectDB.find(i);case 4:if(o=t.sent){t.next=7;break}return t.abrupt("return",!1);case 7:return t.next=9,o.destroy();case 9:return t.abrupt("return",!0);case 10:case"end":return t.stop()}},r,t)}))()},fetchCommits:function fetchCommits(args){var _this9=this;return asyncToGenerator(regeneratorRuntime.mark(function _callee45(){var _checkArgs3,dbName,ref,type,typesAndNames,knownCommitIds,includeDeleted,filterFn,db,commitDB,versionDB,versionQueryOpts,refsByTypeAndName,keys,_iteratorNormalCompletion17,_didIteratorError17,_iteratorError17,_iterator17,_step17,_ref73,_type2,name,_ref74,versions,commitIds,_iteratorNormalCompletion18,_didIteratorError18,_iteratorError18,_iterator18,_step18,version,_id,refs,commitId,commits,fn,filteredCommits;return regeneratorRuntime.wrap(function _callee45$(_context46){for(;;)switch(_context46.prev=_context46.next){case 0:return _checkArgs3=checkArgs(args,{db:"string",ref:"string|undefined",type:"string|undefined",typesAndNames:"Array|undefined",knownCommitIds:"object|undefined",includeDeleted:"boolean|undefined",filterFn:"string|undefined"}),dbName=_checkArgs3.db,ref=_checkArgs3.ref,type=_checkArgs3.type,typesAndNames=_checkArgs3.typesAndNames,knownCommitIds=_checkArgs3.knownCommitIds,includeDeleted=_checkArgs3.includeDeleted,filterFn=_checkArgs3.filterFn,_context46.next=10,ObjectDB.find(dbName);case 10:if(db=_context46.sent,ref||(ref="HEAD"),db){_context46.next=14;break}throw new Error("db "+dbName+" does not exist");case 14:if(_context46.t0=db.__commitDB,_context46.t0){_context46.next=19;break}return _context46.next=18,db._commitDB();case 18:_context46.t0=_context46.sent;case 19:if(commitDB=_context46.t0,_context46.t1=db.__versionDB,_context46.t1){_context46.next=25;break}return _context46.next=24,db._versionDB();case 24:_context46.t1=_context46.sent;case 25:if(versionDB=_context46.t1,versionQueryOpts={},refsByTypeAndName={},!typesAndNames){_context46.next=50;break}for(keys=versionQueryOpts.keys=[],_iteratorNormalCompletion17=!0,_didIteratorError17=!1,_iteratorError17=void 0,_context46.prev=32,_iterator17=typesAndNames[Symbol.iterator]();!(_iteratorNormalCompletion17=(_step17=_iterator17.next()).done);_iteratorNormalCompletion17=!0)_ref73=_step17.value,_type2=_ref73.type,name=_ref73.name,_ref74=_ref73.ref,keys.push(_type2+"/"+name),_ref74&&(refsByTypeAndName[_type2+"/"+name]=_ref74);_context46.next=40;break;case 36:_context46.prev=36,_context46.t2=_context46.catch(32),_didIteratorError17=!0,_iteratorError17=_context46.t2;case 40:_context46.prev=40,_context46.prev=41,!_iteratorNormalCompletion17&&_iterator17.return&&_iterator17.return();case 43:if(_context46.prev=43,!_didIteratorError17){_context46.next=46;break}throw _iteratorError17;case 46:return _context46.finish(43);case 47:return _context46.finish(40);case 48:_context46.next=51;break;case 50:type&&(versionQueryOpts.startkey=type+'/\0"',versionQueryOpts.endkey=type+'/"');case 51:return _context46.next=53,versionDB.getAll(versionQueryOpts);case 53:versions=_context46.sent,commitIds=[],_iteratorNormalCompletion18=!0,_didIteratorError18=!1,_iteratorError18=void 0,_context46.prev=58,_iterator18=versions[Symbol.iterator]();case 60:if(_iteratorNormalCompletion18=(_step18=_iterator18.next()).done){_context46.next=73;break}if(!(version=_step18.value).deleted&&!version._deleted){_context46.next=64;break}return _context46.abrupt("continue",70);case 64:if(_id=version._id,refs=version.refs,!_id.startsWith("_")){_context46.next=67;break}return _context46.abrupt("continue",70);case 67:ref=refsByTypeAndName[_id]||ref,commitId=refs[ref],(commitId&&!knownCommitIds||!knownCommitIds.hasOwnProperty(commitId))&&commitIds.push(commitId);case 70:_iteratorNormalCompletion18=!0,_context46.next=60;break;case 73:_context46.next=79;break;case 75:_context46.prev=75,_context46.t3=_context46.catch(58),_didIteratorError18=!0,_iteratorError18=_context46.t3;case 79:_context46.prev=79,_context46.prev=80,!_iteratorNormalCompletion18&&_iterator18.return&&_iterator18.return();case 82:if(_context46.prev=82,!_didIteratorError18){_context46.next=85;break}throw _iteratorError18;case 85:return _context46.finish(82);case 86:return _context46.finish(79);case 87:return _context46.next=89,db.getCommitsWithIds(commitIds);case 89:if(commits=_context46.sent,includeDeleted||(commits=commits.filter(function(e){return!e.deleted})),!filterFn){_context46.next=107;break}if(_context46.prev=92,"function"==typeof(fn=eval("("+filterFn+")"))){_context46.next=96;break}throw new Error(filterFn+" does not eval to a function!");case 96:if(filteredCommits=commits.filter(fn),Array.isArray(filteredCommits)){_context46.next=101;break}throw new Error(filterFn+" does not return an array!");case 101:commits=filteredCommits;case 102:_context46.next=107;break;case 104:_context46.prev=104,_context46.t4=_context46.catch(92),console.error("fetchCommits filterFn failed:",_context46.t4);case 107:return _context46.abrupt("return",commits);case 108:case"end":return _context46.stop()}},_callee45,_this9,[[32,36,40,48],[41,,43,47],[58,75,79,87],[80,,82,86],[92,104]])}))()},fetchVersionGraph:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,a,s,u,c,l;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",type:"string",name:"string"}),i=n.db,o=n.type,a=n.name,t.next=6,ObjectDB.find(i);case 6:if(s=t.sent){t.next=9;break}throw new Error("db "+i+" does not exist");case 9:return t.next=11,s.versionGraph(o,a);case 11:return u=t.sent,c=u.refs,l=u.history,t.abrupt("return",{refs:c,history:l});case 15:case"end":return t.stop()}},r,t)}))()},exists:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,a,s,u,c,l;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",type:"string",name:"string",ref:"string|undefined"}),i=n.db,o=n.type,a=n.name,s=n.ref,t.next=7,ObjectDB.find(i);case 7:return u=t.sent,t.next=10,u.versionGraph(o,a);case 10:if(c=t.sent){t.next=13;break}return t.abrupt("return",{exists:!1,commitId:void 0});case 13:if(s=s||"HEAD",l=c.refs[s]){t.next=17;break}return t.abrupt("return",{exists:!1,commitId:void 0});case 17:return t.abrupt("return",{exists:!0,commitId:l});case 18:case"end":return t.stop()}},r,t)}))()},fetchLog:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,a,s,u,c,l,f,p,h,d,m,v,y,g,b,_,x,w;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",type:"string|undefined",name:"string|undefined",ref:"string|undefined",commit:"string|undefined",limit:"number|undefined",includeCommits:"boolean|undefined",knownCommitIds:"object|undefined"},function(e){return e.type&&e.name||e.commit?null:{error:"Eiter .type + .name or .commit needed!"}}),i=n.db,o=n.type,a=n.name,s=n.ref,u=n.commit,c=n.limit,l=n.includeCommits,f=n.knownCommitIds,t.next=11,ObjectDB.find(i);case 11:if(p=t.sent,h=s||"HEAD",p){t.next=15;break}throw new Error("db "+i+" does not exist");case 15:if(c||(c=1/0),u||s||(s=h),d=void 0,!u){t.next=28;break}if(d=u,o&&a){t.next=28;break}return t.next=23,p.getCommit(u);case 23:if(m=t.sent){t.next=26;break}throw new Error("fetchLog: specified commit "+u+" but no commit with this id is in the database!");case 26:o=m.type,a=m.name;case 28:return t.next=30,p.versionGraph(o,a);case 30:if(v=t.sent){t.next=33;break}throw new Error("Unknown object "+o+"/"+a);case 33:y=v.refs,g=v.history,d||(d=y[s]),b=d,_=[];case 36:if(!(_.length<c)||_.includes(b)){t.next=45;break}if(_.push(b),(x=g[b])&&x.length){t.next=41;break}return t.abrupt("break",45);case 41:w=slicedToArray(x,1),b=w[0],t.next=36;break;case 45:if(!l){t.next=50;break}return f&&(_=_.filter(function(e){return!f.hasOwnProperty(e)})),t.next=49,p.getCommitsWithIds(_);case 49:_=t.sent;case 50:return t.abrupt("return",_);case 51:case"end":return t.stop()}},r,t)}))()},fetchSnapshot:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,a,s,u,c,l,f,p;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",type:"string|undefined",name:"string|undefined",ref:"string|undefined",commit:"string|undefined"},function(e){return e.type&&e.name||e.commit?null:{error:"Eiter .type + .name or .commit needed!"}}),i=n.db,o=n.type,a=n.name,s=n.ref,u=n.commit,t.next=8,ObjectDB.find(i);case 8:if(c=t.sent,l="HEAD",s=s||l,c){t.next=13;break}throw new Error("db "+i+" does not exist");case 13:if(u){t.next=22;break}return t.next=16,c.versionGraph(o,a);case 16:if(f=t.sent){t.next=19;break}throw new Error("Unknown object "+o+"/"+a);case 19:if(u=f.refs[s]){t.next=22;break}throw new Error("Cannot find commit for ref "+s+" of "+o+"/"+a);case 22:return t.next=24,c.getCommit(u);case 24:if(p=t.sent){t.next=27;break}throw new Error("Cannot find commit "+u);case 27:return t.abrupt("return",c.loadSnapshot(void 0,void 0,p));case 28:case"end":return t.stop()}},r,t)}))()},revert:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,a,s,u,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",type:"string",name:"string",ref:"string|undefined",toCommitId:"string"}),i=n.db,o=n.type,a=n.name,s=n.ref,u=n.toCommitId,t.next=8,ObjectDB.find(i);case 8:return c=t.sent,s||(s="HEAD"),t.abrupt("return",c.revert(o,a,s,u));case 11:case"end":return t.stop()}},r,t)}))()},commit:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,a,s,u,c,l,f,p;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",type:"string",name:"string",ref:"string|undefined",snapshot:"object|string|undefined",preview:"string|undefined",commitSpec:"object",expectedParentCommit:"string|undefined"}),i=n.db,o=n.type,a=n.name,s=n.ref,u=n.expectedParentCommit,c=n.commitSpec,l=n.snapshot,f=n.preview,t.next=11,ObjectDB.find(i);case 11:return p=t.sent,s||(s="HEAD"),t.abrupt("return",p.commit(o,a,l,c,f,s,u));case 14:case"end":return t.stop()}},r,t)}))()},exportToSpecs:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",nameAndTypes:"Array|undefined",includeDeleted:"boolean|undefined"}),i=n.db,o=n.nameAndTypes,t.next=5,ObjectDB.find(i);case 5:if(a=t.sent){t.next=8;break}throw new Error("db "+i+" does not exist");case 8:return t.abrupt("return",a.exportToSpecs(o));case 9:case"end":return t.stop()}},r,t)}))()},exportToDir:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,a,s,u,c,l;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",url:"string",nameAndTypes:"Array|undefined",copyResources:"boolean|undefined",includeDeleted:"boolean|undefined"}),i=n.db,o=n.url,a=n.nameAndTypes,s=n.copyResources,u=n.includeDeleted,t.next=8,ObjectDB.find(i);case 8:if(c=t.sent,l=void 0,c){t.next=12;break}throw new Error("db "+i+" does not exist");case 12:try{l=lively_resources.resource(o)}catch(e){l=lively_resources.resource(System.baseURL).join(o)}return t.abrupt("return",c.exportToDir(l,a,s,u));case 14:case"end":return t.stop()}},r,t)}))()},importFromDir:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,a,s,u,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",url:"string",overwrite:"boolean|undefined",copyResources:"boolean|undefined"}),i=n.db,o=n.url,a=n.overwrite,s=n.copyResources,t.next=7,ObjectDB.find(i);case 7:if(u=t.sent,c=void 0,u){t.next=11;break}throw new Error("db "+i+" does not exist");case 11:try{c=lively_resources.resource(o)}catch(e){c=lively_resources.resource(System.baseURL).join(o)}return t.abrupt("return",u.importFromDir(c,a,s));case 13:case"end":return t.stop()}},r,t)}))()},importFromSpecs:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,a,s,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",specs:"object",overwrite:"boolean|undefined",copyResources:"boolean|undefined"}),i=n.db,o=n.specs,a=n.overwrite,s=n.copyResources,t.next=7,ObjectDB.find(i);case 7:if(u=t.sent){t.next=10;break}throw new Error("db "+i+" does not exist");case 10:return t.abrupt("return",u.importFromSpecs(o,a,s));case 11:case"end":return t.stop()}},r,t)}))()},importFromResource:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,a,s,u,c,l,f;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",type:"string",name:"string",url:"string",commitSpec:"object",purgeHistory:"boolean|undefined"}),i=n.db,o=n.type,a=n.name,s=n.url,u=n.commitSpec,c=n.purgeHistory,t.next=9,ObjectDB.find(i);case 9:if(l=t.sent,f=void 0,l){t.next=13;break}throw new Error("db "+i+" does not exist");case 13:try{f=lively_resources.resource(s)}catch(e){f=lively_resources.resource(System.baseURL).join(s)}return t.abrupt("return",l.importFromResource(o,a,f,u,c));case 15:case"end":return t.stop()}},r,t)}))()},delete:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,a,s,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",type:"string",name:"string",dryRun:"boolean|undefined"}),i=n.db,o=n.type,a=n.name,s=n.dryRun,t.next=7,ObjectDB.find(i);case 7:return u=t.sent,t.abrupt("return",u.delete(o,a,void 0===s||s));case 9:case"end":return t.stop()}},r,t)}))()},deleteCommit:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,a,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",commit:"string",dryRun:"boolean|undefined"}),i=n.db,o=n.commit,a=n.dryRun,t.next=6,ObjectDB.find(i);case 6:return s=t.sent,t.abrupt("return",s.deleteCommit(o,void 0===a||a));case 8:case"end":return t.stop()}},r,t)}))()},fetchConflicts:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,a,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",includeDocs:"boolean|undefined",only:"object|undefined"}),i=n.db,o=n.includeDocs,a=n.only,t.next=6,ObjectDB.find(i);case 6:return s=t.sent,t.abrupt("return",s.getConflicts(o,a));case 8:case"end":return t.stop()}},r,t)}))()},resolveConflict:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,a,s,u,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",id:"string",kind:"string",delete:"Array",resolved:"object"}),i=n.db,o=n.resolved,a=n.delete,s=n.kind,u=n.id,t.next=8,ObjectDB.find(i);case 8:return c=t.sent,t.abrupt("return",c.resolveConflict({resolved:o,delete:a,kind:s,id:u}));case 10:case"end":return t.stop()}},r,t)}))()},fetchDiff:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",otherDB:"string"}),i=n.db,o=n.otherDB,t.next=5,ObjectDB.find(i);case 5:return a=t.sent,t.abrupt("return",a.getDiff(o));case 7:case"end":return t.stop()}},r,t)}))()},synchronize:function(e){var t=this;return asyncToGenerator(regeneratorRuntime.mark(function r(){var n,i,o,a,s,u,c,l,f,p,h,d,m,v;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=checkArgs(e,{db:"string",otherDB:"string",otherDBSnapshotLocation:"string|undefined",onlyTypesAndNames:"object|undefined",method:"string|undefined"}),i=n.db,o=n.otherDB,a=n.otherDBSnapshotLocation,s=n.onlyTypesAndNames,u=n.method,t.next=8,ObjectDB.find(i);case 8:return c=t.sent,a||(a=o.replace(/\/$/,"")+"/snapshots"),u||(u="replicateTo"),t.next=13,ObjectDB.find(i);case 13:return l=t.sent,t.next=16,ObjectDB.named(o,{snapshotLocation:a});case 16:return f=t.sent,t.next=19,f._commitDB();case 19:return p=t.sent,t.next=22,f._versionDB();case 22:return h=t.sent,d=f.snapshotLocation,m={replicationFilter:s?{onlyTypesAndNames:s}:void 0,retry:!0,live:!0},v=l[u](p,h,d,m),t.next=28,v.whenPaused();case 28:return t.next=30,v.safeStop();case 30:return t.next=32,v.waitForIt();case 32:return t.abrupt("return",lively_lang.obj.select(v,["state","method","conflicts","errors","changesByTypeAndName"]));case 33:case"end":return t.stop()}},r,t)}))()}},ObjectDBHTTPInterface=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.location.origin+"/objectdb/";classCallCheck(this,e),this.serverURL=t}return createClass(e,[{key:"_processResponse",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.headers.get("content-type"),e.next=3,t.text();case 3:if(n=e.sent,i=void 0,"application/json"===r)try{i=JSON.parse(n)}catch(e){}if(!(!t.ok||i&&i.error)){e.next=8;break}throw new Error(i&&i.error||n||t.statusText);case 8:return e.abrupt("return",i||n);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_GET",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object.keys(i).map(function(e){var t=i[e];return"object"===(void 0===t?"undefined":_typeof(t))&&(t=JSON.stringify(t)),e+"="+encodeURIComponent(t)}).join("&"),n=this.serverURL+t+"?"+r,e.t0=this,e.next=4,fetch(n);case 4:return e.t1=e.sent,e.abrupt("return",e.t0._processResponse.call(e.t0,e.t1));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_POST",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.serverURL+t,e.t0=this,e.next=4,fetch(r,{method:"POST",body:JSON.stringify(n),headers:{"content-type":"application/json"}});case 4:return e.t1=e.sent,e.abrupt("return",e.t0._processResponse.call(e.t0,e.t1));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"describe",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("describe",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"ensureDB",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("ensureDB",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"destroyDB",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("destroyDB",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fetchCommits",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("fetchCommits",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fetchVersionGraph",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("fetchVersionGraph",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"exists",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("exists",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fetchLog",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("fetchLog",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fetchSnapshot",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("fetchSnapshot",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"revert",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("revert",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"commit",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("commit",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"exportToSpecs",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("exportToSpecs",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"exportToDir",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("exportToDir",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"importFromDir",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("importFromDir",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"importFromSpecs",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("importFromSpecs",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"importFromResource",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("importFromResource",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("delete",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"deleteCommit",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("deleteCommit",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fetchConflicts",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("fetchConflicts",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"resolveConflict",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("resolveConflict",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fetchDiff",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("fetchDiff",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"synchronize",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("synchronize",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),debug=!1,slashRe=/\//g,StorageDatabase=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,Database),createClass(t,null,[{key:"ensureDB",value:function(e,r){return get$1(t.__proto__||Object.getPrototypeOf(t),"ensureDB",this).call(this,"lively.storage-"+e,r)}}]),t}(),LivelyStorageResource=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,e),createClass(t,[{key:"read",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return debug&&console.log("["+this+"] read"),e.next=3,this.db.get(this.pathWithoutQuery());case 3:return t=e.sent,r=t&&t.content,e.abrupt("return",r?"string"==typeof r?r:JSON.stringify(r):"");case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"readJson",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.read();case 2:return t=e.sent,e.abrupt("return","string"==typeof t?JSON.parse(t):t);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"write",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(debug&&console.log("["+this+"] write"),t||(t=""),!this.isDirectory()){e.next=4;break}throw new Error("Cannot write into a directory! ("+this.url+")");case 4:return e.next=6,this.db.update(this.pathWithoutQuery(),function(e){if(e&&e.isDirectory)throw new Error(r.url+" already exists and is a directory (cannot write into it!)");var n=Date.now();return e?_extends({},e,{lastModified:n,size:t.length,content:t}):{etag:void 0,type:void 0,contentType:void 0,user:void 0,group:void 0,mode:void 0,lastModified:n,created:n,size:"string"==typeof t?t.length:0,content:t}});case 6:return e.abrupt("return",this);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"writeJson",value:function(e){return this.write(e)}},{key:"mkdir",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(debug&&console.log("["+this+"] mkdir"),this.isDirectory()){e.next=3;break}throw new Error("Cannot mkdir a file! ("+this.url+")");case 3:return e.next=5,this.db.get(this.pathWithoutQuery());case 5:if(!(t=e.sent)){e.next=10;break}if(t.isDirectory){e.next=9;break}throw new Error(this.url+" already exists and is a file (cannot mkdir it!)");case 9:return e.abrupt("return",this);case 10:return r=Date.now(),e.next=13,this.db.set(this.pathWithoutQuery(),{etag:void 0,type:void 0,contentType:void 0,user:void 0,group:void 0,mode:void 0,lastModified:r,created:r,isDirectory:!0});case 13:return e.abrupt("return",this);case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"exists",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(debug&&console.log("["+this+"] exists"),e.t0=this.isRoot(),e.t0){e.next=6;break}return e.next=5,this.db.get(this.pathWithoutQuery());case 5:e.t0=!!e.sent;case 6:return e.abrupt("return",e.t0);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return debug&&console.log("["+this+"] remove"),t=this.pathWithoutQuery(),r=this.db,e.next=5,r.docList({startkey:t,endkey:t+""});case 5:return n=e.sent,e.next=8,r.setDocuments(n.map(function(e){return{_id:e.id,_rev:e.rev,_deleted:!0}}));case 8:return e.abrupt("return",this);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"readProperties",value:function(){return debug&&console.log("["+this+"] readProperties"),this.db.get(this.pathWithoutQuery())}},{key:"dirList",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,i,o,a,s,u,c,l,f,p,h,d,m,v=this,y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(debug&&console.log("["+this+"] dirList"),this.isDirectory()){e.next=3;break}return e.abrupt("return",this.asDirectory().dirList(y,g));case 3:return t=g.exclude,r=this.pathWithoutQuery(),n=[],e.next=8,this.db.getAll({startkey:r,endkey:r+""});case 8:i=e.sent,"infinity"===y&&(y=1/0),o=0;case 11:if(!(o<i.length)){e.next=29;break}if(a=i[o],s=a._id,u=a.isDirectory,s.startsWith(r)&&r!==s){e.next=15;break}return e.abrupt("continue",26);case 15:if(c=s.slice(r.length),!((l=c.includes("/")?c.match(slashRe).length+1:1)>y)){e.next=20;break}if("continue"!==(f=function(){var e=v.join(c.split("/").slice(0,y).join("/")+"/");return n.some(function(t){return t.equals(e)})||n.push(e),"continue"}())){e.next=20;break}return e.abrupt("continue",26);case 20:if(p=this.join(c),!t||applyExclude(p,t)){e.next=23;break}return e.abrupt("continue",26);case 23:for(n.push(p),h=["created","lastModified","mode","group","user","contentType","type","etag","size"],d={},m=0;m<h.length;m++)p[h[m]]=a[h[m]];case 26:o++,e.next=11;break;case 29:return e.abrupt("return",n);case 30:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"canDealWithJSON",get:function(){return!0}},{key:"db",get:function(){return this._db||(this._db=StorageDatabase.ensureDB(this.host()))}}]),t}(lively_resources.Resource),resourceExtension={name:"lively.storage",matches:function(e){return e.startsWith("lively.storage:")},resourceClass:LivelyStorageResource};lively_resources.registerExtension(resourceExtension),exports.Database=Database,exports.ObjectDB=ObjectDB,exports.ObjectDBInterface=ObjectDBInterface,exports.ObjectDBHTTPInterface=ObjectDBHTTPInterface}(this.lively.storage=this.lively.storage||{},PouchDB,pouchdbAdapterMem,lively.lang,lively.resources)}.call(GLOBAL),"undefined"!=typeof module&&module.exports&&(module.exports=GLOBAL.lively.storage)}()}(),function configure(){function decideAboutTranspiler(e){return e.supportsAsyncAwait?"lively.transpiler":"plugin-babel"}function setupLivelyTranspiler(e){function t(e,t,r){this.System=e,this.moduleId=t,this.env=r}if(e.isBrowser){if("undefined"!=typeof Babel&&(System.global.babel=Babel,delete System.global.Babel),!System.global.babel)return void console.error("[lively.modules] in browser environments babel is required to be loaded before lively.modules!")}else System.global.babel=loadBabel_node();console.log("[lively.modules] SystemJS configured with lively.transpiler & babel"),t.prototype.transpileDoit=function(e,t){var r=this.System,e="(async function(__rec) {\n"+e.replace(/(\/\/# sourceURL=.+)$|$/,"\n}).call(this);\n$1"),n=r.babelOptions;return n.plugins&&n.plugins.length||n.presets&&n.presets.length?r.global.babel.transform(e,n).code:e},t.prototype.transpileModule=function(e,t){var r=this.System,n=Object.assign({},r.babelOptions);return n.plugins=n.plugins?n.plugins.slice():[],n.plugins.push("transform-es2015-modules-systemjs"),r.global.babel.transform(e,n).code},System.set("lively.transpiler",System.newModule({default:t})),System._loader.transpilerPromise=Promise.resolve({translate:function(e,r){return new t(this,e.name,{}).transpileModule(e.source,{})}}),System.config({transpiler:"lively.transpiler",babelOptions:{sourceMaps:!1,compact:"auto",comments:"true",presets:e.supportsAsyncAwait?[]:["es2015"]}})}function setupPluginBabelTranspiler(e){var t=!!System.get("@system-env").browser,r=t?findSystemJSPluginBabel_browser():findSystemJSPluginBabel_node(),n=System.global.babel;r||n?r?(console.log("[lively.modules] SystemJS configured with systemjs-plugin-babel transpiler from "+r),System.config({map:{"plugin-babel":r+"/plugin-babel.js","systemjs-babel-build":r+(t?"/systemjs-babel-browser.js":"/systemjs-babel-node.js")},transpiler:"plugin-babel",babelOptions:Object.assign({sourceMaps:"inline",stage3:!0,es2015:!0,modularRuntime:!0},System.babelOptions)})):(console.warn("[lively.modules] Could not find path to systemjs-plugin-babel but babel! Will fallback but there might be features in lively.modules that won't work!"),System.config({transpiler:"babel"})):console.error("[lively.modules] Could not find path to systemjs-plugin-babel nor a babel global! This will likely break lively.modules!")}function featureTest(){var isBrowser=System.get("@system-env").browser||"undefined"!=typeof self,supportsAsyncAwait=!1;try{eval("async function foo() {}"),supportsAsyncAwait=!0}catch(e){}return{supportsAsyncAwait:supportsAsyncAwait,isBrowser:isBrowser}}function loadBabel_node(){if(global.Babel&&!global.babel&&(global.babel=global.Babel),global.babel)return global.babel;var e;try{e=require.cache[require.resolve("lively.modules")]}catch(e){}try{e=require.cache[require.resolve(__dirname+"/../")]}catch(e){}if(!e)throw new Error("Cannot find batch to babel-standalone module");var t=require("module").Module._resolveFilename("babel-standalone",e);global.window=global,global.navigator={};var r=require(t);return delete global.navigator,delete global.window,r}function urlQuery(){return"undefined"!=typeof document&&document.location?(document.location.search||"").replace(/^\?/,"").split("&").reduce(function(query,ea){var split=ea.split("="),key=split[0],value=split[1];return"true"===value||"false"===value?value=eval(value):isNaN(Number(value))||(value=Number(value)),query[key]=value,query},{}):{}}function findSystemJSPluginBabel_browser(){for(var e,t=[].slice.call(document.getElementsByTagName("script")),r=t.length-1;r>=0;r--){var n=t[r].src,i=n.indexOf("lively.modules/");if(i>-1){e=n.slice(0,i)+"lively.next-node_modules/systemjs-plugin-babel";break}var o=n.indexOf("systemjs/dist/system");if(o>-1){e=n.slice(0,o)+"systemjs-plugin-babel";break}var a=n.indexOf("core/lively/bootstrap.js");if(a>-1){e=n.slice(0,a)+"node_modules/lively.modules/node_modules/systemjs-plugin-babel";break}var s=n.match(/(.*)generated\/[^\/]+\/combinedModules.js/);if(s){e=s[1]+"node_modules/lively.modules/node_modules/systemjs-plugin-babel";break}}return e}function findSystemJSPluginBabel_node(){if(global.systemjsPluginBabel)return global.systemjsPluginBabel;for(var e=[function(){var e=require.cache[require.resolve("lively.modules")],t=require("module").Module._resolveFilename("systemjs-plugin-babel",e);if(t)return require("path").dirname(t)},function(){var e=require.resolve("systemjs-plugin-babel");if(e)return require("path").dirname(e)},function(){var e=require.resolve(require("path").join(__dirname,"systemjs-babel-node.js"));if(e)return require("path").dirname(e)}],t=0;t<e.length;t++)try{return e[t]()}catch(e){}return null}if(System.useModuleTranslationCache=!urlQuery().noModuleCache,System.get("lively.transpiler")||System.map["plugin-babel"]&&System.map["systemjs-plugin-babel"])console.log("[lively.modules] System seems already to be configured");else{var features=featureTest(),transpiler=decideAboutTranspiler(features);"lively.transpiler"===transpiler?setupLivelyTranspiler(features):"plugin-babel"===transpiler?setupPluginBabelTranspiler():console.error(`[lively.modules] could not find System transpiler for platform!`)}}(),function(){var semver;!function(e,t){function r(e,t){if(e instanceof n)return e;if("string"!=typeof e)return null;if(e.length>j)return null;if(!(t?O[X]:O[V]).test(e))return null;try{return new n(e,t)}catch(e){return null}}function n(e,t){if(e instanceof n){if(e.loose===t)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>j)throw new TypeError("version is longer than "+j+" characters");if(!(this instanceof n))return new n(e,t);F("SemVer",e,t),this.loose=t;var r=e.trim().match(t?O[X]:O[V]);if(!r)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>T||this.major<0)throw new TypeError("Invalid major version");if(this.minor>T||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>T||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<T)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}function i(e,t){var r=ge.test(e),n=ge.test(t);return r&&n&&(e=+e,t=+t),r&&!n?-1:n&&!r?1:e<t?-1:e>t?1:0}function o(e,t,r){return new n(e,r).compare(t)}function a(e,t,r){return o(t,e,r)}function s(e,t,r){return o(e,t,r)>0}function u(e,t,r){return o(e,t,r)<0}function c(e,t,r){return 0===o(e,t,r)}function l(e,t,r){return 0!==o(e,t,r)}function f(e,t,r){return o(e,t,r)>=0}function p(e,t,r){return o(e,t,r)<=0}function h(e,t,r,n){var i;switch(t){case"===":"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),i=e===r;break;case"!==":"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),i=e!==r;break;case"":case"=":case"==":i=c(e,r,n);break;case"!=":i=l(e,r,n);break;case">":i=s(e,r,n);break;case">=":i=f(e,r,n);break;case"<":i=u(e,r,n);break;case"<=":i=p(e,r,n);break;default:throw new TypeError("Invalid operator: "+t)}return i}function d(e,t){if(e instanceof d){if(e.loose===t)return e;e=e.value}if(!(this instanceof d))return new d(e,t);F("comparator",e,t),this.loose=t,this.parse(e),this.semver===be?this.value="":this.value=this.operator+this.semver.version,F("comp",this)}function m(e,t){if(e instanceof m&&e.loose===t)return e;if(!(this instanceof m))return new m(e,t);if(this.loose=t,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(function(e){return this.parseRange(e.trim())},this).filter(function(e){return e.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function v(e,t){return F("comp",e),e=_(e,t),F("caret",e),e=g(e,t),F("tildes",e),e=w(e,t),F("xrange",e),e=E(e,t),F("stars",e),e}function y(e){return!e||"x"===e.toLowerCase()||"*"===e}function g(e,t){return e.trim().split(/\s+/).map(function(e){return b(e,t)}).join(" ")}function b(e,t){var r=t?O[ae]:O[oe];return e.replace(r,function(t,r,n,i,o){F("tilde",e,t,r,n,i,o);var a;return y(r)?a="":y(n)?a=">="+r+".0.0 <"+(+r+1)+".0.0":y(i)?a=">="+r+"."+n+".0 <"+r+"."+(+n+1)+".0":o?(F("replaceTilde pr",o),"-"!==o.charAt(0)&&(o="-"+o),a=">="+r+"."+n+"."+i+o+" <"+r+"."+(+n+1)+".0"):a=">="+r+"."+n+"."+i+" <"+r+"."+(+n+1)+".0",F("tilde return",a),a})}function _(e,t){return e.trim().split(/\s+/).map(function(e){return x(e,t)}).join(" ")}function x(e,t){F("caret",e,t);var r=t?O[le]:O[ce];return e.replace(r,function(t,r,n,i,o){F("caret",e,t,r,n,i,o);var a;return y(r)?a="":y(n)?a=">="+r+".0.0 <"+(+r+1)+".0.0":y(i)?a="0"===r?">="+r+"."+n+".0 <"+r+"."+(+n+1)+".0":">="+r+"."+n+".0 <"+(+r+1)+".0.0":o?(F("replaceCaret pr",o),"-"!==o.charAt(0)&&(o="-"+o),a="0"===r?"0"===n?">="+r+"."+n+"."+i+o+" <"+r+"."+n+"."+(+i+1):">="+r+"."+n+"."+i+o+" <"+r+"."+(+n+1)+".0":">="+r+"."+n+"."+i+o+" <"+(+r+1)+".0.0"):(F("no pr"),a="0"===r?"0"===n?">="+r+"."+n+"."+i+" <"+r+"."+n+"."+(+i+1):">="+r+"."+n+"."+i+" <"+r+"."+(+n+1)+".0":">="+r+"."+n+"."+i+" <"+(+r+1)+".0.0"),F("caret return",a),a})}function w(e,t){return F("replaceXRanges",e,t),e.split(/\s+/).map(function(e){return k(e,t)}).join(" ")}function k(e,t){e=e.trim();var r=t?O[re]:O[te];return e.replace(r,function(t,r,n,i,o,a){F("xRange",e,t,r,n,i,o,a);var s=y(n),u=s||y(i),c=u||y(o),l=c;return"="===r&&l&&(r=""),s?t=">"===r||"<"===r?"<0.0.0":"*":r&&l?(u&&(i=0),c&&(o=0),">"===r?(r=">=",u?(n=+n+1,i=0,o=0):c&&(i=+i+1,o=0)):"<="===r&&(r="<",u?n=+n+1:i=+i+1),t=r+n+"."+i+"."+o):u?t=">="+n+".0.0 <"+(+n+1)+".0.0":c&&(t=">="+n+"."+i+".0 <"+n+"."+(+i+1)+".0"),F("xRange return",t),t})}function E(e,t){return F("replaceStars",e,t),e.trim().replace(O[ve],"")}function S(e,t,r,n,i,o,a,s,u,c,l,f,p){return t=y(r)?"":y(n)?">="+r+".0.0":y(i)?">="+r+"."+n+".0":">="+t,s=y(u)?"":y(c)?"<"+(+u+1)+".0.0":y(l)?"<"+u+"."+(+c+1)+".0":f?"<="+u+"."+c+"."+l+"-"+f:"<="+s,(t+" "+s).trim()}function A(e,t){for(r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length){for(var r=0;r<e.length;r++)if(F(e[r].semver),e[r].semver!==be&&e[r].semver.prerelease.length>0){var n=e[r].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0}function D(e,t,r){try{t=new m(t,r)}catch(e){return!1}return t.test(e)}function C(e,t,r,i){e=new n(e,i),t=new m(t,i);var o,a,c,l,h;switch(r){case">":o=s,a=p,c=u,l=">",h=">=";break;case"<":o=u,a=f,c=s,l="<",h="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(D(e,t,i))return!1;for(var v=0;v<t.set.length;++v){var y=null,g=null;if(t.set[v].forEach(function(e){e.semver===be&&(e=new d(">=0.0.0")),y=y||e,g=g||e,o(e.semver,y.semver,i)?y=e:c(e.semver,g.semver,i)&&(g=e)}),y.operator===l||y.operator===h)return!1;if((!g.operator||g.operator===l)&&a(e,g.semver))return!1;if(g.operator===h&&c(e,g.semver))return!1}return!0}e={}.exports=n;var F;F="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:function(){},e.SEMVER_SPEC_VERSION="2.0.0";var j=256,T=Number.MAX_SAFE_INTEGER||9007199254740991,O=e.re=[],R=e.src=[],B=0,P=B++;R[P]="0|[1-9]\\d*";var I=B++;R[I]="[0-9]+";var L=B++;R[L]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var N=B++;R[N]="("+R[P]+")\\.("+R[P]+")\\.("+R[P]+")";var M=B++;R[M]="("+R[I]+")\\.("+R[I]+")\\.("+R[I]+")";var q=B++;R[q]="(?:"+R[P]+"|"+R[L]+")";var $=B++;R[$]="(?:"+R[I]+"|"+R[L]+")";var W=B++;R[W]="(?:-("+R[q]+"(?:\\."+R[q]+")*))";var U=B++;R[U]="(?:-?("+R[$]+"(?:\\."+R[$]+")*))";var G=B++;R[G]="[0-9A-Za-z-]+";var z=B++;R[z]="(?:\\+("+R[G]+"(?:\\."+R[G]+")*))";var V=B++,J="v?"+R[N]+R[W]+"?"+R[z]+"?";R[V]="^"+J+"$";var H="[v=\\s]*"+R[M]+R[U]+"?"+R[z]+"?",X=B++;R[X]="^"+H+"$";var K=B++;R[K]="((?:<|>)?=?)";var Q=B++;R[Q]=R[I]+"|x|X|\\*";var Y=B++;R[Y]=R[P]+"|x|X|\\*";var Z=B++;R[Z]="[v=\\s]*("+R[Y]+")(?:\\.("+R[Y]+")(?:\\.("+R[Y]+")(?:"+R[W]+")?"+R[z]+"?)?)?";var ee=B++;R[ee]="[v=\\s]*("+R[Q]+")(?:\\.("+R[Q]+")(?:\\.("+R[Q]+")(?:"+R[U]+")?"+R[z]+"?)?)?";var te=B++;R[te]="^"+R[K]+"\\s*"+R[Z]+"$";var re=B++;R[re]="^"+R[K]+"\\s*"+R[ee]+"$";var ne=B++;R[ne]="(?:~>?)";var ie=B++;R[ie]="(\\s*)"+R[ne]+"\\s+",O[ie]=new RegExp(R[ie],"g");var oe=B++;R[oe]="^"+R[ne]+R[Z]+"$";var ae=B++;R[ae]="^"+R[ne]+R[ee]+"$";var se=B++;R[se]="(?:\\^)";var ue=B++;R[ue]="(\\s*)"+R[se]+"\\s+",O[ue]=new RegExp(R[ue],"g");var ce=B++;R[ce]="^"+R[se]+R[Z]+"$";var le=B++;R[le]="^"+R[se]+R[ee]+"$";var fe=B++;R[fe]="^"+R[K]+"\\s*("+H+")$|^$";var pe=B++;R[pe]="^"+R[K]+"\\s*("+J+")$|^$";var he=B++;R[he]="(\\s*)"+R[K]+"\\s*("+H+"|"+R[Z]+")",O[he]=new RegExp(R[he],"g");var de=B++;R[de]="^\\s*("+R[Z]+")\\s+-\\s+("+R[Z]+")\\s*$";var me=B++;R[me]="^\\s*("+R[ee]+")\\s+-\\s+("+R[ee]+")\\s*$";var ve=B++;R[ve]="(<|>)?=?\\s*\\*";for(var ye=0;ye<B;ye++)F(ye,R[ye]),O[ye]||(O[ye]=new RegExp(R[ye]));e.parse=r,e.valid=function(e,t){var n=r(e,t);return n?n.version:null},e.clean=function(e,t){var n=r(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null},e.SemVer=n,n.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},n.prototype.toString=function(){return this.version},n.prototype.compare=function(e){return F("SemVer.compare",this.version,this.loose,e),e instanceof n||(e=new n(e,this.loose)),this.compareMain(e)||this.comparePre(e)},n.prototype.compareMain=function(e){return e instanceof n||(e=new n(e,this.loose)),i(this.major,e.major)||i(this.minor,e.minor)||i(this.patch,e.patch)},n.prototype.comparePre=function(e){if(e instanceof n||(e=new n(e,this.loose)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var r=this.prerelease[t],o=e.prerelease[t];if(F("prerelease compare",t,r,o),void 0===r&&void 0===o)return 0;if(void 0===o)return 1;if(void 0===r)return-1;if(r!==o)return i(r,o)}while(++t)},n.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var r=this.prerelease.length;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);-1===r&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},e.inc=function(e,t,r,i){"string"==typeof r&&(i=r,r=void 0);try{return new n(e,r).inc(t,i).version}catch(e){return null}},e.diff=function(e,t){if(c(e,t))return null;var n=r(e),i=r(t);if(n.prerelease.length||i.prerelease.length){for(var o in n)if(("major"===o||"minor"===o||"patch"===o)&&n[o]!==i[o])return"pre"+o;return"prerelease"}for(var o in n)if(("major"===o||"minor"===o||"patch"===o)&&n[o]!==i[o])return o},e.compareIdentifiers=i;var ge=/^[0-9]+$/;e.rcompareIdentifiers=function(e,t){return i(t,e)},e.major=function(e,t){return new n(e,t).major},e.minor=function(e,t){return new n(e,t).minor},e.patch=function(e,t){return new n(e,t).patch},e.compare=o,e.compareLoose=function(e,t){return o(e,t,!0)},e.rcompare=a,e.sort=function(t,r){return t.sort(function(t,n){return e.compare(t,n,r)})},e.rsort=function(t,r){return t.sort(function(t,n){return e.rcompare(t,n,r)})},e.gt=s,e.lt=u,e.eq=c,e.neq=l,e.gte=f,e.lte=p,e.cmp=h,e.Comparator=d;var be={};d.prototype.parse=function(e){var t=this.loose?O[fe]:O[pe],r=e.match(t);if(!r)throw new TypeError("Invalid comparator: "+e);this.operator=r[1],"="===this.operator&&(this.operator=""),r[2]?this.semver=new n(r[2],this.loose):this.semver=be},d.prototype.toString=function(){return this.value},d.prototype.test=function(e){return F("Comparator.test",e,this.loose),this.semver===be||("string"==typeof e&&(e=new n(e,this.loose)),h(e,this.operator,this.semver,this.loose))},e.Range=m,m.prototype.format=function(){return this.range=this.set.map(function(e){return e.join(" ").trim()}).join("||").trim(),this.range},m.prototype.toString=function(){return this.range},m.prototype.parseRange=function(e){var t=this.loose;e=e.trim(),F("range",e,t);var r=t?O[me]:O[de];e=e.replace(r,S),F("hyphen replace",e),e=e.replace(O[he],"$1$2$3"),F("comparator trim",e,O[he]),e=(e=(e=e.replace(O[ie],"$1~")).replace(O[ue],"$1^")).split(/\s+/).join(" ");var n=t?O[fe]:O[pe],i=e.split(" ").map(function(e){return v(e,t)}).join(" ").split(/\s+/);return this.loose&&(i=i.filter(function(e){return!!e.match(n)})),i=i.map(function(e){return new d(e,t)})},e.toComparators=function(e,t){return new m(e,t).set.map(function(e){return e.map(function(e){return e.value}).join(" ").trim().split(" ")})},m.prototype.test=function(e){if(!e)return!1;"string"==typeof e&&(e=new n(e,this.loose));for(var t=0;t<this.set.length;t++)if(A(this.set[t],e))return!0;return!1},e.satisfies=D,e.maxSatisfying=function(e,t,r){return e.filter(function(e){return D(e,t,r)}).sort(function(e,t){return a(e,t,r)})[0]||null},e.minSatisfying=function(e,t,r){return e.filter(function(e){return D(e,t,r)}).sort(function(e,t){return o(e,t,r)})[0]||null},e.validRange=function(e,t){try{return new m(e,t).range||"*"}catch(e){return null}},e.ltr=function(e,t,r){return C(e,t,"<",r)},e.gtr=function(e,t,r){return C(e,t,">",r)},e.outside=C,e.prerelease=function(e,t){var n=r(e,t);return n&&n.prerelease.length?n.prerelease:null},semver=e}({});var GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(exports,lively_lang,lively_ast,lively_notifications,lively_vm,lively_resources,lively_classes,semver){"use strict";function install(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.name;(e[t]=lively_lang.fun.wrap(e[t],r)).hookFunc=r,r.hookName=n}function remove$1(e,t,r){for(var n=[],i=e[t];i;)n.push(i),i=i.originalFunction;var o="string"==typeof r?n.find(function(e){return e.hookFunc&&e.hookFunc.hookName===r}):n.find(function(e){return e.hookFunc===r});return!!o&&(lively_lang.arr.remove(n,o),e[t]=n.reduceRight(function(e,t){return lively_lang.fun.wrap(e,t.hookFunc||t)}),!0)}function isInstalled(e,t,r){for(var n=e[t];n;){if(n.hookFunc){if("string"==typeof r&&n.hookFunc.hookName===r)return!0;if(n.hookFunc===r)return!0}n=n.originalFunction}return!1}function computeRequireMap(e){if(e.loads){var t=e.loads;return lively_lang.arr.uniq(Object.keys(loadedModules$1(e)).concat(Object.keys(t))).reduce(function(e,r){var n=t[r]?t[r].depMap:{};return e[r]=Object.keys(n).map(function(e){var t=n[e];return"@empty"===t?t+"/"+e:t}),e},{})}return Object.keys(e._loader.moduleRecords).reduce(function(t,r){return t[r]=e._loader.moduleRecords[r].dependencies.filter(Boolean).map(function(e){return e.name}),t},{})}function prepareNodejsCaching(){var e=System._nodeRequire("fs"),t=System._nodeRequire("path");nodejsCacheDir="/"===process.cwd()?t.join(process.env.HOME,".lively.next"):process.cwd(),e.existsSync(nodejsCacheDir)||e.mkdirSync(nodejsCacheDir)}function prepareCodeForCustomCompile(e,t,r,n,i){t=String(t);var o=n.sourceAccessorName,a=n.recorder,s=n.recorderName,u=n.dontTransform,c=n.varDefinitionCallbackName,l=n.embedOriginalCode,f=void 0===l||l,p={topLevelVarRecorder:a,varRecorderName:s,sourceAccessorName:o=f?o:void 0,dontTransform:u,recordGlobals:!0,keepPreviouslyDeclaredValues:!0,declarationWrapperName:c,evalId:n.nextEvalId(),currentModuleAccessor:funcCall(member(funcCall(member(member("__lvVarRecorder","System"),"get"),literal("@lively-env")),"moduleEnv"),literal(r))},h="System.global"===s,d=i?'console.log("[lively.modules] executing module '+r+'");\n':"",m="";h?delete p.declarationWrapperName:(d+='System.get("@lively-env").evaluationStart("'+r+'");\nvar '+s+' = System.get("@lively-env").moduleEnv("'+r+'").recorder;\n'+(f?"\nvar "+o+" = "+JSON.stringify(t)+";\n":""),m+='\nSystem.get("@lively-env").evaluationEnd("'+r+'");');try{var v=d+lively_vm.evalCodeTransform(t,p)+m;return i&&"undefined"!=typeof $world&&$world.get("log")&&$world.get("log").isText&&($world.get("log").textString=v),{source:v,options:p}}catch(e){return console.error("Error in prepareCodeForCustomCompile of "+r+" "+e.stack),{source:t,options:p}}}function prepareTranslatedCodeForSetterCapture(e,t,r,n,i,o){t=String(t);var a=_extends({},i,{topLevelVarRecorder:n.recorder,varRecorderName:n.recorderName,dontTransform:n.dontTransform,recordGlobals:!0,declarationWrapperName:n.varDefinitionCallbackName,currentModuleAccessor:funcCall(member(funcCall(member(member("__lvVarRecorder","System"),"get"),literal("@lively-env")),"moduleEnv"),literal(r))});n.recorderName;try{var s=lively_vm.evalCodeTransformOfSystemRegisterSetters(t,a);return o&&"undefined"!=typeof $world&&$world.get("log")&&$world.get("log").isText&&($world.get("log").textString+=s),s}catch(e){return console.error("Error in prepareTranslatedCodeForSetterCapture",e.stack),t}}function getCachedNodejsModule(e,t){try{var r=e._nodeRequire("module").Module,n=r._resolveFilename(t.name.replace(/^file:\/\//,""));return r._cache[n]}catch(r){e.debug&&console.log("[lively.modules getCachedNodejsModule] %s unknown to nodejs",t.name)}return null}function addNodejsWrapperSource(e,t){var r=getCachedNodejsModule(e,t);return r?(t.metadata.format="esm",t.source="var exports = System._nodeRequire('"+r.id+"'); export default exports;\n"+lively_lang.properties.allOwnPropertiesOrFunctions(r.exports).map(function(e){return lively_ast.isValidIdentifier(e)?"export var "+e+" = exports['"+e+"'];":'/*ignoring export "'+e+'" b/c it is not a valid identifier*/'}).join("\n"),e.debug&&console.log("[lively.modules customTranslate] loading %s from nodejs module cache",t.name),!0):(e.debug&&console.log("[lively.modules customTranslate] %s not yet in nodejs module cache",t.name),!1)}function instrumentSourceOfEsmModuleLoad(System,load){return System.translate(load).then(function(translated){var parsed=lively_ast.parse(translated),callExpression=parsed.body.find(function(e){return e.expression&&"CallExpression"===e.expression.type&&"register"===e.expression.callee.property.name});if(!callExpression)throw new Error("Cannot find register call in translated source of "+load.name);var registerCall=callExpression.expression,depNames=registerCall.arguments[0].elements.map(function(e){return e.value}),declareFuncNode=registerCall.arguments[1],declareFuncSource=translated.slice(declareFuncNode.start,declareFuncNode.end),declare=eval('var __moduleName = "'+load.name+'";('+declareFuncSource+");\n//# sourceURL="+load.name+"\n");return System.debug&&"undefined"!==$world&&$world.get("log")&&$world.get("log").isText&&($world.get("log").textString=declare),{localDeps:depNames,declare:declare}})}function instrumentSourceOfGlobalModuleLoad(e,t){return e.translate(t).then(function(e){return{translated:e}})}function wrapModuleLoad$1(e){isInstalled(e,"translate","lively_modules_translate_hook")||install(e,"translate",function(t,r){return customTranslate.call(e,t,r)})}function unwrapModuleLoad$1(e){remove$1(e,"translate","lively_modules_translate_hook")}function scheduleModuleExportsChange(e,t,r,n,i){var o=e.get("@lively-env").pendingExportChanges,a=module$2(e,t).record();a&&(r in a.exports||i)&&((o[t]||(o[t]={}))[r]=n)}function runScheduledExportChanges(e,t){var r=e.get("@lively-env").pendingExportChanges[t];r&&(clearPendingModuleExportChanges(e,t),updateModuleExports(e,t,r))}function clearPendingModuleExportChanges(e,t){delete e.get("@lively-env").pendingExportChanges[t]}function updateModuleExports(e,t,r){var n=e.debug;module$2(e,t).updateRecord(function(i){var o=[],a=[];if(Object.keys(r).forEach(function(e){var s=r[e];n&&console.log("[lively.vm es6 updateModuleExports] %s export %s = %s",t,e,String(s).slice(0,30).replace(/\n/g,"")+"...");var u=!(e in i.exports);u&&(i.__lively_modules__.evalOnlyExport[e]=!0),i.exports[e]=s,u?o.push(e):a.push(e)}),o.length){var s=e.get(t);Object.isFrozen(s)?(console.warn("[lively.vm es6 updateModuleExports] Since module %s is frozen a new module object was installed in the system. Note that only(!) exisiting module bindings are updated. New exports that were added will only be available in already loaded modules after those are reloaded!",t),e.set(t,e.newModule(i.exports))):(n&&console.log("[lively.vm es6 updateModuleExports] adding new exports to %s",t),o.forEach(function(e){Object.defineProperty(s,e,{configurable:!1,enumerable:!0,get:function(){return i.exports[e]},set:function(){throw new Error("exports cannot be changed from the outside")}})}))}if(a.length){n&&console.log("[lively.vm es6 updateModuleExports] updating %s dependents of %s",i.importers.length,t);for(var u=0,c=i.importers.length;u<c;u++){var l=i.importers[u];if(!l.locked){var f;if(l.dependencies.some(function(e,t){return f=t,e&&e.name===i.name})){if(n){var p=module$2(e,l.name);console.log("[lively.vm es6 updateModuleExports] calling setters of "+p.package().name+"/"+p.pathInPackage())}module$2(e,l.name).evaluationStart(),l.setters[f](i.exports),module$2(e,l.name).evaluationEnd()}}}}})}function doInstantiateGlobalModule(e,t){var r={name:null,deps:null,originalIndices:null,declare:null,execute:null,executingRequire:!1,declarative:!1,normalizedDeps:null,groupIndex:null,evaluated:!1,module:null,esModule:null,esmExports:!1};r.name=t.name,r.esmExports=!0,t.metadata.entry=r,r.deps=[];for(var n in t.metadata.globals){var i=t.metadata.globals[n];i&&r.deps.push(i)}return r.execute=function(r,n,i){var o=module$2(e,i.id).metadata();(n=o&&o.entry&&o.entry.module&&o.entry.module.exports)&&Object.keys(n).forEach(function(t){try{delete e.global[t]}catch(e){console.warn('[lively.modules] executeGlobalModule: Cannot delete global["'+t+'"]')}});var a;if(t.metadata.globals){a={};for(var s in t.metadata.globals)t.metadata.globals[s]&&(a[s]=r(t.metadata.globals[s]))}var u=t.metadata.exports;u&&(t.source+='\nSystem.global["'+u+'"] = '+u+";");var c=e.get("@@global-helpers").prepareGlobal(module$2.id,u,a);return __evaluateGlobalLoadSource(e,t),c()},runExecuteOfGlobalModule(e,r)}function __createEntry(){return{name:null,deps:null,originalIndices:null,declare:null,execute:null,executingRequire:!1,declarative:!1,normalizedDeps:null,groupIndex:null,evaluated:!1,module:null,esModule:null,esmExports:!1}}function __evaluateGlobalLoadSource(e,t){function r(e,t){0==a++&&(o=s.System),s.System=s.SystemJS=e}function n(){0==--a&&(s.System=s.SystemJS=o),i=void 0}var i,o,a=0,s=e.global;return function(e){try{r(this,e),i=e,(0,eval)(e.source),n()}catch(t){throw n(),new Error("Error evaluating "+e.address+":\n"+t.stack)}}.call(e,t)}function runExecuteOfGlobalModule(e,t){var r={},n=t.module={exports:r,id:t.name};t.evaluated=!0;var i=t.execute.call(e.global,function(r){var n=t.deps.find(function(e){return e===r}),i=n&&e.get(t.normalizedDeps[t.deps.indexOf(n)])||e.get(e.decanonicalize(r,t.name));if(i)return i;throw new Error("Module "+r+" not declared as a dependency of "+t.name)},r,n);i&&(n.exports=i),r=n.exports;var o=e.get("@system-env").constructor;return r&&(r.__esModule||r instanceof o)?t.esModule=r:t.esmExports&&r!==e.global?t.esModule=e.newModule(r):t.esModule={default:r},t}function isURL(e){return/^[^:\\]+:\/\//.test(e)}function urlResolve(e){var t=e.match(/^([^:]+:\/\/)(.*)/);if(!t)return e;var r=t[1],n=t[2],i=n;do{i=(n=i).replace(/\/[^\/]+\/\.\./,"")}while(i!=n);return i=i.replace(/(^|[^:])[\/]+/g,"$1/"),i=i.replace(/\/\.\//g,"/"),r+i}function isAbsolute(e){return e.startsWith("/")||e.startsWith("http:")||e.startsWith("https:")||e.startsWith("file:")||e.match(urlStartRe)}function ensureResource(e){return e.isResource?e:lively_resources.resource(e)}function normalizePackageURL(e,t){if((arguments.length>2&&void 0!==arguments[2]?arguments[2]:[]).some(function(e){return e===t}))return t;var r=e.decanonicalize(t.replace(/[\/]+$/,"")+"/");if(!isURL(r))throw new Error("Strange package URL: "+r+" is not a valid URL");return(r=r.match(/\.js/)?r.indexOf(r+".js")>-1?r.replace(/\.js$/,""):r.split("/").slice(0,-1).join("/"):r).match(/\.js$/)&&console.warn("packageURL is expected to point to a directory but seems to be a .js file: "+r),String(r).replace(/\/$/,"")}function lookupPackage$1(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=PackageRegistry$$1.ofSystem(e),i=n.allPackageURLs(),o=r?t:normalizePackageURL(e,t,i);return{pkg:n.findPackageWithURL(o),url:o,allPackageURLs:i,registry:n}}function ensurePackage$1(e,t){var r=lookupPackage$1(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),n=r.pkg,i=r.url,o=r.registry;return n||o.addPackageAt(i,"devPackageDirs")}function getPackage$1(e,t){var r=lookupPackage$1(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),n=r.pkg,i=r.url;if(n)return n;throw new Error("[getPackage] package "+t+" (as "+i+") not found")}function applyConfig$1(e,t,r){return getPackage$1(e,r).updateConfig(t)}function importPackage$1(e,t){return Promise.resolve(ensurePackage$1(e,t)).then(function(e){return e.import()})}function removePackage$2(e,t){var r=lookupPackage$1(e,t),n=r.pkg;r.url,r.registry;return n?n.remove():null}function reloadPackage$1(e,t,r){return getPackage$1(e,t).reload(r)}function registerPackage$1(e,t,r){return Promise.resolve(ensurePackage$1(e,t)).then(function(e){return e.register(r)})}function getPackageSpecs(e){return Package.allPackages(e).map(function(e){return e.asSpec()})}function ensureParent(e,t,r){if(r)return r;var n=e.id,i=e.System,o=n.startsWith("file://")?n.replace("file://",""):n;if(r=i._nodeRequire("module").Module._cache[n])return r;r={id:o,filename:o,paths:[]};var a=e.package();return a&&r.paths.push(lively_resources.resource(a.url).join("node_modules/").path()),r}function relative(e,t){return lively_resources.resource(e.id).parent().join(t).url.replace("file://","")}function _require(e,t,r){r=ensureParent(e,t);var n=e.System._nodeRequire("module");return t.startsWith(".")&&(t=relative(e,t)),n._load(t,r)}function _resolve(e,t,r){r=ensureParent(e,t);var n=e.System._nodeRequire("module");return t.startsWith(".")&&(t=relative(e,t)),n._resolveFilename(t,r)}function module$2(e,t,r){var n=livelySystemEnv(e),i=e.decanonicalize(t,r);return n.loadedModules[i]||(n.loadedModules[i]=new ModuleInterface(e,i))}function isModuleLoaded$1(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=livelySystemEnv(e);return(r?t:e.normalizeSync(t))in n.loadedModules}function livelyProtocol(e,t){var r=t.match(livelyURLRe);if(!r)return e(t);var n=slicedToArray(r,3),i=(n[0],n[1],n[2]);return{read:function(){var e="undefined"!=typeof $world&&$world.getMorphWithId(i);return Promise.resolve(e?e.textString:"/*Could not locate "+i+"*/")},write:function(e){var t="undefined"!=typeof $world&&$world.getMorphWithId(i);return t?(t.textString=e,Promise.resolve(this)):Promise.reject("Could not save morph "+i)}}}function wrapResource(e){e.resource=lively_resources.resource,isInstalled(e,"fetch",fetchResource)&&remove$1(e,"fetch","fetchResource"),install(e,"fetch",fetchResource),isInstalled(e,"resource","livelyProtocol")&&remove$1(e,"fetch","livelyProtocol"),install(e,"resource",livelyProtocol)}function livelySystemEnv(e){return{moduleEnv:function(t){return module$2(e,t)},get itself(){return e.get(e.decanonicalize("lively.modules/index.js"))},evaluationStart:function(t){module$2(e,t).evaluationStart()},evaluationEnd:function(t){module$2(e,t).evaluationEnd()},dumpConfig:function(){return JSON.stringify({baseURL:e.baseURL,transpiler:e.transpiler,defaultJSExtensions:e.defaultJSExtensions,map:e.map,meta:e.meta,packages:e.packages,paths:e.paths,packageConfigPaths:e.packageConfigPaths},null,2)},get packageRegistry(){return e["__lively.modules__packageRegistry"]},set packageRegistry(t){e["__lively.modules__packageRegistry"]=t},packages:e["__lively.modules__packages"]||(e["__lively.modules__packages"]={}),loadedModules:e["__lively.modules__loadedModules"]||(e["__lively.modules__loadedModules"]={}),pendingExportChanges:e["__lively.modules__pendingExportChanges"]||(e["__lively.modules__pendingExportChanges"]={}),notifications:e["__lively.modules__notifications"]||(e["__lively.modules__notifications"]=[]),notificationSubscribers:e["__lively.modules__notificationSubscribers"]||(e["__lively.modules__notificationSubscribers"]={}),options:e["__lively.modules__options"]||(e["__lively.modules__options"]=lively_lang.obj.deepCopy(defaultOptions)),onLoadCallbacks:e["__lively.modules__onLoadCallbacks"]||(e["__lively.modules__onLoadCallbacks"]=[]),modulePackageMapCache:e["__lively.modules__modulePackageMapCache"]}}function systems(){return SystemClass.systems}function nameOfSystem(e){return Object.keys(systems()).detect(function(t){return systems()[t]===e})}function getSystem(e,t){return e&&"string"!=typeof e?e:systems()[e]||(systems()[e]=makeSystem(t))}function removeSystem(e){var t=e&&"string"!=typeof e?nameOfSystem(e):e;delete systems()[t]}function makeSystem(e){return prepareSystem(new SystemClass,e)}function prepareSystem(e,t){e.trace=!0;var r=(t=t||{}).hasOwnProperty("useModuleTranslationCache")?t.useModuleTranslationCache:!urlQuery().noModuleCache;e.useModuleTranslationCache=r,e.set("@lively-env",e.newModule(livelySystemEnv(e))),"undefined"!=typeof WorkerGlobalScope&&e.set("@system-env",e.newModule(_extends({},e.get("@system-env"),{browser:!0,worker:!0})));var n="undefined"!=typeof process&&process.versions&&process.versions.electron;if(n&&e.set("@system-env",e.newModule(_extends({electron:n},e.get("@system-env")))),wrapResource(e),wrapModuleLoad$1(e),isInstalled(e,"normalizeHook")||install(e,"normalize",normalizeHook),isInstalled(e,"decanonicalize","decanonicalizeHook")||install(e,"decanonicalize",decanonicalizeHook),isInstalled(e,"normalizeSync","decanonicalizeHook")||install(e,"normalizeSync",decanonicalizeHook),isInstalled(e,"newModule","newModule_volatile")||install(e,"newModule",newModule_volatile),isInstalled(e,"instantiate","instantiate_triggerOnLoadCallbacks")||install(e,"instantiate",instantiate_triggerOnLoadCallbacks),n){i=["electron"].reduce(function(e,t){return e[t]="@node/"+t,e},{});t.map=lively_lang.obj.merge(i,t.map)}if(isNode){var i=["addons","assert","buffer","child_process","cluster","console","crypto","dgram","dns","domain","events","fs","http","https","module","net","os","path","punycode","querystring","readline","repl","stream","stringdecoder","timers","tls","tty","url","util","v8","vm","zlib"].reduce(function(e,t){return e[t]="@node/"+t,e},{});t.map=lively_lang.obj.merge(i,t.map)}return t.packageConfigPaths=t.packageConfigPaths||["./node_modules/*/package.json"],t.transpiler||"traceur"!==e.transpiler||("lively.transpiler"===initialSystem.transpiler?(e.set("lively.transpiler",initialSystem.get("lively.transpiler")),e._loader.transpilerPromise=initialSystem._loader.transpilerPromise,e.config({transpiler:"lively.transpiler",babelOptions:Object.assign(initialSystem.babelOptions||{},t.babelOptions)})):e.config({map:{"plugin-babel":initialSystem.map["plugin-babel"],"systemjs-babel-build":initialSystem.map["systemjs-babel-build"]},transpiler:initialSystem.transpiler,babelOptions:Object.assign(initialSystem.babelOptions||{},t.babelOptions)})),e.config(t),e}function urlQuery(){return"undefined"!=typeof document&&document.location?(document.location.search||"").replace(/^\?/,"").split("&").reduce(function(query$$1,ea){var split=ea.split("="),key=split[0],value=split[1];return"true"===value||"false"===value?value=eval(value):isNaN(Number(value))||(value=Number(value)),query$$1[key]=value,query$$1},{}):{}}function preNormalize(e,t,r){".."===t&&(t="../index.js"),t=t.replace(doubleSlashRe,function(e){return":"===e[0]?e:e[0]+"/"});var n=e.get("@lively-env").packageRegistry;if(n){var i=r&&n.findPackageHavingURL(r);if(i){var o=i.map,a=i.url,s=o&&o[t]||e.map[t];s&&("object"===(void 0===s?"undefined":_typeof(s))&&(s=normalize_doMapWithObject(s,i,e)),"string"==typeof s&&""!==s&&(t=s),t.startsWith(".")&&(t=urlResolve(join(a,t))))}}if(n){var u=n.resolvePath(t,r);u&&(u.endsWith("/")&&!t.endsWith("/")&&(u=u.slice(0,-1)),!u.endsWith("/")&&t.endsWith("/")&&(u+="/"),t=u)}return t}function postNormalize(e,t,r){var n=t.replace(jsExtRe,"");if(t.endsWith("/"))return t;var i=e.get("@lively-env").packageRegistry;if(i){var o=i.findPackageWithURL(n);if(o){var a=(o.main||"index.js").replace(dotSlashStartRe,"");return s=n.replace(trailingSlashRe,"")+"/"+a}}else if(n in e.packages&&(a=e.packages[n].main)){var s=n.replace(trailingSlashRe,"")+"/"+a.replace(dotSlashStartRe,"");return s}var u=t.match(jsonJsExtRe);return u?u[1]:t}function normalizeHook(e,t,r,n){var i=this,o=preNormalize(i,t,r);return e(o,r,n).then(function(e){var r=postNormalize(i,e||o,!1);return i.debug&&console.log("[normalize] "+t+" => "+r),r})}function decanonicalizeHook(e,t,r,n){var i=this,o=postNormalize(i,e(preNormalize(i,t,r),r,n),!0);return i.debug&&console.log("[normalizeSync] "+t+" => "+o),o}function normalize_doMapWithObject(e,t,r){var n,i=r.get(t.map["@env"]||"@system-env");for(var o in e){var a="~"==o[0],s=function(e,t){for(var r=e.split(".");r.length;)t=t[r.shift()];return t}(a?o.substr(1):o,i);if(!a&&s||a&&!s){n=e[o];break}}if(n&&"string"!=typeof n)throw new Error("Unable to map a package conditional to a package conditional.");return n}function newModule_volatile(e,t){var r=Object.freeze;Object.freeze=function(e){return e};var n=e(t);return Object.freeze=r,n}function printSystemConfig$1(e){var t={baseURL:(e=getSystem(e)).baseURL,transpiler:e.transpiler,defaultJSExtensions:e.defaultJSExtensions,defaultExtension:e.defaultExtension,map:e.map,meta:e.meta,packages:e.packages,paths:e.paths,packageConfigPaths:e.packageConfigPaths,bundles:e.bundles};return JSON.stringify(t,null,2)}function instantiate_triggerOnLoadCallbacks(e,t){var r=this;return e(t).then(function(e){var n={};return lively_lang.promise.waitFor(6e4,function(){return r.get(t.name)},n).then(function(e){if(e!==n){for(var i=t.name,o=module$2(r,i),a=r.get("@lively-env").onLoadCallbacks,s=a.length;s--;){var u=a[s],c=u.moduleName,l=u.resolved,f=u.callback;if((l?c:r.decanonicalize(c))===i){a.splice(s,1);try{f(o)}catch(e){console.error(e)}}}lively_notifications.emit("lively.modules/moduleloaded",{module:t.name},Date.now(),r)}else console.warn("[lively.modules] instantiate_triggerOnLoadCallbacks for "+t.name+" timed out")}),e})}function whenLoaded$2(e,t,r){var n=e.decanonicalize(t);if(e.get(n))try{r(module$2(e,n))}catch(e){console.error(e)}else e.get("@lively-env").onLoadCallbacks.push({moduleName:t,resolved:!1,callback:r})}function loadedModules$1(e){return e.get("@lively-env").loadedModules}function knownModuleNames(e){var t=e.loads?Object.keys(e.loads):Object.keys(e._loader.moduleRecords);return lively_lang.arr.uniq(t.concat(Object.keys(loadedModules$1(e))))}function resolvePackageDependencies(e,t){var r=_extends({},e.dependencies,e.devDependencies);return Object.keys(r).reduce(function(e,n){var i=r[n],o=lively_lang.obj.values(t).find(function(e){var t=e.name,r=e.version;return t===n&&lively.modules.semver.satisfies(r,i)})||{},a=o.name,s=o.version;return e[n]=a?a+"@"+s:void 0,e},{})}function dependencyGraph(e){function t(e,t){var i=e+"@"+t;if(i in n)return n[i];var o=r.find(function(r){var n=r.name,i=r.version;return n===e&&lively.modules.semver.satisfies(i,t)})||{},a=o.name,s=o.version;return n[i]=a?a+"@"+s:void 0}var r=lively_lang.obj.values(e),n={};return Object.keys(e).reduce(function(r,n){var i=e[n],o=_extends({},i.dependencies,i.devDependencies);return r[n]=Object.keys(o).map(function(e){return t(e,o[e])}).filter(function(e){return!!e}),r},{})}function changeSystem(e,t){return exports.System=e,t&&(GLOBAL.System=e),e}function loadedModules$$1(){return Object.keys(requireMap())}function module$1(e){return module$2(exports.System,e)}function isModuleLoaded$$1(e,t){return isModuleLoaded$1(exports.System,e,t)}function doesModuleExist$$1(e,t){return doesModuleExist$1(exports.System,e,t)}function printSystemConfig$$1(){return printSystemConfig$1(exports.System)}function whenLoaded$1(e,t){return whenLoaded$2(exports.System,e,t)}function importPackage$$1(e){return importPackage$1(exports.System,e)}function registerPackage$$1(e,t){return registerPackage$1(exports.System,e,t)}function removePackage$1(e){return removePackage$2(exports.System,e)}function reloadPackage$$1(e,t){return reloadPackage$1(exports.System,e,t)}function getPackages(){return getPackageSpecs(exports.System)}function getPackage$$1(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return getPackage$1(exports.System,e,t)}function getPackageOfModule(e){return Package.forModuleId(exports.System,e)}function ensurePackage$$1(e){return ensurePackage$1(exports.System,e)}function applyPackageConfig(e,t){return applyConfig$1(exports.System,e,t)}function lookupPackage$$1(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return lookupPackage$1(exports.System,e,t)}function moduleSourceChange$$1(e,t,r){return moduleSourceChange$1(exports.System,e,t,r)}function requireMap(){return computeRequireMap(exports.System)}function isHookInstalled(e,t){return isInstalled(exports.System,e,t)}function installHook(e,t){return install(exports.System,e,t)}function removeHook(e,t){return remove$1(exports.System,e,t)}function wrapModuleLoad$$1(){wrapModuleLoad$1(exports.System)}function unwrapModuleLoad$$1(){unwrapModuleLoad$1(exports.System)}semver="default"in semver?semver.default:semver;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},asyncToGenerator=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),defineProperty=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},get$1=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},set$1=function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var s=o.set;void 0!==s&&s.call(i,n)}return n},slicedToArray=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),customTranslate=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,s,u,c,l,f,p,h,d,m,v,y,g,b,_,x,w,k=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this,i=n.debug,o=r.metadata,!(a=o&&o.hasOwnProperty("instrument")&&!o.instrument||exceptions.some(function(e){return e(r.name)}))){e.next=4;break}return i&&console.log("[lively.modules customTranslate ignoring] %s",r.name),e.abrupt("return",t(r));case 4:if(!isNode$1||!addNodejsWrapperSource(n,r)){e.next=7;break}return i&&console.log("[lively.modules] loaded %s from nodejs cache",r.name),e.abrupt("return",t(r));case 7:if(s=Date.now(),u=detectModuleFormat(r.source,o),c=module$2(n,r.name),l=!1,f="esm"===u,p="cjs"===u,h="global"===u,c.setSource(r.source),e.prev=10,d=n.useModuleTranslationCache,m=n.global.indexedDB,v=d&&String(lively_lang.string.hashCode(r.source)),!(d&&m&&f)){e.next=25;break}return y=n._livelyModulesTranslationCache||(n._livelyModulesTranslationCache=new BrowserModuleTranslationCache),e.next=16,y.fetchStoredModuleSource(r.name);case 16:if(!((g=e.sent)&&g.hash==v&&g.timestamp>=BrowserModuleTranslationCache.earliestDate)){e.next=23;break}if(!g.source){e.next=23;break}return o.format="register",o.deps=[],i&&console.log("[lively.modules customTranslate] loaded %s from browser cache after %sms",r.name,Date.now()-s),e.abrupt("return",Promise.resolve(g.source));case 23:e.next=36;break;case 25:if(!(isNode$1&&d&&f)){e.next=36;break}return y=n._livelyModulesTranslationCache||(n._livelyModulesTranslationCache=new NodeModuleTranslationCache),e.next=29,y.fetchStoredModuleSource(r.name);case 29:if(!((g=e.sent)&&g.hash==v&&g.timestamp>=NodeModuleTranslationCache.earliestDate)){e.next=36;break}if(!g.source){e.next=36;break}return o.format="register",o.deps=[],i&&console.log("[lively.modules customTranslate] loaded %s from filesystem cache after %sms",r.name,Date.now()-s),e.abrupt("return",Promise.resolve(g.source));case 36:e.next=41;break;case 38:e.prev=38,e.t0=e.catch(10),console.error("[lively.modules customTranslate] error reading module translation cache: "+e.t0.stack);case 41:return b={},f?(c.recorderName="__lvVarRecorder",c.recorder===n.global&&c.unloadEnv(),r.metadata.format="esm",_=prepareCodeForCustomCompile(0,r.source,r.name,c,i),b=_.options,x=_.source,r.source=x,r.metadata["lively.modules instrumented"]=!0,l=!0,i&&console.log("[lively.modules] loaded %s as es6 module",r.name)):"global"===r.metadata.format&&(c.recorderName="System.global",c.recorder=n.global,r.metadata.format="global",w=prepareCodeForCustomCompile(0,r.source,r.name,c,i),b=w.options,x=w.source,r.source=x,r.metadata["lively.modules instrumented"]=!0,l=!0,i&&console.log("[lively.modules] loaded %s as instrumented global module",r.name)),l||i&&console.log("[lively.modules] customTranslate ignoring %s b/c don't know how to handle format %s",r.name,r.metadata.format),e.abrupt("return",t(r).then(function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0===t.indexOf("System.register(")&&(i&&console.log("[lively.modules customTranslate] Installing System.register setter captures for %s",r.name),t=prepareTranslatedCodeForSetterCapture(0,t,r.name,c,b,i)),!(isNode$1&&d&&f)){e.next=14;break}return o=n._livelyModulesTranslationCache||(n._livelyModulesTranslationCache=new NodeModuleTranslationCache),e.prev=3,e.next=6,o.cacheModuleSource(r.name,v,t);case 6:i&&console.log("[lively.modules customTranslate] stored cached version in filesystem for %s",r.name),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),console.error("[lively.modules customTranslate] failed storing module cache: "+e.t0.stack);case 12:e.next=25;break;case 14:if(!(d&&m&&f)){e.next=25;break}return o=n._livelyModulesTranslationCache||(n._livelyModulesTranslationCache=new BrowserModuleTranslationCache),e.prev=16,e.next=19,o.cacheModuleSource(r.name,v,t);case 19:i&&console.log("[lively.modules customTranslate] stored cached version for %s",r.name),e.next=25;break;case 22:e.prev=22,e.t1=e.catch(16),console.error("[lively.modules customTranslate] failed storing module cache: "+e.t1.stack);case 25:return i&&console.log("[lively.modules customTranslate] done %s after %sms",r.name,Date.now()-s),e.abrupt("return",t);case 27:case"end":return e.stop()}},e,k,[[3,9],[16,22]])}));return function(t){return e.apply(this,arguments)}}()));case 45:case"end":return e.stop()}},e,this,[[10,38]])}));return function(t,r){return e.apply(this,arguments)}}(),funcCall=lively_ast.nodes.funcCall,member=lively_ast.nodes.member,literal=lively_ast.nodes.literal,isNode$1=System.get("@system-env").node,ModuleTranslationCache=function(){function e(){classCallCheck(this,e)}return createClass(e,[{key:"cacheModuleSource",value:function(e,t,r){throw new Error("not yet implemented")}},{key:"fetchStoredModuleSource",value:function(e){throw new Error("not yet implemented")}},{key:"deleteCachedData",value:function(e){throw new Error("not yet implemented")}}],[{key:"earliestDate",get:function(){return+new Date("Sun Nov 06 2016 16:00:00 GMT-0800 (PST)")}}]),e}(),nodejsCacheDir=null,NodeModuleTranslationCache=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,ModuleTranslationCache),createClass(t,[{key:"ensurePath",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.moduleCacheDir.join(t).exists();case 2:if(!e.sent){e.next=4;break}return e.abrupt("return");case 4:r="",o=!0,a=!1,s=void 0,e.prev=8,u=t.split("/")[Symbol.iterator]();case 10:if(o=(c=u.next()).done){e.next=38;break}return l=c.value,r+=l+"/",n=this.moduleCacheDir.join(r),e.next=16,n.exists();case 16:if(e.sent){e.next=26;break}return e.prev=17,e.next=20,n.mkdir();case 20:e.next=26;break;case 22:if(e.prev=22,e.t0=e.catch(17),"EEXIST"==e.t0.code){e.next=26;break}throw e.t0;case 26:return n=lively_resources.resource("file://"+r+"/package.json"),e.next=29,n.exists();case 29:if(!e.sent){e.next=35;break}return e.next=32,n.read();case 32:return i=e.sent,e.next=35,this.moduleCacheDir.join(r+"/package.json").write(i);case 35:o=!0,e.next=10;break;case 38:e.next=44;break;case 40:e.prev=40,e.t1=e.catch(8),a=!0,s=e.t1;case 44:e.prev=44,e.prev=45,!o&&u.return&&u.return();case 47:if(e.prev=47,!a){e.next=50;break}throw s;case 50:return e.finish(47);case 51:return e.finish(44);case 52:case"end":return e.stop()}},e,this,[[8,40,44,52],[17,22],[45,,47,51]])}));return function(t){return e.apply(this,arguments)}}()},{key:"dumpModuleCache",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=regeneratorRuntime.keys(System._nodeRequire("module").Module._cache);case 1:if((e.t1=e.t0()).done){e.next=16;break}return t=e.t1.value,r=lively_resources.resource("file://"+t),e.next=6,r.exists();case 6:if(!e.sent){e.next=14;break}return e.t2=this,e.t3=t,e.next=11,r.read();case 11:return e.t4=e.sent,e.next=14,e.t2.cacheModuleSource.call(e.t2,e.t3,"NO_HASH",e.t4);case 14:e.next=1;break;case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fetchStoredModuleSource",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t.replace("file://",""),r=t.match(/([^\/]*.)\.js/)[0],n=t.replace(r,""),i=this.moduleCacheDir.join(t),e.next=3,i.exists();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return e.next=7,i.stat();case 7:return o=e.sent,a=o.birthtime,e.next=11,i.read();case 11:return s=e.sent,e.next=14,this.moduleCacheDir.join(n+"/.hash_"+r).read();case 14:return u=e.sent,e.abrupt("return",{source:s,timestamp:a,hash:u});case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cacheModuleSource",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t.replace("file://",""),i=t.match(/([^\/]*.)\.js/)[0],o=t.replace(i,""),e.next=3,this.ensurePath(o);case 3:return e.next=5,this.moduleCacheDir.join(t).write(n);case 5:return e.next=7,this.moduleCacheDir.join(o+"/.hash_"+i).write(r);case 7:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"deleteCachedData",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t.replace("file://",""),r=t.match(/([^\/]*.)\.js/)[0],n=t.replace(r,""),i=this.moduleCacheDir.join(t),e.next=4,i.exists();case 4:if(e.sent){e.next=6;break}return e.abrupt("return",!1);case 6:return e.next=8,i.remove();case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"moduleCacheDir",get:function(){return nodejsCacheDir||prepareNodejsCaching(),lively_resources.resource("file://"+nodejsCacheDir+"/.module_cache/")}}]),t}(),BrowserModuleTranslationCache=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"lively.modules-module-translation-cache";classCallCheck(this,t);var r=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.version=2,r.sourceCodeCacheStoreName="sourceCodeStore",r.dbName=e,r.db=r.openDb(),r}return inherits(t,ModuleTranslationCache),createClass(t,[{key:"openDb",value:function(){var e=this,t=System.global.indexedDB.open(this.version);return new Promise(function(r,n){t.onsuccess=function(e){r(this.result)},t.onerror=function(e){return n(e.target)},t.onupgradeneeded=function(t){return t.currentTarget.result.createObjectStore(e.sourceCodeCacheStoreName,{keyPath:"moduleId"})}})}},{key:"deleteDb",value:function(){var e=System.global.indexedDB.deleteDatabase(this.dbName);return new Promise(function(t,r){e.onerror=function(e){return r(e.target)},e.onsuccess=function(e){return t(e)}})}},{key:"closeDb",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return t=e.sent,r=t.close(),e.abrupt("return",new Promise(function(e,t){r.onsuccess=function(t){e(this.result)},r.onerror=function(e){return t(e.target.errorCode)}}));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"cacheModuleSource",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var i,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return i=e.sent,e.abrupt("return",new Promise(function(e,a){var s=i.transaction([o.sourceCodeCacheStoreName],"readwrite"),u=s.objectStore(o.sourceCodeCacheStoreName),c=Date.now();u.put({moduleId:t,hash:r,source:n,timestamp:c}),s.oncomplete=e,s.onerror=a}));case 4:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"fetchStoredModuleSource",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return r=e.sent,e.abrupt("return",new Promise(function(e,i){var o=r.transaction([n.sourceCodeCacheStoreName]).objectStore(n.sourceCodeCacheStoreName).get(t);o.onerror=i,o.onsuccess=function(t){return e(o.result)}}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"deleteCachedData",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return r=e.sent,e.abrupt("return",new Promise(function(e,i){var o=r.transaction([n.sourceCodeCacheStoreName],"readwrite").objectStore(n.sourceCodeCacheStoreName).delete(t);o.onerror=i,o.onsuccess=function(t){return e(o.result)}}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(),node_modulesDir=System.decanonicalize("lively.modules/node_modules/"),exceptions=[function(e){return!e.endsWith(".js")},function(e){return e.endsWith("dist/acorn.js")||e.endsWith("dist/escodegen.browser.js")||e.endsWith("bowser.js")||e.endsWith("TweenMax.min.js")},function(e){return e.endsWith("babel-core/browser.js")||e.endsWith("system.src.js")||e.includes("systemjs-plugin-babel")}],moduleSourceChange$1=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n,i,o){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.debug&&console.log("[module change] "+r+" "+n.slice(0,50).replace(/\n/g,"")+" "+i),i&&"es6"!==i&&"esm"!==i&&"register"!==i&&"defined"!==i){e.next=8;break}return e.next=5,moduleSourceChangeEsm(t,r,n,o);case 5:a=e.sent,e.next=15;break;case 8:if("global"!==i){e.next=14;break}return e.next=11,moduleSourceChangeGlobal(t,r,n,o);case 11:a=e.sent,e.next=15;break;case 14:throw new Error("moduleSourceChange is not supported for module "+r+" with format "+i);case 15:return lively_notifications.emit("lively.modules/modulechanged",{module:r,newSource:n,options:o},Date.now(),t),e.abrupt("return",a);case 19:throw e.prev=19,e.t0=e.catch(0),lively_notifications.emit("lively.modules/modulechanged",{module:r,newSource:n,error:e.t0,options:o},Date.now(),t),e.t0;case 23:case"end":return e.stop()}},e,this,[[0,19]])}));return function(t,r,n,i,o){return e.apply(this,arguments)}}(),moduleSourceChangeEsm=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n,i){var o,a,s,u,c,l,f,p,h,d,m,v,y,g,b,_,x,w;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.debug,a={status:"loading",source:n,name:r,address:r,linkSets:[],dependencies:[],metadata:{format:"esm"}},e.next=3,instrumentSourceOfEsmModuleLoad(t,a);case 3:s=e.sent,u=function(e,r){return scheduleModuleExportsChange(t,a.name,e,r,!0)},c=s.declare(u),o&&console.log("[lively.vm es6] sourceChange of %s with deps",a.name,s.localDeps),l=[],f=!0,p=!1,h=void 0,e.prev=10,d=s.localDeps[Symbol.iterator]();case 12:if(f=(m=d.next()).done){e.next=25;break}return v=m.value,e.next=16,t.normalize(v,a.name);case 16:return y=e.sent,g=module$2(t,y),e.next=20,g.load();case 20:b=e.sent,l.push({name:v,fullname:y,module:g,exports:b});case 22:f=!0,e.next=12;break;case 25:e.next=31;break;case 27:e.prev=27,e.t0=e.catch(10),p=!0,h=e.t0;case 31:e.prev=31,e.prev=32,!f&&d.return&&d.return();case 34:if(e.prev=34,!p){e.next=37;break}throw h;case 37:return e.finish(34);case 38:return e.finish(31);case 39:return(_=t.loads&&t.loads[a.name])&&(_.deps=l.map(function(e){return e.name}),_.depMap=l.reduce(function(e,t){return e[t.name]=t.fullname,e},{}),_.metadata&&_.metadata.entry&&(_.metadata.entry.deps=_.deps,_.metadata.entry.normalizedDeps=l.map(function(e){return e.fullname}),_.metadata.entry.declare=s.declare)),x=module$2(t,a.name),w=x.record(),l.forEach(function(e,t){return x.addDependencyToModuleRecord(e.module,c.setters[t])}),w&&(w.execute=c.execute),l.forEach(function(e,t){return c.setters[t](e.exports)}),e.abrupt("return",c.execute());case 46:case"end":return e.stop()}},e,this,[[10,27,31,39],[32,,34,38]])}));return function(t,r,n,i){return e.apply(this,arguments)}}(),moduleSourceChangeGlobal=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n,i){var o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o={status:"loading",source:n,name:r,address:r,linkSets:[],dependencies:[],metadata:{format:"global"}},t.get(r)){e.next=4;break}return e.next=4,t.import(r);case 4:return e.next=6,instrumentSourceOfGlobalModuleLoad(t,o);case 6:return a=e.sent,o.source=a.translated,s=doInstantiateGlobalModule(t,o),t.delete(r),t.set(s.name,s.esModule),e.abrupt("return",s.module);case 12:case"end":return e.stop()}},e,this)}));return function(t,r,n,i){return e.apply(this,arguments)}}(),ModulePackageMapping=function(){function e(t){classCallCheck(this,e),this.System=t,this._notificationHandlers=null,this.clearCache(),this.subscribeToSystemChanges()}return createClass(e,null,[{key:"forSystem",value:function(e){var t=e["__lively.modules__modulePackageMapCache"];if(t)return t;var r=new this(e);return e["__lively.modules__modulePackageMapCache"]=r,r}}]),createClass(e,[{key:"subscribeToSystemChanges",value:function(){var e=this;if(!this._notificationHandlers){var t=this.System;this._notificationHandlers=[lively_notifications.subscribe("lively.modules/moduleloaded",function(t){return e.addModuleIdToCache(t.module)},t),lively_notifications.subscribe("lively.modules/moduleunloaded",function(t){return e.removeModuleFromCache(t.module)},t),lively_notifications.subscribe("lively.modules/packageregistered",function(t){return e.clearCache()},t),lively_notifications.subscribe("lively.modules/packageremoved",function(t){return e.clearCache()},t)]}}},{key:"unsubscribeFromSystemChanges",value:function(){if(this._notificationHandlers){var e=this.System;lively_notifications.unsubscribe("lively.modules/moduleloaded",this._notificationHandlers[0],e),lively_notifications.unsubscribe("lively.modules/moduleunloaded",this._notificationHandlers[1],e),lively_notifications.unsubscribe("lively.modules/packageregistered",this._notificationHandlers[2],e),lively_notifications.unsubscribe("lively.modules/packageremoved",this._notificationHandlers[3],e),this._notificationHandlers=null}}},{key:"clearCache",value:function(){this._cacheInitialized=!1,this.packageToModule={},this.modulesToPackage={},this.modulesWithoutPackage={}}},{key:"ensureCache",value:function(){var e=this.System,t=this._cacheInitialized,r=this.packageToModule,n=this.modulesToPackage,i=this.modulesWithoutPackage;if(t)return this;for(var o=Package.allPackageURLs(e),a=0;a<o.length;a++)r[o[a]]=[];for(var s=knownModuleNames(e),u=0;u<s.length;u++){for(var c=s[u],l=void 0,f=0;f<o.length;f++){var p=o[f];c.startsWith(p)&&(!l||l.length<p.length)&&(l=p)}l?(r[l].push(c),n[c]=l):i[c]={}}return this._cacheInitialized=!0,this}},{key:"addModuleIdToCache",value:function(e){this.ensureCache();var t=this.packageToModule,r=this.modulesToPackage,n=this.modulesWithoutPackage;if(r[e])return r[e];if(n[e])return null;for(var i=Object.keys(t),o=void 0,a=0;a<i.length;a++){var s=i[a];e.startsWith(s)&&(!o||o.length<s.length)&&(o=s)}return o?((t[o]||(t[o]=[])).push(e),r[e]=o):(n[e]={},null)}},{key:"removeModuleFromCache",value:function(e){if(this._cacheInitialized){var t=this.packageToModule,r=this.modulesToPackage,n=this.modulesWithoutPackage;if(n.hasOwnProperty(e))delete n[e];else{var i=r[e];i&&(delete r[e],t[i]&&lively_lang.arr.remove(t[i],e))}}}},{key:"getPackageURLForModuleId",value:function(e){return this.modulesToPackage[e]||this.addModuleIdToCache(e)}},{key:"getModuleIdsForPackageURL",value:function(e){return this.ensureCache(),this.packageToModule[e]||[]}}]),e}(),join=lively_lang.string.joinPath,PackageConfiguration=function(){function PackageConfiguration(e){classCallCheck(this,PackageConfiguration),this.pkg=e}return createClass(PackageConfiguration,[{key:"applyConfig",value:function(e){var t=this.System,r=this.packageURL,n=this.pkg,i=(e=lively_lang.obj.deepMerge(n.config,e)).name||r.split("/").slice(-1)[0],o=e.version,a=e.systemjs||{},s=e.lively,u=e.main||"index.js";t.config({map:defineProperty({},i,r),packages:defineProperty({},r,_extends({},a,{meta:_extends({"package.json":{format:"json"}},a.meta),configured:!0}))}),t.packages[r].configured=!0;var c=t.getConfig().packages[r]||{};return c.map||(c.map={}),a&&(s&&s.main?u=s.main:a.main&&(u=a.main),this.applySystemJSConfig(a)),u.match(/\.[^\/\.]+/)||(u+=".js"),c.main=u,n.version=o,n.config=e,n._name=i,n.mergeWithConfig(c),s?this.applyLivelyConfig(s):{subPackages:[]}}},{key:"applySystemJSConfig",value:function(e){var t=this.System;e.packageConfigPaths&&(t.packageConfigPaths=lively_lang.arr.uniq(t.packageConfigPaths.concat(e.packageConfigPaths))),e.packages&&t.config({packages:e.packages}),e.globalmap&&t.config({map:e.globalmap}),e.babelOptions&&t.config({babelOptions:e.babelOptions})}},{key:"applyLivelyConfig",value:function(e){this.applyLivelyConfigMeta(e),this.applyLivelyConfigHooks(e),this.applyLivelyConfigBundles(e)}},{key:"applyLivelyConfigHooks",value:function applyLivelyConfigHooks(livelyConfig){var _this=this;(livelyConfig.hooks||[]).forEach(function(h){try{var f=eval("("+h.source+")");f.name&&isInstalled(_this.System,h.target,f.name)||install(_this.System,h.target,f)}catch(e){console.error("Error installing hook for %s: %s",_this.packageURL,e,h)}})}},{key:"applyLivelyConfigBundles",value:function(e){var t=this;if(!e.bundles)return Promise.resolve();var r=Object.keys(e.bundles).reduce(function(r,n){var i=t.packageURL+"/"+n,o=e.bundles[n].map(function(e){return t.System.decanonicalize(e,t.packageURL+"/")});return r[i]=o,r},{});return this.System.config({bundles:r}),Promise.resolve()}},{key:"applyLivelyConfigMeta",value:function(e){if(e.meta){var t=this.System.getConfig().packages[this.packageURL]||{},r={meta:{},packages:defineProperty({},this.packageURL,t)};Object.keys(e.meta).forEach(function(n){var i=e.meta[n];isURL(n)?r.meta[n]=i:(t.meta||(t.meta={}),t.meta[n]=i)}),this.System.config(r)}}},{key:"System",get:function(){return this.pkg.System}},{key:"packageURL",get:function(){return this.pkg.url}}]),PackageConfiguration}(),urlStartRe=/^[a-z\.-_\+]+:/i,PackageRegistry$$1=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};classCallCheck(this,e),this.System=t,this.packageBaseDirs=r.packageBaseDirs||[],this.devPackageDirs=r.devPackageDirs||[],this.individualPackageDirs=r.individualPackageDirs||[],this._readyPromise=null,this.packageMap={},this._byURL=null}return createClass(e,null,[{key:"ofSystem",value:function(e){var t=e.get("@lively-env").packageRegistry;return t||(t=e["__lively.modules__packageRegistry"]=new this(e)),t}},{key:"forDirectory",value:function(e,t){return new this(e,{packageBaseDirs:[ensureResource(t)]})}},{key:"fromJSON",value:function(e,t){return new this(e).fromJSON(t)}}]),createClass(e,[{key:"resetByURL",value:function(){this._byURL=null}},{key:"allPackageURLs",value:function(){return Object.keys(this.byURL)}},{key:"toJSON",value:function(){function e(e){var r=e.url;return r.startsWith(t.baseURL)?r.slice(t.baseURL.length).replace(/^\//,""):r}var t=this.System,r=this.packageMap,n=this.individualPackageDirs,i=this.devPackageDirs,o=this.packageBaseDirs,a={};for(var s in r){var u=r[s];a[s]={},a[s].latest=u.latest,a[s].versions={};for(var c in u.versions)a[s].versions[c]=u.versions[c].toJSON()}return{packageMap:a,individualPackageDirs:n.map(e),devPackageDirs:i.map(e),packageBaseDirs:o.map(e)}}},{key:"fromJSON",value:function(e){function t(e){return isURL(e)?lively_resources.resource(e):lively_resources.resource(n.baseURL).join(e)}var r={},n=this.System,i=lively_resources.resource(n.baseURL);for(var o in e.packageMap){var a=e.packageMap[o];r[o]={},r[o].latest=a.latest,r[o].versions={};for(var s in a.versions){var u=a.versions[s],c=u.url;isAbsolute(c)||(c=i.join(c).url);var l=new Package.fromJSON(n,_extends({},u,{url:c}));r[o].versions[s]=l}}return this.packageMap=r,this.individualPackageDirs=e.individualPackageDirs.map(t),this.devPackageDirs=e.devPackageDirs.map(t),this.packageBaseDirs=e.packageBaseDirs.map(t),this.resetByURL(),ModulePackageMapping.forSystem(n).clearCache(),this}},{key:"updateFromJSON",value:function(e){var t=this.packageMap;for(var r in e.packageMap){var n=e.packageMap[r];t[r]||(t[r]={}),t[r].latest?semver.gt(n.latest,t[r].latest)&&(t[r].latest=n.latest):t[r].latest,t[r].versions||(t[r].versions={});var i=this.System,o=lively_resources.resource(i.baseURL);for(var a in n.versions){var s=n.versions[a],u=s.url;isAbsolute(u)||(u=o.join(u).url);var c=new Package.fromJSON(i,_extends({},s,{url:u}));t[r].versions[a]=c}}return this.resetByURL(),ModulePackageMapping.forSystem(System).clearCache(),this}},{key:"whenReady",value:function(){return this._readyPromise||Promise.resolve()}},{key:"isReady",value:function(){return!this._readyPromise}},{key:"withPackagesDo",value:function(e){for(var t in this.packageMap){var r=this.packageMap[t].versions;for(var n in r)e(r[n])}}},{key:"findPackage",value:function(e){for(var t in this.packageMap){var r=this.packageMap[t].versions;for(var n in r){var i=r[n];if(e(i))return i}}return null}},{key:"filterPackages",value:function(e){var t=[];return this.withPackagesDo(function(r){return e(r)&&t.push(r)}),t}},{key:"allPackages",value:function(){var e=[];for(var t in this.packageMap){var r=this.packageMap[t].versions;for(var n in r)e.push(r[n])}return e}},{key:"sortPackagesByVersion",value:function(e){return e.sort(function(e,t){return semver.compare(e.version,t.version,!0)})}},{key:"matches",value:function(e,t,r){var n=e.name,i=e.version;return n===t&&(!r||!(!semver.validRange(i||"",!0)||!semver.satisfies(i,r,!0)))}},{key:"coversDirectory",value:function(e){e=ensureResource(e).asDirectory();var t=this.packageBaseDirs,r=this.devPackageDirs;if(this.individualPackageDirs.some(function(t){return t.equals(e)}))return"individualPackageDirs";if(r.some(function(t){return t.equals(e)}))return"devPackageDirs";var n=e.parent().parent();return t.some(function(e){return e.equals(n)})?this.allPackages().find(function(t){return ensureResource(t.url).equals(e)})?"packageCollectionDirs":"maybe packageCollectionDirs":null}},{key:"lookup",value:function(e,t){var r=this,n=this.packageMap[e];if(!n)return null;if(!t||"latest"===t)return n.versions[n.latest];if(!semver.validRange(t,!0))throw new Error("PackageRegistry>>lookup of "+e+": Invalid version - "+t);var i=lively_lang.obj.values(n.versions).filter(function(n){return r.matches(n,e,t)});return i.length<=1?i[0]:lively_lang.arr.last(this.sortPackagesByVersion(i))}},{key:"findPackageDependency",value:function(e,t,r){return r||(r=e.dependencies[t]||e.devDependencies[t]),semver.validRange(r,!0)||(r=null),this.lookup(t,r)}},{key:"findPackageWithURL",value:function(e){return e.isResource&&(e=e.url),e.endsWith("/")&&(e=e.slice(0,-1)),this.byURL[e]}},{key:"findPackageHavingURL",value:function(e){e.isResource&&(e=e.url),e.endsWith("/")&&(e=e.slice(0,-1));var t=1/0,r=null,n=this.byURL;for(var i in n)if(0===e.indexOf(i)){var o=e.slice(i.length).length;o>=t||(t=o,r=n[i])}return r}},{key:"findPackageForPath",value:function(e,t){if(isAbsolute(e))return this.findPackageHavingURL(e);if(e.startsWith("."))return null;var r=e.split("/"),n=slicedToArray(r,1)[0];if(!n)return null;var i=n.indexOf("@"),o=void 0;return i>-1&&(o=n.slice(i+1),n=n.slice(0,i)),!o&&t?this.findPackageDependency(t,n):this.lookup(n,o)}},{key:"resolvePath",value:function(e,t){if(isAbsolute(e))return e;var r=t&&t.isPackage||null;if(!r&&t){if(e.startsWith(".")){var n=lively_resources.resource(t);return n.isDirectory()||(n=n.parent()),n.join(e).withRelativePartsResolved().url}r=this.findPackageHavingURL(t)}var i=this.findPackageForPath(e,r);if(!i)return null;var o=e.indexOf("/"),a=-1===o||o===e.length-1?"":e.slice(o);return a?lively_resources.resource(i.url).join(a).url:i.url}},{key:"update",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,i,o,a,s,u,c,l,f,p,h,d,m,v,y,g,b,_,x,w,k,E,S,A,D,C,F,j,T,O,R,B,P,I,L,N=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isReady()){e.next=2;break}return e.abrupt("return",this.whenReady().then(function(){return N.update()}));case 2:t=lively_lang.promise.deferred(),this._readyPromise=t.promise,this.packageBaseDirs=this.packageBaseDirs.map(function(e){return e.asDirectory()}),this.individualPackageDirs=this.individualPackageDirs.map(function(e){return e.asDirectory()}),this.devPackageDirs=this.devPackageDirs.map(function(e){return e.asDirectory()}),r={},e.prev=8,n=!0,i=!1,o=void 0,e.prev=12,a=this.packageBaseDirs[Symbol.iterator]();case 14:if(n=(s=a.next()).done){e.next=77;break}return u=s.value,c=!0,l=!1,f=void 0,e.prev=19,e.next=22,u.dirList(1);case 22:e.t0=Symbol.iterator,p=e.sent[e.t0]();case 24:if(c=(h=p.next()).done){e.next=60;break}return d=h.value,m=!0,v=!1,y=void 0,e.prev=29,e.next=32,d.dirList(1);case 32:e.t1=function(e){return e.isDirectory()},e.t2=Symbol.iterator,g=e.sent.filter(e.t1)[e.t2]();case 35:if(m=(b=g.next()).done){e.next=43;break}return _=b.value,e.next=39,this._discoverPackagesIn(_,r,"packageCollectionDirs");case 39:r=e.sent;case 40:m=!0,e.next=35;break;case 43:e.next=49;break;case 45:e.prev=45,e.t3=e.catch(29),v=!0,y=e.t3;case 49:e.prev=49,e.prev=50,!m&&g.return&&g.return();case 52:if(e.prev=52,!v){e.next=55;break}throw y;case 55:return e.finish(52);case 56:return e.finish(49);case 57:c=!0,e.next=24;break;case 60:e.next=66;break;case 62:e.prev=62,e.t4=e.catch(19),l=!0,f=e.t4;case 66:e.prev=66,e.prev=67,!c&&p.return&&p.return();case 69:if(e.prev=69,!l){e.next=72;break}throw f;case 72:return e.finish(69);case 73:return e.finish(66);case 74:n=!0,e.next=14;break;case 77:e.next=83;break;case 79:e.prev=79,e.t5=e.catch(12),i=!0,o=e.t5;case 83:e.prev=83,e.prev=84,!n&&a.return&&a.return();case 86:if(e.prev=86,!i){e.next=89;break}throw o;case 89:return e.finish(86);case 90:return e.finish(83);case 91:x=!0,w=!1,k=void 0,e.prev=94,E=this.individualPackageDirs[Symbol.iterator]();case 96:if(x=(S=E.next()).done){e.next=104;break}return A=S.value,e.next=100,this._discoverPackagesIn(A,r,"individualPackageDirs");case 100:r=e.sent;case 101:x=!0,e.next=96;break;case 104:e.next=110;break;case 106:e.prev=106,e.t6=e.catch(94),w=!0,k=e.t6;case 110:e.prev=110,e.prev=111,!x&&E.return&&E.return();case 113:if(e.prev=113,!w){e.next=116;break}throw k;case 116:return e.finish(113);case 117:return e.finish(110);case 118:D=!0,C=!1,F=void 0,e.prev=121,j=this.devPackageDirs[Symbol.iterator]();case 123:if(D=(T=j.next()).done){e.next=131;break}return O=T.value,e.next=127,this._discoverPackagesIn(O,r,"devPackageDirs");case 127:r=e.sent;case 128:D=!0,e.next=123;break;case 131:e.next=137;break;case 133:e.prev=133,e.t7=e.catch(121),C=!0,F=e.t7;case 137:e.prev=137,e.prev=138,!D&&j.return&&j.return();case 140:if(e.prev=140,!C){e.next=143;break}throw F;case 143:return e.finish(140);case 144:return e.finish(137);case 145:for(R in r)B=r[R],P=B.pkg,I=B.config,L=B.covered,this.System.debug&&console.log("[PackageRegistry] Adding discovered package "+R+" (from "+L+")"),this._addPackageWithConfig(P,I,R+"/",L);this._updateLatestPackages(),t.resolve(),e.next=153;break;case 150:e.prev=150,e.t8=e.catch(8),t.reject(e.t8);case 153:return e.prev=153,this._readyPromise=null,this.resetByURL(),ModulePackageMapping.forSystem(this.System).clearCache(),e.finish(153);case 158:return e.abrupt("return",this);case 159:case"end":return e.stop()}},e,this,[[8,150,153,158],[12,79,83,91],[19,62,66,74],[29,45,49,57],[50,,52,56],[67,,69,73],[84,,86,90],[94,106,110,118],[111,,113,117],[121,133,137,145],[138,,140,144]])}));return function(){return e.apply(this,arguments)}}()},{key:"addPackageAt",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"individualPackageDirs",l=arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((r=t.isResource?t.url:t).endsWith("/")&&r.slice(0,-1),!this.byURL[r]){e.next=4;break}throw new Error("package in "+r+" already added to registry");case 4:return e.next=6,this._discoverPackagesIn(ensureResource(t).asDirectory(),{},void 0,l);case 6:n=e.sent,e.t0=regeneratorRuntime.keys(n);case 8:if((e.t1=e.t0()).done){e.next=16;break}if(i=e.t1.value,!this.byURL[i]){e.next=12;break}return e.abrupt("continue",8);case 12:o=n[i],a=o.pkg,s=o.config,u=this._addPackageDir(i,c,!0),this._addPackageWithConfig(a,s,i+"/",u),e.next=8;break;case 16:return this.resetByURL(),ModulePackageMapping.forSystem(this.System).clearCache(),this._updateLatestPackages(),e.abrupt("return",this.findPackageWithURL(t));case 20:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"removePackage",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e.url,n=e.name,i=e.version,o=ensureResource(r),a=this.coversDirectory(o);"devPackageDirs"===a?this.devPackageDirs=this.devPackageDirs.filter(function(e){return!e.equals(o)}):"individualPackageDirs"===a&&(this.individualPackageDirs=this.individualPackageDirs.filter(function(e){return!e.equals(o)}));var s=this.packageMap;s[n]&&(delete s[n].versions[i],0===Object.keys(s[n].versions).length&&delete s[n]),this.resetByURL(),ModulePackageMapping.forSystem(this.System).clearCache(),t&&this._updateLatestPackages(e.name)}},{key:"updateNameAndVersionOf",value:function(e,t,r,n,i){var o=this.packageMap;o[t]?o[t].versions[r]||console.warn("[PackageRegistry>>updateNameAndVersionOf] No version entry "+r+" of "+t+" found in registry ("+e.url+")"):console.warn("[PackageRegistry>>updateNameAndVersionOf] "+t+"@"+r+" not found in registry ("+e.url+")"),this._addToPackageMap(e,n,i),o[t]&&o[t].versions[r]&&(delete o[t].versions[r],0===Object.keys(o[t].versions).length&&delete o[t]),this._updateLatestPackages(e.name)}},{key:"_updateLatestPackages",value:function(e){var t=this.packageMap;if(e&&t[e])t[e].latest=lively_lang.arr.last(semver.sort(Object.keys(t[e].versions),!0));else for(var r in t)t[r].latest=lively_lang.arr.last(semver.sort(Object.keys(t[r].versions),!0))}},{key:"_discoverPackagesIn",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var i,o,a,s,u,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isDirectory()){e.next=2;break}return e.abrupt("return",r);case 2:if(i=t.asFile().url,!r.hasOwnProperty(i)){e.next=5;break}return e.abrupt("return",r);case 5:return e.prev=5,o=c&&c[i]||new Package(this.System,i),e.next=9,o.tryToLoadPackageConfig();case 9:return a=e.sent,o.setConfig(a),r[i]={pkg:o,config:a,covered:n},this.System.debug&&(s=a.name,u=a.version,console.log("[lively.modules] package "+s+"@"+u+" discovered in "+t.url)),e.abrupt("return",r);case 16:return e.prev=16,e.t0=e.catch(5),e.abrupt("return",r);case 19:case"end":return e.stop()}},e,this,[[5,16]])}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_addToPackageMap",value:function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!t)throw new Error("Cannot add package without name");r||(r="0.0.0");var i=this.packageMap,o=i[t]||(i[t]={versions:{},latest:null});if(o.versions[r]){var a="Redefining version "+r+" of package "+e.url;if(!n)throw new Error(a+" not allowed");console.warn(a)}o.versions[r]=e}},{key:"_addPackageWithConfig",value:function(e,t,r){return(arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)||this._addPackageDir(r,"individualPackageDirs",!0),e.registerWithConfig(t),this._addToPackageMap(e,e.name,e.version),e}},{key:"_addPackageDir",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"individualPackageDirs",r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e=ensureResource(e).asDirectory(),("packageCollectionDirs"===t||"maybe packageCollectionDirs"===t)&&(this.coversDirectory(e)||"").includes("packageCollectionDirs"))return"packageCollectionDirs";var n=t,i=this[n].concat(e);return this[n]=r?lively_lang.arr.uniqBy(i,function(e,t){return e.equals(t)}):i,n}},{key:"byURL",get:function(){if(!this._byURL){this._byURL={};var e=!0,t=!1,r=void 0;try{for(var n,i=this.allPackages()[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;this._byURL[o.url]=o}}catch(e){t=!0,r=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}}return this._byURL}}]),e}(),Package=function(){function e(t,r,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};classCallCheck(this,e),this.System=t,this.url=r,this.registerProcess=null,this.map={},this.setConfig(o)}return createClass(e,null,[{key:"allPackages",value:function(e){return lively_lang.obj.values(PackageRegistry$$1.ofSystem(e).byURL)}},{key:"allPackageURLs",value:function(e){return PackageRegistry$$1.ofSystem(e).allPackageURLs()}},{key:"forModule",value:function(e,t){return this.forModuleId(e,t.id)}},{key:"forModuleId",value:function(e,t){var r=ModulePackageMapping.forSystem(e).getPackageURLForModuleId(t);return r?getPackage$1(e,r,!0):null}},{key:"fromJSON",value:function(t,r){return new e(t).fromJSON(r)}}]),createClass(e,[{key:"setConfig",value:function(e){this._name=e.name,this.version=e.version,this.dependencies=e.dependencies||{},this.devDependencies=e.devDependencies||{},this.main=e.main||"index.js",this.systemjs=e.systemjs,this.lively=e.lively}},{key:"toJSON",value:function(){var e=this.System,t=lively_lang.obj.select(this,["url","_name","version","map","dependencies","devDependencies","main","systemjs","lively"]);return t.url.startsWith(e.baseURL)&&(t.url=t.url.slice(e.baseURL.length).replace(/^\//,"")),t}},{key:"fromJSON",value:function(e){var t=this.System;return this.url=e.url,this._name=e._name,this.version=e.version,this.map=e.map||{},this.main=e.main,this.dependencies=e.dependencies||{},this.devDependencies=e.devDependencies||{},this.systemjs=e.systemjs,this.lively=e.lively,isURL(this.url)||(this.url=join(t.baseURL,this.url)),this.registerWithConfig(),this}},{key:"asSpec",value:function(){return _extends({},lively_lang.obj.select(this,["name","main","map","meta","url","address","version","lively"]),{modules:this.modules().map(function(e){return{name:e.id,deps:e.directRequirements().map(function(e){return e.id})}})})}},{key:"path",value:function(){var e=this.System.baseURL;return 0===this.url.indexOf(e)?this.url.slice(e.length):this.url}},{key:"modules",value:function(){var e=this.url,t=this.System;return ModulePackageMapping.forSystem(t).getModuleIdsForPackageURL(e).map(function(e){return module$2(t,e)})}},{key:"resources",value:function(){var t=asyncToGenerator(regeneratorRuntime.mark(function t(r){var n,i,o,a,s,u,c,l=this,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[".git","node_modules",".module_cache","lively.next-node_modules"];return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.System,i=this.url,o=e.allPackageURLs(n),a=o.filter(function(e){return e!==i&&!i.startsWith(e)}),t.next=6,lively_resources.resource(i).dirList("infinity",{exclude:f});case 6:return s=t.sent,u=s.filter(function(e){return!e.isDirectory()&&!a.some(function(t){return e.url.startsWith(t)})}).map(function(e){return e.url}),c=lively_lang.arr.pluck(this.modules(),"id"),r&&(u=u.filter(r)),t.abrupt("return",u.map(function(e){var t=e.replace(i,"").replace(/^\//,"");return{isLoaded:c.includes(e),url:e,nameInPackage:t,package:l}}));case 11:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"hasResource",value:function(e){this.System;var t=this.url;return(e.startsWith(t)?lively_resources.resource(e):lively_resources.resource(t).join(e)).exists()}},{key:"toString",value:function(){return"Package("+this.name+" - "+this.path()+"/)"}},{key:"mergeWithConfig",value:function(e){var t=e=_extends({},e),r=t.name,n=t.map;return r&&(delete e.name,this._name=r),n&&(delete e.map,Object.assign(this.map,n)),Object.assign(this,e),this}},{key:"addMapping",value:function(e,t){this.map[e]=t,this.System.config({packages:defineProperty({},this.url,{map:defineProperty({},e,t)})})}},{key:"tryToLoadPackageConfig",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.System,r=this.url,n=r+"/package.json",t.config({meta:defineProperty({},n,{format:"json"}),packages:defineProperty({},r,{meta:{"package.json":{format:"json"}}})}),t.debug&&console.log("[lively.modules package reading config] %s",n),e.prev=3,e.t0=t.get(n),e.t0){e.next=9;break}return e.next=8,t.import(n);case 8:e.t0=e.sent;case 9:return i=e.t0,lively_lang.arr.pushIfNotIncluded(t.packageConfigPaths,n),e.abrupt("return",i);case 14:return e.prev=14,e.t1=e.catch(3),console.log("[lively.modules package] Unable loading package config %s for package: ",n,e.t1),delete t.meta[n],o=r.split("/").slice(-1)[0],e.abrupt("return",{name:o});case 20:case"end":return e.stop()}},e,this,[[3,14]])}));return function(){return e.apply(this,arguments)}}()},{key:"import",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.register();case 2:return t=this.url,r=this.System,e.t0=module$2,e.t1=r,e.next=8,r.normalize(t);case 8:return e.t2=e.sent,n=(0,e.t0)(e.t1,e.t2),e.next=12,r.import(n.id);case 12:return i=e.sent,e.next=15,lively_lang.promise.waitFor(1e3,function(){return n.isLoaded()});case 15:return e.abrupt("return",i);case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"isRegistering",value:function(){return!!this.registerProcess}},{key:"register",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isRegistering()){e.next=2;break}return e.abrupt("return",this.registerProcess.promise);case 2:if(r=this.System,n=this.url,this.registerProcess=lively_lang.promise.deferred(),i=this.registerProcess.promise,r.debug&&console.log("[lively.modules package register] %s",n),e.prev=6,e.t0=t,e.t0){e.next=12;break}return e.next=11,this.tryToLoadPackageConfig();case 11:e.t0=e.sent;case 12:o=e.t0,a=this.registerWithConfig(o),this.registerProcess.resolve(o),e.next=21;break;case 17:throw e.prev=17,e.t1=e.catch(6),this.registerProcess.reject(e.t1),e.t1;case 21:return e.prev=21,delete this.registerProcess,e.finish(21);case 24:return e.abrupt("return",i);case 25:case"end":return e.stop()}},e,this,[[6,17,21,24]])}));return function(t){return e.apply(this,arguments)}}()},{key:"updateConfig",value:function(e){e=_extends({},this.runtimeConfig,e);var t=this.name,r=this.version,n=e,i=n.name,o=n.version;new PackageConfiguration(this).applyConfig(e),t===e.name&&r===e.version||(console.log("[lively.modules] Updating registry "+t+"@"+r+" => "+i+"@"+o),PackageRegistry$$1.ofSystem(this.System).updateNameAndVersionOf(this,t,r,i,o))}},{key:"registerWithConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.runtimeConfig,t=this.System,r=this.url,n=new PackageConfiguration(this).applyConfig(e),i=join(r,"package.json");return t.get(i)||t.set(i,t.newModule(_extends({},e,{default:e}))),lively_notifications.emit("lively.modules/packageregistered",{package:r},Date.now(),t),n}},{key:"remove",value:function(e){e=_extends({forgetEnv:!0,forgetDeps:!1,unloadModules:!0},e);var t=this.System,r=this.url;r=r.replace(/\/$/,""),e.unloadModules&&this.modules().forEach(function(t){return t.unload(e)}),PackageRegistry$$1.ofSystem(t).removePackage(this);var n=t.getConfig(),i=r+"/package.json";t.delete(String(i)),lively_lang.arr.remove(n.packageConfigPaths||[],i),t.config({meta:defineProperty({},i,{}),packages:defineProperty({},r,{}),packageConfigPaths:n.packageConfigPaths}),delete t.packages[r],lively_notifications.emit("lively.modules/packageremoved",{package:this.url},Date.now(),t)}},{key:"reload",value:function(e){var t=this.System,r=this.url,n=PackageRegistry$$1.ofSystem(t),i=n.coversDirectory(r);return this.remove(e),n.addPackageAt(r,i||"devPackageDirs",defineProperty({},r,this)),this.import()}},{key:"fork",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r||(r=lively_resources.resource(this.url).join("../"+t).withRelativePartsResolved().url),e.next=3,this.changeAddress(r,t,!1);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"rename",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=lively_resources.resource(this.url).join("../"+t).withRelativePartsResolved().url,e.next=3,this.changeAddress(r,t,!0);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"changeAddress",value:function(){var t=asyncToGenerator(regeneratorRuntime.mark(function t(r){var n,i,o,a,s,u,c,l,f,p,h,d,m,v,y,g,b,_,x,w,k,E,S,A,D,C,F,j,T,O,R,B=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=r.replace(/\/?/,""),n=this.System,i=this.url,o=this.name,a=this.version,t.next=7,this.runtimeConfig;case 7:return s=t.sent,u=lively_resources.resource(i).asDirectory(),c=new e(n,r),t.next=12,lively_resources.resource(r).asDirectory();case 12:return l=t.sent,s.name=B||this.name,f=PackageRegistry$$1.ofSystem(n),p=f.coversDirectory(i),ModulePackageMapping.forSystem(n).clearCache(),n.packages[i]&&(n.packages[r]=n.packages[i],P&&delete n.packages[i]),Object.assign(c,lively_lang.obj.select(this,["_name","map","config"])),t.next=20,l.ensureExistance();case 20:return t.next=22,this.resources(void 0,[]);case 22:t.t0=function(e){return e.url},h=t.sent.map(t.t0),d=this.modules(),m=!0,v=!1,y=void 0,t.prev=28,g=d[Symbol.iterator]();case 30:if(m=(b=g.next()).done){t.next=45;break}if(_=b.value,x=l.join(_.pathInPackage()).url,!P){t.next=38;break}return t.next=36,_.renameTo(x);case 36:t.next=40;break;case 38:return t.next=40,_.copyTo(x);case 40:(w=h.indexOf(_.id))>-1&&h.splice(w,1);case 42:m=!0,t.next=30;break;case 45:t.next=51;break;case 47:t.prev=47,t.t1=t.catch(28),v=!0,y=t.t1;case 51:t.prev=51,t.prev=52,!m&&g.return&&g.return();case 54:if(t.prev=54,!v){t.next=57;break}throw y;case 57:return t.finish(54);case 58:return t.finish(51);case 59:k=!0,E=!1,S=void 0,t.prev=62,A=h[Symbol.iterator]();case 64:if(k=(D=A.next()).done){t.next=72;break}return C=D.value,F=lively_resources.resource(C),j=F.relativePathFrom(u),t.next=69,F.copyTo(l.join(j));case 69:k=!0,t.next=64;break;case 72:t.next=78;break;case 74:t.prev=74,t.t2=t.catch(62),E=!0,S=t.t2;case 78:t.prev=78,t.prev=79,!k&&A.return&&A.return();case 81:if(t.prev=81,!E){t.next=84;break}throw S;case 84:return t.finish(81);case 85:return t.finish(78);case 86:if(!P){t.next=91;break}return t.next=89,this.remove({forgetEnv:!0,forgetDeps:!1});case 89:return t.next=91,u.remove();case 91:if(!B){t.next=112;break}return c.name=B,c.config.name=B,T=lively_resources.resource(r).join("package.json"),t.prev=95,t.next=98,T.exists();case 98:if(!t.sent){t.next=108;break}return t.next=101,T.readJson();case 101:if((O=t.sent).name!==this.name){t.next=106;break}return O.name=B,t.next=106,T.writeJson(O,!0);case 106:(R=n.get(T.url))&&n.set(T.url,n.newModule(_extends({},R,{name:B})));case 108:t.next=112;break;case 110:t.prev=110,t.t3=t.catch(95);case 112:return"individualPackageDirs"!==(p=p||"individualPackageDirs")&&"devPackageDirs"!==p||f._addPackageDir(r,p,!0),f._addPackageWithConfig(c,s,r,p),f.resetByURL(),f._updateLatestPackages(),t.abrupt("return",c);case 118:case"end":return t.stop()}},t,this,[[28,47,51,59],[52,,54,58],[62,74,78,86],[79,,81,85],[95,110]])}));return function(e){return t.apply(this,arguments)}}()},{key:"search",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!i.includeUnloaded){e.next=7;break}return e.next=3,this.resources(function(e){return e.endsWith(".js")},[".git","node_modules","dist",".module_cache","lively.next-node_modules"]);case 3:e.t1=function(e){var t=e.url;return module$2(n.System,t)},e.t0=e.sent.map(e.t1),e.next=8;break;case 7:e.t0=this.modules().filter(function(e){return e.isLoaded()});case 8:return r=e.t0,e.abrupt("return",Promise.all(r.map(function(e){return e.search(t,i).catch(function(t){return console.error("Error searching module "+e.name+":\n"+t.stack),[]})})).then(function(e){return lively_lang.arr.flatten(e,1)}));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"isPackage",get:function(){return!0}},{key:"name",get:function(){if(this._name)return this._name;var e=this.System.get(this.url+"/package.json");return e&&e.name?e.name:lively_lang.arr.last(this.url.replace(/[\/]+$/,"").split("/"))},set:function(e){return this._name=e}},{key:"nameAndVersion",get:function(){return this.name+"@"+this.version}},{key:"address",get:function(){return this.url},set:function(e){return this.url=e}},{key:"runtimeConfig",get:function(){var e=this.name,t=this.version,r=this.dependencies,n=this.devDependencies,i=this.main,o=this.systemjs,a=this.lively,s={name:e,version:t,dependencies:r||{},devDependencies:n||{}};return i&&(s.main=i),o&&(s.systemjs=o),a&&(s.lively=a),s}}]),e}(),ImportInjector=function(){function e(t,r,n,i,o,a,s){classCallCheck(this,e),this.System=t,this.intoModuleId=r,this.intoPackage=n,this.intoModuleSource=i,this.fromModuleId=o.moduleId,this.importData=o,this.alias=a,this.parsed=s||lively_ast.fuzzyParse(i)}return createClass(e,null,[{key:"run",value:function(e,t,r,n,i){return new this(e,t,r,n,i,arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0).run()}}]),createClass(e,[{key:"run",value:function(){var e=this.generateImportStatement(),t=e.standaloneImport,r=e.importedVarName,n=this.existingImportsOfFromModule(),i=n.imports,o=n.importsOfFromModule,a=n.importsOfVar;if(o=this.importsToBeReused(o,a,e),a.length)return{status:"not modified",newSource:this.intoModuleSource,generated:"",importedVarName:"",standaloneImport:t,from:a[0].start,to:a[0].end};if(o.length){var s=this.modifyExistingImport(o,t);if(s)return s}var u=lively_lang.arr.last(i),c=u?u.end:0;return this.insertNewImport(o,t,r,c)}},{key:"importsToBeReused",value:function(e,t,r){return r.isDefault&&(e=e.filter(function(e){return!e.specifiers.some(function(e){return"ImportDefaultSpecifier"==e.type})})),e}},{key:"generateImportStatement",value:function(){var e=this.intoModuleId,t=this.fromModuleId,r=this.importData,n=this.intoPackage,i=this.alias,o="default"===r.exported,a=i||(o?r.local:r.exported),s=!o&&r.exported!==a,u=n&&n.name,c=t,l=r.packageName,f=r.pathInPackage;if(r.isMain)c=l;else if(u===l)try{(c=lively_resources.resource(t).relativePathFrom(lively_resources.resource(e))).startsWith(".")||(c="./"+c)}catch(e){l&&"no group"!==l&&f&&(c=l+"/"+f)}else l&&"no group"!==l&&f&&(c=l+"/"+f);return{isDefault:o,standaloneImport:o?"import "+a+' from "'+c+'";':"import { "+r.exported+(s?" as "+a:"")+' } from "'+c+'";',importedVarName:a}}},{key:"existingImportsOfFromModule",value:function(){var e=this.System,t=this.fromModuleId,r=this.intoModuleId,n=this.importData,i=n.exported,o=n.local,a=this.parsed,s=this.alias,u="default"===i,c=a.body.filter(function(e){return"ImportDeclaration"===e.type}),l=u?s||o:s||i,f=c.filter(function(n){if(!n.source||"string"!=typeof n.source.value)return null;var i=e.decanonicalize(n.source.value,r);return t===i});return{imports:c,importsOfFromModule:f,importsOfVar:f.filter(function(e){return(e.specifiers||[]).some(function(e){return u?"ImportDefaultSpecifier"===e.type&&e.local.name===l:lively_lang.Path("imported.name").get(e)===i&&lively_lang.Path("local.name").get(e)===l})})}}},{key:"modifyExistingImport",value:function(e,t){var r=lively_lang.arr.flatmap(e,function(e){return e.specifiers||[]});if(!r.length)return null;var n=lively_lang.arr.partition(r,function(e){return"ImportDefaultSpecifier"===e.type}),i=slicedToArray(n,2),o=slicedToArray(i[0],1)[0],a=slicedToArray(i[1],1)[0],s=this.alias,u=this.intoModuleSource,c=this.importData,l=c.exported,f=c.local,p="default"===l;if(p?console.assert(!!a,"no ImportSpecifier found"):console.assert(a||o,"at least one kine of specifier is expected"),p){if((v=u.slice(0,a.start).lastIndexOf("{")-1)<0)return null;var h=(s||f)+",",d=u.slice(0,v),m=u.slice(v);return d.endsWith(" ")&&d.endsWith("\n")||(h=" "+h),m.startsWith(" ")||(h+=" "),{status:"modified",newSource:""+d+h+m,generated:h,standaloneImport:t,importedVarName:s||f,from:v,to:v+h.length}}var v=a?a.end:o.end,y=s&&s!==l,g=y?l+" as "+s:l;return h=a?", "+g:", { "+g+" }",{status:"modified",newSource:""+u.slice(0,v)+h+u.slice(v),generated:h,standaloneImport:t,importedVarName:y?s:l,from:v,to:v+h.length}}},{key:"insertNewImport",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e&&e.length&&(n=lively_lang.arr.last(e).end);var i=this.intoModuleSource,o=i.slice(0,n),a=i.slice(n),s=t;return o.length&&!o.endsWith("\n")&&(s="\n"+s),a.length&&!a.startsWith("\n")&&(s+="\n"),{status:"modified",newSource:o+s+a,generated:s,standaloneImport:t,importedVarName:r,from:n,to:n+s.length}}}]),e}(),GlobalInjector=function(){function e(){classCallCheck(this,e)}return createClass(e,null,[{key:"run",value:function(e,t,r){var n=r||lively_ast.fuzzyParse(e,{withComments:!0}),i=n.comments?n.comments.find(function(e){return e.isBlock&&e.text.startsWith("global")}):null,o=i?i.text.replace(/^global\s*/,"").split(",").map(function(e){return e.trim()}).filter(Boolean):[],a=t.filter(function(e){return!o.includes(e)});if(!a.length)return{status:"not modified",newSource:e,generated:"",from:0,to:0};if(!i){var s="/*global "+a.join(",")+"*/\n";return{status:"modified",newSource:s+e,generated:s,from:0,to:s.length}}var u=i.start+"/*".length+i.text.length,c=a.join(",");o.length?c=","+c:i.text.startsWith("global ")||(c=" "+c);var l=u+c.length;return{status:"modified",newSource:e.slice(0,u)+c+e.slice(u),generated:c,from:u,to:l}}}]),e}(),ImportRemover=function(){function e(){classCallCheck(this,e)}return createClass(e,null,[{key:"removeImports",value:function(e,t,r){var n=r||lively_ast.fuzzyParse(e),i=lively_lang.arr.flatmap(n.body,function(e){return"ImportDeclaration"===e.type&&e.specifiers.length?e.specifiers.map(function(t){return{local:t.local,importStmt:e}}):[]}).filter(function(e){return t.some(function(t){return t.local===e.local.name})}),o=i.map(function(e){return{local:e.local.name,from:e.importStmt.source.value}}),a=lively_lang.arr.uniq(i.map(function(e){var t=e.importStmt.specifiers.find(function(t){return e.local===t.local});return lively_lang.arr.remove(e.importStmt.specifiers,t),e.importStmt})).slice().reverse().reduce(function(e,t){var r=e.source,n=e.changes,i=t.start,o=t.end,a=t.specifiers,s=r.slice(0,i),u=r.slice(o),c=r.slice(i,o),l=a.length?lively_ast.stringify(t):"";return l&&l.includes("\n")&&!c.includes("\n")&&(l=l.replace(/\s+/g," ")),r=s+l+u,n=n.concat({replacement:l,start:i,end:o}),{source:r,changes:n}},{source:e,changes:[]});return _extends({},a,{removedImports:o})}},{key:"findUnusedImports",value:function(e){var t="string"==typeof e?lively_ast.fuzzyParse(e):e,r=lively_lang.arr.flatmap(t.body,function(e){return"ImportDeclaration"===e.type&&e.specifiers.length?e.specifiers.map(function(t){return{local:t.local,from:e.source?e.source.value:"",importStmt:e}}):[]}),n=r.map(function(e){return e.local}),i=lively_ast.query.resolveReferences(lively_ast.query.scopes(t)),o=Array.from(i.resolvedRefMap.keys()).filter(function(e){return!n.includes(e)}),a=lively_lang.arr.uniq(o.map(function(e){return e.name}));return r.filter(function(e){return!a.includes(e.local.name)}).map(function(e){return _extends({},e,{local:e.local.name})})}},{key:"removeUnusedImports",value:function(e){var t=lively_ast.fuzzyParse(e);return this.removeImports(e,this.findUnusedImports(t),t)}}]),e}(),detectModuleFormat=function(){var e=/['"]format (esm|es6)['"];/,t=/['"]format cjs['"];/,r=/(^\s*|[}\);\n]\s*)(import\s+(['"]|(\*\s+as\s+)?[^"'\(\)\n;]+\s+from\s+['"]|\{)|export\s+\*\s+from\s+["']|export\s+(\{|default|function|class|var|const|let|async\s+function))/;return function(n,i){return i&&i.format?("es6"==i.format&&i.format,i.format):e.test(n.slice(0,5e3))||!t.test(n.slice(0,5e3))&&r.test(n)?"esm":"global"}}(),doesModuleExist$1=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=livelySystemEnv(t),i=a?r:t.normalizeSync(r),!isModuleLoaded$1(t,i,!0)){e.next=3;break}return e.abrupt("return",!0);case 3:if((o=Package.forModuleId(t,i))&&"no group"!==o.name){e.next=8;break}e.t0=t.resource(i).exists(),e.next=11;break;case 8:return e.next=10,o.hasResource(i);case 10:e.t0=e.sent;case 11:return e.abrupt("return",e.t0);case 12:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),globalProps={initialized:!1,descriptors:{}},ModuleInterface=function(){function e(t,r){var n=this;if(classCallCheck(this,e),!isURL(r)&&!/^@/.test(r))throw new Error("ModuleInterface constructor called with "+r+" that does not seem to be a fully normalized module id.");this.System=t,this.id=r,this.recorderName="__lvVarRecorder",this.sourceAccessorName="__lvOriginalCode",this._recorder=null,this._source=null,this._ast=null,this._scope=null,this._observersOfTopLevelState=[],this._evaluationsInProgress=0,this._evalId=1,this.createdAt=this.lastModifiedAt=new Date,lively_notifications.subscribe("lively.modules/modulechanged",function(e){e.module===n.id&&n.reset()})}return createClass(e,[{key:"fullName",value:function(){return this.id}},{key:"shortName",value:function(){return this.package().name+"/"+this.pathInPackage()}},{key:"source",value:function(){var e=this;return"@empty"===this.id?Promise.resolve(""):this._source?Promise.resolve(this._source):this.System.resource(this.id).read().then(function(t){return e._source=t})}},{key:"setSource",value:function(e){this._source!==e&&(this.reset(),this._source=e)}},{key:"ast",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._ast){e.next=2;break}return e.abrupt("return",this._ast);case 2:return e.t0=lively_ast.parse,e.next=5,this.source();case 5:return e.t1=e.sent,e.abrupt("return",this._ast=(0,e.t0)(e.t1));case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"scope",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._scope){e.next=2;break}return e.abrupt("return",this._scope);case 2:return e.next=4,this.ast();case 4:return t=e.sent,e.abrupt("return",this._scope=lively_ast.query.topLevelDeclsAndRefs(t).scope);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"resolvedScope",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=lively_ast.query,e.next=3,this.scope();case 3:return e.t1=e.sent,e.abrupt("return",this._scope=e.t0.resolveReferences.call(e.t0,e.t1));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"metadata",value:function(){var e=this.System.loads?this.System.loads[this.id]:null;return e?e.metadata:null}},{key:"addMetadata",value:function(e){var t=this.System,r=this.id,n=this.metadata(),i=n?Object.assign(n,e):e;return t.config({meta:defineProperty({},r,i)}),t.meta[r]}},{key:"format",value:function(){var e=this.metadata();return e&&e.format?e.format:this._source?detectModuleFormat(this._source):"global"}},{key:"setFormat",value:function(e){return this.addMetadata({format:e})}},{key:"reset",value:function(){this._source=null,this._ast=null,this._scope=null}},{key:"get",value:function(){var e=this.id;return this.System.get(e)}},{key:"load",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.id,n=this.System,t&&this.addMetadata(t),e.t0=n.get(r),e.t0){e.next=7;break}return e.next=6,n.import(r);case 6:e.t0=e.sent;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"isLoaded",value:function(){return!!this.System.get(this.id)}},{key:"unloadEnv",value:function(){this._recorder=null,this._observersOfTopLevelState=[],delete livelySystemEnv(this.System).loadedModules[this.id]}},{key:"unloadDeps",value:function(e){var t=this;e=lively_lang.obj.merge({forgetDeps:!0,forgetEnv:!0},e),this.dependents().forEach(function(r){t.System.delete(r.id),t.System.loads&&delete t.System.loads[r.id],e.forgetEnv&&r.unloadEnv()})}},{key:"unload",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=_extends({reset:!0,forgetDeps:!0,forgetEnv:!0},t),r=this.System,n=this.id,t.reset&&this.reset(),t.forgetDeps&&this.unloadDeps(t),this.System.delete(n),r.loads&&delete r.loads[n],r.meta&&delete r.meta[n],t.forgetEnv&&this.unloadEnv(),!(i=r._livelyModulesTranslationCache)){e.next=12;break}return e.next=12,i.deleteCachedData(n);case 12:lively_notifications.emit("lively.modules/moduleunloaded",{module:this.id},Date.now(),this.System);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"reload",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=lively_lang.obj.merge({reloadDeps:!0,resetEnv:!0},t),r=[this],t.reloadDeps&&(r=this.dependents().concat(r)),e.next=5,this.unload({forgetDeps:t.reloadDeps,forgetEnv:t.resetEnv});case 5:return e.next=7,Promise.all(r.map(function(e){return e.id!==n.id&&e.load()}));case 7:return e.next=9,this.load();case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"copyTo",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this.System.resource(t),e.next=3,this.source();case 3:return e.t1=e.sent,e.next=6,e.t0.write.call(e.t0,e.t1);case 6:return r=this.System,n=this.recorderName,i=this.sourceAccessorName,o=this._recorder,a=this._source,s=this._ast,u=this._scope,c=this._observersOfTopLevelState,l=module$2(r,t),f=lively_lang.obj.select(this,["_observersOfTopLevelState","_scope","_ast","_source","_recorder","sourceAccessorName","recorderName"]),Object.assign(l,f),r.set(t,r.newModule(r.get(this.id))),e.abrupt("return",l);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"renameTo",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.unload,n=void 0===r||r,i=s.removeFile,o=void 0===i||i,e.next=6,this.copyTo(t);case 6:if(a=e.sent,!n){e.next=10;break}return e.next=10,this.unload({reset:!0,forgetDeps:!1,forgetEnv:!0});case 10:if(!o){e.next=13;break}return e.next=13,this.System.resource(this.id).remove();case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"whenLoaded",value:function(e){if(this.isLoaded())try{e(this)}catch(e){console.error(e)}else livelySystemEnv(this.System).onLoadCallbacks.push({moduleName:this.id,resolved:!0,callback:e})}},{key:"changeSourceAction",value:function(e){var t=this;return Promise.resolve(this.source()).then(function(t){return e(t)}).then(function(e){return t.changeSource(e)})}},{key:"changeSource",value:function(e,t){t=_extends({doSave:!0,doEval:!0},t);var r=this.System,n=this.id,i=this.format(),o=void 0;return this.reset(),this.lastModifiedAt=new Date,Promise.all([t.doSave&&this.System.resource(n).write(e),t.doEval&&moduleSourceChange$1(r,n,e,i,t).then(function(e){return o=e})]).then(function(){return o})}},{key:"addDependencyToModuleRecord",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=this.record(),i=e.record();if(n&&i){var o,a=n.dependencies.some(function(t,r){if(t)return o=r,t&&t.name===e.id});a?i!==n.dependencies[o]&&n.dependencies.splice(o,1,i):n.dependencies.push(i),a&&n.setters[o]||(n.setters[a?o:n.dependencies.length-1]=r);var s;i.importers.some(function(e,r){if(e)return s=r,e&&e.name===t.id})?n!==i.importers[s]&&i.importers.splice(s,1,n):i.importers.push(n)}}},{key:"dependents",value:function(){var e=this;return lively_lang.graph.hull(lively_lang.graph.invert(computeRequireMap(this.System)),this.id).map(function(t){return module$2(e.System,t)})}},{key:"requirements",value:function(){var e=this;return lively_lang.graph.hull(computeRequireMap(this.System),this.id).map(function(t){return module$2(e.System,t)})}},{key:"directRequirements",value:function(){var e=this,t=(this.record()||{}).dependencies||[];return lively_lang.arr.pluck(t.filter(Boolean),"name").map(function(t){return module$2(e.System,t)})}},{key:"define",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments[3],i=this.System,o=this.id,a=this.recorder,s=Symbol.for("lively-object-meta"),u=Symbol.for("lively-module-meta");if("function"!=typeof t||!n||"function"!==n.kind&&"class"!==n.kind||(t[s]=n),t&&t[s]&&!t[u]){var c=this.pathInPackage(),l=this.package();t[u]={package:l?{name:l.name,version:l.version}:{},pathInPackage:c}}return a[e]=t,scheduleModuleExportsChange(i,o,e,t,!1),this.notifyTopLevelObservers(e),(r=r||!this.isEvalutionInProgress())&&runScheduledExportChanges(i,o),t}},{key:"undefine",value:function(e){delete this.recorder[e]}},{key:"subscribeToToplevelDefinitionChanges",value:function(e){return this._observersOfTopLevelState.push(e),e}},{key:"notifyTopLevelObservers",value:function(e){var t=["createOrExtendES6ClassForLively","lively.capturing-declaration-wrapper"],r=this.recorder;lively_lang.arr.include(t,e)||this._observersOfTopLevelState.forEach(function(t){return t(e,r[e])})}},{key:"unsubscribeFromToplevelDefinitionChanges",value:function(e){this._observersOfTopLevelState="string"==typeof e?this._observersOfTopLevelState.filter(function(t){return t.name!==e}):this._observersOfTopLevelState.filter(function(t){return t!==e})}},{key:"evaluationStart",value:function(){this._evaluationsInProgress++}},{key:"evaluationEnd",value:function(){this._evaluationsInProgress--,runScheduledExportChanges(this.System,this.id)}},{key:"nextEvalId",value:function(){return this._evalId++}},{key:"isEvalutionInProgress",value:function(){return this._evaluationsInProgress>0}},{key:"env",value:function(){return this}},{key:"package",value:function(){return Package.forModule(this.System,this)}},{key:"pathInPackage",value:function(){var e=this.package();return e&&0===this.id.indexOf(e.address)?this.id.slice(e.address.length).replace(/^\//,""):this.id}},{key:"imports",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=lively_ast.query,e.next=3,this.scope();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.imports.call(e.t0,e.t1));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"exports",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=lively_ast.query,e.next=3,this.scope();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.exports.call(e.t0,e.t1));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"addImports",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l,f,p,h,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.source();case 2:for(r=e.sent,n=!0,i=!1,o=void 0,e.prev=6,a=t[Symbol.iterator]();!(n=(s=a.next()).done);n=!0)u=s.value,c=module$2(this.System,u.from||u.moduleId),l=c.package(),f={exported:u.exported||u.local,moduleId:c.id,packageName:l.name,packageURL:l.url,pathInPackage:c.pathInPackage()},p=u.local,h=ImportInjector.run(this.System,this.id,this.package(),r,f,p),r=h.newSource,d=h.standAloneImport;e.next=14;break;case 10:e.prev=10,e.t0=e.catch(6),i=!0,o=e.t0;case 14:e.prev=14,e.prev=15,!n&&a.return&&a.return();case 17:if(e.prev=17,!i){e.next=20;break}throw o;case 20:return e.finish(17);case 21:return e.finish(14);case 22:return e.next=24,this.changeSource(r);case 24:case"end":return e.stop()}},e,this,[[6,10,14,22],[15,,17,21]])}));return function(t){return e.apply(this,arguments)}}()},{key:"addGlobalDeclaration",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.source();case 2:if(r=e.sent,n=GlobalInjector.run(r,t),i=n.status,o=n.newSource,!(a="modified"===i)){e.next=10;break}return e.next=10,this.changeSource(o);case 10:return e.abrupt("return",a);case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"removeImports",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.source();case 4:return r=e.sent,e.next=7,ImportRemover.removeImports(r,t);case 7:return n=e.sent,i=n.source,o=n.removedImports,e.next=12,this.changeSource(i);case 12:o.forEach(function(e){return delete a.recorder[e.local]});case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_localDeclForRefAt",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolvedScope();case 2:return r=e.sent,n=lively_ast.query.refWithDeclAt(t,r),e.abrupt("return",n&&{decl:n.decl,id:n.declId,declModule:this});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_localDeclForName",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolvedScope();case 2:r=e.sent,n=void 0,i=!0,o=!1,a=void 0,e.prev=7,s=r.resolvedRefMap.values()[Symbol.iterator]();case 9:if(i=(u=s.next()).done){e.next=18;break}if(c=u.value,l=c.ref.name,t!==l){e.next=15;break}return n=c,e.abrupt("break",18);case 15:i=!0,e.next=9;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(7),o=!0,a=e.t0;case 24:e.prev=24,e.prev=25,!i&&s.return&&s.return();case 27:if(e.prev=27,!o){e.next=30;break}throw a;case 30:return e.finish(27);case 31:return e.finish(24);case 32:return e.abrupt("return",n&&{decl:n.decl,id:n.declId,declModule:this});case 33:case"end":return e.stop()}},e,this,[[7,20,24,32],[25,,27,31]])}));return function(t){return e.apply(this,arguments)}}()},{key:"_importForNSRefAt",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolvedScope();case 2:if(r=e.sent,n=r.node,!((i=lively_ast.query.nodesAtIndex(n,t)).length<2)){e.next=7;break}return e.abrupt("return",[null,null]);case 7:if(o=i[i.length-1],a=i[i.length-2],"Identifier"==o.type&&"MemberExpression"==a.type&&!a.computed&&"Identifier"===a.object.type){e.next=10;break}return e.abrupt("return",[null,null]);case 10:if(s=r.resolvedRefMap.get(a.object)||{},(u=s.decl)&&"ImportDeclaration"===u.type){e.next=13;break}return e.abrupt("return",[null,null]);case 13:return c=a.object.name,l=u.specifiers.find(function(e){return e.local.name===c}),e.abrupt("return","ImportNamespaceSpecifier"!==l.type?[null,null]:[u,l.local,o.name]);case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_resolveImportedDecl",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",[]);case 2:return r=t.id,n=r.start,i=r.name,o=r.type,e.next=8,this.imports();case 8:if(a=e.sent,!(s=a.find(function(e){return e.local==i}))){e.next=17;break}return u=module$2(this.System,s.fromModule,this.id),e.t0=[t],e.next=15,u.bindingPathForExport(s.imported);case 15:return e.t1=e.sent,e.abrupt("return",e.t0.concat.call(e.t0,e.t1));case 17:return e.abrupt("return",[t]);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"bindingPathFor",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._localDeclForName(t);case 2:if(!(r=e.sent)){e.next=7;break}return e.next=6,this._resolveImportedDecl(r);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"bindingPathForExport",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolvedScope();case 2:return e.next=4,this.exports();case 4:if(r=e.sent,!(n=r.find(function(e){return e.exported===t})).fromModule){e.next=17;break}return i=module$2(this.System,n.fromModule,this.id),o={decl:n.node,id:n.declId},o.declModule=this,e.t0=[o],e.next=13,i.bindingPathForExport(n.imported);case 13:return e.t1=e.sent,e.abrupt("return",e.t0.concat.call(e.t0,e.t1));case 17:return e.abrupt("return",this._resolveImportedDecl({decl:n.decl,id:n.declId,declModule:n&&n.decl?this:null}));case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"bindingPathForRefAt",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._localDeclForRefAt(t);case 2:if(!(r=e.sent)){e.next=7;break}return e.next=6,this._resolveImportedDecl(r);case 6:return e.abrupt("return",e.sent);case 7:return e.next=9,this._importForNSRefAt(t);case 9:if(n=e.sent,i=slicedToArray(n,3),o=i[0],a=i[1],s=i[2],o){e.next=16;break}return e.abrupt("return",[]);case 16:return u=module$2(this.System,o.source.value,this.id),e.t0=[{decl:o,declModule:this,id:a}],e.next=20,u.bindingPathForExport(s);case 20:return e.t1=e.sent,e.abrupt("return",e.t0.concat.call(e.t0,e.t1));case 22:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"definitionForRefAt",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bindingPathForRefAt(t);case 2:return r=e.sent,e.abrupt("return",r.length<1?null:r[r.length-1].decl);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"ensureRecord",value:function(){var e=this.System,t=e._loader.moduleRecords;return t[this.id]?t[this.id]:t[this.id]={name:this.id,exports:e.newModule({}),dependencies:[],importers:[],setters:[]}}},{key:"record",value:function(){var e=this.System._loader.moduleRecords[this.id];return e?(e.hasOwnProperty("__lively_modules__")||(e.__lively_modules__={evalOnlyExport:{}}),e):null}},{key:"updateRecord",value:function(e){var t=this.record();if(!t)throw new Error("es6 environment global of "+this.id+": module not loaded, cannot get export object!");t.locked=!0;try{return e(t)}finally{t.locked=!1}}},{key:"search",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,s,u,c,l,f,p,h,d,m,v,y=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=_extends({excludedModules:[]},r)).excludedModules.some(function(e){return"string"==typeof e?e===y.id:e instanceof RegExp?e.test(y.id):"function"==typeof e&&e(y.id)})){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,this.source();case 5:for(n=e.sent,i=void 0,t instanceof RegExp?(o="g",t.ignoreCase&&(o+="i"),t.multiline&&(o+="m"),i=RegExp(t.source,o)):i=RegExp(t,"g"),a=void 0,s=[];null!==(a=i.exec(n));)s.push([a.index,a[0].length]);u=0,c=0,l=1,f=0;case 11:if(!(u<n.length&&c<s.length)){e.next=24;break}if("\n"==n[u]&&(l++,f=u+1),p=slicedToArray(s[c],2),h=p[0],d=p[1],u===h){e.next=16;break}return e.abrupt("continue",21);case 16:-1===(m=n.slice(f).indexOf("\n"))?m=n.length:m+=f,v=this.package(),s[c]={moduleId:this.id,packageName:v?v.name:void 0,pathInPackage:v?this.pathInPackage():this.id,isLoaded:this.isLoaded(),length:d,line:l,column:u-f,lineString:m-f>1e3?"..."+n.slice(u-10,u+100)+"...":n.slice(f,m)},c++;case 21:u++,e.next=11;break;case 24:return e.abrupt("return",s);case 25:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"toString",value:function(){return"module("+this.id+")"}},{key:"dontTransform",get:function(){return[this.recorderName,this.sourceAccessorName,"global","self","_moduleExport","_moduleImport","localStorage","prompt","alert","fetch","getComputedStyle"].concat(lively_ast.query.knownGlobals)}},{key:"recorder",set:function(e){return this._recorder=e},get:function(){var e;if(this._recorder)return this._recorder;var t=this.System,r=this;if(!globalProps.initialized){globalProps.initialized=!0;for(var n in t.global)t.global.__lookupGetter__(n)&&(globalProps.descriptors[n]={value:void 0,configurable:!0,writable:!0})}var i={};if(t.get("@system-env").node){var o=_require.bind(null,this);o.resolve=_resolve.bind(null,this),i.require={configurable:!0,writable:!0,value:o}}return this._recorder=Object.create(t.global,_extends({},globalProps.descriptors,i,(e={System:{configurable:!0,writable:!0,value:t},__currentLivelyModule:{value:r}},defineProperty(e,lively_vm.defaultClassToFunctionConverterName,{configurable:!0,writable:!0,value:lively_classes.runtime.initializeClass}),defineProperty(e,this.varDefinitionCallbackName,{value:function(e,t,n,i,o){return o=o||{},o.kind=t,r.define(e,n,!1,o)}}),defineProperty(e,"_moduleExport",{value:function(e,n){scheduleModuleExportsChange(t,r.id,e,n,!0)}}),defineProperty(e,"_moduleImport",{value:function(e,n){var i=t.decanonicalize(e,r.id),o=t.get(i);if(o)return r.addDependencyToModuleRecord(module$2(t,i),function(e){return Object.assign(r.recorder,e)}),void 0==n?o:(o.hasOwnProperty(n)||console.warn("import from "+o+": Has no export "+n+"!"),o[n]);console.warn("import of "+n+" failed: "+e+" (tried as "+r.id+") is not loaded!")}}),e)))}},{key:"varDefinitionCallbackName",get:function(){return"defVar_"+this.id}}]),e}(),fetchResource=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this,i=n.resource(r.name)){e.next=3;break}return e.abrupt("return",t(r));case 3:return e.prev=3,e.next=6,i.read();case 6:o=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),a=e.t0;case 12:if(!a||!n.get("@system-env").browser){e.next=24;break}if(s=i.url.startsWith("http"),u=!i.url.startsWith(document.location.origin),!s||!u){e.next=24;break}return e.prev=15,e.next=18,i.makeProxied().read();case 18:o=e.sent,a=null,e.next=24;break;case 22:e.prev=22,e.t1=e.catch(15);case 24:if(!a){e.next=26;break}throw a;case 26:return e.abrupt("return",o);case 27:case"end":return e.stop()}},e,this,[[3,9],[15,22]])}));return function(t,r){return e.apply(this,arguments)}}(),livelyURLRe=/^lively:\/\/([^\/]+)\/(.*)$/,isNode=System.get("@system-env").node,initialSystem=initialSystem||System,SystemClass=System.constructor;SystemClass.systems||(SystemClass.systems={});var defaultOptions={notificationLimit:null},dotSlashStartRe=/^\.?\//,trailingSlashRe=/\/$/,jsExtRe=/\.js$/,jsonJsExtRe=/\.json\.js$/i,doubleSlashRe=/.\/{2,}/g,ExportLookup=function(){function e(t){classCallCheck(this,e),this.System=t,this.subscribeToSystemChanges()}return createClass(e,null,[{key:"forSystem",value:function(e){this._forSystemMap||(this._forSystemMap=new WeakMap);var t=this._forSystemMap.get(e);return t||(t=new this(e),this._forSystemMap.set(e,t),t)}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:System,t=arguments[1];return this.forSystem(e).systemExports(t)}},{key:"findExportOfValue",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:System;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.run(n);case 2:return r=e.sent,e.abrupt("return",r.find(function(e){var r=e.local,i=e.moduleId,o=module$2(n,i),a=o.recorder||n.get(o.id)||{};try{return a[r]===t}catch(e){return!1}}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),createClass(e,[{key:"subscribeToSystemChanges",value:function(){var e=this;if(!this._notificationHandlers){var t=this.System;this._notificationHandlers=[lively_notifications.subscribe("lively.modules/moduleloaded",function(t){return e.clearCacheFor(t.module)},t),lively_notifications.subscribe("lively.modules/modulechanged",function(t){return e.clearCacheFor(t.module)},t),lively_notifications.subscribe("lively.vm/doitresult",function(t){return e.clearCacheFor(t.targetModule)},t)]}}},{key:"unsubscribeFromSystemChanges",value:function(){if(this._notificationHandlers){var e=this.System;lively_notifications.unsubscribe("lively.modules/moduleloaded",this._notificationHandlers[0],e),lively_notifications.unsubscribe("lively.modules/modulechanged",this._notificationHandlers[1],e),lively_notifications.unsubscribe("lively.vm/doitresult",this._notificationHandlers[2],e),this._notificationHandlers=null}}},{key:"clearCacheFor",value:function(e){this.exportByModuleCache[e]=null}},{key:"systemExports",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.rawExportsByModule(t);case 2:return r=e.sent,Object.keys(r).forEach(function(e){return n.resolveExportsOfModule(e,r)}),e.abrupt("return",lively_lang.arr.flatmap(Object.keys(r),function(e){return r[e].resolvedExports||r[e].rawExports}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"rawExportsByModule",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},r=this.System,n=r.get("@lively-env")||{},i=Object.keys(n.loadedModules||{}),o=this.exportByModuleCache,a={},s=function(e){e%50<1&&t.progress.step("Scanning ...",e/i.length)},e.next=4,Promise.all(i.map(function(e,r){t.progress&&s(r),u.rawExportsOfModule(e,t,a).then(function(t){return t?a[e]=t:null})}));case 4:return e.abrupt("return",a);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"rawExportsOfModule",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l,f,p,h,d,m,v,y,g,b,_,x,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.System,n=this.exportByModuleCache,i=w.excludedPackages||[],o=w.excludedURLs||(w.excludedURLs=i.filter(function(e){return"string"==typeof e})),a=w.excludeFns||(w.excludeFns=i.filter(function(e){return"function"==typeof e})),s=w.excludedPackageURLs||(w.excludedPackageURLs=o.concat(o.map(function(e){return r.decanonicalize(e.replace(/\/?$/,"/")).replace(/\/$/,"")}))),u=w.livelyEnv||(w.livelyEnv=r.get("@lively-env")||{}),c=w.modes||(w.modes=Object.keys(u.loadedModules||{})),!n[t]){e.next=4;break}return l=n[t].rawExports,e.abrupt("return",s.includes(l.packageURL)||a.some(function(e){return e(l.packageURL)})?null:n[t]);case 4:if(f=module$2(r,t),p=f.pathInPackage(),h=f.package(),d=h&&h.main&&p===h.main,m=h?h.url:"",v=h?h.name:"",y=h?h.version:"",g={moduleId:t,isMain:d,pathInPackage:p,packageName:v,packageURL:m,packageVersion:y,exports:[]},!s.includes(m)&&!a.some(function(e){return e(m)})){e.next=7;break}return e.abrupt("return",null);case 7:if(e.prev=7,b=f.format(),!["register","es6","esm"].includes(b)){e.next=15;break}return e.next=12,f.exports();case 12:g.exports=e.sent,e.next=27;break;case 15:return e.next=17,f.load();case 17:_=e.sent,g.exports=[],e.t0=regeneratorRuntime.keys(_);case 20:if((e.t1=e.t0()).done){e.next=27;break}if("__useDefault"!==(x=e.t1.value)&&"default"!==x){e.next=24;break}return e.abrupt("continue",20);case 24:g.exports.push({exported:x,local:x,type:"id"}),e.next=20;break;case 27:e.next=32;break;case 29:e.prev=29,e.t2=e.catch(7),g.error=e.t2;case 32:return e.abrupt("return",n[t]={rawExports:g});case 33:case"end":return e.stop()}},e,this,[[7,29]])}));return function(t){return e.apply(this,arguments)}}()},{key:"resolveExportsOfModule",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!n[e]){n[e]=!0;var i=t[e];if(i&&!i.resolvedExports){var o=this.System,a=lively_lang.obj.select(i.rawExports,["moduleId","isMain","packageName","packageURL","packageVersion","pathInPackage"]);i.resolvedExports=lively_lang.arr.flatmap(i.rawExports.exports,function(i){var s=i.type,u=i.exported,c=i.local,l=i.fromModule;if("all"!==s)return[_extends({},a,{type:s,exported:u,local:c,fromModule:l})];var f=o.decanonicalize(l,e);return r.resolveExportsOfModule(f,t,n),(t[f].resolvedExports||[]).map(function(e){var t=e.type,r=e.exported,n=e.local,i=e.fromModule;return _extends({},a,{type:t,exported:r,local:n,fromModule:i||l})})}),n[e]=!1}}}},{key:"exportByModuleCache",get:function(){return this._exportByModuleCache||(this._exportByModuleCache={})}}]),e}(),buildPackageMap=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l,f,p,h,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{maxDepth:0,excludes:[]},m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=d.maxDepth,n=d.excludes,!(r>0&&v>r)){e.next=3;break}return e.abrupt("return",m);case 3:return e.prev=3,e.t0=JSON,e.next=7,lively_resources.resource(t).join("package.json").read();case 7:if(e.t1=e.sent,i=e.t0.parse.call(e.t0,e.t1),o=i.name+"@"+i.version,!m[o]&&!n.includes(i.name)){e.next=12;break}return e.abrupt("return",m);case 12:m[o]=_extends({url:t},lively_lang.obj.select(i,["name","version","dependencies","devDependencies","main"])),e.next=18;break;case 15:return e.prev=15,e.t2=e.catch(3),e.abrupt("return",m);case 18:return e.prev=18,e.next=21,lively_resources.resource(t).join("node_modules").dirList(1);case 21:a=e.sent,e.next=27;break;case 24:return e.prev=24,e.t3=e.catch(18),e.abrupt("return",m);case 27:s=!0,u=!1,c=void 0,e.prev=30,l=a[Symbol.iterator]();case 32:if(s=(f=l.next()).done){e.next=41;break}return p=f.value,h=p.url,e.next=37,buildPackageMap(h,d,m,v+1);case 37:m=e.sent;case 38:s=!0,e.next=32;break;case 41:e.next=47;break;case 43:e.prev=43,e.t4=e.catch(30),u=!0,c=e.t4;case 47:e.prev=47,e.prev=48,!s&&l.return&&l.return();case 50:if(e.prev=50,!u){e.next=53;break}throw c;case 53:return e.finish(50);case 54:return e.finish(47);case 55:return e.abrupt("return",m);case 56:case"end":return e.stop()}},e,this,[[3,15],[18,24],[30,43,47,55],[48,,50,54]])}));return function(t){return e.apply(this,arguments)}}(),dependencies=Object.freeze({buildPackageMap:buildPackageMap,resolvePackageDependencies:resolvePackageDependencies,dependencyGraph:dependencyGraph}),GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:void 0;exports.System=exports.System||prepareSystem(GLOBAL.System);var scripting={module:module$2,ensurePackage:ensurePackage$1,registerPackage:registerPackage$1,importPackage:importPackage$1,lookupPackage:lookupPackage$1,ImportInjector:ImportInjector};exports.getSystem=getSystem,exports.removeSystem=removeSystem,exports.loadedModules=loadedModules$$1,exports.printSystemConfig=printSystemConfig$$1,exports.whenLoaded=whenLoaded$1,exports.changeSystem=changeSystem,exports.module=module$1,exports.doesModuleExist=doesModuleExist$$1,exports.isModuleLoaded=isModuleLoaded$$1,exports.importPackage=importPackage$$1,exports.registerPackage=registerPackage$$1,exports.removePackage=removePackage$1,exports.reloadPackage=reloadPackage$$1,exports.getPackages=getPackages,exports.getPackage=getPackage$$1,exports.getPackageOfModule=getPackageOfModule,exports.ensurePackage=ensurePackage$$1,exports.applyPackageConfig=applyPackageConfig,exports.lookupPackage=lookupPackage$$1,exports.moduleSourceChange=moduleSourceChange$$1,exports.requireMap=requireMap,exports.isHookInstalled=isHookInstalled,exports.installHook=installHook,exports.removeHook=removeHook,exports.wrapModuleLoad=wrapModuleLoad$$1,exports.unwrapModuleLoad=unwrapModuleLoad$$1,exports.cjs=dependencies,exports.scripting=scripting,exports.PackageRegistry=PackageRegistry$$1,exports.ExportLookup=ExportLookup,exports.semver=semver}(this.lively.modules=this.lively.modules||{},lively.lang,lively.ast,lively.notifications,lively.vm,lively.resources,lively.classes,semver),"undefined"!=typeof module&&"function"==typeof require&&(module.exports=GLOBAL.lively.modules)}();