!function(e){"use strict";function t(e,t,i,o){var s=Object.create((t||n).prototype),a=new f(o||[]);return s._invoke=function(e,t,n){var i=b;return function(o,s){if(i===x)throw new Error("Generator is already running");if(i===w){if("throw"===o)throw s;return h()}for(;;){var a=n.delegate;if(a){if("return"===o||"throw"===o&&a.iterator[o]===d){n.delegate=null;var u=a.iterator.return;if(u){var c=r(u,a.iterator,s);if("throw"===c.type){o="throw",s=c.arg;continue}}if("return"===o)continue}var c=r(a.iterator[o],a.iterator,s);if("throw"===c.type){n.delegate=null,o="throw",s=c.arg;continue}o="next",s=d;var l=c.arg;if(!l.done)return i=_,l;n[a.resultName]=l.value,n.next=a.nextLoc,n.delegate=null}if("next"===o)n._sent=s,n.sent=i===_?s:d;else if("throw"===o){if(i===b)throw i=w,s;n.dispatchException(s)&&(o="next",s=d)}else"return"===o&&n.abrupt("return",s);i=x;var c=r(e,t,n);if("normal"===c.type){i=n.done?w:_;var l={value:c.arg,done:n.done};if(c.arg!==k)return l;n.delegate&&"next"===o&&(s=d)}else"throw"===c.type&&(i=w,o="throw",s=c.arg)}}}(e,i,a),s}function r(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function n(){}function i(){}function o(){}function s(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function a(e){this.arg=e}function u(e){function t(t,r){var o=e[t](r),s=o.value;return s instanceof a?Promise.resolve(s.arg).then(n,i):Promise.resolve(s).then(function(e){return o.value=e,o})}"object"==typeof process&&process.domain&&(t=process.domain.bind(t));var r,n=t.bind(e,"next"),i=t.bind(e,"throw");t.bind(e,"return");this._invoke=function(e,n){function i(){return t(e,n)}return r=r?r.then(i,i):new Promise(function(e){e(i())})}}function c(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function l(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function f(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(c,this),this.reset(!0)}function p(e){if(e){var t=e[v];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(m.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=d,t.done=!0,t};return n.next=n}}return{next:h}}function h(){return{value:d,done:!0}}var d,m=Object.prototype.hasOwnProperty,v="function"==typeof Symbol&&Symbol.iterator||"@@iterator",y="object"==typeof module,g=e.regeneratorRuntime;if(g)y&&(module.exports=g);else{(g=e.regeneratorRuntime=y?module.exports:{}).wrap=t;var b="suspendedStart",_="suspendedYield",x="executing",w="completed",k={},E=o.prototype=n.prototype;i.prototype=E.constructor=o,o.constructor=i,i.displayName="GeneratorFunction",g.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===i||"GeneratorFunction"===(t.displayName||t.name))},g.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,o):e.__proto__=o,e.prototype=Object.create(E),e},g.awrap=function(e){return new a(e)},s(u.prototype),g.async=function(e,r,n,i){var o=new u(t(e,r,n,i));return g.isGeneratorFunction(r)?o:o.next().then(function(e){return e.done?e.value:o.next()})},s(E),E[v]=function(){return this},E.toString=function(){return"[object Generator]"},g.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},g.values=p,f.prototype={constructor:f,reset:function(e){if(this.prev=0,this.next=0,this.sent=d,this.done=!1,this.delegate=null,this.tryEntries.forEach(l),!e)for(var t in this)"t"===t.charAt(0)&&m.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=d)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,n){return o.type="throw",o.arg=e,r.next=t,!!n}if(this.done)throw e;for(var r=this,n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var s=m.call(i,"catchLoc"),a=m.call(i,"finallyLoc");if(s&&a){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&m.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?this.next=i.finallyLoc:this.complete(o),k},complete:function(e,t){if("throw"===e.type)throw e.arg;"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=e.arg,this.next="end"):"normal"===e.type&&t&&(this.next=t)},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),l(r),k}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;l(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:p(e),resultName:t,nextLoc:r},k}}}}("object"==typeof global?global:"object"==typeof window?window:"object"==typeof self?self:this),function(){var GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;void 0===GLOBAL.lively&&(GLOBAL.lively={}),function(){this.lively=this.lively||{},function(exports){"use strict";function Empty(){return function(){}}function K(){return function(e){return e}}function Null(){return function(){return null}}function False(){return function(){return!1}}function True(){return function(){return!0}}function notYetImplemented(){return function(){throw new Error("Not yet implemented")}}function all(e){var t=[];for(var r in e)e.__lookupGetter__(r)||"function"!=typeof e[r]||t.push(r);return t}function own(e){var t=[];for(var r in e)!e.__lookupGetter__(r)&&e.hasOwnProperty(r)&&"function"==typeof e[r]&&t.push(r);return t}function argumentNames(e){if(e.superclass)return[];var t=e.toString(),r="",n=t.match(/(?:\(([^\)]*)\)|([^\(\)-+!]+))\s*=>/);if(n)r=n[1]||n[2]||"";else{var i=t.match(/^[\s\(]*function[^(]*\(([^)]*)\)/);i&&i[1]&&(r=i[1])}return r.replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",").map(function(e){return e.trim()}).filter(function(e){return!!e})}function qualifiedMethodName(e){var t="";return e.declaredClass?t+=e.declaredClass+">>":e.declaredObject&&(t+=e.declaredObject+"."),t+(e.methodName||e.displayName||e.name||"anonymous")}function extractBody(e){for(var t=String(e).replace(/^function[^\{]+\{\s*/,"").replace(/\}$/,"").trim(),r=t.split(/\n|\r/),n=void 0,i=0;i<r.length;i++){var o=r[i].match(/^(\s+)[^\s]/);o&&(void 0===n||o[1].length<n.length)&&(n=o[1])}return n?t.replace(new RegExp("^"+n,"gm"),""):t}function timeToRun(e){var t=Date.now();return e(),Date.now()-t}function timeToRunN$1(e,t){for(var r=Date.now(),n=0;n<t;n++)e();return(Date.now()-r)/t}function delay(e,t){var r=Array.prototype.slice.call(arguments),n=r.shift();t=1e3*r.shift();return setTimeout(function(){return n.apply(n,r)},t)}function throttle(e,t){var r,n,i,o,s,a,u=debounce(t,function(){s=o=!1});return function(){r=this,n=arguments;return i||(i=setTimeout(function(){i=null,s&&e.apply(r,n),u()},t)),o?s=!0:a=e.apply(r,n),u(),o=!0,a}}function debounce(e,t,r){var n;return function(){var i=this,o=arguments;r&&!n&&t.apply(i,o),clearTimeout(n),n=setTimeout(function(){n=null,r||t.apply(i,o)},e)}}function throttleNamed(e,t,r){var n=_throttledByName;return n[e]?n[e]:n[e]=throttle(function(){debounceNamed(e,t,function(){delete n[e]})(),r.apply(this,arguments)},t)}function debounceNamed(e,t,r,n){var i=_debouncedByName;return i[e]?i[e]:i[e]=debounce(t,function(){delete i[e],r.apply(this,arguments)},n)}function createQueue(e,t){var r=_queues,n=r[e]||(r[e]={_workerActive:!1,worker:t,tasks:[],drain:null,push:function(e){n.tasks.push(e),n.activateWorker()},pushAll:function(e){e.forEach(function(e){n.tasks.push(e)}),n.activateWorker()},pushNoActivate:function(e){n.tasks.push(e)},handleError:function(e){e&&console.error("Error in queue: "+e)},activateWorker:function(){function t(e){n.handleError(e),n.activateWorker()}var i=n.tasks,o=n._workerActive;if(0===i.length)o&&(n._workerActive=!1,"function"==typeof n.drain&&n.drain()),delete r[e];else{o||(n._workerActive=!0);try{n.worker(i.shift(),t)}catch(e){t(e)}}}});return n}function workerWithCallbackQueue(e,t,r){function n(){c&&clearTimeout(c),a=!0,delete o[e]}function i(t){a||(n(),s.callbacks.forEach(function(r){try{r.apply(null,t)}catch(t){console.error("Error when invoking callbacks in queueUntil ["+e+"]:\n"+String(t.stack||t))}}))}var o=_queueUntilCallbacks,s=o[e];if(!!s)return s;var a=!1,u=!1;if(r)var c=setTimeout(function(){a||i([new Error("timeout")])},r);return s=o[e]={callbacks:[],cancel:function(){u=!0,n()},whenDone:function(e){return s.callbacks.push(e),s}},setTimeout(function(){if(!u)try{t(function(){i(arguments)})}catch(e){i([e])}},0),s}function _composeAsyncDefaultEndCallback(e,t){e&&console.error("lively.lang.composeAsync error",e)}function composeAsync(){var e,t,r=Array.prototype.slice,n=r.call(arguments),i=_composeAsyncDefaultEndCallback,o=i,s=new Promise(function(r,n){e=r,t=n});return n.reverse().reduce(function(e,a,u){var c=!1;return function(){function l(){c=!0;var n=r.call(arguments),i=n.shift();i?(o(i),t(i)):e.apply(null,n)}var f=r.call(arguments);if(o===i&&u===n.length-1){for(;f.length&&"function"!=typeof f[f.length-1];)f.pop();"function"==typeof f[f.length-1]&&(o=f.pop())}if("function"==typeof a)try{var p=a.apply(this,f.concat([l]));p&&"function"==typeof p.then&&"function"==typeof p.catch&&p.then(function(e){return l(null,e)}).catch(function(e){return l(e)})}catch(e){console.error("composeAsync: ",e.stack||e),c||(o(e),t(e))}else if(a&&"function"==typeof a.then&&"function"==typeof a.catch)a.then(function(e){l(null,e)}).catch(function(e){l(e)});else{var h=new Error("Invalid argument to composeAsync: "+a);o(h),t(h)}return s}},function(){var t=r.call(arguments);o.apply(null,[null].concat(t)),e(t[0])})}function compose(){return Array.prototype.slice.call(arguments).reverse().reduce(function(e,t){return function(){return e(t.apply(this,arguments))}},function(e){return e})}function flip(e){return function(){var t=Array.prototype.slice.call(arguments),r=[t[1],t[0]].concat(t.slice(2));return e.apply(null,r)}}function withNull(e){return e=e||function(){},function(){var t=lively.lang.arr.from(arguments);e.apply(null,[null].concat(t))}}function waitFor(e,t,r){var n=Date.now(),i=50;r||(r=t,t=e,e=void 0),function o(){if(t())return r();if(e){var s=Date.now()-n,a=e-s;if(a<=0)return r(new Error("timeout"));a<i&&(i=a)}setTimeout(o,i)}()}function waitForAll(e,t,r){function n(e,t,n,s){if(o.length){var a=null,u=o.indexOf(e);u>-1&&o.splice(u,1),n?(o.length=0,a=new Error("in waitForAll at"+("number"==typeof t?" "+t:"")+": \n"+(n.stack||String(n)))):s&&(i[t]=s),o.length||setTimeout(function(){r(a,i)},0)}}r||(r=t,t=e,e=null),e=e||{};var i=t.map(function(){return null});if(t.length){var o=Array.prototype.slice.call(t);t.forEach(function(e,t){try{e(function(){var r=Array.prototype.slice.call(arguments),i=r.shift();n(e,t,i,r)})}catch(r){n(e,t,r,null)}}),e.timeout&&setTimeout(function(){if(o.length){var e=i.map(function(e,t){return null===e&&t}).filter(function(e){return"number"==typeof e}).join(", ");n(null,null,new Error("waitForAll timed out, functions at "+e+" not done"),null)}},e.timeout)}else r(null,i)}function curry(e,t,r,n){function i(){return e.apply(this,o.concat(Array.prototype.slice.call(arguments)))}if(arguments.length<=1)return arguments[0];var o=Array.prototype.slice.call(arguments);e=o.shift();return i.isWrapper=!0,i.originalFunction=e,i}function wrap(e,t){var r=e,n=function(){var e=Array.prototype.slice.call(arguments),n=t.isWrapper?e:[r.bind(this)].concat(e);return t.apply(this,n)};return n.isWrapper=!0,n.originalFunction=r,n}function getOriginal(e){for(;e.originalFunction;)e=e.originalFunction;return e}function wrapperChain(e){var t=[];do{t.push(e),e=e.originalFunction}while(e);return t}function replaceMethodForOneCall(e,t,r){r.originalFunction=e[t];var n=e.hasOwnProperty(t);return e[t]=function(){return n?e[t]=r.originalFunction:delete e[t],r.apply(this,arguments)},e}function once(e){if(e){if("function"!=typeof e)throw new Error("once() expecting a function");var t,r=!1;return function(){return r?t:(r=!0,t=e.apply(this,arguments))}}}function either(){var e=!1;return Array.prototype.slice.call(arguments).map(function(t){return function(){if(!e)return e=!0,t.apply(this,arguments)}})}function eitherNamed(e,t){var r=Array.prototype.slice.call(arguments),n=_eitherNameRegistry,i=(e=r.shift(),n[e]||(n[e]={wasCalled:!1,callsLeft:0}));return i.callsLeft++,function(){if(i.callsLeft--,i.callsLeft<=0&&delete n[e],!i.wasCalled)return i.wasCalled=!0,t.apply(this,arguments)}}function evalJS(src){return eval(src)}function fromString(e){return evalJS("("+e.toString()+");")}function asScript(e,t){return Closure.fromFunction(e,t).recreateFunc()}function asScriptOf(e,t,r,n){var i=r||e.name;if(!i)throw Error("Function that wants to be a script needs a name: "+this);var o=Object.getPrototypeOf(t),s={this:t};if(n&&(s=merge([s,n])),o&&o[i]){var a=function(){try{return Object.getPrototypeOf(t)[i].apply(t,arguments)}catch(e){return void 0!==("undefined"==typeof $world?"undefined":_typeof($world))?$world.logError(e,"Error in $super call"):console.error("Error in $super call: "+e+"\n"+e.stack),null}};s.$super=Closure.fromFunction(a,{obj:t,name:i}).recreateFunc()}return addToObject(asScript(e,s),t,i)}function addToObject(e,t,r){e.displayName=r;var n=t.attributeConnections?t.attributeConnections.filter(function(e){return"update"===e.getSourceAttrName()}):[];return n&&n.forEach(function(e){e.disconnect()}),t[r]=e,(void 0===t||_typeof(t))&&(e.declaredObject=safeToString(t)),"undefined"!=typeof lively&&t&&lively.Tracing&&lively.Tracing.stackTracingEnabled&&lively.Tracing.instrumentMethod(t,r,{declaredObject:safeToString(t)}),n&&n.forEach(function(e){e.connect()}),e}function binds(e,t){return Closure.fromFunction(e,t||{}).recreateFunc()}function setLocalVarValue(e,t,r){e.hasLivelyClosure&&(e.livelyClosure.funcProperties[t]=r)}function getVarMapping(e){return e.hasLivelyClosure?e.livelyClosure.varMapping:e.isWrapper?e.originalFunction.varMapping:e.varMapping?e.varMapping:{}}function setProperty(e,t,r){e[t]=r,e.hasLivelyClosure&&(e.livelyClosure.funcProperties[t]=r)}function functionNames(e){for(var t=[],r=e.prototype;r;)t=Object.keys(r).reduce(function(e,t){return"function"==typeof r[t]&&-1===e.indexOf(t)&&e.push(t),e},t),r=Object.getPrototypeOf(r);return t}function localFunctionNames(e){return Object.keys(e.prototype).filter(function(t){return"function"==typeof e.prototype[t]})}function logErrors(e,t){var r=function(r){var n=Array.prototype.slice.call(arguments);n.shift();try{return r.apply(e,n)}catch(r){if("undefined"!=typeof lively&&lively.morphic&&lively.morphic.World&&lively.morphic.World.current())throw lively.morphic.World.current().logError(r),r;throw t?console.warn("ERROR: %s.%s(%s): err: %s %s",e,t,n,r,r.stack||""):console.warn("ERROR: %s %s",r,r.stack||""),r}};r.methodName="$logErrorsAdvice";var n=wrap(e,r);return n.originalFunction=e,n.methodName="$logErrorsWrapper",n}function logCompletion(e,t){var r=function(r){var n=Array.prototype.slice.call(arguments);n.shift();try{var i=r.apply(e,n)}catch(e){throw console.warn("failed to load "+t+": "+e),"undefined"!=typeof lively&&lively.lang.Execution&&lively.lang.Execution.showStack(),e}return console.log("completed "+t),i};r.methodName="$logCompletionAdvice::"+t;var n=wrap(e,r);return n.methodName="$logCompletionWrapper::"+t,n.originalFunction=e,n}function logCalls(e,t){var r=e,n=function(n){var o=Array.prototype.slice.call(arguments);return o.shift(),i=n.apply(e,o),t?console.warn("%s(%s) -> %s",qualifiedMethodName(r),o,i):console.log("%s(%s) -> %s",qualifiedMethodName(r),o,i),i};n.methodName="$logCallsAdvice::"+qualifiedMethodName(e);var i=wrap(e,n);return i.originalFunction=e,i.methodName="$logCallsWrapper::"+qualifiedMethodName(e),i}function traceCalls(e,t){return wrap(e,function(r){var n=Array.prototype.slice.call(arguments);n.shift(),t.push(n);var i=r.apply(e,n);return t.pop(),i})}function webkitStack(){try{throw new Error}catch(e){return String(e.stack).split(/\n/).slice(2).map(function(e){return e.replace(/^\s*at\s*([^\s]+).*/,"$1")}).join("\n")}}function range(e,t,r){r=r||0;var n=[];if(e<=t){r<=0&&(r=-r||1);for(var i=e;i<=t;i+=r)n.push(i)}else{r>=0&&(r=-r||-1);for(i=e;i>=t;i+=r)n.push(i)}return n}function withN(e,t){for(var r=new Array(e);e>0;)r[--e]=t;return r}function genN(e,t){for(var r=new Array(e);e>0;)r[--e]=t(e);return r}function filter(e,t,r){return e.filter(t,r)}function findAndGet(e,t){var r;return e.find(function(e,n){return r=t(e,n)}),r}function filterByKey(e,t){return e.filter(function(e){return!!e[t]})}function grep(e,t,r){return"string"==typeof t&&(t=new RegExp(t,"i")),e.filter(t.test.bind(t))}function mask(e,t){return e.filter(function(e,r){return!!t[r]})}function reject(e,t,r){return e.filter(function(e,n){return!t.call(r,e,n)})}function rejectByKey(e,t){return e.filter(function(e){return!e[t]})}function without(e,t){return e.filter(function(e){return e!==t})}function withoutAll(e,t){return e.filter(function(e){return-1===t.indexOf(e)})}function uniq(e,t){if(!e.length)return e;var r=[e[0]];if(t)for(var n=1;n<e.length;n++){var i=e[n];i!==r[r.length]&&r.push(i)}else for(var o=1;o<e.length;o++){var s=e[o];-1===r.indexOf(s)&&r.push(s)}return r}function uniqBy(e,t,r){for(var n=e.slice(),i=n.length;i--;)for(var o=e[i],s=i+1;s<n.length;s++)t.call(r,o,n[s])&&n.splice(s--,1);return n}function uniqByKey(e,t){for(var r={},n=[],i=0;i<e.length;i++){var o=e[i];r[o[t]]||(r[o[t]]=!0,n.push(o))}return n}function compact(e){return e.filter(Boolean)}function mutableCompact(e){for(var t=0,r=0,n=e.length;t<n;)e.hasOwnProperty(t)&&(e[r++]=e[t]),t++;for(;r++<n;)e.pop();return e}function forEach$1(e,t,r){return e.forEach(t,r)}function zip(){var e=Array.from(arguments),t=e.shift(),r="function"==typeof last(e)?e.pop():function(e){return e},n=[t].concat(e).map(function(e){return Array.from(e)});return t.map(function(e,t){return r(pluck(n,t),t)})}function flatten(e,t){if("number"==typeof t){if(t<=0)return e;t--}return e.reduce(function(e,r){return e.concat(Array.isArray(r)?flatten(r,t):[r])},[])}function flatmap(e,t,r){for(var n=[],i=0;i<e.length;i++)n.push.apply(n,t.call(r,e[i],i));return n}function interpose(e,t){return e.reduce(function(e,r){return e.length>0&&e.push(t),e.push(r),e},[])}function delimWith(e,t){return interpose(e,t)}function map$1(e,t,r){return e.map(t,r)}function invoke(e,t,r,n,i,o,s,a){return e.map(function(e){return e[t](r,n,i,o,s,a)})}function pluck(e,t){return e.map(function(e){return e[t]})}function reduce(e,t,r,n){return e.reduce(t,r,n)}function reduceRight(e,t,r,n){return e.reduceRight(t,r,n)}function some(e,t,r){return e.some(t,r)}function every(e,t,r){return e.every(t,r)}function equals$2(e,t){var r=e.length;if(!t||r!==t.length)return!1;for(var n=0;n<r;n++){if(e[n]&&t[n]&&e[n].equals&&t[n].equals){if(e[n].equals(t[n]))continue;return!1}if(e[n]!=t[n])return!1}return!0}function deepEquals(e,t){var r=e.length;if(!t||r!==t.length)return!1;for(var n=0;n<r;n++)if(!equals$1(e[n],t[n]))return!1;return!0}function isSorted(e,t){if(t){for(var r=1;r<e.length;r++)if(e[r-1]<e[r])return!1}else for(r=1;r<e.length;r++)if(e[r-1]>e[r])return!1;return!0}function sort(e,t){return e.sort(t)}function sortBy(e,t,r){return pluck(e.map(function(e,n){return{value:e,criteria:t.call(r,e,n)}}).sort(function(e,t){var r=e.criteria,n=t.criteria;return r<n?-1:r>n?1:0}),"value")}function sortByKey(e,t){return sortBy(e,function(e){return e[t]})}function reverse(e){return e.reverse()}function reversed(e){return e.slice().reverse()}function reMatches$1(e,t,r){return r=r||String,e.map(function(e){return r(e).match(t)})}function first(e){return e[0]}function last(e){return e[e.length-1]}function intersect(e,t){return uniq(e).filter(function(e){return t.indexOf(e)>-1})}function union(e,t){for(var r=e.slice(),n=0;n<t.length;n++){var i=t[n];-1===r.indexOf(i)&&r.push(i)}return r}function pushAt(e,t,r){e.splice(r,0,t)}function removeAt(e,t){e.splice(t,1)}function remove(e,t){var r=e.indexOf(t);return r>=0&&removeAt(e,r),t}function pushAll$1(e,t){return e.push.apply(e,t),e}function pushAllAt(e,t,r){e.splice.apply(e,[r,0].concat(t))}function pushIfNotIncluded(e,t){e.includes(t)||e.push(t)}function replaceAt(e,t,r){e.splice(r,1,t)}function clear(e){return e.length=0,e}function isSubset(e,t){for(var r=0;r<e.length;r++)if(!t.includes(e[r]))return!1;return!0}function doAndContinue(e,t,r,n){return r=r||Null,n=n||GLOBAL$1,t=t||function(e,t,r){t.call(n,e,r)},e.reduceRight(function(e,r,i){return function(){t.call(n,e,r,i)}},r)()}function nestedDelay(e,t,r,n,i,o){return n=n||function(){},e.clone().reverse().reduce(function(e,n,s){return function(){t.call(i||GLOBAL$1,n,s),o&&s%o!=0?e():e.delay(r)}},n)()}function forEachShowingProgress(){var e,t,r,n,i,o=Array.from(arguments),s=o.shift(),a=s.length,u=!1;if(1===o.length?(e=o[0].progressBar,t=o[0].iterator,r=o[0].labelFunction,n=o[0].whenDone,i=o[0].context):(e=o[0],t=o[1],r=o[2],n=o[3],i=o[4]),i||(i="undefined"!=typeof window?window:global),r||(r=function(e){return e}),!e){u=!0;var c=("undefined"!=typeof window?window:global).lively&&lively.morphic&&lively.morphic.World.current();e=c?c.addProgressBar():{setValue:function(e){},setLabel:function(){},remove:function(){}}}return e.setValue(0),s.reduceRight(function(n,o,s){return function(){try{e.setValue(s/a),r&&e.setLabel(r.call(i,o,s)),t.call(i,o,s)}catch(e){console.error("Error in forEachShowingProgress at %s (%s)\n%s\n%s",s,o,e,e.stack)}n.delay(0)}},function(){e.setValue(1),u&&function(){e.remove()}.delay(0),n&&n.call(i)})(),s}function swap(e,t,r){t<0&&(t=e.length+t),r<0&&(r=e.length+r);var n=e[t];return e[t]=e[r],e[r]=n,e}function rotate(e,t){return t=t||1,e.slice(t).concat(e.slice(0,t))}function groupBy(e,t,r){return Group.fromArray(e,t,r)}function groupByKey(e,t){return groupBy(e,function(e){return e[t]})}function partition(e,t,r){t=t||function(e){return e};var n=[],i=[];return e.forEach(function(e,o){(t.call(r,e,o)?n:i).push(e)}),[n,i]}function batchify(e,t,r){function n(e,i){if(!i.length)return[e,[]];var o=i[0],s=i.slice(1),a=e.concat([o]);if(t.call(r,a))return n(a,s);var u=n(e,s);return[u[0],[o].concat(u[1])]}function i(e,t){if(!t.length)return e;var r=n([],t);if(!r[0].length)throw new Error("Batchify constrained does not ensure consumption of at least one item per batch!");return i(e.concat([r[0]]),r[1])}return i([],e)}function toTuples(e,t){return t=t||1,range(0,Math.ceil(e.length/t)-1).map(function(r){return e.slice(r*t,r*t+t)},e)}function combinationsPick(e,t){for(var r=e.map(function(e,r){return e[t[r]]}),n=t.slice(),i=e.length;i--;i>=0){var o=e[i],s=n[i]+1;if(o[s]){n[i]=s;break}if(0===i){n=void 0;break}n[i]=0}return[r,n]}function combinations(e){for(var t=e.reduce(function(e,t){return e*t.length},1),r=e.map(function(e){return 0}),n=new Array(t),i=0;i<t;i++){var o=combinationsPick(e,r);n[i]=o[0],r=o[1]}return n}function take(e,t){return e.slice(0,t)}function drop(e,t){return e.slice(t)}function takeWhile(e,t,r){for(var n=0;n<e.length&&t.call(r,e[n],n);n++);return e.slice(0,n)}function dropWhile(e,t,r){for(var n=0;n<e.length&&t.call(r,e[n],n);n++);return e.slice(n)}function shuffle(e){for(var t=range(0,e.length-1),r=Array(e.length),n=0;n<e.length;n++){r[t.splice(Math.round(Math.random()*(t.length-1)),1)]=e[n]}return r}function max(e,t,r){t=t||function(e){return e};var n;return e.reduce(function(e,i,o){var s=t.call(r,i,o);return"number"!=typeof s||s<=e?e:(n=i,s)},-1/0),n}function min(e,t,r){return t=t||function(e){return e},max(e,function(e,n){return-t.call(r,e,n)})}function sum(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}function count$1(e,t){return e.reduce(function(e,r){return r===t?e+1:e},0)}function size$1(e){return e.length}function histogram(e,t){if(void 0===t||"number"==typeof t){var r=t||Math.ceil(Math.log(e.length)/Math.log(2)+1),n=Math.ceil(Math.round(e.length/r));return range(0,r-1).map(function(t){return e.slice(t*n,(t+1)*n)})}if(t instanceof Array){var i=t;return e.reduce(function(e,t){if(t<i[1])return e[0].push(t),e;for(var r=1;r<i.length;r++)if(t>=i[r]&&(!i[r+1]||t<=i[r+1]))return e[r].push(t),e;throw new Error("Histogram creation: Cannot group data "+t+" into thresholds "+i)},range(1,i.length).map(function(){return[]}))}}function clone$1(e){return[].concat(e)}function toArray$3(e){return from(e)}function each(e,t,r){return e.forEach(t,r)}function all$1(e,t,r){return e.every(t,r)}function any(e,t,r){return e.some(t,r)}function collect(e,t,r){return e.map(t,r)}function findAll(e,t,r){return e.filter(t,r)}function inject(e,t,r,n){return n&&(r=r.bind(n)),e.reduce(r,t)}function mapAsyncSeries(e,t,r){function n(e,t){if(!o&&(e||t)){o=!0;try{r(e,i)}catch(e){console.error("Error in mapAsyncSeries - callback invocation error:\n"+(e.stack||e))}}}var i=[],o=!1;return e.reduceRight(function(e,r,s){if(!o)return function(o,a){if(o)return n(o);s>0&&i.push(a);try{t(r,s,once(e))}catch(e){n(e)}}},function(e,t){i.push(t),n(e,!0)})()}function mapAsync(e,t,r,n){function i(){for(;l<t.parallel&&c<e.length;)f[c++]()}function o(t,r){if(!(a.indexOf(t)>-1||(a.push(t),l--,u)))if(!r&&a.length<e.length)i();else{u=!0;try{n&&n(r,s)}catch(e){console.error("Error in mapAsync - main callback invocation error:\n"+(e.stack||e))}}}if("function"==typeof t&&(n=r,r=t,t=null),t=t||{},!e.length)return n&&n(null,[]);t.parallel||(t.parallel=1/0);var s=[],a=[],u=!1,c=0,l=0,f=e.map(function(e,t){return function(){l++;try{r(e,t,once(function(e,r){s[t]=e||r,o(t,e)}))}catch(e){o(t,e)}}});return i()}function print$1(e){if(e&&Array.isArray(e))return"["+e.map(print$1)+"]";if("string"!=typeof e)return String(e);var t=String(e);return t=t.replace(/\n/g,"\\n\\\n"),t=t.replace(/(")/g,"\\$1"),t='"'+t+'"'}function indent$1(e,t,r){if(!r||r<=0)return e;for(;r>0;)r--,e=t+e;return e}function isArray$$1(e){return Array.isArray(e)}function isElement(e){return e&&1==e.nodeType}function isFunction(e){return e instanceof Function}function isBoolean(e){return"boolean"==typeof e}function isString(e){return"string"==typeof e}function isNumber(e){return"number"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return e instanceof RegExp}function isObject(e){return"object"==(void 0===e?"undefined":_typeof(e))}function isPrimitive(e){if(!e)return!0;switch(void 0===e?"undefined":_typeof(e)){case"string":case"number":case"boolean":return!0}return!1}function isEmpty(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function equals$1(e,t){if(e===t)return!0;if(!e||!t)return e==t;if(Array.isArray(e))return deepEquals(e,t);switch(e.constructor){case String:case Date:case Boolean:case Number:return e==t}if("function"==typeof e.isEqualNode)return e.isEqualNode(t);if("function"==typeof e.equals)return e.equals(t);var r=[];for(var n in e)if(r.push(n),"function"!=typeof e[n]&&!equals$1(e[n],t[n]))return!1;for(var n in t)if(-1===r.indexOf(n)&&"function"!=typeof t[n]&&!equals$1(t[n],e[n]))return!1;return!0}function values(e){return e?Object.keys(e).map(function(t){return e[t]}):[]}function select(e,t){for(var r={},n=0;n<t.length;n++)r[t[n]]=e[t[n]];return r}function dissoc(e,t){for(var r=getOwnPropertyDescriptors(e=e||{}),n=0;n<t.length;n++)t[n]in r&&delete r[t[n]];return Object.defineProperties({},r)}function addScript(e,t,r,n){return asScriptOf(fromString(t),e,r,n)}function extend(e,t){for(var r=null,n=1;n<arguments.length;n++)if("string"!=typeof arguments[n]){t=arguments[n];for(var i in t){var o=t.__lookupGetter__(i),s=t.__lookupSetter__(i);if(o&&e.__defineGetter__(i,o),s&&e.__defineSetter__(i,s),!o&&!s){var a=t[i];e[i]=a,r&&r.push(i),"function"==typeof a&&(a.displayName||(a.displayName=i),"undefined"!=typeof lively&&lively.Module&&lively.Module.current&&(a.sourceModule=lively.Module.current()))}}}else{var u=arguments[n];e.categories||(e.categories={}),e.categories[u]||(e.categories[u]=[]),r=e.categories[u]}return e}function clone$$1(e){if(isPrimitive(e))return e;if(Array.isArray(e))return Array.prototype.slice.call(e);var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}function extract(e,t,r){for(var n={},i=0;i<t.length;i++)t[i]in e&&(n[t[i]]=r?r(t[i],e[t[i]]):e[t[i]]);return n}function inspect(e,t,r){if(t=t||{},r=r||0,t.customPrinter){var n=t._ignoreSignal||(t._ignoreSignal={}),i=function(e){return inspect(e,t,r+1)},o=t.customPrinter(e,n,i);if(o!==n)return o}if(!e)return print$1(e);if("function"==typeof e)return t.printFunctionSource?String(e):"function"+(e.name?" "+e.name:"")+"("+argumentNames(e).join(",")+") {/*...*/}";switch(e.constructor){case String:case Boolean:case RegExp:case Number:return print$1(e)}if("function"==typeof e.serializeExpr)return e.serializeExpr();var s=e&&Array.isArray(e),a=s?"[":"{",u=s?"]":"}";if(t.maxDepth&&r>=t.maxDepth)return a+"/*...*/"+u;var c=[];if(0===(c=s?e.map(function(e){return inspect(e,t,r+1)}):Object.keys(e).sort(function(t,r){var n="function"==typeof e[t];return n===("function"==typeof e[r])?t<r?-1:t>r?1:0:n?1:-1}).map(function(n,i){s&&inspect(e[n],t,r+1);var o=inspect(e[n],t,r+1);return t.escapeKeys?JSON.stringify(n):n+": "+o})).length)return a+u;var l=c.join(", "),f=(!s||t.newLineInArrays)&&(!t.minLengthForNewLine||l.length>=t.minLengthForNewLine),p=indent$1("",t.indent||"  ",r),h=indent$1("",t.indent||"  ",r+1),d=f&&!s?"\n"+h:"",m=f?"\n"+h:"",v=f&&!s?"\n"+p:"";return f&&(l=c.join(","+m)),a+d+l+v+u}function merge(e){return arguments.length>1?merge(Array.prototype.slice.call(arguments)):Array.isArray(e[0])?Array.prototype.concat.apply([],e):e.reduce(function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},{})}function deepMerge(e,t){if(!e)return t;if(!t)return e;if(Array.isArray(e)){if(!Array.isArray(t))return t;var r=e.map(function(e,r){return deepMerge(e,t[r])});return t.length>e.length&&(r=r.concat(t.slice(e.length))),r}return"object"!==(void 0===e?"undefined":_typeof(e))||"object"!==(void 0===t?"undefined":_typeof(t))?t:Object.keys(e).concat(Object.keys(t)).reduce(function(r,n){return e[n]?t[n]?"object"!==_typeof(e[n])||"object"!==_typeof(t[n])?r[n]=t[n]:r[n]=deepMerge(e[n],t[n]):r[n]=e[n]:r[n]=t[n],r},{})}function sortKeysWithBeforeAndAfterConstraints(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=[],r=[],n=[];for(var i in e){var o=e[i],s=o.hasOwnProperty("before")?o.before:o.before=[],a=o.hasOwnProperty("after")?o.after:o.after=[];t.push(i),r.push(o);for(var u=s.length;u--;){var c=s[u],l=e[c];l?(l.hasOwnProperty("after")||(l.after=[]),l.after.push(i)):(console.warn("[initializeProperties] "+this+" sortProperties: Property "+i+" requires to be initialized before "+c+" but that property cannot be found."),s.splice(u,1))}for(var f=a.length;f--;){var p=a[f];e[p]||(console.warn("[initializeProperties] "+this+" sortProperties: Property "+i+" requires to be initialized after "+p+" but that property cannot be found."),a.splice(f,1))}n.push(i)}for(var h=[],d=[],m=n.length+1;n.length;){if(m===n.length)throw new Error("Circular dependencies in handler order, could not resolve properties "+n.map(function(t){var r=e[t].before,n=e[t].after;if(!(r&&r.length||n&&n.length))return"";var i=t+"\n";return r&&r.length&&(i+="  - before "+r.join(",")+"\n"),n&&n.length&&(i+="  - after "+n.join(",")+"\n"),i}).join(""));m=n.length;for(var v=[],y=n.length;y--;){var g=n[y];isSubset(e[g].after,d)&&(n.splice(y,1),d.push(g),v.push(g))}h.push(v)}return flatten(h,1)}function inherit(e){return Object.create(e)}function valuesInPropertyHierarchy(e,t){for(var r=[],n=e;n;)n.hasOwnProperty(t)&&r.unshift(n[t]),n=Object.getPrototypeOf(n);return r}function mergePropertyInHierarchy(e,t){return merge(valuesInPropertyHierarchy(e,t))}function deepCopy(e){if(!e||"object"!==(void 0===e?"undefined":_typeof(e))||e instanceof RegExp)return e;var t=Array.isArray(e)?Array(e.length):{};for(var r in e)e.hasOwnProperty(r)&&(t[r]=deepCopy(e[r]));return t}function typeStringOf(e){return null===e?"null":void 0===e?"undefined":e.constructor.name}function shortPrintStringOf(e){function t(e,t,n,i){e.constructor.name===t&&(r+=n,(e.length||Object.keys(e).length)&&(r+="..."),r+=i)}if(!isMutableType(e))return safeToString(e);if("Object"!==e.constructor.name&&!Array.isArray(e)&&e.constructor.name)return e.constructor.name?e.constructor.name:Object.prototype.toString.call(e).split(" ")[1].split("]")[0];var r="";return t(e,"Object","{","}"),t(e,"Array","[","]"),r}function isMutableType(e){return-1===["null","undefined","Boolean","Number","String"].indexOf(typeStringOf(e))}function safeToString(e){try{return(e?e.toString():String(e)).replace("\n","")}catch(e){return"<error printing object>"}}function asObject(e){switch(void 0===e?"undefined":_typeof(e)){case"string":return new String(e);case"boolean":return new Boolean(e);case"number":return new Number(e);default:return e}}function newKeyIn(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"_",n=1;do{t=r+"-"+n++}while(t in e);return t}function format(){return formatFromArray(Array.prototype.slice.call(arguments))}function formatFromArray(e){function t(e,t){return""+e}function r(e,t){return e.toString()}function n(e,t){return inspect(e)}var i=e.shift();i||console.log("Error in Strings>>formatFromArray, first arg is undefined");for(var o={s:t,d:r,i:r,f:function(e,t,r){return r>-1?e.toFixed(r):e.toString()},o:n},s=/((^%|[^\\]%)(\d+)?(\.)([a-zA-Z]))|((^%|[^\\]%)([a-zA-Z]))/,a=function(e){for(var t=[],r=s.exec(e);r;r=s.exec(e)){var i=r[8]||r[5],a=i in o?o[i]:n,u=r[3]?parseInt(r[3]):"."==r[4]?-1:0;t.push(e.substr(0,"%"==r[0][0]?r.index:r.index+1)),t.push({appender:a,precision:u}),e=e.substr(r.index+r[0].length)}return e&&t.push(e.toString()),t}(i),u="",c=0,l=0;l<a.length;++l){var f=a[l];if(f&&"object"==(void 0===f?"undefined":_typeof(f))){var p=e[c++];u+=(f.appender||t)(p,u,f.precision)}else u+=t(f)}return u}function indent(e,t,r){if(!r||r<=0)return e;for(var n="";r>0;)r--,n+=t;return lines(e).map(function(e){return n+e}).join("\n")}function minIndent(e,t){t||(t="  ");var r=new RegExp("^("+t+")*","gm");return min(e.match(r).map(function(e){return Math.floor(e.length/t.length)}))}function changeIndent(e,t,r){t||(t="  "),r||(r=0);var n=minIndent(e,t);if(n===r)return e;if(n<r)return indent(e,t,r-n);var i=t.repeat(n-r);return lines(e).map(function(e){return e.slice(i.length)}).join("\n")}function quote(e){return'"'+e.replace(/"/g,'\\"')+'"'}function print(e){if(e&&Array.isArray(e))return"["+e.map(print)+"]";if("string"!=typeof e)return String(e);var t=String(e);return t=t.replace(/\n/g,"\\n\\\n"),t=t.replace(/(")/g,"\\$1"),t='"'+t+'"'}function printNested(e,t){return t=t||0,e.reduce(function(e,r){return e+=Array.isArray(r)?printNested(r,t+1):indent(r+"\n","  ",t)},"")}function pad(e,t,r){return r?" ".repeat(t)+e:e+" ".repeat(t)}function printTable(e,t){var r=[],n=t&&t.separator||" ",i=!t||!t.align||"left"===t.align,o=t&&"right"===t.align;return e.forEach(function(e){e.forEach(function(e,t){void 0===r[t]&&(r[t]=0),r[t]=Math.max(r[t],String(e).length)})}),e.map(function(e){return e.map(function(e,n){var s=String(e);return pad(s,r[n]-s.length,function(e){return!i&&(!!o||t&&Array.isArray(t.align)&&"right"===t.align[e])}(n))}).join(n)}).join("\n")}function printTree(e,t,r,n){function i(e,s,a){o[s]=n.repeat(e)+t(a,e);var u=r(a,e),c=s+1;if(!u||!u.length)return c;var l=c,f=u.length-1;return u.forEach(function(t,r){c=i(e+1,c,t);var s=f===r,a=o[l].split(""),u=e*n.length+1,p=e*n.length+n.length;for(r=u;r<p;r++)a[r]="-";s&&(a[e*n.length]="\\"),o[l]=a.join(""),s||o.slice(l,c).forEach(function(t,r){var i=t.split("");i[e*n.length]="|",o[l+r]=i.join("")}),l=c}),c}var o=[];return n=n||"  ",i(0,0,e),o.join("\n")}function toArray$1(e){return e.split("")}function lines(e){return e.split(/\n\r?/)}function paragraphs(e,t){function r(e){return/^\s*$/.test(e)}var n=t?t.sep:"\n\n";return t&&t.keepEmptyLines?e.split("\n").concat("").reduce(function(e,t){var n=e[0],i=e[1];return r(i)===r(t)?i+="\n"+t:(i.length&&n.push(i),i=t),[n,i]},[[],""])[0]:e.split(new RegExp(n+"+"))}function nonEmptyLines(e){return lines(e).compact()}function tokens(e,t){return e.split(t||/\s+/).filter(function(e){return!/^\s*$/.test(e)})}function tableize(e,t){for(var r=(t=t||{}).cellSplitter||/\s+/,n=/^\s*$/,i=!t.hasOwnProperty("convertTypes")||!!t.convertTypes,o=lines(e),s=[],a=0;a<o.length;a++){var u=tokens(o[a],r);i&&(u=u.map(function(e){if(e.match(n))return e;var t=Number(e);if(!isNaN(t))return t;var r=new Date(e);return isNaN(+r)?e.trim():r})),u.length>0&&s.push(u)}return s}function unescapeCharacterEntities(e){if("undefined"==typeof document)throw new Error("Cannot unescapeCharacterEntities");var t=document.createElement("div");return t.innerHTML=e,t.textContent}function toQueryParams(e,t){var r=e.trim().match(/([^?#]*)(#.*)?$/);if(!r)return{};return r[1].split(t||"&").inject({},function(e,t){if((t=t.split("="))[0]){var r=decodeURIComponent(t.shift()),n=t.length>1?t.join("="):t[0];void 0!=n&&(n=decodeURIComponent(n)),r in e?(Array.isArray(e[r])||(e[r]=[e[r]]),e[r].push(n)):e[r]=n}return e})}function normalizePath$1(e){var t=e.match(urlStartRe),r=t?t[0]:null,n=r?e.slice(r.length):e;do{n=(e=n).replace(pathDoubleDotRe,"")}while(n!=e);return n=n.replace(pathDoubleSlashRe,"$1/"),n=n.replace(pathDotRe,"/"),r&&(n=r+n),n}function joinPath(){return normalizePath$1(Array.prototype.slice.call(arguments).reduce(function(e,t){return"string"==typeof t?e.replace(/\/*$/,"")+"/"+t.replace(/^\/*/,""):e}))}function newUUID(){return newUUIDTemplate.replace(newUUIDRe,newUUIDReplacer).toUpperCase()}function createDataURI(e,t){return"data:"+(t=t||"text/plain")+";base64,"+btoa(e)}function hashCode(e){var t=0,r=e.length;if(0==r)return t;for(var n=0;n<r;n++){t=(t<<5)-t+e.charCodeAt(n),t&=t}return t}function md5(e){function t(e,t,r,n,i,o){return t=u(u(t,e),u(n,o)),u(t<<i|t>>>32-i,r)}function r(e,r,n,i,o,s,a){return t(r&n|~r&i,e,r,o,s,a)}function n(e,r,n,i,o,s,a){return t(r&i|n&~i,e,r,o,s,a)}function i(e,r,n,i,o,s,a){return t(r^n^i,e,r,o,s,a)}function o(e,r,n,i,o,s,a){return t(n^(r|~i),e,r,o,s,a)}function s(e,t){var s=e[0],a=e[1],c=e[2],l=e[3];a=o(a=o(a=o(a=o(a=i(a=i(a=i(a=i(a=n(a=n(a=n(a=n(a=r(a=r(a=r(a=r(a,c=r(c,l=r(l,s=r(s,a,c,l,t[0],7,-680876936),a,c,t[1],12,-389564586),s,a,t[2],17,606105819),l,s,t[3],22,-1044525330),c=r(c,l=r(l,s=r(s,a,c,l,t[4],7,-176418897),a,c,t[5],12,1200080426),s,a,t[6],17,-1473231341),l,s,t[7],22,-45705983),c=r(c,l=r(l,s=r(s,a,c,l,t[8],7,1770035416),a,c,t[9],12,-1958414417),s,a,t[10],17,-42063),l,s,t[11],22,-1990404162),c=r(c,l=r(l,s=r(s,a,c,l,t[12],7,1804603682),a,c,t[13],12,-40341101),s,a,t[14],17,-1502002290),l,s,t[15],22,1236535329),c=n(c,l=n(l,s=n(s,a,c,l,t[1],5,-165796510),a,c,t[6],9,-1069501632),s,a,t[11],14,643717713),l,s,t[0],20,-373897302),c=n(c,l=n(l,s=n(s,a,c,l,t[5],5,-701558691),a,c,t[10],9,38016083),s,a,t[15],14,-660478335),l,s,t[4],20,-405537848),c=n(c,l=n(l,s=n(s,a,c,l,t[9],5,568446438),a,c,t[14],9,-1019803690),s,a,t[3],14,-187363961),l,s,t[8],20,1163531501),c=n(c,l=n(l,s=n(s,a,c,l,t[13],5,-1444681467),a,c,t[2],9,-51403784),s,a,t[7],14,1735328473),l,s,t[12],20,-1926607734),c=i(c,l=i(l,s=i(s,a,c,l,t[5],4,-378558),a,c,t[8],11,-2022574463),s,a,t[11],16,1839030562),l,s,t[14],23,-35309556),c=i(c,l=i(l,s=i(s,a,c,l,t[1],4,-1530992060),a,c,t[4],11,1272893353),s,a,t[7],16,-155497632),l,s,t[10],23,-1094730640),c=i(c,l=i(l,s=i(s,a,c,l,t[13],4,681279174),a,c,t[0],11,-358537222),s,a,t[3],16,-722521979),l,s,t[6],23,76029189),c=i(c,l=i(l,s=i(s,a,c,l,t[9],4,-640364487),a,c,t[12],11,-421815835),s,a,t[15],16,530742520),l,s,t[2],23,-995338651),c=o(c,l=o(l,s=o(s,a,c,l,t[0],6,-198630844),a,c,t[7],10,1126891415),s,a,t[14],15,-1416354905),l,s,t[5],21,-57434055),c=o(c,l=o(l,s=o(s,a,c,l,t[12],6,1700485571),a,c,t[3],10,-1894986606),s,a,t[10],15,-1051523),l,s,t[1],21,-2054922799),c=o(c,l=o(l,s=o(s,a,c,l,t[8],6,1873313359),a,c,t[15],10,-30611744),s,a,t[6],15,-1560198380),l,s,t[13],21,1309151649),c=o(c,l=o(l,s=o(s,a,c,l,t[4],6,-145523070),a,c,t[11],10,-1120210379),s,a,t[2],15,718787259),l,s,t[9],21,-343485551),e[0]=u(s,e[0]),e[1]=u(a,e[1]),e[2]=u(c,e[2]),e[3]=u(l,e[3])}function a(e){for(var t="",r=0;r<4;r++)t+=c[e>>8*r+4&15]+c[e>>8*r&15];return t}var u=function(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r},c="0123456789abcdef".split("");return function(e){for(var t=e.length,r=0;r<t;r++)e[r]=a(e[r]);return e.join("")}(function(e){var t,r=e.length,n=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=r;t+=64)s(n,function(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}(e.substring(t-64,t)));var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=(e=e.substring(t-64)).length;for(t=0;t<o;t++)i[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(s(n,i),t=16;t--;)i[t]=0;return i[14]=8*r,s(n,i),n}(e))}function reMatches$$1(e,t){var r=[];return e.replace(t,function(e,t){r.push({match:e,start:t,end:t+e.length})}),r}function stringMatch(e,t,r){function n(e,t){if(t.constructor!==RegExp){if(0===e.indexOf(t))return{match:t,rest:e.slice(t.length)};for(var r=0;r<t.length;r++)if(t[r]!=e[r])return{match:null,pos:r};return{match:null}}var n=reMatches$$1(e,t);return n&&n.length&&0===n[0].start?{match:n[0].match,rest:e.slice(n[0].end)}:{match:null}}return(r=r||{}).normalizeWhiteSpace&&(e=e.replace(/\s+/g," ")),r.ignoreIndent&&(e=e.replace(/^\s+/gm,""),t=t.replace(/^\s+/gm,"")),e==t?{matched:!0}:function(e,t){var r=function(e,t){for(var r=0,i=0;i<t.length;i++){var o=t[i],s=n(e,o);if(!s.match)return{matched:!1,pos:r+(s.pos||0),pattern:o};r+=s.match.length,e=s.rest}return e.length?{matched:!1,pos:r}:{matched:!0}}(e,function(e){var t=reMatches$$1(e,/__\//g),r=reMatches$$1(e,/\/__/g);if(t.length!==r.length)throw new Error("pattern invalid: "+e+" cannot be split into __/.../__ embedded RegExps\nstarts: "+JSON.stringify(t)+"\nvs ends:\n"+JSON.stringify(r));var n=0;return t.reduce(function(e,t,i){var o=r[i],s=function(e,t,r,n,i){return n=n||0,i=i||0,[e.slice(0,t),e.slice(t+n,r-i),e.slice(r)]}(e.pop(),t.start-n,o.end-n,3,3);s[0].length&&(e.push(s[0]),n+=s[0].length);try{s[1].length&&(e.push(new RegExp(s[1])),n+=s[1].length+3+3)}catch(e){throw new Error("Cannot create pattern re from: "+inspect(s))}return s[2].length&&e.push(s[2]),e},[e])}(t));return r.matched?r:(r.error=e.slice(0,r.pos)+"<--UNMATCHED--\x3e"+e.slice(r.pos),r)}(e,t)}function peekRight(e,t,r){if(e=e.slice(t),"string"==typeof r){var n=e.indexOf(r);return-1===n?null:n+t}if(r.constructor===RegExp){var i=reMatches$$1(e,r);return i[0]?i[0].start:null}return null}function peekLeft(e,t,r){if(e=e.slice(0,t),"string"==typeof r){var n=e.lastIndexOf(r);return-1===n?null:n}if(r.constructor===RegExp){var i=reMatches$$1(e,r);return last(i)?last(i).start:null}return null}function lineIndexComputer(e){var t=lineRanges(e);return function(e){for(var r=0;r<t.length;r++){var n=t[r];if(e>=n[0]&&e<n[1])return r}return-1}}function lineNumberToIndexesComputer(e){return function(t){return lineRanges(e)[t]}}function lineRanges(e){for(var t=0,r=0,n=lines(e),i=[],o=0;o<n.length;o++){r=t+n[o].length+1,i.push([t,r]),t=r}return i}function findLineWithIndexInLineRanges(e,t){var r=e.length;if(0===r)return-1;for(var n=0,i=r;;){var o=n+Math.floor((i-n)/2),s=slicedToArray(e[o],2),a=s[0],u=s[1];if(t<a){if(0===o)return-1;i=o}else{if(!(t>u))return o;n=o}}return-1}function regexIndexOf(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.substring(r||0).search(t);return n>=0?n+(r||0):n}function regexLastIndexOf(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length;t=t.global?t:new RegExp(t.source,"g"+(t.ignoreCase?"i":"")+(t.multiLine?"m":""));for(var n,i=this.substring(0,r+1),o=-1,s=0;null!=(n=t.exec(i));)o=n.index,t.lastIndex=++s;return o}function diff(e,t){return"undefined"==typeof JsDiff?"diff not supported":JsDiff.convertChangesToXML(JsDiff.diffWordsWithSpace(e,t))}function empty(e){return""==e}function startsWithVowel(e){var t=e[0];return"A"===t||"E"===t||"I"===t||"O"===t||"U"===t||"a"===t||"e"===t||"i"===t||"o"===t||"u"===t||!1}function withDecimalPrecision(e,t){var r=parseFloat(e);return isNaN(r)?e:r.toFixed(t)}function capitalize(e){return e.length?e.charAt(0).toUpperCase()+e.slice(1):e}function camelCaseString(e){return e.split(" ").invoke("capitalize").join("")}function camelize(e){var t=e.split("-"),r=t.length;if(1==r)return t[0];for(var n="-"==e.charAt(0)?t[0].charAt(0).toUpperCase()+t[0].substring(1):t[0],i=1;i<r;i++)n+=t[i].charAt(0).toUpperCase()+t[i].substring(1);return n}function truncate(e,t,r){return t=t||30,r=void 0===r?"...":r,e.length>t?e.slice(0,t-r.length)+r:String(e)}function truncateLeft(e,t,r){return t=t||30,r=void 0===r?"...":r,e.length>t?r+e.slice(-t):String(e)}function regExpEscape(e){return e.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")}function succ(e){return e.slice(0,e.length-1)+String.fromCharCode(e.charCodeAt(e.length-1)+1)}function digitValue(e){return e.charCodeAt(0)-"0".charCodeAt(0)}function longestCommonSubstring(e,t){for(var r=[],n=0;n<e.length;n++){r[n]=[];for(var i=0;i<t.length;i++)r[n][i]=0}for(var o=0;o<e.length;o++)r[o][0]=0;for(var s=1;s<e.length;s++)for(var a=1;a<t.length;a++)r[s][a]=e[s-1]==t[a-1]?r[s-1][a-1]+1:0;for(var u=-1,c=-1,l=-1,f=0;f<e.length;f++)for(var p=0;p<t.length;p++){var h=r[f][p];u<h&&(u=h,c=f-h,l=p-h)}return{length:u,indexA:c,indexB:l,string:u>0?e.slice(c,c+u):""}}function applyChange(e,t){return"insert"===t.action?e.slice(0,t.start)+t.lines.join("\n")+e.slice(t.start):"remove"===t.action?e.slice(0,t.start)+e.slice(t.end):e}function applyChanges(e,t){return t.reduce(function(t,r){return applyChange(e,r)},e)}function levenshtein(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;var r,n,i,o,s,a;for(e.length>t.length&&(r=e,e=t,t=r),a=Array(e.length+1),n=0;n<=e.length;n++)a[n]=n;for(n=1;n<=t.length;n++){for(o=n,i=1;i<=e.length;i++)s=t[n-1]===e[i-1]?a[i-1]:Math.min(a[i-1]+1,Math.min(o+1,a[i]+1)),a[i-1]=o,o=s;a[e.length]=o}return a[e.length]}function random(e,t){return e=e||0,t=t||100,Math.round(Math.random()*(t-e)+e)}function randomSmallerInteger(e){return Math.floor(Math.random()*e)}function humanReadableByteSize(e){function t(e){return Math.round(100*e)/100}return e<1e3?String(t(e))+"B":(e/=1024)<1e3?String(t(e))+"KB":(e/=1024,String(t(e))+"MB")}function average(e){return e.reduce(function(e,t){return e+t},0)/e.length}function averageInc(e,t,r){return(e-t)/r+t}function median(e){var t=e.sort(function(e,t){return t-e}),r=e.length;return r%2==0?.5*(t[r/2-1]+t[r/2]):t[(r-1)/2]}function between(e,t,r,n){n=n||0;var i,o;return t<r?(i=t,o=r):(o=t,i=r),o-e+n>=0&&i-e-n<=0}function sort$1(e){return e.sort(function(e,t){return e-t})}function parseLength(e,t){t=t||"px";var r=e.match(/([0-9\.]+)\s*(.*)/);if(r&&r[1]){var n=parseFloat(r[1]),i=r[2];return convertLength(n,i,t)}}function roundTo(e,t){return t=1/t,Math.round(e*t)/t}function detent(e,t,r,n){var i=roundTo(e,r);if(Math.abs(e-i)<t/2)return i;if(n)return e;return i+(e-(e<i?i-t/2:i+t/2))*r/(r-t)}function toDegrees(e){return 180*e/Math.PI%360}function toRadians(e){return e/180*Math.PI}function backoff(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4,n=Math.min(r,t*Math.pow(2,e)),i=n/2+Math.round(Math.random()*(n/2));return Math.min(r,t+Math.random()*(3*i-t))}function all$2(e,t){var r=[];for(var n in e)!e.__lookupGetter__(n)&&"function"==typeof e[n]||t&&!t(n,e)||r.push(n);return r}function allOwnPropertiesOrFunctions(e,t){return Object.getOwnPropertyNames(e).reduce(function(r,n){return t&&!t(e,n)||r.push(n),r},[])}function own$1(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&(e.__lookupGetter__(r)||"function"!==e[r])&&t.push(r);return t}function forEachOwn(e,t,r){var n=[];for(var i in e)if(e.hasOwnProperty(i)){var o=e[i];"function"!==o&&n.push(t.call(r||this,i,o))}return n}function nameFor(e,t){for(var r in e)if(e[r]===t)return r}function values$1(e){var t=[];for(var r in e)t.push(e[r]);return t}function ownValues(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(e[r]);return t}function any$1(e,t){for(var r in e)if(t(e,r))return!0;return!1}function allProperties(e,t){var r=[];for(var n in e)t&&!t(e,n)||r.push(n);return r}function hash(e){return Object.keys(e).sort().join("").hashCode()}function format$1(e,t,r){return dateFormat(e,t,r)}function equals$3(e,t){return t&&t instanceof Date&&t.getTime()===e.getTime()}function relativeTo(e,t){if(!(t instanceof Date))return"";if(t<e)return"";if(t===e)return"now";var r="min",n="sec",i="hour",o="day",s=t-e,a=Math.round(s/1e3),u=a%60,c=Math.floor(a/60)%60,l=Math.floor(a/60/60)%24,f=Math.floor(a/60/60/24),p=[];return f>0&&(p.push(f),f>1&&(o+="s"),p.push(o)),l>0&&f<2&&(p.push(l),l>1&&(i+="s"),p.push(i)),c>0&&l<3&&0===f&&(p.push(c),c>1&&(r+="s"),p.push(r)),u>0&&c<3&&0===l&&0===f&&(p.push(u),u>1&&(n+="s"),p.push(n)),p.join(" ")}function promise(e){return"function"==typeof e?promise.convertCallbackFun(e):Promise.resolve(e)}function delay$1(e,t){return new Promise(function(r){return setTimeout(r,e,t)})}function delayReject(e,t){return new Promise(function(r,n){return setTimeout(n,e,t)})}function timeout(e,t){return new Promise(function(r,n){var i=!1;setTimeout(function(){return!i&&(i=!0)&&n(new Error("Promise timed out"))},e),t.then(function(e){return!i&&(i=!0)&&r(e)},function(e){return!i&&(i=!0)&&n(e)})})}function waitFor$1(e,t,r){return"function"==typeof e&&(t=e,e=void 0),new Promise(function(n,i){var o=!1,s=!1,a=void 0,u=void 0,c=setInterval(function(){if(o)return clearInterval(c);try{u=t()}catch(e){a=e}if(u||a||s)return o=!0,clearInterval(c),a?i(a):s?void 0===r?i(new Error("timeout")):n(r):n(u)},10);"number"==typeof e&&setTimeout(function(){return s=!0},e)})}function deferred(){var e,t,r=new Promise(function(r,n){e=r,t=n});return{resolve:e,reject:t,promise:r}}function convertCallbackFun(e){return function(){var t=Array.from(arguments),r=this;return new Promise(function(n,i){t.push(function(e,t){return e?i(e):n(t)}),e.apply(r,t)})}}function convertCallbackFunWithManyArgs(e){return function(){var t=Array.from(arguments),r=this;return new Promise(function(n,i){t.push(function(){var e=Array.from(arguments),t=e.shift();return t?i(t):n(e)}),e.apply(r,t)})}}function _chainResolveNext(e,t,r,n,i){var o=e.shift();if(o)try{Promise.resolve(o(t,r)).then(function(t){return _chainResolveNext(e,t,r,n,i)}).catch(function(e){i(e)})}catch(e){i(e)}else n(t)}function chain$1(e){return new Promise(function(t,r){return _chainResolveNext(e.slice(),void 0,{},t,r)})}function promise_finally(e,t){return Promise.resolve(e).then(function(e){try{t()}catch(e){console.error("Error in promise finally: "+e.stack||e)}return e}).catch(function(e){try{t()}catch(e){console.error("Error in promise finally: "+e.stack||e)}throw e})}function parallel(e){function t(){n--;try{var t=s++;e[t]().then(function(e){n++,i[t]=e,0==--a?u():r()}).catch(function(e){return c(e)})}catch(e){c(e)}}function r(){for(;!o&&a>0&&s<e.length&&n>0;)t()}var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;if(!e.length)return Promise.resolve([]);var i=[],o=null,s=0,a=e.length,u=void 0,c=void 0;return new Promise(function(e,t){u=function(){return e(i)},c=function(e){return t(o=e)},r()})}function Path(e,t){return e instanceof Path?e:this instanceof Path?(this.setSplitter(t||"."),void this.fromPath(e)):new Path(e,t)}function clone$2(e){var t={};for(var r in e)t[r]=e[r].slice();return t}function without$1(e,t){var r={};for(var n in e)if(!t.includes(n)){r[n]=[];for(var i=e[n],o=0;o<i.length;o++){var s=i[o];t.includes(s)||r[n].push(s)}}return r}function hull(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;if(!Array.isArray(e[t]))return[];for(var i=[],o={},s={},a=0;a<r.length;a++)s[r[a]]=!0;for(var u=e[t].slice(),c={},l=u.length;l--;){var f=u[l];f in s?u.splice(l,1):c[f]=1}if(r)for(;0!==u.length;)for(var p=0;p<u.length;p++){var h=u.shift();if(!(h in o||h in s)){var d=c[h]||0;if(!(d>n)){i.push(h),o[h]=!0;var m=e[h];if(m)for(var v=0;v<m.length;v++){var y=m[v];y in o||y in c||(c[y]=d+1,u.push(y))}}}}return i}function subgraphReachableBy(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;r&&(e=without$1(e,r));for(var i=[t],o=0,s={};i.length&&o++<n;){var a=i.shift();if(!s[a]){var u=e[a]||[];s[a]=u,i.push.apply(i,toConsumableArray(u))}}return s}function invert(e){var t={};for(var r in e)for(var n=e[r],i=0;i<n.length;i++){var o=n[i];t[o]?t[o].push(r):t[o]=[r]}return t}function sortByReference(e,t){var r=[],n={},i={},o={};for(var s in e){n.hasOwnProperty(s)||(n[s]=!0,r.push(s));var a=e[s],u={};if(a){i[s]=[];var c=!0,l=!1,f=void 0;try{for(var p,h=a[Symbol.iterator]();!(c=(p=h.next()).done);c=!0){var d=p.value;if(!u.hasOwnProperty(d)&&s!==d){var m=o[d]||(o[d]=[]);m.includes(s)||m.push(s),u[d]=!0,i[s].push(d),n.hasOwnProperty(d)||(n[d]=!0,r.push(d))}}}catch(e){l=!0,f=e}finally{try{!c&&h.return&&h.return()}finally{if(l)throw f}}}}for(var v=[];r.length;){for(var y=1/0,g=[],b=[],_=[],x=0;x<r.length;x++){var w=i[F=r[x]]||[];if(!(w.length>y))if(w.length!==y||w.some(function(e){return g.includes(e)}))y=w.length,g=[F],b=[x],_=(o[F]||[]).slice();else{var k;g.push(F),b.push(x),(k=_).push.apply(k,toConsumableArray(o[F]||[]))}}for(x=b.length;x--;){o[F=r[b[x]]]=[],r.splice(b[x],1)}var E=!0,S=!1,A=void 0;try{for(var D,C=_[Symbol.iterator]();!(E=(D=C.next()).done);E=!0){var F;i[F=D.value]=i[F].filter(function(e){return!g.includes(e)})}}catch(e){S=!0,A=e}finally{try{!E&&C.return&&C.return()}finally{if(S)throw A}}v.push(g)}return v}function reduce$1(e,t,r,n,i,o){function s(r){if(!(a.indexOf(r)>-1)){n=e.call(o,n,r,u++),a=a.concat([r]);withoutAll(t[r]||[],a).forEach(function(e){return s(e)})}}var a=i||[],u=0;return s(r),n}function random$1(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t={},r=range(1,e).map(String),n=0;n<r.length;n++){var i=Math.floor(Math.random()*e);t[r[n]]=shuffle(r).slice(0,i)}return t}function isInterval(e){return Array.isArray(e)&&e.length>=2&&e[0]<=e[1]}function sort$2(e){return e.sort(compare)}function compare(e,t){return e[0]<t[0]?e[1]<t[0]?-3:e[1]===t[0]?-2:-1:e[0]===t[0]?e[1]===t[1]?0:e[1]<t[1]?-1:1:-1*compare(t,e)}function coalesce(e,t,r){switch(this.compare(e,t)){case-3:case 3:return null;case 0:return r&&r(e,t,e),e;case 2:case 1:var n=e;e=t,t=n;case-2:case-1:var i=[e[0],Math.max(e[1],t[1])];return r&&r(e,t,i),i;default:throw new Error("Interval compare failed")}}function coalesceOverlapping(e,t){for(var r=[],n=e.length;n>0;){var i=e.shift();n--;for(var o=0;o<n;o++){var s=coalesce(i,e[o],t);s&&(i=s,e.splice(o,1),n--,o--)}r.push(i)}return this.sort(r)}function mergeOverlapping(e,t,r){for(var n=[];e.length>0;){var i=e.shift(),o=t.map(function(e){var t=compare(i,e);return-1===t||0===t||1===t});n.push(r(i,o[0])),n.push(i)}return n}function intervalsInRangeDo(e,t,r,n,i,o){o=o||GLOBAL$2,r=this.sort(r);for(var s,a=[];s=r.shift();)if(!(s[1]<e)){s[0]<e&&((s=Array.prototype.slice.call(s))[0]=e);var u=t<s[0]?t:s[0];if(e<u&&a.push(n.call(o,[e,u],!0)),t<s[1]&&((s=Array.prototype.slice.call(s))[1]=t),s[0]===s[1]){var c;i&&(c=a.slice(-1)[0])&&i.call(o,c,s,c)}else a.push(n.call(o,s,!1));if((e=s[1])>=t)break}return e<t&&a.push(n.call(o,[e,t],!0)),a}function intervalsInbetween(e,t,r){return intervalsInRangeDo(e,t,coalesceOverlapping(Array.prototype.slice.call(r)),function(e,t){return t?e:null}).filter(Boolean)}function mapToMatchingIndexes(e,t){var r,n,i=0;return t.map(function(t){for(;(n=e[i])&&n[0]<t[0];)i++;if(n&&n[0]===t[0]){for(r=i;(n=e[r])&&n[1]<t[1];)r++;if(n&&n[1]===t[1])return range(i,r)}return[]})}function create(e,t,r){var n=r||0;return n+t>e.length&&(n-=n+t-e.length),{array:e,from:n,to:n+t}}function toArray$4(e){return e.array.slice(e.from,e.to)}function originalToProjectedIndex(e,t){return t<e.from||t>=e.to?null:t-e.from}function projectedToOriginalIndex(e,t){return t<0||t>e.to-e.from?null:e.from+t}function transformToIncludeIndex(e,t){if(!(t in e.array))return null;var r=0;return t<e.from&&(r=-e.from+t),t>=e.to&&(r=t-e.to+1),0===r?e:create(e.array,e.to-e.from,e.from+r)}function get$2(e,t,r){var n=e[t];return n?n[r]:void 0}function set$2(e,t,r,n){var i=e[t];return i&&(i[r]=n),n}function getRow(e,t){return e[t]}function setRow(e,t,r){return e[t]=r}function getCol(e,t){return e.reduce(function(e,r){return e.push(r[t]),e},[])}function setCol(e,t,r){return e.map(function(e,n){return e[t]?e[t]=r[n]:void 0})}function create$1(e,t,r){for(var n=new Array(e);e>0;)n[--e]=withN(t,r);return n}function mapCreate(e,t,r,n){for(var i=new Array(e),o=0;o<e;o++){i[o]=new Array(t);for(var s=0;s<t;s++)i[o][s]=r.call(n||this,o,s)}return i}function forEach$2(e,t,r){e.forEach(function(e,n){e.forEach(function(e,i){t.call(r||this,e,n,i)})})}function map$2(e,t,r){var n=new Array(e.length);return e.forEach(function(e,i){n[i]=new Array(e.length),e.forEach(function(e,o){n[i][o]=t.call(r||this,e,i,o)})}),n}function toObjects(e){for(var t=e[0],r=new Array(e.length-1),n=1;n<e.length;n++)for(var i=r[n-1]={},o=0;o<t.length;o++)i[t[o]]=e[n][o];return r}function tableFromObjects(e,t){Array.isArray(e)||(e=[e]);var r=[[]],n=r[0],i=e.reduce(function(e,t){return e.concat([Object.keys(t).reduce(function(e,r){var i=n.indexOf(r);return-1===i&&(i=n.length,n.push(r)),e[i]=t[r],e},[])])},[]);return t=1===arguments.length?null:t,i.forEach(function(e){for(var r=0;r<n.length;r++)e[r]||(e[r]=t)}),r.concat(i)}function prewalk(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{i:0},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=n.i++;t(e,o,i),(r(e,o,i)||[]).forEach(function(e){return prewalk(e,t,r,n,i+1)})}function postwalk(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{i:0},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=n.i++;(r(e,o,i)||[]).forEach(function(e){return postwalk(e,t,r,n,i)}),t(e,o,i)}function find(e,t,r){if(t(e))return e;var n=r(e);if(n&&n.length)for(var i=0;i<n.length;i++){var o=find(n[i],t,r);if(o)return o}}function filter$1(e,t,r){var n=[];return t(e)&&n.push(e),n.concat(flatten((r(e)||[]).map(function(e){return filter$1(e,t,r)})))}function map$3(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return[t(e,n)].concat(flatten((r(e)||[]).map(function(e){return map$3(e,t,r,n+1)})))}function mapTree(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=(r(e)||[]).map(function(e){return mapTree(e,t,r,n+1)});return t(e,i,n)}function create$2(e){var t=[{name:"send",args:["msg","callback"]},{name:"listen",args:["messenger","callback"]},{name:"close",args:["messenger","callback"]},{name:"isOnline",args:[]}],r=t.map(function(e){return e.name}).concat(["id","sendHeartbeat","heartbeatInterval","ignoreUnknownMessages","allowConcurrentSends","sendTimeout","services"]);t.forEach(function(t){if(!e[t.name]){var r="message implementation needs function "+t.name+"("+t.args.join(",")+")";throw new Error(r)}});var n=e.sendHeartbeat&&(e.heartbeatInterval||1e3),i=!!e.hasOwnProperty("ignoreUnknownMessages")&&e.ignoreUnknownMessages,o={_outgoing:[],_inflight:[],_id:e.id||newUUID(),_ignoreUnknownMessages:i,_services:{},_messageCounter:0,_messageResponseCallbacks:{},_whenOnlineCallbacks:[],_statusWatcherProc:null,_startHeartbeatProcessProc:null,_listenInProgress:null,_heartbeatInterval:n,_status:OFFLINE,_runWhenOnlineCallbacks:function(){var e=o._whenOnlineCallbacks.slice();o._whenOnlineCallbacks=[],e.forEach(function(e){try{e.call(null,null,o)}catch(e){console.error("error in _runWhenOnlineCallbacks: %s",e)}})},_ensureStatusWatcher:function(){o._statusWatcherProc||(o._statusWatcherProc=setInterval(function(){o.isOnline()&&o._whenOnlineCallbacks.length&&o._runWhenOnlineCallbacks();var e=o._status;o._status=o.isOnline()?ONLINE:OFFLINE,o._status!==ONLINE&&o._statusWatcherProc&&o.reconnect(),o._status!==e&&o.onStatusChange&&o.onStatusChange()},20))},_addMissingData:function(e){if(!e.target)throw new Error("Message needs target!");if(!e.action)throw new Error("Message needs action!");return e.data||(e.data=null),e.messageId||(e.messageId=newUUID()),e.sender=o.id(),e.messageIndex=o._messageCounter++,e},_queueSend:function(e,t){if(t&&"function"!=typeof t)throw new Error("Expecing a when send callback, got: "+t);o._outgoing.push([e,t])},_deliverMessageQueue:function(){function t(t){if(-1!==o._inflight.indexOf(t)){var n=t[0],i=t[1];i&&(o._messageResponseCallbacks[n.messageId]=i),e.send.call(o,n,function(e){remove(o._inflight,t),e&&r(e,t),o._deliverMessageQueue()})}}function r(e,t){var r=t[0],n=t[1];delete o._messageResponseCallbacks[r.messageId],console.error(e),n&&n(e)}if(e.allowConcurrentSends||!o._inflight.length){var n=o._outgoing.shift();n&&(o._inflight.push(n),o.isOnline()?t(n):o.whenOnline(function(){t(n)}),function(t){"number"==typeof e.sendTimeout&&setTimeout(function(){-1!==o._inflight.indexOf(t)&&(remove(o._inflight,t),r(new Error("Timeout sending message"),t),o._deliverMessageQueue())},e.sendTimeout)}(n),e.allowConcurrentSends&&o._outgoing.length&&o._deliverMessageQueue())}},_startHeartbeatProcess:function(){o._startHeartbeatProcessProc||(o._startHeartbeatProcessProc=setTimeout(function(){e.sendHeartbeat.call(o,function(e,t){o._startHeartbeatProcessProc=null,o._startHeartbeatProcess()})},o._heartbeatInterval))},id:function(){return o._id},isOnline:function(){return e.isOnline.call(o)},heartbeatEnabled:function(){return"number"==typeof o._heartbeatInterval},listen:function(t){if(!o._listenInProgress)return o._listenInProgress=!0,o._ensureStatusWatcher(),e.listen.call(o,function(e){o._listenInProgress=null,t&&t(e),o.heartbeatEnabled()&&o._startHeartbeatProcess()})},reconnect:function(){if(o._status!==ONLINE)return o.listen(),o},send:function(e,t){return o._addMissingData(e),o._queueSend(e,t),o._deliverMessageQueue(),e},sendTo:function(e,t,r,n){var i={target:e,action:t,data:r};return o.send(i,n)},onMessage:function(e){if(o.emit("message",e),e.inResponseTo){var t=o._messageResponseCallbacks[e.inResponseTo];t&&!e.expectMoreResponses&&delete o._messageResponseCallbacks[e.inResponseTo],t&&t(null,e)}else{var r=o._services[e.action];if(r)try{r.call(null,e,o)}catch(t){var n=String(t.stack||t);console.error("Error invoking service: "+n),o.answer(e,{error:n})}else if(!o._ignoreUnknownMessages){var i=new Error("messageNotUnderstood: "+e.action);o.answer(e,{error:String(i)})}}},answer:function(e,t,r,n){"function"==typeof r&&(n=r,r=!1);var i={target:e.sender,action:e.action+"Result",inResponseTo:e.messageId,data:t};return r&&(i.expectMoreResponses=!0),o.send(i,n)},close:function(t){return clearInterval(o._statusWatcherProc),o._statusWatcherProc=null,e.close.call(o,function(e){o._status=OFFLINE,t&&t(e)}),o},whenOnline:function(e){return o._whenOnlineCallbacks.push(e),o.isOnline()&&o._runWhenOnlineCallbacks(),o},outgoingMessages:function(){return pluck(o._inflight.concat(o._outgoing),0)},addServices:function(e){return Object.assign(o._services,e),o}};e.services&&o.addServices(e.services),makeEmitter(o);for(var s in e)-1===r.indexOf(s)&&e.hasOwnProperty(s)&&(o[s]=e[s]);return o}function fork(e,t,r){r||(r=t,t=e,e=null);var n=(e=e||{}).args||[],i=create$3(e);return i.run.apply(i,[t].concat(n).concat(r)),i}function create$3(e){(e=e||{}).useMessenger=!0;var t=e.workerId||newUUID(),r=create$2({sendTimeout:5e3,send:function(e,t){r.worker.postMessage(e),t()},listen:function(t){var n=r.worker=isNodejs?NodejsWorker.create(e):BrowserWorker.create(e);n.on("message",function(e){r.onMessage(e)}),n.on("ready",function(){NodejsWorker.debug&&console.log("WORKER READY!!!")}),n.on("close",function(){NodejsWorker.debug&&console.log("WORKER CLOSED...!!!")}),n.once("ready",t)},close:function(e){return r.worker.ready?r.sendTo(t,"close",{},function(t,n){if((t=t||n.data.error)&&console.error("Error in worker messenger close: "+t.stack||t),t)e(t);else{var i=!1;r.worker.once("close",function(){i=!0}),waitFor(1e3,function(){return!!i},e)}}):e(null)},isOnline:function(){return r.worker&&r.worker.ready}});return Object.assign(r,{eval:function(e,n){r.sendTo(t,"remoteEval",{expr:e},function(e,t){n(e,t?t.data.result:null)})},run:function(){var e=Array.prototype.slice.call(arguments),n=e.shift(),i=e.pop();if("function"!=typeof n)throw new Error("run: no function that should run in worker passed");if("function"!=typeof i)throw new Error("run: no callback passed");return r.sendTo(t,"run",{func:String(n),args:e},function(e,t){i(e||t.data.error,t?t.data.result:null)})}}),r.listen(),r}function createLivelyLangObject(){return{chain:chain$$1,noConflict:noConflict,installGlobals:installGlobals,uninstallGlobals:uninstallGlobals,globalInterfaceSpec:globalInterfaceSpec,toString:function(){return"[object lively.lang]"}}}function chain$$1(e){if(!e)return e;if(Array.isArray(e))return createChain(arr,e);if("Date"===e.constructor.name)return createChain(date,e);switch(void 0===e?"undefined":_typeof(e)){case"string":return createChain(string,e);case"object":return createChain(obj,e);case"function":return createChain(fun,e);case"number":return createChain(num,e)}throw new Error("Chain for object "+e+" ("+e.constructor.name+") no supported")}function createChain(e,t){return Object.keys(e).reduce(function(r,n){return r[n]=function(){var r=Array.prototype.slice.call(arguments);return chain$$1(e[n].apply(null,[t].concat(r)))},r},{value:function(){return t}})}function noConflict(){if(!isNode){livelyLang._prevLivelyGlobal?delete GLOBAL.lively.lang:delete GLOBAL.lively}return livelyLang}function installGlobals(){Object.assign(livelyLang,{worker:worker,messenger:messenger,events:events,tree:tree,grid:grid,arrayProjection:arrayProjection,interval:interval,graph:graph,date:date,properties:properties,obj:obj,arr:arr,fun:fun,num:num,string:string,Closure:Closure,promise:promise,Path:Path,Group:Group}),globalInterfaceSpec.forEach(function(e){if("installMethods"===e.action){(r=Path(e.target)).isIn(GLOBAL)||r.set(GLOBAL,{},!0);var t=Path(e.sources[0]);e.methods.forEach(function(e){installProperty(t.concat([e]),r.concat([e]))}),e.alias&&e.alias.forEach(function(e){installProperty(t.concat([e[1]]),r.concat([e[0]]))})}else{if("installObject"!==e.action)throw new Error("Cannot deal with global setup action: "+e.action);var r=Path(e.target),n=Path(e.source).get(livelyLang);r.set(GLOBAL,n,!0)}})}function installProperty(e,t){if(!e.isIn(livelyLang)){var r=new Error("property not provided by lively.lang: "+e);throw console.error(r.stack||r),r}var n=e.get(livelyLang);if("function"==typeof n&&"prototype"===t.slice(-2,-1).toString()){var i=n;(n=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this),i.apply(null,e)}).toString=function(){return i.toString()}}t.set(GLOBAL,n,!0)}function uninstallGlobals(){globalInterfaceSpec.forEach(function(e){if("installMethods"===e.action){var t=Path(e.target),r=Path(e.source).get(livelyLang),n=t.get(GLOBAL);if(!n)return;e.methods.filter(function(e){return r===n[e]}).forEach(function(e){delete n[e]}),e.alias&&e.alias.filter(function(e){return r===n[e]}).forEach(function(e){delete n[e[0]]})}else{if("installObject"!==e.action)throw new Error("Cannot deal with global setup action: "+e.action);(t=Path(e.target)).del(GLOBAL)}})}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),get$1=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(n)},set$1=function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var s=Object.getPrototypeOf(t);null!==s&&e(s,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var a=o.set;void 0!==a&&a.call(i,n)}return n},slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},parameterRegex=/function[^\(]*\(([^\)]*)\)|\(?([^\)=]*)\)?\s*=>/,Closure=function(){function e(t,r,n,i){classCallCheck(this,e),this.originalFunc=t,this.varMapping=r||{},this.setFuncSource(n||t),this.setFuncProperties(t||i)}return createClass(e,null,[{key:"fromFunction",value:function(e,t){return new this(e,t||{})}},{key:"fromSource",value:function(e,t){return new this(null,t||{},e)}}]),createClass(e,[{key:"setFuncSource",value:function(e){return e="undefined"!=typeof lively&&lively.sourceTransform&&"function"==typeof lively.sourceTransform.stringifyFunctionWithoutToplevelRecorder?lively.sourceTransform.stringifyFunctionWithoutToplevelRecorder(e):String(e),this.source=e}},{key:"getFuncSource",value:function(){return this.source||this.setFuncSource(this.originalFunc)}},{key:"hasFuncSource",value:function(){return this.source&&!0}},{key:"getFunc",value:function(){return this.originalFunc||this.recreateFunc()}},{key:"getFuncProperties",value:function(){return this.funcProperties||(this.funcProperties={})}},{key:"setFuncProperties",value:function(e){var t=this.getFuncProperties();for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])}},{key:"lookup",value:function(e){return this.varMapping[e]}},{key:"parameterNames",value:function(e){if("undefined"!=typeof lively&&lively.ast)return(lively.ast.parseFunction(e).params||[]).map(function(e){return"Identifier"===e.type?e.name:e.left&&"Identifier"===e.left.type?e.left.name:null}).filter(Boolean);var t=parameterRegex.exec(e);if(!t)return[];return(t[1]||t[2]||"").split(",").map(function(e){return e.trim()})}},{key:"firstParameter",value:function(e){return this.parameterNames(e)[0]||null}},{key:"recreateFunc",value:function(){return this.recreateFuncFromSource(this.getFuncSource(),this.originalFunc)}},{key:"recreateFuncFromSource",value:function(e,t){var r=[],n="$super"===this.firstParameter(e);for(var i in this.varMapping)this.varMapping.hasOwnProperty(i)&&("this"!=i?r.push("var "+i+" = this.varMapping."+i+";\n"):!0);var o="";r.length>0&&(o+=r.join("\n")),n&&(o+="(function superWrapperForClosure() { return "),o+="("+e+")",n&&(o+=".apply(this, [$super.bind(this)].concat(Array.from(arguments))) })");try{var s=evalJS.call(this,o)||this.couldNotCreateFunc(o);return this.addFuncProperties(s),this.originalFunc=s,s}catch(e){var a="Cannot create function "+e+" src: "+o;throw console.error(a),new Error(a)}}},{key:"addFuncProperties",value:function(e){var t=this.getFuncProperties();for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);this.addClosureInformation(e)}},{key:"couldNotCreateFunc",value:function(e){var t="Could not recreate closure from source: \n"+e;return console.error(t),function(){throw new Error(t)}}},{key:"asFunction",value:function(){return this.recreateFunc()}},{key:"addClosureInformation",value:function(e){return e.hasLivelyClosure=!0,e.livelyClosure=this,e}},{key:"isLivelyClosure",get:function(){return!0}},{key:"doNotSerialize",get:function(){return["originalFunc"]}}]),e}(),_throttledByName={},_debouncedByName={},_queues={},_queueUntilCallbacks={},_eitherNameRegistry={},fun=Object.freeze({Empty:Empty,K:K,Null:Null,False:False,True:True,notYetImplemented:notYetImplemented,withNull:withNull,all:all,own:own,argumentNames:argumentNames,qualifiedMethodName:qualifiedMethodName,extractBody:extractBody,timeToRun:timeToRun,timeToRunN:timeToRunN$1,delay:delay,throttle:throttle,debounce:debounce,throttleNamed:throttleNamed,debounceNamed:debounceNamed,createQueue:createQueue,workerWithCallbackQueue:workerWithCallbackQueue,composeAsync:composeAsync,compose:compose,waitFor:waitFor,waitForAll:waitForAll,flip:flip,curry:curry,wrap:wrap,binds:binds,getOriginal:getOriginal,wrapperChain:wrapperChain,replaceMethodForOneCall:replaceMethodForOneCall,once:once,either:either,eitherNamed:eitherNamed,evalJS:evalJS,fromString:fromString,asScript:asScript,asScriptOf:asScriptOf,addToObject:addToObject,setLocalVarValue:setLocalVarValue,getVarMapping:getVarMapping,setProperty:setProperty,functionNames:functionNames,localFunctionNames:localFunctionNames,logErrors:logErrors,logCompletion:logCompletion,logCalls:logCalls,traceCalls:traceCalls,webkitStack:webkitStack}),Group=function(){function e(){classCallCheck(this,e)}return createClass(e,[{key:"toArray",value:function(){return this.reduceGroups(function(e,t,r){return e.concat([r])},[])}},{key:"forEach",value:function(e,t){var r=this;return Object.keys(r).forEach(function(n){r[n].forEach(e.bind(t,n))}),r}},{key:"forEachGroup",value:function(e,t){var r=this;return Object.keys(r).forEach(function(n){e.call(t,n,r[n])}),r}},{key:"map",value:function(t,r){var n=new e;return this.forEachGroup(function(e,i){n[e]=i.map(t.bind(r,e))}),n}},{key:"mapGroups",value:function(t,r){var n=new e;return this.forEachGroup(function(e,i){n[e]=t.call(r,e,i)}),n}},{key:"keys",value:function(){return Object.keys(this)}},{key:"reduceGroups",value:function(e,t,r){return this.forEachGroup(function(n,i){t=e.call(r,t,n,i)}),t}},{key:"count",value:function(){return this.reduceGroups(function(e,t,r){return e[t]=r.length,e},{})}}],[{key:"fromArray",value:function(t,r,n){for(var i=new e,o=0,s=t.length;o<s;o++){var a=r.call(n,t[o],o);i[a]||(i[a]=[]),i[a].push(t[o])}return i}},{key:"by",get:function(){return groupBy}}]),e}(),GLOBAL$1="undefined"!=typeof System?System.global:"undefined"!=typeof window?window:global,features$1={from:!!Array.from,filter:!!Array.prototype.filter,find:!!Array.prototype.find,findIndex:!!Array.prototype.findIndex,includes:!!Array.prototype.includes},from=features$1.from?Array.from:function(e){if(!e)return[];if(Array.isArray(e))return e;if(e.toArray)return e.toArray();for(var t=e.length,r=new Array(t);t--;)r[t]=e[t];return r},detect=features$1.find?function(e,t,r){return e.find(t,r)}:function(e,t,r){for(var n,i=0,o=e.length;i<o;i++)if(n=e[i],t.call(r,n,i))return n},findIndex=features$1.findIndex?function(e,t,r){return e.findIndex(t,r)}:function(e,t,r){var n=-1;return e.find(function(e,i){return n=i,t.call(e,r)})?n:-1},isArray$1=Array.isArray,includes$1=features$1.includes?function(e,t){return e.includes(t)}:function(e,t){return-1!==e.indexOf(t)},include$1=includes$1,permutations=function(){function e(t,r){return t.length?flatmap(t,function(n,i){return e(t.slice(0,i).concat(t.slice(i+1)),r.concat([n]))}):[r]}return function(t){return e(t,[])}}();features$1.from||(Array.from=from),features$1.filter||(Array.prototype.filter=function(e,t){return filter(this,e,t)}),features$1.find||(Array.prototype.find=function(e,t){return detect(this,e,t)}),features$1.findIndex||(Array.prototype.findIndex=function(e,t){return findIndex(this,e,t)}),features$1.includes||(Array.prototype.includes=function(e){return includes$1(this,e)});var arr=Object.freeze({range:range,from:from,withN:withN,genN:genN,filter:filter,detect:detect,findIndex:findIndex,findAndGet:findAndGet,filterByKey:filterByKey,grep:grep,mask:mask,reject:reject,rejectByKey:rejectByKey,without:without,withoutAll:withoutAll,uniq:uniq,uniqBy:uniqBy,uniqByKey:uniqByKey,compact:compact,mutableCompact:mutableCompact,forEach:forEach$1,zip:zip,flatten:flatten,flatmap:flatmap,interpose:interpose,delimWith:delimWith,map:map$1,invoke:invoke,pluck:pluck,reduce:reduce,reduceRight:reduceRight,isArray:isArray$1,includes:includes$1,include:include$1,some:some,every:every,equals:equals$2,deepEquals:deepEquals,isSorted:isSorted,sort:sort,sortBy:sortBy,sortByKey:sortByKey,reverse:reverse,reversed:reversed,reMatches:reMatches$1,first:first,last:last,intersect:intersect,union:union,pushAt:pushAt,removeAt:removeAt,remove:remove,pushAll:pushAll$1,pushAllAt:pushAllAt,pushIfNotIncluded:pushIfNotIncluded,replaceAt:replaceAt,clear:clear,isSubset:isSubset,doAndContinue:doAndContinue,nestedDelay:nestedDelay,forEachShowingProgress:forEachShowingProgress,swap:swap,rotate:rotate,groupBy:groupBy,groupByKey:groupByKey,partition:partition,batchify:batchify,toTuples:toTuples,permutations:permutations,combinationsPick:combinationsPick,combinations:combinations,take:take,drop:drop,takeWhile:takeWhile,dropWhile:dropWhile,shuffle:shuffle,max:max,min:min,sum:sum,count:count$1,size:size$1,histogram:histogram,clone:clone$1,toArray:toArray$3,each:each,all:all$1,any:any,collect:collect,findAll:findAll,inject:inject,mapAsyncSeries:mapAsyncSeries,mapAsync:mapAsync}),getOwnPropertyDescriptors="function"==typeof Object.prototype.getOwnPropertyDescriptors?Object.prototype.getOwnPropertyDescriptors:function(e){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&Object.defineProperty(t,r,{configurable:!0,enumerable:!0,writable:!0,value:Object.getOwnPropertyDescriptor(e,r)});return t},keys$1=Object.keys,obj=Object.freeze({isArray:isArray$$1,isElement:isElement,isFunction:isFunction,isBoolean:isBoolean,isString:isString,isNumber:isNumber,isUndefined:isUndefined,isRegExp:isRegExp,isObject:isObject,isPrimitive:isPrimitive,isEmpty:isEmpty,equals:equals$1,keys:keys$1,values:values,select:select,dissoc:dissoc,addScript:addScript,extend:extend,clone:clone$$1,extract:extract,inspect:inspect,merge:merge,deepMerge:deepMerge,inherit:inherit,valuesInPropertyHierarchy:valuesInPropertyHierarchy,mergePropertyInHierarchy:mergePropertyInHierarchy,sortKeysWithBeforeAndAfterConstraints:sortKeysWithBeforeAndAfterConstraints,deepCopy:deepCopy,typeStringOf:typeStringOf,shortPrintStringOf:shortPrintStringOf,isMutableType:isMutableType,safeToString:safeToString,asObject:asObject,newKeyIn:newKeyIn}),features={repeat:!!String.prototype.repeat,includes:!!String.prototype.includes,startsWith:!!String.prototype.startsWith,endsWith:!!String.prototype.endsWith},pathDotRe=/\/\.\//g,pathDoubleDotRe=/\/[^\/]+\/\.\./,pathDoubleSlashRe=/(^|[^:])[\/]+/g,urlStartRe=/^[a-z0-9-_\.]+:\/\//,newUUIDTemplate="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",newUUIDRe=/[xy]/g,newUUIDReplacer=function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)},includes$$1=features.includes?function(e,t){return e.includes(t)}:function(e,t){return e.indexOf(t)>-1},include$$1=includes$$1,startsWith=features.startsWith?function(e,t){return e.startsWith(t)}:function(e,t){return 0===e.indexOf(t)},endsWith=features.endsWith?function(e,t){return e.endsWith(t)}:function(e,t){var r=e.length-t.length;return r>=0&&e.lastIndexOf(t)===r},times=features.repeat?function(e,t){return e.repeat(t)}:function(e,t){return t<1?"":new Array(t+1).join(e)},string=Object.freeze({format:format,formatFromArray:formatFromArray,indent:indent,minIndent:minIndent,changeIndent:changeIndent,quote:quote,print:print,printNested:printNested,pad:pad,printTable:printTable,printTree:printTree,toArray:toArray$1,lines:lines,paragraphs:paragraphs,nonEmptyLines:nonEmptyLines,tokens:tokens,tableize:tableize,unescapeCharacterEntities:unescapeCharacterEntities,toQueryParams:toQueryParams,normalizePath:normalizePath$1,joinPath:joinPath,newUUID:newUUID,createDataURI:createDataURI,hashCode:hashCode,md5:md5,reMatches:reMatches$$1,stringMatch:stringMatch,peekRight:peekRight,peekLeft:peekLeft,lineIndexComputer:lineIndexComputer,lineNumberToIndexesComputer:lineNumberToIndexesComputer,findLineWithIndexInLineRanges:findLineWithIndexInLineRanges,regexIndexOf:regexIndexOf,regexLastIndexOf:regexLastIndexOf,lineRanges:lineRanges,diff:diff,empty:empty,includes:includes$$1,include:include$$1,startsWith:startsWith,startsWithVowel:startsWithVowel,endsWith:endsWith,withDecimalPrecision:withDecimalPrecision,capitalize:capitalize,camelCaseString:camelCaseString,camelize:camelize,truncate:truncate,truncateLeft:truncateLeft,regExpEscape:regExpEscape,succ:succ,digitValue:digitValue,times:times,longestCommonSubstring:longestCommonSubstring,applyChange:applyChange,applyChanges:applyChanges,levenshtein:levenshtein}),normalRandom=function(e,t){var r,n=!1;return function(e,t){if(n)return n=!1,r*t+e;var i,o,s;do{s=(i=2*Math.random()-1)*i+(o=2*Math.random()-1)*o}while(s>=1||0==s);var a=Math.sqrt(-2*Math.log(s)/s);return r=o*a,n=!0,e+t*i*a}}(),convertLength=function(){function e(t,r){return"cm"===r?t:"mm"===r?.1*t:"in"===r?2.54*t:"px"===r?t*e(1/96,"in"):"pt"===r?t*e(1/72,"in"):"pc"===r?t*e(12,"pt"):void 0}return function t(r,n,i){return n===i?r:"cm"===i?e(r,n):"cm"===n?r/e(1,i):t(t(r,n,"cm"),"cm",i)}}(),num=Object.freeze({random:random,normalRandom:normalRandom,randomSmallerInteger:randomSmallerInteger,humanReadableByteSize:humanReadableByteSize,average:average,averageInc:averageInc,median:median,between:between,sort:sort$1,parseLength:parseLength,convertLength:convertLength,roundTo:roundTo,detent:detent,toDegrees:toDegrees,toRadians:toRadians,backoff:backoff}),properties=Object.freeze({all:all$2,allOwnPropertiesOrFunctions:allOwnPropertiesOrFunctions,own:own$1,forEachOwn:forEachOwn,nameFor:nameFor,values:values$1,ownValues:ownValues,any:any$1,allProperties:allProperties,hash:hash}),dateFormat=function(){var e=function(){var t=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,r=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,i=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e};return function(o,s,a){var u=e;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(o)||/\d/.test(o)||(s=o,o=void 0),o=o?new Date(o):new Date,isNaN(o))throw SyntaxError("invalid date");"UTC:"==(s=String(u.masks[s]||s||u.masks.default)).slice(0,4)&&(s=s.slice(4),a=!0);var c=a?"getUTC":"get",l=o[c+"Date"](),f=o[c+"Day"](),p=o[c+"Month"](),h=o[c+"FullYear"](),d=o[c+"Hours"](),m=o[c+"Minutes"](),v=o[c+"Seconds"](),y=o[c+"Milliseconds"](),g=a?0:o.getTimezoneOffset(),b={d:l,dd:i(l),ddd:u.i18n.dayNames[f],dddd:u.i18n.dayNames[f+7],m:p+1,mm:i(p+1),mmm:u.i18n.monthNames[p],mmmm:u.i18n.monthNames[p+12],yy:String(h).slice(2),yyyy:h,h:d%12||12,hh:i(d%12||12),H:d,HH:i(d),M:m,MM:i(m),s:v,ss:i(v),l:i(y,3),L:i(y>99?Math.round(y/10):y),t:d<12?"a":"p",tt:d<12?"am":"pm",T:d<12?"A":"P",TT:d<12?"AM":"PM",Z:a?"UTC":(String(o).match(r)||[""]).pop().replace(n,""),o:(g>0?"-":"+")+i(100*Math.floor(Math.abs(g)/60)+Math.abs(g)%60,4),S:["th","st","nd","rd"][l%10>3?0:(l%100-l%10!=10)*l%10]};return s.replace(t,function(e){return e in b?b[e]:e.slice(1,e.length-1)})}}();return e.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},e.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},e}(),date=Object.freeze({format:format$1,equals:equals$3,relativeTo:relativeTo});Object.assign(promise,{delay:delay$1,delayReject:delayReject,timeout:timeout,waitFor:waitFor$1,deferred:deferred,convertCallbackFun:convertCallbackFun,convertCallbackFunWithManyArgs:convertCallbackFunWithManyArgs,chain:chain$1,finally:promise_finally,parallel:parallel}),Object.assign(Path.prototype,{get isPathAccessor(){return!0},fromPath:function(e){return"string"==typeof e&&""!==e&&e!==this.splitter?(this._parts=e.split(this.splitter),this._path=e):Array.isArray(e)?(this._parts=[].concat(e),this._path=e.join(this.splitter)):(this._parts=[],this._path=""),this},setSplitter:function(e){return e&&(this.splitter=e),this},parts:function(){return this._parts},size:function(){return this._parts.length},slice:function(e,t){return Path(this.parts().slice(e,t))},normalizePath:function(){return this._path},isRoot:function(e){return 0===this._parts.length},isIn:function(e){if(this.isRoot())return!0;var t=this.get(e,-1);return t&&t.hasOwnProperty(this._parts[this._parts.length-1])},equals:function(e){return e&&e.isPathAccessor&&this.parts().equals(e.parts())},isParentPathOf:function(e){e=e&&e.isPathAccessor?e:Path(e);for(var t=this.parts(),r=e.parts(),n=0;n<t.length;n++)if(t[n]!=r[n])return!1;return!0},relativePathTo:function(e){return e=Path(e),this.isParentPathOf(e)?e.slice(this.size(),e.size()):void 0},del:function(e){if(this.isRoot())return!1;for(var t=e,r=0;r<this._parts.length-1;r++){var n=this._parts[r];if(!t.hasOwnProperty(n))return!1;t=t[n]}return delete t[this._parts[this._parts.length-1]]},withParentAndKeyDo:function(e,t,r){if(this.isRoot())return r(null,null);for(var n=e,i=0;i<this._parts.length-1;i++){var o=this._parts[i];if(!n.hasOwnProperty(o)||"object"!==_typeof(n[o])&&"function"!=typeof n[o]){if(!t)return r(null,o);n=n[o]={}}else n=n[o]}return r(n,this._parts[this._parts.length-1])},set:function(e,t,r){return this.withParentAndKeyDo(e,r,function(e,r){return e?e[r]=t:void 0})},defineProperty:function(e,t,r){return this.withParentAndKeyDo(e,r,function(e,r){return e?Object.defineProperty(e,r,t):void 0})},get:function(e,t){return(t?this._parts.slice(0,t):this._parts).reduce(function(e,t){return e?e[t]:e},e)},concat:function(e,t){return Path(this.parts().concat(Path(e,t).parts()))},toString:function(){return this.normalizePath()},serializeExpr:function(){return"lively.lang.Path("+inspect(this.parts())+")"},watch:function(e){if(e&&!this.isRoot()){var t=e.target,r=this.get(t,-1),n=this.parts().slice(-1)[0],i="propertyWatcher$"+n,o=r&&r.hasOwnProperty(i),s=e.uninstall,a=(e.haltWhenChanged,e.showStack),u=r.__lookupGetter__(n),c=r.__lookupSetter__(n);if(t&&n&&r)if(s){if(!o)return;delete r[n],r[n]=r[i],delete r[i];var l="Watcher for "+r+"."+n+" uninstalled";show(l)}else if(o){l="Watcher for "+r+"."+n+" already installed";show(l)}else{if(u||c){l=r+'["'+n+'"] is a getter/setter, watching not support';return console.log(l),void("undefined"==typeof show&&show(l))}r[i]=r[n],r.__defineSetter__(n,function(t){var o=r[i];e.onSet&&e.onSet(t,o);var s=r+"."+n+" changed: "+o+" -> "+t;return a&&(s+="\n"+("undefined"!=typeof lively?lively.printStack():console.trace())),e.verbose&&(console.log(s),"undefined"!=typeof show&&show(s)),r[i]=t}),r.__defineGetter__(n,function(){return e.onGet&&e.onGet(r[i]),r[i]});l="Watcher for "+r+"."+n+" installed";console.log(l),"undefined"!=typeof show&&show(l)}}},debugFunctionWrapper:function(e){var t=e.target,r=this.get(t,-1),n=this.parts().slice(-1)[0],i=e.uninstall,o=(void 0===e.haltWhenChanged||e.haltWhenChanged,e.showStack),s=r&&n&&r[n],a=s&&s.isDebugFunctionWrapper;if(t&&n&&s&&r){if(i){if(!a)return;r[n]=r[n].debugTargetFunction;var u="Uninstalled debugFunctionWrapper for "+r+"."+n;return console.log(u),"undefined"!=typeof show&&show(u),void show(u)}if(a){u="debugFunctionWrapper for "+r+"."+n+" already installed";return console.log(u),void("undefined"!=typeof show&&show(u))}var c=r[n]=s.wrap(function(t){var i=Array.from(arguments);return o&&show(lively.printStack()),e.verbose&&show(n+" called"),i.shift().apply(r,i)});c.isDebugFunctionWrapper=!0,c.debugTargetFunction=s;u="debugFunctionWrapper for "+r+"."+n+" installed";console.log(u),"undefined"!=typeof show&&show(u)}}});var graph=Object.freeze({clone:clone$2,without:without$1,hull:hull,subgraphReachableBy:subgraphReachableBy,invert:invert,sortByReference:sortByReference,reduce:reduce$1,random:random$1}),GLOBAL$2="undefined"!=typeof System?System.global:"undefined"!=typeof window?window:global,interval=Object.freeze({isInterval:isInterval,sort:sort$2,compare:compare,coalesce:coalesce,coalesceOverlapping:coalesceOverlapping,mergeOverlapping:mergeOverlapping,intervalsInRangeDo:intervalsInRangeDo,intervalsInbetween:intervalsInbetween,mapToMatchingIndexes:mapToMatchingIndexes}),arrayProjection=Object.freeze({create:create,toArray:toArray$4,originalToProjectedIndex:originalToProjectedIndex,projectedToOriginalIndex:projectedToOriginalIndex,transformToIncludeIndex:transformToIncludeIndex}),grid=Object.freeze({get:get$2,set:set$2,getRow:getRow,setRow:setRow,getCol:getCol,setCol:setCol,create:create$1,mapCreate:mapCreate,forEach:forEach$2,map:map$2,toObjects:toObjects,tableFromObjects:tableFromObjects}),detect$1=find,tree=Object.freeze({prewalk:prewalk,postwalk:postwalk,find:find,detect:detect$1,filter:filter$1,map:map$3,mapTree:mapTree}),isNode$1="undefined"!=typeof process&&process.versions&&process.versions.node,makeEmitter=isNode$1?function(e,t){if(e.on&&e.removeListener)return e;var r="undefined"!=typeof System?System._nodeRequire("events"):require("events");return Object.assign(e,r.EventEmitter.prototype),r.EventEmitter.call(e),t&&t.maxListenerLimit&&e.setMaxListeners(t.maxListenerLimit),e}:function(e){return e.on&&e.removeListener?e:(e.listeners={},e.on=function(t,r){r&&(e.listeners[t]||(e.listeners[t]=[]),e.listeners[t].push(r))},e.once=function(t,r){function n(){e.removeListener(t,n),r.apply(this,arguments)}r&&e.on(t,n)},e.removeListener=function(t,r){e.listeners[t]&&(e.listeners[t]=e.listeners[t].filter(function(e){return e!==r}))},e.removeAllListeners=function(t){e.listeners[t]&&(e.listeners[t]=[])},e.emit=function(){var t=Array.prototype.slice.call(arguments),r=t.shift(),n=e.listeners[r];n&&n.length&&n.forEach(function(e){try{e.apply(null,t)}catch(e){console.error("Error in event handler: %s",e.stack||String(e))}})},e)},events=Object.freeze({makeEmitter:makeEmitter}),OFFLINE="offline",ONLINE="online",messenger=Object.freeze({create:create$2}),isNodejs="undefined"!=typeof require&&"undefined"!=typeof process,WorkerSetup={loadDependenciesBrowser:function(e){var t="undefined"!=typeof self?self:this;importScripts.apply(t,e.scriptsToLoad||[])},loadDependenciesNodejs:function(e){(global.lively||(global.lively={})).lang=require(require("path").join(e.libLocation,"index"))},initBrowserGlobals:function(e){remoteWorker.send=function(e){postMessage(e)};var t="undefined"!=typeof self?self:this,r=t.Global=t;r.window=r,r.console=r.console||function(){var e={};return["log","error","warn"].forEach(function(t){e[t]=function(){for(var e=arguments[0],r=1;r<arguments.length;r++)e=e.replace("%s",arguments[r]);remoteWorker.send({type:t,message:["[",t.toUpperCase(),"] ",e].join("")})}}),e}()},initOnMessageHandler:function(e){function t(e){if(e=e.data.data?e.data:e,remoteWorker.messenger)remoteWorker.messenger.onMessage(e);else if("close"==e.action)return remoteWorker.send({type:"closed",workerReady:!1}),void remoteWorker.close()}remoteWorker.on?remoteWorker.on("message",t):remoteWorker.onmessage=t},initWorkerInterface:function initWorkerInterface(options){remoteWorker.callStringifiedFunction=function(stringifiedFunc,args,thenDo){var func;try{func=eval("("+stringifiedFunc+")")}catch(e){return void thenDo(new Error("Cannot create function from string: "+e.stack||e))}var usesCallback=func.length===args.length+1,whenDone=lively.lang.fun.once(function(e,t){remoteWorker.isBusy=!1,thenDo(e,t)});remoteWorker.isBusy=!0,usesCallback&&args.push(whenDone);try{var result=func.apply(remoteWorker,args.concat([whenDone]))}catch(e){return void whenDone(e,null)}usesCallback||whenDone(null,result)},remoteWorker.httpRequest=function(e){if(e.url){var t=new XMLHttpRequest,r=e.method||"GET";t.onreadystatechange=function(){4===t.readyState&&e.done&&e.done(t)},t.open(r,e.url),t.send()}else console.log("Error, httpRequest needs url")},remoteWorker.terminateIfNotBusyIn=function(e){setTimeout(function(){remoteWorker.isBusy?remoteWorker.terminateIfNotBusyIn(e):(remoteWorker.send({type:"closed",workerReady:!1}),remoteWorker.close())},e)}},initWorkerMessenger:function initWorkerMessenger(options){if(!options.useMessenger)return null;if(!lively.lang.messenger)throw new Error("worker.create requires messenger.js to be loaded!");if(!lively.lang.events)throw new Error("worker.create requires events.js to be loaded!");return remoteWorker.messenger=lively.lang.messenger.create({services:{remoteEval:function remoteEval(msg,messenger){var result;try{result=eval(msg.data.expr)}catch(e){result=e.stack||e}messenger.answer(msg,{result:String(result)})},run:function(e,t){var r=e.data.func,n=e.data.args;r?remoteWorker.callStringifiedFunction(r,n,function(r,n){t.answer(e,{error:r?String(r):null,result:n})}):t.answer(e,{error:"no funcString"})},close:function(e,t){t.answer(e,{status:"OK"}),remoteWorker.send({type:"closed",workerReady:!1}),remoteWorker.close()}},isOnline:function(){return!0},send:function(e,t){remoteWorker.send(e),t()},listen:function(e){e()},close:function(e){remoteWorker.send({type:"closed",workerReady:!1}),remoteWorker.close()}})}},BrowserWorker={create:function(e){if(!(e=e||{}).libLocation&&!e.scriptsToLoad){var t=document.querySelector('script[src$="worker.js"]');if(!t)throw new Error('Cannot find library path to start worker. Use worker.create({libLocation: "..."}) to explicitly define the path!');e.libLocation=t.src.replace(/worker.js$/,"")}var r="("+String(function(){self.onmessage=function(e){if("setup"!==e.data.action)throw new Error("expected setup to be first message but got "+JSON.stringify(e.data));var t=e.data.options||{};initBrowserGlobals(t),loadDependenciesBrowser(t),initOnMessageHandler(t),initWorkerInterface(t),initWorkerMessenger(t),postMessage({workerReady:!0})},__FUNCTIONDECLARATIONS__}).replace("__FUNCTIONDECLARATIONS__",[WorkerSetup.initBrowserGlobals,WorkerSetup.loadDependenciesBrowser,WorkerSetup.initOnMessageHandler,WorkerSetup.initWorkerInterface,WorkerSetup.initWorkerMessenger].join("\n"))+")();",n=new Worker(function(e){var t;try{t=new Blob([e],{type:"text/javascript"})}catch(r){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,(t=new BlobBuilder).append(e),t=t.getBlob()}return("undefined"!=typeof webkitURL?webkitURL:URL).createObjectURL(t)}(r));return function(e,t){makeEmitter(t),e.scriptsToLoad||(e.scriptsToLoad=["base.js","events.js","object.js","collection.js","function.js","string.js","number.js","date.js","messenger.js","worker.js"].map(function(t){return e.libLocation+t}));var r=Object.keys(e).reduce(function(t,r){return"function"!=typeof e[r]&&(t[r]=e[r]),t},{});t.onmessage=function(e){void 0!==e.data.workerReady?(t.ready=!!e.data.workerReady,t.ready?t.emit("ready"):t.emit("close")):t.emit("message",e.data)},t.errors=[],t.onerror=function(e){console.error(e),t.errors.push(e),t.emit("error",e)},t.postMessage({action:"setup",options:r})}(e,n),n}},NodejsWorker={debug:!1,initCodeFileCreated:!1,create:function(e){e=e||{};var t,r=makeEmitter({ready:!1,errors:[],postMessage:function(e){t?r.ready?t.send(e):r.emit("error",new Error("nodejs worker process not ready or already closed")):r.emit("error",new Error("nodejs worker process not yet created"))}});return NodejsWorker.startWorker(e,function(e,n){if(e)return r.ready=!1,void r.emit("error",e);(t=n).on("message",function(e){NodejsWorker.debug&&console.log("[WORKER PARENT] got message:",e),r.emit("message",e)}),t.on("close",function(){console.log("[WORKER PARENT] worker closed"),r.emit("close")}),t.on("error",function(e){console.log("[WORKER PARENT] error ",e),r.errors.push(e),r.emit("error",e)}),r.ready=!0,r.emit("ready")}),r},workerSetupFunction:function(){var e=process;console.log("[WORKER] Starting init"),e.on("message",function(t){if("setup"!==t.action)throw new Error("expected setup to be first message but got "+JSON.stringify(t.data));e.removeAllListeners("message");var r=t.data.options||{};console.log("[WORKER] running setup with options",r),loadDependenciesNodejs(r),initOnMessageHandler(r),initWorkerInterface(r),initWorkerMessenger(r),e.send({workerReady:!0})}),__FUNCTIONDECLARATIONS__},ensureInitCodeFile:function(e,t,r){var n=require("path"),i=require("os"),o=require("fs"),s=n.join(i.tmpDir(),"lively-nodejs-workers/"),a=n.join(s,"nodejs-worker-init.js");NodejsWorker.initCodeFileCreated?o.exists(a,function(n){n?r(null,a):NodejsWorker.createWorkerCodeFile(e,a,t,r)}):NodejsWorker.createWorkerCodeFile(e,a,t,r)},createWorkerCodeFile:function(e,t,r,n){var i=require("path"),o=require("fs");(0,require("child_process").exec)("mkdir -p "+i.dirname(t),function(e,i,s){e?n(new Error(["[WORKER PARENT] Could not create worker temp dir:",i,s].join("\n"))):o.writeFile(t,r,function(e){NodejsWorker.debug&&console.log("worker code file %s created",t),NodejsWorker.initCodeFileCreated=!0,n(e,t)})})},startWorker:function(e,t){var r=require("util"),n=require("child_process").fork,i=String(NodejsWorker.workerSetupFunction).replace("__FUNCTIONDECLARATIONS__",[WorkerSetup.loadDependenciesNodejs,WorkerSetup.initOnMessageHandler,WorkerSetup.initWorkerInterface,WorkerSetup.initWorkerMessenger].join("\n")),o=r.format("(%s)();\n",i);NodejsWorker.ensureInitCodeFile(e,o,function(r,i){if(r)return t(r);var o=n(i,{});NodejsWorker.debug&&console.log("worker forked"),o.on("message",function(e){"pong"===e.action?console.log("[WORKER pong] ",e):"log"===e.action&&console.log("[Message from WORKER] ",e.data)}),o.once("message",function(e){NodejsWorker.debug&&console.log("worker setup done"),t(null,o,e)}),o.on("close",function(){NodejsWorker.debug&&console.log("[WORKER PARENT] worker closed")}),o.send({action:"setup",data:{options:e}}),global.WORKER=o})}},worker=Object.freeze({fork:fork,create:create$3}),GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:void 0,isNode="undefined"!=typeof process&&process.env&&"function"==typeof process.exit,globalInterfaceSpec=[{action:"installMethods",target:"Array",sources:["arr"],methods:["from","genN","range","withN"]},{action:"installMethods",target:"Array.prototype",sources:["arr"],methods:["all","any","batchify","clear","clone","collect","compact","delimWith","detect","doAndContinue","each","equals","filterByKey","findAll","first","flatten","forEachShowingProgress","grep","groupBy","groupByKey","histogram","include","inject","intersect","invoke","last","mapAsync","mapAsyncSeries","mask","max","min","mutableCompact","nestedDelay","partition","pluck","pushAll","pushAllAt","pushAt","pushIfNotIncluded","reMatches","reject","rejectByKey","remove","removeAt","replaceAt","rotate","shuffle","size","sortBy","sortByKey","sum","swap","toArray","toTuples","union","uniq","uniqBy","without","withoutAll","zip"],alias:[["select","filter"]]},{action:"installMethods",target:"Date",sources:["date"],methods:[]},{action:"installMethods",target:"Date.prototype",sources:["date"],methods:["equals","format","relativeTo"]},{action:"installMethods",target:"Function",sources:["fun"],methods:["fromString"]},{action:"installMethods",target:"Function.prototype",sources:["fun"],methods:["addToObject","argumentNames","asScript","asScriptOf","binds","curry","delay","functionNames","localFunctionNames","getOriginal","getVarMapping","logCalls","logCompletion","logErrors","qualifiedMethodName","setProperty","traceCalls","wrap"]},{action:"installMethods",target:"Number",sources:["num"],methods:[]},{action:"installMethods",target:"Number.prototype",sources:["num"],methods:["detent","randomSmallerInteger","roundTo","toDegrees","toRadians"]},{action:"installMethods",target:"Object",sources:["obj"],methods:["addScript","clone","deepCopy","extend","inherit","isArray","isBoolean","isElement","isEmpty","isFunction","isNumber","isObject","isRegExp","isString","isUndefined","merge","mergePropertyInHierarchy","values","valuesInPropertyHierarchy"]},{action:"installMethods",target:"Object.prototype",sources:["obj"],methods:[]},{action:"installMethods",target:"String.prototype",sources:["string"],methods:["camelize","capitalize","digitValue","empty","hashCode","include","pad","regExpEscape","startsWithVowel","succ","times","toArray","toQueryParams","truncate"]},{action:"installObject",target:"Numbers",source:"num",methods:["average","between","convertLength","humanReadableByteSize","median","normalRandom","parseLength","random","sort"]},{action:"installObject",target:"Properties",source:"properties",methods:["all","allOwnPropertiesOrFunctions","allProperties","any","forEachOwn","hash","nameFor","own","ownValues","values"]},{action:"installObject",target:"Strings",source:"string",methods:["camelCaseString","createDataURI","diff","format","formatFromArray","indent","lineIndexComputer","lines","md5","newUUID","nonEmptyLines","pad","paragraphs","peekLeft","peekRight","print","printNested","printTable","printTree","quote","reMatches","stringMatch","tableize","tokens","unescapeCharacterEntities","withDecimalPrecision"]},{action:"installObject",target:"Objects",source:"obj",methods:["asObject","equals","inspect","isMutableType","safeToString","shortPrintStringOf","typeStringOf"]},{action:"installObject",target:"Functions",source:"fun",methods:["all","compose","composeAsync","createQueue","debounce","debounceNamed","either","extractBody","flip","notYetImplemented","once","own","throttle","throttleNamed","timeToRun","timeToRunN","waitFor","workerWithCallbackQueue","wrapperChain"]},{action:"installObject",target:"Grid",source:"grid"},{action:"installObject",target:"Interval",source:"interval"},{action:"installObject",target:"lively.ArrayProjection",source:"arrayProjection"},{action:"installObject",target:"lively.Closure",source:"Closure"},{action:"installObject",target:"lively.Grouping",source:"Group"},{action:"installObject",target:"lively.PropertyPath",source:"Path"},{action:"installObject",target:"lively.Worker",source:"worker"},{action:"installObject",target:"lively.Class",source:"classHelper"}],livelyLang=createLivelyLangObject();exports.worker=worker,exports.messenger=messenger,exports.events=events,exports.tree=tree,exports.grid=grid,exports.arrayProjection=arrayProjection,exports.interval=interval,exports.graph=graph,exports.date=date,exports.properties=properties,exports.obj=obj,exports.arr=arr,exports.fun=fun,exports.num=num,exports.string=string,exports.Closure=Closure,exports.promise=promise,exports.Path=Path,exports.Group=Group,exports.livelyLang=livelyLang,exports.chain=chain$$1,exports.noConflict=noConflict,exports.installGlobals=installGlobals,exports.uninstallGlobals=uninstallGlobals}(this.lively.lang=this.lively.lang||{})}.call(GLOBAL),"undefined"!=typeof module&&module.exports&&(module.exports=GLOBAL.lively.lang)}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(e,t){"use strict";function r(e){if(void 0===e){if("undefined"==typeof System)return void 0!==n?n:n||(n={emitter:t.events.makeEmitter({},{maxListenerLimit:1e4}),notifications:[]});e=System}var r=e.get("@lively-env");r||e.set("@lively-env",e.newModule({options:{}}));var i=r.options;if(!i)throw new Error("@lively-env registered read-only");i.emitter||Object.assign(i,{emitter:e["__lively.notifications_emitter"]||(e["__lively.notifications_emitter"]=t.events.makeEmitter({},{maxListenerLimit:1e4})),notifications:e["__lively.notifications_notifications"]||(e["__lively.notifications_notifications"]=[])});return{emitter:i.emitter,notifications:i.notifications}}var n=void 0;e.subscribe=function(e,t,n){return r(n).emitter.on(e,t),t},e.subscribeOnce=function(e,t,n){return r(n).emitter.once(e,t),t},e.emit=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),o=arguments[3],s=Object.assign({type:e,time:i},n),a=r(o),u=a.emitter,c=a.notifications;return u.emit(e,s),u.isLogging&&function(e){var r=e.type+" ".repeat(Math.max(0,32-e.type.length));console.log(r+" "+t.obj.inspect(e,{maxDepth:2}))}(s),u.isRecording&&function(e,t){e.push(t),e.limit&&e.splice(0,e.length-e.limit)}(c,s),s},e.unsubscribe=function(e,t,n){return r(n).emitter.removeListener(e,t),t},e.unsubscribeAll=function(e,t){r(t).emitter.removeAllListeners(e)},e.startRecording=function(e){r(e).emitter.isRecording=!0},e.stopRecording=function(e){r(e).emitter.isRecording=!1},e.clearRecord=function(e){var t=r(e).notifications;t.splice(0,t.length)},e.getRecord=function(e){return r(e).notifications},e.startLogging=function(e){r(e).emitter.isLogging=!0},e.stopLogging=function(e){r(e).emitter.isLogging=!1}}(this.lively.notifications=this.lively.notifications||{},lively.lang),"undefined"!=typeof module&&module.exports&&(module.exports=e.lively.classes)}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;if(e.define){var t=e;delete e.define}!function(){var e=void 0;!function(){var e=void 0;(function(t,r){"function"==typeof e&&e.amd?e(["exports"],r):r(t.acorn=t.acorn||{})})(this,function(e){"use strict";function t(e,t){for(var r=65536,n=0;n<t.length;n+=2){if((r+=t[n])>e)return!1;if((r+=t[n+1])>=e)return!0}}function r(e,r){return e<65?36===e:e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&_.test(String.fromCharCode(e)):!1!==r&&t(e,w)))}function n(e,r){return e<48?36===e:e<58||!(e<65)&&(e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&x.test(String.fromCharCode(e)):!1!==r&&(t(e,w)||t(e,k)))))}function i(e,t){return new E(e,{beforeExpr:!0,binop:t})}function o(e,t){return void 0===t&&(t={}),t.keyword=e,D[e]=new E(e,t)}function s(e){return 10===e||13===e||8232===e||8233===e}function a(e){return"[object Array]"===Object.prototype.toString.call(e)}function u(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function c(e,t){for(var r=1,n=0;;){O.lastIndex=n;var i=O.exec(e);if(!(i&&i.index<t))return new B(r,t-n);++r,n=i.index+i[0].length}}function l(e){var t={};for(var r in P)t[r]=e&&u(e,r)?e[r]:P[r];if(t.ecmaVersion>=2015&&(t.ecmaVersion-=2009),null==t.allowReserved&&(t.allowReserved=t.ecmaVersion<5),a(t.onToken)){var n=t.onToken;t.onToken=function(e){return n.push(e)}}return a(t.onComment)&&(t.onComment=function(e,t){return function(r,n,i,o,s,a){var u={type:r?"Block":"Line",value:n,start:i,end:o};e.locations&&(u.loc=new T(this,s,a)),e.ranges&&(u.range=[i,o]),t.push(u)}}(t,t.onComment)),t}function f(e){return new RegExp("^("+e.replace(/ /g,"|")+")$")}function p(e,t,r,n){return e.type=t,e.end=r,this.options.locations&&(e.loc.end=n),this.options.ranges&&(e.range[1]=r),e}function h(e,t,r,n){try{return new RegExp(e,t)}catch(e){if(void 0!==r)throw e instanceof SyntaxError&&n.raise(r,"Error parsing regular expression: "+e.message),e}}function d(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}var m={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},v="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",y={5:v,6:v+" const class extends export import super"},g="-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",b="-------------------------------------------------------------------------------------------------------------------------------------------------",_=new RegExp("["+g+"]"),x=new RegExp("["+g+b+"]");g=b=null;var w=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,17,26,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,26,45,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,785,52,76,44,33,24,27,35,42,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,54,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,86,25,391,63,32,0,449,56,264,8,2,36,18,0,50,29,881,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,881,68,12,0,67,12,65,0,32,6124,20,754,9486,1,3071,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,4149,196,60,67,1213,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42710,42,4148,12,221,3,5761,10591,541],k=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,1306,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,52,0,13,2,49,13,10,2,4,9,83,11,7,0,161,11,6,9,7,3,57,0,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,87,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,423,9,838,7,2,7,17,9,57,21,2,13,19882,9,135,4,60,6,26,9,1016,45,17,3,19723,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,2214,6,110,6,6,9,792487,239],E=function(e,t){void 0===t&&(t={}),this.label=e,this.keyword=t.keyword,this.beforeExpr=!!t.beforeExpr,this.startsExpr=!!t.startsExpr,this.isLoop=!!t.isLoop,this.isAssign=!!t.isAssign,this.prefix=!!t.prefix,this.postfix=!!t.postfix,this.binop=t.binop||null,this.updateContext=null},S={beforeExpr:!0},A={startsExpr:!0},D={},C={num:new E("num",A),regexp:new E("regexp",A),string:new E("string",A),name:new E("name",A),eof:new E("eof"),bracketL:new E("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new E("]"),braceL:new E("{",{beforeExpr:!0,startsExpr:!0}),braceR:new E("}"),parenL:new E("(",{beforeExpr:!0,startsExpr:!0}),parenR:new E(")"),comma:new E(",",S),semi:new E(";",S),colon:new E(":",S),dot:new E("."),question:new E("?",S),arrow:new E("=>",S),template:new E("template"),ellipsis:new E("...",S),backQuote:new E("`",A),dollarBraceL:new E("${",{beforeExpr:!0,startsExpr:!0}),eq:new E("=",{beforeExpr:!0,isAssign:!0}),assign:new E("_=",{beforeExpr:!0,isAssign:!0}),incDec:new E("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new E("prefix",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:i("||",1),logicalAND:i("&&",2),bitwiseOR:i("|",3),bitwiseXOR:i("^",4),bitwiseAND:i("&",5),equality:i("==/!=",6),relational:i("</>",7),bitShift:i("<</>>",8),plusMin:new E("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:i("%",10),star:i("*",10),slash:i("/",10),starstar:new E("**",{beforeExpr:!0}),_break:o("break"),_case:o("case",S),_catch:o("catch"),_continue:o("continue"),_debugger:o("debugger"),_default:o("default",S),_do:o("do",{isLoop:!0,beforeExpr:!0}),_else:o("else",S),_finally:o("finally"),_for:o("for",{isLoop:!0}),_function:o("function",A),_if:o("if"),_return:o("return",S),_switch:o("switch"),_throw:o("throw",S),_try:o("try"),_var:o("var"),_const:o("const"),_while:o("while",{isLoop:!0}),_with:o("with"),_new:o("new",{beforeExpr:!0,startsExpr:!0}),_this:o("this",A),_super:o("super",A),_class:o("class"),_extends:o("extends",S),_export:o("export"),_import:o("import"),_null:o("null",A),_true:o("true",A),_false:o("false",A),_in:o("in",{beforeExpr:!0,binop:7}),_instanceof:o("instanceof",{beforeExpr:!0,binop:7}),_typeof:o("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:o("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:o("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},F=/\r\n?|\n|\u2028|\u2029/,O=new RegExp(F.source,"g"),j=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,R=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,B=function(e,t){this.line=e,this.column=t};B.prototype.offset=function(e){return new B(this.line,this.column+e)};var T=function(e,t,r){this.start=t,this.end=r,null!==e.sourceFile&&(this.source=e.sourceFile)},P={ecmaVersion:7,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1,plugins:{}},I={},L=function(e,t,r){this.options=e=l(e),this.sourceFile=e.sourceFile,this.keywords=f(y[e.ecmaVersion>=6?6:5]);var n="";if(!e.allowReserved){for(var i=e.ecmaVersion;!(n=m[i]);i--);"module"==e.sourceType&&(n+=" await")}this.reservedWords=f(n);var o=(n?n+" ":"")+m.strict;this.reservedWordsStrict=f(o),this.reservedWordsStrictBind=f(o+" "+m.strictBind),this.input=String(t),this.containsEsc=!1,this.loadPlugins(e.plugins),r?(this.pos=r,this.lineStart=this.input.lastIndexOf("\n",r-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(F).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=C.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===e.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.inFunction=this.inGenerator=this.inAsync=!1,this.yieldPos=this.awaitPos=0,this.labels=[],0===this.pos&&e.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2)};L.prototype.isKeyword=function(e){return this.keywords.test(e)},L.prototype.isReservedWord=function(e){return this.reservedWords.test(e)},L.prototype.extend=function(e,t){this[e]=t(this[e])},L.prototype.loadPlugins=function(e){for(var t in e){var r=I[t];if(!r)throw new Error("Plugin '"+t+"' not found");r(this,e[t])}},L.prototype.parse=function(){var e=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(e)};var N=L.prototype,M=/^(?:'((?:[^\']|\.)*)'|"((?:[^\"]|\.)*)"|;)/;N.strictDirective=function(e){for(;;){R.lastIndex=e,e+=R.exec(this.input)[0].length;var t=M.exec(this.input.slice(e));if(!t)return!1;if("use strict"==(t[1]||t[2]))return!0;e+=t[0].length}},N.eat=function(e){return this.type===e&&(this.next(),!0)},N.isContextual=function(e){return this.type===C.name&&this.value===e},N.eatContextual=function(e){return this.value===e&&this.eat(C.name)},N.expectContextual=function(e){this.eatContextual(e)||this.unexpected()},N.canInsertSemicolon=function(){return this.type===C.eof||this.type===C.braceR||F.test(this.input.slice(this.lastTokEnd,this.start))},N.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},N.semicolon=function(){this.eat(C.semi)||this.insertSemicolon()||this.unexpected()},N.afterTrailingComma=function(e,t){if(this.type==e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),t||this.next(),!0},N.expect=function(e){this.eat(e)||this.unexpected()},N.unexpected=function(e){this.raise(null!=e?e:this.start,"Unexpected token")};var q=function(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=-1};N.checkPatternErrors=function(e,t){if(e){e.trailingComma>-1&&this.raiseRecoverable(e.trailingComma,"Comma is not permitted after the rest element");var r=t?e.parenthesizedAssign:e.parenthesizedBind;r>-1&&this.raiseRecoverable(r,"Parenthesized pattern")}},N.checkExpressionErrors=function(e,t){var r=e?e.shorthandAssign:-1;if(!t)return r>=0;r>-1&&this.raise(r,"Shorthand property assignments are valid only in destructuring patterns")},N.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},N.isSimpleAssignTarget=function(e){return"ParenthesizedExpression"===e.type?this.isSimpleAssignTarget(e.expression):"Identifier"===e.type||"MemberExpression"===e.type};var $=L.prototype;$.parseTopLevel=function(e){var t={};for(e.body||(e.body=[]);this.type!==C.eof;){var r=this.parseStatement(!0,!0,t);e.body.push(r)}return this.next(),this.options.ecmaVersion>=6&&(e.sourceType=this.options.sourceType),this.finishNode(e,"Program")};var W={kind:"loop"},U={kind:"switch"};$.isLet=function(){if(this.type!==C.name||this.options.ecmaVersion<6||"let"!=this.value)return!1;R.lastIndex=this.pos;var e=R.exec(this.input),t=this.pos+e[0].length,i=this.input.charCodeAt(t);if(91===i||123==i)return!0;if(r(i,!0)){for(var o=t+1;n(this.input.charCodeAt(o),!0);++o);var s=this.input.slice(t,o);if(!this.isKeyword(s))return!0}return!1},$.isAsyncFunction=function(){if(this.type!==C.name||this.options.ecmaVersion<8||"async"!=this.value)return!1;R.lastIndex=this.pos;var e=R.exec(this.input),t=this.pos+e[0].length;return!(F.test(this.input.slice(this.pos,t))||"function"!==this.input.slice(t,t+8)||t+8!=this.input.length&&n(this.input.charAt(t+8)))},$.parseStatement=function(e,t,r){var n,i=this.type,o=this.startNode();switch(this.isLet()&&(i=C._var,n="let"),i){case C._break:case C._continue:return this.parseBreakContinueStatement(o,i.keyword);case C._debugger:return this.parseDebuggerStatement(o);case C._do:return this.parseDoStatement(o);case C._for:return this.parseForStatement(o);case C._function:return!e&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(o,!1);case C._class:return e||this.unexpected(),this.parseClass(o,!0);case C._if:return this.parseIfStatement(o);case C._return:return this.parseReturnStatement(o);case C._switch:return this.parseSwitchStatement(o);case C._throw:return this.parseThrowStatement(o);case C._try:return this.parseTryStatement(o);case C._const:case C._var:return n=n||this.value,e||"var"==n||this.unexpected(),this.parseVarStatement(o,n);case C._while:return this.parseWhileStatement(o);case C._with:return this.parseWithStatement(o);case C.braceL:return this.parseBlock();case C.semi:return this.parseEmptyStatement(o);case C._export:case C._import:return this.options.allowImportExportEverywhere||(t||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===C._import?this.parseImport(o):this.parseExport(o,r);default:if(this.isAsyncFunction()&&e)return this.next(),this.parseFunctionStatement(o,!0);var s=this.value,a=this.parseExpression();return i===C.name&&"Identifier"===a.type&&this.eat(C.colon)?this.parseLabeledStatement(o,s,a):this.parseExpressionStatement(o,a)}},$.parseBreakContinueStatement=function(e,t){var r="break"==t;this.next(),this.eat(C.semi)||this.insertSemicolon()?e.label=null:this.type!==C.name?this.unexpected():(e.label=this.parseIdent(),this.semicolon());for(var n=0;n<this.labels.length;++n){var i=this.labels[n];if(null==e.label||i.name===e.label.name){if(null!=i.kind&&(r||"loop"===i.kind))break;if(e.label&&r)break}}return n===this.labels.length&&this.raise(e.start,"Unsyntactic "+t),this.finishNode(e,r?"BreakStatement":"ContinueStatement")},$.parseDebuggerStatement=function(e){return this.next(),this.semicolon(),this.finishNode(e,"DebuggerStatement")},$.parseDoStatement=function(e){return this.next(),this.labels.push(W),e.body=this.parseStatement(!1),this.labels.pop(),this.expect(C._while),e.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(C.semi):this.semicolon(),this.finishNode(e,"DoWhileStatement")},$.parseForStatement=function(e){if(this.next(),this.labels.push(W),this.expect(C.parenL),this.type===C.semi)return this.parseFor(e,null);var t=this.isLet();if(this.type===C._var||this.type===C._const||t){var r=this.startNode(),n=t?"let":this.value;return this.next(),this.parseVar(r,!0,n),this.finishNode(r,"VariableDeclaration"),!(this.type===C._in||this.options.ecmaVersion>=6&&this.isContextual("of"))||1!==r.declarations.length||"var"!==n&&r.declarations[0].init?this.parseFor(e,r):this.parseForIn(e,r)}var i=new q,o=this.parseExpression(!0,i);return this.type===C._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.toAssignable(o),this.checkLVal(o),this.checkPatternErrors(i,!0),this.parseForIn(e,o)):(this.checkExpressionErrors(i,!0),this.parseFor(e,o))},$.parseFunctionStatement=function(e,t){return this.next(),this.parseFunction(e,!0,!1,t)},$.isFunction=function(){return this.type===C._function||this.isAsyncFunction()},$.parseIfStatement=function(e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement(!this.strict&&this.isFunction()),e.alternate=this.eat(C._else)?this.parseStatement(!this.strict&&this.isFunction()):null,this.finishNode(e,"IfStatement")},$.parseReturnStatement=function(e){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(C.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,"ReturnStatement")},$.parseSwitchStatement=function(e){this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(C.braceL),this.labels.push(U);for(var t,r=!1;this.type!=C.braceR;)if(this.type===C._case||this.type===C._default){var n=this.type===C._case;t&&this.finishNode(t,"SwitchCase"),e.cases.push(t=this.startNode()),t.consequent=[],this.next(),n?t.test=this.parseExpression():(r&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),r=!0,t.test=null),this.expect(C.colon)}else t||this.unexpected(),t.consequent.push(this.parseStatement(!0));return t&&this.finishNode(t,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(e,"SwitchStatement")},$.parseThrowStatement=function(e){return this.next(),F.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,"ThrowStatement")};var z=[];$.parseTryStatement=function(e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===C._catch){var t=this.startNode();this.next(),this.expect(C.parenL),t.param=this.parseBindingAtom(),this.checkLVal(t.param,!0),this.expect(C.parenR),t.body=this.parseBlock(),e.handler=this.finishNode(t,"CatchClause")}return e.finalizer=this.eat(C._finally)?this.parseBlock():null,e.handler||e.finalizer||this.raise(e.start,"Missing catch or finally clause"),this.finishNode(e,"TryStatement")},$.parseVarStatement=function(e,t){return this.next(),this.parseVar(e,!1,t),this.semicolon(),this.finishNode(e,"VariableDeclaration")},$.parseWhileStatement=function(e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(W),e.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(e,"WhileStatement")},$.parseWithStatement=function(e){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement(!1),this.finishNode(e,"WithStatement")},$.parseEmptyStatement=function(e){return this.next(),this.finishNode(e,"EmptyStatement")},$.parseLabeledStatement=function(e,t,r){for(var n=0;n<this.labels.length;++n)this.labels[n].name===t&&this.raise(r.start,"Label '"+t+"' is already declared");for(var i=this.type.isLoop?"loop":this.type===C._switch?"switch":null,o=this.labels.length-1;o>=0;o--){var s=this.labels[o];if(s.statementStart!=e.start)break;s.statementStart=this.start,s.kind=i}return this.labels.push({name:t,kind:i,statementStart:this.start}),e.body=this.parseStatement(!0),("ClassDeclaration"==e.body.type||"VariableDeclaration"==e.body.type&&(this.strict||"var"!=e.body.kind)||"FunctionDeclaration"==e.body.type&&(this.strict||e.body.generator))&&this.raiseRecoverable(e.body.start,"Invalid labeled declaration"),this.labels.pop(),e.label=r,this.finishNode(e,"LabeledStatement")},$.parseExpressionStatement=function(e,t){return e.expression=t,this.semicolon(),this.finishNode(e,"ExpressionStatement")},$.parseBlock=function(){var e=this.startNode();for(e.body=[],this.expect(C.braceL);!this.eat(C.braceR);){var t=this.parseStatement(!0);e.body.push(t)}return this.finishNode(e,"BlockStatement")},$.parseFor=function(e,t){return e.init=t,this.expect(C.semi),e.test=this.type===C.semi?null:this.parseExpression(),this.expect(C.semi),e.update=this.type===C.parenR?null:this.parseExpression(),this.expect(C.parenR),e.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(e,"ForStatement")},$.parseForIn=function(e,t){var r=this.type===C._in?"ForInStatement":"ForOfStatement";return this.next(),e.left=t,e.right=this.parseExpression(),this.expect(C.parenR),e.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(e,r)},$.parseVar=function(e,t,r){for(e.declarations=[],e.kind=r;;){var n=this.startNode();if(this.parseVarId(n),this.eat(C.eq)?n.init=this.parseMaybeAssign(t):"const"!==r||this.type===C._in||this.options.ecmaVersion>=6&&this.isContextual("of")?"Identifier"==n.id.type||t&&(this.type===C._in||this.isContextual("of"))?n.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.unexpected(),e.declarations.push(this.finishNode(n,"VariableDeclarator")),!this.eat(C.comma))break}return e},$.parseVarId=function(e){e.id=this.parseBindingAtom(),this.checkLVal(e.id,!0)},$.parseFunction=function(e,t,r,n){this.initFunction(e),this.options.ecmaVersion>=6&&!n&&(e.generator=this.eat(C.star)),this.options.ecmaVersion>=8&&(e.async=!!n),null==t&&(t=this.type==C.name),t&&(e.id=this.parseIdent());var i=this.inGenerator,o=this.inAsync,s=this.yieldPos,a=this.awaitPos,u=this.inFunction;return this.inGenerator=e.generator,this.inAsync=e.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,t||this.type!==C.name||(e.id=this.parseIdent()),this.parseFunctionParams(e),this.parseFunctionBody(e,r),this.inGenerator=i,this.inAsync=o,this.yieldPos=s,this.awaitPos=a,this.inFunction=u,this.finishNode(e,t?"FunctionDeclaration":"FunctionExpression")},$.parseFunctionParams=function(e){this.expect(C.parenL),e.params=this.parseBindingList(C.parenR,!1,this.options.ecmaVersion>=8,!0),this.checkYieldAwaitInDefaultParams()},$.parseClass=function(e,t){this.next(),null==t&&(t=this.type===C.name),this.parseClassId(e,t),this.parseClassSuper(e);var r=this.startNode(),n=!1;for(r.body=[],this.expect(C.braceL);!this.eat(C.braceR);)if(!this.eat(C.semi)){var i=this.startNode(),o=this.eat(C.star),s=!1,a=this.type===C.name&&"static"===this.value;this.parsePropertyName(i),i.static=a&&this.type!==C.parenL,i.static&&(o&&this.unexpected(),o=this.eat(C.star),this.parsePropertyName(i)),this.options.ecmaVersion>=8&&!o&&!i.computed&&"Identifier"===i.key.type&&"async"===i.key.name&&this.type!==C.parenL&&!this.canInsertSemicolon()&&(s=!0,this.parsePropertyName(i)),i.kind="method";var u=!1;if(!i.computed){var c=i.key;o||s||"Identifier"!==c.type||this.type===C.parenL||"get"!==c.name&&"set"!==c.name||(u=!0,i.kind=c.name,c=this.parsePropertyName(i)),!i.static&&("Identifier"===c.type&&"constructor"===c.name||"Literal"===c.type&&"constructor"===c.value)&&(n&&this.raise(c.start,"Duplicate constructor in the same class"),u&&this.raise(c.start,"Constructor can't have get/set modifier"),o&&this.raise(c.start,"Constructor can't be a generator"),s&&this.raise(c.start,"Constructor can't be an async method"),i.kind="constructor",n=!0)}if(this.parseClassMethod(r,i,o,s),u){var l="get"===i.kind?0:1;if(i.value.params.length!==l){var f=i.value.start;"get"===i.kind?this.raiseRecoverable(f,"getter should have no params"):this.raiseRecoverable(f,"setter should have exactly one param")}else"set"===i.kind&&"RestElement"===i.value.params[0].type&&this.raiseRecoverable(i.value.params[0].start,"Setter cannot use rest params")}}return e.body=this.finishNode(r,"ClassBody"),this.finishNode(e,t?"ClassDeclaration":"ClassExpression")},$.parseClassMethod=function(e,t,r,n){t.value=this.parseMethod(r,n),e.body.push(this.finishNode(t,"MethodDefinition"))},$.parseClassId=function(e,t){e.id=this.type===C.name?this.parseIdent():t?this.unexpected():null},$.parseClassSuper=function(e){e.superClass=this.eat(C._extends)?this.parseExprSubscripts():null},$.parseExport=function(e,t){if(this.next(),this.eat(C.star))return this.expectContextual("from"),e.source=this.type===C.string?this.parseExprAtom():this.unexpected(),this.semicolon(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(C._default)){this.checkExport(t,"default",this.lastTokStart);var r;if(this.type===C._function||(r=this.isAsyncFunction())){var n=this.startNode();this.next(),r&&this.next(),e.declaration=this.parseFunction(n,null,!1,r)}else if(this.type===C._class){var i=this.startNode();e.declaration=this.parseClass(i,null)}else e.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(e,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())e.declaration=this.parseStatement(!0),"VariableDeclaration"===e.declaration.type?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id.name,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual("from"))e.source=this.type===C.string?this.parseExprAtom():this.unexpected();else{for(var o=0;o<e.specifiers.length;o++)(this.keywords.test(e.specifiers[o].local.name)||this.reservedWords.test(e.specifiers[o].local.name))&&this.unexpected(e.specifiers[o].local.start);e.source=null}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")},$.checkExport=function(e,t,r){e&&(Object.prototype.hasOwnProperty.call(e,t)&&this.raiseRecoverable(r,"Duplicate export '"+t+"'"),e[t]=!0)},$.checkPatternExport=function(e,t){var r=t.type;if("Identifier"==r)this.checkExport(e,t.name,t.start);else if("ObjectPattern"==r)for(var n=0;n<t.properties.length;++n)this.checkPatternExport(e,t.properties[n].value);else if("ArrayPattern"==r)for(var i=0;i<t.elements.length;++i){var o=t.elements[i];o&&this.checkPatternExport(e,o)}else"AssignmentPattern"==r?this.checkPatternExport(e,t.left):"ParenthesizedExpression"==r&&this.checkPatternExport(e,t.expression)},$.checkVariableExport=function(e,t){if(e)for(var r=0;r<t.length;r++)this.checkPatternExport(e,t[r].id)},$.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},$.parseExportSpecifiers=function(e){var t=[],r=!0;for(this.expect(C.braceL);!this.eat(C.braceR);){if(r)r=!1;else if(this.expect(C.comma),this.afterTrailingComma(C.braceR))break;var n=this.startNode();n.local=this.parseIdent(!0),n.exported=this.eatContextual("as")?this.parseIdent(!0):n.local,this.checkExport(e,n.exported.name,n.exported.start),t.push(this.finishNode(n,"ExportSpecifier"))}return t},$.parseImport=function(e){return this.next(),this.type===C.string?(e.specifiers=z,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===C.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(e,"ImportDeclaration")},$.parseImportSpecifiers=function(){var e=[],t=!0;if(this.type===C.name){var r=this.startNode();if(r.local=this.parseIdent(),this.checkLVal(r.local,!0),e.push(this.finishNode(r,"ImportDefaultSpecifier")),!this.eat(C.comma))return e}if(this.type===C.star){var n=this.startNode();return this.next(),this.expectContextual("as"),n.local=this.parseIdent(),this.checkLVal(n.local,!0),e.push(this.finishNode(n,"ImportNamespaceSpecifier")),e}for(this.expect(C.braceL);!this.eat(C.braceR);){if(t)t=!1;else if(this.expect(C.comma),this.afterTrailingComma(C.braceR))break;var i=this.startNode();i.imported=this.parseIdent(!0),this.eatContextual("as")?i.local=this.parseIdent():(i.local=i.imported,this.isKeyword(i.local.name)&&this.unexpected(i.local.start),this.reservedWordsStrict.test(i.local.name)&&this.raiseRecoverable(i.local.start,"The keyword '"+i.local.name+"' is reserved")),this.checkLVal(i.local,!0),e.push(this.finishNode(i,"ImportSpecifier"))}return e};var V=L.prototype;V.toAssignable=function(e,t){if(this.options.ecmaVersion>=6&&e)switch(e.type){case"Identifier":this.inAsync&&"await"===e.name&&this.raise(e.start,"Can not use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":break;case"ObjectExpression":e.type="ObjectPattern";for(var r=0;r<e.properties.length;r++){var n=e.properties[r];"init"!==n.kind&&this.raise(n.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(n.value,t)}break;case"ArrayExpression":e.type="ArrayPattern",this.toAssignableList(e.elements,t);break;case"AssignmentExpression":if("="!==e.operator){this.raise(e.left.end,"Only '=' operator can be used for specifying default value.");break}e.type="AssignmentPattern",delete e.operator,this.toAssignable(e.left,t);case"AssignmentPattern":break;case"ParenthesizedExpression":e.expression=this.toAssignable(e.expression,t);break;case"MemberExpression":if(!t)break;default:this.raise(e.start,"Assigning to rvalue")}return e},V.toAssignableList=function(e,t){var r=e.length;if(r){var n=e[r-1];if(n&&"RestElement"==n.type)--r;else if(n&&"SpreadElement"==n.type){n.type="RestElement";var i=n.argument;this.toAssignable(i,t),"Identifier"!==i.type&&"MemberExpression"!==i.type&&"ArrayPattern"!==i.type&&this.unexpected(i.start),--r}t&&n&&"RestElement"===n.type&&"Identifier"!==n.argument.type&&this.unexpected(n.argument.start)}for(var o=0;o<r;o++){var s=e[o];s&&this.toAssignable(s,t)}return e},V.parseSpread=function(e){var t=this.startNode();return this.next(),t.argument=this.parseMaybeAssign(!1,e),this.finishNode(t,"SpreadElement")},V.parseRest=function(e){var t=this.startNode();return this.next(),t.argument=e?this.type===C.name?this.parseIdent():this.unexpected():this.type===C.name||this.type===C.bracketL?this.parseBindingAtom():this.unexpected(),this.finishNode(t,"RestElement")},V.parseBindingAtom=function(){if(this.options.ecmaVersion<6)return this.parseIdent();switch(this.type){case C.name:return this.parseIdent();case C.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(C.bracketR,!0,!0),this.finishNode(e,"ArrayPattern");case C.braceL:return this.parseObj(!0);default:this.unexpected()}},V.parseBindingList=function(e,t,r,n){for(var i=[],o=!0;!this.eat(e);)if(o?o=!1:this.expect(C.comma),t&&this.type===C.comma)i.push(null);else{if(r&&this.afterTrailingComma(e))break;if(this.type===C.ellipsis){var s=this.parseRest(n);this.parseBindingListItem(s),i.push(s),this.type===C.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(e);break}var a=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(a),i.push(a)}return i},V.parseBindingListItem=function(e){return e},V.parseMaybeDefault=function(e,t,r){if(r=r||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(C.eq))return r;var n=this.startNodeAt(e,t);return n.left=r,n.right=this.parseMaybeAssign(),this.finishNode(n,"AssignmentPattern")},V.checkLVal=function(e,t,r){switch(e.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(t?"Binding ":"Assigning to ")+e.name+" in strict mode"),r&&(u(r,e.name)&&this.raiseRecoverable(e.start,"Argument name clash"),r[e.name]=!0);break;case"MemberExpression":t&&this.raiseRecoverable(e.start,(t?"Binding":"Assigning to")+" member expression");break;case"ObjectPattern":for(var n=0;n<e.properties.length;n++)this.checkLVal(e.properties[n].value,t,r);break;case"ArrayPattern":for(var i=0;i<e.elements.length;i++){var o=e.elements[i];o&&this.checkLVal(o,t,r)}break;case"AssignmentPattern":this.checkLVal(e.left,t,r);break;case"RestElement":this.checkLVal(e.argument,t,r);break;case"ParenthesizedExpression":this.checkLVal(e.expression,t,r);break;default:this.raise(e.start,(t?"Binding":"Assigning to")+" rvalue")}};var G=L.prototype;G.checkPropClash=function(e,t){if(!(this.options.ecmaVersion>=6&&(e.computed||e.method||e.shorthand))){var r,n=e.key;switch(n.type){case"Identifier":r=n.name;break;case"Literal":r=String(n.value);break;default:return}var i=e.kind;if(this.options.ecmaVersion>=6)"__proto__"===r&&"init"===i&&(t.proto&&this.raiseRecoverable(n.start,"Redefinition of __proto__ property"),t.proto=!0);else{var o=t[r="$"+r];if(o){var s="init"!==i;(!this.strict&&!s||!o[i])&&s^o.init||this.raiseRecoverable(n.start,"Redefinition of property")}else o=t[r]={init:!1,get:!1,set:!1};o[i]=!0}}},G.parseExpression=function(e,t){var r=this.start,n=this.startLoc,i=this.parseMaybeAssign(e,t);if(this.type===C.comma){var o=this.startNodeAt(r,n);for(o.expressions=[i];this.eat(C.comma);)o.expressions.push(this.parseMaybeAssign(e,t));return this.finishNode(o,"SequenceExpression")}return i},G.parseMaybeAssign=function(e,t,r){if(this.inGenerator&&this.isContextual("yield"))return this.parseYield();var n=!1,i=-1;t?(i=t.parenthesizedAssign,t.parenthesizedAssign=-1):(t=new q,n=!0);var o=this.start,s=this.startLoc;this.type!=C.parenL&&this.type!=C.name||(this.potentialArrowAt=this.start);var a=this.parseMaybeConditional(e,t);if(r&&(a=r.call(this,a,o,s)),this.type.isAssign){this.checkPatternErrors(t,!0),n||q.call(t);var u=this.startNodeAt(o,s);return u.operator=this.value,u.left=this.type===C.eq?this.toAssignable(a):a,t.shorthandAssign=-1,this.checkLVal(a),this.next(),u.right=this.parseMaybeAssign(e),this.finishNode(u,"AssignmentExpression")}return n&&this.checkExpressionErrors(t,!0),i>-1&&(t.parenthesizedAssign=i),a},G.parseMaybeConditional=function(e,t){var r=this.start,n=this.startLoc,i=this.parseExprOps(e,t);if(this.checkExpressionErrors(t))return i;if(this.eat(C.question)){var o=this.startNodeAt(r,n);return o.test=i,o.consequent=this.parseMaybeAssign(),this.expect(C.colon),o.alternate=this.parseMaybeAssign(e),this.finishNode(o,"ConditionalExpression")}return i},G.parseExprOps=function(e,t){var r=this.start,n=this.startLoc,i=this.parseMaybeUnary(t,!1);return this.checkExpressionErrors(t)?i:this.parseExprOp(i,r,n,-1,e)},G.parseExprOp=function(e,t,r,n,i){var o=this.type.binop;if(null!=o&&(!i||this.type!==C._in)&&o>n){var s=this.type===C.logicalOR||this.type===C.logicalAND,a=this.value;this.next();var u=this.start,c=this.startLoc,l=this.parseExprOp(this.parseMaybeUnary(null,!1),u,c,o,i),f=this.buildBinary(t,r,e,l,a,s);return this.parseExprOp(f,t,r,n,i)}return e},G.buildBinary=function(e,t,r,n,i,o){var s=this.startNodeAt(e,t);return s.left=r,s.operator=i,s.right=n,this.finishNode(s,o?"LogicalExpression":"BinaryExpression")},G.parseMaybeUnary=function(e,t){var r,n=this.start,i=this.startLoc;if(this.inAsync&&this.isContextual("await"))r=this.parseAwait(e),t=!0;else if(this.type.prefix){var o=this.startNode(),s=this.type===C.incDec;o.operator=this.value,o.prefix=!0,this.next(),o.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(e,!0),s?this.checkLVal(o.argument):this.strict&&"delete"===o.operator&&"Identifier"===o.argument.type?this.raiseRecoverable(o.start,"Deleting local variable in strict mode"):t=!0,r=this.finishNode(o,s?"UpdateExpression":"UnaryExpression")}else{if(r=this.parseExprSubscripts(e),this.checkExpressionErrors(e))return r;for(;this.type.postfix&&!this.canInsertSemicolon();){var a=this.startNodeAt(n,i);a.operator=this.value,a.prefix=!1,a.argument=r,this.checkLVal(r),this.next(),r=this.finishNode(a,"UpdateExpression")}}return!t&&this.eat(C.starstar)?this.buildBinary(n,i,r,this.parseMaybeUnary(null,!1),"**",!1):r},G.parseExprSubscripts=function(e){var t=this.start,r=this.startLoc,n=this.parseExprAtom(e),i="ArrowFunctionExpression"===n.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd);if(this.checkExpressionErrors(e)||i)return n;var o=this.parseSubscripts(n,t,r);return e&&"MemberExpression"===o.type&&(e.parenthesizedAssign>=o.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=o.start&&(e.parenthesizedBind=-1)),o},G.parseSubscripts=function(e,t,r,n){for(var i,o=this.options.ecmaVersion>=8&&"Identifier"===e.type&&"async"===e.name&&this.lastTokEnd==e.end&&!this.canInsertSemicolon();;)if((i=this.eat(C.bracketL))||this.eat(C.dot)){var s=this.startNodeAt(t,r);s.object=e,s.property=i?this.parseExpression():this.parseIdent(!0),s.computed=!!i,i&&this.expect(C.bracketR),e=this.finishNode(s,"MemberExpression")}else if(!n&&this.eat(C.parenL)){var a=new q,u=this.yieldPos,c=this.awaitPos;this.yieldPos=0,this.awaitPos=0;var l=this.parseExprList(C.parenR,this.options.ecmaVersion>=8,!1,a);if(o&&!this.canInsertSemicolon()&&this.eat(C.arrow))return this.checkPatternErrors(a,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=u,this.awaitPos=c,this.parseArrowExpression(this.startNodeAt(t,r),l,!0);this.checkExpressionErrors(a,!0),this.yieldPos=u||this.yieldPos,this.awaitPos=c||this.awaitPos;var f=this.startNodeAt(t,r);f.callee=e,f.arguments=l,e=this.finishNode(f,"CallExpression")}else{if(this.type!==C.backQuote)return e;var p=this.startNodeAt(t,r);p.tag=e,p.quasi=this.parseTemplate(),e=this.finishNode(p,"TaggedTemplateExpression")}},G.parseExprAtom=function(e){var t,r=this.potentialArrowAt==this.start;switch(this.type){case C._super:this.inFunction||this.raise(this.start,"'super' outside of function or class");case C._this:var n=this.type===C._this?"ThisExpression":"Super";return t=this.startNode(),this.next(),this.finishNode(t,n);case C.name:var i=this.start,o=this.startLoc,s=this.parseIdent(this.type!==C.name);if(this.options.ecmaVersion>=8&&"async"===s.name&&!this.canInsertSemicolon()&&this.eat(C._function))return this.parseFunction(this.startNodeAt(i,o),!1,!1,!0);if(r&&!this.canInsertSemicolon()){if(this.eat(C.arrow))return this.parseArrowExpression(this.startNodeAt(i,o),[s],!1);if(this.options.ecmaVersion>=8&&"async"===s.name&&this.type===C.name)return s=this.parseIdent(),!this.canInsertSemicolon()&&this.eat(C.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(i,o),[s],!0)}return s;case C.regexp:var a=this.value;return t=this.parseLiteral(a.value),t.regex={pattern:a.pattern,flags:a.flags},t;case C.num:case C.string:return this.parseLiteral(this.value);case C._null:case C._true:case C._false:return t=this.startNode(),t.value=this.type===C._null?null:this.type===C._true,t.raw=this.type.keyword,this.next(),this.finishNode(t,"Literal");case C.parenL:var u=this.start,c=this.parseParenAndDistinguishExpression(r);return e&&(e.parenthesizedAssign<0&&!this.isSimpleAssignTarget(c)&&(e.parenthesizedAssign=u),e.parenthesizedBind<0&&(e.parenthesizedBind=u)),c;case C.bracketL:return t=this.startNode(),this.next(),t.elements=this.parseExprList(C.bracketR,!0,!0,e),this.finishNode(t,"ArrayExpression");case C.braceL:return this.parseObj(!1,e);case C._function:return t=this.startNode(),this.next(),this.parseFunction(t,!1);case C._class:return this.parseClass(this.startNode(),!1);case C._new:return this.parseNew();case C.backQuote:return this.parseTemplate();default:this.unexpected()}},G.parseLiteral=function(e){var t=this.startNode();return t.value=e,t.raw=this.input.slice(this.start,this.end),this.next(),this.finishNode(t,"Literal")},G.parseParenExpression=function(){this.expect(C.parenL);var e=this.parseExpression();return this.expect(C.parenR),e},G.parseParenAndDistinguishExpression=function(e){var t,r=this.start,n=this.startLoc,i=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var o,s,a=this.start,u=this.startLoc,c=[],l=!0,f=!1,p=new q,h=this.yieldPos,d=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==C.parenR;){if(l?l=!1:this.expect(C.comma),i&&this.afterTrailingComma(C.parenR,!0)){f=!0;break}if(this.type===C.ellipsis){o=this.start,c.push(this.parseParenItem(this.parseRest())),this.type===C.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}this.type!==C.parenL||s||(s=this.start),c.push(this.parseMaybeAssign(!1,p,this.parseParenItem))}var m=this.start,v=this.startLoc;if(this.expect(C.parenR),e&&!this.canInsertSemicolon()&&this.eat(C.arrow))return this.checkPatternErrors(p,!1),this.checkYieldAwaitInDefaultParams(),s&&this.unexpected(s),this.yieldPos=h,this.awaitPos=d,this.parseParenArrowList(r,n,c);c.length&&!f||this.unexpected(this.lastTokStart),o&&this.unexpected(o),this.checkExpressionErrors(p,!0),this.yieldPos=h||this.yieldPos,this.awaitPos=d||this.awaitPos,c.length>1?((t=this.startNodeAt(a,u)).expressions=c,this.finishNodeAt(t,"SequenceExpression",m,v)):t=c[0]}else t=this.parseParenExpression();if(this.options.preserveParens){var y=this.startNodeAt(r,n);return y.expression=t,this.finishNode(y,"ParenthesizedExpression")}return t},G.parseParenItem=function(e){return e},G.parseParenArrowList=function(e,t,r){return this.parseArrowExpression(this.startNodeAt(e,t),r)};var H=[];G.parseNew=function(){var e=this.startNode(),t=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(C.dot))return e.meta=t,e.property=this.parseIdent(!0),"target"!==e.property.name&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is new.target"),this.inFunction||this.raiseRecoverable(e.start,"new.target can only be used in functions"),this.finishNode(e,"MetaProperty");var r=this.start,n=this.startLoc;return e.callee=this.parseSubscripts(this.parseExprAtom(),r,n,!0),this.eat(C.parenL)?e.arguments=this.parseExprList(C.parenR,this.options.ecmaVersion>=8,!1):e.arguments=H,this.finishNode(e,"NewExpression")},G.parseTemplateElement=function(){var e=this.startNode();return e.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),e.tail=this.type===C.backQuote,this.finishNode(e,"TemplateElement")},G.parseTemplate=function(){var e=this.startNode();this.next(),e.expressions=[];var t=this.parseTemplateElement();for(e.quasis=[t];!t.tail;)this.expect(C.dollarBraceL),e.expressions.push(this.parseExpression()),this.expect(C.braceR),e.quasis.push(t=this.parseTemplateElement());return this.next(),this.finishNode(e,"TemplateLiteral")},G.parseObj=function(e,t){var r=this.startNode(),n=!0,i={};for(r.properties=[],this.next();!this.eat(C.braceR);){if(n)n=!1;else if(this.expect(C.comma),this.afterTrailingComma(C.braceR))break;var o,s,a,u,c=this.startNode();this.options.ecmaVersion>=6&&(c.method=!1,c.shorthand=!1,(e||t)&&(a=this.start,u=this.startLoc),e||(o=this.eat(C.star))),this.parsePropertyName(c),e||!(this.options.ecmaVersion>=8)||o||c.computed||"Identifier"!==c.key.type||"async"!==c.key.name||this.type===C.parenL||this.type===C.colon||this.canInsertSemicolon()?s=!1:(s=!0,this.parsePropertyName(c,t)),this.parsePropertyValue(c,e,o,s,a,u,t),this.checkPropClash(c,i),r.properties.push(this.finishNode(c,"Property"))}return this.finishNode(r,e?"ObjectPattern":"ObjectExpression")},G.parsePropertyValue=function(e,t,r,n,i,o,s){if((r||n)&&this.type===C.colon&&this.unexpected(),this.eat(C.colon))e.value=t?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,s),e.kind="init";else if(this.options.ecmaVersion>=6&&this.type===C.parenL)t&&this.unexpected(),e.kind="init",e.method=!0,e.value=this.parseMethod(r,n);else if(this.options.ecmaVersion>=5&&!e.computed&&"Identifier"===e.key.type&&("get"===e.key.name||"set"===e.key.name)&&this.type!=C.comma&&this.type!=C.braceR){(r||n||t)&&this.unexpected(),e.kind=e.key.name,this.parsePropertyName(e),e.value=this.parseMethod(!1);var a="get"===e.kind?0:1;if(e.value.params.length!==a){var u=e.value.start;"get"===e.kind?this.raiseRecoverable(u,"getter should have no params"):this.raiseRecoverable(u,"setter should have exactly one param")}else"set"===e.kind&&"RestElement"===e.value.params[0].type&&this.raiseRecoverable(e.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!e.computed&&"Identifier"===e.key.type?((this.keywords.test(e.key.name)||(this.strict?this.reservedWordsStrict:this.reservedWords).test(e.key.name)||this.inGenerator&&"yield"==e.key.name||this.inAsync&&"await"==e.key.name)&&this.raiseRecoverable(e.key.start,"'"+e.key.name+"' can not be used as shorthand property"),e.kind="init",t?e.value=this.parseMaybeDefault(i,o,e.key):this.type===C.eq&&s?(s.shorthandAssign<0&&(s.shorthandAssign=this.start),e.value=this.parseMaybeDefault(i,o,e.key)):e.value=e.key,e.shorthand=!0):this.unexpected()},G.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(C.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(C.bracketR),e.key;e.computed=!1}return e.key=this.type===C.num||this.type===C.string?this.parseExprAtom():this.parseIdent(!0)},G.initFunction=function(e){e.id=null,this.options.ecmaVersion>=6&&(e.generator=!1,e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)},G.parseMethod=function(e,t){var r=this.startNode(),n=this.inGenerator,i=this.inAsync,o=this.yieldPos,s=this.awaitPos,a=this.inFunction;return this.initFunction(r),this.options.ecmaVersion>=6&&(r.generator=e),this.options.ecmaVersion>=8&&(r.async=!!t),this.inGenerator=r.generator,this.inAsync=r.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,this.expect(C.parenL),r.params=this.parseBindingList(C.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(r,!1),this.inGenerator=n,this.inAsync=i,this.yieldPos=o,this.awaitPos=s,this.inFunction=a,this.finishNode(r,"FunctionExpression")},G.parseArrowExpression=function(e,t,r){var n=this.inGenerator,i=this.inAsync,o=this.yieldPos,s=this.awaitPos,a=this.inFunction;return this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!r),this.inGenerator=!1,this.inAsync=e.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,e.params=this.toAssignableList(t,!0),this.parseFunctionBody(e,!0),this.inGenerator=n,this.inAsync=i,this.yieldPos=o,this.awaitPos=s,this.inFunction=a,this.finishNode(e,"ArrowFunctionExpression")},G.parseFunctionBody=function(e,t){var r=t&&this.type!==C.braceL,n=this.strict,i=!1;if(r)e.body=this.parseMaybeAssign(),e.expression=!0;else{var o=this.options.ecmaVersion>=7&&!this.isSimpleParamList(e.params);n&&!o||(i=this.strictDirective(this.end))&&o&&this.raiseRecoverable(e.start,"Illegal 'use strict' directive in function with non-simple parameter list");var s=this.labels;this.labels=[],i&&(this.strict=!0),e.body=this.parseBlock(!0),e.expression=!1,this.labels=s}n||i?(this.strict=!0,e.id&&this.checkLVal(e.id,!0),this.checkParams(e),this.strict=n):!t&&this.isSimpleParamList(e.params)||this.checkParams(e)},G.isSimpleParamList=function(e){for(var t=0;t<e.length;t++)if("Identifier"!==e[t].type)return!1;return!0},G.checkParams=function(e){for(var t={},r=0;r<e.params.length;r++)this.checkLVal(e.params[r],!0,t)},G.parseExprList=function(e,t,r,n){for(var i=[],o=!0;!this.eat(e);){if(o)o=!1;else if(this.expect(C.comma),t&&this.afterTrailingComma(e))break;var s;r&&this.type===C.comma?s=null:this.type===C.ellipsis?(s=this.parseSpread(n),n&&this.type===C.comma&&n.trailingComma<0&&(n.trailingComma=this.start)):s=this.parseMaybeAssign(!1,n),i.push(s)}return i},G.parseIdent=function(e){var t=this.startNode();return e&&"never"==this.options.allowReserved&&(e=!1),this.type===C.name?(!e&&(this.strict?this.reservedWordsStrict:this.reservedWords).test(this.value)&&(this.options.ecmaVersion>=6||-1==this.input.slice(this.start,this.end).indexOf("\\"))&&this.raiseRecoverable(this.start,"The keyword '"+this.value+"' is reserved"),this.inGenerator&&"yield"===this.value&&this.raiseRecoverable(this.start,"Can not use 'yield' as identifier inside a generator"),this.inAsync&&"await"===this.value&&this.raiseRecoverable(this.start,"Can not use 'await' as identifier inside an async function"),t.name=this.value):e&&this.type.keyword?t.name=this.type.keyword:this.unexpected(),this.next(),this.finishNode(t,"Identifier")},G.parseYield=function(){this.yieldPos||(this.yieldPos=this.start);var e=this.startNode();return this.next(),this.type==C.semi||this.canInsertSemicolon()||this.type!=C.star&&!this.type.startsExpr?(e.delegate=!1,e.argument=null):(e.delegate=this.eat(C.star),e.argument=this.parseMaybeAssign()),this.finishNode(e,"YieldExpression")},G.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!0),this.finishNode(e,"AwaitExpression")};var J=L.prototype;J.raise=function(e,t){var r=c(this.input,e);t+=" ("+r.line+":"+r.column+")";var n=new SyntaxError(t);throw n.pos=e,n.loc=r,n.raisedAt=this.pos,n},J.raiseRecoverable=J.raise,J.curPosition=function(){if(this.options.locations)return new B(this.curLine,this.pos-this.lineStart)};var K=function(e,t,r){this.type="",this.start=t,this.end=0,e.options.locations&&(this.loc=new T(e,r)),e.options.directSourceFile&&(this.sourceFile=e.options.directSourceFile),e.options.ranges&&(this.range=[t,0])},Q=L.prototype;Q.startNode=function(){return new K(this,this.start,this.startLoc)},Q.startNodeAt=function(e,t){return new K(this,e,t)},Q.finishNode=function(e,t){return p.call(this,e,t,this.lastTokEnd,this.lastTokEndLoc)},Q.finishNodeAt=function(e,t,r,n){return p.call(this,e,t,r,n)};var Y=function(e,t,r,n){this.token=e,this.isExpr=!!t,this.preserveSpace=!!r,this.override=n},X={b_stat:new Y("{",!1),b_expr:new Y("{",!0),b_tmpl:new Y("${",!0),p_stat:new Y("(",!1),p_expr:new Y("(",!0),q_tmpl:new Y("`",!0,!0,function(e){return e.readTmplToken()}),f_expr:new Y("function",!0)},Z=L.prototype;Z.initialContext=function(){return[X.b_stat]},Z.braceIsBlock=function(e){if(e===C.colon){var t=this.curContext();if(t===X.b_stat||t===X.b_expr)return!t.isExpr}return e===C._return?F.test(this.input.slice(this.lastTokEnd,this.start)):e===C._else||e===C.semi||e===C.eof||e===C.parenR||(e==C.braceL?this.curContext()===X.b_stat:!this.exprAllowed)},Z.updateContext=function(e){var t,r=this.type;r.keyword&&e==C.dot?this.exprAllowed=!1:(t=r.updateContext)?t.call(this,e):this.exprAllowed=r.beforeExpr},C.parenR.updateContext=C.braceR.updateContext=function(){if(1!=this.context.length){var e=this.context.pop();e===X.b_stat&&this.curContext()===X.f_expr?(this.context.pop(),this.exprAllowed=!1):this.exprAllowed=e===X.b_tmpl||!e.isExpr}else this.exprAllowed=!0},C.braceL.updateContext=function(e){this.context.push(this.braceIsBlock(e)?X.b_stat:X.b_expr),this.exprAllowed=!0},C.dollarBraceL.updateContext=function(){this.context.push(X.b_tmpl),this.exprAllowed=!0},C.parenL.updateContext=function(e){var t=e===C._if||e===C._for||e===C._with||e===C._while;this.context.push(t?X.p_stat:X.p_expr),this.exprAllowed=!0},C.incDec.updateContext=function(){},C._function.updateContext=function(e){e.beforeExpr&&e!==C.semi&&e!==C._else&&(e!==C.colon&&e!==C.braceL||this.curContext()!==X.b_stat)&&this.context.push(X.f_expr),this.exprAllowed=!1},C.backQuote.updateContext=function(){this.curContext()===X.q_tmpl?this.context.pop():this.context.push(X.q_tmpl),this.exprAllowed=!1};var ee=function(e){this.type=e.type,this.value=e.value,this.start=e.start,this.end=e.end,e.options.locations&&(this.loc=new T(e,e.startLoc,e.endLoc)),e.options.ranges&&(this.range=[e.start,e.end])},te=L.prototype,re="object"==typeof Packages&&"[object JavaPackage]"==Object.prototype.toString.call(Packages);te.next=function(){this.options.onToken&&this.options.onToken(new ee(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},te.getToken=function(){return this.next(),new ee(this)},"undefined"!=typeof Symbol&&(te[Symbol.iterator]=function(){var e=this;return{next:function(){var t=e.getToken();return{done:t.type===C.eof,value:t}}}}),te.curContext=function(){return this.context[this.context.length-1]},te.nextToken=function(){var e=this.curContext();return e&&e.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(C.eof):e.override?e.override(this):void this.readToken(this.fullCharCodeAtPos())},te.readToken=function(e){return r(e,this.options.ecmaVersion>=6)||92===e?this.readWord():this.getTokenFromCode(e)},te.fullCharCodeAtPos=function(){var e=this.input.charCodeAt(this.pos);if(e<=55295||e>=57344)return e;return(e<<10)+this.input.charCodeAt(this.pos+1)-56613888},te.skipBlockComment=function(){var e=this.options.onComment&&this.curPosition(),t=this.pos,r=this.input.indexOf("*/",this.pos+=2);if(-1===r&&this.raise(this.pos-2,"Unterminated comment"),this.pos=r+2,this.options.locations){O.lastIndex=t;for(var n;(n=O.exec(this.input))&&n.index<this.pos;)++this.curLine,this.lineStart=n.index+n[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(t+2,r),t,this.pos,e,this.curPosition())},te.skipLineComment=function(e){for(var t=this.pos,r=this.options.onComment&&this.curPosition(),n=this.input.charCodeAt(this.pos+=e);this.pos<this.input.length&&10!==n&&13!==n&&8232!==n&&8233!==n;)++this.pos,n=this.input.charCodeAt(this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(t+e,this.pos),t,this.pos,r,this.curPosition())},te.skipSpace=function(){e:for(;this.pos<this.input.length;){var e=this.input.charCodeAt(this.pos);switch(e){case 32:case 160:++this.pos;break;case 13:10===this.input.charCodeAt(this.pos+1)&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(!(e>8&&e<14||e>=5760&&j.test(String.fromCharCode(e))))break e;++this.pos}}},te.finishToken=function(e,t){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var r=this.type;this.type=e,this.value=t,this.updateContext(r)},te.readToken_dot=function(){var e=this.input.charCodeAt(this.pos+1);if(e>=48&&e<=57)return this.readNumber(!0);var t=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===e&&46===t?(this.pos+=3,this.finishToken(C.ellipsis)):(++this.pos,this.finishToken(C.dot))},te.readToken_slash=function(){var e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===e?this.finishOp(C.assign,2):this.finishOp(C.slash,1)},te.readToken_mult_modulo_exp=function(e){var t=this.input.charCodeAt(this.pos+1),r=1,n=42===e?C.star:C.modulo;return this.options.ecmaVersion>=7&&42===t&&(++r,n=C.starstar,t=this.input.charCodeAt(this.pos+2)),61===t?this.finishOp(C.assign,r+1):this.finishOp(n,r)},te.readToken_pipe_amp=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?this.finishOp(124===e?C.logicalOR:C.logicalAND,2):61===t?this.finishOp(C.assign,2):this.finishOp(124===e?C.bitwiseOR:C.bitwiseAND,1)},te.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(C.assign,2):this.finishOp(C.bitwiseXOR,1)},te.readToken_plus_min=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?45==t&&62==this.input.charCodeAt(this.pos+2)&&F.test(this.input.slice(this.lastTokEnd,this.pos))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(C.incDec,2):61===t?this.finishOp(C.assign,2):this.finishOp(C.plusMin,1)},te.readToken_lt_gt=function(e){var t=this.input.charCodeAt(this.pos+1),r=1;return t===e?(r=62===e&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+r)?this.finishOp(C.assign,r+1):this.finishOp(C.bitShift,r)):33==t&&60==e&&45==this.input.charCodeAt(this.pos+2)&&45==this.input.charCodeAt(this.pos+3)?(this.inModule&&this.unexpected(),this.skipLineComment(4),this.skipSpace(),this.nextToken()):(61===t&&(r=2),this.finishOp(C.relational,r))},te.readToken_eq_excl=function(e){var t=this.input.charCodeAt(this.pos+1);return 61===t?this.finishOp(C.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===e&&62===t&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(C.arrow)):this.finishOp(61===e?C.eq:C.prefix,1)},te.getTokenFromCode=function(e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(C.parenL);case 41:return++this.pos,this.finishToken(C.parenR);case 59:return++this.pos,this.finishToken(C.semi);case 44:return++this.pos,this.finishToken(C.comma);case 91:return++this.pos,this.finishToken(C.bracketL);case 93:return++this.pos,this.finishToken(C.bracketR);case 123:return++this.pos,this.finishToken(C.braceL);case 125:return++this.pos,this.finishToken(C.braceR);case 58:return++this.pos,this.finishToken(C.colon);case 63:return++this.pos,this.finishToken(C.question);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(C.backQuote);case 48:var t=this.input.charCodeAt(this.pos+1);if(120===t||88===t)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===t||79===t)return this.readRadixNumber(8);if(98===t||66===t)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 126:return this.finishOp(C.prefix,1)}this.raise(this.pos,"Unexpected character '"+d(e)+"'")},te.finishOp=function(e,t){var r=this.input.slice(this.pos,this.pos+t);return this.pos+=t,this.finishToken(e,r)};var ne=!!h("","u");te.readRegexp=function(){for(var e,t,r=this,n=this.pos;;){r.pos>=r.input.length&&r.raise(n,"Unterminated regular expression");var i=r.input.charAt(r.pos);if(F.test(i)&&r.raise(n,"Unterminated regular expression"),e)e=!1;else{if("["===i)t=!0;else if("]"===i&&t)t=!1;else if("/"===i&&!t)break;e="\\"===i}++r.pos}var o=this.input.slice(n,this.pos);++this.pos;var s=this.readWord1(),a=o,u="";if(s){var c=/^[gim]*$/;this.options.ecmaVersion>=6&&(c=/^[gimuy]*$/),c.test(s)||this.raise(n,"Invalid regular expression flag"),s.indexOf("u")>=0&&(ne?u="u":(a=(a=a.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(e,t,i){return(t=Number("0x"+t))>1114111&&r.raise(n+i+3,"Code point out of bounds"),"x"})).replace(/\\u([a-fA-F0-9]{4})|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"),u=u.replace("u","")))}var l=null;return re||(h(a,u,n,this),l=h(o,s)),this.finishToken(C.regexp,{pattern:o,flags:s,value:l})},te.readInt=function(e,t){for(var r=this.pos,n=0,i=0,o=null==t?1/0:t;i<o;++i){var s,a=this.input.charCodeAt(this.pos);if((s=a>=97?a-97+10:a>=65?a-65+10:a>=48&&a<=57?a-48:1/0)>=e)break;++this.pos,n=n*e+s}return this.pos===r||null!=t&&this.pos-r!==t?null:n},te.readRadixNumber=function(e){this.pos+=2;var t=this.readInt(e);return null==t&&this.raise(this.start+2,"Expected number in radix "+e),r(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(C.num,t)},te.readNumber=function(e){var t=this.pos,n=!1,i=48===this.input.charCodeAt(this.pos);e||null!==this.readInt(10)||this.raise(t,"Invalid number"),i&&this.pos==t+1&&(i=!1);var o=this.input.charCodeAt(this.pos);46!==o||i||(++this.pos,this.readInt(10),n=!0,o=this.input.charCodeAt(this.pos)),69!==o&&101!==o||i||(43!==(o=this.input.charCodeAt(++this.pos))&&45!==o||++this.pos,null===this.readInt(10)&&this.raise(t,"Invalid number"),n=!0),r(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var s,a=this.input.slice(t,this.pos);return n?s=parseFloat(a):i&&1!==a.length?/[89]/.test(a)||this.strict?this.raise(t,"Invalid number"):s=parseInt(a,8):s=parseInt(a,10),this.finishToken(C.num,s)},te.readCodePoint=function(){var e;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var t=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,e>1114111&&this.raise(t,"Code point out of bounds")}else e=this.readHexChar(4);return e},te.readString=function(e){for(var t="",r=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var n=this.input.charCodeAt(this.pos);if(n===e)break;92===n?(t+=this.input.slice(r,this.pos),t+=this.readEscapedChar(!1),r=this.pos):(s(n)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return t+=this.input.slice(r,this.pos++),this.finishToken(C.string,t)},te.readTmplToken=function(){for(var e="",t=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var r=this.input.charCodeAt(this.pos);if(96===r||36===r&&123===this.input.charCodeAt(this.pos+1))return this.pos===this.start&&this.type===C.template?36===r?(this.pos+=2,this.finishToken(C.dollarBraceL)):(++this.pos,this.finishToken(C.backQuote)):(e+=this.input.slice(t,this.pos),this.finishToken(C.template,e));if(92===r)e+=this.input.slice(t,this.pos),e+=this.readEscapedChar(!0),t=this.pos;else if(s(r)){switch(e+=this.input.slice(t,this.pos),++this.pos,r){case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:e+="\n";break;default:e+=String.fromCharCode(r)}this.options.locations&&(++this.curLine,this.lineStart=this.pos),t=this.pos}else++this.pos}},te.readEscapedChar=function(e){var t=this.input.charCodeAt(++this.pos);switch(++this.pos,t){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return d(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";default:if(t>=48&&t<=55){var r=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],n=parseInt(r,8);return n>255&&(r=r.slice(0,-1),n=parseInt(r,8)),"0"!==r&&(this.strict||e)&&this.raise(this.pos-2,"Octal literal in strict mode"),this.pos+=r.length-1,String.fromCharCode(n)}return String.fromCharCode(t)}},te.readHexChar=function(e){var t=this.pos,r=this.readInt(16,e);return null===r&&this.raise(t,"Bad character escape sequence"),r},te.readWord1=function(){this.containsEsc=!1;for(var e="",t=!0,i=this.pos,o=this.options.ecmaVersion>=6;this.pos<this.input.length;){var s=this.fullCharCodeAtPos();if(n(s,o))this.pos+=s<=65535?1:2;else{if(92!==s)break;this.containsEsc=!0,e+=this.input.slice(i,this.pos);var a=this.pos;117!=this.input.charCodeAt(++this.pos)&&this.raise(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var u=this.readCodePoint();(t?r:n)(u,o)||this.raise(a,"Invalid Unicode escape"),e+=d(u),i=this.pos}t=!1}return e+this.input.slice(i,this.pos)},te.readWord=function(){var e=this.readWord1(),t=C.name;return this.keywords.test(e)&&(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+e),t=D[e]),this.finishToken(t,e)};e.version="4.0.11",e.parse=function(e,t){return new L(t,e).parse()},e.parseExpressionAt=function(e,t,r){var n=new L(r,e,t);return n.nextToken(),n.parseExpression()},e.tokenizer=function(e,t){return new L(t,e)},e.addLooseExports=function(t,r,n){e.parse_dammit=t,e.LooseParser=r,e.pluginsLoose=n},e.Parser=L,e.plugins=I,e.defaultOptions=P,e.Position=B,e.SourceLocation=T,e.getLineInfo=c,e.Node=K,e.TokenType=E,e.tokTypes=C,e.keywordTypes=D,e.TokContext=Y,e.tokContexts=X,e.isIdentifierChar=n,e.isIdentifierStart=r,e.Token=ee,e.isNewLine=s,e.lineBreak=F,e.lineBreakG=O,Object.defineProperty(e,"__esModule",{value:!0})}),function(t,r){"function"==typeof e&&e.amd?e(["exports"],r):r((t.acorn=t.acorn||{},t.acorn.walk=t.acorn.walk||{}))}(this,function(e){"use strict";function t(e){return"string"==typeof e?function(t){return t==e}:e||function(){return!0}}function r(e,t,r){r(e,t)}function n(e,t,r){}var i=function(e,t){this.node=e,this.state=t},o=Object.create||function(e){function t(){}return t.prototype=e,new t},s={};s.Program=s.BlockStatement=function(e,t,r){for(var n=0;n<e.body.length;++n)r(e.body[n],t,"Statement")},s.Statement=r,s.EmptyStatement=n,s.ExpressionStatement=s.ParenthesizedExpression=function(e,t,r){return r(e.expression,t,"Expression")},s.IfStatement=function(e,t,r){r(e.test,t,"Expression"),r(e.consequent,t,"Statement"),e.alternate&&r(e.alternate,t,"Statement")},s.LabeledStatement=function(e,t,r){return r(e.body,t,"Statement")},s.BreakStatement=s.ContinueStatement=n,s.WithStatement=function(e,t,r){r(e.object,t,"Expression"),r(e.body,t,"Statement")},s.SwitchStatement=function(e,t,r){r(e.discriminant,t,"Expression");for(var n=0;n<e.cases.length;++n){var i=e.cases[n];i.test&&r(i.test,t,"Expression");for(var o=0;o<i.consequent.length;++o)r(i.consequent[o],t,"Statement")}},s.ReturnStatement=s.YieldExpression=s.AwaitExpression=function(e,t,r){e.argument&&r(e.argument,t,"Expression")},s.ThrowStatement=s.SpreadElement=function(e,t,r){return r(e.argument,t,"Expression")},s.TryStatement=function(e,t,r){r(e.block,t,"Statement"),e.handler&&r(e.handler,t),e.finalizer&&r(e.finalizer,t,"Statement")},s.CatchClause=function(e,t,r){r(e.param,t,"Pattern"),r(e.body,t,"ScopeBody")},s.WhileStatement=s.DoWhileStatement=function(e,t,r){r(e.test,t,"Expression"),r(e.body,t,"Statement")},s.ForStatement=function(e,t,r){e.init&&r(e.init,t,"ForInit"),e.test&&r(e.test,t,"Expression"),e.update&&r(e.update,t,"Expression"),r(e.body,t,"Statement")},s.ForInStatement=s.ForOfStatement=function(e,t,r){r(e.left,t,"ForInit"),r(e.right,t,"Expression"),r(e.body,t,"Statement")},s.ForInit=function(e,t,r){"VariableDeclaration"==e.type?r(e,t):r(e,t,"Expression")},s.DebuggerStatement=n,s.FunctionDeclaration=function(e,t,r){return r(e,t,"Function")},s.VariableDeclaration=function(e,t,r){for(var n=0;n<e.declarations.length;++n)r(e.declarations[n],t)},s.VariableDeclarator=function(e,t,r){r(e.id,t,"Pattern"),e.init&&r(e.init,t,"Expression")},s.Function=function(e,t,r){e.id&&r(e.id,t,"Pattern");for(var n=0;n<e.params.length;n++)r(e.params[n],t,"Pattern");r(e.body,t,e.expression?"ScopeExpression":"ScopeBody")},s.ScopeBody=function(e,t,r){return r(e,t,"Statement")},s.ScopeExpression=function(e,t,r){return r(e,t,"Expression")},s.Pattern=function(e,t,r){"Identifier"==e.type?r(e,t,"VariablePattern"):"MemberExpression"==e.type?r(e,t,"MemberPattern"):r(e,t)},s.VariablePattern=n,s.MemberPattern=r,s.RestElement=function(e,t,r){return r(e.argument,t,"Pattern")},s.ArrayPattern=function(e,t,r){for(var n=0;n<e.elements.length;++n){var i=e.elements[n];i&&r(i,t,"Pattern")}},s.ObjectPattern=function(e,t,r){for(var n=0;n<e.properties.length;++n)r(e.properties[n].value,t,"Pattern")},s.Expression=r,s.ThisExpression=s.Super=s.MetaProperty=n,s.ArrayExpression=function(e,t,r){for(var n=0;n<e.elements.length;++n){var i=e.elements[n];i&&r(i,t,"Expression")}},s.ObjectExpression=function(e,t,r){for(var n=0;n<e.properties.length;++n)r(e.properties[n],t)},s.FunctionExpression=s.ArrowFunctionExpression=s.FunctionDeclaration,s.SequenceExpression=s.TemplateLiteral=function(e,t,r){for(var n=0;n<e.expressions.length;++n)r(e.expressions[n],t,"Expression")},s.UnaryExpression=s.UpdateExpression=function(e,t,r){r(e.argument,t,"Expression")},s.BinaryExpression=s.LogicalExpression=function(e,t,r){r(e.left,t,"Expression"),r(e.right,t,"Expression")},s.AssignmentExpression=s.AssignmentPattern=function(e,t,r){r(e.left,t,"Pattern"),r(e.right,t,"Expression")},s.ConditionalExpression=function(e,t,r){r(e.test,t,"Expression"),r(e.consequent,t,"Expression"),r(e.alternate,t,"Expression")},s.NewExpression=s.CallExpression=function(e,t,r){if(r(e.callee,t,"Expression"),e.arguments)for(var n=0;n<e.arguments.length;++n)r(e.arguments[n],t,"Expression")},s.MemberExpression=function(e,t,r){r(e.object,t,"Expression"),e.computed&&r(e.property,t,"Expression")},s.ExportNamedDeclaration=s.ExportDefaultDeclaration=function(e,t,r){e.declaration&&r(e.declaration,t,"ExportNamedDeclaration"==e.type||e.declaration.id?"Statement":"Expression"),e.source&&r(e.source,t,"Expression")},s.ExportAllDeclaration=function(e,t,r){r(e.source,t,"Expression")},s.ImportDeclaration=function(e,t,r){for(var n=0;n<e.specifiers.length;n++)r(e.specifiers[n],t);r(e.source,t,"Expression")},s.ImportSpecifier=s.ImportDefaultSpecifier=s.ImportNamespaceSpecifier=s.Identifier=s.Literal=n,s.TaggedTemplateExpression=function(e,t,r){r(e.tag,t,"Expression"),r(e.quasi,t)},s.ClassDeclaration=s.ClassExpression=function(e,t,r){return r(e,t,"Class")},s.Class=function(e,t,r){e.id&&r(e.id,t,"Pattern"),e.superClass&&r(e.superClass,t,"Expression");for(var n=0;n<e.body.body.length;n++)r(e.body.body[n],t)},s.MethodDefinition=s.Property=function(e,t,r){e.computed&&r(e.key,t,"Expression"),r(e.value,t,"Expression")},e.simple=function(t,r,n,i,o){n||(n=e.base),function e(t,i,o){var s=o||t.type,a=r[s];n[s](t,i,e),a&&a(t,i)}(t,i,o)},e.ancestor=function(t,r,n,i){n||(n=e.base);var o=[];!function e(t,i,s){var a=s||t.type,u=r[a],c=t!=o[o.length-1];c&&o.push(t),n[a](t,i,e),u&&u(t,i||o,o),c&&o.pop()}(t,i)},e.recursive=function(t,r,n,i,o){var s=n?e.make(n,i):i;!function e(t,r,n){s[n||t.type](t,r,e)}(t,r,o)},e.findNodeAt=function(r,n,o,s,a,u){s=t(s),a||(a=e.base);try{!function e(t,r,u){var c=u||t.type;if((null==n||t.start<=n)&&(null==o||t.end>=o)&&a[c](t,r,e),(null==n||t.start==n)&&(null==o||t.end==o)&&s(c,t))throw new i(t,r)}(r,u)}catch(e){if(e instanceof i)return e;throw e}},e.findNodeAround=function(r,n,o,s,a){o=t(o),s||(s=e.base);try{!function e(t,r,a){var u=a||t.type;if(!(t.start>n||t.end<n)&&(s[u](t,r,e),o(u,t)))throw new i(t,r)}(r,a)}catch(e){if(e instanceof i)return e;throw e}},e.findNodeAfter=function(r,n,o,s,a){o=t(o),s||(s=e.base);try{!function e(t,r,a){if(!(t.end<n)){var u=a||t.type;if(t.start>=n&&o(u,t))throw new i(t,r);s[u](t,r,e)}}(r,a)}catch(e){if(e instanceof i)return e;throw e}},e.findNodeBefore=function(r,n,o,s,a){o=t(o),s||(s=e.base);var u;return function e(t,r,a){if(!(t.start>n)){var c=a||t.type;t.end<=n&&(!u||u.node.end<t.end)&&o(c,t)&&(u=new i(t,r)),s[c](t,r,e)}}(r,a),u},e.make=function(t,r){r||(r=e.base);var n=o(r);for(var i in t)n[i]=t[i];return n},e.base=s,Object.defineProperty(e,"__esModule",{value:!0})}),function(t,r){"function"==typeof e&&e.amd?e(["exports","./acorn"],r):r((t.acorn=t.acorn||{},t.acorn.loose=t.acorn.loose||{}),t.acorn)}(this,function(e,t){"use strict";function r(e){return e<14&&e>8||32===e||160===e||t.isNewLine(e)}function n(e){return""==e.name}function i(e,t){var r=new s(e,t);return r.next(),r.parseTopLevel()}var o={},s=function(e,r){if(void 0===r&&(r={}),this.toks=t.tokenizer(e,r),this.options=this.toks.options,this.input=this.toks.input,this.tok=this.last={type:t.tokTypes.eof,start:0,end:0},this.options.locations){var n=this.toks.curPosition();this.tok.loc=new t.SourceLocation(this.toks,n,n)}this.ahead=[],this.context=[],this.curIndent=0,this.curLineStart=0,this.nextLineStart=this.lineEnd(this.curLineStart)+1,this.inAsync=!1,this.options.pluginsLoose=r.pluginsLoose||{},this.loadPlugins(this.options.pluginsLoose)};s.prototype.startNode=function(){return new t.Node(this.toks,this.tok.start,this.options.locations?this.tok.loc.start:null)},s.prototype.storeCurrentPos=function(){return this.options.locations?[this.tok.start,this.tok.loc.start]:this.tok.start},s.prototype.startNodeAt=function(e){return this.options.locations?new t.Node(this.toks,e[0],e[1]):new t.Node(this.toks,e)},s.prototype.finishNode=function(e,t){return e.type=t,e.end=this.last.end,this.options.locations&&(e.loc.end=this.last.loc.end),this.options.ranges&&(e.range[1]=this.last.end),e},s.prototype.dummyNode=function(e){var r=this.startNode();return r.type=e,r.end=r.start,this.options.locations&&(r.loc.end=r.loc.start),this.options.ranges&&(r.range[1]=r.start),this.last={type:t.tokTypes.name,start:r.start,end:r.start,loc:r.loc},r},s.prototype.dummyIdent=function(){var e=this.dummyNode("Identifier");return e.name="",e},s.prototype.dummyString=function(){var e=this.dummyNode("Literal");return e.value=e.raw="",e},s.prototype.eat=function(e){return this.tok.type===e&&(this.next(),!0)},s.prototype.isContextual=function(e){return this.tok.type===t.tokTypes.name&&this.tok.value===e},s.prototype.eatContextual=function(e){return this.tok.value===e&&this.eat(t.tokTypes.name)},s.prototype.canInsertSemicolon=function(){return this.tok.type===t.tokTypes.eof||this.tok.type===t.tokTypes.braceR||t.lineBreak.test(this.input.slice(this.last.end,this.tok.start))},s.prototype.semicolon=function(){return this.eat(t.tokTypes.semi)},s.prototype.expect=function(e){if(this.eat(e))return!0;for(var t=1;t<=2;t++)if(this.lookAhead(t).type==e){for(var r=0;r<t;r++)this.next();return!0}},s.prototype.pushCx=function(){this.context.push(this.curIndent)},s.prototype.popCx=function(){this.curIndent=this.context.pop()},s.prototype.lineEnd=function(e){for(;e<this.input.length&&!t.isNewLine(this.input.charCodeAt(e));)++e;return e},s.prototype.indentationAfter=function(e){for(var t=0;;++e){var r=this.input.charCodeAt(e);if(32===r)++t;else{if(9!==r)return t;t+=this.options.tabSize}}},s.prototype.closes=function(e,r,n,i){return this.tok.type===e||this.tok.type===t.tokTypes.eof||n!=this.curLineStart&&this.curIndent<r&&this.tokenStartsLine()&&(!i||this.nextLineStart>=this.input.length||this.indentationAfter(this.nextLineStart)<r)},s.prototype.tokenStartsLine=function(){for(var e=this.tok.start-1;e>=this.curLineStart;--e){var t=this.input.charCodeAt(e);if(9!==t&&32!==t)return!1}return!0},s.prototype.extend=function(e,t){this[e]=t(this[e])},s.prototype.loadPlugins=function(e){for(var t in e){var r=o[t];if(!r)throw new Error("Plugin '"+t+"' not found");r(this,e[t])}};var a=s.prototype;a.next=function(){if(this.last=this.tok,this.ahead.length?this.tok=this.ahead.shift():this.tok=this.readToken(),this.tok.start>=this.nextLineStart){for(;this.tok.start>=this.nextLineStart;)this.curLineStart=this.nextLineStart,this.nextLineStart=this.lineEnd(this.curLineStart)+1;this.curIndent=this.indentationAfter(this.curLineStart)}},a.readToken=function(){for(;;)try{return this.toks.next(),this.toks.type===t.tokTypes.dot&&"."===this.input.substr(this.toks.end,1)&&this.options.ecmaVersion>=6&&(this.toks.end++,this.toks.type=t.tokTypes.ellipsis),new t.Token(this.toks)}catch(a){if(!(a instanceof SyntaxError))throw a;var e=a.message,n=a.raisedAt,i=!0;if(/unterminated/i.test(e))if(n=this.lineEnd(a.pos+1),/string/.test(e))i={start:a.pos,end:n,type:t.tokTypes.string,value:this.input.slice(a.pos+1,n)};else if(/regular expr/i.test(e)){var o=this.input.slice(a.pos,n);try{o=new RegExp(o)}catch(e){}i={start:a.pos,end:n,type:t.tokTypes.regexp,value:o}}else i=!!/template/.test(e)&&{start:a.pos,end:n,type:t.tokTypes.template,value:this.input.slice(a.pos,n)};else if(/invalid (unicode|regexp|number)|expecting unicode|octal literal|is reserved|directly after number|expected number in radix/i.test(e))for(;n<this.input.length&&!r(this.input.charCodeAt(n));)++n;else if(/character escape|expected hexadecimal/i.test(e))for(;n<this.input.length;){var s=this.input.charCodeAt(n++);if(34===s||39===s||t.isNewLine(s))break}else if(/unexpected character/i.test(e))n++,i=!1;else{if(!/regular expression/i.test(e))throw a;i=!0}if(this.resetTo(n),!0===i&&(i={start:n,end:n,type:t.tokTypes.name,value:""}),i)return this.options.locations&&(i.loc=new t.SourceLocation(this.toks,t.getLineInfo(this.input,i.start),t.getLineInfo(this.input,i.end))),i}},a.resetTo=function(e){this.toks.pos=e;var r=this.input.charAt(e-1);if(this.toks.exprAllowed=!r||/[\[\{\(,;:?\/*=+\-~!|&%^<>]/.test(r)||/[enwfd]/.test(r)&&/\b(keywords|case|else|return|throw|new|in|(instance|type)of|delete|void)$/.test(this.input.slice(e-10,e)),this.options.locations){this.toks.curLine=1,this.toks.lineStart=t.lineBreakG.lastIndex=0;for(var n;(n=t.lineBreakG.exec(this.input))&&n.index<e;)++this.toks.curLine,this.toks.lineStart=n.index+n[0].length}},a.lookAhead=function(e){for(;e>this.ahead.length;)this.ahead.push(this.readToken());return this.ahead[e-1]};var u=s.prototype;u.parseTopLevel=function(){var e=this.startNodeAt(this.options.locations?[0,t.getLineInfo(this.input,0)]:0);for(e.body=[];this.tok.type!==t.tokTypes.eof;)e.body.push(this.parseStatement());return this.last=this.tok,this.options.ecmaVersion>=6&&(e.sourceType=this.options.sourceType),this.finishNode(e,"Program")},u.parseStatement=function(){var e,r=this.tok.type,i=this.startNode();switch(this.toks.isLet()&&(r=t.tokTypes._var,e="let"),r){case t.tokTypes._break:case t.tokTypes._continue:this.next();var o=r===t.tokTypes._break;return this.semicolon()||this.canInsertSemicolon()?i.label=null:(i.label=this.tok.type===t.tokTypes.name?this.parseIdent():null,this.semicolon()),this.finishNode(i,o?"BreakStatement":"ContinueStatement");case t.tokTypes._debugger:return this.next(),this.semicolon(),this.finishNode(i,"DebuggerStatement");case t.tokTypes._do:return this.next(),i.body=this.parseStatement(),i.test=this.eat(t.tokTypes._while)?this.parseParenExpression():this.dummyIdent(),this.semicolon(),this.finishNode(i,"DoWhileStatement");case t.tokTypes._for:if(this.next(),this.pushCx(),this.expect(t.tokTypes.parenL),this.tok.type===t.tokTypes.semi)return this.parseFor(i,null);var s=this.toks.isLet();if(s||this.tok.type===t.tokTypes._var||this.tok.type===t.tokTypes._const){var a=this.parseVar(!0,s?"let":this.tok.value);return 1!==a.declarations.length||this.tok.type!==t.tokTypes._in&&!this.isContextual("of")?this.parseFor(i,a):this.parseForIn(i,a)}var u=this.parseExpression(!0);return this.tok.type===t.tokTypes._in||this.isContextual("of")?this.parseForIn(i,this.toAssignable(u)):this.parseFor(i,u);case t.tokTypes._function:return this.next(),this.parseFunction(i,!0);case t.tokTypes._if:return this.next(),i.test=this.parseParenExpression(),i.consequent=this.parseStatement(),i.alternate=this.eat(t.tokTypes._else)?this.parseStatement():null,this.finishNode(i,"IfStatement");case t.tokTypes._return:return this.next(),this.eat(t.tokTypes.semi)||this.canInsertSemicolon()?i.argument=null:(i.argument=this.parseExpression(),this.semicolon()),this.finishNode(i,"ReturnStatement");case t.tokTypes._switch:var c=this.curIndent,l=this.curLineStart;this.next(),i.discriminant=this.parseParenExpression(),i.cases=[],this.pushCx(),this.expect(t.tokTypes.braceL);for(var f;!this.closes(t.tokTypes.braceR,c,l,!0);)if(this.tok.type===t.tokTypes._case||this.tok.type===t.tokTypes._default){var p=this.tok.type===t.tokTypes._case;f&&this.finishNode(f,"SwitchCase"),i.cases.push(f=this.startNode()),f.consequent=[],this.next(),f.test=p?this.parseExpression():null,this.expect(t.tokTypes.colon)}else f||(i.cases.push(f=this.startNode()),f.consequent=[],f.test=null),f.consequent.push(this.parseStatement());return f&&this.finishNode(f,"SwitchCase"),this.popCx(),this.eat(t.tokTypes.braceR),this.finishNode(i,"SwitchStatement");case t.tokTypes._throw:return this.next(),i.argument=this.parseExpression(),this.semicolon(),this.finishNode(i,"ThrowStatement");case t.tokTypes._try:if(this.next(),i.block=this.parseBlock(),i.handler=null,this.tok.type===t.tokTypes._catch){var h=this.startNode();this.next(),this.expect(t.tokTypes.parenL),h.param=this.toAssignable(this.parseExprAtom(),!0),this.expect(t.tokTypes.parenR),h.body=this.parseBlock(),i.handler=this.finishNode(h,"CatchClause")}return i.finalizer=this.eat(t.tokTypes._finally)?this.parseBlock():null,i.handler||i.finalizer?this.finishNode(i,"TryStatement"):i.block;case t.tokTypes._var:case t.tokTypes._const:return this.parseVar(!1,e||this.tok.value);case t.tokTypes._while:return this.next(),i.test=this.parseParenExpression(),i.body=this.parseStatement(),this.finishNode(i,"WhileStatement");case t.tokTypes._with:return this.next(),i.object=this.parseParenExpression(),i.body=this.parseStatement(),this.finishNode(i,"WithStatement");case t.tokTypes.braceL:return this.parseBlock();case t.tokTypes.semi:return this.next(),this.finishNode(i,"EmptyStatement");case t.tokTypes._class:return this.parseClass(!0);case t.tokTypes._import:return this.parseImport();case t.tokTypes._export:return this.parseExport();default:if(this.toks.isAsyncFunction())return this.next(),this.next(),this.parseFunction(i,!0,!0);var d=this.parseExpression();return n(d)?(this.next(),this.tok.type===t.tokTypes.eof?this.finishNode(i,"EmptyStatement"):this.parseStatement()):r===t.tokTypes.name&&"Identifier"===d.type&&this.eat(t.tokTypes.colon)?(i.body=this.parseStatement(),i.label=d,this.finishNode(i,"LabeledStatement")):(i.expression=d,this.semicolon(),this.finishNode(i,"ExpressionStatement"))}},u.parseBlock=function(){var e=this.startNode();this.pushCx(),this.expect(t.tokTypes.braceL);var r=this.curIndent,n=this.curLineStart;for(e.body=[];!this.closes(t.tokTypes.braceR,r,n,!0);)e.body.push(this.parseStatement());return this.popCx(),this.eat(t.tokTypes.braceR),this.finishNode(e,"BlockStatement")},u.parseFor=function(e,r){return e.init=r,e.test=e.update=null,this.eat(t.tokTypes.semi)&&this.tok.type!==t.tokTypes.semi&&(e.test=this.parseExpression()),this.eat(t.tokTypes.semi)&&this.tok.type!==t.tokTypes.parenR&&(e.update=this.parseExpression()),this.popCx(),this.expect(t.tokTypes.parenR),e.body=this.parseStatement(),this.finishNode(e,"ForStatement")},u.parseForIn=function(e,r){var n=this.tok.type===t.tokTypes._in?"ForInStatement":"ForOfStatement";return this.next(),e.left=r,e.right=this.parseExpression(),this.popCx(),this.expect(t.tokTypes.parenR),e.body=this.parseStatement(),this.finishNode(e,n)},u.parseVar=function(e,r){var n=this.startNode();n.kind=r,this.next(),n.declarations=[];do{var i=this.startNode();i.id=this.options.ecmaVersion>=6?this.toAssignable(this.parseExprAtom(),!0):this.parseIdent(),i.init=this.eat(t.tokTypes.eq)?this.parseMaybeAssign(e):null,n.declarations.push(this.finishNode(i,"VariableDeclarator"))}while(this.eat(t.tokTypes.comma));if(!n.declarations.length){var o=this.startNode();o.id=this.dummyIdent(),n.declarations.push(this.finishNode(o,"VariableDeclarator"))}return e||this.semicolon(),this.finishNode(n,"VariableDeclaration")},u.parseClass=function(e){var r=this.startNode();this.next(),null==e&&(e=this.tok.type===t.tokTypes.name),this.tok.type===t.tokTypes.name?r.id=this.parseIdent():r.id=e?this.dummyIdent():null,r.superClass=this.eat(t.tokTypes._extends)?this.parseExpression():null,r.body=this.startNode(),r.body.body=[],this.pushCx();var i=this.curIndent+1,o=this.curLineStart;for(this.eat(t.tokTypes.braceL),this.curIndent+1<i&&(i=this.curIndent,o=this.curLineStart);!this.closes(t.tokTypes.braceR,i,o);)if(!this.semicolon()){var s,a,u=this.startNode();this.options.ecmaVersion>=6&&(u.static=!1,s=this.eat(t.tokTypes.star)),this.parsePropertyName(u),n(u.key)?(n(this.parseMaybeAssign())&&this.next(),this.eat(t.tokTypes.comma)):("Identifier"!==u.key.type||u.computed||"static"!==u.key.name||this.tok.type==t.tokTypes.parenL||this.tok.type==t.tokTypes.braceL?u.static=!1:(u.static=!0,s=this.eat(t.tokTypes.star),this.parsePropertyName(u)),u.computed||"Identifier"!==u.key.type||"async"!==u.key.name||this.tok.type===t.tokTypes.parenL||this.canInsertSemicolon()?a=!1:(this.parsePropertyName(u),a=!0),this.options.ecmaVersion>=5&&"Identifier"===u.key.type&&!u.computed&&("get"===u.key.name||"set"===u.key.name)&&this.tok.type!==t.tokTypes.parenL&&this.tok.type!==t.tokTypes.braceL?(u.kind=u.key.name,this.parsePropertyName(u),u.value=this.parseMethod(!1)):(u.computed||u.static||s||a||!("Identifier"===u.key.type&&"constructor"===u.key.name||"Literal"===u.key.type&&"constructor"===u.key.value)?u.kind="method":u.kind="constructor",u.value=this.parseMethod(s,a)),r.body.body.push(this.finishNode(u,"MethodDefinition")))}return this.popCx(),this.eat(t.tokTypes.braceR)||(this.last.end=this.tok.start,this.options.locations&&(this.last.loc.end=this.tok.loc.start)),this.semicolon(),this.finishNode(r.body,"ClassBody"),this.finishNode(r,e?"ClassDeclaration":"ClassExpression")},u.parseFunction=function(e,r,n){var i=this.inAsync;return this.initFunction(e),this.options.ecmaVersion>=6&&(e.generator=this.eat(t.tokTypes.star)),this.options.ecmaVersion>=8&&(e.async=!!n),null==r&&(r=this.tok.type===t.tokTypes.name),this.tok.type===t.tokTypes.name?e.id=this.parseIdent():r&&(e.id=this.dummyIdent()),this.inAsync=e.async,e.params=this.parseFunctionParams(),e.body=this.parseBlock(),this.inAsync=i,this.finishNode(e,r?"FunctionDeclaration":"FunctionExpression")},u.parseExport=function(){var e=this.startNode();if(this.next(),this.eat(t.tokTypes.star))return e.source=this.eatContextual("from")?this.parseExprAtom():this.dummyString(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(t.tokTypes._default)){var r;if(this.tok.type===t.tokTypes._function||(r=this.toks.isAsyncFunction())){var n=this.startNode();this.next(),r&&this.next(),e.declaration=this.parseFunction(n,null,r)}else this.tok.type===t.tokTypes._class?e.declaration=this.parseClass(null):(e.declaration=this.parseMaybeAssign(),this.semicolon());return this.finishNode(e,"ExportDefaultDeclaration")}return this.tok.type.keyword||this.toks.isLet()||this.toks.isAsyncFunction()?(e.declaration=this.parseStatement(),e.specifiers=[],e.source=null):(e.declaration=null,e.specifiers=this.parseExportSpecifierList(),e.source=this.eatContextual("from")?this.parseExprAtom():null,this.semicolon()),this.finishNode(e,"ExportNamedDeclaration")},u.parseImport=function(){var e=this.startNode();if(this.next(),this.tok.type===t.tokTypes.string)e.specifiers=[],e.source=this.parseExprAtom(),e.kind="";else{var r;this.tok.type===t.tokTypes.name&&"from"!==this.tok.value&&((r=this.startNode()).local=this.parseIdent(),this.finishNode(r,"ImportDefaultSpecifier"),this.eat(t.tokTypes.comma)),e.specifiers=this.parseImportSpecifierList(),e.source=this.eatContextual("from")&&this.tok.type==t.tokTypes.string?this.parseExprAtom():this.dummyString(),r&&e.specifiers.unshift(r)}return this.semicolon(),this.finishNode(e,"ImportDeclaration")},u.parseImportSpecifierList=function(){var e=[];if(this.tok.type===t.tokTypes.star){var r=this.startNode();this.next(),r.local=this.eatContextual("as")?this.parseIdent():this.dummyIdent(),e.push(this.finishNode(r,"ImportNamespaceSpecifier"))}else{var i=this.curIndent,o=this.curLineStart,s=this.nextLineStart;for(this.pushCx(),this.eat(t.tokTypes.braceL),this.curLineStart>s&&(s=this.curLineStart);!this.closes(t.tokTypes.braceR,i+(this.curLineStart<=s?1:0),o);){var a=this.startNode();if(this.eat(t.tokTypes.star))a.local=this.eatContextual("as")?this.parseIdent():this.dummyIdent(),this.finishNode(a,"ImportNamespaceSpecifier");else{if(this.isContextual("from"))break;if(a.imported=this.parseIdent(),n(a.imported))break;a.local=this.eatContextual("as")?this.parseIdent():a.imported,this.finishNode(a,"ImportSpecifier")}e.push(a),this.eat(t.tokTypes.comma)}this.eat(t.tokTypes.braceR),this.popCx()}return e},u.parseExportSpecifierList=function(){var e=[],r=this.curIndent,i=this.curLineStart,o=this.nextLineStart;for(this.pushCx(),this.eat(t.tokTypes.braceL),this.curLineStart>o&&(o=this.curLineStart);!this.closes(t.tokTypes.braceR,r+(this.curLineStart<=o?1:0),i)&&!this.isContextual("from");){var s=this.startNode();if(s.local=this.parseIdent(),n(s.local))break;s.exported=this.eatContextual("as")?this.parseIdent():s.local,this.finishNode(s,"ExportSpecifier"),e.push(s),this.eat(t.tokTypes.comma)}return this.eat(t.tokTypes.braceR),this.popCx(),e};var c=s.prototype;c.checkLVal=function(e){if(!e)return e;switch(e.type){case"Identifier":case"MemberExpression":return e;case"ParenthesizedExpression":return e.expression=this.checkLVal(e.expression),e;default:return this.dummyIdent()}},c.parseExpression=function(e){var r=this.storeCurrentPos(),n=this.parseMaybeAssign(e);if(this.tok.type===t.tokTypes.comma){var i=this.startNodeAt(r);for(i.expressions=[n];this.eat(t.tokTypes.comma);)i.expressions.push(this.parseMaybeAssign(e));return this.finishNode(i,"SequenceExpression")}return n},c.parseParenExpression=function(){this.pushCx(),this.expect(t.tokTypes.parenL);var e=this.parseExpression();return this.popCx(),this.expect(t.tokTypes.parenR),e},c.parseMaybeAssign=function(e){if(this.toks.isContextual("yield")){var r=this.startNode();return this.next(),this.semicolon()||this.canInsertSemicolon()||this.tok.type!=t.tokTypes.star&&!this.tok.type.startsExpr?(r.delegate=!1,r.argument=null):(r.delegate=this.eat(t.tokTypes.star),r.argument=this.parseMaybeAssign()),this.finishNode(r,"YieldExpression")}var n=this.storeCurrentPos(),i=this.parseMaybeConditional(e);if(this.tok.type.isAssign){var o=this.startNodeAt(n);return o.operator=this.tok.value,o.left=this.tok.type===t.tokTypes.eq?this.toAssignable(i):this.checkLVal(i),this.next(),o.right=this.parseMaybeAssign(e),this.finishNode(o,"AssignmentExpression")}return i},c.parseMaybeConditional=function(e){var r=this.storeCurrentPos(),n=this.parseExprOps(e);if(this.eat(t.tokTypes.question)){var i=this.startNodeAt(r);return i.test=n,i.consequent=this.parseMaybeAssign(),i.alternate=this.expect(t.tokTypes.colon)?this.parseMaybeAssign(e):this.dummyIdent(),this.finishNode(i,"ConditionalExpression")}return n},c.parseExprOps=function(e){var t=this.storeCurrentPos(),r=this.curIndent,n=this.curLineStart;return this.parseExprOp(this.parseMaybeUnary(!1),t,-1,e,r,n)},c.parseExprOp=function(e,r,n,i,o,s){if(this.curLineStart!=s&&this.curIndent<o&&this.tokenStartsLine())return e;var a=this.tok.type.binop;if(null!=a&&(!i||this.tok.type!==t.tokTypes._in)&&a>n){var u=this.startNodeAt(r);if(u.left=e,u.operator=this.tok.value,this.next(),this.curLineStart!=s&&this.curIndent<o&&this.tokenStartsLine())u.right=this.dummyIdent();else{var c=this.storeCurrentPos();u.right=this.parseExprOp(this.parseMaybeUnary(!1),c,a,i,o,s)}return this.finishNode(u,/&&|\|\|/.test(u.operator)?"LogicalExpression":"BinaryExpression"),this.parseExprOp(u,r,n,i,o,s)}return e},c.parseMaybeUnary=function(e){var r,n=this.storeCurrentPos();if(this.options.ecmaVersion>=8&&this.inAsync&&this.toks.isContextual("await"))r=this.parseAwait(),e=!0;else if(this.tok.type.prefix){var i=this.startNode(),o=this.tok.type===t.tokTypes.incDec;o||(e=!0),i.operator=this.tok.value,i.prefix=!0,this.next(),i.argument=this.parseMaybeUnary(!0),o&&(i.argument=this.checkLVal(i.argument)),r=this.finishNode(i,o?"UpdateExpression":"UnaryExpression")}else if(this.tok.type===t.tokTypes.ellipsis){var s=this.startNode();this.next(),s.argument=this.parseMaybeUnary(e),r=this.finishNode(s,"SpreadElement")}else for(r=this.parseExprSubscripts();this.tok.type.postfix&&!this.canInsertSemicolon();){var a=this.startNodeAt(n);a.operator=this.tok.value,a.prefix=!1,a.argument=this.checkLVal(r),this.next(),r=this.finishNode(a,"UpdateExpression")}if(!e&&this.eat(t.tokTypes.starstar)){var u=this.startNodeAt(n);return u.operator="**",u.left=r,u.right=this.parseMaybeUnary(!1),this.finishNode(u,"BinaryExpression")}return r},c.parseExprSubscripts=function(){var e=this.storeCurrentPos();return this.parseSubscripts(this.parseExprAtom(),e,!1,this.curIndent,this.curLineStart)},c.parseSubscripts=function(e,r,n,i,o){for(;;){if(this.curLineStart!=o&&this.curIndent<=i&&this.tokenStartsLine()){if(this.tok.type!=t.tokTypes.dot||this.curIndent!=i)return e;--i}var s="Identifier"===e.type&&"async"===e.name&&!this.canInsertSemicolon();if(this.eat(t.tokTypes.dot)){var a=this.startNodeAt(r);a.object=e,this.curLineStart!=o&&this.curIndent<=i&&this.tokenStartsLine()?a.property=this.dummyIdent():a.property=this.parsePropertyAccessor()||this.dummyIdent(),a.computed=!1,e=this.finishNode(a,"MemberExpression")}else if(this.tok.type==t.tokTypes.bracketL){this.pushCx(),this.next();var u=this.startNodeAt(r);u.object=e,u.property=this.parseExpression(),u.computed=!0,this.popCx(),this.expect(t.tokTypes.bracketR),e=this.finishNode(u,"MemberExpression")}else if(n||this.tok.type!=t.tokTypes.parenL){if(this.tok.type!=t.tokTypes.backQuote)return e;var c=this.startNodeAt(r);c.tag=e,c.quasi=this.parseTemplate(),e=this.finishNode(c,"TaggedTemplateExpression")}else{var l=this.parseExprList(t.tokTypes.parenR);if(s&&this.eat(t.tokTypes.arrow))return this.parseArrowExpression(this.startNodeAt(r),l,!0);var f=this.startNodeAt(r);f.callee=e,f.arguments=l,e=this.finishNode(f,"CallExpression")}}},c.parseExprAtom=function(){var e;switch(this.tok.type){case t.tokTypes._this:case t.tokTypes._super:var r=this.tok.type===t.tokTypes._this?"ThisExpression":"Super";return e=this.startNode(),this.next(),this.finishNode(e,r);case t.tokTypes.name:var i=this.storeCurrentPos(),o=this.parseIdent(),s=!1;if("async"===o.name&&!this.canInsertSemicolon()){if(this.eat(t.tokTypes._function))return this.parseFunction(this.startNodeAt(i),!1,!0);this.tok.type===t.tokTypes.name&&(o=this.parseIdent(),s=!0)}return this.eat(t.tokTypes.arrow)?this.parseArrowExpression(this.startNodeAt(i),[o],s):o;case t.tokTypes.regexp:e=this.startNode();var a=this.tok.value;return e.regex={pattern:a.pattern,flags:a.flags},e.value=a.value,e.raw=this.input.slice(this.tok.start,this.tok.end),this.next(),this.finishNode(e,"Literal");case t.tokTypes.num:case t.tokTypes.string:return e=this.startNode(),e.value=this.tok.value,e.raw=this.input.slice(this.tok.start,this.tok.end),this.next(),this.finishNode(e,"Literal");case t.tokTypes._null:case t.tokTypes._true:case t.tokTypes._false:return e=this.startNode(),e.value=this.tok.type===t.tokTypes._null?null:this.tok.type===t.tokTypes._true,e.raw=this.tok.type.keyword,this.next(),this.finishNode(e,"Literal");case t.tokTypes.parenL:var u=this.storeCurrentPos();this.next();var c=this.parseExpression();if(this.expect(t.tokTypes.parenR),this.eat(t.tokTypes.arrow)){var l=c.expressions||[c];return l.length&&n(l[l.length-1])&&l.pop(),this.parseArrowExpression(this.startNodeAt(u),l)}if(this.options.preserveParens){var f=this.startNodeAt(u);f.expression=c,c=this.finishNode(f,"ParenthesizedExpression")}return c;case t.tokTypes.bracketL:return e=this.startNode(),e.elements=this.parseExprList(t.tokTypes.bracketR,!0),this.finishNode(e,"ArrayExpression");case t.tokTypes.braceL:return this.parseObj();case t.tokTypes._class:return this.parseClass(!1);case t.tokTypes._function:return e=this.startNode(),this.next(),this.parseFunction(e,!1);case t.tokTypes._new:return this.parseNew();case t.tokTypes.backQuote:return this.parseTemplate();default:return this.dummyIdent()}},c.parseNew=function(){var e=this.startNode(),r=this.curIndent,n=this.curLineStart,i=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(t.tokTypes.dot))return e.meta=i,e.property=this.parseIdent(!0),this.finishNode(e,"MetaProperty");var o=this.storeCurrentPos();return e.callee=this.parseSubscripts(this.parseExprAtom(),o,!0,r,n),this.tok.type==t.tokTypes.parenL?e.arguments=this.parseExprList(t.tokTypes.parenR):e.arguments=[],this.finishNode(e,"NewExpression")},c.parseTemplateElement=function(){var e=this.startNode();return e.value={raw:this.input.slice(this.tok.start,this.tok.end).replace(/\r\n?/g,"\n"),cooked:this.tok.value},this.next(),e.tail=this.tok.type===t.tokTypes.backQuote,this.finishNode(e,"TemplateElement")},c.parseTemplate=function(){var e=this.startNode();this.next(),e.expressions=[];var r=this.parseTemplateElement();for(e.quasis=[r];!r.tail;)this.next(),e.expressions.push(this.parseExpression()),this.expect(t.tokTypes.braceR)?r=this.parseTemplateElement():((r=this.startNode()).value={cooked:"",raw:""},r.tail=!0,this.finishNode(r,"TemplateElement")),e.quasis.push(r);return this.expect(t.tokTypes.backQuote),this.finishNode(e,"TemplateLiteral")},c.parseObj=function(){var e=this.startNode();e.properties=[],this.pushCx();var r=this.curIndent+1,i=this.curLineStart;for(this.eat(t.tokTypes.braceL),this.curIndent+1<r&&(r=this.curIndent,i=this.curLineStart);!this.closes(t.tokTypes.braceR,r,i);){var o,s,a,u=this.startNode();if(this.options.ecmaVersion>=6&&(a=this.storeCurrentPos(),u.method=!1,u.shorthand=!1,o=this.eat(t.tokTypes.star)),this.parsePropertyName(u),u.computed||"Identifier"!==u.key.type||"async"!==u.key.name||this.tok.type===t.tokTypes.parenL||this.tok.type===t.tokTypes.colon||this.canInsertSemicolon()?s=!1:(this.parsePropertyName(u),s=!0),n(u.key))n(this.parseMaybeAssign())&&this.next(),this.eat(t.tokTypes.comma);else{if(this.eat(t.tokTypes.colon))u.kind="init",u.value=this.parseMaybeAssign();else if(this.options.ecmaVersion>=6&&(this.tok.type===t.tokTypes.parenL||this.tok.type===t.tokTypes.braceL))u.kind="init",u.method=!0,u.value=this.parseMethod(o,s);else if(this.options.ecmaVersion>=5&&"Identifier"===u.key.type&&!u.computed&&("get"===u.key.name||"set"===u.key.name)&&this.tok.type!=t.tokTypes.comma&&this.tok.type!=t.tokTypes.braceR)u.kind=u.key.name,this.parsePropertyName(u),u.value=this.parseMethod(!1);else{if(u.kind="init",this.options.ecmaVersion>=6)if(this.eat(t.tokTypes.eq)){var c=this.startNodeAt(a);c.operator="=",c.left=u.key,c.right=this.parseMaybeAssign(),u.value=this.finishNode(c,"AssignmentExpression")}else u.value=u.key;else u.value=this.dummyIdent();u.shorthand=!0}e.properties.push(this.finishNode(u,"Property")),this.eat(t.tokTypes.comma)}}return this.popCx(),this.eat(t.tokTypes.braceR)||(this.last.end=this.tok.start,this.options.locations&&(this.last.loc.end=this.tok.loc.start)),this.finishNode(e,"ObjectExpression")},c.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(t.tokTypes.bracketL))return e.computed=!0,e.key=this.parseExpression(),void this.expect(t.tokTypes.bracketR);e.computed=!1}var r=this.tok.type===t.tokTypes.num||this.tok.type===t.tokTypes.string?this.parseExprAtom():this.parseIdent();e.key=r||this.dummyIdent()},c.parsePropertyAccessor=function(){if(this.tok.type===t.tokTypes.name||this.tok.type.keyword)return this.parseIdent()},c.parseIdent=function(){var e=this.tok.type===t.tokTypes.name?this.tok.value:this.tok.type.keyword;if(!e)return this.dummyIdent();var r=this.startNode();return this.next(),r.name=e,this.finishNode(r,"Identifier")},c.initFunction=function(e){e.id=null,e.params=[],this.options.ecmaVersion>=6&&(e.generator=!1,e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)},c.toAssignable=function(e,t){if(!e||"Identifier"==e.type||"MemberExpression"==e.type&&!t);else if("ParenthesizedExpression"==e.type)e.expression=this.toAssignable(e.expression,t);else{if(this.options.ecmaVersion<6)return this.dummyIdent();if("ObjectExpression"==e.type){e.type="ObjectPattern";for(var r=e.properties,n=0;n<r.length;n++)r[n].value=this.toAssignable(r[n].value,t)}else if("ArrayExpression"==e.type)e.type="ArrayPattern",this.toAssignableList(e.elements,t);else if("SpreadElement"==e.type)e.type="RestElement",e.argument=this.toAssignable(e.argument,t);else{if("AssignmentExpression"!=e.type)return this.dummyIdent();e.type="AssignmentPattern",delete e.operator}}return e},c.toAssignableList=function(e,t){for(var r=0;r<e.length;r++)e[r]=this.toAssignable(e[r],t);return e},c.parseFunctionParams=function(e){return e=this.parseExprList(t.tokTypes.parenR),this.toAssignableList(e,!0)},c.parseMethod=function(e,r){var n=this.startNode(),i=this.inAsync;return this.initFunction(n),this.options.ecmaVersion>=6&&(n.generator=!!e),this.options.ecmaVersion>=8&&(n.async=!!r),this.inAsync=n.async,n.params=this.parseFunctionParams(),n.expression=this.options.ecmaVersion>=6&&this.tok.type!==t.tokTypes.braceL,n.body=n.expression?this.parseMaybeAssign():this.parseBlock(),this.inAsync=i,this.finishNode(n,"FunctionExpression")},c.parseArrowExpression=function(e,r,n){var i=this.inAsync;return this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!n),this.inAsync=e.async,e.params=this.toAssignableList(r,!0),e.expression=this.tok.type!==t.tokTypes.braceL,e.body=e.expression?this.parseMaybeAssign():this.parseBlock(),this.inAsync=i,this.finishNode(e,"ArrowFunctionExpression")},c.parseExprList=function(e,r){this.pushCx();var i=this.curIndent,o=this.curLineStart,s=[];for(this.next();!this.closes(e,i+1,o);)if(this.eat(t.tokTypes.comma))s.push(r?null:this.dummyIdent());else{var a=this.parseMaybeAssign();if(n(a)){if(this.closes(e,i,o))break;this.next()}else s.push(a);this.eat(t.tokTypes.comma)}return this.popCx(),this.eat(e)||(this.last.end=this.tok.start,this.options.locations&&(this.last.loc.end=this.tok.loc.start)),s},c.parseAwait=function(){var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(),this.finishNode(e,"AwaitExpression")},t.defaultOptions.tabSize=4,t.addLooseExports(i,s,o),e.parse_dammit=i,e.LooseParser=s,e.pluginsLoose=o,Object.defineProperty(e,"__esModule",{value:!0})}),function(e){function t(e,t,r){var n=new e.constructor(e.options,e.input,t);if(r)for(var i in r)n[i]=r[i];var o=e,s=n;return["inFunction","inAsync","inGenerator","inModule"].forEach(function(e){e in o&&(s[e]=o[e])}),n.nextToken(),n}var r={exports:{}},n=/^async[\t ]+(return|throw)/,i=/^\s*[):;]/,o=/([^\n])\/\*(\*(?!\/)|[^\n*])*\*\/([^\n])/g;r.exports=function(e,r){r&&"object"==typeof r||(r={}),e.extend("parse",function(t){return function(){return this.inAsync=r.inAsyncFunction,r.awaitAnywhere&&r.inAsyncFunction&&e.raise(node.start,"The options awaitAnywhere and inAsyncFunction are mutually exclusive"),t.apply(this,arguments)}}),e.extend("parseStatement",function(e){return function(t,i){var s=this.start,a=this.startLoc;if("name"===this.type.label&&r.asyncExits&&function(e,t,r){var n=t.input.slice(t.start);return r&&(n=n.replace(o,"$1 $3")),e.test(n)}(n,this)){this.next();var u=this.parseStatement(t,i);return u.async=!0,u.start=s,u.loc&&(u.loc.start=a),u.range&&(u.range[0]=s),u}return e.apply(this,arguments)}}),e.extend("parseIdent",function(e){return function(t){return"module"===this.options.sourceType&&this.options.ecmaVersion>=8&&r.awaitAnywhere?e.call(this,!0):e.apply(this,arguments)}}),e.extend("parseExprAtom",function(e){var n={};return function(i){var o,s=this.start,a=(this.startLoc,e.apply(this,arguments));if("Identifier"===a.type&&"await"===a.name&&!this.inAsync&&r.awaitAnywhere){var u=this.startNodeAt(a.start,a.loc&&a.loc.start);s=this.start;var c={raise:function(){try{return pp.raise.apply(this,arguments)}catch(e){throw n}}};try{if((o=t(this,s-4,c).parseExprSubscripts()).end<=s)return o=t(this,s,c).parseExprSubscripts(),u.argument=o,u=this.finishNodeAt(u,"AwaitExpression",o.end,o.loc&&o.loc.end),this.pos=o.end,this.end=o.end,this.endLoc=o.endLoc,this.next(),u}catch(e){if(e===n)return a;throw e}}return a}});var s={undefined:!0,get:!0,set:!0,static:!0,async:!0,constructor:!0};e.extend("parsePropertyName",function(e){return function(t){var r=t.key&&t.key.name,n=e.apply(this,arguments);return"get"===this.value&&(t.__maybeStaticAsyncGetter=!0),s[this.value]?n:("Identifier"!==n.type||"async"!==n.name&&"async"!==r||function(e,t){return e.lineStart>=t}(this,n.end)||this.input.slice(n.end).match(i)?delete t.__maybeStaticAsyncGetter:"set"===t.kind||"set"===n.name?this.raise(n.start,"'set <member>(value)' cannot be be async"):(this.__isAsyncProp=!0,"Identifier"===(n=e.apply(this,arguments)).type&&"set"===n.name&&this.raise(n.start,"'set <member>(value)' cannot be be async")),n)}}),e.extend("parseClassMethod",function(e){return function(t,r,n){var i=e.apply(this,arguments);return r.__maybeStaticAsyncGetter&&(delete r.__maybeStaticAsyncGetter,"get"!==r.key.name&&(r.kind="get")),i}}),e.extend("parseFunctionBody",function(e){return function(t,r){var n=this.inAsync;this.__isAsyncProp&&(t.async=!0,this.inAsync=!0,delete this.__isAsyncProp);var i=e.apply(this,arguments);return this.inAsync=n,i}})},e.plugins.asyncawait=r.exports}(this.acorn),function(e){var t={exports:{}};t.exports=function(e){function t(e,t){var n=this.startNode(),i=!0,o={};for(n.properties=[],this.next();!this.eat(r.braceR);){if(i)i=!1;else if(this.expect(r.comma),this.afterTrailingComma(r.braceR))break;var s,a,u,c,l=this.startNode();if(this.options.ecmaVersion>=6){if(this.type===r.ellipsis){(l=this.parseSpread()).type=e?"RestElement":"SpreadElement",n.properties.push(l);continue}l.method=!1,l.shorthand=!1,(e||t)&&(u=this.start,c=this.startLoc),e||(s=this.eat(r.star))}this.parsePropertyName(l),e||!(this.options.ecmaVersion>=8)||s||l.computed||"Identifier"!==l.key.type||"async"!==l.key.name||this.type===r.parenL||this.type===r.colon||this.canInsertSemicolon()?a=!1:(a=!0,this.parsePropertyName(l,t)),this.parsePropertyValue(l,e,s,a,u,c,t),this.checkPropClash(l,o),n.properties.push(this.finishNode(l,"Property"))}return this.finishNode(n,e?"ObjectPattern":"ObjectExpression")}var r=e.tokTypes,n=e.Parser.prototype;return e.plugins.objectSpread=function(e){n.parseObj=t},e},t.exports(e)}(this.acorn),this.acorn}(),function(t){(function(r){function n(e,t){if({}.hasOwnProperty.call(n.cache,e))return n.cache[e];var r=n.resolve(e);if(!r)throw new Error("Failed to resolve module "+e);var i={id:e,require:n,filename:e,exports:{},loaded:!1,parent:t,children:[]};t&&t.children.push(i);var o=e.slice(0,e.lastIndexOf("/")+1);return n.cache[e]=i.exports,r.call(i.exports,i,i.exports,o,e),i.loaded=!0,n.cache[e]=i.exports}n.modules={},n.cache={},n.resolve=function(e){return{}.hasOwnProperty.call(n.modules,e)?n.modules[e]:void 0},n.define=function(e,t){n.modules[e]=t};var i=function(){var e="/";return{title:"browser",version:"v7.7.4",browser:!0,env:{},argv:[],nextTick:r.setImmediate||function(e){setTimeout(e,0)},cwd:function(){return e},chdir:function(t){e=t}}}();n.define("/tools/entry-point.js",function(e,i,o,s){!function(){"use strict";r.escodegen=n("/escodegen.js",e),t.escodegen.browser=!0}()}),n.define("/escodegen.js",function(e,t,i,o){!function(){"use strict";function i(e){return k.Statement.hasOwnProperty(e.type)}function o(e,t){var r="";for(t|=0;t>0;t>>>=1,e+=e)1&t&&(r+=e);return r}function s(e){var t=e.length;return t&&T.code.isLineTerminator(e.charCodeAt(t-1))}function a(e,t){var r;for(r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}function u(e,t){function r(e){return"object"==typeof e&&e instanceof Object&&!(e instanceof RegExp)}var n,i;for(n in t)t.hasOwnProperty(n)&&(r(i=t[n])?r(e[n])?u(e[n],i):e[n]=u({},i):e[n]=i);return e}function c(e,t){return 8232==(-2&e)?(t?"u":"\\u")+(8232===e?"2028":"2029"):10===e||13===e?(t?"":"\\")+(10===e?"n":"r"):String.fromCharCode(e)}function l(e,t){var r;return 8===e?"\\b":12===e?"\\f":9===e?"\\t":(r=e.toString(16).toUpperCase(),N||e>255?"\\u"+"0000".slice(r.length)+r:0!==e||T.code.isDecimalDigit(t)?11===e?"\\x0B":"\\x"+"00".slice(r.length)+r:"\\0")}function f(e){if(92===e)return"\\\\";if(10===e)return"\\n";if(13===e)return"\\r";if(8232===e)return"\\u2028";if(8233===e)return"\\u2029";throw new Error("Incorrectly classified character")}function p(e){var t,r,n,i="";for(t=0,r=e.length;t<r;++t)n=e[t],i+=P(n)?p(n):n;return i}function h(e,t){if(!Y)return P(e)?p(e):e;if(null==t){if(e instanceof R)return e;t={}}return null==t.loc?new R(null,null,Y,e,t.name||null):new R(t.loc.start.line,t.loc.start.column,!0===Y?t.loc.source||null:Y,e,t.name||null)}function d(){return z||" "}function m(e,t){var r,n,i,o;return 0===(r=h(e).toString()).length?[t]:0===(n=h(t).toString()).length?[e]:(i=r.charCodeAt(r.length-1),o=n.charCodeAt(0),(43===i||45===i)&&i===o||T.code.isIdentifierPartES5(i)&&T.code.isIdentifierPartES5(o)||47===i&&105===o?[e,d(),t]:T.code.isWhiteSpace(i)||T.code.isLineTerminator(i)||T.code.isWhiteSpace(o)||T.code.isLineTerminator(o)?[e,t]:[e,z,t])}function v(e){return[I,e]}function y(e){var t;t=I,e(I+=L),I=t}function g(e,t){if("Line"===e.type){if(s(e.value))return"//"+e.value;var r="//"+e.value;return Z||(r+="\n"),r}return K.format.indent.adjustMultilineComment&&/[\n\r]/.test(e.value)?function(e,t){var r,n,i,o,s,a,u,c;for(r=e.split(/\r\n|[\r\n]/),a=Number.MAX_VALUE,n=1,i=r.length;n<i;++n){for(o=r[n],s=0;s<o.length&&T.code.isWhiteSpace(o.charCodeAt(s));)++s;a>s&&(a=s)}for(void 0!==t?(u=I,"*"===r[1][a]&&(t+=" "),I=t):(1&a&&--a,u=I),n=1,i=r.length;n<i;++n)c=h(v(r[n].slice(a))),r[n]=Y?c.join(""):c;return I=u,r.join("\n")}("/*"+e.value+"*/",t):"/*"+e.value+"*/"}function b(e,t){var r,n,i,a,u,c,l,f,p,d,m,y;if(e.leadingComments&&e.leadingComments.length>0){if(a=t,Z){for(t=[],f=(i=e.leadingComments[0]).extendedRange,p=i.range,(y=((m=X.substring(f[0],p[0])).match(/\n/g)||[]).length)>0?(t.push(o("\n",y)),t.push(v(g(i)))):(t.push(m),t.push(g(i))),d=p,r=1,n=e.leadingComments.length;r<n;r++)p=(i=e.leadingComments[r]).range,y=(X.substring(d[1],p[0]).match(/\n/g)||[]).length,t.push(o("\n",y)),t.push(v(g(i))),d=p;y=(X.substring(p[1],f[1]).match(/\n/g)||[]).length,t.push(o("\n",y))}else for(i=e.leadingComments[0],t=[],H&&e.type===F.Program&&0===e.body.length&&t.push("\n"),t.push(g(i)),s(h(t).toString())||t.push("\n"),r=1,n=e.leadingComments.length;r<n;++r)s(h(l=[g(i=e.leadingComments[r])]).toString())||l.push("\n"),t.push(v(l));t.push(v(a))}if(e.trailingComments)if(Z)f=(i=e.trailingComments[0]).extendedRange,p=i.range,(y=((m=X.substring(f[0],p[0])).match(/\n/g)||[]).length)>0?(t.push(o("\n",y)),t.push(v(g(i)))):(t.push(m),t.push(g(i)));else for(u=!s(h(t).toString()),c=o(" ",function(e){var t;for(t=e.length-1;t>=0&&!T.code.isLineTerminator(e.charCodeAt(t));--t);return e.length-1-t}(h([I,t,L]).toString())),r=0,n=e.trailingComments.length;r<n;++r)i=e.trailingComments[r],u?(t=0===r?[t,L]:[t,c]).push(g(i,c)):t=[t,v(g(i))],r===n-1||s(h(t).toString())||(t=[t,"\n"]);return t}function _(e,t,r){var n,i=0;for(n=e;n<t;n++)"\n"===X[n]&&i++;for(n=1;n<i;n++)r.push(U)}function x(e,t,r){return t<r?["(",e,")"]:e}function w(e){var t,r,n;for(t=1,r=(n=e.split(/\r\n|\n/)).length;t<r;t++)n[t]=U+I+n[t];return n}function k(){}function E(e){return h(e.name,e)}function S(e,t){return e.async?"async"+(t?d():z):""}function A(e){return e.generator&&!K.moz.starlessGenerator?"*"+z:""}function D(e){var t=e.value;return t.async?S(t,!e.computed):A(t)?"*":""}function C(e){var t;if(t=new k,i(e))return t.generateStatement(e,ne);if(function(e){return k.Expression.hasOwnProperty(e.type)}(e))return t.generateExpression(e,O.Sequence,re);throw new Error("Unknown node type: "+e.type)}var F,O,j,R,B,T,P,I,L,N,M,q,$,W,U,z,V,G,H,J,K,Q,Y,X,Z,ee,te;B=n("/node_modules/estraverse/estraverse.js",e),T=n("/node_modules/esutils/lib/utils.js",e),F=B.Syntax,j={"||":(O={Sequence:0,Yield:1,Await:1,Assignment:1,Conditional:2,ArrowFunction:2,LogicalOR:3,LogicalAND:4,BitwiseOR:5,BitwiseXOR:6,BitwiseAND:7,Equality:8,Relational:9,BitwiseSHIFT:10,Additive:11,Multiplicative:12,Unary:13,Postfix:14,Call:15,New:16,TaggedTemplate:17,Member:18,Primary:19}).LogicalOR,"&&":O.LogicalAND,"|":O.BitwiseOR,"^":O.BitwiseXOR,"&":O.BitwiseAND,"==":O.Equality,"!=":O.Equality,"===":O.Equality,"!==":O.Equality,is:O.Equality,isnt:O.Equality,"<":O.Relational,">":O.Relational,"<=":O.Relational,">=":O.Relational,in:O.Relational,instanceof:O.Relational,"<<":O.BitwiseSHIFT,">>":O.BitwiseSHIFT,">>>":O.BitwiseSHIFT,"+":O.Additive,"-":O.Additive,"*":O.Multiplicative,"%":O.Multiplicative,"/":O.Multiplicative};var re=7,ne=1;(P=Array.isArray)||(P=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),k.prototype.maybeBlock=function(e,t){var r,n,i=this;return n=!K.comment||!e.leadingComments,e.type===F.BlockStatement&&n?[z,this.generateStatement(e,t)]:e.type===F.EmptyStatement&&n?";":(y(function(){r=[U,v(i.generateStatement(e,t))]}),r)},k.prototype.maybeBlockSuffix=function(e,t){var r=s(h(t).toString());return e.type!==F.BlockStatement||K.comment&&e.leadingComments||r?r?[t,I]:[t,U,I]:[t,z]},k.prototype.generatePattern=function(e,t,r){return e.type===F.Identifier?E(e):this.generateExpression(e,t,r)},k.prototype.generateFunctionParams=function(e){var t,r,n,i;if(i=!1,e.type!==F.ArrowFunctionExpression||e.rest||e.defaults&&0!==e.defaults.length||1!==e.params.length||e.params[0].type!==F.Identifier){for((n=e.type===F.ArrowFunctionExpression?[S(e,!1)]:[]).push("("),e.defaults&&(i=!0),t=0,r=e.params.length;t<r;++t)i&&e.defaults[t]?n.push(this.generateAssignment(e.params[t],e.defaults[t],"=",O.Assignment,re)):n.push(this.generatePattern(e.params[t],O.Assignment,re)),t+1<r&&n.push(","+z);e.rest&&(e.params.length&&n.push(","+z),n.push("..."),n.push(E(e.rest))),n.push(")")}else n=[S(e,!0),E(e.params[0])];return n},k.prototype.generateFunctionBody=function(e){var t,r;return t=this.generateFunctionParams(e),e.type===F.ArrowFunctionExpression&&(t.push(z),t.push("=>")),e.expression?(t.push(z),"{"===(r=this.generateExpression(e.body,O.Assignment,re)).toString().charAt(0)&&(r=["(",r,")"]),t.push(r)):t.push(this.maybeBlock(e.body,9)),t},k.prototype.generateIterationForStatement=function(e,t,r){var n=["for"+z+"("],i=this;return y(function(){t.left.type===F.VariableDeclaration?y(function(){n.push(t.left.kind+d()),n.push(i.generateStatement(t.left.declarations[0],0))}):n.push(i.generateExpression(t.left,O.Call,re)),n=[m(n=m(n,e),i.generateExpression(t.right,O.Sequence,re)),")"]}),n.push(this.maybeBlock(t.body,r)),n},k.prototype.generatePropertyKey=function(e,t,r){var n=[];return t&&n.push("["),"AssignmentPattern"===r.type?n.push(this.AssignmentPattern(r,O.Sequence,re)):n.push(this.generateExpression(e,O.Sequence,re)),t&&n.push("]"),n},k.prototype.generateAssignment=function(e,t,r,n,i){return O.Assignment<n&&(i|=1),x([this.generateExpression(e,O.Call,i),z+r+z,this.generateExpression(t,O.Assignment,i)],O.Assignment,n)},k.prototype.semicolon=function(e){return!G&&32&e?"":";"},a(k.prototype,k.Statement={BlockStatement:function(e,t){var r,n,i=["{",U],o=this;return y(function(){0===e.body.length&&Z&&(r=e.range)[1]-r[0]>2&&("\n"===(n=X.substring(r[0]+1,r[1]-1))[0]&&(i=["{"]),i.push(n));var a,u,c,l;for(l=ne,8&t&&(l|=16),a=0,u=e.body.length;a<u;++a)Z&&(0===a&&(e.body[0].leadingComments&&(r=e.body[0].leadingComments[0].extendedRange,"\n"===(n=X.substring(r[0],r[1]))[0]&&(i=["{"])),e.body[0].leadingComments||_(e.range[0],e.body[0].range[0],i)),a>0&&(e.body[a-1].trailingComments||e.body[a].leadingComments||_(e.body[a-1].range[1],e.body[a].range[0],i))),a===u-1&&(l|=32),c=e.body[a].leadingComments&&Z?o.generateStatement(e.body[a],l):v(o.generateStatement(e.body[a],l)),i.push(c),s(h(c).toString())||(Z&&a<u-1?e.body[a+1].leadingComments||i.push(U):i.push(U)),Z&&a===u-1&&(e.body[a].trailingComments||_(e.body[a].range[1],e.range[1],i))}),i.push(v("}")),i},BreakStatement:function(e,t){return e.label?"break "+e.label.name+this.semicolon(t):"break"+this.semicolon(t)},ContinueStatement:function(e,t){return e.label?"continue "+e.label.name+this.semicolon(t):"continue"+this.semicolon(t)},ClassBody:function(e,t){var r=["{",U],n=this;return y(function(t){var i,o;for(i=0,o=e.body.length;i<o;++i)r.push(t),r.push(n.generateExpression(e.body[i],O.Sequence,re)),i+1<o&&r.push(U)}),s(h(r).toString())||r.push(U),r.push(I),r.push("}"),r},ClassDeclaration:function(e,t){var r;return r=["class"],e.id&&(r=m(r,this.generateExpression(e.id,O.Sequence,re))),e.superClass&&(r=m(r,m("extends",this.generateExpression(e.superClass,O.Assignment,re)))),r.push(z),r.push(this.generateStatement(e.body,33)),r},DirectiveStatement:function(e,t){return K.raw&&e.raw?e.raw+this.semicolon(t):function(e){var t,r,n,i;for(i="double"===$?'"':"'",t=0,r=e.length;t<r;++t){if(39===(n=e.charCodeAt(t))){i='"';break}if(34===n){i="'";break}92===n&&++t}return i+e+i}(e.directive)+this.semicolon(t)},DoWhileStatement:function(e,t){var r=m("do",this.maybeBlock(e.body,ne));return r=this.maybeBlockSuffix(e.body,r),m(r,["while"+z+"(",this.generateExpression(e.test,O.Sequence,re),")"+this.semicolon(t)])},CatchClause:function(e,t){var r,n=this;return y(function(){var t;r=["catch"+z+"(",n.generateExpression(e.param,O.Sequence,re),")"],e.guard&&(t=n.generateExpression(e.guard,O.Sequence,re),r.splice(2,0," if ",t))}),r.push(this.maybeBlock(e.body,ne)),r},DebuggerStatement:function(e,t){return"debugger"+this.semicolon(t)},EmptyStatement:function(e,t){return";"},ExportDefaultDeclaration:function(e,t){var r,n=["export"];return r=32&t?33:ne,n=m(n,"default"),n=i(e.declaration)?m(n,this.generateStatement(e.declaration,r)):m(n,this.generateExpression(e.declaration,O.Assignment,re)+this.semicolon(t))},ExportNamedDeclaration:function(e,t){var r,n=["export"],i=this;return r=32&t?33:ne,e.declaration?m(n,this.generateStatement(e.declaration,r)):(e.specifiers&&(0===e.specifiers.length?n=m(n,"{"+z+"}"):e.specifiers[0].type===F.ExportBatchSpecifier?n=m(n,this.generateExpression(e.specifiers[0],O.Sequence,re)):(n=m(n,"{"),y(function(t){var r,o;for(n.push(U),r=0,o=e.specifiers.length;r<o;++r)n.push(t),n.push(i.generateExpression(e.specifiers[r],O.Sequence,re)),r+1<o&&n.push(","+U)}),s(h(n).toString())||n.push(U),n.push(I+"}")),e.source?n=m(n,["from"+z,this.generateExpression(e.source,O.Sequence,re),this.semicolon(t)]):n.push(this.semicolon(t))),n)},ExportAllDeclaration:function(e,t){return["export"+z,"*"+z,"from"+z,this.generateExpression(e.source,O.Sequence,re),this.semicolon(t)]},ExpressionStatement:function(e,t){var r,n;return r=[this.generateExpression(e.expression,O.Sequence,re)],123===(n=h(r).toString()).charCodeAt(0)||function(e){var t;return"class"===e.slice(0,5)&&(123===(t=e.charCodeAt(5))||T.code.isWhiteSpace(t)||T.code.isLineTerminator(t))}(n)||function(e){var t;return"function"===e.slice(0,8)&&(40===(t=e.charCodeAt(8))||T.code.isWhiteSpace(t)||42===t||T.code.isLineTerminator(t))}(n)||function(e){var t,r,n;if("async"!==e.slice(0,5))return!1;if(!T.code.isWhiteSpace(e.charCodeAt(5)))return!1;for(r=6,n=e.length;r<n&&T.code.isWhiteSpace(e.charCodeAt(r));++r);return r!==n&&"function"===e.slice(r,r+8)&&(40===(t=e.charCodeAt(r+8))||T.code.isWhiteSpace(t)||42===t||T.code.isLineTerminator(t))}(n)||J&&16&t&&e.expression.type===F.Literal&&"string"==typeof e.expression.value?r=["(",r,")"+this.semicolon(t)]:r.push(this.semicolon(t)),r},ImportDeclaration:function(e,t){var r,n,i=this;return 0===e.specifiers.length?["import",z,this.generateExpression(e.source,O.Sequence,re),this.semicolon(t)]:(r=["import"],n=0,e.specifiers[n].type===F.ImportDefaultSpecifier&&(r=m(r,[this.generateExpression(e.specifiers[n],O.Sequence,re)]),++n),e.specifiers[n]&&(0!==n&&r.push(","),e.specifiers[n].type===F.ImportNamespaceSpecifier?r=m(r,[z,this.generateExpression(e.specifiers[n],O.Sequence,re)]):(r.push(z+"{"),e.specifiers.length-n==1?(r.push(z),r.push(this.generateExpression(e.specifiers[n],O.Sequence,re)),r.push(z+"}"+z)):(y(function(t){var o,s;for(r.push(U),o=n,s=e.specifiers.length;o<s;++o)r.push(t),r.push(i.generateExpression(e.specifiers[o],O.Sequence,re)),o+1<s&&r.push(","+U)}),s(h(r).toString())||r.push(U),r.push(I+"}"+z)))),r=m(r,["from"+z,this.generateExpression(e.source,O.Sequence,re),this.semicolon(t)]))},VariableDeclarator:function(e,t){var r=1&t?re:6;return e.init?[this.generateExpression(e.id,O.Assignment,r),z,"=",z,this.generateExpression(e.init,O.Assignment,r)]:this.generatePattern(e.id,O.Assignment,r)},VariableDeclaration:function(e,t){function r(){for(s=e.declarations[0],K.comment&&s.leadingComments?(n.push("\n"),n.push(v(u.generateStatement(s,a)))):(n.push(d()),n.push(u.generateStatement(s,a))),i=1,o=e.declarations.length;i<o;++i)s=e.declarations[i],K.comment&&s.leadingComments?(n.push(","+U),n.push(v(u.generateStatement(s,a)))):(n.push(","+z),n.push(u.generateStatement(s,a)))}var n,i,o,s,a,u=this;return n=[e.kind],a=1&t?ne:0,e.declarations.length>1?y(r):r(),n.push(this.semicolon(t)),n},ThrowStatement:function(e,t){return[m("throw",this.generateExpression(e.argument,O.Sequence,re)),this.semicolon(t)]},TryStatement:function(e,t){var r,n,i,o;if(r=["try",this.maybeBlock(e.block,ne)],r=this.maybeBlockSuffix(e.block,r),e.handlers)for(n=0,i=e.handlers.length;n<i;++n)r=m(r,this.generateStatement(e.handlers[n],ne)),(e.finalizer||n+1!==i)&&(r=this.maybeBlockSuffix(e.handlers[n].body,r));else{for(n=0,i=(o=e.guardedHandlers||[]).length;n<i;++n)r=m(r,this.generateStatement(o[n],ne)),(e.finalizer||n+1!==i)&&(r=this.maybeBlockSuffix(o[n].body,r));if(e.handler)if(P(e.handler))for(n=0,i=e.handler.length;n<i;++n)r=m(r,this.generateStatement(e.handler[n],ne)),(e.finalizer||n+1!==i)&&(r=this.maybeBlockSuffix(e.handler[n].body,r));else r=m(r,this.generateStatement(e.handler,ne)),e.finalizer&&(r=this.maybeBlockSuffix(e.handler.body,r))}return e.finalizer&&(r=m(r,["finally",this.maybeBlock(e.finalizer,ne)])),r},SwitchStatement:function(e,t){var r,n,i,o,a,u=this;if(y(function(){r=["switch"+z+"(",u.generateExpression(e.discriminant,O.Sequence,re),")"+z+"{"+U]}),e.cases)for(a=ne,i=0,o=e.cases.length;i<o;++i)i===o-1&&(a|=32),n=v(this.generateStatement(e.cases[i],a)),r.push(n),s(h(n).toString())||r.push(U);return r.push(v("}")),r},SwitchCase:function(e,t){var r,n,i,o,a,u=this;return y(function(){for(r=e.test?[m("case",u.generateExpression(e.test,O.Sequence,re)),":"]:["default:"],i=0,(o=e.consequent.length)&&e.consequent[0].type===F.BlockStatement&&(n=u.maybeBlock(e.consequent[0],ne),r.push(n),i=1),i===o||s(h(r).toString())||r.push(U),a=ne;i<o;++i)i===o-1&&32&t&&(a|=32),n=v(u.generateStatement(e.consequent[i],a)),r.push(n),i+1===o||s(h(n).toString())||r.push(U)}),r},IfStatement:function(e,t){var r,n,i,o=this;return y(function(){r=["if"+z+"(",o.generateExpression(e.test,O.Sequence,re),")"]}),i=32&t,n=ne,i&&(n|=32),e.alternate?(r.push(this.maybeBlock(e.consequent,ne)),r=this.maybeBlockSuffix(e.consequent,r),r=e.alternate.type===F.IfStatement?m(r,["else ",this.generateStatement(e.alternate,n)]):m(r,m("else",this.maybeBlock(e.alternate,n)))):r.push(this.maybeBlock(e.consequent,n)),r},ForStatement:function(e,t){var r,n=this;return y(function(){r=["for"+z+"("],e.init?e.init.type===F.VariableDeclaration?r.push(n.generateStatement(e.init,0)):(r.push(n.generateExpression(e.init,O.Sequence,6)),r.push(";")):r.push(";"),e.test?(r.push(z),r.push(n.generateExpression(e.test,O.Sequence,re)),r.push(";")):r.push(";"),e.update?(r.push(z),r.push(n.generateExpression(e.update,O.Sequence,re)),r.push(")")):r.push(")")}),r.push(this.maybeBlock(e.body,32&t?33:ne)),r},ForInStatement:function(e,t){return this.generateIterationForStatement("in",e,32&t?33:ne)},ForOfStatement:function(e,t){return this.generateIterationForStatement("of",e,32&t?33:ne)},LabeledStatement:function(e,t){return[e.label.name+":",this.maybeBlock(e.body,32&t?33:ne)]},Program:function(e,t){var r,n,i,o,a;for(o=e.body.length,r=[H&&o>0?"\n":""],a=17,i=0;i<o;++i)H||i!==o-1||(a|=32),Z&&(0===i&&(e.body[0].leadingComments||_(e.range[0],e.body[i].range[0],r)),i>0&&(e.body[i-1].trailingComments||e.body[i].leadingComments||_(e.body[i-1].range[1],e.body[i].range[0],r))),n=v(this.generateStatement(e.body[i],a)),r.push(n),i+1<o&&!s(h(n).toString())&&(Z?e.body[i+1].leadingComments||r.push(U):r.push(U)),Z&&i===o-1&&(e.body[i].trailingComments||_(e.body[i].range[1],e.range[1],r));return r},FunctionDeclaration:function(e,t){return[S(e,!0),"function",A(e)||d(),e.id?E(e.id):"",this.generateFunctionBody(e)]},ReturnStatement:function(e,t){return e.argument?[m("return",this.generateExpression(e.argument,O.Sequence,re)),this.semicolon(t)]:["return"+this.semicolon(t)]},WhileStatement:function(e,t){var r,n=this;return y(function(){r=["while"+z+"(",n.generateExpression(e.test,O.Sequence,re),")"]}),r.push(this.maybeBlock(e.body,32&t?33:ne)),r},WithStatement:function(e,t){var r,n=this;return y(function(){r=["with"+z+"(",n.generateExpression(e.object,O.Sequence,re),")"]}),r.push(this.maybeBlock(e.body,32&t?33:ne)),r}}),a(k.prototype,k.Expression={SequenceExpression:function(e,t,r){var n,i,o;for(O.Sequence<t&&(r|=1),n=[],i=0,o=e.expressions.length;i<o;++i)n.push(this.generateExpression(e.expressions[i],O.Assignment,r)),i+1<o&&n.push(","+z);return x(n,O.Sequence,t)},AssignmentExpression:function(e,t,r){return this.generateAssignment(e.left,e.right,e.operator,t,r)},ArrowFunctionExpression:function(e,t,r){return x(this.generateFunctionBody(e),O.ArrowFunction,t)},ConditionalExpression:function(e,t,r){return O.Conditional<t&&(r|=1),x([this.generateExpression(e.test,O.LogicalOR,r),z+"?"+z,this.generateExpression(e.consequent,O.Assignment,r),z+":"+z,this.generateExpression(e.alternate,O.Assignment,r)],O.Conditional,t)},LogicalExpression:function(e,t,r){return this.BinaryExpression(e,t,r)},BinaryExpression:function(e,t,r){var n,i,o,s;return(i=j[e.operator])<t&&(r|=1),o=this.generateExpression(e.left,i,r),s=o.toString(),n=47===s.charCodeAt(s.length-1)&&T.code.isIdentifierPartES5(e.operator.charCodeAt(0))?[o,d(),e.operator]:m(o,e.operator),o=this.generateExpression(e.right,i+1,r),"/"===e.operator&&"/"===o.toString().charAt(0)||"<"===e.operator.slice(-1)&&"!--"===o.toString().slice(0,3)?(n.push(d()),n.push(o)):n=m(n,o),"in"!==e.operator||1&r?x(n,i,t):["(",n,")"]},CallExpression:function(e,t,r){var n,i,o;for((n=[this.generateExpression(e.callee,O.Call,3)]).push("("),i=0,o=e.arguments.length;i<o;++i)n.push(this.generateExpression(e.arguments[i],O.Assignment,re)),i+1<o&&n.push(","+z);return n.push(")"),2&r?x(n,O.Call,t):["(",n,")"]},NewExpression:function(e,t,r){var n,i,o,s,a;if(i=e.arguments.length,a=4&r&&!V&&0===i?5:1,n=m("new",this.generateExpression(e.callee,O.New,a)),!(4&r)||V||i>0){for(n.push("("),o=0,s=i;o<s;++o)n.push(this.generateExpression(e.arguments[o],O.Assignment,re)),o+1<s&&n.push(","+z);n.push(")")}return x(n,O.New,t)},MemberExpression:function(e,t,r){var n,i;return n=[this.generateExpression(e.object,O.Call,2&r?3:1)],e.computed?(n.push("["),n.push(this.generateExpression(e.property,O.Sequence,2&r?re:5)),n.push("]")):(e.object.type===F.Literal&&"number"==typeof e.object.value&&(i=h(n).toString()).indexOf(".")<0&&!/[eExX]/.test(i)&&T.code.isDecimalDigit(i.charCodeAt(i.length-1))&&!(i.length>=2&&48===i.charCodeAt(0))&&n.push("."),n.push("."),n.push(E(e.property))),x(n,O.Member,t)},MetaProperty:function(e,t,r){var n,i,o;return i="string"==typeof e.meta.type&&e.meta.type===F.Identifier?e.meta.name:e.meta,o="string"==typeof e.property.type&&e.property.type===F.Identifier?e.property.name:e.property,n=[i,".",o],x(n,O.Member,t)},UnaryExpression:function(e,t,r){var n,i,o,s,a;return i=this.generateExpression(e.argument,O.Unary,re),""===z?n=m(e.operator,i):(n=[e.operator],e.operator.length>2?n=m(n,i):(a=(s=h(n).toString()).charCodeAt(s.length-1),o=i.toString().charCodeAt(0),(43===a||45===a)&&a===o||T.code.isIdentifierPartES5(a)&&T.code.isIdentifierPartES5(o)?(n.push(d()),n.push(i)):n.push(i))),x(n,O.Unary,t)},YieldExpression:function(e,t,r){var n;return n=e.delegate?"yield*":"yield",e.argument&&(n=m(n,this.generateExpression(e.argument,O.Yield,re))),x(n,O.Yield,t)},AwaitExpression:function(e,t,r){return x(m(e.all?"await*":"await",this.generateExpression(e.argument,O.Await,re)),O.Await,t)},UpdateExpression:function(e,t,r){return e.prefix?x([e.operator,this.generateExpression(e.argument,O.Unary,re)],O.Unary,t):x([this.generateExpression(e.argument,O.Postfix,re),e.operator],O.Postfix,t)},FunctionExpression:function(e,t,r){var n=[S(e,!0),"function"];return e.id?(n.push(A(e)||d()),n.push(E(e.id))):n.push(A(e)||z),n.push(this.generateFunctionBody(e)),n},ArrayPattern:function(e,t,r){return this.ArrayExpression(e,t,r,!0)},ArrayExpression:function(e,t,r,n){var i,o,a=this;return e.elements.length?(o=!n&&e.elements.length>1,i=["[",o?U:""],y(function(t){var r,n;for(r=0,n=e.elements.length;r<n;++r)e.elements[r]?(i.push(o?t:""),i.push(a.generateExpression(e.elements[r],O.Assignment,re))):(o&&i.push(t),r+1===n&&i.push(",")),r+1<n&&i.push(","+(o?U:z))}),o&&!s(h(i).toString())&&i.push(U),i.push(o?I:""),i.push("]"),i):"[]"},RestElement:function(e,t,r){return"..."+this.generatePattern(e.argument)},ClassExpression:function(e,t,r){var n;return n=["class"],e.id&&(n=m(n,this.generateExpression(e.id,O.Sequence,re))),e.superClass&&(n=m(n,m("extends",this.generateExpression(e.superClass,O.Assignment,re)))),n.push(z),n.push(this.generateStatement(e.body,33)),n},MethodDefinition:function(e,t,r){var n,i;return n=e.static?["static"+z]:[],i="get"===e.kind||"set"===e.kind?[m(e.kind,this.generatePropertyKey(e.key,e.computed,e.value)),this.generateFunctionBody(e.value)]:[D(e),this.generatePropertyKey(e.key,e.computed,e.value),this.generateFunctionBody(e.value)],m(n,i)},Property:function(e,t,r){return"get"===e.kind||"set"===e.kind?[e.kind,d(),this.generatePropertyKey(e.key,e.computed,e.value),this.generateFunctionBody(e.value)]:e.shorthand?this.generatePropertyKey(e.key,e.computed,e.value):e.method?[D(e),this.generatePropertyKey(e.key,e.computed,e.value),this.generateFunctionBody(e.value)]:[this.generatePropertyKey(e.key,e.computed,e.value),":"+z,this.generateExpression(e.value,O.Assignment,re)]},ObjectExpression:function(e,t,r){var n,i,o,a=this;return e.properties.length?(n=e.properties.length>1,y(function(){o=a.generateExpression(e.properties[0],O.Sequence,re)}),n||function(e){return/[\r\n]/g.test(e)}(h(o).toString())?(y(function(t){var r,s;if(i=["{",U,t,o],n)for(i.push(","+U),r=1,s=e.properties.length;r<s;++r)i.push(t),i.push(a.generateExpression(e.properties[r],O.Sequence,re)),r+1<s&&i.push(","+U)}),s(h(i).toString())||i.push(U),i.push(I),i.push("}"),i):["{",z,o,z,"}"]):"{}"},AssignmentPattern:function(e,t,r){return this.generateAssignment(e.left,e.right,"=",t,r)},ObjectPattern:function(e,t,r){var n,i,o,a,u,c=this;if(!e.properties.length)return"{}";if(a=!1,1===e.properties.length)"RestElement"!==(u=e.properties[0]).type&&u.value.type!==F.Identifier&&(a=!0);else for(i=0,o=e.properties.length;i<o;++i)if("RestElement"!==(u=e.properties[i]).type&&!u.shorthand){a=!0;break}return n=["{",a?U:""],y(function(t){var r,i;for(r=0,i=e.properties.length;r<i;++r)n.push(a?t:""),n.push(c.generateExpression(e.properties[r],O.Sequence,re)),r+1<i&&n.push(","+(a?U:z))}),a&&!s(h(n).toString())&&n.push(U),n.push(a?I:""),n.push("}"),n},ThisExpression:function(e,t,r){return"this"},Super:function(e,t,r){return"super"},Identifier:function(e,t,r){return E(e)},ImportDefaultSpecifier:function(e,t,r){return E(e.id||e.local)},ImportNamespaceSpecifier:function(e,t,r){var n=["*"],i=e.id||e.local;return i&&n.push(z+"as"+d()+E(i)),n},ImportSpecifier:function(e,t,r){var n=e.imported,i=[n.name],o=e.local;return o&&o.name!==n.name&&i.push(d()+"as"+d()+E(o)),i},ExportSpecifier:function(e,t,r){var n=e.local,i=[n.name],o=e.exported;return o&&o.name!==n.name&&i.push(d()+"as"+d()+E(o)),i},Literal:function(e,t,r){var n;if(e.hasOwnProperty("raw")&&Q&&K.raw)try{if((n=Q(e.raw).body[0].expression).type===F.Literal&&n.value===e.value)return e.raw}catch(e){}return null===e.value?"null":"string"==typeof e.value?function(e){var t,r,n,i,o,s="",a=0,u=0;for(t=0,r=e.length;t<r;++t){if(39===(n=e.charCodeAt(t)))++a;else if(34===n)++u;else if(47===n&&N)s+="\\";else{if(T.code.isLineTerminator(n)||92===n){s+=f(n);continue}if(!T.code.isIdentifierPartES5(n)&&(N&&n<32||!N&&!W&&(n<32||n>126))){s+=l(n,e.charCodeAt(t+1));continue}}s+=String.fromCharCode(n)}if(i=!("double"===$||"auto"===$&&u<a),o=i?"'":'"',!(i?a:u))return o+s+o;for(e=s,s=o,t=0,r=e.length;t<r;++t)(39===(n=e.charCodeAt(t))&&i||34===n&&!i)&&(s+="\\"),s+=String.fromCharCode(n);return s+o}(e.value):"number"==typeof e.value?function(e){var t,r,n,i,o;if(e!=e)throw new Error("Numeric literal whose value is NaN");if(e<0||0===e&&1/e<0)throw new Error("Numeric literal whose value is negative");if(e===1/0)return N?"null":M?"1e400":"1e+400";if(t=""+e,!M||t.length<3)return t;for(r=t.indexOf("."),N||48!==t.charCodeAt(0)||1!==r||(r=0,t=t.slice(1)),n=t,t=t.replace("e+","e"),i=0,(o=n.indexOf("e"))>0&&(i=+n.slice(o+1),n=n.slice(0,o)),r>=0&&(i-=n.length-r-1,n=+(n.slice(0,r)+n.slice(r+1))+""),o=0;48===n.charCodeAt(n.length+o-1);)--o;return 0!==o&&(i-=o,n=n.slice(0,o)),0!==i&&(n+="e"+i),(n.length<t.length||q&&e>1e12&&Math.floor(e)===e&&(n="0x"+e.toString(16)).length<t.length)&&+n===e&&(t=n),t}(e.value):"boolean"==typeof e.value?e.value?"true":"false":e.regex?"/"+e.regex.pattern+"/"+e.regex.flags:function(e){var t,r,n,i,o,s,a,u;if(r=e.toString(),e.source){if(!(t=r.match(/\/([^\/]*)$/)))return r;for(n=t[1],r="",a=!1,u=!1,i=0,o=e.source.length;i<o;++i)s=e.source.charCodeAt(i),u?(r+=c(s,u),u=!1):(a?93===s&&(a=!1):47===s?r+="\\":91===s&&(a=!0),r+=c(s,u),u=92===s);return"/"+r+"/"+n}return r}(e.value)},GeneratorExpression:function(e,t,r){return this.ComprehensionExpression(e,t,r)},ComprehensionExpression:function(e,t,r){var n,i,o,s,a=this;return n=e.type===F.GeneratorExpression?["("]:["["],K.moz.comprehensionExpressionStartsWithAssignment&&(s=this.generateExpression(e.body,O.Assignment,re),n.push(s)),e.blocks&&y(function(){for(i=0,o=e.blocks.length;i<o;++i)s=a.generateExpression(e.blocks[i],O.Sequence,re),i>0||K.moz.comprehensionExpressionStartsWithAssignment?n=m(n,s):n.push(s)}),e.filter&&(n=m(n,"if"+z),s=this.generateExpression(e.filter,O.Sequence,re),n=m(n,["(",s,")"])),K.moz.comprehensionExpressionStartsWithAssignment||(s=this.generateExpression(e.body,O.Assignment,re),n=m(n,s)),n.push(e.type===F.GeneratorExpression?")":"]"),n},ComprehensionBlock:function(e,t,r){var n;return n=e.left.type===F.VariableDeclaration?[e.left.kind,d(),this.generateStatement(e.left.declarations[0],0)]:this.generateExpression(e.left,O.Call,re),n=m(n,e.of?"of":"in"),n=m(n,this.generateExpression(e.right,O.Sequence,re)),["for"+z+"(",n,")"]},SpreadElement:function(e,t,r){return["...",this.generateExpression(e.argument,O.Assignment,re)]},TaggedTemplateExpression:function(e,t,r){var n=3;2&r||(n=1);return x([this.generateExpression(e.tag,O.Call,n),this.generateExpression(e.quasi,O.Primary,4)],O.TaggedTemplate,t)},TemplateElement:function(e,t,r){return e.value.raw},TemplateLiteral:function(e,t,r){var n,i,o;for(n=["`"],i=0,o=e.quasis.length;i<o;++i)n.push(this.generateExpression(e.quasis[i],O.Primary,re)),i+1<o&&(n.push("${"+z),n.push(this.generateExpression(e.expressions[i],O.Sequence,re)),n.push(z+"}"));return n.push("`"),n},ModuleSpecifier:function(e,t,r){return this.Literal(e,t,r)}}),k.prototype.generateExpression=function(e,t,r){var n,i;return i=e.type||F.Property,K.verbatim&&e.hasOwnProperty(K.verbatim)?function(e,t){var r,n;return r=e[K.verbatim],n="string"==typeof r?x(w(r),O.Sequence,t):x(n=w(r.content),null!=r.precedence?r.precedence:O.Sequence,t),h(n,e)}(e,t):(n=this[i](e,t,r),K.comment&&(n=b(e,n)),h(n,e))},k.prototype.generateStatement=function(e,t){var r,n;return r=this[e.type](e,t),K.comment&&(r=b(e,r)),n=h(r).toString(),e.type!==F.Program||H||""!==U||"\n"!==n.charAt(n.length-1)||(r=Y?h(r).replaceRight(/\s+$/,""):n.replace(/\s+$/,"")),h(r,e)},ee={indent:{style:"",base:0},renumber:!0,hexadecimal:!0,quotes:"auto",escapeless:!0,compact:!0,parentheses:!1,semicolons:!1},te={indent:{style:"    ",base:0,adjustMultilineComment:!1},newline:"\n",space:" ",json:!1,renumber:!1,hexadecimal:!1,quotes:"single",escapeless:!1,compact:!1,parentheses:!0,semicolons:!0,safeConcatenation:!1,preserveBlankLines:!1},t.version=n("/package.json",e).version,t.generate=function(i,s){var a,c,l={indent:null,base:null,parse:null,comment:!1,format:{indent:{style:"    ",base:0,adjustMultilineComment:!1},newline:"\n",space:" ",json:!1,renumber:!1,hexadecimal:!1,quotes:"single",escapeless:!1,compact:!1,parentheses:!0,semicolons:!0,safeConcatenation:!1,preserveBlankLines:!1},moz:{comprehensionExpressionStartsWithAssignment:!1,starlessGenerator:!1},sourceMap:null,sourceMapRoot:null,sourceMapWithCode:!1,directive:!1,raw:!0,verbatim:null,sourceCode:null};return null!=s?("string"==typeof s.indent&&(l.format.indent.style=s.indent),"number"==typeof s.base&&(l.format.indent.base=s.base),s=u(l,s),L=s.format.indent.style,I="string"==typeof s.base?s.base:o(L,s.format.indent.base)):(L=(s=l).format.indent.style,I=o(L,s.format.indent.base)),N=s.format.json,M=s.format.renumber,q=!N&&s.format.hexadecimal,$=N?"double":s.format.quotes,W=s.format.escapeless,U=s.format.newline,z=s.format.space,s.format.compact&&(U=z=L=I=""),V=s.format.parentheses,G=s.format.semicolons,H=s.format.safeConcatenation,J=s.directive,Q=N?null:s.parse,Y=s.sourceMap,X=s.sourceCode,Z=s.format.preserveBlankLines&&null!==X,K=s,Y&&(R=t.browser?r.sourceMap.SourceNode:n("/node_modules/source-map/lib/source-map.js",e).SourceNode),a=C(i),Y?(c=a.toStringWithSourceMap({file:s.file,sourceRoot:s.sourceMapRoot}),s.sourceContent&&c.map.setSourceContent(s.sourceMap,s.sourceContent),s.sourceMapWithCode?c:c.map.toString()):(c={code:a.toString(),map:null},s.sourceMapWithCode?c:c.code)},t.attachComments=B.attachComments,t.Precedence=u({},O),t.browser=!1,t.FORMAT_MINIFY=ee,t.FORMAT_DEFAULTS=te}()}),n.define("/package.json",function(e,t,r,n){e.exports={name:"escodegen",description:"ECMAScript code generator",homepage:"http://github.com/estools/escodegen",main:"escodegen.js",bin:{esgenerate:"./bin/esgenerate.js",escodegen:"./bin/escodegen.js"},files:["LICENSE.BSD","LICENSE.source-map","README.md","bin","escodegen.js","package.json"],version:"1.8.1",engines:{node:">=0.12.0"},maintainers:[{name:"Yusuke Suzuki",email:"utatane.tea@gmail.com",web:"http://github.com/Constellation"}],repository:{type:"git",url:"http://github.com/estools/escodegen.git"},dependencies:{estraverse:"^1.9.1",esutils:"^2.0.2",esprima:"^2.7.1",optionator:"^0.8.1"},optionalDependencies:{"source-map":"~0.2.0"},devDependencies:{acorn:"^2.7.0",bluebird:"^2.3.11","bower-registry-client":"^0.2.1",chai:"^1.10.0","commonjs-everywhere":"^0.9.7",gulp:"^3.8.10","gulp-eslint":"^0.2.0","gulp-mocha":"^2.0.0",semver:"^5.1.0"},license:"BSD-2-Clause",scripts:{test:"gulp travis","unit-test":"gulp test",lint:"gulp lint",release:"node tools/release.js","build-min":"./node_modules/.bin/cjsify -ma path: tools/entry-point.js > escodegen.browser.min.js",build:"./node_modules/.bin/cjsify -a path: tools/entry-point.js > escodegen.browser.js"}}}),n.define("/node_modules/source-map/lib/source-map.js",function(e,t,r,i){t.SourceMapGenerator=n("/node_modules/source-map/lib/source-map/source-map-generator.js",e).SourceMapGenerator,t.SourceMapConsumer=n("/node_modules/source-map/lib/source-map/source-map-consumer.js",e).SourceMapConsumer,t.SourceNode=n("/node_modules/source-map/lib/source-map/source-node.js",e).SourceNode}),n.define("/node_modules/source-map/lib/source-map/source-node.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e,t,r,n,i){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==r?null:r,this.name=null==i?null:i,this[a]=!0,null!=n&&this.add(n)}var i=e("/node_modules/source-map/lib/source-map/source-map-generator.js",r).SourceMapGenerator,o=e("/node_modules/source-map/lib/source-map/util.js",r),s=/(\r?\n)/,a="$$$isSourceNode$$$";n.fromStringWithSourceMap=function(e,t,r){function i(e,t){if(null===e||void 0===e.source)a.add(t);else{var i=r?o.join(r,e.source):e.source;a.add(new n(e.originalLine,e.originalColumn,i,t,e.name))}}var a=new n,u=e.split(s),c=function(){return u.shift()+(u.shift()||"")},l=1,f=0,p=null;return t.eachMapping(function(e){if(null!==p){if(!(l<e.generatedLine)){t=(r=u[0]).substr(0,e.generatedColumn-f);return u[0]=r.substr(e.generatedColumn-f),f=e.generatedColumn,i(p,t),void(p=e)}var t="";i(p,c()),l++,f=0}for(;l<e.generatedLine;)a.add(c()),l++;if(f<e.generatedColumn){var r=u[0];a.add(r.substr(0,e.generatedColumn)),u[0]=r.substr(e.generatedColumn),f=e.generatedColumn}p=e},this),u.length>0&&(p&&i(p,c()),a.add(u.join(""))),t.sources.forEach(function(e){var n=t.sourceContentFor(e);null!=n&&(null!=r&&(e=o.join(r,e)),a.setSourceContent(e,n))}),a},n.prototype.add=function(e){if(Array.isArray(e))e.forEach(function(e){this.add(e)},this);else{if(!e[a]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this},n.prototype.prepend=function(e){if(Array.isArray(e))for(var t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[a]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this},n.prototype.walk=function(e){for(var t,r=0,n=this.children.length;r<n;r++)(t=this.children[r])[a]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})},n.prototype.join=function(e){var t,r,n=this.children.length;if(n>0){for(t=[],r=0;r<n-1;r++)t.push(this.children[r]),t.push(e);t.push(this.children[r]),this.children=t}return this},n.prototype.replaceRight=function(e,t){var r=this.children[this.children.length-1];return r[a]?r.replaceRight(e,t):"string"==typeof r?this.children[this.children.length-1]=r.replace(e,t):this.children.push("".replace(e,t)),this},n.prototype.setSourceContent=function(e,t){this.sourceContents[o.toSetString(e)]=t},n.prototype.walkSourceContents=function(e){for(var t=0,r=this.children.length;t<r;t++)this.children[t][a]&&this.children[t].walkSourceContents(e);var n=Object.keys(this.sourceContents);for(t=0,r=n.length;t<r;t++)e(o.fromSetString(n[t]),this.sourceContents[n[t]])},n.prototype.toString=function(){var e="";return this.walk(function(t){e+=t}),e},n.prototype.toStringWithSourceMap=function(e){var t={code:"",line:1,column:0},r=new i(e),n=!1,o=null,s=null,a=null,u=null;return this.walk(function(e,i){t.code+=e,null!==i.source&&null!==i.line&&null!==i.column?(o===i.source&&s===i.line&&a===i.column&&u===i.name||r.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:t.line,column:t.column},name:i.name}),o=i.source,s=i.line,a=i.column,u=i.name,n=!0):n&&(r.addMapping({generated:{line:t.line,column:t.column}}),o=null,n=!1);for(var c=0,l=e.length;c<l;c++)10===e.charCodeAt(c)?(t.line++,t.column=0,c+1===l?(o=null,n=!1):n&&r.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:t.line,column:t.column},name:i.name})):t.column++}),this.walkSourceContents(function(e,t){r.setSourceContent(e,t)}),{code:t.code,map:r}},t.SourceNode=n})}),n.define("/node_modules/source-map/lib/source-map/util.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e){var t=e.match(a);return t?{scheme:t[1],auth:t[2],host:t[3],port:t[4],path:t[5]}:null}function i(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function o(e){var t=e,r=n(e);if(r){if(!r.path)return e;t=r.path}for(var o,s="/"===t.charAt(0),a=t.split(/\/+/),u=0,c=a.length-1;c>=0;c--)"."===(o=a[c])?a.splice(c,1):".."===o?u++:u>0&&(""===o?(a.splice(c+1,u),u=0):(a.splice(c,2),u--));return""===(t=a.join("/"))&&(t=s?"/":"."),r?(r.path=t,i(r)):t}function s(e,t){var r=e||"",n=t||"";return(r>n)-(r<n)}t.getArg=function(e,t,r){if(t in e)return e[t];if(3===arguments.length)return r;throw new Error('"'+t+'" is a required argument.')};var a=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/,u=/^data:.+\,.+$/;t.urlParse=n,t.urlGenerate=i,t.normalize=o,t.join=function(e,t){""===e&&(e="."),""===t&&(t=".");var r=n(t),s=n(e);if(s&&(e=s.path||"/"),r&&!r.scheme)return s&&(r.scheme=s.scheme),i(r);if(r||t.match(u))return t;if(s&&!s.host&&!s.path)return s.host=t,i(s);var a="/"===t.charAt(0)?t:o(e.replace(/\/+$/,"")+"/"+t);return s?(s.path=a,i(s)):a},t.relative=function(e,t){""===e&&(e=".");var r=n(e=e.replace(/\/$/,""));return"/"==t.charAt(0)&&r&&"/"==r.path?t.slice(1):0===t.indexOf(e+"/")?t.substr(e.length+1):t},t.toSetString=function(e){return"$"+e},t.fromSetString=function(e){return e.substr(1)},t.compareByOriginalPositions=function(e,t,r){var n;return(n=s(e.source,t.source))?n:(n=e.originalLine-t.originalLine)?n:(n=e.originalColumn-t.originalColumn)||r?n:(n=s(e.name,t.name))?n:(n=e.generatedLine-t.generatedLine)||e.generatedColumn-t.generatedColumn},t.compareByGeneratedPositions=function(e,t,r){var n;return(n=e.generatedLine-t.generatedLine)?n:(n=e.generatedColumn-t.generatedColumn)||r?n:(n=s(e.source,t.source))?n:(n=e.originalLine-t.originalLine)?n:(n=e.originalColumn-t.originalColumn)||s(e.name,t.name)}})}),n.define("/node_modules/amdefine/amdefine.js",function(e,t,r,o){"use strict";e.exports=function(e,t){function r(e,t){var r;return e&&"."===e.charAt(0)&&t&&(function(e){var t,r;for(t=0;e[t];t+=1)if("."===(r=e[t]))e.splice(t,1),t-=1;else if(".."===r){if(1===t&&(".."===e[2]||".."===e[0]))break;t>0&&(e.splice(t-1,2),t-=2)}}(r=(r=(r=t.split("/")).slice(0,r.length-1)).concat(e.split("/"))),e=r.join("/")),e}function s(r,n,i){var s,a,c,l;if(r)a=f[r]={},s=u(t,a,c={id:r,uri:o,exports:a},r);else{if(p)throw new Error("amdefine with no module ID cannot be called more than once per file.");p=!0,a=e.exports,s=u(t,a,c=e,e.id)}n&&(n=n.map(function(e){return s(e)})),void 0!==(l="function"==typeof i?i.apply(c.exports,n):i)&&(c.exports=l,r&&(f[r]=c.exports))}function a(e,t,r){Array.isArray(e)?(r=t,t=e,e=void 0):"string"!=typeof e&&(r=e,e=t=void 0),t&&!Array.isArray(t)&&(r=t,t=void 0),t||(t=["require","exports","module"]),e?l[e]=[e,t,r]:s(e,t,r)}var u,c,l={},f={},p=!1,h=n("path",e);return u=function(e,t,n,o){function s(r,s){if("string"==typeof r)return c(e,t,n,r,o);r=r.map(function(r){return c(e,t,n,r,o)}),s&&i.nextTick(function(){s.apply(null,r)})}return s.toUrl=function(e){return 0===e.indexOf(".")?r(e,h.dirname(n.filename)):e},s},t=t||function(){return e.require.apply(e,arguments)},c=function(e,t,n,i,o){var a,p,h=i.indexOf("!"),d=i;if(-1===h){if("require"===(i=r(i,o)))return u(e,t,n,o);if("exports"===i)return t;if("module"===i)return n;if(f.hasOwnProperty(i))return f[i];if(l[i])return s.apply(null,l[i]),f[i];if(e)return e(d);throw new Error("No module with ID: "+i)}return a=i.substring(0,h),i=i.substring(h+1,i.length),p=c(e,t,n,a,o),i=p.normalize?p.normalize(i,function(e){return function(t){return r(t,e)}}(o)):r(i,o),f[i]?f[i]:(p.load(i,u(e,t,n,o),function(e){function t(t){f[e]=t}return t.fromText=function(e,t){throw new Error("amdefine does not implement load.fromText")},t}(i),{}),f[i])},a.require=function(e){return f[e]?f[e]:l[e]?(s.apply(null,l[e]),f[e]):void 0},a.amd={},a}}),n.define("/node_modules/source-map/lib/source-map/source-map-generator.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e){e||(e={}),this._file=o.getArg(e,"file",null),this._sourceRoot=o.getArg(e,"sourceRoot",null),this._skipValidation=o.getArg(e,"skipValidation",!1),this._sources=new s,this._names=new s,this._mappings=new a,this._sourcesContents=null}var i=e("/node_modules/source-map/lib/source-map/base64-vlq.js",r),o=e("/node_modules/source-map/lib/source-map/util.js",r),s=e("/node_modules/source-map/lib/source-map/array-set.js",r).ArraySet,a=e("/node_modules/source-map/lib/source-map/mapping-list.js",r).MappingList;n.prototype._version=3,n.fromSourceMap=function(e){var t=e.sourceRoot,r=new n({file:e.file,sourceRoot:t});return e.eachMapping(function(e){var n={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(n.source=e.source,null!=t&&(n.source=o.relative(t,n.source)),n.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(n.name=e.name)),r.addMapping(n)}),e.sources.forEach(function(t){var n=e.sourceContentFor(t);null!=n&&r.setSourceContent(t,n)}),r},n.prototype.addMapping=function(e){var t=o.getArg(e,"generated"),r=o.getArg(e,"original",null),n=o.getArg(e,"source",null),i=o.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,r,n,i),null==n||this._sources.has(n)||this._sources.add(n),null==i||this._names.has(i)||this._names.add(i),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:null!=r&&r.line,originalColumn:null!=r&&r.column,source:n,name:i})},n.prototype.setSourceContent=function(e,t){var r=e;null!=this._sourceRoot&&(r=o.relative(this._sourceRoot,r)),null!=t?(this._sourcesContents||(this._sourcesContents={}),this._sourcesContents[o.toSetString(r)]=t):this._sourcesContents&&(delete this._sourcesContents[o.toSetString(r)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},n.prototype.applySourceMap=function(e,t,r){var n=t;if(null==t){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');n=e.file}var i=this._sourceRoot;null!=i&&(n=o.relative(i,n));var a=new s,u=new s;this._mappings.unsortedForEach(function(t){if(t.source===n&&null!=t.originalLine){var s=e.originalPositionFor({line:t.originalLine,column:t.originalColumn});null!=s.source&&(t.source=s.source,null!=r&&(t.source=o.join(r,t.source)),null!=i&&(t.source=o.relative(i,t.source)),t.originalLine=s.line,t.originalColumn=s.column,null!=s.name&&(t.name=s.name))}var c=t.source;null==c||a.has(c)||a.add(c);var l=t.name;null==l||u.has(l)||u.add(l)},this),this._sources=a,this._names=u,e.sources.forEach(function(t){var n=e.sourceContentFor(t);null!=n&&(null!=r&&(t=o.join(r,t)),null!=i&&(t=o.relative(i,t)),this.setSourceContent(t,n))},this)},n.prototype._validateMapping=function(e,t,r,n){if((!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0)||t||r||n)&&!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:t,name:n}))},n.prototype._serializeMappings=function(){for(var e,t=0,r=1,n=0,s=0,a=0,u=0,c="",l=this._mappings.toArray(),f=0,p=l.length;f<p;f++){if((e=l[f]).generatedLine!==r)for(t=0;e.generatedLine!==r;)c+=";",r++;else if(f>0){if(!o.compareByGeneratedPositions(e,l[f-1]))continue;c+=","}c+=i.encode(e.generatedColumn-t),t=e.generatedColumn,null!=e.source&&(c+=i.encode(this._sources.indexOf(e.source)-u),u=this._sources.indexOf(e.source),c+=i.encode(e.originalLine-1-s),s=e.originalLine-1,c+=i.encode(e.originalColumn-n),n=e.originalColumn,null!=e.name&&(c+=i.encode(this._names.indexOf(e.name)-a),a=this._names.indexOf(e.name)))}return c},n.prototype._generateSourcesContent=function(e,t){return e.map(function(e){if(!this._sourcesContents)return null;null!=t&&(e=o.relative(t,e));var r=o.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,r)?this._sourcesContents[r]:null},this)},n.prototype.toJSON=function(){var e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e},n.prototype.toString=function(){return JSON.stringify(this)},t.SourceMapGenerator=n})}),n.define("/node_modules/source-map/lib/source-map/mapping-list.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}var i=e("/node_modules/source-map/lib/source-map/util.js",r);n.prototype.unsortedForEach=function(e,t){this._array.forEach(e,t)},n.prototype.add=function(e){!function(e,t){var r=e.generatedLine,n=t.generatedLine,o=e.generatedColumn,s=t.generatedColumn;return n>r||n==r&&s>=o||i.compareByGeneratedPositions(e,t)<=0}(this._last,e)?(this._sorted=!1,this._array.push(e)):(this._last=e,this._array.push(e))},n.prototype.toArray=function(){return this._sorted||(this._array.sort(i.compareByGeneratedPositions),this._sorted=!0),this._array},t.MappingList=n})}),n.define("/node_modules/source-map/lib/source-map/array-set.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(){this._array=[],this._set={}}var i=e("/node_modules/source-map/lib/source-map/util.js",r);n.fromArray=function(e,t){for(var r=new n,i=0,o=e.length;i<o;i++)r.add(e[i],t);return r},n.prototype.add=function(e,t){var r=this.has(e),n=this._array.length;r&&!t||this._array.push(e),r||(this._set[i.toSetString(e)]=n)},n.prototype.has=function(e){return Object.prototype.hasOwnProperty.call(this._set,i.toSetString(e))},n.prototype.indexOf=function(e){if(this.has(e))return this._set[i.toSetString(e)];throw new Error('"'+e+'" is not in the set.')},n.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},n.prototype.toArray=function(){return this._array.slice()},t.ArraySet=n})}),n.define("/node_modules/source-map/lib/source-map/base64-vlq.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){var n=e("/node_modules/source-map/lib/source-map/base64.js",r);t.encode=function(e){var t,r="",i=function(e){return e<0?1+(-e<<1):0+(e<<1)}(e);do{t=31&i,(i>>>=5)>0&&(t|=32),r+=n.encode(t)}while(i>0);return r},t.decode=function(e,t){var r,i,o=0,s=e.length,a=0,u=0;do{if(o>=s)throw new Error("Expected more digits in base 64 VLQ value.");r=!!(32&(i=n.decode(e.charAt(o++)))),a+=(i&=31)<<u,u+=5}while(r);t.value=function(e){var t=e>>1;return 1==(1&e)?-t:t}(a),t.rest=e.slice(o)}})}),n.define("/node_modules/source-map/lib/source-map/base64.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){var n={},i={};"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("").forEach(function(e,t){n[e]=t,i[t]=e}),t.encode=function(e){if(e in i)return i[e];throw new TypeError("Must be between 0 and 63: "+e)},t.decode=function(e){if(e in n)return n[e];throw new TypeError("Not a valid base 64 digit: "+e)}})}),n.define("/node_modules/source-map/lib/source-map/source-map-consumer.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(t){var n=t;if("string"==typeof t&&(n=JSON.parse(t.replace(/^\)\]\}'/,""))),null!=n.sections){return new(e("/node_modules/source-map/lib/source-map/indexed-source-map-consumer.js",r).IndexedSourceMapConsumer)(n)}return new(e("/node_modules/source-map/lib/source-map/basic-source-map-consumer.js",r).BasicSourceMapConsumer)(n)}var i=e("/node_modules/source-map/lib/source-map/util.js",r);n.fromSourceMap=function(t){return e("/node_modules/source-map/lib/source-map/basic-source-map-consumer.js",r).BasicSourceMapConsumer.fromSourceMap(t)},n.prototype._version=3,n.prototype.__generatedMappings=null,Object.defineProperty(n.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||(this.__generatedMappings=[],this.__originalMappings=[],this._parseMappings(this._mappings,this.sourceRoot)),this.__generatedMappings}}),n.prototype.__originalMappings=null,Object.defineProperty(n.prototype,"_originalMappings",{get:function(){return this.__originalMappings||(this.__generatedMappings=[],this.__originalMappings=[],this._parseMappings(this._mappings,this.sourceRoot)),this.__originalMappings}}),n.prototype._nextCharIsMappingSeparator=function(e){var t=e.charAt(0);return";"===t||","===t},n.prototype._parseMappings=function(e,t){throw new Error("Subclasses must implement _parseMappings")},n.GENERATED_ORDER=1,n.ORIGINAL_ORDER=2,n.prototype.eachMapping=function(e,t,r){var o,s=t||null;switch(r||n.GENERATED_ORDER){case n.GENERATED_ORDER:o=this._generatedMappings;break;case n.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var a=this.sourceRoot;o.map(function(e){var t=e.source;return null!=t&&null!=a&&(t=i.join(a,t)),{source:t,generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:e.name}}).forEach(e,s)},n.prototype.allGeneratedPositionsFor=function(e){var t={source:i.getArg(e,"source"),originalLine:i.getArg(e,"line"),originalColumn:1/0};null!=this.sourceRoot&&(t.source=i.relative(this.sourceRoot,t.source));var r=[],n=this._findMapping(t,this._originalMappings,"originalLine","originalColumn",i.compareByOriginalPositions);if(n>=0)for(var o=this._originalMappings[n];o&&o.originalLine===t.originalLine;)r.push({line:i.getArg(o,"generatedLine",null),column:i.getArg(o,"generatedColumn",null),lastColumn:i.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[--n];return r.reverse()},t.SourceMapConsumer=n})}),n.define("/node_modules/source-map/lib/source-map/basic-source-map-consumer.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var r=i.getArg(t,"version"),n=i.getArg(t,"sources"),o=i.getArg(t,"names",[]),a=i.getArg(t,"sourceRoot",null),u=i.getArg(t,"sourcesContent",null),c=i.getArg(t,"mappings"),l=i.getArg(t,"file",null);if(r!=this._version)throw new Error("Unsupported version: "+r);n=n.map(i.normalize),this._names=s.fromArray(o,!0),this._sources=s.fromArray(n,!0),this.sourceRoot=a,this.sourcesContent=u,this._mappings=c,this.file=l}var i=e("/node_modules/source-map/lib/source-map/util.js",r),o=e("/node_modules/source-map/lib/source-map/binary-search.js",r),s=e("/node_modules/source-map/lib/source-map/array-set.js",r).ArraySet,a=e("/node_modules/source-map/lib/source-map/base64-vlq.js",r),u=e("/node_modules/source-map/lib/source-map/source-map-consumer.js",r).SourceMapConsumer;(n.prototype=Object.create(u.prototype)).consumer=u,n.fromSourceMap=function(e){var t=Object.create(n.prototype);return t._names=s.fromArray(e._names.toArray(),!0),t._sources=s.fromArray(e._sources.toArray(),!0),t.sourceRoot=e._sourceRoot,t.sourcesContent=e._generateSourcesContent(t._sources.toArray(),t.sourceRoot),t.file=e._file,t.__generatedMappings=e._mappings.toArray().slice(),t.__originalMappings=e._mappings.toArray().slice().sort(i.compareByOriginalPositions),t},n.prototype._version=3,Object.defineProperty(n.prototype,"sources",{get:function(){return this._sources.toArray().map(function(e){return null!=this.sourceRoot?i.join(this.sourceRoot,e):e},this)}}),n.prototype._parseMappings=function(e,t){for(var r,n=1,o=0,s=0,u=0,c=0,l=0,f=e,p={};f.length>0;)if(";"===f.charAt(0))n++,f=f.slice(1),o=0;else if(","===f.charAt(0))f=f.slice(1);else{if(r={},r.generatedLine=n,a.decode(f,p),r.generatedColumn=o+p.value,o=r.generatedColumn,(f=p.rest).length>0&&!this._nextCharIsMappingSeparator(f)){if(a.decode(f,p),r.source=this._sources.at(c+p.value),c+=p.value,0===(f=p.rest).length||this._nextCharIsMappingSeparator(f))throw new Error("Found a source, but no line and column");if(a.decode(f,p),r.originalLine=s+p.value,s=r.originalLine,r.originalLine+=1,0===(f=p.rest).length||this._nextCharIsMappingSeparator(f))throw new Error("Found a source and line, but no column");a.decode(f,p),r.originalColumn=u+p.value,u=r.originalColumn,(f=p.rest).length>0&&!this._nextCharIsMappingSeparator(f)&&(a.decode(f,p),r.name=this._names.at(l+p.value),l+=p.value,f=p.rest)}this.__generatedMappings.push(r),"number"==typeof r.originalLine&&this.__originalMappings.push(r)}this.__generatedMappings.sort(i.compareByGeneratedPositions),this.__originalMappings.sort(i.compareByOriginalPositions)},n.prototype._findMapping=function(e,t,r,n,i){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[n]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[n]);return o.search(e,t,i)},n.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var r=this._generatedMappings[e+1];if(t.generatedLine===r.generatedLine){t.lastGeneratedColumn=r.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},n.prototype.originalPositionFor=function(e){var t={generatedLine:i.getArg(e,"line"),generatedColumn:i.getArg(e,"column")},r=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",i.compareByGeneratedPositions);if(r>=0){var n=this._generatedMappings[r];if(n.generatedLine===t.generatedLine){var o=i.getArg(n,"source",null);return null!=o&&null!=this.sourceRoot&&(o=i.join(this.sourceRoot,o)),{source:o,line:i.getArg(n,"originalLine",null),column:i.getArg(n,"originalColumn",null),name:i.getArg(n,"name",null)}}}return{source:null,line:null,column:null,name:null}},n.prototype.sourceContentFor=function(e,t){if(!this.sourcesContent)return null;if(null!=this.sourceRoot&&(e=i.relative(this.sourceRoot,e)),this._sources.has(e))return this.sourcesContent[this._sources.indexOf(e)];var r;if(null!=this.sourceRoot&&(r=i.urlParse(this.sourceRoot))){var n=e.replace(/^file:\/\//,"");if("file"==r.scheme&&this._sources.has(n))return this.sourcesContent[this._sources.indexOf(n)];if((!r.path||"/"==r.path)&&this._sources.has("/"+e))return this.sourcesContent[this._sources.indexOf("/"+e)]}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},n.prototype.generatedPositionFor=function(e){var t={source:i.getArg(e,"source"),originalLine:i.getArg(e,"line"),originalColumn:i.getArg(e,"column")};null!=this.sourceRoot&&(t.source=i.relative(this.sourceRoot,t.source));var r=this._findMapping(t,this._originalMappings,"originalLine","originalColumn",i.compareByOriginalPositions);if(r>=0){var n=this._originalMappings[r];return{line:i.getArg(n,"generatedLine",null),column:i.getArg(n,"generatedColumn",null),lastColumn:i.getArg(n,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},t.BasicSourceMapConsumer=n})}),n.define("/node_modules/source-map/lib/source-map/binary-search.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e,t,r,i,o){var s=Math.floor((t-e)/2)+e,a=o(r,i[s],!0);return 0===a?s:a>0?t-s>1?n(s,t,r,i,o):s:s-e>1?n(e,s,r,i,o):e<0?-1:e}t.search=function(e,t,r){return 0===t.length?-1:n(-1,t.length,e,t,r)}})}),n.define("/node_modules/source-map/lib/source-map/indexed-source-map-consumer.js",function(e,t,r,i){if("function"!=typeof o)var o=n("/node_modules/amdefine/amdefine.js",e)(e,n);o(function(e,t,r){function n(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var r=i.getArg(t,"version"),n=i.getArg(t,"sections");if(r!=this._version)throw new Error("Unsupported version: "+r);var o={line:-1,column:0};this._sections=n.map(function(e){if(e.url)throw new Error("Support for url field in sections not implemented.");var t=i.getArg(e,"offset"),r=i.getArg(t,"line"),n=i.getArg(t,"column");if(r<o.line||r===o.line&&n<o.column)throw new Error("Section offsets must be ordered and non-overlapping.");return o=t,{generatedOffset:{generatedLine:r+1,generatedColumn:n+1},consumer:new s(i.getArg(e,"map"))}})}var i=e("/node_modules/source-map/lib/source-map/util.js",r),o=e("/node_modules/source-map/lib/source-map/binary-search.js",r),s=e("/node_modules/source-map/lib/source-map/source-map-consumer.js",r).SourceMapConsumer;e("/node_modules/source-map/lib/source-map/basic-source-map-consumer.js",r).BasicSourceMapConsumer;(n.prototype=Object.create(s.prototype)).constructor=s,n.prototype._version=3,Object.defineProperty(n.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var r=0;r<this._sections[t].consumer.sources.length;r++)e.push(this._sections[t].consumer.sources[r]);return e}}),n.prototype.originalPositionFor=function(e){var t={generatedLine:i.getArg(e,"line"),generatedColumn:i.getArg(e,"column")},r=o.search(t,this._sections,function(e,t){var r=e.generatedLine-t.generatedOffset.generatedLine;return r||e.generatedColumn-t.generatedOffset.generatedColumn}),n=this._sections[r];return n?n.consumer.originalPositionFor({line:t.generatedLine-(n.generatedOffset.generatedLine-1),column:t.generatedColumn-(n.generatedOffset.generatedLine===t.generatedLine?n.generatedOffset.generatedColumn-1:0)}):{source:null,line:null,column:null,name:null}},n.prototype.sourceContentFor=function(e,t){for(var r=0;r<this._sections.length;r++){var n=this._sections[r].consumer.sourceContentFor(e,!0);if(n)return n}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},n.prototype.generatedPositionFor=function(e){for(var t=0;t<this._sections.length;t++){var r=this._sections[t];if(-1!==r.consumer.sources.indexOf(i.getArg(e,"source"))){var n=r.consumer.generatedPositionFor(e);if(n){return{line:n.line+(r.generatedOffset.generatedLine-1),column:n.column+(r.generatedOffset.generatedLine===n.line?r.generatedOffset.generatedColumn-1:0)}}}}return{line:null,column:null}},n.prototype._parseMappings=function(e,t){this.__generatedMappings=[],this.__originalMappings=[];for(var r=0;r<this._sections.length;r++)for(var n=this._sections[r],o=n.consumer._generatedMappings,s=0;s<o.length;s++){var a=o[r],u=a.source,c=n.consumer.sourceRoot;null!=u&&null!=c&&(u=i.join(c,u));var l={source:u,generatedLine:a.generatedLine+(n.generatedOffset.generatedLine-1),generatedColumn:a.column+(n.generatedOffset.generatedLine===a.generatedLine)?n.generatedOffset.generatedColumn-1:0,originalLine:a.originalLine,originalColumn:a.originalColumn,name:a.name};this.__generatedMappings.push(l),"number"==typeof l.originalLine&&this.__originalMappings.push(l)}this.__generatedMappings.sort(i.compareByGeneratedPositions),this.__originalMappings.sort(i.compareByOriginalPositions)},t.IndexedSourceMapConsumer=n})}),n.define("/node_modules/esutils/lib/utils.js",function(e,t,r,i){!function(){"use strict";t.ast=n("/node_modules/esutils/lib/ast.js",e),t.code=n("/node_modules/esutils/lib/code.js",e),t.keyword=n("/node_modules/esutils/lib/keyword.js",e)}()}),n.define("/node_modules/esutils/lib/keyword.js",function(e,t,r,i){!function(){"use strict";function t(e,t){return!(!t&&"yield"===e)&&r(e,t)}function r(e,t){if(t&&function(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"let":return!0;default:return!1}}(e))return!0;switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}}function i(e,r){return"null"===e||"true"===e||"false"===e||t(e,r)}function o(e,t){return"null"===e||"true"===e||"false"===e||r(e,t)}function s(e){var t,r,n;if(0===e.length)return!1;if(n=e.charCodeAt(0),!c.isIdentifierStartES5(n))return!1;for(t=1,r=e.length;t<r;++t)if(n=e.charCodeAt(t),!c.isIdentifierPartES5(n))return!1;return!0}function a(e,t){return 1024*(e-55296)+(t-56320)+65536}function u(e){var t,r,n,i,o;if(0===e.length)return!1;for(o=c.isIdentifierStartES6,t=0,r=e.length;t<r;++t){if(55296<=(n=e.charCodeAt(t))&&n<=56319){if(++t>=r)return!1;if(!(56320<=(i=e.charCodeAt(t))&&i<=57343))return!1;n=a(n,i)}if(!o(n))return!1;o=c.isIdentifierPartES6}return!0}var c=n("/node_modules/esutils/lib/code.js",e);e.exports={isKeywordES5:t,isKeywordES6:r,isReservedWordES5:i,isReservedWordES6:o,isRestrictedWord:function(e){return"eval"===e||"arguments"===e},isIdentifierNameES5:s,isIdentifierNameES6:u,isIdentifierES5:function(e,t){return s(e)&&!i(e,t)},isIdentifierES6:function(e,t){return u(e)&&!o(e,t)}}}()}),n.define("/node_modules/esutils/lib/code.js",function(e,t,r,n){!function(){"use strict";function t(e){if(e<=65535)return String.fromCharCode(e);return String.fromCharCode(Math.floor((e-65536)/1024)+55296)+String.fromCharCode((e-65536)%1024+56320)}var r,n,i,o,s,a;for(n={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,NonAsciiIdentifierPart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/},r={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDE00-\uDE11\uDE13-\uDE2B\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDE00-\uDE2F\uDE44\uDE80-\uDEAA]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDD0-\uDDDA\uDE00-\uDE11\uDE13-\uDE37\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF01-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/},i=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279],o=new Array(128),a=0;a<128;++a)o[a]=a>=97&&a<=122||a>=65&&a<=90||36===a||95===a;for(s=new Array(128),a=0;a<128;++a)s[a]=a>=97&&a<=122||a>=65&&a<=90||a>=48&&a<=57||36===a||95===a;e.exports={isDecimalDigit:function(e){return 48<=e&&e<=57},isHexDigit:function(e){return 48<=e&&e<=57||97<=e&&e<=102||65<=e&&e<=70},isOctalDigit:function(e){return e>=48&&e<=55},isWhiteSpace:function(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&i.indexOf(e)>=0},isLineTerminator:function(e){return 10===e||13===e||8232===e||8233===e},isIdentifierStartES5:function(e){return e<128?o[e]:n.NonAsciiIdentifierStart.test(t(e))},isIdentifierPartES5:function(e){return e<128?s[e]:n.NonAsciiIdentifierPart.test(t(e))},isIdentifierStartES6:function(e){return e<128?o[e]:r.NonAsciiIdentifierStart.test(t(e))},isIdentifierPartES6:function(e){return e<128?s[e]:r.NonAsciiIdentifierPart.test(t(e))}}}()}),n.define("/node_modules/esutils/lib/ast.js",function(e,t,r,n){!function(){"use strict";function t(e){if(null==e)return!1;switch(e.type){case"BlockStatement":case"BreakStatement":case"ContinueStatement":case"DebuggerStatement":case"DoWhileStatement":case"EmptyStatement":case"ExpressionStatement":case"ForInStatement":case"ForStatement":case"IfStatement":case"LabeledStatement":case"ReturnStatement":case"SwitchStatement":case"ThrowStatement":case"TryStatement":case"VariableDeclaration":case"WhileStatement":case"WithStatement":return!0}return!1}function r(e){switch(e.type){case"IfStatement":return null!=e.alternate?e.alternate:e.consequent;case"LabeledStatement":case"ForStatement":case"ForInStatement":case"WhileStatement":case"WithStatement":return e.body}return null}e.exports={isExpression:function(e){if(null==e)return!1;switch(e.type){case"ArrayExpression":case"AssignmentExpression":case"BinaryExpression":case"CallExpression":case"ConditionalExpression":case"FunctionExpression":case"Identifier":case"Literal":case"LogicalExpression":case"MemberExpression":case"NewExpression":case"ObjectExpression":case"SequenceExpression":case"ThisExpression":case"UnaryExpression":case"UpdateExpression":return!0}return!1},isStatement:t,isIterationStatement:function(e){if(null==e)return!1;switch(e.type){case"DoWhileStatement":case"ForInStatement":case"ForStatement":case"WhileStatement":return!0}return!1},isSourceElement:function(e){return t(e)||null!=e&&"FunctionDeclaration"===e.type},isProblematicIfStatement:function(e){var t;if("IfStatement"!==e.type)return!1;if(null==e.alternate)return!1;t=e.consequent;do{if("IfStatement"===t.type&&null==t.alternate)return!0;t=r(t)}while(t);return!1},trailingStatement:r}}()}),n.define("/node_modules/estraverse/estraverse.js",function(t,r,n,i){!function(t,n){"use strict";"function"==typeof e&&e.amd?e(["exports"],n):n(void 0!==r?r:t.estraverse={})}(this,function e(t){"use strict";function r(){}function n(e){var t,r,i={};for(t in e)e.hasOwnProperty(t)&&(r=e[t],i[t]="object"==typeof r&&null!==r?n(r):r);return i}function i(e,t){this.parent=e,this.key=t}function o(e,t,r,n){this.node=e,this.path=t,this.wrap=r,this.ref=n}function s(){}function a(e){return null!=e&&("object"==typeof e&&"string"==typeof e.type)}function u(e,t){return(e===f.ObjectExpression||e===f.ObjectPattern)&&"properties"===t}function c(e,t){return(new s).traverse(e,t)}function l(e,t){var r;return r=function(e,t){var r,n,i,o;for(n=e.length,i=0;n;)t(e[o=i+(r=n>>>1)])?n=r:(i=o+1,n-=r+1);return i}(t,function(t){return t.range[0]>e.range[0]}),e.extendedRange=[e.range[0],e.range[1]],r!==t.length&&(e.extendedRange[1]=t[r].range[0]),(r-=1)>=0&&(e.extendedRange[0]=t[r].range[1]),e}var f,p,h,d,m,v,y,g,b;return(p=Array.isArray)||(p=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),r(),r(),m=Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}(),v=Object.keys||function(e){var t,r=[];for(t in e)r.push(t);return r},f={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportBatchSpecifier:"ExportBatchSpecifier",ExportDeclaration:"ExportDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",GeneratorExpression:"GeneratorExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MethodDefinition:"MethodDefinition",ModuleSpecifier:"ModuleSpecifier",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"},d={AssignmentExpression:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","defaults","rest","body"],AwaitExpression:["argument"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ClassBody:["body"],ClassDeclaration:["id","body","superClass"],ClassExpression:["id","body","superClass"],ComprehensionBlock:["left","right"],ComprehensionExpression:["blocks","filter","body"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExportBatchSpecifier:[],ExportDeclaration:["declaration","specifiers","source"],ExportSpecifier:["id","name"],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","defaults","rest","body"],FunctionExpression:["id","params","defaults","rest","body"],GeneratorExpression:["blocks","filter","body"],Identifier:[],IfStatement:["test","consequent","alternate"],ImportDeclaration:["specifiers","source"],ImportDefaultSpecifier:["id"],ImportNamespaceSpecifier:["id"],ImportSpecifier:["id","name"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MethodDefinition:["key","value"],ModuleSpecifier:[],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],Program:["body"],Property:["key","value"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SpreadElement:["argument"],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],TaggedTemplateExpression:["tag","quasi"],TemplateElement:[],TemplateLiteral:["quasis","expressions"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handlers","handler","guardedHandlers","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]},y={},g={},b={},h={Break:y,Skip:g,Remove:b},i.prototype.replace=function(e){this.parent[this.key]=e},i.prototype.remove=function(){return p(this.parent)?(this.parent.splice(this.key,1),!0):(this.replace(null),!1)},s.prototype.path=function(){function e(e,t){if(p(t))for(n=0,i=t.length;n<i;++n)e.push(t[n]);else e.push(t)}var t,r,n,i,o;if(!this.__current.path)return null;for(o=[],t=2,r=this.__leavelist.length;t<r;++t)e(o,this.__leavelist[t].path);return e(o,this.__current.path),o},s.prototype.type=function(){return this.current().type||this.__current.wrap},s.prototype.parents=function(){var e,t,r;for(r=[],e=1,t=this.__leavelist.length;e<t;++e)r.push(this.__leavelist[e].node);return r},s.prototype.current=function(){return this.__current.node},s.prototype.__execute=function(e,t){var r,n;return n=void 0,r=this.__current,this.__current=t,this.__state=null,e&&(n=e.call(this,t.node,this.__leavelist[this.__leavelist.length-1].node)),this.__current=r,n},s.prototype.notify=function(e){this.__state=e},s.prototype.skip=function(){this.notify(g)},s.prototype.break=function(){this.notify(y)},s.prototype.remove=function(){this.notify(b)},s.prototype.__initialize=function(e,t){this.visitor=t,this.root=e,this.__worklist=[],this.__leavelist=[],this.__current=null,this.__state=null,this.__fallback="iteration"===t.fallback,this.__keys=d,t.keys&&(this.__keys=function(e,t){var r,n,i,o=v(t);for(n=0,i=o.length;n<i;n+=1)e[r=o[n]]=t[r];return e}(m(this.__keys),t.keys))},s.prototype.traverse=function(e,t){var r,n,i,s,c,l,f,h,d,m,b,_;for(this.__initialize(e,t),_={},r=this.__worklist,n=this.__leavelist,r.push(new o(e,null,null,null)),n.push(new o(null,null,null,null));r.length;)if((i=r.pop())!==_){if(i.node){if(l=this.__execute(t.enter,i),this.__state===y||l===y)return;if(r.push(_),n.push(i),this.__state===g||l===g)continue;if(s=i.node,c=i.wrap||s.type,!(m=this.__keys[c])){if(!this.__fallback)throw new Error("Unknown node type "+c+".");m=v(s)}for(h=m.length;(h-=1)>=0;)if(f=m[h],b=s[f])if(p(b)){for(d=b.length;(d-=1)>=0;)if(b[d]){if(u(c,m[h]))i=new o(b[d],[f,d],"Property",null);else{if(!a(b[d]))continue;i=new o(b[d],[f,d],null,null)}r.push(i)}}else a(b)&&r.push(new o(b,f,null,null))}}else if(i=n.pop(),l=this.__execute(t.leave,i),this.__state===y||l===y)return},s.prototype.replace=function(e,t){function r(e){var t,r,i,o;if(e.ref.remove())for(r=e.ref.key,o=e.ref.parent,t=n.length;t--;)if((i=n[t]).ref&&i.ref.parent===o){if(i.ref.key<r)break;--i.ref.key}}var n,s,c,l,f,h,d,m,_,x,w,k,E;for(this.__initialize(e,t),w={},n=this.__worklist,s=this.__leavelist,h=new o(e,null,null,new i(k={root:e},"root")),n.push(h),s.push(h);n.length;)if((h=n.pop())!==w){if(void 0!==(f=this.__execute(t.enter,h))&&f!==y&&f!==g&&f!==b&&(h.ref.replace(f),h.node=f),this.__state!==b&&f!==b||(r(h),h.node=null),this.__state===y||f===y)return k.root;if((c=h.node)&&(n.push(w),s.push(h),this.__state!==g&&f!==g)){if(l=h.wrap||c.type,!(_=this.__keys[l])){if(!this.__fallback)throw new Error("Unknown node type "+l+".");_=v(c)}for(d=_.length;(d-=1)>=0;)if(E=_[d],x=c[E])if(p(x)){for(m=x.length;(m-=1)>=0;)if(x[m]){if(u(l,_[d]))h=new o(x[m],[E,m],"Property",new i(x,m));else{if(!a(x[m]))continue;h=new o(x[m],[E,m],null,new i(x,m))}n.push(h)}}else a(x)&&n.push(new o(x,E,null,new i(c,E)))}}else if(h=s.pop(),void 0!==(f=this.__execute(t.leave,h))&&f!==y&&f!==g&&f!==b&&h.ref.replace(f),this.__state!==b&&f!==b||r(h),this.__state===y||f===y)return k.root;return k.root},t.version="1.8.1-dev",t.Syntax=f,t.traverse=c,t.replace=function(e,t){return(new s).replace(e,t)},t.attachComments=function(e,t,r){var i,o,s,a,u=[];if(!e.range)throw new Error("attachComments needs range information");if(!r.length){if(t.length){for(s=0,o=t.length;s<o;s+=1)(i=n(t[s])).extendedRange=[0,e.range[0]],u.push(i);e.leadingComments=u}return e}for(s=0,o=t.length;s<o;s+=1)u.push(l(n(t[s]),r));return a=0,c(e,{enter:function(e){for(var t;a<u.length&&!((t=u[a]).extendedRange[1]>e.range[0]);)t.extendedRange[1]===e.range[0]?(e.leadingComments||(e.leadingComments=[]),e.leadingComments.push(t),u.splice(a,1)):a+=1;return a===u.length?h.Break:u[a].extendedRange[0]>e.range[1]?h.Skip:void 0}}),a=0,c(e,{leave:function(e){for(var t;a<u.length&&(t=u[a],!(e.range[1]<t.extendedRange[0]));)e.range[1]===t.extendedRange[0]?(e.trailingComments||(e.trailingComments=[]),e.trailingComments.push(t),u.splice(a,1)):a+=1;return a===u.length?h.Break:u[a].extendedRange[0]>e.range[1]?h.Skip:void 0}}),e},t.VisitorKeys=d,t.VisitorOption=h,t.Controller=s,t.cloneEnvironment=function(){return e({})},t})}),n("/tools/entry-point.js")}).call(t,t)}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this)}(),function(){this.lively=this.lively||{},function(e,t,r,n){"use strict";function i(){}function o(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={style:"  ",base:0,adjustMultilineComment:!1,optsIndent:r&&r.format&&r.format.indent||{}},i=r&&r.format||{},o=Q({indent:n,quotes:"double"},t.obj.dissoc(i,["indent"]));return r=Q({format:o,comment:!1},t.obj.dissoc(r,["format"])),se.generate(e,r)}function s(e,r,n,i){var o=(i=i||{}).traversal||"preorder",s=t.obj.clone(i.visitors?i.visitors:ae.make(ae.visitors.withMemberExpression)),a="preorder"===o?function(e,t,i,o,s){return r(i,n,o,t),e(i,o+1,s)}:function(e,t,i,o,s){var a=e(i,o+1,s);return r(i,n,o,t),a};return Object.keys(s).forEach(function(e){var t=s[e];s[e]=function(r,n,i){return a(t,e,r,n,i)}}),ae.recursive(e,0,null,s),e}function a(e,r,n,i){var o=[];return i=i||ae.make(ae.visitors.withMemberExpression),Object.keys(ae.base).forEach(function(e){var r=i[e];i[e]=function(e,n,i){return t.arr.pushIfNotIncluded(o,e),r(e,n,i)}}),i.Property=function(e,r,n){t.arr.pushIfNotIncluded(o,e),n(e.key,r,"Expression"),n(e.value,r,"Expression")},i.LabeledStatement=function(e,t,r){e.label&&r(e.label,t,"Expression"),r(e.body,t,"Statement")},ae.findNodeAround(e,r,n,i),o}function u(e){return de(e,{index:0},function(e,t,r){e(),t.astIndex=r.index++}),e}function c(e){if(Array.isArray(e.body))for(var t=e.body.length-1;t>=0;t--){var r=e.body[t];"BlockStatement"===r.type&&r[fe]&&e.body.splice.apply(e.body,[t,1].concat(r.body))}return e}function l(e,t){return"string"==typeof e&&(t=e,e=p(e)),t&&ce.run(e,function(e,r,n){return!e.source&&(e.source=t.slice(e.start,e.end))}),e}function f(e,t){(t=t||{}).ecmaVersion=t.ecmaVersion||8,t.sourceType=t.sourceType||"module",t.plugins=t.plugins||{},t.plugins.asyncawait=t.plugins.hasOwnProperty("asyncawait")?t.plugins.asyncawait:{inAsyncFunction:!0},t.plugins.objectSpread=!t.plugins.hasOwnProperty("objectSpread")||t.plugins.objectSpread;var r,n,i;"LabeledStatement"===t.type&&(n="$={"+e+"}");try{r=p(n||e,t),n?r=null:t.addSource&&l(r,e)}catch(e){i=e}if(i&&void 0!==i.raisedAt){n&&(i.pos-=3,i.raisedAt-=3,i.loc.column-=3);var o="";o+=e.slice(i.raisedAt-20,i.raisedAt),o+="<-error->",o+=e.slice(i.raisedAt,i.raisedAt+20),t.verbose&&show("parse error: "+o),i.parseErrorSource=o}else i&&t.verbose&&show(""+i+i.stack);return r||(r=ue.parse_dammit(e,t),t.addSource&&l(r,e),r.isFuzzy=!0,r.parseError=i),r}function p(e,r){if(r=r||{},r.ecmaVersion=r.ecmaVersion||8,r.sourceType=r.sourceType||"module",r.hasOwnProperty("allowImportExportEverywhere")||(r.allowImportExportEverywhere=!0),r.plugins=r.plugins||{},r.plugins.asyncawait=r.plugins.hasOwnProperty("asyncawait")?r.plugins.asyncawait:{inAsyncFunction:!0},r.plugins.objectSpread=!r.plugins.hasOwnProperty("objectSpread")||r.plugins.objectSpread,r.withComments){delete r.withComments;var n=[];r.onComment=function(e,t,r,i,o,s){n.push({isBlock:e,text:t,node:null,start:r,end:i,line:o,column:s})}}try{var i=acorn.parse(e,r)}catch(t){if("undefined"!=typeof SyntaxError&&t instanceof SyntaxError&&t.loc){var o=e.split("\n"),s=t.message,c=t.loc,f=c.line,p=c.column,h=t.pos,d=o[f-1],m="Syntax error at line "+f+" column "+p+" (index "+h+') "'+s+'"\nsource: '+d.slice(0,p)+"<--SyntaxError--\x3e"+d.slice(p),v=new SyntaxError(m);throw v.loc={line:f,column:p},v.pos=h,v}throw t}return r.addSource&&l(i,e),r.addAstIndex&&!i.hasOwnProperty("astIndex")&&u(i),i&&n&&function(r){r=function(r){return r.nodesWithComments.forEach(function(n){t.arr.clone(n.comments).reduce(function(i,o){if(o.isBlock)return i.lastComment=null,i;if(!i.lastComment)return i.lastComment=o,i;var s=i.lastComment;if(t.arr.detect(n.body,function(e){return e.start>=s.end&&e.end<=o.start}))return i.lastComment=o,i;var a=e.slice(s.end,o.start);return/[\n\r][\n\r]+/.test(a)?(i.lastComment=o,i):(s.text+="\n"+o.text,s.end=o.end,t.arr.remove(n.comments,o),t.arr.remove(r.comments,o),i)},{lastComment:null})}),r}(function(e){return n.forEach(function(r){var n=t.arr.detect(function(e,t){return t="string"==typeof t?this.parse(t):t,a(t,e)}(r.start,i).reverse(),function(e){return"BlockStatement"===e.type||"Program"===e.type});n||(n=i),n.comments||(n.comments=[]),n.comments.push(r),e.nodesWithComments.push(n)}),e}(r)),i.allComments=r.comments}({ast:i,comments:n,nodesWithComments:[]}),i}function h(e){return be.test(e)&&-1===e.indexOf("-")}function d(e){return"this"===e?{type:"ThisExpression"}:{name:String(e),type:"Identifier"}}function m(e){return{type:"Literal",value:e}}function v(e){return{type:"ExpressionStatement",expression:e}}function y(e){return{type:"ReturnStatement",argument:e}}function g(e){for(var t=arguments.length,r=Array(t>2?t-2:0),n=2;n<t;n++)r[n-2]=arguments[n];var i=e.arrow,o=e.id,s=e.expression,a=e.generator,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return u=u.map(function(e){return"string"==typeof e?d(e):e}),{type:(i?"Arrow":"")+"FunctionExpression",id:o?"string"==typeof o?d(o):o:void 0,params:u,body:{body:r,type:"BlockStatement"},expression:s||!1,generator:a||!1}}function b(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return"string"==typeof e&&(e=d(e)),{type:"CallExpression",callee:e,arguments:r}}function _(e,t,r){return"string"==typeof e&&(e={name:e,type:"Identifier"}),{type:"VariableDeclaration",kind:r||"var",declarations:[{type:"VariableDeclarator",id:e,init:t}]}}function x(e,t,r){return"string"==typeof e&&(e=d(e)),"string"==typeof t?(r||h(t)||(r=!0),t=r?m(t):d(t)):"number"==typeof t?(t=m(t),r=!0):"Literal"===t.type&&(r=!0),{type:"MemberExpression",computed:!!r,object:e,property:t}}function w(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return r.reduce(function(e,t){return x(e,t)},"object"===(void 0===e?"undefined":H(e))?e:d(e))}function k(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return{body:Array.isArray(t[0])?t[0]:t,type:"BlockStatement"}}function E(){return Object.assign(k.apply(void 0,arguments),{sourceType:"module",type:"Program"})}function S(e,t,r){for(var n=arguments.length,i=Array(n>3?n-3:0),o=3;o<n;o++)i[o-3]=arguments[o];return Array.isArray(r)||(i.unshift(r),r=null),{block:k(i),finalizer:r?k(r):null,handler:{body:k(t),param:d(e),type:"CatchClause"},type:"TryStatement"}}function A(e,t){return{type:"Property",key:e,computed:"Identifier"!==e.type,shorthand:!1,value:t}}function D(e){var t=new oe,r=t.newScope(e,null);return t.accept(e,r,[]),r}function C(e,r){return t.tree.filter(D(e),function(e){var t=e.node,n=t.start,i=t.end;return"FunctionDeclaration"===t.type&&(n=t.params.length?t.params[0].start:t.body.start,i=t.body.end),n<=r&&r<=i},function(e){return e.subScopes})}function F(e,t){return(t&&e.node.id&&e.node.id.name?[e.node.id]:[]).concat(xe.declIds(e.params)).concat(e.funcDecls.map(function(e){return e.id})).concat(xe.varDeclIds(e)).concat(e.catches).concat(e.classDecls.map(function(e){return e.id})).concat(e.importSpecifiers)}function O(e,r){return t.arr.pluck(F(e,!0),"name").concat(r?j("Program"===e.node.type?e.node:e.node.body):[])}function j(e){return e&&e.comments?t.arr.flatten(e.comments.filter(function(e){return e.text.trim().match(/^global/)}).map(function(e){return t.arr.invoke(e.text.replace(/^\s*global\s*/,"").split(","),"trim")})):[]}function R(e){return le.run(e)}function B(e,t){if(0==t.length)return[null,null];var r=te(t),n=r[0],i=r.slice(1),o=n.decls||function(e){var t=xe.declIds(e.params).concat(e.catches),r=(e.node.id&&e.node.id.name?[e.node]:[]).concat(e.funcDecls).concat(e.classDecls);return t.map(function(e){return[e,e]}).concat(r.map(function(e){return[e,e.id]})).concat(xe.varDecls(e)).concat(e.importSpecifiers.map(function(t){return[L(e.node,t),t]}))}(n);n.decls=o;return o.find(function(t){var r=ee(t,2);r[0];return r[1].name==e})||B(e,i)}function T(e){function t(e,n){var i=[e].concat(n);e.refs.forEach(function(e){var t=B(e.name,i),n=ee(t,2),o=n[0],s=n[1];r.set(e,{decl:o,declId:s,ref:e})}),e.subScopes.forEach(function(e){return t(e,i)})}if(e.referencesResolvedSafely)return e;var r=e.resolvedRefMap||(e.resolvedRefMap=new Map);return t(e,[]),e.referencesResolvedSafely=!0,e}function P(e,r){function n(e){var t=O(e,o);return e.subScopes.map(n).reduce(function(e,t){return e.concat(t)},e.refs).filter(function(e){return-1===t.indexOf(e.name)})}(r=r||{}).withComments=!0,"string"==typeof e&&(e=p(e,r));var i=D(e),o=!!r.jslintGlobalComment,s=O(i,o),a=i.refs.concat(t.arr.flatten(i.subScopes.map(n))),u=t.arr.withoutAll(a.map(function(e){return e.name}),s);return{scope:i,varDecls:i.varDecls,funcDecls:i.funcDecls,classDecls:i.classDecls,declaredNames:s,undeclaredNames:u,refs:a,thisRefs:i.thisRefs}}function I(e,t){return t="string"==typeof t?p(t):t,acorn.walk.findNodesIncluding(t,e)}function L(e,r,n){var o=I(r.start,e).reverse().find(function(e){return t.arr.include(ke,e.type)});if(n&&n.asPath){var s=new i,a=void 0;s.accept=t.fun.wrap(s.accept,function(e,t,r,n){if(t===o)throw a=n,new Error("stop search");return e(t,r,n)});try{s.accept(e,{},[])}catch(e){}return a}return o}function N(e){return e.source||o(e)}function M(e,t){if(e.start===t.start&&e.end===t.end)return 0;if(e.end<=t.start)return-1;if(e.start>=t.end)return 1;if(e.start<=t.start&&e.end>=t.end)return 1;if(t.start<=e.start&&t.end>=e.end)return-1;throw new Error("Comparing nodes")}function q(e,r,n){var i="object"===(void 0===n?"undefined":H(n))?n:{changes:[],source:n},o=!1,s=i.changes.reduce(function(e,r){if(e.end<r.pos)return e;var n=r.pos<e.start;if(o=o||r.pos>=e.start&&r.pos<=e.end,"add"===r.type)return{start:n?e.start+r.string.length:e.start,end:e.end+r.string.length};if("del"===r.type)return{start:n?e.start-r.length:e.start,end:e.end-r.length};throw new Error("Cannot deal with change "+t.obj.inspect(r))},{start:e.start,end:e.end}),a=i.source,u=r(e,a.slice(s.start,s.end),o),c=Array.isArray(u)?u.map(N).join("\n"+function(e,r){var n=t.string.peekLeft(e,r,/\s+$/),i="number"==typeof n?e.slice(n,r):"";return"\n"===i[0]&&(i=i.slice(1)),i}(a,s.start)):c=N(u),l=[{type:"del",pos:s.start,length:s.end-s.start},{type:"add",pos:s.start,string:c}];return{changes:i.changes.concat(l),source:function(e,r){for(var n=0;n<e.length;n++){var i=e[n];if("del"===i.type)r=r.slice(0,i.pos)+r.slice(i.pos+i.length);else{if("add"!==i.type)throw new Error("Unexpected change "+t.obj.inspect(i));r=r.slice(0,i.pos)+i.string+r.slice(i.pos)}}return r}(l,a)}}function $(e,t){for(var r=e.sort(function(e,t){return M(e.target,t.target)}),n="object"===(void 0===t?"undefined":H(t))?t:{changes:[],source:t},i=0;i<r.length;i++){var o=r[i];n=q(o.target,o.replacementFunc,n)}return n}function W(e,r){var n=p(e,r=r||{}),i=t.arr.last(n.body);return"ExpressionStatement"===i.type?(n.body.splice(n.body.length-1,1,y(i.expression)),r.asAST?n:o(n)):r.asAST?n:e}function U(e,r){function n(e){return{type:"unknown",comment:e.comment.text}}function s(e){return e&&"VariableDeclaration"===e.type&&1===e.declarations.length}function a(e){return{name:e.declarations[0].id.name}}function u(e){return"AssignmentExpression"===e.type&&("ObjectExpression"===e.right.type||"AssignmentExpression"===e.right.type&&u(e.right))}var c="string"==typeof e?p(e,{withComments:!0}):e,l=r||("string"==typeof e?e:o(e)),f=t.arr.sortBy(function(e){var r=[],n=new i;return n.accept=t.fun.wrap(n.accept,function(e,n,i,o){return n.comments&&t.arr.pushAll(r,n.comments.map(function(e){return{path:o,comment:e,node:n}})),e(n,i,o)}),n.accept(e,r,[]),r}(c),function(e){return e.comment.start});return f.map(function(e,r){if(function(e){return t.arr.equals(e.path.slice(-2),["value","body"])}(e))return t.obj.merge([e,e.comment,{type:"method",comment:e.comment.text},function(e){for(var r=t.Path(e.path.slice(0,-2)).get(c),n=r.key?r.key.name:"<error: no name for method>",i=e.path.slice(),o="<error: no object found for method>";i.length&&"init"!==t.arr.last(i);)i.pop();if(i.length&&(o=t.Path(i.slice(0,-1).concat(["id","name"])).get(c)),t.string.startsWith(o,"<error")){for(i=e.path.slice();i.length&&"right"!==t.arr.last(i);)i.pop();if(i.length){var s=t.Path(i.slice(0,-1).concat(["left"])).get(c);o=l.slice(s.start,s.end)}}if(t.string.startsWith(o,"<error")){i=e.path.slice();var a=t.Path(i.slice(0,-6)).get(c),u=a&&"CallExpression"===a.type&&a.arguments[0];u&&(o=l.slice(u.start,u.end))}return{name:n,args:t.arr.pluck(r.value.params,"name"),objectName:o}}(e)]);if(function(e){var r=e.path.slice(-5);return t.arr.removeAt(r,1),t.arr.equals(r,["properties","value","callee","body"])}(e))return t.obj.merge([e,e.comment,{type:"method",comment:e.comment.text},function(e){var r,n,i;i=e.path.slice(0,-3);var o=t.Path(i).get(c);o&&"Property"===o.type&&(n=t.arr.pluck(o.value.callee.params,"name"),r=o.key?o.key.name:"<error: no name for method>"),r||(i=e.path.slice(0,-2),(o=t.Path(i).get(c))&&"Property"===o.type&&(n=t.arr.pluck(o.value.params,"name"),r=o.key?o.key.name:"<error: no name for method>")),r||(r="<error: no name for method>",n=[],i=e.path);for(var s=t.arr.clone(i),a="<error: no object found for method>";s.length&&"init"!==t.arr.last(s);)s.pop();if(s.length&&(a=t.Path(s.slice(0,-1).concat(["id","name"])).get(c)),t.string.startsWith(a,"<error")){for(s=t.arr.clone(i);s.length&&"right"!==t.arr.last(s);)s.pop();if(s.length){var u=t.Path(s.slice(0,-1).concat(["left"])).get(c);a=l.slice(u.start,u.end)}}if(t.string.startsWith(a,"<error")){s=t.arr.clone(i);var f=t.Path(s.slice(0,-4)).get(c),p=f&&"CallExpression"===f.type&&f.arguments[0];p&&(a=l.slice(p.start,p.end))}return{name:r,args:n,objectName:a}}(e)]);if(function(e){var r=t.Path(e.path.slice(0,-1)).get(c);return r&&"FunctionDeclaration"===r.type}(e))return t.obj.merge([e,e.comment,{type:"function",comment:e.comment.text},function(e){var r=t.Path(e.path.slice(0,-1)).get(c);return{name:r.id?r.id.name:"<error: no name for function>",args:t.arr.pluck(r.params,"name")}}(e)]);if(function(e){return t.arr.equals(e.path.slice(-2),["right","body"])}(e))return t.obj.merge([e,e.comment,{type:"method",comment:e.comment.text},function(e){var r=t.Path(e.path.slice(0,-1)).get(c);if("FunctionExpression"!==r.type&&"FunctionDeclaration"!==r.type)return{};var n=L(c,r);if("ExpressionStatement"!==n.type||"AssignmentExpression"!==n.expression.type)return{};var i=l.slice(n.expression.left.object.start,n.expression.left.object.end);return{name:l.slice(n.expression.left.property.start,n.expression.left.property.end),objectName:i,args:t.arr.pluck(r.params,"name")}}(e)]);var i=function(e){return t.arr.detect(e.node.body,function(t){return t.start>e.comment.end})}(e);if(!i)return t.obj.merge([e,e.comment,{followingNode:i},n(e)]);var o=f[r+1];return o&&o.comment.start<=i.start?t.obj.merge([e,e.comment,{followingNode:i},n(e)]):function(e){return s(e)&&("ObjectExpression"===e.declarations[0].init.type||u(e.declarations[0].init))}(i)?t.obj.merge([e,e.comment,{followingNode:i},{type:"object",comment:e.comment.text},a(i)]):s(i)?t.obj.merge([e,e.comment,{followingNode:i},{type:"var",comment:e.comment.text},a(i)]):t.obj.merge([e,e.comment,{followingNode:i},n(e)])})}function z(e,r){r=r||t.obj.merge({hideOneLiners:!1},r),"string"==typeof e&&(e=p(e,{addSource:!0}));var n="Program"===e.type?e.body:e.body.body,i=[],o=(r.hideOneLiners&&e.source,!0),s=!1,a=void 0;try{for(var u,c=n[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var l=u.value,f=function(e,r){if(!function(e){return"CallExpression"===t.Path("expression.type").get(e)&&"FunctionExpression"===t.Path("expression.callee.type").get(e)}(e))return null;var n,i=t.Path("expression.arguments.0").get(e);n=i&&"FunctionExpression"===i.type&&t.string.lines(i.source||"").length>5?z(i,r):z(t.Path("expression.callee").get(e),r);var o={node:e,name:t.Path("expression.callee.id.name").get(e)};return n.forEach(function(e){return e.parent||(e.parent=o)}),n}(l=function(e){return"ExportNamedDeclaration"!==e.type&&"ExportDefaultDeclaration"!==e.type||!e.declaration?e:e.declaration}(l),r)||function(e){if("VariableDeclaration"!==e.type)return null;var t=[],r=!0,n=!1,i=void 0;try{for(var o,s=function(){var e=o.value,r=e.id,n=e.node,i={name:r.name,node:n,type:"var-decl"};if(t.push(i),!i.node.init)return"continue";for(var s=i.node.init;"AssignmentExpression"===s.type;)s=s.right;if("ObjectExpression"===s.type)return i.type="object-decl",i.children=G(s).map(function(e){return Q({},e,{type:"object-"+e.type,parent:i})}),t.push.apply(t,re(i.children)),"continue";(u=V(s,i))&&(i.children=u.map(function(e){return Q({},e,{parent:i})}),t.push.apply(t,re(i.children)))},a=function(e){return e.declarations.map(function(e){return!e.source&&e.init&&(e.source=e.id.name+" = "+e.init.source),{node:e,id:e.id}})}(e)[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var u;s()}}catch(e){n=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return t}(l)||function(e){return"FunctionStatement"!==e.type&&"FunctionDeclaration"!==e.type?null:[{name:e.id.name,node:e,type:"function-decl"}]}(l)||function(e){var t;if("ClassDeclaration"!==e.type)return null;var r={type:"class-decl",name:e.id.name,node:e,children:[]};return(t=r.children).push.apply(t,re(e.body.body.map(function(e,t){return function(e,t,r){if("MethodDefinition"!==e.type)return null;var n;return"constructor"===e.kind?n="class-constructor":"method"===e.kind?n=e.static?"class-class-method":"class-instance-method":"get"===e.kind?n=e.static?"class-class-getter":"class-instance-getter":"set"===e.kind&&(n=e.static?"class-class-setter":"class-instance-setter"),n?{type:n,parent:t,node:e,name:e.key.name}:null}(e,r)}).filter(Boolean))),[r].concat(re(r.children))}(l)||V(l);if(f){if(r.hideOneLiners)if(e.loc)f=f.filter(function(e){return!e.node.loc||e.node.loc.start.line!==e.node.loc.end.line});else if(e.source){var h=[],d=!0,m=!1,v=void 0;try{for(var y,g=f[Symbol.iterator]();!(d=(y=g.next()).done);d=!0){var b=y.value;(b.parent&&h.includes(b.parent)||(b.node.source||"").includes("\n"))&&h.push(b)}}catch(e){m=!0,v=e}finally{try{!d&&g.return&&g.return()}finally{if(m)throw v}}f=h}i.push.apply(i,re(f))}}}catch(e){s=!0,a=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw a}}return i}function V(e,t){if("ExpressionStatement"===e.type&&(e=e.expression),"CallExpression"!==e.type)return null;var r=e.arguments.find(function(e){return"ObjectExpression"===e.type});return r?G(r,t):null}function G(e,t){return e.properties.map(function(e){return{name:e.key.name||e.key.value,type:"FunctionExpression"===e.value.type?"method":"property",node:e,parent:t}})}i.prototype.accept=function(e,t,r){if(!e)throw new Error("Undefined AST node in Visitor.accept:\n  "+r.join(".")+"\n  "+e);if(!e.type)throw new Error("Strangee AST node without type in Visitor.accept:\n  "+r.join(".")+"\n  "+JSON.stringify(e));switch(e.type){case"Node":return this.visitNode(e,t,r);case"SourceLocation":return this.visitSourceLocation(e,t,r);case"Position":return this.visitPosition(e,t,r);case"Program":return this.visitProgram(e,t,r);case"Function":return this.visitFunction(e,t,r);case"Statement":return this.visitStatement(e,t,r);case"SwitchCase":return this.visitSwitchCase(e,t,r);case"CatchClause":return this.visitCatchClause(e,t,r);case"VariableDeclarator":return this.visitVariableDeclarator(e,t,r);case"Expression":return this.visitExpression(e,t,r);case"Property":return this.visitProperty(e,t,r);case"Pattern":return this.visitPattern(e,t,r);case"Super":return this.visitSuper(e,t,r);case"SpreadElement":return this.visitSpreadElement(e,t,r);case"TemplateElement":return this.visitTemplateElement(e,t,r);case"Class":return this.visitClass(e,t,r);case"ClassBody":return this.visitClassBody(e,t,r);case"MethodDefinition":return this.visitMethodDefinition(e,t,r);case"ModuleDeclaration":return this.visitModuleDeclaration(e,t,r);case"ModuleSpecifier":return this.visitModuleSpecifier(e,t,r);case"Identifier":return this.visitIdentifier(e,t,r);case"Literal":return this.visitLiteral(e,t,r);case"ExpressionStatement":return this.visitExpressionStatement(e,t,r);case"BlockStatement":return this.visitBlockStatement(e,t,r);case"EmptyStatement":return this.visitEmptyStatement(e,t,r);case"DebuggerStatement":return this.visitDebuggerStatement(e,t,r);case"WithStatement":return this.visitWithStatement(e,t,r);case"ReturnStatement":return this.visitReturnStatement(e,t,r);case"LabeledStatement":return this.visitLabeledStatement(e,t,r);case"BreakStatement":return this.visitBreakStatement(e,t,r);case"ContinueStatement":return this.visitContinueStatement(e,t,r);case"IfStatement":return this.visitIfStatement(e,t,r);case"SwitchStatement":return this.visitSwitchStatement(e,t,r);case"ThrowStatement":return this.visitThrowStatement(e,t,r);case"TryStatement":return this.visitTryStatement(e,t,r);case"WhileStatement":return this.visitWhileStatement(e,t,r);case"DoWhileStatement":return this.visitDoWhileStatement(e,t,r);case"ForStatement":return this.visitForStatement(e,t,r);case"ForInStatement":return this.visitForInStatement(e,t,r);case"Declaration":return this.visitDeclaration(e,t,r);case"ThisExpression":return this.visitThisExpression(e,t,r);case"ArrayExpression":return this.visitArrayExpression(e,t,r);case"ObjectExpression":return this.visitObjectExpression(e,t,r);case"FunctionExpression":return this.visitFunctionExpression(e,t,r);case"UnaryExpression":return this.visitUnaryExpression(e,t,r);case"UpdateExpression":return this.visitUpdateExpression(e,t,r);case"BinaryExpression":return this.visitBinaryExpression(e,t,r);case"AssignmentExpression":return this.visitAssignmentExpression(e,t,r);case"LogicalExpression":return this.visitLogicalExpression(e,t,r);case"MemberExpression":return this.visitMemberExpression(e,t,r);case"ConditionalExpression":return this.visitConditionalExpression(e,t,r);case"CallExpression":return this.visitCallExpression(e,t,r);case"NewExpression":return this.visitNewExpression(e,t,r);case"SequenceExpression":return this.visitSequenceExpression(e,t,r);case"ArrowFunctionExpression":return this.visitArrowFunctionExpression(e,t,r);case"YieldExpression":return this.visitYieldExpression(e,t,r);case"TemplateLiteral":return this.visitTemplateLiteral(e,t,r);case"TaggedTemplateExpression":return this.visitTaggedTemplateExpression(e,t,r);case"AssignmentProperty":return this.visitAssignmentProperty(e,t,r);case"ObjectPattern":return this.visitObjectPattern(e,t,r);case"ArrayPattern":return this.visitArrayPattern(e,t,r);case"RestElement":return this.visitRestElement(e,t,r);case"AssignmentPattern":return this.visitAssignmentPattern(e,t,r);case"ClassExpression":return this.visitClassExpression(e,t,r);case"MetaProperty":return this.visitMetaProperty(e,t,r);case"ImportDeclaration":return this.visitImportDeclaration(e,t,r);case"ImportSpecifier":return this.visitImportSpecifier(e,t,r);case"ImportDefaultSpecifier":return this.visitImportDefaultSpecifier(e,t,r);case"ImportNamespaceSpecifier":return this.visitImportNamespaceSpecifier(e,t,r);case"ExportNamedDeclaration":return this.visitExportNamedDeclaration(e,t,r);case"ExportSpecifier":return this.visitExportSpecifier(e,t,r);case"ExportDefaultDeclaration":return this.visitExportDefaultDeclaration(e,t,r);case"ExportAllDeclaration":return this.visitExportAllDeclaration(e,t,r);case"AwaitExpression":return this.visitAwaitExpression(e,t,r);case"RegExpLiteral":return this.visitRegExpLiteral(e,t,r);case"FunctionDeclaration":return this.visitFunctionDeclaration(e,t,r);case"VariableDeclaration":return this.visitVariableDeclaration(e,t,r);case"ForOfStatement":return this.visitForOfStatement(e,t,r);case"ClassDeclaration":return this.visitClassDeclaration(e,t,r)}throw new Error("No visit function in AST visitor Visitor for:\n  "+r.join(".")+"\n  "+JSON.stringify(e))},i.prototype.visitNode=function(e,t,r){return e},i.prototype.visitSourceLocation=function(e,t,r){return e.start=this.accept(e.start,t,r.concat(["start"])),e.end=this.accept(e.end,t,r.concat(["end"])),e},i.prototype.visitPosition=function(e,t,r){return e},i.prototype.visitProgram=function(e,t,r){for(var n=[],i=0;i<e.body.length;i++){var o=e.body[i],s=o?this.accept(o,t,r.concat(["body",i])):o;Array.isArray(s)?n.push.apply(n,s):n.push(s)}return e.body=n,e},i.prototype.visitFunction=function(e,t,r){e.id&&(e.id=this.accept(e.id,t,r.concat(["id"])));for(var n=[],i=0;i<e.params.length;i++){var o=e.params[i],s=o?this.accept(o,t,r.concat(["params",i])):o;Array.isArray(s)?n.push.apply(n,s):n.push(s)}return e.params=n,e.body=this.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitStatement=function(e,t,r){return e},i.prototype.visitSwitchCase=function(e,t,r){e.test&&(e.test=this.accept(e.test,t,r.concat(["test"])));for(var n=[],i=0;i<e.consequent.length;i++){var o=e.consequent[i],s=o?this.accept(o,t,r.concat(["consequent",i])):o;Array.isArray(s)?n.push.apply(n,s):n.push(s)}return e.consequent=n,e},i.prototype.visitCatchClause=function(e,t,r){return e.param=this.accept(e.param,t,r.concat(["param"])),e.body=this.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitVariableDeclarator=function(e,t,r){return e.id=this.accept(e.id,t,r.concat(["id"])),e.init&&(e.init=this.accept(e.init,t,r.concat(["init"]))),e},i.prototype.visitExpression=function(e,t,r){return e},i.prototype.visitProperty=function(e,t,r){return e.key=this.accept(e.key,t,r.concat(["key"])),e.value=this.accept(e.value,t,r.concat(["value"])),e},i.prototype.visitPattern=function(e,t,r){return e},i.prototype.visitSuper=function(e,t,r){return e},i.prototype.visitSpreadElement=function(e,t,r){return e.argument=this.accept(e.argument,t,r.concat(["argument"])),e},i.prototype.visitTemplateElement=function(e,t,r){return e},i.prototype.visitClass=function(e,t,r){return e.id&&(e.id=this.accept(e.id,t,r.concat(["id"]))),e.superClass&&(e.superClass=this.accept(e.superClass,t,r.concat(["superClass"]))),e.body=this.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitClassBody=function(e,t,r){for(var n=[],i=0;i<e.body.length;i++){var o=e.body[i],s=o?this.accept(o,t,r.concat(["body",i])):o;Array.isArray(s)?n.push.apply(n,s):n.push(s)}return e.body=n,e},i.prototype.visitMethodDefinition=function(e,t,r){return e.key=this.accept(e.key,t,r.concat(["key"])),e.value=this.accept(e.value,t,r.concat(["value"])),e},i.prototype.visitModuleDeclaration=function(e,t,r){return e},i.prototype.visitModuleSpecifier=function(e,t,r){return e.local=this.accept(e.local,t,r.concat(["local"])),e},i.prototype.visitIdentifier=function(e,t,r){return e},i.prototype.visitLiteral=function(e,t,r){return e},i.prototype.visitExpressionStatement=function(e,t,r){return e.expression=this.accept(e.expression,t,r.concat(["expression"])),e},i.prototype.visitBlockStatement=function(e,t,r){for(var n=[],i=0;i<e.body.length;i++){var o=e.body[i],s=o?this.accept(o,t,r.concat(["body",i])):o;Array.isArray(s)?n.push.apply(n,s):n.push(s)}return e.body=n,e},i.prototype.visitEmptyStatement=function(e,t,r){return e},i.prototype.visitDebuggerStatement=function(e,t,r){return e},i.prototype.visitWithStatement=function(e,t,r){return e.object=this.accept(e.object,t,r.concat(["object"])),e.body=this.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitReturnStatement=function(e,t,r){return e.argument&&(e.argument=this.accept(e.argument,t,r.concat(["argument"]))),e},i.prototype.visitLabeledStatement=function(e,t,r){return e.label=this.accept(e.label,t,r.concat(["label"])),e.body=this.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitBreakStatement=function(e,t,r){return e.label&&(e.label=this.accept(e.label,t,r.concat(["label"]))),e},i.prototype.visitContinueStatement=function(e,t,r){return e.label&&(e.label=this.accept(e.label,t,r.concat(["label"]))),e},i.prototype.visitIfStatement=function(e,t,r){return e.test=this.accept(e.test,t,r.concat(["test"])),e.consequent=this.accept(e.consequent,t,r.concat(["consequent"])),e.alternate&&(e.alternate=this.accept(e.alternate,t,r.concat(["alternate"]))),e},i.prototype.visitSwitchStatement=function(e,t,r){e.discriminant=this.accept(e.discriminant,t,r.concat(["discriminant"]));for(var n=[],i=0;i<e.cases.length;i++){var o=e.cases[i],s=o?this.accept(o,t,r.concat(["cases",i])):o;Array.isArray(s)?n.push.apply(n,s):n.push(s)}return e.cases=n,e},i.prototype.visitThrowStatement=function(e,t,r){return e.argument=this.accept(e.argument,t,r.concat(["argument"])),e},i.prototype.visitTryStatement=function(e,t,r){return e.block=this.accept(e.block,t,r.concat(["block"])),e.handler&&(e.handler=this.accept(e.handler,t,r.concat(["handler"]))),e.finalizer&&(e.finalizer=this.accept(e.finalizer,t,r.concat(["finalizer"]))),e},i.prototype.visitWhileStatement=function(e,t,r){return e.test=this.accept(e.test,t,r.concat(["test"])),e.body=this.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitDoWhileStatement=function(e,t,r){return e.body=this.accept(e.body,t,r.concat(["body"])),e.test=this.accept(e.test,t,r.concat(["test"])),e},i.prototype.visitForStatement=function(e,t,r){return e.init&&(e.init=this.accept(e.init,t,r.concat(["init"]))),e.test&&(e.test=this.accept(e.test,t,r.concat(["test"]))),e.update&&(e.update=this.accept(e.update,t,r.concat(["update"]))),e.body=this.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitForInStatement=function(e,t,r){return e.left=this.accept(e.left,t,r.concat(["left"])),e.right=this.accept(e.right,t,r.concat(["right"])),e.body=this.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitDeclaration=function(e,t,r){return e},i.prototype.visitThisExpression=function(e,t,r){return e},i.prototype.visitArrayExpression=function(e,t,r){if(e.elements){for(var n=[],i=0;i<e.elements.length;i++){var o=e.elements[i],s=o?this.accept(o,t,r.concat(["elements",i])):o;Array.isArray(s)?n.push.apply(n,s):n.push(s)}e.elements=n}return e},i.prototype.visitObjectExpression=function(e,t,r){for(var n=[],i=0;i<e.properties.length;i++){var o=e.properties[i],s=o?this.accept(o,t,r.concat(["properties",i])):o;Array.isArray(s)?n.push.apply(n,s):n.push(s)}return e.properties=n,e},i.prototype.visitFunctionExpression=function(e,t,r){e.id&&(e.id=this.accept(e.id,t,r.concat(["id"])));for(var n=[],i=0;i<e.params.length;i++){var o=e.params[i],s=o?this.accept(o,t,r.concat(["params",i])):o;Array.isArray(s)?n.push.apply(n,s):n.push(s)}return e.params=n,e.body=this.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitUnaryExpression=function(e,t,r){return e.argument=this.accept(e.argument,t,r.concat(["argument"])),e},i.prototype.visitUpdateExpression=function(e,t,r){return e.argument=this.accept(e.argument,t,r.concat(["argument"])),e},i.prototype.visitBinaryExpression=function(e,t,r){return e.left=this.accept(e.left,t,r.concat(["left"])),e.right=this.accept(e.right,t,r.concat(["right"])),e},i.prototype.visitAssignmentExpression=function(e,t,r){return e.left=this.accept(e.left,t,r.concat(["left"])),e.right=this.accept(e.right,t,r.concat(["right"])),e},i.prototype.visitLogicalExpression=function(e,t,r){return e.left=this.accept(e.left,t,r.concat(["left"])),e.right=this.accept(e.right,t,r.concat(["right"])),e},i.prototype.visitMemberExpression=function(e,t,r){return e.object=this.accept(e.object,t,r.concat(["object"])),e.property=this.accept(e.property,t,r.concat(["property"])),e},i.prototype.visitConditionalExpression=function(e,t,r){return e.test=this.accept(e.test,t,r.concat(["test"])),e.alternate=this.accept(e.alternate,t,r.concat(["alternate"])),e.consequent=this.accept(e.consequent,t,r.concat(["consequent"])),e},i.prototype.visitCallExpression=function(e,t,r){e.callee=this.accept(e.callee,t,r.concat(["callee"]));for(var n=[],i=0;i<e.arguments.length;i++){var o=e.arguments[i],s=o?this.accept(o,t,r.concat(["arguments",i])):o;Array.isArray(s)?n.push.apply(n,s):n.push(s)}return e.arguments=n,e},i.prototype.visitNewExpression=function(e,t,r){e.callee=this.accept(e.callee,t,r.concat(["callee"]));for(var n=[],i=0;i<e.arguments.length;i++){var o=e.arguments[i],s=o?this.accept(o,t,r.concat(["arguments",i])):o;Array.isArray(s)?n.push.apply(n,s):n.push(s)}return e.arguments=n,e},i.prototype.visitSequenceExpression=function(e,t,r){for(var n=[],i=0;i<e.expressions.length;i++){var o=e.expressions[i],s=o?this.accept(o,t,r.concat(["expressions",i])):o;Array.isArray(s)?n.push.apply(n,s):n.push(s)}return e.expressions=n,e},i.prototype.visitArrowFunctionExpression=function(e,t,r){e.body=this.accept(e.body,t,r.concat(["body"])),e.id&&(e.id=this.accept(e.id,t,r.concat(["id"])));for(var n=[],i=0;i<e.params.length;i++){var o=e.params[i],s=o?this.accept(o,t,r.concat(["params",i])):o;Array.isArray(s)?n.push.apply(n,s):n.push(s)}return e.params=n,e},i.prototype.visitYieldExpression=function(e,t,r){return e.argument&&(e.argument=this.accept(e.argument,t,r.concat(["argument"]))),e},i.prototype.visitTemplateLiteral=function(e,t,r){for(var n=[],i=0;i<e.quasis.length;i++){var o=(s=e.quasis[i])?this.accept(s,t,r.concat(["quasis",i])):s;Array.isArray(o)?n.push.apply(n,o):n.push(o)}e.quasis=n;for(n=[],i=0;i<e.expressions.length;i++){var s;o=(s=e.expressions[i])?this.accept(s,t,r.concat(["expressions",i])):s;Array.isArray(o)?n.push.apply(n,o):n.push(o)}return e.expressions=n,e},i.prototype.visitTaggedTemplateExpression=function(e,t,r){return e.tag=this.accept(e.tag,t,r.concat(["tag"])),e.quasi=this.accept(e.quasi,t,r.concat(["quasi"])),e},i.prototype.visitAssignmentProperty=function(e,t,r){return e.value=this.accept(e.value,t,r.concat(["value"])),e.key=this.accept(e.key,t,r.concat(["key"])),e},i.prototype.visitObjectPattern=function(e,t,r){for(var n=[],i=0;i<e.properties.length;i++){var o=e.properties[i],s=o?this.accept(o,t,r.concat(["properties",i])):o;Array.isArray(s)?n.push.apply(n,s):n.push(s)}return e.properties=n,e},i.prototype.visitArrayPattern=function(e,t,r){if(e.elements){for(var n=[],i=0;i<e.elements.length;i++){var o=e.elements[i],s=o?this.accept(o,t,r.concat(["elements",i])):o;Array.isArray(s)?n.push.apply(n,s):n.push(s)}e.elements=n}return e},i.prototype.visitRestElement=function(e,t,r){return e.argument=this.accept(e.argument,t,r.concat(["argument"])),e},i.prototype.visitAssignmentPattern=function(e,t,r){return e.left=this.accept(e.left,t,r.concat(["left"])),e.right=this.accept(e.right,t,r.concat(["right"])),e},i.prototype.visitClassExpression=function(e,t,r){return e.id&&(e.id=this.accept(e.id,t,r.concat(["id"]))),e.superClass&&(e.superClass=this.accept(e.superClass,t,r.concat(["superClass"]))),e.body=this.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitMetaProperty=function(e,t,r){return e.meta=this.accept(e.meta,t,r.concat(["meta"])),e.property=this.accept(e.property,t,r.concat(["property"])),e},i.prototype.visitImportDeclaration=function(e,t,r){for(var n=[],i=0;i<e.specifiers.length;i++){var o=e.specifiers[i],s=o?this.accept(o,t,r.concat(["specifiers",i])):o;Array.isArray(s)?n.push.apply(n,s):n.push(s)}return e.specifiers=n,e.source=this.accept(e.source,t,r.concat(["source"])),e},i.prototype.visitImportSpecifier=function(e,t,r){return e.imported=this.accept(e.imported,t,r.concat(["imported"])),e.local=this.accept(e.local,t,r.concat(["local"])),e},i.prototype.visitImportDefaultSpecifier=function(e,t,r){return e.local=this.accept(e.local,t,r.concat(["local"])),e},i.prototype.visitImportNamespaceSpecifier=function(e,t,r){return e.local=this.accept(e.local,t,r.concat(["local"])),e},i.prototype.visitExportNamedDeclaration=function(e,t,r){e.declaration&&(e.declaration=this.accept(e.declaration,t,r.concat(["declaration"])));for(var n=[],i=0;i<e.specifiers.length;i++){var o=e.specifiers[i],s=o?this.accept(o,t,r.concat(["specifiers",i])):o;Array.isArray(s)?n.push.apply(n,s):n.push(s)}return e.specifiers=n,e.source&&(e.source=this.accept(e.source,t,r.concat(["source"]))),e},i.prototype.visitExportSpecifier=function(e,t,r){return e.exported=this.accept(e.exported,t,r.concat(["exported"])),e.local=this.accept(e.local,t,r.concat(["local"])),e},i.prototype.visitExportDefaultDeclaration=function(e,t,r){return e.declaration=this.accept(e.declaration,t,r.concat(["declaration"])),e},i.prototype.visitExportAllDeclaration=function(e,t,r){return e.source=this.accept(e.source,t,r.concat(["source"])),e},i.prototype.visitAwaitExpression=function(e,t,r){return e.argument=this.accept(e.argument,t,r.concat(["argument"])),e},i.prototype.visitRegExpLiteral=function(e,t,r){return e},i.prototype.visitFunctionDeclaration=function(e,t,r){e.id=this.accept(e.id,t,r.concat(["id"]));for(var n=[],i=0;i<e.params.length;i++){var o=e.params[i],s=o?this.accept(o,t,r.concat(["params",i])):o;Array.isArray(s)?n.push.apply(n,s):n.push(s)}return e.params=n,e.body=this.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitVariableDeclaration=function(e,t,r){for(var n=[],i=0;i<e.declarations.length;i++){var o=e.declarations[i],s=o?this.accept(o,t,r.concat(["declarations",i])):o;Array.isArray(s)?n.push.apply(n,s):n.push(s)}return e.declarations=n,e},i.prototype.visitForOfStatement=function(e,t,r){return e.left=this.accept(e.left,t,r.concat(["left"])),e.right=this.accept(e.right,t,r.concat(["right"])),e.body=this.accept(e.body,t,r.concat(["body"])),e},i.prototype.visitClassDeclaration=function(e,t,r){return e.id=this.accept(e.id,t,r.concat(["id"])),e.superClass&&(e.superClass=this.accept(e.superClass,t,r.concat(["superClass"]))),e.body=this.accept(e.body,t,r.concat(["body"])),e};var H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},K=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),Q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Y=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(n)},X=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Z=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},ee=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),te=function(e){return Array.isArray(e)?e:Array.from(e)},re=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},ne=function(e){function t(){return J(this,t),Z(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return X(t,i),K(t,[{key:"accept",value:function(e,r,n){var i=n.map(function(e){return"string"==typeof e?"."+e:"["+e+"]"}).join(""),o=[],s=Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,{index:r.index,tree:o},n);return r.tree.push({node:e,path:i,index:r.index++,children:o}),s}}]),t}(),ie=function(e){function t(){return J(this,t),Z(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return X(t,i),K(t,[{key:"recordNotEqual",value:function(e,t,r,n){r.comparisons.errors.push({node1:e,node2:t,path:r.completePath,msg:n})}},{key:"compareType",value:function(e,t,r){return this.compareField("type",e,t,r)}},{key:"compareField",value:function(e,t,r,n){if(r=lively.lang.Path(n.completePath.join(".")).get(r),t&&r&&t[e]===r[e])return!0;if(t&&"*"===t[e]||r&&"*"===r[e])return!0;var i,o=n.completePath.join(".")+"."+e;return i=t?r?o+" is not equal: "+t[e]+" vs. "+r[e]:"node2 not defined but node1 ("+o+") is: "+t[e]:"node1 on "+o+" not defined",this.recordNotEqual(t,r,n,i),!1}},{key:"accept",value:function(e,t,r,n){var i=lively.lang.Path(n.join(".")).get(t);if("*"!==e&&"*"!==i){var o={completePath:n,comparisons:r.comparisons};this.compareType(e,t,o)&&this["visit"+e.type](e,t,o,n)}}},{key:"visitFunction",value:function(e,r,n,i){return e.generator&&this.compareField("generator",e,r,n),e.expression&&this.compareField("expression",e,r,n),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitFunction",this).call(this,e,r,n,i)}},{key:"visitSwitchStatement",value:function(e,r,n,i){return e.lexical&&this.compareField("lexical",e,r,n),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitSwitchStatement",this).call(this,e,r,n,i)}},{key:"visitForInStatement",value:function(e,r,n,i){return e.each&&this.compareField("each",e,r,n),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitForInStatement",this).call(this,e,r,n,i)}},{key:"visitFunctionDeclaration",value:function(e,r,n,i){return e.generator&&this.compareField("generator",e,r,n),e.expression&&this.compareField("expression",e,r,n),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitFunctionDeclaration",this).call(this,e,r,n,i)}},{key:"visitVariableDeclaration",value:function(e,r,n,i){return this.compareField("kind",e,r,n),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitVariableDeclaration",this).call(this,e,r,n,i)}},{key:"visitUnaryExpression",value:function(e,r,n,i){return this.compareField("operator",e,r,n),e.prefix&&this.compareField("prefix",e,r,n),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitUnaryExpression",this).call(this,e,r,n,i)}},{key:"visitBinaryExpression",value:function(e,r,n,i){return this.compareField("operator",e,r,n),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitBinaryExpression",this).call(this,e,r,n,i)}},{key:"visitAssignmentExpression",value:function(e,r,n,i){return this.compareField("operator",e,r,n),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitAssignmentExpression",this).call(this,e,r,n,i)}},{key:"visitUpdateExpression",value:function(e,r,n,i){return this.compareField("operator",e,r,n),e.prefix&&this.compareField("prefix",e,r,n),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitUpdateExpression",this).call(this,e,r,n,i)}},{key:"visitLogicalExpression",value:function(e,r,n,i){return this.compareField("operator",e,r,n),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitLogicalExpression",this).call(this,e,r,n,i)}},{key:"visitMemberExpression",value:function(e,r,n,i){return e.computed&&this.compareField("computed",e,r,n),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitMemberExpression",this).call(this,e,r,n,i)}},{key:"visitComprehensionBlock",value:function(e,r,n,i){return e.each&&this.compareField("each",e,r,n),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitComprehensionBlock",this).call(this,e,r,n,i)}},{key:"visitIdentifier",value:function(e,r,n,i){return this.compareField("name",e,r,n),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitIdentifier",this).call(this,e,r,n,i)}},{key:"visitLiteral",value:function(e,r,n,i){return this.compareField("value",e,r,n),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitLiteral",this).call(this,e,r,n,i)}},{key:"visitClassDeclaration",value:function(e,r,n,i){return this.compareField("id",e,r,n),e.superClass&&this.compareField("superClass",e,r,n),this.compareField("body",e,r,n),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitClassDeclaration",this).call(this,e,r,n,i)}},{key:"visitClassBody",value:function(e,r,n,i){return this.compareField("body",e,r,n),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitClassBody",this).call(this,e,r,n,i)}},{key:"visitMethodDefinition",value:function(e,r,n,i){return this.compareField("static",e,r,n),this.compareField("computed",e,r,n),this.compareField("kind",e,r,n),this.compareField("key",e,r,n),this.compareField("value",e,r,n),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitMethodDefinition",this).call(this,e,r,n,i)}}]),t}(),oe=function(e){function t(){return J(this,t),Z(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return X(t,i),K(t,[{key:"newScope",value:function(e,t){var r={node:e,varDecls:[],varDeclPaths:[],funcDecls:[],funcDeclPaths:[],classDecls:[],classDeclPaths:[],classExprs:[],classExprPaths:[],methodDecls:[],methodDeclPaths:[],importSpecifiers:[],importSpecifierPaths:[],exportDecls:[],exportDeclPaths:[],refs:[],thisRefs:[],params:[],catches:[],subScopes:[],resolvedRefMap:new Map};return t&&t.subScopes.push(r),r}},{key:"visitVariableDeclaration",value:function(e,r,n){return r.varDecls.push(e),r.varDeclPaths.push(n),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitVariableDeclaration",this).call(this,e,r,n)}},{key:"visitVariableDeclarator",value:function(e,t,r){return e.init&&(e.init=this.accept(e.init,t,r.concat(["init"]))),e}},{key:"visitFunction",value:function(e,t,r){var n=this,i=this.newScope(e,t);return e.params.forEach(function(e,t){"AssignmentPattern"===e.type&&n.accept(e.right,i,r.concat("params",t,"right"))}),i.params=Array.prototype.slice.call(e.params),i}},{key:"visitFunctionDeclaration",value:function(e,t,r){var n=this.visitFunction(e,t,r);t.funcDecls.push(e),t.funcDeclPaths.push(r);var i=this;return e.defaults&&(e.defaults=e.defaults.reduce(function(e,t,o){var s=i.accept(t,n,r.concat(["defaults",o]));return Array.isArray(s)?e.push.apply(e,s):e.push(s),e},[])),e.rest&&(e.rest=i.accept(e.rest,n,r.concat(["rest"]))),e.body=i.accept(e.body,n,r.concat(["body"])),e.loc&&(e.loc=i.accept(e.loc,n,r.concat(["loc"]))),e}},{key:"visitFunctionExpression",value:function(e,t,r){var n=this.visitFunction(e,t,r),i=this;return e.defaults&&(e.defaults=e.defaults.reduce(function(e,t,o){var s=i.accept(t,n,r.concat(["defaults",o]));return Array.isArray(s)?e.push.apply(e,s):e.push(s),e},[])),e.rest&&(e.rest=i.accept(e.rest,n,r.concat(["rest"]))),e.body=i.accept(e.body,n,r.concat(["body"])),e.loc&&(e.loc=i.accept(e.loc,n,r.concat(["loc"]))),e}},{key:"visitArrowFunctionExpression",value:function(e,t,r){var n=this.visitFunction(e,t,r),i=this;return e.defaults&&(e.defaults=e.defaults.reduce(function(e,t,o){var s=i.accept(t,n,r.concat(["defaults",o]));return Array.isArray(s)?e.push.apply(e,s):e.push(s),e},[])),e.rest&&(e.rest=i.accept(e.rest,n,r.concat(["rest"]))),e.body=i.accept(e.body,n,r.concat(["body"])),e.loc&&(e.loc=i.accept(e.loc,n,r.concat(["loc"]))),e.generator,e.expression,e}},{key:"visitIdentifier",value:function(e,r,n){return r.refs.push(e),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitIdentifier",this).call(this,e,r,n)}},{key:"visitMemberExpression",value:function(e,t,r){return e.object=this.accept(e.object,t,r.concat(["object"])),e.computed&&(e.property=this.accept(e.property,t,r.concat(["property"]))),e}},{key:"visitProperty",value:function(e,t,r){return e.computed&&(e.key=this.accept(e.key,t,r.concat(["key"]))),e.value=this.accept(e.value,t,r.concat(["value"])),e}},{key:"visitThisExpression",value:function(e,r,n){return r.thisRefs.push(e),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitThisExpression",this).call(this,e,r,n)}},{key:"visitTryStatement",value:function(e,t,r){return e.block=this.accept(e.block,t,r.concat(["block"])),e.handler&&(e.handler=this.accept(e.handler,t,r.concat(["handler"])),t.catches.push(e.handler.param)),e.finalizer&&(e.finalizer=this.accept(e.finalizer,t,r.concat(["finalizer"]))),e}},{key:"visitLabeledStatement",value:function(e,t,r){return e.body=this.accept(e.body,t,r.concat(["body"])),e}},{key:"visitClassDeclaration",value:function(e,t,r){t.classDecls.push(e),t.classDeclPaths.push(r);return e.superClass&&(e.superClass=this.accept(e.superClass,t,r.concat(["superClass"]))),e.body=this.accept(e.body,t,r.concat(["body"])),e}},{key:"visitClassExpression",value:function(e,t,r){e.id&&(t.classExprs.push(e),t.classExprPaths.push(r));return e.superClass&&(e.superClass=this.accept(e.superClass,t,r.concat(["superClass"]))),e.body=this.accept(e.body,t,r.concat(["body"])),e}},{key:"visitMethodDefinition",value:function(e,t,r){return e.value=this.accept(e.value,t,r.concat(["value"])),e}},{key:"visitMetaProperty",value:function(e,t,r){return e}},{key:"visitBreakStatement",value:function(e,t,r){return e}},{key:"visitContinueStatement",value:function(e,t,r){return e}},{key:"visitImportSpecifier",value:function(e,t,r){t.importSpecifiers.push(e.local),t.importSpecifierPaths.push(r);return e.local=this.accept(e.local,t,r.concat(["local"])),e}},{key:"visitImportDefaultSpecifier",value:function(e,t,r){t.importSpecifiers.push(e.local),t.importSpecifierPaths.push(r);return e}},{key:"visitImportNamespaceSpecifier",value:function(e,t,r){t.importSpecifiers.push(e.local),t.importSpecifierPaths.push(r);return e}},{key:"visitExportSpecifier",value:function(e,t,r){return e.local=this.accept(e.local,t,r.concat(["local"])),e}},{key:"visitExportNamedDeclaration",value:function(e,r,n){return r.exportDecls.push(e),r.exportDeclPaths.push(n),e.source||Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitExportNamedDeclaration",this).call(this,e,r,n),e}},{key:"visitExportDefaultDeclaration",value:function(e,r,n){return r.exportDecls.push(e),r.exportDeclPaths.push(n),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitExportDefaultDeclaration",this).call(this,e,r,n)}},{key:"visitExportAllDeclaration",value:function(e,r,n){return r.exportDecls.push(e),r.exportDeclPaths.push(n),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitExportAllDeclaration",this).call(this,e,r,n)}}]),t}(),se=r.escodegen||r,ae=acorn.walk,ue=acorn.loose;ae.base.AwaitExpression||(ae.base.AwaitExpression=function(e,t,r){e.argument&&r(e.argument,t,"Expression")}),ae.forEachNode=s,ae.matchNodes=function(e,t,r,n){return s(e,function(e,r,n,i){t[e.type]&&t[e.type](e,r,n,i)},r,n)},ae.findNodesIncluding=a,ae.withParentInfo=function(e,r,n){function i(e){var r={id:t.string.newUUID(),parentScope:e,containingScopes:[]};return e&&e.containingScopes.push(r),r}n=n||{};var o,a=ae.make({Function:function(e,t,r){t&&t.scope&&(t.scope=i(t.scope)),r(e.body,t,"ScopeBody")},VariableDeclarator:function(e,t,r){e.init&&r(e.init,t,"Expression")},VariableDeclaration:function(e,t,r){for(var n=0;n<e.declarations.length;++n){var i=e.declarations[n];i&&r(i,t,"VariableDeclarator")}},ObjectExpression:function(e,t,r){for(var n=0;n<e.properties.length;++n){var i=e.properties[n];r(i.key,t,"Expression"),r(i.value,t,"Expression")}},MemberExpression:function(e,t,r){r(e.object,t,"Expression"),r(e.property,t,"Expression")}},ae.base),u=[];s(e,function(e){t.arr.withoutAll(Object.keys(e),["end","start","type","source","raw"]).forEach(function(t){if(!e.__lookupGetter__(t)){var r=e[t];e.__defineGetter__(t,function(){return o=t,r}),u.push([e,t,e[t]])}})},null,{visitors:a});var c=[];return Object.keys(a).forEach(function(e){var t=a[e];a[e]=function(i,s,a){return e===i.type||n.visitAllNodes?(c.push(r.call(null,i,{scope:s.scope,depth:s.depth,parent:s.parent,type:e,propertyInParent:o})),t(i,{scope:s.scope,parent:i,depth:s.depth+1},a)):t(i,s,a)}}),ae.recursive(e,{scope:i(),parent:null,propertyInParent:"",depth:0},null,a),u.forEach(function(e){delete e[0][e[1]],e[0][e[1]]=e[2]}),c},ae.copy=function(e,r){function n(e){return null===e?null:i[e.type](e,n)}var i=t.obj.extend({Program:function(e,t){return{start:e.start,end:e.end,type:"Program",body:e.body.map(t),source:e.source,astIndex:e.astIndex}},FunctionDeclaration:function(e,t){return{start:e.start,end:e.end,type:"FunctionDeclaration",id:t(e.id),params:e.params.map(t),body:t(e.body),source:e.source,astIndex:e.astIndex}},BlockStatement:function(e,t){return{start:e.start,end:e.end,type:"BlockStatement",body:e.body.map(t),source:e.source,astIndex:e.astIndex}},ExpressionStatement:function(e,t){return{start:e.start,end:e.end,type:"ExpressionStatement",expression:t(e.expression),source:e.source,astIndex:e.astIndex}},CallExpression:function(e,t){return{start:e.start,end:e.end,type:"CallExpression",callee:t(e.callee),arguments:e.arguments.map(t),source:e.source,astIndex:e.astIndex}},MemberExpression:function(e,t){return{start:e.start,end:e.end,type:"MemberExpression",object:t(e.object),property:t(e.property),computed:e.computed,source:e.source,astIndex:e.astIndex}},NewExpression:function(e,t){return{start:e.start,end:e.end,type:"NewExpression",callee:t(e.callee),arguments:e.arguments.map(t),source:e.source,astIndex:e.astIndex}},VariableDeclaration:function(e,t){return{start:e.start,end:e.end,type:"VariableDeclaration",declarations:e.declarations.map(t),kind:e.kind,source:e.source,astIndex:e.astIndex}},VariableDeclarator:function(e,t){return{start:e.start,end:e.end,type:"VariableDeclarator",id:t(e.id),init:t(e.init),source:e.source,astIndex:e.astIndex}},FunctionExpression:function(e,t){return{start:e.start,end:e.end,type:"FunctionExpression",id:t(e.id),params:e.params.map(t),body:t(e.body),source:e.source,astIndex:e.astIndex}},IfStatement:function(e,t){return{start:e.start,end:e.end,type:"IfStatement",test:t(e.test),consequent:t(e.consequent),alternate:t(e.alternate),source:e.source,astIndex:e.astIndex}},ConditionalExpression:function(e,t){return{start:e.start,end:e.end,type:"ConditionalExpression",test:t(e.test),consequent:t(e.consequent),alternate:t(e.alternate),source:e.source,astIndex:e.astIndex}},SwitchStatement:function(e,t){return{start:e.start,end:e.end,type:"SwitchStatement",discriminant:t(e.discriminant),cases:e.cases.map(t),source:e.source,astIndex:e.astIndex}},SwitchCase:function(e,t){return{start:e.start,end:e.end,type:"SwitchCase",test:t(e.test),consequent:e.consequent.map(t),source:e.source,astIndex:e.astIndex}},BreakStatement:function(e,t){return{start:e.start,end:e.end,type:"BreakStatement",label:e.label,source:e.source,astIndex:e.astIndex}},ContinueStatement:function(e,t){return{start:e.start,end:e.end,type:"ContinueStatement",label:e.label,source:e.source,astIndex:e.astIndex}},TryStatement:function(e,t){return{start:e.start,end:e.end,type:"TryStatement",block:t(e.block),handler:t(e.handler),finalizer:t(e.finalizer),guardedHandlers:e.guardedHandlers.map(t),source:e.source,astIndex:e.astIndex}},CatchClause:function(e,t){return{start:e.start,end:e.end,type:"CatchClause",param:t(e.param),guard:t(e.guard),body:t(e.body),source:e.source,astIndex:e.astIndex}},ThrowStatement:function(e,t){return{start:e.start,end:e.end,type:"ThrowStatement",argument:t(e.argument),source:e.source,astIndex:e.astIndex}},ForStatement:function(e,t){return{start:e.start,end:e.end,type:"ForStatement",init:t(e.init),test:t(e.test),update:t(e.update),body:t(e.body),source:e.source,astIndex:e.astIndex}},ForInStatement:function(e,t){return{start:e.start,end:e.end,type:"ForInStatement",left:t(e.left),right:t(e.right),body:t(e.body),source:e.source,astIndex:e.astIndex}},WhileStatement:function(e,t){return{start:e.start,end:e.end,type:"WhileStatement",test:t(e.test),body:t(e.body),source:e.source,astIndex:e.astIndex}},DoWhileStatement:function(e,t){return{start:e.start,end:e.end,type:"DoWhileStatement",test:t(e.test),body:t(e.body),source:e.source,astIndex:e.astIndex}},WithStatement:function(e,t){return{start:e.start,end:e.end,type:"WithStatement",object:t(e.object),body:t(e.body),source:e.source,astIndex:e.astIndex}},UnaryExpression:function(e,t){return{start:e.start,end:e.end,type:"UnaryExpression",argument:t(e.argument),operator:e.operator,prefix:e.prefix,source:e.source,astIndex:e.astIndex}},BinaryExpression:function(e,t){return{start:e.start,end:e.end,type:"BinaryExpression",left:t(e.left),operator:e.operator,right:t(e.right),source:e.source,astIndex:e.astIndex}},LogicalExpression:function(e,t){return{start:e.start,end:e.end,type:"LogicalExpression",left:t(e.left),operator:e.operator,right:t(e.right),source:e.source,astIndex:e.astIndex}},AssignmentExpression:function(e,t){return{start:e.start,end:e.end,type:"AssignmentExpression",left:t(e.left),operator:e.operator,right:t(e.right),source:e.source,astIndex:e.astIndex}},UpdateExpression:function(e,t){return{start:e.start,end:e.end,type:"UpdateExpression",argument:t(e.argument),operator:e.operator,prefix:e.prefix,source:e.source,astIndex:e.astIndex}},ReturnStatement:function(e,t){return{start:e.start,end:e.end,type:"ReturnStatement",argument:t(e.argument),source:e.source,astIndex:e.astIndex}},Identifier:function(e,t){return{start:e.start,end:e.end,type:"Identifier",name:e.name,source:e.source,astIndex:e.astIndex}},Literal:function(e,t){return{start:e.start,end:e.end,type:"Literal",value:e.value,raw:e.raw,source:e.source,astIndex:e.astIndex}},ObjectExpression:function(e,t){return{start:e.start,end:e.end,type:"ObjectExpression",properties:e.properties.map(function(e){return{key:t(e.key),value:t(e.value),kind:e.kind}}),source:e.source,astIndex:e.astIndex}},ArrayExpression:function(e,t){return{start:e.start,end:e.end,type:"ArrayExpression",elements:e.elements.map(t),source:e.source,astIndex:e.astIndex}},SequenceExpression:function(e,t){return{start:e.start,end:e.end,type:"SequenceExpression",expressions:e.expressions.map(t),source:e.source,astIndex:e.astIndex}},EmptyStatement:function(e,t){return{start:e.start,end:e.end,type:"EmptyStatement",source:e.source,astIndex:e.astIndex}},ThisExpression:function(e,t){return{start:e.start,end:e.end,type:"ThisExpression",source:e.source,astIndex:e.astIndex}},DebuggerStatement:function(e,t){return{start:e.start,end:e.end,type:"DebuggerStatement",source:e.source,astIndex:e.astIndex}},LabeledStatement:function(e,t){return{start:e.start,end:e.end,type:"LabeledStatement",label:e.label,body:t(e.body),source:e.source,astIndex:e.astIndex}}},r||{});return n(e)},ae.findSiblings=function(e,r,n){if(!r)return[];var i=a(e,r.start),o=i.indexOf(r),s=i.slice(0,o),u=t.arr.detect(s.reverse(),function(e){return Array.isArray(e.body)}).body;if(!n)return t.arr.without(u,r);var c=u.indexOf(r);return"before"===n?u.slice(0,c):u.slice(c+1)},ae.findNodeByAstIndex=function(e,t,r){r=null==r||!!r,!e.astIndex&&r&&u(e);var n=null;return de(e,null,function(e,r,i){n||r.astIndex<t||(r.astIndex!==t?e():n=r)}),n},ae.findStatementOfNode=function(e,r,n){n||(n=r,r=e,e=null),e||(e={}),r.astIndex||u(r);var i,o=!1,s=["EmptyStatement","BlockStatement","ExpressionStatement","IfStatement","LabeledStatement","BreakStatement","ContinueStatement","WithStatement","SwitchStatement","ReturnStatement","ThrowStatement","TryStatement","WhileStatement","DoWhileStatement","ForStatement","ForInStatement","DebuggerStatement","FunctionDeclaration","VariableDeclaration","ClassDeclaration"];return de(r,{},function(a,u,c,l){if(!(o||u.astIndex<n.astIndex)){if(u===n||u.astIndex===n.astIndex)if(o=!0,e.asPath)i=l;else{var f=t.Path(l);do{i=f.get(r),f=f.slice(0,f.size()-1)}while(-1==s.indexOf(i.type)&&f.size()>0)}!o&&a()}}),i},ae.addAstIndex=u,ae.visitors={stopAtFunctions:ae.make({Function:function(){}},ae.base),withMemberExpression:ae.make({MemberExpression:function(e,t,r){r(e.object,t,"Expression"),r(e.property,t,"Expression")}},ae.base)};var ce=function(e){function t(){return J(this,t),Z(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return X(t,i),K(t,[{key:"accept",value:function(e,r,n){return this.doFunc(e,r,n),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,r,n)}}],[{key:"run",value:function(e,t,r){var n=new this;return n.doFunc=t,n.accept(e,r,[]),r}}]),t}(),le=function(e){function t(){return J(this,t),Z(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return X(t,i),K(t,[{key:"accept",value:function(e,r,n){switch(e.type){case"ArrowFunctionExpression":case"FunctionExpression":return e;case"FunctionDeclaration":return r.unshift({node:e,path:n}),e;default:return Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,r,n)}}}],[{key:"run",value:function(e){var t=[];return(new this).accept(e,t,[]),t}}]),t}(),fe=Symbol("canBeInlined"),pe=function(e){function t(){return J(this,t),Z(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return X(t,i),K(t,[{key:"accept",value:function(e,r,n){return this.replacer(Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,r,n))}},{key:"visitBlockStatement",value:function(e,r,n){return c(Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitBlockStatement",this).call(this,e,r,n))}},{key:"visitProgram",value:function(e,r,n){return c(Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visitProgram",this).call(this,e,r,n))}}],[{key:"run",value:function(e,t){var r=new this;return r.replacer=t,r.accept(e,null,[])}}]),t}(),he=function(e){function t(){return J(this,t),Z(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return X(t,i),K(t,[{key:"accept",value:function(e,r,n){return this.replacer(Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,r,n),n)}}],[{key:"run",value:function(e,t){var r=new this;return r.replacer=t,r.accept(e,null,[])}}]),t}();acorn.walk.addSource=l;var de=function(e,t,r){var n=new i,o=n.accept;return n.accept=function(e,i,s){return t=r(function(){o.call(n,e,i,s)},e,i,s),e},n.accept(e,t,[]),t},me=function(e,r){var n,i,s=(r=r||{}).printSource||!1,a=r.printPositions||!1,u=r.printIndex||!1,c=[];return"string"==typeof e?(n=e,i=p(e)):(i=e,n=r.source||i.source),s&&!i.source&&(n||(i=p(n=o(i))),l(i,n)),(new ne).accept(i,{index:0,tree:c},[]),t.string.printTree(c[0],function(e){var r=e.path+":"+e.node.type,i=[];if(u&&i.push(e.index),a&&i.push(e.node.start+"-"+e.node.end),s){var o=e.node.source||n.slice(e.node.start,e.node.end),c=t.string.print(o.truncate(60).replace(/\n/g,"").replace(/\s+/g," "));i.push(c)}return i.length&&(r+="("+i.join(",")+")"),r},function(e){return e.children},"  ")},ve=function(e,t){if(!e||!t)throw new Error("node"+(e?"1":"2")+" not defined");var r={completePath:[],comparisons:{errors:[]}};return(new ie).accept(e,t,r,[]),r.comparisons.errors.length?r.comparisons.errors.pluck("msg"):null},ye=function(e,t,r){r=r||{},e.astIndex||u(e);var n=new i,o=null;return(n.accept=function(e,r,n,i){if(!o){var s=r.concat(i);if(e.astIndex===t){var a=s.map(function(e){return"string"==typeof e?"."+e:"["+e+"]"}).join("");o={pathString:a,path:s,node:e}}return this["visit"+e.type](e,s,n,i)}}).call(n,e,[],{},[]),o},ge=function(e,r,n,o){var s=p(r,(n=!!n)?{locations:!0}:void 0),a=new i;o&&(s=t.Path(o).get(s)),a.accept=function(t,r,i){var o=(i=i||[]).reduce(function(e,t){return e[t]},e);return o.start=t.start,o.end=t.end,n&&(o.loc=t.loc),this["visit"+t.type](t,r,i)},a.accept(s)},be=/[_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*$/,_e=Object.freeze({isIdentifier:h,id:d,literal:m,objectLiteral:function(e){for(var t=[],r=0;r<e.length;r+=2){var n=e[r];"string"==typeof n&&(n=d(n)),t.push(A(n,e[r+1]))}return{properties:t,type:"ObjectExpression"}},prop:A,exprStmt:v,returnStmt:y,empty:function(){return{type:"EmptyStatement"}},binaryExpr:function(e,t,r){return{left:e,right:r,operator:t,type:"BinaryExpression"}},funcExpr:g,funcCall:b,varDecl:_,member:x,memberChain:w,assign:function(e,t){return{type:"AssignmentExpression",operator:"=",right:t?"string"==typeof t?d(t):t:d("undefined"),left:"string"==typeof e?d(e):e}},block:k,program:E,tryStmt:S,ifStmt:function(e){return{consequent:arguments.length>1&&void 0!==arguments[1]?arguments[1]:k(),alternate:arguments.length>2&&void 0!==arguments[2]?arguments[2]:k(),test:e,type:"IfStatement"}},forIn:function(e,t,r){return{type:"ForInStatement",left:"string"==typeof e?_(e):e,right:"string"==typeof t?d(t):t,body:r}},conditional:function(e){return{consequent:arguments.length>1&&void 0!==arguments[1]?arguments[1]:d("undefined"),alternate:arguments.length>2&&void 0!==arguments[2]?arguments[2]:d("undefined"),test:e,type:"ConditionalExpression"}},logical:function(e,t,r){return{operator:e,left:t,right:r,type:"LogicalExpression"}}}),xe={declIds:function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];if(n)if("Identifier"===n.type)t.push(n);else if("RestElement"===n.type)t.push(n.argument);else if("AssignmentPattern"===n.type)t.push.apply(t,re(xe.declIds([n.left])));else if("ObjectPattern"===n.type)for(var i=0;i<n.properties.length;i++){var o=n.properties[i];t.push.apply(t,re(xe.declIds([o.value||o])))}else"ArrayPattern"===n.type&&t.push.apply(t,re(xe.declIds(n.elements)))}return t},varDecls:function(e){return t.arr.flatmap(e.varDecls,function(e){return t.arr.flatmap(e.declarations,function(e){return xe.declIds([e.id]).map(function(t){return[e,t]})})})},varDeclIds:function(e){return xe.declIds(e.varDecls.reduce(function(e,t){return e.push.apply(e,t.declarations),e},[]).map(function(e){return e.id}))},objPropertiesAsList:function(e,r,n){return t.arr.flatmap(e.properties,function(e){var i=e.key.name,o=[],s={key:r.concat([i]),value:e.value};switch(e.value.type){case"ArrayExpression":case"ArrayPattern":n||o.push(s),o=o.concat(t.arr.flatmap(e.value.elements,function(e,t){return xe.objPropertiesAsList(e,r.concat([i,t]),n)}));break;case"ObjectExpression":case"ObjectPattern":n||o.push(s),o=o.concat(xe.objPropertiesAsList(e.value,r.concat([i]),n));break;case"AssignmentPattern":n||o.push(s),o=o.concat(xe.objPropertiesAsList(e.left,r.concat([i]),n));break;default:o.push(s)}return o})},isDeclaration:function(e){return"FunctionDeclaration"===e.type||"VariableDeclaration"===e.type||"ClassDeclaration"===e.type}},we=["true","false","null","undefined","arguments","Object","Function","Array","Number","parseFloat","parseInt","Infinity","NaN","Boolean","String","Symbol","Date","Promise","RegExp","Error","EvalError","RangeError","ReferenceError","SyntaxError","TypeError","URIError","JSON","Math","console","ArrayBuffer","Uint8Array","Int8Array","Uint16Array","Int16Array","Uint32Array","Int32Array","Float32Array","Float64Array","Uint8ClampedArray","DataView","Map","Set","WeakMap","WeakSet","Proxy","Reflect","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","unescape","eval","isFinite","isNaN","Intl","navigator","window","document","Blob","setTimeout","clearTimeout","setInterval","clearInterval","requestAnimationFrame","cancelAnimationFrame","btoa","atob","sessionStorage","localStorage","$world","lively"],ke=["EmptyStatement","BlockStatement","ExpressionStatement","IfStatement","BreakStatement","ContinueStatement","WithStatement","ReturnStatement","ThrowStatement","TryStatement","WhileStatement","DoWhileStatement","ForStatement","ForInStatement","ForOfStatement","DebuggerStatement","FunctionDeclaration","VariableDeclaration","ClassDeclaration","ImportDeclaration","ImportDeclaration","ExportNamedDeclaration","ExportDefaultDeclaration","ExportAllDeclaration"],Ee=Object.freeze({helpers:xe,knownGlobals:we,scopes:D,nodesAtIndex:function(e,t){return de(e,[],function(e,r,n){return r.start<=t&&t<=r.end&&(n.push(r),e()),n})},scopesAtIndex:C,scopeAtIndex:function(e,r){return t.arr.last(C(e,r))},scopesAtPos:function(e,t){return I(e,t).filter(function(e){return"Program"===e.type||"FunctionDeclaration"===e.type||"FunctionExpression"===e.type})},nodesInScopeOf:function(e){return de(e,{root:e,result:[]},function(e,t,r){return r.result.push(t),t===r.root||"Program"!==t.type&&"FunctionDeclaration"!==t.type&&"FunctionExpression"!==t.type?(e(),r):r}).result},declarationsOfScope:F,_declaredVarNames:O,_findJsLintGlobalDeclarations:j,topLevelDeclsAndRefs:P,topLevelFuncDecls:R,findGlobalVarRefs:function(e,t){var r=P(e,t),n=r.declaredNames.concat(we);return r.refs.filter(function(e){return-1===n.indexOf(e.name)})},findNodesIncludingLines:function(e,r,n,i){if(!r&&!e)throw new Error("Need at least ast or code");return r=r||o(e),e=e&&e.loc?e:p(r,{locations:!0}),de(e,[],function(e,r,i){return n.every(function(e){return t.num.between(e,r.loc.start.line,r.loc.end.line)})&&(t.arr.pushIfNotIncluded(i,r),e()),i})},findReferencesAndDeclsInScope:function(e,r){function n(e){return e.params.concat(t.arr.pluck(e.funcDecls,"id")).concat(t.arr.pluck(e.classDecls,"id")).concat(xe.varDeclIds(e))}return"this"===r?e.thisRefs:t.arr.flatten(t.tree.map(e,function(e){return e.refs.concat(n(e)).filter(function(e){return e.name===r})},function(e){return e.subScopes.filter(function(e){return n(e).every(function(e){return e.name!==r})})}))},findDeclarationClosestToIndex:function(e,r,n){var i=null;return t.arr.detect(C(e,n).reverse(),function(e){var n=F(e,!0),o=t.arr.pluck(n,"name").indexOf(r);return-1!==o&&(i=n[o],!0)}),i},nodesAt:I,statementOf:L,resolveReferences:T,refWithDeclAt:function(e,t){var r=!0,n=!1,i=void 0;try{for(var o,s=t.resolvedRefMap.values()[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var a=o.value,u=a.ref,c=u.start,l=u.end;if(c<=e&&e<=l)return a}}catch(e){n=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}},imports:function(e){for(var t=[],r=e.node.body||[],n=0;n<r.length;n++){var i=r[n];if("ImportDeclaration"===i.type)if(0!==i.specifiers.length){var o=i.source?i.source.value:"unknown module";t.push.apply(t,re(i.specifiers.map(function(e){var t;return t="ImportNamespaceSpecifier"===e.type?"*":"ImportDefaultSpecifier"===e.type?"default":"ImportSpecifier"===e.type?e.imported.name:null,{local:e.local?e.local.name:null,imported:t,fromModule:o,node:i}})))}else t.push({local:null,imported:null,fromModule:i.source.value,node:i})}return t},exports:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&T(e);var r=e.exportDecls.reduce(function(t,r){var n=L(e.node,r);if(!n)return t;var i=n.source?n.source.value:null;if("ExportAllDeclaration"===n.type)return t.concat([{local:null,exported:"*",imported:"*",fromModule:i,node:r,type:"all"}]);if("ExportDefaultDeclaration"===n.type){if(xe.isDeclaration(n.declaration))return t.concat({local:n.declaration.id.name,exported:"default",type:"FunctionDeclaration"===n.declaration.type?"function":"ClassDeclaration"===n.declaration.type?"class":null,fromModule:null,node:r,decl:n.declaration,declId:n.declaration.id});if("Identifier"===n.declaration.type){var o=e.resolvedRefMap.get(n.declaration)||{},s=o.decl,a=o.declId;return t.concat([{local:n.declaration.name,exported:"default",fromModule:null,node:r,type:"id",decl:s,declId:a}])}return t.concat([{local:null,exported:"default",fromModule:null,node:r,type:"expr",decl:n.declaration,declId:n.declaration}])}return n.specifiers&&n.specifiers.length?t.concat(n.specifiers.map(function(t){var n,o;if(i)n=r,o=t.exported;else if(t.local){var s=e.resolvedRefMap.get(t.local);n=s?s.decl:null,o=s?s.declId:null}return{local:!i&&t.local?t.local.name:null,exported:t.exported?t.exported.name:null,imported:i&&t.local?t.local.name:null,fromModule:i||null,type:"id",node:r,decl:n,declId:o}})):n.declaration&&n.declaration.declarations?t.concat(n.declaration.declarations.map(function(e){return{local:e.id.name,exported:e.id.name,type:n.declaration.kind,fromModule:null,node:r,decl:e,declId:e.id}})):n.declaration?t.concat({local:n.declaration.id.name,exported:n.declaration.id.name,type:"FunctionDeclaration"===n.declaration.type?"function":"ClassDeclaration"===n.declaration.type?"class":null,fromModule:null,node:r,decl:n.declaration,declId:n.declaration.id}):t},[]);return t.arr.uniqBy(r,function(e,t){return e.local==t.local&&e.exported==t.exported&&e.fromModule==t.fromModule})}}),Se=function(e){function t(){return J(this,t),Z(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return X(t,i),K(t,[{key:"accept",value:function(e,r,n){return"ObjectExpression"===e.type&&(e=this.transformSpreadElement(e)),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,r,n)}},{key:"transformSpreadElement",value:function(e){var t=[],r=[t];return e.properties.forEach(function(e){"SpreadElement"!==e.type?t.push(e):(r.push(e),t=[],r.push(t))}),1===r.length?e:(t.length||r.pop(),b.apply(void 0,[x("Object","assign")].concat(re(r.map(function(e){return"SpreadElement"===e.type?e.argument:{properties:e,type:"ObjectExpression"}})))))}}]),t}(),Ae=/^\s*(\{|function\s*\()/,De=Object.freeze({replaceNode:q,replaceNodes:$,replace:function(e,t,r,n){var i="object"===(void 0===e?"undefined":H(e))?e:null;return q(t,r,"string"==typeof e?e:i.source||N(i))},_compareNodesForReplacement:M,oneDeclaratorPerVarDecl:function(e){var r="object"===(void 0===e?"undefined":H(e))?e:p(e),n="string"==typeof e?e:r.source||N(r);return $(function e(r){return t.arr.flatten(r.varDecls.concat(r.subScopes.map(e)))}(D(r)).map(function(e){return{target:e,replacementFunc:function(e,t,r){return r&&(e=p(t).body[0]),e.declarations.map(function(e){return{type:"VariableDeclaration",kind:"var",declarations:[e]}})}}}),n)},oneDeclaratorForVarsInDestructoring:function(e){var r="object"===(void 0===e?"undefined":H(e))?e:p(e),n="string"==typeof e?e:r.source||N(r);return $(function e(r){return t.arr.flatten(r.varDecls.concat(r.subScopes.map(e)))}(D(r)).map(function(e){return{target:e,replacementFunc:function(e,r,n){return n&&(e=p(r).body[0]),t.arr.flatmap(e.declarations,function(e){var r={type:"Identifier",name:"__temp"},n={type:"VariableDeclaration",kind:"var",declarations:[{type:"VariableDeclarator",id:r,init:e.init}]},i=xe.objPropertiesAsList(e.id,[],!1).map(function(e){return e.key}).map(function(e){return _(t.arr.last(e),w.apply(void 0,[r.name].concat(re(e))),"var")});return[n].concat(i)})}}}),n)},returnLastStatement:W,wrapInFunction:function(e,t){var r=W(e,t=t||{});return t.asAST?E(g.apply(void 0,[{id:t.id||void 0},[]].concat(re(r.body)))):"function"+(t.id?" "+t.id:"")+"() {\n"+r+"\n}"},wrapInStartEndCall:function(e,r){"string"==typeof e&&(e=p(e)),r=r||{};var n="Program"===e.type,i=r.startFuncNode||d("__start_execution"),o=r.endFuncNode||d("__end_execution"),s=R(e),a=e.body,u=[];s.forEach(function(r){var n=r.node,i=r.path;t.Path(i).set(e,v(n.id)),u.push(n)}),a.unshift(v(b(i)));var c=t.arr.last(a);return"ExpressionStatement"===c.type?(a.pop(),a.push(v(b(o,d("null"),c.expression)))):"VariableDeclaration"===c.type&&"Identifier"===t.arr.last(c.declarations).id.type?a.push(v(b(o,d("null"),t.arr.last(c.declarations).id))):a.push(v(b(o,d("null"),d("undefined")))),u.push(S.apply(void 0,["err",[v(b(o,d("err"),d("undefined")))]].concat(re(a)))),n?E.apply(void 0,u):k.apply(void 0,u)},transformSingleExpression:function(e){if(!Ae.test(e)||e.split("\n").length>30)return e;try{var t=f(e);1===t.body.length&&("FunctionDeclaration"===t.body[0].type||"BlockStatement"===t.body[0].type&&"LabeledStatement"===t.body[0].body[0].type)&&(e="("+e.replace(/;\s*$/,"")+")")}catch(e){"undefined"!=typeof $world?$world.logError(e):console.error("Eval preprocess error: %s",e.stack||e)}return e},objectSpreadTransform:function(e){return(new Se).accept(e,{},[])}}),Ce=Object.freeze({getCommentPrecedingNode:function(e,r){var n=L(e,r,{asPath:!0}).slice(0,-2),i=t.Path(n).get(e);return i.comments&&i.comments.length?t.chain(U(e)).reversed().detect(function(e){return e.followingNode===r}).value():null},extractComments:U}),Fe=Object.freeze({findDecls:z}),Oe=/^(?!(?:do|if|in|for|let|new|try|var|case|default|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc][$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc0-9\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u0669\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u06f0-\u06f9\u0711\u0730-\u074a\u07a6-\u07b0\u07c0-\u07c9\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09cb-\u09cd\u09d7\u09e2\u09e3\u09e6-\u09ef\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d3e-\u0d44\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0d62\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0e50-\u0e59\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102b-\u103e\u1040-\u1049\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4-\u17d3\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u18a9\u1920-\u192b\u1930-\u193b\u1946-\u194f\u19b0-\u19c0\u19c8\u19c9\u19d0-\u19d9\u1a17-\u1a1b\u1a55-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b00-\u1b04\u1b34-\u1b44\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1b82\u1ba1-\u1bad\u1bb0-\u1bb9\u1be6-\u1bf3\u1c24-\u1c37\u1c40-\u1c49\u1c50-\u1c59\u1cd0-\u1cd2\u1cd4-\u1ce8\u1ced\u1cf2-\u1cf4\u1dc0-\u1de6\u1dfc-\u1dff\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua620-\ua629\ua66f\ua674-\ua67d\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua823-\ua827\ua880\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f1\ua900-\ua909\ua926-\ua92d\ua947-\ua953\ua980-\ua983\ua9b3-\ua9c0\ua9d0-\ua9d9\uaa29-\uaa36\uaa43\uaa4c\uaa4d\uaa50-\uaa59\uaa7b\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaeb-\uaaef\uaaf5\uaaf6\uabe3-\uabea\uabec\uabed\uabf0-\uabf9\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f]*$/,je=p("").constructor;Object.defineProperty(je.prototype,"__serialize__",{configurable:!0,value:function(){return{__expr__:"("+JSON.stringify(this)+")"}}}),e.escodegen=se,e.acorn=acorn,e.query=Ee,e.transform=De,e.comments=Ce,e.categorizer=Fe,e.stringify=o,e.nodes=_e,e.isValidIdentifier=function(e){return Oe.test(e)},e.BaseVisitor=i,e.withMozillaAstDo=de,e.printAst=me,e.compareAst=ve,e.pathToNode=ye,e.rematchAstWithSource=ge,e.ReplaceManyVisitor=pe,e.ReplaceVisitor=he,e.parse=p,e.parseFunction=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=p("("+e+")",t);return ce.run(r,function(r,n,i){r._positionFixed||(r._positionFixed=!0,(r.start||0===r.start)&&(r.start+=-1,r.end+=-1),t.addSource&&!r.source&&(r.source=e.slice(r.start,r.end)))}),r.body[0].expression},e.fuzzyParse=f}(this.lively.ast=this.lively.ast||{},lively.lang,e.escodegen,acorn)}.call(e),"undefined"!=typeof module&&module.exports&&(module.exports=e.lively.ast),t&&(e.define=t)}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;void 0===lively.lang&&(e.livey.lang={})}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(e,t,r){"use strict";function n(e){if(function(e){return e.hasOwnProperty(x)}(e)){var r=i(e),n=r.properties,o=r.propertySettings;e[w]={properties:n,propertySettings:o},n&&"object"===(void 0===n?"undefined":h(n))?function(e,r,n){!function(e){Object.defineProperty(e.prototype,"propertiesAndPropertySettings",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.constructor;return e[w]||i(e)}}),Object.defineProperty(e.prototype,"initializeProperties",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var r=this.propertiesAndPropertySettings(),n=r.properties,i=r.propertySettings;return function(e,r,n,i){var o=r.valueStoreProperty,s=t.obj.sortKeysWithBeforeAndAfterConstraints(n),a=[],u={};e.hasOwnProperty(o)||(e[o]={});for(var c=0;c<s.length;c++){var l=s[c],f=n[l],p=f.derived,h=!!f.foldable,d=f.hasOwnProperty("defaultValue")?f.defaultValue:void 0;Array.isArray(d)&&(d=d.slice()),p||h||(e[o][l]=d);var m=void 0;f.hasOwnProperty("initialize")?(m=u[l]={initialize:d},a.push(l)):p&&void 0!==d?(m=u[l]={derived:d},a.push(l)):h&&void 0!==d&&(m=u[l]={folded:d},a.push(l)),i&&l in i&&(f.readOnly?console.warn("Trying to initialize read-only property "+l+" in "+e+", skipping setting value"):(m||(m=u[l]={},a.push(l)),m.value=i[l]))}for(var c=0;c<a.length;c++){var v=a[c],y=u[v],g=y.hasOwnProperty("value");if(y.hasOwnProperty("initialize")){var b=g?y.value:y.initialize;n[v].initialize.call(e,b),g&&(e[v]=y.value)}else y.hasOwnProperty("derived")?e[v]=g?y.value:y.derived:y.hasOwnProperty("folded")?e[v]=g?y.value:y.folded:g&&(e[v]=y.value)}}(this,i,n,e),this}})}(e);var o=r.valueStoreProperty,s=r.defaultGetter,a=r.defaultSetter,u=e.prototype;Object.keys(n).forEach(function(e){var t=n[e],r=u.hasOwnProperty(e)&&u.__lookupGetter__(e);if(!r){var i=t.get||"function"==typeof s&&function(){return s.call(this,e)}||function(){return this[o][e]};u.__defineGetter__(e,i)}var c=u.hasOwnProperty(e)&&u.__lookupSetter__(e);if(!c){var l=t.hasOwnProperty("set"),f=l||!t.readOnly;if(f){var p=t.set||"function"==typeof a&&function(t){a.call(this,e,t)}||function(t){this[o][e]=t};u.__defineSetter__(e,p)}}})}(e,o,n):console.warn("Class "+e.name+" indicates it has managed properties but its properties accessor ("+x+") does not return a valid property descriptor map")}}function i(e){for(var r=y({},k),n={},i=t.obj.valuesInPropertyHierarchy(e,"propertySettings"),o=t.obj.valuesInPropertyHierarchy(e,"properties"),s=0;s<i.length;s++){var a=i[s];a&&"object"===(void 0===a?"undefined":h(a))&&Object.assign(r,a)}for(s=0;s<o.length;s++){var u=o[s];if("object"===(void 0===u?"undefined":h(u)))for(var c in u)n.hasOwnProperty(c)?Object.assign(n[c],u[c]):n[c]=u[c];else console.error("[initializeProperties] "+e+" encountered property declaration that is not a JS object: "+u)}return{properties:n,propertySettings:r}}function o(e,t){var r=t?"function"==typeof t?t:t.value?t.value:Object:Object,n=e&&e[A];return n&&n===r||(!function(e){if(e===Object||e.prototype[E])return;Object.defineProperty(e.prototype,E,{enumerable:!1,configurable:!0,writable:!0,value:function(){e.apply(this,arguments)}}),e.prototype[E].displayName="lively-initialize-stub"}(r),e[A]=r,B(e.prototype,r.prototype),r!==Object&&B(e,r)),r}function s(e,t,r){if(r=Object.assign(r,R),r.value.displayName=r.key,r.needsDeclaringClass){var n=r.value.originalFunction||r.value;r.value=Object.assign(function(){return n.call.apply(n,[this,t].concat(Array.prototype.slice.call(arguments)))},{originalFunction:n,toString:function(){return n.toString()},displayName:r.key})}Object.defineProperty(e,r.key,r)}function a(e,t){t=Object.assign(t,j),Object.defineProperty(e,t.key,t)}function u(e,t,r){r&&r.forEach(function(t){t.value?s(e,e,t):a(e,t)}),t&&t.forEach(function(t){t.value?s(e.prototype,e,t):a(e.prototype,t)}),e.prototype[E]?Object.getOwnPropertySymbols(e.prototype).includes(E)&&e.prototype[E].isDefaultInitializer&&e[A].prototype[E]&&delete e.prototype[E]:(Object.defineProperty(e.prototype,E,{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),e.prototype[E].isDefaultInitializer=!0,e.prototype[E].displayName="lively-initialize");for(var n=t.map(function(e){return e.key}).concat(["constructor","arguments","caller"]),i=Object.getOwnPropertyNames(e.prototype),o=0;o<i.length;o++){var u=i[o];n.includes(u)||delete e.prototype[u]}for(var c=r.map(function(e){return e.key}).concat(["length","name","prototype","arguments","caller"]),l=Object.getOwnPropertyNames(e),f=0;f<l.length;f++){var p=l[f];c.includes(p)||delete e[p]}}function c(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments[5],c=arguments[6],l=e.name,f=l&&s.hasOwnProperty(l)&&s[l],p=f&&f[A];f&&"function"==typeof f&&p||(f=e);o(f,t);if(u(f,r,i),f[C]=c,a){var h=a.package(),d=f[D],m=Date.now();f[D]={package:h?{name:h.name,version:h.version}:{},pathInPackage:h?a.pathInPackage():a.id,lastChange:d&&d.lastChange&&m<=d.lastChange?d.lastChange+1:m,lastSuperclassChange:0},t&&t.referencedAs&&(f.hasOwnProperty(F)&&a.unsubscribeFromToplevelDefinitionChanges(f[F]),f[F]=a.subscribeToToplevelDefinitionChanges(function(e,s){if(e===t.referencedAs){var a=s&&s[D],c=f[D];if(a){if(a.lastChange===c.lastSuperclassChange)return;c.lastSuperclassChange=a.lastChange}o(f,s),u(f,r,i),n(f)}}))}return f.toString=function(){var e=String(this.prototype[E]).match(O),t=this.name,r=this[A];return"class "+t+" "+(r?"extends "+r.name:"")+" {\n  constructor"+(e?e[0]:"()")+" { /*...*/ }\n}"},n(f),f}function l(e){return U({id:e?L(e):null},["__first_arg__"],G(V(L("__first_arg__"),"&&",I("__first_arg__",M(I("Symbol","for"),q("lively-instance-restorer")),!0)),H(),H(N(M(I(I("this",M(I("Symbol","for"),q("lively-instance-initialize")),!0),"apply"),L("this"),L("arguments"))))))}function f(e,t,n,i){console.assert("Super"===e.type);var o=t.currentMethod;o||console.warn("[lively.classes] Trying to transform es6 class but got super call outside a method! "+r.stringify(e)+" in "+n.join("."));var s=n.slice(-2),a=b(s,2),u=a[0],c=a[1];if("callee"===u&&"object"===c||"callee"===c)return e;return o&&"static"===o[Y]?M(I("Object","getPrototypeOf"),L(X)):M(I("Object","getPrototypeOf"),I(L(X),"prototype"))}function p(e,t,n,i){console.assert("ClassDeclaration"===e.type||"ClassExpression"===e.type);var o=e.body.body,s=e.superClass,a=e.id,u=e.type,c=e.start,f=e.end,p=L("undefined"),h=L("undefined"),d=a?a.name:"anonymous_class",m=i.evalId,g=i.sourceAccessorName,_=e["x-lively-object-meta"]||{start:c,end:f};if(o.length){var x=o.reduce(function(e,t){var r,n=t.key,i=t.kind,o=t.value,s=t.static;if("Literal"!==n.type&&"Identifier"!==n.type&&console.warn("Unexpected key in classToFunctionTransform! "+JSON.stringify(n)),"method"===i){var a=L(d+"_"+function(e){return e.replace(J,"_").replace(K,"_")}(n.name||n.value)+"_"),u=["key",q(n.name||n.value),"value",y({},o,v({id:a},Y,s?"static":"proto"))];r=$(u)}else if("get"===i||"set"===i)r=$(["key",q(n.name||n.value),i,Object.assign({},o,v({id:L(i)},Y,s?"static":"proto"))]);else if("constructor"===i){var c=["key",M(I("Symbol","for"),q("lively-instance-initialize")),"value",y({},o,v({id:L(d+"_initialize_")},Y,"proto"))];r=$(c)}else console.warn("[lively.classes] classToFunctionTransform encountered unknown class property with kind "+i+", ignoring it, "+JSON.stringify(t));return(s?e.clazz:e.inst).push(r),e},{inst:[],clazz:[]}),w=x.inst,k=x.clazz;w.length&&(p={type:"ArrayExpression",elements:w}),k.length&&(h={type:"ArrayExpression",elements:k})}var E,S,A=i.scope;if(s&&i.currentModuleAccessor)if(i.classHolder===s.object)S=s,E=s.property.name;else{var D=A&&A.resolvedRefMap&&A.resolvedRefMap.get(s);D&&D.decl&&A.decls&&A.decls.find(function(e){return b(e,1)[0]===D.decl})&&(S=s,E=s.name)}var C=S?$(["referencedAs",q(E),"value",S]):s||L("undefined"),F=a&&"ClassDeclaration"===u,O=["start",q(_.start),"end",q(_.end)];void 0!==m&&O.push("evalId",q(m)),g&&O.push("moduleSource",r.nodes.id(g));var j=$(O),R=M(U({},["superclass"],W(Z,t.classHolder),W(X,F?{type:"ConditionalExpression",test:V(M(I(Z,"hasOwnProperty"),q(a.name)),"&&",V({argument:I(Z,a),operator:"typeof",prefix:!0,type:"UnaryExpression"},"===",q("function"))),consequent:I(Z,a),alternate:P(I(Z,a),l(a.name))}:l(a?a.name:null)),z(M(i.functionNode,L(X),L("superclass"),p,h,L(Z),i.currentModuleAccessor||L("undefined"),j))),C);if("ClassExpression"===u)return R;var B=R;return i.declarationWrapper&&t.classHolder===i.classHolder&&(B=M(i.declarationWrapper,q(a.name),q("class"),B,i.classHolder,j)),B=W(a,B,"var"),B[Q]=!0,B}var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},m=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),v=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},g=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},b=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},x="properties",w=Symbol.for("lively.classes-properties-and-settings"),k={defaultSetter:null,defaultGetter:null,valueStoreProperty:"_state"},E=Symbol.for("lively-instance-initialize"),S=Symbol.for("lively-instance-restorer"),A=Symbol.for("lively-instance-superclass"),D=Symbol.for("lively-module-meta"),C=Symbol.for("lively-object-meta"),F=Symbol.for("lively-klass-changes-subscriber"),O=/\([^\\)]*\)/,j={enumerable:!1,configurable:!0},R={enumerable:!1,configurable:!0,writable:!0},B="function"==typeof Object.setPrototypeOf?function(e,t){return Object.setPrototypeOf(e,t)}:function(e,t){return e.__proto__=t};c._get=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var s=i.get;return void 0===s?void 0:s.call(n)},c._set=function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var s=Object.getPrototypeOf(t);null!==s&&e(s,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var a=o.set;void 0!==a&&a.call(i,n)}return n};var T=Object.freeze({initializeSymbol:E,instanceRestorerSymbol:S,superclassSymbol:A,moduleMetaSymbol:D,objMetaSymbol:C,moduleSubscribeToToplevelChangesSym:F,setPrototypeOf:B,adoptObject:function(e,t){t!==e.constructor&&(e.constructor=t,B(e,t.prototype))},setSuperclass:o,initializeClass:c}),P=r.nodes.assign,I=r.nodes.member,L=r.nodes.id,N=r.nodes.exprStmt,M=r.nodes.funcCall,q=r.nodes.literal,$=r.nodes.objectLiteral,W=r.nodes.varDecl,U=r.nodes.funcExpr,z=r.nodes.returnStmt,V=r.nodes.binaryExpr,G=r.nodes.ifStmt,H=r.nodes.block,J=/^[^_a-z]/i,K=/[^_a-z0-9]/gi,Q=Symbol(),Y=Symbol(),X="__lively_class__",Z="__lively_classholder__",ee=function(e){function t(){return d(this,t),g(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.BaseVisitor),m(t,[{key:"accept",value:function(e,r,n){return function(e){return"ArrowFunctionExpression"===e.type||"FunctionExpression"===e.type||"FunctionDeclaration"===e.type}(e)&&(r=y({},r,{classHolder:$([]),currentMethod:e[Y]?e:r.currentMethod})),"ClassExpression"!==e.type&&"ClassDeclaration"!==e.type||(e=p(e,r,0,r.options)),"Super"===e.type&&(e=f(e,r,n,r.options)),"MemberExpression"===e.type&&e.object&&"Super"===e.object.type&&(e=function(e,t,r,n){return console.assert("MemberExpression"===e.type),console.assert("Super"===e.object.type),M(I(n.functionNode,"_get"),f(e.object,t,r.concat(["object"])),q(e.property.value||e.property.name),L("this"))}(e,r,n,r.options)),"AssignmentExpression"===e.type&&"MemberExpression"===e.left.type&&"Super"===e.left.object.type&&(e=function(e,t,r,n){return console.assert("AssignmentExpression"===e.type),console.assert("Super"===e.left.object.type),M(I(n.functionNode,"_set"),f(e.left.object,t,r.concat(["left","object"])),q(e.left.property.value||e.left.property.name),e.right,L("this"))}(e,r,n,r.options)),"CallExpression"===e.type&&"Super"===e.callee.type&&(e=function(e,t,r,n){return console.assert("CallExpression"===e.type),console.assert("Super"===e.callee.type),M.apply(void 0,[I(M(I(n.functionNode,"_get"),f(e.callee,t,r.concat(["callee"])),M(I("Symbol","for"),q("lively-instance-initialize")),L("this")),"call"),L("this")].concat(_(e.arguments)))}(e,r,n,r.options)),"CallExpression"===e.type&&e.callee.object&&"Super"===e.callee.object.type&&(e=function(e,t,r,n){return console.assert("CallExpression"===e.type),console.assert("Super"===e.callee.object.type),M.apply(void 0,[I(M(I(n.functionNode,"_get"),f(e.callee.object,t,r.concat(["callee","object"])),q(e.callee.property.value||e.callee.property.name),L("this")),"call"),L("this")].concat(_(e.arguments)))}(e,r,n,r.options)),"ExportDefaultDeclaration"===(e=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(n)}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"accept",this).call(this,e,r,n)).type?function(e,t,r,n){return e.declaration&&e.declaration[Q]?[e.declaration,{declaration:e.declaration.declarations[0].id,type:"ExportDefaultDeclaration"}]:e}(e,0,0,r.options):e}}],[{key:"run",value:function(e,t){var r=new this,n=t.classHolder||$([]);return r.accept(e,{options:t,classHolder:n},[])}}]),t}();e.runtime=T,e.classToFunctionTransform=function(e,t){var n="string"==typeof e?r.parse(e):e;return t.scope=r.query.resolveReferences(r.query.scopes(n)),ee.run(n,t)}}(this.lively.classes=this.lively.classes||{},lively.lang,lively.ast),"undefined"!=typeof module&&module.exports&&(module.exports=e.lively.classes)}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;void 0===lively.lang&&(e.livey.lang={})}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(e,t,r,n){"use strict";function i(e,t){for(var r=t,n=1;e.indexOf(r)>-1;){if(n>1e3)throw new Error("Endless loop searching for unique variable "+r);r=r.replace(/_[0-9]+$|$/,"_"+ ++n)}return r}function o(e,t){return-1===t.excludeDecls.indexOf(e.id.name)&&(!t.includeDecls||t.includeDecls.indexOf(e.id.name)>-1)}function s(e,t){return"ArrayPattern"===e.type?function(e,t){for(var r=t.declaredNames,n=C,o=[],a=0;a<e.elements.length;a++){var u=e.elements[a];if("Identifier"===u.type){var c=g(u,v(t.parent,_(a),!0));c[n]={capture:!0},o.push(c)}else if("RestElement"===u.type){var c=g(u.argument,{type:"CallExpression",arguments:[{type:"Literal",value:a}],callee:v(t.parent,_("slice"),!1)});c[n]={capture:!0},o.push(c)}else if("AssignmentPattern"==u.type){var c=g(u.left,k(E(v(t.parent,_(a),!0),"===",_("undefined")),u.right,v(t.parent,_(a),!0)));c[n]={capture:!0},o.push(c)}else{var l=_(i(r,t.parent.name+"$"+a)),f=g(l,v(t.parent,a));r.push(l.name),o.push(f),o.push.apply(o,m(s(u,{parent:l,declaredNames:r})))}}return o}(e,t):"ObjectPattern"===e.type?function(e,t){for(var r=t.declaredNames,n=C,o=[],a=0;a<e.properties.length;a++){var u=e.properties[a];if("Identifier"==u.value.type){var c=g(u.value,v(t.parent,u.key));c[n]={capture:!0},o.push(c)}else if("AssignmentPattern"==u.value.type){var c=g(u.value.left,k(E(v(t.parent,u.key),"===",_("undefined")),u.value.right,v(t.parent,u.key)));c[n]={capture:!0},o.push(c)}else{var l=_(i(r,t.parent.name+"$"+u.key.name)),f=g(l,v(t.parent,u.key));f[n]={capture:!1},r.push(l.name),o.push.apply(o,m([f].concat(s(u.value,{parent:l,declaredNames:r}))))}}return o}(e,t):[]}function a(e,t,r){var n=A(e),i=t.id.name;return n.declaredNames.indexOf(i)>-1?w(b(t.id,t.init)):{declarations:[t],kind:r||"var",type:"VariableDeclaration"}}function u(e,t,r,n){return w(b(v(e,t,n),r||_("undefined")))}function c(e,t,r,n,i){return f(n,e,l(t,r,i))}function l(e,t,r){return"string"==typeof e&&(e=x(e)),{arguments:[t].concat(e||[]),callee:r,type:"CallExpression"}}function f(e,r,n){return"string"==typeof r&&(r=x(r)),n=t.obj.deepCopy(n),S(e,r,n)}function p(e,t,r){return w(f(e,t,r))}function h(e,t,r,i,o,s,a){if(t){var u=[],c=!1;if(t["x-lively-object-meta"]){var l=t["x-lively-object-meta"],f=l.start,p=l.end,h=l.evalId,d=l.sourceAccessorName;c=!0,u.push("start",n.nodes.literal(f),"end",n.nodes.literal(p))}if(void 0===h&&a.hasOwnProperty("evalId")&&(h=a.evalId,c=!0),void 0===d&&a.hasOwnProperty("sourceAccessorName")&&(d=a.sourceAccessorName,c=!0),void 0!==h&&u.push("evalId",n.nodes.literal(h)),d&&u.push("moduleSource",n.nodes.id(d)),c)return S(e,r,i,o,s,n.nodes.objectLiteral(u))}return S(e,r,i,o,s)}var d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},m=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},v=n.nodes.member,y=n.nodes.prop,g=n.nodes.varDecl,b=n.nodes.assign,_=n.nodes.id,x=n.nodes.literal,w=n.nodes.exprStmt,k=n.nodes.conditional,E=n.nodes.binaryExpr,S=n.nodes.funcCall,A=n.query.topLevelDeclsAndRefs,D=n.query.helpers,C=Symbol("lively.ast-destructuring-transform"),F=Object.freeze({rewriteToCaptureTopLevelVariables:function(e,f,b){f||(f={type:"Identifier",name:"__rec"});var k=e;if((b=d({ignoreUndeclaredExcept:null,includeRefs:null,excludeRefs:b&&b.exclude||[],includeDecls:null,excludeDecls:b&&b.exclude||[],recordDefRanges:!1,es6ExportFuncId:null,es6ImportFuncId:null,captureObj:f,moduleExportFunc:{name:b&&b.es6ExportFuncId||"_moduleExport",type:"Identifier"},moduleImportFunc:{name:b&&b.es6ImportFuncId||"_moduleImport",type:"Identifier"},declarationWrapper:void 0,classToFunction:b&&b.hasOwnProperty("classToFunction")?b.classToFunction:{classHolder:f,functionNode:{type:"Identifier",name:"_createOrExtendClass"},declarationWrapper:b&&b.declarationWrapper,evalId:b&&b.evalId,sourceAccessorName:b&&b.sourceAccessorName}},b)).ignoreUndeclaredExcept){var E=A(e);b.excludeRefs=t.arr.withoutAll(E.undeclaredNames,b.ignoreUndeclaredExcept).concat(b.excludeRefs),b.excludeDecls=t.arr.withoutAll(E.undeclaredNames,b.ignoreUndeclaredExcept).concat(b.excludeDecls)}return b.excludeRefs=b.excludeRefs.concat(b.captureObj.name),b.excludeDecls=b.excludeDecls.concat(b.captureObj.name),b.recordDefRanges&&function(e,r){var n=A(e);t.chain(n.scope.varDecls).pluck("declarations").flatten().value().concat(n.scope.funcDecls).reduce(function(e,t){return e[t.id.name]||(e[t.id.name]=[]),e[t.id.name].push({type:t.type,start:t.start,end:t.end}),e},{})}(k),b.excludeRefs=b.excludeRefs.concat(function(e,r){for(var n=A(e),i=[],o=0;o<n.scope.varDecls.length;o++){var s=n.scope.varDecls[o],a=t.Path(n.scope.varDeclPaths[o]),u=a.slice(0,-1).get(e);"ForStatement"!==u.type&&"ForInStatement"!==u.type&&"ForOfStatement"!==u.type||i.push.apply(i,m(s.declarations))}return n.scope.catches.map(function(e){return e.name}).concat(D.declIds(i.map(function(e){return e.id})).map(function(e){return e.name}))}(e)),b.excludeDecls=b.excludeDecls.concat(function(e,r){for(var n=A(e),i=[],o=0;o<n.scope.varDecls.length;o++){var s=n.scope.varDecls[o],a=t.Path(n.scope.varDeclPaths[o]),u=a.slice(0,-1).get(e);"ForStatement"!==u.type&&"ForInStatement"!==u.type&&"ForOfStatement"!==u.type&&"ExportNamedDeclaration"!==u.type||i.push.apply(i,m(s.declarations))}return n.scope.catches.map(function(e){return e.name}).concat(i.map(function(e){return e.id.name}))}(e)),k=function(e,t){for(var r=[],n=0;n<e.body.length;n++){var i=e.body[n];"ExportDefaultDeclaration"===i.type&&"FunctionDeclaration"===i.declaration.type&&i.declaration.id&&i.declaration.async&&(r.push(i.declaration),i.declaration={type:"Identifier",name:i.declaration.id.name}),r.push(i)}return e.body=r,e}(k),b.es6ExportFuncId&&(b.excludeRefs.push(b.es6ExportFuncId),b.excludeRefs.push(b.es6ImportFuncId),k=function(e,t){return e.body=e.body.reduce(function(e,r){var n;if("ExportNamedDeclaration"===r.type)if(r.source){var i=a=r.source;n=r.specifiers.map(function(e){return{type:"ExpressionStatement",expression:c({type:"Literal",value:e.exported.name},{type:"Literal",value:e.local.name},a,t.moduleExportFunc,t.moduleImportFunc)}})}else if(r.declaration){var s=r.declaration.declarations;n=s?s.map(function(e){return t.excludeDecls.push(e.id),g(e.id,u(t.captureObj,e.id,t.declarationWrapper?h(t.declarationWrapper,null,x(e.id.name),x(r.declaration.kind),e,t.captureObj,t):e.init,!1),r.declaration.kind)}).concat(s.map(function(e){return p(t.moduleExportFunc,e.id.name,e.id)})):[r.declaration].concat(p(t.moduleExportFunc,r.declaration.id.name,r.declaration.id))}else n=r.specifiers.map(function(e){return p(t.moduleExportFunc,e.exported.name,o({id:e.local},t)?v(t.captureObj,e.local):e.local)});else if("ExportDefaultDeclaration"===r.type)n=r.declaration&&r.declaration.id?[r.declaration].concat(p(t.moduleExportFunc,"default",r.declaration.id)):[p(t.moduleExportFunc,"default",r.declaration)];else if("ExportAllDeclaration"===r.type){i={name:t.es6ExportFuncId+"__iterator__",type:"Identifier"};var a=r.source;n=[{type:"ForInStatement",body:{type:"ExpressionStatement",expression:c(i,i,a,t.moduleExportFunc,t.moduleImportFunc)},left:{type:"VariableDeclaration",kind:"var",declarations:[{type:"VariableDeclarator",id:i,init:null}]},right:l(null,a,t.moduleImportFunc)}],t.excludeRefs.push(i.name),t.excludeDecls.push(i.name)}else n="ImportDeclaration"===r.type?r.specifiers.length?r.specifiers.map(function(e){return function(e,t,r,n,i){return g(t,l(r,n,i))}(0,e.local,"ImportSpecifier"===e.type&&e.imported.name||"ImportDefaultSpecifier"===e.type&&"default"||null,r.source,t.moduleImportFunc)}):function(e,t,r){return w(l(e,t,r))}(null,r.source,t.moduleImportFunc):[r];return e.concat(n)},[]),e}(k,b)),k=function(e,t){var r=A(e),i=r.refs.filter(function(e){return function(e,t,r){if(t.scope.importSpecifiers.includes(e))return!1;for(var n=0;n<t.scope.exportDecls.length;n++){var i=t.scope.exportDecls[n];if(i.declarations&&i.declarations.includes(e))return!1;if(i.declaration===e)return!1}return!(r.excludeRefs.includes(e.name)||r.includeRefs&&!r.includeRefs.includes(e.name))}(e,r,t)}),o=[],s=n.ReplaceVisitor.run(e,function(e,r){if("Property"===e.type&&i.includes(e.key)&&e.shorthand)return y(_(e.key.name),e.value);if("ExportNamedDeclaration"===e.type){var n=e.declaration,s=e.specifiers;return n&&(n.id?o.push(n.id):n.declarations&&o.push.apply(o,m(n.declarations.map(function(e){var t=e.id;return t})))),s&&s.forEach(function(e){var t=e.local;return o.push(t)}),e}return"AssignmentExpression"===e.type&&i.includes(e.left)&&t.declarationWrapper?d({},e,{right:h(t.declarationWrapper,null,x(e.left.name),x("assignment"),e.right,t.captureObj,t)}):e});return n.ReplaceVisitor.run(s,function(e,r,n){return i.includes(e)&&!o.includes(e)?v(t.captureObj,e):e})}(k,b),k=function(e,t){var r=A(e);return n.ReplaceManyVisitor.run(e,function(e){if(!r.varDecls.includes(e)||e.declarations.every(function(e){return!o(e,t)}))return e;for(var n=[],a=0;a<e.declarations.length;a++){var c=e.declarations[a];if(o(c,t)){var l=c.init||{operator:"||",type:"LogicalExpression",left:{computed:!1,object:t.captureObj,property:c.id,type:"MemberExpression"},right:{name:"undefined",type:"Identifier"}},f=t.declarationWrapper&&c.id.name?h(t.declarationWrapper,c,x(c.id.name),x(e.kind),l,t.captureObj,t):l;if(c.id.type.includes("Pattern")){var p=i(r.declaredNames,"destructured_1"),d={type:"Identifier",name:p},v={parent:d,declaredNames:r.declaredNames},y=s(c.id,v).map(function(r){return r[C]&&r[C].capture?u(t.captureObj,r.declarations[0].id,t.declarationWrapper?h(t.declarationWrapper,null,x(r.declarations[0].id.name),x(e.kind),r.declarations[0].init,t.captureObj,t):r.declarations[0].init,!1):r});r.declaredNames.push(p),n.push.apply(n,m([g(d,f,e.kind)].concat(y)))}else n.push(u(t.captureObj,c.id,f,!1))}else n.push({type:"VariableDeclaration",kind:e.kind||"var",declarations:[c]})}return n})}(k,b),k=function(e,t){if(t.classToFunction)return r.classToFunctionTransform(e,t.classToFunction);var n=A(e);if(!n.classDecls.length)return e;for(var i=e.body.length-1;i>=0;i--){var o=e.body[i];n.classDecls.includes(o)&&e.body.splice(i+1,0,u(t.captureObj,o.id,o.id,!1))}return e}(k,b),k=function(e,t){for(var r=e.body,n=e.body=[],i=0;i<r.length;i++){var o=r[i];if("ExportNamedDeclaration"!==o.type||!o.declaration||"VariableDeclaration"!==o.declaration.type||o.declaration.declarations.length<=1)n.push(o);else for(var s=o.declaration.declarations,a=0;a<s.length;a++)n.push({type:"ExportNamedDeclaration",specifiers:[],declaration:g(s[a].id,s[a].init,o.declaration.kind)})}return e}(k),k=function(e,t){for(var r=[],n=0;n<e.body.length;n++){var i=e.body[n];r.push(i),"ExportNamedDeclaration"!==i.type&&"ExportDefaultDeclaration"!==i.type||!i.declaration||(i.declaration.declarations?r.push.apply(r,m(i.declaration.declarations.map(function(e){var r=e.id;if(t.declarationWrapper){var n=e.init.callee&&e.init.callee.name===t.declarationWrapper.name;n||(r=h(t.declarationWrapper,e,x(e.id.name),x("assignment"),e.id,t.captureObj,t))}return u(t.captureObj,e.id,r,!1)}))):"FunctionDeclaration"===i.declaration.type||"ClassDeclaration"===i.declaration.type&&r.push(u(t.captureObj,i.declaration.id,i.declaration.id,!1)))}return e.body=r,e}(k,b),k=function(e,t){return e.body=e.body.reduce(function(e,r){return e.concat("ImportDeclaration"===r.type&&r.specifiers.length?[r].concat(r.specifiers.map(function(e){return u(t.captureObj,e.local,e.local,!1)})):[r])},[]),e}(k,b),k=function(e,r){for(var n=A(e),i=[],o=0;o<e.body.length;o++){var s=e.body[o];"ExportDefaultDeclaration"===s.type&&s.declaration&&-1===s.declaration.type.indexOf("Declaration")?i=i.concat([a(e,{type:"VariableDeclarator",id:s.declaration,init:v(r.captureObj,s.declaration)}),s]):"ExportNamedDeclaration"!==s.type||!s.specifiers.length||s.source?i.push(s):i=i.concat(s.specifiers.map(function(i){return t.arr.include(n.declaredNames,i.local.name)?null:a(e,{type:"VariableDeclarator",id:i.local,init:v(r.captureObj,i.local)})}).filter(Boolean)).concat(s)}return e.body=i,e}(k,b),k=function(e,r){var n=A(e).scope,i=n.funcDecls;if(!i.length)return e;for(var s=[],a=i.length;a--;){var c=i[a];if(o(c,r)){var l=n.funcDeclPaths[a].slice(0,-1),f=t.Path(l).get(n.node),p={type:"Identifier",name:c.id.name},m=r.declarationWrapper?h(r.declarationWrapper,c,x(p.name),x("function"),p,r.captureObj,r):p,v=d({},c);if(Array.isArray(f))f.splice(f.indexOf(c),1,w(c.id));else if("ExportNamedDeclaration"===f.type){var y=n.node.body.indexOf(f);y>-1&&n.node.body.splice(y,1,{type:"ExportNamedDeclaration",specifiers:[{type:"ExportSpecifier",exported:c.id,local:c.id}]})}else"ExportDefaultDeclaration"===f.type&&(f.declaration=c.id);s.unshift(u(r.captureObj,p,m,!1)),s.unshift(v)}}return e.body=s.concat(e.body),e}(k,b)},rewriteToRegisterModuleToCaptureSetters:function(e,r,i){i=d({captureObj:r||{type:"Identifier",name:"__rec"},exclude:[],declarationWrapper:void 0},i);var o=t.Path("body.0.expression").get(e);if("System"!==o.callee.object.name)throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call: "+n.stringify(e).slice(0,300)+"...");if("register"!==o.callee.property.name)throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call: "+n.stringify(e).slice(0,300)+"...");var s=t.Path("arguments.1.body.body").get(o),a=t.arr.last(s);if("ReturnStatement"!==a.type)throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call, at return statement: "+n.stringify(e).slice(0,300)+"...");var u=a.argument.properties.find(function(e){return"setters"===e.key.name});if(!u)throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call, at finding setters: "+n.stringify(e).slice(0,300)+"...");var c=a.argument.properties.find(function(e){return"execute"===e.key.name});if(!c)throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call, at finding execute: "+n.stringify(e).slice(0,300)+"...");u.value.elements.forEach(function(e){return e.body.body=e.body.body.map(function(e){if("ExpressionStatement"!==e.type||"AssignmentExpression"!==e.expression.type||"Identifier"!==e.expression.left.type||t.arr.include(i.exclude,e.expression.left.name))return e;var r=e.expression.left,n=i.declarationWrapper?h(i.declarationWrapper,null,x(r.name),x("var"),e.expression,i.captureObj,i):e.expression;return w(b(v(i.captureObj,r),n))})});var l=c.value.body.body.find(function(e){return"ExpressionStatement"===e.type&&"AssignmentExpression"==e.expression.type&&e.expression.left.name===i.captureObj.name});if(l||(l=c.value.body.body.find(function(e){return"VariableDeclaration"===e.type&&e.declarations[0].id&&e.declarations[0].id.name===i.captureObj.name})),l&&(t.arr.remove(c.value.body.body,l),t.arr.pushAt(s,l,s.length-1)),i.sourceAccessorName){var f=c.value.body.body.find(function(e){return"ExpressionStatement"===e.type&&"AssignmentExpression"==e.expression.type&&e.expression.left.name===i.sourceAccessorName});f||(f=c.value.body.body.find(function(e){return"VariableDeclaration"===e.type&&e.declarations[0].id&&e.declarations[0].id.name===i.sourceAccessorName})),f&&(t.arr.remove(c.value.body.body,f),t.arr.pushAt(s,f,s.length-1))}return e}});e.capturing=F,e.stringifyFunctionWithoutToplevelRecorder=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"__lvVarRecorder";"function"==typeof e&&(e=String(e));var r="string"==typeof e?n.parseFunction(e):e,i=n.ReplaceVisitor.run(r,function(e){return"MemberExpression"===e.type&&"Identifier"===e.object.type&&e.object.name===t?e.property:e});return n.stringify(i)}}(this.lively.sourceTransform=this.lively.sourceTransform||{},lively.lang,lively.classes,lively.ast),"undefined"!=typeof module&&module.exports&&(module.exports=e.lively.sourceTransform)}(),function(){var GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(exports,lively_lang,lively_ast,lively_sourceTransform,lively_classes,lively_notifications){"use strict";function getGlobal(){return"undefined"!=typeof System?System.global:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof Global?Global:"undefined"!=typeof self?self:function(){return this}()}function signatureOf(e,t){var r=String(t).match(/function\s*[a-zA-Z0-9_$]*\s*\(([^\)]*)\)/);return e+"("+(r&&r[1]||"")+")"}function pluck(e,t){return e.map(function(e){return e[t]})}function printSymbol(e){if(Symbol.keyFor(e))return'Symbol.for("'+Symbol.keyFor(e)+'")';if(knownSymbols.get(e))return knownSymbols.get(e);String(e).match(symMatcher);return String(e)}function safeToString(e){if(!e)return String(e);if(Array.isArray(e))return"["+e.map(safeToString).join(",")+"]";if("symbol"===(void 0===e?"undefined":_typeof(e)))return printSymbol(e);try{return String(e)}catch(e){throw new Error("Cannot print object: "+e.stack)}}function printEvalResult(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.value,n=e.isError,i=e.isPromise,o=e.promisedValue,s=e.promiseStatus;if(n||r instanceof Error){var a=r,u=String(a),c=a.stack||"";if(c&&a.message!==a.stack){0===(c=String(c)).indexOf(u)&&(c=c.slice(u.length)),u+="\n"+c}return u}if(i){var l=lively_lang.string.print(s),f="pending"===s?void 0:printEvalResult({value:o},t);return"Promise({status: "+l+", "+(void 0===r?"":"value: "+f)+"})"}return r instanceof Promise?'Promise({status: "unknown"})':t.inspect?printInspectEvalValue(r,t.inspectDepth||2):String(r)}function getObjectForCompletion(e,t){var r="";return Promise.resolve().then(function(){var n=t.lastIndexOf(".");return n>=0?(r=t.slice(n+1),t=t.slice(0,n)):(r=t,t='(typeof window === "undefined" ? global : window)'),e(t)}).then(function(e){return{evalResult:e,startLetters:r,code:t}})}function propertyExtract(e,t,r){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t).map(printSymbol)).filter(function(t){return-1===e.indexOf(t)}).map(r).filter(function(e){return!!e}).sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})}function getMethodsOf(e,t){return propertyExtract(e,t,function(e){return t.__lookupGetter__&&t.__lookupGetter__(e)||"function"!=typeof t[e]?null:{name:e,completion:signatureOf(e,t[e])}})}function getAttributesOf(e,t){return propertyExtract(e,t,function(e){return t.__lookupGetter__&&!t.__lookupGetter__(e)&&"function"==typeof t[e]?null:{name:e,completion:e}})}function getProtoChain(e){for(var t=[];e;)t.push(e),e=e.__proto__;return t}function getDescriptorOf(e,t){function r(e,t){return e.length>t&&(e=e.slice(0,t)+"..."),e.replace(/\n/g,"").replace(/\s+/g," ")}if(e===t){if("function"!=typeof e)return r(safeToString(e),50);var n=e.toString(),i=r(n.slice(n.indexOf("{")+1,n.lastIndexOf("}")),50);return signatureOf(e.displayName||e.name||"function",e)+" {"+i+"}"}var o=t.hasOwnProperty("constructor")&&t.constructor;return o?"string"==typeof o.type&&o.type.length?r(o.type,50):"string"==typeof o.name&&o.name.length?r(o.name,50):"anonymous class":"prototype"}function descriptorsOfObjAndProtoProperties(e){var t=[];return getProtoChain(e).map(function(r){var n=getDescriptorOf(e,r),i=getMethodsOf(t,r).concat(getAttributesOf(t,r));return t=t.concat(pluck(i,"name")),[n,pluck(i,"completion")]})}function getCompletions(e,t,r){var n=getObjectForCompletion(e,t).then(function(e){var t=e.evalResult,r={completions:descriptorsOfObjAndProtoProperties(t&&t.isEvalResult?t.value:t),startLetters:e.startLetters,code:e.code};return t&&t.isPromise&&("fulfilled"===t.promiseStatus?r.promiseResolvedCompletions=descriptorsOfObjAndProtoProperties(t.promisedValue):"rejected"===t.promiseStatus&&(r.promiseRejectedCompletions=descriptorsOfObjAndProtoProperties(t.promisedValue))),r});return"function"==typeof r&&n.then(function(e){return r(null,e)}).catch(function(e){return r(e)}),n}function processInlineCodeTransformOptions(parsed,options){if(!parsed.comments)return options;var livelyComment=parsed.comments.find(function(e){return e.text.startsWith("lively.vm ")});if(!livelyComment)return options;try{var inlineOptions=eval("inlineOptions = {"+livelyComment.text.slice("lively.vm ".length)+"};");return Object.assign(options,inlineOptions)}catch(e){return options}}function evalCodeTransform(e,t){e=lively_ast.transform.transformSingleExpression(e);var r=lively_ast.parse(e,{withComments:!0});t=processInlineCodeTransformOptions(r,t);var n=lively_ast.query.topLevelDeclsAndRefs(r),i=n.classDecls,o=n.funcDecls,s=n.varDecls,a={};if(t.hasOwnProperty("evalId")&&(a.evalId=t.evalId),t.sourceAccessorName&&(a.sourceAccessorName=t.sourceAccessorName),[].concat(toConsumableArray(i),toConsumableArray(o)).forEach(function(e){return e["x-lively-object-meta"]=_extends({},a,{start:e.start,end:e.end})}),s.forEach(function(e){return e.declarations.forEach(function(e){return e["x-lively-object-meta"]=_extends({},a,{start:e.start,end:e.end})})}),r=lively_ast.transform.objectSpreadTransform(r),!t.topLevelVarRecorder&&t.topLevelVarRecorderName){var u=getGlobal();"GLOBAL"===t.topLevelVarRecorderName?t.topLevelVarRecorder=getGlobal():t.topLevelVarRecorder=lively_lang.Path(t.topLevelVarRecorderName).get(u)}if(t.topLevelVarRecorder){var c=(t.dontTransform||[]).concat(["arguments"]),l=t.recordGlobals?null:lively_lang.arr.withoutAll(Object.keys(t.topLevelVarRecorder),c),f=id(t.varRecorderName||"__lvVarRecorder"),p=void 0;if(t.declarationWrapperName||"function"==typeof t.declarationCallback){var h=t.declarationWrapperName||defaultDeclarationWrapperName;t.declarationWrapper=member(id(t.varRecorderName||"__lvVarRecorder"),literal(h),!0),t.declarationCallback&&(t.topLevelVarRecorder[h]=t.declarationCallback)}(!t.hasOwnProperty("transformES6Classes")||t.transformES6Classes)&&(defaultClassToFunctionConverterName in t.topLevelVarRecorder||(t.topLevelVarRecorder[defaultClassToFunctionConverterName]=lively_classes.runtime.initializeClass),p={currentModuleAccessor:t.currentModuleAccessor,classHolder:f,functionNode:member(f,defaultClassToFunctionConverterName),declarationWrapper:t.declarationWrapper,evalId:t.evalId,sourceAccessorName:t.sourceAccessorName}),r=lively_sourceTransform.capturing.rewriteToCaptureTopLevelVariables(r,f,{es6ImportFuncId:t.es6ImportFuncId,es6ExportFuncId:t.es6ExportFuncId,ignoreUndeclaredExcept:l,exclude:c,declarationWrapper:t.declarationWrapper||void 0,classToFunction:p,evalId:t.evalId,sourceAccessorName:t.sourceAccessorName,keepTopLevelVarDecls:t.keepTopLevelVarDecls})}t.wrapInStartEndCall&&(r=lively_ast.transform.wrapInStartEndCall(r,{startFuncNode:t.startFuncNode,endFuncNode:t.endFuncNode}));var d=lively_ast.stringify(r);return t.sourceURL&&(d+="\n//# sourceURL="+t.sourceURL.replace(/\s/g,"_")),d}function evalCodeTransformOfSystemRegisterSetters(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t.topLevelVarRecorder)return e;if("function"==typeof t.declarationCallback||t.declarationWrapperName){var r=t.declarationWrapperName||defaultDeclarationWrapperName;t.declarationWrapper=member(id(t.varRecorderName),literal(r),!0),t.declarationCallback&&(t.topLevelVarRecorder[r]=t.declarationCallback)}var n=lively_ast.parse(e),i=(t.dontTransform||[]).concat(["arguments"]),o=(t.recordGlobals||lively_lang.arr.withoutAll(Object.keys(t.topLevelVarRecorder),i),lively_sourceTransform.capturing.rewriteToRegisterModuleToCaptureSetters(n,id(t.varRecorderName||"__lvVarRecorder"),_extends({exclude:i},t)));return lively_ast.stringify(o)}function _normalizeEvalOptions(e){if(e||(e={}),(e=_extends({targetModule:null,sourceURL:e.targetModule,runtime:null,context:getGlobal(),varRecorderName:defaultTopLevelVarRecorderName,dontTransform:[],recordGlobals:null,returnPromise:!0,promiseTimeout:200,waitForPromise:!0,wrapInStartEndCall:!1,onStartEval:null,onEndEval:null},e)).targetModule){var t=e.runtime&&e.runtime.modules&&e.runtime.modules[e.targetModule];t&&(e=Object.assign(e,t))}return e.wrapInStartEndCall&&(e.startFuncNode={type:"MemberExpression",object:{type:"Identifier",name:e.varRecorderName},property:{type:"Literal",value:startEvalFunctionName},computed:!0},e.endFuncNode={type:"MemberExpression",object:{type:"Identifier",name:e.varRecorderName},property:{type:"Literal",value:endEvalFunctionName},computed:!0}),e}function _eval(__lvEvalStatement,__lvVarRecorder,__lvOriginalCode){return eval(__lvEvalStatement)}function runEval$1(e,t,r){"function"==typeof t&&2===arguments.length&&(r=t,t=null);var n,i,o=new EvalResult,s=!1,a=!1;t=_normalizeEvalOptions(t);var u=lively_lang.promise.deferred(),c=t.topLevelVarRecorder||getGlobal(),l=e;t.wrapInStartEndCall&&(c[startEvalFunctionName]&&console.warn(o.addWarning("startEvalFunctionName "+startEvalFunctionName+" already exists in recorder!")),c[endEvalFunctionName]&&console.warn(o.addWarning("endEvalFunctionName "+endEvalFunctionName+" already exists in recorder!")),c[startEvalFunctionName]=function(){s?console.warn(o.addWarning("onEvalStartCalled multiple times!")):(s=!0,"function"==typeof t.onStartEval&&t.onStartEval())},c[endEvalFunctionName]=function(e,n){a?console.warn(o.addWarning("onEvalEndCalled multiple times!")):(a=!0,finishEval(e,n,o,t,c,u,r))});try{e=evalCodeTransform(e,t),t.header&&(e=t.header+e),t.footer&&(e+=t.footer),t.transpiler&&(e=t.transpiler(e,t.transpilerOptions))}catch(e){console.warn(o.addWarning("lively.vm evalCodeTransform not working: "+e))}try{"undefined"!=typeof $world&&$world.get("log")&&($world.get("log").textString=e),i=_eval.call(t.context,e,t.topLevelVarRecorder,t.originalSource||l)}catch(e){n=e}return t.wrapInStartEndCall?n&&!a&&c[endEvalFunctionName](n,void 0):finishEval(n,n||i,o,t,c,u,r),t.sync?o:u.promise}function finishEval(e,t,r,n,i,o,s){n.wrapInStartEndCall&&(delete i[startEvalFunctionName],delete i[endEvalFunctionName]),e?(r.isError=!0,r.value=e):r.value=t,r.value instanceof Promise&&(r.isPromise=!0),n.sync?(r.processSync(n),"function"==typeof n.onEndEval&&n.onEndEval(e,t)):r.process(n).then(function(){return"function"==typeof s&&s(null,r),"function"==typeof n.onEndEval&&n.onEndEval(e,t),r},function(e){return"function"==typeof s&&s(e,void 0),"function"==typeof n.onEndEval&&n.onEndEval(e,void 0),r}).then(o.resolve,o.reject)}function syncEval$1(e,t){return t=Object.assign(t||{},{sync:!0}),runEval$1(e,t)}function tryToWaitForPromise(e,t){console.assert(e.isPromise,"no promise in tryToWaitForPromise???");var r={},n=new Promise(function(e){return setTimeout(e,t,r)});return Promise.race([n,e.value]).then(function(t){return Object.assign(e,t!==r?{promiseStatus:"fulfilled",promisedValue:t}:{promiseStatus:"pending"})}).catch(function(t){return Object.assign(e,{promiseStatus:"rejected",promisedValue:t})})}function ensureImportsAreImported(e,t,r){var n=lively_ast.parse(t).body.filter(function(e){return"ImportDeclaration"===e.type});return Promise.all(n.map(function(t){return e.normalize(t.source.value,r).then(function(t){return e.get(t)||e.import(t)})})).catch(function(e){throw console.error("Error ensuring imports: "+e.message),e})}function hasUnimportedImports(e,t,r){var n=lively.ast.parse(t).body.filter(function(e){return"ImportDeclaration"===e.type});return lively_lang.arr.uniq(n.map(function(e){return e.source.value})).filter(Boolean).filter(function(t){return!e.get(e.decanonicalize(t,r))}).length>0}function babelTranspilerForAsyncAwaitCode(e,t,r,n){return function(e,n){n=Object.assign({sourceMap:void 0,inputSourceMap:void 0,filename:r,code:!0,ast:!1},n);var i="(async function(__rec) {\n"+e+"\n}).call(this);",o=t.transform(i,n).code;return o=o.replace(/\}\)\.call\(undefined\);$/,"}).call(this)")}}function babelPluginTranspilerForAsyncAwaitCode(e,t,r,n){return function(n,i){var o=e.babelOptions||{},s=[];s.push(t.presetES2015),o.stage3&&s.push({plugins:t.pluginsStage3}),o.stage2&&s.push({plugins:t.pluginsStage2}),o.stage1&&s.push({plugins:t.pluginsStage1}),i=Object.assign({sourceMap:void 0,inputSourceMap:void 0,filename:r,babelrc:!1,presets:s,moduleIds:!1,code:!0,ast:!1},i);var a="(async function(__rec) {\n"+n+"\n}).call(this);",u=t.babel.transform(a,i).code;return u=u.replace(/\}\)\.call\(undefined\);$/,"}).call(this)")}}function getEs6Transpiler(e,t,r){if(t.transpiler)return t.transpiler;if(!t.es6Transpile)return null;if("babel"===e.transpiler){var n=e.global[e.transpiler]||e.get(e.decanonicalize(e.transpiler));return n?babelTranspilerForAsyncAwaitCode(0,n,t.targetModule):e.import(e.transpiler).then(function(e){return babelTranspilerForAsyncAwaitCode(0,e,t.targetModule)})}if("plugin-babel"===e.transpiler){var i=e.decanonicalize("plugin-babel").split("/").slice(0,-1).concat("systemjs-babel-browser.js").join("/"),o=e.get(i);return o?babelPluginTranspilerForAsyncAwaitCode(e,o,t.targetModule):e.import(i).then(function(r){return babelPluginTranspilerForAsyncAwaitCode(e,r,t.targetModule)})}if("lively.transpiler"===e.transpiler){var s=new(0,e.get(e.decanonicalize("lively.transpiler")).default)(e,t.targetModule,r);return function(e,t){return s.transpileDoit(e,t)}}throw new Error("Sorry, currently only babel is supported as es6 transpiler for runEval!")}function runEval$2(e,t,r){r=_extends({targetModule:null,parentModule:null,es6Transpile:!0,transpiler:null,transpilerOptions:null,format:"esm"},r);var n=t;e.debug&&console.log("[lively.module] runEval: "+t.slice(0,100).replace(/\n/gm," ")+"...");var i=r,o=i.format,s=i.targetModule,a=i.parentModule;if(s=e.decanonicalize(s||"*scratch*",a),r.targetModule=s,o){var u=e.getConfig().meta[s];u||(u={}),u[s]||(u[s]={}),u[s].format||(u[s].format=o,e.config(u))}var c=e.get("@lively-env").moduleEnv(s),l=c.recorder,f=c.recorderName,p=c.dontTransform,h=getEs6Transpiler(e,r,c),d="var _moduleExport = "+f+"._moduleExport,\n    _moduleImport = "+f+"._moduleImport;\n";if(!(r=_extends({waitForPromise:!0,sync:!1,evalId:r.evalId||c.nextEvalId(),sourceAccessorName:!r.hasOwnProperty("embedOriginalCode")||r.embedOriginalCode?"__lvOriginalCode":void 0,originalSource:n},r,{header:d,recordGlobals:!0,dontTransform:p,varRecorderName:f,topLevelVarRecorder:l,sourceURL:r.sourceURL||r.targetModule,context:r.context||l,wrapInStartEndCall:!0,es6ExportFuncId:"_moduleExport",es6ImportFuncId:"_moduleImport",transpiler:h,declarationWrapperName:c.varDefinitionCallbackName,currentModuleAccessor:funcCall(member$1(funcCall(member$1(member$1("__lvVarRecorder","System"),"get"),literal$1("@lively-env")),"moduleEnv"),literal$1(r.targetModule))})).sync&&!r.importsEnsured&&hasUnimportedImports(e,t,s))return ensureImportsAreImported(e,t,s).then(function(){return runEval$2(e,n,_extends({},r,{importsEnsured:!0}))});if(!c.record()){if(!r.sync&&!r._moduleImported)return e.import(s).catch(function(e){return null}).then(function(){return runEval$2(e,n,_extends({},r,{_moduleImported:!0}))});c.ensureRecord()}if(r.es6Transpile&&r.transpiler instanceof Promise){if(!r.sync&&!r._transpilerLoaded)return r.transpiler.catch(function(e){return console.error(e)}).then(function(t){return runEval$2(e,n,_extends({},r,{transpiler:t,_transpilerLoaded:!0}))});console.warn("[lively.vm] sync eval requested but transpiler is not yet loaded, will continue without transpilation!"),r.transpiler=null}e.debug&&console.log("[lively.module] runEval in module "+s+" started"),lively_notifications.emit("lively.vm/doitrequest",{code:n,waitForPromise:r.waitForPromise,targetModule:r.targetModule},Date.now(),e),e.get("@lively-env").evaluationStart(s);var m=runEval$1(t,r);return r.sync?evalEnd(e,n,r,m):Promise.resolve(m).then(function(t){return evalEnd(e,n,r,t)})}function evalEnd(e,t,r,n){return e.get("@lively-env").evaluationEnd(r.targetModule),e.debug&&console.log("[lively.module] runEval in module "+r.targetModule+" done"),lively_notifications.emit("lively.vm/doitresult",{code:t,result:n,waitForPromise:r.waitForPromise,targetModule:r.targetModule},Date.now(),e),n}function runEval$$1(e,t){var r=t=_extends({format:"esm",System:null,targetModule:null},t),n=r.format,i=r.System,o=r.targetModule;return i||"undefined"==typeof System||(i=System),!i&&o?Promise.reject(new Error("options to runEval have targetModule but cannot find system loader!")):o&&["esm","es6","register"].includes(n)?runEval$2(i,e,t):runEval$1(e,t)}function syncEval$$1(e,t){return syncEval$1(e,t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},asyncToGenerator=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var s=t[i](o),a=s.value}catch(e){return void r(e)}if(!s.done)return Promise.resolve(a).then(function(e){n("next",e)},function(e){n("throw",e)});e(a)}return n("next")})}},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),defineProperty=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},get$1=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(n)},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},set=function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var s=Object.getPrototypeOf(t);null!==s&&e(s,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var a=o.set;void 0!==a&&a.call(i,n)}return n},slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},knownSymbols=Object.getOwnPropertyNames(Symbol).filter(function(e){return"symbol"===_typeof(Symbol[e])}).reduce(function(e,t){return e.set(Symbol[t],"Symbol."+t)},new Map),symMatcher=/^Symbol\((.*)\)$/,printInspectEvalValue=function(){function e(e,r){if("object"===(void 0===r?"undefined":_typeof(r))&&(r=r.maxDepth||2),!e)return String(e);if("string"==typeof e){var n=e.includes("\n")?"`":'"';return n+e+n}if(e instanceof Error)return e.stack||safeToString(e);if(!lively_lang.obj.isObject(e))return safeToString(e);try{var i=lively_lang.obj.inspect(e,{customPrinter:t,maxDepth:r,printFunctionSource:!0})}catch(e){}return"{}"===i?safeToString(e):i}function t(t,o,s){if(!t)return o;if("symbol"===(void 0===t?"undefined":_typeof(t)))return printSymbol(t);if("string"==typeof t)return lively_lang.string.print(lively_lang.string.truncate(t,i));if(t.isMorph)return safeToString(t);if(t instanceof Promise)return"Promise()";if("undefined"!=typeof Node&&t instanceof Node)return safeToString(t);if("undefined"!=typeof ImageData&&t instanceof ImageData)return safeToString(t);var a=t.length||t.byteLength;if(void 0!==a&&a>n&&t.slice){return"["+("string"==typeof t||t.byteLength?safeToString(t.slice(0,n)):t.slice(0,n).map(s))+",...]"}var u=function(t,i){if("string"==typeof t||Array.isArray(t)||!r||"function"!=typeof t[r])return i;for(var o,s="function"==typeof t.entries,a=s?t.entries():t[r](),u=[],c=s?"{":"[",l=s?"}":"]",f=t.constructor&&t.constructor.name||"Iterable",p=0;p<n&&!(o=a.next()).done;p++)u.push(o.value);return f+"("+c+u.map(function(t){return s?String(t[0])+": "+String(t[1]):e(t,2)}).join(", ")+l+")"}(t,o);return u!==o?u:o}var r="undefined"!=typeof Symbol&&Symbol.iterator,n=10,i=100;return e}(),completions=Object.freeze({getObjectForCompletion:getObjectForCompletion,getCompletions:getCompletions}),id=lively_ast.nodes.id,literal=lively_ast.nodes.literal,member=lively_ast.nodes.member,defaultDeclarationWrapperName="lively.capturing-declaration-wrapper",defaultClassToFunctionConverterName="initializeES6ClassForLively",defaultTopLevelVarRecorderName="__lvVarRecorder",startEvalFunctionName="lively.vm-on-eval-start",endEvalFunctionName="lively.vm-on-eval-end",EvalResult=function(){function e(){classCallCheck(this,e),this.isEvalResult=!0,this.value=void 0,this.warnings=[],this.isError=!1,this.isPromise=!1,this.promisedValue=void 0,this.promiseStatus="unknown"}return createClass(e,[{key:"addWarning",value:function(e){return this.warnings.push(e),e}},{key:"printed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.value=printEvalResult(this,e)}},{key:"processSync",value:function(e){return(e.inspect||e.asString)&&(this.value=this.print(this.value,e)),this}},{key:"process",value:function(e){var t=this;return t.isPromise&&e.waitForPromise?tryToWaitForPromise(t,e.promiseTimeout).then(function(){return(e.inspect||e.asString)&&t.printed(e),t}):((e.inspect||e.asString)&&t.printed(e),Promise.resolve(t))}}]),e}(),funcCall=lively_ast.nodes.funcCall,member$1=lively_ast.nodes.member,literal$1=lively_ast.nodes.literal,EvalStrategy=function(){function e(){classCallCheck(this,e)}return createClass(e,[{key:"runEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.reject("runEval(source, options) not yet implemented for "+this.constructor.name));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"keysOfObject",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.reject("keysOfObject(prefix, options) not yet implemented for "+this.constructor.name));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}(),SimpleEvalStrategy=function(_EvalStrategy){function SimpleEvalStrategy(){return classCallCheck(this,SimpleEvalStrategy),possibleConstructorReturn(this,(SimpleEvalStrategy.__proto__||Object.getPrototypeOf(SimpleEvalStrategy)).apply(this,arguments))}return inherits(SimpleEvalStrategy,_EvalStrategy),createClass(SimpleEvalStrategy,[{key:"runEval",value:function(){function runEval(e,t){return _ref3.apply(this,arguments)}var _ref3=asyncToGenerator(regeneratorRuntime.mark(function _callee3(source,options){return regeneratorRuntime.wrap(function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.abrupt("return",Promise.resolve().then(function(){try{return Promise.resolve({value:eval(source)})}catch(e){return{isError:!0,value:e}}}));case 1:case"end":return _context3.stop()}},_callee3,this)}));return runEval}()},{key:"keysOfObject",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lively.vm.completions.getCompletions(function(e){return i.runEval(e,r)},t);case 2:return n=e.sent,e.abrupt("return",{completions:n.completions,prefix:n.startLetters});case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),SimpleEvalStrategy}(EvalStrategy),LivelyVmEvalStrategy=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,EvalStrategy),createClass(t,[{key:"normalizeOptions",value:function(e){if(!e.targetModule)throw new Error("runEval called but options.targetModule not specified!");return Object.assign({sourceURL:e.targetModule+"_doit_"+Date.now()},e)}},{key:"runEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.normalizeOptions(r),(n=r.System||lively.modules.System).config({meta:defineProperty({},r.targetModule,{format:"esm"})}),e.abrupt("return",lively.vm.runEval(t,r));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"keysOfObject",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lively.vm.completions.getCompletions(function(e){return lively.vm.runEval(e,r)},t);case 2:return n=e.sent,e.abrupt("return",{completions:n.completions,prefix:n.startLetters});case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(),RemoteEvalStrategy=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,LivelyVmEvalStrategy),createClass(t,[{key:"sourceForRemote",value:function(e,t,r){return r=lively_lang.obj.dissoc(r,["systemInterface","System","context"]),"\n(function() {\n  var arg = "+JSON.stringify(t)+",\n      options = "+JSON.stringify(r)+';\n  if (typeof lively === "undefined" || !lively.vm) {\n    return Promise.resolve({\n      isEvalResult: true,\n      isError: true,\n      value: \'lively.vm not available!\'\n    });\n  }\n  var hasSystem = typeof System !== "undefined"\n  options.context = hasSystem\n    ? System.global\n    : typeof window !== "undefined"\n        ? window\n        : typeof global !== "undefined"\n            ? global\n            : typeof self !== "undefined" ? self : this;\n  function evalFunction(source, options) {\n    if (hasSystem) {\n      var conf = {meta: {}}; conf.meta[options.targetModule] = {format: "esm"};\n      System.config(conf);\n    } else {\n      options = Object.assign({topLevelVarRecorderName: "GLOBAL"}, options);\n      delete options.targetModule;\n    }\n    return lively.vm.runEval(source, options);\n  }\n  function keysOfObjectFunction(prefix, options) {\n    return lively.vm.completions.getCompletions(code => evalFunction(code, options), prefix)\n      .then(result => ({isEvalResult: true, completions: result.completions, prefix: result.startLetters}));\n  }\n  return '+("eval"===e?"evalFunction":"keysOfObjectFunction")+"(arg, options)\n    .catch(err => ({isEvalResult: true, isError: true, value: String(err.stack || err)}));\n})();\n"}},{key:"runEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.remoteEval(this.sourceForRemote("eval",t,r),r));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"keysOfObject",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.remoteEval(this.sourceForRemote("keysOfObject",t,r),r));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"remoteEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.basicRemoteEval(t,r);case 3:return n=e.sent,e.abrupt("return","string"==typeof n?JSON.parse(n):n);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{isError:!0,value:"Remote eval failed: "+(n||e.t0)});case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"basicRemoteEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Not yet implemented");case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(),HttpEvalStrategy=function(e){function t(e){classCallCheck(this,t);var r=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.url=e||r.constructor.defaultURL,r}return inherits(t,RemoteEvalStrategy),createClass(t,null,[{key:"defaultURL",get:function(){return"http://localhost:3000/lively"}}]),createClass(t,[{key:"normalizeOptions",value:function(e){return e=get$1(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"normalizeOptions",this).call(this,e),Object.assign({serverEvalURL:this.url},e,{context:null})}},{key:"basicRemoteEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.normalizeOptions(r),n="basicRemoteEval_"+(System.get("@system-env").node?"node":"web"),e.next=4,this[n]({method:"POST",body:t},r.serverEvalURL);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"basicRemoteEval_web",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.match(/[^:]+:\/\/[^\/]+/)||[r],i=slicedToArray(n,1),o=i[0],(s=document.location.origin!==o)&&(t.headers=_extends({},t.headers,{pragma:"no-cache","cache-control":"no-cache","x-lively-proxy-request":r}),r=document.location.origin),e.prev=2,e.next=5,window.fetch(r,t);case 5:a=e.sent,e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(2),new Error("Cannot reach server at "+r+": "+e.t0.message);case 11:if(a.ok){e.next=13;break}throw new Error("Server at "+r+": "+a.statusText);case 13:return e.abrupt("return",a.text());case 14:case"end":return e.stop()}},e,this,[[2,8]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"basicRemoteEval_node",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=System._nodeRequire("url").parse,i=System._nodeRequire(r.startsWith("https:")?"https":"http"),o=Object.assign({method:t.method||"GET"},n(r)),e.abrupt("return",new Promise(function(e,r){var n=i.request(o,function(t){t.setEncoding("utf8");var n="";t.on("data",function(e){return n+=e}),t.on("end",function(){return e(n)}),t.on("error",function(e){return r(e)})});n.on("error",function(e){return r(e)}),n.end(t.body)}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(),L2LEvalStrategy=function(e){function t(e,r){classCallCheck(this,t);var n=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.l2lClient=e,n.targetId=r,n}return inherits(t,RemoteEvalStrategy),createClass(t,[{key:"basicRemoteEval",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.l2lClient,i=this.targetId,e.next=4,new Promise(function(e,r){return n.sendTo(i,"remote-eval",{source:t},e)});case 4:return o=e.sent,(s=o.data)&&s.value&&s.value.isEvalResult&&(s=s.value),e.abrupt("return",s);case 8:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(),evalStrategies=Object.freeze({RemoteEvalStrategy:RemoteEvalStrategy,EvalStrategy:EvalStrategy,SimpleEvalStrategy:SimpleEvalStrategy,LivelyVmEvalStrategy:LivelyVmEvalStrategy,HttpEvalStrategy:HttpEvalStrategy,L2LEvalStrategy:L2LEvalStrategy});exports.completions=completions,exports.runEval=runEval$$1,exports.syncEval=syncEval$$1,exports.evalStrategies=evalStrategies,exports.defaultTopLevelVarRecorderName=defaultTopLevelVarRecorderName,exports.defaultClassToFunctionConverterName=defaultClassToFunctionConverterName,exports.evalCodeTransform=evalCodeTransform,exports.evalCodeTransformOfSystemRegisterSetters=evalCodeTransformOfSystemRegisterSetters}(this.lively.vm=this.lively.vm||{},lively.lang,lively.ast,lively.sourceTransform,lively.classes,lively.notifications),"undefined"!=typeof module&&module.exports&&(module.exports=GLOBAL.lively.vm)}(),function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(e,t){"use strict";function r(e,t){return Array.isArray(e)?e.reduce(function(e,t){return r(t,e)},t):"string"==typeof e?t.filter(function(t){return t.path()!==e&&t.name()!==e}):e instanceof RegExp?t.filter(function(t){return!e.test(t.path())&&!e.test(t.name())}):"function"==typeof e?t.filter(function(t){return!e(t)}):t}function n(e){var t=(e=e).split("?"),r=x(t,2),n=(r[0],r[1]),i={};if(!n)return i;var o=n.split("&");if(o)for(var s=0;s<o.length;s++){var a=o[s].split("="),u=a[0],c=!0;if(a.length>1)if("undefined"===(c=decodeURIComponent(a.slice(1).join("="))))c=void 0;else if(c.match(/^(true|false|null|[0-9"[{].*)$/))try{c=JSON.parse(c)}catch(e){"["===c[0]&&(c=c.slice(1,-1).split(","))}i[u]=c}return i}function i(e){var t=e,r=t;do{r=(t=r).replace(E,"")}while(r!=t);return r=r.replace(S,"$1/"),r=r.replace(k,"/")}function o(e,t){var r=e.match(w),n=t.match(w),o=void 0,s=void 0,a=void 0,u=void 0,c=!0;if((r&&!n||!r&&n)&&(c=!1),r&&n&&(o=r[1],s=r[2],a=n[1],u=n[2],o!==a?c=!1:s!==u?c=!1:(e=r[3],t=n[3])),!c)throw new Error("[relativePathBetween] incompatible paths: "+e+" vs. "+t);if(e=i(e),t=i(t),e==t)return"";var l=function(e,t){e.startsWith("/")&&(e=e.slice(1)),t.startsWith("/")&&(t=t.slice(1));for(var r=e.split("/"),n=t.split("/"),i=0;i<n.length&&r[i]&&r[i]==n[i];i++);return"../".repeat(Math.max(0,n.length-i-1))+r.splice(i,r.length).join("/")}(t,e);if(!l)throw new Error("pathname differs in relativePathFrom "+e+" vs "+t);return l}function s(e,t){throw new Error(t+" for "+e.constructor.name+" not yet implemented")}function a(e){var t=(new DOMParser).parseFromString(e,"text/xml"),r=function(e){var t=e.match(/\/([a-z]+?):multistatus/i);return t?t[1]:"d"}(e),n=new j("/"+r+":multistatus/"+r+":response").findAll(t.documentElement),i=new j(r+":href"),o=new j(r+":propstat/"+r+":prop");return n.map(function(e){var t=o.findFirst(e),r=Array.from(t.childNodes).reduce(function(e,t){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.tagName.replace(/[^:]+:/,""),n=R[r],i=e.textContent;switch(n){case"lastModified":case"created":i=new Date(i);break;case"size":i=Number(i)}return t[n]=i,t}(t,e)},{}),n=i.findFirst(e);return r.url=n.textContent||n.text,r})}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",r=arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=e.url,o=e.useCors,s=e.useProxy,a=e.headers,u=(o=void 0===o||o,{method:t});return(s=void 0===s||s)&&(Object.assign(n,{pragma:"no-cache","cache-control":"no-cache","x-lively-proxy-request":i}),i=document.location.origin),o&&(u.mode="cors"),r&&(u.body=r),u.redirect="follow",u.headers=y({},n,a),fetch(i,u)}function c(e){return function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return new Promise(function(t,n){return e.apply(null,r.concat(function(e,r){return e?n(e):t(r)}))})}}function l(e,t){return!t||("string"==typeof t?!e.url.includes(t):"function"==typeof t?!t(e):!(t instanceof RegExp)||!t.test(e.url))}function f(e,t){if(!e)throw new Error("lively.resource resource constructor: expects url but got "+e);if(e.isResource)return e;e=String(e);for(var r=0;r<K.length;r++)if(K[r].matches(e))return new K[r].resourceClass(e,t);throw new Error("Cannot find resource type for url "+e)}function p(e){var t=e.name;K=K.filter(function(e){return e.name!==t}).concat(e)}var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var s=t[i](o),a=s.value}catch(e){return void r(e)}if(!s.done)return Promise.resolve(a).then(function(e){n("next",e)},function(e){n("throw",e)});e(a)}return n("next")})}},m=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},v=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},g=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(n)},b=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},_=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},x=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),w=/^([^:\/]+):\/\/([^\/]*)(.*)/,k=/\/\.\//g,E=/\/[^\/]+\/\.\./,S=/(^|[^:])[\/]+/g,A=/\/+$/,D=/^\/+/,C=/^[a-z0-9-_\.]+:/,F=/^\/\/[^\/]+/,O=function(){function e(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(m(this,e),!t)throw new Error("Cannot create resource without url");this.url=String(t),this.binary=!1,this.lastModified=void 0,this.created=void 0,this.etag=void 0,this.size=void 0,this.type=void 0,this.contentType=void 0,this.user=void 0,this.group=void 0,this.mode=void 0,this._isDirectory=void 0,this._isLink=void 0,this.linkCount=void 0}return v(e,null,[{key:"fromProps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new this(e.url).assignProperties(e)}}]),v(e,[{key:"equals",value:function(e){if(!e||this.constructor!==e.constructor)return!1;var t=this.url,r=e.url;return"/"===t[t.length-1]&&(t=t.slice(0,-1)),"/"===r[r.length-1]&&(r=r.slice(0,-1)),t===r}},{key:"toString",value:function(){return this.constructor.name+'("'+this.url+'")'}},{key:"newResource",value:function(e){return f(e)}},{key:"path",value:function(){var e=this.url.replace(C,"").replace(F,"");return""===e?"/":e}},{key:"pathWithoutQuery",value:function(){return this.path().split("?")[0]}},{key:"name",value:function(){var e=this.path(),t=e.lastIndexOf("?");t>-1&&(e=e.slice(0,t)),e.endsWith("/")&&(e=e.slice(0,-1));var r=e.split("/"),n=r[r.length-1];return decodeURIComponent(n)}},{key:"ext",value:function(){var e=this.url;if(e.endsWith("/"))return"";var t=e.match(/\.([^\/\.]+$)/)||["",""],r=x(t,2),n=(r[0],r[1]);return n.toLowerCase()}},{key:"nameWithoutExt",value:function(){var e=this.name(),t=e.lastIndexOf(".");return t>0&&(e=e.slice(0,t)),e}},{key:"scheme",value:function(){return this.url.split(":")[0]}},{key:"host",value:function(){var e=this.url.indexOf("://");if(-1===e)return null;var t=this.url.slice(e+3),r=t.indexOf("/");return t.slice(0,r>-1?r:t.length)}},{key:"schemeAndHost",value:function(){return this.isRoot()?this.asFile().url:this.url.slice(0,this.url.length-this.path().length)}},{key:"parent",value:function(){return this.isRoot()?null:this.newResource(this.url.replace(A,"").split("/").slice(0,-1).join("/")+"/")}},{key:"parents",value:function(){for(var e=[],t=this.parent();t;)e.unshift(t),t=t.parent();return e}},{key:"isParentOf",value:function(e){var t=this;return e.schemeAndHost()===this.schemeAndHost()&&e.parents().some(function(e){return e.equals(t)})}},{key:"query",value:function(){return n(this.url)}},{key:"withQuery",value:function(e){var t=y({},this.query(),e),r=this.url.split("?"),n=x(r,1)[0],i=Object.keys(t).map(function(e){return e+"="+encodeURIComponent(String(t[e]))}).join("&");return this.newResource(n+"?"+i)}},{key:"commonDirectory",value:function(e){if(e.schemeAndHost()!==this.schemeAndHost())return null;if(this.isDirectory()&&this.equals(e))return this;if(this.isRoot())return this.asDirectory();if(e.isRoot())return e.asDirectory();for(var t=e.parents(),r=this.parents(),n=this.root(),i=0;i<r.length;i++){var o=r[i],s=t[i];if(!s||!o.equals(s))return n;n=o}return n}},{key:"withRelativePartsResolved",value:function(){var e=this.path(),t=i(e);return t===e?this:(t.startsWith("/")&&(t=t.slice(1)),this.newResource(this.root().url+t))}},{key:"relativePathFrom",value:function(e){return o(e.url,this.url)}},{key:"withPath",value:function(e){return(this.isRoot()?this:this.root()).join(e)}},{key:"join",value:function(e){return this.newResource(this.url.replace(A,"")+"/"+e.replace(D,""))}},{key:"isRoot",value:function(){return"/"===this.path()}},{key:"isFile",value:function(){return!this.isRoot()&&!this.url.match(A)}},{key:"isDirectory",value:function(){return!this.isFile()}},{key:"asDirectory",value:function(){return this.url.endsWith("/")?this:this.newResource(this.url.replace(A,"")+"/")}},{key:"root",value:function(){if(this.isRoot())return this;var e=this.url.slice(0,-this.path().length);return this.newResource(e+"/")}},{key:"asFile",value:function(){return this.url.endsWith("/")?this.newResource(this.url.replace(A,"")):this}},{key:"assignProperties",value:function(e){for(var t in e)if("url"!==t){var r=t;"isLink"!==t&&"isDirectory"!==t||(r="_"+t),this[r]=e[t]}return this}},{key:"ensureExistance",value:function(){var e=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.exists();case 2:if(!e.sent){e.next=4;break}return e.abrupt("return",this);case 4:return e.next=6,this.parent().ensureExistance();case 6:if(!this.isFile()){e.next=11;break}return e.next=9,this.write(t||"");case 9:e.next=13;break;case 11:return e.next=13,this.mkdir();case 13:return e.abrupt("return",this);case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"copyTo",value:function(){var e=d(regeneratorRuntime.mark(function e(t){var r,n,i,o=this,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFile()){e.next=13;break}if(r=t.isFile()?t:t.join(this.name()),!s){e.next=5;break}return e.next=5,r.parent().ensureExistance();case 5:return e.t0=r,e.next=8,this.read();case 8:return e.t1=e.sent,e.next=11,e.t0.write.call(e.t0,e.t1);case 11:e.next=25;break;case 13:if(t.isDirectory()){e.next=15;break}throw new Error("Cannot copy a directory to a file!");case 15:return e.next=17,this.dirList("infinity");case 17:return n=e.sent,i=n.map(function(e){return t.join(e.relativePathFrom(o))}),e.next=21,t.ensureExistance();case 21:return e.next=23,n.reduceRight(function(e,t,r){return function(){return Promise.resolve(t.isDirectory()&&i[r].ensureExistance()).then(e)}},function(){return Promise.resolve()})();case 23:return e.next=25,n.reduceRight(function(e,t,r){return function(){return Promise.resolve(t.isFile()&&t.copyTo(i[r],!1)).then(e)}},function(){return Promise.resolve()})();case 25:return e.abrupt("return",this);case 26:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"rename",value:function(){var e=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.copyTo(t);case 2:return this.remove(),e.abrupt("return",t);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"beBinary",value:function(e){return this.setBinary(!0)}},{key:"setBinary",value:function(e){return this.binary=e,this}},{key:"read",value:function(){var e=d(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s(this,"read");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"write",value:function(){var e=d(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s(this,"write");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"mkdir",value:function(){var e=d(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s(this,"mkdir");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"exists",value:function(){var e=d(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s(this,"exists");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=d(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s(this,"remove");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"dirList",value:function(){var e=d(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s(this,"dirList");case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"readProperties",value:function(){var e=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s(this,"readProperties");case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"writeJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.write(t?JSON.stringify(e,null,2):JSON.stringify(e))}},{key:"readJson",value:function(){var e=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,this.read();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"__serialize__",value:function(){return{__expr__:'var r = null; try { r = resource("'+this.url+'");} catch (err) {}; r',bindings:{"lively.resources":["resource"]}}}},{key:"isResource",get:function(){return!0}},{key:"canDealWithJSON",get:function(){return!1}}]),e}(),j=function(){function e(t){m(this,e),this.expression=t,this.contextNode=null,this.xpe=new XPathEvaluator}return v(e,[{key:"establishContext",value:function(e){if(!this.nsResolver){var t=e.ownerDocument?e.ownerDocument.documentElement:e.documentElement;t!==this.contextNode&&(this.contextNode=t,this.nsResolver=this.xpe.createNSResolver(t))}}},{key:"manualNSLookup",value:function(){return this.nsResolver=function(e){return Namespace[e.toUpperCase()]||null},this}},{key:"findAll",value:function(e,t){this.establishContext(e);for(var r=this.xpe.evaluate(this.expression,e,this.nsResolver,XPathResult.ANY_TYPE,null),n=[],i=null;i=r.iterateNext();)n.push(i);return n.length>0||void 0===t?n:t}},{key:"findFirst",value:function(e){this.establishContext(e);return this.xpe.evaluate(this.expression,e,this.nsResolver,XPathResult.ANY_TYPE,null).iterateNext()}}]),e}(),R={getlastmodified:"lastModified",creationDate:"created",getetag:"etag",getcontentlength:"size",resourcetype:"type",getcontenttype:"contentType"},B=["3ds","3g2","3gp","7z","a","aac","adp","ai","aif","aiff","alz","ape","apk","ar","arj","asf","au","avi","bak","bh","bin","bk","bmp","btif","bz2","bzip2","cab","caf","cgm","class","cmx","cpio","cr2","csv","cur","dat","deb","dex","djvu","dll","dmg","dng","doc","docm","docx","dot","dotm","dra","DS_Store","dsk","dts","dtshd","dvb","dwg","dxf","ecelp4800","ecelp7470","ecelp9600","egg","eol","eot","epub","exe","f4v","fbs","fh","fla","flac","fli","flv","fpx","fst","fvt","g3","gif","graffle","gz","gzip","h261","h263","h264","icns","ico","ief","img","ipa","iso","jar","jpeg","jpg","jpgv","jpm","jxr","key","ktx","lha","lvp","lz","lzh","lzma","lzo","m3u","m4a","m4v","mar","mdi","mht","mid","midi","mj2","mka","mkv","mmr","mng","mobi","mov","movie","mp3","mp4","mp4a","mpeg","mpg","mpga","mxu","nef","npx","numbers","o","oga","ogg","ogv","otf","pages","pbm","pcx","pdf","pea","pgm","pic","png","pnm","pot","potm","potx","ppa","ppam","ppm","pps","ppsm","ppsx","ppt","pptm","pptx","psd","pya","pyc","pyo","pyv","qt","rar","ras","raw","rgb","rip","rlc","rmf","rmvb","rtf","rz","s3m","s7z","scpt","sgi","shar","sil","sketch","slk","smv","so","sub","swf","tar","tbz","tbz2","tga","tgz","thmx","tif","tiff","tlz","ttc","ttf","txz","udf","uvh","uvi","uvm","uvp","uvs","uvu","viv","vob","war","wav","wax","wbmp","wdp","weba","webm","webp","whl","wim","wm","wma","wmv","wmx","woff","woff2","wvx","xbm","xif","xla","xlam","xls","xlsb","xlsm","xlsx","xlt","xltm","xltx","xm","xmind","xpi","xpm","xwd","xz","z","zip","zipx"],T="undefined"!=typeof System?System.get("@system-env").node:"undefined"!=typeof global&&"undefined"!=typeof process,P={name:"http-webdav-resource",matches:function(e){return e.startsWith("http:")||e.startsWith("https:")},resourceClass:function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};m(this,t);var n=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return n.useProxy=!!r.hasOwnProperty("useProxy")&&r.useProxy,n.useCors=!!r.hasOwnProperty("useCors")&&r.useCors,n.headers=r.headers||{},n.binary=!!n.isFile()&&B.includes(n.ext()),n.errorOnHTTPStatusCodes=!r.hasOwnProperty("errorOnHTTPStatusCodes")||r.errorOnHTTPStatusCodes,n}return b(t,O),v(t,[{key:"join",value:function(e){return Object.assign(g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"join",this).call(this,e),{headers:this.headers,useCors:this.useCors,useProxy:this.useProxy})}},{key:"makeProxied",value:function(){return this.useProxy?this:new this.constructor(this.url,{headers:this.headers,useCors:this.useCors,useProxy:!0})}},{key:"noErrorOnHTTPStatusCodes",value:function(){return this.errorOnHTTPStatusCodes=!1,this}},{key:"read",value:function(){var e=d(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(this);case 2:if((t=e.sent).ok||!this.errorOnHTTPStatusCodes){e.next=5;break}throw new Error("Cannot read "+this.url+": "+t.statusText+" "+t.status);case 5:if(this.binary){e.next=7;break}return e.abrupt("return",t.text());case 7:if("blob"!==this.binary){e.next=9;break}return e.abrupt("return",t.blob());case 9:if("function"!=typeof t.arrayBuffer){e.next=11;break}return e.abrupt("return",t.arrayBuffer());case 11:if("function"!=typeof t.buffer){e.next=13;break}return e.abrupt("return",t.buffer());case 13:throw new Error("Don't now how to read binary resource "+this+"'");case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"write",value:function(){var e=d(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isFile()){e.next=2;break}throw new Error("Cannot write a non-file: "+this.url);case 2:return e.next=4,u(this,"PUT",t);case 4:if((r=e.sent).ok||!this.errorOnHTTPStatusCodes){e.next=7;break}throw new Error("Cannot write "+this.url+": "+r.statusText+" "+r.status);case 7:return e.abrupt("return",this);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"mkdir",value:function(){var e=d(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFile()){e.next=2;break}throw new Error("Cannot mkdir on a file: "+this.url);case 2:return e.next=4,u(this,"MKCOL");case 4:if((t=e.sent).ok||!this.errorOnHTTPStatusCodes){e.next=7;break}throw new Error("Cannot create directory "+this.url+": "+t.statusText+" "+t.status);case 7:return e.abrupt("return",this);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"exists",value:function(){var e=d(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isRoot()){e.next=4;break}e.t0=!0,e.next=7;break;case 4:return e.next=6,u(this,"HEAD");case 6:e.t0=!!e.sent.ok;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=d(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(this,"DELETE");case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_propfind",value:function(){var e=d(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(this,"PROPFIND",null,{"Content-Type":"text/xml"});case 2:if((t=e.sent).ok||!this.errorOnHTTPStatusCodes){e.next=5;break}throw new Error("Error in dirList for "+this.url+": "+t.statusText);case 5:return e.next=7,t.text();case 7:return r=e.sent,n=this.root(),e.abrupt("return",a(r).map(function(e){return n.join(e.url).assignProperties(e)}));case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"dirList",value:function(){var e=d(regeneratorRuntime.mark(function e(){var t,n,i,o,s,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("number"==typeof a||"infinity"===a){e.next=2;break}throw new Error("dirList  invalid depth argument: "+a);case 2:if(t=u.exclude,a<=0&&(a=1),1!==a){e.next=13;break}return e.next=7,this._propfind();case 7:return n=e.sent,i=n.shift(),t&&(n=r(t,n)),e.abrupt("return",n);case 13:return e.next=15,this.dirList(1,u);case 15:return o=e.sent,s=o.filter(function(e){return e.isDirectory()}),e.abrupt("return",Promise.all(s.map(function(e){return e.dirList("number"==typeof a?a-1:a,u)})).then(function(e){return e.reduce(function(e,t){return e.concat(t)},o)}));case 18:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"readProperties",value:function(){var e=d(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._propfind();case 2:return r=e.sent[0],e.abrupt("return",this.assignProperties(r));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"post",value:function(){var e=d(regeneratorRuntime.mark(function e(){var t,r,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"string"!=typeof i&&(i=JSON.stringify(i)),e.next=3,u(this,"POST",i,{});case 3:return t=e.sent,r=void 0,n=void 0,e.prev=6,e.next=9,t.text();case 9:r=e.sent,e.next=14;break;case 12:e.prev=12,e.t0=e.catch(6);case 14:if(r&&"application/json"===t.headers.get("content-type"))try{n=JSON.parse(r)}catch(e){}if(t.ok||!this.errorOnHTTPStatusCodes){e.next=19;break}throw new Error("Error in POST "+this.url+": "+(r||t.statusText));case 19:return e.abrupt("return",n||r);case 20:case"end":return e.stop()}},e,this,[[6,12]])}));return function(){return e.apply(this,arguments)}}()},{key:"copyTo",value:function(){var e=d(regeneratorRuntime.mark(function e(r){var n,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFile()){e.next=7;break}if(n=r.isFile()?r:r.join(this.name()),!T){e.next=7;break}if(!n.isHTTPResource){e.next=5;break}return e.abrupt("return",this._copyTo_file_nodejs_http(n,i));case 5:if(!n.isNodeJSFileResource){e.next=7;break}return e.abrupt("return",this._copyTo_file_nodejs_fs(n,i));case 7:return e.abrupt("return",g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"copyTo",this).call(this,r,i));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_copyFrom_file_nodejs_fs",value:function(){var e=d(regeneratorRuntime.mark(function e(t){var r,n,i,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!o){e.next=3;break}return e.next=3,this.parent().ensureExistance();case 3:return r=void 0,(n=t._createReadStream()).on("error",function(e){return r=e}),e.next=8,u(this,"PUT",n);case 8:if(i=e.sent,!r){e.next=11;break}throw r;case 11:if(i.ok||!this.errorOnHTTPStatusCodes){e.next=13;break}throw new Error("copyTo: Cannot GET: "+i.statusText+" "+i.status);case 13:return e.abrupt("return",this);case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_copyTo_file_nodejs_fs",value:function(){var e=d(regeneratorRuntime.mark(function e(t){var r,n,i=this,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!o){e.next=3;break}return e.next=3,t.parent().ensureExistance();case 3:return e.next=5,u(this,"GET");case 5:if((r=e.sent).ok||!this.errorOnHTTPStatusCodes){e.next=8;break}throw new Error("copyTo: Cannot GET: "+r.statusText+" "+r.status);case 8:return n=void 0,e.abrupt("return",new Promise(function(e,o){return r.body.pipe(t._createWriteStream()).on("error",function(e){return n=e}).on("finish",function(){return n?o(n):e(i)})}));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_copyTo_file_nodejs_http",value:function(){var e=d(regeneratorRuntime.mark(function e(t){var r,n,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!i){e.next=3;break}return e.next=3,t.parent().ensureExistance();case 3:return e.next=5,u(this,"GET");case 5:if((r=e.sent).ok||!this.errorOnHTTPStatusCodes){e.next=8;break}throw new Error("copyTo: Cannot GET: "+r.statusText+" "+r.status);case 8:return e.next=10,u(t,"PUT",r.body);case 10:if(n=e.sent,r.ok||!this.errorOnHTTPStatusCodes){e.next=13;break}throw new Error("copyTo: Cannot PUT: "+n.statusText+" "+n.status);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"isHTTPResource",get:function(){return!0}}]),t}()},I=c(t.readFile),L=c(t.writeFile),N=function(e){return new Promise(function(r,n){return t.exists(e,function(e){return r(!!e)})})},M=c(t.readdir),q=c(t.mkdir),$=c(t.rmdir),W=c(t.unlink),U=c(t.lstat),z=c(t.rename),V={name:"nodejs-file-resource",matches:function(e){return e.startsWith("file:")},resourceClass:function(e){function n(){return m(this,n),_(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return b(n,O),v(n,[{key:"path",value:function(){return this.url.replace("file://","")}},{key:"stat",value:function(){var e=d(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",U(this.path()));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"read",value:function(){var e=d(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=I(this.path()),e.abrupt("return",this.binary?t:t.then(String));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"write",value:function(){var e=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isDirectory()){e.next=2;break}throw new Error("Cannot write into a directory: "+this.path());case 2:return e.next=4,L(this.path(),t);case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"mkdir",value:function(){var e=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFile()){e.next=2;break}throw new Error("Cannot mkdir on a file: "+this.path());case 2:return e.next=4,q(this.path());case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"exists",value:function(){var e=d(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!!this.isRoot()||N(this.path()));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"dirList",value:function(){var e=d(regeneratorRuntime.mark(function e(){var t,n,i,o,s,a,u,c,l,f,p,h,d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("number"==typeof d||"infinity"===d){e.next=2;break}throw new Error("dirList  invalid depth argument: "+d);case 2:if(t=m.exclude,d<=0&&(d=1),1!==d){e.next=42;break}return n=[],i=!0,o=!1,s=void 0,e.prev=9,e.next=12,M(this.path());case 12:e.t0=Symbol.iterator,a=e.sent[e.t0]();case 14:if(i=(u=a.next()).done){e.next=26;break}return c=u.value,l=this.join(c),e.next=19,l.stat();case 19:f=e.sent,(l=f.isDirectory()?l.asDirectory():l)._assignPropsFromStat(f),n.push(l);case 23:i=!0,e.next=14;break;case 26:e.next=32;break;case 28:e.prev=28,e.t1=e.catch(9),o=!0,s=e.t1;case 32:e.prev=32,e.prev=33,!i&&a.return&&a.return();case 35:if(e.prev=35,!o){e.next=38;break}throw s;case 38:return e.finish(35);case 39:return e.finish(32);case 40:return t&&(n=r(t,n)),e.abrupt("return",n);case 42:return e.next=44,this.dirList(1,m);case 44:return p=e.sent,h=p.filter(function(e){return e.isDirectory()}),e.abrupt("return",Promise.all(h.map(function(e){return e.dirList("number"==typeof d?d-1:d,m)})).then(function(e){return e.reduce(function(e,t){return e.concat(t)},p)}));case 47:case"end":return e.stop()}},e,this,[[9,28,32,40],[33,,35,39]])}));return function(){return e.apply(this,arguments)}}()},{key:"isEmptyDirectory",value:function(){var e=d(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dirList();case 2:return e.t0=e.sent.length,e.abrupt("return",0===e.t0);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"rename",value:function(){var e=d(regeneratorRuntime.mark(function e(t){var r,i,o,s,a,u,c,l,f,p,h,d,m,v,y,b,_,x,w,k;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof this.constructor){e.next=2;break}return e.abrupt("return",g(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"rename",this).call(this,t));case 2:if(!this.isFile()){e.next=7;break}t=t.asFile(),z(this.path(),t.path()),e.next=93;break;case 7:return t=t.asDirectory(),e.next=10,t.ensureExistance();case 10:return r=[],i=[],o=!0,s=!1,a=void 0,e.prev=14,e.next=17,this.dirList("infinity");case 17:e.t0=Symbol.iterator,u=e.sent[e.t0]();case 19:if(o=(c=u.next()).done){e.next=25;break}(l=c.value).isDirectory()?i.push(l):r.push(l);case 22:o=!0,e.next=19;break;case 25:e.next=31;break;case 27:e.prev=27,e.t1=e.catch(14),s=!0,a=e.t1;case 31:e.prev=31,e.prev=32,!o&&u.return&&u.return();case 34:if(e.prev=34,!s){e.next=37;break}throw a;case 37:return e.finish(34);case 38:return e.finish(31);case 39:f=!0,p=!1,h=void 0,e.prev=42,d=i[Symbol.iterator]();case 44:if(f=(m=d.next()).done){e.next=51;break}return v=m.value,e.next=48,t.join(v.relativePathFrom(this)).ensureExistance();case 48:f=!0,e.next=44;break;case 51:e.next=57;break;case 53:e.prev=53,e.t2=e.catch(42),p=!0,h=e.t2;case 57:e.prev=57,e.prev=58,!f&&d.return&&d.return();case 60:if(e.prev=60,!p){e.next=63;break}throw h;case 63:return e.finish(60);case 64:return e.finish(57);case 65:y=!0,b=!1,_=void 0,e.prev=68,x=r[Symbol.iterator]();case 70:if(y=(w=x.next()).done){e.next=77;break}return k=w.value,e.next=74,k.rename(t.join(k.relativePathFrom(this)));case 74:y=!0,e.next=70;break;case 77:e.next=83;break;case 79:e.prev=79,e.t3=e.catch(68),b=!0,_=e.t3;case 83:e.prev=83,e.prev=84,!y&&x.return&&x.return();case 86:if(e.prev=86,!b){e.next=89;break}throw _;case 89:return e.finish(86);case 90:return e.finish(83);case 91:return e.next=93,this.remove();case 93:return e.abrupt("return",t);case 94:case"end":return e.stop()}},e,this,[[14,27,31,39],[32,,34,38],[42,53,57,65],[58,,60,64],[68,79,83,91],[84,,86,90]])}));return function(t){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=d(regeneratorRuntime.mark(function e(){var t,r,n,i,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.exists();case 2:if(e.sent){e.next=5;break}e.next=41;break;case 5:if(!this.isDirectory()){e.next=39;break}return t=!0,r=!1,n=void 0,e.prev=9,e.next=12,this.dirList();case 12:e.t0=Symbol.iterator,i=e.sent[e.t0]();case 14:if(t=(o=i.next()).done){e.next=21;break}return s=o.value,e.next=18,s.remove();case 18:t=!0,e.next=14;break;case 21:e.next=27;break;case 23:e.prev=23,e.t1=e.catch(9),r=!0,n=e.t1;case 27:e.prev=27,e.prev=28,!t&&i.return&&i.return();case 30:if(e.prev=30,!r){e.next=33;break}throw n;case 33:return e.finish(30);case 34:return e.finish(27);case 35:return e.next=37,$(this.path());case 37:e.next=41;break;case 39:return e.next=41,W(this.path());case 41:return e.abrupt("return",this);case 42:case"end":return e.stop()}},e,this,[[9,23,27,35],[28,,30,34]])}));return function(){return e.apply(this,arguments)}}()},{key:"readProperties",value:function(){var e=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this.stat();case 3:return e.t1=e.sent,e.abrupt("return",e.t0._assignPropsFromStat.call(e.t0,e.t1));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"copyTo",value:function(){var e=d(regeneratorRuntime.mark(function e(t){var r,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFile()){e.next=4;break}if(!(r=t.isFile()?t:t.join(this.name())).isHTTPResource){e.next=4;break}return e.abrupt("return",r._copyFrom_file_nodejs_fs(this,i=!0));case 4:return e.abrupt("return",g(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"copyTo",this).call(this,t,i));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_assignPropsFromStat",value:function(e){return this.assignProperties({lastModified:e.mtime,created:e.ctime,size:e.size,type:e.isDirectory()?"directory":"file",isLink:e.isSymbolicLink()})}},{key:"_createWriteStream",value:function(){return t.createWriteStream(this.path())}},{key:"_createReadStream",value:function(){return t.createReadStream(this.path())}},{key:"isNodeJSFileResource",get:function(){return!0}}]),n}()},G=/\//g,H=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(m(this,e),!t||"string"!=typeof t)throw new Error("LocalResourceInMemoryBackend needs name!");this.name=t,this._filespec=r}return v(e,null,[{key:"removeHost",value:function(e){delete this.hosts[e]}},{key:"ensure",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.named(r.host);return Promise.resolve().then(function(){return e?Q("local://"+n.name,e):null}).then(function(){return t})}},{key:"named",value:function(e){return e||(e="default"),this.hosts[e]||(this.hosts[e]=new this(e))}},{key:"hosts",get:function(){return this._hosts||(this._hosts={})}}]),v(e,[{key:"get",value:function(e){return this._filespec[e]}},{key:"set",value:function(e,t){this._filespec[e]=t}},{key:"write",value:function(e,t){var r=this._filespec[e];r||(r=this._filespec[e]={created:new Date}),r.content=t,r.isDirectory=!1,r.lastModified=new Date}},{key:"read",value:function(e){var t=this._filespec[e];return t&&t.content?t.content:""}},{key:"mkdir",value:function(e){var t=this._filespec[e];t&&t.isDirectory||(t||(t=this._filespec[e]={created:new Date}),t.content&&delete t.content,t.isDirectory=!0,t.lastModified=new Date)}},{key:"partialFilespec",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,r={},n=this.filespec,i=Object.keys(n),o=0;o<i.length;o++){var s=i[o];if(s.startsWith(e)&&e!==s){var a=s.slice(e.length);(a.includes("/")?a.match(G).length+1:1)>t||(r[s]=n[s])}}return r}},{key:"filespec",get:function(){return this._filespec},set:function(e){this._filespec=e}}]),e}(),J=function(e){function t(){return m(this,t),_(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return b(t,O),v(t,[{key:"read",value:function(){return Promise.resolve(this.localBackend.read(this.path()))}},{key:"write",value:function(e){if(this.isDirectory())throw new Error("Cannot write into a directory! ("+this.url+")");var t=this.localBackend.get(this.path());if(t&&t.isDirectory)throw new Error(this.url+" already exists and is a directory (cannot write into it!)");return this.localBackend.write(this.path(),e),Promise.resolve(this)}},{key:"mkdir",value:function(){if(!this.isDirectory())throw new Error("Cannot mkdir a file! ("+this.url+")");var e=this.localBackend.get(this.path());if(e&&e.isDirectory)return Promise.resolve(this);if(e&&!e.isDirectory)throw new Error(this.url+" already exists and is a file (cannot mkdir it!)");return this.localBackend.mkdir(this.path()),Promise.resolve(this)}},{key:"exists",value:function(){return Promise.resolve(this.isRoot()||this.path()in this.localBackend.filespec)}},{key:"remove",value:function(){var e=this,t=this.path();return Object.keys(this.localBackend.filespec).forEach(function(r){return r.startsWith(t)&&delete e.localBackend.filespec[r]}),Promise.resolve(this)}},{key:"readProperties",value:function(){throw new Error("not yet implemented")}},{key:"dirList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isDirectory())return this.asDirectory().dirList(t,r);var n=r.exclude,i=this.path(),o=[],s=Object.keys(this.localBackend.filespec);"infinity"===t&&(t=1/0);for(var a=0;a<s.length;a++){var u=s[a];if(u.startsWith(i)&&i!==u){var c=u.slice(i.length);if((c.includes("/")?c.match(G).length+1:1)>t){if("continue"===function(){var r=e.join(c.split("/").slice(0,t).join("/")+"/");return o.some(function(e){return e.equals(r)})||o.push(r),"continue"}())continue}var f=this.join(c);n&&!l(f,n)||o.push(f)}}return Promise.resolve(o)}},{key:"localBackend",get:function(){return H.named(this.host())}}]),t}(),K=K||[];p({name:"local-resource",matches:function(e){return e.startsWith("local:")},resourceClass:J}),p(P),p(V);var Q=function(){var e=d(regeneratorRuntime.mark(function e(t,r,n){var i,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=f(t,n).asDirectory(),e.next=3,i.ensureExistance();case 3:e.t0=regeneratorRuntime.keys(r);case 4:if((e.t1=e.t0()).done){e.next=18;break}if(o=e.t1.value,r.hasOwnProperty(o)){e.next=8;break}return e.abrupt("continue",4);case 8:if(s=i.join(o),"object"!==h(r[o])){e.next=14;break}return e.next=12,Q(s,r[o],n);case 12:e.next=16;break;case 14:return e.next=16,s.write(r[o]);case 16:e.next=4;break;case 18:return e.abrupt("return",i);case 19:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),Y=function(){var e=d(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,l,f,p,h,d,m,v,y,g,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"infinity",_=arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.dirList(b,_);case 2:r=e.sent,n={},i=!0,o=!1,s=void 0,e.prev=7,a=r[Symbol.iterator]();case 9:if(i=(u=a.next()).done){e.next=44;break}if(!(c=u.value).isDirectory()){e.next=15;break}e.t0={},e.next=18;break;case 15:return e.next=17,c.read();case 17:e.t0=e.sent;case 18:for(l=e.t0,f=c.asFile().relativePathFrom(t).split("/"),p=n,h=!0,d=!1,m=void 0,e.prev=24,v=f.slice(0,-1)[Symbol.iterator]();!(h=(y=v.next()).done);h=!0)g=y.value,p[g]||(p[g]={}),p=p[g];e.next=32;break;case 28:e.prev=28,e.t1=e.catch(24),d=!0,m=e.t1;case 32:e.prev=32,e.prev=33,!h&&v.return&&v.return();case 35:if(e.prev=35,!d){e.next=38;break}throw m;case 38:return e.finish(35);case 39:return e.finish(32);case 40:p[f[f.length-1]]=l;case 41:i=!0,e.next=9;break;case 44:e.next=50;break;case 46:e.prev=46,e.t2=e.catch(7),o=!0,s=e.t2;case 50:e.prev=50,e.prev=51,!i&&a.return&&a.return();case 53:if(e.prev=53,!o){e.next=56;break}throw s;case 56:return e.finish(53);case 57:return e.finish(50);case 58:return e.abrupt("return",n);case 59:case"end":return e.stop()}},e,this,[[7,46,50,58],[24,28,32,40],[33,,35,39],[51,,53,57]])}));return function(t){return e.apply(this,arguments)}}(),X=function(){var e=d(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!("fetch"in System.global&&"Headers"in System.global)){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:if(t=System.decanonicalize("lively.resources"),!System.get("@system-env").node){e.next=16;break}e.prev=4,r=System._nodeRequire("fetch-ponyfill"),e.next=14;break;case 8:return e.prev=8,e.t0=e.catch(4),e.next=12,System.normalize("fetch-ponyfill",t);case 12:n=e.sent.replace("file://",""),r=System._nodeRequire(n);case 14:e.next=19;break;case 16:return e.next=18,System.import("fetch-ponyfill",t);case 18:r=e.sent;case 19:Object.assign(System.global,r());case 20:case"end":return e.stop()}},e,this,[[4,8]])}));return function(){return e.apply(this,arguments)}}();e.resource=f,e.createFiles=Q,e.createFileSpec=Y,e.loadViaScript=function(e,t){var r=document.head,n=r.namespaceURI;return new Promise(function(t,i){var o=document.createElementNS(n,"script");o.setAttribute("type","text/ecmascript"),r.appendChild(o),o.setAttributeNS(null,"id",e),"http://www.w3.org/2000/svg"===o.namespaceURI?o.setAttributeNS("http://www.w3.org/1999/xlink","href",e):o.setAttribute("src",e),o.onload=t,o.onerror=i,o.setAttributeNS(null,"async",!0)})},e.ensureFetch=X,e.registerExtension=p,e.unregisterExtension=function(e){var t="string"==typeof e?e:e.name;K=K.filter(function(e){return e.name!==t})},e.Resource=O,e.parseQuery=n}(this.lively.resources=this.lively.resources||{},"undefined"!=typeof module&&"function"==typeof module.require?module.require("fs"):{readFile:function(){throw new Error("fs module not available")}}),"undefined"!=typeof module&&module.exports&&(module.exports=e.lively.resources)}(),function(){var e=function(){var e={},t={exports:e};return function(r){if("object"==typeof e&&void 0!==t)t.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).PouchDB=r()}}(function(){return function e(t,r,n){function i(s,a){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[s]={exports:{}};t[s][0].call(l.exports,function(e){var r=t[s][1][e];return i(r||e)},l,l.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){"use strict";t.exports=function(e){return function(){var t=arguments.length;if(t){for(var r=[],n=-1;++n<t;)r[n]=arguments[n];return e.call(this,r)}return e.call(this,[])}}},{}],2:[function(e,t,r){(function(n){function i(){var e;try{e=r.storage.debug}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e}(r=t.exports=e(3)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},r.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+r.humanize(this.diff),t){var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,n)}},r.save=function(e){try{null==e?r.storage.removeItem("debug"):r.storage.debug=e}catch(e){}},r.load=i,r.useColors=function(){return!("undefined"==typeof window||!window||void 0===window.process||"renderer"!==window.process.type)||"undefined"!=typeof document&&document&&"WebkitAppearance"in document.documentElement.style||"undefined"!=typeof window&&window&&window.console&&(console.firebug||console.exception&&console.table)||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},r.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),r.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],r.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},r.enable(i())}).call(this,e(9))},{3:3,9:9}],3:[function(e,t,r){function n(e){function t(){if(t.enabled){var e=t,n=+new Date,o=n-(i||n);e.diff=o,e.prev=i,e.curr=n,i=n;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=r.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var u=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(t,n){if("%%"===t)return t;u++;var i=r.formatters[n];if("function"==typeof i){var o=s[u];t=i.call(e,o),s.splice(u,1),u--}return t}),r.formatArgs.call(e,s);(t.log||r.log||console.log.bind(console)).apply(e,s)}}return t.namespace=e,t.enabled=r.enabled(e),t.useColors=r.useColors(),t.color=function(e){var t,n=0;for(t in e)n=(n<<5)-n+e.charCodeAt(t),n|=0;return r.colors[Math.abs(n)%r.colors.length]}(e),"function"==typeof r.init&&r.init(t),t}(r=t.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){r.enable("")},r.enable=function(e){r.save(e),r.names=[],r.skips=[];for(var t=("string"==typeof e?e:"").split(/[\s,]+/),n=t.length,i=0;i<n;i++)t[i]&&("-"===(e=t[i].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")))},r.enabled=function(e){var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=e(8),r.names=[],r.skips=[],r.formatters={};var i},{8:8}],4:[function(e,t,r){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,r,n,a,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(r=this._events[e],s(r))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),r.apply(this,a)}else if(o(r))for(a=Array.prototype.slice.call(arguments,1),n=(c=r.slice()).length,u=0;u<n;u++)c[u].apply(this,a);return!0},n.prototype.addListener=function(e,t){var r;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(r=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var n=!1;return r.listener=t,this.on(e,r),this},n.prototype.removeListener=function(e,t){var r,n,s,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],s=r.length,n=-1,r===t||i(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(r)){for(a=s;a-- >0;)if(r[a]===t||r[a].listener&&r[a].listener===t){n=a;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],i(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],5:[function(e,t,r){(function(e){"use strict";function r(){c=!0;for(var e,t,r=l.length;r;){for(t=l,l=[],e=-1;++e<r;)t[e]();r=l.length}c=!1}var n,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,s=new i(r),a=e.document.createTextNode("");s.observe(a,{characterData:!0}),n=function(){a.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){r(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(r,0)};else{var u=new e.MessageChannel;u.port1.onmessage=r,n=function(){u.port2.postMessage(0)}}var c,l=[];t.exports=function(e){1!==l.push(e)||c||n()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],7:[function(e,t,r){"use strict";function n(){}function i(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=d,this.queue=[],this.outcome=void 0,e!==n&&u(this,e)}function o(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function s(e,t,r){l(function(){var n;try{n=t(r)}catch(t){return f.reject(e,t)}n===e?f.reject(e,new TypeError("Cannot resolve promise with itself")):f.resolve(e,n)})}function a(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function u(e,t){function r(t){i||(i=!0,f.reject(e,t))}function n(t){i||(i=!0,f.resolve(e,t))}var i=!1,o=c(function(){t(n,r)});"error"===o.status&&r(o.value)}function c(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}var l=e(5),f={},p=["REJECTED"],h=["FULFILLED"],d=["PENDING"];t.exports=i,i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){if("function"!=typeof e&&this.state===h||"function"!=typeof t&&this.state===p)return this;var r=new this.constructor(n);if(this.state!==d){s(r,this.state===h?e:t,this.outcome)}else this.queue.push(new o(r,e,t));return r},o.prototype.callFulfilled=function(e){f.resolve(this.promise,e)},o.prototype.otherCallFulfilled=function(e){s(this.promise,this.onFulfilled,e)},o.prototype.callRejected=function(e){f.reject(this.promise,e)},o.prototype.otherCallRejected=function(e){s(this.promise,this.onRejected,e)},f.resolve=function(e,t){var r=c(a,t);if("error"===r.status)return f.reject(e,r.value);var n=r.value;if(n)u(e,n);else{e.state=h,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},f.reject=function(e,t){e.state=p,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},i.resolve=function(e){return e instanceof this?e:f.resolve(new this(n),e)},i.reject=function(e){var t=new this(n);return f.reject(t,e)},i.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var o=new Array(r),s=0,a=-1,u=new this(n);++a<r;)!function(e,n){t.resolve(e).then(function(e){o[n]=e,++s!==r||i||(i=!0,f.resolve(u,o))},function(e){i||(i=!0,f.reject(u,e))})}(e[a],a);return u},i.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var o=-1,s=new this(n);++o<r;)!function(e){t.resolve(e).then(function(e){i||(i=!0,f.resolve(s,e))},function(e){i||(i=!0,f.reject(s,e))})}(e[o]);return s}},{5:5}],8:[function(e,t,r){function n(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var i=1e3,o=60*i,s=60*o,a=24*s,u=365.25*a;t.exports=function(e,t){t=t||{};var r=typeof e;if("string"===r&&e.length>0)return function(e){if(!((e=String(e)).length>1e4)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*u;case"days":case"day":case"d":return r*a;case"hours":case"hour":case"hrs":case"hr":case"h":return r*s;case"minutes":case"minute":case"mins":case"min":case"m":return r*o;case"seconds":case"second":case"secs":case"sec":case"s":return r*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}(e);if("number"===r&&!1===isNaN(e))return t.long?function(e){return n(e,a,"day")||n(e,s,"hour")||n(e,o,"minute")||n(e,i,"second")||e+" ms"}(e):function(e){return e>=a?Math.round(e/a)+"d":e>=s?Math.round(e/s)+"h":e>=o?Math.round(e/o)+"m":e>=i?Math.round(e/i)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],9:[function(e,t,r){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function s(){m&&h&&(m=!1,h.length?d=h.concat(d):v=-1,d.length&&a())}function a(){if(!m){var e=o(s);m=!0;for(var t=d.length;t;){for(h=d,d=[];++v<t;)h&&h[v].run();v=-1,t=d.length}h=null,m=!1,function(e){if(f===clearTimeout)return clearTimeout(e);if((f===i||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}(e)}}function u(e,t){this.fun=e,this.array=t}function c(){}var l,f,p=t.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{f="function"==typeof clearTimeout?clearTimeout:i}catch(e){f=i}}();var h,d=[],m=!1,v=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new u(e,t)),1!==d.length||m||o(a)},u.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=c,p.addListener=c,p.once=c,p.off=c,p.removeListener=c,p.removeAllListeners=c,p.emit=c,p.prependListener=c,p.prependOnceListener=c,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],10:[function(e,t,r){!function(e){if("object"==typeof r)t.exports=e();else{var n;try{n=window}catch(e){n=self}n.SparkMD5=e()}}(function(e){"use strict";function t(e,t){var r=e[0],n=e[1],i=e[2],o=e[3];n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&i)+t[1]-389564586|0)<<12|o>>>20)+r|0)&r|~o&n)+t[2]+606105819|0)<<17|i>>>15)+o|0)&o|~i&r)+t[3]-1044525330|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&i)+t[5]+1200080426|0)<<12|o>>>20)+r|0)&r|~o&n)+t[6]-1473231341|0)<<17|i>>>15)+o|0)&o|~i&r)+t[7]-45705983|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&i)+t[9]-1958414417|0)<<12|o>>>20)+r|0)&r|~o&n)+t[10]-42063|0)<<17|i>>>15)+o|0)&o|~i&r)+t[11]-1990404162|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&i)+t[13]-40341101|0)<<12|o>>>20)+r|0)&r|~o&n)+t[14]-1502002290|0)<<17|i>>>15)+o|0)&o|~i&r)+t[15]+1236535329|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[1]-165796510|0)<<5|r>>>27)+n|0)&i|n&~i)+t[6]-1069501632|0)<<9|o>>>23)+r|0)&n|r&~n)+t[11]+643717713|0)<<14|i>>>18)+o|0)&r|o&~r)+t[0]-373897302|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[5]-701558691|0)<<5|r>>>27)+n|0)&i|n&~i)+t[10]+38016083|0)<<9|o>>>23)+r|0)&n|r&~n)+t[15]-660478335|0)<<14|i>>>18)+o|0)&r|o&~r)+t[4]-405537848|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[9]+568446438|0)<<5|r>>>27)+n|0)&i|n&~i)+t[14]-1019803690|0)<<9|o>>>23)+r|0)&n|r&~n)+t[3]-187363961|0)<<14|i>>>18)+o|0)&r|o&~r)+t[8]+1163531501|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[13]-1444681467|0)<<5|r>>>27)+n|0)&i|n&~i)+t[2]-51403784|0)<<9|o>>>23)+r|0)&n|r&~n)+t[7]+1735328473|0)<<14|i>>>18)+o|0)&r|o&~r)+t[12]-1926607734|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[5]-378558|0)<<4|r>>>28)+n|0)^n^i)+t[8]-2022574463|0)<<11|o>>>21)+r|0)^r^n)+t[11]+1839030562|0)<<16|i>>>16)+o|0)^o^r)+t[14]-35309556|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[1]-1530992060|0)<<4|r>>>28)+n|0)^n^i)+t[4]+1272893353|0)<<11|o>>>21)+r|0)^r^n)+t[7]-155497632|0)<<16|i>>>16)+o|0)^o^r)+t[10]-1094730640|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[13]+681279174|0)<<4|r>>>28)+n|0)^n^i)+t[0]-358537222|0)<<11|o>>>21)+r|0)^r^n)+t[3]-722521979|0)<<16|i>>>16)+o|0)^o^r)+t[6]+76029189|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[9]-640364487|0)<<4|r>>>28)+n|0)^n^i)+t[12]-421815835|0)<<11|o>>>21)+r|0)^r^n)+t[15]+530742520|0)<<16|i>>>16)+o|0)^o^r)+t[2]-995338651|0)<<23|n>>>9)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[0]-198630844|0)<<6|r>>>26)+n|0)|~i))+t[7]+1126891415|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[14]-1416354905|0)<<15|i>>>17)+o|0)|~r))+t[5]-57434055|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[12]+1700485571|0)<<6|r>>>26)+n|0)|~i))+t[3]-1894986606|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[10]-1051523|0)<<15|i>>>17)+o|0)|~r))+t[1]-2054922799|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[8]+1873313359|0)<<6|r>>>26)+n|0)|~i))+t[15]-30611744|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[6]-1560198380|0)<<15|i>>>17)+o|0)|~r))+t[13]+1309151649|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[4]-145523070|0)<<6|r>>>26)+n|0)|~i))+t[11]-1120210379|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[2]+718787259|0)<<15|i>>>17)+o|0)|~r))+t[9]-343485551|0)<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0}function r(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function n(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function i(e){var n,i,o,s,a,u,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=c;n+=64)t(l,r(e.substring(n-64,n)));for(i=(e=e.substring(n-64)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<i;n+=1)o[n>>2]|=e.charCodeAt(n)<<(n%4<<3);if(o[n>>2]|=128<<(n%4<<3),n>55)for(t(l,o),n=0;n<16;n+=1)o[n]=0;return s=8*c,s=s.toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),u=parseInt(s[1],16)||0,o[14]=a,o[15]=u,t(l,o),l}function o(e){var t,r="";for(t=0;t<4;t+=1)r+=l[e>>8*t+4&15]+l[e>>8*t&15];return r}function s(e){var t;for(t=0;t<e.length;t+=1)e[t]=o(e[t]);return e.join("")}function a(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function u(e){var t,r=[],n=e.length;for(t=0;t<n-1;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function c(){this.reset()}var l=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==s(i("hello"))&&function(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r},"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,n){var i,o,s,a,u=this.byteLength,c=t(r,u),l=u;return n!==e&&(l=t(n,u)),c>l?new ArrayBuffer(0):(i=l-c,o=new ArrayBuffer(i),s=new Uint8Array(o),a=new Uint8Array(this,c,i),s.set(a),o)}}(),c.prototype.append=function(e){return this.appendBinary(a(e)),this},c.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var n,i=this._buff.length;for(n=64;n<=i;n+=64)t(this._hash,r(this._buff.substring(n-64,n)));return this._buff=this._buff.substring(n-64),this},c.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(o,i),r=s(this._hash),e&&(r=u(r)),this.reset(),r},c.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},c.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},c.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},c.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},c.prototype._finish=function(e,r){var n,i,o,s=r;if(e[s>>2]|=128<<(s%4<<3),s>55)for(t(this._hash,e),s=0;s<16;s+=1)e[s]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),o=parseInt(n[1],16)||0,e[14]=i,e[15]=o,t(this._hash,e)},c.hash=function(e,t){return c.hashBinary(a(e),t)},c.hashBinary=function(e,t){var r=s(i(e));return t?u(r):r},c.ArrayBuffer=function(){this.reset()},c.ArrayBuffer.prototype.append=function(e){var r,i=function(e,t,r){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e)),n.set(new Uint8Array(t),e.byteLength),r?n:n.buffer}(this._buff.buffer,e,!0),o=i.length;for(this._length+=e.byteLength,r=64;r<=o;r+=64)t(this._hash,n(i.subarray(r-64,r)));return this._buff=r-64<o?new Uint8Array(i.buffer.slice(r-64)):new Uint8Array(0),this},c.ArrayBuffer.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n[t]<<(t%4<<3);return this._finish(o,i),r=s(this._hash),e&&(r=u(r)),this.reset(),r},c.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},c.ArrayBuffer.prototype.getState=function(){var e=c.prototype.getState.call(this);return e.buff=function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}(e.buff),e},c.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var r,n=e.length,i=new ArrayBuffer(n),o=new Uint8Array(i);for(r=0;r<n;r+=1)o[r]=e.charCodeAt(r);return t?o:i}(e.buff,!0),c.prototype.setState.call(this,e)},c.ArrayBuffer.prototype.destroy=c.prototype.destroy,c.ArrayBuffer.prototype._finish=c.prototype._finish,c.ArrayBuffer.hash=function(e,r){var i=s(function(e){var r,i,o,s,a,u,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(r=64;r<=c;r+=64)t(l,n(e.subarray(r-64,r)));for(i=(e=r-64<c?e.subarray(r-64):new Uint8Array(0)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<i;r+=1)o[r>>2]|=e[r]<<(r%4<<3);if(o[r>>2]|=128<<(r%4<<3),r>55)for(t(l,o),r=0;r<16;r+=1)o[r]=0;return s=8*c,s=s.toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),u=parseInt(s[1],16)||0,o[14]=a,o[15]=u,t(l,o),l}(new Uint8Array(e)));return r?u(i):i},c})},{}],11:[function(e,t,r){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);t.exports=function(e,t){var r=t||0,i=n;return i[e[r++]]+i[e[r++]]+i[e[r++]]+i[e[r++]]+"-"+i[e[r++]]+i[e[r++]]+"-"+i[e[r++]]+i[e[r++]]+"-"+i[e[r++]]+i[e[r++]]+"-"+i[e[r++]]+i[e[r++]]+i[e[r++]]+i[e[r++]]+i[e[r++]]+i[e[r++]]}},{}],12:[function(e,t,r){(function(e){var r,n=e.crypto||e.msCrypto;if(n&&n.getRandomValues){var i=new Uint8Array(16);r=function(){return n.getRandomValues(i),i}}if(!r){var o=new Array(16);r=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],13:[function(e,t,r){var n=e(12),i=e(11);t.exports=function(e,t,r){var o=t&&r||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[o+a]=s[a];return t||i(s)}},{11:11,12:12}],14:[function(e,t,r){"use strict";function n(e,t,r){var n=r[r.length-1];e===n.element&&(r.pop(),n=r[r.length-1]);var i=n.element,o=n.index;if(Array.isArray(i))i.push(e);else if(o===t.length-2){i[t.pop()]=e}else t.push(e)}r.stringify=function(e){var t=[];t.push({obj:e});for(var r,n,i,o,s,a,u,c,l,f,p,h="";r=t.pop();)if(n=r.obj,i=r.prefix||"",o=r.val||"",h+=i,o)h+=o;else if("object"!=typeof n)h+=void 0===n?null:JSON.stringify(n);else if(null===n)h+="null";else if(Array.isArray(n)){for(t.push({val:"]"}),s=n.length-1;s>=0;s--)a=0===s?"":",",t.push({obj:n[s],prefix:a});t.push({val:"["})}else{u=[];for(c in n)n.hasOwnProperty(c)&&u.push(c);for(t.push({val:"}"}),s=u.length-1;s>=0;s--)f=n[l=u[s]],p=s>0?",":"",p+=JSON.stringify(l)+":",t.push({obj:f,prefix:p});t.push({val:"{"})}return h},r.parse=function(e){for(var t,r,i,o,s,a,u,c,l,f=[],p=[],h=0;;)if("}"!==(t=e[h++])&&"]"!==t&&void 0!==t)switch(t){case" ":case"\t":case"\n":case":":case",":break;case"n":h+=3,n(null,f,p);break;case"t":h+=3,n(!0,f,p);break;case"f":h+=4,n(!1,f,p);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(r="",h--;;){if(i=e[h++],!/[\d\.\-e\+]/.test(i)){h--;break}r+=i}n(parseFloat(r),f,p);break;case'"':for(o="",s=void 0,a=0;'"'!==(u=e[h++])||"\\"===s&&a%2==1;)o+=u,"\\"===(s=u)?a++:a=0;n(JSON.parse('"'+o+'"'),f,p);break;case"[":c={element:[],index:f.length},f.push(c.element),p.push(c);break;case"{":l={element:{},index:f.length},f.push(l.element),p.push(l);break;default:throw new Error("unexpectedly reached end of input: "+t)}else{if(1===f.length)return f.pop();n(f.pop(),f,p)}}},{}],15:[function(e,t,r){(function(r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function i(e){if(e instanceof ArrayBuffer)return function(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),r=new Uint8Array(t),n=new Uint8Array(e);return r.set(n),t}(e);var t=e.size,r=e.type;return"function"==typeof e.slice?e.slice(0,t,r):e.webkitSlice(0,t,r)}function o(e){var t,r,n;if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(t=[],r=0,n=e.length;r<n;r++)t[r]=o(e[r]);return t}if(e instanceof Date)return e.toISOString();if(function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer||"undefined"!=typeof Blob&&e instanceof Blob}(e))return i(e);if(!function(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var r=t.constructor;return"function"==typeof r&&r instanceof r&&Sr.call(r)==Ar}(e))return e;t={};for(r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var s=o(e[r]);void 0!==s&&(t[r]=s)}return t}function s(e){var t=!1;return vr(function(r){if(t)throw new Error("once called more than once");t=!0,e.apply(this,r)})}function a(e){return vr(function(t){var r=this,n="function"==typeof(t=o(t))[t.length-1]&&t.pop(),i=new Er(function(n,i){var o;try{var a=s(function(e,t){e?i(e):n(t)});t.push(a),(o=e.apply(r,t))&&"function"==typeof o.then&&n(o)}catch(e){i(e)}});return n&&i.then(function(e){n(null,e)},n),i})}function u(e,t){return a(vr(function(r){if(this._closed)return Er.reject(new Error("database is closed"));if(this._destroyed)return Er.reject(new Error("database is destroyed"));var n=this;return function(e,t,r){if(e.constructor.listeners("debug").length){for(var n=["api",e.name,t],i=0;i<r.length-1;i++)n.push(r[i]);e.constructor.emit("debug",n);var o=r[r.length-1];r[r.length-1]=function(r,n){var i=["api",e.name,t];i=i.concat(r?["error",r]:["success",n]),e.constructor.emit("debug",i),o(r,n)}}}(n,e,r),this.taskqueue.isReady?t.apply(this,r):new Er(function(t,i){n.taskqueue.addTask(function(o){o?i(o):t(n[e].apply(n,r))})})}))}function c(e){return"$"+e}function l(e){return e.substring(1)}function f(){this._store={}}function p(e){if(this._store=new f,e&&Array.isArray(e))for(var t=0,r=e.length;t<r;t++)this.add(e[t])}function h(e,t){for(var r={},n=0,i=t.length;n<i;n++){var o=t[n];o in e&&(r[o]=e[o])}return r}function d(e){return e}function m(e){return[{ok:e}]}function v(e,t,r){function n(){++u===a&&function(){var e=[];c.forEach(function(t){t.docs.forEach(function(r){e.push({id:t.id,docs:[r]})})}),r(null,{results:e})}()}function i(){if(!(f>=l.length)){var r=Math.min(f+Or,l.length),o=l.slice(f,r);!function(r,o){r.forEach(function(r,a){var u=o+a,l=s.get(r),f=h(l[0],["atts_since","attachments"]);f.open_revs=l.map(function(e){return e.rev}),f.open_revs=f.open_revs.filter(d);var p=d;0===f.open_revs.length&&(delete f.open_revs,p=m),["revs","attachments","binary","ajax","latest"].forEach(function(e){e in t&&(f[e]=t[e])}),e.get(r,f,function(e,t){var o;o=e?[{error:e}]:p(t),function(e,t,r){c[e]={id:t,docs:r},n()}(u,r,o),i()})})}(o,f),f+=o.length}}var o=t.docs,s=new Cr;o.forEach(function(e){s.has(e.id)?s.get(e.id).push(e):s.set(e.id,[e])});var a=s.size,u=0,c=new Array(a),l=[];s.forEach(function(e,t){l.push(t)});var f=0;i()}function y(){return"undefined"!=typeof chrome&&void 0!==chrome.storage&&void 0!==chrome.storage.local}function g(){return Fr}function b(){yr.EventEmitter.call(this),this._listeners={},function(e){y()?chrome.storage.onChanged.addListener(function(t){null!=t.db_name&&e.emit(t.dbName.newValue)}):g()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(t){e.emit(t.key)}):window.attachEvent("storage",function(t){e.emit(t.key)}))}(this)}function _(e){if("undefined"!==console&&e in console){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function x(e){var t=0;return e||(t=2e3),function(e,t){return e=parseInt(e,10)||0,(t=parseInt(t,10))!=t||t<=e?t=(e||1)<<1:t+=1,t>6e5&&(e=3e5,t=6e5),~~((t-e)*Math.random()+e)}(e,t)}function w(e,t){_("info","The above "+e+" is totally normal. "+t)}function k(e,t,r){Error.call(this,r),this.status=e,this.name=t,this.message=r,this.error=!0}function E(e,t){function r(t){for(var r in e)"function"!=typeof e[r]&&(this[r]=e[r]);void 0!==t&&(this.reason=t)}return r.prototype=k.prototype,new r(t)}function S(e){if("object"!=typeof e){var t=e;(e=Nr).data=t}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}function A(e){var t={},r=e.filter&&"function"==typeof e.filter;return t.query=e.query_params,function(n){n.doc||(n.doc={});var i=r&&function(e,t,r){try{return!e(t,r)}catch(e){var n="Filter function threw: "+e.toString();return E(Wr,n)}}(e.filter,n.doc,t);if("object"==typeof i)return i;if(i)return!1;if(e.include_docs){if(!e.attachments)for(var o in n.doc._attachments)n.doc._attachments.hasOwnProperty(o)&&(n.doc._attachments[o].stub=!0)}else delete n.doc;return!0}}function D(e){for(var t=[],r=0,n=e.length;r<n;r++)t=t.concat(e[r]);return t}function C(e){var t;if(e?"string"!=typeof e?t=E(Pr):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=E(Lr)):t=E(Ir),t)throw t}function F(e){return"boolean"==typeof e._remote?e._remote:"function"==typeof e.type&&(_("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===e.type())}function O(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}function j(e){var t=O(e);return t?t.join("/"):null}function R(e){for(var t=Yr.exec(e),r={},n=14;n--;){var i=Jr[n],o=t[n]||"",s=-1!==["user","password"].indexOf(i);r[i]=s?decodeURIComponent(o):o}return r[Kr]={},r[Jr[12]].replace(Qr,function(e,t,n){t&&(r[Kr][t]=n)}),r}function B(e,t){var r=[],n=[];for(var i in t)t.hasOwnProperty(i)&&(r.push(i),n.push(t[i]));return r.push(e),Function.apply(null,r).apply(null,n)}function T(e,t,r){return new Er(function(n,i){e.get(t,function(o,s){if(o){if(404!==o.status)return i(o);s={}}var a=s._rev,u=r(s);if(!u)return n({updated:!1,rev:a});u._id=t,u._rev=a,n(function(e,t,r){return e.put(t).then(function(e){return{updated:!0,rev:e.rev}},function(n){if(409!==n.status)throw n;return T(e,t._id,r)})}(e,u,r))})})}function P(){return _r().replace(/-/g,"").toLowerCase()}function I(e){for(var t,r,n,i,o=e.rev_tree.slice();i=o.pop();){var s=i.ids,a=s[2],u=i.pos;if(a.length)for(var c=0,l=a.length;c<l;c++)o.push({pos:u+1,ids:a[c]});else{var f=!!s[1].deleted,p=s[0];t&&!(n!==f?n:r!==u?r<u:t<p)||(t=p,r=u,n=f)}}return r+"-"+t}function L(e,t){for(var r,n=e.slice();r=n.pop();)for(var i=r.pos,o=r.ids,s=o[2],a=t(0===s.length,i,o[0],r.ctx,o[1]),u=0,c=s.length;u<c;u++)n.push({pos:i+1,ids:s[u],ctx:a})}function N(e,t){return e.pos-t.pos}function M(e){var t=[];L(e,function(e,r,n,i,o){e&&t.push({rev:r+"-"+n,pos:r,opts:o})}),t.sort(N).reverse();for(var r=0,n=t.length;r<n;r++)delete t[r].pos;return t}function q(e){for(var t=I(e),r=M(e.rev_tree),n=[],i=0,o=r.length;i<o;i++){var s=r[i];s.rev===t||s.opts.deleted||n.push(s.rev)}return n}function $(e){var t=[];return L(e.rev_tree,function(e,r,n,i,o){"available"!==o.status||e||(t.push(r+"-"+n),o.status="missing")}),t}function W(e){for(var t,r=[],n=e.slice();t=n.pop();){var i=t.pos,o=t.ids,s=o[0],a=o[1],u=o[2],c=0===u.length,l=t.history?t.history.slice():[];l.push({id:s,opts:a}),c&&r.push({pos:i+1-l.length,ids:l});for(var f=0,p=u.length;f<p;f++)n.push({pos:i+1,ids:u[f],history:l})}return r.reverse()}function U(e,t){return e.pos-t.pos}function z(e,t,r){var n=function(e,t,r){for(var n,i=0,o=e.length;i<o;)r(e[n=i+o>>>1],t)<0?i=n+1:o=n;return i}(e,t,r);e.splice(n,0,t)}function V(e,t){for(var r,n,i=t,o=e.length;i<o;i++){var s=e[i],a=[s.id,s.opts,[]];n?(n[2].push(a),n=a):r=n=a}return r}function G(e,t){return e[0]<t[0]?-1:1}function H(e,t){for(var r=[{tree1:e,tree2:t}],n=!1;r.length>0;){var i=r.pop(),o=i.tree1,s=i.tree2;(o[1].status||s[1].status)&&(o[1].status="available"===o[1].status||"available"===s[1].status?"available":"missing");for(var a=0;a<s[2].length;a++)if(o[2][0]){for(var u=!1,c=0;c<o[2].length;c++)o[2][c][0]===s[2][a][0]&&(r.push({tree1:o[2][c],tree2:s[2][a]}),u=!0);u||(n="new_branch",z(o[2],s[2][a],G))}else n="new_leaf",o[2][0]=s[2][a]}return{conflicts:n,tree:e}}function J(e,t,r){var n,i=[],o=!1,s=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var a=0,u=e.length;a<u;a++){var c=e[a];if(c.pos===t.pos&&c.ids[0]===t.ids[0])n=H(c.ids,t.ids),i.push({pos:c.pos,ids:n.tree}),o=o||n.conflicts,s=!0;else if(!0!==r){var l=c.pos<t.pos?c:t,f=c.pos<t.pos?t:c,p=f.pos-l.pos,h=[],d=[];for(d.push({ids:l.ids,diff:p,parent:null,parentIdx:null});d.length>0;){var m=d.pop();if(0!==m.diff)for(var v=m.ids[2],y=0,g=v.length;y<g;y++)d.push({ids:v[y],diff:m.diff-1,parent:m.ids,parentIdx:y});else m.ids[0]===f.ids[0]&&h.push(m)}var b=h[0];b?(n=H(b.ids,f.ids),b.parent[2][b.parentIdx]=n.tree,i.push({pos:l.pos,ids:l.ids}),o=o||n.conflicts,s=!0):i.push(c)}else i.push(c)}return s||i.push(t),i.sort(U),{tree:i,conflicts:o||"internal_node"}}function K(e,t,r){var n=J(e,t),i=function(e,t){for(var r,n,i=W(e),o=0,s=i.length;o<s;o++){var a,u=i[o],c=u.ids;if(c.length>t){r||(r={});var l=c.length-t;a={pos:u.pos+l,ids:V(c,l)};for(var f=0;f<l;f++){var p=u.pos+f+"-"+c[f].id;r[p]=!0}}else a={pos:u.pos,ids:V(c,0)};n=n?J(n,a,!0).tree:[a]}return r&&L(n,function(e,t,n){delete r[t+"-"+n]}),{tree:n,revs:r?Object.keys(r):[]}}(n.tree,r);return{tree:i.tree,stemmedRevs:i.revs,conflicts:n.conflicts}}function Q(e){return e.ids}function Y(e,t){t||(t=I(e));for(var r,n=t.substring(t.indexOf("-")+1),i=e.rev_tree.map(Q);r=i.pop();){if(r[0]===n)return!!r[1].deleted;i=i.concat(r[2])}}function X(e){return/^_local/.test(e)}function Z(e,t){for(var r,n=t.rev_tree.slice();r=n.pop();){var i=r.pos,o=r.ids,s=o[0],a=o[1],u=o[2],c=0===u.length,l=r.history?r.history.slice():[];if(l.push({id:s,pos:i,opts:a}),c)for(var f=0,p=l.length;f<p;f++){var h=l[f];if(h.pos+"-"+h.id===e)return i+"-"+s}for(var d=0,m=u.length;d<m;d++)n.push({pos:i+1,ids:u[d],history:l})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}function ee(e,t,r){function n(){i.cancel()}yr.EventEmitter.call(this);var i=this;this.db=e;var a=(t=t?o(t):{}).complete=s(function(t,r){t?function(e,t){return"listenerCount"in e?e.listenerCount(t):yr.EventEmitter.listenerCount(e,t)}(i,"error")>0&&i.emit("error",t):i.emit("complete",r),i.removeAllListeners(),e.removeListener("destroyed",n)});r&&(i.on("complete",function(e){r(null,e)}),i.on("error",r)),e.once("destroyed",n),t.onChange=function(e){i.isCancelled||function(e,t){try{e.emit("change",t)}catch(e){_("error",'Error in .on("change", function):',e)}}(i,e)};var u=new Er(function(e,r){t.complete=function(t,n){t?r(t):e(n)}});i.once("cancel",function(){e.removeListener("destroyed",n),t.complete(null,{status:"cancelled"})}),this.then=u.then.bind(u),this.catch=u.catch.bind(u),this.then(function(e){a(null,e)},a),e.taskqueue.isReady?i.validateChanges(t):e.taskqueue.addTask(function(e){e?t.complete(e):i.isCancelled?i.emit("cancel"):i.validateChanges(t)})}function te(e,t,r){var n=[{rev:e._rev}];"all_docs"===r.style&&(n=M(t.rev_tree).map(function(e){return{rev:e.rev}}));var i={id:t.id,changes:n,doc:e};return Y(t,e._rev)&&(i.deleted=!0),r.conflicts&&(i.doc._conflicts=q(t),i.doc._conflicts.length||delete i.doc._conflicts),i}function re(e,t){return e<t?-1:e>t?1:0}function ne(e,t){return function(r,n){r||n[0]&&n[0].error?((r=r||n[0]).docId=t,e(r)):e(null,n.length?n[0]:n)}}function ie(e,t){var r=re(e._id,t._id);if(0!==r)return r;return re(e._revisions?e._revisions.start:0,t._revisions?t._revisions.start:0)}function oe(e){var t=e._compactionQueue[0],r=t.opts,n=t.callback;e.get("_local/compaction").catch(function(){return!1}).then(function(t){t&&t.last_seq&&(r.last_seq=t.last_seq),e._compact(r,function(t,r){t?n(t):n(null,r),br(function(){e._compactionQueue.shift(),e._compactionQueue.length&&oe(e)})})})}function se(){yr.EventEmitter.call(this)}function ae(){this.isReady=!1,this.failed=!1,this.queue=[]}function ue(e,t){if(!(this instanceof ue))return new ue(e,t);var r=this;if(t=t||{},e&&"object"==typeof e&&(e=(t=e).name,delete t.name),this.__opts=t=o(t),r.auto_compaction=t.auto_compaction,r.prefix=ue.prefix,"string"!=typeof e)throw new Error("Missing/invalid DB name");var n=function(e,t){var r=e.match(/([a-z-]*):\/\/(.*)/);if(r)return{name:/https?/.test(r[1])?r[1]+"://"+r[2]:r[2],adapter:r[1]};var n=ue.adapters,i=ue.preferredAdapters,o=ue.prefix,s=t.adapter;if(!s)for(var a=0;a<i.length&&"idb"===(s=i[a])&&"websql"in n&&g()&&localStorage["_pouch__websqldb_"+o+e];++a)_("log",'PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');var u=n[s];return{name:u&&"use_prefix"in u&&!u.use_prefix?e:o+e,adapter:s}}((t.prefix||"")+e,t);if(t.name=n.name,t.adapter=t.adapter||n.adapter,r.name=e,r._adapter=t.adapter,ue.emit("debug",["adapter","Picked adapter: ",t.adapter]),!ue.adapters[t.adapter]||!ue.adapters[t.adapter].valid())throw new Error("Invalid Adapter: "+t.adapter);se.call(r),r.taskqueue=new ae,r.adapter=t.adapter,ue.adapters[t.adapter].call(r,t,function(e){if(e)return r.taskqueue.fail(e);!function(e){function t(t){e.removeListener("closed",r),t||e.constructor.emit("destroyed",e.name)}function r(){e.removeListener("destroyed",t),e.constructor.emit("unref",e)}e.once("destroyed",t),e.once("closed",r),e.constructor.emit("ref",e)}(r),r.emit("created",r),ue.emit("created",r.name),r.taskqueue.ready(r)})}function ce(e,t){for(var r=e,n=0,i=t.length;n<i;n++){if(!(r=r[t[n]]))break}return r}function le(e){for(var t=[],r="",n=0,i=e.length;n<i;n++){var o=e[n];"."===o?n>0&&"\\"===e[n-1]?r=r.substring(0,r.length-1)+".":(t.push(r),r=""):r+=o}return t.push(r),t}function fe(e){return en.indexOf(e)>-1}function pe(e){return Object.keys(e)[0]}function he(e){var t={};return e.forEach(function(e){Object.keys(e).forEach(function(r){var n=e[r];if("object"!=typeof n&&(n={$eq:n}),fe(r))n instanceof Array?t[r]=n.map(function(e){return he([e])}):t[r]=he([n]);else{var i=t[r]=t[r]||{};Object.keys(n).forEach(function(e){var t=n[e];return"$gt"===e||"$gte"===e?function(e,t,r){if(void 0!==r.$eq)return;void 0!==r.$gte?"$gte"===e?t>r.$gte&&(r.$gte=t):t>=r.$gte&&(delete r.$gte,r.$gt=t):void 0!==r.$gt?"$gte"===e?t>r.$gt&&(delete r.$gt,r.$gte=t):t>r.$gt&&(r.$gt=t):r[e]=t}(e,t,i):"$lt"===e||"$lte"===e?function(e,t,r){if(void 0!==r.$eq)return;void 0!==r.$lte?"$lte"===e?t<r.$lte&&(r.$lte=t):t<=r.$lte&&(delete r.$lte,r.$lt=t):void 0!==r.$lt?"$lte"===e?t<r.$lt&&(delete r.$lt,r.$lte=t):t<r.$lt&&(r.$lt=t):r[e]=t}(e,t,i):"$ne"===e?function(e,t){"$ne"in t?t.$ne.push(e):t.$ne=[e]}(t,i):"$eq"===e?function(e,t){delete t.$gt,delete t.$gte,delete t.$lt,delete t.$lte,delete t.$ne,t.$eq=e}(t,i):void(i[e]=t)})}})}),t}function de(e,t){if(e===t)return 0;e=me(e),t=me(t);var r=_e(e),n=_e(t);if(r-n!=0)return r-n;switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return function(e,t){return e===t?0:e>t?1:-1}(e,t)}return Array.isArray(e)?function(e,t){for(var r=Math.min(e.length,t.length),n=0;n<r;n++){var i=de(e[n],t[n]);if(0!==i)return i}return e.length===t.length?0:e.length>t.length?1:-1}(e,t):function(e,t){for(var r=Object.keys(e),n=Object.keys(t),i=Math.min(r.length,n.length),o=0;o<i;o++){var s=de(r[o],n[o]);if(0!==s)return s;if(0!==(s=de(e[r[o]],t[n[o]])))return s}return r.length===n.length?0:r.length>n.length?1:-1}(e,t)}function me(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var r=e.length;e=new Array(r);for(var n=0;n<r;n++)e[n]=me(t[n])}else{if(e instanceof Date)return e.toJSON();if(null!==e){e={};for(var i in t)if(t.hasOwnProperty(i)){var o=t[i];void 0!==o&&(e[i]=me(o))}}}}return e}function ve(e){if(null!==e)switch(typeof e){case"boolean":return e?1:0;case"number":return function(e){if(0===e)return"1";var t=e.toExponential().split(/e\+?/),r=parseInt(t[1],10),n=e<0,i=n?"0":"2",o=function(e,t,r){return function(e,t,r){for(var n="",i=r-e.length;n.length<i;)n+=t;return n}(e,t,r)+e}(((n?-r:r)-tn).toString(),"0",rn);i+=nn+o;var s=Math.abs(parseFloat(t[0]));n&&(s=10-s);var a=s.toFixed(20);return a=a.replace(/\.?0+$/,""),i+=nn+a}(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),r=t?e:Object.keys(e),n=-1,i=r.length,o="";if(t)for(;++n<i;)o+=ye(r[n]);else for(;++n<i;){var s=r[n];o+=ye(s)+ye(e[s])}return o}return""}function ye(e){return e=me(e),_e(e)+nn+ve(e)+"\0"}function ge(e,t){var r,n=t;if("1"===e[t])r=0,t++;else{var i="0"===e[t];t++;var o="",s=e.substring(t,t+rn),a=parseInt(s,10)+tn;for(i&&(a=-a),t+=rn;;){var u=e[t];if("\0"===u)break;o+=u,t++}r=1===(o=o.split(".")).length?parseInt(o,10):parseFloat(o[0]+"."+o[1]),i&&(r-=10),0!==a&&(r=parseFloat(r+"e"+a))}return{num:r,length:t-n}}function be(e,t){var r=e.pop();if(t.length){var n=t[t.length-1];r===n.element&&(t.pop(),n=t[t.length-1]);var i=n.element,o=n.index;if(Array.isArray(i))i.push(r);else if(o===e.length-2){i[e.pop()]=r}else e.push(r)}}function _e(e){var t=["boolean","number","string","object"].indexOf(typeof e);return~t?null===e?1:Array.isArray(e)?5:t<3?t+2:t+3:Array.isArray(e)?5:void 0}function xe(e,t,r){if(e=e.filter(function(e){return we(e.doc,t.selector,r)}),t.sort){var n=function(e){function t(t){return e.map(function(e){var r=le(pe(e));return ce(t,r)})}return function(e,r){var n=de(t(e.doc),t(r.doc));return 0!==n?n:function(e,t){return e<t?-1:e>t?1:0}(e.doc._id,r.doc._id)}}(t.sort);e=e.sort(n),"string"!=typeof t.sort[0]&&"desc"===function(e){return e[pe(e)]}(t.sort[0])&&(e=e.reverse())}if("limit"in t||"skip"in t){var i=t.skip||0,o=("limit"in t?t.limit:e.length)+i;e=e.slice(i,o)}return e}function we(e,t,r){return r.every(function(r){var n=t[r],i=le(r),o=ce(e,i);return fe(r)?function(e,t,r){if("$or"===e)return t.some(function(e){return we(r,e,Object.keys(e))});if("$not"===e)return!we(r,t,Object.keys(t));return!t.find(function(e){return we(r,e,Object.keys(e))})}(r,n,e):ke(n,e,i,o)})}function ke(e,t,r,n){return!e||Object.keys(e).every(function(i){var o=e[i];return function(e,t,r,n,i){if(!on[e])throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return on[e](t,r,n,i)}(i,t,o,r,n)})}function Ee(e){return void 0!==e&&null!==e}function Se(e){return void 0!==e}function Ae(e,t){return t.some(function(t){return e instanceof Array?e.indexOf(t)>-1:e===t})}function De(e,t){if("object"!=typeof t)throw new Error("Selector error: expected a JSON object");var r=xe([{doc:e}],{selector:t=function(e){var t=o(e),r=!1;"$and"in t&&(t=he(t.$and),r=!0),["$or","$nor"].forEach(function(e){e in t&&t[e].forEach(function(e){for(var t=Object.keys(e),r=0;r<t.length;r++){var n=t[r],i=e[n];"object"==typeof i&&null!==i||(e[n]={$eq:i})}})}),"$not"in t&&(t.$not=he([t.$not]));for(var n=Object.keys(t),i=0;i<n.length;i++){var s=n[i],a=t[s];"object"!=typeof a||null===a?a={$eq:a}:"$ne"in a&&!r&&(a.$ne=[a.$ne]),t[s]=a}return t}(t)},Object.keys(t));return r&&1===r.length}function Ce(e,t){if(e.selector&&e.filter&&"_selector"!==e.filter){var r="string"==typeof e.filter?e.filter:"function";return t(new Error('selector invalid for filter "'+r+'"'))}t()}function Fe(e){e.view&&!e.filter&&(e.filter="_view"),e.selector&&!e.filter&&(e.filter="_selector"),e.filter&&"string"==typeof e.filter&&("_view"===e.filter?e.view=j(e.view):e.filter=j(e.filter))}function Oe(e,t){return t.filter&&"string"==typeof t.filter&&!t.doc_ids&&!F(e.db)}function je(e,t){var r=t.complete;if("_view"===t.filter){if(!t.view||"string"!=typeof t.view){var n=E(Wr,"`view` filter parameter not found or invalid.");return r(n)}var i=O(t.view);e.db.get("_design/"+i[0],function(n,o){if(e.isCancelled)return r(null,{status:"cancelled"});if(n)return r(S(n));var s=o&&o.views&&o.views[i[1]]&&o.views[i[1]].map;if(!s)return r(E(Br,o.views?"missing json key: "+i[1]:"missing json key: views"));t.filter=function(e){return B(["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+e+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n"),{})}(s),e.doChanges(t)})}else if(t.selector)t.filter=function(e){return De(e,t.selector)},e.doChanges(t);else{var o=O(t.filter);e.db.get("_design/"+o[0],function(n,i){if(e.isCancelled)return r(null,{status:"cancelled"});if(n)return r(S(n));var s=i&&i.filters&&i.filters[o[1]];if(!s)return r(E(Br,i&&i.filters?"missing json key: "+o[1]:"missing json key: filters"));t.filter=function(e){return B('"use strict";\nreturn '+e+";",{})}(s),e.doChanges(t)})}}function Re(e){return e.reduce(function(e,t){return e[t]=!0,e},{})}function Be(e){if(!/^\d+-./.test(e))return E(Gr);var t=e.indexOf("-"),r=e.substring(0,t),n=e.substring(t+1);return{prefix:parseInt(r,10),id:n}}function Te(e,t){var r,n,i,o={status:"available"};if(e._deleted&&(o.deleted=!0),t)if(e._id||(e._id=Xr()),n=P(),e._rev){if((i=Be(e._rev)).error)return i;e._rev_tree=[{pos:i.prefix,ids:[i.id,{status:"missing"},[[n,o,[]]]]}],r=i.prefix+1}else e._rev_tree=[{pos:1,ids:[n,o,[]]}],r=1;else if(e._revisions&&(e._rev_tree=function(e,t){for(var r=e.start-e.ids.length+1,n=e.ids,i=[n[0],t,[]],o=1,s=n.length;o<s;o++)i=[n[o],{status:"missing"},[i]];return[{pos:r,ids:i}]}(e._revisions,o),r=e._revisions.start,n=e._revisions.ids[0]),!e._rev_tree){if((i=Be(e._rev)).error)return i;r=i.prefix,n=i.id,e._rev_tree=[{pos:r,ids:[n,o,[]]}]}C(e._id),e._rev=r+"-"+n;var s={metadata:{},data:{}};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var u="_"===a[0];if(u&&!an[a]){var c=E($r,a);throw c.message=$r.message+": "+a,c}u&&!un[a]?s.metadata[a.slice(1)]=e[a]:s.data[a]=e[a]}return s}function Pe(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)r.append(e[n]);return r.getBlob(t.type)}}function Ie(e,t){return Pe([function(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),i=0;i<t;i++)n[i]=e.charCodeAt(i);return r}(e)],{type:t})}function Le(e,t){return Ie(cn(e),t)}function Ne(e){for(var t="",r=new Uint8Array(e),n=r.byteLength,i=0;i<n;i++)t+=String.fromCharCode(r[i]);return t}function Me(e,t){if("undefined"==typeof FileReader)return t(Ne((new FileReaderSync).readAsArrayBuffer(e)));var r=new FileReader,n="function"==typeof r.readAsBinaryString;r.onloadend=function(e){var r=e.target.result||"";if(n)return t(r);t(Ne(r))},n?r.readAsBinaryString(e):r.readAsArrayBuffer(e)}function qe(e,t){Me(e,function(e){t(e)})}function $e(e,t){qe(e,function(e){t(ln(e))})}function We(e,t){if("undefined"==typeof FileReader)return t((new FileReaderSync).readAsArrayBuffer(e));var r=new FileReader;r.onloadend=function(e){var r=e.target.result||new ArrayBuffer(0);t(r)},r.readAsArrayBuffer(e)}function Ue(e,t){function r(){fn(i)}function n(){var e=function(e){return ln(e)}(l.end(!0));t(e),l.destroy()}function i(){var t=c*a,i=t+a;++c<u?f(l,e,t,i,r):f(l,e,t,i,n)}var o="string"==typeof e,s=o?e.length:e.size,a=Math.min(pn,s),u=Math.ceil(s/a),c=0,l=o?new wr:new wr.ArrayBuffer,f=o?function(e,t,r,n,i){(r>0||n<t.length)&&(t=t.substring(r,n)),e.appendBinary(t),i()}:function(e,t,r,n,i){(r>0||n<t.size)&&(t=function(e,t,r){return e.webkitSlice?e.webkitSlice(t,r):e.slice(t,r)}(t,r,n)),We(t,function(t){e.append(t),i()})};i()}function ze(e,t,r){var n=function(e){try{return cn(e)}catch(e){return{error:E(Mr,"Attachment is not a valid base64 string")}}}(e.data);if(n.error)return r(n.error);e.length=n.length,e.data="blob"===t?Ie(n,e.content_type):"base64"===t?ln(n):n,Ue(n,function(t){e.digest="md5-"+t,r()})}function Ve(e,t,r){if(e.stub)return r();"string"==typeof e.data?ze(e,t,r):function(e,t,r){Ue(e.data,function(n){e.digest="md5-"+n,e.length=e.data.size||e.data.length||0,"binary"===t?qe(e.data,function(t){e.data=t,r()}):"base64"===t?$e(e.data,function(t){e.data=t,r()}):r()})}(e,t,r)}function Ge(e,t,r){function n(){o++,e.length===o&&(i?r(i):r())}if(!e.length)return r();var i,o=0;e.forEach(function(e){function r(e){i=e,++s===o.length&&n()}var o=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],s=0;if(!o.length)return n();for(var a in e.data._attachments)e.data._attachments.hasOwnProperty(a)&&Ve(e.data._attachments[a],t,r)})}function He(e,t,r,n,i,o,s,a){if(function(e,t){for(var r,n=e.slice(),i=t.split("-"),o=parseInt(i[0],10),s=i[1];r=n.pop();){if(r.pos===o&&r.ids[0]===s)return!0;for(var a=r.ids[2],u=0,c=a.length;u<c;u++)n.push({pos:r.pos+1,ids:a[u]})}return!1}(t.rev_tree,r.metadata.rev))return n[i]=r,o();var u=t.winningRev||I(t),c="deleted"in t?t.deleted:Y(t,u),l="deleted"in r.metadata?r.metadata.deleted:Y(r.metadata),f=/^1-/.test(r.metadata.rev);if(c&&!l&&a&&f){var p=r.data;p._rev=u,p._id=r.metadata.id,r=Te(p,a)}var h=K(t.rev_tree,r.metadata.rev_tree[0],e);if(a&&(c&&l&&"new_leaf"!==h.conflicts||!c&&"new_leaf"!==h.conflicts||c&&!l&&"new_branch"===h.conflicts)){var d=E(Tr);return n[i]=d,o()}var m=r.metadata.rev;r.metadata.rev_tree=h.tree,r.stemmedRevs=h.stemmedRevs||[],t.rev_map&&(r.metadata.rev_map=t.rev_map);var v=I(r.metadata),y=Y(r.metadata,v),g=c===y?0:c<y?-1:1;s(r,v,y,m===v?y:Y(r.metadata,m),!0,g,i,o)}function Je(e,t,r,n,i,o,s,a,u){function c(){++p===h&&u&&u()}e=e||1e3;var l=a.new_edits,f=new Cr,p=0,h=t.length;t.forEach(function(e,t){if(e._id&&X(e._id)){var n=e._deleted?"_removeLocal":"_putLocal";r[n](e,{ctx:i},function(e,r){o[t]=e||r,c()})}else{var s=e.metadata.id;f.has(s)?(h--,f.get(s).push([e,t])):f.set(s,[[e,t]])}}),f.forEach(function(t,r){function i(){++f<t.length?u():c()}function u(){var u=t[f],c=u[0],p=u[1];if(n.has(r))He(e,n.get(r),c,o,p,i,s,l);else{var h=K([],c.metadata.rev_tree[0],e);c.metadata.rev_tree=h.tree,c.stemmedRevs=h.stemmedRevs||[],function(e,t,r){var n=I(e.metadata),i=Y(e.metadata,n);if("was_delete"in a&&i)return o[t]=E(Br,"deleted"),r();if(l&&function(e){return"missing"===e.metadata.rev_tree[0].ids[1].status}(e)){var u=E(Tr);return o[t]=u,r()}s(e,n,i,i,!1,i?0:1,t,r)}(c,p,i)}}var f=0;u()})}function Ke(e){try{return JSON.parse(e)}catch(t){return kr.parse(e)}}function Qe(e){try{return JSON.stringify(e)}catch(t){return kr.stringify(e)}}function Ye(e){return function(t){var r="unknown_error";t.target&&t.target.error&&(r=t.target.error.name||t.target.error.message),e(E(zr,r,t.type))}}function Xe(e,t,r){return{data:Qe(e),winningRev:t,deletedOrLocal:r?"1":"0",seq:e.seq,id:e.id}}function Ze(e){if(!e)return null;var t=Ke(e.data);return t.winningRev=e.winningRev,t.deleted="1"===e.deletedOrLocal,t.seq=e.seq,t}function et(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function tt(e,t,r,n){r?n(e?"string"!=typeof e?e:Le(e,t):Pe([""],{type:t})):e?"string"!=typeof e?Me(e,function(e){n(ln(e))}):n(e):n("")}function rt(e,t,r,n){function i(){++s===o.length&&n&&n()}var o=Object.keys(e._attachments||{});if(!o.length)return n&&n();var s=0;o.forEach(function(n){t.attachments&&t.include_docs?function(e,t){var n=e._attachments[t],o=n.digest;r.objectStore(vn).get(o).onsuccess=function(e){n.body=e.target.result.body,i()}}(e,n):(e._attachments[n].stub=!0,i())})}function nt(e,t){return Er.all(e.map(function(e){if(e.doc&&e.doc._attachments){var r=Object.keys(e.doc._attachments);return Er.all(r.map(function(r){var n=e.doc._attachments[r];if("body"in n){var i=n.body,o=n.content_type;return new Er(function(s){tt(i,o,t,function(t){e.doc._attachments[r]=jr(h(n,["digest","content_type"]),{data:t}),s()})})}}))}}))}function it(e,t,r){function n(){--u||function(){if(!i.length)return;i.forEach(function(e){var t=a.index("digestSeq").count(IDBKeyRange.bound(e+"::",e+"::",!1,!1));t.onsuccess=function(t){var r=t.target.result;r||s.delete(e)}})}()}var i=[],o=r.objectStore(mn),s=r.objectStore(vn),a=r.objectStore(yn),u=e.length;e.forEach(function(e){var r=o.index("_doc_id_rev"),s=t+"::"+e;r.getKey(s).onsuccess=function(e){var t=e.target.result;if("number"!=typeof t)return n();o.delete(t);a.index("seq").openCursor(IDBKeyRange.only(t)).onsuccess=function(e){var t=e.target.result;if(t){var r=t.value.digestSeq.split("::")[0];i.push(r),a.delete(t.primaryKey),t.continue()}else n()}}})}function ot(e,t,r){try{return{txn:e.transaction(t,r)}}catch(e){return{error:e}}}function st(e,t,r,n,i,o){function s(){var t=ot(i,[dn,mn,vn,bn,yn,gn],"readwrite");if(t.error)return o(t.error);(p=t.txn).onabort=Ye(o),p.ontimeout=Ye(o),p.oncomplete=c,h=p.objectStore(dn),d=p.objectStore(mn),m=p.objectStore(vn),v=p.objectStore(yn),(y=p.objectStore(gn)).get(gn).onsuccess=function(e){b=e.target.result,u()},function(e){var t=[];if(_.forEach(function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach(function(r){var n=e.data._attachments[r];n.stub&&t.push(n.digest)})}),!t.length)return e();var r,n=0;t.forEach(function(i){!function(e,t){m.get(e).onsuccess=function(r){if(r.target.result)t();else{var n=E(Hr,"unknown stub attachment with digest "+e);n.status=412,t(n)}}}(i,function(i){i&&!r&&(r=i),++n===t.length&&e(r)})})}(function(t){if(t)return F=!0,o(t);!function(){function t(){++o===_.length&&Je(e.revs_limit,_,n,C,p,D,l,r,a)}function i(e){var r=Ze(e.target.result);r&&C.set(r.id,r),t()}if(!_.length)return;var o=0;for(var s=0,u=_.length;s<u;s++){var c=_[s];if(c._id&&X(c._id))t();else{var f=h.get(c.metadata.id);f.onsuccess=i}}}()})}function a(){S=!0,u()}function u(){b&&S&&(b.docCount+=A,y.put(b))}function c(){F||(xn.notify(n._meta.name),o(null,D))}function l(e,t,r,n,i,o,s,a){e.metadata.winningRev=t,e.metadata.deleted=r;var c=e.data;c._id=e.metadata.id,c._rev=e.metadata.rev,n&&(c._deleted=!0);if(c._attachments&&Object.keys(c._attachments).length)return function(e,t,r,n,i,o){function s(){c===l.length&&f(e,t,r,n,i,o)}function a(){c++,s()}var u=e.data,c=0,l=Object.keys(u._attachments);l.forEach(function(r){var n=e.data._attachments[r];if(n.stub)c++,s();else{var i=n.data;delete n.data,n.revpos=parseInt(t,10);var o=n.digest;!function(e,t,r){m.count(e).onsuccess=function(n){var i=n.target.result;if(i)return r();var o={digest:e,body:t},s=m.put(o);s.onsuccess=r}}(o,i,a)}})}(e,t,r,i,s,a);A+=o,u(),f(e,t,r,i,s,a)}function f(e,t,r,i,o,s){function a(o){var s=e.stemmedRevs||[];i&&n.auto_compaction&&(s=s.concat($(e.metadata))),s&&s.length&&it(s,e.metadata.id,p),l.seq=o.target.result;var a=Xe(l,t,r);h.put(a).onsuccess=u}function u(){D[o]={ok:!0,id:l.id,rev:l.rev},C.set(e.metadata.id,e.metadata),function(e,t,r){function n(){++o===s.length&&r()}function i(r){var i=e.data._attachments[r].digest,o=v.put({seq:t,digestSeq:i+"::"+t});o.onsuccess=n,o.onerror=function(e){e.preventDefault(),e.stopPropagation(),n()}}var o=0,s=Object.keys(e.data._attachments||{});if(!s.length)return r();for(var a=0;a<s.length;a++)i(s[a])}(e,l.seq,s)}var c=e.data,l=e.metadata;c._doc_id_rev=l.id+"::"+l.rev,delete c._id,delete c._rev;var f=d.put(c);f.onsuccess=a,f.onerror=function(e){e.preventDefault(),e.stopPropagation(),d.index("_doc_id_rev").getKey(c._doc_id_rev).onsuccess=function(e){d.put(c,e.target.result).onsuccess=a}}}for(var p,h,d,m,v,y,g,b,_=t.docs,x=0,w=_.length;x<w;x++){var k=_[x];k._id&&X(k._id)||(k=_[x]=Te(k,r.new_edits)).error&&!g&&(g=k)}if(g)return o(g);var S=!1,A=0,D=new Array(_.length),C=new Cr,F=!1,O=n._meta.blobSupport?"blob":"base64";Ge(_,O,function(e){if(e)return o(e);s()})}function at(e,t,r,n,i){function o(e){l=e.target.result,c&&i(c,l,f)}function s(e){c=e.target.result,l&&i(c,l,f)}function a(){if(!c.length)return i();var r,a=c[c.length-1];if(t&&t.upper)try{r=IDBKeyRange.bound(a,t.upper,!0,t.upperOpen)}catch(e){if("DataError"===e.name&&0===e.code)return i()}else r=IDBKeyRange.lowerBound(a,!0);t=r,c=null,l=null,e.getAll(t,n).onsuccess=o,e.getAllKeys(t,n).onsuccess=s}function u(e){var t=e.target.result;if(!t)return i();i([t.key],[t.value],t)}var c,l,f;"function"==typeof e.getAll&&"function"==typeof e.getAllKeys&&n>1&&!r?(f={continue:a},e.getAll(t,n).onsuccess=o,e.getAllKeys(t,n).onsuccess=s):r?e.openCursor(t,"prev").onsuccess=u:e.openCursor(t).onsuccess=u}function ut(e,t,r){function n(t,r,n){var i=t.id+"::"+n;w.get(i).onsuccess=function(n){if(r.doc=et(n.target.result),e.conflicts){var i=q(t);i.length&&(r.doc._conflicts=i)}rt(r.doc,e,y)}}function i(t,r){var i={id:r.id,key:r.id,value:{rev:t}},o=r.deleted;"ok"===e.deleted?(k.push(i),o?(i.value.deleted=!0,i.doc=null):e.include_docs&&n(r,i,t)):!o&&f--<=0&&(k.push(i),e.include_docs&&n(r,i,t))}function o(e){for(var t=0,r=e.length;t<r&&k.length!==p;t++){var n=Ze(e[t]);i(n.winningRev,n)}}function s(t){var r=t.target.result;e.descending&&(r=r.reverse()),o(r)}function a(){r(null,{total_rows:g,offset:e.skip,rows:k})}var u="startkey"in e&&e.startkey,c="endkey"in e&&e.endkey,l="key"in e&&e.key,f=e.skip||0,p="number"==typeof e.limit?e.limit:-1,h=function(e,t,r,n,i){try{if(e&&t)return i?IDBKeyRange.bound(t,e,!r,!1):IDBKeyRange.bound(e,t,!1,!r);if(e)return i?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return i?IDBKeyRange.lowerBound(t,!r):IDBKeyRange.upperBound(t,!r);if(n)return IDBKeyRange.only(n)}catch(e){return{error:e}}return null}(u,c,!1!==e.inclusive_end,l,e.descending),d=h&&h.error;if(d&&("DataError"!==d.name||0!==d.code))return r(E(zr,d.name,d.message));var m=[dn,mn,gn];e.attachments&&m.push(vn);var v=ot(t,m,"readonly");if(v.error)return r(v.error);var y=v.txn;y.oncomplete=function(){e.attachments?nt(k,e.binary).then(a):a()},y.onabort=Ye(r);var g,b=y.objectStore(dn),_=y.objectStore(mn),x=y.objectStore(gn),w=_.index("_doc_id_rev"),k=[];return x.get(gn).onsuccess=function(e){g=e.target.result.docCount},d||0===p?void 0:-1===p?function(e,t,r){if("function"!=typeof e.getAll){var n=[];e.openCursor(t).onsuccess=function(e){var t=e.target.result;t?(n.push(t.value),t.continue()):r({target:{result:n}})}}else e.getAll(t).onsuccess=r}(b,h,s):void at(b,h,e.descending,p+f,function(e,t,r){r&&(o(t),k.length<p&&r.continue())})}function ct(){!wn&&kn.length&&(wn=!0,kn.shift()())}function lt(e,t,r,n){function i(e,t,r,n){if(r.seq!==t)return n();if(r.winningRev===e._rev)return n(r,e);var i=e._id+"::"+r.winningRev;m.get(i).onsuccess=function(e){n(r,et(e.target.result))}}function s(){e.complete(null,{results:v,last_seq:c})}if((e=o(e)).continuous){var a=r+":"+Xr();return xn.addListener(r,a,t,e),xn.notify(r),{cancel:function(){xn.removeListener(r,a)}}}var u=e.doc_ids&&new Dr(e.doc_ids);e.since=e.since||0;var c=e.since,l="limit"in e?e.limit:-1;0===l&&(l=1);var f;f="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var p,h,d,m,v=[],y=0,g=A(e),b=new Cr,_=[dn,mn];e.attachments&&_.push(vn);var x=ot(n,_,"readonly");if(x.error)return e.complete(x.error);(p=x.txn).onabort=Ye(e.complete),p.oncomplete=function(){!e.continuous&&e.attachments?nt(v).then(s):s()},h=p.objectStore(mn),d=p.objectStore(dn),m=h.index("_doc_id_rev");at(h,e.since&&!e.descending?IDBKeyRange.lowerBound(e.since,!0):null,e.descending,l,function(t,r,n){function o(t,r){var n=e.processChange(r,t,e);c=n.seq=t.seq;var i=g(n);if("object"==typeof i)return e.complete(i);i&&(y++,f&&v.push(n),e.attachments&&e.include_docs?rt(r,e,p,function(){nt([n],e.binary).then(function(){e.onChange(n)})}):e.onChange(n))}if(n&&t.length){var s=new Array(t.length),a=new Array(t.length),h=0;r.forEach(function(e,r){!function(e,t,r){if(u&&!u.has(e._id))return r();var n=b.get(e._id);if(n)return i(e,t,n,r);d.get(e._id).onsuccess=function(o){n=Ze(o.target.result),b.set(e._id,n),i(e,t,n,r)}}(et(e),t[r],function(e,i){a[r]=e,s[r]=i,++h===t.length&&function(){for(var e=0,t=s.length;e<t&&y!==l;e++){var r=s[e];r&&o(a[e],r)}y!==l&&n.continue()}()})})}})}function ft(e,t){var r=this;!function(e,t,r){kn.push(function(){e(function(e,n){!function(e,t,r,n){try{e(t,r)}catch(t){n.emit("error",t)}}(t,e,n,r),wn=!1,br(function(){ct()})})}),ct()}(function(t){!function(e,t,r){function n(e,t){var r=e.objectStore(dn);r.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),r.openCursor().onsuccess=function(e){var n=e.target.result;if(n){var i=n.value,o=Y(i);i.deletedOrLocal=o?"1":"0",r.put(i),n.continue()}else t()}}function i(e,t){var r=e.objectStore(bn),n=e.objectStore(dn),i=e.objectStore(mn),o=n.openCursor();o.onsuccess=function(e){var o=e.target.result;if(o){var s=o.value,a=s.id,u=X(a),c=I(s);if(u){var l=a+"::"+c,f=a+"::",p=a+"::~",h=i.index("_doc_id_rev"),d=IDBKeyRange.bound(f,p,!1,!1),m=h.openCursor(d);m.onsuccess=function(e){if(m=e.target.result){var t=m.value;t._doc_id_rev===l&&r.put(t),i.delete(m.primaryKey),m.continue()}else n.delete(o.primaryKey),o.continue()}}else o.continue()}else t&&t()}}function o(e,t){var r=e.objectStore(mn),n=e.objectStore(vn),i=e.objectStore(yn),o=n.count();o.onsuccess=function(e){var n=e.target.result;if(!n)return t();r.openCursor().onsuccess=function(e){var r=e.target.result;if(!r)return t();for(var n=r.value,o=r.primaryKey,s=Object.keys(n._attachments||{}),a={},u=0;u<s.length;u++){var c=n._attachments[s[u]];a[c.digest]=!0}var l=Object.keys(a);for(u=0;u<l.length;u++){var f=l[u];i.put({seq:o,digestSeq:f+"::"+o})}r.continue()}}}function s(e){var t=e.objectStore(mn),r=e.objectStore(dn),n=r.openCursor();n.onsuccess=function(e){function n(){var e=Xe(o,o.winningRev,o.deleted),t=r.put(e);t.onsuccess=function(){i.continue()}}var i=e.target.result;if(i){var o=function(e){if(!e.data)return e.deleted="1"===e.deletedOrLocal,e;return Ze(e)}(i.value);if(o.winningRev=o.winningRev||I(o),o.seq)return n();!function(){var e=o.id+"::",r=o.id+"::",i=0;t.index("_doc_id_rev").openCursor(IDBKeyRange.bound(e,r)).onsuccess=function(e){var t=e.target.result;if(!t)return o.seq=i,n();var r=t.primaryKey;r>i&&(i=r),t.continue()}}()}}}var u=t.name,c=null;e._meta=null;e._remote=!1,e.type=function(){return"idb"},e._id=a(function(t){t(null,e._meta.instanceId)}),e._bulkDocs=function(r,n,i){st(t,r,n,e,c,i)},e._get=function(e,t,r){function n(){r(s,{doc:i,metadata:o,ctx:a})}var i,o,s,a=t.ctx;if(!a){var u=ot(c,[dn,mn,vn],"readonly");if(u.error)return r(u.error);a=u.txn}a.objectStore(dn).get(e).onsuccess=function(e){if(!(o=Ze(e.target.result)))return s=E(Br,"missing"),n();var r;if(t.rev)r=t.latest?Z(t.rev,o):t.rev;else{r=o.winningRev;var u=Y(o);if(u)return s=E(Br,"deleted"),n()}var c=a.objectStore(mn),l=o.id+"::"+r;c.index("_doc_id_rev").get(l).onsuccess=function(e){if((i=e.target.result)&&(i=et(i)),!i)return s=E(Br,"missing"),n();n()}}},e._getAttachment=function(e,t,r,n,i){var o;if(n.ctx)o=n.ctx;else{var s=ot(c,[dn,mn,vn],"readonly");if(s.error)return i(s.error);o=s.txn}var a=r.digest,u=r.content_type;o.objectStore(vn).get(a).onsuccess=function(e){var t=e.target.result.body;tt(t,u,n.binary,function(e){i(null,e)})}},e._info=function(t){var r,n,i=ot(c,[gn,mn],"readonly");if(i.error)return t(i.error);var o=i.txn;o.objectStore(gn).get(gn).onsuccess=function(e){n=e.target.result.docCount},o.objectStore(mn).openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;r=t?t.key:0},o.oncomplete=function(){t(null,{doc_count:n,update_seq:r,idb_attachment_format:e._meta.blobSupport?"binary":"base64"})}},e._allDocs=function(e,t){ut(e,c,t)},e._changes=function(t){return lt(t,e,u,c)},e._close=function(e){c.close(),En.delete(u),e()},e._getRevisionTree=function(e,t){var r=ot(c,[dn],"readonly");if(r.error)return t(r.error);var n=r.txn,i=n.objectStore(dn).get(e);i.onsuccess=function(e){var r=Ze(e.target.result);r?t(null,r.rev_tree):t(E(Br))}},e._doCompaction=function(e,t,r){var n=[dn,mn,vn,yn],i=ot(c,n,"readwrite");if(i.error)return r(i.error);var o=i.txn,s=o.objectStore(dn);s.get(e).onsuccess=function(r){var n=Ze(r.target.result);L(n.rev_tree,function(e,r,n,i,o){var s=r+"-"+n;-1!==t.indexOf(s)&&(o.status="missing")}),it(t,e,o);var i=n.winningRev,s=n.deleted;o.objectStore(dn).put(Xe(n,i,s))},o.onabort=Ye(r),o.oncomplete=function(){r()}},e._getLocal=function(e,t){var r=ot(c,[bn],"readonly");if(r.error)return t(r.error);var n=r.txn,i=n.objectStore(bn).get(e);i.onerror=Ye(t),i.onsuccess=function(e){var r=e.target.result;r?(delete r._doc_id_rev,t(null,r)):t(E(Br))}},e._putLocal=function(e,t,r){"function"==typeof t&&(r=t,t={}),delete e._revisions;var n=e._rev,i=e._id;e._rev=n?"0-"+(parseInt(n.split("-")[1],10)+1):"0-1";var o,s=t.ctx;if(!s){var a=ot(c,[bn],"readwrite");if(a.error)return r(a.error);(s=a.txn).onerror=Ye(r),s.oncomplete=function(){o&&r(null,o)}}var u,l=s.objectStore(bn);n?(u=l.get(i)).onsuccess=function(i){var s=i.target.result;if(s&&s._rev===n){var a=l.put(e);a.onsuccess=function(){o={ok:!0,id:e._id,rev:e._rev},t.ctx&&r(null,o)}}else r(E(Tr))}:((u=l.add(e)).onerror=function(e){r(E(Tr)),e.preventDefault(),e.stopPropagation()},u.onsuccess=function(){o={ok:!0,id:e._id,rev:e._rev},t.ctx&&r(null,o)})},e._removeLocal=function(e,t,r){"function"==typeof t&&(r=t,t={});var n=t.ctx;if(!n){var i=ot(c,[bn],"readwrite");if(i.error)return r(i.error);(n=i.txn).oncomplete=function(){o&&r(null,o)}}var o,s=e._id,a=n.objectStore(bn),u=a.get(s);u.onerror=Ye(r),u.onsuccess=function(n){var i=n.target.result;i&&i._rev===e._rev?(a.delete(s),o={ok:!0,id:s,rev:"0-0"},t.ctx&&r(null,o)):r(E(Br))}},e._destroy=function(e,t){xn.removeAllListeners(u);var r=Sn.get(u);r&&r.result&&(r.result.close(),En.delete(u));var n=indexedDB.deleteDatabase(u);n.onsuccess=function(){Sn.delete(u),g()&&u in localStorage&&delete localStorage[u],t(null,{ok:!0})},n.onerror=Ye(t)};var l=En.get(u);if(l)return c=l.idb,e._meta=l.global,br(function(){r(null,e)});var f;f=t.storage?function(e,t){try{return indexedDB.open(e,{version:hn,storage:t})}catch(t){return indexedDB.open(e,hn)}}(u,t.storage):indexedDB.open(u,hn);Sn.set(u,f),f.onupgradeneeded=function(e){function t(){var e=u[c-1];c++,e&&e(a,t)}var r=e.target.result;if(e.oldVersion<1)return function(e){var t=e.createObjectStore(dn,{keyPath:"id"});e.createObjectStore(mn,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.createObjectStore(vn,{keyPath:"digest"}),e.createObjectStore(gn,{keyPath:"id",autoIncrement:!1}),e.createObjectStore(_n),t.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),e.createObjectStore(bn,{keyPath:"_id"});var r=e.createObjectStore(yn,{autoIncrement:!0});r.createIndex("seq","seq"),r.createIndex("digestSeq","digestSeq",{unique:!0})}(r);var a=e.currentTarget.transaction;e.oldVersion<3&&function(e){e.createObjectStore(bn,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}(r),e.oldVersion<4&&function(e){var t=e.createObjectStore(yn,{autoIncrement:!0});t.createIndex("seq","seq"),t.createIndex("digestSeq","digestSeq",{unique:!0})}(r);var u=[n,i,o,s],c=e.oldVersion;t()},f.onsuccess=function(t){function n(){void 0!==a&&p&&(e._meta={name:u,instanceId:l,blobSupport:a},En.set(u,{idb:c,global:e._meta}),r(null,e))}function i(){if(void 0!==s&&void 0!==o){var e=u+"_id";e in o?l=o[e]:o[e]=l=Xr(),o.docCount=s,f.objectStore(gn).put(o)}}(c=t.target.result).onversionchange=function(){c.close(),En.delete(u)},c.onabort=function(e){_("error","Database has a global failure",e.target.error),c.close(),En.delete(u)};var o,s,a,l,f=c.transaction([gn,_n,dn],"readwrite"),p=!1;f.objectStore(gn).get(gn).onsuccess=function(e){o=e.target.result||{id:gn},i()},function(e,t){e.objectStore(dn).index("deletedOrLocal").count(IDBKeyRange.only("0")).onsuccess=function(e){t(e.target.result)}}(f,function(e){s=e,i()}),sn||(sn=function(e){return new Er(function(t){var r=Pe([""]);e.objectStore(_n).put(r,"key").onsuccess=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);t(r||!e||parseInt(e[1],10)>=43)},e.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)}}).catch(function(){return!1})}(f)),sn.then(function(e){a=e,n()}),f.oncomplete=function(){p=!0,n()}},f.onerror=function(){var e="Failed to open indexedDB, are you in private browsing mode?";_("error",e),r(E(zr,e))}}(r,e,t)},t,r.constructor)}function pt(e){return e<65?e-48:e-55}function ht(e,t){return"UTF-8"===t?function(e){return decodeURIComponent(escape(e))}(function(e,t,r){for(var n="";t<r;)n+=String.fromCharCode(pt(e.charCodeAt(t++))<<4|pt(e.charCodeAt(t++)));return n}(e,0,e.length)):function(e,t,r){for(var n="";t<r;)n+=String.fromCharCode(pt(e.charCodeAt(t+2))<<12|pt(e.charCodeAt(t+3))<<8|pt(e.charCodeAt(t))<<4|pt(e.charCodeAt(t+1))),t+=4;return n}(e,0,e.length)}function dt(e){return"'"+e+"'"}function mt(e){return delete e._id,delete e._rev,JSON.stringify(e)}function vt(e,t,r){return e=JSON.parse(e),e._id=t,e._rev=r,e}function yt(e){for(var t="(";e--;)t+="?",e&&(t+=",");return t+")"}function gt(e,t,r,n,i){return"SELECT "+e+" FROM "+("string"==typeof t?t:t.join(" JOIN "))+(r?" ON "+r:"")+(n?" WHERE "+("string"==typeof n?n:n.join(" AND ")):"")+(i?" ORDER BY "+i:"")}function bt(e,t,r){function n(){++i===e.length&&function(){if(!o.length)return;var e="SELECT DISTINCT digest AS digest FROM "+Rn+" WHERE seq IN "+yt(o.length);r.executeSql(e,o,function(e,t){for(var r=[],n=0;n<t.rows.length;n++)r.push(t.rows.item(n).digest);if(r.length){var i="DELETE FROM "+Rn+" WHERE seq IN ("+o.map(function(){return"?"}).join(",")+")";e.executeSql(i,o,function(e){var t="SELECT digest FROM "+Rn+" WHERE digest IN ("+r.map(function(){return"?"}).join(",")+")";e.executeSql(t,r,function(e,t){for(var n=new Dr,i=0;i<t.rows.length;i++)n.add(t.rows.item(i).digest);r.forEach(function(t){n.has(t)||(e.executeSql("DELETE FROM "+Rn+" WHERE digest=?",[t]),e.executeSql("DELETE FROM "+Fn+" WHERE digest=?",[t]))})})})}})}()}if(e.length){var i=0,o=[];e.forEach(function(e){var i="SELECT seq FROM "+Cn+" WHERE doc_id=? AND rev=?";r.executeSql(i,[t,e],function(e,t){if(!t.rows.length)return n();var r=t.rows.item(0).seq;o.push(r),e.executeSql("DELETE FROM "+Cn+" WHERE seq=?",[r],n)})})}}function _t(e){return function(t){_("error","WebSQL threw an error",t);var r=t&&t.constructor.toString().match(/function ([^(]+)/),n=(r&&r[1]||t.type,t.target||t.message);e(E(Vr,n))}}function xt(e,t,r,n,i,o,s){function a(){if(m)return s(m);o.notify(n._name),s(null,v)}function u(e){var t=[];if(p.forEach(function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach(function(r){var n=e.data._attachments[r];n.stub&&t.push(n.digest)})}),!t.length)return e();var r,n=0;t.forEach(function(i){!function(e,t){var r="SELECT count(*) as cnt FROM "+Fn+" WHERE digest=?";d.executeSql(r,[e],function(r,n){if(0===n.rows.item(0).cnt){var i=E(Hr,"unknown stub attachment with digest "+e);t(i)}else t()})}(i,function(i){i&&!r&&(r=i),++n===t.length&&e(r)})})}function c(e,t,r,i,o,s,a,u){function c(){function t(e,t){function n(){return++o===s.length&&t(),!1}function i(t){var i="INSERT INTO "+Rn+" (digest, seq) VALUES (?,?)",o=[r._attachments[t].digest,e];d.executeSql(i,o,n,n)}var o=0,s=Object.keys(r._attachments||{});if(!s.length)return t();for(var a=0;a<s.length;a++)i(s[a])}var r=e.data,n=i?1:0,o=r._id,s=r._rev,a=mt(r),u="INSERT INTO "+Cn+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",c=[o,s,a,n];d.executeSql(u,c,function(e,r){var n=r.insertId;t(n,function(){p(e,n)})},function(){var e=gt("seq",Cn,null,"doc_id=? AND rev=?");return d.executeSql(e,[o,s],function(e,r){var i=r.rows.item(0).seq,u="UPDATE "+Cn+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",c=[a,n,o,s];e.executeSql(u,c,function(e){t(i,function(){p(e,i)})})}),!1})}function l(e){h||(e?u(h=e):m===g.length&&c())}function f(e){m++,l(e)}function p(r,i){var s=e.metadata.id,c=e.stemmedRevs||[];o&&n.auto_compaction&&(c=$(e.metadata).concat(c)),c.length&&bt(c,s,r),e.metadata.seq=i;var l=e.metadata.rev;delete e.metadata.rev;var f=o?"UPDATE "+Dn+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+Cn+" WHERE doc_id="+Dn+".id AND rev=?) WHERE id=?":"INSERT INTO "+Dn+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",p=Qe(e.metadata),h=o?[p,i,t,s]:[s,i,i,p];r.executeSql(f,h,function(){v[a]={ok:!0,id:e.metadata.id,rev:l},y.set(s,e.metadata),u()})}var h=null,m=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev;var g=Object.keys(e.data._attachments||{});i&&(e.data._deleted=!0),g.forEach(function(r){var n=e.data._attachments[r];if(n.stub)m++,l();else{var i=n.data;delete n.data,n.revpos=parseInt(t,10);!function(e,t,r){var n="SELECT digest FROM "+Fn+" WHERE digest=?";d.executeSql(n,[e],function(i,o){if(o.rows.length)return r();n="INSERT INTO "+Fn+" (digest, body, escaped) VALUES (?,?,1)",i.executeSql(n,[e,function(e){return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}(t)],function(){r()},function(){return r(),!1})})}(n.digest,i,f)}}),g.length||c()}function l(){Je(e.revs_limit,p,n,y,d,v,c,r)}var f=r.new_edits,p=t.docs.map(function(e){if(e._id&&X(e._id))return e;return Te(e,f)}),h=p.filter(function(e){return e.error});if(h.length)return s(h[0]);var d,m,v=new Array(p.length),y=new Cr;Ge(p,"binary",function(e){if(e)return s(e);i.transaction(function(e){d=e,u(function(e){e?m=e:function(e){function t(){++r===p.length&&e()}if(!p.length)return e();var r=0;p.forEach(function(e){if(e._id&&X(e._id))return t();var r=e.metadata.id;d.executeSql("SELECT json FROM "+Dn+" WHERE id = ?",[r],function(e,n){if(n.rows.length){var i=Ke(n.rows.item(0).json);y.set(r,i)}t()})})}(l)})},_t(s),a)})}function wt(e,t,r,n,i){function o(){++a===s.length&&i&&i()}var s=Object.keys(e._attachments||{});if(!s.length)return i&&i();var a=0;s.forEach(function(i){t.attachments&&t.include_docs?function(e,i){var s=e._attachments[i],a={binary:t.binary,ctx:n};r._getAttachment(e._id,i,s,a,function(t,r){e._attachments[i]=jr(h(s,["digest","content_type"]),{data:r}),o()})}(e,i):(e._attachments[i].stub=!0,o())})}function kt(e,t){function r(){g()&&(window.localStorage["_pouch__websqldb_"+m._name]=!0),t(null,m)}function n(e,t){e.executeSql(Nn),e.executeSql("ALTER TABLE "+Cn+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){e.executeSql(In),e.executeSql("ALTER TABLE "+Dn+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){e.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+Dn+" (local, id)");var r="SELECT "+Dn+".winningseq AS seq, "+Dn+".json AS metadata FROM "+Cn+" JOIN "+Dn+" ON "+Cn+".seq = "+Dn+".winningseq";e.executeSql(r,[],function(e,r){for(var n=[],i=[],o=0;o<r.rows.length;o++){var s=r.rows.item(o),a=s.seq,u=JSON.parse(s.metadata);Y(u)&&n.push(a),X(u.id)&&i.push(u.id)}e.executeSql("UPDATE "+Dn+"SET local = 1 WHERE id IN "+yt(i.length),i,function(){e.executeSql("UPDATE "+Cn+" SET deleted = 1 WHERE seq IN "+yt(n.length),n,t)})})})})}function i(e,t){var r="CREATE TABLE IF NOT EXISTS "+On+" (id UNIQUE, rev, json)";e.executeSql(r,[],function(){var r="SELECT "+Dn+".id AS id, "+Cn+".json AS data FROM "+Cn+" JOIN "+Dn+" ON "+Cn+".seq = "+Dn+".winningseq WHERE local = 1";e.executeSql(r,[],function(e,r){function n(){if(!i.length)return t(e);var r=i.shift(),o=JSON.parse(r.data)._rev;e.executeSql("INSERT INTO "+On+" (id, rev, json) VALUES (?,?,?)",[r.id,o,r.data],function(e){e.executeSql("DELETE FROM "+Dn+" WHERE id=?",[r.id],function(e){e.executeSql("DELETE FROM "+Cn+" WHERE seq=?",[r.seq],function(){n()})})})}for(var i=[],o=0;o<r.rows.length;o++)i.push(r.rows.item(o));n()})})}function s(e,t){var r="ALTER TABLE "+Cn+" ADD COLUMN doc_id";e.executeSql(r,[],function(r){var n="ALTER TABLE "+Cn+" ADD COLUMN rev";r.executeSql(n,[],function(r){r.executeSql(Ln,[],function(r){var n="SELECT hex(doc_id_rev) as hex FROM "+Cn;r.executeSql(n,[],function(r,n){for(var i=[],o=0;o<n.rows.length;o++)i.push(n.rows.item(o));!function(r){function n(){if(!r.length)return t(e);var i=ht(r.shift().hex,d),o=i.lastIndexOf("::"),s=i.substring(0,o),a=i.substring(o+2),u="UPDATE "+Cn+" SET doc_id=?, rev=? WHERE doc_id_rev=?";e.executeSql(u,[s,a,i],function(){n()})}n()}(i)})})})})}function u(e,t){function r(e){var r="SELECT COUNT(*) AS cnt FROM "+Fn;e.executeSql(r,[],function(e,r){function n(){var r=gt(Wn+", "+Dn+".id AS id",[Dn,Cn],$n,null,Dn+".id ");r+=" LIMIT "+o+" OFFSET "+i,i+=o,e.executeSql(r,[],function(e,r){function i(e,t){var r=o[e]=o[e]||[];-1===r.indexOf(t)&&r.push(t)}if(!r.rows.length)return t(e);for(var o={},s=0;s<r.rows.length;s++)for(var a=r.rows.item(s),u=vt(a.data,a.id,a.rev),c=Object.keys(u._attachments||{}),l=0;l<c.length;l++){i(u._attachments[c[l]].digest,a.seq)}var f=[];if(Object.keys(o).forEach(function(e){o[e].forEach(function(t){f.push([e,t])})}),!f.length)return n();var p=0;f.forEach(function(t){var r="INSERT INTO "+Rn+" (digest, seq) VALUES (?,?)";e.executeSql(r,t,function(){++p===f.length&&n()})})})}if(!r.rows.item(0).cnt)return t(e);var i=0,o=10;n()})}var n="CREATE TABLE IF NOT EXISTS "+Rn+" (digest, seq INTEGER)";e.executeSql(n,[],function(e){e.executeSql(qn,[],function(e){e.executeSql(Mn,[],r)})})}function c(e,t){var r="ALTER TABLE "+Fn+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";e.executeSql(r,[],t)}function l(e,t){var r="ALTER TABLE "+Dn+" ADD COLUMN max_seq INTEGER";e.executeSql(r,[],function(e){var r="UPDATE "+Dn+" SET max_seq=(SELECT MAX(seq) FROM "+Cn+" WHERE doc_id=id)";e.executeSql(r,[],function(e){var r="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+Dn+" (max_seq)";e.executeSql(r,[],t)})})}function f(){for(;b.length>0;){b.pop()(null,v)}}function p(e,t){if(0===t){var r="CREATE TABLE IF NOT EXISTS "+jn+" (dbid, db_version INTEGER)",o="CREATE TABLE IF NOT EXISTS "+Fn+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",a="CREATE TABLE IF NOT EXISTS "+Rn+" (digest, seq INTEGER)",p="CREATE TABLE IF NOT EXISTS "+Dn+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",h="CREATE TABLE IF NOT EXISTS "+Cn+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",d="CREATE TABLE IF NOT EXISTS "+On+" (id UNIQUE, rev, json)";e.executeSql(o),e.executeSql(d),e.executeSql(a,[],function(){e.executeSql(Mn),e.executeSql(qn)}),e.executeSql(p,[],function(){e.executeSql(Nn),e.executeSql(h,[],function(){e.executeSql(In),e.executeSql(Ln),e.executeSql(r,[],function(){var t="INSERT INTO "+jn+" (db_version, dbid) VALUES (?,?)";v=Xr();var r=[An,v];e.executeSql(t,r,function(){f()})})})})}else{var m=[n,i,s,u,c,l,function(){t<An&&e.executeSql("UPDATE "+jn+" SET db_version = "+An);var r="SELECT dbid FROM "+jn;e.executeSql(r,[],function(e,t){v=t.rows.item(0).dbid,f()})}],y=t,g=function(e){m[y-1](e,g),y++};g(e)}}function h(e,t){var r=gt("COUNT("+Dn+".id) AS 'num'",[Dn,Cn],$n,Cn+".deleted=0");e.executeSql(r,[],function(e,r){t(r.rows.item(0).num)})}var d,m=this,v=null,y=function(e){return"size"in e?1e6*e.size:"undefined"!=typeof navigator&&/Android/.test(navigator.userAgent)?5e6:1}(e),b=[];m._name=e.name;var _=function(e){var t=Bn.get(e.name);return t||(t=function(e){try{return{db:function(e){return e.websql(e.name,e.version,e.description,e.size)}(e)}}catch(e){return{error:e}}}(e),Bn.set(e.name,t)),t}(jr({},e,{version:Pn,description:e.name,size:y}));if(_.error)return _t(t)(_.error);var x=_.db;"function"!=typeof x.readTransaction&&(x.readTransaction=x.transaction),x.transaction(function(e){!function(e,t){e.executeSql('SELECT HEX("a") AS hex',[],function(e,r){var n=r.rows.item(0).hex;d=2===n.length?"UTF-8":"UTF-16",t()})}(e,function(){!function(e){var t="SELECT sql FROM sqlite_master WHERE tbl_name = "+jn;e.executeSql(t,[],function(e,t){t.rows.length?/db_version/.test(t.rows.item(0).sql)?e.executeSql("SELECT db_version FROM "+jn,[],function(e,t){var r=t.rows.item(0).db_version;p(e,r)}):e.executeSql("ALTER TABLE "+jn+" ADD COLUMN db_version INTEGER",[],function(){p(e,1)}):p(e,0)})}(e)})},_t(t),r),m._remote=!1,m.type=function(){return"websql"},m._id=a(function(e){e(null,v)}),m._info=function(e){var t,r;x.readTransaction(function(e){!function(e,t){var r="SELECT MAX(seq) AS seq FROM "+Cn;e.executeSql(r,[],function(e,r){var n=r.rows.item(0).seq||0;t(n)})}(e,function(e){t=e}),h(e,function(e){r=e})},_t(e),function(){e(null,{doc_count:r,update_seq:t,websql_encoding:d})})},m._bulkDocs=function(t,r,n){xt(e,t,r,m,x,Tn,n)},m._get=function(e,t,r){function n(e){r(e,{doc:i,metadata:o,ctx:s})}var i,o,s=t.ctx;if(!s)return x.readTransaction(function(n){m._get(e,jr({ctx:n},t),r)});var a,u;if(t.rev){if(t.latest)return void function(e,t,r,n,i){var o=gt(Wn,[Dn,Cn],$n,Dn+".id=?"),s=[t];e.executeSql(o,s,function(e,t){if(!t.rows.length){var o=E(Br,"missing");return i(o)}var s=Ke(t.rows.item(0).metadata);n(Z(r,s))})}(s,e,t.rev,function(n){t.latest=!1,t.rev=n,m._get(e,t,r)},n);a=gt(Wn,[Dn,Cn],Dn+".id="+Cn+".doc_id",[Cn+".doc_id=?",Cn+".rev=?"]),u=[e,t.rev]}else a=gt(Wn,[Dn,Cn],$n,Dn+".id=?"),u=[e];s.executeSql(a,u,function(e,r){if(!r.rows.length){return n(E(Br,"missing"))}var s=r.rows.item(0);if(o=Ke(s.metadata),s.deleted&&!t.rev){return n(E(Br,"deleted"))}i=vt(s.data,o.id,s.rev),n()})},m._allDocs=function(e,t){var r,n=[],i="startkey"in e&&e.startkey,o="endkey"in e&&e.endkey,s="key"in e&&e.key,a="descending"in e&&e.descending,u="limit"in e?e.limit:-1,c="skip"in e?e.skip:0,l=!1!==e.inclusive_end,f=[],p=[];if(!1!==s)p.push(Dn+".id = ?"),f.push(s);else if(!1!==i||!1!==o){if(!1!==i&&(p.push(Dn+".id "+(a?"<=":">=")+" ?"),f.push(i)),!1!==o){var d=a?">":"<";l&&(d+="="),p.push(Dn+".id "+d+" ?"),f.push(o)}!1!==s&&(p.push(Dn+".id = ?"),f.push(s))}"ok"!==e.deleted&&p.push(Cn+".deleted = 0"),x.readTransaction(function(t){if(h(t,function(e){r=e}),0!==u){var i=gt(Wn,[Dn,Cn],$n,p,Dn+".id "+(a?"DESC":"ASC"));i+=" LIMIT "+u+" OFFSET "+c,t.executeSql(i,f,function(t,r){for(var i=0,o=r.rows.length;i<o;i++){var s=r.rows.item(i),a=Ke(s.metadata),u=a.id,c=vt(s.data,u,s.rev),l=c._rev,f={id:u,key:u,value:{rev:l}};if(e.include_docs){if(f.doc=c,f.doc._rev=l,e.conflicts){var p=q(a);p.length&&(f.doc._conflicts=p)}wt(f.doc,e,m,t)}if(s.deleted){if("ok"!==e.deleted)continue;f.value.deleted=!0,f.doc=null}n.push(f)}})}},_t(t),function(){t(null,{total_rows:r,offset:e.skip,rows:n})})},m._changes=function(e){if((e=o(e)).continuous){var t=m._name+":"+Xr();return Tn.addListener(m._name,t,m,e),Tn.notify(m._name),{cancel:function(){Tn.removeListener(m._name,t)}}}var r=e.descending;e.since=e.since&&!r?e.since:0;var n="limit"in e?e.limit:-1;0===n&&(n=1);var i;i="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var s=[],a=0;!function(){var t=Dn+".json AS metadata, "+Dn+".max_seq AS maxSeq, "+Cn+".json AS winningDoc, "+Cn+".rev AS winningRev ",o=Dn+" JOIN "+Cn,u=Dn+".id="+Cn+".doc_id AND "+Dn+".winningseq="+Cn+".seq",c=["maxSeq > ?"],l=[e.since];e.doc_ids&&(c.push(Dn+".id IN "+yt(e.doc_ids.length)),l=l.concat(e.doc_ids));var f=gt(t,o,u,c,"maxSeq "+(r?"DESC":"ASC")),p=A(e);e.view||e.filter||(f+=" LIMIT "+n);var h=e.since||0;x.readTransaction(function(t){t.executeSql(f,l,function(t,r){function o(t){return function(){e.onChange(t)}}for(var u=0,c=r.rows.length;u<c;u++){var l=r.rows.item(u),f=Ke(l.metadata);h=l.maxSeq;var d=vt(l.winningDoc,f.id,l.winningRev),v=e.processChange(d,f,e);v.seq=l.maxSeq;var y=p(v);if("object"==typeof y)return e.complete(y);if(y&&(a++,i&&s.push(v),e.attachments&&e.include_docs?wt(d,e,m,t,o(v)):o(v)()),a===n)break}})},_t(e.complete),function(){e.continuous||e.complete(null,{results:s,last_seq:h})})}()},m._close=function(e){e()},m._getAttachment=function(e,t,r,n,i){var o,s=n.ctx,a=r.digest,u=r.content_type,c="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+Fn+" WHERE digest=?";s.executeSql(c,[a],function(e,t){var r=t.rows.item(0),s=r.escaped?function(e){return e.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}(r.body):ht(r.body,d);o=n.binary?Ie(s,u):ln(s),i(null,o)})},m._getRevisionTree=function(e,t){x.readTransaction(function(r){var n="SELECT json AS metadata FROM "+Dn+" WHERE id = ?";r.executeSql(n,[e],function(e,r){if(r.rows.length){var n=Ke(r.rows.item(0).metadata);t(null,n.rev_tree)}else t(E(Br))})})},m._doCompaction=function(e,t,r){if(!t.length)return r();x.transaction(function(r){var n="SELECT json AS metadata FROM "+Dn+" WHERE id = ?";r.executeSql(n,[e],function(r,n){var i=Ke(n.rows.item(0).metadata);L(i.rev_tree,function(e,r,n,i,o){var s=r+"-"+n;-1!==t.indexOf(s)&&(o.status="missing")});var o="UPDATE "+Dn+" SET json = ? WHERE id = ?";r.executeSql(o,[Qe(i),e])}),bt(t,e,r)},_t(r),function(){r()})},m._getLocal=function(e,t){x.readTransaction(function(r){var n="SELECT json, rev FROM "+On+" WHERE id=?";r.executeSql(n,[e],function(r,n){if(n.rows.length){var i=n.rows.item(0),o=vt(i.json,e,i.rev);t(null,o)}else t(E(Br))})})},m._putLocal=function(e,t,r){function n(e){var n,c;o?(n="UPDATE "+On+" SET rev=?, json=? WHERE id=? AND rev=?",c=[i,u,s,o]):(n="INSERT INTO "+On+" (id, rev, json) VALUES (?,?,?)",c=[s,i,u]),e.executeSql(n,c,function(e,n){n.rowsAffected?(a={ok:!0,id:s,rev:i},t.ctx&&r(null,a)):r(E(Tr))},function(){return r(E(Tr)),!1})}"function"==typeof t&&(r=t,t={}),delete e._revisions;var i,o=e._rev,s=e._id;i=e._rev=o?"0-"+(parseInt(o.split("-")[1],10)+1):"0-1";var a,u=mt(e);t.ctx?n(t.ctx):x.transaction(n,_t(r),function(){a&&r(null,a)})},m._removeLocal=function(e,t,r){function n(n){var o="DELETE FROM "+On+" WHERE id=? AND rev=?",s=[e._id,e._rev];n.executeSql(o,s,function(n,o){if(!o.rowsAffected)return r(E(Br));i={ok:!0,id:e._id,rev:"0-0"},t.ctx&&r(null,i)})}"function"==typeof t&&(r=t,t={});var i;t.ctx?n(t.ctx):x.transaction(n,_t(r),function(){i&&r(null,i)})},m._destroy=function(e,t){Tn.removeAllListeners(m._name),x.transaction(function(e){[Dn,Cn,Fn,jn,On,Rn].forEach(function(t){e.executeSql("DROP TABLE IF EXISTS "+t,[])})},_t(t),function(){g()&&(delete window.localStorage["_pouch__websqldb_"+m._name],delete window.localStorage[m._name]),t(null,{ok:!0})})}}function Et(){if("undefined"==typeof indexedDB||null===indexedDB||!/iP(hone|od|ad)/.test(navigator.userAgent))return!0;var e=g(),t="_pouch__websqldb_valid_"+navigator.userAgent;if(e&&localStorage[t])return"1"===localStorage[t];var r=function(){try{return openDatabase("_pouch_validate_websql",1,"",1),!0}catch(e){return!1}}();return e&&(localStorage[t]=r?"1":"0"),r}function St(e,t,r,n){return openDatabase(e,t,r,n)}function At(e,t){var r=jr({websql:St},e);kt.call(this,r,t)}function Dt(e,t){var r,n,i,o=new Headers,s={method:e.method,credentials:"include",headers:o};return e.json&&(o.set("Accept","application/json"),o.set("Content-Type",e.headers["Content-Type"]||"application/json")),e.body&&e.processData&&"string"!=typeof e.body?s.body=JSON.stringify(e.body):s.body="body"in e?e.body:null,Object.keys(e.headers).forEach(function(t){e.headers.hasOwnProperty(t)&&o.set(t,e.headers[t])}),r=function(){for(var e={},t=new Er(function(t,r){e.resolve=t,e.reject=r}),r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.promise=t,Er.resolve().then(function(){return fetch.apply(null,r)}).then(function(t){e.resolve(t)}).catch(function(t){e.reject(t)}),e}(e.url,s),e.timeout>0&&(n=setTimeout(function(){r.reject(new Error("Load timeout for resource: "+e.url))},e.timeout)),r.promise.then(function(t){return i={statusCode:t.status},e.timeout>0&&clearTimeout(n),i.statusCode>=200&&i.statusCode<300?e.binary?t.blob():t.text():t.json()}).then(function(e){i.statusCode>=200&&i.statusCode<300?t(null,i,e):(e.status=i.statusCode,t(e))}).catch(function(e){e||(e=new Error("canceled")),t(e)}),{abort:r.reject}}function Ct(e,t){return Un||e.xhr?function(e,t){var r,n,i=!1,o=function(){i=!0,r.abort(),a()},s={abort:function(){r.abort(),a()}},a=function(){clearTimeout(n),s.abort=function(){},r&&(r.onprogress=void 0,r.upload&&(r.upload.onprogress=void 0),r.onreadystatechange=void 0,r=void 0)};r=e.xhr?new e.xhr:new XMLHttpRequest;try{r.open(e.method,e.url)}catch(e){return t(new Error(e.name||"Url is invalid"))}r.withCredentials=!("withCredentials"in e)||e.withCredentials,"GET"===e.method?delete e.headers["Content-Type"]:e.json&&(e.headers.Accept="application/json",e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.body&&e.processData&&"string"!=typeof e.body&&(e.body=JSON.stringify(e.body))),e.binary&&(r.responseType="arraybuffer"),"body"in e||(e.body=null);for(var u in e.headers)e.headers.hasOwnProperty(u)&&r.setRequestHeader(u,e.headers[u]);return e.timeout>0&&(n=setTimeout(o,e.timeout),r.onprogress=function(){clearTimeout(n),4!==r.readyState&&(n=setTimeout(o,e.timeout))},void 0!==r.upload&&(r.upload.onprogress=r.onprogress)),r.onreadystatechange=function(){if(4===r.readyState){var n={statusCode:r.status};if(r.status>=200&&r.status<300){var o;o=e.binary?Pe([r.response||""],{type:r.getResponseHeader("Content-Type")}):r.responseText,t(null,n,o)}else{var s={};if(i)(s=new Error("ETIMEDOUT")).code="ETIMEDOUT";else if("string"==typeof r.response)try{s=JSON.parse(r.response)}catch(e){}s.status=r.status,t(s)}a()}},e.body&&e.body instanceof Blob?We(e.body,function(e){r.send(e)}):r.send(e.body),s}(e,t):Dt(e,t)}function Ft(e,t){e=o(e);return(e=jr({method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1},e)).json&&(e.binary||(e.headers.Accept="application/json"),e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json"),e.binary&&(e.encoding=null,e.json=!1),e.processData||(e.json=!1),Ct(e,function(r,n,i){if(r)return t(S(r));var o,s=n.headers&&n.headers["content-type"],a=i||"";if(!e.binary&&(e.json||!e.processData)&&"object"!=typeof a&&(/json/.test(s)||/^[\s]*\{/.test(a)&&/\}[\s]*$/.test(a)))try{a=JSON.parse(a.toString())}catch(e){}n.statusCode>=200&&n.statusCode<300?function(t,r,n){if(!e.binary&&e.json&&"string"==typeof t)try{t=JSON.parse(t)}catch(e){return n(e)}Array.isArray(t)&&(t=t.map(function(e){return e.error||e.missing?S(e):e})),e.binary&&zn(t,r),n(null,t,r)}(a,n,t):((o=S(a)).status=n.statusCode,t(o))})}function Ot(e,t){var r=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n=-1!==r.indexOf("safari")&&-1===r.indexOf("chrome"),i=-1!==r.indexOf("msie"),o=-1!==r.indexOf("edge"),s=n||(i||o)&&"GET"===e.method,a=!("cache"in e)||e.cache;if(!/^blob:/.test(e.url)&&(s||!a)){var u=-1!==e.url.indexOf("?");e.url+=(u?"&":"?")+"_nonce="+Date.now()}return Ft(e,t)}function jt(e){var t=e.doc&&e.doc._attachments;t&&Object.keys(t).forEach(function(e){var r=t[e];r.data=Le(r.data,r.content_type)})}function Rt(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):/^_local/.test(e)?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function Bt(e){return e._attachments&&Object.keys(e._attachments)?Er.all(Object.keys(e._attachments).map(function(t){var r=e._attachments[t];if(r.data&&"string"!=typeof r.data)return new Er(function(e){$e(r.data,e)}).then(function(e){r.data=e})})):Er.resolve()}function Tt(e,t){if(function(e){if(!e.prefix)return!1;var t=R(e.prefix).protocol;return"http"===t||"https"===t}(t)){var r=t.name.substr(t.prefix.length);e=t.prefix+encodeURIComponent(r)}var n=R(e);(n.user||n.password)&&(n.auth={username:n.user,password:n.password});var i=n.path.replace(/(^\/|\/$)/g,"").split("/");return n.db=i.pop(),-1===n.db.indexOf("%")&&(n.db=encodeURIComponent(n.db)),n.path=i.join("/"),n}function Pt(e,t){return It(e,e.db+"/"+t)}function It(e,t){var r=e.path?"/":"";return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+r+t}function Lt(e){return"?"+Object.keys(e).map(function(t){return t+"="+encodeURIComponent(e[t])}).join("&")}function Nt(e,t){function r(e,t,r){var n=e.ajax||{},i=jr(o(p),n,t),s=o(p.headers||{});return i.headers=jr(s,n.headers,t.headers||{}),c.constructor.listeners("debug").length&&c.constructor.emit("debug",["http",i.method,i.url]),c._ajax(i,r)}function n(e,t){return new Er(function(n,i){r(e,t,function(e,t){if(e)return i(e);n(t)})})}function i(e,t){return u(e,vr(function(e){s().then(function(){return t.apply(this,e)}).catch(function(t){e.pop()(t)})}))}function s(){if(e.skipSetup||e.skip_setup)return Er.resolve();if(g)return g;return(g=n({},{method:"GET",url:f}).catch(function(e){return e&&e.status&&404===e.status?(w(404,"PouchDB is just detecting if the remote exists."),n({},{method:"PUT",url:f})):Er.reject(e)}).catch(function(e){return!(!e||!e.status||412!==e.status)||Er.reject(e)})).catch(function(){g=null}),g}function a(e){return e.split("/").map(encodeURIComponent).join("/")}var c=this,l=Tt(e.name,e),f=Pt(l,""),p=(e=o(e)).ajax||{};if(e.auth||l.auth){var d=e.auth||l.auth,m=d.username+":"+d.password,y=ln(unescape(encodeURIComponent(m)));p.headers=p.headers||{},p.headers.Authorization="Basic "+y}c._ajax=Ot;var g;br(function(){t(null,c)}),c._remote=!0,c.type=function(){return"http"},c.id=i("id",function(e){r({},{method:"GET",url:It(l,"")},function(t,r){var n=r&&r.uuid?r.uuid+l.db:Pt(l,"");e(null,n)})}),c.request=i("request",function(e,t){e.url=Pt(l,e.url),r({},e,t)}),c.compact=i("compact",function(e,t){"function"==typeof e&&(t=e,e={}),r(e=o(e),{url:Pt(l,"_compact"),method:"POST"},function(){function r(){c.info(function(n,i){i&&!i.compact_running?t(null,{ok:!0}):setTimeout(r,e.interval||200)})}r()})}),c.bulkGet=u("bulkGet",function(e,t){function n(t){var n={};e.revs&&(n.revs=!0),e.attachments&&(n.attachments=!0),e.latest&&(n.latest=!0),r(e,{url:Pt(l,"_bulk_get"+Lt(n)),method:"POST",body:{docs:e.docs}},t)}function i(){function r(e){return function(r,n){a[e]=n.results,++s===i&&t(null,{results:D(a)})}}for(var n=Gn,i=Math.ceil(e.docs.length/n),s=0,a=new Array(i),u=0;u<i;u++){var c=h(e,["revs","attachments","latest"]);c.ajax=p,c.docs=e.docs.slice(u*n,Math.min(e.docs.length,(u+1)*n)),v(o,c,r(u))}}var o=this,s=It(l,""),a=Kn[s];"boolean"!=typeof a?n(function(e,r){e?(Kn[s]=!1,w(e.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),i()):(Kn[s]=!0,t(null,r))}):a?n(t):i()}),c._info=function(e){s().then(function(){r({},{method:"GET",url:Pt(l,"")},function(t,r){if(t)return e(t);r.host=Pt(l,""),e(null,r)})}).catch(e)},c.get=i("get",function(e,t,r){function i(e){var r=e._attachments,i=r&&Object.keys(r);if(r&&i.length){return function(e,t){return new Er(function(r,n){function i(){l++,e[f++]().then(s,a)}function o(){++p===h?c?n(c):r():u()}function s(){l--,o()}function a(e){l--,c=c||e,o()}function u(){for(;l<t&&f<h;)i()}var c,l=0,f=0,p=0,h=e.length;u()})}(i.map(function(i){return function(){return function(i){var o=r[i],s=Rt(e._id)+"/"+a(i)+"?rev="+e._rev;return n(t,{method:"GET",url:Pt(l,s),binary:!0}).then(function(e){return t.binary?e:new Er(function(t){$e(e,t)})}).then(function(e){delete o.stub,delete o.length,o.data=e})}(i)}}),5)}}"function"==typeof t&&(r=t,t={});var s={};(t=o(t)).revs&&(s.revs=!0),t.revs_info&&(s.revs_info=!0),t.latest&&(s.latest=!0),t.open_revs&&("all"!==t.open_revs&&(t.open_revs=JSON.stringify(t.open_revs)),s.open_revs=t.open_revs),t.rev&&(s.rev=t.rev),t.conflicts&&(s.conflicts=t.conflicts),e=Rt(e);var u={method:"GET",url:Pt(l,e+Lt(s))};n(t,u).then(function(e){return Er.resolve().then(function(){if(t.attachments)return function(e){return Array.isArray(e)?Er.all(e.map(function(e){if(e.ok)return i(e.ok)})):i(e)}(e)}).then(function(){r(null,e)})}).catch(function(t){t.docId=e,r(t)})}),c.remove=i("remove",function(e,t,n,i){var o;"string"==typeof t?(o={_id:e,_rev:t},"function"==typeof n&&(i=n,n={})):(o=e,"function"==typeof t?(i=t,n={}):(i=n,n=t));var s=o._rev||n.rev;r(n,{method:"DELETE",url:Pt(l,Rt(o._id))+"?rev="+s},i)}),c.getAttachment=i("getAttachment",function(e,t,n,i){"function"==typeof n&&(i=n,n={});var o=n.rev?"?rev="+n.rev:"";r(n,{method:"GET",url:Pt(l,Rt(e))+"/"+a(t)+o,binary:!0},i)}),c.removeAttachment=i("removeAttachment",function(e,t,n,i){r({},{method:"DELETE",url:Pt(l,Rt(e)+"/"+a(t))+"?rev="+n},i)}),c.putAttachment=i("putAttachment",function(e,t,n,i,o,s){"function"==typeof o&&(s=o,o=i,i=n,n=null);var u=Rt(e)+"/"+a(t),c=Pt(l,u);if(n&&(c+="?rev="+n),"string"==typeof i){var f;try{f=cn(i)}catch(e){return s(E(Mr,"Attachment is not a valid base64 string"))}i=f?Ie(f,o):""}r({},{headers:{"Content-Type":o},method:"PUT",url:c,processData:!1,body:i,timeout:p.timeout||6e4},s)}),c._bulkDocs=function(e,t,n){e.new_edits=t.new_edits,s().then(function(){return Er.all(e.docs.map(Bt))}).then(function(){r(t,{method:"POST",url:Pt(l,"_bulk_docs"),timeout:t.timeout,body:e},function(e,t){if(e)return n(e);t.forEach(function(e){e.ok=!0}),n(null,t)})}).catch(n)},c._put=function(e,t,n){s().then(function(){return Bt(e)}).then(function(){r(t,{method:"PUT",url:Pt(l,Rt(e._id)),body:e},function(t,r){if(t)return t.docId=e&&e._id,n(t);n(null,r)})}).catch(n)},c.allDocs=i("allDocs",function(e,t){"function"==typeof e&&(t=e,e={});var r,i={},s="GET";(e=o(e)).conflicts&&(i.conflicts=!0),e.descending&&(i.descending=!0),e.include_docs&&(i.include_docs=!0),e.attachments&&(i.attachments=!0),e.key&&(i.key=JSON.stringify(e.key)),e.start_key&&(e.startkey=e.start_key),e.startkey&&(i.startkey=JSON.stringify(e.startkey)),e.end_key&&(e.endkey=e.end_key),e.endkey&&(i.endkey=JSON.stringify(e.endkey)),void 0!==e.inclusive_end&&(i.inclusive_end=!!e.inclusive_end),void 0!==e.limit&&(i.limit=e.limit),void 0!==e.skip&&(i.skip=e.skip);var a=Lt(i);void 0!==e.keys&&(s="POST",r={keys:e.keys}),n(e,{method:s,url:Pt(l,"_all_docs"+a),body:r}).then(function(r){e.include_docs&&e.attachments&&e.binary&&r.rows.forEach(jt),t(null,r)}).catch(t)}),c._changes=function(e){var t="batch_size"in e?e.batch_size:Vn;!(e=o(e)).continuous||"heartbeat"in e||(e.heartbeat=Jn);var n="timeout"in e?e.timeout:"timeout"in p?p.timeout:3e4;"timeout"in e&&e.timeout&&n-e.timeout<Hn&&(n=e.timeout+Hn),"heartbeat"in e&&e.heartbeat&&n-e.heartbeat<Hn&&(n=e.heartbeat+Hn);var i={};"timeout"in e&&e.timeout&&(i.timeout=e.timeout);var a,u=void 0!==e.limit&&e.limit;a="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var c=u;if(e.style&&(i.style=e.style),(e.include_docs||e.filter&&"function"==typeof e.filter)&&(i.include_docs=!0),e.attachments&&(i.attachments=!0),e.continuous&&(i.feed="longpoll"),e.conflicts&&(i.conflicts=!0),e.descending&&(i.descending=!0),"heartbeat"in e&&e.heartbeat&&(i.heartbeat=e.heartbeat),e.filter&&"string"==typeof e.filter&&(i.filter=e.filter),e.view&&"string"==typeof e.view&&(i.filter="_view",i.view=e.view),e.query_params&&"object"==typeof e.query_params)for(var f in e.query_params)e.query_params.hasOwnProperty(f)&&(i[f]=e.query_params[f]);var h,d="GET";e.doc_ids?(i.filter="_doc_ids",d="POST",h={doc_ids:e.doc_ids}):e.selector&&(i.filter="_selector",d="POST",h={selector:e.selector});var m,v,y=function(o,a){if(!e.aborted){i.since=o,"object"==typeof i.since&&(i.since=JSON.stringify(i.since)),e.descending?u&&(i.limit=c):i.limit=!u||c>t?t:c;var f={method:d,url:Pt(l,"_changes"+Lt(i)),timeout:n,body:h};v=o,e.aborted||s().then(function(){m=r(e,f,a)}).catch(a)}},g={results:[]},b=function(r,n){if(!e.aborted){var i=0;if(n&&n.results){i=n.results.length,g.last_seq=n.last_seq;({}).query=e.query_params,n.results=n.results.filter(function(t){c--;var r=A(e)(t);return r&&(e.include_docs&&e.attachments&&e.binary&&jt(t),a&&g.results.push(t),e.onChange(t)),r})}else if(r)return e.aborted=!0,void e.complete(r);n&&n.last_seq&&(v=n.last_seq);var o=u&&c<=0||n&&i<t||e.descending;(!e.continuous||u&&c<=0)&&o?e.complete(null,g):br(function(){y(v,b)})}};return y(e.since||0,b),{cancel:function(){e.aborted=!0,m&&m.abort()}}},c.revsDiff=i("revsDiff",function(e,t,n){"function"==typeof t&&(n=t,t={}),r(t,{method:"POST",url:Pt(l,"_revs_diff"),body:e},n)}),c._close=function(e){e()},c._destroy=function(e,t){r(e,{url:Pt(l,""),method:"DELETE"},function(e,r){if(e&&e.status&&404!==e.status)return t(e);t(null,r)})}}function Mt(e){this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Mt)}catch(e){}}function qt(e){this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,qt)}catch(e){}}function $t(e){this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,$t)}catch(e){}}function Wt(e,t){return t&&e.then(function(e){br(function(){t(null,e)})},function(e){br(function(){t(e)})}),e}function Ut(e,t){return function(){var r=arguments,n=this;return e.add(function(){return t.apply(n,r)})}}function zt(e){var t=new Dr(e),r=new Array(t.size),n=-1;return t.forEach(function(e){r[++n]=e}),r}function Vt(e){var t=new Array(e.size),r=-1;return e.forEach(function(e,n){t[++r]=n}),t}function Gt(e){return new $t("builtin "+e+" function requires map values to be numbers or number arrays")}function Ht(e){for(var t=0,r=0,n=e.length;r<n;r++){var i=e[r];if("number"!=typeof i){if(!Array.isArray(i))throw Gt("_sum");t="number"==typeof t?[t]:t;for(var o=0,s=i.length;o<s;o++){var a=i[o];if("number"!=typeof a)throw Gt("_sum");void 0===t[o]?t.push(a):t[o]+=a}}else"number"==typeof t?t+=i:t[0]+=i}return t}function Jt(e,t){return B("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:Ht,log:Qn,isArray:Yn,toJSON:Xn})}function Kt(){this.promise=new Er(function(e){e()})}function Qt(e){if(!e)return"undefined";switch(typeof e){case"function":case"string":return e.toString();default:return JSON.stringify(e)}}function Yt(e,t,r,n,i,o){var s,a=function(e,t){return Qt(e)+Qt(t)+"undefined"}(r,n);if(!i&&(s=e._cachedViews=e._cachedViews||{})[a])return s[a];var u=e.info().then(function(u){var c=u.db_name+"-mrview-"+(i?"temp":function(e){return wr.hash(e)}(a));return T(e,"_local/"+o,function(e){e.views=e.views||{};var r=t;-1===r.indexOf("/")&&(r=t+"/"+t);var n=e.views[r]=e.views[r]||{};if(!n[c])return n[c]=!0,e}).then(function(){return e.registerDependentDatabase(c).then(function(t){var i=t.db;i.auto_compaction=!0;var o={name:c,db:i,sourceDB:e,adapter:e.adapter,mapFun:r,reduceFun:n};return o.db.get("_local/lastSeq").catch(function(e){if(404!==e.status)throw e}).then(function(e){return o.seq=e?e.seq:0,s&&o.db.once("destroyed",function(){delete s[a]}),o})})})});return s&&(s[a]=u),u}function Xt(e){return-1===e.indexOf("/")?[e,e]:e.split("/")}function Zt(e,t){try{e.emit("error",t)}catch(e){_("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),_("error",t)}}function er(e){return/^1-/.test(e)}function tr(e,t){var r=Object.keys(t._attachments);return Er.all(r.map(function(r){return e.getAttachment(t._id,r,{rev:t._rev})}))}function rr(e,t,r,n){function i(t){return e.allDocs({keys:t,include_docs:!0,conflicts:!0}).then(function(e){if(n.cancelled)throw new Error("cancelled");e.rows.forEach(function(e){e.deleted||!e.doc||!er(e.value.rev)||function(e){return e._attachments&&Object.keys(e._attachments).length>0}(e.doc)||function(e){return e._conflicts&&e._conflicts.length>0}(e.doc)||(e.doc._conflicts&&delete e.doc._conflicts,s.push(e.doc),delete r[e.id])})})}r=o(r);var s=[],a=!0;return Er.resolve().then(function(){var e=Object.keys(r).filter(function(e){var t=r[e].missing;return 1===t.length&&er(t[0])});if(e.length>0)return i(e)}).then(function(){var i=function(e){var t=[];return Object.keys(e).forEach(function(r){e[r].missing.forEach(function(e){t.push({id:r,rev:e})})}),{docs:t,revs:!0,latest:!0}}(r);if(i.docs.length)return e.bulkGet(i).then(function(r){if(n.cancelled)throw new Error("cancelled");return Er.all(r.results.map(function(r){return Er.all(r.docs.map(function(r){var n=r.ok;return r.error&&(a=!1),n&&n._attachments?function(e,t,r){var n=F(t)&&!F(e),i=Object.keys(r._attachments);return n?e.get(r._id).then(function(n){return Er.all(i.map(function(i){return function(e,t,r){return!e._attachments||!e._attachments[r]||e._attachments[r].digest!==t._attachments[r].digest}(n,r,i)?t.getAttachment(r._id,i):e.getAttachment(n._id,i)}))}).catch(function(e){if(404!==e.status)throw e;return tr(t,r)}):tr(t,r)}(t,e,n).then(function(e){var t=Object.keys(n._attachments);return e.forEach(function(e,r){var i=n._attachments[t[r]];delete i.stub,delete i.length,i.data=e}),n}):n}))})).then(function(e){s=s.concat(D(e).filter(Boolean))})})}).then(function(){return{ok:a,docs:s}})}function nr(e,t,r,n,i){return e.get(t).catch(function(r){if(404===r.status)return"http"!==e.adapter&&"https"!==e.adapter||w(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:n,_id:t,history:[],replicator:si,version:oi};throw r}).then(function(o){if(!i.cancelled&&o.last_seq!==r)return o.history=(o.history||[]).filter(function(e){return e.session_id!==n}),o.history.unshift({last_seq:r,session_id:n}),o.history=o.history.slice(0,ai),o.version=oi,o.replicator=si,o.session_id=n,o.last_seq=r,e.put(o).catch(function(o){if(409===o.status)return nr(e,t,r,n,i);throw o})})}function ir(e,t,r,n,i){this.src=e,this.target=t,this.id=r,this.returnValue=n,this.opts=i}function or(e,t){var r=e[0],n=e.slice(1),i=t[0],o=t.slice(1);if(!r||0===t.length)return{last_seq:ui,history:[]};if(sr(r.session_id,t))return{last_seq:r.last_seq,history:e};return sr(i.session_id,n)?{last_seq:i.last_seq,history:o}:or(n,o)}function sr(e,t){var r=t[0],n=t.slice(1);return!(!e||0===t.length)&&(e===r.session_id||sr(e,n))}function ar(e){return"number"==typeof e.status&&4===Math.floor(e.status/100)}function ur(e,t,r){var n=r.doc_ids?r.doc_ids.sort(de):"",i=r.filter?r.filter.toString():"",o="",s="",a="";return r.selector&&(a=JSON.stringify(r.selector)),r.filter&&r.query_params&&(o=JSON.stringify(function(e){return Object.keys(e).sort(de).reduce(function(t,r){return t[r]=e[r],t},{})}(r.query_params))),r.filter&&"_view"===r.filter&&(s=r.view.toString()),Er.all([e.id(),t.id()]).then(function(e){var t=e[0]+e[1]+i+s+o+n+a;return new Er(function(e){Ue(t,e)})}).then(function(e){return"_local/"+(e=e.replace(/\//g,".").replace(/\+/g,"_"))})}function cr(e,t,r,n,i){function s(){return k?Er.resolve():ur(e,t,r).then(function(i){w=i;var o={};o=!1===r.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:"source"===r.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:"target"===r.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},k=new ir(e,t,w,n,o)})}function a(){if(N=[],0!==_.docs.length){var e=_.docs,s={timeout:r.timeout};return t.bulkDocs({docs:e,new_edits:!1},s).then(function(t){if(n.cancelled)throw h(),new Error("cancelled");var r=Object.create(null);t.forEach(function(e){e.error&&(r[e.id]=e)});var s=Object.keys(r).length;i.doc_write_failures+=s,i.docs_written+=e.length-s,e.forEach(function(e){var t=r[e._id];if(t){if(i.errors.push(t),"unauthorized"!==t.name&&"forbidden"!==t.name)throw t;n.emit("denied",o(t))}else N.push(e)})},function(t){throw i.doc_write_failures+=e.length,t})}}function u(){if(_.error)throw new Error("There was a problem getting docs.");i.last_seq=j=_.seq;var e=o(i);return N.length&&(e.docs=N,n.emit("change",e)),C=!0,k.writeCheckpoint(_.seq,M).then(function(){if(C=!1,n.cancelled)throw h(),new Error("cancelled");_=void 0,y()}).catch(function(e){throw b(e),e})}function c(){return rr(e,t,_.diffs,n).then(function(e){_.error=!e.ok,e.docs.forEach(function(e){delete _.diffs[e._id],i.docs_read++,_.docs.push(e)})})}function l(){n.cancelled||_||(0!==S.length?(_=S.shift(),function(){var e={};return _.changes.forEach(function(t){"_user/"!==t.id&&(e[t.id]=t.changes.map(function(e){return e.rev}))}),t.revsDiff(e).then(function(e){if(n.cancelled)throw h(),new Error("cancelled");_.diffs=e})}().then(c).then(a).then(u).then(l).catch(function(e){p("batch processing terminated with error",e)})):f(!0))}function f(e){0!==D.changes.length?(e||F||D.changes.length>=B)&&(S.push(D),D={seq:0,changes:[],docs:[]},"pending"!==n.state&&"stopped"!==n.state||(n.state="active",n.emit("active")),l()):0!==S.length||_||((R&&q.live||F)&&(n.state="pending",n.emit("paused")),F&&h())}function p(e,t){O||(t.message||(t.message=e),i.ok=!1,i.status="aborting",S=[],D={seq:0,changes:[],docs:[]},h(t))}function h(o){O||n.cancelled&&(i.status="cancelled",C)||(i.status=i.status||"complete",i.end_time=new Date,i.last_seq=j,O=!0,o?((o=E(o)).result=i,"unauthorized"===o.name||"forbidden"===o.name?(n.emit("error",o),n.removeAllListeners()):function(e,t,r,n){if(!1===e.retry)return t.emit("error",r),void t.removeAllListeners();if("function"!=typeof e.back_off_function&&(e.back_off_function=x),t.emit("requestError",r),"active"===t.state||"pending"===t.state){t.emit("paused",r),t.state="stopped";var i=function(){e.current_back_off=li},o=function(){t.removeListener("active",i)};t.once("paused",o),t.once("active",i)}e.current_back_off=e.current_back_off||li,e.current_back_off=e.back_off_function(e.current_back_off),setTimeout(n,e.current_back_off)}(r,n,o,function(){cr(e,t,r,n)})):(n.emit("complete",i),n.removeAllListeners()))}function d(e){if(n.cancelled)return h();A(r)(e)&&(D.seq=e.seq,D.changes.push(e),f(0===S.length&&q.live))}function m(e){if(P=!1,n.cancelled)return h();if(e.results.length>0)q.since=e.last_seq,y(),f(!0);else{var t=function(){R?(q.live=!0,y()):F=!0,f(!0)};_||0!==e.results.length?t():(C=!0,k.writeCheckpoint(e.last_seq,M).then(function(){C=!1,i.last_seq=j=e.last_seq,t()}).catch(b))}}function v(e){if(P=!1,n.cancelled)return h();p("changes rejected",e)}function y(){function t(){o.cancel()}function i(){n.removeListener("cancel",t)}if(!P&&!F&&S.length<T){P=!0,n._changes&&(n.removeListener("cancel",n._abortChanges),n._changes.cancel()),n.once("cancel",t);var o=e.changes(q).on("change",d);o.then(i,i),o.then(m).catch(v),r.retry&&(n._changes=o,n._abortChanges=t)}}function g(){s().then(function(){if(!n.cancelled)return k.getCheckpoint().then(function(e){q={since:j=e,limit:B,batch_size:B,style:"all_docs",doc_ids:I,selector:L,return_docs:!0},r.filter&&("string"!=typeof r.filter?q.include_docs=!0:q.filter=r.filter),"heartbeat"in r&&(q.heartbeat=r.heartbeat),"timeout"in r&&(q.timeout=r.timeout),r.query_params&&(q.query_params=r.query_params),r.view&&(q.view=r.view),y()});h()}).catch(function(e){p("getCheckpoint rejected with ",e)})}function b(e){C=!1,p("writeCheckpoint completed with error",e)}var _,w,k,S=[],D={seq:0,changes:[],docs:[]},C=!1,F=!1,O=!1,j=0,R=r.continuous||r.live||!1,B=r.batch_size||100,T=r.batches_limit||10,P=!1,I=r.doc_ids,L=r.selector,N=[],M=Xr();i=i||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var q={};n.ready(e,t),n.cancelled?h():(n._addedListeners||(n.once("cancel",h),"function"==typeof r.complete&&(n.once("error",r.complete),n.once("complete",function(e){r.complete(null,e)})),n._addedListeners=!0),void 0===r.since?g():s().then(function(){return C=!0,k.writeCheckpoint(r.since,M)}).then(function(){C=!1,n.cancelled?h():(j=r.since,g())}).catch(b))}function lr(){yr.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var e=this,t=new Er(function(t,r){e.once("complete",t),e.once("error",r)});e.then=function(e,r){return t.then(e,r)},e.catch=function(e){return t.catch(e)},e.catch(function(){})}function fr(e,t){var r=t.PouchConstructor;return"string"==typeof e?new r(e,t):e}function pr(e,t,r,n){if("function"==typeof r&&(n=r,r={}),void 0===r&&(r={}),r.doc_ids&&!Array.isArray(r.doc_ids))throw E(Wr,"`doc_ids` filter parameter is not a list.");r.complete=n,(r=o(r)).continuous=r.continuous||r.live,r.retry="retry"in r&&r.retry,r.PouchConstructor=r.PouchConstructor||this;var i=new lr(r);return cr(fr(e,r),fr(t,r),r,i),i}function hr(e,t,r,n){return"function"==typeof r&&(n=r,r={}),void 0===r&&(r={}),r=o(r),r.PouchConstructor=r.PouchConstructor||this,e=fr(e,r),t=fr(t,r),new dr(e,t,r,n)}function dr(e,t,r,n){function i(e){d.emit("change",{direction:"pull",change:e})}function o(e){d.emit("change",{direction:"push",change:e})}function s(e){d.emit("denied",{direction:"push",doc:e})}function a(e){d.emit("denied",{direction:"pull",doc:e})}function u(){d.pushPaused=!0,d.pullPaused&&d.emit("paused")}function c(){d.pullPaused=!0,d.pushPaused&&d.emit("paused")}function l(){d.pushPaused=!1,d.pullPaused&&d.emit("active",{direction:"push"})}function f(){d.pullPaused=!1,d.pushPaused&&d.emit("active",{direction:"pull"})}function p(e){return function(t,r){("change"===t&&(r===i||r===o)||"denied"===t&&(r===a||r===s)||"paused"===t&&(r===c||r===u)||"active"===t&&(r===f||r===l))&&(t in y||(y[t]={}),y[t][e]=!0,2===Object.keys(y[t]).length&&d.removeAllListeners(t))}}function h(e,t,r){-1==e.listeners(t).indexOf(r)&&e.on(t,r)}var d=this;this.canceled=!1;var m=r.push?jr({},r,r.push):r,v=r.pull?jr({},r,r.pull):r;this.push=pr(e,t,m),this.pull=pr(t,e,v),this.pushPaused=!0,this.pullPaused=!0;var y={};r.live&&(this.push.on("complete",d.pull.cancel.bind(d.pull)),this.pull.on("complete",d.push.cancel.bind(d.push))),this.on("newListener",function(e){"change"===e?(h(d.pull,"change",i),h(d.push,"change",o)):"denied"===e?(h(d.pull,"denied",a),h(d.push,"denied",s)):"active"===e?(h(d.pull,"active",f),h(d.push,"active",l)):"paused"===e&&(h(d.pull,"paused",c),h(d.push,"paused",u))}),this.on("removeListener",function(e){"change"===e?(d.pull.removeListener("change",i),d.push.removeListener("change",o)):"denied"===e?(d.pull.removeListener("denied",a),d.push.removeListener("denied",s)):"active"===e?(d.pull.removeListener("active",f),d.push.removeListener("active",l)):"paused"===e&&(d.pull.removeListener("paused",c),d.push.removeListener("paused",u))}),this.pull.on("removeListener",p("pull")),this.push.on("removeListener",p("push"));var g=Er.all([this.push,this.pull]).then(function(e){var t={push:e[0],pull:e[1]};return d.emit("complete",t),n&&n(null,t),d.removeAllListeners(),t},function(e){if(d.cancel(),n?n(e):d.emit("error",e),d.removeAllListeners(),n)throw e});this.then=function(e,t){return g.then(e,t)},this.catch=function(e){return g.catch(e)}}var mr=n(e(7)),vr=n(e(1)),yr=e(4),gr=n(e(6)),br=n(e(5)),_r=n(e(13)),xr=n(e(2)),wr=n(e(10)),kr=n(e(14)),Er="function"==typeof Promise?Promise:mr,Sr=Function.prototype.toString,Ar=Sr.call(Object);f.prototype.get=function(e){var t=c(e);return this._store[t]},f.prototype.set=function(e,t){var r=c(e);return this._store[r]=t,!0},f.prototype.has=function(e){return c(e)in this._store},f.prototype.delete=function(e){var t=c(e),r=t in this._store;return delete this._store[t],r},f.prototype.forEach=function(e){for(var t=Object.keys(this._store),r=0,n=t.length;r<n;r++){var i=t[r];e(this._store[i],i=l(i))}},Object.defineProperty(f.prototype,"size",{get:function(){return Object.keys(this._store).length}}),p.prototype.add=function(e){return this._store.set(e,!0)},p.prototype.has=function(e){return this._store.has(e)},p.prototype.forEach=function(e){this._store.forEach(function(t,r){e(r)})},Object.defineProperty(p.prototype,"size",{get:function(){return this._store.size}});var Dr,Cr;!function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}()?(Dr=p,Cr=f):(Dr=Set,Cr=Map);var Fr,Or=6;if(y())Fr=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),Fr=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){Fr=!1}gr(b,yr.EventEmitter),b.prototype.addListener=function(e,t,r,n){function i(){if(o._listeners[t])if(s)s="waiting";else{s=!0;var e=h(n,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);r.changes(e).on("change",function(e){e.seq>n.since&&!n.cancelled&&(n.since=e.seq,n.onChange(e))}).on("complete",function(){"waiting"===s&&br(i),s=!1}).on("error",function(){s=!1})}}if(!this._listeners[t]){var o=this,s=!1;this._listeners[t]=i,this.on(e,i)}},b.prototype.removeListener=function(e,t){t in this._listeners&&(yr.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},b.prototype.notifyLocalWindows=function(e){y()?chrome.storage.local.set({dbName:e}):g()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},b.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var jr="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t};gr(k,Error),k.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};new k(401,"unauthorized","Name or password is incorrect.");var Rr=new k(400,"bad_request","Missing JSON list of 'docs'"),Br=new k(404,"not_found","missing"),Tr=new k(409,"conflict","Document update conflict"),Pr=new k(400,"bad_request","_id field must contain a string"),Ir=new k(412,"missing_id","_id is required for puts"),Lr=new k(400,"bad_request","Only reserved document ids may start with underscore."),Nr=(new k(412,"precondition_failed","Database not open"),new k(500,"unknown_error","Database encountered an unknown error")),Mr=new k(500,"badarg","Some query argument is invalid"),qr=(new k(400,"invalid_request","Request was invalid"),new k(400,"query_parse_error","Some query parameter is invalid")),$r=new k(500,"doc_validation","Bad special document member"),Wr=new k(400,"bad_request","Something wrong with the request"),Ur=new k(400,"bad_request","Document must be a JSON object"),zr=(new k(404,"not_found","Database not found"),new k(500,"indexed_db_went_bad","unknown")),Vr=new k(500,"web_sql_went_bad","unknown"),Gr=(new k(500,"levelDB_went_went_bad","unknown"),new k(403,"forbidden","Forbidden by design doc validate_doc_update function"),new k(400,"bad_request","Invalid rev format")),Hr=(new k(412,"file_exists","The database could not be created, the file already exists."),new k(412,"missing_stub","A pre-existing attachment stub wasn't found"));new k(413,"invalid_url","Provided URL is invalid");var Jr=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Kr="queryKey",Qr=/(?:^|&)([^&=]*)=?([^&]*)/g,Yr=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Xr=_r;gr(ee,yr.EventEmitter),ee.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},ee.prototype.validateChanges=function(e){var t=e.complete,r=this;ue._changesFilterPlugin?ue._changesFilterPlugin.validate(e,function(n){if(n)return t(n);r.doChanges(e)}):r.doChanges(e)},ee.prototype.doChanges=function(e){var t=this,r=e.complete;if("live"in(e=o(e))&&!("continuous"in e)&&(e.continuous=e.live),e.processChange=te,"latest"===e.since&&(e.since="now"),e.since||(e.since=0),"now"!==e.since){if(ue._changesFilterPlugin){if(ue._changesFilterPlugin.normalize(e),ue._changesFilterPlugin.shouldFilter(this,e))return ue._changesFilterPlugin.filter(this,e)}else["doc_ids","filter","selector","view"].forEach(function(t){t in e&&_("warn",'The "'+t+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in e||(e.descending=!1),e.limit=0===e.limit?1:e.limit,e.complete=r;var n=this.db._changes(e);if(n&&"function"==typeof n.cancel){var i=t.cancel;t.cancel=vr(function(e){n.cancel(),i.apply(this,e)})}}else this.db.info().then(function(n){t.isCancelled?r(null,{status:"cancelled"}):(e.since=n.update_seq,t.doChanges(e))},r)},gr(se,yr.EventEmitter),se.prototype.post=u("post",function(e,t,r){if("function"==typeof t&&(r=t,t={}),"object"!=typeof e||Array.isArray(e))return r(E(Ur));this.bulkDocs({docs:[e]},t,ne(r,e._id))}),se.prototype.put=u("put",function(e,t,r){function n(r){"function"==typeof i._put&&!1!==t.new_edits?i._put(e,t,r):i.bulkDocs({docs:[e]},t,ne(r,e._id))}if("function"==typeof t&&(r=t,t={}),"object"!=typeof e||Array.isArray(e))return r(E(Ur));if(C(e._id),X(e._id)&&"function"==typeof this._putLocal)return e._deleted?this._removeLocal(e,r):this._putLocal(e,r);var i=this;t.force&&e._rev?(!function(){var r=e._rev.split("-"),n=r[1],i=parseInt(r[0],10)+1,o=P();e._revisions={start:i,ids:[o,n]},e._rev=i+"-"+o,t.new_edits=!1}(),n(function(t){var n=t?null:{ok:!0,id:e._id,rev:e._rev};r(t,n)})):n(r)}),se.prototype.putAttachment=u("putAttachment",function(e,t,r,n,i){function o(e){var r="_rev"in e?parseInt(e._rev,10):0;return e._attachments=e._attachments||{},e._attachments[t]={content_type:i,data:n,revpos:++r},s.put(e)}var s=this;return"function"==typeof i&&(i=n,n=r,r=null),void 0===i&&(i=n,n=r,r=null),i||_("warn","Attachment",t,"on document",e,"is missing content_type"),s.get(e).then(function(e){if(e._rev!==r)throw E(Tr);return o(e)},function(t){if(t.reason===Br.message)return o({_id:e});throw t})}),se.prototype.removeAttachment=u("removeAttachment",function(e,t,r,n){var i=this;i.get(e,function(e,o){if(e)n(e);else if(o._rev===r){if(!o._attachments)return n();delete o._attachments[t],0===Object.keys(o._attachments).length&&delete o._attachments,i.put(o,n)}else n(E(Tr))})}),se.prototype.remove=u("remove",function(e,t,r,n){var i;"string"==typeof t?(i={_id:e,_rev:t},"function"==typeof r&&(n=r,r={})):(i=e,"function"==typeof t?(n=t,r={}):(n=r,r=t)),(r=r||{}).was_delete=!0;var o={_id:i._id,_rev:i._rev||r.rev};if(o._deleted=!0,X(o._id)&&"function"==typeof this._removeLocal)return this._removeLocal(i,n);this.bulkDocs({docs:[o]},r,ne(n,o._id))}),se.prototype.revsDiff=u("revsDiff",function(e,t,r){function n(e,t){s.has(e)||s.set(e,{missing:[]}),s.get(e).missing.push(t)}"function"==typeof t&&(r=t,t={});var i=Object.keys(e);if(!i.length)return r(null,{});var o=0,s=new Cr;i.map(function(t){this._getRevisionTree(t,function(a,u){if(a&&404===a.status&&"missing"===a.message)s.set(t,{missing:e[t]});else{if(a)return r(a);!function(t,r){var i=e[t].slice(0);L(r,function(e,r,o,s,a){var u=r+"-"+o,c=i.indexOf(u);-1!==c&&(i.splice(c,1),"available"!==a.status&&n(t,u))}),i.forEach(function(e){n(t,e)})}(t,u)}if(++o===i.length){var c={};return s.forEach(function(e,t){c[t]=e}),r(null,c)}})},this)}),se.prototype.bulkGet=u("bulkGet",function(e,t){v(this,e,t)}),se.prototype.compactDocument=u("compactDocument",function(e,t,r){var n=this;this._getRevisionTree(e,function(i,o){if(i)return r(i);var s=function(e){var t={},r=[];return L(e,function(e,n,i,o){var s=n+"-"+i;return e&&(t[s]=0),void 0!==o&&r.push({from:o,to:s}),s}),r.reverse(),r.forEach(function(e){void 0===t[e.from]?t[e.from]=1+t[e.to]:t[e.from]=Math.min(t[e.from],1+t[e.to])}),t}(o),a=[],u=[];Object.keys(s).forEach(function(e){s[e]>t&&a.push(e)}),L(o,function(e,t,r,n,i){var o=t+"-"+r;"available"===i.status&&-1!==a.indexOf(o)&&u.push(o)}),n._doCompaction(e,u,r)})}),se.prototype.compact=u("compact",function(e,t){"function"==typeof e&&(t=e,e={});e=e||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:e,callback:t}),1===this._compactionQueue.length&&oe(this)}),se.prototype._compact=function(e,t){var r=this,n={return_docs:!1,last_seq:e.last_seq||0},i=[];r.changes(n).on("change",function(e){i.push(r.compactDocument(e.id,0))}).on("complete",function(e){var n=e.last_seq;Er.all(i).then(function(){return T(r,"_local/compaction",function(e){return(!e.last_seq||e.last_seq<n)&&(e.last_seq=n,e)})}).then(function(){t(null,{ok:!0})}).catch(t)}).on("error",t)},se.prototype.get=u("get",function(e,t,r){function n(){var n=[],s=i.length;if(!s)return r(null,n);i.forEach(function(i){o.get(e,{rev:i,revs:t.revs,latest:t.latest,attachments:t.attachments},function(e,t){if(e)n.push({missing:i});else{for(var o,a=0,u=n.length;a<u;a++)if(n[a].ok&&n[a].ok._rev===t._rev){o=!0;break}o||n.push({ok:t})}--s||r(null,n)})})}if("function"==typeof t&&(r=t,t={}),"string"!=typeof e)return r(E(Pr));if(X(e)&&"function"==typeof this._getLocal)return this._getLocal(e,r);var i=[],o=this;if(!t.open_revs)return this._get(e,t,function(n,i){if(n)return n.docId=e,r(n);var s=i.doc,a=i.metadata,u=i.ctx;if(t.conflicts){var c=q(a);c.length&&(s._conflicts=c)}if(Y(a,s._rev)&&(s._deleted=!0),t.revs||t.revs_info){for(var l=s._rev.split("-"),f=parseInt(l[0],10),p=l[1],h=W(a.rev_tree),d=null,m=0;m<h.length;m++){var v=h[m],y=v.ids.map(function(e){return e.id}).indexOf(p);(y===f-1||!d&&-1!==y)&&(d=v)}var g=d.ids.map(function(e){return e.id}).indexOf(s._rev.split("-")[1])+1,b=d.ids.length-g;if(d.ids.splice(g,b),d.ids.reverse(),t.revs&&(s._revisions={start:d.pos+d.ids.length-1,ids:d.ids.map(function(e){return e.id})}),t.revs_info){var _=d.pos+d.ids.length;s._revs_info=d.ids.map(function(e){return _--,{rev:_+"-"+e.id,status:e.opts.status}})}}if(t.attachments&&s._attachments){var x=s._attachments,w=Object.keys(x).length;if(0===w)return r(null,s);Object.keys(x).forEach(function(e){this._getAttachment(s._id,e,x[e],{rev:s._rev,binary:t.binary,ctx:u},function(t,n){var i=s._attachments[e];i.data=n,delete i.stub,delete i.length,--w||r(null,s)})},o)}else{if(s._attachments)for(var k in s._attachments)s._attachments.hasOwnProperty(k)&&(s._attachments[k].stub=!0);r(null,s)}});if("all"===t.open_revs)this._getRevisionTree(e,function(e,t){if(e)return r(e);i=M(t).map(function(e){return e.rev}),n()});else{if(!Array.isArray(t.open_revs))return r(E(Nr,"function_clause"));i=t.open_revs;for(var s=0;s<i.length;s++){var a=i[s];if("string"!=typeof a||!/^\d+-/.test(a))return r(E(Gr))}n()}}),se.prototype.getAttachment=u("getAttachment",function(e,t,r,n){var i=this;r instanceof Function&&(n=r,r={}),this._get(e,r,function(o,s){return o?n(o):s.doc._attachments&&s.doc._attachments[t]?(r.ctx=s.ctx,r.binary=!0,void i._getAttachment(e,t,s.doc._attachments[t],r,n)):n(E(Br))})}),se.prototype.allDocs=u("allDocs",function(e,t){if("function"==typeof e&&(t=e,e={}),e.skip=void 0!==e.skip?e.skip:0,e.start_key&&(e.startkey=e.start_key),e.end_key&&(e.endkey=e.end_key),"keys"in e){if(!Array.isArray(e.keys))return t(new TypeError("options.keys must be an array"));var r=["startkey","endkey","key"].filter(function(t){return t in e})[0];if(r)return void t(E(qr,"Query parameter `"+r+"` is not compatible with multi-get"));if(!F(this))return function(e,t,r){var n="limit"in t?t.keys.slice(t.skip,t.limit+t.skip):t.skip>0?t.keys.slice(t.skip):t.keys;if(t.descending&&n.reverse(),!n.length)return e._allDocs({limit:0},r);var i={offset:t.skip};return Er.all(n.map(function(r){var n=jr({key:r,deleted:"ok"},t);return["limit","skip","keys"].forEach(function(e){delete n[e]}),new Er(function(t,o){e._allDocs(n,function(e,n){if(e)return o(e);i.total_rows=n.total_rows,t(n.rows[0]||{key:r,error:"not_found"})})})})).then(function(e){return i.rows=e,i})}(this,e,t)}return this._allDocs(e,t)}),se.prototype.changes=function(e,t){return"function"==typeof e&&(t=e,e={}),new ee(this,e,t)},se.prototype.close=u("close",function(e){return this._closed=!0,this.emit("closed"),this._close(e)}),se.prototype.info=u("info",function(e){var t=this;this._info(function(r,n){if(r)return e(r);n.db_name=n.db_name||t.name,n.auto_compaction=!(!t.auto_compaction||F(t)),n.adapter=t.adapter,e(null,n)})}),se.prototype.id=u("id",function(e){return this._id(e)}),se.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},se.prototype.bulkDocs=u("bulkDocs",function(e,t,r){if("function"==typeof t&&(r=t,t={}),t=t||{},Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return r(E(Rr));for(var n=0;n<e.docs.length;++n)if("object"!=typeof e.docs[n]||Array.isArray(e.docs[n]))return r(E(Ur));var i;if(e.docs.forEach(function(e){e._attachments&&Object.keys(e._attachments).forEach(function(t){i=i||function(e){return"_"===e.charAt(0)&&e+" is not a valid attachment name, attachment names cannot start with '_'"}(t),e._attachments[t].content_type||_("warn","Attachment",t,"on document",e._id,"is missing content_type")})}),i)return r(E(Wr,i));"new_edits"in t||(t.new_edits=!("new_edits"in e)||e.new_edits);var o=this;t.new_edits||F(o)||e.docs.sort(ie),function(e){for(var t=0;t<e.length;t++){var r=e[t];if(r._deleted)delete r._attachments;else if(r._attachments)for(var n=Object.keys(r._attachments),i=0;i<n.length;i++){var o=n[i];r._attachments[o]=h(r._attachments[o],["data","digest","content_type","length","revpos","stub"])}}}(e.docs);var s=e.docs.map(function(e){return e._id});return this._bulkDocs(e,t,function(e,n){if(e)return r(e);if(t.new_edits||(n=n.filter(function(e){return e.error})),!F(o))for(var i=0,a=n.length;i<a;i++)n[i].id=n[i].id||s[i];r(null,n)})}),se.prototype.registerDependentDatabase=u("registerDependentDatabase",function(e,t){var r=new this.constructor(e,this.__opts);T(this,"_local/_pouch_dependentDbs",function(t){return t.dependentDbs=t.dependentDbs||{},!t.dependentDbs[e]&&(t.dependentDbs[e]=!0,t)}).then(function(){t(null,{db:r})}).catch(t)}),se.prototype.destroy=u("destroy",function(e,t){function r(){n._destroy(e,function(e,r){if(e)return t(e);n._destroyed=!0,n.emit("destroyed"),t(null,r||{ok:!0})})}"function"==typeof e&&(t=e,e={});var n=this,i=!("use_prefix"in n)||n.use_prefix;if(F(n))return r();n.get("_local/_pouch_dependentDbs",function(e,o){if(e)return 404!==e.status?t(e):r();var s=o.dependentDbs,a=n.constructor,u=Object.keys(s).map(function(e){var t=i?e.replace(new RegExp("^"+a.prefix),""):e;return new a(t,n.__opts).destroy()});Er.all(u).then(r,t)})}),ae.prototype.execute=function(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()},ae.prototype.fail=function(e){this.failed=e,this.execute()},ae.prototype.ready=function(e){this.isReady=!0,this.db=e,this.execute()},ae.prototype.addTask=function(e){this.queue.push(e),this.failed&&this.execute()},gr(ue,se),ue.adapters={},ue.preferredAdapters=[],ue.prefix="_pouch_";var Zr=new yr.EventEmitter;!function(e){Object.keys(yr.EventEmitter.prototype).forEach(function(t){"function"==typeof yr.EventEmitter.prototype[t]&&(e[t]=Zr[t].bind(Zr))});var t=e._destructionListeners=new Cr;e.on("ref",function(e){t.has(e.name)||t.set(e.name,[]),t.get(e.name).push(e)}),e.on("unref",function(e){if(t.has(e.name)){var r=t.get(e.name),n=r.indexOf(e);n<0||(r.splice(n,1),r.length>1?t.set(e.name,r):t.delete(e.name))}}),e.on("destroyed",function(e){if(t.has(e)){var r=t.get(e);t.delete(e),r.forEach(function(e){e.emit("destroyed",!0)})}})}(ue),ue.adapter=function(e,t,r){t.valid()&&(ue.adapters[e]=t,r&&ue.preferredAdapters.push(e))},ue.plugin=function(e){if("function"==typeof e)e(ue);else{if("object"!=typeof e||0===Object.keys(e).length)throw new Error('Invalid plugin: got "'+e+'", expected an object or a function');Object.keys(e).forEach(function(t){ue.prototype[t]=e[t]})}return this.__defaults&&(ue.__defaults=jr({},this.__defaults)),ue},ue.defaults=function(e){function t(e,r){if(!(this instanceof t))return new t(e,r);r=r||{},e&&"object"==typeof e&&(e=(r=e).name,delete r.name),r=jr({},t.__defaults,r),ue.call(this,e,r)}return gr(t,ue),t.preferredAdapters=ue.preferredAdapters.slice(),Object.keys(ue).forEach(function(e){e in t||(t[e]=ue[e])}),t.__defaults=jr({},this.__defaults,e),t};var en=["$or","$nor","$not"],tn=-324,rn=3,nn="",on={$elemMatch:function(e,t,r,n){return!!Array.isArray(n)&&(0!==n.length&&("object"==typeof n[0]?n.some(function(e){return we(e,t,Object.keys(t))}):n.some(function(n){return ke(t,e,r,n)})))},$allMatch:function(e,t,r,n){return!!Array.isArray(n)&&(0!==n.length&&("object"==typeof n[0]?n.every(function(e){return we(e,t,Object.keys(t))}):n.every(function(n){return ke(t,e,r,n)})))},$eq:function(e,t,r,n){return Se(n)&&0===de(n,t)},$gte:function(e,t,r,n){return Se(n)&&de(n,t)>=0},$gt:function(e,t,r,n){return Se(n)&&de(n,t)>0},$lte:function(e,t,r,n){return Se(n)&&de(n,t)<=0},$lt:function(e,t,r,n){return Se(n)&&de(n,t)<0},$exists:function(e,t,r,n){return t?Se(n):!Se(n)},$mod:function(e,t,r,n){return Ee(n)&&function(e,t){var r=t[0],n=t[1];if(0===r)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(r,10)!==r)throw new Error("Divisor is not an integer");if(parseInt(n,10)!==n)throw new Error("Modulus is not an integer");return parseInt(e,10)===e&&e%r===n}(n,t)},$ne:function(e,t,r,n){return t.every(function(e){return 0!==de(n,e)})},$in:function(e,t,r,n){return Ee(n)&&Ae(n,t)},$nin:function(e,t,r,n){return Ee(n)&&!Ae(n,t)},$size:function(e,t,r,n){return Ee(n)&&function(e,t){return e.length===t}(n,t)},$all:function(e,t,r,n){return Array.isArray(n)&&function(e,t){return t.every(function(t){return e.indexOf(t)>-1})}(n,t)},$regex:function(e,t,r,n){return Ee(n)&&function(e,t){return new RegExp(t).test(e)}(n,t)},$type:function(e,t,r,n){return function(e,t){switch(t){case"null":return null===e;case"boolean":return"boolean"==typeof e;case"number":return"number"==typeof e;case"string":return"string"==typeof e;case"array":return e instanceof Array;case"object":return"[object Object]"==={}.toString.call(e)}throw new Error(t+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}(n,t)}};ue.plugin(function(e){e.debug=xr;var t={};e.on("debug",function(e){var r=e[0],n=e.slice(1);t[r]||(t[r]=xr("pouchdb:"+r)),t[r].apply(null,n)})}),ue.plugin(function(e){e._changesFilterPlugin={validate:Ce,normalize:Fe,shouldFilter:Oe,filter:je}}),ue.version="6.3.2";var sn,an=Re(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),un=Re(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]),cn=function(e){return atob(e)},ln=function(e){return btoa(e)},fn=r.setImmediate||r.setTimeout,pn=32768,hn=5,dn="document-store",mn="by-sequence",vn="attach-store",yn="attach-seq-store",gn="meta-store",bn="local-store",_n="detect-blob-support",xn=new b,wn=!1,kn=[],En=new Cr,Sn=new Cr;ft.valid=function(){return!("undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform))&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var An=7,Dn=dt("document-store"),Cn=dt("by-sequence"),Fn=dt("attach-store"),On=dt("local-store"),jn=dt("metadata-store"),Rn=dt("attach-seq-store"),Bn=new Cr,Tn=new b,Pn=1,In="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+Cn+" (seq, deleted)",Ln="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+Cn+" (doc_id, rev)",Nn="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+Dn+" (winningseq)",Mn="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+Rn+" (seq)",qn="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+Rn+" (digest, seq)",$n=Cn+".seq = "+Dn+".winningseq",Wn=Cn+".seq AS seq, "+Cn+".deleted AS deleted, "+Cn+".json AS data, "+Cn+".rev AS rev, "+Dn+".json AS metadata";At.valid=function(){return"function"==typeof openDatabase&&Et()},At.use_prefix=!0;var Un=function(){try{return new XMLHttpRequest,!0}catch(e){return!1}}(),zn=function(){},Vn=25,Gn=50,Hn=5e3,Jn=1e4,Kn={};Nt.valid=function(){return!0};gr(Mt,Error),gr(qt,Error),gr($t,Error);var Qn=_.bind(null,"log"),Yn=Array.isArray,Xn=JSON.parse;Kt.prototype.add=function(e){return this.promise=this.promise.catch(function(){}).then(function(){return e()}),this.promise},Kt.prototype.finish=function(){return this.promise};var Zn={},ei=new Kt,ti=50,ri={_sum:function(e,t){return Ht(t)},_count:function(e,t){return t.length},_stats:function(e,t){return{sum:Ht(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:function(e){for(var t=0,r=0,n=e.length;r<n;r++){var i=e[r];t+=i*i}return t}(t)}}},ni=function(e,t,r,n){function i(e,t,r){try{t(r)}catch(t){Zt(e,t)}}function o(e,t,r,n,i){try{return{output:t(r,n,i)}}catch(t){return Zt(e,t),{error:t}}}function s(e,t){var r=de(e.key,t.key);return 0!==r?r:de(e.value,t.value)}function a(e){var t=e.value;return t&&"object"==typeof t&&t._id||e.id}function u(e){return function(t){return e.include_docs&&e.attachments&&e.binary&&function(e){e.rows.forEach(function(e){var t=e.doc&&e.doc._attachments;t&&Object.keys(t).forEach(function(e){var r=t[e];t[e].data=Le(r.data,r.content_type)})})}(t),t}}function c(e,t,r,n){var i=t[e];void 0!==i&&(n&&(i=encodeURIComponent(JSON.stringify(i))),r.push(e+"="+i))}function l(e){if(void 0!==e){var t=Number(e);return isNaN(t)||t!==parseInt(e,10)?e:t}}function f(e,t){var r=e.descending?"endkey":"startkey",n=e.descending?"startkey":"endkey";if(void 0!==e[r]&&void 0!==e[n]&&de(e[r],e[n])>0)throw new Mt("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(t.reduce&&!1!==e.reduce){if(e.include_docs)throw new Mt("{include_docs:true} is invalid for reduce");if(e.keys&&e.keys.length>1&&!e.group&&!e.group_level)throw new Mt("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(t){var r=function(e){if(e){if("number"!=typeof e)return new Mt('Invalid value for integer: "'+e+'"');if(e<0)return new Mt('Invalid value for positive integer: "'+e+'"')}}(e[t]);if(r)throw r})}function p(e){return function(t){if(404===t.status)return e;throw t}}function h(e,t,r){var n="_local/doc_"+e,i={_id:n,keys:[]},o=r.get(e),s=o[0];return(function(e){return 1===e.length&&/^1-/.test(e[0].rev)}(o[1])?Er.resolve(i):t.db.get(n).catch(p(i))).then(function(e){return function(e){return e.keys.length?t.db.allDocs({keys:e.keys,include_docs:!0}):Er.resolve({rows:[]})}(e).then(function(t){return function(e,t){for(var r=[],n=new Dr,i=0,o=t.rows.length;i<o;i++){var a=t.rows[i].doc;if(a&&(r.push(a),n.add(a._id),a._deleted=!s.has(a._id),!a._deleted)){var u=s.get(a._id);"value"in u&&(a.value=u.value)}}var c=Vt(s);return c.forEach(function(e){if(!n.has(e)){var t={_id:e},i=s.get(e);"value"in i&&(t.value=i.value),r.push(t)}}),e.keys=zt(c.concat(e.keys)),r.push(e),r}(e,t)})})}function d(e){var t="string"==typeof e?e:e.name,r=Zn[t];return r||(r=Zn[t]=new Kt),r}function m(e){return Ut(d(e),function(){return function(e){function r(t,r){return function(){return function(e,t,r){return e.db.get("_local/lastSeq").catch(p({_id:"_local/lastSeq",seq:0})).then(function(n){var i=Vt(t);return Er.all(i.map(function(r){return h(r,e,t)})).then(function(t){var i=D(t);return n.seq=r,i.push(n),e.db.bulkDocs({docs:i})})})}(e,t,r)}}function n(){return e.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:l,limit:ti}).then(o)}function o(t){var o=t.results;if(o.length){var p=function(t){for(var r=new Cr,n=0,o=t.length;n<o;n++){var f=t[n];if("_"!==f.doc._id[0]){a=[],(u=f.doc)._deleted||i(e.sourceDB,c,u),a.sort(s);var p=function(e){for(var t,r=new Cr,n=0,i=e.length;n<i;n++){var o=e[n],s=[o.key,o.id];n>0&&0===de(o.key,t)&&s.push(n),r.set(ye(s),o),t=o.key}return r}(a);r.set(f.doc._id,[p,f.changes])}l=f.seq}return r}(o);if(f.add(r(p,l)),!(o.length<ti))return n()}}var a,u,c=t(e.mapFun,function(e,t){var r={id:u._id,key:me(e)};void 0!==t&&null!==t&&(r.value=me(t)),a.push(r)}),l=e.seq||0,f=new Kt;return n().then(function(){return f.finish()}).then(function(){e.seq=l})}(e)})()}function v(e,t){return Ut(d(e),function(){return function(e,t){function n(t){return t.include_docs=!0,e.db.allDocs(t).then(function(e){return s=e.total_rows,e.rows.map(function(e){if("value"in e.doc&&"object"==typeof e.doc.value&&null!==e.doc.value){var t=Object.keys(e.doc.value).sort(),r=["id","key","value"];if(!(t<r||t>r))return e.doc.value}var n=function(e){for(var t=[],r=[],n=0;;){var i=e[n++];if("\0"!==i)switch(i){case"1":t.push(null);break;case"2":t.push("1"===e[n]),n++;break;case"3":var o=ge(e,n);t.push(o.num),n+=o.length;break;case"4":for(var s="";;){var a=e[n];if("\0"===a)break;s+=a,n++}s=s.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),t.push(s);break;case"5":var u={element:[],index:t.length};t.push(u.element),r.push(u);break;case"6":var c={element:{},index:t.length};t.push(c.element),r.push(c);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}else{if(1===t.length)return t.pop();be(t,r)}}}(e.doc._id);return{key:n[0],id:n[1],value:"value"in e.doc?e.doc.value:null}})})}function i(n){var i;if(i=u?function(e,t,n){0===n.group_level&&delete n.group_level;var i=n.group||n.group_level,s=r(e.reduceFun),a=[],u=isNaN(n.group_level)?Number.POSITIVE_INFINITY:n.group_level;t.forEach(function(e){var t=a[a.length-1],r=i?e.key:null;if(i&&Array.isArray(r)&&(r=r.slice(0,u)),t&&0===de(t.groupKey,r))return t.keys.push([e.key,e.id]),void t.values.push(e.value);a.push({keys:[[e.key,e.id]],values:[e.value],groupKey:r})}),t=[];for(var c=0,l=a.length;c<l;c++){var f=a[c],p=o(e.sourceDB,s,f.keys,f.values,!1);if(p.error&&p.error instanceof $t)throw p.error;t.push({value:p.error?null:p.output,key:f.groupKey})}return{rows:function(e,t,r){return r=r||0,"number"==typeof t?e.slice(r,t+r):r>0?e.slice(r):e}(t,n.limit,n.skip)}}(e,n,t):{total_rows:s,offset:c,rows:n},t.include_docs){var l=zt(n.map(a));return e.sourceDB.allDocs({keys:l,include_docs:!0,conflicts:t.conflicts,attachments:t.attachments,binary:t.binary}).then(function(e){var t=new Cr;return e.rows.forEach(function(e){t.set(e.id,e.doc)}),n.forEach(function(e){var r=a(e),n=t.get(r);n&&(e.doc=n)}),i})}return i}var s,u=e.reduceFun&&!1!==t.reduce,c=t.skip||0;if(void 0===t.keys||t.keys.length||(t.limit=0,delete t.keys),void 0!==t.keys){var l=t.keys,f=l.map(function(e){var t={startkey:ye([e]),endkey:ye([e,{}])};return n(t)});return Er.all(f).then(D).then(i)}var p,h,d={descending:t.descending};if("start_key"in t&&(p=t.start_key),"startkey"in t&&(p=t.startkey),"end_key"in t&&(h=t.end_key),"endkey"in t&&(h=t.endkey),void 0!==p&&(d.startkey=ye(t.descending?[p,{}]:[p])),void 0!==h){var m=!1!==t.inclusive_end;t.descending&&(m=!m),d.endkey=ye(m?[h,{}]:[h])}if(void 0!==t.key){var v=ye([t.key]),y=ye([t.key,{}]);d.descending?(d.endkey=v,d.startkey=y):(d.startkey=v,d.endkey=y)}return u||("number"==typeof t.limit&&(d.limit=t.limit),d.skip=c),n(d).then(i)}(e,t)})()}function y(t,r,i){if("function"==typeof t._query)return function(e,t,r){return new Er(function(n,i){e._query(t,r,function(e,t){if(e)return i(e);n(t)})})}(t,r,i);if(F(t))return function(e,t,r){var n,i=[],o="GET";if(c("reduce",r,i),c("include_docs",r,i),c("attachments",r,i),c("limit",r,i),c("descending",r,i),c("group",r,i),c("group_level",r,i),c("skip",r,i),c("stale",r,i),c("conflicts",r,i),c("startkey",r,i,!0),c("start_key",r,i,!0),c("endkey",r,i,!0),c("end_key",r,i,!0),c("inclusive_end",r,i),c("key",r,i,!0),i=i.join("&"),i=""===i?"":"?"+i,void 0!==r.keys){var s="keys="+encodeURIComponent(JSON.stringify(r.keys));s.length+i.length+1<=2e3?i+=("?"===i[0]?"&":"?")+s:(o="POST","string"==typeof t?n={keys:r.keys}:t.keys=r.keys)}if("string"==typeof t){var a=Xt(t);return e.request({method:o,url:"_design/"+a[0]+"/_view/"+a[1]+i,body:n}).then(function(e){return e.rows.forEach(function(e){if(e.value&&e.value.error&&"builtin_reduce_error"===e.value.error)throw new Error(e.reason)}),e}).then(u(r))}return n=n||{},Object.keys(t).forEach(function(e){Array.isArray(t[e])?n[e]=t[e]:n[e]=t[e].toString()}),e.request({method:"POST",url:"_temp_view"+i,body:n}).then(u(r))}(t,r,i);if("string"!=typeof r)return f(i,r),ei.add(function(){return Yt(t,"temp_view/temp_view",r.map,r.reduce,!0,e).then(function(e){return function(e,t){return e.then(function(e){return t().then(function(){return e})},function(e){return t().then(function(){throw e})})}(m(e).then(function(){return v(e,i)}),function(){return e.db.destroy()})})}),ei.finish();var o=r,s=Xt(o),a=s[0],l=s[1];return t.get("_design/"+a).then(function(r){var s=r.views&&r.views[l];if(!s)throw new qt("ddoc "+r._id+" has no view named "+l);return n(r,l),f(i,s),Yt(t,o,s.map,s.reduce,!1,e).then(function(e){return"ok"===i.stale||"update_after"===i.stale?("update_after"===i.stale&&br(function(){m(e)}),v(e,i)):m(e).then(function(){return v(e,i)})})})}return{query:function(e,t,r){var n=this;"function"==typeof t&&(r=t,t={}),t=t?function(e){return e.group_level=l(e.group_level),e.limit=l(e.limit),e.skip=l(e.skip),e}(t):{},"function"==typeof e&&(e={map:e});var i=Er.resolve().then(function(){return y(n,e,t)});return Wt(i,r),i},viewCleanup:function(e){return vr(function(t){var r=t.pop(),n=e.apply(this,t);return"function"==typeof r&&Wt(n,r),n})}(function(){return"function"==typeof this._viewCleanup?function(e){return new Er(function(t,r){e._viewCleanup(function(e,n){if(e)return r(e);t(n)})})}(this):F(this)?function(e){return e.request({method:"POST",url:"_view_cleanup"})}(this):function(t){return t.get("_local/"+e).then(function(e){var r=new Cr;Object.keys(e.views).forEach(function(e){var t=Xt(e),n="_design/"+t[0],i=t[1],o=r.get(n);o||(o=new Dr,r.set(n,o)),o.add(i)});var n={keys:Vt(r),include_docs:!0};return t.allDocs(n).then(function(n){var i={};n.rows.forEach(function(t){var n=t.key.substring(8);r.get(t.key).forEach(function(r){var o=n+"/"+r;e.views[o]||(o=r);var s=Object.keys(e.views[o]),a=t.doc&&t.doc.views&&t.doc.views[r];s.forEach(function(e){i[e]=i[e]||a})})});var o=Object.keys(i).filter(function(e){return!i[e]}).map(function(e){return Ut(d(e),function(){return new t.constructor(e,t.__opts).destroy()})()});return Er.all(o).then(function(){return{ok:!0}})})},p({ok:!0}))}(this)})}}("mrviews",function(e,t){if("function"==typeof e&&2===e.length){var r=e;return function(e){return r(e,t)}}return Jt(e.toString(),t)},function(e){var t=e.toString(),r=function(e){if(/^_sum/.test(e))return ri._sum;if(/^_count/.test(e))return ri._count;if(/^_stats/.test(e))return ri._stats;if(/^_/.test(e))throw new Error(e+" is not a supported reduce function.")}(t);return r||Jt(t)},function(e,t){var r=e.views&&e.views[t];if("string"!=typeof r.map)throw new qt("ddoc "+e._id+" has no string view named "+t+", instead found object of type: "+typeof r.map)}),ii={query:function(e,t,r){return ni.query.call(this,e,t,r)},viewCleanup:function(e){return ni.viewCleanup.call(this,e)}},oi=1,si="pouchdb",ai=5,ui=0;ir.prototype.writeCheckpoint=function(e,t){var r=this;return this.updateTarget(e,t).then(function(){return r.updateSource(e,t)})},ir.prototype.updateTarget=function(e,t){return this.opts.writeTargetCheckpoint?nr(this.target,this.id,e,t,this.returnValue):Er.resolve(!0)},ir.prototype.updateSource=function(e,t){if(this.opts.writeSourceCheckpoint){var r=this;return this.readOnlySource?Er.resolve(!0):nr(this.src,this.id,e,t,this.returnValue).catch(function(e){if(ar(e))return r.readOnlySource=!0,!0;throw e})}return Er.resolve(!0)};var ci={undefined:function(e,t){return 0===de(e.last_seq,t.last_seq)?t.last_seq:0},1:function(e,t){return function(e,t){return e.session_id===t.session_id?{last_seq:e.last_seq,history:e.history}:or(e.history,t.history)}(t,e).last_seq}};ir.prototype.getCheckpoint=function(){var e=this;return e.target.get(e.id).then(function(t){return e.readOnlySource?Er.resolve(t.last_seq):e.src.get(e.id).then(function(e){if(t.version!==e.version)return ui;var r;return(r=t.version?t.version.toString():"undefined")in ci?ci[r](t,e):ui},function(r){if(404===r.status&&t.last_seq)return e.src.put({_id:e.id,last_seq:ui}).then(function(){return ui},function(r){return ar(r)?(e.readOnlySource=!0,t.last_seq):ui});throw r})}).catch(function(e){if(404!==e.status)throw e;return ui})};var li=0;gr(lr,yr.EventEmitter),lr.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},lr.prototype.ready=function(e,t){function r(){n.cancel()}var n=this;n._readyCalled||(n._readyCalled=!0,e.once("destroyed",r),t.once("destroyed",r),n.once("complete",function(){e.removeListener("destroyed",r),t.removeListener("destroyed",r)}))},gr(dr,yr.EventEmitter),dr.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},ue.plugin(function(e){e.adapter("idb",ft,!0)}).plugin(function(e){e.adapter("websql",At,!0)}).plugin(function(e){e.adapter("http",Nt,!1),e.adapter("https",Nt,!1)}).plugin(ii).plugin(function(e){e.replicate=pr,e.sync=hr,Object.defineProperty(e.prototype,"replicate",{get:function(){var e=this;return{from:function(t,r,n){return e.constructor.replicate(t,e,r,n)},to:function(t,r,n){return e.constructor.replicate(e,t,r,n)}}}}),e.prototype.sync=function(e,t,r){return this.constructor.sync(this,e,t,r)}}),t.exports=ue}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,13:13,14:14,2:2,4:4,5:5,6:6,7:7}]},{},[15])(15)}),t.exports}(),t=function(){var e={},t={exports:e};return function(r){if("object"==typeof e&&void 0!==t)t.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pouchdbAdapterMemory=r()}}(function(){return function e(t,r,n){function i(s,a){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[s]={exports:{}};t[s][0].call(l.exports,function(e){var r=t[s][1][e];return i(r||e)},l,l.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){"use strict";t.exports=function(e){return function(){var t=arguments.length;if(t){for(var r=[],n=-1;++n<t;)r[n]=arguments[n];return e.call(this,r)}return e.call(this,[])}}},{}],2:[function(e,t,r){"use strict";function n(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function i(e){return s[e>>18&63]+s[e>>12&63]+s[e>>6&63]+s[63&e]}function o(e,t,r){for(var n,o=[],s=t;s<r;s+=3)n=(e[s]<<16)+(e[s+1]<<8)+e[s+2],o.push(i(n));return o.join("")}r.byteLength=function(e){return 3*e.length/4-n(e)},r.toByteArray=function(e){var t,r,i,o,s,c=e.length;o=n(e),s=new u(3*c/4-o),r=o>0?c-4:c;var l=0;for(t=0;t<r;t+=4)i=a[e.charCodeAt(t)]<<18|a[e.charCodeAt(t+1)]<<12|a[e.charCodeAt(t+2)]<<6|a[e.charCodeAt(t+3)],s[l++]=i>>16&255,s[l++]=i>>8&255,s[l++]=255&i;return 2===o?(i=a[e.charCodeAt(t)]<<2|a[e.charCodeAt(t+1)]>>4,s[l++]=255&i):1===o&&(i=a[e.charCodeAt(t)]<<10|a[e.charCodeAt(t+1)]<<4|a[e.charCodeAt(t+2)]>>2,s[l++]=i>>8&255,s[l++]=255&i),s},r.fromByteArray=function(e){for(var t,r=e.length,n=r%3,i="",a=[],u=0,c=r-n;u<c;u+=16383)a.push(o(e,u,u+16383>c?c:u+16383));return 1===n?(t=e[r-1],i+=s[t>>2],i+=s[t<<4&63],i+="=="):2===n&&(t=(e[r-2]<<8)+e[r-1],i+=s[t>>10],i+=s[t>>4&63],i+=s[t<<2&63],i+="="),a.push(i),a.join("")};for(var s=[],a=[],u="undefined"!=typeof Uint8Array?Uint8Array:Array,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=0,f=c.length;l<f;++l)s[l]=c[l],a[c.charCodeAt(l)]=l;a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63},{}],3:[function(e,t,r){},{}],4:[function(e,t,r){(function(r){var n=e("is-array-buffer-x"),i="function"==typeof r.alloc&&"function"==typeof r.allocUnsafe&&"function"==typeof r.from;t.exports=function(e,t,o){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return n(e)?function(e,t,n){t>>>=0;var o=e.byteLength-t;if(o<0)throw new RangeError("'offset' is out of bounds");if(void 0===n)n=o;else if((n>>>=0)>o)throw new RangeError("'length' is out of bounds");return i?r.from(e.slice(t,t+n)):new r(new Uint8Array(e.slice(t,t+n)))}(e,t,o):"string"==typeof e?function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!r.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');return i?r.from(e,t):new r(e,t)}(e,t):i?r.from(e):new r(e)}}).call(this,e("buffer").Buffer)},{buffer:5,"is-array-buffer-x":25}],5:[function(e,t,r){"use strict";function n(e){if(e>T)throw new RangeError("Invalid typed array length");var t=new Uint8Array(e);return t.__proto__=i.prototype,t}function i(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return a(e)}return o(e,t,r)}function o(e,t,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return e instanceof ArrayBuffer?function(e,t,r){if(t<0||e.byteLength<t)throw new RangeError("'offset' is out of bounds");if(e.byteLength<t+(r||0))throw new RangeError("'length' is out of bounds");var n;n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r);return n.__proto__=i.prototype,n}(e,t,r):"string"==typeof e?function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!i.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');var r=0|l(e,t),o=n(r),s=o.write(e,t);s!==r&&(o=o.slice(0,s));return o}(e,t):function(e){if(i.isBuffer(e)){var t=0|c(e.length),r=n(t);return 0===r.length?r:(e.copy(r,0,0,t),r)}if(e){if(O(e)||"length"in e)return"number"!=typeof e.length||j(e.length)?n(0):u(e);if("Buffer"===e.type&&Array.isArray(e.data))return u(e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e)}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function a(e){return s(e),n(e<0?0:0|c(e))}function u(e){for(var t=e.length<0?0:0|c(e.length),r=n(t),i=0;i<t;i+=1)r[i]=255&e[i];return r}function c(e){if(e>=T)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+T.toString(16)+" bytes");return 0|e}function l(e,t){if(i.isBuffer(e))return e.length;if(O(e)||e instanceof ArrayBuffer)return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return D(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return C(e).length;default:if(n)return D(e).length;t=(""+t).toLowerCase(),n=!0}}function f(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if(r>>>=0,t>>>=0,r<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var n=e.length;(!t||t<0)&&(t=0);(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=function(e){return e<16?"0"+e.toString(16):e.toString(16)}(e[o]);return i}(this,t,r);case"utf8":case"utf-8":return x(this,t,r);case"ascii":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}(this,t,r);case"latin1":case"binary":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}(this,t,r);case"base64":return function(e,t,r){return 0===t&&r===e.length?R.fromByteArray(e):R.fromByteArray(e.slice(t,r))}(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function p(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function h(e,t,r,n,o){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,j(r)&&(r=o?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(o)return-1;r=e.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof t&&(t=i.from(t,n)),i.isBuffer(t))return 0===t.length?-1:d(e,t,r,n,o);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):d(e,[t],r,n,o);throw new TypeError("val must be string, number or Buffer")}function d(e,t,r,n,i){function o(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}var s=1,a=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,r/=2}var c;if(i){var l=-1;for(c=r;c<a;c++)if(o(e,c)===o(t,-1===l?0:c-l)){if(-1===l&&(l=c),c-l+1===u)return l*s}else-1!==l&&(c-=c-l),l=-1}else for(r+u>a&&(r=a-u),c=r;c>=0;c--){for(var f=!0,p=0;p<u;p++)if(o(e,c+p)!==o(t,p)){f=!1;break}if(f)return c}return-1}function m(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(j(a))return s;e[r+s]=a}return s}function v(e,t,r,n){return F(D(t,e.length-r),e,r,n)}function y(e,t,r,n){return F(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function g(e,t,r,n){return y(e,t,r,n)}function b(e,t,r,n){return F(C(t),e,r,n)}function _(e,t,r,n){return F(function(e,t){for(var r,n,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function x(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o=e[i],s=null,a=o>239?4:o>223?3:o>191?2:1;if(i+a<=r){var u,c,l,f;switch(a){case 1:o<128&&(s=o);break;case 2:128==(192&(u=e[i+1]))&&(f=(31&o)<<6|63&u)>127&&(s=f);break;case 3:u=e[i+1],c=e[i+2],128==(192&u)&&128==(192&c)&&(f=(15&o)<<12|(63&u)<<6|63&c)>2047&&(f<55296||f>57343)&&(s=f);break;case 4:u=e[i+1],c=e[i+2],l=e[i+3],128==(192&u)&&128==(192&c)&&128==(192&l)&&(f=(15&o)<<18|(63&u)<<12|(63&c)<<6|63&l)>65535&&f<1114112&&(s=f)}}null===s?(s=65533,a=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),i+=a}return function(e){var t=e.length;if(t<=P)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=P));return r}(n)}function w(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function k(e,t,r,n,o,s){if(!i.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<s)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function E(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function S(e,t,r,n,i){return t=+t,r>>>=0,i||E(e,0,r,4),B.write(e,t,r,n,23,4),r+4}function A(e,t,r,n,i){return t=+t,r>>>=0,i||E(e,0,r,8),B.write(e,t,r,n,52,8),r+8}function D(e,t){t=t||1/0;for(var r,n=e.length,i=null,o=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function C(e){return R.toByteArray(function(e){if((e=e.trim().replace(I,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function F(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function O(e){return"function"==typeof ArrayBuffer.isView&&ArrayBuffer.isView(e)}function j(e){return e!=e}var R=e("base64-js"),B=e("ieee754");r.Buffer=i,r.SlowBuffer=function(e){return+e!=e&&(e=0),i.alloc(+e)},r.INSPECT_MAX_BYTES=50;var T=2147483647;r.kMaxLength=T,(i.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),"undefined"!=typeof Symbol&&Symbol.species&&i[Symbol.species]===i&&Object.defineProperty(i,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),i.poolSize=8192,i.from=function(e,t,r){return o(e,t,r)},i.prototype.__proto__=Uint8Array.prototype,i.__proto__=Uint8Array,i.alloc=function(e,t,r){return function(e,t,r){return s(e),e<=0?n(e):void 0!==t?"string"==typeof r?n(e).fill(t,r):n(e).fill(t):n(e)}(e,t,r)},i.allocUnsafe=function(e){return a(e)},i.allocUnsafeSlow=function(e){return a(e)},i.isBuffer=function(e){return null!=e&&!0===e._isBuffer},i.compare=function(e,t){if(!i.isBuffer(e)||!i.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,o=0,s=Math.min(r,n);o<s;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return r<n?-1:n<r?1:0},i.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return i.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=i.allocUnsafe(t),o=0;for(r=0;r<e.length;++r){var s=e[r];if(!i.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,o),o+=s.length}return n},i.byteLength=l,i.prototype._isBuffer=!0,i.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},i.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},i.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},i.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?x(this,0,e):f.apply(this,arguments)},i.prototype.equals=function(e){if(!i.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===i.compare(this,e)},i.prototype.inspect=function(){var e="",t=r.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},i.prototype.compare=function(e,t,r,n,o){if(!i.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),t<0||r>e.length||n<0||o>this.length)throw new RangeError("out of range index");if(n>=o&&t>=r)return 0;if(n>=o)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,o>>>=0,this===e)return 0;for(var s=o-n,a=r-t,u=Math.min(s,a),c=this.slice(n,o),l=e.slice(t,r),f=0;f<u;++f)if(c[f]!==l[f]){s=c[f],a=l[f];break}return s<a?-1:a<s?1:0},i.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},i.prototype.indexOf=function(e,t,r){return h(this,e,t,r,!0)},i.prototype.lastIndexOf=function(e,t,r){return h(this,e,t,r,!1)},i.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return m(this,e,t,r);case"utf8":case"utf-8":return v(this,e,t,r);case"ascii":return y(this,e,t,r);case"latin1":case"binary":return g(this,e,t,r);case"base64":return b(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var P=4096;i.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return n.__proto__=i.prototype,n},i.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},i.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},i.prototype.readUInt8=function(e,t){return e>>>=0,t||w(e,1,this.length),this[e]},i.prototype.readUInt16LE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]|this[e+1]<<8},i.prototype.readUInt16BE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]<<8|this[e+1]},i.prototype.readUInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},i.prototype.readUInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},i.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*t)),n},i.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o},i.prototype.readInt8=function(e,t){return e>>>=0,t||w(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},i.prototype.readInt16LE=function(e,t){e>>>=0,t||w(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},i.prototype.readInt16BE=function(e,t){e>>>=0,t||w(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},i.prototype.readInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},i.prototype.readInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},i.prototype.readFloatLE=function(e,t){return e>>>=0,t||w(e,4,this.length),B.read(this,e,!0,23,4)},i.prototype.readFloatBE=function(e,t){return e>>>=0,t||w(e,4,this.length),B.read(this,e,!1,23,4)},i.prototype.readDoubleLE=function(e,t){return e>>>=0,t||w(e,8,this.length),B.read(this,e,!0,52,8)},i.prototype.readDoubleBE=function(e,t){return e>>>=0,t||w(e,8,this.length),B.read(this,e,!1,52,8)},i.prototype.writeUIntLE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){k(this,e,t,r,Math.pow(2,8*r)-1,0)}var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},i.prototype.writeUIntBE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){k(this,e,t,r,Math.pow(2,8*r)-1,0)}var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},i.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||k(this,e,t,1,255,0),this[t]=255&e,t+1},i.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||k(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},i.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||k(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},i.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||k(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},i.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||k(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},i.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);k(this,e,t,r,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<r&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},i.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);k(this,e,t,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},i.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||k(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},i.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||k(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},i.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||k(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},i.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||k(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},i.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||k(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},i.prototype.writeFloatLE=function(e,t,r){return S(this,e,t,!0,r)},i.prototype.writeFloatBE=function(e,t,r){return S(this,e,t,!1,r)},i.prototype.writeDoubleLE=function(e,t,r){return A(this,e,t,!0,r)},i.prototype.writeDoubleBE=function(e,t,r){return A(this,e,t,!1,r)},i.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,o=n-r;if(this===e&&r<t&&t<n)for(i=o-1;i>=0;--i)e[i+t]=this[i+r];else if(o<1e3)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},i.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!i.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0);var s;if("number"==typeof e)for(s=t;s<r;++s)this[s]=e;else{var a=i.isBuffer(e)?e:new i(e,n),u=a.length;for(s=0;s<r-t;++s)this[s+t]=a[s%u]}return this};var I=/[^+/0-9A-Za-z-_]/g},{"base64-js":2,ieee754:22}],6:[function(e,t,r){(function(e){function t(e){return Object.prototype.toString.call(e)}r.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===t(e)},r.isBoolean=function(e){return"boolean"==typeof e},r.isNull=function(e){return null===e},r.isNullOrUndefined=function(e){return null==e},r.isNumber=function(e){return"number"==typeof e},r.isString=function(e){return"string"==typeof e},r.isSymbol=function(e){return"symbol"==typeof e},r.isUndefined=function(e){return void 0===e},r.isRegExp=function(e){return"[object RegExp]"===t(e)},r.isObject=function(e){return"object"==typeof e&&null!==e},r.isDate=function(e){return"[object Date]"===t(e)},r.isError=function(e){return"[object Error]"===t(e)||e instanceof Error},r.isFunction=function(e){return"function"==typeof e},r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},r.isBuffer=e.isBuffer}).call(this,{isBuffer:e("../../is-buffer/index.js")})},{"../../is-buffer/index.js":26}],7:[function(e,t,r){function n(e){o.call(this,e),this._options=e,this._iterator=null,this._operations=[]}var i=e("util"),o=e("abstract-leveldown").AbstractIterator;i.inherits(n,o),n.prototype.setDb=function(e){var t=this._iterator=e.iterator(this._options);this._operations.forEach(function(e){t[e.method].apply(t,e.args)})},n.prototype._operation=function(e,t){if(this._iterator)return this._iterator[e].apply(this._iterator,t);this._operations.push({method:e,args:t})},"next end".split(" ").forEach(function(e){n.prototype["_"+e]=function(){this._operation(e,arguments)}}),t.exports=n},{"abstract-leveldown":12,util:114}],8:[function(e,t,r){(function(r,n){function i(e){s.call(this,"string"==typeof e?e:""),this._db=void 0,this._operations=[],this._iterators=[]}var o=e("util"),s=e("abstract-leveldown").AbstractLevelDOWN,a=e("./deferred-iterator");o.inherits(i,s),i.prototype.setDb=function(e){this._db=e,this._operations.forEach(function(t){e[t.method].apply(e,t.args)}),this._iterators.forEach(function(t){t.setDb(e)})},i.prototype._open=function(e,t){return n.nextTick(t)},i.prototype._operation=function(e,t){if(this._db)return this._db[e].apply(this._db,t);this._operations.push({method:e,args:t})},"put get del batch approximateSize".split(" ").forEach(function(e){i.prototype["_"+e]=function(){this._operation(e,arguments)}}),i.prototype._isBuffer=function(e){return r.isBuffer(e)},i.prototype._iterator=function(e){if(this._db)return this._db.iterator.apply(this._db,arguments);var t=new a(e);return this._iterators.push(t),t},t.exports=i,t.exports.DeferredIterator=a}).call(this,{isBuffer:e("../is-buffer/index.js")},e("_process"))},{"../is-buffer/index.js":26,"./deferred-iterator":7,_process:70,"abstract-leveldown":12,util:114}],9:[function(e,t,r){(function(e){function r(e){this._db=e,this._operations=[],this._written=!1}r.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},r.prototype.put=function(e,t){this._checkWritten();var r=this._db._checkKey(e,"key",this._db._isBuffer);if(r)throw r;return this._db._isBuffer(e)||(e=String(e)),this._db._isBuffer(t)||(t=String(t)),"function"==typeof this._put?this._put(e,t):this._operations.push({type:"put",key:e,value:t}),this},r.prototype.del=function(e){this._checkWritten();var t=this._db._checkKey(e,"key",this._db._isBuffer);if(t)throw t;return this._db._isBuffer(e)||(e=String(e)),"function"==typeof this._del?this._del(e):this._operations.push({type:"del",key:e}),this},r.prototype.clear=function(){return this._checkWritten(),this._operations=[],"function"==typeof this._clear&&this._clear(),this},r.prototype.write=function(t,r){if(this._checkWritten(),"function"==typeof t&&(r=t),"function"!=typeof r)throw new Error("write() requires a callback argument");return"object"!=typeof t&&(t={}),this._written=!0,"function"==typeof this._write?this._write(r):"function"==typeof this._db._batch?this._db._batch(this._operations,t,r):void e.nextTick(r)},t.exports=r}).call(this,e("_process"))},{_process:70}],10:[function(e,t,r){(function(e){function r(e){this.db=e,this._ended=!1,this._nexting=!1}r.prototype.next=function(t){var r=this;if("function"!=typeof t)throw new Error("next() requires a callback argument");return r._ended?t(new Error("cannot call next() after end()")):r._nexting?t(new Error("cannot call next() before previous next() has completed")):(r._nexting=!0,"function"==typeof r._next?r._next(function(){r._nexting=!1,t.apply(null,arguments)}):void e.nextTick(function(){r._nexting=!1,t()}))},r.prototype.end=function(t){if("function"!=typeof t)throw new Error("end() requires a callback argument");return this._ended?t(new Error("end() already called on iterator")):(this._ended=!0,"function"==typeof this._end?this._end(t):void e.nextTick(t))},t.exports=r}).call(this,e("_process"))},{_process:70}],11:[function(e,t,r){(function(r,n){function i(e){if(!arguments.length||void 0===e)throw new Error("constructor requires at least a location argument");if("string"!=typeof e)throw new Error("constructor requires a location string argument");this.location=e,this.status="new"}var o=e("xtend"),s=e("./abstract-iterator"),a=e("./abstract-chained-batch");i.prototype.open=function(e,t){var r=this,i=this.status;if("function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("open() requires a callback argument");"object"!=typeof e&&(e={}),e.createIfMissing=0!=e.createIfMissing,e.errorIfExists=!!e.errorIfExists,"function"==typeof this._open?(this.status="opening",this._open(e,function(e){if(e)return r.status=i,t(e);r.status="open",t()})):(this.status="open",n.nextTick(t))},i.prototype.close=function(e){var t=this,r=this.status;if("function"!=typeof e)throw new Error("close() requires a callback argument");"function"==typeof this._close?(this.status="closing",this._close(function(n){if(n)return t.status=r,e(n);t.status="closed",e()})):(this.status="closed",n.nextTick(e))},i.prototype.get=function(e,t,r){var i;if("function"==typeof t&&(r=t),"function"!=typeof r)throw new Error("get() requires a callback argument");return(i=this._checkKey(e,"key",this._isBuffer))?r(i):(this._isBuffer(e)||(e=String(e)),"object"!=typeof t&&(t={}),t.asBuffer=0!=t.asBuffer,"function"==typeof this._get?this._get(e,t,r):void n.nextTick(function(){r(new Error("NotFound"))}))},i.prototype.put=function(e,t,r,i){var o;if("function"==typeof r&&(i=r),"function"!=typeof i)throw new Error("put() requires a callback argument");return(o=this._checkKey(e,"key",this._isBuffer))?i(o):(this._isBuffer(e)||(e=String(e)),null==t||this._isBuffer(t)||n.browser||(t=String(t)),"object"!=typeof r&&(r={}),"function"==typeof this._put?this._put(e,t,r,i):void n.nextTick(i))},i.prototype.del=function(e,t,r){var i;if("function"==typeof t&&(r=t),"function"!=typeof r)throw new Error("del() requires a callback argument");return(i=this._checkKey(e,"key",this._isBuffer))?r(i):(this._isBuffer(e)||(e=String(e)),"object"!=typeof t&&(t={}),"function"==typeof this._del?this._del(e,t,r):void n.nextTick(r))},i.prototype.batch=function(e,t,r){if(!arguments.length)return this._chainedBatch();if("function"==typeof t&&(r=t),"function"==typeof e&&(r=e),"function"!=typeof r)throw new Error("batch(array) requires a callback argument");if(!Array.isArray(e))return r(new Error("batch(array) requires an array argument"));t&&"object"==typeof t||(t={});for(var i,o,s=0,a=e.length;s<a;s++)if("object"==typeof(i=e[s])){if(o=this._checkKey(i.type,"type",this._isBuffer))return r(o);if(o=this._checkKey(i.key,"key",this._isBuffer))return r(o)}if("function"==typeof this._batch)return this._batch(e,t,r);n.nextTick(r)},i.prototype.approximateSize=function(e,t,r){if(null==e||null==t||"function"==typeof e||"function"==typeof t)throw new Error("approximateSize() requires valid `start`, `end` and `callback` arguments");if("function"!=typeof r)throw new Error("approximateSize() requires a callback argument");if(this._isBuffer(e)||(e=String(e)),this._isBuffer(t)||(t=String(t)),"function"==typeof this._approximateSize)return this._approximateSize(e,t,r);n.nextTick(function(){r(null,0)})},i.prototype._setupIteratorOptions=function(e){var t=this;return e=o(e),["start","end","gt","gte","lt","lte"].forEach(function(r){e[r]&&t._isBuffer(e[r])&&0===e[r].length&&delete e[r]}),e.reverse=!!e.reverse,e.keys=0!=e.keys,e.values=0!=e.values,e.limit="limit"in e?e.limit:-1,e.keyAsBuffer=0!=e.keyAsBuffer,e.valueAsBuffer=0!=e.valueAsBuffer,e},i.prototype.iterator=function(e){return"object"!=typeof e&&(e={}),e=this._setupIteratorOptions(e),"function"==typeof this._iterator?this._iterator(e):new s(this)},i.prototype._chainedBatch=function(){return new a(this)},i.prototype._isBuffer=function(e){return r.isBuffer(e)},i.prototype._checkKey=function(e,t){if(null===e||void 0===e)return new Error(t+" cannot be `null` or `undefined`");if(this._isBuffer(e)){if(0===e.length)return new Error(t+" cannot be an empty Buffer")}else if(""===String(e))return new Error(t+" cannot be an empty String")},t.exports=i}).call(this,{isBuffer:e("../../../is-buffer/index.js")},e("_process"))},{"../../../is-buffer/index.js":26,"./abstract-chained-batch":9,"./abstract-iterator":10,_process:70,xtend:120}],12:[function(e,t,r){r.AbstractLevelDOWN=e("./abstract-leveldown"),r.AbstractIterator=e("./abstract-iterator"),r.AbstractChainedBatch=e("./abstract-chained-batch"),r.isLevelDOWN=e("./is-leveldown")},{"./abstract-chained-batch":9,"./abstract-iterator":10,"./abstract-leveldown":11,"./is-leveldown":13}],13:[function(e,t,r){var n=e("./abstract-leveldown");t.exports=function(e){return!(!e||"object"!=typeof e)&&Object.keys(n.prototype).filter(function(e){return"_"!=e[0]&&"approximateSize"!=e}).every(function(t){return"function"==typeof e[t]})}},{"./abstract-leveldown":11}],14:[function(e,t,r){"use strict";function n(e){if(this._capacity=i(e),this._length=0,this._front=0,o(e)){for(var t=e.length,r=0;r<t;++r)this[r]=e[r];this._length=t}}function i(e){if("number"!=typeof e){if(!o(e))return 16;e=e.length}return function(e){return e>>>=0,e-=1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,1+(e|=e>>16)}(Math.min(Math.max(16,e),1073741824))}n.prototype.toArray=function(){for(var e=this._length,t=new Array(e),r=this._front,n=this._capacity,i=0;i<e;++i)t[i]=this[r+i&n-1];return t},n.prototype.push=function(e){var t=arguments.length,r=this._length;if(t>1){var n=this._capacity;if(r+t>n){for(var i=0;i<t;++i){this._checkCapacity(r+1);this[o=this._front+r&this._capacity-1]=arguments[i],r++,this._length=r}return r}var o=this._front;for(i=0;i<t;++i)this[o+r&n-1]=arguments[i],o++;return this._length=r+t,r+t}if(0===t)return r;this._checkCapacity(r+1);return this[i=this._front+r&this._capacity-1]=e,this._length=r+1,r+1},n.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,r=this[t];return this[t]=void 0,this._length=e-1,r}},n.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,r=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,r}},n.prototype.unshift=function(e){var t=this._length,r=arguments.length;if(r>1){if(t+r>(i=this._capacity)){for(var n=r-1;n>=0;n--){this._checkCapacity(t+1);var i=this._capacity;this[s=(this._front-1&i-1^i)-i]=arguments[n],t++,this._length=t,this._front=s}return t}var o=this._front;for(n=r-1;n>=0;n--){var s;this[s=(o-1&i-1^i)-i]=arguments[n],o=s}return this._front=o,this._length=t+r,t+r}if(0===r)return t;this._checkCapacity(t+1);i=this._capacity;return this[n=(this._front-1&i-1^i)-i]=e,this._length=t+1,this._front=n,t+1},n.prototype.peekBack=function(){var e=this._length;if(0!==e){return this[this._front+e-1&this._capacity-1]}},n.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},n.prototype.get=function(e){var t=e;if(t===(0|t)){var r=this._length;if(t<0&&(t+=r),!(t<0||t>=r))return this[this._front+t&this._capacity-1]}},n.prototype.isEmpty=function(){return 0===this._length},n.prototype.clear=function(){for(var e=this._length,t=this._front,r=this._capacity,n=0;n<e;++n)this[t+n&r-1]=void 0;this._length=0,this._front=0},n.prototype.toString=function(){return this.toArray().toString()},n.prototype.valueOf=n.prototype.toString,n.prototype.removeFront=n.prototype.shift,n.prototype.removeBack=n.prototype.pop,n.prototype.insertFront=n.prototype.unshift,n.prototype.insertBack=n.prototype.push,n.prototype.enqueue=n.prototype.push,n.prototype.dequeue=n.prototype.shift,n.prototype.toJSON=n.prototype.toArray,Object.defineProperty(n.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),n.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(i(1.5*this._capacity+16))},n.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var r=this._front,n=this._length;if(r+n>t){!function(e,t,r,n,i){for(var o=0;o<i;++o)r[o+n]=e[o+t],e[o+t]=void 0}(this,0,this,t,r+n&t-1)}};var o=Array.isArray;t.exports=n},{}],15:[function(e,t,r){function n(e,t,r){o(this,{type:e,name:e,cause:"string"!=typeof t?t:r,message:t&&"string"!=typeof t?t.message:t},"ewr")}function i(e,t){Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,arguments.callee),n.call(this,"CustomError",e,t)}var o=e("prr");i.prototype=new Error,t.exports=function(e){var t=function(t,r){return function(e,t,r){var o=function(r,i){n.call(this,t,r,i),"FilesystemError"==t&&(this.code=this.cause.code,this.path=this.cause.path,this.errno=this.cause.errno,this.message=(e.errno[this.cause.errno]?e.errno[this.cause.errno].description:this.cause.message)+(this.cause.path?" ["+this.cause.path+"]":"")),Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,arguments.callee)};return o.prototype=r?new r:new i,o}(e,t,r)};return{CustomError:i,FilesystemError:t("FilesystemError"),createError:t}}},{prr:17}],16:[function(e,t,r){var n=t.exports.all=[{errno:-2,code:"ENOENT",description:"no such file or directory"},{errno:-1,code:"UNKNOWN",description:"unknown error"},{errno:0,code:"OK",description:"success"},{errno:1,code:"EOF",description:"end of file"},{errno:2,code:"EADDRINFO",description:"getaddrinfo error"},{errno:3,code:"EACCES",description:"permission denied"},{errno:4,code:"EAGAIN",description:"resource temporarily unavailable"},{errno:5,code:"EADDRINUSE",description:"address already in use"},{errno:6,code:"EADDRNOTAVAIL",description:"address not available"},{errno:7,code:"EAFNOSUPPORT",description:"address family not supported"},{errno:8,code:"EALREADY",description:"connection already in progress"},{errno:9,code:"EBADF",description:"bad file descriptor"},{errno:10,code:"EBUSY",description:"resource busy or locked"},{errno:11,code:"ECONNABORTED",description:"software caused connection abort"},{errno:12,code:"ECONNREFUSED",description:"connection refused"},{errno:13,code:"ECONNRESET",description:"connection reset by peer"},{errno:14,code:"EDESTADDRREQ",description:"destination address required"},{errno:15,code:"EFAULT",description:"bad address in system call argument"},{errno:16,code:"EHOSTUNREACH",description:"host is unreachable"},{errno:17,code:"EINTR",description:"interrupted system call"},{errno:18,code:"EINVAL",description:"invalid argument"},{errno:19,code:"EISCONN",description:"socket is already connected"},{errno:20,code:"EMFILE",description:"too many open files"},{errno:21,code:"EMSGSIZE",description:"message too long"},{errno:22,code:"ENETDOWN",description:"network is down"},{errno:23,code:"ENETUNREACH",description:"network is unreachable"},{errno:24,code:"ENFILE",description:"file table overflow"},{errno:25,code:"ENOBUFS",description:"no buffer space available"},{errno:26,code:"ENOMEM",description:"not enough memory"},{errno:27,code:"ENOTDIR",description:"not a directory"},{errno:28,code:"EISDIR",description:"illegal operation on a directory"},{errno:29,code:"ENONET",description:"machine is not on the network"},{errno:31,code:"ENOTCONN",description:"socket is not connected"},{errno:32,code:"ENOTSOCK",description:"socket operation on non-socket"},{errno:33,code:"ENOTSUP",description:"operation not supported on socket"},{errno:34,code:"ENOENT",description:"no such file or directory"},{errno:35,code:"ENOSYS",description:"function not implemented"},{errno:36,code:"EPIPE",description:"broken pipe"},{errno:37,code:"EPROTO",description:"protocol error"},{errno:38,code:"EPROTONOSUPPORT",description:"protocol not supported"},{errno:39,code:"EPROTOTYPE",description:"protocol wrong type for socket"},{errno:40,code:"ETIMEDOUT",description:"connection timed out"},{errno:41,code:"ECHARSET",description:"invalid Unicode character"},{errno:42,code:"EAIFAMNOSUPPORT",description:"address family for hostname not supported"},{errno:44,code:"EAISERVICE",description:"servname not supported for ai_socktype"},{errno:45,code:"EAISOCKTYPE",description:"ai_socktype not supported"},{errno:46,code:"ESHUTDOWN",description:"cannot send after transport endpoint shutdown"},{errno:47,code:"EEXIST",description:"file already exists"},{errno:48,code:"ESRCH",description:"no such process"},{errno:49,code:"ENAMETOOLONG",description:"name too long"},{errno:50,code:"EPERM",description:"operation not permitted"},{errno:51,code:"ELOOP",description:"too many symbolic links encountered"},{errno:52,code:"EXDEV",description:"cross-device link not permitted"},{errno:53,code:"ENOTEMPTY",description:"directory not empty"},{errno:54,code:"ENOSPC",description:"no space left on device"},{errno:55,code:"EIO",description:"i/o error"},{errno:56,code:"EROFS",description:"read-only file system"},{errno:57,code:"ENODEV",description:"no such device"},{errno:58,code:"ESPIPE",description:"invalid seek"},{errno:59,code:"ECANCELED",description:"operation canceled"}];t.exports.errno={},t.exports.code={},n.forEach(function(e){t.exports.errno[e.errno]=e,t.exports.code[e.code]=e}),t.exports.custom=e("./custom")(t.exports),t.exports.create=t.exports.custom.createError},{"./custom":15}],17:[function(e,t,r){!function(e,r,n){void 0!==t&&t.exports?t.exports=n():r.prr=n()}(0,this,function(){var e="function"==typeof Object.defineProperty?function(e,t,r){return Object.defineProperty(e,t,r),e}:function(e,t,r){return e[t]=r.value,e};return function(t,r,n,i){var o;if(i=function(e,t){var r="object"==typeof t,n=!r&&"string"==typeof t,i=function(e){return r?!!t[e]:!!n&&t.indexOf(e[0])>-1};return{enumerable:i("enumerable"),configurable:i("configurable"),writable:i("writable"),value:e}}(n,i),"object"==typeof r){for(o in r)Object.hasOwnProperty.call(r,o)&&(i.value=r[o],e(t,o,i));return t}return e(t,r,i)}})},{}],18:[function(e,t,r){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,r,n,a,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(r=this._events[e],s(r))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),r.apply(this,a)}else if(o(r))for(a=Array.prototype.slice.call(arguments,1),n=(c=r.slice()).length,u=0;u<n;u++)c[u].apply(this,a);return!0},n.prototype.addListener=function(e,t){var r;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(r=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var n=!1;return r.listener=t,this.on(e,r),this},n.prototype.removeListener=function(e,t){var r,n,s,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],s=r.length,n=-1,r===t||i(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(r)){for(a=s;a-- >0;)if(r[a]===t||r[a].listener&&r[a].listener===t){n=a;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],i(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],19:[function(e,t,r){"use strict";function n(e,t,r,n,i,o){this._color=e,this.key=t,this.value=r,this.left=n,this.right=i,this._count=o}function i(e){return new n(e._color,e.key,e.value,e.left,e.right,e._count)}function o(e,t){return new n(e,t.key,t.value,t.left,t.right,t._count)}function s(e){e._count=1+(e.left?e.left._count:0)+(e.right?e.right._count:0)}function a(e,t){this._compare=e,this.root=t}function u(e,t){if(t.left){if(r=u(e,t.left))return r}var r;return(r=e(t.key,t.value))||(t.right?u(e,t.right):void 0)}function c(e,t,r,n){if(t(e,n.key)<=0){if(n.left){if(i=c(e,t,r,n.left))return i}var i;if(i=r(n.key,n.value))return i}if(n.right)return c(e,t,r,n.right)}function l(e,t,r,n,i){var o,s=r(e,i.key),a=r(t,i.key);if(s<=0){if(i.left&&(o=l(e,t,r,n,i.left)))return o;if(a>0&&(o=n(i.key,i.value)))return o}if(a>0&&i.right)return l(e,t,r,n,i.right)}function f(e,t){this.tree=e,this._stack=t}function p(e,t){e.key=t.key,e.value=t.value,e.left=t.left,e.right=t.right,e._color=t._color,e._count=t._count}t.exports=function(e){return new a(e||function(e,t){return e<t?-1:e>t?1:0},null)};var h=0,d=1,m=a.prototype;Object.defineProperty(m,"keys",{get:function(){var e=[];return this.forEach(function(t,r){e.push(t)}),e}}),Object.defineProperty(m,"values",{get:function(){var e=[];return this.forEach(function(t,r){e.push(r)}),e}}),Object.defineProperty(m,"length",{get:function(){return this.root?this.root._count:0}}),m.insert=function(e,t){for(var r=this._compare,i=this.root,u=[],c=[];i;){var l=r(e,i.key);u.push(i),c.push(l),i=l<=0?i.left:i.right}u.push(new n(h,e,t,null,null,1));for(var f=u.length-2;f>=0;--f){i=u[f];c[f]<=0?u[f]=new n(i._color,i.key,i.value,u[f+1],i.right,i._count+1):u[f]=new n(i._color,i.key,i.value,i.left,u[f+1],i._count+1)}for(f=u.length-1;f>1;--f){var p=u[f-1];i=u[f];if(p._color===d||i._color===d)break;var m=u[f-2];if(m.left===p)if(p.left===i){if(!(v=m.right)||v._color!==h){if(m._color=h,m.left=p.right,p._color=d,p.right=m,u[f-2]=p,u[f-1]=i,s(m),s(p),f>=3){(y=u[f-3]).left===m?y.left=p:y.right=p}break}p._color=d,m.right=o(d,v),m._color=h,f-=1}else{if(!(v=m.right)||v._color!==h){if(p.right=i.left,m._color=h,m.left=i.right,i._color=d,i.left=p,i.right=m,u[f-2]=i,u[f-1]=p,s(m),s(p),s(i),f>=3){(y=u[f-3]).left===m?y.left=i:y.right=i}break}p._color=d,m.right=o(d,v),m._color=h,f-=1}else if(p.right===i){if(!(v=m.left)||v._color!==h){if(m._color=h,m.right=p.left,p._color=d,p.left=m,u[f-2]=p,u[f-1]=i,s(m),s(p),f>=3){(y=u[f-3]).right===m?y.right=p:y.left=p}break}p._color=d,m.left=o(d,v),m._color=h,f-=1}else{var v;if(!(v=m.left)||v._color!==h){if(p.left=i.right,m._color=h,m.right=i.left,i._color=d,i.right=p,i.left=m,u[f-2]=i,u[f-1]=p,s(m),s(p),s(i),f>=3){var y;(y=u[f-3]).right===m?y.right=i:y.left=i}break}p._color=d,m.left=o(d,v),m._color=h,f-=1}}return u[0]._color=d,new a(r,u[0])},m.forEach=function(e,t,r){if(this.root)switch(arguments.length){case 1:return u(e,this.root);case 2:return c(t,this._compare,e,this.root);case 3:if(this._compare(t,r)>=0)return;return l(t,r,this._compare,e,this.root)}},Object.defineProperty(m,"begin",{get:function(){for(var e=[],t=this.root;t;)e.push(t),t=t.left;return new f(this,e)}}),Object.defineProperty(m,"end",{get:function(){for(var e=[],t=this.root;t;)e.push(t),t=t.right;return new f(this,e)}}),m.at=function(e){if(e<0)return new f(this,[]);for(var t=this.root,r=[];;){if(r.push(t),t.left){if(e<t.left._count){t=t.left;continue}e-=t.left._count}if(!e)return new f(this,r);if(e-=1,!t.right)break;if(e>=t.right._count)break;t=t.right}return new f(this,[])},m.ge=function(e){for(var t=this._compare,r=this.root,n=[],i=0;r;){var o=t(e,r.key);n.push(r),o<=0&&(i=n.length),r=o<=0?r.left:r.right}return n.length=i,new f(this,n)},m.gt=function(e){for(var t=this._compare,r=this.root,n=[],i=0;r;){var o=t(e,r.key);n.push(r),o<0&&(i=n.length),r=o<0?r.left:r.right}return n.length=i,new f(this,n)},m.lt=function(e){for(var t=this._compare,r=this.root,n=[],i=0;r;){var o=t(e,r.key);n.push(r),o>0&&(i=n.length),r=o<=0?r.left:r.right}return n.length=i,new f(this,n)},m.le=function(e){for(var t=this._compare,r=this.root,n=[],i=0;r;){var o=t(e,r.key);n.push(r),o>=0&&(i=n.length),r=o<0?r.left:r.right}return n.length=i,new f(this,n)},m.find=function(e){for(var t=this._compare,r=this.root,n=[];r;){var i=t(e,r.key);if(n.push(r),0===i)return new f(this,n);r=i<=0?r.left:r.right}return new f(this,[])},m.remove=function(e){var t=this.find(e);return t?t.remove():this},m.get=function(e){for(var t=this._compare,r=this.root;r;){var n=t(e,r.key);if(0===n)return r.value;r=n<=0?r.left:r.right}};var v=f.prototype;Object.defineProperty(v,"valid",{get:function(){return this._stack.length>0}}),Object.defineProperty(v,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0}),v.clone=function(){return new f(this.tree,this._stack.slice())},v.remove=function(){var e=this._stack;if(0===e.length)return this.tree;var t=new Array(e.length),r=e[e.length-1];t[t.length-1]=new n(r._color,r.key,r.value,r.left,r.right,r._count);for(var u=e.length-2;u>=0;--u){(r=e[u]).left===e[u+1]?t[u]=new n(r._color,r.key,r.value,t[u+1],r.right,r._count):t[u]=new n(r._color,r.key,r.value,r.left,t[u+1],r._count)}if((r=t[t.length-1]).left&&r.right){var c=t.length;for(r=r.left;r.right;)t.push(r),r=r.right;var l=t[c-1];t.push(new n(r._color,l.key,l.value,r.left,r.right,r._count)),t[c-1].key=r.key,t[c-1].value=r.value;for(u=t.length-2;u>=c;--u)r=t[u],t[u]=new n(r._color,r.key,r.value,r.left,t[u+1],r._count);t[c-1].left=t[c]}if((r=t[t.length-1])._color===h){var f=t[t.length-2];f.left===r?f.left=null:f.right===r&&(f.right=null),t.pop();for(u=0;u<t.length;++u)t[u]._count--;return new a(this.tree._compare,t[0])}if(r.left||r.right){r.left?p(r,r.left):r.right&&p(r,r.right),r._color=d;for(u=0;u<t.length-1;++u)t[u]._count--;return new a(this.tree._compare,t[0])}if(1===t.length)return new a(this.tree._compare,null);for(u=0;u<t.length;++u)t[u]._count--;var m=t[t.length-2];return function(e){for(var t,r,n,a,u=e.length-1;u>=0;--u){if(t=e[u],0===u)return void(t._color=d);if((r=e[u-1]).left===t){if((n=r.right).right&&n.right._color===h)return n=r.right=i(n),a=n.right=i(n.right),r.right=n.left,n.left=r,n.right=a,n._color=r._color,t._color=d,r._color=d,a._color=d,s(r),s(n),u>1&&((c=e[u-2]).left===r?c.left=n:c.right=n),void(e[u-1]=n);if(n.left&&n.left._color===h)return n=r.right=i(n),a=n.left=i(n.left),r.right=a.left,n.left=a.right,a.left=r,a.right=n,a._color=r._color,r._color=d,n._color=d,t._color=d,s(r),s(n),s(a),u>1&&((c=e[u-2]).left===r?c.left=a:c.right=a),void(e[u-1]=a);if(n._color===d){if(r._color===h)return r._color=d,void(r.right=o(h,n));r.right=o(h,n);continue}n=i(n),r.right=n.left,n.left=r,n._color=r._color,r._color=h,s(r),s(n),u>1&&((c=e[u-2]).left===r?c.left=n:c.right=n),e[u-1]=n,e[u]=r,u+1<e.length?e[u+1]=t:e.push(t),u+=2}else{if((n=r.left).left&&n.left._color===h)return n=r.left=i(n),a=n.left=i(n.left),r.left=n.right,n.right=r,n.left=a,n._color=r._color,t._color=d,r._color=d,a._color=d,s(r),s(n),u>1&&((c=e[u-2]).right===r?c.right=n:c.left=n),void(e[u-1]=n);if(n.right&&n.right._color===h)return n=r.left=i(n),a=n.right=i(n.right),r.left=a.right,n.right=a.left,a.right=r,a.left=n,a._color=r._color,r._color=d,n._color=d,t._color=d,s(r),s(n),s(a),u>1&&((c=e[u-2]).right===r?c.right=a:c.left=a),void(e[u-1]=a);if(n._color===d){if(r._color===h)return r._color=d,void(r.left=o(h,n));r.left=o(h,n);continue}if(n=i(n),r.left=n.right,n.right=r,n._color=r._color,r._color=h,s(r),s(n),u>1){var c;(c=e[u-2]).right===r?c.right=n:c.left=n}e[u-1]=n,e[u]=r,u+1<e.length?e[u+1]=t:e.push(t),u+=2}}}(t),m.left===r?m.left=null:m.right=null,new a(this.tree._compare,t[0])},Object.defineProperty(v,"key",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].key},enumerable:!0}),Object.defineProperty(v,"value",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].value},enumerable:!0}),Object.defineProperty(v,"index",{get:function(){var e=0,t=this._stack;if(0===t.length){var r=this.tree.root;return r?r._count:0}t[t.length-1].left&&(e=t[t.length-1].left._count);for(var n=t.length-2;n>=0;--n)t[n+1]===t[n].right&&(++e,t[n].left&&(e+=t[n].left._count));return e},enumerable:!0}),v.next=function(){var e=this._stack;if(0!==e.length){var t=e[e.length-1];if(t.right)for(t=t.right;t;)e.push(t),t=t.left;else for(e.pop();e.length>0&&e[e.length-1].right===t;)t=e[e.length-1],e.pop()}},Object.defineProperty(v,"hasNext",{get:function(){var e=this._stack;if(0===e.length)return!1;if(e[e.length-1].right)return!0;for(var t=e.length-1;t>0;--t)if(e[t-1].left===e[t])return!0;return!1}}),v.update=function(e){var t=this._stack;if(0===t.length)throw new Error("Can't update empty node!");var r=new Array(t.length),i=t[t.length-1];r[r.length-1]=new n(i._color,i.key,e,i.left,i.right,i._count);for(var o=t.length-2;o>=0;--o)(i=t[o]).left===t[o+1]?r[o]=new n(i._color,i.key,i.value,r[o+1],i.right,i._count):r[o]=new n(i._color,i.key,i.value,i.left,r[o+1],i._count);return new a(this.tree._compare,r[0])},v.prev=function(){var e=this._stack;if(0!==e.length){var t=e[e.length-1];if(t.left)for(t=t.left;t;)e.push(t),t=t.right;else for(e.pop();e.length>0&&e[e.length-1].left===t;)t=e[e.length-1],e.pop()}},Object.defineProperty(v,"hasPrev",{get:function(){var e=this._stack;if(0===e.length)return!1;if(e[e.length-1].left)return!0;for(var t=e.length-1;t>0;--t)if(e[t-1].right===e[t])return!0;return!1}})},{}],20:[function(e,t,r){"use strict";t.exports="function"==typeof Symbol&&"symbol"==typeof Symbol("")},{}],21:[function(e,t,r){"use strict";t.exports=e("has-symbol-support-x")&&"symbol"==typeof Symbol.toStringTag},{"has-symbol-support-x":20}],22:[function(e,t,r){r.read=function(e,t,r,n,i){var o,s,a=8*i-n-1,u=(1<<a)-1,c=u>>1,l=-7,f=r?i-1:0,p=r?-1:1,h=e[t+f];for(f+=p,o=h&(1<<-l)-1,h>>=-l,l+=a;l>0;o=256*o+e[t+f],f+=p,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=n;l>0;s=256*s+e[t+f],f+=p,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(h?-1:1);s+=Math.pow(2,n),o-=c}return(h?-1:1)*s*Math.pow(2,o-n)},r.write=function(e,t,r,n,i,o){var s,a,u,c=8*o-i-1,l=(1<<c)-1,f=l>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:o-1,d=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),(t+=s+f>=1?p/u:p*Math.pow(2,1-f))*u>=2&&(s++,u/=2),s+f>=l?(a=0,s=l):s+f>=1?(a=(t*u-1)*Math.pow(2,i),s+=f):(a=t*Math.pow(2,f-1)*Math.pow(2,i),s=0));i>=8;e[r+h]=255&a,h+=d,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;e[r+h]=255&s,h+=d,s/=256,c-=8);e[r+h-d]|=128*m}},{}],23:[function(e,t,r){(function(e){"use strict";function r(){c=!0;for(var e,t,r=l.length;r;){for(t=l,l=[],e=-1;++e<r;)t[e]();r=l.length}c=!1}var n,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,s=new i(r),a=e.document.createTextNode("");s.observe(a,{characterData:!0}),n=function(){a.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){r(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(r,0)};else{var u=new e.MessageChannel;u.port1.onmessage=r,n=function(){u.port2.postMessage(0)}}var c,l=[];t.exports=function(e){1!==l.push(e)||c||n()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],24:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],25:[function(e,t,r){"use strict";var n,i,o,s=e("is-object-like-x"),a="function"==typeof ArrayBuffer;if(a){if(e("has-to-string-tag-x"))try{o="number"==typeof(o=Object.getOwnPropertyDescriptor(ArrayBuffer.prototype,"byteLength").get).call(new ArrayBuffer(4))&&o}catch(e){}!1===Boolean(o)&&(n=e("to-string-tag-x"),i="[object ArrayBuffer]")}t.exports=function(e){if(!1===a||!1===s(e))return!1;if(!1===Boolean(o))return n(e)===i;try{return"number"==typeof o.call(e)}catch(e){}return!1}},{"has-to-string-tag-x":21,"is-object-like-x":28,"to-string-tag-x":110}],26:[function(e,t,r){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}t.exports=function(e){return null!=e&&(n(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&n(e.slice(0,0))}(e)||!!e._isBuffer)}},{}],27:[function(e,t,r){"use strict";var n=Function.prototype.toString,i=e("to-string-tag-x"),o=e("has-to-string-tag-x"),s=e("is-primitive"),a=/^\s*class /,u=function(e){try{var t=n.call(e).replace(/\/\/.*\n/g,"").replace(/\/\*[.\s\S]*\*\//g,"").replace(/\n/gm," ").replace(/ {2}/g," ");return a.test(t)}catch(e){}return!1};t.exports=function(e){if(s(e))return!1;if(o)return function(e){try{return!u(e)&&(n.call(e),!0)}catch(e){}return!1}(e);if(u(e))return!1;var t=i(e);return"[object Function]"===t||"[object GeneratorFunction]"===t||"[object AsyncFunction]"===t}},{"has-to-string-tag-x":21,"is-primitive":29,"to-string-tag-x":110}],28:[function(e,t,r){"use strict";var n=e("is-function-x"),i=e("is-primitive");t.exports=function(e){return!1===i(e)&&!1===n(e)}},{"is-function-x":27,"is-primitive":29}],29:[function(e,t,r){"use strict";t.exports=function(e){return null==e||"function"!=typeof e&&"object"!=typeof e}},{}],30:[function(e,t,r){var n={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},{}],31:[function(e,t,r){function n(e){this.opts=e||{},this.encodings=i}var i=e("./lib/encodings");t.exports=n,n.prototype._encoding=function(e){return"string"==typeof e&&(e=i[e]),e||(e=i.id),e},n.prototype._keyEncoding=function(e,t){return this._encoding(t&&t.keyEncoding||e&&e.keyEncoding||this.opts.keyEncoding)},n.prototype._valueEncoding=function(e,t){return this._encoding(t&&(t.valueEncoding||t.encoding)||e&&(e.valueEncoding||e.encoding)||this.opts.valueEncoding||this.opts.encoding)},n.prototype.encodeKey=function(e,t,r){return this._keyEncoding(t,r).encode(e)},n.prototype.encodeValue=function(e,t,r){return this._valueEncoding(t,r).encode(e)},n.prototype.decodeKey=function(e,t){return this._keyEncoding(t).decode(e)},n.prototype.decodeValue=function(e,t){return this._valueEncoding(t).decode(e)},n.prototype.encodeBatch=function(e,t){var r=this;return e.map(function(e){var n={type:e.type,key:r.encodeKey(e.key,t,e)};return r.keyAsBuffer(t,e)&&(n.keyEncoding="binary"),e.prefix&&(n.prefix=e.prefix),"value"in e&&(n.value=r.encodeValue(e.value,t,e),r.valueAsBuffer(t,e)&&(n.valueEncoding="binary")),n})};var o=["lt","gt","lte","gte","start","end"];n.prototype.encodeLtgt=function(e){var t=this,r={};return Object.keys(e).forEach(function(n){r[n]=o.indexOf(n)>-1?t.encodeKey(e[n],e):e[n]}),r},n.prototype.createStreamDecoder=function(e){var t=this;return e.keys&&e.values?function(r,n){return{key:t.decodeKey(r,e),value:t.decodeValue(n,e)}}:e.keys?function(r){return t.decodeKey(r,e)}:e.values?function(r,n){return t.decodeValue(n,e)}:function(){}},n.prototype.keyAsBuffer=function(e){return this._keyEncoding(e).buffer},n.prototype.valueAsBuffer=function(e){return this._valueEncoding(e).buffer}},{"./lib/encodings":32}],32:[function(e,t,r){(function(e){function t(t){return void 0===t||null===t||e.isBuffer(t)}r.utf8=r["utf-8"]={encode:function(e){return t(e)?e:String(e)},decode:function(e){return"string"==typeof e?e:String(e)},buffer:!1,type:"utf8"},r.json={encode:JSON.stringify,decode:JSON.parse,buffer:!1,type:"json"},r.binary={encode:function(r){return t(r)?r:new e(r)},decode:function(e){return e},buffer:!0,type:"binary"},r.none={encode:function(e){return e},decode:function(e){return e},buffer:!1,type:"id"},r.id=r.none;["hex","ascii","base64","ucs2","ucs-2","utf16le","utf-16le"].forEach(function(n){r[n]={encode:function(r){return t(r)?r:new e(r,n)},decode:function(e){return e.toString(n)},buffer:!0,type:n}})}).call(this,e("buffer").Buffer)},{buffer:5}],33:[function(e,t,r){var n=e("errno").create,i=n("LevelUPError"),o=n("NotFoundError",i);o.prototype.notFound=!0,o.prototype.status=404,t.exports={LevelUPError:i,InitializationError:n("InitializationError",i),OpenError:n("OpenError",i),ReadError:n("ReadError",i),WriteError:n("WriteError",i),NotFoundError:o,EncodingError:n("EncodingError",i)}},{errno:16}],34:[function(e,t,r){function n(e,t){if(!(this instanceof n))return new n(e,t);o.call(this,s(t,{objectMode:!0})),this._iterator=e,this._destroyed=!1,this._decoder=null,t&&t.decoder&&(this._decoder=t.decoder),this.on("end",this._cleanup.bind(this))}var i=e("inherits"),o=e("readable-stream").Readable,s=e("xtend"),a=e("level-errors").EncodingError;t.exports=n,i(n,o),n.prototype._read=function(){var e=this;this._destroyed||this._iterator.next(function(t,r,n){if(!e._destroyed){if(t)return e.emit("error",t);if(void 0===r&&void 0===n)e.push(null);else{if(!e._decoder)return e.push({key:r,value:n});try{n=e._decoder(r,n)}catch(t){return e.emit("error",new a(t)),void e.push(null)}e.push(n)}}})},n.prototype.destroy=n.prototype._cleanup=function(){var e=this;this._destroyed||(this._destroyed=!0,this._iterator.end(function(t){if(t)return e.emit("error",t);e.emit("close")}))}},{inherits:24,"level-errors":33,"readable-stream":78,xtend:120}],35:[function(e,t,r){function n(e,t){this._levelup=e,this._codec=t,this.batch=e.db.batch(),this.ops=[],this.length=0}var i=e("./util"),o=e("level-errors").WriteError,s=i.getOptions,a=i.dispatchError;n.prototype.put=function(e,t,r){r=s(r);var n=this._codec.encodeKey(e,r),i=this._codec.encodeValue(t,r);try{this.batch.put(n,i)}catch(e){throw new o(e)}return this.ops.push({type:"put",key:n,value:i}),this.length++,this},n.prototype.del=function(e,t){t=s(t);var r=this._codec.encodeKey(e,t);try{this.batch.del(r)}catch(e){throw new o(e)}return this.ops.push({type:"del",key:r}),this.length++,this},n.prototype.clear=function(){try{this.batch.clear()}catch(e){throw new o(e)}return this.ops=[],this.length=0,this},n.prototype.write=function(e){var t=this._levelup,r=this.ops;try{this.batch.write(function(n){if(n)return a(t,new o(n),e);t.emit("batch",r),e&&e()})}catch(e){throw new o(e)}},t.exports=n},{"./util":37,"level-errors":33}],36:[function(e,t,r){(function(r){function n(e,t){return"function"==typeof e?e:t}function i(e,t,n){if(!(this instanceof i))return new i(e,t,n);var o;if(c.call(this),this.setMaxListeners(1/0),"function"==typeof e?((t="object"==typeof t?t:{}).db=e,e=null):"object"==typeof e&&"function"==typeof e.db&&(t=e,e=null),"function"==typeof t&&(n=t,t={}),(!t||"function"!=typeof t.db)&&"string"!=typeof e){if(o=new w("Must provide a location for the database"),n)return r.nextTick(function(){n(o)});throw o}t=D(t),this.options=p(C,t),this._codec=new A(this.options),this._status="new",h(this,"location",e,"e"),this.open(n)}function o(e,t,r){if(!e._isOpening()&&!e.isOpen())return O(e,new g("Database is not open"),r),!0}function s(e,t,r){O(e,new y(t),r)}function a(e,t,r){O(e,new g(t),r)}function u(e){return function(t,r){F()[e](t,r||function(){})}}var c=e("events").EventEmitter,l=e("util").inherits,f=e("util").deprecate,p=e("xtend"),h=e("prr"),d=e("deferred-leveldown"),m=e("level-iterator-stream"),v=e("level-errors"),y=v.WriteError,g=v.ReadError,b=v.NotFoundError,_=v.OpenError,x=v.EncodingError,w=v.InitializationError,k=v.LevelUPError,E=e("./util"),S=e("./batch"),A=e("level-codec"),D=E.getOptions,C=E.defaultOptions,F=e("./leveldown"),O=E.dispatchError;E.isDefined;l(i,c),i.prototype.open=function(e){var t,n,i=this;if(this.isOpen())return e&&r.nextTick(function(){e(null,i)}),this;if(this._isOpening())return e&&this.once("open",function(){e(null,i)});if(this.emit("opening"),this._status="opening",this.db=new d(this.location),"function"!=typeof this.options.db&&"function"!=typeof F)throw new k("missing db factory, you need to set options.db");t=this.options.db||F(),(n=t(this.location)).open(this.options,function(t){if(t)return O(i,new _(t),e);i.db.setDb(n),i.db=n,i._status="open",e&&e(null,i),i.emit("open"),i.emit("ready")})},i.prototype.close=function(e){var t=this;if(this.isOpen())this._status="closing",this.db.close(function(){t._status="closed",t.emit("closed"),e&&e.apply(null,arguments)}),this.emit("closing"),this.db=new d(this.location);else{if("closed"==this._status&&e)return r.nextTick(e);"closing"==this._status&&e?this.once("closed",e):this._isOpening()&&this.once("open",function(){t.close(e)})}},i.prototype.isOpen=function(){return"open"==this._status},i.prototype._isOpening=function(){return"opening"==this._status},i.prototype.isClosed=function(){return/^clos/.test(this._status)},i.prototype.get=function(e,t,r){var i,s=this;if(r=n(t,r),!o(this,0,r)){if(null===e||void 0===e||"function"!=typeof r)return a(this,"get() requires key and callback arguments",r);t=E.getOptions(t),i=this._codec.encodeKey(e,t),t.asBuffer=this._codec.valueAsBuffer(t),this.db.get(i,t,function(n,i){if(n)return n=/notfound/i.test(n)||n.notFound?new b("Key not found in database ["+e+"]",n):new g(n),O(s,n,r);if(r){try{i=s._codec.decodeValue(i,t)}catch(e){return r(new x(e))}r(null,i)}})}},i.prototype.put=function(e,t,r,i){var a,u,c=this;if(i=n(r,i),null===e||void 0===e)return s(this,"put() requires a key argument",i);o(this,0,i)||(r=D(r),a=this._codec.encodeKey(e,r),u=this._codec.encodeValue(t,r),this.db.put(a,u,r,function(r){if(r)return O(c,new y(r),i);c.emit("put",e,t),i&&i()}))},i.prototype.del=function(e,t,r){var i,a=this;if(r=n(t,r),null===e||void 0===e)return s(this,"del() requires a key argument",r);o(this,0,r)||(t=D(t),i=this._codec.encodeKey(e,t),this.db.del(i,t,function(t){if(t)return O(a,new y(t),r);a.emit("del",e),r&&r()}))},i.prototype.batch=function(e,t,r){var i,a=this;return arguments.length?(r=n(t,r),Array.isArray(e)?void(o(this,0,r)||(t=D(t),i=(i=a._codec.encodeBatch(e,t)).map(function(e){return e.type||void 0===e.key||void 0===e.value||(e.type="put"),e}),this.db.batch(i,t,function(t){if(t)return O(a,new y(t),r);a.emit("batch",e),r&&r()}))):s(this,"batch() requires an array argument",r)):new S(this,this._codec)},i.prototype.approximateSize=f(function(e,t,r,i){var o,s,u=this;if(i=n(r,i),r=D(r),null===e||void 0===e||null===t||void 0===t||"function"!=typeof i)return a(this,"approximateSize() requires start, end and callback arguments",i);o=this._codec.encodeKey(e,r),s=this._codec.encodeKey(t,r),this.db.approximateSize(o,s,function(e,t){if(e)return O(u,new _(e),i);i&&i(null,t)})},"db.approximateSize() is deprecated. Use db.db.approximateSize() instead"),i.prototype.readStream=i.prototype.createReadStream=function(e){return e=p({keys:!0,values:!0},this.options,e),e.keyEncoding=e.keyEncoding,e.valueEncoding=e.valueEncoding,e=this._codec.encodeLtgt(e),e.keyAsBuffer=this._codec.keyAsBuffer(e),e.valueAsBuffer=this._codec.valueAsBuffer(e),"number"!=typeof e.limit&&(e.limit=-1),new m(this.db.iterator(e),p(e,{decoder:this._codec.createStreamDecoder(e)}))},i.prototype.keyStream=i.prototype.createKeyStream=function(e){return this.createReadStream(p(e,{keys:!0,values:!1}))},i.prototype.valueStream=i.prototype.createValueStream=function(e){return this.createReadStream(p(e,{keys:!1,values:!0}))},i.prototype.toString=function(){return"LevelUP"},t.exports=i,t.exports.errors=e("level-errors"),t.exports.destroy=f(u("destroy"),"levelup.destroy() is deprecated. Use leveldown.destroy() instead"),t.exports.repair=f(u("repair"),"levelup.repair() is deprecated. Use leveldown.repair() instead")}).call(this,e("_process"))},{"./batch":35,"./leveldown":3,"./util":37,_process:70,"deferred-leveldown":8,events:18,"level-codec":38,"level-errors":33,"level-iterator-stream":34,prr:71,util:114,xtend:120}],37:[function(e,t,r){e("xtend");t.exports={defaultOptions:{createIfMissing:!0,errorIfExists:!1,keyEncoding:"utf8",valueEncoding:"utf8",compression:!0},getOptions:function(e){return"string"==typeof e&&(e={valueEncoding:e}),"object"!=typeof e&&(e={}),e},dispatchError:function(e,t,r){"function"==typeof r?r(t):e.emit("error",t)},isDefined:function(e){return void 0!==e}}},{xtend:120}],38:[function(e,t,r){arguments[4][31][0].apply(r,arguments)},{"./lib/encodings":39,dup:31}],39:[function(e,t,r){(function(e){function t(e){return e}function n(t){return void 0===t||null===t||e.isBuffer(t)}r.utf8=r["utf-8"]={encode:function(e){return n(e)?e:String(e)},decode:t,buffer:!1,type:"utf8"},r.json={encode:JSON.stringify,decode:JSON.parse,buffer:!1,type:"json"},r.binary={encode:function(t){return n(t)?t:new e(t)},decode:t,buffer:!0,type:"binary"},r.id={encode:function(e){return e},decode:function(e){return e},buffer:!1,type:"id"};["hex","ascii","base64","ucs2","ucs-2","utf16le","utf-16le"].forEach(function(t){r[t]={encode:function(r){return n(r)?r:new e(r,t)},decode:function(e){return e.toString(t)},buffer:!0,type:t}})}).call(this,e("buffer").Buffer)},{buffer:5}],40:[function(e,t,r){"use strict";function n(){}function i(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=d,this.queue=[],this.outcome=void 0,e!==n&&u(this,e)}function o(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function s(e,t,r){l(function(){var n;try{n=t(r)}catch(t){return f.reject(e,t)}n===e?f.reject(e,new TypeError("Cannot resolve promise with itself")):f.resolve(e,n)})}function a(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function u(e,t){function r(t){i||(i=!0,f.reject(e,t))}function n(t){i||(i=!0,f.resolve(e,t))}var i=!1,o=c(function(){t(n,r)});"error"===o.status&&r(o.value)}function c(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}var l=e("immediate"),f={},p=["REJECTED"],h=["FULFILLED"],d=["PENDING"];t.exports=i,i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){if("function"!=typeof e&&this.state===h||"function"!=typeof t&&this.state===p)return this;var r=new this.constructor(n);if(this.state!==d){s(r,this.state===h?e:t,this.outcome)}else this.queue.push(new o(r,e,t));return r},o.prototype.callFulfilled=function(e){f.resolve(this.promise,e)},o.prototype.otherCallFulfilled=function(e){s(this.promise,this.onFulfilled,e)},o.prototype.callRejected=function(e){f.reject(this.promise,e)},o.prototype.otherCallRejected=function(e){s(this.promise,this.onRejected,e)},f.resolve=function(e,t){var r=c(a,t);if("error"===r.status)return f.reject(e,r.value);var n=r.value;if(n)u(e,n);else{e.state=h,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},f.reject=function(e,t){e.state=p,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},i.resolve=function(e){return e instanceof this?e:f.resolve(new this(n),e)},i.reject=function(e){var t=new this(n);return f.reject(t,e)},i.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var o=new Array(r),s=0,a=-1,u=new this(n);++a<r;)!function(e,n){t.resolve(e).then(function(e){o[n]=e,++s!==r||i||(i=!0,f.resolve(u,o))},function(e){i||(i=!0,f.reject(u,e))})}(e[a],a);return u},i.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var o=-1,s=new this(n);++o<r;)!function(e){t.resolve(e).then(function(e){i||(i=!0,f.resolve(s,e))},function(e){i||(i=!0,f.reject(s,e))})}(e[o]);return s}},{immediate:23}],41:[function(e,t,r){t.exports=function(e){return null===e}},{}],42:[function(e,t,r){(function(e){function t(e,t){return Object.hasOwnProperty.call(e,t)}function n(e){return void 0!==e&&""!==e}function t(e,t){return Object.hasOwnProperty.call(e,t)}function i(e,t){return Object.hasOwnProperty.call(e,t)&&t}r.compare=function(t,r){if(e.isBuffer(t)){for(var n=Math.min(t.length,r.length),i=0;i<n;i++){var o=t[i]-r[i];if(o)return o}return t.length-r.length}return t<r?-1:t>r?1:0};var o=r.lowerBoundKey=function(e){return i(e,"gt")||i(e,"gte")||i(e,"min")||(e.reverse?i(e,"end"):i(e,"start"))||void 0},s=r.lowerBound=function(e,t){var r=o(e);return r?e[r]:t},a=r.lowerBoundInclusive=function(e){return!t(e,"gt")},u=r.upperBoundInclusive=function(e){return!t(e,"lt")},c=r.lowerBoundExclusive=function(e){return!a(e)},l=r.upperBoundExclusive=function(e){return!u(e)},f=r.upperBoundKey=function(e){return i(e,"lt")||i(e,"lte")||i(e,"max")||(e.reverse?i(e,"start"):i(e,"end"))||void 0},p=r.upperBound=function(e,t){var r=f(e);return r?e[r]:t};r.start=function(e,t){return e.reverse?p(e,t):s(e,t)},r.end=function(e,t){return e.reverse?s(e,t):p(e,t)},r.startInclusive=function(e){return e.reverse?u(e):a(e)},r.endInclusive=function(e){return e.reverse?a(e):u(e)},r.toLtgt=function(e,n,i,o,s){n=n||{},i=i||function(e){return e};var a=arguments.length>3,u=r.lowerBoundKey(e),c=r.upperBoundKey(e);return u?"gt"===u?n.gt=i(e.gt,!1):n.gte=i(e[u],!1):a&&(n.gte=i(o,!1)),c?"lt"===c?n.lt=i(e.lt,!0):n.lte=i(e[c],!0):a&&(n.lte=i(s,!0)),null!=e.reverse&&(n.reverse=!!e.reverse),t(n,"max")&&delete n.max,t(n,"min")&&delete n.min,t(n,"start")&&delete n.start,t(n,"end")&&delete n.end,n},r.contains=function(e,t,i){i=i||r.compare;var o=s(e);if(n(o)){if((u=i(t,o))<0||0===u&&c(e))return!1}var a=p(e);if(n(a)){var u;if((u=i(t,a))>0||0===u&&l(e))return!1}return!0},r.filter=function(e,t){return function(n){return r.contains(e,n,t)}}}).call(this,{isBuffer:e("../is-buffer/index.js")})},{"../is-buffer/index.js":26}],43:[function(e,t,r){t.exports=e("immediate")},{immediate:50}],44:[function(e,t,r){(function(r){function n(e){return p.compare(e,this._end)>0}function i(e){return p.compare(e,this._end)>=0}function o(e){return p.compare(e,this._end)<0}function s(e){return p.compare(e,this._end)<=0}function a(e,t){f.call(this,e),this._limit=t.limit,-1===this._limit&&(this._limit=1/0);var r=e._store[e._location];this.keyAsBuffer=!1!==t.keyAsBuffer,this.valueAsBuffer=!1!==t.valueAsBuffer,this._reverse=t.reverse,this._options=t,this._done=0,this._reverse?(this._incr="prev",this._start=p.upperBound(t),this._end=p.lowerBound(t),void 0===this._start?this._tree=r.end:p.upperBoundInclusive(t)?this._tree=r.le(this._start):this._tree=r.lt(this._start),this._end&&(p.lowerBoundInclusive(t)?this._test=i:this._test=n)):(this._incr="next",this._start=p.lowerBound(t),this._end=p.upperBound(t),void 0===this._start?this._tree=r.begin:p.lowerBoundInclusive(t)?this._tree=r.ge(this._start):this._tree=r.gt(this._start),this._end&&(p.upperBoundInclusive(t)?this._test=s:this._test=o))}function u(e){if(!(this instanceof u))return new u(e);l.call(this,"string"==typeof e?e:""),this._location=this.location?"$"+this.location:"_tree",this._store=this.location?d:this,this._store[this._location]=this._store[this._location]||h(p.compare)}var c=e("inherits"),l=e("abstract-leveldown").AbstractLevelDOWN,f=e("abstract-leveldown").AbstractIterator,p=e("ltgt"),h=e("functional-red-black-tree"),d={},m=e("./immediate");c(a,f),a.prototype._next=function(e){var t,n;return this._done++>=this._limit?m(e):this._tree.valid?(t=this._tree.key,n=this._tree.value,this._test(t)?(this.keyAsBuffer&&(t=new r(t)),this.valueAsBuffer&&(n=new r(n)),this._tree[this._incr](),void m(function(){e(null,t,n)})):m(e)):m(e)},a.prototype._test=function(){return!0},u.clearGlobalStore=function(e){e?Object.keys(d).forEach(function(e){delete d[e]}):d={}},c(u,l),u.prototype._open=function(e,t){var r=this;m(function(){t(null,r)})},u.prototype._put=function(e,t,r,n){void 0!==t&&null!==t||(t="");var i=this._store[this._location].find(e);i.valid?this._store[this._location]=i.update(t):this._store[this._location]=this._store[this._location].insert(e,t),m(n)},u.prototype._get=function(e,t,n){var i=this._store[this._location].get(e);if(void 0===i)return m(function(){n(new Error("NotFound"))});!1===t.asBuffer||this._isBuffer(i)||(i=new r(String(i))),m(function(){n(null,i)})},u.prototype._del=function(e,t,r){this._store[this._location]=this._store[this._location].remove(e),m(r)},u.prototype._batch=function(e,t,r){for(var n,i,o,s=-1,a=e.length,u=this._store[this._location];++s<a;)e[s]&&(n=this._isBuffer(e[s].key)?e[s].key:String(e[s].key),o=u.find(n),"put"===e[s].type?(i=this._isBuffer(e[s].value)?e[s].value:String(e[s].value),u=o.valid?o.update(i):u.insert(n,i)):u=o.remove());this._store[this._location]=u,m(r)},u.prototype._iterator=function(e){return new a(this,e)},u.prototype._isBuffer=function(e){return r.isBuffer(e)},u.destroy=function(e,t){var r="$"+e;r in d&&delete d[r],m(t)},t.exports=u}).call(this,e("buffer").Buffer)},{"./immediate":43,"abstract-leveldown":48,buffer:5,"functional-red-black-tree":19,inherits:24,ltgt:56}],45:[function(e,t,r){arguments[4][9][0].apply(r,arguments)},{_process:70,dup:9}],46:[function(e,t,r){arguments[4][10][0].apply(r,arguments)},{_process:70,dup:10}],47:[function(e,t,r){arguments[4][11][0].apply(r,arguments)},{"../../../is-buffer/index.js":26,"./abstract-chained-batch":45,"./abstract-iterator":46,_process:70,dup:11,xtend:120}],48:[function(e,t,r){arguments[4][12][0].apply(r,arguments)},{"./abstract-chained-batch":45,"./abstract-iterator":46,"./abstract-leveldown":47,"./is-leveldown":49,dup:12}],49:[function(e,t,r){arguments[4][13][0].apply(r,arguments)},{"./abstract-leveldown":47,dup:13}],50:[function(e,t,r){"use strict";function n(){s&&a&&(s=!1,a.length?f=a.concat(f):l=-1,f.length&&i())}function i(){if(!s){p=!1,s=!0;for(var e=f.length,t=setTimeout(n);e;){for(a=f,f=[];a&&++l<e;)a[l].run();l=-1,e=f.length}a=null,l=-1,s=!1,clearTimeout(t)}}function o(e,t){this.fun=e,this.array=t}for(var s,a,u,c=[e("./nextTick"),e("./mutation.js"),e("./messageChannel"),e("./stateChange"),e("./timeout")],l=-1,f=[],p=!1,h=-1,d=c.length;++h<d;)if(c[h]&&c[h].test&&c[h].test()){u=c[h].install(i);break}o.prototype.run=function(){var e=this.fun,t=this.array;switch(t.length){case 0:return e();case 1:return e(t[0]);case 2:return e(t[0],t[1]);case 3:return e(t[0],t[1],t[2]);default:return e.apply(null,t)}},t.exports=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];f.push(new o(e,t)),p||s||(p=!0,u())}},{"./messageChannel":51,"./mutation.js":52,"./nextTick":53,"./stateChange":54,"./timeout":55}],51:[function(e,t,r){(function(e){"use strict";r.test=function(){return!e.setImmediate&&void 0!==e.MessageChannel},r.install=function(t){var r=new e.MessageChannel;return r.port1.onmessage=t,function(){r.port2.postMessage(0)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],52:[function(e,t,r){(function(e){"use strict";var t=e.MutationObserver||e.WebKitMutationObserver;r.test=function(){return t},r.install=function(r){var n=0,i=new t(r),o=e.document.createTextNode("");return i.observe(o,{characterData:!0}),function(){o.data=n=++n%2}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],53:[function(e,t,r){(function(e){"use strict";r.test=function(){return void 0!==e&&!e.browser},r.install=function(t){return function(){e.nextTick(t)}}}).call(this,e("_process"))},{_process:70}],54:[function(e,t,r){(function(e){"use strict";r.test=function(){return"document"in e&&"onreadystatechange"in e.document.createElement("script")},r.install=function(t){return function(){var r=e.document.createElement("script");return r.onreadystatechange=function(){t(),r.onreadystatechange=null,r.parentNode.removeChild(r),r=null},e.document.documentElement.appendChild(r),t}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],55:[function(e,t,r){"use strict";r.test=function(){return!0},r.install=function(e){return function(){setTimeout(e,0)}}},{}],56:[function(e,t,r){(function(e){function t(e,t){return Object.hasOwnProperty.call(e,t)}function n(e){return void 0!==e&&""!==e}function t(e,t){return Object.hasOwnProperty.call(e,t)}function i(e,t){return Object.hasOwnProperty.call(e,t)&&t}r.compare=function(t,r){if(e.isBuffer(t)){for(var n=Math.min(t.length,r.length),i=0;i<n;i++){var o=t[i]-r[i];if(o)return o}return t.length-r.length}return t<r?-1:t>r?1:0};var o=r.lowerBoundKey=function(e){return i(e,"gt")||i(e,"gte")||i(e,"min")||(e.reverse?i(e,"end"):i(e,"start"))||void 0},s=r.lowerBound=function(e){var t=o(e);return t&&e[t]},a=r.lowerBoundInclusive=function(e){return!t(e,"gt")},u=r.upperBoundInclusive=function(e){return!t(e,"lt")},c=r.lowerBoundExclusive=function(e){return!a(e)},l=r.upperBoundExclusive=function(e){return!u(e)},f=r.upperBoundKey=function(e){return i(e,"lt")||i(e,"lte")||i(e,"max")||(e.reverse?i(e,"start"):i(e,"end"))||void 0},p=r.upperBound=function(e){var t=f(e);return t&&e[t]};r.toLtgt=function(e,n,i,o,s){n=n||{},i=i||function(e){return e};var a=arguments.length>3,u=r.lowerBoundKey(e),c=r.upperBoundKey(e);return u?"gt"===u?n.gt=i(e.gt,!1):n.gte=i(e[u],!1):a&&(n.gte=i(o,!1)),c?"lt"===c?n.lt=i(e.lt,!0):n.lte=i(e[c],!0):a&&(n.lte=i(s,!0)),null!=e.reverse&&(n.reverse=!!e.reverse),t(n,"max")&&delete n.max,t(n,"min")&&delete n.min,t(n,"start")&&delete n.start,t(n,"end")&&delete n.end,n},r.contains=function(e,t,i){i=i||r.compare;var o=s(e);if(n(o)){if((u=i(t,o))<0||0===u&&c(e))return!1}var a=p(e);if(n(a)){var u;if((u=i(t,a))>0||0===u&&l(e))return!1}return!0},r.filter=function(e,t){return function(n){return r.contains(e,n,t)}}}).call(this,{isBuffer:e("../../../is-buffer/index.js")})},{"../../../is-buffer/index.js":26}],57:[function(e,t,r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function i(e,t){var r=new Uint8Array(e);return E.blob([r],{type:t})}function o(e,t){E.readAsBinaryString(e,t)}function s(e,t){var r=t.prefix()[0],n=e._cache,i=n.get(r);return i||(i=new f.Map,n.set(r,i)),i}function a(){this._batch=[],this._cache=new f.Map}function u(e){return"winningRev"in e?e.winningRev:x.winningRev(e)}function c(e,t){return"deleted"in e?e.deleted:_.isDeleted(e,t)}function l(e,t,r){var n=[];return e.forEach(function(e){if(e.doc&&e.doc._attachments){Object.keys(e.doc._attachments).forEach(function(t){var r=e.doc._attachments[t];"data"in r||n.push(r)})}}),p.all(n.map(function(e){return function(e,t,r){var n=e.content_type;return new p(function(o,s){t.binaryStore.get(e.digest,function(t,a){var u;if(t){if("NotFoundError"!==t.name)return s(t);u=r.binary?E.binaryStringToBlobOrBuffer("",n):""}else u=r.binary?i(a,n):a.toString("base64");delete e.stub,delete e.length,e.data=u,o()})})}(e,t,r)}))}var f=e("pouchdb-collections"),p=n(e("pouchdb-promise")),h=n(e("levelup")),d=n(e("sublevel-pouchdb")),m=e("through2"),v=n(e("argsarray")),y=n(e("double-ended-queue")),g=n(e("buffer-from")),b=e("pouchdb-utils"),_=e("pouchdb-adapter-utils"),x=e("pouchdb-merge"),w=e("pouchdb-json"),k=e("pouchdb-md5"),E=e("pouchdb-binary-utils"),S=e("pouchdb-errors");a.prototype.get=function(e,t,r){var n=s(this,e),i=n.get(t);return i?b.nextTick(function(){r(null,i)}):null===i?b.nextTick(function(){r({name:"NotFoundError"})}):void e.get(t,function(e,i){if(e)return"NotFoundError"===e.name&&n.set(t,null),r(e);n.set(t,i),r(null,i)})},a.prototype.batch=function(e){for(var t=0,r=e.length;t<r;t++){var n=e[t],i=s(this,n.prefix);"put"===n.type?i.set(n.key,n.value):i.set(n.key,null)}this._batch=this._batch.concat(e)},a.prototype.execute=function(e,t){for(var r=new f.Set,n=[],i=this._batch.length-1;i>=0;i--){var o=this._batch[i],s=o.prefix.prefix()[0]+""+o.key;r.has(s)||(r.add(s),n.push(o))}e.batch(n,t)};var A="document-store",D="by-sequence",C="attach-store",F="attach-binary-store",O="local-store",j="meta-store",R=new f.Map,B="_local_last_update_seq",T="_local_doc_count",P="_local_uuid",I="md5-",L={encode:w.safeJsonStringify,decode:w.safeJsonParse,buffer:!1,type:"cheap-json"},N=new b.changesHandler;t.exports=function(e,t){function r(){G.docStore=z.sublevel(A,{valueEncoding:L}),G.bySeqStore=z.sublevel(D,{valueEncoding:"json"}),G.attachmentStore=z.sublevel(C,{valueEncoding:"json"}),G.binaryStore=z.sublevel(F,{valueEncoding:"binary"}),G.localStore=z.sublevel(O,{valueEncoding:"json"}),G.metaStore=z.sublevel(j,{valueEncoding:"json"}),"object"==typeof e.migrate?e.migrate.doMigrationTwo(z,G,n):n()}function n(){G.metaStore.get(B,function(e,r){void 0===z._updateSeq&&(z._updateSeq=r||0),G.metaStore.get(T,function(e,r){z._docCount=e?0:r,G.metaStore.get(P,function(e,r){U=e?b.uuid():r,G.metaStore.put(P,U,function(){b.nextTick(function(){t(null,V)})})})})})}function s(e,t){try{e.apply(null,t)}catch(e){t[t.length-1](e)}}function w(){var e=z._queue.peekFront();"read"===e.type?function(e){for(var t=[e],r=1,n=z._queue.get(r);void 0!==n&&"read"===n.type;)t.push(n),r++,n=z._queue.get(r);var i=0;t.forEach(function(e){var r=e.args,n=r[r.length-1];r[r.length-1]=v(function(e){n.apply(null,e),++i===t.length&&b.nextTick(function(){t.forEach(function(){z._queue.shift()}),z._queue.length&&w()})}),s(e.fun,r)})}(e):function(e){var t=e.args,r=t[t.length-1];t[t.length-1]=v(function(e){r.apply(null,e),b.nextTick(function(){z._queue.shift(),z._queue.length&&w()})}),s(e.fun,t)}(e)}function M(e){return v(function(t){z._queue.push({fun:e,args:t,type:"write"}),1===z._queue.length&&b.nextTick(w)})}function q(e){return v(function(t){z._queue.push({fun:e,args:t,type:"read"}),1===z._queue.length&&b.nextTick(w)})}function $(e){return("0000000000000000"+e).slice(-16)}function W(e,t){Q.destroy(e,t)}var U,z,V=this,G={},H=(e=b.clone(e)).revs_limit,J=e.name;void 0===e.createIfMissing&&(e.createIfMissing=!0);var K,Q=e.db,Y=b.functionName(Q);R.has(Y)?K=R.get(Y):(K=new f.Map,R.set(Y,K)),K.has(J)?(z=K.get(J),r()):K.set(J,d(h(J,e,function(n){if(n)return K.delete(J),t(n);(z=K.get(J))._docCount=-1,z._queue=new y,"object"==typeof e.migrate?e.migrate.doMigrationOne(J,z,r):r()}))),V._remote=!1,V.type=function(){return"leveldb"},V._id=function(e){e(null,U)},V._info=function(e){var t={doc_count:z._docCount,update_seq:z._updateSeq,backend_adapter:b.functionName(Q)};return b.nextTick(function(){e(null,t)})},V._get=q(function(e,t,r){t=b.clone(t),G.docStore.get(e,function(e,n){if(e||!n)return r(S.createError(S.MISSING_DOC,"missing"));var i;if(t.rev)i=t.latest?x.latest(t.rev,n):t.rev;else if(i=u(n),c(n,i))return r(S.createError(S.MISSING_DOC,"deleted"));var o=n.rev_map[i];G.bySeqStore.get($(o),function(e,t){if(!t)return r(S.createError(S.MISSING_DOC));if("_id"in t&&t._id!==n.id)return r(new Error("wrong doc returned"));if(t._id=n.id,"_rev"in t){if(t._rev!==i)return r(new Error("wrong doc returned"))}else t._rev=i;return r(null,{doc:t,metadata:n})})})}),V._getAttachment=function(e,t,r,n,o){var s=r.digest,a=r.content_type;G.binaryStore.get(s,function(e,t){if(e)return"NotFoundError"!==e.name?o(e):o(null,n.binary?function(e){return E.blob([""],{type:e})}(a):"");n.binary?o(null,i(t,a)):o(null,t.toString("base64"))})},V._bulkDocs=M(function(e,t,r){function n(e,t){var r=p.resolve();e.forEach(function(e,t){r=r.then(function(){return new p(function(r,n){V._doCompactionNoLock(t,e,{ctx:v},function(e){if(e)return n(e);r()})})})}),r.then(function(){t()},t)}function i(){n(m,function(e){if(e&&c(e),V.auto_compaction)return function(e){var t=new f.Map;d.forEach(function(e,r){t.set(r,x.compactTree(e))}),n(t,e)}(c);c()})}function s(e,t,n,i,s,a,c,l){function f(e){A++,x||(e?l(x=e):A===D.length&&_())}function p(e,t,r,n){return function(i){!function(e,t,r,n,i){var o=e.data._attachments[r];delete o.data,o.digest=t,o.length=n.length;var s=e.metadata.id,a=e.metadata.rev;o.revpos=parseInt(a,10),u(s,a,t,function(e,r){return e?i(e):0===n.length?i(e):r?(v.batch([{type:"put",prefix:G.binaryStore,key:t,value:g(n,"binary")}]),void i()):i(e)})}(e,I+i,t,r,n)}}function b(e,t,r){return function(n){k.binaryMd5(n,p(e,t,n,r))}}function _(){var t=e.metadata.rev_map[e.metadata.rev];if(t)return l();t=++w,e.metadata.rev_map[e.metadata.rev]=e.metadata.seq=t;var r=[{key:$(t),value:e.data,prefix:G.bySeqStore,type:"put"},{key:e.metadata.id,value:e.metadata,prefix:G.docStore,type:"put"}];v.batch(r),h[c]={ok:!0,id:e.metadata.id,rev:e.metadata.rev},d.set(e.metadata.id,e.metadata),l()}y+=a;var x=null,A=0;e.metadata.winningRev=t,e.metadata.deleted=n,e.data._id=e.metadata.id,e.data._rev=e.metadata.rev,i&&(e.data._deleted=!0),e.stemmedRevs.length&&m.set(e.metadata.id,e.stemmedRevs);for(var D=e.data._attachments?Object.keys(e.data._attachments):[],C=0;C<D.length;C++){var F=D[C],O=e.data._attachments[F];if(O.stub)u(e.data._id,e.data._rev,O.digest,f);else{var j;if("string"==typeof O.data){try{j=E.atob(O.data)}catch(e){return void r(S.createError(S.BAD_ARG,"Attachment is not a valid base64 string"))}b(e,F,f)(j)}else o(O.data,b(e,F,f))}}D.length||_()}function u(e,t,r,n){function i(n){var i=[e,t].join("@"),o={};return n?n.refs&&(o.refs=n.refs,o.refs[i]=!0):(o.refs={},o.refs[i]=!0),new p(function(e){v.batch([{type:"put",prefix:G.attachmentStore,key:r,value:o}]),e(!n)})}var o=F[r]||p.resolve();F[r]=o.then(function(){return new p(function(e,t){v.get(G.attachmentStore,r,function(r,n){if(r&&"NotFoundError"!==r.name)return t(r);e(n)})}).then(i).then(function(e){n(null,e)},n)})}function c(e){if(e)return b.nextTick(function(){r(e)});v.batch([{prefix:G.metaStore,type:"put",key:B,value:w},{prefix:G.metaStore,type:"put",key:T,value:z._docCount+y}]),v.execute(z,function(e){if(e)return r(e);z._docCount+=y,z._updateSeq=w,N.notify(J),b.nextTick(function(){r(null,h)})})}var l=t.new_edits,h=new Array(e.docs.length),d=new f.Map,m=new f.Map,v=new a,y=0,w=z._updateSeq,A=e.docs,D=A.map(function(e){if(e._id&&_.isLocalId(e._id))return e;var t=_.parseDoc(e,l);return t.metadata&&!t.metadata.rev_map&&(t.metadata.rev_map={}),t}),C=D.filter(function(e){return e.error});if(C.length)return r(C[0]);var F={};if(!D.length)return r(null,[]);!function(e){var t=[];if(A.forEach(function(e){e&&e._attachments&&Object.keys(e._attachments).forEach(function(r){var n=e._attachments[r];n.stub&&t.push(n.digest)})}),!t.length)return e();var r,n=0;t.forEach(function(i){!function(e,t){v.get(G.attachmentStore,e,function(r){if(r){var n=S.createError(S.MISSING_STUB,"unknown stub attachment with digest "+e);t(n)}else t()})}(i,function(i){i&&!r&&(r=i),++n===t.length&&e(r)})})}(function(e){if(e)return r(e);!function(e){function t(){if(++n===A.length)return e(r)}var r,n=0;A.forEach(function(e){if(e._id&&_.isLocalId(e._id))return t();v.get(G.docStore,e._id,function(n,i){n?"NotFoundError"!==n.name&&(r=n):d.set(e._id,i),t()})})}(function(e){if(e)return r(e);_.processDocs(H,D,V,d,v,h,s,t,i)})})}),V._allDocs=q(function(e,t){e=b.clone(e),function(e){z.isClosed()?e(new Error("database is closed")):e(null,z._docCount)}(function(r,n){if(r)return t(r);var i={},o=e.skip||0;if(e.startkey&&(i.gte=e.startkey),e.endkey&&(i.lte=e.endkey),e.key&&(i.gte=i.lte=e.key),e.descending){i.reverse=!0;var s=i.lte;i.lte=i.gte,i.gte=s}var a;if("number"==typeof e.limit&&(a=e.limit),0===a||"start"in i&&"end"in i&&i.start>i.end)return t(null,{total_rows:n,offset:e.skip,rows:[]});var f=[],h=G.docStore.readStream(i),d=m.obj(function(t,r,n){function i(t){var r={id:s.id,key:s.id,value:{rev:l}};if(e.include_docs){if(r.doc=t,r.doc._rev=r.value.rev,e.conflicts){var i=x.collectConflicts(s);i.length&&(r.doc._conflicts=i)}for(var o in r.doc._attachments)r.doc._attachments.hasOwnProperty(o)&&(r.doc._attachments[o].stub=!0)}if(!1===e.inclusive_end&&s.id===e.endkey)return n();if(p){if("ok"!==e.deleted)return n();r.value.deleted=!0,r.doc=null}f.push(r),n()}var s=t.value,l=u(s),p=c(s,l);if(p){if("ok"!==e.deleted)return void n()}else{if(o-- >0)return void n();if("number"==typeof a&&a--<=0)return h.unpipe(),h.destroy(),void n()}if(e.include_docs){var d=s.rev_map[l];G.bySeqStore.get($(d),function(e,t){i(t)})}else i()},function(r){p.resolve().then(function(){if(e.include_docs&&e.attachments)return l(f,G,e)}).then(function(){t(null,{total_rows:n,offset:e.skip,rows:f})},t),r()}).on("unpipe",function(){d.end()});h.on("error",t),h.pipe(d)})}),V._changes=function(e){function t(){e.done=!0,p&&e.limit&&e.limit<o.length&&(o.length=e.limit),y.unpipe(g),y.destroy(),e.continuous||e.cancelled||(e.include_docs&&e.attachments?l(o,G,e).then(function(){e.complete(null,{results:o,last_seq:s})}):e.complete(null,{results:o,last_seq:s}))}if((e=b.clone(e)).continuous){var r=J+":"+b.uuid();return N.addListener(J,r,V,e),N.notify(J),{cancel:function(){N.removeListener(J,r)}}}var n,i=e.descending,o=[],s=e.since||0,a=0,c={reverse:i};"limit"in e&&e.limit>0&&(n=e.limit),c.reverse||(c.start=$(e.since||0));var p,h=e.doc_ids&&new f.Set(e.doc_ids),d=b.filterChange(e),v=new f.Map;p="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var y=G.bySeqStore.readStream(c),g=m.obj(function(r,c,f){function m(t){function r(r){var n=e.processChange(r,t,e);n.seq=t.seq;var i=d(n);if("object"==typeof i)return e.complete(i);i&&(a++,e.attachments&&e.include_docs?l([n],G,e).then(function(){e.onChange(n)}):e.onChange(n),p&&o.push(n)),f()}var n=u(t);if(t.seq!==y)return f();if(s=y,n===g._rev)return r(g);var i=t.rev_map[n];G.bySeqStore.get($(i),function(e,t){r(t)})}if(n&&a>=n)return t(),f();if(e.cancelled||e.done)return f();var y=function(e){return parseInt(e,10)}(r.key),g=r.value;if(y===e.since&&!i)return f();if(h&&!h.has(g._id))return f();var b;if(b=v.get(g._id))return m(b);G.docStore.get(g._id,function(t,r){if(e.cancelled||e.done||z.isClosed()||_.isLocalId(r.id))return f();v.set(g._id,r),m(r)})},function(t){if(e.cancelled)return t();p&&e.limit&&e.limit<o.length&&(o.length=e.limit),t()}).on("unpipe",function(){g.end(),t()});return y.pipe(g),{cancel:function(){e.cancelled=!0,t()}}},V._close=function(e){if(z.isClosed())return e(S.createError(S.NOT_OPEN));z.close(function(t){t?e(t):(K.delete(J),e())})},V._getRevisionTree=function(e,t){G.docStore.get(e,function(e,r){e?t(S.createError(S.MISSING_DOC)):t(null,r.rev_tree)})},V._doCompaction=M(function(e,t,r,n){V._doCompactionNoLock(e,t,r,n)}),V._doCompactionNoLock=function(e,t,r,n){if("function"==typeof r&&(n=r,r={}),!t.length)return n();var i=r.ctx||new a;i.get(G.docStore,e,function(o,s){function a(r){if(r&&(p=r),++d===t.length){if(p)return n(p);!function(){function r(e){e&&(o=e),++s===n.length&&u(o)}var n=Object.keys(h);if(!n.length)return u();var o,s=0,a=new f.Map;t.forEach(function(t){a.set(e+"@"+t,!0)}),n.forEach(function(e){i.get(G.attachmentStore,e,function(t,n){if(t)return"NotFoundError"===t.name?r():r(t);var i=Object.keys(n.refs||{}).filter(function(e){return!a.has(e)}),o={};i.forEach(function(e){o[e]=!0}),i.length?l.push({key:e,type:"put",value:{refs:o},prefix:G.attachmentStore}):l=l.concat([{key:e,type:"del",prefix:G.attachmentStore},{key:e,type:"del",prefix:G.binaryStore}]),r()})})}()}}function u(e){return e?n(e):(i.batch(l),r.ctx?n():void i.execute(z,n))}if(o)return n(o);var c=t.map(function(e){var t=s.rev_map[e];return delete s.rev_map[e],t});x.traverseRevTree(s.rev_tree,function(e,r,n,i,o){var s=r+"-"+n;-1!==t.indexOf(s)&&(o.status="missing")});var l=[];l.push({key:s.id,value:s,type:"put",prefix:G.docStore});var p,h={},d=0;c.forEach(function(e){l.push({key:$(e),type:"del",prefix:G.bySeqStore}),i.get(G.bySeqStore,$(e),function(e,t){if(e)return"NotFoundError"===e.name?a():a(e);Object.keys(t._attachments||{}).forEach(function(e){var r=t._attachments[e].digest;h[r]=!0}),a()})})})},V._getLocal=function(e,t){G.localStore.get(e,function(e,r){e?t(S.createError(S.MISSING_DOC)):t(null,r)})},V._putLocal=function(e,t,r){"function"==typeof t&&(r=t,t={}),t.ctx?V._putLocalNoLock(e,t,r):V._putLocalWithLock(e,t,r)},V._putLocalWithLock=M(function(e,t,r){V._putLocalNoLock(e,t,r)}),V._putLocalNoLock=function(e,t,r){delete e._revisions;var n=e._rev,i=e._id,o=t.ctx||new a;o.get(G.localStore,i,function(s,a){if(s&&n)return r(S.createError(S.REV_CONFLICT));if(a&&a._rev!==n)return r(S.createError(S.REV_CONFLICT));e._rev=n?"0-"+(parseInt(n.split("-")[1],10)+1):"0-1";var u=[{type:"put",prefix:G.localStore,key:i,value:e}];o.batch(u);var c={ok:!0,id:e._id,rev:e._rev};if(t.ctx)return r(null,c);o.execute(z,function(e){if(e)return r(e);r(null,c)})})},V._removeLocal=function(e,t,r){"function"==typeof t&&(r=t,t={}),t.ctx?V._removeLocalNoLock(e,t,r):V._removeLocalWithLock(e,t,r)},V._removeLocalWithLock=M(function(e,t,r){V._removeLocalNoLock(e,t,r)}),V._removeLocalNoLock=function(e,t,r){var n=t.ctx||new a;n.get(G.localStore,e._id,function(i,o){if(i)return r("NotFoundError"!==i.name?i:S.createError(S.MISSING_DOC));if(o._rev!==e._rev)return r(S.createError(S.REV_CONFLICT));n.batch([{prefix:G.localStore,type:"del",key:e._id}]);var s={ok:!0,id:e._id,rev:"0-0"};if(t.ctx)return r(null,s);n.execute(z,function(e){if(e)return r(e);r(null,s)})})},V._destroy=function(e,t){var r,n=b.functionName(Q);if(!R.has(n))return W(J,t);(r=R.get(n)).has(J)?(N.removeAllListeners(J),r.get(J).close(function(){r.delete(J),W(J,t)})):W(J,t)}}},{argsarray:1,"buffer-from":4,"double-ended-queue":14,levelup:36,"pouchdb-adapter-utils":60,"pouchdb-binary-utils":61,"pouchdb-collections":62,"pouchdb-errors":63,"pouchdb-json":64,"pouchdb-md5":65,"pouchdb-merge":66,"pouchdb-promise":58,"pouchdb-utils":67,"sublevel-pouchdb":97,through2:109}],58:[function(e,t,r){"use strict";var n=function(e){return e&&"object"==typeof e&&"default"in e?e.default:e}(e("lie")),i="function"==typeof Promise?Promise:n;t.exports=i},{lie:40}],59:[function(e,t,r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function i(e,t){var r=o.assign({db:a},e);s.call(this,r,t)}var o=e("pouchdb-utils"),s=n(e("pouchdb-adapter-leveldb-core")),a=n(e("memdown"));i.valid=function(){return!0},i.use_prefix=!1;t.exports=function(e){e.adapter("memory",i,!0)}},{memdown:44,"pouchdb-adapter-leveldb-core":57,"pouchdb-utils":67}],60:[function(e,t,r){"use strict";function n(e){return e.reduce(function(e,t){return e[t]=!0,e},{})}function i(e){if(!/^\d+-./.test(e))return l.createError(l.INVALID_REV);var t=e.indexOf("-"),r=e.substring(0,t),n=e.substring(t+1);return{prefix:parseInt(r,10),id:n}}function o(e,t){var r,n,o,s={status:"available"};if(e._deleted&&(s.deleted=!0),t)if(e._id||(e._id=c.uuid()),n=c.rev(),e._rev){if((o=i(e._rev)).error)return o;e._rev_tree=[{pos:o.prefix,ids:[o.id,{status:"missing"},[[n,s,[]]]]}],r=o.prefix+1}else e._rev_tree=[{pos:1,ids:[n,s,[]]}],r=1;else if(e._revisions&&(e._rev_tree=function(e,t){for(var r=e.start-e.ids.length+1,n=e.ids,i=[n[0],t,[]],o=1,s=n.length;o<s;o++)i=[n[o],{status:"missing"},[i]];return[{pos:r,ids:i}]}(e._revisions,s),r=e._revisions.start,n=e._revisions.ids[0]),!e._rev_tree){if((o=i(e._rev)).error)return o;r=o.prefix,n=o.id,e._rev_tree=[{pos:r,ids:[n,s,[]]}]}c.invalidIdError(e._id),e._rev=r+"-"+n;var a={metadata:{},data:{}};for(var u in e)if(Object.prototype.hasOwnProperty.call(e,u)){var f="_"===u[0];if(f&&!m[u]){var p=l.createError(l.DOC_VALIDATION,u);throw p.message=l.DOC_VALIDATION.message+": "+u,p}f&&!v[u]?a.metadata[u.slice(1)]=e[u]:a.data[u]=e[u]}return a}function s(e,t,r){var n=function(e){try{return p.atob(e)}catch(e){return{error:l.createError(l.BAD_ARG,"Attachment is not a valid base64 string")}}}(e.data);if(n.error)return r(n.error);e.length=n.length,e.data="blob"===t?p.binaryStringToBlobOrBuffer(n,e.content_type):"base64"===t?p.btoa(n):n,h.binaryMd5(n,function(t){e.digest="md5-"+t,r()})}function a(e,t,r){if(e.stub)return r();"string"==typeof e.data?s(e,t,r):function(e,t,r){h.binaryMd5(e.data,function(n){e.digest="md5-"+n,e.length=e.data.size||e.data.length||0,"binary"===t?p.blobOrBufferToBinaryString(e.data,function(t){e.data=t,r()}):"base64"===t?p.blobOrBufferToBase64(e.data,function(t){e.data=t,r()}):r()})}(e,t,r)}function u(e,t,r,n,i,s,a,u){if(f.revExists(t.rev_tree,r.metadata.rev))return n[i]=r,s();var c=t.winningRev||f.winningRev(t),p="deleted"in t?t.deleted:f.isDeleted(t,c),h="deleted"in r.metadata?r.metadata.deleted:f.isDeleted(r.metadata),d=/^1-/.test(r.metadata.rev);if(p&&!h&&u&&d){var m=r.data;m._rev=c,m._id=r.metadata.id,r=o(m,u)}var v=f.merge(t.rev_tree,r.metadata.rev_tree[0],e);if(u&&(p&&h&&"new_leaf"!==v.conflicts||!p&&"new_leaf"!==v.conflicts||p&&!h&&"new_branch"===v.conflicts)){var y=l.createError(l.REV_CONFLICT);return n[i]=y,s()}var g=r.metadata.rev;r.metadata.rev_tree=v.tree,r.stemmedRevs=v.stemmedRevs||[],t.rev_map&&(r.metadata.rev_map=t.rev_map);var b=f.winningRev(r.metadata),_=f.isDeleted(r.metadata,b),x=p===_?0:p<_?-1:1;a(r,b,_,g===b?_:f.isDeleted(r.metadata,g),!0,x,i,s)}Object.defineProperty(r,"__esModule",{value:!0});var c=e("pouchdb-utils"),l=e("pouchdb-errors"),f=e("pouchdb-merge"),p=e("pouchdb-binary-utils"),h=e("pouchdb-md5"),d=e("pouchdb-collections"),m=n(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),v=n(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);r.invalidIdError=c.invalidIdError,r.isDeleted=f.isDeleted,r.isLocalId=f.isLocalId,r.normalizeDdocFunctionName=c.normalizeDdocFunctionName,r.parseDdocFunctionName=c.parseDdocFunctionName,r.parseDoc=o,r.preprocessAttachments=function(e,t,r){function n(){o++,e.length===o&&(i?r(i):r())}if(!e.length)return r();var i,o=0;e.forEach(function(e){function r(e){i=e,++s===o.length&&n()}var o=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],s=0;if(!o.length)return n();for(var u in e.data._attachments)e.data._attachments.hasOwnProperty(u)&&a(e.data._attachments[u],t,r)})},r.processDocs=function(e,t,r,n,i,o,s,a,c){function p(){++v===y&&c&&c()}e=e||1e3;var h=a.new_edits,m=new d.Map,v=0,y=t.length;t.forEach(function(e,t){if(e._id&&f.isLocalId(e._id)){var n=e._deleted?"_removeLocal":"_putLocal";r[n](e,{ctx:i},function(e,r){o[t]=e||r,p()})}else{var s=e.metadata.id;m.has(s)?(y--,m.get(s).push([e,t])):m.set(s,[[e,t]])}}),m.forEach(function(t,r){function i(){++d<t.length?c():p()}function c(){var c=t[d],p=c[0],m=c[1];if(n.has(r))u(e,n.get(r),p,o,m,i,s,h);else{var v=f.merge([],p.metadata.rev_tree[0],e);p.metadata.rev_tree=v.tree,p.stemmedRevs=v.stemmedRevs||[],function(e,t,r){var n=f.winningRev(e.metadata),i=f.isDeleted(e.metadata,n);if("was_delete"in a&&i)return o[t]=l.createError(l.MISSING_DOC,"deleted"),r();if(h&&function(e){return"missing"===e.metadata.rev_tree[0].ids[1].status}(e)){var u=l.createError(l.REV_CONFLICT);return o[t]=u,r()}s(e,n,i,i,!1,i?0:1,t,r)}(p,m,i)}}var d=0;c()})},r.updateDoc=u},{"pouchdb-binary-utils":61,"pouchdb-collections":62,"pouchdb-errors":63,"pouchdb-md5":65,"pouchdb-merge":66,"pouchdb-utils":67}],61:[function(e,t,r){"use strict";function n(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)r.append(e[n]);return r.getBlob(t.type)}}function i(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),i=0;i<t;i++)n[i]=e.charCodeAt(i);return r}function o(e,t){return n([i(e)],{type:t})}function s(e){for(var t="",r=new Uint8Array(e),n=r.byteLength,i=0;i<n;i++)t+=String.fromCharCode(r[i]);return t}function a(e,t){if("undefined"==typeof FileReader)return t(s((new FileReaderSync).readAsArrayBuffer(e)));var r=new FileReader,n="function"==typeof r.readAsBinaryString;r.onloadend=function(e){var r=e.target.result||"";if(n)return t(r);t(s(r))},n?r.readAsBinaryString(e):r.readAsArrayBuffer(e)}function u(e,t){a(e,function(e){t(e)})}Object.defineProperty(r,"__esModule",{value:!0});var c=function(e){return atob(e)},l=function(e){return btoa(e)};r.atob=c,r.btoa=l,r.base64StringToBlobOrBuffer=function(e,t){return o(c(e),t)},r.binaryStringToArrayBuffer=i,r.binaryStringToBlobOrBuffer=o,r.blob=n,r.blobOrBufferToBase64=function(e,t){u(e,function(e){t(l(e))})},r.blobOrBufferToBinaryString=u,r.readAsArrayBuffer=function(e,t){if("undefined"==typeof FileReader)return t((new FileReaderSync).readAsArrayBuffer(e));var r=new FileReader;r.onloadend=function(e){var r=e.target.result||new ArrayBuffer(0);t(r)},r.readAsArrayBuffer(e)},r.readAsBinaryString=a,r.typedBuffer=function(){}},{}],62:[function(e,t,r){"use strict";function n(e){return"$"+e}function i(e){return e.substring(1)}function o(){this._store={}}function s(e){if(this._store=new o,e&&Array.isArray(e))for(var t=0,r=e.length;t<r;t++)this.add(e[t])}Object.defineProperty(r,"__esModule",{value:!0}),o.prototype.get=function(e){var t=n(e);return this._store[t]},o.prototype.set=function(e,t){var r=n(e);return this._store[r]=t,!0},o.prototype.has=function(e){return n(e)in this._store},o.prototype.delete=function(e){var t=n(e),r=t in this._store;return delete this._store[t],r},o.prototype.forEach=function(e){for(var t=Object.keys(this._store),r=0,n=t.length;r<n;r++){var o=t[r];e(this._store[o],o=i(o))}},Object.defineProperty(o.prototype,"size",{get:function(){return Object.keys(this._store).length}}),s.prototype.add=function(e){return this._store.set(e,!0)},s.prototype.has=function(e){return this._store.has(e)},s.prototype.forEach=function(e){this._store.forEach(function(t,r){e(r)})},Object.defineProperty(s.prototype,"size",{get:function(){return this._store.size}}),!function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}()?(r.Set=s,r.Map=o):(r.Set=Set,r.Map=Map)},{}],63:[function(e,t,r){"use strict";function n(e,t,r){Error.call(this,r),this.status=e,this.name=t,this.message=r,this.error=!0}Object.defineProperty(r,"__esModule",{value:!0});(function(e){return e&&"object"==typeof e&&"default"in e?e.default:e})(e("inherits"))(n,Error),n.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var i=new n(401,"unauthorized","Name or password is incorrect."),o=new n(400,"bad_request","Missing JSON list of 'docs'"),s=new n(404,"not_found","missing"),a=new n(409,"conflict","Document update conflict"),u=new n(400,"bad_request","_id field must contain a string"),c=new n(412,"missing_id","_id is required for puts"),l=new n(400,"bad_request","Only reserved document ids may start with underscore."),f=new n(412,"precondition_failed","Database not open"),p=new n(500,"unknown_error","Database encountered an unknown error"),h=new n(500,"badarg","Some query argument is invalid"),d=new n(400,"invalid_request","Request was invalid"),m=new n(400,"query_parse_error","Some query parameter is invalid"),v=new n(500,"doc_validation","Bad special document member"),y=new n(400,"bad_request","Something wrong with the request"),g=new n(400,"bad_request","Document must be a JSON object"),b=new n(404,"not_found","Database not found"),_=new n(500,"indexed_db_went_bad","unknown"),x=new n(500,"web_sql_went_bad","unknown"),w=new n(500,"levelDB_went_went_bad","unknown"),k=new n(403,"forbidden","Forbidden by design doc validate_doc_update function"),E=new n(400,"bad_request","Invalid rev format"),S=new n(412,"file_exists","The database could not be created, the file already exists."),A=new n(412,"missing_stub","A pre-existing attachment stub wasn't found"),D=new n(413,"invalid_url","Provided URL is invalid");r.UNAUTHORIZED=i,r.MISSING_BULK_DOCS=o,r.MISSING_DOC=s,r.REV_CONFLICT=a,r.INVALID_ID=u,r.MISSING_ID=c,r.RESERVED_ID=l,r.NOT_OPEN=f,r.UNKNOWN_ERROR=p,r.BAD_ARG=h,r.INVALID_REQUEST=d,r.QUERY_PARSE_ERROR=m,r.DOC_VALIDATION=v,r.BAD_REQUEST=y,r.NOT_AN_OBJECT=g,r.DB_MISSING=b,r.WSQ_ERROR=x,r.LDB_ERROR=w,r.FORBIDDEN=k,r.INVALID_REV=E,r.FILE_EXISTS=S,r.MISSING_STUB=A,r.IDB_ERROR=_,r.INVALID_URL=D,r.createError=function(e,t){function r(t){for(var r in e)"function"!=typeof e[r]&&(this[r]=e[r]);void 0!==t&&(this.reason=t)}return r.prototype=n.prototype,new r(t)},r.generateErrorFromResponse=function(e){if("object"!=typeof e){var t=e;(e=p).data=t}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}},{inherits:24}],64:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(e){return e&&"object"==typeof e&&"default"in e?e.default:e}(e("vuvuzela"));r.safeJsonParse=function(e){try{return JSON.parse(e)}catch(t){return n.parse(e)}},r.safeJsonStringify=function(e){try{return JSON.stringify(e)}catch(t){return n.stringify(e)}}},{vuvuzela:119}],65:[function(e,t,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("pouchdb-binary-utils"),i=function(e){return e&&"object"==typeof e&&"default"in e?e.default:e}(e("spark-md5")),o=t.setImmediate||t.setTimeout,s=32768;r.binaryMd5=function(e,t){function r(){o(u)}function a(){var e=function(e){return n.btoa(e)}(d.end(!0));t(e),d.destroy()}function u(){var t=h*f,n=t+f;++h<p?m(d,e,t,n,r):m(d,e,t,n,a)}var c="string"==typeof e,l=c?e.length:e.size,f=Math.min(s,l),p=Math.ceil(l/f),h=0,d=c?new i:new i.ArrayBuffer,m=c?function(e,t,r,n,i){(r>0||n<t.length)&&(t=t.substring(r,n)),e.appendBinary(t),i()}:function(e,t,r,i,o){(r>0||i<t.size)&&(t=function(e,t,r){return e.webkitSlice?e.webkitSlice(t,r):e.slice(t,r)}(t,r,i)),n.readAsArrayBuffer(t,function(t){e.append(t),o()})};u()},r.stringMd5=function(e){return i.hash(e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"pouchdb-binary-utils":61,"spark-md5":80}],66:[function(e,t,r){"use strict";function n(e){for(var t,r,n,i,o=e.rev_tree.slice();i=o.pop();){var s=i.ids,a=s[2],u=i.pos;if(a.length)for(var c=0,l=a.length;c<l;c++)o.push({pos:u+1,ids:a[c]});else{var f=!!s[1].deleted,p=s[0];t&&!(n!==f?n:r!==u?r<u:t<p)||(t=p,r=u,n=f)}}return r+"-"+t}function i(e,t){for(var r,n=e.slice();r=n.pop();)for(var i=r.pos,o=r.ids,s=o[2],a=t(0===s.length,i,o[0],r.ctx,o[1]),u=0,c=s.length;u<c;u++)n.push({pos:i+1,ids:s[u],ctx:a})}function o(e,t){return e.pos-t.pos}function s(e){var t=[];i(e,function(e,r,n,i,o){e&&t.push({rev:r+"-"+n,pos:r,opts:o})}),t.sort(o).reverse();for(var r=0,n=t.length;r<n;r++)delete t[r].pos;return t}function a(e){for(var t,r=[],n=e.slice();t=n.pop();){var i=t.pos,o=t.ids,s=o[0],a=o[1],u=o[2],c=0===u.length,l=t.history?t.history.slice():[];l.push({id:s,opts:a}),c&&r.push({pos:i+1-l.length,ids:l});for(var f=0,p=u.length;f<p;f++)n.push({pos:i+1,ids:u[f],history:l})}return r.reverse()}function u(e,t){return e.pos-t.pos}function c(e,t,r){var n=function(e,t,r){for(var n,i=0,o=e.length;i<o;)r(e[n=i+o>>>1],t)<0?i=n+1:o=n;return i}(e,t,r);e.splice(n,0,t)}function l(e,t){for(var r,n,i=t,o=e.length;i<o;i++){var s=e[i],a=[s.id,s.opts,[]];n?(n[2].push(a),n=a):r=n=a}return r}function f(e,t){return e[0]<t[0]?-1:1}function p(e,t){for(var r=[{tree1:e,tree2:t}],n=!1;r.length>0;){var i=r.pop(),o=i.tree1,s=i.tree2;(o[1].status||s[1].status)&&(o[1].status="available"===o[1].status||"available"===s[1].status?"available":"missing");for(var a=0;a<s[2].length;a++)if(o[2][0]){for(var u=!1,l=0;l<o[2].length;l++)o[2][l][0]===s[2][a][0]&&(r.push({tree1:o[2][l],tree2:s[2][a]}),u=!0);u||(n="new_branch",c(o[2],s[2][a],f))}else n="new_leaf",o[2][0]=s[2][a]}return{conflicts:n,tree:e}}function h(e,t,r){var n,i=[],o=!1,s=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var a=0,c=e.length;a<c;a++){var l=e[a];if(l.pos===t.pos&&l.ids[0]===t.ids[0])n=p(l.ids,t.ids),i.push({pos:l.pos,ids:n.tree}),o=o||n.conflicts,s=!0;else if(!0!==r){var f=l.pos<t.pos?l:t,h=l.pos<t.pos?t:l,d=h.pos-f.pos,m=[],v=[];for(v.push({ids:f.ids,diff:d,parent:null,parentIdx:null});v.length>0;){var y=v.pop();if(0!==y.diff)for(var g=y.ids[2],b=0,_=g.length;b<_;b++)v.push({ids:g[b],diff:y.diff-1,parent:y.ids,parentIdx:b});else y.ids[0]===h.ids[0]&&m.push(y)}var x=m[0];x?(n=p(x.ids,h.ids),x.parent[2][x.parentIdx]=n.tree,i.push({pos:f.pos,ids:f.ids}),o=o||n.conflicts,s=!0):i.push(l)}else i.push(l)}return s||i.push(t),i.sort(u),{tree:i,conflicts:o||"internal_node"}}function d(e){return e.ids}Object.defineProperty(r,"__esModule",{value:!0}),r.collectConflicts=function(e){for(var t=n(e),r=s(e.rev_tree),i=[],o=0,a=r.length;o<a;o++){var u=r[o];u.rev===t||u.opts.deleted||i.push(u.rev)}return i},r.collectLeaves=s,r.compactTree=function(e){var t=[];return i(e.rev_tree,function(e,r,n,i,o){"available"!==o.status||e||(t.push(r+"-"+n),o.status="missing")}),t},r.isDeleted=function(e,t){t||(t=n(e));for(var r,i=t.substring(t.indexOf("-")+1),o=e.rev_tree.map(d);r=o.pop();){if(r[0]===i)return!!r[1].deleted;o=o.concat(r[2])}},r.isLocalId=function(e){return/^_local/.test(e)},r.merge=function(e,t,r){var n=h(e,t),o=function(e,t){for(var r,n,o=a(e),s=0,u=o.length;s<u;s++){var c,f=o[s],p=f.ids;if(p.length>t){r||(r={});var d=p.length-t;c={pos:f.pos+d,ids:l(p,d)};for(var m=0;m<d;m++){var v=f.pos+m+"-"+p[m].id;r[v]=!0}}else c={pos:f.pos,ids:l(p,0)};n=n?h(n,c,!0).tree:[c]}return r&&i(n,function(e,t,n){delete r[t+"-"+n]}),{tree:n,revs:r?Object.keys(r):[]}}(n.tree,r);return{tree:o.tree,stemmedRevs:o.revs,conflicts:n.conflicts}},r.revExists=function(e,t){for(var r,n=e.slice(),i=t.split("-"),o=parseInt(i[0],10),s=i[1];r=n.pop();){if(r.pos===o&&r.ids[0]===s)return!0;for(var a=r.ids[2],u=0,c=a.length;u<c;u++)n.push({pos:r.pos+1,ids:a[u]})}return!1},r.rootToLeaf=a,r.traverseRevTree=i,r.winningRev=n,r.latest=function(e,t){for(var r,n=t.rev_tree.slice();r=n.pop();){var i=r.pos,o=r.ids,s=o[0],a=o[1],u=o[2],c=0===u.length,l=r.history?r.history.slice():[];if(l.push({id:s,pos:i,opts:a}),c)for(var f=0,p=l.length;f<p;f++){var h=l[f];if(h.pos+"-"+h.id===e)return i+"-"+s}for(var d=0,m=u.length;d<m;d++)n.push({pos:i+1,ids:u[d],history:l})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}},{}],67:[function(e,t,r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function i(e){if(e instanceof ArrayBuffer)return function(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),r=new Uint8Array(t),n=new Uint8Array(e);return r.set(n),t}(e);var t=e.size,r=e.type;return"function"==typeof e.slice?e.slice(0,t,r):e.webkitSlice(0,t,r)}function o(e){var t,r,n;if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(t=[],r=0,n=e.length;r<n;r++)t[r]=o(e[r]);return t}if(e instanceof Date)return e.toISOString();if(function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer||"undefined"!=typeof Blob&&e instanceof Blob}(e))return i(e);if(!function(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var r=t.constructor;return"function"==typeof r&&r instanceof r&&A.call(r)==D}(e))return e;t={};for(r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var s=o(e[r]);void 0!==s&&(t[r]=s)}return t}function s(e){var t=!1;return b(function(r){if(t)throw new Error("once called more than once");t=!0,e.apply(this,r)})}function a(e){return b(function(t){var r=this,n="function"==typeof(t=o(t))[t.length-1]&&t.pop(),i=new g(function(n,i){var o;try{var a=s(function(e,t){e?i(e):n(t)});t.push(a),(o=e.apply(r,t))&&"function"==typeof o.then&&n(o)}catch(e){i(e)}});return n&&i.then(function(e){n(null,e)},n),i})}function u(e,t){for(var r={},n=0,i=t.length;n<i;n++){var o=t[n];o in e&&(r[o]=e[o])}return r}function c(e){return e}function l(e){return[{ok:e}]}function f(){return"undefined"!=typeof chrome&&void 0!==chrome.storage&&void 0!==chrome.storage.local}function p(){return y}function h(){x.EventEmitter.call(this),this._listeners={},function(e){f()?chrome.storage.onChanged.addListener(function(t){null!=t.db_name&&e.emit(t.dbName.newValue)}):p()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(t){e.emit(t.key)}):window.attachEvent("storage",function(t){e.emit(t.key)}))}(this)}function d(e){if("undefined"!==console&&e in console){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function m(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}function v(e,t,r){return new g(function(n,i){e.get(t,function(o,s){if(o){if(404!==o.status)return i(o);s={}}var a=s._rev,u=r(s);if(!u)return n({updated:!1,rev:a});u._id=t,u._rev=a,n(function(e,t,r){return e.put(t).then(function(e){return{updated:!0,rev:e.rev}},function(n){if(409!==n.status)throw n;return v(e,t._id,r)})}(e,u,r))})})}Object.defineProperty(r,"__esModule",{value:!0});var y,g=n(e("pouchdb-promise")),b=n(e("argsarray")),_=e("pouchdb-collections"),x=e("events"),w=n(e("inherits")),k=n(e("immediate")),E=e("pouchdb-errors"),S=n(e("uuid/v4")),A=Function.prototype.toString,D=A.call(Object),C=6;if(f())y=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),y=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){y=!1}w(h,x.EventEmitter),h.prototype.addListener=function(e,t,r,n){function i(){if(o._listeners[t])if(s)s="waiting";else{s=!0;var e=u(n,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);r.changes(e).on("change",function(e){e.seq>n.since&&!n.cancelled&&(n.since=e.seq,n.onChange(e))}).on("complete",function(){"waiting"===s&&k(i),s=!1}).on("error",function(){s=!1})}}if(!this._listeners[t]){var o=this,s=!1;this._listeners[t]=i,this.on(e,i)}},h.prototype.removeListener=function(e,t){t in this._listeners&&(x.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},h.prototype.notifyLocalWindows=function(e){f()?chrome.storage.local.set({dbName:e}):p()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},h.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var F="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},O=function(){}.name?function(e){return e.name}:function(e){return e.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]},j=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],R="queryKey",B=/(?:^|&)([^&=]*)=?([^&]*)/g,T=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,P=S;r.adapterFun=function(e,t){return a(b(function(r){if(this._closed)return g.reject(new Error("database is closed"));if(this._destroyed)return g.reject(new Error("database is destroyed"));var n=this;return function(e,t,r){if(e.constructor.listeners("debug").length){for(var n=["api",e.name,t],i=0;i<r.length-1;i++)n.push(r[i]);e.constructor.emit("debug",n);var o=r[r.length-1];r[r.length-1]=function(r,n){var i=["api",e.name,t];i=i.concat(r?["error",r]:["success",n]),e.constructor.emit("debug",i),o(r,n)}}}(n,e,r),this.taskqueue.isReady?t.apply(this,r):new g(function(t,i){n.taskqueue.addTask(function(o){o?i(o):t(n[e].apply(n,r))})})}))},r.assign=F,r.bulkGetShim=function(e,t,r){function n(){++f===a&&function(){var e=[];p.forEach(function(t){t.docs.forEach(function(r){e.push({id:t.id,docs:[r]})})}),r(null,{results:e})}()}function i(){if(!(d>=h.length)){var r=Math.min(d+C,h.length),o=h.slice(d,r);!function(r,o){r.forEach(function(r,a){var f=o+a,h=s.get(r),d=u(h[0],["atts_since","attachments"]);d.open_revs=h.map(function(e){return e.rev}),d.open_revs=d.open_revs.filter(c);var m=c;0===d.open_revs.length&&(delete d.open_revs,m=l),["revs","attachments","binary","ajax","latest"].forEach(function(e){e in t&&(d[e]=t[e])}),e.get(r,d,function(e,t){var o;o=e?[{error:e}]:m(t),function(e,t,r){p[e]={id:t,docs:r},n()}(f,r,o),i()})})}(o,d),d+=o.length}}var o=t.docs,s=new _.Map;o.forEach(function(e){s.has(e.id)?s.get(e.id).push(e):s.set(e.id,[e])});var a=s.size,f=0,p=new Array(a),h=[];s.forEach(function(e,t){h.push(t)});var d=0;i()},r.changesHandler=h,r.clone=o,r.defaultBackOff=function(e){var t=0;return e||(t=2e3),function(e,t){return e=parseInt(e,10)||0,(t=parseInt(t,10))!=t||t<=e?t=(e||1)<<1:t+=1,t>6e5&&(e=3e5,t=6e5),~~((t-e)*Math.random()+e)}(e,t)},r.explainError=function(e,t){d("info","The above "+e+" is totally normal. "+t)},r.filterChange=function(e){var t={},r=e.filter&&"function"==typeof e.filter;return t.query=e.query_params,function(n){n.doc||(n.doc={});var i=r&&function(e,t,r){try{return!e(t,r)}catch(e){var n="Filter function threw: "+e.toString();return E.createError(E.BAD_REQUEST,n)}}(e.filter,n.doc,t);if("object"==typeof i)return i;if(i)return!1;if(e.include_docs){if(!e.attachments)for(var o in n.doc._attachments)n.doc._attachments.hasOwnProperty(o)&&(n.doc._attachments[o].stub=!0)}else delete n.doc;return!0}},r.flatten=function(e){for(var t=[],r=0,n=e.length;r<n;r++)t=t.concat(e[r]);return t},r.functionName=O,r.guardedConsole=d,r.hasLocalStorage=p,r.invalidIdError=function(e){var t;if(e?"string"!=typeof e?t=E.createError(E.INVALID_ID):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=E.createError(E.RESERVED_ID)):t=E.createError(E.MISSING_ID),t)throw t},r.isChromeApp=f,r.isCordova=function(){return"undefined"!=typeof cordova||"undefined"!=typeof PhoneGap||"undefined"!=typeof phonegap},r.isRemote=function(e){return"boolean"==typeof e._remote?e._remote:"function"==typeof e.type&&(d("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===e.type())},r.listenerCount=function(e,t){return"listenerCount"in e?e.listenerCount(t):x.EventEmitter.listenerCount(e,t)},r.nextTick=k,r.normalizeDdocFunctionName=function(e){var t=m(e);return t?t.join("/"):null},r.once=s,r.parseDdocFunctionName=m,r.parseUri=function(e){for(var t=T.exec(e),r={},n=14;n--;){var i=j[n],o=t[n]||"",s=-1!==["user","password"].indexOf(i);r[i]=s?decodeURIComponent(o):o}return r[R]={},r[j[12]].replace(B,function(e,t,n){t&&(r[R][t]=n)}),r},r.pick=u,r.rev=function(){return S().replace(/-/g,"").toLowerCase()},r.scopeEval=function(e,t){var r=[],n=[];for(var i in t)t.hasOwnProperty(i)&&(r.push(i),n.push(t[i]));return r.push(e),Function.apply(null,r).apply(null,n)},r.toPromise=a,r.upsert=v,r.uuid=P},{argsarray:1,events:18,immediate:23,inherits:24,"pouchdb-collections":62,"pouchdb-errors":63,"pouchdb-promise":68,"uuid/v4":117}],68:[function(e,t,r){arguments[4][58][0].apply(r,arguments)},{dup:58,lie:40}],69:[function(e,t,r){(function(e){"use strict";function r(t,r,n,i){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var o,s,a=arguments.length;switch(a){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick(function(){t.call(null,r)});case 3:return e.nextTick(function(){t.call(null,r,n)});case 4:return e.nextTick(function(){t.call(null,r,n,i)});default:for(o=new Array(a-1),s=0;s<o.length;)o[s++]=arguments[s];return e.nextTick(function(){t.apply(null,o)})}}!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports=r:t.exports=e.nextTick}).call(this,e("_process"))},{_process:70}],70:[function(e,t,r){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function s(){m&&h&&(m=!1,h.length?d=h.concat(d):v=-1,d.length&&a())}function a(){if(!m){var e=o(s);m=!0;for(var t=d.length;t;){for(h=d,d=[];++v<t;)h&&h[v].run();v=-1,t=d.length}h=null,m=!1,function(e){if(f===clearTimeout)return clearTimeout(e);if((f===i||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}(e)}}function u(e,t){this.fun=e,this.array=t}function c(){}var l,f,p=t.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{f="function"==typeof clearTimeout?clearTimeout:i}catch(e){f=i}}();var h,d=[],m=!1,v=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new u(e,t)),1!==d.length||m||o(a)},u.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=c,p.addListener=c,p.once=c,p.off=c,p.removeListener=c,p.removeAllListeners=c,p.emit=c,p.prependListener=c,p.prependOnceListener=c,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],71:[function(e,t,r){arguments[4][17][0].apply(r,arguments)},{dup:17}],72:[function(e,t,r){(function(r){function n(e){if(!(this instanceof n))return new n(e);a.call(this,e),u.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",i)}function i(){this.allowHalfOpen||this._writableState.ended||r.nextTick(this.end.bind(this))}t.exports=n;var o=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t},s=e("core-util-is");s.inherits=e("inherits");var a=e("./_stream_readable"),u=e("./_stream_writable");s.inherits(n,a),function(e,t){for(var r=0,n=e.length;r<n;r++)t(e[r],r)}(o(u.prototype),function(e){n.prototype[e]||(n.prototype[e]=u.prototype[e])})}).call(this,e("_process"))},{"./_stream_readable":74,"./_stream_writable":76,_process:70,"core-util-is":6,inherits:24}],73:[function(e,t,r){function n(e){if(!(this instanceof n))return new n(e);i.call(this,e)}t.exports=n;var i=e("./_stream_transform"),o=e("core-util-is");o.inherits=e("inherits"),o.inherits(n,i),n.prototype._transform=function(e,t,r){r(null,e)}},{"./_stream_transform":75,"core-util-is":6,inherits:24}],74:[function(e,t,r){(function(r){function n(t,r){var n=(t=t||{}).highWaterMark;this.highWaterMark=n||0===n?n:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!t.objectMode,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(_||(_=e("string_decoder/").StringDecoder),this.decoder=new _(t.encoding),this.encoding=t.encoding)}function i(e){if(!(this instanceof i))return new i(e);this._readableState=new n(e,this),this.readable=!0,g.call(this)}function o(e,t,n,i,o){var s=function(e,t){var r=null;v.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));return r}(t,n);if(s)e.emit("error",s);else if(null===n||void 0===n)t.reading=!1,t.ended||function(e,t){if(t.decoder&&!t.ended){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.length>0?a(e):h(e)}(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!o){var u=new Error("stream.push() after EOF");e.emit("error",u)}else if(t.endEmitted&&o){u=new Error("stream.unshift() after end event");e.emit("error",u)}else!t.decoder||o||i||(n=t.decoder.write(n)),t.length+=t.objectMode?1:n.length,o?t.buffer.unshift(n):(t.reading=!1,t.buffer.push(n)),t.needReadable&&a(e),function(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(function(){!function(e,t){var r=t.length;for(;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}(e,t)}))}(e,t);else o||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}function s(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:null===e||isNaN(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:e<=0?0:(e>t.highWaterMark&&(t.highWaterMark=function(e){if(e>=x)e=x;else{e--;for(var t=1;t<32;t<<=1)e|=e>>t;e++}return e}(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function a(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,t.sync?r.nextTick(function(){u(e)}):u(e))}function u(e){e.emit("readable")}function c(e){function t(e,t,i){!1===e.write(r)&&n.awaitDrain++}var r,n=e._readableState;for(n.awaitDrain=0;n.pipesCount&&null!==(r=e.read());)if(1===n.pipesCount?t(n.pipes):d(n.pipes,t),e.emit("data",r),n.awaitDrain>0)return;if(0===n.pipesCount)return n.flowing=!1,void(y.listenerCount(e,"data")>0&&f(e));n.ranOut=!0}function l(){this._readableState.ranOut&&(this._readableState.ranOut=!1,c(this))}function f(e,t){if(e._readableState.flowing)throw new Error("Cannot switch to old mode now.");var n=t||!1,i=!1;e.readable=!0,e.pipe=g.prototype.pipe,e.on=e.addListener=g.prototype.on,e.on("readable",function(){i=!0;for(var t;!n&&null!==(t=e.read());)e.emit("data",t);null===t&&(i=!1,e._readableState.needReadable=!0)}),e.pause=function(){n=!0,this.emit("pause")},e.resume=function(){n=!1,i?r.nextTick(function(){e.emit("readable")}):this.read(0),this.emit("resume")},e.emit("readable")}function p(e,t){var r,n=t.buffer,i=t.length,o=!!t.decoder,s=!!t.objectMode;if(0===n.length)return null;if(0===i)r=null;else if(s)r=n.shift();else if(!e||e>=i)r=o?n.join(""):v.concat(n,i),n.length=0;else if(e<n[0].length){r=(l=n[0]).slice(0,e),n[0]=l.slice(e)}else if(e===n[0].length)r=n.shift();else{r=o?"":new v(e);for(var a=0,u=0,c=n.length;u<c&&a<e;u++){var l=n[0],f=Math.min(e-a,l.length);o?r+=l.slice(0,f):l.copy(r,a,0,f),f<l.length?n[0]=l.slice(f):n.shift(),a+=f}}return r}function h(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");!t.endEmitted&&t.calledRead&&(t.ended=!0,r.nextTick(function(){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}))}function d(e,t){for(var r=0,n=e.length;r<n;r++)t(e[r],r)}t.exports=i;var m=e("isarray"),v=e("buffer").Buffer;i.ReadableState=n;var y=e("events").EventEmitter;y.listenerCount||(y.listenerCount=function(e,t){return e.listeners(t).length});var g=e("stream"),b=e("core-util-is");b.inherits=e("inherits");var _;b.inherits(i,g),i.prototype.push=function(e,t){var r=this._readableState;return"string"!=typeof e||r.objectMode||(t=t||r.defaultEncoding)!==r.encoding&&(e=new v(e,t),t=""),o(this,r,e,t,!1)},i.prototype.unshift=function(e){return o(this,this._readableState,e,"",!0)},i.prototype.setEncoding=function(t){_||(_=e("string_decoder/").StringDecoder),this._readableState.decoder=new _(t),this._readableState.encoding=t};var x=8388608;i.prototype.read=function(e){var t=this._readableState;t.calledRead=!0;var r,n=e;if(("number"!=typeof e||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return a(this),null;if(0===(e=s(e,t))&&t.ended)return r=null,t.length>0&&t.decoder&&(r=p(e,t),t.length-=r.length),0===t.length&&h(this),r;var i=t.needReadable;return t.length-e<=t.highWaterMark&&(i=!0),(t.ended||t.reading)&&(i=!1),i&&(t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),i&&!t.reading&&(e=s(n,t)),null===(r=e>0?p(e,t):null)&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),t.ended&&!t.endEmitted&&0===t.length&&h(this),r},i.prototype._read=function(e){this.emit("error",new Error("not implemented"))},i.prototype.pipe=function(e,t){function n(e){e===p&&o()}function i(){e.end()}function o(){e.removeListener("close",a),e.removeListener("finish",u),e.removeListener("drain",v),e.removeListener("error",s),e.removeListener("unpipe",n),p.removeListener("end",i),p.removeListener("end",o),e._writableState&&!e._writableState.needDrain||v()}function s(t){f(),e.removeListener("error",s),0===y.listenerCount(e,"error")&&e.emit("error",t)}function a(){e.removeListener("finish",u),f()}function u(){e.removeListener("close",a),f()}function f(){p.unpipe(e)}var p=this,h=this._readableState;switch(h.pipesCount){case 0:h.pipes=e;break;case 1:h.pipes=[h.pipes,e];break;default:h.pipes.push(e)}h.pipesCount+=1;var d=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?i:o;h.endEmitted?r.nextTick(d):p.once("end",d),e.on("unpipe",n);var v=function(e){return function(){var t=e._readableState;t.awaitDrain--,0===t.awaitDrain&&c(e)}}(p);return e.on("drain",v),e._events&&e._events.error?m(e._events.error)?e._events.error.unshift(s):e._events.error=[s,e._events.error]:e.on("error",s),e.once("close",a),e.once("finish",u),e.emit("pipe",p),h.flowing||(this.on("readable",l),h.flowing=!0,r.nextTick(function(){c(p)})),e},i.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,this.removeListener("readable",l),t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var r=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,this.removeListener("readable",l),t.flowing=!1;for(var i=0;i<n;i++)r[i].emit("unpipe",this);return this}return-1===(i=function(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}(t.pipes,e))?this:(t.pipes.splice(i,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},i.prototype.on=function(e,t){var r=g.prototype.on.call(this,e,t);if("data"!==e||this._readableState.flowing||f(this),"readable"===e&&this.readable){var n=this._readableState;n.readableListening||(n.readableListening=!0,n.emittedReadable=!1,n.needReadable=!0,n.reading?n.length&&a(this):this.read(0))}return r},i.prototype.addListener=i.prototype.on,i.prototype.resume=function(){f(this),this.read(0),this.emit("resume")},i.prototype.pause=function(){f(this,!0),this.emit("pause")},i.prototype.wrap=function(e){var t=this._readableState,r=!1,n=this;e.on("end",function(){if(t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&n.push(e)}n.push(null)}),e.on("data",function(i){if(t.decoder&&(i=t.decoder.write(i)),(!t.objectMode||null!==i&&void 0!==i)&&(t.objectMode||i&&i.length)){n.push(i)||(r=!0,e.pause())}});for(var i in e)"function"==typeof e[i]&&void 0===this[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));return d(["error","close","destroy","pause","resume"],function(t){e.on(t,n.emit.bind(n,t))}),n._read=function(t){r&&(r=!1,e.resume())},n},i._fromList=p}).call(this,e("_process"))},{_process:70,buffer:5,"core-util-is":6,events:18,inherits:24,isarray:77,stream:81,"string_decoder/":96}],75:[function(e,t,r){function n(e,t){this.afterTransform=function(e,r){return function(e,t,r){var n=e._transformState;n.transforming=!1;var i=n.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));n.writechunk=null,n.writecb=null,null!==r&&void 0!==r&&e.push(r);i&&i(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}(t,e,r)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function i(e){if(!(this instanceof i))return new i(e);s.call(this,e);this._transformState=new n(e,this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",function(){"function"==typeof this._flush?this._flush(function(e){o(t,e)}):o(t)})}function o(e,t){if(t)return e.emit("error",t);var r=e._writableState,n=(e._readableState,e._transformState);if(r.length)throw new Error("calling transform done when ws.length != 0");if(n.transforming)throw new Error("calling transform done when still transforming");return e.push(null)}t.exports=i;var s=e("./_stream_duplex"),a=e("core-util-is");a.inherits=e("inherits"),a.inherits(i,s),i.prototype.push=function(e,t){return this._transformState.needTransform=!1,s.prototype.push.call(this,e,t)},i.prototype._transform=function(e,t,r){throw new Error("not implemented")},i.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},i.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},{"./_stream_duplex":72,"core-util-is":6,inherits:24}],76:[function(e,t,r){(function(r){function n(e,t){var n=(e=e||{}).highWaterMark;this.highWaterMark=n||0===n?n:16384,this.objectMode=!!e.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var i=!1===e.decodeStrings;this.decodeStrings=!i,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,i=n.sync,o=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,i,o){n?r.nextTick(function(){o(i)}):o(i);e._writableState.errorEmitted=!0,e.emit("error",i)}(e,0,i,t,o);else{var c=u(e,n);c||n.bufferProcessing||!n.buffer.length||function(e,t){t.bufferProcessing=!0;for(var r=0;r<t.buffer.length;r++){var n=t.buffer[r],i=n.chunk,o=n.encoding,a=n.callback,u=t.objectMode?1:i.length;if(s(e,t,u,i,o,a),t.writing){r++;break}}t.bufferProcessing=!1,r<t.buffer.length?t.buffer=t.buffer.slice(r):t.buffer.length=0}(e,n),i?r.nextTick(function(){a(e,n,c,o)}):a(e,n,c,o)}}(t,e)},this.writecb=null,this.writelen=0,this.buffer=[],this.errorEmitted=!1}function i(t){var r=e("./_stream_duplex");if(!(this instanceof i||this instanceof r))return new i(t);this._writableState=new n(t,this),this.writable=!0,p.call(this)}function o(e,t,r,n,i){r=function(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=new l(t,r)),t}(t,r,n),l.isBuffer(r)&&(n="buffer");var o=t.objectMode?1:r.length;t.length+=o;var a=t.length<t.highWaterMark;return a||(t.needDrain=!0),t.writing?t.buffer.push(new function(e,t,r){this.chunk=e,this.encoding=t,this.callback=r}(r,n,i)):s(e,t,o,r,n,i),a}function s(e,t,r,n,i,o){t.writelen=r,t.writecb=o,t.writing=!0,t.sync=!0,e._write(n,i,t.onwrite),t.sync=!1}function a(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),n(),r&&c(e,t)}function u(e,t){return t.ending&&0===t.length&&!t.finished&&!t.writing}function c(e,t){var r=u(0,t);return r&&(t.finished=!0,e.emit("finish")),r}t.exports=i;var l=e("buffer").Buffer;i.WritableState=n;var f=e("core-util-is");f.inherits=e("inherits");var p=e("stream");f.inherits(i,p),i.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},i.prototype.write=function(e,t,n){var i=this._writableState,s=!1;return"function"==typeof t&&(n=t,t=null),l.isBuffer(e)?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=function(){}),i.ended?function(e,t,n){var i=new Error("write after end");e.emit("error",i),r.nextTick(function(){n(i)})}(this,0,n):function(e,t,n,i){var o=!0;if(!l.isBuffer(n)&&"string"!=typeof n&&null!==n&&void 0!==n&&!t.objectMode){var s=new TypeError("Invalid non-string/buffer chunk");e.emit("error",s),r.nextTick(function(){i(s)}),o=!1}return o}(this,i,e,n)&&(s=o(this,i,e,t,n)),s},i.prototype._write=function(e,t,r){r(new Error("not implemented"))},i.prototype.end=function(e,t,n){var i=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),void 0!==e&&null!==e&&this.write(e,t),i.ending||i.finished||function(e,t,n){t.ending=!0,c(e,t),n&&(t.finished?r.nextTick(n):e.once("finish",n)),t.ended=!0}(this,i,n)}}).call(this,e("_process"))},{"./_stream_duplex":72,_process:70,buffer:5,"core-util-is":6,inherits:24,stream:81}],77:[function(e,t,r){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],78:[function(e,t,r){var n=e("stream");(r=t.exports=e("./lib/_stream_readable.js")).Stream=n,r.Readable=r,r.Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":72,"./lib/_stream_passthrough.js":73,"./lib/_stream_readable.js":74,"./lib/_stream_transform.js":75,"./lib/_stream_writable.js":76,stream:81}],79:[function(e,t,r){function n(e,t){for(var r in e)t[r]=e[r]}function i(e,t,r){return s(e,t,r)}var o=e("buffer"),s=o.Buffer;s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?t.exports=o:(n(o,r),r.Buffer=i),n(s,i),i.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return s(e,t,r)},i.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=s(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},i.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return s(e)},i.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return o.SlowBuffer(e)}},{buffer:5}],80:[function(e,t,r){!function(e){if("object"==typeof r)t.exports=e();else{var n;try{n=window}catch(e){n=self}n.SparkMD5=e()}}(function(e){"use strict";function t(e,t){var r=e[0],n=e[1],i=e[2],o=e[3];n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&i)+t[1]-389564586|0)<<12|o>>>20)+r|0)&r|~o&n)+t[2]+606105819|0)<<17|i>>>15)+o|0)&o|~i&r)+t[3]-1044525330|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&i)+t[5]+1200080426|0)<<12|o>>>20)+r|0)&r|~o&n)+t[6]-1473231341|0)<<17|i>>>15)+o|0)&o|~i&r)+t[7]-45705983|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&i)+t[9]-1958414417|0)<<12|o>>>20)+r|0)&r|~o&n)+t[10]-42063|0)<<17|i>>>15)+o|0)&o|~i&r)+t[11]-1990404162|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&i)+t[13]-40341101|0)<<12|o>>>20)+r|0)&r|~o&n)+t[14]-1502002290|0)<<17|i>>>15)+o|0)&o|~i&r)+t[15]+1236535329|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[1]-165796510|0)<<5|r>>>27)+n|0)&i|n&~i)+t[6]-1069501632|0)<<9|o>>>23)+r|0)&n|r&~n)+t[11]+643717713|0)<<14|i>>>18)+o|0)&r|o&~r)+t[0]-373897302|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[5]-701558691|0)<<5|r>>>27)+n|0)&i|n&~i)+t[10]+38016083|0)<<9|o>>>23)+r|0)&n|r&~n)+t[15]-660478335|0)<<14|i>>>18)+o|0)&r|o&~r)+t[4]-405537848|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[9]+568446438|0)<<5|r>>>27)+n|0)&i|n&~i)+t[14]-1019803690|0)<<9|o>>>23)+r|0)&n|r&~n)+t[3]-187363961|0)<<14|i>>>18)+o|0)&r|o&~r)+t[8]+1163531501|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[13]-1444681467|0)<<5|r>>>27)+n|0)&i|n&~i)+t[2]-51403784|0)<<9|o>>>23)+r|0)&n|r&~n)+t[7]+1735328473|0)<<14|i>>>18)+o|0)&r|o&~r)+t[12]-1926607734|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[5]-378558|0)<<4|r>>>28)+n|0)^n^i)+t[8]-2022574463|0)<<11|o>>>21)+r|0)^r^n)+t[11]+1839030562|0)<<16|i>>>16)+o|0)^o^r)+t[14]-35309556|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[1]-1530992060|0)<<4|r>>>28)+n|0)^n^i)+t[4]+1272893353|0)<<11|o>>>21)+r|0)^r^n)+t[7]-155497632|0)<<16|i>>>16)+o|0)^o^r)+t[10]-1094730640|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[13]+681279174|0)<<4|r>>>28)+n|0)^n^i)+t[0]-358537222|0)<<11|o>>>21)+r|0)^r^n)+t[3]-722521979|0)<<16|i>>>16)+o|0)^o^r)+t[6]+76029189|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[9]-640364487|0)<<4|r>>>28)+n|0)^n^i)+t[12]-421815835|0)<<11|o>>>21)+r|0)^r^n)+t[15]+530742520|0)<<16|i>>>16)+o|0)^o^r)+t[2]-995338651|0)<<23|n>>>9)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[0]-198630844|0)<<6|r>>>26)+n|0)|~i))+t[7]+1126891415|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[14]-1416354905|0)<<15|i>>>17)+o|0)|~r))+t[5]-57434055|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[12]+1700485571|0)<<6|r>>>26)+n|0)|~i))+t[3]-1894986606|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[10]-1051523|0)<<15|i>>>17)+o|0)|~r))+t[1]-2054922799|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[8]+1873313359|0)<<6|r>>>26)+n|0)|~i))+t[15]-30611744|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[6]-1560198380|0)<<15|i>>>17)+o|0)|~r))+t[13]+1309151649|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[4]-145523070|0)<<6|r>>>26)+n|0)|~i))+t[11]-1120210379|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[2]+718787259|0)<<15|i>>>17)+o|0)|~r))+t[9]-343485551|0)<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0}function r(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function n(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function i(e){var n,i,o,s,a,u,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=c;n+=64)t(l,r(e.substring(n-64,n)));for(i=(e=e.substring(n-64)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<i;n+=1)o[n>>2]|=e.charCodeAt(n)<<(n%4<<3);if(o[n>>2]|=128<<(n%4<<3),n>55)for(t(l,o),n=0;n<16;n+=1)o[n]=0;return s=8*c,s=s.toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),u=parseInt(s[1],16)||0,o[14]=a,o[15]=u,t(l,o),l}function o(e){var t,r="";for(t=0;t<4;t+=1)r+=l[e>>8*t+4&15]+l[e>>8*t&15];return r}function s(e){var t;for(t=0;t<e.length;t+=1)e[t]=o(e[t]);return e.join("")}function a(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function u(e){var t,r=[],n=e.length;for(t=0;t<n-1;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function c(){this.reset()}var l=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==s(i("hello"))&&function(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r},"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,n){var i,o,s,a,u=this.byteLength,c=t(r,u),l=u;return n!==e&&(l=t(n,u)),c>l?new ArrayBuffer(0):(i=l-c,o=new ArrayBuffer(i),s=new Uint8Array(o),a=new Uint8Array(this,c,i),s.set(a),o)}}(),c.prototype.append=function(e){return this.appendBinary(a(e)),this},c.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var n,i=this._buff.length;for(n=64;n<=i;n+=64)t(this._hash,r(this._buff.substring(n-64,n)));return this._buff=this._buff.substring(n-64),this},c.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(o,i),r=s(this._hash),e&&(r=u(r)),this.reset(),r},c.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},c.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},c.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},c.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},c.prototype._finish=function(e,r){var n,i,o,s=r;if(e[s>>2]|=128<<(s%4<<3),s>55)for(t(this._hash,e),s=0;s<16;s+=1)e[s]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),o=parseInt(n[1],16)||0,e[14]=i,e[15]=o,t(this._hash,e)},c.hash=function(e,t){return c.hashBinary(a(e),t)},c.hashBinary=function(e,t){var r=s(i(e));return t?u(r):r},c.ArrayBuffer=function(){this.reset()},c.ArrayBuffer.prototype.append=function(e){var r,i=function(e,t,r){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e)),n.set(new Uint8Array(t),e.byteLength),r?n:n.buffer}(this._buff.buffer,e,!0),o=i.length;for(this._length+=e.byteLength,r=64;r<=o;r+=64)t(this._hash,n(i.subarray(r-64,r)));return this._buff=r-64<o?new Uint8Array(i.buffer.slice(r-64)):new Uint8Array(0),this},c.ArrayBuffer.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n[t]<<(t%4<<3);return this._finish(o,i),r=s(this._hash),e&&(r=u(r)),this.reset(),r},c.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},c.ArrayBuffer.prototype.getState=function(){var e=c.prototype.getState.call(this);return e.buff=function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}(e.buff),e},c.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var r,n=e.length,i=new ArrayBuffer(n),o=new Uint8Array(i);for(r=0;r<n;r+=1)o[r]=e.charCodeAt(r);return t?o:i}(e.buff,!0),c.prototype.setState.call(this,e)},c.ArrayBuffer.prototype.destroy=c.prototype.destroy,c.ArrayBuffer.prototype._finish=c.prototype._finish,c.ArrayBuffer.hash=function(e,r){var i=s(function(e){var r,i,o,s,a,u,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(r=64;r<=c;r+=64)t(l,n(e.subarray(r-64,r)));for(i=(e=r-64<c?e.subarray(r-64):new Uint8Array(0)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<i;r+=1)o[r>>2]|=e[r]<<(r%4<<3);if(o[r>>2]|=128<<(r%4<<3),r>55)for(t(l,o),r=0;r<16;r+=1)o[r]=0;return s=8*c,s=s.toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),u=parseInt(s[1],16)||0,o[14]=a,o[15]=u,t(l,o),l}(new Uint8Array(e)));return r?u(i):i},c})},{}],81:[function(e,t,r){function n(){i.call(this)}t.exports=n;var i=e("events").EventEmitter;e("inherits")(n,i),n.Readable=e("readable-stream/readable.js"),n.Writable=e("readable-stream/writable.js"),n.Duplex=e("readable-stream/duplex.js"),n.Transform=e("readable-stream/transform.js"),n.PassThrough=e("readable-stream/passthrough.js"),n.Stream=n,n.prototype.pipe=function(e,t){function r(t){e.writable&&!1===e.write(t)&&c.pause&&c.pause()}function n(){c.readable&&c.resume&&c.resume()}function o(){l||(l=!0,e.end())}function s(){l||(l=!0,"function"==typeof e.destroy&&e.destroy())}function a(e){if(u(),0===i.listenerCount(this,"error"))throw e}function u(){c.removeListener("data",r),e.removeListener("drain",n),c.removeListener("end",o),c.removeListener("close",s),c.removeListener("error",a),e.removeListener("error",a),c.removeListener("end",u),c.removeListener("close",u),e.removeListener("close",u)}var c=this;c.on("data",r),e.on("drain",n),e._isStdio||t&&!1===t.end||(c.on("end",o),c.on("close",s));var l=!1;return c.on("error",a),e.on("error",a),c.on("end",u),c.on("close",u),e.on("close",u),e.emit("pipe",c),e}},{events:18,inherits:24,"readable-stream/duplex.js":82,"readable-stream/passthrough.js":91,"readable-stream/readable.js":92,"readable-stream/transform.js":93,"readable-stream/writable.js":94}],82:[function(e,t,r){t.exports=e("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":83}],83:[function(e,t,r){"use strict";function n(e){if(!(this instanceof n))return new n(e);c.call(this,e),l.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",i)}function i(){this.allowHalfOpen||this._writableState.ended||s(o,this)}function o(e){e.end()}var s=e("process-nextick-args"),a=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};t.exports=n;var u=e("core-util-is");u.inherits=e("inherits");var c=e("./_stream_readable"),l=e("./_stream_writable");u.inherits(n,c);for(var f=a(l.prototype),p=0;p<f.length;p++){var h=f[p];n.prototype[h]||(n.prototype[h]=l.prototype[h])}Object.defineProperty(n.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),n.prototype._destroy=function(e,t){this.push(null),this.end(),s(t,e)}},{"./_stream_readable":85,"./_stream_writable":87,"core-util-is":6,inherits:24,"process-nextick-args":69}],84:[function(e,t,r){"use strict";function n(e){if(!(this instanceof n))return new n(e);i.call(this,e)}t.exports=n;var i=e("./_stream_transform"),o=e("core-util-is");o.inherits=e("inherits"),o.inherits(n,i),n.prototype._transform=function(e,t,r){r(null,e)}},{"./_stream_transform":86,"core-util-is":6,inherits:24}],85:[function(e,t,r){(function(r,n){"use strict";function i(t,r){x=x||e("./_stream_duplex"),t=t||{},this.objectMode=!!t.objectMode,r instanceof x&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var n=t.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:i,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new j,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(O||(O=e("string_decoder/").StringDecoder),this.decoder=new O(t.encoding),this.encoding=t.encoding)}function o(t){if(x=x||e("./_stream_duplex"),!(this instanceof o))return new o(t);this._readableState=new i(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),E.call(this)}function s(e,t,r,n,i){var o=e._readableState;if(null===t)o.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,c(e)}(e,o);else{var s;i||(s=function(e,t){var r;(function(e){return S.isBuffer(e)||e instanceof A})(t)||"string"==typeof t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));return r}(o,t)),s?e.emit("error",s):o.objectMode||t&&t.length>0?("string"==typeof t||o.objectMode||Object.getPrototypeOf(t)===S.prototype||(t=function(e){return S.from(e)}(t)),n?o.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):a(e,o,t,!0):o.ended?e.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!r?(t=o.decoder.write(t),o.objectMode||0!==t.length?a(e,o,t,!1):f(e,o)):a(e,o,t,!1))):n||(o.reading=!1)}return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(o)}function a(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&c(e)),f(e,t)}function u(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=T?e=T:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function c(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(F("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?_(l,e):l(e))}function l(e){F("emit readable"),e.emit("readable"),m(e)}function f(e,t){t.readingMore||(t.readingMore=!0,_(p,e,t))}function p(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(F("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function h(e){F("readable nexttick read 0"),e.read(0)}function d(e,t){t.reading||(F("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),m(e),t.flowing&&!t.reading&&e.read(0)}function m(e){var t=e._readableState;for(F("flow",t.flowing);t.flowing&&null!==e.read(););}function v(e,t){if(0===t.length)return null;var r;return t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var n;e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?function(e,t){var r=t.head,n=1,i=r.data;e-=i.length;for(;r=r.next;){var o=r.data,s=e>o.length?o.length:e;if(s===o.length?i+=o:i+=o.slice(0,e),0===(e-=s)){s===o.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(s));break}++n}return t.length-=n,i}(e,t):function(e,t){var r=S.allocUnsafe(e),n=t.head,i=1;n.data.copy(r),e-=n.data.length;for(;n=n.next;){var o=n.data,s=e>o.length?o.length:e;if(o.copy(r,r.length-e,0,s),0===(e-=s)){s===o.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(s));break}++i}return t.length-=i,r}(e,t);return n}(e,t.buffer,t.decoder),r}function y(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,_(g,t,e))}function g(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function b(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}var _=e("process-nextick-args");t.exports=o;var x,w=e("isarray");o.ReadableState=i;e("events").EventEmitter;var k=function(e,t){return e.listeners(t).length},E=e("./internal/streams/stream"),S=e("safe-buffer").Buffer,A=n.Uint8Array||function(){},D=e("core-util-is");D.inherits=e("inherits");var C=e("util"),F=void 0;F=C&&C.debuglog?C.debuglog("stream"):function(){};var O,j=e("./internal/streams/BufferList"),R=e("./internal/streams/destroy");D.inherits(o,E);var B=["error","close","destroy","pause","resume"];Object.defineProperty(o.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),o.prototype.destroy=R.destroy,o.prototype._undestroy=R.undestroy,o.prototype._destroy=function(e,t){this.push(null),t(e)},o.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=S.from(e,t),t=""),r=!0),s(this,e,t,!1,r)},o.prototype.unshift=function(e){return s(this,e,null,!0,!1)},o.prototype.isPaused=function(){return!1===this._readableState.flowing},o.prototype.setEncoding=function(t){return O||(O=e("string_decoder/").StringDecoder),this._readableState.decoder=new O(t),this._readableState.encoding=t,this};var T=8388608;o.prototype.read=function(e){F("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return F("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?y(this):c(this),null;if(0===(e=u(e,t))&&t.ended)return 0===t.length&&y(this),null;var n=t.needReadable;F("need readable",n),(0===t.length||t.length-e<t.highWaterMark)&&F("length less than watermark",n=!0),t.ended||t.reading?F("reading or ended",n=!1):n&&(F("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=u(r,t)));var i;return null===(i=e>0?v(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&y(this)),null!==i&&this.emit("data",i),i},o.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},o.prototype.pipe=function(e,t){function n(t,r){F("onunpipe"),t===l&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,F("cleanup"),e.removeListener("close",a),e.removeListener("finish",u),e.removeListener("drain",h),e.removeListener("error",s),e.removeListener("unpipe",n),l.removeListener("end",i),l.removeListener("end",c),l.removeListener("data",o),d=!0,!f.awaitDrain||e._writableState&&!e._writableState.needDrain||h())}function i(){F("onend"),e.end()}function o(t){F("ondata"),v=!1;!1!==e.write(t)||v||((1===f.pipesCount&&f.pipes===e||f.pipesCount>1&&-1!==b(f.pipes,e))&&!d&&(F("false write response, pause",l._readableState.awaitDrain),l._readableState.awaitDrain++,v=!0),l.pause())}function s(t){F("onerror",t),c(),e.removeListener("error",s),0===k(e,"error")&&e.emit("error",t)}function a(){e.removeListener("finish",u),c()}function u(){F("onfinish"),e.removeListener("close",a),c()}function c(){F("unpipe"),l.unpipe(e)}var l=this,f=this._readableState;switch(f.pipesCount){case 0:f.pipes=e;break;case 1:f.pipes=[f.pipes,e];break;default:f.pipes.push(e)}f.pipesCount+=1,F("pipe count=%d opts=%j",f.pipesCount,t);var p=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?i:c;f.endEmitted?_(p):l.once("end",p),e.on("unpipe",n);var h=function(e){return function(){var t=e._readableState;F("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&k(e,"data")&&(t.flowing=!0,m(e))}}(l);e.on("drain",h);var d=!1,v=!1;return l.on("data",o),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?w(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",s),e.once("close",a),e.once("finish",u),e.emit("pipe",l),f.flowing||(F("pipe resume"),l.resume()),e},o.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r),this);if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,r);return this}var s=b(t.pipes,e);return-1===s?this:(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r),this)},o.prototype.on=function(e,t){var r=E.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&c(this):_(h,this))}return r},o.prototype.addListener=o.prototype.on,o.prototype.resume=function(){var e=this._readableState;return e.flowing||(F("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,_(d,e,t))}(this,e)),this},o.prototype.pause=function(){return F("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(F("pause"),this._readableState.flowing=!1,this.emit("pause")),this},o.prototype.wrap=function(e){var t=this._readableState,r=!1,n=this;e.on("end",function(){if(F("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&n.push(e)}n.push(null)}),e.on("data",function(i){if(F("wrapped data"),t.decoder&&(i=t.decoder.write(i)),(!t.objectMode||null!==i&&void 0!==i)&&(t.objectMode||i&&i.length)){n.push(i)||(r=!0,e.pause())}});for(var i in e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<B.length;o++)e.on(B[o],n.emit.bind(n,B[o]));return n._read=function(t){F("wrapped _read",t),r&&(r=!1,e.resume())},n},o._fromList=v}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":83,"./internal/streams/BufferList":88,"./internal/streams/destroy":89,"./internal/streams/stream":90,_process:70,"core-util-is":6,events:18,inherits:24,isarray:30,"process-nextick-args":69,"safe-buffer":79,"string_decoder/":95,util:3}],86:[function(e,t,r){"use strict";function n(e){this.afterTransform=function(t,r){return function(e,t,r){var n=e._transformState;n.transforming=!1;var i=n.writecb;if(!i)return e.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!==r&&void 0!==r&&e.push(r);i(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}(e,t,r)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function i(e){if(!(this instanceof i))return new i(e);s.call(this,e),this._transformState=new n(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(e,r){o(t,e,r)}):o(t)})}function o(e,t,r){if(t)return e.emit("error",t);null!==r&&void 0!==r&&e.push(r);var n=e._writableState,i=e._transformState;if(n.length)throw new Error("Calling transform done when ws.length != 0");if(i.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}t.exports=i;var s=e("./_stream_duplex"),a=e("core-util-is");a.inherits=e("inherits"),a.inherits(i,s),i.prototype.push=function(e,t){return this._transformState.needTransform=!1,s.prototype.push.call(this,e,t)},i.prototype._transform=function(e,t,r){throw new Error("_transform() is not implemented")},i.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},i.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},i.prototype._destroy=function(e,t){var r=this;s.prototype._destroy.call(this,e,function(e){t(e),r.emit("close")})}},{"./_stream_duplex":83,"core-util-is":6,inherits:24}],87:[function(e,t,r){(function(r,n){"use strict";function i(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}function o(){}function s(t,r){v=v||e("./_stream_duplex"),t=t||{},this.objectMode=!!t.objectMode,r instanceof v&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var n=t.highWaterMark,o=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:o,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var s=!1===t.decodeStrings;this.decodeStrings=!s,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,n,i){--t.pendingcb,r?(m(i,n),m(d,e,t),e._writableState.errorEmitted=!0,e.emit("error",n)):(i(n),e._writableState.errorEmitted=!0,e.emit("error",n),d(e,t))}(e,r,n,t,i);else{var o=p(r);o||r.corked||r.bufferProcessing||!r.bufferedRequest||f(e,r),n?y(l,e,r,o,i):l(e,r,o,i)}}(r,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new i(this)}function a(t){if(v=v||e("./_stream_duplex"),!(E.call(a,this)||this instanceof v))return new a(t);this._writableState=new s(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),_.call(this)}function u(e,t,r,n,i,o){if(!r){var s=function(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=x.from(t,r)),t}(t,n,i);n!==s&&(r=!0,i="buffer",n=s)}var a=t.objectMode?1:n.length;t.length+=a;var u=t.length<t.highWaterMark;if(u||(t.needDrain=!0),t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else c(e,t,!1,a,n,i,o);return u}function c(e,t,r,n,i,o,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function l(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),d(e,t)}function f(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,o=new Array(n),s=t.corkedRequestsFree;s.entry=r;for(var a=0,u=!0;r;)o[a]=r,r.isBuf||(u=!1),r=r.next,a+=1;o.allBuffers=u,c(e,t,!0,t.length,o,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new i(t)}else{for(;r;){var l=r.chunk,f=r.encoding,p=r.callback;if(c(e,t,!1,t.objectMode?1:l.length,l,f,p),r=r.next,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=r,t.bufferProcessing=!1}function p(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function h(e,t){e._final(function(r){t.pendingcb--,r&&e.emit("error",r),t.prefinished=!0,e.emit("prefinish"),d(e,t)})}function d(e,t){var r=p(t);return r&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,m(h,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),r}var m=e("process-nextick-args");t.exports=a;var v,y=!r.browser&&["v0.10","v0.9."].indexOf(r.version.slice(0,5))>-1?setImmediate:m;a.WritableState=s;var g=e("core-util-is");g.inherits=e("inherits");var b={deprecate:e("util-deprecate")},_=e("./internal/streams/stream"),x=e("safe-buffer").Buffer,w=n.Uint8Array||function(){},k=e("./internal/streams/destroy");g.inherits(a,_),s.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(s.prototype,"buffer",{get:b.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}();var E;"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(E=Function.prototype[Symbol.hasInstance],Object.defineProperty(a,Symbol.hasInstance,{value:function(e){return!!E.call(this,e)||e&&e._writableState instanceof s}})):E=function(e){return e instanceof this},a.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},a.prototype.write=function(e,t,r){var n=this._writableState,i=!1,s=function(e){return x.isBuffer(e)||e instanceof w}(e)&&!n.objectMode;return s&&!x.isBuffer(e)&&(e=function(e){return x.from(e)}(e)),"function"==typeof t&&(r=t,t=null),s?t="buffer":t||(t=n.defaultEncoding),"function"!=typeof r&&(r=o),n.ended?function(e,t){var r=new Error("write after end");e.emit("error",r),m(t,r)}(this,r):(s||function(e,t,r,n){var i=!0,o=!1;return null===r?o=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),m(n,o),i=!1),i}(this,n,e,r))&&(n.pendingcb++,i=u(this,n,s,e,t,r)),i},a.prototype.cork=function(){this._writableState.corked++},a.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||f(this,e))},a.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},a.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},a.prototype._writev=null,a.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!==e&&void 0!==e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(e,t,r){t.ending=!0,d(e,t),r&&(t.finished?m(r):e.once("finish",r)),t.ended=!0,e.writable=!1}(this,n,r)},Object.defineProperty(a.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),a.prototype.destroy=k.destroy,a.prototype._undestroy=k.undestroy,a.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":83,"./internal/streams/destroy":89,"./internal/streams/stream":90,_process:70,"core-util-is":6,inherits:24,"process-nextick-args":69,"safe-buffer":79,"util-deprecate":111}],88:[function(e,t,r){"use strict";function n(e,t,r){e.copy(t,r)}var i=e("safe-buffer").Buffer;t.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},e.prototype.concat=function(e){if(0===this.length)return i.alloc(0);if(1===this.length)return this.head.data;for(var t=i.allocUnsafe(e>>>0),r=this.head,o=0;r;)n(r.data,t,o),o+=r.data.length,r=r.next;return t},e}()},{"safe-buffer":79}],89:[function(e,t,r){"use strict";function n(e,t){e.emit("error",t)}var i=e("process-nextick-args");t.exports={destroy:function(e,t){var r=this,o=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;o||s?t?t(e):!e||this._writableState&&this._writableState.errorEmitted||i(n,this,e):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(i(n,r,e),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(e)}))},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},{"process-nextick-args":69}],90:[function(e,t,r){t.exports=e("events").EventEmitter},{events:18}],91:[function(e,t,r){t.exports=e("./readable").PassThrough},{"./readable":92}],92:[function(e,t,r){(r=t.exports=e("./lib/_stream_readable.js")).Stream=r,r.Readable=r,r.Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":83,"./lib/_stream_passthrough.js":84,"./lib/_stream_readable.js":85,"./lib/_stream_transform.js":86,"./lib/_stream_writable.js":87}],93:[function(e,t,r){t.exports=e("./readable").Transform},{"./readable":92}],94:[function(e,t,r){t.exports=e("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":87}],95:[function(e,t,r){"use strict";function n(e){this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(p.isEncoding===h||!h(e)))throw new Error("Unknown encoding: "+e);return t||e}(e);var t;switch(this.encoding){case"utf16le":this.text=s,this.end=a,t=4;break;case"utf8":this.fillLast=o,t=4;break;case"base64":this.text=u,this.end=c,t=3;break;default:return this.write=l,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=p.allocUnsafe(t)}function i(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:-1}function o(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"".repeat(r);if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"".repeat(r+1);if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"".repeat(r+2)}}(this,e,t);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function s(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function a(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function u(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function c(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function l(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}var p=e("safe-buffer").Buffer,h=p.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};r.StringDecoder=n,n.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},n.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"".repeat(this.lastTotal-this.lastNeed):t},n.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var o=i(t[n]);return o>=0?(o>0&&(e.lastNeed=o-1),o):--n<r?0:(o=i(t[n]))>=0?(o>0&&(e.lastNeed=o-2),o):--n<r?0:(o=i(t[n]))>=0?(o>0&&(2===o?o=0:e.lastNeed=o-3),o):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},n.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":79}],96:[function(e,t,r){function n(e){return e.toString(this.encoding)}function i(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function o(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}var s=e("buffer").Buffer,a=s.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},u=r.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!a(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=i;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=o;break;default:return void(this.write=n)}this.charBuffer=new s(6),this.charReceived=0,this.charLength=0};u.prototype.write=function(e){for(var t="";this.charLength;){var r=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,r),this.charReceived+=r,this.charReceived<this.charLength)return"";e=e.slice(r,e.length);if(!((i=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&i<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var n=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,n),n-=this.charReceived);var i;n=(t+=e.toString(this.encoding,0,n)).length-1;if((i=t.charCodeAt(n))>=55296&&i<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,n)}return t},u.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var r=e[e.length-t];if(1==t&&r>>5==6){this.charLength=2;break}if(t<=2&&r>>4==14){this.charLength=3;break}if(t<=3&&r>>3==30){this.charLength=4;break}}this.charReceived=t},u.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var r=this.charReceived,n=this.charBuffer,i=this.encoding;t+=n.slice(0,r).toString(i)}return t}},{buffer:5}],97:[function(e,t,r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function i(e){return function(e){return"function"==typeof e}(e.prefix)?e.prefix():e}function o(){Error.call(this)}function s(e,t){if(!(this instanceof s))return new s(e,t);m.call(this,{objectMode:!0,highWaterMark:e.highWaterMark}),this._waiting=!1,this._options=e,this._makeData=t}var a=n(e("ltgt")),u=n(e("events")),c=n(e("inherits")),l=n(e("level-codec")),f=n(e("readable-stream"));c(o,Error),o.prototype.name="NotFoundError";var p=u.EventEmitter,h=new o,d=function(e,t,r,n){function i(e){var t,r={};if(n)for(t in n)void 0!==n[t]&&(r[t]=n[t]);if(e)for(t in e)void 0!==e[t]&&(r[t]=e[t]);return r}var o=new p;return o.sublevels={},o.options=n,o.version="6.5.4",o.methods={},t=t||[],o.put=function(r,n,s,a){"function"==typeof s&&(a=s,s={}),e.apply([{key:r,value:n,prefix:t.slice(),type:"put"}],i(s),function(e){if(e)return a(e);o.emit("put",r,n),a(null)})},o.prefix=function(){return t.slice()},o.batch=function(r,n,s){"function"==typeof n&&(s=n,n={}),r=r.map(function(e){return{key:e.key,value:e.value,prefix:e.prefix||t,keyEncoding:e.keyEncoding,valueEncoding:e.valueEncoding,type:e.type}}),e.apply(r,i(n),function(e){if(e)return s(e);o.emit("batch",r),s(null)})},o.get=function(r,n,o){"function"==typeof n&&(o=n,n={}),e.get(r,t,i(n),function(e,t){e?o(h):o(null,t)})},o.sublevel=function(n,s){return o.sublevels[n]=o.sublevels[n]||d(e,t.concat(n),r,i(s))},o.readStream=o.createReadStream=function(n){(n=i(n)).prefix=t;var o,s=e.iterator(n);return(o=r(n,e.createDecoder(n))).setIterator(s),o},o.close=function(t){e.close(t)},o.isOpen=e.isOpen,o.isClosed=e.isClosed,o},m=f.Readable;c(s,m),s.prototype.setIterator=function(e){return this._iterator=e,this._destroyed?e.end(function(){}):this._waiting?(this._waiting=!1,this._read()):this},s.prototype._read=function(){var e=this;if(!e._destroyed)return e._iterator?void e._iterator.next(function(t,r,n){if(t||void 0===r&&void 0===n)return t||e._destroyed||e.push(null),e._cleanup(t);n=e._makeData(r,n),e._destroyed||e.push(n)}):this._waiting=!0},s.prototype._cleanup=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;e&&t.emit("error",e),t._iterator?t._iterator.end(function(){t._iterator=null,t.emit("close")}):t.emit("close")}},s.prototype.destroy=function(){this._cleanup()};var v={encode:function(e){return""+e[0]+""+e[1]},decode:function(e){var t=e.toString(),r=t.indexOf("",1);return[t.substring(1,r),t.substring(r+1)]},lowerBound:"\0",upperBound:""},y=new l;t.exports=function(e){return d(function(e,t,r){function n(e,n,i,o){return t.encode([e,r.encodeKey(n,i,o)])}function o(e,t){return t&&t.options&&(e.keyEncoding=e.keyEncoding||t.options.keyEncoding,e.valueEncoding=e.valueEncoding||t.options.valueEncoding),e}return e.open(function(){}),{apply:function(t,s,a){s=s||{};for(var u=[],c=-1,l=t.length;++c<l;){var f=t[c];o(f,f.prefix),f.prefix=i(f.prefix),u.push({key:n(f.prefix,f.key,s,f),value:"del"!==f.type&&r.encodeValue(f.value,s,f),type:f.type})}e.db.batch(u,s,a)},get:function(t,i,o,s){return o.asBuffer=r.valueAsBuffer(o),e.db.get(n(i,t,o),o,function(e,t){e?s(e):s(null,r.decodeValue(t,o))})},createDecoder:function(e){return function(n,i){return{key:r.decodeKey(t.decode(n)[1],e),value:r.decodeValue(i,e)}}},isClosed:function(){return e.isClosed()},close:function(t){return e.close(t)},iterator:function(i){var o=function(e){var t={};for(var r in e)t[r]=e[r];return t}(i||{}),s=i.prefix||[];return a.toLtgt(i,o,function(e){return n(s,e,o,{})},t.lowerBound,t.upperBound),o.prefix=null,o.keyAsBuffer=o.valueAsBuffer=!1,"number"!=typeof o.limit&&(o.limit=-1),o.keyAsBuffer=t.buffer,o.valueAsBuffer=r.valueAsBuffer(o),function(e){return{next:function(t){return e.next(t)},end:function(t){e.end(t)}}}(e.db.iterator(o))}}}(e,v,y),[],s,e.options)}},{events:18,inherits:24,"level-codec":31,ltgt:42,"readable-stream":78}],98:[function(e,t,r){arguments[4][83][0].apply(r,arguments)},{"./_stream_readable":100,"./_stream_writable":102,"core-util-is":6,dup:83,inherits:24,"process-nextick-args":69}],99:[function(e,t,r){arguments[4][84][0].apply(r,arguments)},{"./_stream_transform":101,"core-util-is":6,dup:84,inherits:24}],100:[function(e,t,r){arguments[4][85][0].apply(r,arguments)},{"./_stream_duplex":98,"./internal/streams/BufferList":103,"./internal/streams/destroy":104,"./internal/streams/stream":105,_process:70,"core-util-is":6,dup:85,events:18,inherits:24,isarray:30,"process-nextick-args":69,"safe-buffer":79,"string_decoder/":108,util:3}],101:[function(e,t,r){arguments[4][86][0].apply(r,arguments)},{"./_stream_duplex":98,"core-util-is":6,dup:86,inherits:24}],102:[function(e,t,r){arguments[4][87][0].apply(r,arguments)},{"./_stream_duplex":98,"./internal/streams/destroy":104,"./internal/streams/stream":105,_process:70,"core-util-is":6,dup:87,inherits:24,"process-nextick-args":69,"safe-buffer":79,"util-deprecate":111}],103:[function(e,t,r){arguments[4][88][0].apply(r,arguments)},{dup:88,"safe-buffer":79}],104:[function(e,t,r){arguments[4][89][0].apply(r,arguments)},{dup:89,"process-nextick-args":69}],105:[function(e,t,r){arguments[4][90][0].apply(r,arguments)},{dup:90,events:18}],106:[function(e,t,r){arguments[4][92][0].apply(r,arguments)},{"./lib/_stream_duplex.js":98,"./lib/_stream_passthrough.js":99,"./lib/_stream_readable.js":100,"./lib/_stream_transform.js":101,"./lib/_stream_writable.js":102,dup:92}],107:[function(e,t,r){arguments[4][93][0].apply(r,arguments)},{"./readable":106,dup:93}],108:[function(e,t,r){arguments[4][95][0].apply(r,arguments)},{dup:95,"safe-buffer":79}],109:[function(e,t,r){(function(r){function n(e){s.call(this,e),this._destroyed=!1}function i(e,t,r){r(null,e)}function o(e){return function(t,r,n){return"function"==typeof t&&(n=r,r=t,t={}),"function"!=typeof r&&(r=i),"function"!=typeof n&&(n=null),e(t,r,n)}}var s=e("readable-stream/transform"),a=e("util").inherits,u=e("xtend");a(n,s),n.prototype.destroy=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;r.nextTick(function(){e&&t.emit("error",e),t.emit("close")})}},t.exports=o(function(e,t,r){var i=new n(e);return i._transform=t,r&&(i._flush=r),i}),t.exports.ctor=o(function(e,t,r){function i(t){if(!(this instanceof i))return new i(t);this.options=u(e,t),n.call(this,this.options)}return a(i,n),i.prototype._transform=t,r&&(i.prototype._flush=r),i}),t.exports.obj=o(function(e,t,r){var i=new n(u({objectMode:!0,highWaterMark:16},e));return i._transform=t,r&&(i._flush=r),i})}).call(this,e("_process"))},{_process:70,"readable-stream/transform":107,util:114,xtend:120}],110:[function(e,t,r){"use strict";var n=e("lodash.isnull"),i=e("validate.io-undefined"),o=Object.prototype.toString;t.exports=function(e){return n(e)?"[object Null]":i(e)?"[object Undefined]":o.call(e)}},{"lodash.isnull":41,"validate.io-undefined":118}],111:[function(e,t,r){(function(e){function r(t){try{if(!e.localStorage)return!1}catch(e){return!1}var r=e.localStorage[t];return null!=r&&"true"===String(r).toLowerCase()}t.exports=function(e,t){if(r("noDeprecation"))return e;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],112:[function(e,t,r){arguments[4][24][0].apply(r,arguments)},{dup:24}],113:[function(e,t,r){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],114:[function(e,t,r){(function(t,n){function i(e,t){var n={seen:[],stylize:s};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),f(t)?n.showHidden=t:t&&r._extend(n,t),m(n.showHidden)&&(n.showHidden=!1),m(n.depth)&&(n.depth=2),m(n.colors)&&(n.colors=!1),m(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=o),a(n,e,n.depth)}function o(e,t){var r=i.styles[t];return r?"["+i.colors[r][0]+"m"+e+"["+i.colors[r][1]+"m":e}function s(e,t){return e}function a(e,t,n){if(e.customInspect&&t&&_(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(n,e);return d(i)||(i=a(e,i,n)),i}var o=function(e,t){if(m(t))return e.stylize("undefined","undefined");if(d(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(h(t))return e.stylize(""+t,"number");if(f(t))return e.stylize(""+t,"boolean");if(p(t))return e.stylize("null","null")}(e,t);if(o)return o;var s=Object.keys(t),y=function(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),b(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return u(t);if(0===s.length){if(_(t)){var x=t.name?": "+t.name:"";return e.stylize("[Function"+x+"]","special")}if(v(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(g(t))return e.stylize(Date.prototype.toString.call(t),"date");if(b(t))return u(t)}var w="",E=!1,S=["{","}"];if(l(t)&&(E=!0,S=["[","]"]),_(t)){w=" [Function"+(t.name?": "+t.name:"")+"]"}if(v(t)&&(w=" "+RegExp.prototype.toString.call(t)),g(t)&&(w=" "+Date.prototype.toUTCString.call(t)),b(t)&&(w=" "+u(t)),0===s.length&&(!E||0==t.length))return S[0]+w+S[1];if(n<0)return v(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var A;return A=E?function(e,t,r,n,i){for(var o=[],s=0,a=t.length;s<a;++s)k(t,String(s))?o.push(c(e,t,r,n,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(c(e,t,r,n,i,!0))}),o}(e,t,n,y,s):s.map(function(r){return c(e,t,n,y,r,E)}),e.seen.pop(),function(e,t,r){var n=0;if(e.reduce(function(e,t){return n++,t.indexOf("\n")>=0&&n++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(A,w,S)}function u(e){return"["+Error.prototype.toString.call(e)+"]"}function c(e,t,r,n,i,o){var s,u,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?u=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(u=e.stylize("[Setter]","special")),k(n,i)||(s="["+i+"]"),u||(e.seen.indexOf(c.value)<0?(u=p(r)?a(e,c.value,null):a(e,c.value,r-1)).indexOf("\n")>-1&&(u=o?u.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+u.split("\n").map(function(e){return"   "+e}).join("\n")):u=e.stylize("[Circular]","special")),m(s)){if(o&&i.match(/^\d+$/))return u;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+u}function l(e){return Array.isArray(e)}function f(e){return"boolean"==typeof e}function p(e){return null===e}function h(e){return"number"==typeof e}function d(e){return"string"==typeof e}function m(e){return void 0===e}function v(e){return y(e)&&"[object RegExp]"===x(e)}function y(e){return"object"==typeof e&&null!==e}function g(e){return y(e)&&"[object Date]"===x(e)}function b(e){return y(e)&&("[object Error]"===x(e)||e instanceof Error)}function _(e){return"function"==typeof e}function x(e){return Object.prototype.toString.call(e)}function w(e){return e<10?"0"+e.toString(10):e.toString(10)}function k(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var E=/%[sdj%]/g;r.format=function(e){if(!d(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(i(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,o=n.length,s=String(e).replace(E,function(e){if("%%"===e)return"%";if(r>=o)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),a=n[r];r<o;a=n[++r])p(a)||!y(a)?s+=" "+a:s+=" "+i(a);return s},r.deprecate=function(e,i){if(m(n.process))return function(){return r.deprecate(e,i).apply(this,arguments)};if(!0===t.noDeprecation)return e;var o=!1;return function(){if(!o){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),o=!0}return e.apply(this,arguments)}};var S,A={};r.debuglog=function(e){if(m(S)&&(S=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!A[e])if(new RegExp("\\b"+e+"\\b","i").test(S)){var n=t.pid;A[e]=function(){var t=r.format.apply(r,arguments);console.error("%s %d: %s",e,n,t)}}else A[e]=function(){};return A[e]},r.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=l,r.isBoolean=f,r.isNull=p,r.isNullOrUndefined=function(e){return null==e},r.isNumber=h,r.isString=d,r.isSymbol=function(e){return"symbol"==typeof e},r.isUndefined=m,r.isRegExp=v,r.isObject=y,r.isDate=g,r.isError=b,r.isFunction=_,r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},r.isBuffer=e("./support/isBuffer");var D=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];r.log=function(){console.log("%s - %s",function(){var e=new Date,t=[w(e.getHours()),w(e.getMinutes()),w(e.getSeconds())].join(":");return[e.getDate(),D[e.getMonth()],t].join(" ")}(),r.format.apply(r,arguments))},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!y(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":113,_process:70,inherits:112}],115:[function(e,t,r){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);t.exports=function(e,t){var r=t||0,i=n;return i[e[r++]]+i[e[r++]]+i[e[r++]]+i[e[r++]]+"-"+i[e[r++]]+i[e[r++]]+"-"+i[e[r++]]+i[e[r++]]+"-"+i[e[r++]]+i[e[r++]]+"-"+i[e[r++]]+i[e[r++]]+i[e[r++]]+i[e[r++]]+i[e[r++]]+i[e[r++]]}},{}],116:[function(e,t,r){(function(e){var r,n=e.crypto||e.msCrypto;if(n&&n.getRandomValues){var i=new Uint8Array(16);r=function(){return n.getRandomValues(i),i}}if(!r){var o=new Array(16);r=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],117:[function(e,t,r){var n=e("./lib/rng"),i=e("./lib/bytesToUuid");t.exports=function(e,t,r){var o=t&&r||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[o+a]=s[a];return t||i(s)}},{"./lib/bytesToUuid":115,"./lib/rng":116}],118:[function(e,t,r){"use strict";t.exports=function(e){return void 0===e}},{}],119:[function(e,t,r){"use strict";function n(e,t,r){var n=r[r.length-1];e===n.element&&(r.pop(),n=r[r.length-1]);var i=n.element,o=n.index;if(Array.isArray(i))i.push(e);else if(o===t.length-2){i[t.pop()]=e}else t.push(e)}r.stringify=function(e){var t=[];t.push({obj:e});for(var r,n,i,o,s,a,u,c,l,f,p,h="";r=t.pop();)if(n=r.obj,i=r.prefix||"",o=r.val||"",h+=i,o)h+=o;else if("object"!=typeof n)h+=void 0===n?null:JSON.stringify(n);else if(null===n)h+="null";else if(Array.isArray(n)){for(t.push({val:"]"}),s=n.length-1;s>=0;s--)a=0===s?"":",",t.push({obj:n[s],prefix:a});t.push({val:"["})}else{u=[];for(c in n)n.hasOwnProperty(c)&&u.push(c);for(t.push({val:"}"}),s=u.length-1;s>=0;s--)f=n[l=u[s]],p=s>0?",":"",p+=JSON.stringify(l)+":",t.push({obj:f,prefix:p});t.push({val:"{"})}return h},r.parse=function(e){for(var t,r,i,o,s,a,u,c,l,f=[],p=[],h=0;;)if("}"!==(t=e[h++])&&"]"!==t&&void 0!==t)switch(t){case" ":case"\t":case"\n":case":":case",":break;case"n":h+=3,n(null,f,p);break;case"t":h+=3,n(!0,f,p);break;case"f":h+=4,n(!1,f,p);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(r="",h--;;){if(i=e[h++],!/[\d\.\-e\+]/.test(i)){h--;break}r+=i}n(parseFloat(r),f,p);break;case'"':for(o="",s=void 0,a=0;'"'!==(u=e[h++])||"\\"===s&&a%2==1;)o+=u,"\\"===(s=u)?a++:a=0;n(JSON.parse('"'+o+'"'),f,p);break;case"[":c={element:[],index:f.length},f.push(c.element),p.push(c);break;case"{":l={element:{},index:f.length},f.push(l.element),p.push(l);break;default:throw new Error("unexpectedly reached end of input: "+t)}else{if(1===f.length)return f.pop();n(f.pop(),f,p)}}},{}],120:[function(e,t,r){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var i in r)n.call(r,i)&&(e[i]=r[i])}return e};var n=Object.prototype.hasOwnProperty},{}]},{},[59])(59)}),t.exports}();!function(){var r="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;void 0===r.lively&&(r.lively={}),"undefined"==typeof btoa&&(r.btoa=function(e){return new Buffer(e).toString("base64")}),"undefined"==typeof atob&&(r.atob=function(e){return new Buffer(e,"base64").toString()}),function(){this.lively=this.lively||{},function(e,t,r,n,i){"use strict";function o(e){if(!b)throw new Error("nodejsRequire can only be used in nodejs!");return"undefined"!=typeof System?System._nodeRequire(e):require("module")._load(e)}function s(e,t,r){if(void 0===t&&"string"==typeof r&&!r.includes("undefined"))throw new Error("parameter "+e+" is undefined");if("string"==typeof r){var n=void 0===t?"undefined":c(t),i=t?t.constructor.name:"";if(!r.split("|").some(function(e){return n===e||i===e}))throw new Error('parameter "'+e+'" expected to be of type '+r+" but is "+(i||n))}if("function"==typeof r){var o=r(t);if(o&&o.error)throw new Error('check of parameter "'+e+'" failed: '+o.error)}}function a(e,t,r){for(var n in t)s(n,e[n],t[n]);if("function"==typeof r){var i=r(e);if(i&&i.error)throw new Error(i.error)}return e}function u(e,t){return!t||("string"==typeof t?!e.url.includes(t):"function"==typeof t?!t(e):!(t instanceof RegExp)||!t.test(e.url))}t="default"in t?t.default:t,r="default"in r?r.default:r;var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var s=t[i](o),a=s.value}catch(e){return void r(e)}if(!s.done)return Promise.resolve(a).then(function(e){n("next",e)},function(e){n("throw",e)});e(a)}return n("next")})}},f=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},p=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},d=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},m=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},v=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),y=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:void 0,b="undefined"!=typeof global&&"undefined"!=typeof process,_=t;_.plugin(r);var x=b?function(){var e=!1,t=!1;return function(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e||(e=!0,t=function(){if(!b)throw new Error("nodejs_attemptToLoadProperPouchDB called under non-nodejs environment");if("undefined"!=typeof System){var e=System._nodeRequire("path").join,t=System.normalizeSync("lively.storage/index.js"),n=e(System.normalizeSync("pouchdb",t).replace(/file:\/\//,""),"../../lib/index.js");try{return(_=System._nodeRequire(n)).plugin(r),!0}catch(e){return!1}}try{return(_=require("pouchdb")).plugin(r),!0}catch(e){return!1}}()),i.adapter||(i.adapter=n.startsWith("http")?"http":t?"leveldb":"memory"),"leveldb"==i.adapter&&(n=function(e){if(e.startsWith("/"))return e;if(e.match(/[^\/]+:\/\//))return e.startsWith("file:")&&(e=e.replace(/^file:\/\//,"")),e;if(!b)throw new Error("nodejs_leveldbPath called under non-nodejs environment");var t="undefined"!=typeof System&&System.baseURL.startsWith("file://")?System.baseURL.replace("file://",""):g.process.cwd(),r=o("path").join,n=o("fs"),i=n.mkdirSync,s=n.existsSync,a=(n.readdirSync,n.readFileSync);if(e.includes("/"))return r(t,e);try{var u=a(r(t,"../package.json")),c=JSON.parse(u);if("lively.web"===c.name||"lively.next"===c.name){var l=r(t,"../.livelydbs");return s(l)||i(l),r(l,e)}}catch(e){}var f=r(t,".livelydbs");return s(f)||i(f),r(f,e)}(n)),i=h({},i,{name:n}),new _(i)}}():function(e,t){return new _(h({name:e},t))},w=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};f(this,e),this.name=t,this.options=r,this._pouchdb=null}return p(e,null,[{key:"findDB",value:function(e){return this.databases.get(e)}},{key:"ensureDB",value:function(e,t){var r=this.findDB(e);return r||(r=new this(e,t),this.databases.set(e,r),r)}},{key:"PouchDB",get:function(){return _},set:function(e){_=e}},{key:"databases",get:function(){return this._databases||(this._databases=new Map)}}]),p(e,[{key:"close",value:function(){this._pouchdb&&(this._pouchdb.close(),delete this._pouchdb)}},{key:"isDestroyed",value:function(){return!!this.pouchdb._destroyed}},{key:"destroy",value:function(e){return this.constructor.databases.delete(this.name),this.isDestroyed()?{ok:!0}:this.pouchdb.destroy(e)}},{key:"update",value:function(){var e=l(regeneratorRuntime.mark(function e(t,r,n){var i,o,s,a,u,l,f,p,h,d,m,v,y,g,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=n||{},i=n,o=i.ensure,s=void 0===o||o,a=i.retryOnConflict,u=void 0===a||a,l=i.maxUpdateAttempts,f=void 0===l?10:l,p={latest:!0},h=this.pouchdb,d=void 0,m=void 0,e.prev=2,e.next=5,h.get(t,p);case 5:d=e.sent,e.next=12;break;case 8:if(e.prev=8,e.t0=e.catch(2),"not_found"===e.t0.name&&s){e.next=12;break}throw e.t0;case 12:return e.next=14,r(d);case 14:if((m=e.sent)&&"object"===(void 0===m?"undefined":c(m))){e.next=17;break}return e.abrupt("return",null);case 17:return m._id!==t&&(m._id=t),d&&m._rev!==d._rev&&(m._rev=d._rev),e.prev=19,e.next=22,h.put(m);case 22:return v=e.sent,y=v.id,g=v.rev,e.abrupt("return",Object.assign(m,{_rev:g}));case 28:if(e.prev=28,e.t1=e.catch(19),!("conflict"===e.t1.name&&u&&b<f)){e.next=32;break}return e.abrupt("return",this.update(t,r,n,b+1));case 32:throw e.t1;case 33:case"end":return e.stop()}},e,this,[[2,8],[19,28]])}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"mixin",value:function(){var e=l(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.update(t,function(e){return Object.assign(e||{_id:t},r)},n));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"set",value:function(){var e=l(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.update(t,function(e){return r},n));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.pouchdb.get(t);case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),"not_found"!==e.t0.name){e.next=10;break}return e.abrupt("return",void 0);case 10:throw e.t0;case 11:case"end":return e.stop()}},e,this,[[0,6]])}));return function(t){return e.apply(this,arguments)}}()},{key:"has",value:function(){var e=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return e.abrupt("return",!!e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"add",value:function(){var e=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.pouchdb.post(t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"docList",value:function(){var e=l(regeneratorRuntime.mark(function e(){var t,r,n,i,o,s,a,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.allDocs(u);case 2:for(t=e.sent,r=t.rows,n=[],i=0;i<r.length;i++)o=r[i],s=o.id,a=o.value.rev,n.push({id:s,rev:a});return e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"revList",value:function(){var e=l(regeneratorRuntime.mark(function e(t){var r,n,i,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.get(t,{revs:!0});case 2:return r=e.sent,n=r._id,i=r._revisions,o=i.start,s=i.ids,e.abrupt("return",s.map(function(e){return o--+"-"+e}));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllRevisions",value:function(){var e=l(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.skip,n=void 0===r?0:r,i=u.limit,o=void 0===i?0:i,e.next=6,this.revList(t);case 6:return s=e.sent,n>0&&(s=s.slice(n)),o>0&&(s=s.slice(0,o)),a=s.map(function(e){return{rev:e,id:t}}),e.next=12,this.getDocuments(a);case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAll",value:function(){var e=l(regeneratorRuntime.mark(function e(){var t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.allDocs(h({},n,{include_docs:!0}));case 2:return t=e.sent,r=t.rows,e.abrupt("return",r.map(function(e){return e.doc}));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setDocuments",value:function(){var e=l(regeneratorRuntime.mark(function e(t,r){var n,i,o,s,a,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.bulkDocs(t,r);case 2:n=e.sent,i=0;case 4:if(!(i<n.length)){e.next=16;break}if(o=t[i],(s=n[i]).ok||"conflict"!==s.name||o._rev){e.next=13;break}return e.next=9,this.set(o._id,o);case 9:a=e.sent,u=a._id,c=a._rev,n[i]={ok:!0,id:u,rev:c};case 13:i++,e.next=4;break;case 16:return e.abrupt("return",n);case 17:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getDocuments",value:function(){var e=l(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,l,f,p,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=h.ignoreErrors,n=void 0===r||r,e.next=4,this.pouchdb.bulkGet({docs:t});case 4:i=e.sent,o=i.results,s=[],a=0;case 8:if(!(a<o.length)){e.next=23;break}u=o[a],c=u.docs,l=u.id,console.assert(1===c.length,"getDocuments: expected only one doc for "+l),f=0;case 12:if(!(f<c.length)){e.next=20;break}if(p=c[f],!n||p.ok){e.next=16;break}return e.abrupt("continue",17);case 16:s.push(p.ok||p.error||p);case 17:f++,e.next=12;break;case 20:a++,e.next=8;break;case 23:return e.abrupt("return",s);case 24:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"query",value:function(e,t){return this.pouchdb.query(e,t)}},{key:"remove",value:function(){var e=l(regeneratorRuntime.mark(function e(t,r,n){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===r){e.next=4;break}e.t0={_id:t,_rev:r},e.next=7;break;case 4:return e.next=6,this.get(t);case 6:e.t0=e.sent;case 7:return i=e.t0,e.abrupt("return",i?this.pouchdb.remove(i):void 0);case 9:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"removeAll",value:function(){var e=l(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.pouchdb,e.next=3,t.allDocs();case 3:return r=e.sent,e.next=6,Promise.all(r.rows.map(function(e){return t.remove(e.id,e.value.rev)}));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"replicateTo",value:function(t,r){return t instanceof e&&(t=t.pouchdb),this.pouchdb.replicate.to(t,r)}},{key:"replicateFrom",value:function(t,r){return t instanceof e&&(t=t.pouchdb),this.pouchdb.replicate.from(t,r)}},{key:"sync",value:function(t,r){return t instanceof e&&(t=t.pouchdb),this.pouchdb.sync(t,r)}},{key:"getConflicts",value:function(){var e=l(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.query({map:"function(doc) { if (doc._conflicts) emit(doc._id); }"},{reduce:!1,include_docs:!0,conflicts:!0});case 2:return t=e.sent,r=t.rows,e.abrupt("return",r.map(function(e){return e.doc}));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"resolveConflicts",value:function(){var e=l(regeneratorRuntime.mark(function e(t,r){var n,i,o,s,a,u,c,l,f,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouchdb.get("doc",{conflicts:!0});case 2:return n=e.sent,i=n._conflicts.map(function(e){return{id:t,rev:e}}),e.next=6,this.getDocuments(i);case 6:o=e.sent,s=n,a=!0,u=!1,c=void 0,e.prev=11,l=o[Symbol.iterator]();case 13:if(a=(f=l.next()).done){e.next=28;break}return p=f.value,e.next=17,r(s,p);case 17:if(s=e.sent){e.next=20;break}return e.abrupt("return",null);case 20:return e.next=22,this.set(t,s);case 22:return s=e.sent,e.next=25,this.pouchdb.remove(p);case 25:a=!0,e.next=13;break;case 28:e.next=34;break;case 30:e.prev=30,e.t0=e.catch(11),u=!0,c=e.t0;case 34:e.prev=34,e.prev=35,!a&&l.return&&l.return();case 37:if(e.prev=37,!u){e.next=40;break}throw c;case 40:return e.finish(37);case 41:return e.finish(34);case 42:return e.abrupt("return",s);case 43:case"end":return e.stop()}},e,this,[[11,30,34,42],[35,,37,41]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"dump",value:function(){var e=l(regeneratorRuntime.mark(function e(){var t,r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.name,r=this.pouchdb,e.t0=t,e.t1=r.type(),e.t2=(new Date).toJSON(),e.next=7,r.info();case 7:return e.t3=e.sent,n={name:e.t0,db_type:e.t1,start_time:e.t2,db_info:e.t3},e.next=11,this.getAll({attachments:!0});case 11:return i=e.sent,e.abrupt("return",{header:n,docs:i});case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"backup",value:function(){var e=l(regeneratorRuntime.mark(function e(){var t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.name+"_backup_"+n,r=this.constructor.ensureDB(t),e.next=3,this.replicateTo(r);case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"migrate",value:function(){var e=l(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAll();case 2:r=e.sent,n=[],i=[],o=0;case 5:if(!(o<r.length)){e.next=16;break}if(s=r[o],a=t(s,o)){e.next=10;break}return i.push(s),e.abrupt("continue",13);case 10:a.hasOwnProperty("_id")||(a._id=s._id),a.hasOwnProperty("_rev")&&delete a._rev,n.push(a);case 13:o++,e.next=5;break;case 16:return e.next=18,this.setDocuments(n);case 18:return e.abrupt("return",{migrated:n.length,unchanged:i.length});case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"pouchdb",get:function(){if(this._pouchdb)return this._pouchdb;var e=this.name,t=this.options;return this._pouchdb=x(e,t)}}],[{key:"loadDump",value:function(){var e=l(regeneratorRuntime.mark(function e(t){var r,n,i,o,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.header,n=t.docs,i=s.name||r.name,o=this.ensureDB(i),e.next=3,o.setDocuments(n,{new_edits:!1});case 3:return e.abrupt("return",o);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),k=function(){var e,t,r;return"object"==("undefined"==typeof process?"undefined":c(process))&&"object"==c(process.versions)&&process.versions.node&&"renderer"!==process.__atom_type?(r="undefined"!=typeof System?System._nodeRequire("crypto"):require("crypto"),t=function(){var e=r.createHash("sha1");return{update:function(t){return e.update(t)},digest:function(){return e.digest("hex")}}}):(e=new Uint32Array(80),t=function(t){function r(e){o[f]|=(255&e)<<p,p?p-=8:(f++,p=24),16===f&&n()}function n(){for(var e=16;e<80;e++){var t=o[e-3]^o[e-8]^o[e-14]^o[e-16];o[e]=t<<1|t>>>31}var r,n,i=s,p=a,h=u,d=c,m=l;for(e=0;e<80;e++){e<20?(r=d^p&(h^d),n=1518500249):e<40?(r=p^h^d,n=1859775393):e<60?(r=p&h|d&(p|h),n=2400959708):(r=p^h^d,n=3395469782);var v=(i<<5|i>>>27)+r+m+n+(0|o[e]);m=d,d=h,h=p<<30|p>>>2,p=i,i=v}for(s=s+i|0,a=a+p|0,u=u+h|0,c=c+d|0,l=l+m|0,f=0,e=0;e<16;e++)o[e]=0}function i(e){for(var t="",r=28;r>=0;r-=4)t+=(e>>r&15).toString(16);return t}var o,s=1732584193,a=4023233417,u=2562383102,c=271733878,l=3285377520,f=0,p=24,h=0;return o=t?e:new Uint32Array(80),{update:function(e){if("string"==typeof e)return function(e){var t=e.length;h+=8*t;for(var n=0;n<t;n++)r(e.charCodeAt(n))}(e);var t=e.length;h+=8*t;for(var n=0;n<t;n++)r(e[n])},digest:function(){r(128),(f>14||14===f&&p<24)&&n(),f=14,p=24,r(0),r(0),r(h>0xffffffffff?h/1099511627776:0),r(h>4294967295?h/4294967296:0);for(var e=24;e>=0;e-=8)r(h>>e);return i(s)+i(a)+i(u)+i(c)+i(l)}}}),function(e){if(void 0===e)return t(!1);var r=t(!0);return r.update(e),r.digest()}}(),E=E||new Map,S=function(){function e(t,r){if(f(this,e),this.name=t,!r.snapshotLocation||!r.snapshotLocation.isResource)throw new Error("ObjectDB needs snapshotLocation!");this.snapshotLocation=r.snapshotLocation,this.__commitDB=null,this.__versionDB=null}return p(e,null,[{key:"find",value:function(){var e=l(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=E.get(t))){e.next=3;break}return e.abrupt("return",r);case 3:return n=w.ensureDB("__internal__objectdb-meta"),e.next=6,n.get(t);case 6:if(i=e.sent){e.next=9;break}return e.abrupt("return");case 9:return e.abrupt("return",this.named(t,i));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"named",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=E.get(e);if(r)return r;if(!t||!t.snapshotLocation)throw new Error("need snapshotLocation");if("string"==typeof t.snapshotLocation)try{t.snapshotLocation=n.resource(t.snapshotLocation)}catch(e){t.snapshotLocation=n.resource(System.baseURL).join(t.snapshotLocation)}var i=new this(e,t);E.set(e,i);return w.ensureDB("__internal__objectdb-meta").set(e,h({},t,{snapshotLocation:t.snapshotLocation.url})).catch(function(e){return console.error("error writing objectdb meta:",e)}),i}}]),p(e,[{key:"destroy",value:function(){var e=l(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=w.findDB(this.name+"-commits"))){e.next=4;break}return e.next=4,t.destroy();case 4:if(!(r=w.findDB(this.name+"-version-graph"))){e.next=8;break}return e.next=8,r.destroy();case 8:return E.delete(this.name),n=w.ensureDB("__internal__objectdb-meta"),e.next=12,n.remove(this.name);case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"snapshotResourceFor",value:function(e){var t=e.content.slice(0,2),r=e.content.slice(2);return this.snapshotLocation.join(t+"/"+r+".json")}},{key:"snapshotObject",value:function(){var e=l(regeneratorRuntime.mark(function e(t,r,n,i,o,s,a,u){var c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=i||{},c=function(e){return e},e.next=4,c(n,i);case 4:return l=e.sent,e.abrupt("return",this.commit(t,r,l,o,s,a,u));case 6:case"end":return e.stop()}},e,this)}));return function(t,r,n,i,o,s,a,u){return e.apply(this,arguments)}}()},{key:"loadObject",value:function(){var e=l(regeneratorRuntime.mark(function e(t,r,n,i,o){var s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=n||{},e.next=3,this.loadSnapshot(t,r,i,o);case 3:return s=e.sent,a=function(e){return e},e.abrupt("return",a(s,n));case 6:case"end":return e.stop()}},e,this)}));return function(t,r,n,i,o){return e.apply(this,arguments)}}()},{key:"has",value:function(){var e=l(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.objectStats(t,r);case 2:return e.abrupt("return",!!e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"objects",value:function(){var e=l(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.objectStats(t);case 2:if(r=e.sent,!t){e.next=5;break}return e.abrupt("return",Object.keys(r||{}));case 5:n={};for(i in r)n[i]=Object.keys(r[i]);return e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"objectStats",value:function(){var e=l(regeneratorRuntime.mark(function e(t,r){var n,i,o,s,a,u,c,l,f,p,h,d,m,y,g,b,_,x,w,k,E;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n={},e.t0=this.__commitDB,e.t0){e.next=6;break}return e.next=5,this._commitDB();case 5:e.t0=e.sent;case 6:return i=e.t0,o={reduce:!0,group:!0},t&&r?o.key=t+"\0"+r:t&&(o.startkey=t+"\0",o.endkey=t+""),e.prev=9,e.next=12,i.pouchdb.query("nameWithMaxMinTimestamp_index",o);case 12:for(s=e.sent,a=s.rows,u=!0,c=!1,l=void 0,e.prev=17,f=a[Symbol.iterator]();!(u=(p=f.next()).done);u=!0)h=p.value,d=h.key,m=h.value,y=m.count,g=m.max,b=m.min,_=d.split("\0"),x=v(_,2),w=x[0],k=x[1],(E=n[w]||(n[w]={}))[k]={count:y,newest:g,oldest:b};e.next=25;break;case 21:e.prev=21,e.t1=e.catch(17),c=!0,l=e.t1;case 25:e.prev=25,e.prev=26,!u&&f.return&&f.return();case 28:if(e.prev=28,!c){e.next=31;break}throw l;case 31:return e.finish(28);case 32:return e.finish(25);case 33:e.next=39;break;case 35:return e.prev=35,e.t2=e.catch(9),console.error(e.t2),e.abrupt("return",n);case 39:if(!t||!r){e.next=41;break}return e.abrupt("return",(n[t]||{})[r]);case 41:if(!t){e.next=43;break}return e.abrupt("return",n[t]);case 43:return e.abrupt("return",n);case 44:case"end":return e.stop()}},e,this,[[9,35],[17,21,25,33],[26,,28,32]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getCommits",value:function(){var e=l(regeneratorRuntime.mark(function e(t,r){var n,i,o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"HEAD",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._log(t,r,s,a);case 2:if((n=e.sent).length){e.next=5;break}return e.abrupt("return",[]);case 5:if(e.t0=this.__commitDB,e.t0){e.next=10;break}return e.next=9,this._commitDB();case 9:e.t0=e.sent;case 10:return i=e.t0,e.next=13,i.getDocuments(n.map(function(e){return{id:e}}));case 13:return o=e.sent,e.abrupt("return",o);case 15:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getCommit",value:function(){var e=l(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.__commitDB,e.t0){e.next=5;break}return e.next=4,this._commitDB();case 4:e.t0=e.sent;case 5:return r=e.t0,e.abrupt("return",r.get(t));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCommitsWithIds",value:function(){var e=l(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return",[]);case 2:if(e.t0=this.__commitDB,e.t0){e.next=7;break}return e.next=6,this._commitDB();case 6:e.t0=e.sent;case 7:return r=e.t0,e.abrupt("return",r.getDocuments(t.map(function(e){return{id:e}})));case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getLatestCommit",value:function(){var e=l(regeneratorRuntime.mark(function e(t,r){var n,i,o,s,a,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"HEAD",c=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._log(t,r,u,1);case 2:if(n=e.sent,i=v(n,1),o=i[0]){e.next=7;break}return e.abrupt("return",null);case 7:if(e.t0=this.__commitDB,e.t0){e.next=12;break}return e.next=11,this._commitDB();case 11:e.t0=e.sent;case 12:return s=e.t0,e.next=15,s.get(o);case 15:if(!(a=e.sent)||!a.deleted||c){e.next=18;break}return e.abrupt("return",null);case 18:return e.abrupt("return",a);case 19:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"commit",value:function(){var e=l(regeneratorRuntime.mark(function e(t,r,n,i,o){var s,a,u,c,l,f,p,h,d,m,v,y,g,b,_,x,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"HEAD",k=arguments[6];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=i.user,a=i.description,u=void 0===a?"no description":a,c=i.tags,l=void 0===c?[]:c,f=i.message,p=void 0===f?"":f,h=i.metadata,t){e.next=3;break}throw new Error("object needs a type");case 3:if(r){e.next=5;break}throw new Error("object needs a name");case 5:if(s){e.next=7;break}throw new Error("Cannot commit "+t+"/"+r+" without user");case 7:if(e.t0=this.__versionDB,e.t0){e.next=12;break}return e.next=11,this._versionDB();case 11:e.t0=e.sent;case 12:return d=e.t0,e.next=15,this.versionGraph(t,r);case 15:if(m=e.sent,v=m?m.refs[w]:null,y=v?[v]:[],!k){e.next=23;break}if(m){e.next=21;break}throw new Error('Trying to store "'+t+"/"+r+'" on top of expected version '+k+" but no version entry exists!");case 21:if(v===k){e.next=23;break}throw new Error('Trying to store "'+t+"/"+r+'" on top of expected version '+k+" but ref "+w+" is of version "+v+"!");case 23:return g=n?JSON.stringify(n):null,b=this._createCommit(t,r,u,l,h,s,p,y,n,g,o),m||(m={refs:{},history:{}}),m.refs[w]=b._id,m.history[b._id]=y,e.next=29,d.set(t+"/"+r,m);case 29:if(e.t1=this.__commitDB,e.t1){e.next=34;break}return e.next=33,this._commitDB();case 33:e.t1=e.sent;case 34:return _=e.t1,e.next=37,_.set(b._id,b);case 37:if(b=e.sent,!n){e.next=49;break}return x=this.snapshotResourceFor(b),e.next=42,x.parent().ensureExistance();case 42:if(!x.canDealWithJSON){e.next=47;break}return e.next=45,x.writeJson(n);case 45:e.next=49;break;case 47:return e.next=49,x.write(g);case 49:return e.abrupt("return",b);case 50:case"end":return e.stop()}},e,this)}));return function(t,r,n,i,o){return e.apply(this,arguments)}}()},{key:"loadSnapshot",value:function(){var e=l(regeneratorRuntime.mark(function e(t,r,n){var i,o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"HEAD";return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=void 0,!n||"string"==typeof n){e.next=5;break}i=n,e.next=20;break;case 5:if(!n){e.next=17;break}if(e.t0=this.__commitDB,e.t0){e.next=11;break}return e.next=10,this._commitDB();case 10:e.t0=e.sent;case 11:return o=e.t0,e.next=14,o.get(n);case 14:i=e.sent,e.next=20;break;case 17:return e.next=19,this.getLatestCommit(t,r,s);case 19:i=e.sent;case 20:if(i){e.next=22;break}throw new Error("Cannot find commit to loadSnapshot for "+t+"/"+r+" (using "+n+")");case 22:return e.abrupt("return",this.snapshotResourceFor(i).readJson());case 23:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_createCommit",value:function(e,t,r,n,o,s){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[],c=arguments[8],l=arguments[9],f=arguments[10];!f&&c&&c.preview&&(f=c.preview);var p={name:t,type:e,timestamp:Date.now(),author:{name:s.name,email:s.email,realm:s.realm},tags:[],description:r,message:a,preview:f,content:l?k(l):null,deleted:!c,metadata:o,ancestors:u},h=i.obj.dissoc(p,["preview"]),d=k(JSON.stringify(h));return Object.assign(p,{_id:d})}},{key:"_commitDB",value:function(){var e=l(regeneratorRuntime.mark(function e(){var t,r,n,i,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.__commitDB){e.next=2;break}return e.abrupt("return",this.__commitDB);case 2:if(t=this.name+"-commits",!(r=w.findDB(t))){e.next=5;break}return e.abrupt("return",this.__commitDB=r);case 5:return r=w.ensureDB(t),e.next=8,Promise.all([r.has("_design/name_index"),r.has("_design/nameAndTimestamp_index"),r.has("_design/nameWithMaxMinTimestamp_index")]);case 8:if((n=e.sent).every(Boolean)){e.next=16;break}return console.log("Preparing indexes for object storage DB "+t),i={_id:"_design/name_index",views:{name_index:{map:"function (doc) { emit(`${doc.type}\0${doc.name}}`); }"}}},o={_id:"_design/nameAndTimestamp_index",views:{nameAndTimestamp_index:{map:"function (doc) { emit(`${doc.type}\0${doc.name}\0${doc.timestamp}}\0${doc._id}}`); }"}}},s={_id:"_design/nameWithMaxMinTimestamp_index",views:{nameWithMaxMinTimestamp_index:{map:"doc => emit(`${doc.type}\0${doc.name}`, doc.timestamp)",reduce:"_stats"}}},e.next=14,r.setDocuments([i,o,s]);case 14:return e.next=16,Promise.all([r.pouchdb.query("name_index",{stale:"update_after"}),r.pouchdb.query("nameAndTimestamp_index",{stale:"update_after"}),r.pouchdb.query("nameWithMaxMinTimestamp_index",{stale:"update_after"})]);case 16:return e.abrupt("return",this.__commitDB=r);case 17:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"versionGraph",value:function(){var e=l(regeneratorRuntime.mark(function e(t,r){var n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.__versionDB,e.t0){e.next=5;break}return e.next=4,this._versionDB();case 4:e.t0=e.sent;case 5:return n=e.t0,e.next=8,n.get(t+"/"+r);case 8:return i=e.sent,e.abrupt("return",!i||i.deleted?null:i);case 10:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"_log",value:function(){var e=l(regeneratorRuntime.mark(function e(t,r){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n,i,o,s,a,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.versionGraph(t,r);case 2:if((n=e.sent)&&!n.deleted){e.next=5;break}return e.abrupt("return",[]);case 5:i=n.refs.HEAD,o=[];case 6:if(!o.includes(i)){e.next=9;break}throw new Error("cyclic version graph???");case 9:if(o.push(i),s=n.history[i]||[],a=v(s,1),(i=a[0])&&!(o.length>=u)){e.next=15;break}return e.abrupt("break",17);case 15:e.next=6;break;case 17:return e.abrupt("return",o);case 18:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"_findTimestampedVersionsOfObjectNamed",value:function(){var e=l(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,l,f,p,d,m,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=v.include_docs,n=void 0===r||r,i=v.descending,o=void 0===i||i,s=v.startTime,a=void 0===s?"0".repeat(13):s,u=v.endTime,c=void 0===u?"9".repeat(13):u,l=t+"\0"+(o?c:a),f=t+"\0"+(o?a:c),e.t0=this.__commitDB,e.t0){e.next=15;break}return e.next=14,this._commitDB();case 14:e.t0=e.sent;case 15:return p=e.t0,e.next=18,p.pouchdb.query("nameAndTimestamp_index",h({},v,{descending:o,include_docs:n,startkey:l,endkey:f}));case 18:return d=e.sent,m=d.rows,e.abrupt("return",n?m.map(function(e){return e.doc}):m.map(function(e){return e.id}));case 21:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_versionDB",value:function(){var e=l(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.__versionDB){e.next=2;break}return e.abrupt("return",this.__versionDB);case 2:if(t=this.name+"-version-graph",!(r=w.findDB(t))){e.next=5;break}return e.abrupt("return",this.__versionDB=r);case 5:return r=w.ensureDB(t),e.abrupt("return",this.__versionDB=r);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"exportToDir",value:function(){var e=l(regeneratorRuntime.mark(function e(t,r){var n,i,o,s,a,u,c,l=this,f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.__commitDB,e.t0){e.next=5;break}return e.next=4,this._commitDB();case 4:e.t0=e.sent;case 5:n=e.t0,i=!0,o=!1,s=void 0,e.prev=10,a=regeneratorRuntime.mark(function e(){var r,n,i,o,s,a,u,h,d,m,v,y,g,b,_,x,w,k;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.value,n=r.name,i=r.type,o=t.join(i).join(n).asDirectory(),e.next=5,l.versionGraph(i,n);case 5:return s=e.sent,a=s.refs,u=s.history,h=Object.keys(u),e.next=11,l.getCommitsWithIds(h);case 11:return d=e.sent,p||(d=d.filter(function(e){return!e.deleted})),m=f?d.map(function(e){delete e._rev;var t=l.snapshotResourceFor(e);return{from:t,to:o.join(t.parent().name()+"/"+t.name())}}):[],f||d.forEach(function(e){delete e._rev}),e.next=17,o.ensureExistance();case 17:return e.next=19,o.join("index.json").writeJson({name:n,type:i});case 19:return e.next=21,o.join("commits.json").writeJson(d);case 21:return e.next=23,o.join("history.json").writeJson({refs:a,history:u});case 23:v=!0,y=!1,g=void 0,e.prev=26,b=m[Symbol.iterator]();case 28:if(v=(_=b.next()).done){e.next=36;break}return x=_.value,w=x.from,k=x.to,e.next=33,w.copyTo(k);case 33:v=!0,e.next=28;break;case 36:e.next=42;break;case 38:e.prev=38,e.t0=e.catch(26),y=!0,g=e.t0;case 42:e.prev=42,e.prev=43,!v&&b.return&&b.return();case 45:if(e.prev=45,!y){e.next=48;break}throw g;case 48:return e.finish(45);case 49:return e.finish(42);case 50:case"end":return e.stop()}},e,l,[[26,38,42,50],[43,,45,49]])}),u=r[Symbol.iterator]();case 13:if(i=(c=u.next()).done){e.next=18;break}return e.delegateYield(a(),"t1",15);case 15:i=!0,e.next=13;break;case 18:e.next=24;break;case 20:e.prev=20,e.t2=e.catch(10),o=!0,s=e.t2;case 24:e.prev=24,e.prev=25,!i&&u.return&&u.return();case 27:if(e.prev=27,!o){e.next=30;break}throw s;case 30:return e.finish(27);case 31:return e.finish(24);case 32:case"end":return e.stop()}},e,this,[[10,20,24,32],[25,,27,31]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"exportToSpecs",value:function(){var e=l(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,l,f,p,h,d,m,v,y,g,b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],t){e.next=10;break}return t=[],e.next=5,this.objectStats();case 5:if(e.t0=e.sent,e.t0){e.next=8;break}e.t0={};case 8:n=e.t0;for(i in n)for(o in n[i])t.push({type:i,name:o});case 10:s=!0,a=!1,u=void 0,e.prev=13,c=t[Symbol.iterator]();case 15:if(s=(l=c.next()).done){e.next=33;break}return f=l.value,p=f.name,h=f.type,e.next=20,this.versionGraph(h,p);case 20:return d=e.sent,m=d.refs,v=d.history,y=Object.keys(v),e.next=26,this.getCommitsWithIds(y);case 26:g=e.sent,b||(g=g.filter(function(e){return!e.deleted})),g.forEach(function(e){delete e._rev}),r.push({type:h,name:p,commits:g,history:{refs:m,history:v}});case 30:s=!0,e.next=15;break;case 33:e.next=39;break;case 35:e.prev=35,e.t1=e.catch(13),a=!0,u=e.t1;case 39:e.prev=39,e.prev=40,!s&&c.return&&c.return();case 42:if(e.prev=42,!a){e.next=45;break}throw u;case 45:return e.finish(42);case 46:return e.finish(39);case 47:return e.abrupt("return",r);case 48:case"end":return e.stop()}},e,this,[[13,35,39,47],[40,,42,46]])}));return function(t){return e.apply(this,arguments)}}()},{key:"importFromDir",value:function(){var e=l(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,f,p,h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=function(){var e=l(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([t.join("index.json").readJson(),t.join("commits.json").readJson(),t.join("history.json").readJson()]);case 2:if(r=e.sent,n=v(r,3),i=n[0],o=i.type,s=i.name,a=n[1],u=n[2],!m){e.next=15;break}return e.next=12,t.dirList(1,{exclude:function(e){return!e.isDirectory()}});case 12:e.t0=e.sent,e.next=16;break;case 15:e.t0=[];case 16:return c=e.t0,e.abrupt("return",{dir:t,type:o,name:s,commits:a,history:u,snapshotDirs:c});case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.dirList(3,{exclude:function(e){return!e.isDirectory()&&"index.json"!==e.name()}});case 2:r=(r=e.sent).filter(function(e){return"index.json"===e.name()}),n=r.map(function(e){return e.parent()}),i=this.snapshotLocation,o=[],s=!0,a=!1,u=void 0,e.prev=9,c=n[Symbol.iterator]();case 11:if(s=(f=c.next()).done){e.next=21;break}return p=f.value,e.t0=o,e.next=16,d(p);case 16:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 18:s=!0,e.next=11;break;case 21:e.next=27;break;case 23:e.prev=23,e.t2=e.catch(9),a=!0,u=e.t2;case 27:e.prev=27,e.prev=28,!s&&c.return&&c.return();case 30:if(e.prev=30,!a){e.next=33;break}throw u;case 33:return e.finish(30);case 34:return e.finish(27);case 35:return e.abrupt("return",this.importFromSpecs(o,h,m));case 36:case"end":return e.stop()}},e,this,[[9,23,27,35],[28,,30,34]])}));return function(t){return e.apply(this,arguments)}}()},{key:"importFromSpecs",value:function(){var e=l(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,l,f,p,h,d,m,v,y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],g=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(y){e.next=36;break}if(e.t0=this.__versionDB,e.t0){e.next=6;break}return e.next=5,this._versionDB();case 5:e.t0=e.sent;case 6:r=e.t0,n=!0,i=!1,o=void 0,e.prev=10,s=t[Symbol.iterator]();case 12:if(n=(a=s.next()).done){e.next=22;break}return u=a.value,c=u.type,l=u.name,e.next=17,r.get(c+"/"+l);case 17:if(!e.sent){e.next=19;break}throw new Error("Import failed: object "+c+"/"+l+" already exists and overwrite is not allowed");case 19:n=!0,e.next=12;break;case 22:e.next=28;break;case 24:e.prev=24,e.t1=e.catch(10),i=!0,o=e.t1;case 28:e.prev=28,e.prev=29,!n&&s.return&&s.return();case 31:if(e.prev=31,!i){e.next=34;break}throw o;case 34:return e.finish(31);case 35:return e.finish(28);case 36:f=!0,p=!1,h=void 0,e.prev=39,d=t[Symbol.iterator]();case 41:if(f=(m=d.next()).done){e.next=48;break}return v=m.value,e.next=45,this.importFromSpec(v,!0,g);case 45:f=!0,e.next=41;break;case 48:e.next=54;break;case 50:e.prev=50,e.t2=e.catch(39),p=!0,h=e.t2;case 54:e.prev=54,e.prev=55,!f&&d.return&&d.return();case 57:if(e.prev=57,!p){e.next=60;break}throw h;case 60:return e.finish(57);case 61:return e.finish(54);case 62:return e.abrupt("return",t);case 63:case"end":return e.stop()}},e,this,[[10,24,28,36],[29,,31,35],[39,50,54,62],[55,,57,61]])}));return function(t){return e.apply(this,arguments)}}()},{key:"importFromSpec",value:function(){var e=l(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.__versionDB,e.t0){e.next=5;break}return e.next=4,this._versionDB();case 4:e.t0=e.sent;case 5:if(r=e.t0,e.t1=this.__commitDB,e.t1){e.next=11;break}return e.next=10,this._commitDB();case 10:e.t1=e.sent;case 11:if(n=e.t1,i=this.snapshotLocation,o=t.type,s=t.name,a=t.commits,u=t.history,c=t.snapshotDirs,e.t2=!l,!e.t2){e.next=23;break}return e.next=22,r.get(o+"/"+s);case 22:e.t2=e.sent;case 23:if(!e.t2){e.next=25;break}throw new Error("Import failed: object "+o+"/"+s+" already exists and overwrite is not allowed");case 25:return e.next=27,Promise.all([n.setDocuments(a),r.set(o+"/"+s,u)].concat(y(c&&f?c.map(function(e){return e.copyTo(i.join(e.name()).asDirectory())}):[])));case 27:return e.abrupt("return",t);case 28:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"importFromResource",value:function(){var e=l(regeneratorRuntime.mark(function e(t,r,n,i){var o,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.readJson();case 2:if(o=e.sent,e.t0=s,!e.t0){e.next=8;break}return e.next=7,this.has(t,r);case 7:e.t0=e.sent;case 8:if(!e.t0){e.next=11;break}return e.next=11,this.delete(t,r,!1);case 11:return e.abrupt("return",this.commit(t,r,o,i));case 12:case"end":return e.stop()}},e,this)}));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=l(regeneratorRuntime.mark(function e(t,r){var n,i,o,s,a,u,c,l,f,p,d,m,v,y,g,b,_,x,w=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],i=[],e.t0=this.__commitDB,e.t0){e.next=6;break}return e.next=5,this._commitDB();case 5:e.t0=e.sent;case 6:return o=e.t0,s={include_docs:!0,startkey:t+"\0"+r+"\0",endkey:t+"\0"+r+""},e.next=10,o.query("nameAndTimestamp_index",s);case 10:for(a=e.sent,u=a.rows,c=!0,l=!1,f=void 0,e.prev=15,p=u[Symbol.iterator]();!(c=(d=p.next()).done);c=!0)m=d.value,v=m.doc,n.push(this.snapshotResourceFor(v)),i.push(h({},v,{_deleted:!0}));e.next=23;break;case 19:e.prev=19,e.t1=e.catch(15),l=!0,f=e.t1;case 23:e.prev=23,e.prev=24,!c&&p.return&&p.return();case 26:if(e.prev=26,!l){e.next=29;break}throw f;case 29:return e.finish(26);case 30:return e.finish(23);case 31:if(e.t2=this.__versionDB,e.t2){e.next=36;break}return e.next=35,this._versionDB();case 35:e.t2=e.sent;case 36:return y=e.t2,e.next=39,y.get(t+"/"+r);case 39:if(g=e.sent,b=g._id,_=g._rev,x={_id:b,_rev:_,deleted:!0},w){e.next=49;break}return e.next=46,o.setDocuments(i);case 46:return e.next=48,y.setDocuments([x]);case 48:Promise.all(n.map(function(e){return e.remove()}));case 49:return e.abrupt("return",{commits:i,history:x,resources:n});case 50:case"end":return e.stop()}},e,this,[[15,19,23,31],[24,,26,30]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"deleteCommit",value:function(){var e=l(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,l,f,p,d,m,y,g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"HEAD";return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=void 0,!t||"string"==typeof t){e.next=5;break}r=t,e.next=15;break;case 5:if(!t){e.next=15;break}if(e.t0=this.__commitDB,e.t0){e.next=11;break}return e.next=10,this._commitDB();case 10:e.t0=e.sent;case 11:return n=e.t0,e.next=14,n.get(t);case 14:r=e.sent;case 15:if(r){e.next=17;break}throw new Error("commit needed!");case 17:if(e.t1=this.__versionDB,e.t1){e.next=22;break}return e.next=21,this._versionDB();case 21:e.t1=e.sent;case 22:if(i=e.t1,e.t2=this.__commitDB,e.t2){e.next=28;break}return e.next=27,this._commitDB();case 27:e.t2=e.sent;case 28:return o=e.t2,s=r,a=s.name,u=s.type,c=s._id,l=[this.snapshotResourceFor(r)],f=[h({},r,{_deleted:!0})],e.next=37,i.get(u+"/"+a);case 37:if(p=e.sent){e.next=40;break}throw new Error("No history for "+u+"/"+a+"@"+r._id);case 40:if(p.refs[b]){e.next=42;break}throw new Error("Cannot delete commit "+u+"/"+a+"@"+r._id+" b/c it is not where ref "+b+" is pointing!");case 42:if(d=p.history[r._id]||[],m=v(d,1),(y=m[0])||!(Object.keys(p.history).length<=1)){e.next=47;break}p.deleted=!0,e.next=53;break;case 47:if(y){e.next=51;break}throw new Error("Cannot delete commit "+u+"/"+a+"@"+r._id+" b/c it has no ancestor but there are still other commits!");case 51:delete p.history[r._id],p.refs[b]=y;case 53:if(g){e.next=59;break}return e.next=56,o.setDocuments(f);case 56:return e.next=58,i.set(u+"/"+a,p);case 58:Promise.all(l.map(function(e){return e.remove()}));case 59:return e.abrupt("return",{commits:f,history:p,resources:l});case 60:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),A={describe:function(e){var t=this;return l(regeneratorRuntime.mark(function r(){var n,i,o,s;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(s=function(e,t){var r=e.find(function(e){return e.name===t}).node.value.body,n=r.body||[],i=(r.comments||[]).find(function(e){return e.end<n[0].start}),o={name:t,parameters:[],sideEffect:!1,returns:null,description:""};if(i&&i.text.trim()){var s=lively.lang.string.changeIndent(i.text," ",0).split("\n"),a=!0,u=!1,c=void 0;try{for(var l,f=s[Symbol.iterator]();!(a=(l=f.next()).done);a=!0){var p=l.value;if(p.startsWith("ignore-in-doc")){o.description="";break}p.startsWith("side effect:")?o.sideEffect=JSON.parse(p.split(":")[1]):p.startsWith("returns:")?o.returns=p.split(":")[1].trim():o.description+=p+"\n"}}catch(e){u=!0,c=e}finally{try{!a&&f.return&&f.return()}finally{if(u)throw c}}}var h=!0,d=!1,m=void 0;try{for(var v,y=n[Symbol.iterator]();!(h=(v=y.next()).done);h=!0){var g=v.value;if("checkArgs"===lively.lang.Path("declarations.0.init.callee.name").get(g)){var b=lively.lang.Path("declarations.0.id.properties").get(g);b&&(o.parameters=b.map(function(e){return e.key.name}))}}}catch(e){d=!0,m=e}finally{try{!h&&y.return&&y.return()}finally{if(d)throw m}}return o},r.prev=1,t._methodSpecs){r.next=9;break}return r.next=5,lively.modules.module("lively.storage/objectdb.js").source();case 5:n=r.sent,i=lively.ast.parse(n,{withComments:!0}),o=lively.ast.categorizer.findDecls(i),t._methodSpecs=o.filter(function(e){return e.parent&&"ObjectDBInterface"===e.parent.name});case 9:return r.abrupt("return",e?s(t._methodSpecs,e):t._methodSpecs.map(function(e){return s(t._methodSpecs,e.name)}).filter(Boolean));case 12:return r.prev=12,r.t0=r.catch(1),r.abrupt("return","Error in describe "+r.t0);case 15:case"end":return r.stop()}},r,t,[[1,12]])}))()},ensureDB:function(e){var t=this;return l(regeneratorRuntime.mark(function r(){var n,i,o,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=a(e,{db:"string",snapshotLocation:"string|Resource"}),i=n.db,o=n.snapshotLocation,t.next=5,S.find(i);case 5:if(!(s=t.sent)){t.next=8;break}return t.abrupt("return",!1);case 8:return S.named(i,{snapshotLocation:o}),t.abrupt("return",!0);case 10:case"end":return t.stop()}},r,t)}))()},destroyDB:function(e){var t=this;return l(regeneratorRuntime.mark(function r(){var n,i,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=a(e,{db:"string"}),i=n.db,t.next=4,S.find(i);case 4:if(o=t.sent){t.next=7;break}return t.abrupt("return",!1);case 7:return t.next=9,o.destroy();case 9:return t.abrupt("return",!0);case 10:case"end":return t.stop()}},r,t)}))()},fetchCommits:function(e){var t=this;return l(regeneratorRuntime.mark(function r(){var n,i,o,s,u,c,l,f,p,h,d,m,v,y,g,b,_,x,w,k,E,A,D,C,F,O,j,R,B,T,P,I,L,N;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=a(e,{db:"string",ref:"string|undefined",type:"string|undefined",typesAndNames:"Array|undefined",knownCommitIds:"object|undefined",includeDeleted:"boolean|undefined"}),i=n.db,o=n.ref,s=n.type,u=n.typesAndNames,c=n.knownCommitIds,l=n.includeDeleted,t.next=9,S.find(i);case 9:if(f=t.sent,o||(o="HEAD"),f){t.next=13;break}throw new Error("db "+i+" does not exist");case 13:if(t.t0=f.__commitDB,t.t0){t.next=18;break}return t.next=17,f._commitDB();case 17:t.t0=t.sent;case 18:if(p=t.t0,t.t1=f.__versionDB,t.t1){t.next=24;break}return t.next=23,f._versionDB();case 23:t.t1=t.sent;case 24:if(h=t.t1,d={},m={},!u){t.next=49;break}for(v=d.keys=[],y=!0,g=!1,b=void 0,t.prev=31,_=u[Symbol.iterator]();!(y=(x=_.next()).done);y=!0)w=x.value,k=w.type,E=w.name,A=w.ref,v.push(k+"/"+E),A&&(m[k+"/"+E]=A);t.next=39;break;case 35:t.prev=35,t.t2=t.catch(31),g=!0,b=t.t2;case 39:t.prev=39,t.prev=40,!y&&_.return&&_.return();case 42:if(t.prev=42,!g){t.next=45;break}throw b;case 45:return t.finish(42);case 46:return t.finish(39);case 47:t.next=50;break;case 49:s&&(d.startkey=s+'/\0"',d.endkey=s+'/"');case 50:return t.next=52,h.getAll(d);case 52:D=t.sent,C=[],F=!0,O=!1,j=void 0,t.prev=57,R=D[Symbol.iterator]();case 59:if(F=(B=R.next()).done){t.next=70;break}if(!(T=B.value).deleted){t.next=63;break}return t.abrupt("continue",67);case 63:P=T._id,I=T.refs,o=m[P]||o,((L=I[o])&&!c||!c.hasOwnProperty(L))&&C.push(L);case 67:F=!0,t.next=59;break;case 70:t.next=76;break;case 72:t.prev=72,t.t3=t.catch(57),O=!0,j=t.t3;case 76:t.prev=76,t.prev=77,!F&&R.return&&R.return();case 79:if(t.prev=79,!O){t.next=82;break}throw j;case 82:return t.finish(79);case 83:return t.finish(76);case 84:return t.next=86,f.getCommitsWithIds(C);case 86:return N=t.sent,l||(N=N.filter(function(e){return!e.deleted})),t.abrupt("return",N);case 89:case"end":return t.stop()}},r,t,[[31,35,39,47],[40,,42,46],[57,72,76,84],[77,,79,83]])}))()},fetchVersionGraph:function(e){var t=this;return l(regeneratorRuntime.mark(function r(){var n,i,o,s,u,c,l,f;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=a(e,{db:"string",type:"string",name:"string"}),i=n.db,o=n.type,s=n.name,t.next=6,S.find(i);case 6:if(u=t.sent){t.next=9;break}throw new Error("db "+i+" does not exist");case 9:return t.next=11,u.versionGraph(o,s);case 11:return c=t.sent,l=c.refs,f=c.history,t.abrupt("return",{refs:l,history:f});case 15:case"end":return t.stop()}},r,t)}))()},fetchLog:function(e){var t=this;return l(regeneratorRuntime.mark(function r(){var n,i,o,s,u,c,l,f,p,h,d,m,y,g,b,_,x,w,k,E;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=a(e,{db:"string",type:"string|undefined",name:"string|undefined",ref:"string|undefined",commit:"string|undefined",limit:"number|undefined",includeCommits:"boolean|undefined",knownCommitIds:"object|undefined"},function(e){return e.type&&e.name||e.commit?null:{error:"Eiter .type + .name or .commit needed!"}}),i=n.db,o=n.type,s=n.name,u=n.ref,c=n.commit,l=n.limit,f=n.includeCommits,p=n.knownCommitIds,t.next=11,S.find(i);case 11:if(h=t.sent,d=u||"HEAD",h){t.next=15;break}throw new Error("db "+i+" does not exist");case 15:if(l||(l=1/0),c||u||(u=d),m=void 0,!c){t.next=27;break}if(m=c,o&&s){t.next=27;break}return t.next=24,h.getCommit(c);case 24:y=t.sent,o=y.type,s=y.name;case 27:return t.next=29,h.versionGraph(o,s);case 29:if(g=t.sent){t.next=32;break}throw new Error("Unknown object "+o+"/"+s);case 32:b=g.refs,_=g.history,m||(m=b[u]),x=m,w=[];case 35:if(!(w.length<l)||w.includes(x)){t.next=44;break}if(w.push(x),(k=_[x])&&k.length){t.next=40;break}return t.abrupt("break",44);case 40:E=v(k,1),x=E[0],t.next=35;break;case 44:if(!f){t.next=49;break}return p&&(w=w.filter(function(e){return!p.hasOwnProperty(e)})),t.next=48,h.getCommitsWithIds(w);case 48:w=t.sent;case 49:return t.abrupt("return",w);case 50:case"end":return t.stop()}},r,t)}))()},fetchSnapshot:function(e){var t=this;return l(regeneratorRuntime.mark(function r(){var n,i,o,s,u,c,l,f,p,h;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=a(e,{db:"string",type:"string|undefined",name:"string|undefined",ref:"string|undefined",commit:"string|undefined"},function(e){return e.type&&e.name||e.commit?null:{error:"Eiter .type + .name or .commit needed!"}}),i=n.db,o=n.type,s=n.name,u=n.ref,c=n.commit,t.next=8,S.find(i);case 8:if(l=t.sent,f="HEAD",u=u||f,l){t.next=13;break}throw new Error("db "+i+" does not exist");case 13:if(c){t.next=22;break}return t.next=16,l.versionGraph(o,s);case 16:if(p=t.sent){t.next=19;break}throw new Error("Unknown object "+o+"/"+s);case 19:if(c=p.refs[u]){t.next=22;break}throw new Error("Cannot find commit for ref "+u+" of "+o+"/"+s);case 22:return t.next=24,l.getCommit(c);case 24:if(h=t.sent){t.next=27;break}throw new Error("Cannot find commit "+c);case 27:return t.abrupt("return",l.loadSnapshot(void 0,void 0,h));case 28:case"end":return t.stop()}},r,t)}))()},commit:function(e){var t=this;return l(regeneratorRuntime.mark(function r(){var n,i,o,s,u,c,l,f,p,h;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=a(e,{db:"string",type:"string",name:"string",ref:"string|undefined",snapshot:"object",preview:"string|undefined",commitSpec:"object",expectedParentCommit:"string|undefined"}),i=n.db,o=n.type,s=n.name,u=n.ref,c=n.expectedParentCommit,l=n.commitSpec,f=n.snapshot,p=n.preview,t.next=11,S.find(i);case 11:return h=t.sent,u||(u="HEAD"),t.abrupt("return",h.commit(o,s,f,l,p,u,c));case 14:case"end":return t.stop()}},r,t)}))()},exportToSpecs:function(e){var t=this;return l(regeneratorRuntime.mark(function r(){var n,i,o,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=a(e,{db:"string",nameAndTypes:"Array|undefined",includeDeleted:"boolean|undefined"}),i=n.db,o=n.nameAndTypes,t.next=5,S.find(i);case 5:if(s=t.sent){t.next=8;break}throw new Error("db "+i+" does not exist");case 8:return t.abrupt("return",s.exportToSpecs(o));case 9:case"end":return t.stop()}},r,t)}))()},exportToDir:function(e){var t=this;return l(regeneratorRuntime.mark(function r(){var i,o,s,u,c,l,f,p;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=a(e,{db:"string",url:"string",nameAndTypes:"Array|undefined",copyResources:"boolean|undefined",includeDeleted:"boolean|undefined"}),o=i.db,s=i.url,u=i.nameAndTypes,c=i.copyResources,l=i.includeDeleted,t.next=8,S.find(o);case 8:if(f=t.sent,p=void 0,f){t.next=12;break}throw new Error("db "+o+" does not exist");case 12:try{p=n.resource(s)}catch(e){p=n.resource(System.baseURL).join(s)}return t.abrupt("return",f.exportToDir(p,u,c,l));case 14:case"end":return t.stop()}},r,t)}))()},importFromDir:function(e){var t=this;return l(regeneratorRuntime.mark(function r(){var i,o,s,u,c,l,f;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=a(e,{db:"string",url:"string",overwrite:"boolean|undefined",copyResources:"boolean|undefined"}),o=i.db,s=i.url,u=i.overwrite,c=i.copyResources,t.next=7,S.find(o);case 7:if(l=t.sent,f=void 0,l){t.next=11;break}throw new Error("db "+o+" does not exist");case 11:try{f=n.resource(s)}catch(e){f=n.resource(System.baseURL).join(s)}return t.abrupt("return",l.importFromDir(f,u,c));case 13:case"end":return t.stop()}},r,t)}))()},importFromSpecs:function(e){var t=this;return l(regeneratorRuntime.mark(function r(){var n,i,o,s,u,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=a(e,{db:"string",specs:"object",overwrite:"boolean|undefined",copyResources:"boolean|undefined"}),i=n.db,o=n.specs,s=n.overwrite,u=n.copyResources,t.next=7,S.find(i);case 7:if(c=t.sent){t.next=10;break}throw new Error("db "+i+" does not exist");case 10:return t.abrupt("return",c.importFromSpecs(o,s,u));case 11:case"end":return t.stop()}},r,t)}))()},importFromResource:function(e){var t=this;return l(regeneratorRuntime.mark(function r(){var i,o,s,u,c,l,f,p,h;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=a(e,{db:"string",type:"string",name:"string",url:"string",commitSpec:"object",purgeHistory:"boolean|undefined"}),o=i.db,s=i.type,u=i.name,c=i.url,l=i.commitSpec,f=i.purgeHistory,t.next=9,S.find(o);case 9:if(p=t.sent,h=void 0,p){t.next=13;break}throw new Error("db "+o+" does not exist");case 13:try{h=n.resource(c)}catch(e){h=n.resource(System.baseURL).join(c)}return t.abrupt("return",p.importFromResource(s,u,h,l,f));case 15:case"end":return t.stop()}},r,t)}))()}},D=(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.origin+"/objectdb/";f(this,e),this.serverURL=t}p(e,[{key:"_processResponse",value:function(){var e=l(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.headers.get("content-type"),e.next=3,t.text();case 3:if(n=e.sent,i=void 0,"application/json"===r)try{i=JSON.parse(n)}catch(e){}if(t.ok&&!i.error){e.next=8;break}throw new Error(i&&i.error||n||t.statusText);case 8:return e.abrupt("return",i||n);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_GET",value:function(){var e=l(regeneratorRuntime.mark(function e(t){var r,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object.keys(i).map(function(e){var t=i[e];return"object"===(void 0===t?"undefined":c(t))&&(t=JSON.stringify(t)),e+"="+encodeURIComponent(t)}).join("&"),n=this.serverURL+t+"?"+r,e.t0=this,e.next=4,fetch(n);case 4:return e.t1=e.sent,e.abrupt("return",e.t0._processResponse.call(e.t0,e.t1));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_POST",value:function(){var e=l(regeneratorRuntime.mark(function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.serverURL+t,e.t0=this,e.next=4,fetch(r,{method:"POST",body:JSON.stringify(n),headers:{"content-type":"application/json"}});case 4:return e.t1=e.sent,e.abrupt("return",e.t0._processResponse.call(e.t0,e.t1));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"describe",value:function(){var e=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("describe",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"ensureDB",value:function(){var e=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("ensureDB",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"destroyDB",value:function(){var e=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("destroyDB",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fetchCommits",value:function(){var e=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("fetchCommits",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fetchVersionGraph",value:function(){var e=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("fetchVersionGraph",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fetchLog",value:function(){var e=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("fetchLog",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fetchSnapshot",value:function(){var e=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("fetchSnapshot",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"commit",value:function(){var e=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("commit",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"exportToSpecs",value:function(){var e=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._GET("exportToSpecs",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"exportToDir",value:function(){var e=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("exportToDir",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"importFromDir",value:function(){var e=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("importFromDir",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"importFromSpecs",value:function(){var e=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("importFromSpecs",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"importFromResource",value:function(){var e=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._POST("importFromResource",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}])}(),/\//g),C=function(e){function t(){return f(this,t),m(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,w),p(t,null,[{key:"ensureDB",value:function(e,r){return function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(n)}(t.__proto__||Object.getPrototypeOf(t),"ensureDB",this).call(this,"lively.storage-"+e,r)}}]),t}(),F={name:"lively.storage",matches:function(e){return e.startsWith("lively.storage:")},resourceClass:function(e){function t(){return f(this,t),m(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,e),p(t,[{key:"read",value:function(){var e=l(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,this.db.get(this.pathWithoutQuery());case 3:return t=e.sent,r=t&&t.content,e.abrupt("return",r?"string"==typeof r?r:JSON.stringify(r):"");case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"readJson",value:function(){var e=l(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.read();case 2:return t=e.sent,e.abrupt("return","string"==typeof t?JSON.parse(t):t);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"write",value:function(){var e=l(regeneratorRuntime.mark(function e(t){var r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t||(t=""),!this.isDirectory()){e.next=4;break}throw new Error("Cannot write into a directory! ("+this.url+")");case 4:return e.next=6,this.db.update(this.pathWithoutQuery(),function(e){if(e&&e.isDirectory)throw new Error(r.url+" already exists and is a directory (cannot write into it!)");var n=Date.now();return e?h({},e,{lastModified:n,size:t.length,content:t}):{etag:void 0,type:void 0,contentType:void 0,user:void 0,group:void 0,mode:void 0,lastModified:n,created:n,size:"string"==typeof t?t.length:0,content:t}});case 6:return e.abrupt("return",this);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"writeJson",value:function(e){return this.write(e)}},{key:"mkdir",value:function(){var e=l(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDirectory()){e.next=3;break}throw new Error("Cannot mkdir a file! ("+this.url+")");case 3:return e.next=5,this.db.get(this.pathWithoutQuery());case 5:if(!(t=e.sent)){e.next=10;break}if(t.isDirectory){e.next=9;break}throw new Error(this.url+" already exists and is a file (cannot mkdir it!)");case 9:return e.abrupt("return",this);case 10:return r=Date.now(),e.next=13,this.db.set(this.pathWithoutQuery(),{etag:void 0,type:void 0,contentType:void 0,user:void 0,group:void 0,mode:void 0,lastModified:r,created:r,isDirectory:!0});case 13:return e.abrupt("return",this);case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"exists",value:function(){var e=l(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.isRoot(),e.t0){e.next=6;break}return e.next=5,this.db.get(this.pathWithoutQuery());case 5:e.t0=!!e.sent;case 6:return e.abrupt("return",e.t0);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=l(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.pathWithoutQuery(),r=this.db,e.next=5,r.docList({startkey:t,endkey:t+""});case 5:return n=e.sent,e.next=8,r.setDocuments(n.map(function(e){return{_id:e.id,_rev:e.rev,_deleted:!0}}));case 8:return e.abrupt("return",this);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"readProperties",value:function(){return this.db.get(this.pathWithoutQuery())}},{key:"dirList",value:function(){var e=l(regeneratorRuntime.mark(function e(){var t,r,n,i,o,s,a,c,l,f,p,h,d,m,v,y=this,g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDirectory()){e.next=3;break}return e.abrupt("return",this.asDirectory().dirList(g,b));case 3:return t=b.exclude,r=this.pathWithoutQuery(),n=[],e.next=8,this.db.getAll({startkey:r,endkey:r+""});case 8:i=e.sent,"infinity"===g&&(g=1/0),o=0;case 11:if(!(o<i.length)){e.next=29;break}if(s=i[o],a=s._id,c=s.isDirectory,a.startsWith(r)&&r!==a){e.next=15;break}return e.abrupt("continue",26);case 15:if(l=a.slice(r.length),!((f=l.includes("/")?l.match(D).length+1:1)>g)){e.next=20;break}if("continue"!==(p=function(){var e=y.join(l.split("/").slice(0,g).join("/")+"/");return n.some(function(t){return t.equals(e)})||n.push(e),"continue"}())){e.next=20;break}return e.abrupt("continue",26);case 20:if(h=this.join(l),!t||u(h,t)){e.next=23;break}return e.abrupt("continue",26);case 23:for(n.push(h),d=["created","lastModified","mode","group","user","contentType","type","etag","size"],m={},v=0;v<d.length;v++)h[d[v]]=s[d[v]];case 26:o++,e.next=11;break;case 29:return e.abrupt("return",n);case 30:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"canDealWithJSON",get:function(){return!0}},{key:"db",get:function(){return this._db||(this._db=C.ensureDB(this.host()))}}]),t}(n.Resource)};n.registerExtension(F),e.Database=w,e.ObjectDB=S,e.ObjectDBInterface=A}(this.lively.storage=this.lively.storage||{},e,t,lively.resources,lively.lang)}.call(r),"undefined"!=typeof module&&module.exports&&(module.exports=r.lively.storage)}()}(),function configure(){function decideAboutTranspiler(e){return e.supportsAsyncAwait?"lively.transpiler":"plugin-babel"}function setupLivelyTranspiler(e){function t(e,t,r){this.System=e,this.moduleId=t,this.env=r}if(e.isBrowser){if("undefined"!=typeof Babel&&(System.global.babel=Babel,delete System.global.Babel),!System.global.babel)return void console.error("[lively.modules] in browser environments babel is required to be loaded before lively.modules!")}else System.global.babel=loadBabel_node();console.log("[lively.modules] SystemJS configured with lively.transpiler & babel"),t.prototype.transpileDoit=function(e,t){var r=this.System,n=(e="(async function(__rec) {\n"+e.replace(/(\/\/# sourceURL=.+)$|$/,"\n}).call(this);\n$1"),r.babelOptions);return n.plugins&&n.plugins.length||n.presets&&n.presets.length?r.global.babel.transform(e,n).code:e},t.prototype.transpileModule=function(e,t){var r=this.System,n=Object.assign({},r.babelOptions);return n.plugins=n.plugins?n.plugins.slice():[],n.plugins.push("transform-es2015-modules-systemjs"),r.global.babel.transform(e,n).code},System.set("lively.transpiler",System.newModule({default:t})),System._loader.transpilerPromise=Promise.resolve({translate:function(e,r){return new t(this,e.name,{}).transpileModule(e.source,{})}}),System.config({transpiler:"lively.transpiler",babelOptions:{sourceMaps:!1,compact:"auto",comments:"true",presets:e.supportsAsyncAwait?[]:["es2015"]}})}function setupPluginBabelTranspiler(e){var t=!!System.get("@system-env").browser,r=t?findSystemJSPluginBabel_browser():findSystemJSPluginBabel_node(),n=System.global.babel;r||n?r?(console.log("[lively.modules] SystemJS configured with systemjs-plugin-babel transpiler from "+r),System.config({map:{"plugin-babel":r+"/plugin-babel.js","systemjs-babel-build":r+(t?"/systemjs-babel-browser.js":"/systemjs-babel-node.js")},transpiler:"plugin-babel",babelOptions:Object.assign({sourceMaps:"inline",stage3:!0,es2015:!0,modularRuntime:!0},System.babelOptions)})):(console.warn("[lively.modules] Could not find path to systemjs-plugin-babel but babel! Will fallback but there might be features in lively.modules that won't work!"),System.config({transpiler:"babel"})):console.error("[lively.modules] Could not find path to systemjs-plugin-babel nor a babel global! This will likely break lively.modules!")}function featureTest(){var isBrowser=System.get("@system-env").browser,supportsAsyncAwait=!1;try{eval("async function foo() {}"),supportsAsyncAwait=!0}catch(e){}return{supportsAsyncAwait:supportsAsyncAwait,isBrowser:isBrowser}}function loadBabel_node(){if(global.Babel&&!global.babel&&(global.babel=global.Babel),global.babel)return global.babel;var e;try{e=require.cache[require.resolve("lively.modules")]}catch(e){}try{e=require.cache[require.resolve(__dirname+"/../")]}catch(e){}if(!e)throw new Error("Cannot find batch to babel-standalone module");var t=require("module").Module._resolveFilename("babel-standalone",e);global.window=global,global.navigator={};var r=require(t);return delete global.navigator,delete global.window,r}function urlQuery(){return"undefined"!=typeof document&&document.location?(document.location.search||"").replace(/^\?/,"").split("&").reduce(function(query,ea){var split=ea.split("="),key=split[0],value=split[1];return"true"===value||"false"===value?value=eval(value):isNaN(Number(value))||(value=Number(value)),query[key]=value,query},{}):{}}function findSystemJSPluginBabel_browser(){for(var e,t=[].slice.call(document.getElementsByTagName("script")),r=t.length-1;r>=0;r--){var n=t[r].src,i=n.indexOf("lively.modules/");if(i>-1){e=n.slice(0,i)+"lively.next-node_modules/systemjs-plugin-babel";break}var o=n.indexOf("systemjs/dist/system");if(o>-1){e=n.slice(0,o)+"systemjs-plugin-babel";break}var s=n.indexOf("core/lively/bootstrap.js");if(s>-1){e=n.slice(0,s)+"node_modules/lively.modules/node_modules/systemjs-plugin-babel";break}var a=n.match(/(.*)generated\/[^\/]+\/combinedModules.js/);if(a){e=a[1]+"node_modules/lively.modules/node_modules/systemjs-plugin-babel";break}}return e}function findSystemJSPluginBabel_node(){if(global.systemjsPluginBabel)return global.systemjsPluginBabel;for(var e=[function(){var e=require.cache[require.resolve("lively.modules")],t=require("module").Module._resolveFilename("systemjs-plugin-babel",e);if(t)return require("path").dirname(t)},function(){var e=require.resolve("systemjs-plugin-babel");if(e)return require("path").dirname(e)},function(){var e=require.resolve(require("path").join(__dirname,"systemjs-babel-node.js"));if(e)return require("path").dirname(e)}],t=0;t<e.length;t++)try{return e[t]()}catch(e){}return null}if(System.useModuleTranslationCache=!urlQuery().noModuleCache,System.get("lively.transpiler")||System.map["plugin-babel"]&&System.map["systemjs-plugin-babel"])console.log("[lively.modules] System seems already to be configured");else{var features=featureTest(),transpiler=decideAboutTranspiler(features);"lively.transpiler"===transpiler?setupLivelyTranspiler(features):"plugin-babel"===transpiler?setupPluginBabelTranspiler():console.error("[lively.modules] could not find System transpiler for platform!")}}(),function(){var semver;!function(e,t){function r(e,t){if(e instanceof n)return e;if("string"!=typeof e)return null;if(e.length>x)return null;if(!(t?k[q]:k[L]).test(e))return null;try{return new n(e,t)}catch(e){return null}}function n(e,t){if(e instanceof n){if(e.loose===t)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>x)throw new TypeError("version is longer than "+x+" characters");if(!(this instanceof n))return new n(e,t);_("SemVer",e,t),this.loose=t;var r=e.trim().match(t?k[q]:k[L]);if(!r)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>w||this.major<0)throw new TypeError("Invalid major version");if(this.minor>w||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>w||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<w)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}function i(e,t){var r=ce.test(e),n=ce.test(t);return r&&n&&(e=+e,t=+t),r&&!n?-1:n&&!r?1:e<t?-1:e>t?1:0}function o(e,t,r){return new n(e,r).compare(new n(t,r))}function s(e,t,r){return o(e,t,r)>0}function a(e,t,r){return o(e,t,r)<0}function u(e,t,r){return 0===o(e,t,r)}function c(e,t,r){return 0!==o(e,t,r)}function l(e,t,r){return o(e,t,r)>=0}function f(e,t,r){return o(e,t,r)<=0}function p(e,t,r,n){var i;switch(t){case"===":"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),i=e===r;break;case"!==":"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),i=e!==r;break;case"":case"=":case"==":i=u(e,r,n);break;case"!=":i=c(e,r,n);break;case">":i=s(e,r,n);break;case">=":i=l(e,r,n);break;case"<":i=a(e,r,n);break;case"<=":i=f(e,r,n);break;default:throw new TypeError("Invalid operator: "+t)}return i}function h(e,t){if(e instanceof h){if(e.loose===t)return e;e=e.value}if(!(this instanceof h))return new h(e,t);_("comparator",e,t),this.loose=t,this.parse(e),this.semver===le?this.value="":this.value=this.operator+this.semver.version,_("comp",this)}function d(e,t){if(e instanceof d)return e.loose===t?e:new d(e.raw,t);if(e instanceof h)return new d(e.value,t);if(!(this instanceof d))return new d(e,t);if(this.loose=t,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(function(e){return this.parseRange(e.trim())},this).filter(function(e){return e.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function m(e,t){return _("comp",e),e=function(e,t){return e.trim().split(/\s+/).map(function(e){return function(e,t){_("caret",e,t);var r=t?k[te]:k[ee];return e.replace(r,function(t,r,n,i,o){_("caret",e,t,r,n,i,o);var s;return v(r)?s="":v(n)?s=">="+r+".0.0 <"+(+r+1)+".0.0":v(i)?s="0"===r?">="+r+"."+n+".0 <"+r+"."+(+n+1)+".0":">="+r+"."+n+".0 <"+(+r+1)+".0.0":o?(_("replaceCaret pr",o),"-"!==o.charAt(0)&&(o="-"+o),s="0"===r?"0"===n?">="+r+"."+n+"."+i+o+" <"+r+"."+n+"."+(+i+1):">="+r+"."+n+"."+i+o+" <"+r+"."+(+n+1)+".0":">="+r+"."+n+"."+i+o+" <"+(+r+1)+".0.0"):(_("no pr"),s="0"===r?"0"===n?">="+r+"."+n+"."+i+" <"+r+"."+n+"."+(+i+1):">="+r+"."+n+"."+i+" <"+r+"."+(+n+1)+".0":">="+r+"."+n+"."+i+" <"+(+r+1)+".0.0"),_("caret return",s),s})}(e,t)}).join(" ")}(e,t),_("caret",e),e=function(e,t){return e.trim().split(/\s+/).map(function(e){return function(e,t){var r=t?k[Y]:k[Q];return e.replace(r,function(t,r,n,i,o){_("tilde",e,t,r,n,i,o);var s;return v(r)?s="":v(n)?s=">="+r+".0.0 <"+(+r+1)+".0.0":v(i)?s=">="+r+"."+n+".0 <"+r+"."+(+n+1)+".0":o?(_("replaceTilde pr",o),"-"!==o.charAt(0)&&(o="-"+o),s=">="+r+"."+n+"."+i+o+" <"+r+"."+(+n+1)+".0"):s=">="+r+"."+n+"."+i+" <"+r+"."+(+n+1)+".0",_("tilde return",s),s})}(e,t)}).join(" ")}(e,t),_("tildes",e),e=function(e,t){return _("replaceXRanges",e,t),e.split(/\s+/).map(function(e){return function(e,t){e=e.trim();var r=t?k[H]:k[G];return e.replace(r,function(t,r,n,i,o,s){_("xRange",e,t,r,n,i,o,s);var a=v(n),u=a||v(i),c=u||v(o),l=c;return"="===r&&l&&(r=""),a?t=">"===r||"<"===r?"<0.0.0":"*":r&&l?(u&&(i=0),c&&(o=0),">"===r?(r=">=",u?(n=+n+1,i=0,o=0):c&&(i=+i+1,o=0)):"<="===r&&(r="<",u?n=+n+1:i=+i+1),t=r+n+"."+i+"."+o):u?t=">="+n+".0.0 <"+(+n+1)+".0.0":c&&(t=">="+n+"."+i+".0 <"+n+"."+(+i+1)+".0"),_("xRange return",t),t})}(e,t)}).join(" ")}(e,t),_("xrange",e),e=function(e,t){return _("replaceStars",e,t),e.trim().replace(k[ae],"")}(e,t),_("stars",e),e}function v(e){return!e||"x"===e.toLowerCase()||"*"===e}function y(e,t,r,n,i,o,s,a,u,c,l,f,p){return t=v(r)?"":v(n)?">="+r+".0.0":v(i)?">="+r+"."+n+".0":">="+t,a=v(u)?"":v(c)?"<"+(+u+1)+".0.0":v(l)?"<"+u+"."+(+c+1)+".0":f?"<="+u+"."+c+"."+l+"-"+f:"<="+a,(t+" "+a).trim()}function g(e,t,r){try{t=new d(t,r)}catch(e){return!1}return t.test(e)}function b(e,t,r,i){e=new n(e,i),t=new d(t,i);var o,u,c,p,m;switch(r){case">":o=s,u=f,c=a,p=">",m=">=";break;case"<":o=a,u=l,c=s,p="<",m="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(g(e,t,i))return!1;for(var v=0;v<t.set.length;++v){var y=null,b=null;if(t.set[v].forEach(function(e){e.semver===le&&(e=new h(">=0.0.0")),y=y||e,b=b||e,o(e.semver,y.semver,i)?y=e:c(e.semver,b.semver,i)&&(b=e)}),y.operator===p||y.operator===m)return!1;if((!b.operator||b.operator===p)&&u(e,b.semver))return!1;if(b.operator===m&&c(e,b.semver))return!1}return!0}e={}.exports=n;var _;_="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:function(){},e.SEMVER_SPEC_VERSION="2.0.0";var x=256,w=Number.MAX_SAFE_INTEGER||9007199254740991,k=e.re=[],E=e.src=[],S=0,A=S++;E[A]="0|[1-9]\\d*";var D=S++;E[D]="[0-9]+";var C=S++;E[C]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var F=S++;E[F]="("+E[A]+")\\.("+E[A]+")\\.("+E[A]+")";var O=S++;E[O]="("+E[D]+")\\.("+E[D]+")\\.("+E[D]+")";var j=S++;E[j]="(?:"+E[A]+"|"+E[C]+")";var R=S++;E[R]="(?:"+E[D]+"|"+E[C]+")";var B=S++;E[B]="(?:-("+E[j]+"(?:\\."+E[j]+")*))";var T=S++;E[T]="(?:-?("+E[R]+"(?:\\."+E[R]+")*))";var P=S++;E[P]="[0-9A-Za-z-]+";var I=S++;E[I]="(?:\\+("+E[P]+"(?:\\."+E[P]+")*))";var L=S++,N="v?"+E[F]+E[B]+"?"+E[I]+"?";E[L]="^"+N+"$";var M="[v=\\s]*"+E[O]+E[T]+"?"+E[I]+"?",q=S++;E[q]="^"+M+"$";var $=S++;E[$]="((?:<|>)?=?)";var W=S++;E[W]=E[D]+"|x|X|\\*";var U=S++;E[U]=E[A]+"|x|X|\\*";var z=S++;E[z]="[v=\\s]*("+E[U]+")(?:\\.("+E[U]+")(?:\\.("+E[U]+")(?:"+E[B]+")?"+E[I]+"?)?)?";var V=S++;E[V]="[v=\\s]*("+E[W]+")(?:\\.("+E[W]+")(?:\\.("+E[W]+")(?:"+E[T]+")?"+E[I]+"?)?)?";var G=S++;E[G]="^"+E[$]+"\\s*"+E[z]+"$";var H=S++;E[H]="^"+E[$]+"\\s*"+E[V]+"$";var J=S++;E[J]="(?:~>?)";var K=S++;E[K]="(\\s*)"+E[J]+"\\s+",k[K]=new RegExp(E[K],"g");var Q=S++;E[Q]="^"+E[J]+E[z]+"$";var Y=S++;E[Y]="^"+E[J]+E[V]+"$";var X=S++;E[X]="(?:\\^)";var Z=S++;E[Z]="(\\s*)"+E[X]+"\\s+",k[Z]=new RegExp(E[Z],"g");var ee=S++;E[ee]="^"+E[X]+E[z]+"$";var te=S++;E[te]="^"+E[X]+E[V]+"$";var re=S++;E[re]="^"+E[$]+"\\s*("+M+")$|^$";var ne=S++;E[ne]="^"+E[$]+"\\s*("+N+")$|^$";var ie=S++;E[ie]="(\\s*)"+E[$]+"\\s*("+M+"|"+E[z]+")",k[ie]=new RegExp(E[ie],"g");var oe=S++;E[oe]="^\\s*("+E[z]+")\\s+-\\s+("+E[z]+")\\s*$";var se=S++;E[se]="^\\s*("+E[V]+")\\s+-\\s+("+E[V]+")\\s*$";var ae=S++;E[ae]="(<|>)?=?\\s*\\*";for(var ue=0;ue<S;ue++)_(ue,E[ue]),k[ue]||(k[ue]=new RegExp(E[ue]));e.parse=r,e.valid=function(e,t){var n=r(e,t);return n?n.version:null},e.clean=function(e,t){var n=r(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null},e.SemVer=n,n.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},n.prototype.toString=function(){return this.version},n.prototype.compare=function(e){return _("SemVer.compare",this.version,this.loose,e),e instanceof n||(e=new n(e,this.loose)),this.compareMain(e)||this.comparePre(e)},n.prototype.compareMain=function(e){return e instanceof n||(e=new n(e,this.loose)),i(this.major,e.major)||i(this.minor,e.minor)||i(this.patch,e.patch)},n.prototype.comparePre=function(e){if(e instanceof n||(e=new n(e,this.loose)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var r=this.prerelease[t],o=e.prerelease[t];if(_("prerelease compare",t,r,o),void 0===r&&void 0===o)return 0;if(void 0===o)return 1;if(void 0===r)return-1;if(r!==o)return i(r,o)}while(++t)},n.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var r=this.prerelease.length;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);-1===r&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},e.inc=function(e,t,r,i){"string"==typeof r&&(i=r,r=void 0);try{return new n(e,r).inc(t,i).version}catch(e){return null}},e.diff=function(e,t){if(u(e,t))return null;var n=r(e),i=r(t);if(n.prerelease.length||i.prerelease.length){for(var o in n)if(("major"===o||"minor"===o||"patch"===o)&&n[o]!==i[o])return"pre"+o;return"prerelease"}for(var o in n)if(("major"===o||"minor"===o||"patch"===o)&&n[o]!==i[o])return o},e.compareIdentifiers=i;var ce=/^[0-9]+$/;e.rcompareIdentifiers=function(e,t){return i(t,e)},e.major=function(e,t){return new n(e,t).major},e.minor=function(e,t){return new n(e,t).minor},e.patch=function(e,t){return new n(e,t).patch},e.compare=o,e.compareLoose=function(e,t){return o(e,t,!0)},e.rcompare=function(e,t,r){return o(t,e,r)},e.sort=function(t,r){return t.sort(function(t,n){return e.compare(t,n,r)})},e.rsort=function(t,r){return t.sort(function(t,n){return e.rcompare(t,n,r)})},e.gt=s,e.lt=a,e.eq=u,e.neq=c,e.gte=l,e.lte=f,e.cmp=p,e.Comparator=h;var le={};h.prototype.parse=function(e){var t=this.loose?k[re]:k[ne],r=e.match(t);if(!r)throw new TypeError("Invalid comparator: "+e);this.operator=r[1],"="===this.operator&&(this.operator=""),r[2]?this.semver=new n(r[2],this.loose):this.semver=le},h.prototype.toString=function(){return this.value},h.prototype.test=function(e){return _("Comparator.test",e,this.loose),this.semver===le||("string"==typeof e&&(e=new n(e,this.loose)),p(e,this.operator,this.semver,this.loose))},h.prototype.intersects=function(e,t){if(!(e instanceof h))throw new TypeError("a Comparator is required");var r;if(""===this.operator)return r=new d(e.value,t),g(this.value,r,t);if(""===e.operator)return r=new d(this.value,t),g(e.semver,r,t);var n=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),i=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),o=this.semver.version===e.semver.version,s=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),a=p(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),u=p(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return n||i||o&&s||a||u},e.Range=d,d.prototype.format=function(){return this.range=this.set.map(function(e){return e.join(" ").trim()}).join("||").trim(),this.range},d.prototype.toString=function(){return this.range},d.prototype.parseRange=function(e){var t=this.loose;e=e.trim(),_("range",e,t);var r=t?k[se]:k[oe];e=e.replace(r,y),_("hyphen replace",e),e=e.replace(k[ie],"$1$2$3"),_("comparator trim",e,k[ie]),e=(e=(e=e.replace(k[K],"$1~")).replace(k[Z],"$1^")).split(/\s+/).join(" ");var n=t?k[re]:k[ne],i=e.split(" ").map(function(e){return m(e,t)}).join(" ").split(/\s+/);return this.loose&&(i=i.filter(function(e){return!!e.match(n)})),i=i.map(function(e){return new h(e,t)})},d.prototype.intersects=function(e,t){if(!(e instanceof d))throw new TypeError("a Range is required");return this.set.some(function(r){return r.every(function(r){return e.set.some(function(e){return e.every(function(e){return r.intersects(e,t)})})})})},e.toComparators=function(e,t){return new d(e,t).set.map(function(e){return e.map(function(e){return e.value}).join(" ").trim().split(" ")})},d.prototype.test=function(e){if(!e)return!1;"string"==typeof e&&(e=new n(e,this.loose));for(var t=0;t<this.set.length;t++)if(function(e,t){for(var r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length){for(r=0;r<e.length;r++)if(_(e[r].semver),e[r].semver!==le&&e[r].semver.prerelease.length>0){var n=e[r].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0}(this.set[t],e))return!0;return!1},e.satisfies=g,e.maxSatisfying=function(e,t,r){var i=null,o=null;try{var s=new d(t,r)}catch(e){return null}return e.forEach(function(e){s.test(e)&&(i&&-1!==o.compare(e)||(o=new n(i=e,r)))}),i},e.minSatisfying=function(e,t,r){var i=null,o=null;try{var s=new d(t,r)}catch(e){return null}return e.forEach(function(e){s.test(e)&&(i&&1!==o.compare(e)||(o=new n(i=e,r)))}),i},e.validRange=function(e,t){try{return new d(e,t).range||"*"}catch(e){return null}},e.ltr=function(e,t,r){return b(e,t,"<",r)},e.gtr=function(e,t,r){return b(e,t,">",r)},e.outside=b,e.prerelease=function(e,t){var n=r(e,t);return n&&n.prerelease.length?n.prerelease:null},e.intersects=function(e,t,r){return e=new d(e,r),t=new d(t,r),e.intersects(t)},semver=e}({});var GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;this.lively=this.lively||{},function(exports,lively_lang,lively_ast,lively_notifications,lively_vm,lively_resources,lively_classes,semver){"use strict";function install(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.name;(e[t]=lively_lang.fun.wrap(e[t],r)).hookFunc=r,r.hookName=n}function remove$1(e,t,r){for(var n=[],i=e[t];i;)n.push(i),i=i.originalFunction;var o="string"==typeof r?n.find(function(e){return e.hookFunc&&e.hookFunc.hookName===r}):n.find(function(e){return e.hookFunc===r});return!!o&&(lively_lang.arr.remove(n,o),e[t]=n.reduceRight(function(e,t){return lively_lang.fun.wrap(e,t.hookFunc||t)}),!0)}function isInstalled(e,t,r){for(var n=e[t];n;){if(n.hookFunc){if("string"==typeof r&&n.hookFunc.hookName===r)return!0;if(n.hookFunc===r)return!0}n=n.originalFunction}return!1}function computeRequireMap(e){if(e.loads){var t=e.loads;return lively_lang.arr.uniq(Object.keys(loadedModules$1(e)).concat(Object.keys(t))).reduce(function(e,r){var n=t[r]?t[r].depMap:{};return e[r]=Object.keys(n).map(function(e){var t=n[e];return"@empty"===t?t+"/"+e:t}),e},{})}return Object.keys(e._loader.moduleRecords).reduce(function(t,r){return t[r]=e._loader.moduleRecords[r].dependencies.filter(Boolean).map(function(e){return e.name}),t},{})}function prepareNodejsCaching(){var e=System._nodeRequire("fs"),t=System._nodeRequire("path");nodejsCacheDir="/"===process.cwd()?t.join(process.env.HOME,".lively.next"):process.cwd(),e.existsSync(nodejsCacheDir)||e.mkdirSync(nodejsCacheDir)}function prepareCodeForCustomCompile(e,t,r,n,i){t=String(t);var o=n.sourceAccessorName,s=n.recorder,a=n.recorderName,u={topLevelVarRecorder:s,varRecorderName:a,sourceAccessorName:o=o,dontTransform:n.dontTransform,recordGlobals:!0,keepPreviouslyDeclaredValues:!0,declarationWrapperName:n.varDefinitionCallbackName,evalId:n.nextEvalId(),currentModuleAccessor:funcCall(member(funcCall(member(member("__lvVarRecorder","System"),"get"),literal("@lively-env")),"moduleEnv"),literal(r))},c=i?'console.log("[lively.modules] executing module '+r+'");\n':"",l="";"System.global"===a?delete u.declarationWrapperName:(c+='System.get("@lively-env").evaluationStart("'+r+'");\nvar '+a+' = System.get("@lively-env").moduleEnv("'+r+'").recorder;\n\nvar '+o+" = "+JSON.stringify(t)+";\n",l+='\nSystem.get("@lively-env").evaluationEnd("'+r+'");');try{var f=c+lively_vm.evalCodeTransform(t,u)+l;return i&&"undefined"!=typeof $world&&$world.get("log")&&$world.get("log").isText&&($world.get("log").textString=f),{source:f,options:u}}catch(e){return console.error("Error in prepareCodeForCustomCompile of "+r+" "+e.stack),{source:t,options:u}}}function prepareTranslatedCodeForSetterCapture(e,t,r,n,i,o){t=String(t);var s=_extends({},i,{topLevelVarRecorder:n.recorder,varRecorderName:n.recorderName,dontTransform:n.dontTransform,recordGlobals:!0,declarationWrapperName:n.varDefinitionCallbackName,currentModuleAccessor:funcCall(member(funcCall(member(member("__lvVarRecorder","System"),"get"),literal("@lively-env")),"moduleEnv"),literal(r))});n.recorderName;try{var a=lively_vm.evalCodeTransformOfSystemRegisterSetters(t,s);return o&&"undefined"!=typeof $world&&$world.get("log")&&$world.get("log").isText&&($world.get("log").textString+=a),a}catch(e){return console.error("Error in prepareTranslatedCodeForSetterCapture",e.stack),t}}function getCachedNodejsModule(e,t){try{var r=e._nodeRequire("module").Module,n=r._resolveFilename(t.name.replace(/^file:\/\//,""));return r._cache[n]}catch(r){e.debug&&console.log("[lively.modules getCachedNodejsModule] %s unknown to nodejs",t.name)}return null}function addNodejsWrapperSource(e,t){var r=getCachedNodejsModule(e,t);return r?(t.metadata.format="esm",t.source="var exports = System._nodeRequire('"+r.id+"'); export default exports;\n"+lively_lang.properties.allOwnPropertiesOrFunctions(r.exports).map(function(e){return lively_ast.isValidIdentifier(e)?"export var "+e+" = exports['"+e+"'];":'/*ignoring export "'+e+'" b/c it is not a valid identifier*/'}).join("\n"),e.debug&&console.log("[lively.modules customTranslate] loading %s from nodejs module cache",t.name),!0):(e.debug&&console.log("[lively.modules customTranslate] %s not yet in nodejs module cache",t.name),!1)}function instrumentSourceOfEsmModuleLoad(System,load){return System.translate(load).then(function(translated){var parsed=lively_ast.parse(translated),callExpression=parsed.body.find(function(e){return e.expression&&"CallExpression"===e.expression.type&&"register"===e.expression.callee.property.name});if(!callExpression)throw new Error("Cannot find register call in translated source of "+load.name);var registerCall=callExpression.expression,depNames=registerCall.arguments[0].elements.map(function(e){return e.value}),declareFuncNode=registerCall.arguments[1],declareFuncSource=translated.slice(declareFuncNode.start,declareFuncNode.end),declare=eval('var __moduleName = "'+load.name+'";('+declareFuncSource+");\n//# sourceURL="+load.name+"\n");return System.debug&&"undefined"!==$world&&$world.get("log")&&$world.get("log").isText&&($world.get("log").textString=declare),{localDeps:depNames,declare:declare}})}function instrumentSourceOfGlobalModuleLoad(e,t){return e.translate(t).then(function(e){return{translated:e}})}function wrapModuleLoad$1(e){isInstalled(e,"translate","lively_modules_translate_hook")||install(e,"translate",function(t,r){return customTranslate.call(e,t,r)})}function unwrapModuleLoad$1(e){remove$1(e,"translate","lively_modules_translate_hook")}function scheduleModuleExportsChange(e,t,r,n,i){var o=e.get("@lively-env").pendingExportChanges,s=module$2(e,t).record();if(s&&(r in s.exports||i)){(o[t]||(o[t]={}))[r]=n}}function runScheduledExportChanges(e,t){var r=e.get("@lively-env").pendingExportChanges[t];r&&(clearPendingModuleExportChanges(e,t),updateModuleExports(e,t,r))}function clearPendingModuleExportChanges(e,t){delete e.get("@lively-env").pendingExportChanges[t]}function updateModuleExports(e,t,r){var n=e.debug;module$2(e,t).updateRecord(function(i){var o=[],s=[];if(Object.keys(r).forEach(function(e){var a=r[e];n&&console.log("[lively.vm es6 updateModuleExports] %s export %s = %s",t,e,String(a).slice(0,30).replace(/\n/g,"")+"...");var u=!(e in i.exports);u&&(i.__lively_modules__.evalOnlyExport[e]=!0),i.exports[e]=a,u?o.push(e):s.push(e)}),o.length){var a=e.get(t);Object.isFrozen(a)?(console.warn("[lively.vm es6 updateModuleExports] Since module %s is frozen a new module object was installed in the system. Note that only(!) exisiting module bindings are updated. New exports that were added will only be available in already loaded modules after those are reloaded!",t),e.set(t,e.newModule(i.exports))):(n&&console.log("[lively.vm es6 updateModuleExports] adding new exports to %s",t),o.forEach(function(e){Object.defineProperty(a,e,{configurable:!1,enumerable:!0,get:function(){return i.exports[e]},set:function(){throw new Error("exports cannot be changed from the outside")}})}))}if(s.length){n&&console.log("[lively.vm es6 updateModuleExports] updating %s dependents of %s",i.importers.length,t);for(var u=0,c=i.importers.length;u<c;u++){var l=i.importers[u];if(!l.locked){var f;if(l.dependencies.some(function(e,t){return f=t,e&&e.name===i.name})){if(n){var p=module$2(e,l.name);console.log("[lively.vm es6 updateModuleExports] calling setters of "+p.package().name+"/"+p.pathInPackage())}module$2(e,l.name).evaluationStart(),l.setters[f](i.exports),module$2(e,l.name).evaluationEnd()}}}}})}function doInstantiateGlobalModule(e,t){var r={name:null,deps:null,originalIndices:null,declare:null,execute:null,executingRequire:!1,declarative:!1,normalizedDeps:null,groupIndex:null,evaluated:!1,module:null,esModule:null,esmExports:!1};r.name=t.name,r.esmExports=!0,t.metadata.entry=r,r.deps=[];for(var n in t.metadata.globals){var i=t.metadata.globals[n];i&&r.deps.push(i)}return r.execute=function(r,n,i){var o=module$2(e,i.id).metadata();(n=o&&o.entry&&o.entry.module&&o.entry.module.exports)&&Object.keys(n).forEach(function(t){try{delete e.global[t]}catch(e){console.warn('[lively.modules] executeGlobalModule: Cannot delete global["'+t+'"]')}});var s;if(t.metadata.globals){s={};for(var a in t.metadata.globals)t.metadata.globals[a]&&(s[a]=r(t.metadata.globals[a]))}var u=t.metadata.exports;u&&(t.source+='\nSystem.global["'+u+'"] = '+u+";");var c=e.get("@@global-helpers").prepareGlobal(module$2.id,u,s);return __evaluateGlobalLoadSource(e,t),c()},runExecuteOfGlobalModule(e,r)}function __createEntry(){return{name:null,deps:null,originalIndices:null,declare:null,execute:null,executingRequire:!1,declarative:!1,normalizedDeps:null,groupIndex:null,evaluated:!1,module:null,esModule:null,esmExports:!1}}function __evaluateGlobalLoadSource(e,t){function r(){0==--o&&(s.System=s.SystemJS=i),n=void 0}var n,i,o=0,s=e.global;return function(e){try{!function(e,t){0==o++&&(i=s.System),s.System=s.SystemJS=e}(this),n=e,(0,eval)(e.source),r()}catch(t){throw r(),new Error("Error evaluating "+e.address+":\n"+t.stack)}}.call(e,t)}function runExecuteOfGlobalModule(e,t){var r={},n=t.module={exports:r,id:t.name};t.evaluated=!0;var i=t.execute.call(e.global,function(r){var n=t.deps.find(function(e){return e===r}),i=n&&e.get(t.normalizedDeps[t.deps.indexOf(n)])||e.get(e.decanonicalize(r,t.name));if(i)return i;throw new Error("Module "+r+" not declared as a dependency of "+t.name)},r,n);i&&(n.exports=i),r=n.exports;var o=e.get("@system-env").constructor;return r&&(r.__esModule||r instanceof o)?t.esModule=r:t.esmExports&&r!==e.global?t.esModule=e.newModule(r):t.esModule={default:r},t}function isURL(e){return/^[^:\\]+:\/\//.test(e)}function urlResolve(e){var t=e.match(/^([^:]+:\/\/)(.*)/);if(!t)return e;var r=t[1],n=t[2],i=n;do{i=(n=i).replace(/\/[^\/]+\/\.\./,"")}while(i!=n);return i=i.replace(/(^|[^:])[\/]+/g,"$1/"),i=i.replace(/\/\.\//g,"/"),r+i}function isAbsolute(e){return e.startsWith("/")||e.startsWith("http:")||e.startsWith("https:")||e.startsWith("file:")||e.match(urlStartRe)}function ensureResource(e){return e.isResource?e:lively_resources.resource(e)}function normalizePackageURL(e,t){if((arguments.length>2&&void 0!==arguments[2]?arguments[2]:[]).some(function(e){return e===t}))return t;var r=e.decanonicalize(t.replace(/[\/]+$/,"")+"/");if(!isURL(r))throw new Error("Strange package URL: "+r+" is not a valid URL");return(r=r.match(/\.js/)?r.indexOf(r+".js")>-1?r.replace(/\.js$/,""):r.split("/").slice(0,-1).join("/"):r).match(/\.js$/)&&console.warn("packageURL is expected to point to a directory but seems to be a .js file: "+r),String(r).replace(/\/$/,"")}function lookupPackage$1(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=PackageRegistry$$1.ofSystem(e),i=n.allPackageURLs(),o=r?t:normalizePackageURL(e,t,i);return{pkg:n.findPackageWithURL(o),url:o,allPackageURLs:i,registry:n}}function ensurePackage$1(e,t){var r=lookupPackage$1(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),n=r.pkg,i=r.url,o=r.registry;return n||o.addPackageAt(i,"devPackageDirs")}function getPackage$1(e,t){var r=lookupPackage$1(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),n=r.pkg,i=r.url;if(n)return n;throw new Error("[getPackage] package "+t+" (as "+i+") not found")}function applyConfig$1(e,t,r){return getPackage$1(e,r).updateConfig(t)}function importPackage$1(e,t){return Promise.resolve(ensurePackage$1(e,t)).then(function(e){return e.import()})}function removePackage$2(e,t){var r=lookupPackage$1(e,t),n=r.pkg;r.url,r.registry;return n?n.remove():null}function reloadPackage$1(e,t,r){return getPackage$1(e,t).reload(r)}function registerPackage$1(e,t,r){return Promise.resolve(ensurePackage$1(e,t)).then(function(e){return e.register(r)})}function getPackageSpecs(e){return Package.allPackages(e).map(function(e){return e.asSpec()})}function ensureParent(e,t,r){if(r)return r;var n=e.id,i=e.System,o=n.startsWith("file://")?n.replace("file://",""):n;if(r=i._nodeRequire("module").Module._cache[n])return r;r={id:o,filename:o,paths:[]};var s=e.package();return s&&r.paths.push(lively_resources.resource(s.url).join("node_modules/").path()),r}function relative(e,t){return lively_resources.resource(e.id).parent().join(t).url.replace("file://","")}function _require(e,t,r){r=ensureParent(e);var n=e.System._nodeRequire("module");return t.startsWith(".")&&(t=relative(e,t)),n._load(t,r)}function _resolve(e,t,r){r=ensureParent(e);var n=e.System._nodeRequire("module");return t.startsWith(".")&&(t=relative(e,t)),n._resolveFilename(t,r)}function module$2(e,t,r){var n=livelySystemEnv(e),i=e.decanonicalize(t,r);return n.loadedModules[i]||(n.loadedModules[i]=new ModuleInterface(e,i))}function isModuleLoaded$1(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=livelySystemEnv(e);return(r?t:e.normalizeSync(t))in n.loadedModules}function livelyProtocol(e,t){var r=t.match(livelyURLRe);if(!r)return e(t);var n=slicedToArray(r,3),i=(n[0],n[1],n[2]);return{read:function(){var e="undefined"!=typeof $world&&$world.getMorphWithId(i);return Promise.resolve(e?e.textString:"/*Could not locate "+i+"*/")},write:function(e){var t="undefined"!=typeof $world&&$world.getMorphWithId(i);return t?(t.textString=e,Promise.resolve(this)):Promise.reject("Could not save morph "+i)}}}function wrapResource(e){e.resource=lively_resources.resource,isInstalled(e,"fetch",fetchResource)&&remove$1(e,"fetch","fetchResource"),install(e,"fetch",fetchResource),isInstalled(e,"resource","livelyProtocol")&&remove$1(e,"fetch","livelyProtocol"),install(e,"resource",livelyProtocol)}function livelySystemEnv(e){return{moduleEnv:function(t){return module$2(e,t)},get itself(){return e.get(e.decanonicalize("lively.modules/index.js"))},evaluationStart:function(t){module$2(e,t).evaluationStart()},evaluationEnd:function(t){module$2(e,t).evaluationEnd()},dumpConfig:function(){return JSON.stringify({baseURL:e.baseURL,transpiler:e.transpiler,defaultJSExtensions:e.defaultJSExtensions,map:e.map,meta:e.meta,packages:e.packages,paths:e.paths,packageConfigPaths:e.packageConfigPaths},null,2)},get packageRegistry(){return e["__lively.modules__packageRegistry"]},set packageRegistry(t){e["__lively.modules__packageRegistry"]=t},packages:e["__lively.modules__packages"]||(e["__lively.modules__packages"]={}),loadedModules:e["__lively.modules__loadedModules"]||(e["__lively.modules__loadedModules"]={}),pendingExportChanges:e["__lively.modules__pendingExportChanges"]||(e["__lively.modules__pendingExportChanges"]={}),notifications:e["__lively.modules__notifications"]||(e["__lively.modules__notifications"]=[]),notificationSubscribers:e["__lively.modules__notificationSubscribers"]||(e["__lively.modules__notificationSubscribers"]={}),options:e["__lively.modules__options"]||(e["__lively.modules__options"]=lively_lang.obj.deepCopy(defaultOptions)),onLoadCallbacks:e["__lively.modules__onLoadCallbacks"]||(e["__lively.modules__onLoadCallbacks"]=[]),modulePackageMapCache:e["__lively.modules__modulePackageMapCache"]}}function systems(){return SystemClass.systems}function nameOfSystem(e){return Object.keys(systems()).detect(function(t){return systems()[t]===e})}function getSystem(e,t){return e&&"string"!=typeof e?e:systems()[e]||(systems()[e]=makeSystem(t))}function removeSystem(e){var t=e&&"string"!=typeof e?nameOfSystem(e):e;delete systems()[t]}function makeSystem(e){return prepareSystem(new SystemClass,e)}function prepareSystem(e,t){e.trace=!0;var r=(t=t||{}).hasOwnProperty("useModuleTranslationCache")?t.useModuleTranslationCache:!urlQuery().noModuleCache;e.useModuleTranslationCache=r,e.set("@lively-env",e.newModule(livelySystemEnv(e)));var n="undefined"!=typeof process&&process.versions&&process.versions.electron;if(n&&e.set("@system-env",e.newModule(_extends({electron:n},e.get("@system-env")))),wrapResource(e),wrapModuleLoad$1(e),isInstalled(e,"normalizeHook")||install(e,"normalize",normalizeHook),isInstalled(e,"decanonicalize","decanonicalizeHook")||install(e,"decanonicalize",decanonicalizeHook),isInstalled(e,"normalizeSync","decanonicalizeHook")||install(e,"normalizeSync",decanonicalizeHook),isInstalled(e,"newModule","newModule_volatile")||install(e,"newModule",newModule_volatile),isInstalled(e,"instantiate","instantiate_triggerOnLoadCallbacks")||install(e,"instantiate",instantiate_triggerOnLoadCallbacks),n){var i=["electron"].reduce(function(e,t){return e[t]="@node/"+t,e},{});t.map=lively_lang.obj.merge(i,t.map)}if(isNode){i=["addons","assert","buffer","child_process","cluster","console","crypto","dgram","dns","domain","events","fs","http","https","module","net","os","path","punycode","querystring","readline","repl","stream","stringdecoder","timers","tls","tty","url","util","v8","vm","zlib"].reduce(function(e,t){return e[t]="@node/"+t,e},{});t.map=lively_lang.obj.merge(i,t.map)}return t.packageConfigPaths=t.packageConfigPaths||["./node_modules/*/package.json"],t.transpiler||"traceur"!==e.transpiler||("lively.transpiler"===initialSystem.transpiler?(e.set("lively.transpiler",initialSystem.get("lively.transpiler")),e._loader.transpilerPromise=initialSystem._loader.transpilerPromise,e.config({transpiler:"lively.transpiler",babelOptions:Object.assign(initialSystem.babelOptions||{},t.babelOptions)})):e.config({map:{"plugin-babel":initialSystem.map["plugin-babel"],"systemjs-babel-build":initialSystem.map["systemjs-babel-build"]},transpiler:initialSystem.transpiler,babelOptions:Object.assign(initialSystem.babelOptions||{},t.babelOptions)})),e.config(t),e}function urlQuery(){return"undefined"!=typeof document&&document.location?(document.location.search||"").replace(/^\?/,"").split("&").reduce(function(query$$1,ea){var split=ea.split("="),key=split[0],value=split[1];return"true"===value||"false"===value?value=eval(value):isNaN(Number(value))||(value=Number(value)),query$$1[key]=value,query$$1},{}):{}}function preNormalize(e,t,r){".."===t&&(t="../index.js"),t=t.replace(doubleSlashRe,function(e){return":"===e[0]?e:e[0]+"/"});var n=e.get("@lively-env").packageRegistry;if(n){var i=r&&n.findPackageHavingURL(r);if(i){var o=i.map,s=i.url,a=o&&o[t]||e.map[t];a&&("object"===(void 0===a?"undefined":_typeof(a))&&(a=normalize_doMapWithObject(a,i,e)),"string"==typeof a&&""!==a&&(t=a),t.startsWith(".")&&(t=urlResolve(join(s,t))))}}if(n){var u=n.resolvePath(t,r);u&&(u.endsWith("/")&&!t.endsWith("/")&&(u=u.slice(0,-1)),!u.endsWith("/")&&t.endsWith("/")&&(u+="/"),t=u)}return t}function postNormalize(e,t,r){var n=t.replace(jsExtRe,"");if(t.endsWith("/"))return t;var i=e.get("@lively-env").packageRegistry;if(i){var o=i.findPackageWithURL(n);if(o){var s=(o.main||"index.js").replace(dotSlashStartRe,"");return n.replace(trailingSlashRe,"")+"/"+s}}else if(n in e.packages){if(s=e.packages[n].main){return n.replace(trailingSlashRe,"")+"/"+s.replace(dotSlashStartRe,"")}}var a=t.match(jsonJsExtRe);return a?a[1]:t}function normalizeHook(e,t,r,n){var i=this,o=preNormalize(i,t,r);return e(o,r,n).then(function(e){var r=postNormalize(i,e||o);return i.debug&&console.log("[normalize] "+t+" => "+r),r})}function decanonicalizeHook(e,t,r,n){var i=postNormalize(this,e(preNormalize(this,t,r),r,n));return this.debug&&console.log("[normalizeSync] "+t+" => "+i),i}function normalize_doMapWithObject(e,t,r){var n,i=r.get(t.map["@env"]||"@system-env");for(var o in e){var s="~"==o[0],a=function(e,t){for(var r=e.split(".");r.length;)t=t[r.shift()];return t}(s?o.substr(1):o,i);if(!s&&a||s&&!a){n=e[o];break}}if(n&&"string"!=typeof n)throw new Error("Unable to map a package conditional to a package conditional.");return n}function newModule_volatile(e,t){var r=Object.freeze;Object.freeze=function(e){return e};var n=e(t);return Object.freeze=r,n}function printSystemConfig$1(e){var t={baseURL:(e=getSystem(e)).baseURL,transpiler:e.transpiler,defaultJSExtensions:e.defaultJSExtensions,defaultExtension:e.defaultExtension,map:e.map,meta:e.meta,packages:e.packages,paths:e.paths,packageConfigPaths:e.packageConfigPaths,bundles:e.bundles};return JSON.stringify(t,null,2)}function instantiate_triggerOnLoadCallbacks(e,t){var r=this;return e(t).then(function(e){var n={};return lively_lang.promise.waitFor(6e4,function(){return r.get(t.name)},n).then(function(e){if(e!==n){for(var i=t.name,o=module$2(r,i),s=r.get("@lively-env").onLoadCallbacks,a=s.length;a--;){var u=s[a],c=u.moduleName,l=u.resolved,f=u.callback;if((l?c:r.decanonicalize(c))===i){s.splice(a,1);try{f(o)}catch(e){console.error(e)}}}lively_notifications.emit("lively.modules/moduleloaded",{module:t.name},Date.now(),r)}else console.warn("[lively.modules] instantiate_triggerOnLoadCallbacks for "+t.name+" timed out")}),e})}function whenLoaded$2(e,t,r){var n=e.decanonicalize(t);if(e.get(n))try{r(module$2(e,n))}catch(e){console.error(e)}else e.get("@lively-env").onLoadCallbacks.push({moduleName:t,resolved:!1,callback:r})}function loadedModules$1(e){return e.get("@lively-env").loadedModules}function knownModuleNames(e){var t=e.loads?Object.keys(e.loads):Object.keys(e._loader.moduleRecords);return lively_lang.arr.uniq(t.concat(Object.keys(loadedModules$1(e))))}function resolvePackageDependencies(e,t){var r=_extends({},e.dependencies,e.devDependencies);return Object.keys(r).reduce(function(e,n){var i=r[n],o=lively_lang.obj.values(t).find(function(e){var t=e.name,r=e.version;return t===n&&lively.modules.semver.satisfies(r,i)})||{},s=o.name,a=o.version;return e[n]=s?s+"@"+a:void 0,e},{})}function dependencyGraph(e){var t=lively_lang.obj.values(e),r={};return Object.keys(e).reduce(function(n,i){var o=e[i],s=_extends({},o.dependencies,o.devDependencies);return n[i]=Object.keys(s).map(function(e){return function(e,n){var i=e+"@"+n;if(i in r)return r[i];var o=t.find(function(t){var r=t.name,i=t.version;return r===e&&lively.modules.semver.satisfies(i,n)})||{},s=o.name,a=o.version;return r[i]=s?s+"@"+a:void 0}(e,s[e])}).filter(function(e){return!!e}),n},{})}function changeSystem(e,t){return exports.System=e,t&&(GLOBAL.System=e),e}function loadedModules$$1(){return Object.keys(requireMap())}function module$1(e){return module$2(exports.System,e)}function isModuleLoaded$$1(e,t){return isModuleLoaded$1(exports.System,e,t)}function doesModuleExist$$1(e,t){return doesModuleExist$1(exports.System,e,t)}function printSystemConfig$$1(){return printSystemConfig$1(exports.System)}function whenLoaded$1(e,t){return whenLoaded$2(exports.System,e,t)}function importPackage$$1(e){return importPackage$1(exports.System,e)}function registerPackage$$1(e,t){return registerPackage$1(exports.System,e,t)}function removePackage$1(e){return removePackage$2(exports.System,e)}function reloadPackage$$1(e,t){return reloadPackage$1(exports.System,e,t)}function getPackages(){return getPackageSpecs(exports.System)}function getPackage$$1(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return getPackage$1(exports.System,e,t)}function getPackageOfModule(e){return Package.forModuleId(exports.System,e)}function ensurePackage$$1(e){return ensurePackage$1(exports.System,e)}function applyPackageConfig(e,t){return applyConfig$1(exports.System,e,t)}function lookupPackage$$1(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return lookupPackage$1(exports.System,e,t)}function moduleSourceChange$$1(e,t,r){return moduleSourceChange$1(exports.System,e,t,r)}function requireMap(){return computeRequireMap(exports.System)}function isHookInstalled(e,t){return isInstalled(exports.System,e,t)}function installHook(e,t){return install(exports.System,e,t)}function removeHook(e,t){return remove$1(exports.System,e,t)}function wrapModuleLoad$$1(){wrapModuleLoad$1(exports.System)}function unwrapModuleLoad$$1(){unwrapModuleLoad$1(exports.System)}semver="default"in semver?semver.default:semver;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},asyncToGenerator=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var s=t[i](o),a=s.value}catch(e){return void r(e)}if(!s.done)return Promise.resolve(a).then(function(e){n("next",e)},function(e){n("throw",e)});e(a)}return n("next")})}},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),defineProperty=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},get$1=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(n)},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},set$1=function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var s=Object.getPrototypeOf(t);null!==s&&e(s,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var a=o.set;void 0!==a&&a.call(i,n)}return n},slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),customTranslate=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,s,a,u,c,l,f,p,h,d,m,v,y,g,b,_,x,w,k=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this,i=n.debug,o=r.metadata,!(s=o&&o.hasOwnProperty("instrument")&&!o.instrument||exceptions.some(function(e){return e(r.name)}))){e.next=4;break}return i&&console.log("[lively.modules customTranslate ignoring] %s",r.name),e.abrupt("return",t(r));case 4:if(!isNode$1||!addNodejsWrapperSource(n,r)){e.next=7;break}return i&&console.log("[lively.modules] loaded %s from nodejs cache",r.name),e.abrupt("return",t(r));case 7:if(a=Date.now(),u=detectModuleFormat(r.source,o),c=module$2(n,r.name),l=!1,f="esm"===u,p="cjs"===u,h="global"===u,c.setSource(r.source),e.prev=10,d=n.useModuleTranslationCache,m=n.global.indexedDB,v=d&&String(lively_lang.string.hashCode(r.source)),!(d&&m&&f)){e.next=25;break}return y=n._livelyModulesTranslationCache||(n._livelyModulesTranslationCache=new BrowserModuleTranslationCache),e.next=16,y.fetchStoredModuleSource(r.name);case 16:if(!((g=e.sent)&&g.hash==v&&g.timestamp>=BrowserModuleTranslationCache.earliestDate)){e.next=23;break}if(!g.source){e.next=23;break}return o.format="register",o.deps=[],i&&console.log("[lively.modules customTranslate] loaded %s from browser cache after %sms",r.name,Date.now()-a),e.abrupt("return",Promise.resolve(g.source));case 23:e.next=36;break;case 25:if(!(isNode$1&&d&&f)){e.next=36;break}return y=n._livelyModulesTranslationCache||(n._livelyModulesTranslationCache=new NodeModuleTranslationCache),e.next=29,y.fetchStoredModuleSource(r.name);case 29:if(!((g=e.sent)&&g.hash==v&&g.timestamp>=NodeModuleTranslationCache.earliestDate)){e.next=36;break}if(!g.source){e.next=36;break}return o.format="register",o.deps=[],i&&console.log("[lively.modules customTranslate] loaded %s from filesystem cache after %sms",r.name,Date.now()-a),e.abrupt("return",Promise.resolve(g.source));case 36:e.next=41;break;case 38:e.prev=38,e.t0=e.catch(10),console.error("[lively.modules customTranslate] error reading module translation cache: "+e.t0.stack);case 41:return b={},f?(c.recorderName="__lvVarRecorder",c.recorder===n.global&&c.unloadEnv(),r.metadata.format="esm",_=prepareCodeForCustomCompile(0,r.source,r.name,c,i),b=_.options,x=_.source,r.source=x,r.metadata["lively.modules instrumented"]=!0,l=!0,i&&console.log("[lively.modules] loaded %s as es6 module",r.name)):"global"===r.metadata.format&&(c.recorderName="System.global",c.recorder=n.global,r.metadata.format="global",w=prepareCodeForCustomCompile(0,r.source,r.name,c,i),b=w.options,x=w.source,r.source=x,r.metadata["lively.modules instrumented"]=!0,l=!0,i&&console.log("[lively.modules] loaded %s as instrumented global module",r.name)),l||i&&console.log("[lively.modules] customTranslate ignoring %s b/c don't know how to handle format %s",r.name,r.metadata.format),e.abrupt("return",t(r).then(function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0===t.indexOf("System.register(")&&(i&&console.log("[lively.modules customTranslate] Installing System.register setter captures for %s",r.name),t=prepareTranslatedCodeForSetterCapture(0,t,r.name,c,b,i)),!(isNode$1&&d&&f)){e.next=14;break}return o=n._livelyModulesTranslationCache||(n._livelyModulesTranslationCache=new NodeModuleTranslationCache),e.prev=3,e.next=6,o.cacheModuleSource(r.name,v,t);case 6:i&&console.log("[lively.modules customTranslate] stored cached version in filesystem for %s",r.name),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),console.error("[lively.modules customTranslate] failed storing module cache: "+e.t0.stack);case 12:e.next=25;break;case 14:if(!(d&&m&&f)){e.next=25;break}return o=n._livelyModulesTranslationCache||(n._livelyModulesTranslationCache=new BrowserModuleTranslationCache),e.prev=16,e.next=19,o.cacheModuleSource(r.name,v,t);case 19:i&&console.log("[lively.modules customTranslate] stored cached version for %s",r.name),e.next=25;break;case 22:e.prev=22,e.t1=e.catch(16),console.error("[lively.modules customTranslate] failed storing module cache: "+e.t1.stack);case 25:return i&&console.log("[lively.modules customTranslate] done %s after %sms",r.name,Date.now()-a),e.abrupt("return",t);case 27:case"end":return e.stop()}},e,k,[[3,9],[16,22]])}));return function(t){return e.apply(this,arguments)}}()));case 45:case"end":return e.stop()}},e,this,[[10,38]])}));return function(t,r){return e.apply(this,arguments)}}(),funcCall=lively_ast.nodes.funcCall,member=lively_ast.nodes.member,literal=lively_ast.nodes.literal,isNode$1=System.get("@system-env").node,ModuleTranslationCache=function(){function e(){classCallCheck(this,e)}return createClass(e,[{key:"cacheModuleSource",value:function(e,t,r){throw new Error("not yet implemented")}},{key:"fetchStoredModuleSource",value:function(e){throw new Error("not yet implemented")}},{key:"deleteCachedData",value:function(e){throw new Error("not yet implemented")}}],[{key:"earliestDate",get:function(){return+new Date("Sun Nov 06 2016 16:00:00 GMT-0800 (PST)")}}]),e}(),nodejsCacheDir=null,NodeModuleTranslationCache=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,ModuleTranslationCache),createClass(t,[{key:"ensurePath",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.moduleCacheDir.join(t).exists();case 2:if(!e.sent){e.next=4;break}return e.abrupt("return");case 4:r="",o=!0,s=!1,a=void 0,e.prev=8,u=t.split("/")[Symbol.iterator]();case 10:if(o=(c=u.next()).done){e.next=38;break}return l=c.value,r+=l+"/",n=this.moduleCacheDir.join(r),e.next=16,n.exists();case 16:if(e.sent){e.next=26;break}return e.prev=17,e.next=20,n.mkdir();case 20:e.next=26;break;case 22:if(e.prev=22,e.t0=e.catch(17),"EEXIST"==e.t0.code){e.next=26;break}throw e.t0;case 26:return n=lively_resources.resource("file://"+r+"/package.json"),e.next=29,n.exists();case 29:if(!e.sent){e.next=35;break}return e.next=32,n.read();case 32:return i=e.sent,e.next=35,this.moduleCacheDir.join(r+"/package.json").write(i);case 35:o=!0,e.next=10;break;case 38:e.next=44;break;case 40:e.prev=40,e.t1=e.catch(8),s=!0,a=e.t1;case 44:e.prev=44,e.prev=45,!o&&u.return&&u.return();case 47:if(e.prev=47,!s){e.next=50;break}throw a;case 50:return e.finish(47);case 51:return e.finish(44);case 52:case"end":return e.stop()}},e,this,[[8,40,44,52],[17,22],[45,,47,51]])}));return function(t){return e.apply(this,arguments)}}()},{key:"dumpModuleCache",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=regeneratorRuntime.keys(System._nodeRequire("module").Module._cache);case 1:if((e.t1=e.t0()).done){e.next=16;break}return t=e.t1.value,r=lively_resources.resource("file://"+t),e.next=6,r.exists();case 6:if(!e.sent){e.next=14;break}return e.t2=this,e.t3=t,e.next=11,r.read();case 11:return e.t4=e.sent,e.next=14,e.t2.cacheModuleSource.call(e.t2,e.t3,"NO_HASH",e.t4);case 14:e.next=1;break;case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fetchStoredModuleSource",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t.replace("file://",""),r=t.match(/([^\/]*.)\.js/)[0],n=t.replace(r,""),i=this.moduleCacheDir.join(t),e.next=3,i.exists();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return e.next=7,i.stat();case 7:return o=e.sent,s=o.birthtime,e.next=11,i.read();case 11:return a=e.sent,e.next=14,this.moduleCacheDir.join(n+"/.hash_"+r).read();case 14:return u=e.sent,e.abrupt("return",{source:a,timestamp:s,hash:u});case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cacheModuleSource",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t.replace("file://",""),i=t.match(/([^\/]*.)\.js/)[0],o=t.replace(i,""),e.next=3,this.ensurePath(o);case 3:return e.next=5,this.moduleCacheDir.join(t).write(n);case 5:return e.next=7,this.moduleCacheDir.join(o+"/.hash_"+i).write(r);case 7:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"deleteCachedData",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t.replace("file://",""),r=t.match(/([^\/]*.)\.js/)[0],n=t.replace(r,""),i=this.moduleCacheDir.join(t),e.next=4,i.exists();case 4:if(e.sent){e.next=6;break}return e.abrupt("return",!1);case 6:return e.next=8,i.remove();case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"moduleCacheDir",get:function(){return nodejsCacheDir||prepareNodejsCaching(),lively_resources.resource("file://"+nodejsCacheDir+"/.module_cache/")}}]),t}(),BrowserModuleTranslationCache=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"lively.modules-module-translation-cache";classCallCheck(this,t);var r=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.version=2,r.sourceCodeCacheStoreName="sourceCodeStore",r.dbName=e,r.db=r.openDb(),r}return inherits(t,ModuleTranslationCache),createClass(t,[{key:"openDb",value:function(){var e=this,t=System.global.indexedDB.open(this.version);return new Promise(function(r,n){t.onsuccess=function(e){r(this.result)},t.onerror=function(e){return n(e.target)},t.onupgradeneeded=function(t){return t.currentTarget.result.createObjectStore(e.sourceCodeCacheStoreName,{keyPath:"moduleId"})}})}},{key:"deleteDb",value:function(){var e=System.global.indexedDB.deleteDatabase(this.dbName);return new Promise(function(t,r){e.onerror=function(e){return r(e.target)},e.onsuccess=function(e){return t(e)}})}},{key:"closeDb",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return t=e.sent,r=t.close(),e.abrupt("return",new Promise(function(e,t){r.onsuccess=function(t){e(this.result)},r.onerror=function(e){return t(e.target.errorCode)}}));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"cacheModuleSource",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var i,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return i=e.sent,e.abrupt("return",new Promise(function(e,s){var a=i.transaction([o.sourceCodeCacheStoreName],"readwrite"),u=a.objectStore(o.sourceCodeCacheStoreName),c=Date.now();u.put({moduleId:t,hash:r,source:n,timestamp:c}),a.oncomplete=e,a.onerror=s}));case 4:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"fetchStoredModuleSource",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return r=e.sent,e.abrupt("return",new Promise(function(e,i){var o=r.transaction([n.sourceCodeCacheStoreName]).objectStore(n.sourceCodeCacheStoreName).get(t);o.onerror=i,o.onsuccess=function(t){return e(o.result)}}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"deleteCachedData",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return r=e.sent,e.abrupt("return",new Promise(function(e,i){var o=r.transaction([n.sourceCodeCacheStoreName],"readwrite").objectStore(n.sourceCodeCacheStoreName).delete(t);o.onerror=i,o.onsuccess=function(t){return e(o.result)}}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(),node_modulesDir=System.decanonicalize("lively.modules/node_modules/"),exceptions=[function(e){return!e.endsWith(".js")},function(e){return e.endsWith("dist/acorn.js")||e.endsWith("dist/escodegen.browser.js")||e.endsWith("bowser.js")||e.endsWith("TweenMax.min.js")},function(e){return e.endsWith("babel-core/browser.js")||e.endsWith("system.src.js")||e.includes("systemjs-plugin-babel")}],moduleSourceChange$1=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n,i,o){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.debug&&console.log("[module change] "+r+" "+n.slice(0,50).replace(/\n/g,"")+" "+i),i&&"es6"!==i&&"esm"!==i&&"register"!==i&&"defined"!==i){e.next=8;break}return e.next=5,moduleSourceChangeEsm(t,r,n,o);case 5:s=e.sent,e.next=15;break;case 8:if("global"!==i){e.next=14;break}return e.next=11,moduleSourceChangeGlobal(t,r,n,o);case 11:s=e.sent,e.next=15;break;case 14:throw new Error("moduleSourceChange is not supported for module "+r+" with format "+i);case 15:return lively_notifications.emit("lively.modules/modulechanged",{module:r,newSource:n,options:o},Date.now(),t),e.abrupt("return",s);case 19:throw e.prev=19,e.t0=e.catch(0),lively_notifications.emit("lively.modules/modulechanged",{module:r,newSource:n,error:e.t0,options:o},Date.now(),t),e.t0;case 23:case"end":return e.stop()}},e,this,[[0,19]])}));return function(t,r,n,i,o){return e.apply(this,arguments)}}(),moduleSourceChangeEsm=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n,i){var o,s,a,u,c,l,f,p,h,d,m,v,y,g,b,_,x,w;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.debug,s={status:"loading",source:n,name:r,address:r,linkSets:[],dependencies:[],metadata:{format:"esm"}},e.next=3,instrumentSourceOfEsmModuleLoad(t,s);case 3:a=e.sent,u=function(e,r){return scheduleModuleExportsChange(t,s.name,e,r,!0)},c=a.declare(u),o&&console.log("[lively.vm es6] sourceChange of %s with deps",s.name,a.localDeps),l=[],f=!0,p=!1,h=void 0,e.prev=10,d=a.localDeps[Symbol.iterator]();case 12:if(f=(m=d.next()).done){e.next=25;break}return v=m.value,e.next=16,t.normalize(v,s.name);case 16:return y=e.sent,g=module$2(t,y),e.next=20,g.load();case 20:b=e.sent,l.push({name:v,fullname:y,module:g,exports:b});case 22:f=!0,e.next=12;break;case 25:e.next=31;break;case 27:e.prev=27,e.t0=e.catch(10),p=!0,h=e.t0;case 31:e.prev=31,e.prev=32,!f&&d.return&&d.return();case 34:if(e.prev=34,!p){e.next=37;break}throw h;case 37:return e.finish(34);case 38:return e.finish(31);case 39:return(_=t.loads&&t.loads[s.name])&&(_.deps=l.map(function(e){return e.name}),_.depMap=l.reduce(function(e,t){return e[t.name]=t.fullname,e},{}),_.metadata&&_.metadata.entry&&(_.metadata.entry.deps=_.deps,_.metadata.entry.normalizedDeps=l.map(function(e){return e.fullname}),_.metadata.entry.declare=a.declare)),x=module$2(t,s.name),w=x.record(),l.forEach(function(e,t){return x.addDependencyToModuleRecord(e.module,c.setters[t])}),w&&(w.execute=c.execute),l.forEach(function(e,t){return c.setters[t](e.exports)}),e.abrupt("return",c.execute());case 46:case"end":return e.stop()}},e,this,[[10,27,31,39],[32,,34,38]])}));return function(t,r,n,i){return e.apply(this,arguments)}}(),moduleSourceChangeGlobal=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n,i){var o,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o={status:"loading",source:n,name:r,address:r,linkSets:[],dependencies:[],metadata:{format:"global"}},t.get(r)){e.next=4;break}return e.next=4,t.import(r);case 4:return e.next=6,instrumentSourceOfGlobalModuleLoad(t,o);case 6:return s=e.sent,o.source=s.translated,a=doInstantiateGlobalModule(t,o),t.delete(r),t.set(a.name,a.esModule),e.abrupt("return",a.module);case 12:case"end":return e.stop()}},e,this)}));return function(t,r,n,i){return e.apply(this,arguments)}}(),ModulePackageMapping=function(){function e(t){classCallCheck(this,e),this.System=t,this._notificationHandlers=null,this.clearCache(),this.subscribeToSystemChanges()}return createClass(e,null,[{key:"forSystem",value:function(e){var t=e["__lively.modules__modulePackageMapCache"];if(t)return t;var r=new this(e);return e["__lively.modules__modulePackageMapCache"]=r,r}}]),createClass(e,[{key:"subscribeToSystemChanges",value:function(){var e=this;if(!this._notificationHandlers){var t=this.System;this._notificationHandlers=[lively_notifications.subscribe("lively.modules/moduleloaded",function(t){return e.addModuleIdToCache(t.module)},t),lively_notifications.subscribe("lively.modules/moduleunloaded",function(t){return e.removeModuleFromCache(t.module)},t),lively_notifications.subscribe("lively.modules/packageregistered",function(t){return e.clearCache()},t),lively_notifications.subscribe("lively.modules/packageremoved",function(t){return e.clearCache()},t)]}}},{key:"unsubscribeFromSystemChanges",value:function(){if(this._notificationHandlers){var e=this.System;lively_notifications.unsubscribe("lively.modules/moduleloaded",this._notificationHandlers[0],e),lively_notifications.unsubscribe("lively.modules/moduleunloaded",this._notificationHandlers[1],e),lively_notifications.unsubscribe("lively.modules/packageregistered",this._notificationHandlers[2],e),lively_notifications.unsubscribe("lively.modules/packageremoved",this._notificationHandlers[3],e),this._notificationHandlers=null}}},{key:"clearCache",value:function(){this._cacheInitialized=!1,this.packageToModule={},this.modulesToPackage={},this.modulesWithoutPackage={}}},{key:"ensureCache",value:function(){var e=this.System,t=this._cacheInitialized,r=this.packageToModule,n=this.modulesToPackage,i=this.modulesWithoutPackage;if(t)return this;for(var o=Package.allPackageURLs(e),s=0;s<o.length;s++)r[o[s]]=[];for(var a=knownModuleNames(e),u=0;u<a.length;u++){for(var c=a[u],l=void 0,f=0;f<o.length;f++){var p=o[f];c.startsWith(p)&&(!l||l.length<p.length)&&(l=p)}l?(r[l].push(c),n[c]=l):i[c]={}}return this._cacheInitialized=!0,this}},{key:"addModuleIdToCache",value:function(e){this.ensureCache();var t=this.packageToModule,r=this.modulesToPackage,n=this.modulesWithoutPackage;if(r[e])return r[e];if(n[e])return null;for(var i=Object.keys(t),o=void 0,s=0;s<i.length;s++){var a=i[s];e.startsWith(a)&&(!o||o.length<a.length)&&(o=a)}if(o){return(t[o]||(t[o]=[])).push(e),r[e]=o}return n[e]={},null}},{key:"removeModuleFromCache",value:function(e){if(this._cacheInitialized){var t=this.packageToModule,r=this.modulesToPackage,n=this.modulesWithoutPackage;if(n.hasOwnProperty(e))delete n[e];else{var i=r[e];i&&(delete r[e],t[i]&&lively_lang.arr.remove(t[i],e))}}}},{key:"getPackageURLForModuleId",value:function(e){return this.modulesToPackage[e]||this.addModuleIdToCache(e)}},{key:"getModuleIdsForPackageURL",value:function(e){return this.ensureCache(),this.packageToModule[e]||[]}}]),e}(),join=lively_lang.string.joinPath,PackageConfiguration=function(){function PackageConfiguration(e){classCallCheck(this,PackageConfiguration),this.pkg=e}return createClass(PackageConfiguration,[{key:"applyConfig",value:function(e){var t=this.System,r=this.packageURL,n=this.pkg,i=(e=lively_lang.obj.deepMerge(n.config,e)).name||r.split("/").slice(-1)[0],o=e.version,s=e.systemjs||{},a=e.lively,u=e.main||"index.js";t.config({map:defineProperty({},i,r),packages:defineProperty({},r,_extends({},s,{meta:_extends({"package.json":{format:"json"}},s.meta),configured:!0}))}),t.packages[r].configured=!0;var c=t.getConfig().packages[r]||{};return c.map||(c.map={}),s&&(a&&a.main?u=a.main:s.main&&(u=s.main),this.applySystemJSConfig(s)),u.match(/\.[^\/\.]+/)||(u+=".js"),c.main=u,n.version=o,n.config=e,n._name=i,n.mergeWithConfig(c),a?this.applyLivelyConfig(a):{subPackages:[]}}},{key:"applySystemJSConfig",value:function(e){var t=this.System;e.packageConfigPaths&&(t.packageConfigPaths=lively_lang.arr.uniq(t.packageConfigPaths.concat(e.packageConfigPaths))),e.packages&&t.config({packages:e.packages}),e.globalmap&&t.config({map:e.globalmap}),e.babelOptions&&t.config({babelOptions:e.babelOptions})}},{key:"applyLivelyConfig",value:function(e){this.applyLivelyConfigMeta(e),this.applyLivelyConfigHooks(e),this.applyLivelyConfigBundles(e)}},{key:"applyLivelyConfigHooks",value:function applyLivelyConfigHooks(livelyConfig){var _this=this;(livelyConfig.hooks||[]).forEach(function(h){try{var f=eval("("+h.source+")");f.name&&isInstalled(_this.System,h.target,f.name)||install(_this.System,h.target,f)}catch(e){console.error("Error installing hook for %s: %s",_this.packageURL,e,h)}})}},{key:"applyLivelyConfigBundles",value:function(e){var t=this;if(!e.bundles)return Promise.resolve();var r=Object.keys(e.bundles).reduce(function(r,n){var i=t.packageURL+"/"+n,o=e.bundles[n].map(function(e){return t.System.decanonicalize(e,t.packageURL+"/")});return r[i]=o,r},{});return this.System.config({bundles:r}),Promise.resolve()}},{key:"applyLivelyConfigMeta",value:function(e){if(e.meta){var t=this.System.getConfig().packages[this.packageURL]||{},r={meta:{},packages:defineProperty({},this.packageURL,t)};Object.keys(e.meta).forEach(function(n){var i=e.meta[n];isURL(n)?r.meta[n]=i:(t.meta||(t.meta={}),t.meta[n]=i)}),this.System.config(r)}}},{key:"System",get:function(){return this.pkg.System}},{key:"packageURL",get:function(){return this.pkg.url}}]),PackageConfiguration}(),urlStartRe=/^[a-z\.-_\+]+:/i,PackageRegistry$$1=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};classCallCheck(this,e),this.System=t,this.packageBaseDirs=r.packageBaseDirs||[],this.devPackageDirs=r.devPackageDirs||[],this.individualPackageDirs=r.individualPackageDirs||[],this._readyPromise=null,this.packageMap={},this._byURL=null}return createClass(e,null,[{key:"ofSystem",value:function(e){var t=e.get("@lively-env").packageRegistry;return t||(t=e["__lively.modules__packageRegistry"]=new this(e)),t}},{key:"forDirectory",value:function(e,t){return new this(e,{packageBaseDirs:[ensureResource(t)]})}},{key:"fromJSON",value:function(e,t){return new this(e).fromJSON(t)}}]),createClass(e,[{key:"resetByURL",value:function(){this._byURL=null}},{key:"allPackageURLs",value:function(){return Object.keys(this.byURL)}},{key:"toJSON",value:function(){function e(e){var r=e.url;return r.startsWith(t.baseURL)?r.slice(t.baseURL.length).replace(/^\//,""):r}var t=this.System,r=this.packageMap,n=this.individualPackageDirs,i=this.devPackageDirs,o=this.packageBaseDirs,s={};for(var a in r){var u=r[a];s[a]={},s[a].latest=u.latest,s[a].versions={};for(var c in u.versions)s[a].versions[c]=u.versions[c].toJSON()}return{packageMap:s,individualPackageDirs:n.map(e),devPackageDirs:i.map(e),packageBaseDirs:o.map(e)}}},{key:"fromJSON",value:function(e){function t(e){return isURL(e)?lively_resources.resource(e):lively_resources.resource(n.baseURL).join(e)}var r={},n=this.System,i=lively_resources.resource(n.baseURL);for(var o in e.packageMap){var s=e.packageMap[o];r[o]={},r[o].latest=s.latest,r[o].versions={};for(var a in s.versions){var u=s.versions[a],c=u.url;isAbsolute(c)||(c=i.join(c).url);var l=new Package.fromJSON(n,_extends({},u,{url:c}));r[o].versions[a]=l}}return this.packageMap=r,this.individualPackageDirs=e.individualPackageDirs.map(t),this.devPackageDirs=e.devPackageDirs.map(t),this.packageBaseDirs=e.packageBaseDirs.map(t),this.resetByURL(),ModulePackageMapping.forSystem(n).clearCache(),this}},{key:"updateFromJSON",value:function(e){var t=this.packageMap;for(var r in e.packageMap){var n=e.packageMap[r];t[r]||(t[r]={}),t[r].latest?semver.gt(n.latest,t[r].latest)&&(t[r].latest=n.latest):t[r].latest,t[r].versions||(t[r].versions={});var i=this.System,o=lively_resources.resource(i.baseURL);for(var s in n.versions){var a=n.versions[s],u=a.url;isAbsolute(u)||(u=o.join(u).url);var c=new Package.fromJSON(i,_extends({},a,{url:u}));t[r].versions[s]=c}}return this.resetByURL(),ModulePackageMapping.forSystem(System).clearCache(),this}},{key:"whenReady",value:function(){return this._readyPromise||Promise.resolve()}},{key:"isReady",value:function(){return!this._readyPromise}},{key:"withPackagesDo",value:function(e){for(var t in this.packageMap){var r=this.packageMap[t].versions;for(var n in r)e(r[n])}}},{key:"findPackage",value:function(e){for(var t in this.packageMap){var r=this.packageMap[t].versions;for(var n in r){var i=r[n];if(e(i))return i}}return null}},{key:"filterPackages",value:function(e){var t=[];return this.withPackagesDo(function(r){return e(r)&&t.push(r)}),t}},{key:"allPackages",value:function(){var e=[];for(var t in this.packageMap){var r=this.packageMap[t].versions;for(var n in r)e.push(r[n])}return e}},{key:"sortPackagesByVersion",value:function(e){return e.sort(function(e,t){return semver.compare(e.version,t.version,!0)})}},{key:"matches",value:function(e,t,r){var n=e.name,i=e.version;return n===t&&(!r||!(!semver.validRange(i||"",!0)||!semver.satisfies(i,r,!0)))}},{key:"coversDirectory",value:function(e){e=ensureResource(e).asDirectory();var t=this.packageBaseDirs,r=this.devPackageDirs;if(this.individualPackageDirs.some(function(t){return t.equals(e)}))return"individualPackageDirs";if(r.some(function(t){return t.equals(e)}))return"devPackageDirs";var n=e.parent().parent();return t.some(function(e){return e.equals(n)})?this.allPackages().find(function(t){return ensureResource(t.url).equals(e)})?"packageCollectionDirs":"maybe packageCollectionDirs":null}},{key:"lookup",value:function(e,t){var r=this,n=this.packageMap[e];if(!n)return null;if(!t||"latest"===t)return n.versions[n.latest];if(!semver.validRange(t,!0))throw new Error("PackageRegistry>>lookup of "+e+": Invalid version - "+t);var i=lively_lang.obj.values(n.versions).filter(function(n){return r.matches(n,e,t)});return i.length<=1?i[0]:lively_lang.arr.last(this.sortPackagesByVersion(i))}},{key:"findPackageDependency",value:function(e,t,r){return r||(r=e.dependencies[t]||e.devDependencies[t]),semver.validRange(r,!0)||(r=null),this.lookup(t,r)}},{key:"findPackageWithURL",value:function(e){return e.isResource&&(e=e.url),e.endsWith("/")&&(e=e.slice(0,-1)),this.byURL[e]}},{key:"findPackageHavingURL",value:function(e){e.isResource&&(e=e.url),e.endsWith("/")&&(e=e.slice(0,-1));var t=1/0,r=null,n=this.byURL;for(var i in n)if(0===e.indexOf(i)){var o=e.slice(i.length).length;o>=t||(t=o,r=n[i])}return r}},{key:"findPackageForPath",value:function(e,t){if(isAbsolute(e))return this.findPackageHavingURL(e);if(e.startsWith("."))return null;var r=e.split("/"),n=slicedToArray(r,1)[0];if(!n)return null;var i=n.indexOf("@"),o=void 0;return i>-1&&(o=n.slice(i+1),n=n.slice(0,i)),!o&&t?this.findPackageDependency(t,n):this.lookup(n,o)}},{key:"resolvePath",value:function(e,t){if(isAbsolute(e))return e;var r=t&&t.isPackage||null;if(!r&&t){if(e.startsWith(".")){var n=lively_resources.resource(t);return n.isDirectory()||(n=n.parent()),n.join(e).withRelativePartsResolved().url}r=this.findPackageHavingURL(t)}var i=this.findPackageForPath(e,r);if(!i)return null;var o=e.indexOf("/"),s=-1===o||o===e.length-1?"":e.slice(o);return s?lively_resources.resource(i.url).join(s).url:i.url}},{key:"update",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,i,o,s,a,u,c,l,f,p,h,d,m,v,y,g,b,_,x,w,k,E,S,A,D,C,F,O,j,R,B,T,P,I,L,N=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isReady()){e.next=2;break}return e.abrupt("return",this.whenReady().then(function(){return N.update()}));case 2:t=lively_lang.promise.deferred(),this._readyPromise=t.promise,this.packageBaseDirs=this.packageBaseDirs.map(function(e){return e.asDirectory()}),this.individualPackageDirs=this.individualPackageDirs.map(function(e){return e.asDirectory()}),this.devPackageDirs=this.devPackageDirs.map(function(e){return e.asDirectory()}),r={},e.prev=8,n=!0,i=!1,o=void 0,e.prev=12,s=this.packageBaseDirs[Symbol.iterator]();case 14:if(n=(a=s.next()).done){e.next=77;break}return u=a.value,c=!0,l=!1,f=void 0,e.prev=19,e.next=22,u.dirList(1);case 22:e.t0=Symbol.iterator,p=e.sent[e.t0]();case 24:if(c=(h=p.next()).done){e.next=60;break}return d=h.value,m=!0,v=!1,y=void 0,e.prev=29,e.next=32,d.dirList(1);case 32:e.t1=function(e){return e.isDirectory()},e.t2=Symbol.iterator,g=e.sent.filter(e.t1)[e.t2]();case 35:if(m=(b=g.next()).done){e.next=43;break}return _=b.value,e.next=39,this._discoverPackagesIn(_,r,"packageCollectionDirs");case 39:r=e.sent;case 40:m=!0,e.next=35;break;case 43:e.next=49;break;case 45:e.prev=45,e.t3=e.catch(29),v=!0,y=e.t3;case 49:e.prev=49,e.prev=50,!m&&g.return&&g.return();case 52:if(e.prev=52,!v){e.next=55;break}throw y;case 55:return e.finish(52);case 56:return e.finish(49);case 57:c=!0,e.next=24;break;case 60:e.next=66;break;case 62:e.prev=62,e.t4=e.catch(19),l=!0,f=e.t4;case 66:e.prev=66,e.prev=67,!c&&p.return&&p.return();case 69:if(e.prev=69,!l){e.next=72;break}throw f;case 72:return e.finish(69);case 73:return e.finish(66);case 74:n=!0,e.next=14;break;case 77:e.next=83;break;case 79:e.prev=79,e.t5=e.catch(12),i=!0,o=e.t5;case 83:e.prev=83,e.prev=84,!n&&s.return&&s.return();case 86:if(e.prev=86,!i){e.next=89;break}throw o;case 89:return e.finish(86);case 90:return e.finish(83);case 91:x=!0,w=!1,k=void 0,e.prev=94,E=this.individualPackageDirs[Symbol.iterator]();case 96:if(x=(S=E.next()).done){e.next=104;break}return A=S.value,e.next=100,this._discoverPackagesIn(A,r,"individualPackageDirs");case 100:r=e.sent;case 101:x=!0,e.next=96;break;case 104:e.next=110;break;case 106:e.prev=106,e.t6=e.catch(94),w=!0,k=e.t6;case 110:e.prev=110,e.prev=111,!x&&E.return&&E.return();case 113:if(e.prev=113,!w){e.next=116;break}throw k;case 116:return e.finish(113);case 117:return e.finish(110);case 118:D=!0,C=!1,F=void 0,e.prev=121,O=this.devPackageDirs[Symbol.iterator]();case 123:if(D=(j=O.next()).done){e.next=131;break}return R=j.value,e.next=127,this._discoverPackagesIn(R,r,"devPackageDirs");case 127:r=e.sent;case 128:D=!0,e.next=123;break;case 131:e.next=137;break;case 133:e.prev=133,e.t7=e.catch(121),C=!0,F=e.t7;case 137:e.prev=137,e.prev=138,!D&&O.return&&O.return();case 140:if(e.prev=140,!C){e.next=143;break}throw F;case 143:return e.finish(140);case 144:return e.finish(137);case 145:for(B in r)T=r[B],P=T.pkg,I=T.config,L=T.covered,this.System.debug&&console.log("[PackageRegistry] Adding discovered package "+B+" (from "+L+")"),this._addPackageWithConfig(P,I,B+"/",L);this._updateLatestPackages(),t.resolve(),e.next=153;break;case 150:e.prev=150,e.t8=e.catch(8),t.reject(e.t8);case 153:return e.prev=153,this._readyPromise=null,this.resetByURL(),ModulePackageMapping.forSystem(this.System).clearCache(),e.finish(153);case 158:return e.abrupt("return",this);case 159:case"end":return e.stop()}},e,this,[[8,150,153,158],[12,79,83,91],[19,62,66,74],[29,45,49,57],[50,,52,56],[67,,69,73],[84,,86,90],[94,106,110,118],[111,,113,117],[121,133,137,145],[138,,140,144]])}));return function(){return e.apply(this,arguments)}}()},{key:"addPackageAt",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"individualPackageDirs",l=arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((r=t.isResource?t.url:t).endsWith("/")&&r.slice(0,-1),!this.byURL[r]){e.next=4;break}throw new Error("package in "+r+" already added to registry");case 4:return e.next=6,this._discoverPackagesIn(ensureResource(t).asDirectory(),{},void 0,l);case 6:n=e.sent,e.t0=regeneratorRuntime.keys(n);case 8:if((e.t1=e.t0()).done){e.next=16;break}if(i=e.t1.value,!this.byURL[i]){e.next=12;break}return e.abrupt("continue",8);case 12:o=n[i],s=o.pkg,a=o.config,u=this._addPackageDir(i,c,!0),this._addPackageWithConfig(s,a,i+"/",u),e.next=8;break;case 16:return this.resetByURL(),ModulePackageMapping.forSystem(this.System).clearCache(),this._updateLatestPackages(),e.abrupt("return",this.findPackageWithURL(t));case 20:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"removePackage",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e.url,n=e.name,i=e.version,o=ensureResource(r),s=this.coversDirectory(o);"devPackageDirs"===s?this.devPackageDirs=this.devPackageDirs.filter(function(e){return!e.equals(o)}):"individualPackageDirs"===s&&(this.individualPackageDirs=this.individualPackageDirs.filter(function(e){return!e.equals(o)}));var a=this.packageMap;a[n]&&(delete a[n].versions[i],0===Object.keys(a[n].versions).length&&delete a[n]),this.resetByURL(),ModulePackageMapping.forSystem(this.System).clearCache(),t&&this._updateLatestPackages(e.name)}},{key:"updateNameAndVersionOf",value:function(e,t,r,n,i){var o=this.packageMap;o[t]?o[t].versions[r]||console.warn("[PackageRegistry>>updateNameAndVersionOf] No version entry "+r+" of "+t+" found in registry ("+e.url+")"):console.warn("[PackageRegistry>>updateNameAndVersionOf] "+t+"@"+r+" not found in registry ("+e.url+")"),this._addToPackageMap(e,n,i),o[t]&&o[t].versions[r]&&(delete o[t].versions[r],0===Object.keys(o[t].versions).length&&delete o[t]),this._updateLatestPackages(e.name)}},{key:"_updateLatestPackages",value:function(e){var t=this.packageMap;if(e&&t[e])t[e].latest=lively_lang.arr.last(semver.sort(Object.keys(t[e].versions),!0));else for(var r in t)t[r].latest=lively_lang.arr.last(semver.sort(Object.keys(t[r].versions),!0))}},{key:"_discoverPackagesIn",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var i,o,s,a,u,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isDirectory()){e.next=2;break}return e.abrupt("return",r);case 2:if(i=t.asFile().url,!r.hasOwnProperty(i)){e.next=5;break}return e.abrupt("return",r);case 5:return e.prev=5,o=c&&c[i]||new Package(this.System,i),e.next=9,o.tryToLoadPackageConfig();case 9:return s=e.sent,o.setConfig(s),r[i]={pkg:o,config:s,covered:n},this.System.debug&&(a=s.name,u=s.version,console.log("[lively.modules] package "+a+"@"+u+" discovered in "+t.url)),e.abrupt("return",r);case 16:return e.prev=16,e.t0=e.catch(5),e.abrupt("return",r);case 19:case"end":return e.stop()}},e,this,[[5,16]])}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_addToPackageMap",value:function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!t)throw new Error("Cannot add package without name");r||(r="0.0.0");var i=this.packageMap,o=i[t]||(i[t]={versions:{},latest:null});if(o.versions[r]){var s="Redefining version "+r+" of package "+e.url;if(!n)throw new Error(s+" not allowed");console.warn(s)}o.versions[r]=e}},{key:"_addPackageWithConfig",value:function(e,t,r){return(arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)||this._addPackageDir(r,"individualPackageDirs",!0),e.registerWithConfig(t),this._addToPackageMap(e,e.name,e.version),e}},{key:"_addPackageDir",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"individualPackageDirs",r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e=ensureResource(e).asDirectory(),"packageCollectionDirs"===t||"maybe packageCollectionDirs"===t){if((this.coversDirectory(e)||"").includes("packageCollectionDirs"))return"packageCollectionDirs"}var n=t,i=this[n].concat(e);return this[n]=r?lively_lang.arr.uniqBy(i,function(e,t){return e.equals(t)}):i,n}},{key:"byURL",get:function(){if(!this._byURL){this._byURL={};var e=!0,t=!1,r=void 0;try{for(var n,i=this.allPackages()[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;this._byURL[o.url]=o}}catch(e){t=!0,r=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}}return this._byURL}}]),e}(),Package=function(){function e(t,r,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};classCallCheck(this,e),this.System=t,this.url=r,this.registerProcess=null,this.map={},this.setConfig(o)}return createClass(e,null,[{key:"allPackages",value:function(e){return lively_lang.obj.values(PackageRegistry$$1.ofSystem(e).byURL)}},{key:"allPackageURLs",value:function(e){return PackageRegistry$$1.ofSystem(e).allPackageURLs()}},{key:"forModule",value:function(e,t){return this.forModuleId(e,t.id)}},{key:"forModuleId",value:function(e,t){var r=ModulePackageMapping.forSystem(e).getPackageURLForModuleId(t);return r?getPackage$1(e,r,!0):null}},{key:"fromJSON",value:function(t,r){return new e(t).fromJSON(r)}}]),createClass(e,[{key:"setConfig",value:function(e){this._name=e.name,this.version=e.version,this.dependencies=e.dependencies||{},this.devDependencies=e.devDependencies||{},this.main=e.main||"index.js",this.systemjs=e.systemjs,this.lively=e.lively}},{key:"toJSON",value:function(){var e=this.System,t=lively_lang.obj.select(this,["url","_name","version","map","dependencies","devDependencies","main","systemjs","lively"]);return t.url.startsWith(e.baseURL)&&(t.url=t.url.slice(e.baseURL.length).replace(/^\//,"")),t}},{key:"fromJSON",value:function(e){var t=this.System;return this.url=e.url,this._name=e._name,this.version=e.version,this.map=e.map||{},this.main=e.main,this.dependencies=e.dependencies||{},this.devDependencies=e.devDependencies||{},this.systemjs=e.systemjs,this.lively=e.lively,isURL(this.url)||(this.url=join(t.baseURL,this.url)),this.registerWithConfig(),this}},{key:"asSpec",value:function(){return _extends({},lively_lang.obj.select(this,["name","main","map","meta","url","address","version","lively"]),{modules:this.modules().map(function(e){return{name:e.id,deps:e.directRequirements().map(function(e){return e.id})}})})}},{key:"path",value:function(){var e=this.System.baseURL;return 0===this.url.indexOf(e)?this.url.slice(e.length):this.url}},{key:"modules",value:function(){var e=this.url,t=this.System;return ModulePackageMapping.forSystem(t).getModuleIdsForPackageURL(e).map(function(e){return module$2(t,e)})}},{key:"resources",value:function(){var t=asyncToGenerator(regeneratorRuntime.mark(function t(r){var n,i,o,s,a,u,c,l=this,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[".git","node_modules",".module_cache","lively.next-node_modules"];return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.System,i=this.url,o=e.allPackageURLs(n),s=o.filter(function(e){return e!==i&&!i.startsWith(e)}),t.next=6,lively_resources.resource(i).dirList("infinity",{exclude:f});case 6:return a=t.sent,u=a.filter(function(e){return!e.isDirectory()&&!s.some(function(t){return e.url.startsWith(t)})}).map(function(e){return e.url}),c=lively_lang.arr.pluck(this.modules(),"id"),r&&(u=u.filter(r)),t.abrupt("return",u.map(function(e){var t=e.replace(i,"").replace(/^\//,"");return{isLoaded:c.includes(e),url:e,nameInPackage:t,package:l}}));case 11:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"hasResource",value:function(e){this.System;var t=this.url;return(e.startsWith(t)?lively_resources.resource(e):lively_resources.resource(t).join(e)).exists()}},{key:"toString",value:function(){return"Package("+this.name+" - "+this.path()+"/)"}},{key:"mergeWithConfig",value:function(e){var t=e=_extends({},e),r=t.name,n=t.map;return r&&(delete e.name,this._name=r),n&&(delete e.map,Object.assign(this.map,n)),Object.assign(this,e),this}},{key:"addMapping",value:function(e,t){this.map[e]=t,this.System.config({packages:defineProperty({},this.url,{map:defineProperty({},e,t)})})}},{key:"tryToLoadPackageConfig",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.System,r=this.url,n=r+"/package.json",t.config({meta:defineProperty({},n,{format:"json"}),packages:defineProperty({},r,{meta:{"package.json":{format:"json"}}})}),t.debug&&console.log("[lively.modules package reading config] %s",n),e.prev=3,e.t0=t.get(n),e.t0){e.next=9;break}return e.next=8,t.import(n);case 8:e.t0=e.sent;case 9:return i=e.t0,lively_lang.arr.pushIfNotIncluded(t.packageConfigPaths,n),e.abrupt("return",i);case 14:return e.prev=14,e.t1=e.catch(3),console.log("[lively.modules package] Unable loading package config %s for package: ",n,e.t1),delete t.meta[n],o=r.split("/").slice(-1)[0],e.abrupt("return",{name:o});case 20:case"end":return e.stop()}},e,this,[[3,14]])}));return function(){return e.apply(this,arguments)}}()},{key:"import",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.register();case 2:return t=this.url,r=this.System,e.t0=module$2,e.t1=r,e.next=8,r.normalize(t);case 8:return e.t2=e.sent,n=(0,e.t0)(e.t1,e.t2),e.next=12,r.import(n.id);case 12:return i=e.sent,e.next=15,lively_lang.promise.waitFor(1e3,function(){return n.isLoaded()});case 15:return e.abrupt("return",i);case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"isRegistering",value:function(){return!!this.registerProcess}},{key:"register",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isRegistering()){e.next=2;break}return e.abrupt("return",this.registerProcess.promise);case 2:if(r=this.System,n=this.url,this.registerProcess=lively_lang.promise.deferred(),i=this.registerProcess.promise,r.debug&&console.log("[lively.modules package register] %s",n),e.prev=6,e.t0=t,e.t0){e.next=12;break}return e.next=11,this.tryToLoadPackageConfig();case 11:e.t0=e.sent;case 12:o=e.t0,s=this.registerWithConfig(o),this.registerProcess.resolve(o),e.next=21;break;case 17:throw e.prev=17,e.t1=e.catch(6),this.registerProcess.reject(e.t1),e.t1;case 21:return e.prev=21,delete this.registerProcess,e.finish(21);case 24:return e.abrupt("return",i);case 25:case"end":return e.stop()}},e,this,[[6,17,21,24]])}));return function(t){return e.apply(this,arguments)}}()},{key:"updateConfig",value:function(e){e=_extends({},this.runtimeConfig,e);var t=this.name,r=this.version,n=e,i=n.name,o=n.version;if(new PackageConfiguration(this).applyConfig(e),t!==e.name||r!==e.version){console.log("[lively.modules] Updating registry "+t+"@"+r+" => "+i+"@"+o);PackageRegistry$$1.ofSystem(this.System).updateNameAndVersionOf(this,t,r,i,o)}}},{key:"registerWithConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.runtimeConfig,t=this.System,r=this.url,n=new PackageConfiguration(this).applyConfig(e),i=join(r,"package.json");return t.get(i)||t.set(i,t.newModule(_extends({},e,{default:e}))),lively_notifications.emit("lively.modules/packageregistered",{package:r},Date.now(),t),n}},{key:"remove",value:function(e){e=_extends({forgetEnv:!0,forgetDeps:!1,unloadModules:!0},e);var t=this.System,r=this.url;r=r.replace(/\/$/,""),e.unloadModules&&this.modules().forEach(function(t){return t.unload(e)});PackageRegistry$$1.ofSystem(t).removePackage(this);var n=t.getConfig(),i=r+"/package.json";t.delete(String(i)),lively_lang.arr.remove(n.packageConfigPaths||[],i),t.config({meta:defineProperty({},i,{}),packages:defineProperty({},r,{}),packageConfigPaths:n.packageConfigPaths}),delete t.packages[r],lively_notifications.emit("lively.modules/packageremoved",{package:this.url},Date.now(),t)}},{key:"reload",value:function(e){var t=this.System,r=this.url,n=PackageRegistry$$1.ofSystem(t),i=n.coversDirectory(r);return this.remove(e),n.addPackageAt(r,i||"devPackageDirs",defineProperty({},r,this)),this.import()}},{key:"fork",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r||(r=lively_resources.resource(this.url).join("../"+t).withRelativePartsResolved().url),e.next=3,this.changeAddress(r,t,!1);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"rename",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=lively_resources.resource(this.url).join("../"+t).withRelativePartsResolved().url,e.next=3,this.changeAddress(r,t,!0);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"changeAddress",value:function(){var t=asyncToGenerator(regeneratorRuntime.mark(function t(r){var n,i,o,s,a,u,c,l,f,p,h,d,m,v,y,g,b,_,x,w,k,E,S,A,D,C,F,O,j,R,B,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=r.replace(/\/?/,""),n=this.System,i=this.url,o=this.name,s=this.version,t.next=7,this.runtimeConfig;case 7:return a=t.sent,u=lively_resources.resource(i).asDirectory(),c=new e(n,r),t.next=12,lively_resources.resource(r).asDirectory();case 12:return l=t.sent,a.name=T||this.name,f=PackageRegistry$$1.ofSystem(n),p=f.coversDirectory(i),ModulePackageMapping.forSystem(n).clearCache(),n.packages[i]&&(n.packages[r]=n.packages[i],P&&delete n.packages[i]),Object.assign(c,lively_lang.obj.select(this,["_name","map","config"])),t.next=20,l.ensureExistance();case 20:return t.next=22,this.resources(void 0,[]);case 22:t.t0=function(e){return e.url},h=t.sent.map(t.t0),d=this.modules(),m=!0,v=!1,y=void 0,t.prev=28,g=d[Symbol.iterator]();case 30:if(m=(b=g.next()).done){t.next=45;break}if(_=b.value,x=l.join(_.pathInPackage()).url,!P){t.next=38;break}return t.next=36,_.renameTo(x);case 36:t.next=40;break;case 38:return t.next=40,_.copyTo(x);case 40:(w=h.indexOf(_.id))>-1&&h.splice(w,1);case 42:m=!0,t.next=30;break;case 45:t.next=51;break;case 47:t.prev=47,t.t1=t.catch(28),v=!0,y=t.t1;case 51:t.prev=51,t.prev=52,!m&&g.return&&g.return();case 54:if(t.prev=54,!v){t.next=57;break}throw y;case 57:return t.finish(54);case 58:return t.finish(51);case 59:k=!0,E=!1,S=void 0,t.prev=62,A=h[Symbol.iterator]();case 64:if(k=(D=A.next()).done){t.next=72;break}return C=D.value,F=lively_resources.resource(C),O=F.relativePathFrom(u),t.next=69,F.copyTo(l.join(O));case 69:k=!0,t.next=64;break;case 72:t.next=78;break;case 74:t.prev=74,t.t2=t.catch(62),E=!0,S=t.t2;case 78:t.prev=78,t.prev=79,!k&&A.return&&A.return();case 81:if(t.prev=81,!E){t.next=84;break}throw S;case 84:return t.finish(81);case 85:return t.finish(78);case 86:if(!P){t.next=91;break}return t.next=89,this.remove({forgetEnv:!0,forgetDeps:!1});case 89:return t.next=91,u.remove();case 91:if(!T){t.next=112;break}return c.name=T,c.config.name=T,j=lively_resources.resource(r).join("package.json"),t.prev=95,t.next=98,j.exists();case 98:if(!t.sent){t.next=108;break}return t.next=101,j.readJson();case 101:if((R=t.sent).name!==this.name){t.next=106;break}return R.name=T,t.next=106,j.writeJson(R,!0);case 106:(B=n.get(j.url))&&n.set(j.url,n.newModule(_extends({},B,{name:T})));case 108:t.next=112;break;case 110:t.prev=110,t.t3=t.catch(95);case 112:return"individualPackageDirs"!==(p=p||"individualPackageDirs")&&"devPackageDirs"!==p||f._addPackageDir(r,p,!0),f._addPackageWithConfig(c,a,r,p),f.resetByURL(),f._updateLatestPackages(),t.abrupt("return",c);case 118:case"end":return t.stop()}},t,this,[[28,47,51,59],[52,,54,58],[62,74,78,86],[79,,81,85],[95,110]])}));return function(e){return t.apply(this,arguments)}}()},{key:"search",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!i.includeUnloaded){e.next=7;break}return e.next=3,this.resources(function(e){return e.endsWith(".js")},[".git","node_modules","dist",".module_cache","lively.next-node_modules"]);case 3:e.t1=function(e){var t=e.url;return module$2(n.System,t)},e.t0=e.sent.map(e.t1),e.next=8;break;case 7:e.t0=this.modules().filter(function(e){return e.isLoaded()});case 8:return r=e.t0,e.abrupt("return",Promise.all(r.map(function(e){return e.search(t,i).catch(function(t){return console.error("Error searching module "+e.name+":\n"+t.stack),[]})})).then(function(e){return lively_lang.arr.flatten(e,1)}));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"isPackage",get:function(){return!0}},{key:"name",get:function(){if(this._name)return this._name;var e=this.System.get(this.url+"/package.json");return e&&e.name?e.name:lively_lang.arr.last(this.url.replace(/[\/]+$/,"").split("/"))},set:function(e){return this._name=e}},{key:"nameAndVersion",get:function(){return this.name+"@"+this.version}},{key:"address",get:function(){return this.url},set:function(e){return this.url=e}},{key:"runtimeConfig",get:function(){var e=this.name,t=this.version,r=this.dependencies,n=this.devDependencies,i=this.main,o=this.systemjs,s=this.lively,a={name:e,version:t,dependencies:r||{},devDependencies:n||{}};return i&&(a.main=i),o&&(a.systemjs=o),s&&(a.lively=s),a}}]),e}(),ImportInjector=function(){function e(t,r,n,i,o,s,a){classCallCheck(this,e),this.System=t,this.intoModuleId=r,this.intoPackage=n,this.intoModuleSource=i,this.fromModuleId=o.moduleId,this.importData=o,this.alias=s,this.parsed=a||lively_ast.fuzzyParse(i)}return createClass(e,null,[{key:"run",value:function(e,t,r,n,i){return new this(e,t,r,n,i,arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0).run()}}]),createClass(e,[{key:"run",value:function(){var e=this.generateImportStatement(),t=e.standaloneImport,r=e.importedVarName,n=this.existingImportsOfFromModule(),i=n.imports,o=n.importsOfFromModule,s=n.importsOfVar;if(o=this.importsToBeReused(o,s,e),s.length)return{status:"not modified",newSource:this.intoModuleSource,generated:"",importedVarName:"",standaloneImport:t,from:s[0].start,to:s[0].end};if(o.length){var a=this.modifyExistingImport(o,t);if(a)return a}var u=lively_lang.arr.last(i),c=u?u.end:0;return this.insertNewImport(o,t,r,c)}},{key:"importsToBeReused",value:function(e,t,r){return r.isDefault&&(e=e.filter(function(e){return!e.specifiers.some(function(e){return"ImportDefaultSpecifier"==e.type})})),e}},{key:"generateImportStatement",value:function(){var e=this.intoModuleId,t=this.fromModuleId,r=this.importData,n=this.intoPackage,i=this.alias,o="default"===r.exported,s=i||(o?r.local:r.exported),a=!o&&r.exported!==s,u=n&&n.name,c=t,l=r.packageName,f=r.pathInPackage;if(r.isMain)c=l;else if(u===l)try{(c=lively_resources.resource(t).relativePathFrom(lively_resources.resource(e))).startsWith(".")||(c="./"+c)}catch(e){l&&"no group"!==l&&f&&(c=l+"/"+f)}else l&&"no group"!==l&&f&&(c=l+"/"+f);return{isDefault:o,standaloneImport:o?"import "+s+' from "'+c+'";':"import { "+r.exported+(a?" as "+s:"")+' } from "'+c+'";',importedVarName:s}}},{key:"existingImportsOfFromModule",value:function(){var e=this.System,t=this.fromModuleId,r=this.intoModuleId,n=this.importData,i=n.exported,o=n.local,s=this.parsed,a=this.alias,u="default"===i,c=s.body.filter(function(e){return"ImportDeclaration"===e.type}),l=u?a||o:a||i,f=c.filter(function(n){if(!n.source||"string"!=typeof n.source.value)return null;var i=e.decanonicalize(n.source.value,r);return t===i});return{imports:c,importsOfFromModule:f,importsOfVar:f.filter(function(e){return(e.specifiers||[]).some(function(e){return u?"ImportDefaultSpecifier"===e.type&&e.local.name===l:lively_lang.Path("imported.name").get(e)===i&&lively_lang.Path("local.name").get(e)===l})})}}},{key:"modifyExistingImport",value:function(e,t){var r=lively_lang.arr.flatmap(e,function(e){return e.specifiers||[]});if(!r.length)return null;var n=lively_lang.arr.partition(r,function(e){return"ImportDefaultSpecifier"===e.type}),i=slicedToArray(n,2),o=slicedToArray(i[0],1)[0],s=slicedToArray(i[1],1)[0],a=this.alias,u=this.intoModuleSource,c=this.importData,l=c.exported,f=c.local,p="default"===l;if(p?console.assert(!!s,"no ImportSpecifier found"):console.assert(s||o,"at least one kine of specifier is expected"),p){if((v=u.slice(0,s.start).lastIndexOf("{")-1)<0)return null;var h=(a||f)+",",d=u.slice(0,v),m=u.slice(v);return d.endsWith(" ")&&d.endsWith("\n")||(h=" "+h),m.startsWith(" ")||(h+=" "),{status:"modified",newSource:""+d+h+m,generated:h,standaloneImport:t,importedVarName:a||f,from:v,to:v+h.length}}var v=s?s.end:o.end,y=a&&a!==l,g=y?l+" as "+a:l;return h=s?", "+g:", { "+g+" }",{status:"modified",newSource:""+u.slice(0,v)+h+u.slice(v),generated:h,standaloneImport:t,importedVarName:y?a:l,from:v,to:v+h.length}}},{key:"insertNewImport",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e&&e.length&&(n=lively_lang.arr.last(e).end);var i=this.intoModuleSource,o=i.slice(0,n),s=i.slice(n),a=t;return o.length&&!o.endsWith("\n")&&(a="\n"+a),s.length&&!s.startsWith("\n")&&(a+="\n"),{status:"modified",newSource:o+a+s,generated:a,standaloneImport:t,importedVarName:r,from:n,to:n+a.length}}}]),e}(),GlobalInjector=function(){function e(){classCallCheck(this,e)}return createClass(e,null,[{key:"run",value:function(e,t,r){var n=r||lively_ast.fuzzyParse(e,{withComments:!0}),i=n.comments?n.comments.find(function(e){return e.isBlock&&e.text.startsWith("global")}):null,o=i?i.text.replace(/^global\s*/,"").split(",").map(function(e){return e.trim()}).filter(Boolean):[],s=t.filter(function(e){return!o.includes(e)});if(!s.length)return{status:"not modified",newSource:e,generated:"",from:0,to:0};if(!i){var a="/*global "+s.join(",")+"*/\n";return{status:"modified",newSource:a+e,generated:a,from:0,to:a.length}}var u=i.start+"/*".length+i.text.length,c=s.join(",");o.length?c=","+c:i.text.startsWith("global ")||(c=" "+c);var l=u+c.length;return{status:"modified",newSource:e.slice(0,u)+c+e.slice(u),generated:c,from:u,to:l}}}]),e}(),ImportRemover=function(){function e(){classCallCheck(this,e)}return createClass(e,null,[{key:"removeImports",value:function(e,t,r){var n=r||lively_ast.fuzzyParse(e),i=lively_lang.arr.flatmap(n.body,function(e){return"ImportDeclaration"===e.type&&e.specifiers.length?e.specifiers.map(function(t){return{local:t.local,importStmt:e}}):[]}).filter(function(e){return t.some(function(t){return t.local===e.local.name})}),o=i.map(function(e){return{local:e.local.name,from:e.importStmt.source.value}}),s=lively_lang.arr.uniq(i.map(function(e){var t=e.importStmt.specifiers.find(function(t){return e.local===t.local});return lively_lang.arr.remove(e.importStmt.specifiers,t),e.importStmt})).slice().reverse().reduce(function(e,t){var r=e.source,n=e.changes,i=t.start,o=t.end,s=t.specifiers,a=r.slice(0,i),u=r.slice(o),c=r.slice(i,o),l=s.length?lively_ast.stringify(t):"";return l&&l.includes("\n")&&!c.includes("\n")&&(l=l.replace(/\s+/g," ")),r=a+l+u,n=n.concat({replacement:l,start:i,end:o}),{source:r,changes:n}},{source:e,changes:[]});return _extends({},s,{removedImports:o})}},{key:"findUnusedImports",value:function(e){var t="string"==typeof e?lively_ast.fuzzyParse(e):e,r=lively_lang.arr.flatmap(t.body,function(e){return"ImportDeclaration"===e.type&&e.specifiers.length?e.specifiers.map(function(t){return{local:t.local,from:e.source?e.source.value:"",importStmt:e}}):[]}),n=r.map(function(e){return e.local}),i=lively_ast.query.resolveReferences(lively_ast.query.scopes(t)),o=Array.from(i.resolvedRefMap.keys()).filter(function(e){return!n.includes(e)}),s=lively_lang.arr.uniq(o.map(function(e){return e.name}));return r.filter(function(e){return!s.includes(e.local.name)}).map(function(e){return _extends({},e,{local:e.local.name})})}},{key:"removeUnusedImports",value:function(e){var t=lively_ast.fuzzyParse(e);return this.removeImports(e,this.findUnusedImports(t),t)}}]),e}(),detectModuleFormat=function(){var e=/['"]format (esm|es6)['"];/,t=/['"]format cjs['"];/,r=/(^\s*|[}\);\n]\s*)(import\s+(['"]|(\*\s+as\s+)?[^"'\(\)\n;]+\s+from\s+['"]|\{)|export\s+\*\s+from\s+["']|export\s+(\{|default|function|class|var|const|let|async\s+function))/;return function(n,i){return i&&i.format?("es6"==i.format&&i.format,i.format):e.test(n.slice(0,5e3))||!t.test(n.slice(0,5e3))&&r.test(n)?"esm":"global"}}(),doesModuleExist$1=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=livelySystemEnv(t),i=s?r:t.normalizeSync(r),!isModuleLoaded$1(t,i,!0)){e.next=3;break}return e.abrupt("return",!0);case 3:if((o=Package.forModuleId(t,i))&&"no group"!==o.name){e.next=8;break}e.t0=t.resource(i).exists(),e.next=11;break;case 8:return e.next=10,o.hasResource(i);case 10:e.t0=e.sent;case 11:return e.abrupt("return",e.t0);case 12:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),globalProps={initialized:!1,descriptors:{}},ModuleInterface=function(){function e(t,r){var n=this;if(classCallCheck(this,e),!isURL(r)&&!/^@/.test(r))throw new Error("ModuleInterface constructor called with "+r+" that does not seem to be a fully normalized module id.");this.System=t,this.id=r,this.recorderName="__lvVarRecorder",this.sourceAccessorName="__lvOriginalCode",this._recorder=null,this._source=null,this._ast=null,this._scope=null,this._observersOfTopLevelState=[],this._evaluationsInProgress=0,this._evalId=1,this.createdAt=this.lastModifiedAt=new Date,lively_notifications.subscribe("lively.modules/modulechanged",function(e){e.module===n.id&&n.reset()})}return createClass(e,[{key:"fullName",value:function(){return this.id}},{key:"shortName",value:function(){return this.package().name+"/"+this.pathInPackage()}},{key:"source",value:function(){var e=this;return"@empty"===this.id?Promise.resolve(""):this._source?Promise.resolve(this._source):this.System.resource(this.id).read().then(function(t){return e._source=t})}},{key:"setSource",value:function(e){this._source!==e&&(this.reset(),this._source=e)}},{key:"ast",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._ast){e.next=2;break}return e.abrupt("return",this._ast);case 2:return e.t0=lively_ast.parse,e.next=5,this.source();case 5:return e.t1=e.sent,e.abrupt("return",this._ast=(0,e.t0)(e.t1));case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"scope",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._scope){e.next=2;break}return e.abrupt("return",this._scope);case 2:return e.next=4,this.ast();case 4:return t=e.sent,e.abrupt("return",this._scope=lively_ast.query.topLevelDeclsAndRefs(t).scope);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"resolvedScope",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=lively_ast.query,e.next=3,this.scope();case 3:return e.t1=e.sent,e.abrupt("return",this._scope=e.t0.resolveReferences.call(e.t0,e.t1));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"metadata",value:function(){var e=this.System.loads?this.System.loads[this.id]:null;return e?e.metadata:null}},{key:"addMetadata",value:function(e){var t=this.System,r=this.id,n=this.metadata(),i=n?Object.assign(n,e):e;return t.config({meta:defineProperty({},r,i)}),t.meta[r]}},{key:"format",value:function(){var e=this.metadata();return e&&e.format?e.format:this._source?detectModuleFormat(this._source):"global"}},{key:"setFormat",value:function(e){return this.addMetadata({format:e})}},{key:"reset",value:function(){this._source=null,this._ast=null,this._scope=null}},{key:"get",value:function(){var e=this.id;return this.System.get(e)}},{key:"load",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.id,n=this.System,t&&this.addMetadata(t),e.t0=n.get(r),e.t0){e.next=7;break}return e.next=6,n.import(r);case 6:e.t0=e.sent;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"isLoaded",value:function(){return!!this.System.get(this.id)}},{key:"unloadEnv",value:function(){this._recorder=null,this._observersOfTopLevelState=[],delete livelySystemEnv(this.System).loadedModules[this.id]}},{key:"unloadDeps",value:function(e){var t=this;e=lively_lang.obj.merge({forgetDeps:!0,forgetEnv:!0},e),this.dependents().forEach(function(r){t.System.delete(r.id),t.System.loads&&delete t.System.loads[r.id],e.forgetEnv&&r.unloadEnv()})}},{key:"unload",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=_extends({reset:!0,forgetDeps:!0,forgetEnv:!0},t),r=this.System,n=this.id,t.reset&&this.reset(),t.forgetDeps&&this.unloadDeps(t),this.System.delete(n),r.loads&&delete r.loads[n],r.meta&&delete r.meta[n],t.forgetEnv&&this.unloadEnv(),!(i=r._livelyModulesTranslationCache)){e.next=12;break}return e.next=12,i.deleteCachedData(n);case 12:lively_notifications.emit("lively.modules/moduleunloaded",{module:this.id},Date.now(),this.System);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"reload",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=lively_lang.obj.merge({reloadDeps:!0,resetEnv:!0},t),r=[this],t.reloadDeps&&(r=this.dependents().concat(r)),e.next=5,this.unload({forgetDeps:t.reloadDeps,forgetEnv:t.resetEnv});case 5:return e.next=7,Promise.all(r.map(function(e){return e.id!==n.id&&e.load()}));case 7:return e.next=9,this.load();case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"copyTo",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,l,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this.System.resource(t),e.next=3,this.source();case 3:return e.t1=e.sent,e.next=6,e.t0.write.call(e.t0,e.t1);case 6:return r=this.System,n=this.recorderName,i=this.sourceAccessorName,o=this._recorder,s=this._source,a=this._ast,u=this._scope,c=this._observersOfTopLevelState,l=module$2(r,t),f=lively_lang.obj.select(this,["_observersOfTopLevelState","_scope","_ast","_source","_recorder","sourceAccessorName","recorderName"]),Object.assign(l,f),r.set(t,r.newModule(r.get(this.id))),e.abrupt("return",l);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"renameTo",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.unload,n=void 0===r||r,i=a.removeFile,o=void 0===i||i,e.next=6,this.copyTo(t);case 6:if(s=e.sent,!n){e.next=10;break}return e.next=10,this.unload({reset:!0,forgetDeps:!1,forgetEnv:!0});case 10:if(!o){e.next=13;break}return e.next=13,this.System.resource(this.id).remove();case 13:return e.abrupt("return",s);case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"whenLoaded",value:function(e){if(this.isLoaded())try{e(this)}catch(e){console.error(e)}else livelySystemEnv(this.System).onLoadCallbacks.push({moduleName:this.id,resolved:!0,callback:e})}},{key:"changeSourceAction",value:function(e){var t=this;return Promise.resolve(this.source()).then(function(t){return e(t)}).then(function(e){return t.changeSource(e)})}},{key:"changeSource",value:function(e,t){t=_extends({doSave:!0,doEval:!0},t);var r=this.System,n=this.id,i=this.format(),o=void 0;return this.reset(),this.lastModifiedAt=new Date,Promise.all([t.doSave&&this.System.resource(n).write(e),t.doEval&&moduleSourceChange$1(r,n,e,i,t).then(function(e){return o=e})]).then(function(){return o})}},{key:"addDependencyToModuleRecord",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=this.record(),i=e.record();if(n&&i){var o,s=n.dependencies.some(function(t,r){if(t)return o=r,t&&t.name===e.id});s?i!==n.dependencies[o]&&n.dependencies.splice(o,1,i):n.dependencies.push(i),s&&n.setters[o]||(n.setters[s?o:n.dependencies.length-1]=r);var a;i.importers.some(function(e,r){if(e)return a=r,e&&e.name===t.id})?n!==i.importers[a]&&i.importers.splice(a,1,n):i.importers.push(n)}}},{key:"dependents",value:function(){var e=this;return lively_lang.graph.hull(lively_lang.graph.invert(computeRequireMap(this.System)),this.id).map(function(t){return module$2(e.System,t)})}},{key:"requirements",value:function(){var e=this;return lively_lang.graph.hull(computeRequireMap(this.System),this.id).map(function(t){return module$2(e.System,t)})}},{key:"directRequirements",value:function(){var e=this,t=(this.record()||{}).dependencies||[];return lively_lang.arr.pluck(t.filter(Boolean),"name").map(function(t){return module$2(e.System,t)})}},{key:"define",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments[3],i=this.System,o=this.id,s=this.recorder,a=Symbol.for("lively-object-meta"),u=Symbol.for("lively-module-meta");if("function"!=typeof t||!n||"function"!==n.kind&&"class"!==n.kind||(t[a]=n),t&&t[a]&&!t[u]){var c=this.pathInPackage(),l=this.package();t[u]={package:l?{name:l.name,version:l.version}:{},pathInPackage:c}}return s[e]=t,scheduleModuleExportsChange(i,o,e,t,!1),this.notifyTopLevelObservers(e),(r=r||!this.isEvalutionInProgress())&&runScheduledExportChanges(i,o),t}},{key:"undefine",value:function(e){delete this.recorder[e]}},{key:"subscribeToToplevelDefinitionChanges",value:function(e){return this._observersOfTopLevelState.push(e),e}},{key:"notifyTopLevelObservers",value:function(e){var t=this.recorder;lively_lang.arr.include(["createOrExtendES6ClassForLively","lively.capturing-declaration-wrapper"],e)||this._observersOfTopLevelState.forEach(function(r){return r(e,t[e])})}},{key:"unsubscribeFromToplevelDefinitionChanges",value:function(e){this._observersOfTopLevelState="string"==typeof e?this._observersOfTopLevelState.filter(function(t){return t.name!==e}):this._observersOfTopLevelState.filter(function(t){return t!==e})}},{key:"evaluationStart",value:function(){this._evaluationsInProgress++}},{key:"evaluationEnd",value:function(){this._evaluationsInProgress--,runScheduledExportChanges(this.System,this.id)}},{key:"nextEvalId",value:function(){return this._evalId++}},{key:"isEvalutionInProgress",value:function(){return this._evaluationsInProgress>0}},{key:"env",value:function(){return this}},{key:"package",value:function(){return Package.forModule(this.System,this)}},{key:"pathInPackage",value:function(){var e=this.package();return e&&0===this.id.indexOf(e.address)?this.id.slice(e.address.length).replace(/^\//,""):this.id}},{key:"imports",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=lively_ast.query,e.next=3,this.scope();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.imports.call(e.t0,e.t1));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"exports",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=lively_ast.query,e.next=3,this.scope();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.exports.call(e.t0,e.t1));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"addImports",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,l,f,p,h,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.source();case 2:for(r=e.sent,n=!0,i=!1,o=void 0,e.prev=6,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0)u=a.value,c=module$2(this.System,u.from||u.moduleId),l=c.package(),f={exported:u.exported||u.local,moduleId:c.id,packageName:l.name,packageURL:l.url,pathInPackage:c.pathInPackage()},p=u.local,h=ImportInjector.run(this.System,this.id,this.package(),r,f,p),r=h.newSource,d=h.standAloneImport;e.next=14;break;case 10:e.prev=10,e.t0=e.catch(6),i=!0,o=e.t0;case 14:e.prev=14,e.prev=15,!n&&s.return&&s.return();case 17:if(e.prev=17,!i){e.next=20;break}throw o;case 20:return e.finish(17);case 21:return e.finish(14);case 22:return e.next=24,this.changeSource(r);case 24:case"end":return e.stop()}},e,this,[[6,10,14,22],[15,,17,21]])}));return function(t){return e.apply(this,arguments)}}()},{key:"addGlobalDeclaration",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.source();case 2:if(r=e.sent,n=GlobalInjector.run(r,t),i=n.status,o=n.newSource,!(s="modified"===i)){e.next=10;break}return e.next=10,this.changeSource(o);case 10:return e.abrupt("return",s);case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"removeImports",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.source();case 4:return r=e.sent,e.next=7,ImportRemover.removeImports(r,t);case 7:return n=e.sent,i=n.source,o=n.removedImports,e.next=12,this.changeSource(i);case 12:o.forEach(function(e){return delete s.recorder[e.local]});case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_localDeclForRefAt",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolvedScope();case 2:return r=e.sent,n=lively_ast.query.refWithDeclAt(t,r),e.abrupt("return",n&&{decl:n.decl,id:n.declId,declModule:this});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_localDeclForName",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolvedScope();case 2:r=e.sent,n=void 0,i=!0,o=!1,s=void 0,e.prev=7,a=r.resolvedRefMap.values()[Symbol.iterator]();case 9:if(i=(u=a.next()).done){e.next=18;break}if(c=u.value,l=c.ref.name,t!==l){e.next=15;break}return n=c,e.abrupt("break",18);case 15:i=!0,e.next=9;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(7),o=!0,s=e.t0;case 24:e.prev=24,e.prev=25,!i&&a.return&&a.return();case 27:if(e.prev=27,!o){e.next=30;break}throw s;case 30:return e.finish(27);case 31:return e.finish(24);case 32:return e.abrupt("return",n&&{decl:n.decl,id:n.declId,declModule:this});case 33:case"end":return e.stop()}},e,this,[[7,20,24,32],[25,,27,31]])}));return function(t){return e.apply(this,arguments)}}()},{key:"_importForNSRefAt",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolvedScope();case 2:if(r=e.sent,n=r.node,!((i=lively_ast.query.nodesAtIndex(n,t)).length<2)){e.next=7;break}return e.abrupt("return",[null,null]);case 7:if(o=i[i.length-1],s=i[i.length-2],"Identifier"==o.type&&"MemberExpression"==s.type&&!s.computed&&"Identifier"===s.object.type){e.next=10;break}return e.abrupt("return",[null,null]);case 10:if(a=r.resolvedRefMap.get(s.object)||{},(u=a.decl)&&"ImportDeclaration"===u.type){e.next=13;break}return e.abrupt("return",[null,null]);case 13:return c=s.object.name,l=u.specifiers.find(function(e){return e.local.name===c}),e.abrupt("return","ImportNamespaceSpecifier"!==l.type?[null,null]:[u,l.local,o.name]);case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_resolveImportedDecl",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",[]);case 2:return r=t.id,n=r.start,i=r.name,o=r.type,e.next=8,this.imports();case 8:if(s=e.sent,!(a=s.find(function(e){return e.local==i}))){e.next=17;break}return u=module$2(this.System,a.fromModule,this.id),e.t0=[t],e.next=15,u.bindingPathForExport(a.imported);case 15:return e.t1=e.sent,e.abrupt("return",e.t0.concat.call(e.t0,e.t1));case 17:return e.abrupt("return",[t]);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"bindingPathFor",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._localDeclForName(t);case 2:if(!(r=e.sent)){e.next=7;break}return e.next=6,this._resolveImportedDecl(r);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"bindingPathForExport",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolvedScope();case 2:return e.next=4,this.exports();case 4:if(r=e.sent,!(n=r.find(function(e){return e.exported===t})).fromModule){e.next=17;break}return i=module$2(this.System,n.fromModule,this.id),o={decl:n.node,id:n.declId},o.declModule=this,e.t0=[o],e.next=13,i.bindingPathForExport(n.imported);case 13:return e.t1=e.sent,e.abrupt("return",e.t0.concat.call(e.t0,e.t1));case 17:return e.abrupt("return",this._resolveImportedDecl({decl:n.decl,id:n.declId,declModule:n&&n.decl?this:null}));case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"bindingPathForRefAt",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._localDeclForRefAt(t);case 2:if(!(r=e.sent)){e.next=7;break}return e.next=6,this._resolveImportedDecl(r);case 6:return e.abrupt("return",e.sent);case 7:return e.next=9,this._importForNSRefAt(t);case 9:if(n=e.sent,i=slicedToArray(n,3),o=i[0],s=i[1],a=i[2],o){e.next=16;break}return e.abrupt("return",[]);case 16:return u=module$2(this.System,o.source.value,this.id),e.t0=[{decl:o,declModule:this,id:s}],e.next=20,u.bindingPathForExport(a);case 20:return e.t1=e.sent,e.abrupt("return",e.t0.concat.call(e.t0,e.t1));case 22:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"definitionForRefAt",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bindingPathForRefAt(t);case 2:return r=e.sent,e.abrupt("return",r.length<1?null:r[r.length-1].decl);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"ensureRecord",value:function(){var e=this.System,t=e._loader.moduleRecords;return t[this.id]?t[this.id]:t[this.id]={name:this.id,exports:e.newModule({}),dependencies:[],importers:[],setters:[]}}},{key:"record",value:function(){var e=this.System._loader.moduleRecords[this.id];return e?(e.hasOwnProperty("__lively_modules__")||(e.__lively_modules__={evalOnlyExport:{}}),e):null}},{key:"updateRecord",value:function(e){var t=this.record();if(!t)throw new Error("es6 environment global of "+this.id+": module not loaded, cannot get export object!");t.locked=!0;try{return e(t)}finally{t.locked=!1}}},{key:"search",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,s,a,u,c,l,f,p,h,d,m,v,y=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=_extends({excludedModules:[]},r)).excludedModules.some(function(e){return"string"==typeof e?e===y.id:e instanceof RegExp?e.test(y.id):"function"==typeof e&&e(y.id)})){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,this.source();case 5:for(n=e.sent,i=void 0,t instanceof RegExp?(o="g",t.ignoreCase&&(o+="i"),t.multiline&&(o+="m"),i=RegExp(t.source,o)):i=RegExp(t,"g"),s=void 0,a=[];null!==(s=i.exec(n));)a.push([s.index,s[0].length]);u=0,c=0,l=1,f=0;case 11:if(!(u<n.length&&c<a.length)){e.next=24;break}if("\n"==n[u]&&(l++,f=u+1),p=slicedToArray(a[c],2),h=p[0],d=p[1],u===h){e.next=16;break}return e.abrupt("continue",21);case 16:-1===(m=n.slice(f).indexOf("\n"))?m=n.length:m+=f,v=this.package(),a[c]={moduleId:this.id,packageName:v?v.name:void 0,pathInPackage:v?this.pathInPackage():this.id,isLoaded:this.isLoaded(),length:d,line:l,column:u-f,lineString:n.slice(f,m)},c++;case 21:u++,e.next=11;break;case 24:return e.abrupt("return",a);case 25:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"toString",value:function(){return"module("+this.id+")"}},{key:"dontTransform",get:function(){return[this.recorderName,this.sourceAccessorName,"global","self","_moduleExport","_moduleImport","localStorage","prompt","alert","fetch","getComputedStyle"].concat(lively_ast.query.knownGlobals)}},{key:"recorder",set:function(e){return this._recorder=e},get:function(){var e;if(this._recorder)return this._recorder;var t=this.System,r=this;if(!globalProps.initialized){globalProps.initialized=!0;for(var n in t.global)t.global.__lookupGetter__(n)&&(globalProps.descriptors[n]={value:void 0,configurable:!0,writable:!0})}var i={};if(t.get("@system-env").node){var o=_require.bind(null,this);o.resolve=_resolve.bind(null,this),i.require={configurable:!0,writable:!0,value:o}}return this._recorder=Object.create(t.global,_extends({},globalProps.descriptors,i,(e={System:{configurable:!0,writable:!0,value:t},__currentLivelyModule:{value:r}},defineProperty(e,lively_vm.defaultClassToFunctionConverterName,{configurable:!0,writable:!0,value:lively_classes.runtime.initializeClass}),defineProperty(e,this.varDefinitionCallbackName,{value:function(e,t,n,i,o){return o=o||{},o.kind=t,r.define(e,n,!1,o)}}),defineProperty(e,"_moduleExport",{value:function(e,n){scheduleModuleExportsChange(t,r.id,e,n,!0)}}),defineProperty(e,"_moduleImport",{value:function(e,n){var i=t.decanonicalize(e,r.id),o=t.get(i);if(o)return r.addDependencyToModuleRecord(module$2(t,i),function(e){return Object.assign(r.recorder,e)}),void 0==n?o:(o.hasOwnProperty(n)||console.warn("import from "+o+": Has no export "+n+"!"),o[n]);console.warn("import of "+n+" failed: "+e+" (tried as "+r.id+") is not loaded!")}}),e)))}},{key:"varDefinitionCallbackName",get:function(){return"defVar_"+this.id}}]),e}(),fetchResource=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,i,o,s,a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this,i=n.resource(r.name)){e.next=3;break}return e.abrupt("return",t(r));case 3:return e.prev=3,e.next=6,i.read();case 6:o=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),s=e.t0;case 12:if(!s||!n.get("@system-env").browser){e.next=24;break}if(a=i.url.startsWith("http"),u=!i.url.startsWith(document.location.origin),!a||!u){e.next=24;break}return e.prev=15,e.next=18,i.makeProxied().read();case 18:o=e.sent,s=null,e.next=24;break;case 22:e.prev=22,e.t1=e.catch(15);case 24:if(!s){e.next=26;break}throw s;case 26:return e.abrupt("return",o);case 27:case"end":return e.stop()}},e,this,[[3,9],[15,22]])}));return function(t,r){return e.apply(this,arguments)}}(),livelyURLRe=/^lively:\/\/([^\/]+)\/(.*)$/,isNode=System.get("@system-env").node,initialSystem=initialSystem||System,SystemClass=System.constructor;SystemClass.systems||(SystemClass.systems={});var defaultOptions={notificationLimit:null},dotSlashStartRe=/^\.?\//,trailingSlashRe=/\/$/,jsExtRe=/\.js$/,jsonJsExtRe=/\.json\.js$/i,doubleSlashRe=/.\/{2,}/g,ExportLookup=function(){function e(t){classCallCheck(this,e),this.System=t,this.subscribeToSystemChanges()}return createClass(e,null,[{key:"forSystem",value:function(e){this._forSystemMap||(this._forSystemMap=new WeakMap);var t=this._forSystemMap.get(e);return t||(t=new this(e),this._forSystemMap.set(e,t),t)}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:System,t=arguments[1];return this.forSystem(e).systemExports(t)}},{key:"findExportOfValue",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:System;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.run(n);case 2:return r=e.sent,e.abrupt("return",r.find(function(e){var r=e.local,i=e.moduleId,o=module$2(n,i),s=o.recorder||n.get(o.id)||{};try{return s[r]===t}catch(e){return!1}}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),createClass(e,[{key:"subscribeToSystemChanges",value:function(){var e=this;if(!this._notificationHandlers){var t=this.System;this._notificationHandlers=[lively_notifications.subscribe("lively.modules/moduleloaded",function(t){return e.clearCacheFor(t.module)},t),lively_notifications.subscribe("lively.modules/modulechanged",function(t){return e.clearCacheFor(t.module)},t),lively_notifications.subscribe("lively.vm/doitresult",function(t){return e.clearCacheFor(t.targetModule)},t)]}}},{key:"unsubscribeFromSystemChanges",value:function(){if(this._notificationHandlers){var e=this.System;lively_notifications.unsubscribe("lively.modules/moduleloaded",this._notificationHandlers[0],e),lively_notifications.unsubscribe("lively.modules/modulechanged",this._notificationHandlers[1],e),lively_notifications.unsubscribe("lively.vm/doitresult",this._notificationHandlers[2],e),this._notificationHandlers=null}}},{key:"clearCacheFor",value:function(e){this.exportByModuleCache[e]=null}},{key:"systemExports",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.rawExportsByModule(t);case 2:return r=e.sent,Object.keys(r).forEach(function(e){return n.resolveExportsOfModule(e,r)}),e.abrupt("return",lively_lang.arr.flatmap(Object.keys(r),function(e){return r[e].resolvedExports||r[e].rawExports}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"rawExportsByModule",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},r=this.System,n=r.get("@lively-env")||{},i=Object.keys(n.loadedModules||{}),o=this.exportByModuleCache,s={},e.next=4,Promise.all(i.map(function(e){return a.rawExportsOfModule(e,t,s).then(function(t){return t?s[e]=t:null})}));case 4:return e.abrupt("return",s);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"rawExportsOfModule",value:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,l,f,p,h,d,m,v,y,g,b,_,x,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.System,n=this.exportByModuleCache,i=w.excludedPackages||[],o=w.excludedURLs||(w.excludedURLs=i.filter(function(e){return"string"==typeof e})),s=w.excludeFns||(w.excludeFns=i.filter(function(e){return"function"==typeof e})),a=w.excludedPackageURLs||(w.excludedPackageURLs=o.concat(o.map(function(e){return r.decanonicalize(e.replace(/\/?$/,"/")).replace(/\/$/,"")}))),u=w.livelyEnv||(w.livelyEnv=r.get("@lively-env")||{}),c=w.modes||(w.modes=Object.keys(u.loadedModules||{})),!n[t]){e.next=4;break}return l=n[t].rawExports,e.abrupt("return",a.includes(l.packageURL)||s.some(function(e){return e(l.packageURL)})?null:n[t]);case 4:if(f=module$2(r,t),p=f.pathInPackage(),h=f.package(),d=h&&h.main&&p===h.main,m=h?h.url:"",v=h?h.name:"",y=h?h.version:"",g={moduleId:t,isMain:d,pathInPackage:p,packageName:v,packageURL:m,packageVersion:y,exports:[]},!a.includes(m)&&!s.some(function(e){return e(m)})){e.next=7;break}return e.abrupt("return",null);case 7:if(e.prev=7,b=f.format(),!["register","es6","esm"].includes(b)){e.next=15;break}return e.next=12,f.exports();case 12:g.exports=e.sent,e.next=27;break;case 15:return e.next=17,f.load();case 17:_=e.sent,g.exports=[],e.t0=regeneratorRuntime.keys(_);case 20:if((e.t1=e.t0()).done){e.next=27;break}if("__useDefault"!==(x=e.t1.value)&&"default"!==x){e.next=24;break}return e.abrupt("continue",20);case 24:g.exports.push({exported:x,local:x,type:"id"}),e.next=20;break;case 27:e.next=32;break;case 29:e.prev=29,e.t2=e.catch(7),g.error=e.t2;case 32:return e.abrupt("return",n[t]={rawExports:g});case 33:case"end":return e.stop()}},e,this,[[7,29]])}));return function(t){return e.apply(this,arguments)}}()},{key:"resolveExportsOfModule",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!n[e]){n[e]=!0;var i=t[e];if(i&&!i.resolvedExports){var o=this.System,s=lively_lang.obj.select(i.rawExports,["moduleId","isMain","packageName","packageURL","packageVersion","pathInPackage"]);i.resolvedExports=lively_lang.arr.flatmap(i.rawExports.exports,function(i){var a=i.type,u=i.exported,c=i.local,l=i.fromModule;if("all"!==a)return[_extends({},s,{type:a,exported:u,local:c,fromModule:l})];var f=o.decanonicalize(l,e);return r.resolveExportsOfModule(f,t,n),(t[f].resolvedExports||[]).map(function(e){var t=e.type,r=e.exported,n=e.local,i=e.fromModule;return _extends({},s,{type:t,exported:r,local:n,fromModule:i||l})})}),n[e]=!1}}}},{key:"exportByModuleCache",get:function(){return this._exportByModuleCache||(this._exportByModuleCache={})}}]),e}(),buildPackageMap=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,o,s,a,u,c,l,f,p,h,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{maxDepth:0,excludes:[]},m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=d.maxDepth,n=d.excludes,!(r>0&&v>r)){e.next=3;break}return e.abrupt("return",m);case 3:return e.prev=3,e.t0=JSON,e.next=7,lively_resources.resource(t).join("package.json").read();case 7:if(e.t1=e.sent,i=e.t0.parse.call(e.t0,e.t1),o=i.name+"@"+i.version,!m[o]&&!n.includes(i.name)){e.next=12;break}return e.abrupt("return",m);case 12:m[o]=_extends({url:t},lively_lang.obj.select(i,["name","version","dependencies","devDependencies","main"])),e.next=18;break;case 15:return e.prev=15,e.t2=e.catch(3),e.abrupt("return",m);case 18:return e.prev=18,e.next=21,lively_resources.resource(t).join("node_modules").dirList(1);case 21:s=e.sent,e.next=27;break;case 24:return e.prev=24,e.t3=e.catch(18),e.abrupt("return",m);case 27:a=!0,u=!1,c=void 0,e.prev=30,l=s[Symbol.iterator]();case 32:if(a=(f=l.next()).done){e.next=41;break}return p=f.value,h=p.url,e.next=37,buildPackageMap(h,d,m,v+1);case 37:m=e.sent;case 38:a=!0,e.next=32;break;case 41:e.next=47;break;case 43:e.prev=43,e.t4=e.catch(30),u=!0,c=e.t4;case 47:e.prev=47,e.prev=48,!a&&l.return&&l.return();case 50:if(e.prev=50,!u){e.next=53;break}throw c;case 53:return e.finish(50);case 54:return e.finish(47);case 55:return e.abrupt("return",m);case 56:case"end":return e.stop()}},e,this,[[3,15],[18,24],[30,43,47,55],[48,,50,54]])}));return function(t){return e.apply(this,arguments)}}(),dependencies=Object.freeze({buildPackageMap:buildPackageMap,resolvePackageDependencies:resolvePackageDependencies,dependencyGraph:dependencyGraph}),GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:void 0;exports.System=exports.System||prepareSystem(GLOBAL.System),exports.getSystem=getSystem,exports.removeSystem=removeSystem,exports.loadedModules=loadedModules$$1,exports.printSystemConfig=printSystemConfig$$1,exports.whenLoaded=whenLoaded$1,exports.changeSystem=changeSystem,exports.module=module$1,exports.doesModuleExist=doesModuleExist$$1,exports.isModuleLoaded=isModuleLoaded$$1,exports.importPackage=importPackage$$1,exports.registerPackage=registerPackage$$1,exports.removePackage=removePackage$1,exports.reloadPackage=reloadPackage$$1,exports.getPackages=getPackages,exports.getPackage=getPackage$$1,exports.getPackageOfModule=getPackageOfModule,exports.ensurePackage=ensurePackage$$1,exports.applyPackageConfig=applyPackageConfig,exports.lookupPackage=lookupPackage$$1,exports.moduleSourceChange=moduleSourceChange$$1,exports.requireMap=requireMap,exports.isHookInstalled=isHookInstalled,exports.installHook=installHook,exports.removeHook=removeHook,exports.wrapModuleLoad=wrapModuleLoad$$1,exports.unwrapModuleLoad=unwrapModuleLoad$$1,exports.cjs=dependencies,exports.PackageRegistry=PackageRegistry$$1,exports.ExportLookup=ExportLookup,exports.semver=semver}(this.lively.modules=this.lively.modules||{},lively.lang,lively.ast,lively.notifications,lively.vm,lively.resources,lively.classes,semver),"undefined"!=typeof module&&"function"==typeof require&&(module.exports=GLOBAL.lively.modules)}();