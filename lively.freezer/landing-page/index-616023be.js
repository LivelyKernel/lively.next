System.register(["./__rootModule___commonjs-entry-51a55f66.js"],function(bd,Dd){var se,Rc,ad,Ne,Cb,Sd,ve,uc,dd,vd,Ed,fe,jc,Od,qb,ic,Wb,lc,db,Xa,Gb,sc,ub,sb,fa,Db,ab,eb,kc,Vb,pb,Nb,zb,rb,Ib,da,ka,va,Fa;return{setters:[function(M){se=M.s;Rc=M.l;ad=M.u;Ne=M.$;Cb=M.a0;Sd=M.aK;ve=M.aL;uc=M.aM;dd=M.aN;vd=M.aO;Ed=M.aP;fe=M.aQ;jc=M.aR;Od=M.aS;qb=M.m;ic=M.K;Wb=M.as;lc=M.aT;db=M.n;Xa=M.aU;Gb=M._;sc=M.N;ub=M.t;sb=M.v;fa=M.a;Db=M.k;ab=M.aV;eb=M.ai;kc=M.a6;Vb=M.aW;pb=M.aX;Nb=M.aY;zb=M.aZ;rb=M.a_;Ib=M.a4;da=M.a$;
ka=M.b0;va=M.ar;Fa=M.b1}],execute:function(){function M(z,C,K){var T=3<arguments.length&&void 0!==arguments[3]?arguments[3]:K.name;(z[C]=Xf.fun.wrap(z[C],K)).hookFunc=K;K.hookName=T}function Aa(z,C,K){for(var T=[],O=z[C];O;)T.push(O),O=O.originalFunction;O="string"===typeof K?T.find(function(qa){return qa.hookFunc&&qa.hookFunc.hookName===K}):T.find(function(qa){return qa.hookFunc===K});if(!O)return!1;Xf.arr.remove(T,O);z[C]=T.reduceRight(function(qa,Ba){return Xf.fun.wrap(qa,Ba.hookFunc||Ba)});return!0}
function wb(z,C,K){for(z=z[C];z;){if(z.hookFunc&&("string"===typeof K&&z.hookFunc.hookName===K||z.hookFunc===K))return!0;z=z.originalFunction}return!1}function Na(z,C){z="string"===typeof z?ae.parse(z):z;C.scope=ae.query.resolveReferences(ae.query.scopes(z));return ae.ClassReplaceVisitor.run(z,C)}function hb(z){if(z.loads){var C=z.loads;return Gg.arr.uniq(Object.keys(Gg.loadedModules(z)).concat(Object.keys(C))).reduce(function(K,T){var O=C[T]?C[T].depMap:{};K[T]=Object.keys(O).map(function(qa){var Ba=
O[qa];return"@empty"===Ba?"".concat(Ba,"/").concat(qa):Ba});return K},{})}return Object.keys(z._loader.moduleRecords).reduce(function(K,T){K[T]=z._loader.moduleRecords[T].dependencies.filter(Boolean).map(function(O){return O.name});return K},{})}function Bb(z,C,K,T,O){var qa=z.get("@lively-env").pendingExportChanges;(z=vg.module(z,C).record())&&(K in z.exports||O)&&((qa[C]||(qa[C]={}))[K]=T)}function ba(z,C){var K=z.get("@lively-env").pendingExportChanges[C];K&&(vg.clearPendingModuleExportChanges(z,
C),vg.updateModuleExports(z,C,K))}function dc(){dc=Gb(regeneratorRuntime.mark(function qa(C,K,T,O){var Ba,ib,Ub,pc,Dc,kd,Ad,Rd,cf,Ud,Ge,Se,mh,Rh,dh;return regeneratorRuntime.wrap(function(eh){for(;;)switch(eh.prev=eh.next){case 0:return Ba=C.debug,ib={status:"loading",source:T,name:K,address:K,linkSets:[],dependencies:[],metadata:{format:"esm"}},eh.next=4,tg.instrumentSourceOfEsmModuleLoad(C,ib);case 4:Ub=eh.sent,pc=function(Rg,$c){return tg.scheduleModuleExportsChange(C,ib.name,Rg,$c,!0)},Dc=Ub.declare(pc),
Ba&&console.log("[lively.vm es6] sourceChange of %s with deps",ib.name,Ub.localDeps),kd=[],Ad=sc(Ub.localDeps),eh.prev=10,Ad.s();case 12:if((Rd=Ad.n()).done){eh.next=24;break}cf=Rd.value;eh.next=16;return C.normalize(cf,ib.name);case 16:return Ud=eh.sent,Ge=tg.classHolder.module(C,Ud),eh.next=20,Ge.load();case 20:Se=eh.sent,kd.push({name:cf,fullname:Ud,module:Ge,exports:Se});case 22:eh.next=12;break;case 24:eh.next=29;break;case 26:eh.prev=26,eh.t0=eh["catch"](10),Ad.e(eh.t0);case 29:return eh.prev=
29,Ad.f(),eh.finish(29);case 32:if(mh=C.loads&&C.loads[ib.name])mh.deps=kd.map(function(Rg){return Rg.name}),mh.depMap=kd.reduce(function(Rg,$c){Rg[$c.name]=$c.fullname;return Rg},{}),mh.metadata&&mh.metadata.entry&&(mh.metadata.entry.deps=mh.deps,mh.metadata.entry.normalizedDeps=kd.map(function(Rg){return Rg.fullname}),mh.metadata.entry.declare=Ub.declare);Rh=tg.classHolder.module(C,ib.name);dh=Rh.record();kd.forEach(function(Rg,$c){return Rh.addDependencyToModuleRecord(Rg.module,Dc.setters[$c])});
dh&&(dh.execute=Dc.execute);kd.forEach(function(Rg,$c){return Dc.setters[$c](Rg.exports)});return eh.abrupt("return",Dc.execute());case 40:case "end":return eh.stop()}},qa,null,[[10,26,29,32]])}));return dc.apply(this,arguments)}function la(){la=Gb(regeneratorRuntime.mark(function qa(C,K,T,O){var Ba,ib,Ub;return regeneratorRuntime.wrap(function(pc){for(;;)switch(pc.prev=pc.next){case 0:Ba={status:"loading",source:T,name:K,address:K,linkSets:[],dependencies:[],metadata:{format:"global"}};if(C.get(K)){pc.next=
4;break}pc.next=4;return Dd.import(K);case 4:return pc.next=6,tg.instrumentSourceOfGlobalModuleLoad(C,Ba);case 6:return ib=pc.sent,Ba.source=ib.translated,Ub=tg.doInstantiateGlobalModule(C,Ba),C["delete"](K),C.set(Ub.name,Ub.esModule),pc.abrupt("return",Ub.module);case 12:case "end":return pc.stop()}},qa)}));return la.apply(this,arguments)}function Fb(z,C,K,T,O){return vb.apply(this,arguments)}function vb(){vb=Gb(regeneratorRuntime.mark(function Ba(C,K,T,O,qa){var ib;return regeneratorRuntime.wrap(function(Ub){for(;;)switch(Ub.prev=
Ub.next){case 0:Ub.prev=0;C.debug&&console.log("[module change] ".concat(K," ").concat(T.slice(0,50).replace(/\n/g,"")," ").concat(O));if(O&&"es6"!==O&&"esm"!==O&&"register"!==O&&"defined"!==O){Ub.next=8;break}Ub.next=5;return tg.moduleSourceChangeEsm(C,K,T,qa);case 5:ib=Ub.sent;Ub.next=15;break;case 8:if("global"!==O){Ub.next=14;break}Ub.next=11;return tg.moduleSourceChangeGlobal(C,K,T,qa);case 11:ib=Ub.sent;Ub.next=15;break;case 14:throw Error("moduleSourceChange is not supported for module ".concat(K,
" with format ").concat(O));case 15:return tg.emit("lively.modules/modulechanged",{module:K,newSource:T,options:qa},Date.now(),C),Ub.abrupt("return",ib);case 19:throw Ub.prev=19,Ub.t0=Ub["catch"](0),tg.emit("lively.modules/modulechanged",{module:K,newSource:T,error:Ub.t0,options:qa},Date.now(),C),Ub.t0;case 23:case "end":return Ub.stop()}},Ba,null,[[0,19]])}));return vb.apply(this,arguments)}function Ia(z){return/\.js/i.test(z)}function xb(z){return pd.isJsFile(z)?z.replace(/\/[^\/]*$/,""):z.replace(/\/$/,
"")}function Rb(z){return/^[^:\\]+:\/\//.test(z)}function yc(z){var C=z.match(/^([^:]+:\/\/)(.*)/);if(!C)return z;z=C[1];var K=C=C[2];do C=K,K=C.replace(/\/[^\/]+\/\.\./,"");while(K!==C);K=K.replace(/(^|[^:])[\/]+/g,"$1/");K=K.replace(/\/\.\//g,"/");return z+K}function id(){return ob.apply(this,arguments)}function ob(){ob=Gb(regeneratorRuntime.mark(function C(){var K;return regeneratorRuntime.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return K=System.decanonicalize("lively.installer/packages-config.json"),
T.t0=JSON,T.next=4,ya.resource(K).read();case 4:return T.t1=T.sent,T.abrupt("return",T.t0.parse.call(T.t0,T.t1));case 6:case "end":return T.stop()}},C)}));return ob.apply(this,arguments)}function Pb(z,C){var K=2<arguments.length&&void 0!==arguments[2]?arguments[2]:!1,T=ya.classHolder.PackageRegistry.ofSystem(z),O=T.allPackageURLs();K=K?C:ya.normalizePackageURL(z,C,O);return{pkg:T.findPackageWithURL(K),url:K,allPackageURLs:O,registry:T}}function tb(z,C){var K=ya.lookupPackage(z,C,2<arguments.length&&
void 0!==arguments[2]?arguments[2]:!1),T=K.url,O=K.registry;return K.pkg||O.addPackageAt(T,"devPackageDirs")}function xc(z,C){var K=ya.lookupPackage(z,C,2<arguments.length&&void 0!==arguments[2]?arguments[2]:!1),T=K.pkg;K=K.url;if(T)return T;throw Error("[getPackage] package ".concat(C," (as ").concat(K,") not found"));}function Pc(z,C,K){return ya.getPackage(z,K).updateConfig(C)}function nd(z,C){return Promise.resolve(ya.ensurePackage(z,C)).then(function(K){return K["import"]()})}function Id(z,C){return(z=
ya.lookupPackage(z,C).pkg)?z.remove():null}function Hb(z,C,K){return ya.getPackage(z,C).reload(K)}function Kd(z,C,K){return Promise.resolve(ya.ensurePackage(z,C)).then(function(T){return T.register(K)})}function vc(z){return ya.Package.allPackages(z).map(function(C){return C.asSpec()})}function Qc(z,C,K){K=Oe.ensureParent(z,C);var T=z.System._nodeRequire("module");C.startsWith(".")&&(C=Oe.relative(z,C));return T._load(C,K)}function kb(z,C,K){K=Oe.ensureParent(z,C);var T=z.System._nodeRequire("module");
C.startsWith(".")&&(C=Oe.relative(z,C));return T._resolveFilename(C,K)}function Cc(z,C,K){var T=Fe.livelySystemEnv(z);C=z.decanonicalize(C,K);return T.loadedModules[C]||(T.loadedModules[C]=new Fe.ModuleInterface(z,C))}function zc(z,C){var K=2<arguments.length&&void 0!==arguments[2]?arguments[2]:!1,T=Fe.livelySystemEnv(z);return(K?C:z.normalizeSync(C))in T.loadedModules}function Fc(z,C){return xd.apply(this,arguments)}function xd(){xd=Gb(regeneratorRuntime.mark(function T(C,K){var O,qa,Ba,ib=arguments;
return regeneratorRuntime.wrap(function(Ub){for(;;)switch(Ub.prev=Ub.next){case 0:qa=(O=2<ib.length&&void 0!==ib[2]?ib[2]:!1)?K:C.normalizeSync(K);if(!Fe.isModuleLoaded(C,qa,!0)){Ub.next=4;break}return Ub.abrupt("return",!0);case 4:if((Ba=Fe.Package.forModuleId(C,qa))&&"no group"!==Ba.name){Ub.next=9;break}Ub.t0=C.resource(qa).exists();Ub.next=12;break;case 9:return Ub.next=11,Ba.hasResource(qa);case 11:Ub.t0=Ub.sent;case 12:return Ub.abrupt("return",Ub.t0);case 13:case "end":return Ub.stop()}},T)}));
return xd.apply(this,arguments)}function Uc(){return Tb.exceptions}function Md(z){return Tb.exceptions=z}function Ob(z,C,K,T,O){C=String(C);z=T.sourceAccessorName;var qa=T.recorder,Ba=T.recorderName,ib=T.dontTransform,Ub=T.varDefinitionCallbackName,pc=T.embedOriginalCode;z=(pc=void 0===pc?!0:pc)?z:void 0;T={topLevelVarRecorder:qa,varRecorderName:Ba,sourceAccessorName:z,dontTransform:ib,jsx:K.endsWith(".jsx"),recordGlobals:!0,keepPreviouslyDeclaredValues:!0,declarationWrapperName:Ub,evalId:T.nextEvalId(),
classTransform:Tb.classToFunctionTransform,currentModuleAccessor:Tb.funcCall(Tb.member(Tb.funcCall(Tb.member(Tb.member("__lvVarRecorder","System"),"get"),Tb.literal("@lively-env")),"moduleEnv"),Tb.literal(K))};qa="System.global"===Ba;ib=O?'console.log("[lively.modules] executing module '.concat(K,'");\n'):"";Ub="";qa?delete T.declarationWrapperName:(ib+='SystemJS.get("@lively-env").evaluationStart("'.concat(K,'");\n')+"var ".concat(Ba,' = SystemJS.get("@lively-env").moduleEnv("').concat(K,'").recorder;\n')+
(pc?"\nvar ".concat(z," = ").concat(JSON.stringify(C),";\n"):""),Ub+='\nSystemJS.get("@lively-env").evaluationEnd("'.concat(K,'");'));try{var Dc=ib+Tb.evalCodeTransform(C,T)+Ub;O&&"undefined"!==typeof $world&&$world.get("log")&&$world.get("log").isText&&($world.get("log").textString=Dc);return{source:Dc,options:T}}catch(kd){return console.error("Error in prepareCodeForCustomCompile of ".concat(K," ").concat(kd.stack)),{source:C,options:T}}}function Le(z,C,K,T,O,qa){C=String(C);z=Object.assign({},
O,{classTransform:Tb.classToFunctionTransform,topLevelVarRecorder:T.recorder,varRecorderName:T.recorderName,dontTransform:T.dontTransform,recordGlobals:!0,declarationWrapperName:T.varDefinitionCallbackName,currentModuleAccessor:Tb.funcCall(Tb.member(Tb.funcCall(Tb.member(Tb.member("__lvVarRecorder","System"),"get"),Tb.literal("@lively-env")),"moduleEnv"),Tb.literal(K))});try{var Ba=Tb.evalCodeTransformOfSystemRegisterSetters(C,z);qa&&"undefined"!==typeof $world&&$world.get("log")&&$world.get("log").isText&&
($world.get("log").textString+=Ba);return Ba}catch(ib){return console.error("Error in prepareTranslatedCodeForSetterCapture",ib.stack),C}}function We(){We=Gb(regeneratorRuntime.mark(function T(C,K){var O,qa,Ba,ib,Ub,pc,Dc,kd,Ad,Rd,cf,Ud,Ge,Se,mh,Rh,dh,eh;return regeneratorRuntime.wrap(function(Rg){for(;;)switch(Rg.prev=Rg.next){case 0:O=this;qa=O.debug;ib=(Ba=K.metadata)&&Ba.hasOwnProperty("instrument")&&!Ba.instrument||Tb.exceptions.some(function($c){return $c(K.name)});if(!ib){Rg.next=7;break}qa&&
console.log("[lively.modules customTranslate ignoring] %s",K.name);return Rg.abrupt("return",C(K));case 7:if(!Tb.isNode||!Tb.addNodejsWrapperSource(O,K)){Rg.next=10;break}qa&&console.log("[lively.modules] loaded %s from nodejs cache",K.name);return Rg.abrupt("return",C(K));case 10:Ub=Date.now();pc=Tb.detectModuleFormat(K.source,Ba);Dc=Tb.module(O,K.name);kd=!1;Ad="esm"===pc;Dc.setSource(K.source);Rg.prev=16;Rd=O.useModuleTranslationCache;cf=O.global.indexedDB;Ud=Rd&&String(Tb.string.hashCode(K.source));
if(!(Rd&&cf&&Ad)){Rg.next=33;break}Ge=O._livelyModulesTranslationCache||(O._livelyModulesTranslationCache=new Tb.BrowserModuleTranslationCache);Rg.next=24;return Ge.fetchStoredModuleSource(K.name);case 24:Se=Rg.sent;if(!(Se&&Se.hash===Ud&&Se.timestamp>=Tb.BrowserModuleTranslationCache.earliestDate)){Rg.next=31;break}if(!Se.source){Rg.next=31;break}Ba.format="register";Ba.deps=[];qa&&console.log("[lively.modules customTranslate] loaded %s from browser cache after %sms",K.name,Date.now()-Ub);return Rg.abrupt("return",
Promise.resolve(Se.source));case 31:Rg.next=44;break;case 33:if(!(Tb.isNode&&Rd&&Ad)){Rg.next=44;break}mh=O._livelyModulesTranslationCache||(O._livelyModulesTranslationCache=new Tb.NodeModuleTranslationCache);Rg.next=37;return mh.fetchStoredModuleSource(K.name);case 37:Rh=Rg.sent;if(!(Rh&&Rh.hash===Ud&&Rh.timestamp>=Tb.NodeModuleTranslationCache.earliestDate)){Rg.next=44;break}if(!Rh.source){Rg.next=44;break}Ba.format="register";Ba.deps=[];qa&&console.log("[lively.modules customTranslate] loaded %s from filesystem cache after %sms",
K.name,Date.now()-Ub);return Rg.abrupt("return",Promise.resolve(Rh.source));case 44:Rg.next=49;break;case 46:Rg.prev=46,Rg.t0=Rg["catch"](16),console.error("[lively.modules customTranslate] error reading module translation cache: ".concat(Rg.t0.stack));case 49:return dh={},eh=K.source,Ad?(Dc.recorderName="__lvVarRecorder",Dc.recorder===O.global&&Dc.unloadEnv(),K.metadata.format="esm",Tb.__inter0__=Tb.prepareCodeForCustomCompile(O,eh,K.name,Dc,qa),dh=Tb.__inter0__.options,eh=Tb.__inter0__.source,K.source=
eh,kd=K.metadata["lively.modules instrumented"]=!0,qa&&console.log("[lively.modules] loaded %s as es6 module",K.name)):"global"===K.metadata.format&&(Dc.recorderName="System.global",Dc.recorder=O.global,K.metadata.format="global",Tb.__inter1__=Tb.prepareCodeForCustomCompile(O,eh,K.name,Dc,qa),dh=Tb.__inter1__.options,eh=Tb.__inter1__.source,K.source=eh,kd=K.metadata["lively.modules instrumented"]=!0,qa&&console.log("[lively.modules] loaded %s as instrumented global module",K.name)),kd||qa&&console.log("[lively.modules] customTranslate ignoring %s b/c don't know how to handle format %s",
K.name,K.metadata.format),Rg.abrupt("return",C(K).then(function(){var $c=Gb(regeneratorRuntime.mark(function Yc(ye){var Tc,td;return regeneratorRuntime.wrap(function(hd){for(;;)switch(hd.prev=hd.next){case 0:0===ye.indexOf("System.register(")&&(qa&&console.log("[lively.modules customTranslate] Installing System.register setter captures for %s",K.name),ye=Tb.prepareTranslatedCodeForSetterCapture(O,ye,K.name,Dc,dh,qa));if(!(Tb.isNode&&Rd&&Ad)){hd.next=14;break}Tc=O._livelyModulesTranslationCache||(O._livelyModulesTranslationCache=
new Tb.NodeModuleTranslationCache);hd.prev=3;hd.next=6;return Tc.cacheModuleSource(K.name,Ud,ye);case 6:qa&&console.log("[lively.modules customTranslate] stored cached version in filesystem for %s",K.name);hd.next=12;break;case 9:hd.prev=9,hd.t0=hd["catch"](3),console.error("[lively.modules customTranslate] failed storing module cache: ".concat(hd.t0.stack));case 12:hd.next=25;break;case 14:if(!(Rd&&cf&&Ad)){hd.next=25;break}td=O._livelyModulesTranslationCache||(O._livelyModulesTranslationCache=new Tb.BrowserModuleTranslationCache);
hd.prev=16;hd.next=19;return td.cacheModuleSource(K.name,Ud,ye);case 19:qa&&console.log("[lively.modules customTranslate] stored cached version for %s",K.name);hd.next=25;break;case 22:hd.prev=22,hd.t1=hd["catch"](16),console.error("[lively.modules customTranslate] failed storing module cache: ".concat(hd.t1.stack));case 25:return qa&&console.log("[lively.modules customTranslate] done %s after %sms",K.name,Date.now()-Ub),hd.abrupt("return",ye);case 27:case "end":return hd.stop()}},Yc,null,[[3,9],
[16,22]])}));return function(ye){return $c.apply(this,arguments)}}()));case 54:case "end":return Rg.stop()}},T,this,[[16,46]])}));return We.apply(this,arguments)}function xe(z,C){return z.translate(C).then(function(K){var T=Tb.parse(K).body.find(function(qa){return qa.expression&&"CallExpression"===qa.expression.type&&"register"===qa.expression.callee.property.name});if(!T)throw Error("Cannot find register call in translated source of ".concat(C.name));var O=T.expression;T=O.arguments[0].elements.map(function(qa){return qa.value});
O=O.arguments[1];K=K.slice(O.start,O.end);K=eval('var SystemJS = System; var __moduleName = "'.concat(C.name,'";\n(').concat(K,");\n//# sourceURL=").concat(C.name,"\n"));z.debug&&"undefined"!==$world&&$world.get("log")&&$world.get("log").isText&&($world.get("log").textString=K);return{localDeps:T,declare:K}})}function Fg(z,C){return z.translate(C).then(function(K){return{translated:K}})}function Zc(z){Tb.isHookInstalled(z,"translate","lively_modules_translate_hook")||Tb.installHook(z,"translate",
function(C,K){return Tb.customTranslate.call(z,C,K)},"lively_modules_translate_hook")}function rd(z){Tb.removeHook(z,"translate","lively_modules_translate_hook")}function ti(){ti=Gb(regeneratorRuntime.mark(function T(C,K){var O,qa,Ba,ib,Ub,pc,Dc,kd,Ad,Rd,cf,Ud;return regeneratorRuntime.wrap(function(Ge){for(;;)switch(Ge.prev=Ge.next){case 0:O=this;qa=25E4;Ba=O.resource(K.name);ib=O.get("@system-env").node&&!Ba.isNodeJSFileResource&&!Ba.isESMResource;if(!ib){Ge.next=8;break}Ge.next=7;return Kf(K.name);
case 7:Ba=Ge.sent;case 8:if(Ba){Ge.next=10;break}return Ge.abrupt("return",C(K));case 10:if(Ye.jsFileHashMap||O.get("@system-env").node){Ge.next=14;break}Ge.next=13;return O.resource(O.baseURL).join("__JS_FILE_HASHES__").readJson();case 13:Ye.jsFileHashMap=Ge.sent;case 14:Dc=O.useModuleTranslationCache;kd=O.global.indexedDB;Ad=O._livelyModulesTranslationCache;if(O.get("@system-env").node||!Dc||!kd||!Ad){Ge.next=24;break}Ge.next=20;return Ad.fetchStoredModuleSource(K.name);case 20:Rd=Ge.sent;if(!Rd||
Ye.jsFileHashMap[K.name.replace(O.baseURL,"/")]!==Rd.hash&&!K.name.includes("jspm")){Ge.next=24;break}K.metadata.instrument=!1;return Ge.abrupt("return",Rd.source);case 24:if(!(Ba.isResource&&Ba.ext()&&Ba.ext().startsWith("css"))){Ge.next=26;break}return Ge.abrupt("return","");case 26:Ge.prev=26;if(!Ba.isResource){Ge.next=33;break}Ge.next=30;return Ba.read();case 30:Ge.t0=Ge.sent;Ge.next=34;break;case 33:Ge.t0=Ba;case 34:Ub=Ge.t0;Ge.next=40;break;case 37:Ge.prev=37,Ge.t1=Ge["catch"](26),pc=Ge.t1;
case 40:if(!pc||!O.get("@system-env").browser){Ge.next=53;break}cf=Ba.url.startsWith("http");Ud=!Ba.url.startsWith(document.location.origin);if(!cf||!Ud){Ge.next=53;break}Ge.prev=44;Ge.next=47;return Ba.makeProxied(O.baseURL).read();case 47:Ub=Ge.sent;pc=null;Ge.next=53;break;case 51:Ge.prev=51,Ge.t2=Ge["catch"](44);case 53:if(!pc){Ge.next=55;break}throw pc;case 55:if(!ib){Ge.next=59;break}Ge.next=58;return Ub.text();case 58:Ub=Ge.sent;case 59:if(!(Ub.length>qa&&"undefined"!==typeof $world)||O._loadingIndicator){Ge.next=
66;break}O._loadingIndicator=$world.execCommand("open loading indicator",{label:"loading module",status:K.name.replace(O.baseURL,"")});Ge.next=63;return Ye.promise.delay(500);case 63:if(!O._loadingIndicator){Ge.next=66;break}Ge.next=66;return O._loadingIndicator.whenRendered();case 66:return Ge.abrupt("return",Ub);case 67:case "end":return Ge.stop()}},T,this,[[26,37],[44,51]])}));return ti.apply(this,arguments)}function dg(z){z.resource=Ye.resource;Ye.isHookInstalled(z,"fetch",Ye.fetchResource)&&
Ye.removeHook(z,"fetch","fetchResource");Ye.installHook(z,"fetch",Ye.fetchResource);Ye.isHookInstalled(z,"resource","livelyProtocol")&&Ye.removeHook(z,"fetch","livelyProtocol");Ye.installHook(z,"resource",Ye.livelyProtocol)}function Of(z){Ye.removeHook(z,"fetch","fetchResource");Ye.removeHook(z,"resource","livelyProtocol");delete z.resource}function mg(z){te.isHookInstalled(z,"normalize","normalizeHook")||te.installHook(z,"normalize",te.normalizeHook,"normalizeHook");te.isHookInstalled(z,"decanonicalize",
"decanonicalizeHook")||te.installHook(z,"decanonicalize",te.decanonicalizeHook,"decanonicalizeHook");te.isHookInstalled(z,"locate","locateHook")||te.installHook(z,"locate",te.locateHook,"locateHook");te.isHookInstalled(z,"normalizeSync","decanonicalizeHook")||te.installHook(z,"normalizeSync",te.decanonicalizeHook,"decanonicalizeHook");te.isHookInstalled(z,"newModule","newModule_volatile")||te.installHook(z,"newModule",te.newModule_volatile,"newModule_volatile");te.isHookInstalled(z,"instantiate",
"instantiate_triggerOnLoadCallbacks")||te.installHook(z,"instantiate",te.instantiate_triggerOnLoadCallbacks,"instantiate_triggerOnLoadCallbacks");z._loader.modules||(z._loader.modules={});if(!z._loader.modules._originalModules){var C=Proxy.revocable(z._loader.modules,{set:function(T,O,qa){te.moduleLoadPromises[O]&&te.moduleLoadPromises[O].resolve(qa);T[O]=qa;return!0}}),K=C.proxy;K._revoke=C.revoke;K._originalModules=z._loader.modules;z._loader.modules=K}}function wf(z){te.removeHook(z,"normalize",
"normalizeHook");te.removeHook(z,"decanonicalize","decanonicalizeHook");te.removeHook(z,"normalizeSync","decanonicalizeHook");te.removeHook(z,"newModule","newModule_volatile");te.removeHook(z,"instantiate","instantiate_triggerOnLoadCallbacks");te.removeHook(z,"locate","locateHook");var C=z._loader.modules;C._originalModules&&(z._loader.modules=C._originalModules,C._revoke(),delete z._loader.modules._revoke,delete z._loader.modules._originalModules)}function mf(z){return{moduleEnv:function(C){return te.classHolder.module(z,
C)},get itself(){return z.get(z.decanonicalize("lively.modules/index.js"))},evaluationStart:function(C){te.classHolder.module(z,C).evaluationStart()},evaluationEnd:function(C){te.classHolder.module(z,C).evaluationEnd()},dumpConfig:function(){return JSON.stringify({baseURL:z.baseURL,transpiler:z.transpiler,defaultJSExtensions:z.defaultJSExtensions,map:z.map,meta:z.meta,packages:z.packages,paths:z.paths,packageConfigPaths:z.packageConfigPaths},null,2)},get packageRegistry(){return z["__lively.modules__packageRegistry"]},
set packageRegistry(C){z["__lively.modules__packageRegistry"]=C},packages:z["__lively.modules__packages"]||(z["__lively.modules__packages"]={}),loadedModules:z["__lively.modules__loadedModules"]||(z["__lively.modules__loadedModules"]={}),pendingExportChanges:z["__lively.modules__pendingExportChanges"]||(z["__lively.modules__pendingExportChanges"]={}),notifications:z["__lively.modules__notifications"]||(z["__lively.modules__notifications"]=[]),notificationSubscribers:z["__lively.modules__notificationSubscribers"]||
(z["__lively.modules__notificationSubscribers"]={}),options:z["__lively.modules__options"]||(z["__lively.modules__options"]=te.obj.deepCopy(te.defaultOptions)),onLoadCallbacks:z["__lively.modules__onLoadCallbacks"]||(z["__lively.modules__onLoadCallbacks"]=[]),modulePackageMapCache:z["__lively.modules__modulePackageMapCache"]}}function Mb(z,C){return z&&"string"!==typeof z?z:te.systems()[z]||(te.systems()[z]=te.makeSystem(C))}function gd(z){z=z&&"string"!==typeof z?te.nameOfSystem(z):z;delete te.systems()[z]}
function Vd(z,C){z.trace=!0;C=C||{};var K=C.hasOwnProperty("useModuleTranslationCache")?C.useModuleTranslationCache:!te.urlQuery().noModuleCache;z.useModuleTranslationCache=K;C._nodeRequire&&(z._nodeRequire=C._nodeRequire);z.set("@lively-env",z.newModule(te.livelySystemEnv(z)));"undefined"!==typeof WorkerGlobalScope&&z.set("@system-env",z.newModule(Object.assign({},z.get("@system-env"),{browser:!0,worker:!0,location})));(K="undefined"!==typeof process&&process.versions&&process.versions.electron)&&
z.set("@system-env",z.newModule(Object.assign({electron:K},z.get("@system-env"))));te.wrapResource(z);te.wrapModuleLoad(z);te.wrapModuleResolution(z);K&&(K=["electron"].reduce(function(T,O){T[O]="@node/"+O;return T},{}),C.map=te.obj.merge(K,C.map));te.isNode&&(K="addons assert buffer child_process cluster console crypto dgram dns domain events fs http https module net os path punycode querystring readline repl stream stringdecoder timers tls tty url util v8 vm zlib constants worker_threads process".split(" ").reduce(function(T,
O){T[O]=T["node:"+O]="@node/"+O;return T},{}),C.map=te.obj.merge(K,C.map));C.packageConfigPaths=C.packageConfigPaths||["./node_modules/*/package.json"];C.transpiler||"traceur"!==z.transpiler||(K=te.GLOBAL.System,"lively.transpiler"===K.transpiler?(z.set("lively.transpiler",K.get("lively.transpiler")),z._loader.transpilerPromise=K._loader.transpilerPromise,z.config({transpiler:"lively.transpiler",babelOptions:Object.assign(K.babelOptions||{},C.babelOptions)})):z.config({map:{"plugin-babel":K.map["plugin-babel"],
"systemjs-babel-build":K.map["systemjs-babel-build"]},transpiler:K.transpiler,babelOptions:Object.assign(K.babelOptions||{},C.babelOptions)}));z.config(C);return z}function sf(){sf=Gb(regeneratorRuntime.mark(function T(C,K){var O;return regeneratorRuntime.wrap(function(qa){for(;;)switch(qa.prev=qa.next){case 0:K._fileCheckMap=K._fileCheckMap||{};if(!(C in K._fileCheckMap)){qa.next=3;break}return qa.abrupt("return",K._fileCheckMap[C]);case 3:O=K._livelyModulesTranslationCache;qa.t0=O;if(!qa.t0){qa.next=
9;break}qa.next=8;return O.fetchStoredModuleSource(C);case 8:qa.t0=qa.sent;case 9:if(!qa.t0){qa.next=11;break}return qa.abrupt("return",K._fileCheckMap[C]=!0);case 11:return qa.next=13,te.resource(C).exists();case 13:return qa.abrupt("return",K._fileCheckMap[C]=qa.sent);case 14:case "end":return qa.stop()}},T)}));return sf.apply(this,arguments)}function hg(){hg=Gb(regeneratorRuntime.mark(function qa(C,K,T,O){var Ba,ib,Ub,pc,Dc,kd;return regeneratorRuntime.wrap(function(Ad){for(;;)switch(Ad.prev=Ad.next){case 0:if(!T||
"cjs"!==K){Ad.next=2;break}return Ad.abrupt("return","cjs");case 2:if("@system-env"!==K){Ad.next=4;break}return Ad.abrupt("return",K);case 4:return Ba=this,ib=te.preNormalize(Ba,K,T),Ad.next=8,C(ib,T,!0);case 8:Ub=Ad.sent;pc=te.postNormalize(Ba,Ub||ib,!1);Dc=pc.startsWith("file:");Ba.debug&&console.log("[normalize] ".concat(K," => ").concat(pc));if(te.jsExtRe.test(K)||te.jsxExtRe.test(K)||te.cjsExtRe.test(K)||te.jsonExtRe.test(pc)||te.nodeModRe.test(pc)||te.nodeExtRe.test(pc)||Ba.loads&&Ba.loads[pc]){Ad.next=
38;break}if(!te.jsExtRe.test(pc)){Ad.next=29;break}Ad.next=16;return te.checkExistence(pc,Ba);case 16:if(!Ad.sent){Ad.next=18;break}return Ad.abrupt("return",pc);case 18:return kd=pc.replace(".js","/index.js"),Ad.next=21,te.checkExistence(kd,Ba);case 21:Ad.t0=Ad.sent;if(Ad.t0){Ad.next=24;break}Ad.t0=!Dc;case 24:if(!Ad.t0){Ad.next=26;break}return Ad.abrupt("return",kd);case 26:return Ad.abrupt("return",pc.replace(".js","/index.node"));case 29:if(pc.includes("jspm.dev")||"@empty"===pc){Ad.next=38;break}Ad.next=
32;return te.checkExistence(pc+".js",Ba);case 32:if(!Ad.sent){Ad.next=34;break}return Ad.abrupt("return",pc+".js");case 34:return Ad.next=36,te.checkExistence(pc+"/index.js",Ba);case 36:if(!Ad.sent){Ad.next=38;break}return Ad.abrupt("return",pc+"/index.js");case 38:return te.jsxJsExtRe.test(pc)&&(pc=pc.replace(".jsx.js",".jsx")),Ad.abrupt("return",pc);case 40:case "end":return Ad.stop()}},qa,this)}));return hg.apply(this,arguments)}function bh(){bh=Gb(regeneratorRuntime.mark(function T(C,K){var O,
qa,Ba,ib;return regeneratorRuntime.wrap(function(Ub){for(;;)switch(Ub.prev=Ub.next){case 0:return O=K.name.split("!"),qa=ic(O,2),Ba=qa[0],K.name=Ba,Ub.next=4,C(K);case 4:return ib=Ub.sent,Ub.abrupt("return",ib);case 6:case "end":return Ub.stop()}},T)}));return bh.apply(this,arguments)}function Qf(){Qf=Gb(regeneratorRuntime.mark(function K(C){return regeneratorRuntime.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.abrupt("return",System.get(C)||(te.moduleLoadPromises[C]||(te.moduleLoadPromises[C]=
te.promise.deferred())).promise);case 1:case "end":return T.stop()}},K)}));return Qf.apply(this,arguments)}function he(z){z=te.getSystem(z);return JSON.stringify({baseURL:z.baseURL,transpiler:z.transpiler,defaultJSExtensions:z.defaultJSExtensions,defaultExtension:z.defaultExtension,map:z.map,meta:z.meta,packages:z.packages,paths:z.paths,packageConfigPaths:z.packageConfigPaths,bundles:z.bundles},null,2)}function Uf(z,C,K){var T=z.decanonicalize(C);if(z.get(T))try{K(te.classHolder.module(z,T))}catch(O){console.error(O)}else z.get("@lively-env").onLoadCallbacks.push({moduleName:C,
resolved:!1,callback:K})}function $g(z){return z.get("@lively-env").loadedModules}function Ta(z){var C=z.loads?Object.keys(z.loads):Object.keys(z._loader.moduleRecords);return te.arr.uniq(C.concat(Object.keys(te.loadedModules(z))))}function th(z,C,K){return Promise.all(te.obj.values(te.loadedModules(z)).map(function(T){return T.search(C,K)})).then(function(T){return T.flat()})}function Be(z){return cb.apply(this,arguments)}function cb(){cb=Gb(regeneratorRuntime.mark(function K(C){var T,O,qa,Ba,ib,
Ub,pc,Dc,kd,Ad,Rd,cf=arguments;return regeneratorRuntime.wrap(function(Ud){for(;;)switch(Ud.prev=Ud.next){case 0:T=1<cf.length&&void 0!==cf[1]?cf[1]:{maxDepth:0,excludes:[]};O=2<cf.length&&void 0!==cf[2]?cf[2]:{};qa=3<cf.length&&void 0!==cf[3]?cf[3]:0;Ba=T.maxDepth;ib=T.excludes;if(!(0<Ba&&qa>Ba)){Ud.next=6;break}return Ud.abrupt("return",O);case 6:return Ud.prev=6,Ud.t0=JSON,Ud.next=10,gi.resource(C).join("package.json").read();case 10:Ud.t1=Ud.sent;Ub=Ud.t0.parse.call(Ud.t0,Ud.t1);pc="".concat(Ub.name,
"@").concat(Ub.version);if(!O[pc]&&!ib.includes(Ub.name)){Ud.next=15;break}return Ud.abrupt("return",O);case 15:O[pc]=Object.assign({url:C},gi.obj.select(Ub,["name","version","dependencies","devDependencies","main"]));Ud.next=21;break;case 18:return Ud.prev=18,Ud.t2=Ud["catch"](6),Ud.abrupt("return",O);case 21:return Ud.prev=21,Ud.next=24,gi.resource(C).join("node_modules").dirList(1);case 24:Dc=Ud.sent;Ud.next=30;break;case 27:return Ud.prev=27,Ud.t3=Ud["catch"](21),Ud.abrupt("return",O);case 30:kd=
sc(Dc),Ud.prev=31,kd.s();case 33:if((Ad=kd.n()).done){Ud.next=40;break}Rd=Ad.value.url;Ud.next=37;return Be(Rd,T,O,qa+1);case 37:O=Ud.sent;case 38:Ud.next=33;break;case 40:Ud.next=45;break;case 42:Ud.prev=42,Ud.t4=Ud["catch"](31),kd.e(Ud.t4);case 45:return Ud.prev=45,kd.f(),Ud.finish(45);case 48:return Ud.abrupt("return",O);case 49:case "end":return Ud.stop()}},K,null,[[6,18],[21,27],[31,42,45,48]])}));return cb.apply(this,arguments)}function Yb(z,C){var K=Object.assign({},z.dependencies,{},z.devDependencies);
return Object.keys(K).reduce(function(T,O){var qa=K[O],Ba=gi.obj.values(C).find(function(Ub){var pc=Ub.version;return Ub.name===O&&lively.modules.semver.satisfies(pc,qa)})||{},ib=Ba.name;Ba=Ba.version;T[O]=ib?"".concat(ib,"@").concat(Ba):void 0;return T},{})}function de(z){function C(O,qa){var Ba="".concat(O,"@").concat(qa);if(Ba in T)return T[Ba];var ib=K.find(function(pc){var Dc=pc.version;return pc.name===O&&lively.modules.semver.satisfies(Dc,qa)})||{},Ub=ib.name;ib=ib.version;return T[Ba]=Ub?
"".concat(Ub,"@").concat(ib):void 0}var K=gi.obj.values(z),T={};return Object.keys(z).reduce(function(O,qa){var Ba=z[qa],ib=Object.assign({},Ba.dependencies,{},Ba.devDependencies);O[qa]=Object.keys(ib).map(function(Ub){return C(Ub,ib[Ub])}).filter(function(Ub){return!!Ub});return O},{})}function P(z,C){ke.defaultSystem=z;C&&(ke.GLOBAL.System=z);z._scripting=ke.scripting;return z}function pa(){ke._wrapModuleResolution(ke.defaultSystem)}function wa(){ke._unwrapModuleResolution(ke.defaultSystem)}function Ea(){return Object.keys(ke.requireMap())}
function ia(z){return ke._module(ke.defaultSystem,z)}function Ca(z,C){return ke._isModuleLoaded(ke.defaultSystem,z,C)}function w(z,C){return ke._doesModuleExist(ke.defaultSystem,z,C)}function ma(){return ke._printSystemConfig(ke.defaultSystem)}function ua(z,C){return ke._whenLoaded(ke.defaultSystem,z,C)}function ha(z){return ke._importPackage(ke.defaultSystem,z)}function ra(z,C){return ke._registerPackage(ke.defaultSystem,z,C)}function mb(z){return ke._removePackage(ke.defaultSystem,z)}function E(z,
C){return ke._reloadPackage(ke.defaultSystem,z,C)}function R(){return ke.getPackageSpecs(ke.defaultSystem)}function Ya(z){return ke._getPackage(ke.defaultSystem,z,1<arguments.length&&void 0!==arguments[1]?arguments[1]:!1)}function gb(z){return ke.Package.forModuleId(ke.defaultSystem,z)}function $b(z){return ke._ensurePackage(ke.defaultSystem,z)}function Sc(z,C){return ke._applyPackageConfig(ke.defaultSystem,z,C)}function Ic(z){return ke._lookupPackage(ke.defaultSystem,z,1<arguments.length&&void 0!==
arguments[1]?arguments[1]:!1)}function Pd(z,C,K){return ke._moduleSourceChange(ke.defaultSystem,z,C,K)}function Zd(){return ke.computeRequireMap(ke.defaultSystem)}function ge(z,C){return ke._isHookInstalled(ke.defaultSystem,z,C)}function Ce(z,C){return ke._installHook(ke.defaultSystem,z,C)}function $e(z,C){return ke._removeHook(ke.defaultSystem,z,C)}function pf(){ke._wrapModuleLoad(ke.defaultSystem)}function ig(){ke._unwrapModuleLoad(ke.defaultSystem)}bd({b:Na,m:ia,p:id});var Xf=window.lively.FreezerRuntime.recorderFor("lively.modules/src/hooks.js");
Xf.install=M;Xf.remove=Aa;Xf.isInstalled=wb;Xf.arr=se;Xf.fun=Rc;Xf.install=M;Xf.remove=Aa;Xf.isInstalled=wb;var Vg=window.lively.FreezerRuntime.recorderFor("lively.modules/src/cycle-breaker.js");Vg.classHolder={};var Re=Vg.classHolder;Vg.classHolder=Re;var ae=window.lively.FreezerRuntime.recorderFor("lively.classes/class-to-function-transform.js");ae.isFunctionNode=function(z){return"ArrowFunctionExpression"===z.type||"FunctionExpression"===z.type||"FunctionDeclaration"===z.type};ae.ensureIdentifier=
function(z){return z.replace(ae.firstIdRe,"_").replace(ae.trailingIdRe,"_")};ae.classFieldsInitialization=function(z){return z.map(function(C){var K=C.key;C=C.value;var T=K.name;"PrivateIdentifier"===K.type&&(T="_"+T);return ae.assign(ae.member("this",T),C)})};ae.constructorTemplate=function(z,C){return ae.funcExpr({id:z?ae.id(z):null},["__first_arg__"],ae.ifStmt(ae.binaryExpr(ae.id("__first_arg__"),"&&",ae.member("__first_arg__",ae.funcCall(ae.member("Symbol","for"),ae.literal("lively-instance-restorer")),
!0)),ae.block(),ae.block.apply(ae,qb(ae.classFieldsInitialization(C)).concat([ae.returnStmt(ae.funcCall(ae.member(ae.member("this",ae.funcCall(ae.member("Symbol","for"),ae.literal("lively-instance-initialize")),!0),"apply"),ae.id("this"),ae.id("arguments")))]))))};ae.splitExportDefaultWithClass=function(z,C,K,T){return z.declaration&&z.declaration[ae.isTransformedClassVarDeclSymbol]?[z.declaration,{declaration:z.declaration.declarations[0].id,type:"ExportDefaultDeclaration"}]:z};ae.replaceSuper=function(z,
C,K,T){console.assert("Super"===z.type);(C=C.currentMethod)||console.warn("[lively.classes] Trying to transform es6 class but got super call outside a method! ".concat(ae.stringify(z)," in ").concat(K.join(".")));K=K.slice(-2);K=ic(K,2);T=K[1];return"callee"===K[0]&&"object"===T||"callee"===T?z:C&&"static"===C[ae.methodKindSymbol]?ae.funcCall(ae.member("Object","getPrototypeOf"),ae.id(ae.tempLivelyClassVar)):ae.funcCall(ae.member("Object","getPrototypeOf"),ae.member(ae.id(ae.tempLivelyClassVar),"prototype"))};
ae.replaceSuperMethodCall=function(z,C,K,T){console.assert("CallExpression"===z.type);console.assert("Super"===z.callee.object.type);return ae.funcCall.apply(ae,[ae.member(ae.funcCall(ae.member(T.functionNode,"_get"),ae.replaceSuper(z.callee.object,C,K.concat(["callee","object"]),T),ae.literal(z.callee.property.value||z.callee.property.name),ae.id("this")),"call"),ae.id("this")].concat(qb(z.arguments)))};ae.replaceDirectSuperCall=function(z,C,K,T){console.assert("CallExpression"===z.type);console.assert("Super"===
z.callee.type);return ae.funcCall.apply(ae,[ae.member(ae.funcCall(ae.member(T.functionNode,"_get"),ae.replaceSuper(z.callee,C,K.concat(["callee"]),T),ae.funcCall(ae.member("Symbol","for"),ae.literal("lively-instance-initialize")),ae.id("this")),"call"),ae.id("this")].concat(qb(z.arguments)))};ae.replaceSuperGetter=function(z,C,K,T){console.assert("MemberExpression"===z.type);console.assert("Super"===z.object.type);return ae.funcCall(ae.member(T.functionNode,"_get"),ae.replaceSuper(z.object,C,K.concat(["object"]),
T),ae.literal(z.property.value||z.property.name),ae.id("this"))};ae.replaceSuperSetter=function(z,C,K,T){console.assert("AssignmentExpression"===z.type);console.assert("Super"===z.left.object.type);return ae.funcCall(ae.member(T.functionNode,"_set"),ae.replaceSuper(z.left.object,C,K.concat(["left","object"]),T),ae.literal(z.left.property.value||z.left.property.name),z.right,ae.id("this"))};ae.replaceClass=function(z,C,K,T){console.assert("ClassDeclaration"===z.type||"ClassExpression"===z.type);var O=
z.body.body,qa=z.superClass;K=z.id;var Ba=z.type,ib=z.start,Ub=z.end,pc=T.addClassNameGetter,Dc=void 0===pc?!0:pc;pc=ae.id("undefined");var kd=ae.id("undefined"),Ad=K?K.name:"anonymous_class",Rd=T.evalId,cf=T.sourceAccessorName;z=z["x-lively-object-meta"]||{start:ib,end:Ub};var Ud=["Literal","Identifier","PrivateIdentifier","MemberExpression","CallExpression"];O=O.reduce(function(Rh,dh){var eh=dh.key,Rg=dh.kind,$c=dh.value,vf=dh["static"],ye=dh.type;Ud.includes(eh.type)||console.warn("Unexpected key in classToFunctionTransform! ".concat(JSON.stringify(eh),
" -> ").concat(ae.stringify(dh)));if("method"===Rg){dh=eh.name||eh.value||ae.Path("property.name").get(eh);var Yc=ae.id(Ad+"_"+ae.ensureIdentifier(dh||ae.Path("arguments.0.value").get(eh))+"_");eh=["key",dh?ae.literal(dh):eh,"value",Object.assign({},$c,Wb({id:Yc},ae.methodKindSymbol,vf?"static":"proto"))];Yc=ae.objectLiteral(eh)}else"get"===Rg||"set"===Rg?Yc=ae.objectLiteral(["key",ae.literal(eh.name||eh.value||ae.Path("property.name").get(eh)),Rg,Object.assign({},$c,Wb({id:ae.id(Rg)},ae.methodKindSymbol,
vf?"static":"proto"))]):"constructor"===Rg?(eh=["key",ae.funcCall(ae.member("Symbol","for"),ae.literal("lively-instance-initialize")),"value",Object.assign({},$c,Wb({id:ae.id(Ad+"_initialize_")},ae.methodKindSymbol,"proto"))],Yc=ae.objectLiteral(eh)):"PropertyDefinition"===ye?Rh.fields.push(dh):console.warn("[lively.classes] classToFunctionTransform encountered unknown class property with kind ".concat(Rg,", ignoring it, ").concat(JSON.stringify(dh)," -> ").concat(ae.stringify(dh)));Yc&&(vf?Rh.clazz:
Rh.inst).push(Yc);return Rh},{inst:[],fields:[],clazz:Dc?[ae.parse('({ key: Symbol.for("__LivelyClassName__"), get: function get() { return "'.concat(Ad,'"; } })')).body[0].expression]:[]});ib=O.inst;Ub=O.clazz;O=O.fields;ib.length&&(pc={type:"ArrayExpression",elements:ib});Ub.length&&(kd={type:"ArrayExpression",elements:Ub});ib=T.scope;if(qa&&T.currentModuleAccessor)if(T.classHolder===qa.object){var Ge=qa;var Se=qa.property.name}else{var mh=ib&&ib.resolvedRefMap&&ib.resolvedRefMap.get(qa);mh&&mh.decl&&
ib.decls&&ib.decls.find(function(Rh){return ic(Rh,1)[0]===mh.decl})&&(Ge=qa,Se=qa.name)}Se=Ge?ae.objectLiteral(["referencedAs",ae.literal(Se),"value",Ge]):qa||ae.id("undefined");Ge=K&&"ClassDeclaration"===Ba;qa=["start",ae.literal(z.start),"end",ae.literal(z.end)];"undefined"!==typeof Rd&&qa.push("evalId",ae.literal(Rd));cf&&qa.push("moduleSource",ae.nodes.id(cf));Rd=ae.objectLiteral(qa);pc=ae.funcCall(ae.funcExpr({},["superclass"],ae.varDecl(ae.tempLivelyClassHolderVar,C.classHolder),ae.varDecl(ae.tempLivelyClassVar,
Ge?{type:"ConditionalExpression",test:ae.binaryExpr(ae.funcCall(ae.member(ae.tempLivelyClassHolderVar,"hasOwnProperty"),ae.literal(K.name)),"&&",ae.binaryExpr({argument:ae.member(ae.tempLivelyClassHolderVar,K),operator:"typeof",prefix:!0,type:"UnaryExpression"},"===",ae.literal("function"))),consequent:ae.member(ae.tempLivelyClassHolderVar,K),alternate:ae.assign(ae.member(ae.tempLivelyClassHolderVar,K),ae.constructorTemplate(K.name,O))}:K?ae.constructorTemplate(K.name,O):ae.constructorTemplate(null,
O)),ae.returnStmt(ae.funcCall(T.functionNode,ae.id(ae.tempLivelyClassVar),ae.id("superclass"),pc,kd,ae.id(ae.tempLivelyClassHolderVar),T.currentModuleAccessor||ae.id("undefined"),Rd))),Se);if("ClassExpression"===Ba)return pc;Ba=pc;T.declarationWrapper&&C.classHolder===T.classHolder&&(Ba=ae.funcCall(T.declarationWrapper,ae.literal(K.name),ae.literal("class"),Ba,T.classHolder,Rd));Ba=ae.varDecl(K,Ba,"var");Ba[ae.isTransformedClassVarDeclSymbol]=!0;return Ba};ae.replacePrivateIdentifier=function(z){return Object.assign({},
z,{type:"Identifier",name:"_"+z.name})};ae.classToFunctionTransform=Na;ae.Path=ad;ae.parse=Ne;ae.stringify=Cb;ae.query=Sd;ae.nodes=ve;ae.Visitor=uc;var Sb=ae.nodes;ae.assign=Sb.assign;ae.member=Sb.member;ae.id=Sb.id;ae.exprStmt=Sb.exprStmt;ae.funcCall=Sb.funcCall;ae.literal=Sb.literal;ae.objectLiteral=Sb.objectLiteral;ae.varDecl=Sb.varDecl;ae.funcExpr=Sb.funcExpr;ae.returnStmt=Sb.returnStmt;ae.binaryExpr=Sb.binaryExpr;ae.ifStmt=Sb.ifStmt;ae.block=Sb.block;ae.firstIdRe=/^[^_a-z]/i;ae.trailingIdRe=
/[^_a-z0-9]/ig;ae.isTransformedClassVarDeclSymbol=Symbol();ae.methodKindSymbol=Symbol();ae.tempLivelyClassVar="__lively_class__";ae.tempLivelyClassHolderVar="__lively_classholder__";var Hd=function(z){function C(){Ed(this,C);return K.apply(this,arguments)}dd(C,z);var K=vd(C);fe(C,[{key:"accept",value:function(T,O,qa){ae.isFunctionNode(T)&&(O=Object.assign({},O,{classHolder:ae.objectLiteral([]),currentMethod:T[ae.methodKindSymbol]?T:O.currentMethod}));if("ClassExpression"===T.type||"ClassDeclaration"===
T.type)T=ae.replaceClass(T,O,qa,O.options);"PrivateIdentifier"===T.type&&(T=ae.replacePrivateIdentifier(T));"Super"===T.type&&(T=ae.replaceSuper(T,O,qa,O.options));"MemberExpression"===T.type&&T.object&&"Super"===T.object.type&&(T=ae.replaceSuperGetter(T,O,qa,O.options));"AssignmentExpression"===T.type&&"MemberExpression"===T.left.type&&"Super"===T.left.object.type&&(T=ae.replaceSuperSetter(T,O,qa,O.options));"CallExpression"===T.type&&"Super"===T.callee.type&&(T=ae.replaceDirectSuperCall(T,O,qa,
O.options));"CallExpression"===T.type&&T.callee.object&&"Super"===T.callee.object.type&&(T=ae.replaceSuperMethodCall(T,O,qa,O.options));T=jc(Od(C.prototype),"accept",this).call(this,T,O,qa);return"ExportDefaultDeclaration"===T.type?ae.splitExportDefaultWithClass(T,O,qa,O.options):T}}],[{key:"run",value:function(T,O){var qa=new this,Ba=O.classHolder||ae.objectLiteral([]);return qa.accept(T,{options:O,classHolder:Ba},[])}}]);return C}(ae.Visitor);ae.ClassReplaceVisitor=Hd;ae.classToFunctionTransform=
Na;var hf=window.lively.FreezerRuntime.recorderFor("lively.classes/index.js");hf.runtime=lc;hf.classToFunctionTransform=Na;hf.runtime=lc;hf.classToFunctionTransform=Na;var zf=Object.freeze({__proto__:null,runtime:lc,classToFunctionTransform:Na});bd("c",zf);var Gg=window.lively.FreezerRuntime.recorderFor("lively.modules/src/dependencies.js");Gg.computeRequireMap=hb;Gg.arr=se;Gg.loadedModules=$g;Gg.computeRequireMap=hb;var vg=window.lively.FreezerRuntime.recorderFor("lively.modules/src/import-export.js");
vg.scheduleModuleExportsChange=Bb;vg.clearPendingModuleExportChanges=function(z,C){delete z.get("@lively-env").pendingExportChanges[C]};vg.updateModuleExports=function(z,C,K){var T=z.debug;vg.module(z,C).updateRecord(function(O){var qa=[],Ba=[];Object.keys(K).forEach(function(Rd){var cf=K[Rd];T&&console.log("[lively.vm es6 updateModuleExports] %s export %s = %s",C,Rd,String(cf).slice(0,30).replace(/\n/g,"")+"...");var Ud=!(Rd in O.exports);Ud&&(O.__lively_modules__.evalOnlyExport[Rd]=!0);O.exports[Rd]=
cf;Ud?qa.push(Rd):Ba.push(Rd)});if(qa.length){var ib=z.get(C);Object.isFrozen(ib)?(console.warn("[lively.vm es6 updateModuleExports] Since module %s is frozen a new module object was installed in the system. Note that only(!) exisiting module bindings are updated. New exports that were added will only be available in already loaded modules after those are reloaded!",C),z.set(C,z.newModule(O.exports))):(T&&console.log("[lively.vm es6 updateModuleExports] adding new exports to %s",C),qa.forEach(function(Rd){Object.defineProperty(ib,
Rd,{configurable:!1,enumerable:!0,get:function(){return O.exports[Rd]},set:function(){throw Error("exports cannot be changed from the outside");}})}))}if(Ba.length){T&&console.log("[lively.vm es6 updateModuleExports] updating %s dependents of %s",O.importers.length,C);for(var Ub=0,pc=O.importers.length;Ub<pc;Ub++){var Dc=O.importers[Ub],kd=void 0;if(!Dc.locked&&Dc.dependencies.some(function(Rd,cf){kd=cf;return Rd&&Rd.name===O.name})){if(T){var Ad=vg.module(z,Dc.name);console.log("[lively.vm es6 updateModuleExports] calling setters of ".concat(Ad["package"]().name,
"/").concat(Ad.pathInPackage()))}vg.module(z,Dc.name).evaluationStart();Dc.setters[kd](O.exports);vg.module(z,Dc.name).evaluationEnd()}}}})};vg.runScheduledExportChanges=ba;vg.commonjsHelpers=db;vg.module=Cc;vg.scheduleModuleExportsChange=Bb;vg.runScheduledExportChanges=ba;var tg=window.lively.FreezerRuntime.recorderFor("lively.modules/src/change.js");tg.moduleSourceChangeEsm=function(z,C,K,T){return dc.apply(this,arguments)};tg.doInstantiateGlobalModule=function(z,C){var K=tg.__createEntry();K.name=
C.name;K.esmExports=!0;C.metadata.entry=K;K.deps=[];for(var T in C.metadata.globals){var O=C.metadata.globals[T];O&&K.deps.push(O)}K.execute=function(qa,Ba,ib){(Ba=(Ba=tg.classHolder.module(z,ib.id).metadata())&&Ba.entry&&Ba.entry.module&&Ba.entry.module.exports)&&Object.keys(Ba).forEach(function(Dc){try{delete z.global[Dc]}catch(kd){console.warn('[lively.modules] executeGlobalModule: Cannot delete global["'.concat(Dc,'"]'))}});if(C.metadata.globals){var Ub={};for(var pc in C.metadata.globals)C.metadata.globals[pc]&&
(Ub[pc]=qa(C.metadata.globals[pc]))}if(qa=C.metadata.exports)C.source+='\nSystem.global["'.concat(qa,'"] = ').concat(qa,";");ib=z.get("@@global-helpers").prepareGlobal(ib.id,qa,Ub);tg.__evaluateGlobalLoadSource(z,C);return ib()};return tg.runExecuteOfGlobalModule(z,K)};tg.moduleSourceChangeGlobal=function(z,C,K,T){return la.apply(this,arguments)};tg.moduleSourceChange=Fb;tg.__createEntry=function(){return{name:null,deps:null,originalIndices:null,declare:null,execute:null,executingRequire:!1,declarative:!1,
normalizedDeps:null,groupIndex:null,evaluated:!1,module:null,esModule:null,esmExports:!1}};tg.__evaluateGlobalLoadSource=function(z,C){function K(){0===--O&&(qa.System=qa.SystemJS=T)}var T,O=0,qa=z.global;return function(Ba){try{0===O++&&(T=qa.System),qa.System=qa.SystemJS=this,(0,eval)(Ba.source),K()}catch(ib){throw K(),Error("Error evaluating ".concat(Ba.address,":\n").concat(ib.stack));}}.call(z,C)};tg.runExecuteOfGlobalModule=function(z,C){var K={},T=C.module={exports:K,id:C.name};C.evaluated=
!0;if(K=C.execute.call(z.global,function(O){var qa=C.deps.find(function(Ba){return Ba===O});if(qa=qa&&z.get(C.normalizedDeps[C.deps.indexOf(qa)])||z.get(z.decanonicalize(O,C.name)))return qa;throw Error("Module "+O+" not declared as a dependency of "+C.name);},K,T))T.exports=K;K=T.exports;T=z.get("@system-env").constructor;C.esModule=K&&(K.__esModule||K instanceof T)?K:C.esmExports&&K!==z.global?z.newModule(K):{"default":K};return C};tg.emit=Xa;tg.instrumentSourceOfEsmModuleLoad=xe;tg.instrumentSourceOfGlobalModuleLoad=
Fg;tg.scheduleModuleExportsChange=Bb;tg.classHolder=Re;tg.moduleSourceChange=Fb;var pd=window.lively.FreezerRuntime.recorderFor("lively.modules/src/url-helpers.js");pd.isJsFile=Ia;pd.asDir=xb;pd.isURL=Rb;pd.urlResolve=yc;pd.string=ub;pd.isJsFile=Ia;pd.asDir=xb;var Z=pd.string.joinPath;pd.join=Z;pd.join=Z;pd.isURL=Rb;pd.urlResolve=yc;var Ga=window.lively.FreezerRuntime.recorderFor("lively.modules/src/packages/configuration.js");Ga.arr=se;Ga.obj=sb;Ga.isURL=Rb;Ga.installHook=M;Ga.isHookInstalled=wb;
var fb=function(){function z(C){Ed(this,z);this.pkg=C}fe(z,[{key:"applyConfig",value:function(C){var K=this.System,T=this.packageURL,O=this.pkg;C=Ga.obj.deepMerge(O.config,C);var qa=C.name||T.split("/").slice(-1)[0],Ba=C.version,ib=C.systemjs||{},Ub=C.lively,pc=C.main||"index.js";K.config({map:Wb({},qa,T),packages:Wb({},T,Object.assign({},ib,{meta:Object.assign({"package.json":{format:"json"}},ib.meta),configured:!0}))});K.packages[T].configured=!0;K=K.getConfig().packages[T]||{};K.map||(K.map={});
ib&&(Ub&&Ub.main?pc=Ub.main:ib.main&&(pc=ib.main),this.applySystemJSConfig(ib));pc.match(/\.[^\/\.]+/)||(pc+=".js");K.main=pc;O.version=Ba;O.config=C;O._name=qa;O.mergeWithConfig(K);return Ub?this.applyLivelyConfig(Ub):{subPackages:[]}}},{key:"applySystemJSConfig",value:function(C){var K=this.System;C.packageConfigPaths&&K.config({packageConfigPaths:Ga.arr.uniq(K.packageConfigPaths.concat(C.packageConfigPaths))});C.packages&&K.config({packages:C.packages});C.globalmap&&K.config({map:C.globalmap});
C.babelOptions&&K.config({babelOptions:C.babelOptions});C.meta&&K.config({meta:C.meta})}},{key:"applyLivelyConfig",value:function(C){this.applyLivelyConfigMeta(C);this.applyLivelyConfigHooks(C);this.applyLivelyConfigBundles(C)}},{key:"applyLivelyConfigHooks",value:function(C){var K=this;(C.hooks||[]).forEach(function(T){try{var O=eval("("+T.source+")");O.name&&Ga.isHookInstalled(K.System,T.target,O.name)||Ga.installHook(K.System,T.target,O)}catch(qa){console.error("Error installing hook for %s: %s",
K.packageURL,qa,T)}})}},{key:"applyLivelyConfigBundles",value:function(C){var K=this;if(!C.bundles)return Promise.resolve();var T=Object.keys(C.bundles).reduce(function(O,qa){var Ba=K.packageURL+"/"+qa;qa=C.bundles[qa].map(function(ib){return K.System.decanonicalize(ib,K.packageURL+"/")});O[Ba]=qa;return O},{});this.System.config({bundles:T});return Promise.resolve()}},{key:"applyLivelyConfigMeta",value:function(C){if(C.meta){var K=this.System.getConfig().packages[this.packageURL]||{},T={meta:{},
packages:Wb({},this.packageURL,K)};Object.keys(C.meta).forEach(function(O){var qa=C.meta[O];Ga.isURL(O)?T.meta[O]=qa:(K.meta||(K.meta={}),K.meta[O]=qa)});this.System.config(T)}}},{key:"System",get:function(){return this.pkg.System}},{key:"packageURL",get:function(){return this.pkg.url}}]);return z}();Ga.PackageConfiguration=fb;Ga["default"]=fb;var ya=window.lively.FreezerRuntime.recorderFor("lively.modules/src/packages/package.js");ya.packagesConfig=id;ya.normalizePackageURL=function(z,C){if((2<arguments.length&&
void 0!==arguments[2]?arguments[2]:[]).some(function(T){return T===C}))return C;var K=z.decanonicalize(C.replace(/[\/]+$/,"")+"/");if(!ya.isURL(K))throw Error("Strange package URL: ".concat(K," is not a valid URL"));K.match(/\.js/)&&(K=-1<K.indexOf(K+".js")?K.replace(/\.js$/,""):K.split("/").slice(0,-1).join("/"));K.match(/\.js$/)&&console.warn("packageURL is expected to point to a directory but seems to be a .js file: "+K);return String(K).replace(/\/$/,"")};ya.lookupPackage=Pb;ya.ensurePackage=
tb;ya.getPackage=xc;ya.applyConfig=Pc;ya.importPackage=nd;ya.removePackage=Id;ya.reloadPackage=Hb;ya.registerPackage=Kd;ya.getPackageSpecs=vc;ya.commonjsHelpers=db;ya.arr=se;ya.promise=fa;ya.obj=sb;ya.emit=Xa;ya.module=Cc;ya.resource=Db;ya.PackageConfiguration=fb;ya.isURL=Rb;ya.join=Z;ya.classHolder=Re;ya.packagesConfig=id;var tc=function(){function z(C,K,T,O){var qa=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};Ed(this,z);this.System=C;this.url=K;this.registerProcess=null;this.map={};
this.setConfig(qa)}fe(z,null,[{key:"allPackages",value:function(C){return ya.obj.values(ya.classHolder.PackageRegistry.ofSystem(C).byURL)}},{key:"allPackageURLs",value:function(C){return ya.classHolder.PackageRegistry.ofSystem(C).allPackageURLs()}},{key:"forModule",value:function(C,K){return this.forModuleId(C,K.id)}},{key:"forModuleId",value:function(C,K){return(K=ya.classHolder.ModulePackageMapping.forSystem(C).getPackageURLForModuleId(K))?ya.getPackage(C,K,!0):null}},{key:"fromJSON",value:function(C,
K){return(new ya.Package(C)).fromJSON(K)}}]);fe(z,[{key:"setConfig",value:function(C){this._name=C.name;this.version=C.version;this.dependencies=C.dependencies||{};this.devDependencies=C.devDependencies||{};this.main=C.main||"index.js";this.systemjs=C.systemjs;this.lively=C.lively}},{key:"toJSON",value:function(){var C=this.System,K=ya.obj.select(this,"url _name version map dependencies devDependencies main systemjs lively".split(" "));K.url.startsWith(C.baseURL)&&(K.url=K.url.slice(C.baseURL.length).replace(/^\//,
""));return K}},{key:"fromJSON",value:function(C){var K=this.System;this.url=C.url;this._name=C._name;this.version=C.version;this.map=C.map||{};this.main=C.main;this.dependencies=C.dependencies||{};this.devDependencies=C.devDependencies||{};this.systemjs=C.systemjs;this.lively=C.lively;ya.isURL(this.url)||(this.url=ya.join(K.baseURL,this.url));this.registerWithConfig();return this}},{key:"asSpec",value:function(){return Object.assign({},ya.obj.select(this,"name main map meta url address version lively".split(" ")),
{modules:this.modules().map(function(C){return{name:C.id,deps:C.directRequirements().map(function(K){return K.id})}})})}},{key:"path",value:function(){var C=this.System.baseURL;return 0===this.url.indexOf(C)?this.url.slice(C.length):this.url}},{key:"modules",value:function(){var C=this.url,K=this.System;return ya.classHolder.ModulePackageMapping.forSystem(K).getModuleIdsForPackageURL(C).map(function(T){return ya.module(K,T)})}},{key:"resources",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa=
this,Ba,ib,Ub,pc,Dc,kd,Ad,Rd,cf=arguments;return regeneratorRuntime.wrap(function(Ud){for(;;)switch(Ud.prev=Ud.next){case 0:return Ba=1<cf.length&&void 0!==cf[1]?cf[1]:[".git","node_modules",".module_cache","lively.next-node_modules"],ib=this.System,Ub=this.url,pc=ya.Package.allPackageURLs(ib),Dc=pc.filter(function(Ge){return Ge!==Ub&&!Ub.startsWith(Ge)}),Ud.next=6,ya.resource(Ub).dirList("infinity",{exclude:Ba});case 6:return kd=Ud.sent,Ad=kd.filter(function(Ge){return!Ge.isDirectory()&&!Dc.some(function(Se){return Ge.url.startsWith(Se)})}).map(function(Ge){return Ge.url}),
Rd=ya.arr.pluck(this.modules(),"id"),T&&(Ad=Ad.filter(T)),Ud.abrupt("return",Ad.map(function(Ge){var Se=Ge.replace(Ub,"").replace(/^\//,"");return{isLoaded:Rd.includes(Ge),url:Ge,nameInPackage:Se,"package":qa}}));case 11:case "end":return Ud.stop()}},O,this)}));return function(T){return C.apply(this,arguments)}}()},{key:"hasResource",value:function(C){var K=this.url;return(C.startsWith(K)?ya.resource(C):ya.resource(K).join(C)).exists()}},{key:"toString",value:function(){return"Package(".concat(this.name,
" - ").concat(this.path(),"/)")}},{key:"mergeWithConfig",value:function(C){var K=C=Object.assign({},C),T=K.name;K=K.map;T&&(delete C.name,this._name=T);K&&(delete C.map,Object.assign(this.map,K));Object.assign(this,C);return this}},{key:"addMapping",value:function(C,K){this.map[C]=K;this.System.config({packages:Wb({},this.url,{map:Wb({},C,K)})})}},{key:"tryToLoadPackageConfig",value:function(){var C=Gb(regeneratorRuntime.mark(function T(){var O,qa,Ba,ib,Ub,pc;return regeneratorRuntime.wrap(function(Dc){for(;;)switch(Dc.prev=
Dc.next){case 0:O=this.System;qa=this.url;Ba=qa+"/package.json";O.config({meta:Wb({},Ba,{format:"json"}),packages:Wb({},qa,{meta:{"package.json":{format:"json"}}})});O.debug&&console.log("[lively.modules package reading config] %s",Ba);Dc.prev=4;Dc.t0=O.get(Ba);if(Dc.t0){Dc.next=10;break}Dc.next=9;return O["import"](Ba);case 9:Dc.t0=Dc.sent;case 10:return ib=Dc.t0,Ub=qb(O.packageConfigPaths),ya.arr.pushIfNotIncluded(Ub,Ba),O.config({packageConfigPaths:Ub}),Dc.abrupt("return",ib);case 17:return Dc.prev=
17,Dc.t1=Dc["catch"](4),console.log("[lively.modules package] Unable loading package config %s for package: ",Ba,Dc.t1),delete O.meta[Ba],pc=qa.split("/").slice(-1)[0],Dc.abrupt("return",{name:pc});case 23:case "end":return Dc.stop()}},T,this,[[4,17]])}));return function(){return C.apply(this,arguments)}}()},{key:"import",value:function(){var C=Gb(regeneratorRuntime.mark(function T(){var O,qa,Ba,ib,Ub;return regeneratorRuntime.wrap(function(pc){for(;;)switch(pc.prev=pc.next){case 0:return pc.next=
2,this.register();case 2:return O=this.url,qa=this.System,pc.t0=ya,pc.t1=qa,pc.next=7,qa.normalize(O);case 7:return pc.t2=pc.sent,Ba=pc.t0.module.call(pc.t0,pc.t1,pc.t2),pc.next=11,qa["import"](Ba.id);case 11:return ib=pc.sent,Ub=ya.promise.deferred(),Ba.whenLoaded(Ub.resolve),pc.next=16,Ub.promise;case 16:return pc.abrupt("return",ib);case 17:case "end":return pc.stop()}},T,this)}));return function(){return C.apply(this,arguments)}}()},{key:"isRegistering",value:function(){return!!this.registerProcess}},
{key:"register",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa,Ba,ib,Ub;return regeneratorRuntime.wrap(function(pc){for(;;)switch(pc.prev=pc.next){case 0:if(!this.isRegistering()){pc.next=2;break}return pc.abrupt("return",this.registerProcess.promise);case 2:qa=this.System;Ba=this.url;this.registerProcess=ya.promise.deferred();ib=this.registerProcess.promise;qa.debug&&console.log("[lively.modules package register] %s",Ba);pc.prev=6;pc.t0=T;if(pc.t0){pc.next=12;break}pc.next=
11;return this.tryToLoadPackageConfig();case 11:pc.t0=pc.sent;case 12:Ub=pc.t0;this.registerWithConfig(Ub);this.registerProcess.resolve(Ub);pc.next=21;break;case 17:throw pc.prev=17,pc.t1=pc["catch"](6),this.registerProcess.reject(pc.t1),pc.t1;case 21:return pc.prev=21,delete this.registerProcess,pc.finish(21);case 24:return pc.abrupt("return",ib);case 25:case "end":return pc.stop()}},O,this,[[6,17,21,24]])}));return function(T){return C.apply(this,arguments)}}()},{key:"updateConfig",value:function(C){C=
Object.assign({},this.runtimeConfig,{},C);var K=this.name,T=this.version,O=C,qa=O.name;O=O.version;(new ya.PackageConfiguration(this)).applyConfig(C);if(K!==C.name||T!==C.version)console.log("[lively.modules] Updating registry ".concat(K,"@").concat(T," => ").concat(qa,"@").concat(O)),ya.classHolder.PackageRegistry.ofSystem(this.System).updateNameAndVersionOf(this,K,T,qa,O)}},{key:"registerWithConfig",value:function(){var C=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.runtimeConfig,
K=this.System,T=this.url,O=(new ya.PackageConfiguration(this)).applyConfig(C),qa=ya.join(T,"package.json");K.get(qa)||K.set(qa,K.newModule(Object.assign({},C,{"default":C})));ya.emit("lively.modules/packageregistered",{"package":T},Date.now(),K);return O}},{key:"remove",value:function(C){C=Object.assign({forgetEnv:!0,forgetDeps:!1,unloadModules:!0},C);var K=this.System,T=this.url;T=T.replace(/\/$/,"");C.unloadModules&&this.modules().forEach(function(Ba){return Ba.unload(C)});ya.classHolder.PackageRegistry.ofSystem(K).removePackage(this);
var O=K.getConfig(),qa=T+"/package.json";K["delete"](String(qa));ya.arr.remove(O.packageConfigPaths||[],qa);K.config({meta:Wb({},qa,{}),packages:Wb({},T,{}),packageConfigPaths:O.packageConfigPaths});delete K.packages[T];ya.emit("lively.modules/packageremoved",{"package":this.url},Date.now(),K)}},{key:"reload",value:function(C){var K=this.url,T=ya.classHolder.PackageRegistry.ofSystem(this.System),O=T.coversDirectory(K);this.remove(C);T.addPackageAt(K,O||"devPackageDirs",Wb({},K,this));return this["import"]()}},
{key:"fork",value:function(){var C=Gb(regeneratorRuntime.mark(function qa(T,O){return regeneratorRuntime.wrap(function(Ba){for(;;)switch(Ba.prev=Ba.next){case 0:return O||(O=ya.resource(this.url).join("../".concat(T)).withRelativePartsResolved().url),Ba.next=3,this.changeAddress(O,T,!1);case 3:return Ba.abrupt("return",Ba.sent);case 4:case "end":return Ba.stop()}},qa,this)}));return function(T,O){return C.apply(this,arguments)}}()},{key:"rename",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa;
return regeneratorRuntime.wrap(function(Ba){for(;;)switch(Ba.prev=Ba.next){case 0:return qa=ya.resource(this.url).join("../".concat(T)).withRelativePartsResolved().url,Ba.next=3,this.changeAddress(qa,T,!0);case 3:return Ba.abrupt("return",Ba.sent);case 4:case "end":return Ba.stop()}},O,this)}));return function(T){return C.apply(this,arguments)}}()},{key:"changeAddress",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa,Ba,ib,Ub,pc,Dc,kd,Ad,Rd,cf,Ud,Ge,Se,mh,Rh,dh,eh,Rg,$c,vf,ye,
Yc,Tc,td,hd,aa=arguments;return regeneratorRuntime.wrap(function(Sa){for(;;)switch(Sa.prev=Sa.next){case 0:return qa=1<aa.length&&void 0!==aa[1]?aa[1]:null,Ba=2<aa.length&&void 0!==aa[2]?aa[2]:!0,T=T.replace(/\/?/,""),ib=this.System,Ub=this.url,Sa.next=6,this.runtimeConfig;case 6:return pc=Sa.sent,Dc=ya.resource(Ub).asDirectory(),kd=new ya.Package(ib,T),Sa.next=11,ya.resource(T).asDirectory();case 11:return Ad=Sa.sent,pc.name=qa||this.name,Rd=ya.classHolder.PackageRegistry.ofSystem(ib),cf=Rd.coversDirectory(Ub),
ya.classHolder.ModulePackageMapping.forSystem(ib).clearCache(),ib.packages[Ub]&&(ib.packages[T]=ib.packages[Ub],Ba&&delete ib.packages[Ub]),Object.assign(kd,ya.obj.select(this,["_name","map","config"])),Sa.next=20,Ad.ensureExistance();case 20:return Sa.next=22,this.resources(void 0,[]);case 22:Sa.t0=function(Ma){return Ma.url},Ud=Sa.sent.map(Sa.t0),Ge=this.modules(),Se=sc(Ge),Sa.prev=26,Se.s();case 28:if((mh=Se.n()).done){Sa.next=42;break}Rh=mh.value;dh=Ad.join(Rh.pathInPackage()).url;if(!Ba){Sa.next=
36;break}Sa.next=34;return Rh.renameTo(dh);case 34:Sa.next=38;break;case 36:return Sa.next=38,Rh.copyTo(dh);case 38:eh=Ud.indexOf(Rh.id),-1<eh&&Ud.splice(eh,1);case 40:Sa.next=28;break;case 42:Sa.next=47;break;case 44:Sa.prev=44,Sa.t1=Sa["catch"](26),Se.e(Sa.t1);case 47:return Sa.prev=47,Se.f(),Sa.finish(47);case 50:Rg=sc(Ud),Sa.prev=51,Rg.s();case 53:if(($c=Rg.n()).done){Sa.next=61;break}vf=$c.value;ye=ya.resource(vf);Yc=ye.relativePathFrom(Dc);Sa.next=59;return ye.copyTo(Ad.join(Yc));case 59:Sa.next=
53;break;case 61:Sa.next=66;break;case 63:Sa.prev=63,Sa.t2=Sa["catch"](51),Rg.e(Sa.t2);case 66:return Sa.prev=66,Rg.f(),Sa.finish(66);case 69:if(!Ba){Sa.next=74;break}Sa.next=72;return this.remove({forgetEnv:!0,forgetDeps:!1});case 72:return Sa.next=74,Dc.remove();case 74:if(!qa){Sa.next=95;break}kd.name=qa;kd.config.name=qa;Tc=ya.resource(T).join("package.json");Sa.prev=78;Sa.next=81;return Tc.exists();case 81:if(!Sa.sent){Sa.next=91;break}Sa.next=84;return Tc.readJson();case 84:td=Sa.sent;if(td.name!==
this.name){Sa.next=89;break}td.name=qa;Sa.next=89;return Tc.writeJson(td,!0);case 89:(hd=ib.get(Tc.url))&&ib.set(Tc.url,ib.newModule(Object.assign({},hd,{name:qa})));case 91:Sa.next=95;break;case 93:Sa.prev=93,Sa.t3=Sa["catch"](78);case 95:return cf=cf||"individualPackageDirs","individualPackageDirs"!==cf&&"devPackageDirs"!==cf||Rd._addPackageDir(T,cf,!0),Rd._addPackageWithConfig(kd,pc,T,cf),Rd.resetByURL(),Rd._updateLatestPackages(),Sa.abrupt("return",kd);case 101:case "end":return Sa.stop()}},O,
this,[[26,44,47,50],[51,63,66,69],[78,93]])}));return function(T){return C.apply(this,arguments)}}()},{key:"search",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa=this,Ba,ib,Ub=arguments;return regeneratorRuntime.wrap(function(pc){for(;;)switch(pc.prev=pc.next){case 0:Ba=1<Ub.length&&void 0!==Ub[1]?Ub[1]:{};if(!Ba.includeUnloaded){pc.next=8;break}pc.next=4;return this.resources(function(Dc){return Dc.endsWith(".js")},[".git","node_modules","dist",".module_cache","lively.next-node_modules"].concat(qb(Ba.excludedModules||
[])));case 4:pc.t1=function(Dc){return ya.module(qa.System,Dc.url)};pc.t0=pc.sent.map(pc.t1);pc.next=9;break;case 8:pc.t0=this.modules().filter(function(Dc){return Dc.isLoaded()});case 9:return ib=pc.t0,pc.abrupt("return",Promise.all(ib.map(function(Dc){return Dc.search(T,Ba)["catch"](function(kd){console.error("Error searching module ".concat(Dc.name,":\n").concat(kd.stack));return[]})})).then(function(Dc){return Dc.flat()}));case 11:case "end":return pc.stop()}},O,this)}));return function(T){return C.apply(this,
arguments)}}()},{key:"isPackage",get:function(){return!0}},{key:"name",get:function(){if(this._name)return this._name;var C=this.System.get(this.url+"/package.json");return C&&C.name?C.name:ya.arr.last(this.url.replace(/[\/]+$/,"").split("/"))},set:function(C){return this._name=C}},{key:"nameAndVersion",get:function(){return"".concat(this.name,"@").concat(this.version)}},{key:"address",get:function(){return this.url},set:function(C){return this.url=C}},{key:"runtimeConfig",get:function(){var C=this.main,
K=this.systemjs,T=this.lively,O={name:this.name,version:this.version,dependencies:this.dependencies||{},devDependencies:this.devDependencies||{}};C&&(O.main=C);K&&(O.systemjs=K);T&&(O.lively=T);return O}}]);return z}();ya.Package=tc;ya.ensurePackage=tb;ya.importPackage=nd;ya.removePackage=Id;ya.reloadPackage=Hb;ya.registerPackage=Kd;ya.getPackage=xc;ya.lookupPackage=Pb;ya.applyConfig=Pc;ya.getPackageSpecs=vc;ya.Package=tc;var Mc=window.lively.FreezerRuntime.recorderFor("lively.modules/src/import-modification.js");
Mc.arr=se;Mc.Path=ad;Mc.fuzzyParse=ab;Mc.query=Sd;Mc.stringify=Cb;Mc.resource=Db;var Cd=bd("I",function(){function z(C,K,T,O,qa,Ba,ib){Ed(this,z);this.System=C;this.intoModuleId=K;this.intoPackage=T;this.intoModuleSource=O;this.fromModuleId=qa.moduleId;this.importData=qa;this.alias=Ba;this.parsed=ib||Mc.fuzzyParse(O)}fe(z,null,[{key:"run",value:function(C,K,T,O,qa){return(new this(C,K,T,O,qa,5<arguments.length&&void 0!==arguments[5]?arguments[5]:void 0,6<arguments.length&&void 0!==arguments[6]?arguments[6]:
void 0)).run()}}]);fe(z,[{key:"run",value:function(){var C=this.generateImportStatement(),K=C.standaloneImport,T=C.importedVarName,O=this.existingImportsOfFromModule(),qa=O.imports,Ba=O.importsOfFromModule;O=O.importsOfVar;Ba=this.importsToBeReused(Ba,O,C);if(O.length)return{status:"not modified",newSource:this.intoModuleSource,generated:"",importedVarName:"",standaloneImport:K,from:O[0].start,to:O[0].end};if(Ba.length&&(C=this.modifyExistingImport(Ba,K)))return C;qa=Mc.arr.last(qa);return this.insertNewImport(Ba,
K,T,qa?qa.end:0)}},{key:"importsToBeReused",value:function(C,K,T){T.isDefault&&(C=C.filter(function(O){return!O.specifiers.some(function(qa){return"ImportDefaultSpecifier"===qa.type})}));return C}},{key:"generateImportStatement",value:function(){var C=this.intoModuleId,K=this.fromModuleId,T=this.importData,O=this.intoPackage,qa="default"===T.exported,Ba=this.alias||(qa?T.local:T.exported),ib=!qa&&T.exported!==Ba;O=O&&O.name;var Ub=K,pc=T.packageName,Dc=T.pathInPackage;if(T.isMain)Ub=pc;else if(O===
pc)try{Ub=Mc.resource(K).relativePathFrom(Mc.resource(C)),Ub.startsWith(".")||(Ub="./"+Ub)}catch(kd){pc&&"no group"!==pc&&Dc&&(Ub=pc+"/"+Dc)}else pc&&"no group"!==pc&&Dc&&(Ub=pc+"/"+Dc);return{isDefault:qa,standaloneImport:qa?"import ".concat(Ba,' from "').concat(Ub,'";'):"import { ".concat(T.exported).concat(ib?" as ".concat(Ba):"",' } from "').concat(Ub,'";'),importedVarName:Ba}}},{key:"existingImportsOfFromModule",value:function(){var C=this.System,K=this.fromModuleId,T=this.intoModuleId,O=this.importData,
qa=O.exported,Ba=O.local,ib=this.alias,Ub="default"===qa;O=this.parsed.body.filter(function(Dc){return"ImportDeclaration"===Dc.type});var pc=Ub?ib||Ba:ib||qa;K=C.decanonicalize(K,T);Ba=O.filter(function(Dc){if(!Dc.source||"string"!==typeof Dc.source.value)return null;Dc=C.decanonicalize(Dc.source.value,T);return K===Dc});ib=Ba.filter(function(Dc){return(Dc.specifiers||[]).some(function(kd){return Ub?"ImportDefaultSpecifier"===kd.type&&kd.local.name===pc:Mc.Path("imported.name").get(kd)===qa&&Mc.Path("local.name").get(kd)===
pc})});return{imports:O,importsOfFromModule:Ba,importsOfVar:ib}}},{key:"modifyExistingImport",value:function(C,K){C=C.flatMap(function(pc){return pc.specifiers||[]});if(!C.length)return null;C=Mc.arr.partition(C,function(pc){return"ImportDefaultSpecifier"===pc.type});C=ic(C,2);var T=ic(C[0],1)[0],O=ic(C[1],1)[0];C=this.alias;var qa=this.intoModuleSource,Ba=this.importData,ib=Ba.exported;Ba=Ba.local;var Ub="default"===ib;Ub?console.assert(!!O,"no ImportSpecifier found"):console.assert(O||T,"at least one kine of specifier is expected");
if(Ub){T=qa.slice(0,O.start).lastIndexOf("{")-1;if(0>T)return null;O=(C||Ba)+",";ib=qa.slice(0,T);qa=qa.slice(T);ib.endsWith(" ")&&ib.endsWith("\n")||(O=" "+O);qa.startsWith(" ")||(O+=" ");return{status:"modified",newSource:"".concat(ib).concat(O).concat(qa),generated:O,standaloneImport:K,importedVarName:C||Ba,from:T,to:T+O.length}}T=O?O.end:T.end;Ub=(Ba=C&&C!==ib)?"".concat(ib," as ").concat(C):ib;O=O?", ".concat(Ub):", { ".concat(Ub," }");return{status:"modified",newSource:"".concat(qa.slice(0,
T)).concat(O).concat(qa.slice(T)),generated:O,standaloneImport:K,importedVarName:Ba?C:ib,from:T,to:T+O.length}}},{key:"insertNewImport",value:function(C,K,T){var O=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;C&&C.length&&(O=Mc.arr.last(C).end);var qa=this.intoModuleSource,Ba=qa.slice(0,O);qa=qa.slice(O);var ib=K;Ba.length&&!Ba.endsWith("\n")&&(ib="\n"+ib);qa.length&&!qa.startsWith("\n")&&(ib+="\n");return{status:"modified",newSource:Ba+ib+qa,generated:ib,standaloneImport:K,importedVarName:T,
from:O,to:O+ib.length}}}]);return z}());Mc.ImportInjector=Cd;var Ee=bd("G",function(){function z(){Ed(this,z)}fe(z,null,[{key:"getGlobals",value:function(C,K){C=K||Mc.fuzzyParse(C,{withComments:!0});K=(K=C.comments?C.comments.find(function(O){return O.isBlock&&O.text.match(/^\s*global/)}):null)?K.text.replace(/^\s*global\s*/,"").split(",").map(function(O){return O.trim()}).filter(Boolean):[];var T=[].concat(qb(K),qb(Mc.query.knownGlobals));C=Mc.query.findGlobalVarRefs(C,{jslintGlobalComment:!0}).filter(function(O){return!T.includes(O.name)}).map(function(O){return O.name});
return Mc.arr.compact([].concat(qb(K),qb(C)))}},{key:"run",value:function(C,K,T){T=T||Mc.fuzzyParse(C,{withComments:!0});var O=(T=T.comments?T.comments.find(function(Ba){return Ba.isBlock&&Ba.text.startsWith("global")}):null)?T.text.replace(/^global\s*/,"").split(",").map(function(Ba){return Ba.trim()}).filter(Boolean):[],qa=K.filter(function(Ba){return!O.includes(Ba)});if(!qa.length)return{status:"not modified",newSource:C,generated:"",from:0,to:0};if(!T)return T="/*global ".concat(qa.join(","),
"*/\n"),{status:"modified",newSource:T+C,generated:T,from:0,to:T.length};K=T.start+2+T.text.length;qa=qa.join(",");O.length?qa=","+qa:T.text.startsWith("global ")||(qa=" "+qa);T=K+qa.length;return{status:"modified",newSource:C.slice(0,K)+qa+C.slice(K),generated:qa,from:K,to:T}}}]);return z}());Mc.GlobalInjector=Ee;var bf=bd("f",function(){function z(){Ed(this,z)}fe(z,null,[{key:"removeImports",value:function(C,K,T){var O=(T||Mc.fuzzyParse(C)).body.flatMap(function(qa){return"ImportDeclaration"===
qa.type&&qa.specifiers.length?qa.specifiers.map(function(Ba){return{local:Ba.local,importStmt:qa}}):[]}).filter(function(qa){return K.some(function(Ba){return Ba.local===qa.local.name})});T=O.map(function(qa){return{local:qa.local.name,from:qa.importStmt.source.value}});C=Mc.arr.uniq(O.map(function(qa){var Ba=qa.importStmt.specifiers.find(function(ib){return qa.local===ib.local});Mc.arr.remove(qa.importStmt.specifiers,Ba);return qa.importStmt})).slice().reverse().reduce(function(qa,Ba){var ib=qa.source;
qa=qa.changes;var Ub=Ba.start,pc=Ba.end,Dc=Ba.specifiers,kd=ib.slice(0,Ub),Ad=ib.slice(pc);ib=ib.slice(Ub,pc);(Ba=Dc.length?Mc.stringify(Ba):"")&&Ba.includes("\n")&&!ib.includes("\n")&&(Ba=Ba.replace(/\s+/g," "));ib=kd+Ba+Ad;qa=qa.concat({replacement:Ba,start:Ub,end:pc});return{source:ib,changes:qa}},{source:C,changes:[]});return Object.assign({},C,{removedImports:T})}},{key:"findUnusedImports",value:function(C){var K="string"===typeof C?Mc.fuzzyParse(C):C;C=K.body.flatMap(function(qa){return"ImportDeclaration"===
qa.type&&qa.specifiers.length?qa.specifiers.map(function(Ba){return{local:Ba.local,from:qa.source?qa.source.value:"",importStmt:qa}}):[]});var T=C.map(function(qa){return qa.local});K=Mc.query.resolveReferences(Mc.query.scopes(K));K=Array.from(K.resolvedRefMap.keys()).filter(function(qa){return!T.includes(qa)});var O=Mc.arr.uniq(K.map(function(qa){return qa.name}));return C.filter(function(qa){return!O.includes(qa.local.name)}).map(function(qa){return Object.assign({},qa,{local:qa.local.name})})}},
{key:"removeUnusedImports",value:function(C){var K=Mc.fuzzyParse(C);return this.removeImports(C,this.findUnusedImports(K),K)}}]);return z}());Mc.ImportRemover=bf;var Oe=window.lively.FreezerRuntime.recorderFor("lively.modules/src/nodejs.js");Oe.ensureParent=function(z,C,K){if(K)return K;K=z.id;var T=z.System;C=K.startsWith("file://")?K.replace("file://",""):K;if(K=T._nodeRequire("module").Module._cache[K])return K;K={id:C,filename:C,paths:[]};(z=z["package"]())&&K.paths.push(Oe.resource(z.url).join("node_modules/").path());
return K};Oe.relative=function(z,C){return Oe.resource(z.id).parent().join(C).url.replace("file://","")};Oe._require=Qc;Oe._resolve=kb;Oe.resource=Db;Oe._require=Qc;Oe._resolve=kb;var Fe=window.lively.FreezerRuntime.recorderFor("lively.modules/src/module.js");Fe.module=Cc;Fe.isModuleLoaded=zc;Fe.doesModuleExist=Fc;Fe.arr=se;Fe.obj=sb;Fe.graph=eb;Fe.parse=Ne;Fe.query=Sd;Fe.computeRequireMap=hb;Fe.moduleSourceChange=Fb;Fe.scheduleModuleExportsChange=Bb;Fe.runScheduledExportChanges=ba;Fe.livelySystemEnv=
mf;Fe.Package=tc;Fe.isURL=Rb;Fe.emit=Xa;Fe.subscribe=kc;Fe.defaultClassToFunctionConverterName=Vb;Fe.classRuntime=lc;Fe.ImportInjector=Cd;Fe.GlobalInjector=Ee;Fe.ImportRemover=bf;Fe._require=Qc;Fe._resolve=kb;Fe.classHolder=Re;Fe.regExpEscape=pb;var Pf=bd("d",function(){var z=/['"]format (esm|es6)['"];/,C=/['"]format cjs['"];/,K=/(^\s*|[}\);\n]\s*)(import\s+(['"]|(\*\s+as\s+)?[^"'\(\)\n;]+\s+from\s+['"]|\{)|export\s+\*\s+from\s+["']|export\s+(\{|default|function|class|var|const|let|async\s+function))/;
return function(T,O){return O&&O.format?("es6"===O.format&&"esm"===O.forma,O.format):z.test(T.slice(0,5E3))||!C.test(T.slice(0,5E3))&&K.test(T)?"esm":C.test(T.slice(0,5E3))?"cjs":"global"}}());Fe.detectModuleFormat=Pf;Fe.detectModuleFormat=Pf;Fe.classHolder.module=Fe.module;Fe.isModuleLoaded=zc;Fe.doesModuleExist=Fc;Fe.globalProps={initialized:!1,descriptors:{}};var eg=function(){function z(C,K){var T=this;Ed(this,z);if(!Fe.isURL(K)&&!/^@/.test(K))throw Error("ModuleInterface constructor called with ".concat(K,
" that does not seem to be a fully normalized module id."));this.System=C;this.id=K;this.recorderName="__lvVarRecorder";this.sourceAccessorName="__lvOriginalCode";this._scope=this._ast=this._source=this._recorder=null;this._observersOfTopLevelState=[];this._evaluationsInProgress=0;this._evalId=1;this.createdAt=this.lastModifiedAt=new Date;Fe.subscribe("lively.modules/modulechanged",function(O){O.module===T.id&&T.reset()})}fe(z,[{key:"fullName",value:function(){return this.id}},{key:"shortName",value:function(){return"".concat(this["package"]().name,
"/").concat(this.pathInPackage())}},{key:"source",value:function(){var C=this;return"@empty"===this.id?Promise.resolve(""):this._source?Promise.resolve(this._source):this.System.resource(this.id).read().then(function(K){return C._source=K})}},{key:"setSource",value:function(C){this.sourceAccessorName&&this.recorderName&&C.includes("var "+this.recorderName)&&C.includes("var "+this.sourceAccessorName)||this._source===C||(this.reset(),this._source=C)}},{key:"ast",value:function(){var C=Gb(regeneratorRuntime.mark(function T(){return regeneratorRuntime.wrap(function(O){for(;;)switch(O.prev=
O.next){case 0:if(!this._ast){O.next=2;break}return O.abrupt("return",this._ast);case 2:return O.t0=Fe,O.next=5,this.source();case 5:return O.t1=O.sent,O.abrupt("return",this._ast=O.t0.parse.call(O.t0,O.t1));case 7:case "end":return O.stop()}},T,this)}));return function(){return C.apply(this,arguments)}}()},{key:"scope",value:function(){var C=Gb(regeneratorRuntime.mark(function T(){var O;return regeneratorRuntime.wrap(function(qa){for(;;)switch(qa.prev=qa.next){case 0:if(!this._scope){qa.next=2;break}return qa.abrupt("return",
this._scope);case 2:return qa.next=4,this.ast();case 4:return O=qa.sent,qa.abrupt("return",this._scope=Fe.query.topLevelDeclsAndRefs(O).scope);case 6:case "end":return qa.stop()}},T,this)}));return function(){return C.apply(this,arguments)}}()},{key:"resolvedScope",value:function(){var C=Gb(regeneratorRuntime.mark(function T(){return regeneratorRuntime.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.t0=Fe.query,O.next=3,this.scope();case 3:return O.t1=O.sent,O.abrupt("return",this._scope=
O.t0.resolveReferences.call(O.t0,O.t1));case 5:case "end":return O.stop()}},T,this)}));return function(){return C.apply(this,arguments)}}()},{key:"metadata",value:function(){var C=this.System.loads?this.System.loads[this.id]:null;return C?C.metadata:null}},{key:"addMetadata",value:function(C){var K=this.System,T=this.id,O=this.metadata();C=O?Object.assign(O,C):C;K.config({meta:Wb({},T,C)});return K.meta[T]}},{key:"format",value:function(){var C=this.metadata();return C&&C.format?C.format:this._source?
Fe.detectModuleFormat(this._source):"global"}},{key:"setFormat",value:function(C){return this.addMetadata({format:C})}},{key:"reset",value:function(){this._scope=this._ast=this._source=null}},{key:"get",value:function(){return this.System.get(this.id)}},{key:"load",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa,Ba;return regeneratorRuntime.wrap(function(ib){for(;;)switch(ib.prev=ib.next){case 0:qa=this.id;Ba=this.System;T&&this.addMetadata(T);ib.t0=Ba.get(qa);if(ib.t0){ib.next=
7;break}ib.next=6;return Ba["import"](qa);case 6:ib.t0=ib.sent;case 7:return ib.abrupt("return",ib.t0);case 8:case "end":return ib.stop()}},O,this)}));return function(T){return C.apply(this,arguments)}}()},{key:"isLoaded",value:function(){return!!this.System.get(this.id)}},{key:"unloadEnv",value:function(){this._recorder=null;this._observersOfTopLevelState=[];delete Fe.livelySystemEnv(this.System).loadedModules[this.id]}},{key:"unloadDeps",value:function(C){var K=this;C=Fe.obj.merge({forgetDeps:!0,
forgetEnv:!0},C);this.dependents().forEach(function(T){K.System["delete"](T.id);K.System.loads&&delete K.System.loads[T.id];C.forgetEnv&&T.unloadEnv()})}},{key:"unload",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa,Ba,ib;return regeneratorRuntime.wrap(function(Ub){for(;;)switch(Ub.prev=Ub.next){case 0:T=Object.assign({reset:!0,forgetDeps:!0,forgetEnv:!0},T);qa=this.System;Ba=this.id;T.reset&&this.reset();T.forgetDeps&&this.unloadDeps(T);this.System["delete"](Ba);qa.loads&&
delete qa.loads[Ba];qa.meta&&delete qa.meta[Ba];T.forgetEnv&&this.unloadEnv();ib=qa._livelyModulesTranslationCache;if(!ib){Ub.next=12;break}Ub.next=12;return ib.deleteCachedData(Ba);case 12:Fe.emit("lively.modules/moduleunloaded",{module:this.id},Date.now(),this.System);case 13:case "end":return Ub.stop()}},O,this)}));return function(T){return C.apply(this,arguments)}}()},{key:"reload",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa=this,Ba;return regeneratorRuntime.wrap(function(ib){for(;;)switch(ib.prev=
ib.next){case 0:return T=Fe.obj.merge({reloadDeps:!0,resetEnv:!0},T),Ba=[this],T.reloadDeps&&(Ba=this.dependents().concat(Ba)),ib.next=5,this.unload({forgetDeps:T.reloadDeps,forgetEnv:T.resetEnv});case 5:return ib.next=7,Promise.all(Ba.map(function(Ub){return Ub.id!==qa.id&&Ub.load()}));case 7:return ib.next=9,this.load();case 9:case "end":return ib.stop()}},O,this)}));return function(T){return C.apply(this,arguments)}}()},{key:"copyTo",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa,
Ba,ib;return regeneratorRuntime.wrap(function(Ub){for(;;)switch(Ub.prev=Ub.next){case 0:return Ub.t0=this.System.resource(T),Ub.next=3,this.source();case 3:return Ub.t1=Ub.sent,Ub.next=6,Ub.t0.write.call(Ub.t0,Ub.t1);case 6:return qa=this.System,Ba=Fe.module(qa,T),ib=Fe.obj.select(this,"_observersOfTopLevelState _scope _ast _source _recorder sourceAccessorName recorderName".split(" ")),Object.assign(Ba,ib),qa.set(T,qa.newModule(qa.get(this.id))),Ub.abrupt("return",Ba);case 12:case "end":return Ub.stop()}},
O,this)}));return function(T){return C.apply(this,arguments)}}()},{key:"renameTo",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa,Ba,ib,Ub,pc,Dc,kd=arguments;return regeneratorRuntime.wrap(function(Ad){for(;;)switch(Ad.prev=Ad.next){case 0:return qa=1<kd.length&&void 0!==kd[1]?kd[1]:{},Ba=qa.unload,ib=void 0===Ba?!0:Ba,Ub=qa.removeFile,pc=void 0===Ub?!0:Ub,Ad.next=4,this.copyTo(T);case 4:Dc=Ad.sent;if(!ib){Ad.next=8;break}Ad.next=8;return this.unload({reset:!0,forgetDeps:!1,
forgetEnv:!0});case 8:if(!pc){Ad.next=11;break}Ad.next=11;return this.System.resource(this.id).remove();case 11:return Ad.abrupt("return",Dc);case 12:case "end":return Ad.stop()}},O,this)}));return function(T){return C.apply(this,arguments)}}()},{key:"whenLoaded",value:function(C){if(this.isLoaded())try{C(this)}catch(K){console.error(K)}else Fe.livelySystemEnv(this.System).onLoadCallbacks.push({moduleName:this.id,resolved:!0,callback:C})}},{key:"changeSourceAction",value:function(C){var K=this;return Promise.resolve(this.source()).then(function(T){return C(T)}).then(function(T){return K.changeSource(T)})}},
{key:"changeSource",value:function(C,K){K=Object.assign({doSave:!0,doEval:!0},K);var T=this.System,O=this.id,qa=this.format(),Ba;this.reset();this.lastModifiedAt=new Date;return Promise.all([K.doSave&&this.System.resource(O).write(C),K.doEval&&Fe.moduleSourceChange(T,O,C,qa,K).then(function(ib){return Ba=ib})]).then(function(){return Ba})}},{key:"addDependencyToModuleRecord",value:function(C){var K=this,T=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},O=this.record(),qa=C.record();
if(O&&qa){var Ba,ib=O.dependencies.some(function(pc,Dc){if(pc)return Ba=Dc,pc&&pc.name===C.id});ib?qa!==O.dependencies[Ba]&&O.dependencies.splice(Ba,1,qa):O.dependencies.push(qa);ib&&O.setters[Ba]||(O.setters[ib?Ba:O.dependencies.length-1]=T);var Ub;qa.importers.some(function(pc,Dc){if(pc)return Ub=Dc,pc&&pc.name===K.id})?O!==qa.importers[Ub]&&qa.importers.splice(Ub,1,O):qa.importers.push(O)}}},{key:"dependents",value:function(){var C=this;return Fe.graph.hull(Fe.graph.invert(Fe.computeRequireMap(this.System)),
this.id).map(function(K){return Fe.module(C.System,K)})}},{key:"requirements",value:function(){var C=this;return Fe.graph.hull(Fe.computeRequireMap(this.System),this.id).map(function(K){return Fe.module(C.System,K)})}},{key:"directRequirements",value:function(){var C=this,K=(this.record()||{}).dependencies||[];return Fe.arr.pluck(K.filter(Boolean),"name").map(function(T){return Fe.module(C.System,T)})}},{key:"isMochaTest",value:function(){if(!this._source)return!1;var C=this._scope||(this._scope=
Fe.query.topLevelDeclsAndRefs(Fe.parse(this._source)).scope);return Fe.query.imports(C).map(function(K){return K.fromModule}).some(function(K){return K.endsWith("mocha-es6")||K.endsWith("mocha-es6/index.js")})?!0:!1}},{key:"define",value:function(C,K){var T=2<arguments.length&&void 0!==arguments[2]?arguments[2]:!0,O=3<arguments.length?arguments[3]:void 0,qa=this.System,Ba=this.id,ib=this.recorder;qa.debug&&console.log("[lively.modules] ".concat(this.shortName()," defines ").concat(C));var Ub=Symbol["for"]("lively-object-meta"),
pc=Symbol["for"]("lively-module-meta");"function"!==typeof K||!O||"function"!==O.kind&&"class"!==O.kind||(K[Ub]=O);K&&K[Ub]&&!K[pc]&&(O=this.pathInPackage(),Ub=this["package"](),K[pc]={"package":Ub?{name:Ub.name,version:Ub.version}:{},pathInPackage:O});ib[C]=K;Fe.scheduleModuleExportsChange(qa,Ba,C,K,!1);this.notifyTopLevelObservers(C);(T=T||!this.isEvalutionInProgress())&&Fe.runScheduledExportChanges(qa,Ba);return K}},{key:"undefine",value:function(C){delete this.recorder[C]}},{key:"subscribeToToplevelDefinitionChanges",
value:function(C){this._observersOfTopLevelState.push(C);return C}},{key:"notifyTopLevelObservers",value:function(C){var K=this.recorder;["createOrExtendES6ClassForLively","lively.capturing-declaration-wrapper"].includes(C)||this._observersOfTopLevelState.forEach(function(T){return T(C,K[C])})}},{key:"unsubscribeFromToplevelDefinitionChanges",value:function(C){this._observersOfTopLevelState="string"===typeof C?this._observersOfTopLevelState.filter(function(K){return K.name!==C}):this._observersOfTopLevelState.filter(function(K){return K!==
C})}},{key:"evaluationStart",value:function(){this._evaluationsInProgress++}},{key:"evaluationEnd",value:function(){this._evaluationsInProgress--;Fe.runScheduledExportChanges(this.System,this.id)}},{key:"nextEvalId",value:function(){return this._evalId++}},{key:"isEvalutionInProgress",value:function(){return 0<this._evaluationsInProgress}},{key:"env",value:function(){return this}},{key:"package",value:function(){return Fe.Package.forModule(this.System,this)}},{key:"pathInPackage",value:function(){var C=
this["package"]();return C&&0===this.id.indexOf(C.address)?this.id.slice(C.address.length).replace(/^\//,""):this.id}},{key:"imports",value:function(){var C=Gb(regeneratorRuntime.mark(function T(){return regeneratorRuntime.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.t0=Fe.query,O.next=3,this.scope();case 3:return O.t1=O.sent,O.abrupt("return",O.t0.imports.call(O.t0,O.t1));case 5:case "end":return O.stop()}},T,this)}));return function(){return C.apply(this,arguments)}}()},{key:"exports",
value:function(){var C=Gb(regeneratorRuntime.mark(function T(){return regeneratorRuntime.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.t0=Fe.query,O.next=3,this.scope();case 3:return O.t1=O.sent,O.abrupt("return",O.t0.exports.call(O.t0,O.t1));case 5:case "end":return O.stop()}},T,this)}));return function(){return C.apply(this,arguments)}}()},{key:"addImports",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa,Ba,ib,Ub,pc,Dc,kd,Ad;return regeneratorRuntime.wrap(function(Rd){for(;;)switch(Rd.prev=
Rd.next){case 0:return Rd.next=2,this.source();case 2:qa=Rd.sent;Ba=sc(T);try{for(Ba.s();!(ib=Ba.n()).done;)Ub=ib.value,pc=Fe.module(this.System,Ub.from||Ub.moduleId),Dc=pc["package"](),kd={exported:Ub.exported||Ub.local,moduleId:pc.id,packageName:Dc.name,packageURL:Dc.url,pathInPackage:pc.pathInPackage()},Ad=Ub.local,Fe.__inter0__=Fe.ImportInjector.run(this.System,this.id,this["package"](),qa,kd,Ad),qa=Fe.__inter0__.newSource}catch(cf){Ba.e(cf)}finally{Ba.f()}Rd.next=7;return this.changeSource(qa);
case 7:case "end":return Rd.stop()}},O,this)}));return function(T){return C.apply(this,arguments)}}()},{key:"addGlobalDeclaration",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa,Ba,ib,Ub,pc;return regeneratorRuntime.wrap(function(Dc){for(;;)switch(Dc.prev=Dc.next){case 0:return Dc.next=2,this.source();case 2:qa=Dc.sent;Ba=Fe.GlobalInjector.run(qa,T);ib=Ba.status;Ub=Ba.newSource;pc="modified"===ib;if(!pc){Dc.next=8;break}Dc.next=8;return this.changeSource(Ub);case 8:return Dc.abrupt("return",
pc);case 9:case "end":return Dc.stop()}},O,this)}));return function(T){return C.apply(this,arguments)}}()},{key:"removeImports",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa=this,Ba,ib,Ub,pc;return regeneratorRuntime.wrap(function(Dc){for(;;)switch(Dc.prev=Dc.next){case 0:if(T.length){Dc.next=2;break}return Dc.abrupt("return");case 2:return Dc.next=4,this.source();case 4:return Ba=Dc.sent,Dc.next=7,Fe.ImportRemover.removeImports(Ba,T);case 7:return ib=Dc.sent,Ub=ib.source,
pc=ib.removedImports,Dc.next=12,this.changeSource(Ub);case 12:pc.forEach(function(kd){return delete qa.recorder[kd.local]});case 13:case "end":return Dc.stop()}},O,this)}));return function(T){return C.apply(this,arguments)}}()},{key:"_localDeclForRefAt",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa,Ba;return regeneratorRuntime.wrap(function(ib){for(;;)switch(ib.prev=ib.next){case 0:return ib.next=2,this.resolvedScope();case 2:return qa=ib.sent,Ba=Fe.query.refWithDeclAt(T,
qa),ib.abrupt("return",Ba&&{decl:Ba.decl,id:Ba.declId,declModule:this});case 5:case "end":return ib.stop()}},O,this)}));return function(T){return C.apply(this,arguments)}}()},{key:"_localDeclForName",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa,Ba,ib,Ub,pc,Dc;return regeneratorRuntime.wrap(function(kd){for(;;)switch(kd.prev=kd.next){case 0:return kd.next=2,this.resolvedScope();case 2:qa=kd.sent,ib=sc(qa.resolvedRefMap.values()),kd.prev=4,ib.s();case 6:if((Ub=ib.n()).done){kd.next=
14;break}pc=Ub.value;Dc=pc.ref.name;if(T!==Dc){kd.next=12;break}Ba=pc;return kd.abrupt("break",14);case 12:kd.next=6;break;case 14:kd.next=19;break;case 16:kd.prev=16,kd.t0=kd["catch"](4),ib.e(kd.t0);case 19:return kd.prev=19,ib.f(),kd.finish(19);case 22:return kd.abrupt("return",Ba&&{decl:Ba.decl,id:Ba.declId,declModule:this});case 23:case "end":return kd.stop()}},O,this,[[4,16,19,22]])}));return function(T){return C.apply(this,arguments)}}()},{key:"_importForNSRefAt",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa,
Ba,ib,Ub,pc,Dc,kd,Ad,Rd;return regeneratorRuntime.wrap(function(cf){for(;;)switch(cf.prev=cf.next){case 0:return cf.next=2,this.resolvedScope();case 2:qa=cf.sent;Ba=qa.node;ib=Fe.query.nodesAtIndex(Ba,T);if(!(2>ib.length)){cf.next=7;break}return cf.abrupt("return",[null,null]);case 7:Ub=ib[ib.length-1];pc=ib[ib.length-2];if("Identifier"===Ub.type&&"MemberExpression"===pc.type&&!pc.computed&&"Identifier"===pc.object.type){cf.next=11;break}return cf.abrupt("return",[null,null]);case 11:Dc=qa.resolvedRefMap.get(pc.object)||
{};if((kd=Dc.decl)&&"ImportDeclaration"===kd.type){cf.next=14;break}return cf.abrupt("return",[null,null]);case 14:return Ad=pc.object.name,Rd=kd.specifiers.find(function(Ud){return Ud.local.name===Ad}),cf.abrupt("return","ImportNamespaceSpecifier"!==Rd.type?[null,null]:[kd,Rd.local,Ub.name]);case 17:case "end":return cf.stop()}},O,this)}));return function(T){return C.apply(this,arguments)}}()},{key:"_resolveImportedDecl",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa,Ba,ib,
Ub;return regeneratorRuntime.wrap(function(pc){for(;;)switch(pc.prev=pc.next){case 0:if(T){pc.next=2;break}return pc.abrupt("return",[]);case 2:return qa=T.id.name,pc.next=5,this.imports();case 5:Ba=pc.sent;ib=Ba.find(function(Dc){return Dc.local===qa});if(!ib){pc.next=14;break}Ub=Fe.module(this.System,ib.fromModule,this.id);pc.t0=[T];pc.next=12;return Ub.bindingPathForExport(ib.imported);case 12:return pc.t1=pc.sent,pc.abrupt("return",pc.t0.concat.call(pc.t0,pc.t1));case 14:return pc.abrupt("return",
[T]);case 15:case "end":return pc.stop()}},O,this)}));return function(T){return C.apply(this,arguments)}}()},{key:"bindingPathFor",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa;return regeneratorRuntime.wrap(function(Ba){for(;;)switch(Ba.prev=Ba.next){case 0:return Ba.next=2,this._localDeclForName(T);case 2:qa=Ba.sent;if(!qa){Ba.next=7;break}Ba.next=6;return this._resolveImportedDecl(qa);case 6:return Ba.abrupt("return",Ba.sent);case 7:case "end":return Ba.stop()}},O,this)}));
return function(T){return C.apply(this,arguments)}}()},{key:"bindingPathForExport",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa,Ba,ib,Ub;return regeneratorRuntime.wrap(function(pc){for(;;)switch(pc.prev=pc.next){case 0:return pc.next=2,this.resolvedScope();case 2:return pc.next=4,this.exports();case 4:qa=pc.sent;Ba=qa.find(function(Dc){return Dc.exported===T});if(!Ba.fromModule){pc.next=17;break}ib=Fe.module(this.System,Ba.fromModule,this.id);Ub={decl:Ba.node,id:Ba.declId,
declModule:this};pc.t0=[Ub];pc.next=13;return ib.bindingPathForExport(Ba.imported);case 13:return pc.t1=pc.sent,pc.abrupt("return",pc.t0.concat.call(pc.t0,pc.t1));case 17:return pc.abrupt("return",this._resolveImportedDecl({decl:Ba.decl,id:Ba.declId,declModule:Ba&&Ba.decl?this:null}));case 18:case "end":return pc.stop()}},O,this)}));return function(T){return C.apply(this,arguments)}}()},{key:"bindingPathForRefAt",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa,Ba,ib,Ub,pc,Dc,
kd;return regeneratorRuntime.wrap(function(Ad){for(;;)switch(Ad.prev=Ad.next){case 0:return Ad.next=2,this._localDeclForRefAt(T);case 2:qa=Ad.sent;if(!qa){Ad.next=7;break}Ad.next=6;return this._resolveImportedDecl(qa);case 6:return Ad.abrupt("return",Ad.sent);case 7:return Ad.next=9,this._importForNSRefAt(T);case 9:Ba=Ad.sent;ib=ic(Ba,3);Ub=ib[0];pc=ib[1];Dc=ib[2];if(Ub){Ad.next=16;break}return Ad.abrupt("return",[]);case 16:return kd=Fe.module(this.System,Ub.source.value,this.id),Ad.t0=[{decl:Ub,
declModule:this,id:pc}],Ad.next=20,kd.bindingPathForExport(Dc);case 20:return Ad.t1=Ad.sent,Ad.abrupt("return",Ad.t0.concat.call(Ad.t0,Ad.t1));case 22:case "end":return Ad.stop()}},O,this)}));return function(T){return C.apply(this,arguments)}}()},{key:"definitionForRefAt",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa;return regeneratorRuntime.wrap(function(Ba){for(;;)switch(Ba.prev=Ba.next){case 0:return Ba.next=2,this.bindingPathForRefAt(T);case 2:return qa=Ba.sent,Ba.abrupt("return",
1>qa.length?null:qa[qa.length-1].decl);case 4:case "end":return Ba.stop()}},O,this)}));return function(T){return C.apply(this,arguments)}}()},{key:"ensureRecord",value:function(){var C=this.System,K=C._loader.moduleRecords;return K[this.id]?K[this.id]:K[this.id]={name:this.id,exports:C.newModule({}),dependencies:[],importers:[],setters:[]}}},{key:"record",value:function(){var C=this.System._loader.moduleRecords[this.id];if(!C)return null;C.hasOwnProperty("__lively_modules__")||(C.__lively_modules__=
{evalOnlyExport:{}});return C}},{key:"updateRecord",value:function(C){var K=this.record();if(!K)throw Error("es6 environment global of ".concat(this.id,": module not loaded, cannot get export object!"));K.locked=!0;try{return C(K)}finally{K.locked=!1}}},{key:"search",value:function(){var C=Gb(regeneratorRuntime.mark(function qa(T,O){var Ba=this,ib,Ub,pc,Dc,kd,Ad,Rd,cf,Ud,Ge,Se,mh,Rh,dh,eh;return regeneratorRuntime.wrap(function(Rg){for(;;)switch(Rg.prev=Rg.next){case 0:O=Object.assign({excludedModules:[]},
O);if(!O.excludedModules.some(function($c){return"string"===typeof $c?$c===Ba.id:$c instanceof RegExp?$c.test(Ba.id):"function"===typeof $c?$c(Ba.id):!1})){Rg.next=3;break}return Rg.abrupt("return",[]);case 3:return Rg.next=5,this.source();case 5:ib=Rg.sent;T instanceof RegExp?(pc="g",T.ignoreCase&&(pc+="i"),T.multiline&&(pc+="m"),Ub=RegExp(T.source,pc)):(Dc="g",O.caseSensitive||(Dc+="i"),O.regexMode||(T=Fe.regExpEscape(T)),Ub=RegExp(T,Dc));for(Ad=[];null!==(kd=Ub.exec(ib));)Ad.push([kd.index,kd[0].length]);
cf=Rd=0;Ud=1;Ge=0;case 10:if(!(Rd<ib.length&&cf<Ad.length)){Rg.next=23;break}"\n"===ib[Rd]&&(Ud++,Ge=Rd+1);Se=ic(Ad[cf],2);mh=Se[0];Rh=Se[1];if(Rd===mh){Rg.next=15;break}return Rg.abrupt("continue",20);case 15:dh=ib.slice(Ge).indexOf("\n"),dh=-1===dh?ib.length:dh+Ge,eh=this["package"](),Ad[cf]={moduleId:this.id,packageName:eh?eh.name:void 0,pathInPackage:eh?this.pathInPackage():this.id,isLoaded:this.isLoaded(),length:Rh,line:Ud,column:Rd-Ge,lineString:1E3<dh-Ge?"...".concat(ib.slice(Rd-10,Rd+100),
"..."):ib.slice(Ge,dh)},cf++;case 20:Rd++;Rg.next=10;break;case 23:return Rg.abrupt("return",Ad);case 24:case "end":return Rg.stop()}},qa,this)}));return function(T,O){return C.apply(this,arguments)}}()},{key:"toString",value:function(){return"module(".concat(this.id,")")}},{key:"isModule",get:function(){return!0}},{key:"dontTransform",get:function(){return[this.recorderName,this.sourceAccessorName,"global","self","_moduleExport","_moduleImport","localStorage","prompt","alert","fetch","getComputedStyle"].concat(qb(this.isMochaTest()?
[]:Fe.GlobalInjector.getGlobals(this._source))).concat(Fe.query.knownGlobals)}},{key:"recorder",set:function(C){return this._recorder=C},get:function(){var C;if(this._recorder)return this._recorder;var K=this.System,T=this;if(!Fe.globalProps.initialized){Fe.globalProps.initialized=!0;for(var O in K.global)if(K.global.__lookupGetter__(O)||"closed"===O)Fe.globalProps.descriptors[O]={value:void 0,configurable:!0,writable:!0}}O={};if(K.get("@system-env").node){var qa=Fe._require.bind(null,this);qa.resolve=
Fe._resolve.bind(null,this);O.require={configurable:!0,writable:!0,value:qa}}return this._recorder=Object.create(K.global,Object.assign({},Fe.globalProps.descriptors,{},O,(C={event:{configurable:!0,writable:!0,value:void 0},System:{configurable:!0,writable:!0,value:K},__currentLivelyModule:{value:T}},Wb(C,Fe.defaultClassToFunctionConverterName,{configurable:!0,writable:!0,value:Fe.classRuntime.initializeClass}),Wb(C,this.varDefinitionCallbackName,{value:function(Ba,ib,Ub,pc,Dc){Dc=Dc||{};Dc.kind=
ib;return T.define(Ba,Ub,!1,Dc)}}),Wb(C,"_moduleExport",{value:function(Ba,ib){Fe.scheduleModuleExportsChange(K,T.id,Ba,ib,!0)}}),Wb(C,"_moduleImport",{value:function(Ba,ib){var Ub=K.decanonicalize(Ba,T.id),pc=K.get(Ub);if(pc){T.addDependencyToModuleRecord(Fe.module(K,Ub),function(Dc){return Object.assign(T.recorder,Dc)});if(void 0===ib)return pc;pc.hasOwnProperty(ib)||console.warn("import from ".concat(pc,": Has no export ").concat(ib,"!"));return pc[ib]}console.warn("import of ".concat(ib," failed: ").concat(Ba,
" (tried as ").concat(T.id,") is not loaded!"))}}),C)))}},{key:"varDefinitionCallbackName",get:function(){return"defVar_"+this.id}}]);return z}();Fe.ModuleInterface=eg;Fe["default"]=Cc;var be=window.lively.FreezerRuntime.recorderFor("lively.modules/src/cache.js");be.prepareNodejsCaching=function(){var z=System._nodeRequire("fs"),C=System._nodeRequire("path"),K="win32"===process.platform;C=K||"/"!==process.cwd()?process.cwd():C.join(process.env.HOME,".lively.next");be.nodejsCacheDirURL=K?"file:///".concat(C.replace(/\\/g,
"/")):"file://".concat(C);z.existsSync(C)||z.mkdirSync(C)};be.resource=Db;var v=function(){function z(){Ed(this,z)}fe(z,[{key:"cacheModuleSource",value:function(C,K,T){throw Error("not yet implemented");}},{key:"fetchStoredModuleSource",value:function(C){throw Error("not yet implemented");}},{key:"deleteCachedData",value:function(C){throw Error("not yet implemented");}}],[{key:"earliestDate",get:function(){return+new Date("Sun Oct 18 2020 16:00:00 GMT-0800 (PST)")}}]);return z}();be.ModuleTranslationCache=
v;be.nodejsCacheDirURL=null;var oa=function(z){function C(){Ed(this,C);return K.apply(this,arguments)}dd(C,z);var K=vd(C);fe(C,[{key:"ensurePath",value:function(){var T=Gb(regeneratorRuntime.mark(function Ba(qa){var ib,Ub,pc,Dc,kd,Ad;return regeneratorRuntime.wrap(function(Rd){for(;;)switch(Rd.prev=Rd.next){case 0:return Rd.next=2,this.moduleCacheDir.join(qa).exists();case 2:if(!Rd.sent){Rd.next=4;break}return Rd.abrupt("return");case 4:ib="",Dc=sc(qa.split("/")),Rd.prev=6,Dc.s();case 8:if((kd=Dc.n()).done){Rd.next=
35;break}Ad=kd.value;ib+=Ad+"/";Ub=this.moduleCacheDir.join(ib);Rd.next=14;return Ub.exists();case 14:if(Rd.sent){Rd.next=24;break}Rd.prev=15;Rd.next=18;return Ub.mkdir();case 18:Rd.next=24;break;case 20:Rd.prev=20;Rd.t0=Rd["catch"](15);if("EEXIST"===Rd.t0.code){Rd.next=24;break}throw Rd.t0;case 24:return Ub=be.resource("file://"+ib+"/package.json"),Rd.next=27,Ub.exists();case 27:if(!Rd.sent){Rd.next=33;break}Rd.next=30;return Ub.read();case 30:return pc=Rd.sent,Rd.next=33,this.moduleCacheDir.join(ib+
"/package.json").write(pc);case 33:Rd.next=8;break;case 35:Rd.next=40;break;case 37:Rd.prev=37,Rd.t1=Rd["catch"](6),Dc.e(Rd.t1);case 40:return Rd.prev=40,Dc.f(),Rd.finish(40);case 43:case "end":return Rd.stop()}},Ba,this,[[6,37,40,43],[15,20]])}));return function(qa){return T.apply(this,arguments)}}()},{key:"dumpModuleCache",value:function(){var T=Gb(regeneratorRuntime.mark(function qa(){var Ba,ib;return regeneratorRuntime.wrap(function(Ub){for(;;)switch(Ub.prev=Ub.next){case 0:Ub.t0=regeneratorRuntime.keys(System._nodeRequire("module").Module._cache);
case 1:if((Ub.t1=Ub.t0()).done){Ub.next=16;break}Ba=Ub.t1.value;ib=be.resource("file://"+Ba);Ub.next=6;return ib.exists();case 6:if(!Ub.sent){Ub.next=14;break}Ub.t2=this;Ub.t3=Ba;Ub.next=11;return ib.read();case 11:return Ub.t4=Ub.sent,Ub.next=14,Ub.t2.cacheModuleSource.call(Ub.t2,Ub.t3,"NO_HASH",Ub.t4);case 14:Ub.next=1;break;case 16:case "end":return Ub.stop()}},qa,this)}));return function(){return T.apply(this,arguments)}}()},{key:"getFileName",value:function(T){return T.match(/([^\/]*.)(\.js)?$/)[0]}},
{key:"fetchStoredModuleSource",value:function(){var T=Gb(regeneratorRuntime.mark(function Ba(qa){var ib,Ub,pc,Dc,kd,Ad,Rd;return regeneratorRuntime.wrap(function(cf){for(;;)switch(cf.prev=cf.next){case 0:return qa=qa.replace("file://",""),ib=this.getFileName(qa),Ub=qa.replace(ib,""),pc=this.moduleCacheDir.join(qa),cf.next=6,pc.exists();case 6:if(cf.sent){cf.next=8;break}return cf.abrupt("return",null);case 8:return cf.next=10,pc.stat();case 10:return Dc=cf.sent,kd=Dc.birthtime,cf.next=14,pc.read();
case 14:return Ad=cf.sent,cf.next=17,this.moduleCacheDir.join(Ub+"/.hash_"+ib).read();case 17:return Rd=cf.sent,cf.abrupt("return",{source:Ad,timestamp:kd,hash:Rd});case 19:case "end":return cf.stop()}},Ba,this)}));return function(qa){return T.apply(this,arguments)}}()},{key:"cacheModuleSource",value:function(){var T=Gb(regeneratorRuntime.mark(function Ub(qa,Ba,ib){var pc,Dc;return regeneratorRuntime.wrap(function(kd){for(;;)switch(kd.prev=kd.next){case 0:return qa=qa.replace("file://",""),pc=this.getFileName(qa),
Dc=qa.replace(pc,""),kd.next=5,this.ensurePath(Dc);case 5:return kd.next=7,this.moduleCacheDir.join(qa).write(ib);case 7:return kd.next=9,this.moduleCacheDir.join(Dc+"/.hash_"+pc).write(Ba);case 9:case "end":return kd.stop()}},Ub,this)}));return function(qa,Ba,ib){return T.apply(this,arguments)}}()},{key:"deleteCachedData",value:function(){var T=Gb(regeneratorRuntime.mark(function Ba(qa){var ib;return regeneratorRuntime.wrap(function(Ub){for(;;)switch(Ub.prev=Ub.next){case 0:return qa=qa.replace("file://",
""),ib=this.moduleCacheDir.join(qa),Ub.next=4,ib.exists();case 4:if(Ub.sent){Ub.next=6;break}return Ub.abrupt("return",!1);case 6:return Ub.next=8,ib.remove();case 8:return Ub.abrupt("return",!0);case 9:case "end":return Ub.stop()}},Ba,this)}));return function(qa){return T.apply(this,arguments)}}()},{key:"moduleCacheDir",get:function(){be.nodejsCacheDirURL||be.prepareNodejsCaching();return be.resource("".concat(be.nodejsCacheDirURL,"/.module_cache/"))}}]);return C}(be.ModuleTranslationCache);be.NodeModuleTranslationCache=
oa;var Oc=bd("B",function(z){function C(){var T=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"lively.modules-module-translation-cache";Ed(this,C);var O=K.call(this);O.version=2;O.sourceCodeCacheStoreName="sourceCodeStore";O.dbName=T;O.db=O.openDb();return O}dd(C,z);var K=vd(C);fe(C,[{key:"openDb",value:function(){var T=this,O=System.global.indexedDB.open(this.version);return new Promise(function(qa,Ba){O.onsuccess=function(ib){qa(this.result)};O.onerror=function(ib){return Ba(ib.target)};
O.onupgradeneeded=function(ib){return ib.currentTarget.result.createObjectStore(T.sourceCodeCacheStoreName,{keyPath:"moduleId"})}})}},{key:"deleteDb",value:function(){var T=System.global.indexedDB.deleteDatabase(this.dbName);return new Promise(function(O,qa){T.onerror=function(Ba){return qa(Ba.target)};T.onsuccess=function(Ba){return O(Ba)}})}},{key:"closeDb",value:function(){var T=Gb(regeneratorRuntime.mark(function qa(){var Ba,ib;return regeneratorRuntime.wrap(function(Ub){for(;;)switch(Ub.prev=
Ub.next){case 0:return Ub.next=2,this.db;case 2:return Ba=Ub.sent,ib=Ba.close(),Ub.abrupt("return",new Promise(function(pc,Dc){ib.onsuccess=function(kd){pc(this.result)};ib.onerror=function(kd){return Dc(kd.target.errorCode)}}));case 5:case "end":return Ub.stop()}},qa,this)}));return function(){return T.apply(this,arguments)}}()},{key:"cacheModuleSource",value:function(){var T=Gb(regeneratorRuntime.mark(function Ub(qa,Ba,ib){var pc=this,Dc;return regeneratorRuntime.wrap(function(kd){for(;;)switch(kd.prev=
kd.next){case 0:return kd.next=2,this.db;case 2:return Dc=kd.sent,kd.abrupt("return",new Promise(function(Ad,Rd){var cf=Dc.transaction([pc.sourceCodeCacheStoreName],"readwrite"),Ud=cf.objectStore(pc.sourceCodeCacheStoreName),Ge=Date.now();Ud.put({moduleId:qa,hash:Ba,source:ib,timestamp:Ge});cf.oncomplete=Ad;cf.onerror=Rd}));case 4:case "end":return kd.stop()}},Ub,this)}));return function(qa,Ba,ib){return T.apply(this,arguments)}}()},{key:"fetchStoredModuleSource",value:function(){var T=Gb(regeneratorRuntime.mark(function Ba(qa){var ib=
this,Ub;return regeneratorRuntime.wrap(function(pc){for(;;)switch(pc.prev=pc.next){case 0:return pc.next=2,this.db;case 2:return Ub=pc.sent,pc.abrupt("return",new Promise(function(Dc,kd){var Ad=Ub.transaction([ib.sourceCodeCacheStoreName]).objectStore(ib.sourceCodeCacheStoreName).get(qa);Ad.onerror=kd;Ad.onsuccess=function(Rd){return Dc(Ad.result)}}));case 4:case "end":return pc.stop()}},Ba,this)}));return function(qa){return T.apply(this,arguments)}}()},{key:"deleteCachedData",value:function(){var T=
Gb(regeneratorRuntime.mark(function Ba(qa){var ib=this,Ub;return regeneratorRuntime.wrap(function(pc){for(;;)switch(pc.prev=pc.next){case 0:return pc.next=2,this.db;case 2:return Ub=pc.sent,pc.abrupt("return",new Promise(function(Dc,kd){var Ad=Ub.transaction([ib.sourceCodeCacheStoreName],"readwrite").objectStore(ib.sourceCodeCacheStoreName)["delete"](qa);Ad.onerror=kd;Ad.onsuccess=function(Rd){return Dc(Ad.result)}}));case 4:case "end":return pc.stop()}},Ba,this)}));return function(qa){return T.apply(this,
arguments)}}()}]);return C}(be.ModuleTranslationCache));be.BrowserModuleTranslationCache=Oc;var Tb=window.lively.FreezerRuntime.recorderFor("lively.modules/src/instrumentation.js");Tb.getExceptions=Uc;Tb.setExceptions=Md;Tb.prepareCodeForCustomCompile=Ob;Tb.prepareTranslatedCodeForSetterCapture=Le;Tb.getCachedNodejsModule=function(z,C){try{var K=z._nodeRequire("module").Module,T=K._resolveFilename(C.name.replace(/^file:\/\//,"").replace(/^\/([a-z]:\/)/i,"$1"));return K._cache[T]}catch(O){z.debug&&
console.log("[lively.modules getCachedNodejsModule] %s unknown to nodejs",C.name)}return null};Tb.addNodejsWrapperSource=function(z,C){var K=Tb.getCachedNodejsModule(z,C);if(K)return C.metadata.format="esm",C.source="var exports = System._nodeRequire('".concat(K.id,"'); export default exports;\n")+Tb.properties.allOwnPropertiesOrFunctions(K.exports).map(function(T){return Tb.isValidIdentifier(T)?"export var ".concat(T," = exports['").concat(T,"'];"):'/*ignoring export "'.concat(T,'" b/c it is not a valid identifier*/')}).join("\n"),
z.debug&&console.log("[lively.modules customTranslate] loading %s from nodejs module cache",C.name),!0;z.debug&&console.log("[lively.modules customTranslate] %s not yet in nodejs module cache",C.name);return!1};Tb.customTranslate=function(z,C){return We.apply(this,arguments)};Tb.instrumentSourceOfEsmModuleLoad=xe;Tb.instrumentSourceOfGlobalModuleLoad=Fg;Tb.wrapModuleLoad=Zc;Tb.unwrapModuleLoad=rd;Tb.commonjsHelpers=db;Tb.parse=Ne;Tb.nodes=ve;Tb.isValidIdentifier=Nb;var ne=Tb.nodes;Tb.funcCall=ne.funcCall;
Tb.member=ne.member;Tb.literal=ne.literal;Tb.evalCodeTransform=zb;Tb.evalCodeTransformOfSystemRegisterSetters=rb;Tb.string=ub;Tb.properties=Ib;Tb.classToFunctionTransform=Na;Tb.installHook=M;Tb.removeHook=Aa;Tb.isHookInstalled=wb;Tb.module=Cc;Tb.detectModuleFormat=Pf;Tb.BrowserModuleTranslationCache=Oc;Tb.NodeModuleTranslationCache=oa;Tb.isNode=System.get("@system-env").node;Tb.node_modulesDir=System.decanonicalize("lively.modules/node_modules/");Tb.exceptions=[function(z){return!z.endsWith(".js")&&
!z.endsWith(".jsx")&&!z.startsWith("https://jspm.dev")&&!z.startsWith("esm://")},function(z){return z.endsWith("dist/acorn.js")||z.endsWith("dist/escodegen.browser.js")||z.endsWith("bowser.js")||z.endsWith("TweenMax.min.js")},function(z){return z.endsWith("babel-core/browser.js")||z.endsWith("system.src.js")||z.includes("systemjs-plugin-babel")}];Tb.prepareCodeForCustomCompile=Ob;Tb.prepareTranslatedCodeForSetterCapture=Le;Tb.wrapModuleLoad=Zc;Tb.unwrapModuleLoad=rd;Tb.getExceptions=Uc;Tb.setExceptions=
Md;Tb.instrumentSourceOfEsmModuleLoad=xe;Tb.instrumentSourceOfGlobalModuleLoad=Fg;window.lively.FreezerRuntime.recorderFor("@empty");var Ye=window.lively.FreezerRuntime.recorderFor("lively.modules/src/resource.js");Ye.fetchResource=function(z,C){return ti.apply(this,arguments)};Ye.livelyProtocol=function(z,C){var K=C.match(Ye.livelyURLRe);if(!K)return z(C);z=ic(K,3);z[0];z[1];var T=z[2];return{read:function(){var O="undefined"!==typeof $world&&$world.getMorphWithId(T);return Promise.resolve(O?O.textString:
"/*Could not locate ".concat(T,"*/"))},write:function(O){var qa="undefined"!==typeof $world&&$world.getMorphWithId(T);if(!qa)return Promise.reject("Could not save morph ".concat(T));qa.textString=O;return Promise.resolve(this)}}};Ye.wrapResource=dg;Ye.unwrapResource=Of;Ye.resource=Db;Ye.Resource=da;Ye.promise=fa;Ye.installHook=M;Ye.removeHook=Aa;Ye.isHookInstalled=wb;Ye._fetch=void 0;var Kf;"undefined"!==typeof System&&System.get("@system-env").node&&(Kf=Ye._fetch||System._nodeRequire("node-fetch"));
Ye.jsFileHashMap=Ye.jsFileHashMap||void 0;Ye.livelyURLRe=/^lively:\/\/([^\/]+)\/(.*)$/;Ye.wrapResource=dg;Ye.unwrapResource=Of;var jg=function(z){function C(){Ed(this,C);return K.apply(this,arguments)}dd(C,z);var K=vd(C);fe(C,[{key:"read",value:function(){var T=Gb(regeneratorRuntime.mark(function qa(){var Ba,ib;return regeneratorRuntime.wrap(function(Ub){for(;;)switch(Ub.prev=Ub.next){case 0:return Ba=this.morphId,ib="undefined"!==typeof $world&&$world.getMorphWithId(Ba),Ub.abrupt("return",Promise.resolve(ib?
ib.textString:"/*Could not locate ".concat(Ba,"*/")));case 3:case "end":return Ub.stop()}},qa,this)}));return function(){return T.apply(this,arguments)}}()},{key:"write",value:function(){var T=Gb(regeneratorRuntime.mark(function Ba(qa){var ib,Ub;return regeneratorRuntime.wrap(function(pc){for(;;)switch(pc.prev=pc.next){case 0:ib=this.morphId;if(Ub="undefined"!==typeof $world&&$world.getMorphWithId(ib)){pc.next=4;break}return pc.abrupt("return",Promise.reject("Could not save morph ".concat(ib)));case 4:return Ub.textString=
qa,pc.abrupt("return",Promise.resolve(this));case 6:case "end":return pc.stop()}},Ba,this)}));return function(qa){return T.apply(this,arguments)}}()},{key:"exists",value:function(){var T=Gb(regeneratorRuntime.mark(function qa(){return regeneratorRuntime.wrap(function(Ba){for(;;)switch(Ba.prev=Ba.next){case 0:return Ba.abrupt("return","undefined"!==typeof $world&&$world.getMorphWithId(this.morphId));case 1:case "end":return Ba.stop()}},qa,this)}));return function(){return T.apply(this,arguments)}}()},
{key:"remove",value:function(){var T=Gb(regeneratorRuntime.mark(function qa(){return regeneratorRuntime.wrap(function(Ba){for(;;)switch(Ba.prev=Ba.next){case 0:return"undefined"!==typeof $world&&$world.getMorphWithId(this.morphId).remove(),Ba.abrupt("return",!0);case 2:case "end":return Ba.stop()}},qa,this)}));return function(){return T.apply(this,arguments)}}()},{key:"canDealWithJSON",get:function(){return!1}},{key:"morphId",get:function(){var T=this.url.match(Ye.livelyURLRe);T=ic(T,3);T[0];T[1];
return T[2]}}]);return C}(Ye.Resource);Ye.LivelyResource=jg;var Og={name:"lively.modules",matches:function(z){return z.match(Ye.livelyURLRe)},resourceClass:Ye.LivelyResource};Ye.resourceExtension=Og;Ye.resourceExtension=Og;Ye.registerExtension=ka;Ye.registerExtension(Ye.resourceExtension);var te=window.lively.FreezerRuntime.recorderFor("lively.modules/src/system.js");te.wrapModuleResolution=mg;te.unwrapModuleResolution=wf;te.livelySystemEnv=mf;te.systems=function(){System.constructor.systems||(System.constructor.systems=
{});return System.constructor.systems};te.nameOfSystem=function(z){return Object.keys(te.systems()).some(function(C){return te.systems()[C]===z})};te.getSystem=Mb;te.removeSystem=gd;te.makeSystem=function(z){return te.prepareSystem(new System.constructor,z)};te.prepareSystem=Vd;te.urlQuery=function(){return"undefined"!==typeof document&&document.location?(document.location.search||"").replace(/^\?/,"").split("&").reduce(function(z,C){var K=C.split("=");C=K[0];K=K[1];"true"===K||"false"===K?K=eval(K):
isNaN(Number(K))||(K=Number(K));z[C]=K;return z},{}):{}};te.preNormalize=function(z,C,K){".."===C&&(C="../index.js");C=C.replace(te.doubleSlashRe,function(ib){return":"===ib[0]?ib:ib[0]+"/"});var T=z.get("@lively-env").packageRegistry;if(T){var O=K&&T.findPackageHavingURL(K);if(O){var qa=O.map,Ba=O.url;if(qa=qa&&qa[C]||z.map[C])"object"===va(qa)&&(qa=te.normalize_doMapWithObject(qa,O,z)),"string"===typeof qa&&""!==qa&&(C=qa),C.startsWith(".")&&(C=te.urlResolve(te.join(Ba,C)))}}T&&(z=T.resolvePath(C,
K))&&(z.endsWith("/")&&!C.endsWith("/")&&(z=z.slice(0,-1)),!z.endsWith("/")&&C.endsWith("/")&&(z+="/"),C=z);return C};te.postNormalize=function(z,C,K){K=C.replace(te.jsExtRe,"");if(C.endsWith("/"))return C;var T=z.get("@lively-env").packageRegistry;if(T){if(T=T.findPackageWithURL(K))return z=(T.main||"index.js").replace(te.dotSlashStartRe,""),K.replace(te.trailingSlashRe,"")+"/"+z}else if(K in z.packages&&(T=z.packages[K].main))return K.replace(te.trailingSlashRe,"")+"/"+T.replace(te.dotSlashStartRe,
"");K=C.match(te.jsonJsExtRe);z.debug&&console.log(">> [postNormalize] ".concat(K?K[1]:C));return K?K[1]:C};te.checkExistence=function(z,C){return sf.apply(this,arguments)};te.normalizeHook=function(z,C,K,T){return hg.apply(this,arguments)};te.decanonicalizeHook=function(z,C,K,T){if(C&&C.endsWith("!cjs")){C=C.replace("!cjs","");var O="!cjs"}var qa=te.preNormalize(this,C,K);z=z(qa,K,T);z=te.postNormalize(this,z,!0);O&&(z+=O);this.debug&&console.log("[normalizeSync] ".concat(C," => ").concat(z));return z};
te.locateHook=function(z,C){return bh.apply(this,arguments)};te.whenSystemModuleLoaded=function(z){return Qf.apply(this,arguments)};te.normalize_doMapWithObject=function(z,C,K){C=K.get(C.map["@env"]||"@system-env");var T;for(T in z){K="~"===T[0];var O=K?T.substr(1):T;var qa=C;for(O=O.split(".");O.length;)qa=qa[O.shift()];if(!K&&qa||K&&!qa){var Ba=z[T];break}}if(Ba&&"string"!==typeof Ba)throw Error("Unable to map a package conditional to a package conditional.");return Ba};te.normalize_packageOfURL=
function(z,C){var K=Object.keys(C.packages||{}).map(function(T){return 0===z.indexOf(T)?{url:T,penalty:z.slice(T.length).length}:null}).filter(function(T){return!!T});return(C=(K=K.length?K.reduce(function(T,O){return T.penalty>O.penalty?O:T}).url:null)&&C.packages[K])?{systemPackage:C,packageURL:K}:null};te.newModule_volatile=function(z,C){var K=Object.freeze;Object.freeze=function(T){return T};z=z(C);Object.freeze=K;return z};te.printSystemConfig=he;te.instantiate_triggerOnLoadCallbacks=function(z,
C){var K=this;return z(C).then(function(T){var O={};te.whenSystemModuleLoaded(C.name).then(function(qa){if(qa===O)console.warn("[lively.modules] instantiate_triggerOnLoadCallbacks for ".concat(C.name," timed out"));else{qa=C.name;for(var Ba=te.classHolder.module(K,qa),ib=K.get("@lively-env").onLoadCallbacks,Ub=ib.length;Ub--;){var pc=ib[Ub],Dc=pc.moduleName,kd=pc.callback;if((pc.resolved?Dc:K.decanonicalize(Dc))===qa){ib.splice(Ub,1);try{kd(Ba)}catch(Ad){console.error(Ad)}}}te.emit("lively.modules/moduleloaded",
{module:C.name},Date.now(),K);K._loadingIndicator&&(K._loadingIndicator.remove(),K._loadingIndicator=null)}});return T})};te.whenLoaded=Uf;te.loadedModules=$g;te.knownModuleNames=Ta;te.searchLoadedModules=th;te.arr=se;te.obj=sb;te.promise=fa;te.removeHook=Aa;te.installHook=M;te.isHookInstalled=wb;te.classHolder=Re;te.isNode=System.get("@system-env").node;te.GLOBAL="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:void 0;te.defaultOptions={notificationLimit:null};
te.wrapModuleResolution=mg;te.unwrapModuleResolution=wf;te.wrapModuleLoad=Zc;te.wrapResource=dg;te.emit=Xa;te.join=Z;te.urlResolve=yc;te.resource=Db;te.dotSlashStartRe=/^\.?\//;te.trailingSlashRe=/\/$/;te.jsExtRe=/\.js$/;te.cjsExtRe=/\.cjs$/;te.jsxExtRe=/\.jsx$/;te.nodeExtRe=/\.node$/;te.jsonExtRe=/\.json$/;te.jsonJsExtRe=/(.*\.json)\.js$/i;te.jsxJsExtRe=/(.*\.jsx)\.js$/i;te.doubleSlashRe=/.\/{2,}/g;te.nodeModRe=/@node.*/;te.moduleLoadPromises={};te.whenLoaded=Uf;te.getSystem=Mb;te.removeSystem=gd;
te.prepareSystem=Vd;te.printSystemConfig=he;te.livelySystemEnv=mf;te.loadedModules=$g;te.knownModuleNames=Ta;te.searchLoadedModules=th;var Eh={exports:{}},$h=window.lively.FreezerRuntime.recorderFor("lively.next-node_modules/semver/5.3.0/semver.js");$h.commonjsHelpers=db;$h.semverModule=Eh;$h.semver=Eh.exports;(function(z,C){function K(Xd,ff){if(Xd instanceof T)return Xd;if("string"!==typeof Xd||Xd.length>Tc||!(ff?hd[oe]:hd[ud]).test(Xd))return null;try{return new T(Xd,ff)}catch(af){return null}}
function T(Xd,ff){if(Xd instanceof T){if(Xd.loose===ff)return Xd;Xd=Xd.version}else if("string"!==typeof Xd)throw new TypeError("Invalid Version: "+Xd);if(Xd.length>Tc)throw new TypeError("version is longer than "+Tc+" characters");if(!(this instanceof T))return new T(Xd,ff);Yc("SemVer",Xd,ff);this.loose=ff;ff=Xd.trim().match(ff?hd[oe]:hd[ud]);if(!ff)throw new TypeError("Invalid Version: "+Xd);this.raw=Xd;this.major=+ff[1];this.minor=+ff[2];this.patch=+ff[3];if(this.major>td||0>this.major)throw new TypeError("Invalid major version");
if(this.minor>td||0>this.minor)throw new TypeError("Invalid minor version");if(this.patch>td||0>this.patch)throw new TypeError("Invalid patch version");this.prerelease=ff[4]?ff[4].split(".").map(function(af){if(/^[0-9]+$/.test(af)){var Gf=+af;if(0<=Gf&&Gf<td)return Gf}return af}):[];this.build=ff[5]?ff[5].split("."):[];this.format()}function O(Xd,ff){var af=Zi.test(Xd),Gf=Zi.test(ff);af&&Gf&&(Xd=+Xd,ff=+ff);return af&&!Gf?-1:Gf&&!af?1:Xd<ff?-1:Xd>ff?1:0}function qa(Xd,ff,af){return(new T(Xd,af)).compare(ff)}
function Ba(Xd,ff,af){return 0<qa(Xd,ff,af)}function ib(Xd,ff,af){return 0>qa(Xd,ff,af)}function Ub(Xd,ff,af){return 0===qa(Xd,ff,af)}function pc(Xd,ff,af){return 0!==qa(Xd,ff,af)}function Dc(Xd,ff,af){return 0<=qa(Xd,ff,af)}function kd(Xd,ff,af){return 0>=qa(Xd,ff,af)}function Ad(Xd,ff,af,Gf){switch(ff){case "===":"object"===va(Xd)&&(Xd=Xd.version);"object"===va(af)&&(af=af.version);Xd=Xd===af;break;case "!==":"object"===va(Xd)&&(Xd=Xd.version);"object"===va(af)&&(af=af.version);Xd=Xd!==af;break;
case "":case "=":case "==":Xd=Ub(Xd,af,Gf);break;case "!=":Xd=pc(Xd,af,Gf);break;case ">":Xd=Ba(Xd,af,Gf);break;case ">=":Xd=Dc(Xd,af,Gf);break;case "<":Xd=ib(Xd,af,Gf);break;case "<=":Xd=kd(Xd,af,Gf);break;default:throw new TypeError("Invalid operator: "+ff);}return Xd}function Rd(Xd,ff){if(Xd instanceof Rd){if(Xd.loose===ff)return Xd;Xd=Xd.value}if(!(this instanceof Rd))return new Rd(Xd,ff);Yc("comparator",Xd,ff);this.loose=ff;this.parse(Xd);this.value=this.semver===ni?"":this.operator+this.semver.version;
Yc("comp",this)}function cf(Xd,ff){if(Xd instanceof cf&&Xd.loose===ff)return Xd;if(!(this instanceof cf))return new cf(Xd,ff);this.loose=ff;this.raw=Xd;this.set=Xd.split(/\s*\|\|\s*/).map(function(af){return this.parseRange(af.trim())},this).filter(function(af){return af.length});if(!this.set.length)throw new TypeError("Invalid SemVer Range: "+Xd);this.format()}function Ud(Xd){return!Xd||"x"===Xd.toLowerCase()||"*"===Xd}function Ge(Xd,ff){return Xd.trim().split(/\s+/).map(function(af){return Se(af,
ff)}).join(" ")}function Se(Xd,ff){return Xd.replace(ff?hd[Rf]:hd[lf],function(af,Gf,Jh,ci,di){Yc("tilde",Xd,af,Gf,Jh,ci,di);Ud(Gf)?af="":Ud(Jh)?af=">="+Gf+".0.0 <"+(+Gf+1)+".0.0":Ud(ci)?af=">="+Gf+"."+Jh+".0 <"+Gf+"."+(+Jh+1)+".0":di?(Yc("replaceTilde pr",di),"-"!==di.charAt(0)&&(di="-"+di),af=">="+Gf+"."+Jh+"."+ci+di+" <"+Gf+"."+(+Jh+1)+".0"):af=">="+Gf+"."+Jh+"."+ci+" <"+Gf+"."+(+Jh+1)+".0";Yc("tilde return",af);return af})}function mh(Xd,ff){return Xd.trim().split(/\s+/).map(function(af){return Rh(af,
ff)}).join(" ")}function Rh(Xd,ff){Yc("caret",Xd,ff);return Xd.replace(ff?hd[fg]:hd[ng],function(af,Gf,Jh,ci,di){Yc("caret",Xd,af,Gf,Jh,ci,di);Ud(Gf)?af="":Ud(Jh)?af=">="+Gf+".0.0 <"+(+Gf+1)+".0.0":Ud(ci)?af="0"===Gf?">="+Gf+"."+Jh+".0 <"+Gf+"."+(+Jh+1)+".0":">="+Gf+"."+Jh+".0 <"+(+Gf+1)+".0.0":di?(Yc("replaceCaret pr",di),"-"!==di.charAt(0)&&(di="-"+di),af="0"===Gf?"0"===Jh?">="+Gf+"."+Jh+"."+ci+di+" <"+Gf+"."+Jh+"."+(+ci+1):">="+Gf+"."+Jh+"."+ci+di+" <"+Gf+"."+(+Jh+1)+".0":">="+Gf+"."+Jh+"."+ci+
di+" <"+(+Gf+1)+".0.0"):(Yc("no pr"),af="0"===Gf?"0"===Jh?">="+Gf+"."+Jh+"."+ci+" <"+Gf+"."+Jh+"."+(+ci+1):">="+Gf+"."+Jh+"."+ci+" <"+Gf+"."+(+Jh+1)+".0":">="+Gf+"."+Jh+"."+ci+" <"+(+Gf+1)+".0.0");Yc("caret return",af);return af})}function dh(Xd,ff){Yc("replaceXRanges",Xd,ff);return Xd.split(/\s+/).map(function(af){return eh(af,ff)}).join(" ")}function eh(Xd,ff){Xd=Xd.trim();return Xd.replace(ff?hd[Me]:hd[Ue],function(af,Gf,Jh,ci,di,vj){Yc("xRange",Xd,af,Gf,Jh,ci,di,vj);var pj=(vj=Ud(Jh))||Ud(ci),
kj=pj||Ud(di);"="===Gf&&kj&&(Gf="");vj?af=">"===Gf||"<"===Gf?"<0.0.0":"*":Gf&&kj?(pj&&(ci=0),kj&&(di=0),">"===Gf?(Gf=">=",pj?(Jh=+Jh+1,di=ci=0):kj&&(ci=+ci+1,di=0)):"<="===Gf&&(Gf="<",pj?Jh=+Jh+1:ci=+ci+1),af=Gf+Jh+"."+ci+"."+di):pj?af=">="+Jh+".0.0 <"+(+Jh+1)+".0.0":kj&&(af=">="+Jh+"."+ci+".0 <"+Jh+"."+(+ci+1)+".0");Yc("xRange return",af);return af})}function Rg(Xd,ff,af,Gf,Jh,ci,di,vj,pj,kj,Ih,mk,fl){ff=Ud(af)?"":Ud(Gf)?">="+af+".0.0":Ud(Jh)?">="+af+"."+Gf+".0":">="+ff;vj=Ud(pj)?"":Ud(kj)?"<"+(+pj+
1)+".0.0":Ud(Ih)?"<"+pj+"."+(+kj+1)+".0":mk?"<="+pj+"."+kj+"."+Ih+"-"+mk:"<="+vj;return(ff+" "+vj).trim()}function $c(Xd,ff){for(var af=0;af<Xd.length;af++)if(!Xd[af].test(ff))return!1;if(ff.prerelease.length){for(af=0;af<Xd.length;af++)if(Yc(Xd[af].semver),Xd[af].semver!==ni&&0<Xd[af].semver.prerelease.length){var Gf=Xd[af].semver;if(Gf.major===ff.major&&Gf.minor===ff.minor&&Gf.patch===ff.patch)return!0}return!1}return!0}function vf(Xd,ff,af){try{ff=new cf(ff,af)}catch(Gf){return!1}return ff.test(Xd)}
function ye(Xd,ff,af,Gf){Xd=new T(Xd,Gf);ff=new cf(ff,Gf);switch(af){case ">":var Jh=Ba;af=kd;var ci=ib;var di=">";var vj=">=";break;case "<":Jh=ib;af=Dc;ci=Ba;di="<";vj="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"');}if(vf(Xd,ff,Gf))return!1;for(var pj=0;pj<ff.set.length;++pj){var kj=null,Ih=null;ff.set[pj].forEach(function(mk){mk.semver===ni&&(mk=new Rd(">=0.0.0"));kj=kj||mk;Ih=Ih||mk;Jh(mk.semver,kj.semver,Gf)?kj=mk:ci(mk.semver,Ih.semver,Gf)&&(Ih=mk)});if(kj.operator===
di||kj.operator===vj||(!Ih.operator||Ih.operator===di)&&af(Xd,Ih.semver)||Ih.operator===vj&&ci(Xd,Ih.semver))return!1}return!0}C=z.exports=T;var Yc="object"===("undefined"===typeof process?"undefined":va(process))&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var Xd=Array.prototype.slice.call(arguments,0);Xd.unshift("SEMVER");console.log.apply(console,Xd)}:function(){};C.SEMVER_SPEC_VERSION="2.0.0";var Tc=256,td=Number.MAX_SAFE_INTEGER||9007199254740991,
hd=C.re=[];z=C.src=[];var aa=0,Sa=aa++;z[Sa]="0|[1-9]\\d*";var Ma=aa++;z[Ma]="[0-9]+";var jb=aa++;z[jb]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var Jb=aa++;z[Jb]="("+z[Sa]+")\\.("+z[Sa]+")\\.("+z[Sa]+")";var gc=aa++;z[gc]="("+z[Ma]+")\\.("+z[Ma]+")\\.("+z[Ma]+")";var ac=aa++;z[ac]="(?:"+z[Sa]+"|"+z[jb]+")";var Kc=aa++;z[Kc]="(?:"+z[Ma]+"|"+z[jb]+")";jb=aa++;z[jb]="(?:-("+z[ac]+"(?:\\."+z[ac]+")*))";ac=aa++;z[ac]="(?:-?("+z[Kc]+"(?:\\."+z[Kc]+")*))";var md=aa++;z[md]="[0-9A-Za-z-]+";Kc=aa++;z[Kc]="(?:\\+("+z[md]+
"(?:\\."+z[md]+")*))";var ud=aa++;Jb="v?"+z[Jb]+z[jb]+"?"+z[Kc]+"?";z[ud]="^"+Jb+"$";gc="[v=\\s]*"+z[gc]+z[ac]+"?"+z[Kc]+"?";var oe=aa++;z[oe]="^"+gc+"$";md=aa++;z[md]="((?:<|>)?=?)";var ze=aa++;z[ze]=z[Ma]+"|x|X|\\*";Ma=aa++;z[Ma]=z[Sa]+"|x|X|\\*";Sa=aa++;z[Sa]="[v=\\s]*("+z[Ma]+")(?:\\.("+z[Ma]+")(?:\\.("+z[Ma]+")(?:"+z[jb]+")?"+z[Kc]+"?)?)?";jb=aa++;z[jb]="[v=\\s]*("+z[ze]+")(?:\\.("+z[ze]+")(?:\\.("+z[ze]+")(?:"+z[ac]+")?"+z[Kc]+"?)?)?";var Ue=aa++;z[Ue]="^"+z[md]+"\\s*"+z[Sa]+"$";var Me=aa++;
z[Me]="^"+z[md]+"\\s*"+z[jb]+"$";ac=aa++;z[ac]="(?:~>?)";var xf=aa++;z[xf]="(\\s*)"+z[ac]+"\\s+";hd[xf]=new RegExp(z[xf],"g");var lf=aa++;z[lf]="^"+z[ac]+z[Sa]+"$";var Rf=aa++;z[Rf]="^"+z[ac]+z[jb]+"$";ac=aa++;z[ac]="(?:\\^)";var Hg=aa++;z[Hg]="(\\s*)"+z[ac]+"\\s+";hd[Hg]=new RegExp(z[Hg],"g");var ng=aa++;z[ng]="^"+z[ac]+z[Sa]+"$";var fg=aa++;z[fg]="^"+z[ac]+z[jb]+"$";var gg=aa++;z[gg]="^"+z[md]+"\\s*("+gc+")$|^$";var Wh=aa++;z[Wh]="^"+z[md]+"\\s*("+Jb+")$|^$";var wg=aa++;z[wg]="(\\s*)"+z[md]+"\\s*("+
gc+"|"+z[Sa]+")";hd[wg]=new RegExp(z[wg],"g");var xh=aa++;z[xh]="^\\s*("+z[Sa]+")\\s+-\\s+("+z[Sa]+")\\s*$";var Qi=aa++;z[Qi]="^\\s*("+z[jb]+")\\s+-\\s+("+z[jb]+")\\s*$";var Di=aa++;z[Di]="(<|>)?=?\\s*\\*";for(Sa=0;Sa<aa;Sa++)Yc(Sa,z[Sa]),hd[Sa]||(hd[Sa]=new RegExp(z[Sa]));C.parse=K;C.valid=function(Xd,ff){return(Xd=K(Xd,ff))?Xd.version:null};C.clean=function(Xd,ff){return(Xd=K(Xd.trim().replace(/^[=v]+/,""),ff))?Xd.version:null};C.SemVer=T;T.prototype.format=function(){this.version=this.major+"."+
this.minor+"."+this.patch;this.prerelease.length&&(this.version+="-"+this.prerelease.join("."));return this.version};T.prototype.toString=function(){return this.version};T.prototype.compare=function(Xd){Yc("SemVer.compare",this.version,this.loose,Xd);Xd instanceof T||(Xd=new T(Xd,this.loose));return this.compareMain(Xd)||this.comparePre(Xd)};T.prototype.compareMain=function(Xd){Xd instanceof T||(Xd=new T(Xd,this.loose));return O(this.major,Xd.major)||O(this.minor,Xd.minor)||O(this.patch,Xd.patch)};
T.prototype.comparePre=function(Xd){Xd instanceof T||(Xd=new T(Xd,this.loose));if(this.prerelease.length&&!Xd.prerelease.length)return-1;if(!this.prerelease.length&&Xd.prerelease.length)return 1;if(!this.prerelease.length&&!Xd.prerelease.length)return 0;var ff=0;do{var af=this.prerelease[ff],Gf=Xd.prerelease[ff];Yc("prerelease compare",ff,af,Gf);if(void 0===af&&void 0===Gf)return 0;if(void 0===Gf)return 1;if(void 0===af)return-1;if(af!==Gf)return O(af,Gf)}while(++ff)};T.prototype.inc=function(Xd,
ff){switch(Xd){case "premajor":this.minor=this.patch=this.prerelease.length=0;this.major++;this.inc("pre",ff);break;case "preminor":this.patch=this.prerelease.length=0;this.minor++;this.inc("pre",ff);break;case "prepatch":this.prerelease.length=0;this.inc("patch",ff);this.inc("pre",ff);break;case "prerelease":0===this.prerelease.length&&this.inc("patch",ff);this.inc("pre",ff);break;case "major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++;this.patch=this.minor=0;this.prerelease=
[];break;case "minor":0===this.patch&&0!==this.prerelease.length||this.minor++;this.patch=0;this.prerelease=[];break;case "patch":0===this.prerelease.length&&this.patch++;this.prerelease=[];break;case "pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(Xd=this.prerelease.length;0<=--Xd;)"number"===typeof this.prerelease[Xd]&&(this.prerelease[Xd]++,Xd=-2);-1===Xd&&this.prerelease.push(0)}ff&&(this.prerelease[0]===ff?isNaN(this.prerelease[1])&&(this.prerelease=[ff,0]):this.prerelease=[ff,
0]);break;default:throw Error("invalid increment argument: "+Xd);}this.format();this.raw=this.version;return this};C.inc=function(Xd,ff,af,Gf){"string"===typeof af&&(Gf=af,af=void 0);try{return(new T(Xd,af)).inc(ff,Gf).version}catch(Jh){return null}};C.diff=function(Xd,ff){if(Ub(Xd,ff))return null;Xd=K(Xd);ff=K(ff);if(Xd.prerelease.length||ff.prerelease.length){for(var af in Xd)if(("major"===af||"minor"===af||"patch"===af)&&Xd[af]!==ff[af])return"pre"+af;return"prerelease"}for(af in Xd)if(("major"===
af||"minor"===af||"patch"===af)&&Xd[af]!==ff[af])return af};C.compareIdentifiers=O;var Zi=/^[0-9]+$/;C.rcompareIdentifiers=function(Xd,ff){return O(ff,Xd)};C.major=function(Xd,ff){return(new T(Xd,ff)).major};C.minor=function(Xd,ff){return(new T(Xd,ff)).minor};C.patch=function(Xd,ff){return(new T(Xd,ff)).patch};C.compare=qa;C.compareLoose=function(Xd,ff){return qa(Xd,ff,!0)};C.rcompare=function(Xd,ff,af){return qa(ff,Xd,af)};C.sort=function(Xd,ff){return Xd.sort(function(af,Gf){return C.compare(af,
Gf,ff)})};C.rsort=function(Xd,ff){return Xd.sort(function(af,Gf){return C.rcompare(af,Gf,ff)})};C.gt=Ba;C.lt=ib;C.eq=Ub;C.neq=pc;C.gte=Dc;C.lte=kd;C.cmp=Ad;C.Comparator=Rd;var ni={};Rd.prototype.parse=function(Xd){var ff=Xd.match(this.loose?hd[gg]:hd[Wh]);if(!ff)throw new TypeError("Invalid comparator: "+Xd);this.operator=ff[1];"="===this.operator&&(this.operator="");this.semver=ff[2]?new T(ff[2],this.loose):ni};Rd.prototype.toString=function(){return this.value};Rd.prototype.test=function(Xd){Yc("Comparator.test",
Xd,this.loose);if(this.semver===ni)return!0;"string"===typeof Xd&&(Xd=new T(Xd,this.loose));return Ad(Xd,this.operator,this.semver,this.loose)};C.Range=cf;cf.prototype.format=function(){return this.range=this.set.map(function(Xd){return Xd.join(" ").trim()}).join("||").trim()};cf.prototype.toString=function(){return this.range};cf.prototype.parseRange=function(Xd){var ff=this.loose;Xd=Xd.trim();Yc("range",Xd,ff);Xd=Xd.replace(ff?hd[Qi]:hd[xh],Rg);Yc("hyphen replace",Xd);Xd=Xd.replace(hd[wg],"$1$2$3");
Yc("comparator trim",Xd,hd[wg]);Xd=Xd.replace(hd[xf],"$1~");Xd=Xd.replace(hd[Hg],"$1^");Xd=Xd.split(/\s+/).join(" ");var af=ff?hd[gg]:hd[Wh];Xd=Xd.split(" ").map(function(Gf){Yc("comp",Gf);Gf=mh(Gf,ff);Yc("caret",Gf);Gf=Ge(Gf,ff);Yc("tildes",Gf);Gf=dh(Gf,ff);Yc("xrange",Gf);Yc("replaceStars",Gf,ff);Gf=Gf.trim().replace(hd[Di],"");Yc("stars",Gf);return Gf}).join(" ").split(/\s+/);this.loose&&(Xd=Xd.filter(function(Gf){return!!Gf.match(af)}));return Xd=Xd.map(function(Gf){return new Rd(Gf,ff)})};C.toComparators=
function(Xd,ff){return(new cf(Xd,ff)).set.map(function(af){return af.map(function(Gf){return Gf.value}).join(" ").trim().split(" ")})};cf.prototype.test=function(Xd){if(!Xd)return!1;"string"===typeof Xd&&(Xd=new T(Xd,this.loose));for(var ff=0;ff<this.set.length;ff++)if($c(this.set[ff],Xd))return!0;return!1};C.satisfies=vf;C.maxSatisfying=function(Xd,ff,af){return Xd.filter(function(Gf){return vf(Gf,ff,af)}).sort(function(Gf,Jh){return qa(Jh,Gf,af)})[0]||null};C.minSatisfying=function(Xd,ff,af){return Xd.filter(function(Gf){return vf(Gf,
ff,af)}).sort(function(Gf,Jh){return qa(Gf,Jh,af)})[0]||null};C.validRange=function(Xd,ff){try{return(new cf(Xd,ff)).range||"*"}catch(af){return null}};C.ltr=function(Xd,ff,af){return ye(Xd,ff,"<",af)};C.gtr=function(Xd,ff,af){return ye(Xd,ff,">",af)};C.outside=ye;C.prerelease=function(Xd,ff){return(Xd=K(Xd,ff))&&Xd.prerelease.length?Xd.prerelease:null}})($h.semverModule,$h.semver);var Gi=bd("e",Eh.exports);$h.__moduleExports=Eh.exports;$h.semver=Eh.exports;$h["default"]=Eh.exports;var Ng=window.lively.FreezerRuntime.recorderFor("lively.modules/src/packages/package-registry.js");
Ng.isAbsolute=function(z){return z.startsWith("/")||z.startsWith("http:")||z.startsWith("https:")||z.startsWith("file:")||z.match(Ng.urlStartRe)};Ng.ensureResource=function(z){return z.isResource?z:Ng.resource(z)};Ng.semver=Gi;Ng.arr=se;Ng.obj=sb;Ng.promise=fa;Ng.Package=tc;Ng.resource=Db;Ng.isURL=Rb;Ng.classHolder=Re;Ng.urlStartRe=/^[a-z\.-_\+]+:/i;var Ii=bd("P",function(){function z(C){var K=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};Ed(this,z);this.System=C;this.packageBaseDirs=
K.packageBaseDirs||[];this.devPackageDirs=K.devPackageDirs||[];this.individualPackageDirs=K.individualPackageDirs||[];this._readyPromise=null;this.packageMap={};this._byURL=null}fe(z,null,[{key:"ofSystem",value:function(C){var K=C.get("@lively-env").packageRegistry;K||(K=C["__lively.modules__packageRegistry"]=new this(C));return K}},{key:"forDirectory",value:function(C,K){return new this(C,{packageBaseDirs:[Ng.ensureResource(K)]})}},{key:"fromJSON",value:function(C,K){return(new this(C)).fromJSON(K)}}]);
fe(z,[{key:"resetByURL",value:function(){this._byURL=null}},{key:"allPackageURLs",value:function(){return Object.keys(this.byURL)}},{key:"toJSON",value:function(){function C(kd){kd=kd.url;return kd.startsWith(K.baseURL)?kd.slice(K.baseURL.length).replace(/^\//,""):kd}var K=this.System,T=this.packageMap,O=this.individualPackageDirs,qa=this.devPackageDirs,Ba=this.packageBaseDirs,ib={},Ub;for(Ub in T){var pc=T[Ub];ib[Ub]={};ib[Ub].latest=pc.latest;ib[Ub].versions={};for(var Dc in pc.versions)ib[Ub].versions[Dc]=
pc.versions[Dc].toJSON()}return{packageMap:ib,individualPackageDirs:O.map(C),devPackageDirs:qa.map(C),packageBaseDirs:Ba.map(C)}}},{key:"fromJSON",value:function(C){function K(kd){return Ng.isURL(kd)?Ng.resource(kd):Ng.resource(O.baseURL).join(kd)}var T={},O=this.System,qa=Ng.resource(O.baseURL),Ba;for(Ba in C.packageMap){var ib=C.packageMap[Ba];T[Ba]={};T[Ba].latest=ib.latest;T[Ba].versions={};for(var Ub in ib.versions){var pc=ib.versions[Ub],Dc=pc.url;Ng.isAbsolute(Dc)||(Dc=qa.join(Dc).url);pc=
Ng.Package.fromJSON(O,Object.assign({},pc,{url:Dc}));T[Ba].versions[Ub]=pc}}this.packageMap=T;this.individualPackageDirs=C.individualPackageDirs.map(K);this.devPackageDirs=C.devPackageDirs.map(K);this.packageBaseDirs=C.packageBaseDirs.map(K);this.resetByURL();Ng.classHolder.ModulePackageMapping.forSystem(O).clearCache();return this}},{key:"updateFromJSON",value:function(C){var K=this.packageMap,T;for(T in C.packageMap){var O=C.packageMap[T];K[T]||(K[T]={});K[T].latest?Ng.semver.gt(O.latest,K[T].latest)&&
(K[T].latest=O.latest):K[T].latest;K[T].versions||(K[T].versions={});var qa=this.System,Ba=Ng.resource(qa.baseURL),ib;for(ib in O.versions){var Ub=O.versions[ib],pc=Ub.url;Ng.isAbsolute(pc)||(pc=Ba.join(pc).url);Ub=new Ng.Package.fromJSON(qa,Object.assign({},Ub,{url:pc}));K[T].versions[ib]=Ub}}this.resetByURL();Ng.classHolder.ModulePackageMapping.forSystem(System).clearCache();return this}},{key:"whenReady",value:function(){return this._readyPromise||Promise.resolve()}},{key:"isReady",value:function(){return!this._readyPromise}},
{key:"withPackagesDo",value:function(C){for(var K in this.packageMap){var T=this.packageMap[K].versions,O;for(O in T)C(T[O])}}},{key:"findPackage",value:function(C){for(var K in this.packageMap){var T=this.packageMap[K].versions,O;for(O in T){var qa=T[O];if(C(qa))return qa}}return null}},{key:"filterPackages",value:function(C){var K=[];this.withPackagesDo(function(T){return C(T)&&K.push(T)});return K}},{key:"allPackages",value:function(){var C=[],K;for(K in this.packageMap){var T=this.packageMap[K].versions,
O;for(O in T)C.push(T[O])}return C}},{key:"sortPackagesByVersion",value:function(C){return C.sort(function(K,T){return Ng.semver.compare(T.version,K.version,!0)})}},{key:"matches",value:function(C,K,T){var O=C.version;return C.name!==K?!1:!T||Ng.semver.validRange(O||"",!0)&&Ng.semver.satisfies(O,T,!0)?!0:!1}},{key:"coversDirectory",value:function(C){C=Ng.ensureResource(C).asDirectory();var K=this.packageBaseDirs,T=this.devPackageDirs;if(this.individualPackageDirs.some(function(qa){return qa.equals(C)}))return"individualPackageDirs";
if(T.some(function(qa){return qa.equals(C)}))return"devPackageDirs";var O=C.parent().parent();return K.some(function(qa){return qa.equals(O)})?this.allPackages().find(function(qa){return Ng.ensureResource(qa.url).equals(C)})?"packageCollectionDirs":"maybe packageCollectionDirs":null}},{key:"lookup",value:function(C,K){var T=this,O=this.packageMap[C];if(!O)return null;if(!K||"latest"===K)return O.versions[O.latest];if(!Ng.semver.validRange(K,!0))throw Error("PackageRegistry>>lookup of ".concat(C,": Invalid version - ").concat(K));
O=Ng.obj.values(O.versions).filter(function(qa){return T.matches(qa,C,K)});return 1>=O.length?O[0]:Ng.arr.last(this.sortPackagesByVersion(O))}},{key:"findPackageDependency",value:function(C,K,T){T||(T=C.dependencies[K]||C.devDependencies[K]);Ng.semver.validRange(T,!0)||(T=null);return this.lookup(K,T)}},{key:"findPackageWithURL",value:function(C){C.isResource&&(C=C.url);C.endsWith("/")&&(C=C.slice(0,-1));return this.byURL[C]}},{key:"findPackageHavingURL",value:function(C){C.isResource&&(C=C.url);
C.endsWith("/")&&(C=C.slice(0,-1));var K=Infinity,T=null,O=this.byURL,qa;for(qa in O)if(0===C.indexOf(qa)){var Ba=C.slice(qa.length).length;Ba>=K||(K=Ba,T=O[qa])}return T}},{key:"findPackageForPath",value:function(C,K){if(Ng.isAbsolute(C))return this.findPackageHavingURL(C);if(C.startsWith("."))return null;C=C.split("/");C=ic(C,1)[0];if(!C)return null;var T=C.indexOf("@");if(-1<T){var O=C.slice(T+1);C=C.slice(0,T)}return!O&&K?this.findPackageDependency(K,C):this.lookup(C,O)}},{key:"resolvePath",value:function(C,
K){if(Ng.isAbsolute(C))return C;var T=K&&K.isPackage||null;if(!T&&K){if(C.startsWith("."))return K=Ng.resource(K),K.isDirectory()||(K=K.parent()),K.join(C).withRelativePartsResolved().url;T=this.findPackageHavingURL(K)}K=this.findPackageForPath(C,T);if(!K)return null;T=C.indexOf("/");return(C=-1===T||T===C.length-1?"":C.slice(T))?Ng.resource(K.url).join(C).url:K.url}},{key:"update",value:function(){var C=Gb(regeneratorRuntime.mark(function T(){var O=this,qa,Ba,ib,Ub,pc,Dc,kd,Ad,Rd,cf,Ud,Ge,Se,mh,
Rh,dh,eh,Rg,$c,vf,ye,Yc;return regeneratorRuntime.wrap(function(Tc){for(;;)switch(Tc.prev=Tc.next){case 0:if(this.isReady()){Tc.next=2;break}return Tc.abrupt("return",this.whenReady().then(function(){return O.update()}));case 2:qa=Ng.promise.deferred(),this._readyPromise=qa.promise,this.packageBaseDirs=this.packageBaseDirs.map(function(td){return td.asDirectory()}),this.individualPackageDirs=this.individualPackageDirs.map(function(td){return td.asDirectory()}),this.devPackageDirs=this.devPackageDirs.map(function(td){return td.asDirectory()}),
Ba={},Tc.prev=8,ib=sc(this.packageBaseDirs),Tc.prev=10,ib.s();case 12:if((Ub=ib.n()).done){Tc.next=58;break}pc=Ub.value;Tc.t0=sc;Tc.next=17;return pc.dirList(1);case 17:Tc.t1=Tc.sent,Dc=(0,Tc.t0)(Tc.t1),Tc.prev=19,Dc.s();case 21:if((kd=Dc.n()).done){Tc.next=48;break}Ad=kd.value;Tc.t2=sc;Tc.next=26;return Ad.dirList(1);case 26:Tc.t3=function(td){return td.isDirectory()},Tc.t4=Tc.sent.filter(Tc.t3),Rd=(0,Tc.t2)(Tc.t4),Tc.prev=29,Rd.s();case 31:if((cf=Rd.n()).done){Tc.next=38;break}Ud=cf.value;Tc.next=
35;return this._discoverPackagesIn(Ud,Ba,"packageCollectionDirs");case 35:Ba=Tc.sent;case 36:Tc.next=31;break;case 38:Tc.next=43;break;case 40:Tc.prev=40,Tc.t5=Tc["catch"](29),Rd.e(Tc.t5);case 43:return Tc.prev=43,Rd.f(),Tc.finish(43);case 46:Tc.next=21;break;case 48:Tc.next=53;break;case 50:Tc.prev=50,Tc.t6=Tc["catch"](19),Dc.e(Tc.t6);case 53:return Tc.prev=53,Dc.f(),Tc.finish(53);case 56:Tc.next=12;break;case 58:Tc.next=63;break;case 60:Tc.prev=60,Tc.t7=Tc["catch"](10),ib.e(Tc.t7);case 63:return Tc.prev=
63,ib.f(),Tc.finish(63);case 66:Ge=sc(this.individualPackageDirs),Tc.prev=67,Ge.s();case 69:if((Se=Ge.n()).done){Tc.next=76;break}mh=Se.value;Tc.next=73;return this._discoverPackagesIn(mh,Ba,"individualPackageDirs");case 73:Ba=Tc.sent;case 74:Tc.next=69;break;case 76:Tc.next=81;break;case 78:Tc.prev=78,Tc.t8=Tc["catch"](67),Ge.e(Tc.t8);case 81:return Tc.prev=81,Ge.f(),Tc.finish(81);case 84:Rh=sc(this.devPackageDirs),Tc.prev=85,Rh.s();case 87:if((dh=Rh.n()).done){Tc.next=94;break}eh=dh.value;Tc.next=
91;return this._discoverPackagesIn(eh,Ba,"devPackageDirs");case 91:Ba=Tc.sent;case 92:Tc.next=87;break;case 94:Tc.next=99;break;case 96:Tc.prev=96,Tc.t9=Tc["catch"](85),Rh.e(Tc.t9);case 99:return Tc.prev=99,Rh.f(),Tc.finish(99);case 102:for(Rg in Ba)$c=Ba[Rg],vf=$c.pkg,ye=$c.config,Yc=$c.covered,this.System.debug&&console.log("[PackageRegistry] Adding discovered package ".concat(Rg," (from ").concat(Yc,")")),this._addPackageWithConfig(vf,ye,Rg+"/",Yc);this._updateLatestPackages();qa.resolve();Tc.next=
110;break;case 107:Tc.prev=107,Tc.t10=Tc["catch"](8),qa.reject(Tc.t10);case 110:return Tc.prev=110,this._readyPromise=null,this.resetByURL(),Ng.classHolder.ModulePackageMapping.forSystem(this.System).clearCache(),Tc.finish(110);case 115:return Tc.abrupt("return",this);case 116:case "end":return Tc.stop()}},T,this,[[8,107,110,115],[10,60,63,66],[19,50,53,56],[29,40,43,46],[67,78,81,84],[85,96,99,102]])}));return function(){return C.apply(this,arguments)}}()},{key:"addPackageAt",value:function(){var C=
Gb(regeneratorRuntime.mark(function O(T){var qa,Ba,ib,Ub,pc,Dc,kd,Ad,Rd,cf=arguments;return regeneratorRuntime.wrap(function(Ud){for(;;)switch(Ud.prev=Ud.next){case 0:qa=1<cf.length&&void 0!==cf[1]?cf[1]:"individualPackageDirs";Ba=2<cf.length?cf[2]:void 0;ib=T.isResource?T.url:T;ib.endsWith("/")&&ib.slice(0,-1);if(!this.byURL[ib]){Ud.next=6;break}throw Error("package in ".concat(ib," already added to registry"));case 6:return Ud.next=8,this._discoverPackagesIn(Ng.ensureResource(T).asDirectory(),{},
void 0,Ba);case 8:Ub=Ud.sent,Ud.t0=regeneratorRuntime.keys(Ub);case 10:if((Ud.t1=Ud.t0()).done){Ud.next=19;break}pc=Ud.t1.value;if(!this.byURL[pc]){Ud.next=14;break}return Ud.abrupt("continue",10);case 14:Dc=Ub[pc];kd=Dc.pkg;Ad=Dc.config;Rd=this._addPackageDir(pc,qa,!0);this._addPackageWithConfig(kd,Ad,pc+"/",Rd);Ud.next=10;break;case 19:return this.resetByURL(),Ng.classHolder.ModulePackageMapping.forSystem(this.System).clearCache(),this._updateLatestPackages(),Ud.abrupt("return",this.findPackageWithURL(T));
case 23:case "end":return Ud.stop()}},O,this)}));return function(T){return C.apply(this,arguments)}}()},{key:"removePackage",value:function(C){var K=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!0,T=C.name,O=C.version,qa=Ng.ensureResource(C.url),Ba=this.coversDirectory(qa);"devPackageDirs"===Ba?this.devPackageDirs=this.devPackageDirs.filter(function(ib){return!ib.equals(qa)}):"individualPackageDirs"===Ba&&(this.individualPackageDirs=this.individualPackageDirs.filter(function(ib){return!ib.equals(qa)}));
Ba=this.packageMap;Ba[T]&&(delete Ba[T].versions[O],0===Object.keys(Ba[T].versions).length&&delete Ba[T]);this.resetByURL();Ng.classHolder.ModulePackageMapping.forSystem(this.System).clearCache();K&&this._updateLatestPackages(C.name)}},{key:"updateNameAndVersionOf",value:function(C,K,T,O,qa){var Ba=this.packageMap;Ba[K]?Ba[K].versions[T]||console.warn("[PackageRegistry>>updateNameAndVersionOf] No version entry ".concat(T," of ").concat(K," found in registry (").concat(C.url,")")):console.warn("[PackageRegistry>>updateNameAndVersionOf] ".concat(K,
"@").concat(T," not found in registry (").concat(C.url,")"));this._addToPackageMap(C,O,qa);Ba[K]&&Ba[K].versions[T]&&(delete Ba[K].versions[T],0===Object.keys(Ba[K].versions).length&&delete Ba[K]);this._updateLatestPackages(C.name)}},{key:"_updateLatestPackages",value:function(C){var K=this.packageMap;if(C&&K[C])K[C].latest=Ng.arr.last(Ng.semver.sort(Object.keys(K[C].versions),!0));else for(var T in K)K[T].latest=Ng.arr.last(Ng.semver.sort(Object.keys(K[T].versions),!0))}},{key:"_discoverPackagesIn",
value:function(){var C=Gb(regeneratorRuntime.mark(function Ba(T,O,qa){var ib,Ub,pc,Dc,kd,Ad,Rd=arguments;return regeneratorRuntime.wrap(function(cf){for(;;)switch(cf.prev=cf.next){case 0:ib=3<Rd.length&&void 0!==Rd[3]?Rd[3]:null;if(T.isDirectory()){cf.next=3;break}return cf.abrupt("return",O);case 3:Ub=T.asFile().url;if(!O.hasOwnProperty(Ub)){cf.next=6;break}return cf.abrupt("return",O);case 6:return cf.prev=6,pc=ib&&ib[Ub]||new Ng.Package(this.System,Ub),cf.next=10,pc.tryToLoadPackageConfig();case 10:return Dc=
cf.sent,pc.setConfig(Dc),O[Ub]={pkg:pc,config:Dc,covered:qa},this.System.debug&&(kd=Dc.name,Ad=Dc.version,console.log("[lively.modules] package ".concat(kd,"@").concat(Ad," discovered in ").concat(T.url))),cf.abrupt("return",O);case 17:return cf.prev=17,cf.t0=cf["catch"](6),cf.abrupt("return",O);case 20:case "end":return cf.stop()}},Ba,this,[[6,17]])}));return function(T,O,qa){return C.apply(this,arguments)}}()},{key:"_addToPackageMap",value:function(C,K,T){var O=3<arguments.length&&void 0!==arguments[3]?
arguments[3]:!0;if(!K)throw Error("Cannot add package without name");T||(T="0.0.0");var qa=this.packageMap;qa=qa[K]||(qa[K]={versions:{},latest:null});if(qa.versions[T]){var Ba="Redefining version ".concat(T," of package ").concat(C.url);if(O)console.warn(Ba);else throw Error(Ba+" not allowed");}qa.versions[T]=C}},{key:"_addPackageWithConfig",value:function(C,K,T){3<arguments.length&&void 0!==arguments[3]&&arguments[3]||this._addPackageDir(T,"individualPackageDirs",!0);C.registerWithConfig(K);this._addToPackageMap(C,
C.name,C.version);return C}},{key:"_addPackageDir",value:function(C){var K=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"individualPackageDirs",T=2<arguments.length&&void 0!==arguments[2]?arguments[2]:!0;C=Ng.ensureResource(C).asDirectory();if(("packageCollectionDirs"===K||"maybe packageCollectionDirs"===K)&&(this.coversDirectory(C)||"").includes("packageCollectionDirs"))return"packageCollectionDirs";var O=this[K].concat(C);this[K]=T?Ng.arr.uniqBy(O,function(qa,Ba){return qa.equals(Ba)}):
O;return K}},{key:"byURL",get:function(){if(!this._byURL){this._byURL={};var C=sc(this.allPackages()),K;try{for(C.s();!(K=C.n()).done;){var T=K.value;this._byURL[T.url]=T}}catch(O){C.e(O)}finally{C.f()}}return this._byURL}}]);return z}());Ng.PackageRegistry=Ii;var fi=window.lively.FreezerRuntime.recorderFor("lively.modules/src/export-lookup.js");fi.commonjsHelpers=db;fi.obj=sb;fi.subscribe=kc;fi.unsubscribe=Fa;fi.module=Cc;var Ji=bd("E",function(){function z(C){Ed(this,z);this.System=C;this.subscribeToSystemChanges()}
fe(z,null,[{key:"forSystem",value:function(C){this._forSystemMap||(this._forSystemMap=new WeakMap);var K=this._forSystemMap.get(C);if(K)return K;K=new this(C);this._forSystemMap.set(C,K);return K}},{key:"run",value:function(){var C=1<arguments.length?arguments[1]:void 0;return this.forSystem(0<arguments.length&&void 0!==arguments[0]?arguments[0]:System).systemExports(C)}},{key:"findExportOfValue",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa,Ba,ib=arguments;return regeneratorRuntime.wrap(function(Ub){for(;;)switch(Ub.prev=
Ub.next){case 0:return qa=1<ib.length&&void 0!==ib[1]?ib[1]:System,Ub.next=3,this.run(qa);case 3:return Ba=Ub.sent,Ub.abrupt("return",Ba.find(function(pc){var Dc=pc.local;pc=fi.module(qa,pc.moduleId);pc=pc.recorder||qa.get(pc.id)||{};try{return pc[Dc]===T}catch(kd){return!1}}));case 5:case "end":return Ub.stop()}},O,this)}));return function(T){return C.apply(this,arguments)}}()}]);fe(z,[{key:"subscribeToSystemChanges",value:function(){var C=this;if(!this._notificationHandlers){var K=this.System;this._notificationHandlers=
[fi.subscribe("lively.modules/moduleloaded",function(T){return C.clearCacheFor(T.module)},K),fi.subscribe("lively.modules/modulechanged",function(T){return C.clearCacheFor(T.module)},K),fi.subscribe("lively.vm/doitresult",function(T){return C.clearCacheFor(T.targetModule)},K)]}}},{key:"unsubscribeFromSystemChanges",value:function(){if(this._notificationHandlers){var C=this.System;fi.unsubscribe("lively.modules/moduleloaded",this._notificationHandlers[0],C);fi.unsubscribe("lively.modules/modulechanged",
this._notificationHandlers[1],C);fi.unsubscribe("lively.vm/doitresult",this._notificationHandlers[2],C);this._notificationHandlers=null}}},{key:"clearCacheFor",value:function(C){this.exportByModuleCache[C]=null}},{key:"systemExports",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa=this,Ba;return regeneratorRuntime.wrap(function(ib){for(;;)switch(ib.prev=ib.next){case 0:return ib.next=2,this.rawExportsByModule(T);case 2:return Ba=ib.sent,Object.keys(Ba).forEach(function(Ub){return qa.resolveExportsOfModule(Ub,
Ba)}),ib.abrupt("return",Object.keys(Ba).flatMap(function(Ub){return Ba[Ub]?Ba[Ub].resolvedExports||Ba[Ub].rawExports:[]}));case 5:case "end":return ib.stop()}},O,this)}));return function(T){return C.apply(this,arguments)}}()},{key:"rawExportsByModule",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa=this,Ba,ib,Ub,pc,Dc;return regeneratorRuntime.wrap(function(kd){for(;;)switch(kd.prev=kd.next){case 0:return T=T||{},Ba=this.System,ib=Ba.get("@lively-env")||{},Ub=Object.keys(ib.loadedModules||
{}),pc={},Dc=function(Ad){1>Ad%50&&T.progress.step&&T.progress.step("Scanning ...",Ad/Ub.length)},kd.next=8,Promise.all(Ub.map(function(Ad,Rd){T.progress&&Dc(Rd);return qa.rawExportsOfModule(Ad,T,pc).then(function(cf){return cf?pc[Ad]=cf:null})}));case 8:return kd.abrupt("return",pc);case 9:case "end":return kd.stop()}},O,this)}));return function(T){return C.apply(this,arguments)}}()},{key:"rawExportsOfModule",value:function(){var C=Gb(regeneratorRuntime.mark(function O(T){var qa,Ba,ib,Ub,pc,Dc,kd,
Ad,Rd,cf,Ud,Ge,Se,mh,Rh,dh,eh,Rg,$c,vf=arguments;return regeneratorRuntime.wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:qa=1<vf.length&&void 0!==vf[1]?vf[1]:{};Ba=this.System;ib=this.exportByModuleCache;Ub=qa.excludedPackages||[];pc=qa.excludedURLs||(qa.excludedURLs=Ub.filter(function(Yc){return"string"===typeof Yc}));Dc=qa.excludeFns||(qa.excludeFns=Ub.filter(function(Yc){return"function"===typeof Yc}));kd=qa.excludedPackageURLs||(qa.excludedPackageURLs=pc.concat(pc.map(function(Yc){return Ba.decanonicalize(Yc.replace(/\/?$/,
"/")).replace(/\/$/,"")})));if(!ib[T]){ye.next=9;break}Ad=ib[T].rawExports;return ye.abrupt("return",kd.includes(Ad.packageURL)||Dc.some(function(Yc){return Yc(Ad.packageURL)})?null:ib[T]);case 9:Rd=fi.module(Ba,T);cf=Rd.pathInPackage();Ge=(Ud=Rd["package"]())&&Ud.main&&cf===Ud.main;Se=Ud?Ud.url:"";mh=Ud?Ud.name:"";Rh=Ud?Ud.version:"";dh={moduleId:T,isMain:Ge,pathInPackage:cf,packageName:mh,packageURL:Se,packageVersion:Rh,exports:[]};if(!kd.includes(Se)&&!Dc.some(function(Yc){return Yc(Se)})){ye.next=
19;break}return ye.abrupt("return",null);case 19:ye.prev=19;eh=Rd.format();if(!["register","es6","esm"].includes(eh)){ye.next=27;break}ye.next=24;return Rd.exports();case 24:dh.exports=ye.sent;ye.next=39;break;case 27:return ye.next=29,Rd.load();case 29:Rg=ye.sent,dh.exports=[],ye.t0=regeneratorRuntime.keys(Rg);case 32:if((ye.t1=ye.t0()).done){ye.next=39;break}$c=ye.t1.value;if("__useDefault"!==$c&&"default"!==$c){ye.next=36;break}return ye.abrupt("continue",32);case 36:dh.exports.push({exported:$c,
local:$c,type:"id"});ye.next=32;break;case 39:ye.next=44;break;case 41:ye.prev=41,ye.t2=ye["catch"](19),dh.error=ye.t2;case 44:return ye.abrupt("return",ib[T]={rawExports:dh});case 45:case "end":return ye.stop()}},O,this,[[19,41]])}));return function(T){return C.apply(this,arguments)}}()},{key:"resolveExportsOfModule",value:function(C,K){var T=this,O=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(!O[C]){O[C]=!0;var qa=K[C];if(qa&&!qa.resolvedExports){var Ba=this.System,ib=fi.obj.select(qa.rawExports,
"moduleId isMain packageName packageURL packageVersion pathInPackage".split(" "));qa.resolvedExports=qa.rawExports.exports.flatMap(function(Ub){var pc=Ub.type,Dc=Ub.exported,kd=Ub.local,Ad=Ub.fromModule;if("all"!==pc)return[Object.assign({},ib,{type:pc,exported:Dc,local:kd,fromModule:Ad})];Ub=Ba.decanonicalize(Ad,C);T.resolveExportsOfModule(Ub,K,O);return(K[Ub]&&K[Ub].resolvedExports||[]).map(function(Rd){return Object.assign({},ib,{type:Rd.type,exported:Rd.exported,local:Rd.local,fromModule:Rd.fromModule||
Ad})})});O[C]=!1}}}},{key:"exportByModuleCache",get:function(){return this._exportByModuleCache||(this._exportByModuleCache={})}}]);return z}());fi.ExportLookup=Ji;fi["default"]=Ji;var gi=window.lively.FreezerRuntime.recorderFor("lively.modules/cjs/dependencies.js");gi.buildPackageMap=Be;gi.resolvePackageDependencies=Yb;gi.dependencyGraph=de;gi.obj=sb;gi.resource=Db;gi.buildPackageMap=Be;gi.resolvePackageDependencies=Yb;gi.dependencyGraph=de;var xj=Object.freeze({__proto__:null,buildPackageMap:Be,
resolvePackageDependencies:Yb,dependencyGraph:de}),yg=window.lively.FreezerRuntime.recorderFor("lively.modules/src/packages/module-package-mapping.js");yg.arr=se;yg.unsubscribe=Fa;yg.subscribe=kc;yg.knownModuleNames=Ta;yg.classHolder=Re;var Ti=function(){function z(C){Ed(this,z);this.System=C;this._notificationHandlers=null;this.clearCache();this.subscribeToSystemChanges()}fe(z,null,[{key:"forSystem",value:function(C){var K=C["__lively.modules__modulePackageMapCache"];if(K)return K;K=new this(C);
return C["__lively.modules__modulePackageMapCache"]=K}}]);fe(z,[{key:"subscribeToSystemChanges",value:function(){var C=this;if(!this._notificationHandlers){var K=this.System;this._notificationHandlers=[yg.subscribe("lively.modules/moduleloaded",function(T){return C.addModuleIdToCache(T.module)},K),yg.subscribe("lively.modules/moduleunloaded",function(T){return C.removeModuleFromCache(T.module)},K),yg.subscribe("lively.modules/packageregistered",function(T){return C.clearCache()},K),yg.subscribe("lively.modules/packageremoved",
function(T){return C.clearCache()},K)]}}},{key:"unsubscribeFromSystemChanges",value:function(){if(this._notificationHandlers){var C=this.System;yg.unsubscribe("lively.modules/moduleloaded",this._notificationHandlers[0],C);yg.unsubscribe("lively.modules/moduleunloaded",this._notificationHandlers[1],C);yg.unsubscribe("lively.modules/packageregistered",this._notificationHandlers[2],C);yg.unsubscribe("lively.modules/packageremoved",this._notificationHandlers[3],C);this._notificationHandlers=null}}},{key:"clearCache",
value:function(){this._cacheInitialized=!1;this.packageToModule={};this.modulesToPackage={};this.modulesWithoutPackage={}}},{key:"ensureCache",value:function(){var C=this.System,K=this.packageToModule,T=this.modulesToPackage,O=this.modulesWithoutPackage;if(this._cacheInitialized)return this;for(var qa=yg.classHolder.Package.allPackageURLs(C),Ba=0;Ba<qa.length;Ba++)K[qa[Ba]]=[];C=yg.knownModuleNames(C);for(Ba=0;Ba<C.length;Ba++){for(var ib=C[Ba],Ub=void 0,pc=0;pc<qa.length;pc++){var Dc=qa[pc];ib.startsWith(Dc)&&
(!Ub||Ub.length<Dc.length)&&(Ub=Dc)}Ub?(K[Ub].push(ib),T[ib]=Ub):O[ib]={}}this._cacheInitialized=!0;return this}},{key:"addModuleIdToCache",value:function(C){this.ensureCache();var K=this.packageToModule,T=this.modulesToPackage,O=this.modulesWithoutPackage;if(T[C])return T[C];if(O[C])return null;for(var qa=Object.keys(K),Ba,ib=0;ib<qa.length;ib++){var Ub=qa[ib];C.startsWith(Ub)&&(!Ba||Ba.length<Ub.length)&&(Ba=Ub)}if(Ba)return(K[Ba]||(K[Ba]=[])).push(C),T[C]=Ba;O[C]={};return null}},{key:"removeModuleFromCache",
value:function(C){if(this._cacheInitialized){var K=this.packageToModule,T=this.modulesToPackage,O=this.modulesWithoutPackage;if(O.hasOwnProperty(C))delete O[C];else if(O=T[C])delete T[C],K[O]&&yg.arr.remove(K[O],C)}}},{key:"getPackageURLForModuleId",value:function(C){return this.modulesToPackage[C]||this.addModuleIdToCache(C)}},{key:"getModuleIdsForPackageURL",value:function(C){this.ensureCache();return this.packageToModule[C]||[]}}]);return z}();yg.ModulePackageMapping=Ti;yg["default"]=Ti;var ke=
window.lively.FreezerRuntime.recorderFor("lively.modules/index.js");ke.changeSystem=P;ke.wrapModuleResolution=pa;ke.unwrapModuleResolution=wa;ke.loadedModules=Ea;ke.module=ia;ke.isModuleLoaded=Ca;ke.doesModuleExist=w;ke.printSystemConfig=ma;ke.whenLoaded=ua;ke.importPackage=ha;ke.registerPackage=ra;ke.removePackage=mb;ke.reloadPackage=E;ke.getPackages=R;ke.getPackage=Ya;ke.getPackageOfModule=gb;ke.ensurePackage=$b;ke.applyPackageConfig=Sc;ke.lookupPackage=Ic;ke.moduleSourceChange=Pd;ke.requireMap=
Zd;ke.isHookInstalled=ge;ke.installHook=Ce;ke.removeHook=$e;ke.wrapModuleLoad=pf;ke.unwrapModuleLoad=ig;ke.getSystem=Mb;ke.removeSystem=gd;ke.prepareSystem=Vd;ke._printSystemConfig=he;ke._unwrapModuleResolution=wf;ke._wrapModuleResolution=mg;ke._whenLoaded=Uf;ke._module=Cc;ke._doesModuleExist=Fc;ke._isModuleLoaded=zc;ke.GLOBAL="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:void 0;ke.defaultSystem=ke.defaultSystem||ke.prepareSystem(ke.GLOBAL.System);
var Mg=ke.defaultSystem;ke.System=Mg;ke.defaultSystem=Mg;ke.getSystem=Mb;ke.removeSystem=gd;ke.loadedModules=Ea;ke.printSystemConfig=ma;ke.whenLoaded=ua;ke.changeSystem=P;ke.module=ia;ke.doesModuleExist=w;ke.isModuleLoaded=Ca;ke.unwrapModuleResolution=wa;ke.wrapModuleResolution=pa;ke.Package=tc;ke._getPackage=xc;ke._ensurePackage=tb;ke.getPackageSpecs=vc;ke._applyPackageConfig=Pc;ke._importPackage=nd;ke._removePackage=Id;ke._reloadPackage=Hb;ke._registerPackage=Kd;ke._lookupPackage=Pb;ke.importPackage=
ha;ke.registerPackage=ra;ke.removePackage=mb;ke.reloadPackage=E;ke.getPackages=R;ke.getPackage=Ya;ke.getPackageOfModule=gb;ke.ensurePackage=$b;ke.applyPackageConfig=Sc;ke.lookupPackage=Ic;ke.PackageRegistry=Ii;ke.PackageRegistry=Ii;ke._moduleSourceChange=Fb;ke.moduleSourceChange=Pd;ke.computeRequireMap=hb;ke.requireMap=Zd;ke._isHookInstalled=wb;ke._installHook=M;ke._removeHook=Aa;ke.isHookInstalled=ge;ke.installHook=Ce;ke.removeHook=$e;ke._wrapModuleLoad=Zc;ke._unwrapModuleLoad=rd;ke.wrapModuleLoad=
pf;ke.unwrapModuleLoad=ig;ke["default"]=Ji;ke.ExportLookup=Ji;ke.cjs=xj;ke.cjs=xj;ke["default"]=Gi;ke.semver=Gi;ke.ImportInjector=Cd;ke.scripting=ke.defaultSystem._scripting={module:ke._module,ensurePackage:ke._ensurePackage,registerPackage:ke._registerPackage,importPackage:ke._importPackage,lookupPackage:ke._lookupPackage,ImportInjector:ke.ImportInjector};ke.defaultClassToFunctionConverterName=Vb;ke.classRuntime=lc;ke.defaultSystem.global[ke.defaultClassToFunctionConverterName]=ke.classRuntime.initializeClass;
ke.classHolder=Re;ke.ModulePackageMapping=Ti;ke.classHolder.ModulePackageMapping=ke.ModulePackageMapping;ke.classHolder.Package=ke.Package;ke.classHolder.PackageRegistry=ke.PackageRegistry;var Hh=bd("s",ke.scripting);ke.scripting=Hh;var Zf=Object.freeze({__proto__:null,System:Mg,getSystem:Mb,removeSystem:gd,loadedModules:Ea,printSystemConfig:ma,whenLoaded:ua,changeSystem:P,module:ia,doesModuleExist:w,isModuleLoaded:Ca,unwrapModuleResolution:wa,wrapModuleResolution:pa,importPackage:ha,registerPackage:ra,
removePackage:mb,reloadPackage:E,getPackages:R,getPackage:Ya,getPackageOfModule:gb,ensurePackage:$b,applyPackageConfig:Sc,lookupPackage:Ic,PackageRegistry:Ii,moduleSourceChange:Pd,requireMap:Zd,isHookInstalled:ge,installHook:Ce,removeHook:$e,wrapModuleLoad:pf,unwrapModuleLoad:ig,ExportLookup:Ji,cjs:xj,semver:Gi,scripting:Hh});bd("a",Zf)}}});