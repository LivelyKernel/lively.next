System.register("./__rootModule___commonjs-entry-51a55f66.js ./ui.cp-8dfc076f.js ./editor-modes-aae4d878.js ./index-61952933.js @babel/plugin-syntax-import-meta ./loading-indicator.cp-98e470a2.js ./index-42118cd5.js ./interface-1a7f3c67.js ./index-616023be.js ./popups.cp-5b9fb681.js ./list.cp-840d1cf8.js ./tooltips.cp-3c41b378.js".split(" "),function(bd,Dd){var se,Rc,ad,Ne,Cb,Sd,ve,uc,dd,vd,Ed,fe,jc,Od,qb,ic,Wb,lc,db,Xa,Gb,sc,ub,sb,fa,Db,ab,eb,kc,Vb,pb,Nb;return{setters:[function(zb){se=zb.b;Rc=zb.r;
ad=zb.C;Ne=zb.ad;Cb=zb.S;Sd=zb.c;ve=zb.a9;uc=zb.p;dd=zb.d;vd=zb.s;Ed=zb.t;fe=zb.br;jc=zb.i;Od=zb.N;qb=zb._;ic=zb.K;Wb=zb.aq;lc=zb.bs;db=zb.M;Xa=zb.o;Gb=zb.Y;sc=zb.m;ub=zb.l;sb=zb.aF},function(zb){fa=zb.I;Db=zb.D},function(zb){ab=zb.tokenizeDocument;eb=zb.modeInfo;kc=zb.visitDocumentTokens;Vb=zb.getMode},function(zb){pb=zb.F;Nb=zb.b},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function(){function zb(la){var Fb=1<arguments.length&&
void 0!==arguments[1]?arguments[1]:"",vb=2<arguments.length?arguments[2]:void 0,Ia=Fb&&dc.arr.last(Fb.split(".")).toLowerCase(),xb="",Rb=0,yc=Math.pow(2,19);if("string"===typeof la){if(la.length>yc)return null}else if(la.document.stringSize>yc)return null;if("string"===typeof la)xb=la.slice(0,1E3);else{yc=Od(la.document.lines);var id;try{for(yc.s();!(id=yc.n()).done;){var ob=id.value,Pb=ob.stringSize,tb=ob.text,xc=!0;1E3<Rb+Pb&&(xc=!1,Pb=1E3-Rb);xb+=tb.slice(0,Pb)+(xc?"\n":"");Rb+=Pb;if(1E3<=Rb)break}}catch(Cc){yc.e(Cc)}finally{yc.f()}}Rb=
Od(dc.modeInfo);var Pc;try{for(Rb.s();!(Pc=Rb.n()).done;){var nd=Pc.value,Id=nd.contentTest,Hb=nd.mode,Kd=nd.ext,vc=nd.file;if("function"===typeof Id)try{if(Id(xb))return Hb}catch(Cc){}if(vc&&vc instanceof RegExp&&vc.test(Fb))return Hb;if(Kd){var Qc=Od(Kd),kb;try{for(Qc.s();!(kb=Qc.n()).done;)if(kb.value===Ia)return Hb}catch(Cc){Qc.e(Cc)}finally{Qc.f()}}}}catch(Cc){Rb.e(Cc)}finally{Rb.f()}return vb}bd("guessTextModeName",zb);var rb=window.lively.FreezerRuntime.recorderFor("lively.ide/text/completion.cp.js");
rb.FilterableList=pb;rb.List=Nb;rb.pt=se;rb.rect=Rc;rb.Color=ad;rb.InputLine=Ne;rb.ShadowObject=Cb;rb.component=Sd;rb.AutocompleteList=rb.component["for"](function(){return rb.component({type:rb.FilterableList,borderWidth:0,name:"autocomplete list",extent:rb.pt(400,360),renderOnGPU:!0,selectedAction:"default",submorphs:[{type:rb.InputLine,name:"input",extent:rb.pt(22,22),fill:rb.Color.rgba(255,255,255,0),fixedHeight:!1,fixedWidth:!0,fontFamily:'"IBM Plex Mono"',padding:rb.rect(0,3,0,-1),placeholder:null},
{name:"padding",extent:rb.pt(10,0),fill:rb.Color.rgba(0,0,0,0),position:rb.pt(0,21)},{type:rb.List,name:"list",borderColor:rb.Color.rgb(149,165,166),borderRadius:3,clipMode:"auto",dropShadow:new rb.ShadowObject({distance:15,color:rb.Color.rgba(0,0,0,.35),blur:52}),extent:rb.pt(400,339),fill:rb.Color.rgba(255,255,255,.9),fontFamily:"IBM Plex Mono",itemHeight:18,itemPadding:rb.rect(3,2,7,-1),manualItemHeight:!0,padding:rb.rect(0,0,0,0),position:rb.pt(0,21)}]})},{module:"lively.ide/text/completion.cp.js",
"export":"AutocompleteList",range:{start:219,end:1251}},rb.AutocompleteList);var Ib=rb.AutocompleteList;rb.AutocompleteList=Ib;var da=window.lively.FreezerRuntime.recorderFor("lively.ide/text/completion.js");da.Color=ad;da.Rectangle=ve;da.pt=se;da.part=uc;da.connect=dd;da.arr=vd;da.string=Ed;da.FilterableList=pb;da.Range=fe;da.AutocompleteList=Ib;Ib=function(la){var Fb=window.lively.FreezerRuntime.recorderFor("lively.ide/text/completion.js"),vb=Fb.hasOwnProperty("Completer")&&"function"===typeof Fb.Completer?
Fb.Completer:Fb.Completer=function(Ia){if(!Ia||!Ia[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments)};return jc(vb,la,[{key:"compute",value:function(){return[]}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"Completer"}}],Fb,{pathInPackage:function(){return"./text/completion.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},
"package":function(){return{name:"lively.ide",version:"0.1.0"}}},{start:374,end:427})}(void 0);da.Completer=Ib;da.Completer=Ib;Ib=function(la){var Fb=window.lively.FreezerRuntime.recorderFor("lively.ide/text/completion.js"),vb=Fb.hasOwnProperty("WordCompleter")&&"function"===typeof Fb.WordCompleter?Fb.WordCompleter:Fb.WordCompleter=function(Ia){if(!Ia||!Ia[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments)};return jc(vb,la,[{key:"compute",
value:function(Ia,xb){var Rb=[],yc=[],id=Ia.document.lineStrings;Ia=Ia.cursorPosition.row;for(var ob=Ia-1;0<=ob;ob--){var Pb=Od(id[ob].split(/[^0-9a-z@_]+/i)),tb;try{for(Pb.s();!(tb=Pb.n()).done;){var xc=tb.value;xc&&!Rb.includes(xc)&&xc!==xb&&(Rb.push(xc),yc.push({priority:1E3-(Ia-ob),completion:xc}))}}catch(Id){Pb.e(Id)}finally{Pb.f()}}for(tb=Ia+1;tb<id.length;tb++){xc=Od(id[tb].split(/[^0-9a-z_@]+/i));var Pc;try{for(xc.s();!(Pc=xc.n()).done;){var nd=Pc.value;nd&&!Rb.includes(nd)&&nd!==xb&&(Rb.push(nd),
yc.push({priority:1E3-(tb-Ia),completion:nd}))}}catch(Id){xc.e(Id)}finally{xc.f()}}return yc}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"WordCompleter"}}],Fb,{pathInPackage:function(){return"./text/completion.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.ide",version:"0.1.0"}}},{start:435,end:1364})}(void 0);da.WordCompleter=Ib;da.WordCompleter=
Ib;Ib=[new da.WordCompleter];da.defaultCompleters=Ib;da.defaultCompleters=Ib;Ib=function(la){var Fb=window.lively.FreezerRuntime.recorderFor("lively.ide/text/completion.js"),vb=Fb.hasOwnProperty("CompletionController")&&"function"===typeof Fb.CompletionController?Fb.CompletionController:Fb.CompletionController=function(Ia){if(!Ia||!Ia[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments)};return jc(vb,la,[{key:Symbol["for"]("lively-instance-initialize"),
value:function(Ia){var xb=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];this.textMorph=Ia;this.completers=xb=Ia.pluginCollect("getCompleters",xb)}},{key:"computeCompletions",value:function(){var Ia=qb(regeneratorRuntime.mark(function yc(Rb){var id,ob,Pb,tb,xc,Pc,nd,Id,Hb,Kd,vc,Qc,kb;return regeneratorRuntime.wrap(function(Cc){for(;;)switch(Cc.prev=Cc.next){case 0:id=[],ob=Od(this.completers),Cc.prev=2,ob.s();case 4:if((Pb=ob.n()).done){Cc.next=19;break}tb=Pb.value;Cc.prev=6;Cc.t0=id;Cc.next=
10;return tb.compute(this.textMorph,Rb);case 10:Cc.t1=Cc.sent;id=Cc.t0.concat.call(Cc.t0,Cc.t1);Cc.next=17;break;case 14:Cc.prev=14,Cc.t2=Cc["catch"](6),console.warn("Error in completer ".concat(tb,": ").concat(Cc.t2.stack||Cc.t2));case 17:Cc.next=4;break;case 19:Cc.next=24;break;case 21:Cc.prev=21,Cc.t3=Cc["catch"](2),ob.e(Cc.t3);case 24:return Cc.prev=24,ob.f(),Cc.finish(24);case 27:xc=new Map;id.forEach(function(zc){var Fc=xc.get(zc.completion);Fc||(Fc=[],xc.set(zc.completion,Fc));Fc.push(zc)});
Pc=[];nd=Od(xc.values());try{for(nd.s();!(Id=nd.n()).done;)Hb=Id.value,Pc.push(da.arr.last(da.arr.sortByKey(Hb,"priority")))}catch(zc){nd.e(zc)}finally{nd.f()}Kd=0;vc=da.arr.sortByKey(Pc,"priority").reverse();Qc=vc.length&&vc[0].priority||0;kb=vc.map(function(zc){zc.highestPriority=Qc;var Fc=zc.completion.replace(/\n/g,""),xd=String((zc.info||"").replace(/\n/g,""));Kd=Math.max(Kd,Fc.length+xd.length);return{isListItem:!0,string:Fc,annotation:xd,value:zc}});return Cc.abrupt("return",{items:kb,maxCol:Kd});
case 37:case "end":return Cc.stop()}},yc,this,[[2,21,24,27],[6,14]])}));return function(Rb){return Ia.apply(this,arguments)}}()},{key:"computeSortedCompletions",value:function(){var Ia=qb(regeneratorRuntime.mark(function yc(Rb){var id=this,ob,Pb,tb,xc,Pc=arguments;return regeneratorRuntime.wrap(function(nd){for(;;)switch(nd.prev=nd.next){case 0:return ob=1<Pc.length&&void 0!==Pc[1]?Pc[1]:!1,Pb={tokens:[Rb],lowercasedTokens:[Rb],input:Rb},nd.next=4,this.computeCompletions(Rb);case 4:return tb=nd.sent,
xc=da.arr.sortBy(tb.items.filter(function(Id){return id.filterFunction(Pb,Id,ob)}),function(Id){return id.sortFunction(Pb,Id)}),nd.abrupt("return",xc);case 7:case "end":return nd.stop()}},yc,this)}));return function(Rb){return Ia.apply(this,arguments)}}()},{key:"_printCompletions",value:function(){var Ia=qb(regeneratorRuntime.mark(function yc(Rb){var id;return regeneratorRuntime.wrap(function(ob){for(;;)switch(ob.prev=ob.next){case 0:return ob.next=2,this.computeSortedCompletions(Rb);case 2:return ob.t0=
function(Pb){return{completion:Pb.value.completion,priority:Pb.value.priority,maxP:Pb.value.highestPriority,sortVal:Pb._cache[Rb].sortVal,lev:JSON.stringify(Pb._cache[Rb].levenshtein)}},id=ob.sent.map(ob.t0),ob.abrupt("return",da.string.printTable(lively.lang.grid.tableFromObjects(id)));case 5:case "end":return ob.stop()}},yc,this)}));return function(Rb){return Ia.apply(this,arguments)}}()},{key:"prefix",value:function(){var Ia=this.textMorph,xb=Ia.selection;return(xb.isEmpty()?Ia.getLine(xb.lead.row).slice(0,
xb.lead.column):xb.text).match(/[a-z0-9@_]*$/i)[0]}},{key:"filterFunction",value:function(Ia,xb){var Rb=2<arguments.length&&void 0!==arguments[2]?arguments[2]:!1;xb._cache||(xb._cache={});var yc=Ia.tokens,id=Ia.lowercasedTokens,ob=Ia.input;ob=xb._cache[ob]||(xb._cache[ob]={});if(ob.hasOwnProperty("filtered"))return ob.filtered;var Pb=xb.value.completion.replace(/\([^\)]*\)$/,""),tb=Pb.toLowerCase();if(Rb&&yc[0]&&!Pb.startsWith(yc[0]))return ob.filtered=!1;if(id.every(function(Pc){return tb.includes(Pc)}))return!0;
var xc=ob.levenshtein||(ob.levenshtein={});Rb=Rb||3>=da.arr.sum(Ia.lowercasedTokens.map(function(Pc){return xc[Pc]||(xc[Pc]=da.string.levenshtein(tb,Pc))}));return ob.filtered=Rb}},{key:"sortFunction",value:function(Ia,xb){xb._cache||(xb._cache={});var Rb=xb._cache[Ia.input]||(xb._cache[Ia.input]={});if(Rb.hasOwnProperty("sortVal"))return Rb.sortVal;Rb=xb._cache[Ia.input]={};var yc=xb.value;xb=yc.highestPriority;var id=yc.completion;yc=yc.priority;id=id.replace(/\([^\)]*\)$/,"").toLowerCase();var ob=
0;Ia.lowercasedTokens.forEach(function(tb){id.startsWith(tb)?ob+=12:3<=tb.length&&id.includes(tb)&&(ob+=5)});xb=-((yc||(ob?xb:0))/Math.pow(10,String(xb).length-2))-ob;var Pb=Rb.levenshtein||(Rb.levenshtein={});Ia=da.arr.sum(Ia.lowercasedTokens.map(function(tb){return Pb[tb]||(Pb[tb]=da.string.levenshtein(id,tb))}));ob&&(Ia/=2);return Rb.sortVal=Ia+xb}},{key:"positionForMenu",value:function(){var Ia=this.textMorph,xb=Ia.charBoundsFromTextPosition(Ia.cursorPosition);return Ia.getGlobalTransform().transformRectToRect(xb).topLeft().addXY(-Ia.scroll.x,
-Ia.scroll.y).addPt(da.pt(Ia.borderWidth+4,Ia.borderWidth+4))}},{key:"completionListSpec",value:function(){var Ia=qb(regeneratorRuntime.mark(function Rb(){var yc,id,ob,Pb,tb,xc,Pc,nd,Id,Hb,Kd,vc,Qc,kb,Cc,zc,Fc,xd,Uc;return regeneratorRuntime.wrap(function(Md){for(;;)switch(Md.prev=Md.next){case 0:return yc=this.textMorph,id=yc.fontSize,ob=yc.fontFamily,Pb=this.positionForMenu(),tb=this.prefix(),Md.next=6,this.computeCompletions(tb);case 6:xc=Md.sent;Pc=xc.items;nd=xc.maxCol;Id=yc.env.fontMetric.sizeFor(ob,
id,"M");Hb=Id.width*nd;Kd=yc.document.getLine(0).height;vc=Math.max(120,Hb<yc.width?Hb:yc.width);Qc=Kd*Pc.length+Kd+10;kb=Math.max(70,Math.min(700,Qc));Cc=Pb.extent(da.pt(vc,kb));if(zc=yc.world())Fc=zc.visibleBounds().insetBy(5),Cc.bottom()>Fc.bottom()&&(xd=Cc.bottom()-Fc.bottom(),xd>Cc.height-50&&(xd=Cc.height-50),Cc.height-=xd),Cc.right()>Fc.right()&&(Uc=Cc.right()-Fc.right(),Cc.width=120>Cc.width-Uc?120:Cc.width-Uc),Fc.containsRect(Cc)||(Cc=Cc.withTopLeft(Fc.translateForInclusion(Cc).topLeft())),
Cc=Cc.translatedBy(Fc.insetBy(-1).topLeft().negated());return Md.abrupt("return",{type:da.FilterableList,hasFixedPosition:!0,epiMorph:!0,fontSize:id,position:Cc.topLeft(),extent:Cc.extent(),items:Pc,input:tb,name:"text completion menu",historyId:"lively.morphic-text completion",filterFunction:this.filterFunction,sortFunction:this.sortFunction,renderOnGPU:!0,selectedIndex:0,submorphs:[{name:"input",fontColor:yc.fontColor,clipMode:"visible",fill:yc.fill,fixedHeight:!0,fixedWidth:!1,padding:da.Rectangle.inset(0,
0,0,0)},{name:"padding",height:2}]});case 22:case "end":return Md.stop()}},Rb,this)}));return function(){return Ia.apply(this,arguments)}}()},{key:"removeMenuOnBlur",value:function(Ia){Ia.evt;var xb=Ia.menu;setTimeout(function(){xb.withAllSubmorphsDetect(function(Rb){return Rb.isFocused()})?xb.inputMorph.focus():xb.remove()})}},{key:"openCompletionList",value:function(){var Ia=qb(regeneratorRuntime.mark(function Rb(){var yc,id,ob,Pb,tb,xc,Pc,nd,Id,Hb;return regeneratorRuntime.wrap(function(Kd){for(;;)switch(Kd.prev=
Kd.next){case 0:return yc=this.textMorph.selection.start,Kd.next=3,this.completionListSpec();case 3:return id=Kd.sent,ob=da.part(da.AutocompleteList,id),Pb=new da.Range({start:yc,end:this.textMorph.selection.start}),tb=this.textMorph.textInRange(Pb),xc=ob.inputMorph,Pc=ob.listMorph,nd=id.input,Id=ob.addMorph({name:"prefix mask",fill:da.Color.transparent,bounds:xc.textBounds()},xc),Pb.isEmpty()||(this.textMorph.deleteText(Pb),xc.input=tb,xc.gotoDocumentEnd()),da.connect(xc,"textString",Id,"setBounds",
{converter:"() => input.textBounds()",varMapping:{input:xc}}),da.connect(ob,"accepted",this,"insertCompletion",{updater:"function($upd) {\n        let textToInsert, customInsertionFn = null, completion = this.sourceObj.selection;\n        if (completion) {\n          if (completion.prefix) prefix = completion.prefix;\n          textToInsert = completion.completion;\n          customInsertionFn = completion.customInsertionFn;\n        } else {\n          textToInsert = this.sourceObj.inputMorph.textString;\n        }\n        $upd(textToInsert, prefix, customInsertionFn);\n      }",
varMapping:{prefix:nd}}),da.connect(ob,"accepted",ob,"remove"),da.connect(ob,"canceled",ob,"remove"),da.connect(ob,"remove",this.textMorph,"focus"),da.connect(ob.inputMorph,"onBlur",this,"removeMenuOnBlur",{converter:"evt => ({menu, evt})",varMapping:{menu:ob}}),Hb=this.textMorph.world(),Pc.addStyleClass("hiddenScrollbar"),xc.height=Pc.itemHeight,xc.fontSize=Pc.fontSize,ob.relayout(),xc.focus(),nd.length&&(xc.gotoDocumentEnd(),ob.moveBy(da.pt(-xc.textBounds().width,0))),Hb.addMorph(ob),Kd.abrupt("return",
ob);case 27:case "end":return Kd.stop()}},Rb,this)}));return function(){return Ia.apply(this,arguments)}}()},{key:"autoInsertBestMatchingCompletion",value:function(){var Ia=qb(regeneratorRuntime.mark(function yc(Rb){var id,ob,Pb,tb,xc,Pc=arguments;return regeneratorRuntime.wrap(function(nd){for(;;)switch(nd.prev=nd.next){case 0:return id=1<Pc.length&&void 0!==Pc[1]?Pc[1]:!0,ob=2<Pc.length?Pc[2]:void 0,nd.next=4,this.computeSortedCompletions(Rb,id);case 4:Pb=nd.sent,tb=ic(Pb,1),(xc=tb[0])&&this.insertCompletion(xc.value.completion,
Rb,ob);case 8:case "end":return nd.stop()}},yc,this)}));return function(Rb){return Ia.apply(this,arguments)}}()},{key:"insertCompletion",value:function(Ia,xb,Rb){var yc=this.textMorph,id=yc.document,ob=yc.selection.isMultiSelection?yc.selection.selections:[yc.selection];yc.undoManager.group();ob.forEach(function(Pb){Pb.collapseToEnd();var tb=Pb.lead,xc=xb?id.indexToPosition(id.positionToIndex(tb)-xb.length):tb;"function"===typeof Rb?Rb(Ia,xb,yc,{start:xc,end:tb},Pb):yc.replace({start:xc,end:tb},Ia)});
yc.undoManager.group()}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"CompletionController"}}],Fb,{pathInPackage:function(){return"./text/completion.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.ide",version:"0.1.0"}}},{start:1488,end:13063})}(void 0);da.CompletionController=Ib;da.CompletionController=Ib;Ib=[{name:"text completion",handlesCount:!0,
multiSelectAction:"single",exec:function(la,Fb,vb){return qb(regeneratorRuntime.mark(function xb(){var Rb;return regeneratorRuntime.wrap(function(yc){for(;;)switch(yc.prev=yc.next){case 0:return Rb=new da.CompletionController(la,da.defaultCompleters),yc.next=3,Rb.openCompletionList();case 3:return yc.abrupt("return",!0);case 4:case "end":return yc.stop()}},xb)}))()}},{name:"text completion first match",handlesCount:!0,multiSelectAction:"single",exec:function(la,Fb,vb){return qb(regeneratorRuntime.mark(function xb(){var Rb;
return regeneratorRuntime.wrap(function(yc){for(;;)switch(yc.prev=yc.next){case 0:return Rb=new da.CompletionController(la,da.defaultCompleters),yc.next=3,Rb.autoInsertBestMatchingCompletion(Rb.prefix());case 3:return yc.abrupt("return",!0);case 4:case "end":return yc.stop()}},xb)}))()}}];da.completionCommands=Ib;da.completionCommands=Ib;var ka=window.lively.FreezerRuntime.recorderFor("lively.ide/text/multi-select-commands.js");ka.arr=vd;var va=[{name:"[multi select] add cursor above",multiSelectAction:"single",
exec:function(la){var Fb=la.selection.start;0<Fb.row&&(Fb=la.getPositionAboveOrBelow(1,Fb,!0,0,la.charBoundsFromTextPosition(Fb).x),la.selection.addRange({start:Fb,end:Fb}));return!0}},{name:"[multi select] add cursor below",multiSelectAction:"single",exec:function(la){var Fb=la.selection.start;Fb.row<la.documentEndPosition.row&&(Fb=la.getPositionAboveOrBelow(-1,Fb,!0,0,la.charBoundsFromTextPosition(Fb).x),la.selection.addRange({start:Fb,end:Fb}));return!0}},{name:"[multi select] all like this",multiSelectAction:"single",
exec:function(la){var Fb=la.selection.selections[la.selection.selections.length-1];if(Fb.isEmpty())return!0;la.searchForAll(Fb.text,{start:{column:0,row:0}}).forEach(function(vb){return la.selection.addRange(vb.range,!1)});la.selection.mergeSelections();ka.arr.remove(la.selection.selections,Fb);la.selection.selections.push(Fb);return!0}},{name:"[multi select] more like this forward",multiSelectAction:"single",exec:function(la){var Fb=la.selection.selections.length-1,vb=la.selection.selections[Fb];
if(vb.isEmpty())return!0;var Ia=la.search(vb.text,{start:vb.end,backwards:!1});Ia&&(vb=la.selection.selections.findIndex(function(xb){return xb.range.equals(Ia.range)}),-1<vb?ka.arr.swap(la.selection.selections,vb,Fb):la.selection.addRange(Ia.range));return!0}},{name:"[multi select] more like this backward",multiSelectAction:"single",exec:function(la){var Fb=la.selection.selections.length-1,vb=la.selection.selections[Fb];if(vb.isEmpty())return!0;var Ia=vb.start,xb=la.search(vb.text,{start:{row:Ia.row,
column:Ia.column-(vb.text.length-1)},backwards:!0});xb&&(vb=la.selection.selections.findIndex(function(Rb){return Rb.range.equals(xb.range)}),-1<vb?ka.arr.swap(la.selection.selections,vb,Fb):la.selection.addRange(xb.range));return!0}},{name:"[multi select] remove focused cursor",multiSelectAction:"single",exec:function(la){var Fb=la.selection.selections.length;1<Fb&&la.selection.removeSelections(Fb-1);return!0}},{name:"[multi select] goto previous focused cursor",multiSelectAction:"single",exec:function(la){la.selection.selections=
lively.lang.arr.rotate(la.selection.selections,-1);return!0}},{name:"[multi select] goto next focused cursor",multiSelectAction:"single",exec:function(la){la.selection.selections=lively.lang.arr.rotate(la.selection.selections,1);return!0}},{name:"[multi select] align cursors",multiSelectAction:"single",exec:function(la){var Fb=la.selection.selections;if(1>=Fb.length)return!0;var vb=ka.arr.groupBy(Fb,function(xb){return xb.range.start.row});Fb=vb.keys().map(function(xb){xb=vb[xb];var Rb=ka.arr.max(xb,
function(yc){return yc.range.start.column});ka.arr.without(xb,Rb).forEach(function(yc){return yc.range=Rb.range});return Rb});var Ia=ka.arr.max(Fb,function(xb){return xb.range.start.column}).range.start.column;Fb.forEach(function(xb){var Rb=xb.range.start;xb=Rb.row;Rb=Rb.column;la.insertText(" ".repeat(Ia-Rb),{row:xb,column:Rb})});return!0}},{name:"[multi select] create rectangular selection",multiSelectAction:"single",exec:function(la){la.selection.disableMultiSelect();if(la.selection.isEmpty())var Fb=
la.lastSavedMark&&la.lastSavedMark.position||(void 0).lineRange().start,vb=la.cursorPosition;else Fb=la.selection,vb=Fb.lead,Fb=Fb.anchor;la.selection.collapse();var Ia=Fb.column,xb=vb.column;ka.arr.range(Fb.row,vb.row).forEach(function(Rb){return la.getLine(Rb).length>Math.min(xb,Ia)&&la.selection.addRange({end:{row:Rb,column:xb},start:{row:Rb,column:Ia}},!1)});la.selection.mergeSelections();return!0}},{name:"[multi select] count",multiSelectAction:"single",handlesCount:!0,exec:function(la,Fb){var vb=
2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;la.undoManager.group();la.selection.selections.forEach(function(Ia,xb){return Ia.text=String(xb+vb)});la.undoManager.group();return!0}}];ka.multiSelectCommands=va;ka.multiSelectCommands=va;var Fa=window.lively.FreezerRuntime.recorderFor("lively.ide/text/code-navigation-commands.js");Fa.pToI=function(la,Fb){return la.positionToIndex(Fb)};Fa.iToP=function(la,Fb){return la.indexToPosition(Fb)};Fa.execCodeNavigator=function(la){return function(Fb,
vb,Ia){var xb=Fb.pluginInvokeFirst("getNavigator");if(!xb)return!0;Fb.saveMark();Ia=Ia||1;for(var Rb=0;Rb<Ia;Rb++)xb[la](Fb,vb);return!0}};Fa.once=Wb;var M=[{name:"forwardSexp",bindKey:"Ctrl-Alt-f|Ctrl-Alt-Right",exec:Fa.execCodeNavigator("forwardSexp"),multiSelectAction:"forEach",readOnly:!0},{name:"backwardSexp",bindKey:"Ctrl-Alt-b|Ctrl-Alt-Left",exec:Fa.execCodeNavigator("backwardSexp"),multiSelectAction:"forEach",readOnly:!0},{name:"backwardUpSexp",bindKey:"Ctrl-Alt-u|Ctrl-Alt-Up",exec:Fa.execCodeNavigator("backwardUpSexp"),
multiSelectAction:"forEach",readOnly:!0},{name:"forwardDownSexp",bindKey:"Ctrl-Alt-d|Ctrl-Alt-Down",exec:Fa.execCodeNavigator("forwardDownSexp"),multiSelectAction:"forEach",readOnly:!0},{name:"markDefun",bindKey:"Ctrl-Alt-h",exec:Fa.execCodeNavigator("markDefun"),multiSelectAction:"forEach",readOnly:!0},{name:"expandRegion",bindKey:{win:"Shift-Ctrl-E|Ctrl-Shift-Space",mac:"Shift-Command-Space|Ctrl-Shift-Space"},exec:function(la,Fb){function vb(){var Rb=la.$expandRegionState,yc=Fa.pToI(la,la.cursorPosition);
if(Rb&&(Rb.range[0]===yc||Rb.range[1]===yc))return Rb;Rb=la.selection.range;return la.$expandRegionState={range:[Fa.pToI(la,Rb.start),Fa.pToI(la,Rb.end)]}}Fb=Fb||{};var Ia=la.pluginInvokeFirst("getNavigator");if(!Ia)return!0;var xb=Fb.start;Fb=Fb.end;if("number"===typeof xb&&"number"===typeof Fb)vb(),Ia={range:[xb,Fb],prev:vb()};else{xb=Ia.ensureAST(la);if(!xb)return;Ia=Ia.expandRegion(la,la.textString,xb,vb())}Ia&&Ia.range&&(la.selection={start:Fa.iToP(la,Ia.range[0]),end:Fa.iToP(la,Ia.range[1])},
la.$expandRegionState=Ia);Fa.once(la,"selectionChange",function(){return la.$expandRegionState=null},"call");return!0},multiSelectAction:"forEach",readOnly:!0},{name:"contractRegion",bindKey:{win:"Shift-Ctrl-S|Ctrl-Alt-Space",mac:"Ctrl-Command-space|Ctrl-Alt-Space"},exec:function(la){if(la.selection.isEmpty())return!0;var Fb=la.pluginInvokeFirst("getNavigator");if(!Fb)return!0;var vb=Fb.ensureAST(la);if(!vb)return!0;var Ia=la.$expandRegionState;if(!Ia)return!0;(Fb=Fb.contractRegion(la,la.textString,
vb,Ia))&&Fb.range&&(la.selection={start:Fa.iToP(la,Fb.range[0]),end:Fa.iToP(la,Fb.range[1])},la.$expandRegionState=Fb);Fa.once(la,"selectionChange",function(){return la.$expandRegionState=null},"call");return!0},multiSelectAction:"forEach",readOnly:!0}];Fa.commands=M;Fa.commands=M;var Aa=window.lively.FreezerRuntime.recorderFor("lively.ide/text/generic-code-commands.js");Aa.arr=vd;Aa.chain=lc;Aa.string=Ed;var wb=[{name:"toggle comment",exec:function(la){var Fb=la.pluginInvokeFirst("getComment");if(!Fb)return!0;
if(!Fb.lineCommentStart)return Fb.blockCommentStart?la.execCommand("toggle block comment"):!0;var vb=Fb.lineCommentStart,Ia=new RegExp("^(\\s*)(".concat(vb,"\\s?)(.*)"));Fb=la.document;var xb=la.selection;xb.isEmpty()||0!==xb.end.column||xb.growRight(-1);var Rb=xb.start.row;Fb=Fb.lineStrings.slice(xb.start.row,xb.end.row+1);Fb=Fb.some(function(ob){return!!ob.trim()})?Aa.arr.dropWhile(Fb,function(ob){return ob.trim()?!1:++Rb&&!0}):Fb;var yc=Fb.every(function(ob){return ob.trim()&&ob.match(Ia)});la.undoManager.group();
if(yc)Fb.forEach(function(ob,Pb){if(ob=ob.match(Ia)){ob=ic(ob,4);ob[0];var tb=ob[1],xc=ob[2];ob[3];la.deleteText({start:{row:Rb+Pb,column:tb.length},end:{row:Rb+Pb,column:tb.length+xc.length}})}});else{var id=Fb.reduce(function(ob,Pb,tb){return Pb.trim()||xb.isEmpty()&&xb.start.row===xb.end.row?Math.min(ob,Pb.match(/^\s*/)[0].length):ob},Infinity);id=Infinity===id?0:id;Fb.forEach(function(ob,Pb){ob=ob.match(/^(\s*)(.*)/);ob=ic(ob,3);ob[0];ob[1];ob[2];la.insertText("".concat(vb," "),{row:Rb+Pb,column:id})})}la.undoManager.group();
return!0}},{name:"toggle block comment",exec:function(la){var Fb=la.pluginInvokeFirst("getComment");if(!Fb)return!0;if(!Fb.blockCommentStart)return Fb.lineCommentStart?la.execCommand("toggle comment"):!0;if(!Fb||!Fb.blockCommentStart)return!0;var vb=Fb.blockCommentStart;Fb=Fb.blockCommentEnd;var Ia=new RegExp("^"+vb.replace(/\*/g,"\\*")),xb=new RegExp(Fb.replace(/\*/g,"\\*")+"$"),Rb=la.tokenAt(la.cursorPosition);if(Rb&&"comment"===Rb.token){var yc=la.textInRange(Rb);if(yc.match(Ia)&&yc.match(xb))return la.undoManager.group(),
la.replace(Rb,yc.slice(vb.length,-Fb.length)),la.undoManager.group(),!0}la.undoManager.group();la.insertText(vb,la.selection.start);la.insertText(Fb,la.selection.end);la.undoManager.group();vb=!la.selection.isEmpty();la.selection.growLeft(Fb.length);vb||la.selection.collapse();return!0}},{name:"comment box",exec:function(la,Fb,vb){Fb=la.undoManager.ensureNewGroup(la,"comment box");if(la.selection.isEmpty())return la.insertText("-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-"),la.execCommand("toggle comment"),
la.undoManager.group(Fb),!0;var Ia=la.selection.range,xb=la.withSelectedLinesDo(function(yc){return yc}),Rb=Aa.arr.min([Ia.start.column].concat(Aa.chain(xb).map(function(yc){return yc.match(/^\s*/)}).flat().compact().pluck("length").value()));xb=Aa.arr.max(xb.map(function(yc){return yc.length}))-Rb;xb=Array(Math.ceil(xb/2)+1).join("-=")+"-";la.execCommand("toggle comment");la.collapseSelection();la.cursorPosition={row:Ia.start.row,column:0};vb?la.insertText(Aa.string.indent("-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-\n",
" ",Rb)):la.insertText(Aa.string.indent(xb+"\n"," ",Rb));la.selection.goUp();la.execCommand("toggle comment");la.cursorPosition={row:Ia.end.row+2,column:0};la.insertText(Aa.string.indent(xb+"\n"," ",Rb));la.selection.goUp();la.execCommand("toggle comment");la.selection.range={start:{row:Ia.start.row,column:0},end:la.cursorPosition};la.undoManager.group(Fb);return!0},multiSelectAction:"forEach",handlesCount:!0}];Aa.commands=wb;Aa.commands=wb;var Na=window.lively.FreezerRuntime.recorderFor("lively.ide/text/code-evaluation-commands.js");
Na.Inspector=fa;Na.string=Ed;Na.Morph=db;Na.pt=se;Na.Color=ad;Na.runCommand=Xa;Na.defaultDirectory=Gb;var hb=[{name:"doit",doc:"Evaluates the selected code or the current line and report the result",exec:function(){var la=qb(regeneratorRuntime.mark(function xb(vb,Ia){var Rb,yc,id,ob=arguments;return regeneratorRuntime.wrap(function(Pb){for(;;)switch(Pb.prev=Pb.next){case 0:return Rb=2<ob.length&&void 0!==ob[2]?ob[2]:1,vb.maybeSelectCommentOrLine(),Pb.prev=2,Ia=Object.assign({},Ia,{logDoit:!0,inspect:!0,
inspectDepth:Rb}),Pb.next=6,vb.doEval(void 0,Ia);case 6:yc=Pb.sent;id=yc.error?yc.error:yc.isError?yc.value:null;Pb.next=13;break;case 10:Pb.prev=10,Pb.t0=Pb["catch"](2),id=Pb.t0;case 13:return id?vb.showError(id):vb.setStatusMessage(Na.string.truncate(yc.value,1E3)),Pb.abrupt("return",yc);case 15:case "end":return Pb.stop()}},xb,null,[[2,10]])}));return function(vb,Ia){return la.apply(this,arguments)}}()},{name:"blame selection",doc:"Retrieves complete git blame information for the selected code.",
exec:function(){var la=qb(regeneratorRuntime.mark(function Ia(vb){var xb,Rb,yc,id,ob,Pb,tb,xc;return regeneratorRuntime.wrap(function(Pc){for(;;)switch(Pc.prev=Pc.next){case 0:xb=vb.selection.selections[0];Rb=xb.range.start.row+1;yc=xb.range.end.row+1;if(vb.editorPlugin.evalEnvironment.targetModule){Pc.next=6;break}vb.showError("Error!");return Pc.abrupt("return");case 6:id=vb.editorPlugin.evalEnvironment.targetModule;if(id.match(/http:/)||id.match(/file:/)){Pc.next=10;break}vb.showError("Only available for files located in the file system.");
return Pc.abrupt("return");case 10:return Pc.next=12,Na.defaultDirectory();case 12:return ob=Pc.sent,ob=ob.replace("http://localhost:9011/","").replace("/lively.server",""),id=id.replace("http://localhost:9011/","").replace("file://",""),Pb="git blame --date=short -L ".concat(Rb,",").concat(yc," ").concat(id,' | while read hash others;\n        do\n          echo $(git log -1 --pretty=%s $hash) " -- " $others\n        done'),tb=Na.runCommand(Pb,{cwd:ob}),Pc.next=19,tb.whenDone();case 19:xc=tb.output,
$world.execCommand("open workspace",{title:"Blame Info",content:xc,language:"text"});case 21:case "end":return Pc.stop()}},Ia)}));return function(vb){return la.apply(this,arguments)}}()},{name:"blame line",doc:"Retrieves git commit message and author name from the last time the line at which the cursor is positioned was changed.",exec:function(){var la=qb(regeneratorRuntime.mark(function Ia(vb){var xb,Rb,yc,id,ob,Pb,tb,xc,Pc;return regeneratorRuntime.wrap(function(nd){for(;;)switch(nd.prev=nd.next){case 0:xb=
vb.cursorPosition.row+1;if(vb.editorPlugin.evalEnvironment.targetModule){nd.next=4;break}vb.showError("Error!");return nd.abrupt("return");case 4:Rb=vb.editorPlugin.evalEnvironment.targetModule;if(Rb.match(/http:/)||Rb.match(/file:/)){nd.next=8;break}vb.showError("Only available for files located in the file system.");return nd.abrupt("return");case 8:return nd.next=10,Na.defaultDirectory();case 10:return yc=nd.sent,yc=yc.replace("http://localhost:9011/","").replace("/lively.server",""),Rb=Rb.replace("http://localhost:9011/",
"").replace("file://",""),id="git blame --date=short -L "+xb+","+xb+" --porcelain "+Rb,ob=Na.runCommand(id,{cwd:yc}),nd.next=17,ob.whenDone();case 17:Pb=ob.output,tb=Pb.match(/author (.*)$/m)[1],xc=Pb.match(/summary (.*)$/m)[1],Pc=Pb.match(/author-time (.*)$/m)[1],Pc=(new Date(1E3*Pc)).toDateString(),"Not Committed Yet"===tb?vb.setStatusMessage("Line not yet commited."):vb.setStatusMessage(xc+" - "+tb+" on "+Pc);case 23:case "end":return nd.stop()}},Ia)}));return function(vb){return la.apply(this,
arguments)}}()},{name:"eval all",doc:"Evaluates the entire text contents",scrollCursorIntoView:!1,exec:function(){var la=qb(regeneratorRuntime.mark(function xb(vb,Ia){var Rb,yc;return regeneratorRuntime.wrap(function(id){for(;;)switch(id.prev=id.next){case 0:return id.prev=0,id.next=3,vb.doEval({start:{row:0,column:0},end:vb.documentEndPosition},Object.assign({},Ia,{logDoit:!0}));case 3:Rb=id.sent;yc=Rb.error?Rb.error:Rb.isError?Rb.value:null;id.next=10;break;case 7:id.prev=7,id.t0=id["catch"](0),
yc=id.t0;case 10:return yc?vb.showError(yc):vb.setStatusMessage(String(Rb.value)),id.abrupt("return",Rb);case 12:case "end":return id.stop()}},xb,null,[[0,7]])}));return function(vb,Ia){return la.apply(this,arguments)}}()},{name:"printit",doc:"Evaluates selected code or the current line and inserts the result in a printed representation",exec:function(){var la=qb(regeneratorRuntime.mark(function xb(vb,Ia){var Rb,yc,id,ob,Pb,tb,xc;return regeneratorRuntime.wrap(function(Pc){for(;;)switch(Pc.prev=Pc.next){case 0:return vb.maybeSelectCommentOrLine(),
Pc.prev=1,Ia=Object.assign({},Ia,{asString:!1,logDoit:!0}),Pc.next=5,vb.doEval(void 0,Ia);case 5:Rb=Pc.sent;yc=Rb.error?Rb.error:Rb.isError?Rb.value:null;Pc.next=12;break;case 9:Pc.prev=9,Pc.t0=Pc["catch"](1),yc=Pc.t0;case 12:vb.selection.collapseToEnd();id=Rb.value&&Rb.value.isColor;if(!id){Pc.next=22;break}vb.selection.text=String(Rb.value);ob=new Na.Morph({fill:Na.Color.transparent,extent:Na.pt(vb.fontSize+2,vb.fontSize+2),submorphs:[{fill:Rb.value,center:Na.pt(vb.fontSize+2,vb.fontSize+2).scaleBy(.5)}]});
Pb=vb.selection.start;tb=Pb.column;xc=Pb.row;vb.insertText([ob,{}],vb.selection.start);vb.selection.start={column:tb,row:xc};vb.focus();return Pc.abrupt("return",Rb);case 22:return vb.insertTextAndSelect(yc?String(yc)+(yc.stack?"\n"+yc.stack:""):String(Rb.value)),vb.focus(),Pc.abrupt("return",Rb);case 25:case "end":return Pc.stop()}},xb,null,[[1,9]])}));return function(vb,Ia){return la.apply(this,arguments)}}()},{name:"editit",doc:"Evaluates the expression and opens an object editor on the resulting object.",
exec:function(){var la=qb(regeneratorRuntime.mark(function xb(vb,Ia){var Rb,yc,id,ob;return regeneratorRuntime.wrap(function(Pb){for(;;)switch(Pb.prev=Pb.next){case 0:vb.maybeSelectCommentOrLine();yc=vb.textInRange(vb.selection);id=vb.evalEnvironment||{};ob=vb.pluginFind(function(tb){return tb.isEditorPlugin&&"function"===typeof tb.runEval});id.systemInterface||(id.systemInterface=ob.systemInterface(Ia));if("local"!==id.systemInterface.name){Pb.next=15;break}Pb.prev=6;Pb.next=9;return vb.doEval(void 0,
Ia);case 9:Rb=Pb.sent;yc=Rb.value;Pb.next=15;break;case 13:Pb.prev=13,Pb.t0=Pb["catch"](6);case 15:return vb.world().execCommand("open object editor",{target:yc,evalEnvironment:id}),Pb.abrupt("return",Rb);case 17:case "end":return Pb.stop()}},xb,null,[[6,13]])}));return function(vb,Ia){return la.apply(this,arguments)}}()},{name:"inspectit",doc:"Evaluates the expression and opens an inspector widget on the resulting object.",exec:function(){var la=qb(regeneratorRuntime.mark(function xb(vb,Ia){var Rb,
yc,id,ob,Pb;return regeneratorRuntime.wrap(function(tb){for(;;)switch(tb.prev=tb.next){case 0:vb.maybeSelectCommentOrLine();id=vb.textInRange(vb.selection);ob=vb.evalEnvironment||{};Pb=vb.pluginFind(function(xc){return xc.isEditorPlugin&&"function"===typeof xc.runEval});ob.systemInterface||(ob.systemInterface=Pb.systemInterface(Ia));if("local"!==ob.systemInterface.name){tb.next=20;break}tb.prev=6;tb.next=9;return vb.doEval(void 0,Ia);case 9:Rb=tb.sent;yc=Rb.error?Rb.error:Rb.isError?Rb.value:null;
id=Rb.value;tb.next=17;break;case 14:tb.prev=14,tb.t0=tb["catch"](6),yc=tb.t0;case 17:Na.Inspector.openInWindow({targetObject:yc||id});tb.next=21;break;case 20:Na.Inspector.openInWindow({remoteTarget:{code:id,evalEnvironment:ob}});case 21:return tb.abrupt("return",Rb);case 22:case "end":return tb.stop()}},xb,null,[[6,14]])}));return function(vb,Ia){return la.apply(this,arguments)}}()},{name:"log it",doc:"Evaluates the expression and `console.log`s the result.",exec:function(){var la=qb(regeneratorRuntime.mark(function xb(vb,
Ia){var Rb,yc,id;return regeneratorRuntime.wrap(function(ob){for(;;)switch(ob.prev=ob.next){case 0:vb.maybeSelectCommentOrLine();yc=vb.evalEnvironment||{};id=vb.pluginFind(function(Pb){return Pb.isEditorPlugin&&"function"===typeof Pb.runEval});yc.systemInterface||(yc.systemInterface=id.systemInterface(Ia));if("local"!==yc.systemInterface.name){ob.next=8;break}ob.next=7;return vb.doEval(void 0,Ia);case 7:Rb=ob.sent;case 8:return console.log(Rb.value||Rb.error),ob.abrupt("return",Rb);case 10:case "end":return ob.stop()}},
xb)}));return function(vb,Ia){return la.apply(this,arguments)}}()},{name:"print inspectit",doc:"Prints a representation of the object showing it's properties. The count argument defines how deep (recursively) objects will be printed.",handlesCount:!0,exec:function(){var la=qb(regeneratorRuntime.mark(function xb(vb,Ia){var Rb,yc,id=arguments;return regeneratorRuntime.wrap(function(ob){for(;;)switch(ob.prev=ob.next){case 0:return Rb=2<id.length&&void 0!==id[2]?id[2]:1,vb.maybeSelectCommentOrLine(),
ob.prev=2,Ia=Object.assign({},Ia,{inspect:!0,inspectDepth:Rb,logDoit:!0}),ob.next=6,vb.doEval(void 0,Ia);case 6:yc=ob.sent;ob.next=11;break;case 9:ob.prev=9,ob.t0=ob["catch"](2);case 11:return vb.selection.collapseToEnd(),vb.insertTextAndSelect(yc.value),ob.abrupt("return",yc);case 14:case "end":return ob.stop()}},xb,null,[[2,9]])}));return function(vb,Ia){return la.apply(this,arguments)}}()}];Na.codeEvaluationCommands=hb;Na.codeEvaluationCommands=hb;var Bb=window.lively.FreezerRuntime.recorderFor("lively.ide/text/rich-text-commands.js");
Bb.changeAttributeInSelectionOrMorph=function(la,Fb,vb){var Ia=la.selection;la.keepPosAtSameScrollOffsetWhile(function(){Ia.isEmpty()?la[Fb]="function"===typeof vb?vb(la[Fb]):vb:la.undoManager&&(la.undoManager.group(),la.changeStyleProperty(Fb,function(xb){return"function"===typeof vb?vb(xb):vb}),la.undoManager.group())})};var ba=[{name:"increase font size",scrollCursorIntoView:!1,exec:function(la){var Fb=la.fontSize;Bb.changeAttributeInSelectionOrMorph(la,"fontSize",function(vb){vb=vb||Fb;return vb+
(18<=vb?2:1)});return!0}},{name:"decrease font size",scrollCursorIntoView:!1,exec:function(la){var Fb=la.fontSize;Bb.changeAttributeInSelectionOrMorph(la,"fontSize",function(vb){vb=vb||Fb;return vb-(18>=vb?1:2)});return!0}},{name:"change font",scrollCursorIntoView:!1,exec:function(){var la=qb(regeneratorRuntime.mark(function Ia(vb){var xb,Rb,yc,id,ob;return regeneratorRuntime.wrap(function(Pb){for(;;)switch(Pb.prev=Pb.next){case 0:xb=["serif","sans-serif","monospace"];if(Rb=localStorage["lively.morpic/text-change-font-additional-fonts"])Rb=
JSON.parse(Rb),xb.push.apply(xb,sc(Rb));xb.map(function(tb){return tb.toLowerCase()}).includes(vb.fontFamily.toLowerCase())||(xb.push(vb.fontFamily),Rb=[].concat(sc(Rb||[]),[vb.fontFamily]),localStorage["lively.morpic/text-change-font-additional-fonts"]=JSON.stringify(Rb));Pb.next=7;return $world.editListPrompt("choose font",xb,{requester:vb,preselect:xb.indexOf(vb.fontFamily),historyId:"lively.morpic/text-change-font-hist"});case 7:yc=Pb.sent;id=ic(yc.selections,1);if(ob=id[0])vb.fontFamily=ob;return Pb.abrupt("return",
!0);case 12:case "end":return Pb.stop()}},Ia)}));return function(vb){return la.apply(this,arguments)}}()},{name:"set link of selection",scrollCursorIntoView:!1,exec:function(){var la=qb(regeneratorRuntime.mark(function Ia(vb){var xb,Rb,yc,id,ob,Pb=arguments;return regeneratorRuntime.wrap(function(tb){for(;;)switch(tb.prev=tb.next){case 0:xb=1<Pb.length&&void 0!==Pb[1]?Pb[1]:{};if(xb.hasOwnProperty("link")){tb.next=9;break}yc=vb.selection;id=vb.getStyleInRange(yc);ob=id.link;tb.next=6;return vb.world().prompt("Set link",
{input:ob||"https://",historyId:"lively.morphic-rich-text-link-hist"});case 6:if(Rb=tb.sent){tb.next=9;break}return tb.abrupt("return");case 9:vb.undoManager.group(),vb.setStyleInRange({link:Rb||void 0},yc),vb.undoManager.group();case 12:case "end":return tb.stop()}},Ia)}));return function(vb){return la.apply(this,arguments)}}()},{name:"set doit of selection",scrollCursorIntoView:!1,exec:function(){var la=qb(regeneratorRuntime.mark(function Ia(vb){var xb,Rb,yc,id;return regeneratorRuntime.wrap(function(ob){for(;;)switch(ob.prev=
ob.next){case 0:return xb=vb.selection,Rb=vb.getStyleInRange(xb),yc=Rb.doit,ob.next=5,vb.world().editPrompt("Enter doit code (runs on clicking the text)",{requester:vb,input:yc?yc.code:"// empty doit",historyId:"lively.morphic-rich-text-doit-hist",mode:"js",evalEnvironment:vb.evalEnvForDoit(yc||{})});case 5:id=ob.sent,vb.undoManager.group(),id?vb.addTextAttribute({doit:{code:id},nativeCursor:"pointer",textDecoration:"underline"},xb):vb.removeTextAttribute({doit:null,nativeCursor:"",textDecoration:""},
xb),vb.undoManager.group();case 9:case "end":return ob.stop()}},Ia)}));return function(vb){return la.apply(this,arguments)}}()},{name:"reset text style",scrollCursorIntoView:!1,exec:function(la){var Fb=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};la.undoManager.group();Fb=!Fb.onlySelection&&la.selection.isEmpty()?la.documentRange:la.selection.range;la.setStyleInRange(null,Fb);la.undoManager.group();return!0}},{name:"open text attribute controls",exec:function(){var la=qb(regeneratorRuntime.mark(function Ia(vb){var xb,
Rb,yc,id;return regeneratorRuntime.wrap(function(ob){for(;;)switch(ob.prev=ob.next){case 0:return ob.next=2,Dd.import("./index-616023be.js").then(function(Pb){return Pb.a});case 2:return xb=ob.sent,Rb=xb.module,ob.next=6,Rb("lively.ide/text/ui.js").load();case 6:return yc=ob.sent,id=yc.RichTextControl,ob.abrupt("return",id.openFor(vb));case 9:case "end":return ob.stop()}},Ia)}));return function(vb){return la.apply(this,arguments)}}()}];Bb.commands=ba;Bb.commands=ba;var dc=window.lively.FreezerRuntime.recorderFor("lively.ide/editor-plugin.js");
dc.guessTextModeName=zb;dc.rangedToken=function(la,Fb,vb,Ia,xb){return{start:{row:la,column:Fb},end:{row:la,column:vb},token:Ia,mode:xb}};dc.fun=ub;dc.arr=vd;dc.connect=dd;dc.disconnect=sb;dc.DefaultTheme=Db;dc.tokenizeDocument=ab;dc.modeInfo=eb;dc.visitDocumentTokens=kc;dc.getMode=Vb;dc.completionCommands=Ib;dc.multiSelectCommands=va;dc.navCommands=M;dc.codeCommands=wb;dc.codeEvaluationCommands=hb;dc.richTextCommands=ba;dc.Range=fe;dc.guessTextModeName=zb;Ib=bd("default",function(la){var Fb=window.lively.FreezerRuntime.recorderFor("lively.ide/editor-plugin.js"),
vb=Fb.hasOwnProperty("EditorPlugin")&&"function"===typeof Fb.EditorPlugin?Fb.EditorPlugin:Fb.EditorPlugin=function(Ia){if(!Ia||!Ia[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments)};return jc(vb,la,[{key:Symbol["for"]("lively-instance-initialize"),value:function(){this.theme=dc.DefaultTheme.instance;this._ast=this.checker=null;this._tokens=[];this._tokenizerValidBefore=null;this.__dont_serialize__=["mode","_ast","_tokens","_tokenizerValidBefore"]}},
{key:"isEditorPlugin",get:function(){return!0}},{key:"shortName",get:function(){return null}},{key:"longName",get:function(){return this.shortName}},{key:"attach",value:function(Ia){var xb=this;this.textMorph=Ia;dc.connect(Ia,"textChange",this,"onTextChange");dc.connect(Ia,"viewChange",this,"onViewChange");this.textMorph.whenRendered().then(function(){return xb.highlight()})}},{key:"detach",value:function(Ia){dc.disconnect(Ia,"textChange",this,"onTextChange");dc.disconnect(Ia,"viewChange",this,"onViewChange");
this.textMorph=null}},{key:"onViewChange",value:function(){this.requestHighlight()}},{key:"onTextChange",value:function(Ia){this._ast=null;if(Ia){var xb=this._tokenizerValidBefore;if("replace"===Ia.selector){dc.__inter0__=Ia.args[0].start;Ia=dc.__inter0__.row;var Rb=dc.__inter0__.column}else Rb=Ia=0;if(!xb||Ia<xb.row||Ia===xb.row&&Rb<xb.column)Ia=Math.max(0,Ia),this._tokenizerValidBefore={row:Ia,column:Rb}}this.requestHighlight()}},{key:"requestHighlight",value:function(){var Ia=this;0<arguments.length&&
void 0!==arguments[0]&&arguments[0]?this.highlight():dc.fun.debounceNamed(this.textMorph.id+"-requestHighlight",300,function(){Ia.highlight()})()}},{key:"highlight",value:function(){var Ia=this.textMorph,xb=this.theme,Rb=this.mode,yc=this._tokenizerValidBefore;if(xb&&Ia&&Ia.document&&Rb){Ia.fill=xb.background;Ia.cursorColor=xb.cursorColor||Ia.fontColor;var id=Ia.viewState,ob={};yc=dc.tokenizeDocument(Rb,Ia.document,id.firstVisibleRow,id.lastVisibleRow,yc);Rb=yc.lines;yc=yc.tokens;if(Rb.length){id=
Rb[0].row;for(var Pb=[],tb=0;tb<yc.length;id++,tb++)for(var xc=yc[tb],Pc=0;Pc<xc.length;Pc+=5){var nd=xc[Pc],Id=xc[Pc+1],Hb=xb[xc[Pc+2]]||xb["default"];Hb&&Pb.push({start:{row:id,column:nd},end:{row:id,column:Id}},Hb)}Ia.embeddedMorphs.forEach(function(Kd){var vc=Ia.embeddedMorphMap.get(Kd).anchor;ob[Kd.id]=Ia.textAttributeAt(vc.position)});Ia.setTextAttributesWithSortedRanges(Pb);Ia.embeddedMorphs.forEach(function(Kd){var vc=Ia.embeddedMorphMap.get(Kd).anchor;vc=dc.Range.at(vc.position);vc.end.column+=
1;Ia.replace(vc,[Kd,ob[Kd.id]],!1)});this._tokenizerValidBefore={row:dc.arr.last(Rb).row+1,column:0}}if(this.checker)this.checker.onDocumentChange({},Ia,this)}}},{key:"visitTokensInRange",value:function(Ia,xb){var Rb=Ia.start,yc=Ia.end,id=Rb.row-1;dc.visitDocumentTokens(this.mode,this.textMorph.document,Rb.row,yc.row,null,function(ob){return id++},function(ob,Pb,tb,xc,Pc,nd,Id){if(id===Rb.row&&0<Rb.column){if(Rb.column>=xc)return;tb<Rb.column&&Rb.column<xc&&(tb=Rb.column)}if(id===yc.row){if(yc.column<=
tb)return;tb<yc.column&&yc.column<xc&&(xc=yc.column)}xb(ob,Pb,id,tb,xc,Pc,nd,Id)})}},{key:"tokensInRange",value:function(Ia){var xb=[];this.visitTokensInRange(Ia,function(Rb,yc,id,ob,Pb,tb,xc,Pc){return xb.push(dc.rangedToken(id,ob,Pb,Rb,Pc))});return xb}},{key:"tokensOfRow",value:function(Ia){var xb=this.textMorph.getLine(Ia).length;return this.tokensInRange({start:{row:Ia,column:0},end:{row:Ia,column:xb}})}},{key:"tokenAt",value:function(Ia){for(var xb=this.tokensOfRow(Ia.row),Rb=xb.length;Rb--;){var yc=
xb[Rb];if(yc.token&&yc.start.column<=Ia.column&&Ia.column<=yc.end.column)return yc}return null}},{key:"getCommands",value:function(Ia){return[].concat(sc(Ia),sc(dc.completionCommands),sc(dc.multiSelectCommands),sc(dc.navCommands),sc(dc.codeCommands),sc(dc.codeEvaluationCommands),sc(dc.richTextCommands))}},{key:"getComment",value:function(){if(!this.mode)return null;var Ia=this.mode,xb=Ia.lineComment,Rb=Ia.blockCommentStart;Ia=Ia.blockCommentEnd;var yc={};xb&&(yc.lineCommentStart=xb);Rb&&(yc.blockCommentStart=
Rb);Ia&&(yc.blockCommentEnd=Ia);return yc}},{key:"toString",value:function(){return"".concat(this.constructor.name,"(").concat(this.textMorph,")")}},{key:"cmd_newline",value:function(Ia,xb,Rb){var yc=this.textMorph,id=Ia.row,ob=Ia.column;Ia=xb[ob-1];xb=xb[ob];yc.selection.text="\n";yc.selection.collapseToEnd();"{"===Ia&&"}"===xb&&(yc.selection.text="\n"+" ".repeat(Rb),yc.selection.collapse());yc.execCommand("indent according to mode",{undo:!1,ignoreFollowingText:!1,firstRow:id+1,lastRow:id+1});return!0}},
{key:"openPairs",get:function(){return{"{":"}","[":"]","(":")",'"':'"',"'":"'","`":"`"}}},{key:"closePairs",get:function(){return{"}":"{","]":"[",")":"(",'"':'"',"'":"'","`":"`"}}},{key:"cmd_delete_backwards",value:function(){var Ia=this.textMorph,xb=this.openPairs,Rb=Ia.selection,yc=Ia.getLine(Rb.end.row),id=yc[Rb.end.column-1];yc=yc[Rb.end.column];Ia.autoInsertPairs&&Rb.isEmpty()&&id in xb&&yc===xb[id]&&(Rb.growRight(1),Rb.growLeft(1));return!1}},{key:"cmd_insertstring",value:function(Ia){var xb=
this.openPairs,Rb=this.closePairs,yc=this.textMorph,id=yc.selection,ob=yc.autoInsertPairs&&Ia in xb,Pb=yc.autoInsertPairs&&Ia in Rb;if(!ob&&!Pb)return!1;var tb=yc.getLine(id.end.row)[id.end.column];if(!id.isEmpty()){if(!ob)return!1;Rb=yc.undoManager.ensureNewGroup(yc);yc.insertText(xb[Ia],id.end);yc.insertText(Ia,id.start);yc.undoManager.group(Rb);id.growRight(-1);return!0}if(tb in Rb&&Ia===tb)return id.goRight(1),!0;if(Pb&&!ob)return!1;Rb=yc.undoManager.ensureNewGroup(yc);yc.insertText(Ia+xb[Ia]);
yc.undoManager.group(Rb);id.goLeft(1);return!0}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"EditorPlugin"}}],Fb,{pathInPackage:function(){return"./editor-plugin.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.ide",version:"0.1.0"}}},{start:3236,end:12244})}(void 0));va=bd("CodeMirrorEnabledEditorPlugin",function(la){var Fb=window.lively.FreezerRuntime.recorderFor("lively.ide/editor-plugin.js"),
vb=Fb.hasOwnProperty("CodeMirrorEnabledEditorPlugin")&&"function"===typeof Fb.CodeMirrorEnabledEditorPlugin?Fb.CodeMirrorEnabledEditorPlugin:Fb.CodeMirrorEnabledEditorPlugin=function(Ia){if(!Ia||!Ia[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments)};return jc(vb,la,[{key:Symbol["for"]("lively-instance-initialize"),value:function(){jc._get(Object.getPrototypeOf(vb.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this);
this.mode=null}},{key:"attach",value:function(Ia){this.mode=this.codeMirrorMode(Ia);return jc._get(Object.getPrototypeOf(vb.prototype),"attach",this).call(this,Ia)}},{key:"__deserialize__",value:function(){this.mode=this.textMorph?this.codeMirrorMode(this.textMorph):null}},{key:"defaultCodeMirrorModeConfig",value:function(Ia){return{indentWithTabs:!Ia.useSoftTabs,indentUnit:Ia.tabWidth,tabSize:4}}},{key:"codeMirrorMode",value:function(Ia){Ia=this.defaultCodeMirrorModeConfig(Ia);return dc.getMode(Ia,
{name:this.longName})}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"CodeMirrorEnabledEditorPlugin"}}],Fb,{pathInPackage:function(){return"./editor-plugin.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.ide",version:"0.1.0"}}},{start:12252,end:12960})}(dc.EditorPlugin));dc.CodeMirrorEnabledEditorPlugin=va;dc.CodeMirrorEnabledEditorPlugin=
va;dc["default"]=Ib}}});