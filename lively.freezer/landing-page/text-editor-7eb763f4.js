System.register("./__rootModule___commonjs-entry-51a55f66.js ./editor-plugin-5397d87c.js ./messages.cp-817cc06d.js @babel/plugin-syntax-import-meta ./ui.cp-8dfc076f.js ./loading-indicator.cp-98e470a2.js ./index-61952933.js ./tooltips.cp-3c41b378.js ./index-42118cd5.js ./interface-1a7f3c67.js ./index-616023be.js ./popups.cp-5b9fb681.js ./list.cp-840d1cf8.js ./editor-modes-aae4d878.js".split(" "),function(bd){var Dd,se,Rc,ad,Ne,Cb,Sd,ve,uc,dd,vd,Ed,fe,jc,Od,qb,ic,Wb;return{setters:[function(lc){Dd=
lc.M;se=lc.h;Rc=lc.F;ad=lc.b3;Ne=lc.a;Cb=lc.b;Sd=lc.C;ve=lc.d;uc=lc.aG;dd=lc.aq;vd=lc.k;Ed=lc.i;fe=lc.K;jc=lc._;Od=lc.ar},function(lc){qb=lc.guessTextModeName},function(lc){ic=lc.StatusMessageConfirm;Wb=lc.StatusMessageWarning},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function(){var lc=window.lively.FreezerRuntime.recorderFor("lively.ide/text-editor.js");lc.Morph=Dd;lc.Text=se;lc.config=
Rc;lc.num=ad;lc.promise=Ne;lc.pt=Cb;lc.Color=Sd;lc.connect=ve;lc.signal=uc;lc.once=dd;lc.resource=vd;lc.guessTextModeName=qb;lc.StatusMessageConfirm=ic;lc.StatusMessageWarning=Wb;lc.editorCommands=[{name:"focus url input",exec:function(Xa){Xa.ui.urlInput.focus();return!0}},{name:"focus content text",exec:function(Xa){Xa.ui.contentText.focus();return!0}},{name:"load file",exec:function(){var Xa=jc(regeneratorRuntime.mark(function ub(sc){return regeneratorRuntime.wrap(function(sb){for(;;)switch(sb.prev=
sb.next){case 0:return sc.location=sc.ui.urlInput.input,sb.abrupt("return",!0);case 2:case "end":return sb.stop()}},ub)}));return function(sc){return Xa.apply(this,arguments)}}()},{name:"save file",exec:function(){var Xa=jc(regeneratorRuntime.mark(function ub(sc){var sb,fa;return regeneratorRuntime.wrap(function(Db){for(;;)switch(Db.prev=Db.next){case 0:return sb=sc.customSaveAction||sc.defaultSaveAction,Db.prev=1,Db.next=4,sb(sc);case 4:fa=Db.sent;fa.saved?(sc.setStatusMessage(fa.message||"saved",
lc.StatusMessageConfirm),lc.signal(sc,"contentSaved")):sc.setStatusMessage(fa.message||"not saved");Db.next=11;break;case 8:Db.prev=8,Db.t0=Db["catch"](1),sc.showError("Error saving: ".concat(Db.t0.stack||Db.t0));case 11:return Db.abrupt("return",!0);case 12:case "end":return Db.stop()}},ub,null,[[1,8]])}));return function(sc){return Xa.apply(this,arguments)}}()},{name:"remove file",exec:function(){var Xa=jc(regeneratorRuntime.mark(function ub(sc){var sb;return regeneratorRuntime.wrap(function(fa){for(;;)switch(fa.prev=
fa.next){case 0:if(sb=sc.locationResource){fa.next=4;break}sc.setStatusMessage("No file selected");return fa.abrupt("return",!0);case 4:return fa.prev=4,fa.next=7,sc.world().confirm("Really remove ".concat(sb.url,"?"));case 7:if(!fa.sent){fa.next=14;break}fa.next=10;return sb.remove();case 10:sc.setStatusMessage("".concat(sb.url," removed!"));sc.reload();fa.next=16;break;case 14:return fa.next=16,sc.world().inform("delete file canceled");case 16:fa.next=21;break;case 18:fa.prev=18,fa.t0=fa["catch"](4),
sc.showError("Error writing ".concat(sb.url,": ").concat(fa.t0.stack||fa.t0));case 21:return fa.abrupt("return",!0);case 22:case "end":return fa.stop()}},ub,null,[[4,18]])}));return function(sc){return Xa.apply(this,arguments)}}()}];var db=bd("default",function(Xa){var Gb=window.lively.FreezerRuntime.recorderFor("lively.ide/text-editor.js"),sc=Gb.hasOwnProperty("TextEditor")&&"function"===typeof Gb.TextEditor?Gb.TextEditor:Gb.TextEditor=function(ub){if(!ub||!ub[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,
arguments)};return Ed(sc,Xa,[{key:Symbol["for"]("lively-instance-initialize"),value:function(ub){Ed._get(Object.getPrototypeOf(sc.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,ub);this.relayout();this._loadPromise=null}},{key:"isTextEditor",get:function(){return!0}},{key:"reload",value:function(){this.location=this.location}},{key:"relayout",value:function(){var ub=this.ui,sb=ub.urlInput,fa=ub.loadButton,Db=ub.saveButton,ab=ub.removeButton;ub=ub.contentText;sb.width=ub.width=
this.width;sb.top=0;sb.height=20;fa.extent=Db.extent=ab.extent=lc.pt(this.width/3,20);fa.topLeft=sb.bottomLeft;Db.topLeft=fa.topRight;ab.topLeft=Db.topRight;ub.topLeft=fa.bottomLeft;ub.height=this.height-fa.bottom}},{key:"whenLoaded",value:function(){var ub=jc(regeneratorRuntime.mark(function fa(){return regeneratorRuntime.wrap(function(Db){for(;;)switch(Db.prev=Db.next){case 0:return Db.abrupt("return",this._loadPromise||Promise.resolve(this));case 1:case "end":return Db.stop()}},fa,this)}));return function(){return ub.apply(this,
arguments)}}()},{key:"parseFileNameInput",value:function(ub){var sb=ub,fa=ub.lastIndexOf(":");if(-1<fa&&ub.slice(fa+1).match(/^[0-9]+$/)){var Db=Number(ub.slice(fa+1));sb=ub.slice(0,fa)}return{lineNumber:Db,url:sb}}},{key:"showFileContent",value:function(){var ub=jc(regeneratorRuntime.mark(function Db(fa){var ab,eb,kc,Vb;return regeneratorRuntime.wrap(function(pb){for(;;)switch(pb.prev=pb.next){case 0:ab=lc.promise.deferred();this._loadPromise=ab.promise;pb.prev=2;if(!this.customLoadContentAction){pb.next=
9;break}pb.next=6;return this.customLoadContentAction(this,fa);case 6:kc=pb.sent;pb.next=14;break;case 9:return eb=lc.resource(fa),pb.next=12,eb.read();case 12:kc=pb.sent,kc.constructor===ArrayBuffer&&(kc=(new TextDecoder).decode(kc));case 14:return kc||(kc=""),pb.next=17,this.prepareEditorForFile(fa,kc);case 17:if(Vb=this.getWindow())Vb.title=eb?eb.name():fa;ab.resolve(this);pb.next=26;break;case 22:pb.prev=22,pb.t0=pb["catch"](2),this.showError(pb.t0),ab.reject(pb.t0);case 26:return pb.abrupt("return",
this._loadPromise);case 27:case "end":return pb.stop()}},Db,this,[[2,22]])}));return function(fa){return ub.apply(this,arguments)}}()},{key:"prepareEditorForFile",value:function(){var ub=jc(regeneratorRuntime.mark(function Db(fa){var ab,eb,kc,Vb=arguments;return regeneratorRuntime.wrap(function(pb){for(;;)switch(pb.prev=pb.next){case 0:return ab=1<Vb.length&&void 0!==Vb[1]?Vb[1]:"","object"===Od(ab)&&(lc.__inter0__=ab,ab=lc.__inter0__.content,fa=lc.__inter0__.url),eb=this.ui.contentText,ab.length>
Math.pow(2,19)?this.setStatusMessage("File content very big, ".concat(lc.num.humanReadableByteSize(ab.length),". Styling is disabled"),lc.StatusMessageWarning):kc=lc.guessTextModeName(ab,fa),pb.prev=4,pb.next=7,eb.changeEditorMode(kc);case 7:pb.next=15;break;case 11:pb.prev=11,pb.t0=pb["catch"](4),console.warn("Failed to set mode ".concat(kc,": ").concat(pb.t0)),eb.changeEditorMode(null);case 15:eb.textString=ab,eb.gotoDocumentStart(),eb.scroll=lc.pt(0,0);case 18:case "end":return pb.stop()}},Db,
this,[[4,11]])}));return function(fa){return ub.apply(this,arguments)}}()},{key:"defaultSaveAction",value:function(){var ub=jc(regeneratorRuntime.mark(function Db(fa){var ab;return regeneratorRuntime.wrap(function(eb){for(;;)switch(eb.prev=eb.next){case 0:ab=fa.locationResource;if(!ab){eb.next=5;break}eb.next=4;return ab.write(fa.ui.contentText.textString);case 4:return eb.abrupt("return",{saved:!0});case 5:return eb.abrupt("return",{saved:!1,message:"No file selected"});case 6:case "end":return eb.stop()}},
Db)}));return function(fa){return ub.apply(this,arguments)}}()},{key:"focus",value:function(){this.ui.contentText.focus()}},{key:"close",value:function(){var ub=this.getWindow();ub?ub.close():this.remove()}},{key:"onWindowClose",value:function(){lc.signal(this,"closed")}},{key:"commands",get:function(){return lc.editorCommands.concat(Ed._get(Object.getPrototypeOf(sc.prototype),"commands",this))}},{key:"keybindings",get:function(){return[{keys:{mac:"Meta-S",win:"Ctrl-S"},command:"save file"},{keys:"Alt-Up",
command:"focus url input"},{keys:"Alt-Down",command:"focus content text"}].concat(Ed._get(Object.getPrototypeOf(sc.prototype),"keybindings",this))}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"TextEditor"}},{key:"openURL",value:function(ub,sb){return this.openInWindow(Object.assign({location:ub},sb))}},{key:"openAsEDITOR",value:function(ub,sb){var fa=this.openURL(ub,sb);return new Promise(function(Db,ab){lc.once(fa,"contentSaved",Db,"call",{updater:function(eb){eb(null,"saved");
this.sourceObj.close()}});lc.once(fa,"closed",Db,"call",{updater:function(eb){return eb(null,"aborted")}})})}},{key:"openInWindow",value:function(ub){ub=new this(ub);ub.env.world.openInWindow(ub).activate();return ub}},{key:"properties",get:function(){return{name:{defaultValue:"text editor"},fill:{defaultValue:lc.Color.white},border:{defaultValue:{width:1,color:lc.Color.black}},extent:{defaultValue:lc.pt(700,600)},historyId:{defaultValue:"lively.morphic-text editor url"},submorphs:{after:["historyId"],
initialize:function(ub){if(!ub.length){this.submorphs=[lc.Text.makeInputLine({name:"urlInput",historyId:this.historyId}),{name:"loadButton",type:"button",label:"reload"},{name:"saveButton",type:"button",label:"save"},{name:"removeButton",type:"button",label:"remove"},Object.assign({},lc.config.codeEditor.defaultStyle,{name:"contentText",type:"text",lineWrapping:!1})];var sb=this.ui;ub=sb.urlInput;var fa=sb.loadButton,Db=sb.saveButton;sb=sb.removeButton;lc.connect(this,"extent",this,"relayout");lc.connect(ub,
"inputAccepted",this,"location");lc.connect(fa,"fire",this,"execCommand",{converter:function(){return"load file"}});lc.connect(Db,"fire",this,"execCommand",{converter:function(){return"save file"}});lc.connect(sb,"fire",this,"execCommand",{converter:function(){return"remove file"}})}}},ui:{readOnly:!0,derived:!0,after:["submorphs"],get:function(){var ub=fe(this.submorphs,5);return{urlInput:ub[0],loadButton:ub[1],saveButton:ub[2],removeButton:ub[3],contentText:ub[4]}}},location:{derived:!0,after:["submorphs"],
get:function(){return this.ui.urlInput.input},set:function(ub){var sb=this.parseFileNameInput(ub),fa=sb.url;sb=sb.lineNumber;var Db=this.ui,ab=Db.contentText;Db=Db.urlInput;Db.input=ub||"";Db.acceptInput();Db.isFocused()&&ab.focus();this.showFileContent(fa);"undefined"!==typeof sb&&(this.lineNumber=sb)}},locationResource:{derived:!0,after:["location"],get:function(){var ub=this.parseFileNameInput(this.location).url;return lc.resource(ub)},set:function(ub){this.location=ub.url}},lineNumber:{derived:!0,
after:["location"],get:function(){return this.ui.contentText.cursorPosition.row},set:function(ub){var sb=this,fa=Number(ub);isNaN(fa)||this.whenLoaded().then(function(){var Db=sb.ui.contentText;Db.cursorPosition={row:fa,column:0};Db.centerRow(fa)})}},customSaveAction:{},customLoadContentAction:{}}}}],Gb,{pathInPackage:function(){return"./text-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.ide",
version:"0.1.0"}}},{start:2019,end:10126})}(lc.Morph));lc["default"]=db}}});