System.register(["./__rootModule___commonjs-entry-51a55f66.js","@babel/plugin-syntax-import-meta"],function(bd){var Dd,se,Rc,ad,Ne;return{setters:[function(Cb){Dd=Cb.s;se=Cb.v;Rc=Cb.bA;ad=Cb.am;Ne=Cb.i},function(){}],execute:function(){var Cb=window.lively.FreezerRuntime.recorderFor("lively.morphic/text/occur.js");Cb.findOccurPlugin=function(ve){return ve.plugins.slice().reverse().find(function(uc){return uc.isOccurPlugin})};Cb.arr=Dd;Cb.obj=se;Cb.TextSearcher=Rc;Cb.KeyHandler=ad;Cb.occurKeyHandler=
Object.assign(Cb.KeyHandler.withBindings([{keys:"Escape|Ctrl-G",command:"occur exit"},{keys:"Enter",command:"occur accept"}]),{isOccurHandler:!0});var Sd=bd("occurStartCommand",{name:"occur",exec:function(ve){var uc=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};uc.needle&&ve.addPlugin(new Cb.Occur(uc));return!!uc.needle}});Cb.occurStartCommand=Sd;Cb.occurStartCommand=Sd;Cb.occurCommands=[{name:"occur exit",exec:function(ve){var uc=Cb.findOccurPlugin(ve);if(!uc)return!1;uc.options.translatePosition=
!0;ve.removePlugin(uc);(ve=Cb.findOccurPlugin(ve))&&ve.highlight();return!0},readOnly:!0},{name:"occur accept",bindKey:"Enter",exec:function(ve){var uc=Cb.findOccurPlugin(ve);if(!uc)return!1;uc.options.translatePosition=!0;ve.removePlugin(uc);(ve=Cb.findOccurPlugin(ve))&&ve.highlight();return!0},readOnly:!0}];Sd=bd("Occur",function(ve){var uc=window.lively.FreezerRuntime.recorderFor("lively.morphic/text/occur.js"),dd=uc.hasOwnProperty("Occur")&&"function"===typeof uc.Occur?uc.Occur:uc.Occur=function(vd){if(!vd||
!vd[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments)};return Ne(dd,ve,[{key:Symbol["for"]("lively-instance-initialize"),value:function(){var vd=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.options=vd;vd.textMorph&&(this.textMorph=vd.textMorph)}},{key:"__serialize__",value:function(){return{__expr__:"new Occur(".concat(Cb.obj.inspect(Cb.obj.dissoc(this.options,["textMorph"])),")"),bindings:{"lively.morphic/text/occur.js":["Occur"]}}}},
{key:"isOccurPlugin",get:function(){return!0}},{key:"attach",value:function(vd){this.textMorph=vd;vd=this.textMorph.cursorPosition;this.displayOccurContent(this.options)&&(vd=this.originalToOccurPosition(vd),this.textMorph.cursorPosition=vd);return this}},{key:"detach",value:function(vd){this.removeHighlight();vd=(vd=this.options.translatePosition&&this.textMorph.cursorPosition)&&this.occurToOriginalPosition(vd);this.displayOriginalContent();vd&&(this.textMorph.cursorPosition=vd);this.textMorph=null;
return this}},{key:"getKeyHandlers",value:function(vd){return vd.concat(Cb.occurKeyHandler)}},{key:"getCommands",value:function(vd){return Cb.occurCommands.concat(vd)}},{key:"matchingLines",value:function(){var vd=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{needle:""};if(!vd.needle)return[];var Ed=this.textMorph.document.lineStrings;vd=(new Cb.TextSearcher(this.textMorph)).searchForAll(Object.assign({},vd,{start:{column:0,row:0}}));return Cb.arr.groupBy(vd,function(fe){return fe.range.start.row}).mapGroups(function(fe,
jc){fe=jc[0].range.start.row;return{row:fe,ranges:jc.map(function(Od){return Od.range}),line:Ed[fe]}}).toArray()}},{key:"displayOccurContent",value:function(vd){this._originalDocument=this.textMorph.document;var Ed=this._originalDocument.constructor,fe=this.matchingLines(vd),jc=fe.map(function(Od){return Od.line});Ed=this._document=new Ed(jc);Ed._occurMatchingLines=fe;return 0<fe.length?(this.textMorph.changeDocument(Ed,!0),this.highlight(vd.needle),!0):!1}},{key:"displayOriginalContent",value:function(){this.textMorph.changeDocument(this._originalDocument)}},
{key:"occurToOriginalPosition",value:function(vd){var Ed=this._document._occurMatchingLines;return Ed&&Ed[vd.row]?{row:Ed[vd.row].row,column:vd.column}:vd}},{key:"originalToOccurPosition",value:function(vd){var Ed=this._document._occurMatchingLines,fe={row:0,column:0};if(!Ed)return fe;for(var jc=0;jc<Ed.length;jc++)if(Ed[jc].row===vd.row)return{row:jc,column:vd.column};return fe}},{key:"highlight",value:function(vd){var Ed=this;this.removeHighlight();var fe={borderRadius:"4px",backgroundColor:"rgba(87, 255, 8, 0.25)",
position:"absolute","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box","box-sizing":"border-box","box-shadow":"0 0 4px rgb(91, 255, 50)"};this._document._occurMatchingLines.flatMap(function(jc,Od){return jc.ranges.map(function(qb){return{start:{column:qb.start.column,row:Od},end:{column:qb.end.column,row:Od}}})}).map(function(jc,Od){return{id:"occur-"+Od,range:jc,style:fe}}).forEach(function(jc){return Ed.textMorph.addMarker(jc)})}},{key:"removeHighlight",value:function(){var vd=this;
(this.textMorph.markers||[]).filter(function(Ed){return 0===Ed.id.indexOf("occur-")}).forEach(function(Ed){return vd.textMorph.removeMarker(Ed)})}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"Occur"}}],uc,{pathInPackage:function(){return"./text/occur.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.morphic",version:"0.1.2"}}},{start:1776,
end:6377})}(void 0));Cb.Occur=Sd;Cb.Occur=Sd}}});