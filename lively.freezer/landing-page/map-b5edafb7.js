System.register(["./__rootModule___commonjs-entry-51a55f66.js","./canvas-2fd3d40b.js","@babel/plugin-syntax-import-meta"],function(bd){var Dd,se,Rc,ad,Ne,Cb,Sd,ve,uc;return{setters:[function(dd){Dd=dd.d;se=dd.l;Rc=dd.a;ad=dd.b;Ne=dd.C;Cb=dd.b4;Sd=dd.i;ve=dd.N},function(dd){uc=dd.C},function(){}],execute:function(){var dd=window.lively.FreezerRuntime.recorderFor("lively.morphic/text/map.js");dd.Canvas=uc;dd.connect=Dd;dd.fun=se;dd.promise=Rc;dd.pt=ad;dd.Color=Ne;dd.addClassMappings=Cb;var vd=bd("default",
function(Ed){var fe=window.lively.FreezerRuntime.recorderFor("lively.morphic/text/map.js"),jc=fe.hasOwnProperty("TextMap")&&"function"===typeof fe.TextMap?fe.TextMap:fe.TextMap=function(Od){if(!Od||!Od[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments)};return Sd(jc,Ed,[{key:"onChange",value:function(Od){"extent"===Od.prop&&this.update();return Sd._get(Object.getPrototypeOf(jc.prototype),"onChange",this).call(this,Od)}},{key:"reset",
value:function(){this.border={width:0};this.preserveContents=!0}},{key:"attachTo",value:function(Od){var qb=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!1;this.textMorph&&this.detachFrom(this.textMorph);this.textMorph=Od;dd.connect(Od,"viewChange",this,"updateDebounced");dd.connect(Od,"textChange",this,"updateDebounced");dd.connect(Od,"selectionChange",this,"updateDebounced");qb&&(this.textMorph.addMorph(this),this.height=this.textMorph.height-this.textMorph.padding.top());this.update();
this.makeDirty()}},{key:"detachFromCurrentTextMorph",value:function(){this.detachFrom(this.textMorph);this.textMorph=null}},{key:"detachFrom",value:function(Od){var qb=this;Od&&Od.attributeConnections.forEach(function(ic){return ic.targetObj===qb&&ic.disconnect()})}},{key:"updateDebounced",value:function(){var Od=this;this.owner===this.textMorph&&(this.topRight=this.textMorph.innerBounds().topRight().addPt(this.textMorph.scroll));dd.fun.throttleNamed("update-"+this.id,100,function(){return Od.update()})()}},
{key:"measure",get:function(){var Od=this.height;return{width:this.width,height:Od,heightPerLine:Math.min(2,Od/this.textMorph.document.lines.length),widthPerChar:.5}}},{key:"update",value:function(){function Od(da,ka){var va=da.start;da=Math.max((da.end.row-va.row+1)*Xa,1);qb.fillStyle=ka;qb.fillRect(0,va.row*Xa,lc,da)}var qb=this.context,ic=this.textMorph,Wb=this.measure,lc=Wb.width,db=Wb.height,Xa=Wb.heightPerLine,Gb=Wb.widthPerChar,sc=ic.document;Wb=ic.markers;var ub=ic.selections,sb=ic.textLayout.whatsVisible(ic),
fa=sb.startRow;sb=sb.endRow;this.owner===ic&&(this.topRight=this.textMorph.innerBounds().topRight().addPt(this.textMorph.scroll).subXY(this.textMorph.padding.top()));if(qb){this.clear(null);qb.fillStyle="rgba(0,0,0, 0.1)";qb.fillRect(0,0,lc,fa*Xa);qb.fillStyle="rgba(0,0,0, 0.1)";qb.fillRect(0,sb*Xa,lc,db-sb*Xa);ic=0;qb.beginPath();qb.lineWidth=Math.max(1,Xa-.3);qb.strokeStyle="gray";db=ve(sc.lines);var Db;try{for(db.s();!(Db=db.n()).done;){var ab=Db.value.text,eb=ab.length,kc=ab.trimLeft().length;
sc=eb-kc;qb.moveTo(sc,ic);qb.lineTo(sc+kc*Gb,ic);sc=0;ic+=Xa}}catch(da){db.e(da)}finally{db.f()}qb.stroke();qb.beginPath();qb.strokeStyle="black";qb.moveTo(0,fa*Xa);qb.lineTo(lc,fa*Xa);qb.moveTo(0,sb*Xa);qb.lineTo(lc,sb*Xa);qb.stroke();qb.fillStyle="blue";Db=ve(ub);var Vb;try{for(Db.s();!(Vb=Db.n()).done;){var pb=Vb.value;pb.isEmpty()||Od(pb,"blue",!0)}}catch(da){Db.e(da)}finally{Db.f()}Vb=ve(Wb);var Nb;try{for(Vb.s();!(Nb=Vb.n()).done;){var zb=Nb.value,rb=zb.style["background-color"]||"red";if("string"===
typeof rb){var Ib=dd.Color.fromString(rb);Ib&&.5>Ib.a&&(Ib.a=.9,rb=Ib.toRGBAString())}Od(zb.range,rb,!0)}}catch(da){Vb.e(da)}finally{Vb.f()}}}},{key:"onMouseDown",value:function(Od){var qb=this,ic=this.textMorph,Wb=this.measure;Wb.width;Wb.height;Wb=Wb.heightPerLine;Od=Od.positionIn(this);ic.scrollPositionIntoView({row:Math.round(Od.y/Wb),column:0});dd.promise.delay(100).then(function(){return qb.update()})}},{key:"onDrag",value:function(Od){this.onMouseDown(Od)}}],[{key:Symbol["for"]("__LivelyClassName__"),
get:function(){return"TextMap"}},{key:"openInside",value:function(Od){var qb=new dd.TextMap;qb.attachTo(Od);return qb}},{key:"properties",get:function(){return{textMorph:{},relativeBoundsInTextMorph:{},extent:{defaultValue:dd.pt(60,50)},markers:{},draggable:{defaultValue:!0}}}}],fe,{pathInPackage:function(){return"./text/map.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.morphic",
version:"0.1.2"}}},{start:251,end:5455})}(dd.Canvas));dd.addClassMappings({textmap:dd.TextMap});dd["default"]=vd}}});