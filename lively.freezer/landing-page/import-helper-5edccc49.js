System.register("./__rootModule___commonjs-entry-51a55f66.js ./index-61952933.js ./index-616023be.js ./top-bar.cp-fa0cb96d.js ./loading-indicator.cp-98e470a2.js @babel/plugin-syntax-import-meta ./tooltips.cp-3c41b378.js ./canvas-2fd3d40b.js lively.collab ./ui.cp-8dfc076f.js ./index-42118cd5.js ./interface-1a7f3c67.js ./popups.cp-5b9fb681.js ./list.cp-840d1cf8.js ./messages.cp-817cc06d.js rollup @rollup/plugin-json ./editor-plugin-5397d87c.js ./editor-modes-aae4d878.js ./helpers-94ca076d.js @rollup/plugin-commonjs rollup-plugin-polyfill-node ./user-ui-98206202.js ./object-classes-06d7e61a.js".split(" "),function(bd){var Dd,
se,Rc,ad,Ne,Cb,Sd,ve,uc,dd,vd,Ed,fe,jc,Od,qb;return{setters:[function(ic){Dd=ic.s;se=ic.t;Rc=ic.b;ad=ic.F;Ne=ic.aV;Cb=ic.aK;Sd=ic.i;ve=ic._;uc=ic.K;dd=ic.N},function(){},function(ic){vd=ic.I;Ed=ic.G;fe=ic.f},function(ic){jc=ic.c;Od=ic.P},function(ic){qb=ic.L},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}],
execute:function(){function ic(pb,Nb,zb){zb=(zb||{}).recordUndo;zb=void 0===zb?!0:zb;var rb=pb.textString,Ib=pb.editorPlugin.parse();Ib=Vb.GlobalInjector.run(rb,Nb,Ib);Nb=Ib.status;rb=Ib.generated;var da=Ib.from;Ib.to;Ib=pb.indexToPosition(da);if("not modified"===Nb)return null;zb&&pb.undoManager.group();Nb=pb.insertText(rb,Ib);zb&&pb.undoManager.group();return Nb}function Wb(pb,Nb,zb){return lc.apply(this,arguments)}function lc(){lc=ve(regeneratorRuntime.mark(function Ib(Nb,zb,rb){var da,ka,va,Fa,
M,Aa,wb,Na,hb,Bb,ba,dc,la,Fb,vb,Ia,xb,Rb,yc,id,ob;return regeneratorRuntime.wrap(function(Pb){for(;;)switch(Pb.prev=Pb.next){case 0:da=Object.assign({gotoImport:!0,insertImportAtCursor:!1,recordUndo:!0,System},rb);ka=da.gotoImport;va=da.insertImportAtCursor;Fa=da.recordUndo;M=da.System;if(Aa=Nb.pluginFind(function(tb){return tb.isJSEditorPlugin})){Pb.next=4;break}throw Error("cannot find js plugin of ".concat(Nb));case 4:return wb=Aa.evalEnvironment.targetModule,Pb.next=7,Aa.systemInterface().getPackageForModule(wb);
case 7:Na=Pb.sent,dc=[],la=[],ka&&Nb.saveMark(),Fa&&Nb.undoManager.group(),zb=zb.slice();case 13:if(!zb.length){Pb.next=31;break}Fb=zb.shift();vb=Nb.textString;Ia=Vb.ImportInjector.run(M,wb,Na,vb,Fb);xb=Ia.generated;hb=Ia.from;Bb=Ia.to;Rb=Ia.standaloneImport;yc=Ia.importedVarName;ba=Nb.indexToPosition(hb);xb&&la.push(Nb.insertText(xb,ba));yc&&dc.push(yc);if(!Rb){Pb.next=29;break}Pb.prev=21;Pb.next=24;return Aa.runEval(Rb);case 24:Pb.next=29;break;case 26:Pb.prev=26,Pb.t0=Pb["catch"](21),console.error("Error when trying to import ".concat(Rb,
": ").concat(Pb.t0.stack));case 29:Pb.next=13;break;case 31:return va&&(id=dc.join("\n"),ob=Nb.cursorPosition,Nb.getLine(ob.row).slice(0,ob.col),Nb.selection.text=id,ka||(Nb.scrollCursorIntoView(),Nb.focus())),Fa&&Nb.undoManager.group(),ka&&(Nb.selection=la.length?Vb.arr.last(la):{start:ba,end:Nb.indexToPosition(Bb)},Nb.scrollCursorIntoView(),Nb.focus()),Pb.abrupt("return",{ranges:la});case 35:case "end":return Pb.stop()}},Ib,null,[[21,26]])}));return lc.apply(this,arguments)}function db(pb,Nb){return Xa.apply(this,
arguments)}function Xa(){Xa=ve(regeneratorRuntime.mark(function rb(Nb,zb){var Ib,da;return regeneratorRuntime.wrap(function(ka){for(;;)switch(ka.prev=ka.next){case 0:if(Ib=Nb.pluginFind(function(va){return va.isJSEditorPlugin})){ka.next=3;break}throw Error("cannot find js plugin of ".concat(Nb));case 3:return ka.t0=Vb,ka.next=6,Ib.systemInterface();case 6:return ka.t1=ka.sent,ka.t2={world:Nb.world(),progress:zb.progress,requester:zb.requester},ka.next=10,ka.t0.interactivelyChooseImports.call(ka.t0,
ka.t1,ka.t2);case 10:return da=ka.sent,ka.abrupt("return",da?Vb.injectImportsIntoText(Nb,da,zb):null);case 12:case "end":return ka.stop()}},rb)}));return Xa.apply(this,arguments)}function Gb(pb,Nb){return sc.apply(this,arguments)}function sc(){sc=ve(regeneratorRuntime.mark(function rb(Nb,zb){var Ib,da;return regeneratorRuntime.wrap(function(ka){for(;;)switch(ka.prev=ka.next){case 0:return zb=Object.assign({System,world:$world},zb),ka.next=3,Vb.LoadingIndicator.runFn(function(va){var Fa=new Vb.ProgressMonitor({handlers:{searchProgress:function(M,
Aa){va.progress=Aa;va.label=M}}});return Vb.config.ide.workerEnabled?Vb.callService("exportsOfModules",{excludedPackages:Vb.config.ide.js.ignoredPackages,livelySystem:Nb,progress:new Vb.ProgressMonitor({handlers:{workerProgress:function(M,Aa){va.progress=Aa;va.label=M}}})}):Nb.exportsOfModules({excludedPackages:Vb.config.ide.js.ignoredPackages,progress:Fa})},"computing imports...");case 3:return Ib=ka.sent,ka.next=6,Vb.ExportPrompt.run(zb.world,Ib,zb.requester);case 6:return da=ka.sent,ka.abrupt("return",
da.length?da:null);case 8:case "end":return ka.stop()}},rb)}));return sc.apply(this,arguments)}function ub(pb,Nb){Nb=Nb||[];pb=Vb.fuzzyParse(pb,{withComments:!0});return Vb.query.findGlobalVarRefs(pb,{jslintGlobalComment:!0}).filter(function(zb){return!Nb.includes(zb.name)})}function sb(pb,Nb){return fa.apply(this,arguments)}function fa(){fa=ve(regeneratorRuntime.mark(function rb(Nb,zb){var Ib,da,ka,va,Fa,M,Aa,wb,Na,hb,Bb,ba,dc,la,Fb,vb,Ia,xb,Rb,yc,id,ob,Pb,tb,xc,Pc,nd,Id,Hb,Kd,vc;return regeneratorRuntime.wrap(function(Qc){for(;;)switch(Qc.prev=
Qc.next){case 0:return vc=function(){vc=ve(regeneratorRuntime.mark(function Cc(){return regeneratorRuntime.wrap(function(zc){for(;;)switch(zc.prev=zc.next){case 0:return zc.t0=Vb,zc.next=3,ka();case 3:return zc.t1=zc.sent,zc.t2=dc,zc.t3=function(Fc){return!Na.includes(Fc.name)},zc.abrupt("return",la=zc.t0.undeclaredVariables.call(zc.t0,zc.t1,zc.t2).filter(zc.t3));case 7:case "end":return zc.stop()}},Cc)}));return vc.apply(this,arguments)},Kd=function(){return vc.apply(this,arguments)},Ib=zb||{},da=
Ib.sourceUpdater,ka=Ib.sourceRetriever,va=Ib.highlightUndeclared,Fa=Ib.requester,M=Ib.keepTextPosition,Aa=void 0===M?!0:M,wb=Ib.ignore,Na=void 0===wb?[]:wb,hb=Ib.autoApplyIfSingleChoice,Bb=void 0===hb?!1:hb,ba=Ib.knownGlobals,dc=void 0===ba?Nb.evalEnvironment.knownGlobals||[]:ba,"function"!==typeof ka&&(ka=function(){return Nb.textString}),"function"!==typeof va&&(va=function(kb){var Cc=kb.end;kb={start:Nb.indexToPosition(kb.start),end:Nb.indexToPosition(Cc)};Nb.selection=kb;Nb.centerRange(kb)}),
Fb=[],Qc.next=8,Kd();case 8:if(la.length){Qc.next=10;break}return Qc.abrupt("return",Fb);case 10:Na=Na.slice();if(vb=Nb.pluginFind(function(kb){return kb.isJSEditorPlugin})){Qc.next=14;break}throw Error("cannot find js plugin of ".concat(Nb));case 14:return Qc.next=16,vb.systemInterface();case 16:return Ia=Qc.sent,Qc.next=19,Ia.exportsOfModules({excludedPackages:Vb.config.ide.js.ignoredPackages});case 19:xb=Qc.sent,Nb.collapseSelection(),Aa&&(Rb=Nb.scroll,yc=Nb.cursorPosition,id=Nb.addAnchor(Object.assign({},
yc,{id:"fix-undeclared-vars"}))),ob=!1;case 23:return Qc.next=26,Kd();case 26:if(la.length){Qc.next=28;break}return Qc.abrupt("break",69);case 28:return Pb=la[0],tb=Pb.name,xc=Vb.matchingExportsForUndeclared(Pb,xb),Pc=["ignore for now","declare as global"].concat(xc.map(function(kb){return{isListItem:!0,value:kb,label:Vb.labelForExport(kb)}})),nd=void 0,Qc.next=35,va(Pb);case 35:if(!Bb||1!==xc.length){Qc.next=39;break}nd=xc[0];Qc.next=46;break;case 39:return Qc.next=41,$world.filterableListPrompt("Found undeclared variable ".concat(tb,
".  How should it be handled?"),Pc,{requester:Fa,theme:"dark",preselect:2<Pc.length?2:0});case 41:Vb.__inter0__=Qc.sent;Id=Vb.__inter0__.selected;Hb=uc(Id,1);if(nd=Hb[0]){Qc.next=46;break}ob=!0;return Qc.abrupt("break",69);case 46:if(nd!==Pc[0]){Qc.next=49;break}Na.push(tb);return Qc.abrupt("continue",23);case 49:if(nd!==Pc[1]){Qc.next=59;break}Fb.push({type:"global",name:tb});if("function"!==typeof da){Qc.next=56;break}Qc.next=54;return da("global",[tb]);case 54:Qc.next=58;break;case 56:return Qc.next=
58,Vb.declareVarNamesAsGlobals(Nb,[tb],{recordUndo:!0,sourceUpdater:da});case 58:return Qc.abrupt("continue",23);case 59:Fb.push({type:"import",imported:nd});if("function"!==typeof da){Qc.next=65;break}Qc.next=63;return da("import",[nd]);case 63:Qc.next=67;break;case 65:return Qc.next=67,Vb.injectImportsIntoText(Nb,[nd],{gotoImport:!1,insertImportAtCursor:!1,recordUndo:!0});case 67:Qc.next=23;break;case 69:return Aa&&(Nb.scroll=Rb,Nb.cursorPosition=id.position,Nb.removeAnchor(id)),Qc.abrupt("return",
ob?null:Fb);case 71:case "end":return Qc.stop()}},rb)}));return fa.apply(this,arguments)}function Db(pb,Nb){return ab.apply(this,arguments)}function ab(){ab=ve(regeneratorRuntime.mark(function rb(Nb,zb){var Ib,da,ka,va,Fa,M,Aa,wb,Na;return regeneratorRuntime.wrap(function(hb){for(;;)switch(hb.prev=hb.next){case 0:return zb=Object.assign({world:Nb.world()},zb),Ib=Nb.textString,hb.next=4,Vb.chooseUnusedImports(Ib,zb);case 4:if(da=hb.sent){hb.next=7;break}return hb.abrupt("return","canceled");case 7:if(da.changes&&
da.changes.length){hb.next=9;break}return hb.abrupt("return","nothing to remove");case 9:Nb.undoManager.group();ka=dd(da.changes);try{for(ka.s();!(va=ka.n()).done;)Fa=va.value,M=Fa.replacement,Aa=Fa.start,wb=Fa.end,Na={start:Nb.indexToPosition(Aa),end:Nb.indexToPosition(wb)},Nb.replace(Na,M)}catch(Bb){ka.e(Bb)}finally{ka.f()}Nb.undoManager.group();return hb.abrupt("return","imports removed");case 14:case "end":return hb.stop()}},rb)}));return ab.apply(this,arguments)}function eb(pb,Nb){return kc.apply(this,
arguments)}function kc(){kc=ve(regeneratorRuntime.mark(function rb(Nb,zb){var Ib,da,ka,va;return regeneratorRuntime.wrap(function(Fa){for(;;)switch(Fa.prev=Fa.next){case 0:zb=Object.assign({world:$world},zb);if((Ib=Vb.ImportRemover.findUnusedImports(Nb))&&Ib.length){Fa.next=4;break}return Fa.abrupt("return",null);case 4:return da=Ib.map(function(M){var Aa=M.from;return{isListItem:!0,label:["".concat(M.local),{fontWeight:"bold"}," from ",{},"".concat(Aa,"\n"),{fontStyle:"italic"}],value:M}}),Fa.next=
7,zb.world.editListPrompt("Which imports should be removed?",da,{multiSelect:!0,requester:zb.requester});case 7:ka=Fa.sent;if((va=ka.list)&&va.length){Fa.next=11;break}return Fa.abrupt("return",[]);case 11:return Fa.abrupt("return",Vb.ImportRemover.removeImports(Nb,va));case 12:case "end":return Fa.stop()}},rb)}));return kc.apply(this,arguments)}bd({chooseUnusedImports:eb,cleanupUnusedImports:Db,declareVarNamesAsGlobals:ic,injectImportsIntoText:Wb,interactivelyChooseImports:Gb,interactivelyInjectImportIntoText:db,
interactivlyFixUndeclaredVariables:sb,undeclaredVariables:ub});var Vb=window.lively.FreezerRuntime.recorderFor("lively.ide/js/import-helper.js");Vb.declareVarNamesAsGlobals=ic;Vb.injectImportsIntoText=Wb;Vb.interactivelyInjectImportIntoText=db;Vb.interactivelyChooseImports=Gb;Vb.labelForExport=function(pb){var Nb=pb.type,zb=pb.exported,rb=pb.local,Ib=pb.fromModule,da=pb.pathInPackage,ka=pb.packageName;pb=pb.packageVersion;zb="default"===zb?"".concat(rb," (default)"):zb;if(Ib)var va=" rexported from ".concat(Ib);
Ib=" [".concat(ka,"/").concat(da);pb&&(Ib+=" ".concat(pb));Ib+="]";return[zb,{},"".concat(Nb," ").concat(va||""," ").concat(Ib),{fontSize:"70%",lineHeight:"175%",textStyleClasses:["truncated-text","annotation"]}]};Vb.ensureFullModuleIdOfFromModule=function(pb){var Nb=pb.fromModule;pb=pb.packageURL;return Nb?Nb.startsWith(".")?Vb.string.joinPath(pb||System.baseURL,Nb):Nb:null};Vb.matchingExportsForUndeclared=function(pb,Nb){var zb=2<arguments.length&&void 0!==arguments[2]?arguments[2]:!0,rb=Nb.filter(function(da){return("default"===
da.exported?da.local:da.exported)===pb.name}),Ib=rb.filter(function(da){return da.fromModule?!0:!rb.some(function(ka){return da!==ka&&ka.fromModule?Vb.ensureFullModuleIdOfFromModule(ka)===da.moduleId:!1})});return zb?Ib:Vb.arr.withoutAll(rb,Ib)};Vb.undeclaredVariables=ub;Vb.interactivlyFixUndeclaredVariables=sb;Vb.cleanupUnusedImports=Db;Vb.chooseUnusedImports=eb;Vb.arr=Dd;Vb.string=se;Vb.pt=Rc;Vb.LoadingIndicator=qb;Vb.config=ad;Vb.fuzzyParse=Ne;Vb.query=Cb;Vb.ImportInjector=vd;Vb.GlobalInjector=
Ed;Vb.ImportRemover=fe;Vb.callService=jc;Vb.ProgressMonitor=Od;Vb.declareVarNamesAsGlobals=ic;Vb.injectImportsIntoText=Wb;Vb.interactivelyInjectImportIntoText=db;Vb.interactivelyChooseImports=Gb;(function(pb){var Nb=window.lively.FreezerRuntime.recorderFor("lively.ide/js/import-helper.js"),zb=Nb.hasOwnProperty("ExportPrompt")&&"function"===typeof Nb.ExportPrompt?Nb.ExportPrompt:Nb.ExportPrompt=function(rb){if(!rb||!rb[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,
arguments)};return Sd(zb,pb,[{key:"run",value:function(){var rb=ve(regeneratorRuntime.mark(function va(da,ka){var Fa,M,Aa,wb=arguments;return regeneratorRuntime.wrap(function(Na){for(;;)switch(Na.prev=Na.next){case 0:return Fa=2<wb.length&&void 0!==wb[2]?wb[2]:da,Na.next=3,da.filterableListPrompt("Select import",ka.map(function(hb){return{isListItem:!0,value:hb,label:Vb.labelForExport(hb)}}),{multiSelect:!0,historyId:"lively.ide/js-interactively-import",extent:Vb.pt(800,500),fuzzy:"value.exported",
requester:Fa,sortFunction:function(hb,Bb){Bb=Bb.value;var ba=Bb.exported;Bb=Bb.isMain;ba=(ba||"").toLowerCase();var dc=Bb?-1:0;hb.lowercasedTokens.forEach(function(la){return dc-=ba.startsWith(la)?10:ba.includes(la)?5:0});return Vb.arr.sum(hb.lowercasedTokens.map(function(la){return Vb.string.levenshtein(ba.toLowerCase(),la)}))+dc}});case 3:return M=Na.sent,Aa=M.selected,Na.abrupt("return",Aa);case 6:case "end":return Na.stop()}},va)}));return function(da,ka){return rb.apply(this,arguments)}}()}],
[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"ExportPrompt"}},{key:"run",value:function(rb,Ib){var da=2<arguments.length&&void 0!==arguments[2]?arguments[2]:rb;return(new this).run(rb,Ib,da)}}],Nb,{pathInPackage:function(){return"./js/import-helper.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.ide",version:"0.1.0"}}},{start:5849,end:6989})})(void 0);
Vb.undeclaredVariables=ub;Vb.interactivlyFixUndeclaredVariables=sb;Vb.cleanupUnusedImports=Db;Vb.chooseUnusedImports=eb}}});