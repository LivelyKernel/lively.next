System.register(["./__rootModule___commonjs-entry-51a55f66.js"],function(bd){var Dd,se,Rc,ad,Ne,Cb,Sd,ve;return{setters:[function(uc){Dd=uc.b;se=uc.P;Rc=uc.r;ad=uc.C;Ne=uc.M;Cb=uc.I;Sd=uc.d;ve=uc.i}],execute:function(){var uc=window.lively.FreezerRuntime.recorderFor("lively.components/canvas.js");uc.pt=Dd;uc.Point=se;uc.rect=Rc;uc.Color=ad;uc.Morph=Ne;uc.Image=Cb;uc.connect=Sd;var dd=bd("C",function(vd){var Ed=window.lively.FreezerRuntime.recorderFor("lively.components/canvas.js"),fe=Ed.hasOwnProperty("Canvas")&&
"function"===typeof Ed.Canvas?Ed.Canvas:Ed.Canvas=function(jc){if(!jc||!jc[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments)};return ve(fe,vd,[{key:"context",get:function(){if(this._canvas)return this._canvas.getContext(this.contextType);this.world()&&this.env.renderer.getNodeForMorph(this)||console.warn("Context not yet rendered. Please ensure that the Canvas Morph has been rendered first before accessing the context. This can be achieved by waiting for the whenRendered() promise before you proceed accessing the context property.");
return null}},{key:"_canvas",set:function(jc){var Od=this.__canvas__;this.__canvas__=jc;this.restoreContent(Od,jc)}},{key:"_canvas",get:function(){return this.__canvas__}},{key:Symbol["for"]("lively-instance-initialize"),value:function(){var jc=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};ve._get(Object.getPrototypeOf(fe.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,jc);uc.connect(this,"extent",this,"onExtentChanged")}},{key:"afterRender",value:function(jc,Od){Od?
this._canvas=jc:"function"===typeof this.__canvas_init__&&(this.__canvas_init__(),delete this.__canvas_init__)}},{key:"restoreContent",value:function(jc,Od){var qb=this.contextType,ic=this.preserveContents;"function"===typeof this.__canvas_init__?(this.__canvas_init__(),delete this.__canvas_init__):ic&&"2d"===qb&&jc&&jc!==Od&&this.context.drawImage(jc,0,0)}},{key:"onExtentChanged",value:function(){var jc=this;if(this._canvas&&this.preserveContents&&this.context.getImageData){var Od=this._canvas,qb=
Od.width;Od=Od.height;if(qb&&Od){var ic=this.context.getImageData(0,0,qb,Od);this.__canvas_init__=function(){jc.context.putImageData(ic,0,0)}}}}},{key:"clear",value:function(jc){var Od=this.context;if(Od){var qb=this._canvas,ic=qb.width;qb=qb.height;Od.save();Od.setTransform(1,0,0,1,0,0);jc?(jc.toCSSString&&(jc=jc.toCSSString()),Od.fillStyle=jc,Od.fillRect(0,0,ic,qb)):Od.clearRect(0,0,ic,qb);Od.restore()}}},{key:"render",value:function(jc){return jc.renderCanvas(this)}},{key:"withContextDo",value:function(jc){var Od=
this;this._canvas?jc(this.context):this.__canvas_init__=function(){return jc(Od.context)}}},{key:"toDataURI",value:function(){return this._canvas&&this._canvas.toDataURL()}},{key:"fromDataURI",value:function(jc){var Od=this,qb=new uc.Image;qb.onload=function(){Od._canvas.width=qb.width;Od._canvas.height=qb.height;Od.context.drawImage(qb,0,0)};qb.src=jc}},{key:"imageData",value:function(jc){jc||(jc=this.canvasBounds);return this.context.getImageData(jc.x,jc.y,jc.width,jc.height)}},{key:"nonTransparentArea",
value:function(){for(var jc=this.imageData(),Od=jc.data,qb=jc.width,ic=jc.height,Wb=qb,lc=ic,db=0;db<ic;db++)for(var Xa=0;Xa<Wb;Xa++)0<Od[4*(db*qb+Xa)+3]&&(Wb=Xa,lc>db&&(lc=db));if(Wb===qb)return uc.rect(0,0,0,0);db=Wb;Xa=lc;for(--ic;ic>lc;ic--)for(var Gb=qb-1;Gb>db;Gb--)0<Od[4*(ic*qb+Gb)+3]&&(db=Gb,Xa<ic&&(Xa=ic));return{imageData:jc,bounds:uc.rect(Wb,lc,db-Wb+1,Xa-lc+1)}}},{key:"trimNonTransparent",value:function(){var jc=this.nonTransparentArea(),Od=jc.imageData;jc=jc.bounds;if(!jc.topLeft().equals(uc.pt(0,
0))){var qb=jc.x,ic=jc.y;this.context.putImageData(Od,-qb,-ic,qb,ic,jc.width,jc.height);this.position=this.position.addPt(jc.topLeft())}jc.extent().equals(this.extent)||(this.extent=jc.extent())}},{key:"finishDraw",value:function(){var jc=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},Od=this.context,qb=jc.color;qb=void 0===qb?"rgba(0,0,0,0.6)":qb;var ic=jc.width;ic=void 0===ic?4:ic;var Wb=jc.fill;Wb=void 0===Wb?!1:Wb;jc=jc.fillColor||qb;qb.toCSSString&&(qb=qb.toCSSString());jc.toCSSString&&
(jc=jc.toCSSString());Od.strokeStyle=qb;Od.lineWidth=ic;Od.stroke();Od.closePath();Wb&&(Od.fillStyle=jc,Od.fill())}},{key:"arc",value:function(jc,Od,qb,ic){var Wb=4<arguments.length&&void 0!==arguments[4]?arguments[4]:!1,lc=5<arguments.length&&void 0!==arguments[5]?arguments[5]:{},db=this.context;db.beginPath();db.arc(jc.x,jc.y,Od,qb,ic,Wb);this.finishDraw(lc)}},{key:"polygon",value:function(jc){var Od=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},qb=this.context;qb.beginPath();qb.moveTo(jc[0].x,
jc[0].y);for(var ic=0;ic<jc.length;ic++)qb.lineTo(jc[ic].x,jc[ic].y);qb.lineTo(jc[0].x,jc[0].y);this.finishDraw(Od)}},{key:"text",value:function(jc,Od){var qb=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},ic=this.context,Wb=qb.color;Wb=void 0===Wb?"black":Wb;var lc=qb.font;lc=void 0===lc?"14px Arial":lc;var db=qb.align;db=void 0===db?"start":db;var Xa=qb.baseline;Xa=void 0===Xa?"bottom":Xa;ic.save();ic.font=lc;ic.fillStyle=Wb;ic.textAlign=db;ic.textBaseline=Xa;qb.angle&&!isNaN(qb.angle)&&
(ic.translate(Od.x,Od.y),ic.rotate(qb.angle),ic.translate(-Od.x,-Od.y));ic.fillText(jc,Od.x,Od.y);ic.restore()}},{key:"line",value:function(jc,Od){var qb=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},ic=this.context,Wb=qb.color||"rgba(0,0,0,0.6)";qb=qb.width||4;Wb.toCSSString&&(Wb=Wb.toCSSString());ic.strokeStyle=Wb;ic.beginPath();ic.lineWidth=qb;ic.moveTo(jc.x,jc.y);ic.lineTo(Od.x,Od.y);ic.stroke();ic.closePath()}},{key:"spiral",value:function(){this.clear(uc.Color.white);for(var jc=
this.innerBounds().center(),Od=0,qb=1,ic=0;150>ic;ic++){var Wb=jc.addPt(uc.Point.polar(qb,Od));this.line(jc,Wb,{color:uc.Color.random()});jc=Wb;Od+=Math.PI/10;qb+=.3}}},{key:"rect",value:function(jc,Od){var qb=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},ic=this.context;ic.beginPath();ic.rect(jc.x,jc.y,Od.x,Od.y);this.finishDraw(qb)}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"Canvas"}},{key:"properties",get:function(){return{extent:{defaultValue:uc.pt(200,200)},
fill:{defaultValue:uc.Color.transparent},contextType:{defaultValue:"2d"},preserveContents:{defaultValue:!0},canvasExtent:{get:function(){return this._canvas&&uc.pt(this._canvas.width,this._canvas.height)}},canvasBounds:{readOnly:!0,get:function(){return this._canvas&&this.canvasExtent.extentAsRectangle()}},_serializedContents:{get:function(){return this.preserveContents&&this.toDataURI()},set:function(jc){var Od=this;this.withContextDo(function(){return Od.fromDataURI(jc)})}}}}}],Ed,{pathInPackage:function(){return"./canvas.js"},
unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.components",version:"0.1.0"}}},{start:232,end:8717})}(uc.Morph));uc.Canvas=dd;uc.Canvas=dd}}});