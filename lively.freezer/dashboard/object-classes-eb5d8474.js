System.register(["./__root_module__-aefa9179.js","kld-intersections"],function(Da){var Bb,Qb,hc,ac,be,bd,Sd,ed,Mc,pd,Dd,ke,Kd,jd,cb;return{setters:[function(Ab){Bb=Ab.s;Qb=Ab.P;hc=Ab.a6;ac=Ab.p;be=Ab.bG;bd=Ab.D;Sd=Ab.bH;ed=Ab.r;Mc=Ab.aS;pd=Ab.bI;Dd=Ab.bJ;ke=Ab.bK;Kd=Ab.bL;jd=Ab.bM;cb=Ab.n},function(){}],execute:function(){function Ab(Wb,oc,Lb,Bc){Bc=void 0===Bc?{}:Bc;Bc=Bc.package||gc.ObjectPackage.lookupPackageForObject(Wb,Bc);if(!Bc)throw Error("Object is not part of an object package: "+Wb);
return Bc.addScript(Wb,oc,Lb)}function Yb(Wb,oc){oc=gc.normalizeOptions(oc).System;Wb=(Wb=Wb[Symbol.for("lively-module-meta")])?Wb.package.name:null;return(oc=(Wb?gc.lookupPackage(oc,Wb):{}).pkg)?!!gc.ObjectPackage.forSystemPackage(oc):!1}Da({addScript:Ab,isObjectClass:Yb});var gc=lively.FreezerRuntime.recorderFor("lively.classes/object-classes.js");gc.normalizeOptions=function(Wb){Wb=Object.assign({baseURL:gc.defaultBaseURL,System:System},Wb);Wb.baseURL=Wb.baseURL.replace(/\/$/,"");return Wb};gc.addScript=
Ab;gc.isObjectClass=Yb;gc.string=Bb;gc.Path=Qb;gc.arr=hc;gc.parse=ac;gc.isValidIdentifier=be;gc.stringify=bd;gc.parseFunction=Sd;gc.resource=ed;gc.runEval=Mc;gc.scripting=pd;gc.ExportLookup=Dd;var dd=gc.scripting;gc.ensurePackage=dd.ensurePackage;gc.registerPackage=dd.registerPackage;gc.importPackage=dd.importPackage;gc.lookupPackage=dd.lookupPackage;gc.module=dd.module;gc.ImportInjector=dd.ImportInjector;gc.RuntimeSourceDescriptor=ke;gc.toJsIdentifier=Kd;gc.adoptObject=jd;gc.classToFunctionTransform=
cb;gc.objectPackageSym=Symbol.for("lively-object-package-data");gc.defaultBaseURL="local://lively-object-modules";gc.globalClasses=Object.keys(System.global).map(function(Wb){Wb=System.global[Wb];return"function"===typeof Wb&&Wb.name&&Wb}).filter(Boolean);gc.addScript=Ab;gc.addScript=Ab;gc.isObjectClass=Yb;gc.isObjectClass=Yb;gc._packageStore=gc._packageStore||{};dd=function(Wb,oc){this._id=Wb;this.options=gc.normalizeOptions(oc)};dd.lookupPackageForObject=function(Wb,oc){return this.lookupPackageForClass(Wb.constructor,
oc)};dd.lookupPackageForClass=function(Wb,oc){oc=gc.normalizeOptions(oc).System;Wb=(Wb=Wb[Symbol.for("lively-module-meta")])?Wb.package.name:null;return(oc=(Wb?gc.lookupPackage(oc,Wb):{}).pkg)?gc.ObjectPackage.forSystemPackage(oc):null};dd.forSystemPackage=function(Wb){return this.packageStore[Wb.name]};dd.withId=function(Wb,oc){return this.packageStore[Wb]||(this.packageStore[Wb]=new this(Wb,oc))};dd.prototype.resource=function(Wb){Wb=void 0===Wb?"":Wb;return gc.resource(this.packageURL).join(Wb)};
dd.prototype.load=function(){return gc.importPackage(this.System,this.packageURL)};dd.prototype.ensureExistance=function(){var Wb=this,oc,Lb,Bc,Sc,Yc,Xb,qb,uc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Hc){switch(Hc.nextAddress){case 1:return oc=Wb.resource("/"),Hc.yield(oc.exists(),2);case 2:if(Hc.yieldResult)return Hc.return();Lb=[{resource:oc}];Bc=[{resource:Wb.resource("package.json"),content:JSON.stringify(Wb.config,null,2)}];return Hc.yield(Promise.all(Lb.map(function(Ia){return Ia.resource.mkdir()})),
3);case 3:return Hc.yield(Promise.all(Bc.map(function(Ia){var Va;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tb){switch(tb.nextAddress){case 1:return tb.yield(Ia.resource.exists(),2);case 2:if(!(Va=!tb.yieldResult)){tb.jumpTo(3);break}return tb.yield(Ia.resource.write(Ia.content),4);case 4:Va=tb.yieldResult;case 3:return tb.return(Va)}})})),4);case 4:return Hc.yield(Wb.objectModule.ensureExistance(),5);case 5:return Sc=Wb,Yc=Sc.System,Xb=Sc.packageURL,qb=Sc.config,Hc.yield(gc.ensurePackage(Yc,
Xb),6);case 6:return uc=Hc.yieldResult,uc.registerWithConfig(qb),console.log(Wb.packageURL+" REGISTERED"),Hc.return(Wb)}})};dd.prototype.ensureObjectClass=function(Wb){var oc=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lb){return 1==Lb.nextAddress?Lb.yield(oc.ensureExistance(),2):Lb.return(oc.objectModule.ensureObjectClass(Wb))})};dd.prototype.adoptObject=function(Wb){var oc=this,Lb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bc){if(1==Bc.nextAddress)return oc.objectClass===
Wb.constructor?Bc.return():Bc.yield(oc.ensureObjectClass(Wb.constructor),2);Lb=Bc.yieldResult;gc.adoptObject(Wb,Lb);Bc.jumpToEnd()})};dd.prototype.addScript=function(Wb,oc,Lb){return this.objectModule.addScript(Wb,oc,Lb)};dd.prototype.remove=function(){this.systemPackage.remove();delete gc.ObjectPackage.packageStore[this.id];return this.resource().remove()};dd.prototype.renameObjectClass=function(Wb,oc){oc=void 0===oc?[]:oc;var Lb=this,Bc,Sc,Yc,Xb,qb,uc,Hc,Ia,Va,tb,Jb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ib){if(1==
Ib.nextAddress){Bc=Lb;Sc=Bc.objectClass;Yc=Bc.System;if(!Sc||Sc[Symbol.for("__LivelyClassName__")]===Wb)return Ib.return(Sc);if(!gc.isValidIdentifier(Wb))throw Error(Wb+" is not a valid name for a class");qb=Xb=gc.RuntimeSourceDescriptor.for(Sc,Yc);uc=qb.source;Hc=qb.ast;Ia=Hc.id;Va=Ia.start;tb=Ia.end;return Ib.yield(Xb.changeSource(uc.slice(0,Va)+Wb+uc.slice(tb)),2)}Jb=Lb.objectClass;oc.forEach(function(ib){ib.constructor=Jb;ib.__proto__=Jb.prototype});return Ib.return(Jb)})};dd.prototype.fork=function(Wb,
oc){var Lb=this,Bc,Sc,Yc,Xb,qb,uc,Hc,Ia,Va,tb,Jb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ib){switch(Ib.nextAddress){case 1:return Bc=Lb,Sc=Bc.System,Yc=Bc.baseURL,Xb=Bc.objectClass,oc=Object.assign({System:Sc,baseURL:Yc},oc),qb=gc.RuntimeSourceDescriptor.for(Xb),uc=qb._renamedSource(Wb),Hc=uc.moduleSource,Ia=gc.ObjectPackage.withId(Wb,oc),Ib.yield(Ia.ensureExistance(),2);case 2:return Va=Ia,tb=Va.objectModule,Jb=tb.systemModule,Ib.yield(Jb.load({format:"esm"}),3);case 3:return Ib.yield(Jb.changeSource(Hc),
4);case 4:return Ib.return(Ia)}})};$jscomp.global.Object.defineProperties(dd.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return this._id}},name:{configurable:!0,enumerable:!0,get:function(){return this.id}},System:{configurable:!0,enumerable:!0,get:function(){return this.options.System}},baseURL:{configurable:!0,enumerable:!0,get:function(){return this.options.baseURL}},packageURL:{configurable:!0,enumerable:!0,get:function(){return this.baseURL+("/"+this.id)}},config:{configurable:!0,
enumerable:!0,get:function(){return{name:this.name,version:"0.1.0",lively:{isObjectPackage:!0}}}},systemPackage:{configurable:!0,enumerable:!0,get:function(){return gc.lookupPackage(this.System,this.packageURL,!0).pkg}},objectModule:{configurable:!0,enumerable:!0,get:function(){return this._objectModule||(this._objectModule=new gc.ObjectModule("index.js",this))}},objectClass:{configurable:!0,enumerable:!0,get:function(){return this.objectModule.objectClass}}});$jscomp.global.Object.defineProperties(dd,
{packageStore:{configurable:!0,enumerable:!0,get:function(){return this._packageStore||(this._packageStore=gc._packageStore)}}});Da("default",dd);gc.ObjectPackage=dd;var Zd=function(Wb,oc){if(!Wb)throw Error("ObjectModule needs package!");if(!oc)throw Error("ObjectModule needs package!");this._moduleName=Wb;this._objectPackage=oc};Zd.prototype.read=function(){return this.resource.read()};Zd.prototype.write=function(Wb){return this.resource.write(Wb)};Zd.prototype.ensureExistance=function(){var Wb=
this,oc,Lb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bc){switch(Bc.nextAddress){case 1:return oc=Wb.resource,Bc.yield(oc.exists(),2);case 2:if(Bc.yieldResult){Bc.jumpTo(3);break}return Bc.yield(oc.write("'format esm';\n"),4);case 4:Lb={},Wb.System.config({meta:(Lb[Wb.url]={format:"esm"},Lb)});case 3:return Bc.return(Wb)}})};Zd.prototype.ensureObjectClass=function(Wb){var oc=this,Lb=this.objectClass;return Lb&&Lb.prototype.__proto__===Wb.prototype?Lb:Promise.resolve(this.ensureObjectClassSource(Wb)).then(function(Bc){var Sc=
Bc.source,Yc=Bc.moduleId,Xb=Bc.className,qb=Bc.bindings,uc=oc.System;Bc=gc.module(uc,Yc);if(qb)for(var Hc in qb)Bc.define(Hc,qb[Hc]);Sc=gc.runEval(Sc,{classTransform:gc.classToFunctionTransform,sync:!0,targetModule:Yc,System:uc});if(Sc.isError)throw Sc.value;Sc=Bc.recorder[Xb];if(!Sc)throw Error("Failed to define class "+Xb+" in "+Yc);return Sc})};Zd.prototype.ensureObjectClassSource=function(Wb){return this.createDefaultClassDeclaration(Wb)};Zd.prototype.createDefaultClassDeclaration=function(Wb){Wb=
void 0===Wb?Object:Wb;var oc=this,Lb,Bc,Sc,Yc,Xb,qb,uc,Hc,Ia,Va,tb,Jb,Ib,ib,jb,Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){switch(rc.nextAddress){case 1:Lb=oc;Bc=Lb.System;Sc=Lb.systemModule;Yc=Lb.objectPackage;Xb=gc.string.capitalize(gc.toJsIdentifier(Yc.id));qb=Wb[Symbol.for("__LivelyClassName__")];uc=!qb;Hc=gc.globalClasses.includes(Wb);Ia="";Va=null;if(uc){qb="__anonymous_superclass__";tb={};Va=(tb[qb]=Wb,tb);rc.jumpTo(2);break}if(Hc){rc.jumpTo(2);break}return rc.yield(gc.ExportLookup.findExportOfValue(Wb,
Bc),4);case 4:(Jb=rc.yieldResult)?(Ib=gc.ImportInjector.run(Bc,Sc.id,Sc.package(),"",Jb),ib=Ib.standaloneImport,Ia+=ib+"\n\n"):(jb={},Va=(jb[qb]=Wb,jb));case 2:return Xb===qb&&(Xb="Object"+Xb),Fb="Object"===qb?"class "+Xb+" {}\n":"class "+Xb+" extends "+qb+" {}\n",Ia+="export default "+Fb+"\n",rc.yield(Sc.changeSource(Ia),5);case 5:return rc.yield(Sc.load(),6);case 6:return rc.return({source:Ia,className:Xb,moduleId:oc.url,bindings:Va})}})};Zd.prototype.addScript=function(Wb,oc,Lb){var Bc=this,Sc,
Yc,Xb,qb,uc,Hc,Ia,Va,tb,Jb,Ib,ib,jb,Fb,rc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ic){switch(Ic.nextAddress){case 1:if(Wb.constructor===Bc.objectClass){Sc=Wb.constructor;Ic.jumpTo(2);break}return Ic.yield(Bc.ensureObjectClass(Wb.constructor),3);case 3:Sc=Ic.yieldResult;case 2:Yc=Sc;Xb="function"===typeof oc?String(oc):oc;qb=gc.parseFunction(Xb);uc=gc.RuntimeSourceDescriptor.for(Yc,Bc.System);Lb||(Lb=gc.Path("id.name").get(qb));if(!Lb)throw Error("No name, cannot add "+gc.string.truncate(Xb,
30).replace(/\n/g,"")+"!");Hc=gc.toJsIdentifier(Lb);console.assert("FunctionExpression"===qb.type||"ArrowFunctionExpression"===qb.type,"not a function expression but: "+qb.type);Ia=qb.params.map(function(ec){return Xb.slice(ec.start,ec.end)});Va="BlockStatement"===qb.body.type?Xb.slice(qb.body.start,qb.body.end):"{ return "+Xb.slice(qb.body.start,qb.body.end)+" }";tb=Hc+"("+Ia.join(",")+") "+Va;"ArrowFunctionExpression"===qb.type&&(qb.type="FunctionExpression");Jb=uc.source;Ib=uc.ast;if(!Ib)throw Error("cannot find class decl of "+
uc.module.id);(ib=Ib.body.body.find(function(ec){return ec.key.name===Hc&&!ec.static}))?Jb=Jb.slice(0,ib.start)+tb+Jb.slice(ib.end):(jb=Jb.lastIndexOf("}"),Fb=Jb.slice(0,jb),rc=Jb.slice(jb),/\n\s*$/m.test(Fb)||(Fb+="\n"),tb=gc.string.changeIndent(tb,"  ",1),/^[ ]*\n/m.test(rc)||(rc="\n"+rc),Jb=Fb+tb+rc);return Ic.yield(uc.changeSource(Jb),4);case 4:return Ic.return({script:Yc.prototype[Hc],klass:Yc,module:uc.module.id,methodName:Hc})}})};$jscomp.global.Object.defineProperties(Zd.prototype,{objectPackage:{configurable:!0,
enumerable:!0,get:function(){return this._objectPackage}},objectClass:{configurable:!0,enumerable:!0,get:function(){var Wb=this.systemModule;return Wb.isLoaded()?Wb.System.get(Wb.id).default:null}},moduleName:{configurable:!0,enumerable:!0,get:function(){return this._moduleName}},systemModule:{configurable:!0,enumerable:!0,get:function(){return gc.module(this.System,this.url)}},System:{configurable:!0,enumerable:!0,get:function(){return this.objectPackage.System}},resource:{configurable:!0,enumerable:!0,
get:function(){return this.objectPackage.resource(this.moduleName)}},url:{configurable:!0,enumerable:!0,get:function(){return this.resource.url}}});gc.ObjectModule=Zd;gc.default=dd}}});