System.register("./__root_module__-f418f9fd.js lively.collab kld-intersections ./user-ui-983ba0be.js ./index-ccf96d3d.js ./world-edf3c374.js ./index-96ee3fea.js ./index-6e65d49f.js".split(" "),function(Ha,tb){var Ab,kc,ac,Ld,Tc,$d,Uc,Pc,Jd,pe,Ze,Ff,te,Bc,sd,le,jc,je,Ae,Dc,Mc,bc,Gc,Zc,Rd,Kd;return{setters:[function(rb){Ab=rb.av;kc=rb.aK;ac=rb.aV;Ld=rb.ab;Tc=rb.ac;$d=rb.aZ;Uc=rb.aX;Pc=rb.aY;Jd=rb.I;pe=rb.aW;Ze=rb.aA;Ff=rb.a3;te=rb.a1;Bc=rb.C;sd=rb.a6;le=rb.a8;jc=rb.L;je=rb.r;Ae=rb.bf;Dc=rb.be;
Mc=rb.aF;bc=rb.bi;Gc=rb.aj;Zc=rb.aJ},function(){},function(){},function(){},function(){},function(rb){Rd=rb.S;Kd=rb.a},function(){},function(){}],execute:function(){var rb=lively.FreezerRuntime.recorderFor("LivelyTopBar/index.js");rb.Morph=Ab;rb.Icon=kc;rb.Tooltip=ac;rb.morph=Ld;rb.Text=Tc;rb.Polygon=$d;rb.Label=Uc;rb.Path=Pc;rb.Image=Jd;rb.HTMLMorph=pe;rb.Ellipse=Ze;rb.pt=Ff;rb.Rectangle=te;rb.Color=Bc;rb.arr=sd;rb.obj=le;rb.LoadingIndicator=jc;rb.resource=je;rb.Canvas=Ae;rb.getClassName=Dc;rb.Selection=
Rd;rb.SelectionElement=Kd;rb.connect=Mc;rb.disconnect=bc;rb.CommentBrowser=Gc;var ob=function(Bb){var Va=lively.FreezerRuntime.recorderFor("LivelyTopBar/index.js"),Ta=Va.hasOwnProperty("LivelyTopBar")&&"function"===typeof Va.LivelyTopBar?Va.LivelyTopBar:Va.LivelyTopBar=function(xa){xa&&xa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Zc(Ta,Bb,[{key:"beforePublish",value:function(){this.activeSideBars=[];this.currentShapeMode=
"Rectangle";this.setEditMode("Halo")}},{key:"onLoad",value:function(){var xa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wa){if(1==wa.nextAddress)return xa.isComponent?wa.return():wa.yield(xa.whenRendered(),2);document.body.style.background="black";xa.setEditMode("Halo");xa.getSubmorphNamed("fast load toggler").refresh();wa.jumpToEnd()})}},{key:"onUserChanged",value:function(xa){this.userFlap.onUserChanged(xa)}},{key:"relayout",value:function(){this.respondsToVisibleWindow&&(this.width=
this.world().visibleBounds().width,this.position=rb.pt(0,0))}},{key:"adjustElements",value:function(){var xa=this.get("ipad status bar");xa&&(xa.width=this.width);this.userFlap.owner==this&&(this.userFlap.right=this.width-10)}},{key:"getShapeMenuItems",value:function(){var xa=this;return Object.entries(this.shapeToIcon).map(function(wa){wa=$jscomp.makeIterator(wa);var Qa=wa.next().value,Eb=wa.next().value;wa=Eb.shortcut;Eb=Eb.args;return[[].concat($jscomp.arrayFromIterable(xa.currentShapeMode===Qa?
[].concat($jscomp.arrayFromIterable(rb.Icon.textAttribute("check",{fontSize:11,paddingTop:"2px"})),["   ",{}]):["     ",{}]),$jscomp.arrayFromIterable(rb.Icon.textAttribute.apply(rb.Icon,$jscomp.arrayFromIterable(Eb))),["   "+Qa+" ",{float:"none"},"      "+wa,{float:"right",fontSize:11,opacity:.5,fontFamily:"IBM Plex Mono"}]),function(){xa.currentShapeMode=Qa;xa.setEditMode("Shape")}]})}},{key:"getSideBarMenuItems",value:function(){var xa=this;return Object.entries(this.sideBarToIcon).map(function(wa){wa=
$jscomp.makeIterator(wa);var Qa=wa.next().value;wa=wa.next().value.args;return[[].concat($jscomp.arrayFromIterable(xa.activeSideBars.includes(Qa)?[].concat($jscomp.arrayFromIterable(rb.Icon.textAttribute("check",{fontSize:11,paddingTop:"2px"})),["   ",{}]):["     ",{}]),$jscomp.arrayFromIterable(rb.Icon.textAttribute.apply(rb.Icon,$jscomp.arrayFromIterable(wa))),["   "+Qa+" ",{float:"none"}]),function(){return xa.openSideBar(Qa)}]})}},{key:"reloadSidebar",value:function(){this.sideBar.remove();this.sideBar=
null;this.stylingPalette.remove();this.stylingPalette=null;this.openSideBar("Scene Graph");this.openSideBar("Styling Palette")}},{key:"onKeyUp",value:function(xa){"Hand"==this._tmpEditMode&&this.setEditMode("Hand",!0)}},{key:"onKeyDown",value:function(xa){Zc._get(Object.getPrototypeOf(Ta.prototype),"onKeyDown",this).call(this,xa);if(xa.isCommandKey()&&"Hand"==this._tmpEditMode)this.setEditMode("Halo",!0);else if(!xa.isAltDown()){var wa={R:"Rectangle",E:"Ellipse",I:"Image",P:"Path",Q:"Polygon",L:"Label",
C:"Canvas",H:"HTML"};switch(xa.key){case "Escape":this.setEditMode("Halo");break;case "R":case "E":case "I":case "P":case "Q":case "L":case "C":case "H":this.currentShapeMode=wa[xa.key];this.setEditMode("Shape");break;case "T":this.setEditMode("Text")}}}},{key:"openSideBar",value:function(xa){var wa=this,Qa,Eb,rc,qb,sb,kb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){switch(ha.nextAddress){case 1:wa.activeSideBars.includes(xa)?rb.arr.remove(wa.activeSideBars,xa):wa.activeSideBars.push(xa);
if("Scene Graph"!=xa){ha.jumpTo(2);break}if(wa.sideBar){ha.jumpTo(3);break}Qa=rb.LoadingIndicator.open("loading side bar");return ha.yield(Qa.whenRendered(),4);case 4:return Eb=wa,ha.yield(tb.import("./scene graph side bar master-693e4106.js"),6);case 6:if(!(rc=ha.yieldResult)){ha.jumpTo(7);break}return ha.yield(rb.resource("part://SystemIDE/scene graph side bar master"),8);case 8:rc=ha.yieldResult;case 7:return ha.yield(rc.read(),5);case 5:return Eb.sideBar=ha.yieldResult,wa.sideBar.hasFixedPosition=
!0,wa.sideBar.respondsToVisibleWindow=!0,wa.sideBar.openInWorld(),wa.sideBar.right=0,ha.yield(wa.sideBar.whenRendered(),9);case 9:Qa.remove();case 3:wa.sideBar.toggle(wa.activeSideBars.includes("Scene Graph"));case 2:if("Styling Palette"!=xa){ha.jumpTo(0);break}if(wa.stylingPalette){ha.jumpTo(11);break}qb=rb.LoadingIndicator.open("loading side bar");return ha.yield(qb.whenRendered(),12);case 12:return sb=wa,ha.yield(tb.import("./styling side bar master-f89eb8bb.js"),14);case 14:if(!(kb=ha.yieldResult)){ha.jumpTo(15);
break}return ha.yield(rb.resource("part://SystemIDE/styling side bar master"),16);case 16:kb=ha.yieldResult;case 15:return ha.yield(kb.read(),13);case 13:return sb.stylingPalette=ha.yieldResult,wa.stylingPalette.collapseAll(),wa.stylingPalette.hasFixedPosition=!0,wa.stylingPalette.respondsToVisibleWindow=!0,wa.stylingPalette.openInWorld(),wa.stylingPalette.left=wa.world().width,ha.yield(wa.stylingPalette.whenRendered(),17);case 17:qb.remove();case 11:wa.stylingPalette.toggle(wa.activeSideBars.includes("Styling Palette")),
ha.jumpToEnd()}})}},{key:"onMouseDown",value:function(xa){var wa=this.get("select shape type"),Qa=this.get("shape mode button"),Eb=this.get("side bar selector");xa.targetMorph==wa&&(this.world().openWorldMenu(xa,this.getShapeMenuItems()).position=Qa.globalBounds().bottomLeft().subPt(this.world().scroll));"undo button"==xa.targetMorph.name&&$world.execCommand("undo");"redo button"==xa.targetMorph.name&&$world.execCommand("redo");"save button"==xa.targetMorph.name&&$world.execCommand("save world");
xa.targetMorph==Qa&&this.setEditMode("Shape");"text mode button"==xa.targetMorph.name&&this.setEditMode("Text");"hand mode button"==xa.targetMorph.name&&this.setEditMode("Hand");"halo mode button"==xa.targetMorph.name&&this.setEditMode("Halo");"open component browser"==xa.targetMorph.name&&this.interactivelyLoadComponent();"load world button"==xa.targetMorph.name&&this.world().execCommand("load world");"comment browser button"==xa.targetMorph.name&&this.toggleCommentBrowser();xa.targetMorph==Eb&&
(this.world().openWorldMenu(xa,this.getSideBarMenuItems()).position=Eb.globalBounds().bottomLeft().subPt(this.world().scroll))}},{key:"colorCommentBrowserButton",value:function(){var xa=this.get("user flap"),wa=xa.haloShadow;xa=xa.haloColor;var Qa=this.get("comment browser button");Qa.fontColor=xa;Qa.dropShadow=wa}},{key:"uncolorCommentBrowserButton",value:function(){var xa=this.get("comment browser button"),wa=rb.Color.rgb(102,102,102);xa.dropShadow=!1;xa.fontColor=wa}},{key:"toggleCommentBrowser",
value:function(){var xa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wa){rb.CommentBrowser.isOpen()?xa.uncolorCommentBrowserButton():xa.colorCommentBrowserButton();return wa.yield(xa.world().execCommand("toggle comment browser"),0)})}},{key:"commentCountBadge",get:function(){return this.get("comment browser button").get("comment count badge")}},{key:"interactivelyLoadComponent",value:function(){var xa=this,wa,Qa,Eb,rc,qb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sb){if(1==
sb.nextAddress)return wa=xa.get("open component browser"),Qa=xa.userFlap,Eb=Qa.haloShadow,rc=Qa.haloColor,qb=rb.Color.rgb(102,102,102),wa.fontColor=rc,wa.dropShadow=Eb,sb.yield(xa.world().execCommand("browse and load component"),2);wa.dropShadow=!1;wa.fontColor=qb;sb.jumpToEnd()})}},{key:"setEditMode",value:function(xa,wa){var Qa=this;wa=void 0===wa?!1:wa;this.editMode=xa;var Eb=this.primaryTarget||this.world(),rc=this.userFlap,qb=rc.haloShadow,sb=rc.haloColor,kb=rb.Color.rgb(102,102,102);wa||(this._tmpEditMode=
xa);wa=this.get("shape mode button");rc=this.get("text mode button");var ha=this.get("hand mode button"),Pa=this.get("halo mode button");[["Shape",wa.submorphs],["Text",[rc]],["Hand",[ha]],["Halo",[Pa]]].forEach(function(T){var ia=$jscomp.makeIterator(T);T=ia.next().value;ia=ia.next().value;"Shape"==xa?Qa.toggleShapeMode(Eb,!0,Qa.currentShapeMode):"Text"==xa?Qa.toggleShapeMode(Eb,!0,"Text"):Qa.toggleShapeMode(Eb,!1);Qa.showHaloPreviews("Halo"==xa);T==xa?ia.forEach(function(Fa){Fa.dropShadow=qb;Fa.fontColor=
sb}):ia.forEach(function(Fa){Fa.dropShadow=null;Fa.fontColor=kb})})}},{key:"canBeCreatedViaDrag",value:function(xa){return[rb.Morph,rb.Ellipse,rb.HTMLMorph,rb.Canvas,rb.Text,rb.Polygon,rb.Path,rb.Image].includes(xa)}},{key:"toggleShapeMode",value:function(xa,wa,Qa){var Eb={Rectangle:rb.Morph,Ellipse:rb.Ellipse,HTML:rb.HTMLMorph,Canvas:rb.Canvas,Image:rb.Image,Path:rb.Path,Label:rb.Label,Polygon:rb.Polygon,Text:rb.Text};wa?(xa.nativeCursor="crosshair",xa._yieldShapeOnClick=Eb[Qa]):(xa._yieldShapeOnClick=
!1,xa.nativeCursor="auto")}},{key:"handleShapeCreation",value:function(xa){var wa=this.primaryTarget||this.world(),Qa=wa._yieldShapeOnClick;if(!Qa)return!1;wa._sizeTooltip&&wa._sizeTooltip.remove();if(xa.targetMorph!=wa)return!1;if(wa._shapeRequest&&Qa&&!wa._yieldedShape){var Eb=wa.localize(this.world().firstHand.position);switch(Qa){case rb.Image:wa.addMorph(rb.morph({type:Qa,position:Eb,extent:rb.pt(150,150),fill:rb.Color.transparent,imageUrl:"https://i.imgur.com/uGRFZEs.jpg"}));break;case rb.Label:wa.addMorph(rb.morph({type:Qa,
position:Eb,value:"I am a label!",fill:rb.Color.transparent}));break;case rb.Text:if(xa.targetMorph.isText)return;this.addMorph(rb.morph({type:Qa,position:Eb,textString:"I am a text field!",fill:rb.Color.transparent}))}}Qa==rb.Text&&wa._yieldedShape?wa._yieldedShape.focus():wa._yieldedShape&&this.world().showHaloFor(wa._yieldedShape);wa._yieldedShape=null;wa._shapeRequest=!1}},{key:"prepareShapeCreation",value:function(xa){var wa=this.primaryTarget||this.world(),Qa=wa._yieldShapeOnClick;if(!Qa||!this.canBeCreatedViaDrag(Qa))return!1;
wa._yieldedShape=wa.addMorph(rb.morph(Object.assign({type:Qa,position:xa.positionIn(wa),extent:rb.pt(1,1),fill:rb.Color.transparent,borderWidth:1,borderColor:rb.Color.rgb(23,160,251),fixedHeight:!0,fixedWidth:!0,lineWrapping:!0},Qa==rb.Image?this.getImageDefaultAttrs():{},{},Qa==rb.Polygon?this.getPolyDefaultAttrs():{},{},Qa==rb.Path?this.getPathDefaultAttrs():{})));wa._sizeTooltip=rb.morph({type:rb.Tooltip,padding:rb.Rectangle.inset(5,5,5,5),styleClasses:["Tooltip"]}).openInWorld();return!0}},{key:"getPolyDefaultAttrs",
value:function(){return{vertices:[rb.pt(131.4,86.3),rb.pt(171,139.6),rb.pt(105.9,119.9),rb.pt(65.3,172.5),rb.pt(64.7,107),rb.pt(0,86.3),rb.pt(64.7,65.5),rb.pt(65.3,0),rb.pt(105.9,52.6),rb.pt(171,32.9),rb.pt(131.4,86.3)],borderWidth:1}}},{key:"getPathDefaultAttrs",value:function(){return{vertices:[rb.pt(0,0),rb.pt(1,1)],borderWidth:1}}},{key:"getImageDefaultAttrs",value:function(){return{imageUrl:"https://i.imgur.com/uGRFZEs.jpg"}}},{key:"yieldShapeIfNeeded",value:function(xa){var wa=this.primaryTarget||
this.world();return wa._yieldedShape?(wa._yieldedShape.extent=xa.positionIn(wa.world()).subPt(xa.state.dragStartPosition).subPt(rb.pt(1,1)).maxPt(rb.pt(1,1)),wa._sizeTooltip.description=wa._yieldShapeOnClick[Symbol.for("__LivelyClassName__")]+": "+wa._yieldedShape.width.toFixed(0)+"x"+wa._yieldedShape.height.toFixed(0),wa._sizeTooltip.topLeft=xa.positionIn(wa.world()).addXY(15,15),!0):!1}},{key:"handleHaloSelection",value:function(xa){var wa=this.world(),Qa=this.primaryTarget||wa;this._showHaloPreview&&
this._currentlyHighlighted&&0==wa.halos().length&&(xa.stop(),wa.getSubmorphsByStyleClassName("HaloPreview").forEach(function(Eb){return Eb.remove()}),wa.showHaloFor(this._currentlyHighlighted));xa.targetMorph==Qa&&(Qa._shapeRequest=!0)}},{key:"handleHaloPreview",value:function(xa){if(this._showHaloPreview){var wa=this.primaryTarget||this.world();xa=wa.morphsContainingPoint(xa.positionIn(wa));wa=xa.filter(function(Qa){return Qa.halosEnabled&&[Qa].concat($jscomp.arrayFromIterable(Qa.ownerChain())).every(function(Eb){return Eb.visible&&
0<Eb.opacity&&!Eb.styleClasses.includes("HaloPreview")})})[0];xa.find(function(Qa){return Qa.isMenuItem})||this.showHaloPreviewFor(wa)}}},{key:"showHaloPreviewFor",value:function(xa){var wa=this.primaryTarget||this.world();if(xa&&(![xa].concat($jscomp.arrayFromIterable(xa.ownerChain())).find(function(Qa){return Qa.isComponent})&&xa.getWindow()?xa=null:[xa].concat($jscomp.arrayFromIterable(xa.ownerChain())).find(function(Qa){return Qa.isEpiMorph})?xa=null:xa==wa&&(xa=null),this._currentlyHighlighted!=
xa&&(this.clearHaloPreviews(),this._currentlyHighlighted=xa),!(0<this.world().halos().length)&&xa)){this._previewCache||(this._previewCache=new WeakMap);wa=rb.Morph;switch(rb.getClassName(xa)){case "Ellipse":wa=rb.Ellipse}wa=this._previewCache.get(xa)||rb.morph({type:wa,styleClasses:["HaloPreview"],epiMorph:!0,fill:rb.Color.transparent,reactsToPointer:!1,halosEnabled:!1,acceptsDrops:!1,border:{color:rb.Color.rgb(23,160,251),width:1}});wa.owner||this.world().addMorph(wa);wa.setBounds(xa.globalBounds());
wa.borderColor=rb.Color.rgb(23,160,251);wa.borderStyle="solid";xa.master&&(wa.borderColor=rb.Color.purple);xa.ownerChain().find(function(Qa){return Qa.master&&Qa.master.managesMorph(xa)})&&(wa.borderColor=rb.Color.purple,wa.borderStyle="dotted");xa.isComponent&&(wa.borderColor=rb.Color.magenta);this._previewCache.set(xa,wa)}}},{key:"showHaloPreviews",value:function(xa){xa||this.clearHaloPreviews();this._showHaloPreview=xa}},{key:"clearHaloPreviews",value:function(){this.world().getSubmorphsByStyleClassName("HaloPreview").forEach(function(xa){return xa.remove()})}},
{key:"prepareDragSelection",value:function(xa){var wa=(this.primaryTarget||this.world()).world();this._selectionStartPos=xa.positionIn(wa);this._morphSelection=wa.addMorph({type:rb.Selection,epiMorph:!0,reactsToPointer:!1,position:this._selectionStartPos,extent:xa.state.dragDelta});this._selectedMorphs={}}},{key:"adjustDragSelection",value:function(xa){var wa=this,Qa=this.primaryTarget||this.world(),Eb=Qa.world(),rc=rb.Rectangle.fromAny(xa.position,this._selectionStartPos);this._morphSelection.setBounds(rc);
Qa.submorphs.forEach(function(qb){if(!qb.isSelectionElement&&!qb.isHand){var sb=qb.globalBounds(),kb=rc.containsRect(sb);!wa._selectedMorphs[qb.id]&&kb&&(wa._selectedMorphs[qb.id]=Eb.addMorph({type:rb.SelectionElement,bounds:sb},wa._morphSelection));wa._selectedMorphs[qb.id]&&!kb&&(wa._selectedMorphs[qb.id].remove(),delete wa._selectedMorphs[qb.id])}})}},{key:"finishDragSelectionIfNeeded",value:function(xa){if(this._morphSelection){var wa=this.world();this._morphSelection.fadeOut(200);rb.obj.values(this._selectedMorphs).map(function(Qa){return Qa.remove()});
wa.showHaloForSelection(Object.keys(this._selectedMorphs).map(function(Qa){return wa.getMorphWithId(Qa)}));this._selectedMorphs={};this._morphSelection=null}}},{key:"onTargetDragStart",value:function(xa){!this.prepareShapeCreation(xa)&&xa.leftMouseButtonPressed()&&this.prepareDragSelection(xa)}},{key:"onTargetDrag",value:function(xa){!this.yieldShapeIfNeeded(xa)&&this._morphSelection&&this.adjustDragSelection(xa)}},{key:"detachFromTarget",value:function(xa){rb.disconnect(xa,"onMouseMove",this,"handleHaloPreview");
rb.disconnect(xa,"onMouseDown",this,"handleHaloSelection");rb.disconnect(xa,"onMouseUp",this,"handleShapeCreation");rb.disconnect(xa,"onDragStart",this,"onTargetDragStart");rb.disconnect(xa,"onDrag",this,"onTargetDrag");rb.disconnect(xa,"onDragEnd",this,"finishDragSelectionIfNeeded")}},{key:"attachToTarget",value:function(xa){this.primaryTarget&&this.detachFromTarget(this.primaryTarget);this.primaryTarget=xa;rb.connect(xa,"onMouseMove",this,"handleHaloPreview",{garbageCollect:!0});rb.connect(xa,"onMouseDown",
this,"handleHaloSelection",{garbageCollect:!0});rb.connect(xa,"onMouseUp",this,"handleShapeCreation",{garbageCollect:!0});rb.connect(xa,"onDragStart",this,"onTargetDragStart",{garbageCollect:!0});rb.connect(xa,"onDrag",this,"onTargetDrag",{garbageCollect:!0});rb.connect(xa,"onDragEnd",this,"finishDragSelectionIfNeeded",{garbageCollect:!0})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"LivelyTopBar"}},{key:"properties",get:function(){return{isTopBar:{readOnly:!0,get:function(){return!0}},
primaryTarget:{doc:"A reference to the morph that the top bar considers its primary target",defaultValue:null},userFlap:{},activeSideBars:{},currentShapeMode:{after:["submorphs"],set:function(xa){this.setProperty("currentShapeMode",xa);this.get("shape status icon").textAndAttributes=rb.Icon.textAttribute(this.shapeToIcon[xa].args[0])}},sideBarToIcon:{readOnly:!0,get:function(){return{"Scene Graph":{args:["sitemap",{textStyleClasses:["fas"]}]},"Styling Palette":{args:["palette",{textStyleClasses:["fas"]}]}}}},
shapeToIcon:{readOnly:!0,get:function(){return{Rectangle:{shortcut:"R",args:["square",{textStyleClasses:["fas"]}]},Ellipse:{shortcut:"E",args:["circle",{textStyleClasses:["fas"]}]},Image:{shortcut:"I",args:["image",{textStyleClasses:["fas"],paddingTop:"1px"}]},Path:{shortcut:"P",args:["bezier-curve",{fontSize:13,paddingTop:"3px"}]},Polygon:{shortcut:"Q",args:["draw-polygon",{fontSize:17}]},Label:{shortcut:"L",args:["tag",{paddingTop:"1px"}]},Canvas:{shortcut:"C",args:["chess-board",{paddingTop:"1px"}]},
HTML:{shortcut:"H",args:["code",{paddingTop:"1px"}]}}}}}}}],Va,{pathInPackage:function(){return"index.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"LivelyTopBar",version:"0.1.1-218"}}},{start:717,end:21724})}(rb.Morph);ob=rb.LivelyTopBar;rb.default=ob}}});