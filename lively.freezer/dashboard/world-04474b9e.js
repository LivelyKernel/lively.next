System.register("./__root_module__-46f2ff9c.js ./index-962e9416.js kld-intersections ./index-ebb1a6e0.js ./index-024e2974.js ./color-picker-832d1d5c.js".split(" "),function(Ma){var rb,Db,hc,Kb,id,Zc,yd,Kc,sc,bd,hd,se,xe,ne,Rc,Pd,Hb,Gc,ud,Vc,Id,ie,Fb,Ac,$c,Bc,vd,pb,lb,Zb,Mb,ub,rc,Ta,Lb,mb,Gb,vc,Lc,cc,Vb,Ub,Ga,jb,X,ha,Fa,Ja,Ca,ra,tb,Na,lc,kd,Tb,md,wb,je,bf,Wc,xb,ze,yb,nb,Ha,R,ya,$a,Ab,bc,Ec,pc,wd,xd,Se,v,Ie,cf,df,Ze,ke,Ke,yf,wf,ug;return{setters:[function(Zd){rb=Zd.W;Db=Zd.R;hc=Zd.a2;Kb=Zd.C;id=
Zd.p;Zc=Zd.a3;yd=Zd.a4;Kc=Zd.P;sc=Zd.b;bd=Zd.c;hd=Zd._;se=Zd.a5;xe=Zd.e;ne=Zd.m;Rc=Zd.O;Pd=Zd.h;Hb=Zd.a6;Gc=Zd.a7;ud=Zd.u;Vc=Zd.a8;Id=Zd.v;ie=Zd.k;Fb=Zd.r;Ac=Zd.a9;$c=Zd.o;Bc=Zd.aa;vd=Zd.ab;pb=Zd.ac;lb=Zd.M;Zb=Zd.T;Mb=Zd.ad;ub=Zd.ae;rc=Zd.Y;Ta=Zd.I;Lb=Zd.n;mb=Zd.d;Gb=Zd.g;vc=Zd.af;Lc=Zd.i;cc=Zd.f;Vb=Zd.a;Ub=Zd.ag;Ga=Zd.X;jb=Zd.S;X=Zd.V;ha=Zd.Q;Fa=Zd.t;Ja=Zd.ah;Ca=Zd.ai;ra=Zd.aj;tb=Zd.l;Na=Zd.ak;lc=Zd.al;kd=Zd.am;Tb=Zd.an;md=Zd.ao;wb=Zd.ap;je=Zd.aq;bf=Zd.ar;Wc=Zd.as;xb=Zd.L;ze=Zd.at;yb=Zd.j;nb=Zd.au;
Ha=Zd.D;R=Zd.a0;ya=Zd.av;$a=Zd.$;Ab=Zd.aw},function(Zd){bc=Zd.i},function(){},function(Zd){Ec=Zd.s;pc=Zd.a;wd=Zd.r;xd=Zd._;Se=Zd.P;v=Zd.H;Ie=Zd.M;cf=Zd.S;df=Zd.b;Ze=Zd.c;ke=Zd.G;Ke=Zd.F},function(){},function(Zd){yf=Zd.C;wf=Zd.a;ug=Zd.c}],execute:function(){function Zd(){}function Hc(V,O,Ka){var ea;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){return 1==Da.nextAddress?O.startsWith("image/")?Da.yield(dh.fileReadAsDataURL(V),3):Da.jumpTo(2):2!=Da.nextAddress?(ea=Da.yieldResult,Da.return(new dh.Image({imageUrl:ea,
autoResize:!0,name:V.name}))):Da.return(null)})}var dh=lively.FreezerRuntime.recorderFor("lively.morphic/events/html-drop-handler.js");dh.uploadItem=Zd;dh.uploadFile=Hc;dh.fileReadAsDataURL=function(V){return new Promise(function(O,Ka){Ka=new dh.FileReader;Ka.onload=function(ea){return O(ea.target.result)};Ka.readAsDataURL(V)})};dh.Image=rb;dh.uploadItem=Zd;dh.uploadItem=Zd;dh.uploadFile=Hc;dh.uploadFile=Hc;var ed=lively.FreezerRuntime.recorderFor("lively.ide/world-commands.js");ed.Rectangle=Db;ed.rect=
hc;ed.Color=Kb;ed.pt=id;ed.tree=Zc;ed.date=yd;ed.Path=Kc;ed.arr=sc;ed.string=bd;ed.obj=hd;ed.inspect=se;ed.easings=xe;ed.morph=ne;ed.Text=Rc;ed.config=Pd;ed.KeyHandler=Hb;ed.loadObjectFromPartsbinFolder=Gc;ed.loadPart=ud;ed.interactivelySaveWorld=Vc;ed.show=Ec;ed.showAndSnapToGuides=pc;ed.removeSnapToGuidesOf=wd;ed.LoadingIndicator=Id;ed.createMorphSnapshot=ie;ed.interactivelyFreezeWorld=bc;ed.resource=Fb;ed.BrowserModuleTranslationCache=Ac;ed.CommentBrowser=xd;ed.once=$c;ed.commands=[{name:"clear storage and reload",
exec:function(){var V,O;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ka){if(1==Ka.nextAddress)return Ka.yield($world.confirm(["Caution\n",{},"Proceeding will clear all local storage and reload the page! Make sure if you want to save your world before you continue.",{fontSize:15,fontWeight:"normal"}],{width:400}),2);if(V=Ka.yieldResult)localStorage.clear(),O=new ed.BrowserModuleTranslationCache("2"),O.closeDb(),O.deleteDb(),window.location.reload(!0);Ka.jumpToEnd()})}},{name:"undo",
exec:function(V){if(V.focusedMorph&&V.focusedMorph!==V&&V.focusedMorph.undoManager)return!1;V.env.undoManager.undo();return!0}},{name:"redo",exec:function(V){if(V.focusedMorph&&V.focusedMorph!==V&&V.focusedMorph.undoManager)return!1;V.env.undoManager.redo();return!0}},{name:"run command",handlesCount:!0,exec:function(V,O,Ka){var ea,Da,Sa,vb,Bb,Ib;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wc){if(1==wc.nextAddress)return ea=V.focusedMorph||V,Da=ed.KeyHandler.generateCommandToKeybindingMap(ea,
!0).map(function(yc){var gd=yc.prettyKeys,$d=yc.command.name,te=yc.target.constructor.name;gd=gd?gd.join(", "):"";return{isListItem:!0,value:yc,label:[""+te,{fontSize:"80%",textStyleClasses:["v-center-text"],paddingRight:"10px"},""+$d,null],annotation:[gd,{fontSize:"80%",textStyleClasses:["truncated-text"],paddingRight:"5px",maxWidth:140}]}}),wc.yield(V.filterableListPrompt("Run command",Da,{historyId:"lively.morphic-run command",requester:ea,extent:ed.pt(700,900),prompt:V._cachedRunCommandPrompt}),
2);Sa=wc.yieldResult;vb=Sa.prompt;Bb=$jscomp.makeIterator(Sa.selected);Ib=Bb.next().value;V._cachedRunCommandPrompt=vb;return wc.return(Ib?Ib.target.execCommand(Ib.command,O,Ka):!0)})}},{name:"show command history",exec:function(V,O){var Ka=V.commandHandler;O=ed.arr.sortBy(Ka.history,function(ea){return-ea.time}).map(function(ea){return{isListItem:!0,string:Ka.printCommand(ea),value:ea}});$world.editListPrompt("select commands",O,{multiSelect:!0,requester:V});return!0}},{name:"show halo for focused morph",
exec:function(V){var O=V.focusedMorph;V.showHaloFor(O.getWindow()||O,V.firstHand.pointerId);return!0}},{name:"show morph",exec:function(V,O){ed.show(O.morph,void 0===O.loop?!1:O.loop)}},{name:"show and snap to guides",exec:function(V,O){ed.showAndSnapToGuides(O.target,O.showGuides,O.snap)}},{name:"remove snap to guides",exec:function(V,O){ed.removeSnapToGuidesOf(O)}},{name:"copy morph",exec:function(V){var O=V.focusedMorph;if(!O||O===V)return $world.setStatusMessage("no morph selected"),!0;V=O.getWindow()||
O;O=V.copy();O.openInWorld(V.globalPosition.addXY(10,10));O.isWindow&&O.activate();return O}},{name:"select morph",exec:function(V,O){O=void 0===O?{root:V,selectionFn:null,justReturn:!1,requester:V,filterFn:null,prependItems:[],prompt:null,remote:!1}:O;var Ka,ea,Da,Sa,vb,Bb,Ib,wc,yc,gd,$d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(te){if(1==te.nextAddress)return Ka=0,ea=O.filterFn||function(){return!0},Da=O.selectionFn||function(Ed,Je,He){return V.filterableListPrompt(Ed,Je,He)},
te.yield(System.import("lively.classes/object-classes.js"),2);if(3!=te.nextAddress)return Sa=te.yieldResult,vb=Sa.default,Bb=ed.arr.compact(ed.tree.map(O.root||V,function(Ed,Je){if(!ea(Ed))return null;var He=!!vb.lookupPackageForObject(Ed);return{isListItem:!0,label:[""+String(++Ka)+"\u2003".repeat(Je),{fontSize:"80%",textStyleClasses:["v-center-text"],paddingRight:"10px"},""+Ed,{fontWeight:He?"bolder":"normal",fontStyle:He?"normal":"italic",fontFamily:"Inconsolata",fontSize:16},He?" [Object Class]":
"",{opacity:.5}],value:Ed}},function(Ed){return ea(Ed)?Ed.submorphs:[]})),Ib=["show halo","open object editor","open object inspector"],te.yield(Da(O.prompt||"Choose morph",(O.prependItems||[]).concat(Bb),{historyId:"lively.morphic-select morph",onSelection:function(Ed){(void 0).lastSelectionHalo&&(void 0).lastSelectionHalo.remove();Ed&&Ed.show&&wc!=Ed&&((void 0).lastSelectionHalo=Ed.show(),wc=Ed)},selectedAction:"show halo",actions:Ib}),3);yc=te.yieldResult;gd=yc.selected;$d=yc.action;if(O.justReturn)return te.return(gd);
gd.forEach(function(Ed){$d===Ib[0]?V.showHaloFor(Ed):$d===Ib[1]?V.execCommand("open object editor",{target:Ed}):$d===Ib[2]&&V.execCommand("open object inspector",{target:Ed})});return te.return(gd)})}},{name:"print morph(s)",exec:function(V){var O,Ka,ea,Da,Sa,vb,Bb,Ib,wc,yc,gd,$d,te,Ed,Je,He,ye,oe;return $jscomp.asyncExecutePromiseGeneratorProgram(function(of){switch(of.nextAddress){case 1:O=!1,Ka=[];case 2:if(O)return Bb=ed.LoadingIndicator.open("printing morph..."),of.yield(System.import("lively.2lively/client.js"),
6);ea=$jscomp;Da=ea.makeIterator;return of.yield(V.execCommand("select morph",{justReturn:!0}),4);case 4:return Sa=Da.call(ea,of.yieldResult),vb=Sa.next().value,Ka.push(vb),of.yield(V.confirm("Select additional morphs?",{rejectLabel:"NO"}),5);case 5:O=!of.yieldResult;of.jumpTo(2);break;case 6:return Ib=of.yieldResult,wc=Ib.default,yc=wc.default(),of.yield(yc.listPeers(!0),7);case 7:return gd=of.yieldResult,$d=gd.find(function(Cf){return"pdf printer"===Cf.type}),te={ackTimeout:3E4},Ed=yc,Je=Ed.sendToAndWait,
He=$d.id,of.yield(Promise.all(Ka.map(function(Cf){return ed.createMorphSnapshot(Cf,{addPreview:!1,testLoad:!1})})),9);case 9:return of.yield(Je.call(Ed,He,"[PDF printer] print",of.yieldResult,te),8);case 8:ye=of.yieldResult;if(oe=ye.error||ye.data.error)throw V.showError(oe),oe;V.serveFileAsDownload(ye.data,{fileName:Ka[0].name+(1<Ka.length?".etc":"")+".pdf",type:"application/pdf"});Bb.remove();of.jumpToEnd()}})}},{name:"escape",exec:function(V,O,Ka,ea){O=V.env.eventDispatcher.eventState;O.menu&&
O.menu.remove();O=V.halos();O.forEach(function(Da){return Da.remove()});V.hands.forEach(function(Da){return Da.cancelGrab(!0,ea)});V=ed.arr.last(O)&&ed.arr.last(O).target||V.focusedMorph||V;V.focus();V.isText&&V.selection.disableMultiSelect&&V.selection.disableMultiSelect();return!1}},{name:"move or resize halo target",exec:function(V,O){O=void 0===O?{direction:"left",offset:1,what:"move"}:O;var Ka=V.halos()[0];if(!Ka||Ka.changingName||V.focusedMorph!=Ka)return!1;var ea=O;V=ea.direction;O=ea.offset;
ea=ea.what;var Da=Ka.target;O=O||1;switch(V){case "left":Da["move"===ea?"left":"width"]-=O;break;case "right":Da["move"===ea?"left":"width"]+=O;break;case "up":Da["move"===ea?"top":"height"]-=O;break;case "down":Da["move"===ea?"top":"height"]+=O}Ka.alignWithTarget();return!0}},{name:"close halo target",exec:function(V){V=V.halos()[0];if(!V||V.changingName)return!1;V.target.selectedMorphs?V.target.selectedMorphs.forEach(function(O){return O.abandon()}):V.target.abandon();return!0}},{name:"resize manually",
exec:function(V,O){O=void 0===O?{}:O;var Ka,ea,Da,Sa,vb,Bb,Ib,wc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yc){switch(yc.nextAddress){case 1:Da=V.windowBounds();Sa=V.bounds();vb=Number;if(Bb=O.width){yc.jumpTo(2);break}return yc.yield(V.prompt("Enter world width",{input:Math.max(Sa.width,Da.width),requester:V}),3);case 3:Bb=yc.yieldResult;case 2:Ka=vb(Bb);if("number"!==typeof Ka){yc.jumpTo(4);break}Ib=Number;if(wc=O.height){yc.jumpTo(5);break}return yc.yield(V.prompt("Enter world height",
{input:Math.max(Sa.height,Da.height),requester:V}),6);case 6:wc=yc.yieldResult;case 5:ea=Ib(wc);case 4:return"number"!==typeof Ka||isNaN(Ka)||"number"!==typeof ea||isNaN(ea)||(V.extent=ed.pt(Ka,ea)),yc.return(!0)}})}},{name:"resize windows to fit visible world bounds",exec:function(V){var O=V.getWindows().filter(function(Sa){return!Sa.minimized});if(!O.length)return!0;V=V.visibleBoundsExcludingTopBar();var Ka=O.reduce(function(Sa,vb){return vb.bounds().union(Sa)},new ed.Rectangle(0,0,0,0)),ea=V.width/
Ka.width,Da=V.height/Ka.height;O.forEach(function(Sa){var vb=Sa.bounds();Sa.setBounds(new ed.Rectangle(vb.x*ea,vb.y*Da,vb.width*ea,vb.height*Da))});return!0}},{name:"window switcher",exec:function(V){var O,Ka,ea,Da,Sa,vb,Bb,Ib;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wc){if(1==wc.nextAddress){if((O=V.activePrompt())&&"lively.morphic-window switcher"===O.historyId)return O.focus(),wc.return(O.get("list").execCommand("select down"));Ka=V.submorphs.filter(function(yc){return yc.isWindow}).reverse().map(function(yc){return{isListItem:!0,
string:yc.title||String(yc),value:yc}});Ka.forEach(function(yc){yc.value.opacity=.5;yc.value.blur=1});return wc.yield(V.filterableListPrompt("Choose window",Ka,{preselect:1,requester:V,historyId:"lively.morphic-window switcher",onSelection:function(yc){ea&&(ea.minimized=Da,ea.blur=1,ea.animate({opacity:.3,duration:200}));if(ea=yc)yc.animate({opacity:1,duration:200}),yc.blur=0,Da=yc.minimized,yc.minimized=!1},width:1*V.visibleBounds().extent().x/3,itemPadding:ed.Rectangle.inset(4)}),2)}vb=Sa=wc.yieldResult;
Bb=$jscomp.makeIterator(vb.selected);Ib=Bb.next().value;Ka.forEach(function(yc){yc.value.opacity=1;yc.value.blur=0});Ib&&(Ib.activate(),Ib.minimized=!1);return wc.return(!0)})}},{name:"close active window or morph",exec:function(V){var O=V.focusedMorph;if(!O)return!0;var Ka=O.getWindow();V.undoStart("window close");Ka?Ka.close():(ed.arr.last(ed.arr.without(O.ownerChain(),V)).remove(),(Ka=V.activeWindow())&&Ka.activate());V.undoStop("window close");return!0}},{name:"toggle minimize active window",
exec:function(V){(V=V.activeWindow())&&V.toggleMinimize();return!0}},{name:"toggle minimize all windows",exec:function(V){(V=V.getWindows())&&V.map(function(O){return O.toggleMinimize()});return!0}},{name:"toggle minimize all except active window",exec:function(V){(V=V.getWindows().filter(function(O){return!O.isActive()}))&&V.map(function(O){return O.toggleMinimize()});return!0}},{name:"close all except active window",exec:function(V){(V=V.getWindows().filter(function(O){return!O.isActive()}))&&V.map(function(O){return O.close()});
return!0}},{name:"close all windows",exec:function(V){(V=V.getWindows())&&V.map(function(O){return O.close()});return!0}},{name:"open status message of focused morph",exec:function(V){var O=V.focusedMorph;if(V=$jscomp.makeIterator(O?V.visibleStatusMessagesFor(O):[]).next().value)V.expand(),V.focus();return V||!0}},{name:"resize active window",exec:function(V,O){function Ka(){var $d,te,Ed;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Je){if(1==Je.nextAddress)return Je.yield(V.filterableListPrompt("How to resize the window?",
"full center right left bottom top reset".split(" "),{requester:V}),2);$d=Je.yieldResult;te=$jscomp.makeIterator($d.selected);Ed=te.next().value;return Je.return(Ed)})}function ea($d,te){switch($d){case "full":return Ib;case "col1":case "left":return gd.withTopLeft(Ib.topLeft());case "col2":case "center":return gd.withCenter(Ib.center());case "col3":case "right":return gd.translatedBy(ed.pt(Ib.width-yc,0));case "top":return Ib.divide([ed.rect(0,0,1,.5)])[0];case "bottom":return Ib.divide([ed.rect(0,
.5,1,.5)])[0];case "reset":return Bb._normalBounds||ed.pt(500,400).extentAsRectangle().withCenter(te.center());default:return te}}O=void 0===O?{how:null,window:null}:O;var Da,Sa,vb,Bb,Ib,wc,yc,gd;return $jscomp.asyncExecutePromiseGeneratorProgram(function($d){if(1==$d.nextAddress){Da=O;Sa=Da.window;vb=Da.how;Bb=Sa||V.activeWindow();if(!Bb)return $d.return();Ib=V.visibleBoundsExcludingTopBar().insetBy(15);wc=Bb.bounds();Bb._normalBounds||(Bb._normalBounds=wc);yc=Math.min(700,Math.max(1E3,Ib.width/
3));gd=Ib.withWidth(yc);return vb?$d.jumpTo(2):$d.yield(Ka(),3)}2!=$d.nextAddress&&(vb=$d.yieldResult);if(!vb)return $d.return();Bb.setBounds(ea(vb,Ib));"reset"===vb&&delete Bb._normalBounds;return $d.return(!0)})}},{name:"[recovery] show last object editor saves",exec:function(V,O){return V.execCommand("[recovery] show last doits",Object.assign({},O,{title:"logged ObjectEditor save",logAccessFn:function(){return JSON.parse(localStorage["oe helper"]).saves}}))}},{name:"[recovery] show last doits",
description:"browse a list of your last doits",exec:function(V,O){O=void 0===O?{}:O;var Ka,ea,Da,Sa,vb,Bb,Ib,wc,yc,gd,$d,te,Ed,Je;return $jscomp.asyncExecutePromiseGeneratorProgram(function(He){if(1==He.nextAddress){Ka=O;(ea=Ka.logAccessFn)||(ea=function(){return JSON.parse(localStorage["lively.next-js-ide-doitlog"])});try{Da=ea()}catch(ye){}if(!Da)return He.return(V.inform("no log yet"));Sa=ed.arr.sortBy(Da.map(function(ye,oe){var of="string"===typeof ye?ye:ye.source;ye="string"===typeof ye?oe:ye.time||
oe;oe=ed.date.format(new Date(ye),"yy-mm-dd HH:MM");return{time:ye,source:of,printedTime:oe}}),function(ye){return-ye.time});vb=Sa.map(function(ye,oe){return{isListItem:!0,string:"["+ye.printedTime+"] "+ye.source.slice(0,100).replace(/\n/g,"").trim(),value:ye}});return He.yield(V.filterableListPrompt("select doit code",vb,{multiSelect:!0,requester:V}),2)}Bb=He.yieldResult;Ib=Bb.selected;if(Ib.length){wc=[];yc=$jscomp.makeIterator(Ib);for(gd=yc.next();!gd.done;gd=yc.next())te=$d=gd.value,Ed=te.source,
Je=te.printedTime,wc.push("// "+Je+"\n"+Ed);return He.return(V.execCommand("open workspace",Object.assign({title:"logged doits",mode:"js"},O,{content:wc.join("\n\n")})))}return He.return(!0)})}},{name:"open loading indicator",exec:function(V,O){V={};"object"===typeof O&&(V=O,O=V.label);return ed.LoadingIndicator.open(O,V)}},{name:"open workspace",exec:function(V,O,Ka,ea){O=void 0===O?{}:O;var Da,Sa,vb,Bb,Ib,wc,yc,gd,$d,te;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ed){switch(Ed.nextAddress){case 1:if(Da=
ea&&V.relayCommandExecutionToFocusedMorph(ea))return Ed.return(Da);Sa=O.language||O.mode||"javascript";vb={javascript:"lively.ide/js/workspace.js",shell:"lively.ide/shell/workspace.js",html:"lively.ide/html/workspace.js",py:"lively.ide/py/workspace.js",md:"lively.ide/md/workspace.js",sql:"lively.ide/sql/workspace.js",css:"lively.ide/css/workspace.js",text:null};Bb=Object.keys(ed.config.ide.modes.aliases).reduce(function(Je,He){var ye={};return Object.assign(Je,(ye[ed.config.ide.modes.aliases[He]]=
He,ye))},{});if(!O.askForMode){Ed.jumpTo(2);break}Ib=Object.keys(vb).concat("javascript console");return Ed.yield(V.filterableListPrompt("Open workspace for...",Ib),3);case 3:if(wc=Ed.yieldResult,yc=$jscomp.makeIterator(wc.selected),Sa=yc.next().value,!Sa)return Ed.return(!0);case 2:if("javascript console"===Sa)return Ed.return(V.execCommand("open console",O));O=Object.assign({content:""},O,{mode:Sa,language:Sa});gd=vb[O.language]||vb[Bb[O.language]];return"text"!==Sa&&gd?Ed.yield(System.import(gd),
4):Ed.return(V.execCommand("open text window",Object.assign({},ed.config.codeEditor.modes.text,{},O)));case 4:return $d=Ed.yieldResult,te=$d.default,Ed.return((new te({title:O.title||O.language+" workspace",center:V.center,content:O.content,target:O.target,systemInterface:O.systemInterface||O.backend})).activate())}})}},{name:"open console",exec:function(V,O){var Ka;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){if(1==ea.nextAddress)return ea.yield(ed.loadObjectFromPartsbinFolder("Console"),
2);Ka=ea.yieldResult;return ea.return(Ka.openInWorldNearHand())})}},{name:"open shell workspace",exec:function(V,O){return V.execCommand("open workspace",Object.assign({},O,{language:"shell"}))}},{name:"open javascript workspace",exec:function(V,O){return V.execCommand("open workspace",Object.assign({},O,{language:"javascript"}))}},{name:"open shell terminal",exec:function(V,O){var Ka,ea;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){if(1==Da.nextAddress)return Da.yield(System.import("lively.ide/shell/terminal.js"),
2);Ka=Da.yieldResult;ea=Ka.default;return Da.return(ea.open(O).openInWorldNearHand())})}},{name:"open text window",exec:function(V,O){var Ka=O=void 0===O?{}:O,ea=Ka.title,Da=Ka.extent,Sa=Ka.content,vb=Ka.mode,Bb=Ka.name;Ka=Ka.rangesAndStyles;ea=ea||"text window";Sa=Sa||"";Da=Da||ed.pt(500,400);Bb=Bb||"text workspace";Sa="string"===typeof Sa?[Sa,null]:Sa;O=new ed.Text(Object.assign({padding:ed.Rectangle.inset(3)},ed.obj.dissoc(O,["title","content"]),{textAndAttributes:Sa,clipMode:"auto",name:Bb,extent:Da}));
Ka&&O.setTextAttributesWithSortedRanges(Ka);vb&&O.changeEditorMode(vb);return V.openInWindow(O,{title:ea}).activate()}},{name:"merge and open in window",exec:function(V,O){O=void 0===O?{a:"",b:"",format:null,extent:ed.pt(500,600)}:O;var Ka;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){if(1==ea.nextAddress)return ea.yield(ed.loadObjectFromPartsbinFolder("text merger"),2);Ka=ea.yieldResult;return ea.return(Ka.targetMorph.open(O.a,O.b,O))})}},{name:"diff and open in window",exec:function(V,
O){var Ka,ea,Da;function Sa(te,Ed,Je){var He,ye,oe,of,Cf,rh,Bh,$g,Hf,ei,Gh,ni,wg,Lg;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pe){if(1==Pe.nextAddress){He=Je;ye=He.format;oe=null;if("patch"!==ye)return $d=gd[ye](te,Ed,Je),of=ed.arr.flatmap($d,function(Vi){var Pb=Vi.added;return[Vi.value,Vi.removed?{fontWeight:"normal",textDecoration:"line-through",fontColor:ed.Color.red}:Pb?{fontWeight:"bold",textDecoration:"",fontColor:ed.Color.green}:{fontWeight:"normal",textDecoration:"",fontColor:ed.Color.darkGray}]}),
Pe.jumpTo(2);Cf=Je;rh=Cf.headerA;Bh=Cf.headerB;$g=Cf.filenameA;Hf=Cf.filenameB;ei=Cf.context;of=[gd.createTwoFilesPatch($g||"a",Hf||"b",te,Ed,rh,Bh,"number"===typeof ei?{context:ei}:void 0),{}];return Pe.yield(System.import("lively.ide/diff/editor-plugin.js"),3)}2!=Pe.nextAddress&&(Gh=Pe.yieldResult,ni=Gh.default,oe=new ni);wg=V.execCommand("open text window",Je);Lg=wg.targetMorph;wg.extent=yc||ed.pt(300,200).maxPt(Lg.textBounds().extent());Lg.textAndAttributes=of;oe&&Lg.addPlugin(oe);return Pe.return(Lg)})}
O=void 0===O?{a:"",b:"",format:null,extent:ed.pt(500,600)}:O;var vb,Bb,Ib,wc,yc,gd,$d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(te){if(1==te.nextAddress){vb=O;Bb=vb.a;Ib=vb.b;wc=vb.format;yc=vb.extent;if(wc)Bb=String(Bb),Ib=String(Ib);else{a:{var Ed=Bb,Je=Ib;if(ed.obj.isPrimitive(Ed)||Ed instanceof RegExp||ed.obj.isPrimitive(Je)||Je instanceof RegExp)Ed=String(Ed),Je=String(Je);if("string"!==typeof Ed||"string"!==typeof Je)try{JSON.stringify(Ed);JSON.stringify(Je);Ka="diffJson";
ea=Ed;Da=Je;break a}catch(He){Ed=String(Ed),Je=String(Je)}Ka="diffLines";ea=Ed;Da=Je}Bb=ea;Ib=Da;wc=Ka}return te.yield(System.import("https://jspm.dev/diff"),2)}if(3!=te.nextAddress)return gd=te.yieldResult,te.yield(Sa(Bb,Ib,Object.assign({fontFamily:"monospace"},O,{format:wc})),3);$d=te.yieldResult;return te.return($d)})}},{name:"merge workspaces",exec:function(V,O){return V.execCommand("diff workspace",Object.assign({},O,{merge:!0}))}},{name:"diff workspaces",exec:function(V,O){function Ka(yc,gd){var $d=
yc.pluginFind(function(Ed){return Ed.evalEnvironment});$d=$d&&$d.evalEnvironment.targetModule||"no file";var te=gd.pluginFind(function(Ed){return Ed.evalEnvironment});return V.execCommand("diff and open in window",{a:yc.textString,b:gd.textString,filenameA:$d,filenameB:te&&te.evalEnvironment.targetModule||"no file"})}function ea(yc,gd){var $d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(te){if(1==te.nextAddress)return te.yield(ed.loadObjectFromPartsbinFolder("text merger"),2);$d=te.yieldResult;
return te.return($d.targetMorph.open(yc.textString,gd.textString))})}function Da(yc,gd){var $d,te,Ed,Je;return $jscomp.asyncExecutePromiseGeneratorProgram(function(He){if(1==He.nextAddress)return $d=yc.map(function(ye){return{isListItem:!0,value:ye,string:ye.name||String(ye)}}),He.yield(V.filterableListPrompt("choose text: ",$d,{onSelection:function(ye){debugger;ye&&ye.show()}}),2);te=He.yieldResult;Ed=$jscomp.makeIterator(te.selected);Je=Ed.next().value;return He.return(Je)})}O=void 0===O?{}:O;var Sa,
vb,Bb,Ib,wc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yc){switch(yc.nextAddress){case 1:Sa=O;vb=Sa.editor1;Bb=Sa.editor2;Ib=Sa.merge;vb&&Bb||(wc=V.withAllSubmorphsSelect(function(gd){return gd.isText&&!gd.isInputLine&&!gd.isUsedAsEpiMorph()}).reverse());if(vb){yc.jumpTo(2);break}return yc.yield(Da(wc),3);case 3:vb=yc.yieldResult;case 2:if(!vb)return yc.return(V.setStatusMessage("Canceled"));if(Bb){yc.jumpTo(4);break}return yc.yield(Da(ed.arr.without(wc,vb)),5);case 5:Bb=yc.yieldResult;
case 4:return Bb?yc.return(Ib?ea(vb,Bb):Ka(vb,Bb)):yc.return(V.setStatusMessage("Canceled"))}})}},{name:"search workspaces",exec:function(){function V(yc,gd){return yc.map(function($d){var te=$d.world()?$d.getWindow():$world.withAllSubmorphsDetect(function(ye){return ye.isWindow&&ye.targetMorph===ne}),Ed=0,Je=ed.string.lines($d.textString).find(function(ye,oe){ye=ye.toLowerCase();Ed=oe;return gd.every(function(of){return ye.includes(of)})}),He=te?te.title:$d.toString();return Je?{isListItem:!0,string:He+
" | "+Je,value:{window:te,morph:$d,row:Ed}}:null}).filter(Boolean)}function O(yc){return $world.withAllSubmorphsDo(function(gd){gd.isWindow&&gd.minimized&&gd.targetMorph&&gd.targetMorph.isText&&(gd=gd.targetMorph);if(!gd.textString||!gd.isText||gd.isUsedAsEpiMorph())return null;var $d=gd.textString.toLowerCase();return yc.every(function(te){return $d.includes(te)})?gd:null}).filter(Boolean)}var Ka=this,ea,Da,Sa,vb,Bb,Ib,wc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yc){if(1==yc.nextAddress)return yc.yield($world.filterableListPrompt("search workspaces",
[],{historyId:"lively.morphic-ide-search-workspaces-hist",customize:function(gd){gd.getSubmorphNamed("list").updateFilter=function(){var $d=this.parseInput();if(!(3>$d.input.length)){var te=O($d.lowercasedTokens);this.listMorph.items=V(te,$d.lowercasedTokens)}}}}),2);ea=yc.yieldResult;Da=$jscomp.makeIterator(ea.selected);return(Sa=Da.next().value)?(vb=Sa,Bb=vb.morph,Ib=vb.window,wc=vb.row,Ib&&(Ib.minimized&&Ib.toggleMinimize(),Ib.activate()),(Ib||Bb).show(),Ka.cursorPosition={row:wc,column:0},yc.return(Bb)):
yc.return(null)})}},{name:"open PartsBin",exec:function(V){var O,Ka,ea,Da;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sa){if(1==Sa.nextAddress)return O=ed.LoadingIndicator.open("Loading Partsbin..."),Sa.yield(System.import("lively.morphic/partsbin.js"),2);if(3!=Sa.nextAddress)return Ka=Sa.yieldResult,ea=Ka.loadPart,Sa.yield(ea("PartsBin"),3);Da=Sa.yieldResult;Da.openInWorldNearHand();Da.targetMorph.selectedCategory="*basics*";Da.focus();O.remove();Da.getWindow().activate();return Sa.return(Da)})}},
{name:"browse and load component",exec:function(V){var O,Ka,ea,Da,Sa,vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bb){switch(Bb.nextAddress){case 1:O=ed.LoadingIndicator.open("loading component browser");if(V._componentsBrowser){Bb.jumpTo(2);break}return Bb.yield(O.whenRendered(),2);case 2:if(Ka=V._componentsBrowser){Bb.jumpTo(4);break}Da=ea=V;return Bb.yield(ed.resource("part://SystemDialogs/master component browser").read(),5);case 5:Ka=Da._componentsBrowser=Bb.yieldResult;case 4:return Sa=
Ka,O.remove(),Bb.yield(Sa.activate(),6);case 6:(vb=Bb.yieldResult)&&!vb.world()&&vb.openInWorld(),Bb.jumpToEnd()}})}},{name:"load object from PartsBin",exec:function(V,O){O=void 0===O?{}:O;var Ka,ea,Da,Sa,vb,Bb,Ib,wc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yc){switch(yc.nextAddress){case 1:return ea=O,Da=ea.name,Sa=void 0===ea.open?!0:ea.open,Da?yc.yield(System.import("lively.morphic/partsbin.js"),6):yc.yield(System.import("lively.morphic/partsbin.js"),4);case 4:return vb=yc.yieldResult,
Bb=vb.interactivelyLoadObjectFromPartsBinFolder,yc.yield(Bb(),5);case 5:Ka=yc.yieldResult;yc.jumpTo(3);break;case 6:return Ib=yc.yieldResult,wc=Ib.loadObjectFromPartsbinFolder,yc.yield(wc(Da),7);case 7:Ka=yc.yieldResult;case 3:return Ka&&Sa&&Ka.openInWorldNearHand(),yc.return(Ka)}})}},{name:"open object drawer",exec:function(V){var O,Ka;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){if(1==ea.nextAddress)return ea.yield(System.import("lively.components/object-drawer.js"),2);O=ea.yieldResult;
Ka=O.default;return ea.return((new Ka).openInWorldNearHand())})}},{name:"open object editor",exec:function(V,O){O=void 0===O?{target:null,selectedClass:null,selectedMethod:null,evalEnvironment:null}:O;var Ka,ea,Da,Sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){if(1==vb.nextAddress){if(!O.target)return V.setStatusMessage("No target for ObjectEditor"),vb.return(null);Ka=O.loadingIndicator=ed.LoadingIndicator.open("Open Object Editor...");return vb.yield(System.import("lively.ide/js/objecteditor/index.js"),
2)}if(3!=vb.nextAddress)return ea=vb.yieldResult,Da=ea.ObjectEditor,vb.yield(Da.open(O),3);Sa=vb.yieldResult;Ka.remove();return vb.return(Sa)})}},{name:"open object inspector",exec:function(V,O){O=void 0===O?{target:null}:O;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ka){return O.target?Ka.return(ed.inspect(O.target)):(V.setStatusMessage("no target for Inspector"),Ka.return(null))})}},{name:"inspect server",exec:function(V){var O,Ka,ea,Da,Sa,vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bb){switch(Bb.nextAddress){case 1:return Bb.yield(System.import("lively.ide/js/inspector.js"),
2);case 2:return O=Bb.yieldResult,Ka=O.default,Bb.yield(System.import("lively-system-interface"),3);case 3:return ea=Bb.yieldResult,Da=ea.serverInterfaceFor,Sa=Da(System.baseURL+"eval"),vb={format:"esm",context:"global",targetModule:"lively://lively.next-workspace/world",sourceURL:"inspect-server_"+Date.now(),systemInterface:Sa},Bb.yield(Sa.runEval('\n           import LivelyServer from "lively.server/server.js";\n           let server = LivelyServer.servers.values().next().value;\n        ',vb),
4);case 4:Ka.openInWindow({remoteTarget:{code:"server",evalEnvironment:vb}}),Bb.jumpToEnd()}})}},{name:"open scene graph inspector",exec:function(V,O){O=void 0===O?{target:null}:O;var Ka;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){if(1==ea.nextAddress)return ea.yield(ed.loadObjectFromPartsbinFolder("scene graph inspector"),2);Ka=ea.yieldResult;Ka.targetMorph=O.target||V;return ea.return(Ka.openInWindow({title:"morph graph"}))})}},{name:"open browser",progressIndicator:"opening browser...",
exec:function(V,O,Ka,ea){O=void 0===O?{packageName:"lively.morphic",moduleName:"morph.js"}:O;var Da,Sa,vb,Bb,Ib;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wc){if(1==wc.nextAddress)return(Da=ea&&V.relayCommandExecutionToFocusedMorph(ea))?wc.return(Da):wc.yield(System.import("lively.ide/js/browser/index.js"),2);if(3!=wc.nextAddress)return Sa=wc.yieldResult,vb=Sa.default,Bb=ed.obj.select(O,["packageName","moduleName","textPosition","codeEntity","systemInterface"]),wc.yield(vb.browse(Bb,
{extent:ed.pt(700,600)}),3);Ib=wc.yieldResult;Ib.getWindow().activate();return wc.return(Ib)})}},{name:"choose and browse package resources",progressIndicator:"browsing resources...",exec:function(V,O,Ka,ea){O=void 0===O?{browser:null,systemInterface:null}:O;var Da,Sa,vb,Bb,Ib,wc,yc,gd,$d,te,Ed,Je,He,ye,oe,of,Cf,rh,Bh,$g,Hf,ei,Gh,ni;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wg){switch(wg.nextAddress){case 1:if(Da=ea&&V.relayCommandExecutionToFocusedMorph(ea))return wg.return(Da);
Sa=(Sa=O.browser||V.focusedMorph&&V.focusedMorph.ownerChain().find(function(Lg){return Lg.isBrowser}))&&Sa.isBrowser?Sa.getWindow():null;return wg.yield(System.import("lively-system-interface"),2);case 2:return vb=wg.yieldResult,Bb=vb.localInterface,Ib=O&&O.systemInterface?O.systemInterface:Sa?Sa.systemInterface:Bb,wg.yield(Ib.getPackages({excluded:ed.config.ide.js.ignoredPackages}),3);case 3:wc=wg.yieldResult,yc=[],gd={},$d=$jscomp.makeIterator(wc),te=$d.next();case 4:if(te.done)return wg.yield(V.filterableListPrompt("Choose module to open",
yc,{historyId:"lively.morphic-choose and browse package resources",requester:Sa,width:700,multiSelect:!0,fuzzy:"value.shortName"}),8);gd.$jscomp$loop$prop$p$2737=te.value;gd.$jscomp$loop$prop$excluded$2736=(ed.Path("lively.ide.exclude").get(gd.$jscomp$loop$prop$p$2737)||[]).map(function(Lg){return Lg.includes("*")?new RegExp(Lg.replace(/\*/g,".*")):Lg});gd.$jscomp$loop$prop$excluded$2736.push(".git","node_modules",".module_cache");Ed=yc.push;Je=Ed.apply;He=yc;ye=$jscomp;oe=ye.arrayFromIterable;of=
function(Lg){return function(Pe){return{isListItem:!0,string:"["+Lg.$jscomp$loop$prop$p$2737.name+"] "+Pe.nameInPackage+(Pe.isLoaded?"":" [not loaded]"),value:Pe}}}(gd);Cf=function(Lg){return function(Pe){var Vi=Pe.url;return!Vi.endsWith("/")&&!Lg.$jscomp$loop$prop$excluded$2736.some(function(Pb){return Pb instanceof RegExp?Pb.test(Vi):Vi.includes(Pb)})}}(gd);return wg.yield(Ib.resourcesOfPackage(gd.$jscomp$loop$prop$p$2737,gd.$jscomp$loop$prop$excluded$2736),7);case 7:Je.call(Ed,He,oe.call(ye,wg.yieldResult.filter(Cf).sort(function(Lg,
Pe){return Lg.isLoaded&&!Pe.isLoaded?-1:!Lg.isLoaded&&Pe.isLoaded?1:Lg.nameInPackage.toLowerCase()<Pe.nameInPackage.toLowerCase()?-1:Lg.nameInPackage.toLowerCase()==Pe.nameInPackage.toLowerCase()?0:1}).map(of)));gd={$jscomp$loop$prop$excluded$2736:gd.$jscomp$loop$prop$excluded$2736,$jscomp$loop$prop$p$2737:gd.$jscomp$loop$prop$p$2737};te=$d.next();wg.jumpTo(4);break;case 8:return rh=wg.yieldResult,Bh=rh.selected,$g=$jscomp.makeIterator(ed.arr.partition(Bh,function(Lg){return Lg.url.match(/\.js(on)?/)})),
Hf=$g.next().value,ei=$g.next().value,wg.yield(System.import("lively.ide/js/browser/index.js"),9);case 9:return Gh=wg.yieldResult,ni=Gh.default,wg.yield(Promise.all(Hf.map(function(Lg){return ni.browse({packageName:Lg.package,moduleName:Lg.url},Sa,Ib).then(function(Pe){return Pe.activate()})})),10);case 10:if(!ei.length){wg.jumpTo(11);break}return wg.yield(Promise.all(ei.map(function(Lg){return V.execCommand("open file",{url:Lg.url})})),11);case 11:return wg.return(!0)}})}},{name:"choose and browse module",
progressIndicator:"browsing module...",handlesCount:!0,exec:function(V,O,Ka){O=void 0===O?{browser:void 0,systemInterface:void 0}:O;var ea,Da,Sa,vb,Bb,Ib,wc,yc,gd,$d,te,Ed,Je,He,ye,oe,of,Cf,rh;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bh){switch(Bh.nextAddress){case 1:if(!O.browser&&(Da=(ea=V.focusedMorph)&&ea.getWindow())&&Da.targetMorph&&Da.targetMorph.isFileBrowser)return Bh.return(Da.targetMorph.execCommand("find file and select",O,Ka));Sa=O.browser||ea&&ea.ownerChain().find(function($g){return $g.isBrowser});
return Bh.yield(System.import("lively.ide/js/browser/index.js"),2);case 2:return vb=Bh.yieldResult,Bb=vb.default,Bh.yield(System.import("lively-system-interface"),3);case 3:return Ib=Bh.yieldResult,wc=Ib.localInterface,yc=O&&O.systemInterface?O.systemInterface:Sa?Sa.systemInterface:wc,gd="local"==yc.name?"":" on ["+ed.string.truncate(yc.name,35,"...")+"]",Bh.yield(yc.getPackages(),4);case 4:$d=Bh.yieldResult;te=[];Ed=$jscomp.makeIterator($d);for(Je=Ed.next();!Je.done;Je=Ed.next())for(He=Je.value,
ye=ed.Path("lively.ide.exclude").get(He)||[],ye=ye.map(function($g){return $g.includes("*")?new RegExp($g.replace(/\*/g,".*")):$g}),oe={},of=$jscomp.makeIterator(He.modules),Cf=of.next();!Cf.done;oe={$jscomp$loop$prop$m$2739:oe.$jscomp$loop$prop$m$2739},Cf=of.next())oe.$jscomp$loop$prop$m$2739=Cf.value,ye.some(function($g){return function(Hf){return Hf instanceof RegExp?Hf.test($g.$jscomp$loop$prop$m$2739.name):$g.$jscomp$loop$prop$m$2739.name.includes(Hf)}}(oe))||(rh=yc.shortModuleName(oe.$jscomp$loop$prop$m$2739.name,
He),te.push({isListItem:!0,string:"["+He.name+"] "+rh,value:{package:He,module:oe.$jscomp$loop$prop$m$2739,shortName:rh}}));te=ed.arr.sortBy(te,function($g){return $g.string});(function(){var $g,Hf,ei,Gh,ni,wg,Lg,Pe,Vi;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pb){switch(Pb.nextAddress){case 1:return $g=Sa||ea,Pb.yield(V.filterableListPrompt("Choose module to open"+gd,te,{historyId:"lively.morphic-choose and browse module",requester:$g,height:Math.min($g.height,700),width:500,multiSelect:!0,
listFontColor:"white",fuzzy:"value.shortName"}),2);case 2:Hf=Pb.yieldResult,ei=Hf.selected,Gh=0;case 3:if(!(Gh<ei.length)){Pb.jumpTo(0);break}ni=ei[Gh];wg=ni.package;Lg=ni.shortName;Pe={packageName:wg.name,moduleName:Lg};return Pb.yield(Bb.browse(Pe,0===Gh?Sa:void 0,yc),6);case 6:Vi=Pb.yieldResult,Vi.moveBy(ed.pt(20*Gh,20*Gh)),Vi.getWindow().activate(),Gh++,Pb.jumpTo(3)}})})();return Bh.return(!0)}})}},{name:"open code search",progressIndicator:"opening code search...",exec:function(V,O){O=void 0===
O?{browser:null,systemInterface:null,input:null}:O;var Ka,ea,Da,Sa,vb,Bb,Ib,wc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yc){if(1==yc.nextAddress){Ka=V.focusedMorph?V.focusedMorph.ownerChain():[];ea=O.browser||Ka.find(function(gd){return gd.isBrowser});Da=ed.LoadingIndicator.open("loading code search");if(ea&&ea.isBrowser){if(ea.state.associatedSearchPanel)return yc.return(ea.state.associatedSearchPanel.getWindow().activate())}else ea=null;return yc.yield(System.import("lively-system-interface"),
2)}if(3!=yc.nextAddress)return Sa=yc.yieldResult,vb=Sa.localInterface,Bb=O.systemInterface||ea&&ea.systemInterface,Bb||(Bb=(Ib=Ka.find(function(gd){return gd.isText&&gd.editorPlugin&&gd.editorPlugin.isJSEditorPlugin}))?Ib.editorPlugin.systemInterface():vb),yc.yield(ed.resource("part://SystemIDE/code search").read(),3);wc=yc.yieldResult;Object.assign(wc,{browser:ea,input:O.input,systemInterface:Bb});wc.openInWindow();wc.focus();Da.remove();ea&&(ea.state.associatedSearchPanel=wc);return yc.return(wc)})}},
{name:"open grep search",progressIndicator:"opening code search...",exec:function(V,O){var Ka;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){if(1==ea.nextAddress)return ea.yield(ed.loadObjectFromPartsbinFolder("grep search"),2);Ka=ea.yieldResult;return ea.return(Ka.openInWorldNearHand(V).activate())})}},{name:"open test runner",progressIndicator:"opening test runner...",exec:function(V){var O,Ka;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){return 1==ea.nextAddress?
ea.yield(System.import("lively.ide/test-runner.js"),2):3!=ea.nextAddress?(O=ea.yieldResult,Ka=O.default,ea.yield(Ka.open(),3)):ea.return(ea.yieldResult)})}},{name:"open file browser",progressIndicator:"opening file browser...",exec:function(V,O){O=void 0===O?{}:O;var Ka,ea,Da,Sa,vb,Bb,Ib;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wc){if(1==wc.nextAddress)return wc.yield(System.import("lively.ide/http-file-browser.js"),2);Ka=wc.yieldResult;ea=Ka.default;Da=O;Sa=Da.location;vb=Da.url;
Ib=(Bb=Da.file)?ea.forFile(Bb,Sa):ea.forLocation(vb||Sa||document.location.origin);return wc.return(V.openInWindow(Ib).activate())})}},{name:"open file",progressIndicator:"opening file...",exec:function(V,O){O=void 0===O?{url:null,lineNumber:null,reuse:!1}:O;var Ka,ea,Da,Sa,vb,Bb,Ib,wc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yc){switch(yc.nextAddress){case 1:Ka=O;ea=Ka.url;Da=Ka.lineNumber;Sa=Ka.reuse;vb=V.commandHandler.progressIndicator;if(ea){yc.jumpTo(2);break}vb.visible=!1;
debugger;return yc.yield(V.prompt("Enter file location",{historyId:"lively.morphic-text editor url",useLastInput:!0}),3);case 3:ea=yc.yieldResult,vb.visible=!0;case 2:if(Sa&&(V.getWindows().slice(-2),Bb=ed.arr.findAndGet(V.getWindows(),function(gd){return(gd=gd.targetMorph)&&gd.isTextEditor&&gd.location.split(":")[0]===ea?gd:null})))return"number"===typeof Da&&(Bb.lineNumber=Da),yc.return(Bb.getWindow().activate());Da&&(ea+=":"+Da);return yc.yield(System.import("lively.ide/text-editor.js"),4);case 4:return Ib=
yc.yieldResult,wc=Ib.default,yc.return(ea?wc.openURL(ea,ed.obj.dissoc(O,["url"])):null)}})}},{name:"open file for EDITOR",exec:function(V,O){O=void 0===O?{url:null,lineNumber:null}:O;var Ka,ea,Da,Sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){return 1==vb.nextAddress?vb.yield(System.import("lively.ide/text-editor.js"),2):3!=vb.nextAddress?(Ka=vb.yieldResult,ea=Ka.default,Da=O,Sa=Da.url,vb.yield(ea.openAsEDITOR(Sa,{}),3)):vb.return(vb.yieldResult)})}},{name:"open subserver controller",
exec:function(V,O){var Ka;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){if(1==ea.nextAddress)return ea.yield(ed.loadPart("subserver controller"),2);Ka=ea.yieldResult;return ea.return(Ka.openInWorld())})}},{name:"[lively.installer] publish new version of a package",exec:function(V){var O,Ka;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){switch(ea.nextAddress){case 1:return ea.yield(lively.modules.registerPackage(document.location.origin+"/lively.installer"),2);case 2:return ea.yield(System.import("lively.installer/packages/publish-new-package-version.js"),
3);case 3:return O=ea.yieldResult,Ka=O.default,ea.yield(Ka(),4);case 4:return ea.return(!0)}})}},{name:"report a bug",exec:function(V){return $jscomp.asyncExecutePromiseGeneratorProgram(function(O){window.open("https://github.com/LivelyKernel/lively.next/issues/new","_blank");return O.return(!0)})}},{name:"fix font metric",exec:function(V){return $jscomp.asyncExecutePromiseGeneratorProgram(function(O){V.env.fontMetric.reset();V.withAllSubmorphsDo(function(Ka){return Ka.isText&&Ka.textLayout&&Ka.textLayout.reset()});
return O.return(!0)})}},{name:"delete change history",exec:function(V){var O=V.env,Ka=O.printStatus();O.deleteHistory();V.setStatusMessage(Ka);V._componentsBrowser&&V._componentsBrowser.reset();return!0}},{name:"install global inspect and show",exec:function(V){window.show=ed.show;window.inspect=ed.inspect;V.setStatusMessage("inspect() and show() are now globally available");return!0}},{name:"save world",exec:function(V,O,Ka,ea){var Da,Sa,vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bb){if(1==
Bb.nextAddress){if(Da=ea&&V.relayCommandExecutionToFocusedMorph(ea))return Bb.return(Da);O=Object.assign({confirmOverwrite:!0,showSaveDialog:!0},O);Sa=V.focusedMorph;return Bb.yield(ed.interactivelySaveWorld(V,O),2)}vb=Bb.yieldResult;Sa&&Sa.focus();return Bb.return(vb)})}},{name:"freeze world",exec:function(V){return $jscomp.asyncExecutePromiseGeneratorProgram(function(O){return O.yield(ed.interactivelyFreezeWorld(V),0)})}},{name:"save this world",exec:function(V,O,Ka,ea){return V.execCommand("save world",
Object.assign({confirmOverwrite:!0},O,{showSaveDialog:!1}))}},{name:"load world",exec:function(V,O){O=void 0===O?{}:O;var Ka,ea,Da,Sa,vb,Bb,Ib,wc,yc,gd,$d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(te){switch(te.nextAddress){case 1:Ka=O;ea=Ka.id;Da=Ka.commit;Sa=Ka.name;vb=Ka.ref;Bb=Ka.world;Ib=V.constructor;if(Bb)return te.return(Ib.loadWorld(Bb,V));if(ea||Da)return te.return(Ib.loadFromCommit(ea||Da,V));if(Sa)return te.return(Ib.loadFromDB(Sa,vb,V));wc=ed.LoadingIndicator.open("loading project browser...");
return te.yield(wc.whenRendered(),2);case 2:yc=ed.morph({fill:ed.Color.black.withA(.5),extent:V.extent,name:"dark overlay",opacity:0,reactsToPointer:!1,renderOnGPU:!0,halosEnabled:!1});yc.openInWorld(ed.pt(0,0));yc.animate({opacity:1,duration:300});if(gd=V.get("a project browser")){te.jumpTo(3);break}return te.yield(ed.resource("part://partial freezing/project browser").read(),4);case 4:gd=te.yieldResult;case 3:return $d=gd,$d.name="a project browser",$d.hasFixedPosition=!0,$d.epiMorph=!0,$d.bringToFront().alignInWorld(V),
$d.update(),$d.focus(),ed.once($d,"remove",function(){return yc.animate({opacity:0}).then(function(){return yc.remove()})}),wc.remove(),te.return($d)}})}},{name:"add external package dependency to object",exec:function(V,O){O=void 0===O?{}:O;var Ka,ea,Da,Sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){if(1==vb.nextAddress)return Ka=O.target||V,ea=Ka.metadata&&Ka.metadata.externalPackages||[],vb.yield(V.editListPrompt("modify package dependencies of "+Ka,ea),2);Da=vb.yieldResult;
Sa=Da.list;if(!Sa)return vb.return();Sa.length?(Ka.metadata||(Ka.metadata={}),Ka.metadata.externalPackages=Sa):Ka.metadata&&delete Ka.metadata.externalPackages;return vb.return(!0)})}},{name:"toggle comment browser",exec:function(V){return $jscomp.asyncExecutePromiseGeneratorProgram(function(O){ed.CommentBrowser.toggle();O.jumpToEnd()})}}];var pg=ed.commands;ed.default=pg;var Qc=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js");Qc.RadialGradient=Bc;Qc.Point=vd;Qc.pt=id;Qc.rect=
hc;Qc.Color=Kb;Qc.LinearGradient=pb;Qc.Morph=lb;Qc.Tooltip=Zb;Qc.Image=rb;Qc.VerticalLayout=Mb;Qc.GridLayout=ub;Qc.Text=Rc;Qc.Ellipse=rc;Qc.morph=ne;Qc.Icon=Ta;Qc.num=Lb;Qc.arr=sc;Qc.connect=mb;Qc.signal=Gb;Qc.Popover=Se;Qc.ColorPalette=yf;Qc.ColorPicker=wf;Qc.colorWidgets=ug;Qc.joinPath=vc;Qc.WHEEL_URL=Qc.joinPath(System.baseURL,"/lively.ide/assets/color-wheel.png");(function(V){var O=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ka=O.hasOwnProperty("GradientTypeSelector")&&
"function"===typeof O.GradientTypeSelector?O.GradientTypeSelector:O.GradientTypeSelector=function(ea){ea&&ea[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Lc(Ka,V,[{key:"defaultLinearGradient",get:function(){return new Qc.LinearGradient({stops:[{color:Qc.Color.white,offset:0},{color:Qc.Color.black,offset:1}]})}},{key:"defaultRadialGradient",get:function(){return new Qc.RadialGradient({stops:[{color:Qc.Color.white,offset:0},{color:Qc.Color.black,
offset:1}],focus:Qc.pt(.5,.5),bounds:Qc.rect(0,0,30,30)})}},{key:"update",value:function(ea){var Da=$jscomp.makeIterator(this.submorphs),Sa=Da.next().value;Da=Da.next().value;Sa.borderColor=Da.borderColor=Qc.Color.gray.darker();ea instanceof Qc.RadialGradient?Sa.borderColor=Qc.Color.orange:ea instanceof Qc.LinearGradient&&(Da.borderColor=Qc.Color.orange)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientTypeSelector"}},{key:"properties",get:function(){return{fill:{defaultValue:Qc.Color.transparent},
layout:{initialize:function(){this.extent=Qc.pt(180,40);this.layout=new Qc.GridLayout({grid:[[null,"radialMode",null,"linearMode",null]],autoAssign:!1,fitToCell:!1})}},submorphs:{initialize:function(){var ea=this,Da=$jscomp.makeIterator(this.submorphs=[Qc.morph({type:"ellipse",master:{auto:"styleguide://SystemWidgets/gradient mode/deselected"},name:"radialMode",fill:this.defaultRadialGradient}),Qc.morph({type:"ellipse",master:{auto:"styleguide://SystemWidgets/gradient mode/deselected"},name:"linearMode",
fill:this.defaultLinearGradient})]),Sa=Da.next().value;Da=Da.next().value;Qc.connect(Sa,"onMouseDown",function(){return Qc.signal(ea,"radial")});Qc.connect(Da,"onMouseDown",function(){return Qc.signal(ea,"linear")})}}}}}],O,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:660,
end:2566})})(Qc.Morph);var Va=function(V){var O=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ka=O.hasOwnProperty("GradientEditor")&&"function"===typeof O.GradientEditor?O.GradientEditor:O.GradientEditor=function(ea){ea&&ea[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Lc(Ka,V,[{key:"remove",value:function(){Lc._get(Object.getPrototypeOf(Ka.prototype),"remove",this).call(this);this.gradientHandle&&
this.gradientHandle.remove()}},{key:"selectRadialGradient",value:function(){var ea=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){return 1==Da.nextAddress?(ea.get("linearMode").borderColor=Qc.Color.gray.darker(),ea.get("radialMode").borderColor=Qc.Color.orange,Da.yield(ea.applyGradient(Qc.RadialGradient),2)):Da.yield(ea.updateGradientHandles(),0)})}},{key:"selectLinearGradient",value:function(){var ea=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){return 1==
Da.nextAddress?(ea.get("radialMode").borderColor=Qc.Color.gray.darker(),ea.get("linearMode").borderColor=Qc.Color.orange,Da.yield(ea.applyGradient(Qc.LinearGradient),2)):Da.yield(ea.updateGradientHandles(),0)})}},{key:"applyGradient",value:function(ea){var Da=this,Sa,vb,Bb,Ib,wc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yc){Sa=Da.gradientValue;Da.get("gradientEditor");Sa&&Sa.isGradient?(vb=Sa,Bb=vb.stops,Ib=vb.focus,wc=vb.vector,Da.gradientValue=new ea({stops:Bb,bounds:Da.gradientBounds,
focus:Ib,vector:wc})):Da.gradientValue=new ea({stops:[{color:Qc.Color.white,offset:0},{color:Qc.Color.black,offset:1}],bounds:Da.gradientBounds});Da.update(Da.gradientValue);yc.jumpToEnd()})}},{key:"showGradientHandlesOn",value:function(ea){this.handleMorph=ea;this.updateGradientHandles()}},{key:"updateGradientHandles",value:function(){var ea=this,Da,Sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){if(1==vb.nextAddress)return Da=300,Sa=ea.gradientValue.__proto__.constructor,ea.handleMorph?
ea.gradientHandle?vb.yield(ea.gradientHandle.fadeOut(Da),3):vb.jumpTo(2):vb.return();Sa==Qc.RadialGradient?ea.gradientHandle=new Qc.GradientFocusHandle({target:ea.handleMorph}):Sa==Qc.LinearGradient&&(ea.gradientHandle=new Qc.GradientDirectionHandle({target:ea.handleMorph}));ea.gradientHandle&&(Qc.signal(ea,"openHandle",ea.gradientHandle),ea.gradientHandle.relayout(),ea.gradientHandle.opacity=0,ea.gradientHandle.animate({opacity:1,duration:Da}));vb.jumpToEnd()})}},{key:"update",value:function(ea){(ea=
void 0===ea?this.gradientValue:ea)&&ea.isGradient&&this.get("gradientEditor").update(ea)}},{key:"build",value:function(){var ea;this.submorphs=[ea=new Qc.GradientTypeSelector({name:"typeSelector"}),this.gradientEditor()];Qc.connect(ea,"radial",this,"selectRadialGradient");Qc.connect(ea,"linear",this,"selectLinearGradient");Qc.connect(this,"gradientValue",this,"update");this.update(this.gradientValue);ea.update(this.gradientValue);this.gradientValue&&this.updateGradientHandles()}},{key:"gradientEditor",
value:function(){return Qc.morph({fill:null,clipMode:"hidden",extent:Qc.pt(190,80),submorphs:[new Qc.GradientStopVisualizer({position:Qc.pt(5,30),name:"gradientEditor",gradientEditor:this})]})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientEditor"}},{key:"properties",get:function(){return{layout:{initialize:function(){this.layout=new Qc.VerticalLayout({spacing:3})}},fill:{defaultValue:Qc.Color.transparent},handleMorph:{},gradientValue:{set:function(ea){ea&&ea.isGradient||
(ea=!1);this.setProperty("gradientValue",ea)}},submorphs:{initialize:function(){this.build()}}}}}],O,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:2575,end:6191})}(Qc.Morph);Qc.GradientEditor=Va;Qc.GradientEditor=Va;Qc.GradientEditor=Va;(function(V){var O=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),
Ka=O.hasOwnProperty("StopControlHead")&&"function"===typeof O.StopControlHead?O.StopControlHead:O.StopControlHead=function(ea){ea&&ea[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Lc(Ka,V,[{key:"update",value:function(ea){var Da=this.getSubmorphNamed("paletteField");this.getSubmorphNamed("pickerField");Da||(this.submorphs=[Da=this.paletteField(Qc.pt(10,10))]);Da.fill=this.stopColor=ea.stops[this.index].color}},{key:"onHoverIn",
value:function(){var ea=this.targetProperty.stops[this.index].color;this.palette=this.palette||new Qc.Popover({name:"Color Palette",targetMorph:new Qc.ColorPalette({color:ea})});Qc.connect(this.palette.targetMorph,"color",this.palette,"color");this.picker=this.picker||new Qc.ColorPicker({color:ea});this.picker.color=ea;this.scheduleExpand()}},{key:"onHoverOut",value:function(){this.scheduleShrink()}},{key:"scheduleExpand",value:function(){this.queue.pop()||(this.queue.push(this.expand),this.dequeue())}},
{key:"scheduleShrink",value:function(){this.queue.pop()||(this.queue.push(this.shrink),this.dequeue())}},{key:"dequeue",value:function(){var ea=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){if(1==Da.nextAddress){if(ea.queueActive)return Da.return();ea.queueActive=!0}if(3!=Da.nextAddress)return 0<ea.queue.length?Da.yield(ea.queue.shift().bind(ea)(),2):Da.jumpTo(3);ea.queueActive=!1;Da.jumpToEnd()})}},{key:"expand",value:function(){var ea=this,Da,Sa,vb,Bb,Ib,wc,yc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gd){if(1<
ea.submorphs.length)return gd.return();Da=ea.get("paletteField");vb=Qc.pt(2,-14);ea.submorphs=[ea.closeButton(),Da,ea.pickerField()];ea.master={auto:"styleguide://SystemWidgets/stop control head/expanded"};Sa=ea.get("gradientEditor");Bb=ea.transformRectToMorph(Sa,ea.innerBounds());Ib=Bb.x;wc=Bb.width;yc=Ib+wc-Sa.width;Ib<ea.width/2&&(vb=vb.addXY(ea.width/3-Ib,0));yc>ea.width/2&&(vb=vb.addXY(ea.width/3-yc,0));Da.extent=Qc.pt(15,15);ea.center=vb;ea.stopVisualizer.gradientEditor.update();gd.jumpToEnd()})}},
{key:"shrink",value:function(){var ea=this,Da,Sa,vb,Bb,Ib;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wc){if(3>ea.submorphs.length)return wc.return();Da=Qc.pt(2,-14);Sa=$jscomp.makeIterator([ea.get("close"),ea.get("paletteField"),ea.get("pickerField")]);vb=Sa.next().value;Bb=Sa.next().value;Ib=Sa.next().value;Bb.bringToFront();vb.remove();Ib.remove();ea.master={auto:"styleguide://SystemWidgets/stop control head/collapsed"};ea.center=Da;wc.jumpToEnd()})}},{key:"onWidgetClosed",value:function(){this.palette=
this.picker=null;this.shrink()}},{key:"removeStop",value:function(){this.stopVisualizer.removeStop(this.index)&&this.remove()}},{key:"closeButton",value:function(){var ea=new Qc.Morph({name:"close",extent:Qc.pt(15,15),fill:Qc.Color.transparent,origin:Qc.pt(0,-3),clipMode:"hidden",submorphs:[Qc.Icon.makeLabel("times",{styleClasses:["closeButton"]})]});Qc.connect(ea,"onMouseDown",this,"removeStop");return ea}},{key:"updateColor",value:function(ea){this.stopVisualizer.updateStop(this.index,{color:ea})}},
{key:"openColorWidget",value:function(ea){this.stopVisualizer.stopControls.forEach(function(Da){return Da.head.closeAllWidgets()});this[ea].topLeft=Qc.pt(0,0);Qc.connect(this[ea],"color",this,"updateColor");Qc.connect(this[ea],"close",this,"onWidgetClosed");Qc.connect(this.stopVisualizer,"remove",this[ea],"remove");Qc.connect(this[ea],"onBlur",this,"removeWhenLostFocus",{converter:function(){return ea},varMapping:{name:ea}});this[ea].fadeIntoWorld(this.globalBounds().bottomCenter());this[ea].focus()}},
{key:"removeWhenLostFocus",value:function(ea){var Da=this;setTimeout(function(){$world.focusedMorph.ownerChain().includes(Da[ea])||$world.focusedMorph.isMenuItem?Da[ea].focus():Da.closeColorWidget(ea)},100)}},{key:"closeColorWidget",value:function(ea){this[ea]&&this[ea].remove()}},{key:"closeAllWidgets",value:function(){this.closeColorWidget("palette");this.closeColorWidget("picker")}},{key:"paletteField",value:function(ea){ea=Qc.morph({type:"ellipse",name:"paletteField",extent:ea,styleClasses:["paletteField"]});
Qc.connect(ea,"onMouseDown",this,"openColorWidget",{converter:function(){return"palette"}});return ea}},{key:"pickerField",value:function(){var ea=new Qc.Image({name:"pickerField",styleClasses:["pickerField"]});Qc.connect(ea,"onMouseDown",this,"openColorWidget",{converter:function(){return"picker"}});return ea}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"StopControlHead"}},{key:"properties",get:function(){return{stopVisualizer:{},gradientEditor:{},targetProperty:{get:function(){return this.stopVisualizer.targetProperty}},
master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/stop control head/collapsed"}}},index:{},queue:{defaultValue:[]},isHaloItem:{defaultValue:!0}}}}],O,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:6193,end:11487})})(Qc.Morph);(function(V){var O=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),
Ka=O.hasOwnProperty("GradientStopVisualizer")&&"function"===typeof O.GradientStopVisualizer?O.GradientStopVisualizer:O.GradientStopVisualizer=function(ea){ea&&ea[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Lc(Ka,V,[{key:"update",value:function(ea){this.fill=new Qc.LinearGradient({stops:ea.stops,vector:"eastwest"});this.get("instruction").animate({visible:!1,duration:300});this.renderStopControls(ea)}},{key:"onHoverOut",value:function(){this.toggleStopPreview(!1)}},
{key:"onMouseMove",value:function(ea){var Da=ea.positionIn(this);ea=Da.x;this.stopControls&&this.stopControls.find(function(Sa){return Sa.bounds().containsPoint(Da)})?this.toggleStopPreview(!1):(this.toggleStopPreview(!0),this.get("stopControlPreview").position=Qc.pt(ea,0))}},{key:"onMouseDown",value:function(ea){if(this.get("stopControlPreview").visible){var Da=ea.positionIn(this).x/this.width;ea=this.targetProperty.stops.findIndex(function(Sa){return Sa.offset>Da});ea=0>ea?this.targetProperty.stops.length-
1:ea;this.insertStop(ea,Da)}}},{key:"toggleStopPreview",value:function(ea){this.get("instruction").visible||(this.get("stopControlPreview").visible=ea)}},{key:"removeStop",value:function(ea){var Da=this.targetProperty;return 2<Da.stops.length?(Qc.arr.removeAt(Da.stops,ea),this.targetProperty=Da,!0):!1}},{key:"insertStop",value:function(ea,Da){var Sa=this.targetProperty;Qc.arr.pushAt(Sa.stops,{offset:Da,color:Sa.stops[ea].color},ea);this.targetProperty=Sa}},{key:"updateStop",value:function(ea,Da){var Sa=
this.targetProperty;Sa.stops[ea]=Object.assign({},Sa.stops[ea],{},Da);this.targetProperty=Sa}},{key:"renderStopControls",value:function(ea){var Da=this;if(!this.stopControls||this.stopControls.length!=ea.stops.length){var Sa=$jscomp.makeIterator(this.submorphs),vb=Sa.next().value;Sa=Sa.next().value;this.stopControls=ea.stops.map(function(Bb,Ib){return new Qc.GradientStopControl({stopVisualizer:Da,index:Ib})});this.submorphs=[vb,Sa].concat($jscomp.arrayFromIterable(this.stopControls));Qc.arr.invoke(this.stopControls,
"update",ea)}Qc.arr.invoke(this.stopControls,"update",ea)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientStopVisualizer"}},{key:"properties",get:function(){return{fill:{defaultValue:Qc.Color.gray},gradientEditor:{},draggable:{defaultValue:!1},targetProperty:{derived:!0,get:function(){return this.gradientEditor&&this.gradientEditor.gradientValue},set:function(ea){this.gradientEditor.gradientValue=ea}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient stop visualizer"}}},
submorphs:{after:["gradientEditor"],initialize:function(){this.submorphs=[{type:"label",name:"instruction",value:"Select Gradient Type",visible:!(this.targetProperty&&this.targetProperty.isGradient)},{name:"stopControlPreview",visible:!1,master:{auto:"styleguide://SystemWidgets/stop control preview"},submorphs:[Qc.Icon.makeLabel("plus-circle",{name:"addStopLabel"})]}]}}}}}],O,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:11489,end:14883})})(Qc.Morph);(function(V){var O=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ka=O.hasOwnProperty("GradientStopControl")&&"function"===typeof O.GradientStopControl?O.GradientStopControl:O.GradientStopControl=function(ea){ea&&ea[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return Lc(Ka,V,[{key:"update",value:function(ea){this.position=this.stopVisualizer.extent.subPt(Qc.pt(10,0)).scaleByPt(Qc.pt(ea.stops[this.index].offset,0)).addPt(Qc.pt(5,0));this.head.update(ea)}},{key:"onDragStart",value:function(ea){this.nativeCursor="-webkit-grabbing";this.stopVisualizer.nativeCursor="-webkit-grabbing";this.offsetView=(new Qc.Tooltip).openInWorld(ea.hand.position.addPt(Qc.pt(10,10)))}},{key:"onDrag",value:function(ea){var Da=Math.max(0,Math.min(1,(this.position.x-
5+ea.state.dragDelta.x)/(this.stopVisualizer.width-10)));this.stopVisualizer.updateStop(this.index,{offset:Da});this.offsetView.description=(100*Da).toFixed(2)+"%";this.offsetView.position=ea.hand.position.addPt(Qc.pt(10,10))}},{key:"onDragEnd",value:function(){this.nativeCursor="-webkit-grab";this.stopVisualizer.nativeCursor="auto";this.offsetView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientStopControl"}},{key:"properties",get:function(){return{index:{},head:{},
stopVisualizer:{},styleClasses:{defaultValue:["stopControlLine"]},nativeCursor:{defaultValue:"-webkit-grab"},draggable:{defaultValue:!0},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient stop control"}}},submorphs:{after:["index","stopVisualizer"],initialize:function(){this.head=new Qc.StopControlHead({name:"stop control head",stopVisualizer:this.stopVisualizer,index:this.index});this.head.stopControl=this;this.addMorph(this.head)}}}}}],O,{pathInPackage:function(){return"styling/gradient-editor.js"},
unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:14885,end:16661})})(Qc.Morph);(function(V){var O=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ka=O.hasOwnProperty("FocusHandle")&&"function"===typeof O.FocusHandle?O.FocusHandle:O.FocusHandle=function(ea){ea&&ea[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return Lc(Ka,V,[{key:"relayout",value:function(){this.center=this.gradientHandle.innerBounds().center()}},{key:"onDragStart",value:function(ea){this.tfm=this.gradientHandle.target.getGlobalTransform().inverse();this.focusView=(new Qc.Tooltip).openInWorld(ea.hand.position.addPt(Qc.pt(10,10)))}},{key:"onDrag",value:function(ea){var Da=ea.state.dragDelta,Sa=this.gradientHandle,vb=Sa.target.fill;vb.focus=vb.focus.addXY(Da.x/Sa.target.width,Da.y/Sa.target.height);this.focusView.description=
"x: "+(100*vb.focus.x).toFixed()+"%, y: "+(100*vb.focus.y).toFixed()+"%";this.focusView.position=ea.hand.position.addPt(Qc.pt(10,10));Sa.target.makeDirty();Sa.relayout()}},{key:"onDragEnd",value:function(ea){this.focusView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"FocusHandle"}},{key:"properties",get:function(){return{gradientHandle:{},styleClasses:{defaultValue:["focusHandle"]},extent:{defaultValue:Qc.pt(20,20)},fill:{defaultValue:Qc.Color.orange}}}}],O,{pathInPackage:function(){return"styling/gradient-editor.js"},
unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:16663,end:17666})})(Qc.Ellipse);(function(V){var O=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ka=O.hasOwnProperty("BoundsHandle")&&"function"===typeof O.BoundsHandle?O.BoundsHandle:O.BoundsHandle=function(ea){ea&&ea[Symbol.for("lively-instance-restorer")]||
this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Lc(Ka,V,[{key:"relayout",value:function(){this.center=this.gradientHandle.innerBounds().partNamed(this.side);this.scale=1/this.gradientHandle.target.getGlobalTransform().getScale()}},{key:"onDragStart",value:function(ea){this.boundsView=(new Qc.Tooltip).openInWorld(ea.hand.position.addPt(Qc.pt(10,10)))}},{key:"onDrag",value:function(ea){var Da=this.gradientHandle,Sa=Da.target.fill,vb=Sa.bounds.partNamed(this.side).addPt(ea.state.dragDelta.scaleBy(2));
Sa.bounds=Sa.bounds.withPartNamed(this.side,vb);this.boundsView.description="w: "+Sa.bounds.width.toFixed()+"px h: "+Sa.bounds.height.toFixed()+"px";this.boundsView.position=ea.hand.position.addPt(Qc.pt(10,10));Da.target.makeDirty();Da.relayout()}},{key:"onDragEnd",value:function(ea){this.boundsView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"BoundsHandle"}},{key:"properties",get:function(){return{side:{},gradientHandle:{},styleClasses:{after:["side"],initialize:function(){this.styleClasses=
["boundsHandle",this.side]}}}}}],O,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:17668,end:18747})})(Qc.Ellipse);var gb=function(V){var O=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ka=O.hasOwnProperty("GradientFocusHandle")&&"function"===typeof O.GradientFocusHandle?
O.GradientFocusHandle:O.GradientFocusHandle=function(ea){ea&&ea[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Lc(Ka,V,[{key:"relayout",value:function(){var ea=this.target.fill,Da=ea.focus;this.extent=ea.bounds.extent();this.submorphs.forEach(function(Sa){return Sa.relayout()});this.rotation=this.target.rotation;this.scale=this.target.scale;this.borderWidth=2/this.scale;this.owner&&(this.center=this.owner.localizePointFrom(this.target.extent.scaleByPt(Da),
this.target))}},{key:"initBoundsHandles",value:function(){var ea=this;this.bounds().sides.forEach(function(Da){ea.addMorph(new Qc.BoundsHandle({gradientHandle:ea,side:Da,name:"bounds handle "+Da.split("C")[0]}))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientFocusHandle"}},{key:"properties",get:function(){return{target:{},isHaloItem:{defaultValue:!0},hasFixedPosition:{defaultValue:!0},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient focus handle"}}},
submorphs:{initialize:function(){this.submorps=[];this.initBoundsHandles();this.addMorph(new Qc.FocusHandle({gradientHandle:this}));this.relayout()}}}}}],O,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:18756,end:20039})}(Qc.Ellipse);Qc.GradientFocusHandle=gb;Qc.GradientFocusHandle=
gb;Qc.GradientFocusHandle=gb;(function(V){var O=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ka=O.hasOwnProperty("RotationPoint")&&"function"===typeof O.RotationPoint?O.RotationPoint:O.RotationPoint=function(ea){ea&&ea[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Lc(Ka,V,[{key:"relayout",value:function(){this.center=Qc.Point.polar(this.gradientHandle.width/2,this.gradientHandle.target.fill.vectorAsAngle())}},
{key:"onDragStart",value:function(ea){this.angleView=(new Qc.Tooltip).openInWorld(ea.hand.position.addPt(Qc.pt(10,10)));this.angleView.rotation=0}},{key:"onDrag",value:function(ea){var Da=this.gradientHandle;Da.target.fill.vector=ea.positionIn(Da).theta();Da.target.makeDirty();Da.relayout();this.angleView.description=(Qc.num.toDegrees(Da.target.fill.vectorAsAngle())+180).toFixed()+"\u00b0";this.angleView.position=ea.hand.position.addPt(Qc.pt(10,10))}},{key:"onDragEnd",value:function(ea){this.angleView.remove()}}],
[{key:Symbol.for("__LivelyClassName__"),get:function(){return"RotationPoint"}},{key:"properties",get:function(){return{gradientHandle:{}}}}],O,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:20041,end:20838})})(Qc.Ellipse);(function(V){var O=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),
Ka=O.hasOwnProperty("GradientDirectionHandle")&&"function"===typeof O.GradientDirectionHandle?O.GradientDirectionHandle:O.GradientDirectionHandle=function(ea){ea&&ea[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Lc(Ka,V,[{key:"isHaloItem",get:function(){return!0}},{key:"relayout",value:function(){this.owner&&(this.position=this.owner.localizePointFrom(this.target.extent.scaleBy(.5),this.target));this.rotationPoint.relayout()}},
{key:"initRotationPoint",value:function(){this.rotationPoint=this.addMorph(new Qc.RotationPoint({gradientHandle:this,name:"rotation point"}))}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientDirectionHandle"}},{key:"properties",get:function(){return{target:{},origin:{defaultValue:Qc.pt(25,25)},extent:{defaultValue:Qc.pt(50,50)},hasFixedPosition:{defaultValue:!0},submorphs:{initialize:function(){this.initRotationPoint();this.relayout()}},master:{initialize:function(){this.master=
{auto:"styleguide://SystemWidgets/gradient direction handle"}}}}}}],O,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:20840,end:21812})})(Qc.Ellipse);Qc.colorWidgets.GradientEditor=Qc.GradientEditor;var Za=lively.FreezerRuntime.recorderFor("lively.ide/world.js");Za.resource=
Fb;Za.Rectangle=Db;Za.Color=Kb;Za.pt=id;Za.arr=sc;Za.fun=cc;Za.obj=hd;Za.promise=Vb;Za.PropertyPath=Kc;Za.once=$c;Za.GridLayout=ub;Za.MorphicDB=Ub;Za.easings=xe;Za.HTMLMorph=Ga;Za.Text=Rc;Za.Label=jb;Za.Path=X;Za.Polygon=ha;Za.morph=ne;Za.Ellipse=rc;Za.touchInputDevice=Fa;Za.Icon=Ta;Za.Morph=lb;Za.VerticalLayout=Mb;Za.HorizontalLayout=Ja;Za.ProportionalLayout=Ca;Za.Tooltip=Zb;Za.Image=rb;Za.inspect=se;Za.config=Pd;Za.World=ra;Za.loadMorphFromSnapshot=tb;Za.loadObjectFromPartsbinFolder=Gc;Za.loadPart=
ud;Za.uploadFile=Hc;Za.InformPrompt=Na;Za.ConfirmPrompt=lc;Za.MultipleChoicePrompt=kd;Za.TextPrompt=Tb;Za.EditPrompt=md;Za.PasswordPrompt=wb;Za.ListPrompt=je;Za.EditListPrompt=bf;Za.LoadingIndicator=Id;Za.Halo=v;Za.MorphHighlighter=Ie;Za.StatusMessage=cf;Za.StatusMessageForMorph=df;Za.ProportionalLayoutHalo=Ze;Za.GridLayoutHalo=ke;Za.FlexLayoutHalo=Ke;Za.Window=Wc;Za.List=xb;Za.FilterableList=ze;Za.Menu=yb;Za.worldCommands=pg;Za.GradientEditor=Va;Za.completions=nb;Za.runEval=Ha;Za.getClassName=R;
Za.serialize=ya;Za.Canvas=$a;Za.CommentBrowser=xd;Za.prefetchCoreStyleguides=Ab;pg=Ma("LivelyWorld",function(V){var O=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),Ka=O.hasOwnProperty("LivelyWorld")&&"function"===typeof O.LivelyWorld?O.LivelyWorld:O.LivelyWorld=function(ea){ea&&ea[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Lc(Ka,V,[{key:"visibleBoundsExcludingTopBar",value:function(){var ea=$world.getSubmorphNamed("lively top bar"),
Da=this.visibleBounds();return ea?new Za.Rectangle(Da.x,Da.y+ea.height,Da.width,Da.height-ea.height):Da}},{key:"getListedComponents",value:function(){var ea=this,Da=this.withAllSubmorphsSelect(function(Sa){return Sa.isComponent&&!ea.hiddenComponents.includes(Sa.name)});return Za.arr.uniq([].concat($jscomp.arrayFromIterable(Da),$jscomp.arrayFromIterable(this.localComponents)))}},{key:"activeWindow",value:function(){return this.getWindows().reverse().find(function(ea){return ea.isActive()})}},{key:"getWindows",
value:function(){return this.submorphs.filter(function(ea){return ea.isWindow})}},{key:"activePrompt",value:function(){return this.getPrompts().reverse().find(function(ea){return ea.isActive()})}},{key:"getPrompts",value:function(){return this.submorphs.filter(function(ea){return ea.isPrompt})}},{key:"openInWindow",value:function(ea,Da){Da=void 0===Da?{title:ea.name,name:"window for "+ea.name}:Da;ea=(new Za.Window(Object.assign({},Da,{extent:ea.extent.addXY(0,25),targetMorph:ea}))).openInWorld();
ea.ensureNotOverTheTop();return ea}},{key:"withTopBarDo",value:function(ea){var Da=this.get("lively top bar");Da&&ea(Da)}},{key:"onTopBarLoaded",value:function(){}},{key:"onKeyUp",value:function(ea){this.withTopBarDo(function(Da){return Da.onKeyUp(ea)})}},{key:"onKeyDown",value:function(ea){Lc._get(Object.getPrototypeOf(Ka.prototype),"onKeyDown",this).call(this,ea);ea.targetMorph==this&&this.withTopBarDo(function(Da){return Da.onKeyDown(ea)})}},{key:"onMouseDown",value:function(ea){Lc._get(Object.getPrototypeOf(Ka.prototype),
"onMouseDown",this).call(this,ea);var Da=ea.state.clickedOnMorph,Sa=this.activeWindow();Sa&&Da==this&&Sa.deactivate();this.handleHaloCycle(ea);ea.state.menu&&ea.state.menu.remove();this._tooltipViewer.mouseDown(ea)}},{key:"onMouseUp",value:function(ea){ea.isCommandKey()&&ea.stop();if(ea.isAltDown()&&Za.config.altClickDefinesThat){var Da=this.morphsContainingPoint(ea.position)[0];setTimeout(function(){return System.global.that=Da},100);Da.show();ea.stop();console.log('Set global "that" to '+Da)}}},
{key:"onDrag",value:function(ea){}},{key:"whenReady",value:function(){var ea=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){return 1==Da.nextAddress?Da.yield(ea._styleLoading,2):Da.return(!0)})}},{key:"onLoad",value:function(){var ea=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){if(1==Da.nextAddress){ea.opacity=0;ea.onWindowResize();lively.modules&&lively.modules.removeHook("fetch",window.__logFetch);ea.animate({opacity:1,blur:3,duration:1E3,easing:Za.easings.inOutExpo});
if(!ea.showsUserFlap&&!Za.resource(document.location.href).query().showsUserFlap)return Da.jumpTo(2);ea._styleLoading=Za.prefetchCoreStyleguides(window.worldLoadingIndicator);return Da.yield(ea._styleLoading,2)}ea.animate({blur:0,duration:1E3,easing:Za.easings.inOutExpo});document.body.style.overflowX="visible";document.body.style.overflowY="visible";Da.jumpToEnd()})}},{key:"isNotUnique",value:function(ea){var Da,Sa,vb,Bb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ib){switch(Ib.nextAddress){case 1:return Ib.yield(Za.MorphicDB.default.exists("world",
ea),2);case 2:if(Da=Ib.yieldResult.exists){Ib.jumpTo(3);break}Sa=ea+".json";vb=Za;Bb=vb.resource;return Ib.yield(System.decanonicalize("lively.morphic/styleguides"),5);case 5:return Ib.yield(Bb.call(vb,Ib.yieldResult).join(Sa).exists(),4);case 4:Da=Ib.yieldResult;case 3:return Ib.return(Da)}})}},{key:"askForName",value:function(){var ea=this,Da;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sa){switch(Sa.nextAddress){case 1:return Sa.yield(ea.whenRendered(),3);case 3:if(Da){Sa.jumpTo(4);
break}return Sa.yield(ea.prompt(["New Project\n",{},"Enter a name for this project:",{fontWeight:"normal"}],{width:400,hasFixedPosition:!0,forceConfirm:!0}),5);case 5:return Da=Sa.yieldResult,Sa.yield(ea.isNotUnique(Da),6);case 6:if(!Sa.yieldResult){Sa.jumpTo(3);break}return Sa.yield(ea.confirm("This Project name is already taken. Please pick a different one!",{hasFixedPosition:!0,width:400}),8);case 8:Da=!1;Sa.jumpTo(3);break;case 4:return Sa.return(Da)}})}},{key:"onWindowResize",value:function(ea){Lc._get(Object.getPrototypeOf(Ka.prototype),
"onWindowResize",this).call(this,ea);"elastic"===this.resizePolicy&&this.execCommand("resize to fit window")}},{key:"nativeDrop_ensureUploadIndicator",value:function(){var ea=this,Da;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sa){if(1==Sa.nextAddress)return ea._cachedDragIndicator||(ea._cachedDragIndicator=Za.loadObjectFromPartsbinFolder("upload-indicator")),Sa.yield(ea._cachedDragIndicator,2);Da=Sa.yieldResult;Da.world()||Da.openInWorld();Za.fun.debounceNamed("remove-upload-indicator",
1E3,function(){ea.nativeDrop_removeUploadIndicator()})();Sa.jumpToEnd()})}},{key:"nativeDrop_removeUploadIndicator",value:function(){this._cachedDragIndicator&&this._cachedDragIndicator.then(function(ea){return ea.remove()})}},{key:"onNativeDragover",value:function(ea){ea.targetMorph===this&&this.nativeDrop_ensureUploadIndicator()}},{key:"onNativeDrop",value:function(ea){var Da=this,Sa,vb,Bb,Ib,wc,yc,gd,$d,te,Ed,Je,He,ye,oe,of,Cf,rh,Bh,$g,Hf,ei,Gh,ni,wg,Lg,Pe,Vi,Pb,Nc,fe,ge,Mf,jg,fi,Ch,zk,Wm,Xm,Fm,
Vk,Gm,Wk,dm,Il,bj,Jl;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xf){switch(Xf.nextAddress){case 1:Da.nativeDrop_removeUploadIndicator();if(ea.targetMorph!=Da)return Xf.return();Sa=ea;vb=Sa.domEvt;Bb=vb.dataTransfer;Ib=Bb.files;wc=document.location.origin;if(!Ib.length){Xf.jumpTo(2);break}yc=Da.getCurrentUser();gd=yc.isGuestUser?"uploads/":"users/"+$world.getCurrentUser().name+"/uploads";if(!ea.isAltDown()){Xf.jumpTo(3);break}return Xf.yield(Da.prompt("Choose upload location",{history:"lively.morphic-html-drop-file-upload-location",
input:gd}),4);case 4:if(gd=Xf.yieldResult,!gd)return Xf.return(Da.setStatusMessage("Canceled upload"));case 3:return Xf.yield(Da.confirm("Upload "+Ib.length+" file"+(1<Ib.length?"s":"")+"?"),5);case 5:$d=Xf.yieldResult;if(!$d)return Xf.return();te=new Za.FormData;for(Ed=0;Ed<Ib.length;Ed++)te.append("file",Ib[Ed],Ib[Ed].name);ye=Za.LoadingIndicator.open("Uploading File");Xf.setCatchFinallyBlocks(6);oe={};of=function(sj){sj=sj.loaded/sj.total;ye.progress=sj;ye.status="Uploaded "+(100*sj).toFixed()+
"%"};yc.isGuestUser||(oe.Authorization="Bearer "+yc.token);Je=Za.resource(System.baseURL,{headers:oe,onProgress:of,onLoad:function(sj){return He=sj}});Je=Je.join("/upload?uploadPath="+encodeURIComponent(gd));return Xf.yield(Je.write(te),8);case 8:Xf.leaveTryBlock(7);break;case 6:return Cf=Xf.enterCatchBlock(),Xf.return(Da.showError("Upload failed: "+Cf.message+"\n"));case 7:ye.remove();Xf.setCatchFinallyBlocks(9);Da.setStatusMessage("Uploaded "+He.uploadedFiles.length+" file");rh=He.uploadedFiles.map(function(sj){var Ak=
Za.resource(wc).join(sj.path);return Object.assign({},sj,{url:Ak.url,name:Ak.name()})});Bh=[];$g=[];Hf=[];ei=$jscomp.makeIterator(rh);for(Gh=ei.next();!Gh.done;Gh=ei.next())ni=Gh.value,ni.type.startsWith("image/")?Bh.push(ni):ni.type.startsWith("video")?$g.push(ni):Hf.push(ni);if(!$g.length){Xf.jumpTo(11);break}wg=$jscomp.makeIterator($g);Lg=wg.next();case 12:if(Lg.done){Xf.jumpTo(11);break}Pe=Lg.value;Vi=Object;Pb=Vi.assign;return Xf.yield(Za.loadObjectFromPartsbinFolder("video morph"),15);case 15:Pb.call(Vi,
Xf.yieldResult,{videoURL:Pe.url,name:Pe.name}).openInWorld();Lg=wg.next();Xf.jumpTo(12);break;case 11:Bh.length&&Bh.forEach(function(sj){var Ak=new Za.Image({imageUrl:sj.url,autoResize:!0,name:sj.name});Ak.whenLoaded().then(function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(em){if(1==em.nextAddress)return Ak.extent=Ak.naturalExtent.scaleBy(.8*Da.visibleBounds().height/Ak.height),Ak.openInWorld(),em.yield(Ak.whenRendered(),2);Ak.center=Da.visibleBounds().center();em.jumpToEnd()})})});
if(!Hf.length){Xf.jumpTo(16);break}Nc=$jscomp.makeIterator(Hf);fe=Nc.next();case 17:if(fe.done){Xf.jumpTo(16);break}ge=fe.value;return Xf.yield(Da.confirm("open file "+ge.name+" ("+ge.type+")?"),20);case 20:(Mf=Xf.yieldResult)&&Da.execCommand("open file",{url:ge.url});fe=Nc.next();Xf.jumpTo(17);break;case 16:Xf.leaveTryBlock(10);break;case 9:jg=Xf.enterCatchBlock(),Da.showError(jg);case 10:return Xf.return();case 2:fi=vb.dataTransfer.types;if(!fi.includes("text/html")){Xf.jumpTo(21);break}Ch=vb.dataTransfer.getData("text/html");
zk=(new Za.DOMParser).parseFromString(Ch,"text/html");Wm=zk.querySelectorAll("img");if(1===Wm.length&&Wm[0].src&&fi.includes("text/uri-list")){Xm=Wm[0].src;Fm=new Za.Image({imageUrl:Xm,autoResize:!0,name:Za.arr.last(Xm.split("/"))});Fm.whenLoaded().then(function(){return Fm.openInWorld()});Xf.jumpTo(22);break}Vk=Object;Gm=Vk.assign;return Xf.yield(Za.loadObjectFromPartsbinFolder("html-morph"),23);case 23:Gm.call(Vk,Xf.yieldResult,{html:Ch}).openInWorld();case 22:return Xf.return();case 21:Wk=0;case 24:if(!(Wk<
vb.dataTransfer.items.length)){Xf.jumpTo(0);break}dm=vb.dataTransfer.items[Wk];if("file"!==dm.kind){"string"===dm.kind&&dm.getAsString(function(sj){return Za.inspect(sj)});Xf.jumpTo(25);break}Il=dm.getAsFile();return Xf.yield(Da.confirm("Upload "+Il.name+"?"),28);case 28:bj=Xf.yieldResult;if(!bj){Xf.jumpTo(25);break}return Xf.yield(Za.uploadFile(Il,Il.type),30);case 30:(Jl=Xf.yieldResult)&&Jl.openInWorld(),Jl.center=Da.visibleBounds().center();case 25:Wk++,Xf.jumpTo(24)}})}},{key:"menuItems",value:function(){var ea=
this;return[{title:"World menu"},{command:"undo",target:this},{command:"redo",target:this},{isDivider:!0},["Debugging",[{command:"delete change history",target:this},{command:"fix font metric",target:this},{command:"inspect server",target:this}]],["Tools",[{command:"open javascript workspace",target:this},{command:"open browser",target:this},{command:"choose and browse module",target:this},{command:"open code search",target:this},{command:"open file browser",target:this},{command:"open shell workspace",
target:this,tooltip:"Opens a workspace like interface\nthat allows you to trigger shell comands\nvia select + eval by pressing either "+(new Za.Text).keysForCommand("doit")+" or "+(new Za.Text).keysForCommand("printit")},{command:"open shell terminal",target:this,tooltip:"Opens a classic remote shell interface,\nthat allows you to send commands to a\nbash session running on the server.\nAlso comes with advanced git support."},{command:"open workspace",args:{askForMode:!0},target:this}]],{isDivider:!0},
{command:"run command",target:this},{command:"select morph",target:this},{command:"window switcher",target:this},["Exported Components",[["Toggle Select All",function(){0==ea.getListedComponents().length?ea.hiddenComponents=[]:ea.hiddenComponents=ea.withAllSubmorphsSelect(function(Da){return Da.isComponent}).map(function(Da){return Da.name})}]].concat($jscomp.arrayFromIterable(this.withAllSubmorphsSelect(function(Da){return Da.isComponent}).map(function(Da){var Sa=ea.hiddenComponents.includes(Da.name);
return[[].concat($jscomp.arrayFromIterable(Za.Icon.textAttribute(Sa?"square":"check-square")),["  "+Da.name,{}]),function(){ea.hiddenComponents=Sa?Za.arr.without(ea.hiddenComponents,Da.name):[Da.name].concat($jscomp.arrayFromIterable(ea.hiddenComponents))}]})))],["Resize","static"===this.resizePolicy?[{command:"resize to fit window",target:this},{command:"resize manually",target:this},["switch to automatic resizing of world",function(){return ea.resizePolicy="elastic"}]]:[["switch to manual resizing of world",
function(){return ea.resizePolicy="static"}]]],["Troubleshooting",[{command:"report a bug",target:this},{command:"clear storage and reload",target:this}]],{isDivider:!0},["Windows",[{command:"toggle minimize all windows",target:this},{command:"close all windows",target:this}]],{isDivider:!0},{command:"save world",target:this},{command:"load world",target:this}]}},{key:"openWorldMenu",value:function(ea,Da){var Sa=this.env.eventDispatcher.eventState;Sa.menu&&Sa.menu.remove();return Sa.menu=Da&&Da.length?
Za.Menu.openAtHand(Da,{hand:ea&&ea.hand||this.firstHand}):null}},{key:"onPaste",value:function(ea){var Da=this,Sa,vb,Bb,Ib,wc,yc,gd,$d,te,Ed,Je,He;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ye){switch(ye.nextAddress){case 1:ye.setCatchFinallyBlocks(2,3);vb=ea.domEvt.clipboardData;if(!vb.types.includes("application/morphic")){ye.jumpTo(3);break}ea.stop();Bb=JSON.parse(vb.getData("application/morphic"));Ib=[];Array.isArray(Bb)||(Bb=[Bb]);Sa=Za.LoadingIndicator.open("pasting morphs...");
wc=$jscomp.makeIterator(Bb);yc=wc.next();case 6:if(yc.done){ye.jumpTo(8);break}gd=yc.value;return ye.yield(Za.loadMorphFromSnapshot(gd),9);case 9:$d=ye.yieldResult;$d.openInWorld(ea.hand.position);gd.copyMeta&&gd.copyMeta.offset&&(te=gd.copyMeta.offset,Ed=te.x,Je=te.y,$d.moveBy(Za.pt(Ed,Je)));Ib.push($d);yc=wc.next();ye.jumpTo(6);break;case 8:Da.showHaloFor(Ib);case 3:ye.enterFinallyBlock();Sa&&Sa.remove();ye.leaveFinallyBlock(0);break;case 2:He=ye.enterCatchBlock(),Da.showError(He),ye.jumpTo(3)}})}},
{key:"commands",get:function(){return Za.worldCommands.concat(Lc._get(Object.getPrototypeOf(Ka.prototype),"commands",this)).concat([{name:"open in prototype box",exec:function(ea,Da){var Sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){if(1==vb.nextAddress)return vb.yield(Za.loadPart("prototype box"),2);Sa=vb.yieldResult;Sa.wrapProto(Da.target);vb.jumpToEnd()})}}])}},{key:"keybindings",get:function(){return Lc._get(Object.getPrototypeOf(Ka.prototype),"keybindings",this).concat(Za.config.globalKeyBindings)}},
{key:"keybindings",set:function(ea){Lc._set(Object.getPrototypeOf(Ka.prototype),"keybindings",ea,this)}},{key:"halos",value:function(){return this.submorphs.filter(function(ea){return ea.isHalo})}},{key:"haloForPointerId",value:function(ea){return this.submorphs.find(function(Da){return Da.isHalo&&Da.state&&Da.state.pointerId===ea})}},{key:"showHaloFor",value:function(ea,Da,Sa){Da=void 0===Da?this.firstHand&&this.firstHand.pointerId:Da;Sa=void 0===Sa?!0:Sa;if(Za.Halo)return ea="function"===typeof ea.createHalo?
ea.createHalo(Za.Halo,Da):new Za.Halo({pointerId:Da,target:ea}),this.addMorph(ea),Sa&&ea.focus(),ea.alignWithTarget(),ea}},{key:"showHaloForSelection",value:function(ea,Da){return 0<ea.length&&this.showHaloFor(ea,Da)}},{key:"layoutHaloForPointerId",value:function(ea){ea=void 0===ea?this.firstHand&&this.firstHand.pointerId:ea;return this.submorphs.find(function(Da){return Da.isLayoutHalo&&Da.state&&Da.state.pointerId===ea})}},{key:"showLayoutHaloFor",value:function(ea,Da){Da=void 0===Da?this.firstHand&&
this.firstHand.pointerId:Da;var Sa=ea===this?null:ea.owner===this?ea:ea.ownerChain().slice(-2)[0];Sa=Sa?this.submorphs.indexOf(Sa)+1:this.submorphs.length;switch(ea.layout.constructor){case Za.ProportionalLayout:var vb=new Za.ProportionalLayoutHalo({container:ea,pointerId:Da});break;case Za.HorizontalLayout:case Za.VerticalLayout:vb=new Za.FlexLayoutHalo({container:ea,pointerId:Da});break;case Za.GridLayout:vb=new Za.GridLayoutHalo({container:this.container,pointerId:Da})}return vb&&this.addMorphAt(vb,
Sa)}},{key:"highlightMorph",value:function(ea,Da,Sa,vb){vb=void 0===vb?[]:vb;return Za.MorphHighlighter.for(ea,Da,void 0===Sa?!1:Sa,vb)}},{key:"removeHighlighters",value:function(ea){return Za.MorphHighlighter.removeHighlighters(void 0===ea?this:ea)}},{key:"visibleStatusMessages",value:function(){return this.submorphs.filter(function(ea){return ea.isStatusMessage})}},{key:"visibleStatusMessagesFor",value:function(ea){return this.submorphs.filter(function(Da){return Da.isStatusMessage&&Da.targetMorph===
ea})}},{key:"logErrorPreperation",value:function(ea){var Da=String(ea),Sa=ea.stack||"";Sa&&ea.message!==ea.stack&&(Sa=String(Sa),0===Sa.indexOf(Da)&&(Sa=Sa.slice(Da.length)),Da+="\n"+Sa);return Da}},{key:"logError",value:function(ea){this.setStatusMessage(this.logErrorPreperation(ea),Za.Color.red)}},{key:"showError",value:function(ea){return this.logError(ea)}},{key:"showErrorFor",value:function(ea,Da){return this.setStatusMessageFor(ea,this.logErrorPreperation(Da),Za.Color.red)}},{key:"setStatusMessageFor",
value:function(ea,Da,Sa,vb,Bb){vb=void 0===vb?5E3:vb;if(Za.StatusMessageForMorph){this.visibleStatusMessagesFor(ea).forEach(function(Ib){return Ib.remove()});Da=new Za.StatusMessageForMorph(Object.assign({message:Da,color:Sa},Bb));this.openStatusMessage(Da,vb);Da.targetMorph=ea;Da.fadeIn(300);if(Da.removeOnTargetMorphChange&&ea.isText)Za.once(ea,"selectionChange",Da,"fadeOut",{converter:function(){return 200},garbageCollect:!0});return Da}}},{key:"setStatusMessage",value:function(ea,Da,Sa,vb){Sa=
void 0===Sa?5E3:Sa;vb=void 0===vb?{}:vb;if(Za.StatusMessage)return console[Da==Za.Color.red?"error":"log"](ea),Za.config.verboseLogging?this.openStatusMessage(new Za.StatusMessage(Object.assign({message:ea,color:Da,hasFixedPosition:!0},vb)),Sa):null}},{key:"openStatusMessage",value:function(ea,Da){this.addMorph(ea);if(ea.slidable){for(var Sa=this.visibleStatusMessages(),vb=$jscomp.makeIterator(Sa),Bb=vb.next();!Bb.done;Bb=vb.next()){Bb=Bb.value;if(Sa.length<=(Za.config.maxStatusMessages||0))break;
!Bb.stayOpen&&Bb.slidable&&(Bb.remove(),Za.arr.remove(Sa,Bb))}Za.arr.without(Sa,ea).forEach(function(Ib){return $jscomp.asyncExecutePromiseGeneratorProgram(function(wc){!Ib.isMaximized&&Ib.slidable&&Ib.slideTo(Ib.position.addPt(Za.pt(0,-ea.extent.y-10)));wc.jumpToEnd()})});Sa=this.visibleBounds().bottomRight().addXY(-20,-20);ea.align(ea.bounds().bottomRight(),Sa);ea.topRight=Sa.addPt(Za.pt(0,40));ea.animate({bottomRight:Sa,duration:500})}"number"===typeof Da&&setTimeout(function(){return ea.stayOpen||
ea.fadeOut()},Da);return ea}},{key:"addProgressBar",value:function(ea){ea=void 0===ea?{}:ea;var Da=this,Sa,vb,Bb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ib){if(1==Ib.nextAddress)return Sa=ea,vb=void 0===Sa.location?"center":Sa.location,Ib.yield(Za.loadObjectFromPartsbinFolder("progress bar"),2);Bb=Ib.yieldResult;Object.assign(Bb,{progress:0},Za.obj.dissoc(ea,["location"]));Da.addMorph(Bb);Bb.align(Bb[vb],Da.visibleBounds()[vb]());return Ib.return(Bb)})}},{key:"withProgressBarDo",
value:function(ea,Da){var Sa=this,vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bb){switch(Bb.nextAddress){case 1:return Bb.yield(Sa.addProgressBar(Da),2);case 2:return vb=Bb.yieldResult,Bb.setFinallyBlock(3),Bb.yield(ea(vb),5);case 5:return Bb.return(Bb.yieldResult);case 3:Bb.enterFinallyBlock(),vb.remove(),Bb.leaveFinallyBlock(0)}})}},{key:"openPrompt",value:function(ea,Da){Da=void 0===Da?{requester:null,animated:!1}:Da;var Sa=this,vb,Bb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ib){vb=
Sa.focusedMorph;Bb=Sa.visibleBounds();return Ib.return(Sa.withRequesterDo(Da.requester,function(wc){return $jscomp.asyncExecutePromiseGeneratorProgram(function(yc){ea.openInWorldNear(wc,Sa);ea.height>Bb.height&&(ea.height=Bb.height-5);"function"===typeof Da.customize&&Da.customize(ea);Da.animated&&Sa.previousPrompt&&Sa.previousPrompt.world()&&Sa.previousPrompt.transitionTo(ea);Sa.previousPrompt=ea;return yc.return(Za.promise.finally(ea.activate(Da),function(){return vb&&vb.focus()}))})}))})}},{key:"withRequesterDo",
value:function(ea,Da){var Sa=this,vb,Bb,Ib;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wc){switch(wc.nextAddress){case 1:Bb=Sa.visibleBounds().center();if(!ea){wc.jumpTo(2);break}Bb=ea.globalBounds().center();ea.isWorld&&(Bb=ea.visibleBounds().center());if(!(vb=ea.getWindow())){wc.jumpTo(2);break}return wc.yield(vb.toggleFader(!0),4);case 4:Bb=vb.globalBounds().center();case 2:return wc.yield(Da(Bb),5);case 5:return Ib=wc.yieldResult,vb&&vb.toggleFader(!1),wc.return(Ib)}})}},{key:"inform",
value:function(ea,Da){Da=void 0===Da?{fontSize:16,requester:null,animated:!0}:Da;return this.openPrompt(new Za.InformPrompt(Object.assign({label:void 0===ea?"no message":ea},Da)),Da)}},{key:"prompt",value:function(ea,Da){Da=void 0===Da?{requester:null,input:"",historyId:null,useLastInput:!1}:Da;ea=new Za.TextPrompt(Object.assign({label:ea},Da));Da.forceConfirm&&ea.get("cancel button").disable();return this.openPrompt(ea,Da)}},{key:"editPrompt",value:function(ea,Da){Da=void 0===Da?{requester:null,
input:"",historyId:null,useLastInput:!1,textStyle:null,mode:null,evalEnvironment:null}:Da;return this.openPrompt(new Za.EditPrompt(Object.assign({label:ea},Da)),Da)}},{key:"passwordPrompt",value:function(ea,Da){Da=void 0===Da?{requester:null,input:""}:Da;return this.openPrompt(new Za.PasswordPrompt(Object.assign({label:ea},Da)),Da)}},{key:"confirm",value:function(ea,Da){Da=void 0===Da?{requester:null,animated:!0}:Da;return this.openPrompt(new Za.ConfirmPrompt(Object.assign({label:ea},Da)),Da)}},{key:"multipleChoicePrompt",
value:function(ea,Da){Da=void 0===Da?{requester:null,animated:!0,choices:[]}:Da;return this.openPrompt(new Za.MultipleChoicePrompt(Object.assign({label:ea},Da)),Da)}},{key:"listPrompt",value:function(ea,Da,Sa){ea=void 0===ea?"":ea;Da=void 0===Da?[]:Da;Sa=void 0===Sa?{requester:null,onSelection:null,preselect:0}:Sa;return this.openPrompt(new Za.ListPrompt(Object.assign({filterable:!1,padding:Za.Rectangle.inset(3),label:ea,items:Da},Sa)),Sa)}},{key:"filterableListPrompt",value:function(ea,Da,Sa){ea=
void 0===ea?"":ea;Da=void 0===Da?[]:Da;Sa=void 0===Sa?{requester:null,onSelection:null,preselect:0,multiSelect:!1,historyId:null,fuzzy:!1,actions:["default"],selectedAction:"default",theme:"dark"}:Sa;return Sa.prompt?(ea=Sa.prompt.get("list"),ea.items=Da,ea.selectedIndex=Sa.preselect||0,this.openPrompt(Sa.prompt,Sa)):this.openPrompt(new Za.ListPrompt(Object.assign({filterable:!0,padding:Za.Rectangle.inset(3),label:ea,items:Da},Sa)),Sa)}},{key:"editListPrompt",value:function(ea,Da,Sa){Da=void 0===
Da?[]:Da;Sa=void 0===Sa?{requester:null,multiSelect:!0,historyId:null}:Sa;return this.openPrompt(new Za.EditListPrompt(Object.assign({label:void 0===ea?"":ea,multiSelect:!0,items:Da,padding:Za.Rectangle.inset(3)},Sa)),Sa)}},{key:"showLoadingIndicatorFor",value:function(ea,Da){return this.addMorph(Za.LoadingIndicator.open(Da,{center:ea.globalBounds().center()}))}},{key:"defaultMenuItems",value:function(ea,Da){function Sa(Ed){var Je=this,He=Bb.morphsContainingPoint(wc.worldPoint(Za.pt(0,0)));He.pop();
var ye=He.indexOf(wc);He=He.slice(ye+1);return He.map(function(oe){return[String(oe),Ed.bind(Je,oe)]})}var vb=this,Bb=this,Ib=[],wc=ea;this.reset&&"function"===typeof this.reset&&Ib.push(["Reset",function(){vb.reset()}]);Ib.push(["Open in...",[["Window",function(){wc.openInWindow()}]]]);Ib.push(["Add morph to...",{getItems:Sa.bind(wc,function(Ed){return Ed.addMorph(wc)})}]);Ib.push(["Get halo on...",{getItems:Sa.bind(wc,function(Ed){return Ed.world().showHaloFor(Ed)})}]);wc.owner&&1<wc.owner.submorphs.length&&
Ib.push(["Arrange morph",[["Bring to front",function(){return wc.owner.addMorph(wc)}],["Send to back",function(){return wc.owner.addMorphBack(wc)}],["Fit to submorphs",function(){var Ed,Je,He;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ye){if(1==ye.nextAddress)return ye.yield(wc.world().prompt("Padding around submorphs:",{input:"Rectangle.inset(5)",historyId:"lively.morphic-fit-to-submorphs-padding-hist",requester:wc}),2);if(3!=ye.nextAddress)return Ed=ye.yieldResult,"string"!==typeof Ed?
ye.return():ye.yield(Za.runEval(Ed,{topLevelVarRecorder:{Rectangle:Za.Rectangle}}),3);Je=ye.yieldResult;Ed=(He=Je.value)&&He.isRectangle?He:Za.Rectangle.inset(0);wc.undoStart("fitToSubmorphs");wc.fitToSubmorphs(Ed);wc.undoStop("fitToSubmorphs");ye.jumpToEnd()})}]].concat($jscomp.arrayFromIterable(Za.PropertyPath("master.auto").get(wc)?[["Adjust to Master Component Submorph Hierarchy",function(){return wc.master.reconcileSubmorphs()}]]:[]))]);this.submorphs.length&&Ib.push(["Select all submorphs",
function(){return wc.world().showHaloFor(wc.submorphs.slice())}]);var yc=[];wc.startSteppingScripts?yc.push(["Start stepping",function(){wc.startSteppingScripts()}]):yc.push(["Start stepping",function(){var Ed,Je,He,ye,oe,of,Cf,rh,Bh,$g,Hf,ei,Gh,ni,wg,Lg,Pe,Vi,Pb,Nc,fe,ge,Mf,jg,fi;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ch){switch(Ch.nextAddress){case 1:return Ed=[],Je=$jscomp,He=Je.makeIterator,Ch.yield(Za.completions.getCompletions(function(){return wc},""),2);case 2:ye=He.call(Je,
Ch.yieldResult.completions);for(oe=ye.next();!oe.done;oe=ye.next())for(of=oe.value,Cf=$jscomp.makeIterator(of),rh=Cf.next().value,Bh=Cf.next().value,$g=$jscomp.makeIterator(Bh),Hf=$g.next();!Hf.done;Hf=$g.next())ei=Hf.value,ei.startsWith("_")||ei.startsWith("$")||(Gh=$jscomp.makeIterator(ei.match(/^([^\(]+)\(?([^\)]+)?\)?$/)||[]),Gh.next(),ni=Gh.next().value,wg=Gh.next().value,ni&&"function"===typeof wc[ni]&&Ed.push({isListItem:!0,string:rh+" "+ei,value:{selector:ni,args:wg}}));return Ch.yield($world.filterableListPrompt("Select method to start",
Ed,{requester:wc,historyId:"lively.morphic-start-stepping-chooser"}),3);case 3:return Lg=Ch.yieldResult,Pe=$jscomp.makeIterator(Lg.selected),(Vi=Pe.next().value)?Ch.yield($world.prompt("Steptime in ms (how of the method will be called)?",{input:100}),4):Ch.return();case 4:Pb=Ch.yieldResult;Pb=Number(Pb);if(isNaN(Pb))return Ch.return();Nc=[Pb,Vi.selector];if(!Vi.args){Ch.jumpTo(5);break}fe={targetModule:"lively://lively.morphic-stepping-args/eval.js"};return Ch.yield($world.editPrompt("Arguments to pass",
{input:"["+Vi.args+"]",mode:"js",evalEnvironment:fe}),6);case 6:return ge=Ch.yieldResult,Ch.yield(Za.runEval(ge,fe),7);case 7:Mf=Ch.yieldResult;jg=Mf.value;if(fi=Mf.isError)return $world.inform("Error evaluating the arguments: "+jg),Ch.return();Array.isArray(jg)&&Nc.push.apply(Nc,$jscomp.arrayFromIterable(jg));case 5:wc.startStepping.apply(wc,$jscomp.arrayFromIterable(Nc)),Ch.jumpToEnd()}})}]);0!=wc.tickingScripts.length&&yc.push(["Stop stepping",function(){return wc.stopStepping()}]);0!=yc.length&&
Ib.push(["Stepping",yc]);Ib.push(["Change Tooltip",function(){var Ed;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Je){if(1==Je.nextAddress)return Ed=wc,Je.yield(wc.world().prompt("Enter Tooltip",{placeholder:"Description",input:wc.tooltip||""}),2);Ed.tooltip=Je.yieldResult;Je.jumpToEnd()})}]);var gd=["Morphic properties",[]];Ib.push(gd);Ib.push(["display serialization info",function(){var Ed,Je,He;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ye){if(1==ye.nextAddress)return ye.yield(System.import("lively.serializer2/debugging.js"),
2);Ed=ye.yieldResult;Je=Ed.SnapshotInspector;He=Za.serialize(wc);Je.forSnapshot(He).openSummary();ye.jumpToEnd()})}]);Ib.push(["display object report",function(){var Ed,Je,He;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ye){if(1==ye.nextAddress)return ye.yield(System.import("lively.serializer2/debugging.js"),2);Ed=ye.yieldResult;Je=Ed.SnapshotInspector;He=Za.serialize(wc);Je.forSnapshot(He).openObjectReport();ye.jumpToEnd()})}]);var $d=Za.Icon.textAttribute("check-square"),te=Za.Icon.textAttribute("square");
Object.assign($d[1],{float:"none",display:"inline"});["grabbable","draggable","acceptsDrops","halosEnabled"].forEach(function(Ed){return gd[1].push([[].concat($jscomp.arrayFromIterable(ea[Ed]?$d:te),[" "+Ed,{float:"none"}]),function(){return ea[Ed]=!ea[Ed]}])});Ib.push(["export to HTML",function(){var Ed,Je,He,ye;return $jscomp.asyncExecutePromiseGeneratorProgram(function(oe){if(1==oe.nextAddress)return oe.yield(System.import("lively.morphic/rendering/html-generator.js"),2);if(3!=oe.nextAddress)return Ed=
oe.yieldResult,Je=Ed.generateHTML,He=Za.HTMLMorph,ye="exported-"+ea.name,oe.yield(Je(ea,null,{isFragment:!0,addStyles:!1}),3);(new He({name:ye,html:oe.yieldResult})).openInWorld();oe.jumpToEnd()})}]);Ib.push({isDivider:!0});Ib.push(["Add comment",function(){var Ed,Je,He,ye;return $jscomp.asyncExecutePromiseGeneratorProgram(function(oe){if(1==oe.nextAddress)return oe.yield($world.prompt("Enter comment"),2);if(4!=oe.nextAddress){Ed=oe.yieldResult;if(!Ed)return $world.setStatusMessage("Comment not saved",
"red"),oe.jumpTo(0);Je=Za.pt(0,0);Da&&!Da.halo&&(He=wc.localize(Da.position).x/wc.width,ye=wc.localize(Da.position).y/wc.height,Je=Za.pt(He,ye));return oe.yield(wc.addComment(Ed,Je),4)}$world.setStatusMessage("Comment saved","green");oe.jumpToEnd()})}]);return Ib}},{key:"defaultConnectionMenuItems",value:function(ea){return ea.attributeConnections&&ea.attributeConnections.length?ea.attributeConnections.map(function(Da){return[String(Da),[["show",function(){var Sa,vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bb){if(1==
Bb.nextAddress)return Bb.yield(System.import("lively.ide/fabrik.js"),2);Sa=Bb.yieldResult;vb=Sa.interactivelyShowConnection;vb(Da);Bb.jumpToEnd()})}],["edit",function(){var Sa,vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bb){if(1==Bb.nextAddress)return Bb.yield(System.import("lively.ide/fabrik.js"),2);Sa=Bb.yieldResult;vb=Sa.interactivelyReEvaluateConnection;vb(Da);Bb.jumpToEnd()})}],["disconnect",function(){Da.disconnect();$world.setStatusMessage("disconnected "+Da)}]]]}):null}},
{key:"defaultSourceDataBindings",value:function(ea){var Da=ea.propertiesAndPropertySettings().properties,Sa=Za.arr.groupByKey(Object.keys(Da).map(function(Bb){Bb=Object.assign({name:Bb},Da[Bb]);return Bb.group&&Bb.group.startsWith("_")?null:Bb}).filter(Boolean),"group");ea=["core","geometry","interaction","styling","layouting"];var vb=[];ea.forEach(function(Bb){return vb.push(Sa[Bb])});Za.arr.withoutAll(Sa.keys(),ea).forEach(function(Bb){return vb.push(Sa[Bb])});return vb}},{key:"targetDataBindings",
value:function(ea){for(var Da=[],Sa=ea;Sa!==Object.prototype;){var vb=Sa===ea?String(this):Za.getClassName(Sa),Bb=null,Ib=Za.obj.getOwnPropertyDescriptors(Sa),wc=Object.getPrototypeOf(Sa),yc;for(yc in Ib){var gd=Ib[yc].value;"function"!==typeof gd||gd===Sa.constructor||yc.startsWith("$")||yc.startsWith("_")||(Bb||(Bb=[]),gd=Za.fun.argumentNames(gd),Bb.push({group:vb+" methods",signature:yc+"("+gd.join(", ")+")",name:yc}))}Bb&&Da.push(Bb);Sa=wc}return this.defaultSourceDataBindings(ea).concat(Da)}},
{key:"defaultConnectMenuItems",value:function(ea,Da){var Sa=this,vb=this.defaultSourceDataBindings(Da),Bb=Da.world();vb=vb.map(function(Ib){return[Ib[0].group||"uncategorized",Ib.map(function(wc){return[wc.name,ea?function(){return ea(wc.name,Da,wc)}:function(){var yc,gd;return $jscomp.asyncExecutePromiseGeneratorProgram(function($d){if(1==$d.nextAddress)return $d.yield(System.import("lively.ide/fabrik.js"),2);yc=$d.yieldResult;gd=yc.interactiveConnectGivenSource;gd(Da,wc.name);$d.jumpToEnd()})}]})]});
Bb&&vb.push(["custom...",ea?function(){return ea("custom...",Da,null)}:function(){var Ib,wc,yc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gd){if(1==gd.nextAddress)return gd.yield(System.import("lively.ide/fabrik.js"),2);if(3!=gd.nextAddress)return Ib=gd.yieldResult,wc=Ib.interactiveConnectGivenSource,gd.yield(Bb.prompt("Enter custom connection point",{requester:Da,historyId:"lively.morphic-custom-connection-points",useLastInput:!0}),3);(yc=gd.yieldResult)&&wc(Sa,yc);gd.jumpToEnd()})}]);
return vb}},{key:"handleHaloCycle",value:function(ea){var Da=ea.state.clickedOnMorph,Sa=ea.isCommandKey(),vb=ea.isShiftDown(),Bb;Sa&&!Da.isHalo&&(Sa=Bb=ea.world.morphsContainingPoint(ea.position),Bb=Bb.filter(function(Ib){return Ib.halosEnabled}),Sa=Sa.filter(function(Ib){return Ib.halosEnabled}),Bb=Sa[0]||Bb[0]);vb&&!Da.isHaloItem&&Bb&&ea.halo&&ea.halo.borderBox!=Bb?ea.halo.addMorphToSelection(Bb):(Da=ea.halo&&!ea.targetMorphs.find(function(Ib){return Ib.isHaloItem||Ib.keepHalo&&Ib.keepHalo(ea)}),
vb=ea.layoutHalo&&!ea.targetMorphs.find(function(Ib){return Ib.isHaloItem}),Sa=(!ea.halo||Da)&&Bb,vb&&ea.layoutHalo.remove(),Da&&ea.halo.remove(),Sa&&(ea.stop(),this.showHaloFor(Bb,ea.domEvt.pointerId)))}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"LivelyWorld"}},{key:"properties",get:function(){return{localComponents:{initialize:function(){var ea=this;this.whenRendered().then(function(){ea.localComponents?ea.localComponents.forEach(function(Da){var Sa,vb,Bb,Ib,wc,yc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gd){switch(gd.nextAddress){case 1:if(Da.owner){gd.jumpTo(0);
break}Sa=Da.withAllSubmorphsSelect(function($d){return $d.master&&!$d.master._appliedMaster});vb=$jscomp.makeIterator(Sa);Bb=vb.next();case 3:if(Bb.done){gd.jumpTo(5);break}Ib=Bb.value;return gd.yield(Ib.master.applyIfNeeded(!0),4);case 4:Bb=vb.next();gd.jumpTo(3);break;case 5:wc=ea.withAllSubmorphsSelect(function($d){return $d.master&&$d.master.uses(Da)}),yc=ea.localComponents.filter(function($d){return $d.master&&$d.master.uses(Da)}),wc.forEach(function($d){$d.requestMasterStyling()}),yc.forEach(function($d){return $d.master.applyIfNeeded(!0)}),
gd.jumpToEnd()}})}):ea.localComponents=ea.withAllSubmorphsSelect(function(Da){return Da.isComponent})})}},name:{set:function(ea){this.setProperty("name",ea);document.title="lively.next - "+ea}},hiddenComponents:{initialize:function(){this.hiddenComponents=[]}},fill:{defaultValue:Za.Color.rgb(81,90,90)},draggable:{readOnly:!0,get:function(){return!Za.touchInputDevice}},commentBrowser:{}}}}],O,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:1664,end:42194})}(Za.World));Za.LivelyWorld=pg;Za.LivelyWorld=pg;Za.LivelyWorld=pg;pg=Ma("SelectionElement",function(V){var O=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),Ka=O.hasOwnProperty("SelectionElement")&&"function"===typeof O.SelectionElement?O.SelectionElement:O.SelectionElement=function(ea){ea&&ea[Symbol.for("lively-instance-restorer")]||
this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Lc(Ka,V,void 0,[{key:Symbol.for("__LivelyClassName__"),get:function(){return"SelectionElement"}},{key:"properties",get:function(){return{borderColor:{defaultValue:Za.Color.red},borderWidth:{defaultValue:1},fill:{defaultValue:Za.Color.transparent},epiMorph:{defaultValue:!0},isSelectionElement:{readOnly:!0,get:function(){return!0}}}}}],O,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:42203,end:42565})}(Za.Morph));Za.SelectionElement=pg;Za.SelectionElement=pg;Za.SelectionElement=pg;pg=Ma("Selection",function(V){var O=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),Ka=O.hasOwnProperty("Selection")&&"function"===typeof O.Selection?O.Selection:O.Selection=function(ea){ea&&ea[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return Lc(Ka,V,void 0,[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Selection"}},{key:"properties",get:function(){return{fill:{defaultValue:Za.Color.gray.withA(.2)},borderWidth:{defaultValue:2},borderColor:{defaultValue:Za.Color.gray},isSelectionElement:{readOnly:!0,get:function(){return!0}}}}}],O,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},
package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:42574,end:42894})}(Za.Morph));Za.Selection=pg;Za.Selection=pg;Za.Selection=pg}}});