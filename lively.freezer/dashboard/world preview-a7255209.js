System.register(["./__root_module__-aefa9179.js","kld-intersections","./index-ea95c5b9.js","./index-9b6165d2.js"],function(){var Da,Bb,Qb,hc,ac,be,bd,Sd,ed,Mc,pd,Dd,ke,Kd,jd;return{setters:[function(cb){Da=cb.aw;Bb=cb.as;Qb=cb.ai;hc=cb.aD;ac=cb.aB;be=cb.an;bd=cb.Z;Sd=cb.bQ;ed=cb.$;Mc=cb.a5;pd=cb.s;Dd=cb.a6;ke=cb.C;Kd=cb.a3;jd=cb.L},function(){},function(){},function(){}],execute:function(){var cb=lively.FreezerRuntime.recorderFor("StaticText/index.js");cb.HTMLMorph=Da;var Ab=function(gc){var dd=
lively.FreezerRuntime.recorderFor("StaticText/index.js"),Zd=dd.hasOwnProperty("StaticText")&&"function"===typeof dd.StaticText?dd.StaticText:dd.StaticText=function(Wb){Wb&&Wb[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Bb(Zd,gc,[{key:"refresh",value:function(){this.html='<span style="line-height: 1.3; font-size: '+this.fontSize+"px; color: "+this.fontColor+"; font-family: "+this.fontFamily+'">'+this.value+"</span>"}}],[{key:Symbol.for("__LivelyClassName__"),
get:function(){return"StaticText"}},{key:"properties",get:function(){return{html:{isStyleProp:!1},fontSize:{type:"Number",set:function(Wb){this.setProperty("fontSize",Wb);this.refresh()}},fontColor:{type:"Color",set:function(Wb){this.setProperty("fontColor",Wb);this.refresh()}},fontFamily:{type:"Enum",set:function(Wb){this.setProperty("fontFamily",Wb);this.refresh()}},value:{set:function(Wb){this.setProperty("value",Wb);this.refresh()}}}}}],dd,{pathInPackage:function(){return"index.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"StaticText",version:"0.1.1-10"}}},{start:74,end:953})}(cb.HTMLMorph);Ab=cb.StaticText;cb.default=Ab;var Yb=lively.FreezerRuntime.recorderFor("WorldVersionViewer/index.js");Yb.Morph=Qb;Yb.World=hc;Yb.HorizontalLayout=ac;Yb.morph=be;Yb.MorphicDB=bd;Yb.graph=Sd;Yb.promise=ed;Yb.date=Mc;Yb.string=pd;Yb.arr=Dd;Yb.Color=ke;Yb.pt=Kd;Yb.LoadingIndicator=jd;(function(gc){var dd=lively.FreezerRuntime.recorderFor("WorldVersionViewer/index.js"),
Zd=dd.hasOwnProperty("WorldVersion")&&"function"===typeof dd.WorldVersion?dd.WorldVersion:dd.WorldVersion=function(Wb){Wb&&Wb[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Bb(Zd,gc,[{key:"update",value:function(){var Wb=$jscomp.makeIterator(this.submorphs),oc=Wb.next().value;Wb=Wb.next().value;oc.imageUrl=this.commit.preview;Wb.textAndAttributes=this.info;Wb.fontColor=this.selected?Yb.Color.white:Yb.Color.darkGray}}],[{key:Symbol.for("__LivelyClassName__"),
get:function(){return"WorldVersion"}},{key:"properties",get:function(){return{commit:{},fill:{defaultValue:Yb.Color.transparent},info:{derived:!0,get:function(){var Wb=this.commit,oc=Wb.message,Lb=Wb.name,Bc=Wb.timestamp;return[Wb._id.slice(0,6)+" ",{fontWeight:"bold"},Yb.string.truncate(oc.split("\n")[0],40)+" ",{}," ("+Lb+" ",{},""+Yb.date.format(new Date(Bc),"yyyy-mm-dd HH:MM Z"),{}]}},selected:{set:function(Wb){this.setProperty("selected",Wb);this.update()}},layout:{initialize:function(){this.layout=
new Yb.HorizontalLayout({align:"center",spacing:5})}},submorphs:{initialize:function(){this.submorphs=[{type:"image",extent:Yb.pt(30,30),name:"preview",reactsToPointer:!1},{reactsToPointer:!1,type:"label",fill:null,name:"commit info",fontFamily:"Nunito",fontColor:Yb.Color.gray}]}}}}}],dd,{pathInPackage:function(){return"index.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"WorldVersionViewer",
version:"0.1.1-33"}}},{start:274,end:1824})})(Yb.Morph);cb=function(gc){var dd=lively.FreezerRuntime.recorderFor("WorldVersionViewer/index.js"),Zd=dd.hasOwnProperty("WorldVersionViewer")&&"function"===typeof dd.WorldVersionViewer?dd.WorldVersionViewer:dd.WorldVersionViewer=function(Wb){Wb&&Wb[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Bb(Zd,gc,[{key:"reset",value:function(){this.getSubmorphNamed("version list").items=[]}},
{key:"onMouseDown",value:function(Wb){switch(Wb.targetMorph.name){case "visit button":this.visitSelectedCommit();break;case "revert button":this.revertToSelectedCommit()}}},{key:"visitSelectedCommit",value:function(){var Wb=this,oc,Lb,Bc,Sc,Yc,Xb,qb,uc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Hc){switch(Hc.nextAddress){case 1:return oc=Wb.get("version list").selection,Lb=Yb.LoadingIndicator.open("Loading "+oc.name+"..."),Bc=$world,Sc=Wb.db||Yb.MorphicDB.default,Yc=oc._id,Hc.setCatchFinallyBlocks(2,
3),Yc?Hc.yield(Yb.World.loadFromCommit(Yc,void 0,{morphicDB:Sc}),8):Hc.yield(Yb.World.loadFromDB(oc.name,oc.ref,void 0,{morphicDB:Sc}),7);case 7:Xb=Hc.yieldResult;Hc.jumpTo(6);break;case 8:Xb=Hc.yieldResult;case 6:return qb=Xb,Hc.return(qb);case 3:Hc.enterFinallyBlock();Lb.remove();Hc.leaveFinallyBlock(0);break;case 2:uc=Hc.enterCatchBlock(),console.error(uc),Bc.showError("Error loading world:"+uc),Hc.jumpTo(3)}})}},{key:"revertToSelectedCommit",value:function(){var Wb=this,oc,Lb,Bc,Sc,Yc,Xb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qb){if(1==
qb.nextAddress){oc=Wb.get("version list").selection;if(!oc)return qb.return();Lb=Wb.db||Yb.MorphicDB.default;Bc=oc;Sc=Bc._id;Yc=Bc.name;Xb=Bc.type;return qb.yield(Lb.revert(Xb,Yc,Sc,"HEAD"),2)}return qb.return(Wb.initializeFromStartCommit(oc,Lb,{showRevertButton:!0}))})}},{key:"initializeFromStartCommit",value:function(Wb,oc,Lb){oc=void 0===oc?Yb.MorphicDB.default:oc;Lb=void 0===Lb?{}:Lb;var Bc=this,Sc,Yc,Xb,qb,uc,Hc,Ia,Va,tb,Jb,Ib,ib,jb,Fb,rc,Ic,ec,Pc,Q,ha,Ha,Pa,bc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ic){switch(ic.nextAddress){case 1:return Sc=
Lb,Yc=void 0===Sc.showRefs?!0:Sc.showRefs,Xb=Bc.startCommit=Wb,qb=Xb._id,uc=Xb.type,Hc=Xb.name,Ia=Bc.getSubmorphNamed("version list spinner"),Ia.visible=!0,Ia.center=Bc.get("version list").center,Bc.db=oc,ic.yield(oc.history(uc,Hc),2);case 2:Va=ic.yieldResult,tb=Va.refs,Jb=Va.history,Ib=qb,ib=Yb.graph.invert(Jb),jb=Yb.graph.hull(ib,qb),Fb={_id:!0},rc=[Wb],Ic=$jscomp.makeIterator(jb),ec=Ic.next();case 3:if(ec.done)return ha=Yb.arr.max(rc,function(Ra){return Ra.timestamp}),Ib=ha._id,ic.yield(oc.log(Ib,
void 0,!0),7);Pc=ec.value;return ic.yield(oc.log(Pc,void 0,!0,Fb),6);case 6:Q=ic.yieldResult;rc.push.apply(rc,$jscomp.arrayFromIterable(Q));Q.forEach(function(Ra){return Fb[Ra._id]=!0});ec=Ic.next();ic.jumpTo(3);break;case 7:Ha=ic.yieldResult;if(Yc)for(Pa in tb);bc=Ha.map(function(Ra){var tc=new Yb.WorldVersion({reactsToPointer:!1,commit:Ra});tc.update();return{isListItem:!0,morph:tc,value:Ra}});Bc.get("version list").items=bc;Ia.visible=!1;ic.jumpToEnd()}})}}],[{key:Symbol.for("__LivelyClassName__"),
get:function(){return"WorldVersionViewer"}}],dd,{pathInPackage:function(){return"index.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"WorldVersionViewer",version:"0.1.1-33"}}},{start:1841,end:5600})}(Yb.Morph);cb=Yb.WorldVersionViewer;Yb.default=cb}}});