System.register(["./__root_module__-cd530690.js","kld-intersections"],function(Da){var zb,Rb,kc,dc,ke,hd,$d,md,Qc,xd,Od,ge,Ud,nd,Za;return{setters:[function(Cb){zb=Cb.s;Rb=Cb.P;kc=Cb.a5;dc=Cb.p;ke=Cb.bF;hd=Cb.B;$d=Cb.bG;md=Cb.r;Qc=Cb.aR;xd=Cb.bH;Od=Cb.bI;ge=Cb.bJ;Ud=Cb.bK;nd=Cb.bL;Za=Cb.n},function(){}],execute:function(){function Cb(Zb,rc,Lb,Gc){Gc=void 0===Gc?{}:Gc;Gc=Gc.package||ic.ObjectPackage.lookupPackageForObject(Zb,Gc);if(!Gc)throw Error("Object is not part of an object package: "+Zb);
return Gc.addScript(Zb,rc,Lb)}function bc(Zb,rc){rc=ic.normalizeOptions(rc).System;Zb=(Zb=Zb[Symbol.for("lively-module-meta")])?Zb.package.name:null;return(rc=(Zb?ic.lookupPackage(rc,Zb):{}).pkg)?!!ic.ObjectPackage.forSystemPackage(rc):!1}Da({addScript:Cb,isObjectClass:bc});var ic=lively.FreezerRuntime.recorderFor("lively.classes/object-classes.js");ic.normalizeOptions=function(Zb){Zb=Object.assign({baseURL:ic.defaultBaseURL,System:System},Zb);Zb.baseURL=Zb.baseURL.replace(/\/$/,"");return Zb};ic.addScript=
Cb;ic.isObjectClass=bc;ic.string=zb;ic.Path=Rb;ic.arr=kc;ic.parse=dc;ic.isValidIdentifier=ke;ic.stringify=hd;ic.parseFunction=$d;ic.resource=md;ic.runEval=Qc;ic.scripting=xd;ic.ExportLookup=Od;var id=ic.scripting;ic.ensurePackage=id.ensurePackage;ic.registerPackage=id.registerPackage;ic.importPackage=id.importPackage;ic.lookupPackage=id.lookupPackage;ic.module=id.module;ic.ImportInjector=id.ImportInjector;ic.RuntimeSourceDescriptor=ge;ic.toJsIdentifier=Ud;ic.adoptObject=nd;ic.classToFunctionTransform=
Za;ic.objectPackageSym=Symbol.for("lively-object-package-data");ic.defaultBaseURL="local://lively-object-modules";ic.globalClasses=Object.keys(System.global).map(function(Zb){Zb=System.global[Zb];return"function"===typeof Zb&&Zb.name&&Zb}).filter(Boolean);ic.addScript=Cb;ic.addScript=Cb;ic.isObjectClass=bc;ic.isObjectClass=bc;ic._packageStore=ic._packageStore||{};id=function(Zb,rc){this._id=Zb;this.options=ic.normalizeOptions(rc)};id.lookupPackageForObject=function(Zb,rc){return this.lookupPackageForClass(Zb.constructor,
rc)};id.lookupPackageForClass=function(Zb,rc){rc=ic.normalizeOptions(rc).System;Zb=(Zb=Zb[Symbol.for("lively-module-meta")])?Zb.package.name:null;return(rc=(Zb?ic.lookupPackage(rc,Zb):{}).pkg)?ic.ObjectPackage.forSystemPackage(rc):null};id.forSystemPackage=function(Zb){return this.packageStore[Zb.name]};id.withId=function(Zb,rc){return this.packageStore[Zb]||(this.packageStore[Zb]=new this(Zb,rc))};id.prototype.resource=function(Zb){Zb=void 0===Zb?"":Zb;return ic.resource(this.packageURL).join(Zb)};
id.prototype.load=function(){return ic.importPackage(this.System,this.packageURL)};id.prototype.ensureExistance=function(){var Zb=this,rc,Lb,Gc,$c,ed,$b,ob,zc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Mc){switch(Mc.nextAddress){case 1:return rc=Zb.resource("/"),Mc.yield(rc.exists(),2);case 2:if(Mc.yieldResult)return Mc.return();Lb=[{resource:rc}];Gc=[{resource:Zb.resource("package.json"),content:JSON.stringify(Zb.config,null,2)}];return Mc.yield(Promise.all(Lb.map(function(Ja){return Ja.resource.mkdir()})),
3);case 3:return Mc.yield(Promise.all(Gc.map(function(Ja){var Ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ub){switch(ub.nextAddress){case 1:return ub.yield(Ja.resource.exists(),2);case 2:if(!(Ra=!ub.yieldResult)){ub.jumpTo(3);break}return ub.yield(Ja.resource.write(Ja.content),4);case 4:Ra=ub.yieldResult;case 3:return ub.return(Ra)}})})),4);case 4:return Mc.yield(Zb.objectModule.ensureExistance(),5);case 5:return $c=Zb,ed=$c.System,$b=$c.packageURL,ob=$c.config,Mc.yield(ic.ensurePackage(ed,
$b),6);case 6:return zc=Mc.yieldResult,zc.registerWithConfig(ob),console.log(Zb.packageURL+" REGISTERED"),Mc.return(Zb)}})};id.prototype.ensureObjectClass=function(Zb){var rc=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lb){return 1==Lb.nextAddress?Lb.yield(rc.ensureExistance(),2):Lb.return(rc.objectModule.ensureObjectClass(Zb))})};id.prototype.adoptObject=function(Zb){var rc=this,Lb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gc){if(1==Gc.nextAddress)return rc.objectClass===
Zb.constructor?Gc.return():Gc.yield(rc.ensureObjectClass(Zb.constructor),2);Lb=Gc.yieldResult;ic.adoptObject(Zb,Lb);Gc.jumpToEnd()})};id.prototype.addScript=function(Zb,rc,Lb){return this.objectModule.addScript(Zb,rc,Lb)};id.prototype.remove=function(){this.systemPackage.remove();delete ic.ObjectPackage.packageStore[this.id];return this.resource().remove()};id.prototype.renameObjectClass=function(Zb,rc){rc=void 0===rc?[]:rc;var Lb=this,Gc,$c,ed,$b,ob,zc,Mc,Ja,Ra,ub,Mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ob){if(1==
Ob.nextAddress){Gc=Lb;$c=Gc.objectClass;ed=Gc.System;if(!$c||$c.className===Zb)return Ob.return($c);if(!ic.isValidIdentifier(Zb))throw Error(Zb+" is not a valid name for a class");ob=$b=ic.RuntimeSourceDescriptor.for($c,ed);zc=ob.source;Mc=ob.ast;Ja=Mc.id;Ra=Ja.start;ub=Ja.end;return Ob.yield($b.changeSource(zc.slice(0,Ra)+Zb+zc.slice(ub)),2)}Mb=Lb.objectClass;rc.forEach(function(kb){kb.constructor=Mb;kb.__proto__=Mb.prototype});return Ob.return(Mb)})};id.prototype.fork=function(Zb,rc){var Lb=this,
Gc,$c,ed,$b,ob,zc,Mc,Ja,Ra,ub,Mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ob){switch(Ob.nextAddress){case 1:return Gc=Lb,$c=Gc.System,ed=Gc.baseURL,$b=Gc.objectClass,rc=Object.assign({System:$c,baseURL:ed},rc),ob=ic.RuntimeSourceDescriptor.for($b),zc=ob._renamedSource(Zb),Mc=zc.moduleSource,Ja=ic.ObjectPackage.withId(Zb,rc),Ob.yield(Ja.ensureExistance(),2);case 2:return Ra=Ja,ub=Ra.objectModule,Mb=ub.systemModule,Ob.yield(Mb.load({format:"esm"}),3);case 3:return Ob.yield(Mb.changeSource(Mc),
4);case 4:return Ob.return(Ja)}})};$jscomp.global.Object.defineProperties(id.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return this._id}},name:{configurable:!0,enumerable:!0,get:function(){return this.id}},System:{configurable:!0,enumerable:!0,get:function(){return this.options.System}},baseURL:{configurable:!0,enumerable:!0,get:function(){return this.options.baseURL}},packageURL:{configurable:!0,enumerable:!0,get:function(){return this.baseURL+("/"+this.id)}},config:{configurable:!0,
enumerable:!0,get:function(){return{name:this.name,version:"0.1.0",lively:{isObjectPackage:!0}}}},systemPackage:{configurable:!0,enumerable:!0,get:function(){return ic.lookupPackage(this.System,this.packageURL,!0).pkg}},objectModule:{configurable:!0,enumerable:!0,get:function(){return this._objectModule||(this._objectModule=new ic.ObjectModule("index.js",this))}},objectClass:{configurable:!0,enumerable:!0,get:function(){return this.objectModule.objectClass}}});$jscomp.global.Object.defineProperties(id,
{packageStore:{configurable:!0,enumerable:!0,get:function(){return this._packageStore||(this._packageStore=ic._packageStore)}}});Da("default",id);ic.ObjectPackage=id;var fe=function(Zb,rc){if(!Zb)throw Error("ObjectModule needs package!");if(!rc)throw Error("ObjectModule needs package!");this._moduleName=Zb;this._objectPackage=rc};fe.prototype.read=function(){return this.resource.read()};fe.prototype.write=function(Zb){return this.resource.write(Zb)};fe.prototype.ensureExistance=function(){var Zb=
this,rc,Lb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gc){switch(Gc.nextAddress){case 1:return rc=Zb.resource,Gc.yield(rc.exists(),2);case 2:if(Gc.yieldResult){Gc.jumpTo(3);break}return Gc.yield(rc.write("'format esm';\n"),4);case 4:Lb={},Zb.System.config({meta:(Lb[Zb.url]={format:"esm"},Lb)});case 3:return Gc.return(Zb)}})};fe.prototype.ensureObjectClass=function(Zb){var rc=this,Lb=this.objectClass;return Lb&&Lb.prototype.__proto__===Zb.prototype?Lb:Promise.resolve(this.ensureObjectClassSource(Zb)).then(function(Gc){var $c=
Gc.source,ed=Gc.moduleId,$b=Gc.className,ob=Gc.bindings,zc=rc.System;Gc=ic.module(zc,ed);if(ob)for(var Mc in ob)Gc.define(Mc,ob[Mc]);$c=ic.runEval($c,{classTransform:ic.classToFunctionTransform,sync:!0,targetModule:ed,System:zc});if($c.isError)throw $c.value;$c=Gc.recorder[$b];if(!$c)throw Error("Failed to define class "+$b+" in "+ed);return $c})};fe.prototype.ensureObjectClassSource=function(Zb){return this.createDefaultClassDeclaration(Zb)};fe.prototype.createDefaultClassDeclaration=function(Zb){Zb=
void 0===Zb?Object:Zb;var rc=this,Lb,Gc,$c,ed,$b,ob,zc,Mc,Ja,Ra,ub,Mb,Ob,kb,ib,Jb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vc){switch(vc.nextAddress){case 1:Lb=rc;Gc=Lb.System;$c=Lb.systemModule;ed=Lb.objectPackage;$b=ic.string.capitalize(ic.toJsIdentifier(ed.id));ob=Zb.className;zc=!ob;Mc=ic.globalClasses.includes(Zb);Ja="";Ra=null;if(zc){ob="__anonymous_superclass__";ub={};Ra=(ub[ob]=Zb,ub);vc.jumpTo(2);break}if(Mc){vc.jumpTo(2);break}return vc.yield(ic.ExportLookup.findExportOfValue(Zb,
Gc),4);case 4:(Mb=vc.yieldResult)?(Ob=ic.ImportInjector.run(Gc,$c.id,$c.package(),"",Mb),kb=Ob.standaloneImport,Ja+=kb+"\n\n"):(ib={},Ra=(ib[ob]=Zb,ib));case 2:return $b===ob&&($b="Object"+$b),Jb="Object"===ob?"class "+$b+" {}\n":"class "+$b+" extends "+ob+" {}\n",Ja+="export default "+Jb+"\n",vc.yield($c.changeSource(Ja),5);case 5:return vc.yield($c.load(),6);case 6:return vc.return({source:Ja,className:$b,moduleId:rc.url,bindings:Ra})}})};fe.prototype.addScript=function(Zb,rc,Lb){var Gc=this,$c,
ed,$b,ob,zc,Mc,Ja,Ra,ub,Mb,Ob,kb,ib,Jb,vc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sc){switch(sc.nextAddress){case 1:if(Zb.constructor===Gc.objectClass){$c=Zb.constructor;sc.jumpTo(2);break}return sc.yield(Gc.ensureObjectClass(Zb.constructor),3);case 3:$c=sc.yieldResult;case 2:ed=$c;$b="function"===typeof rc?String(rc):rc;ob=ic.parseFunction($b);zc=ic.RuntimeSourceDescriptor.for(ed,Gc.System);Lb||(Lb=ic.Path("id.name").get(ob));if(!Lb)throw Error("No name, cannot add "+ic.string.truncate($b,
30).replace(/\n/g,"")+"!");Mc=ic.toJsIdentifier(Lb);console.assert("FunctionExpression"===ob.type||"ArrowFunctionExpression"===ob.type,"not a function expression but: "+ob.type);Ja=ob.params.map(function(Uc){return $b.slice(Uc.start,Uc.end)});Ra="BlockStatement"===ob.body.type?$b.slice(ob.body.start,ob.body.end):"{ return "+$b.slice(ob.body.start,ob.body.end)+" }";ub=Mc+"("+Ja.join(",")+") "+Ra;"ArrowFunctionExpression"===ob.type&&(ob.type="FunctionExpression");Mb=zc.source;Ob=zc.ast;if(!Ob)throw Error("cannot find class decl of "+
zc.module.id);(kb=Ob.body.body.find(function(Uc){return Uc.key.name===Mc&&!Uc.static}))?Mb=Mb.slice(0,kb.start)+ub+Mb.slice(kb.end):(ib=Mb.lastIndexOf("}"),Jb=Mb.slice(0,ib),vc=Mb.slice(ib),/\n\s*$/m.test(Jb)||(Jb+="\n"),ub=ic.string.changeIndent(ub,"  ",1),/^[ ]*\n/m.test(vc)||(vc="\n"+vc),Mb=Jb+ub+vc);return sc.yield(zc.changeSource(Mb),4);case 4:return sc.return({script:ed.prototype[Mc],klass:ed,module:zc.module.id,methodName:Mc})}})};$jscomp.global.Object.defineProperties(fe.prototype,{objectPackage:{configurable:!0,
enumerable:!0,get:function(){return this._objectPackage}},objectClass:{configurable:!0,enumerable:!0,get:function(){var Zb=this.systemModule;return Zb.isLoaded()?Zb.System.get(Zb.id).default:null}},moduleName:{configurable:!0,enumerable:!0,get:function(){return this._moduleName}},systemModule:{configurable:!0,enumerable:!0,get:function(){return ic.module(this.System,this.url)}},System:{configurable:!0,enumerable:!0,get:function(){return this.objectPackage.System}},resource:{configurable:!0,enumerable:!0,
get:function(){return this.objectPackage.resource(this.moduleName)}},url:{configurable:!0,enumerable:!0,get:function(){return this.resource.url}}});ic.ObjectModule=fe;ic.default=id}}});