System.register(["./__root_module__-64e296ea.js","kld-intersections","./client-command-874783a6.js"],function(Ba){var Ab,Qb,dc,Xb,Xd,ad;return{setters:[function(Nd){Ab=Nd.s;Qb=Nd.$;dc=Nd.a6;Xb=Nd.bG;Xd=Nd.a7},function(){},function(Nd){ad=Nd.runCommand}],execute:function(){function Nd(fb,Db){var mc,hc,Tc,Ld,oc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pc){if(1==pc.nextAddress)return mc=Gd.fileInfoCommandString(fb,Db),hc=Gd.runCommand(mc,Db),pc.yield(hc.whenDone(),2);if(Tc=0!=
hc.exitCode?hc.output:null)throw Tc;Ld=$jscomp.makeIterator(Gd.parseDirectoryListFromLs(hc.stdout,Db.rootDirectory||"."));oc=Ld.next().value;return pc.return(oc)})}function dd(fb,Db){return Gd.string.lines(fb).map(function(mc){return mc.trim().length?(new Gd.FileInfo(Db)).readFromDirectoryListLine(mc):null}).filter(Boolean)}function Lc(fb,Db){var mc,hc,Tc,Ld,oc,pc,Nb,Dc,Vc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Hd){mc=Object.assign({findFilesGroup:"default-find-files-process"},
Db);hc=mc.findFilesGroup;Tc=mc.rootDirectory;oc=Ld=Gd.findFilesProcesses[hc]||(Gd.findFilesProcesses[hc]={promiseState:null,commands:[]});pc=oc.commands;Nb=oc.promiseState;Nb||(Ld.promiseState=Nb=Gd.promise.deferred());Dc=Gd.findFilesCommandString(fb,Db);pc.forEach(function(Id){return Id.kill()});Vc=Gd.runCommand(Dc,Db);pc.push(Vc);Vc.whenDone().then(function(){Gd.arr.remove(pc,Vc);if(pc.some(function(rb){return rb.startTime>Vc.startTime}))console.log("[findFiles] command "+Vc+" exited but a newer findFiles command was started for group "+
hc+", discarding output");else{var Id=0!=Vc.exitCode?Vc.output:null;Id&&console.warn(Id);Id=Id?[]:Gd.parseDirectoryListFromLs(Vc.stdout,Tc)||[];Nb.resolve(Id);Object.assign(Ld,{promiseState:null,commands:[]})}}).catch(function(Id){return console.error(Id)});return Hd.return(Nb.promise)})}function rd(fb){function Db(mc){return Array.prototype.concat.apply([mc],mc.children?mc.children.map(Db):[])}return Db(fb).map(function(mc){var hc=mc.fullPath.replace(/^\//,"");return{fileName:hc,path:hc,rootDirectory:"./",
isDirectory:mc.isDirectory,isLink:void 0,lastModified:void 0,linkCount:void 0,mode:void 0,size:void 0,group:void 0,user:void 0}})}var Gd=lively.FreezerRuntime.recorderFor("lively.shell/client-fs-helper.js");Gd.fileInfo=Nd;Gd.fileInfoCommandString=function(fb,Db){var mc=Db=void 0===Db?{}:Db;Db=mc.rootDirectory;mc=mc.platform;Db=Db||".";var hc="win32"===mc?"\\":"/";"win32"===mc||Db.endsWith(hc)||(Db+=hc);return"win32"===mc?"cd "+Db+' && ls -lLd --time-style=locale "'+fb+'"':'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && env TZ=GMT LANG=en_US.UTF-8 cd '+
(Db+' && ls -lLd "$timeformat" "'+fb+'"')};Gd.parseDirectoryListFromLs=dd;Gd.findFiles=Lc;Gd.findFilesCommandString=function(fb,Db){var mc=Db=void 0===Db?{}:Db,hc=mc.rootDirectory,Tc=mc.exclude,Ld=mc.depth;mc=mc.platform;hc=hc||".";Tc=Tc||"-iname "+Gd.defaultExcludes.map(Gd.string.print).join(" -o -iname ");var oc="win32"===mc?"\\":"/";"win32"===mc||hc.endsWith(oc)||(hc+=oc);fb=Gd.string.format('%s "%s"',Db.re?"-iregex":Db.matchPath?"-ipath":"-iname",fb);Ld="number"===typeof Ld?" -maxdepth "+Ld:"";
return"win32"===mc?Gd.string.format("find %s %s ( %s ) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd --time-style=locale {}",hc,Db.re?"-E ":"",Tc.replace(/"/g,""),fb.replace(/"/g,""),Ld):'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && '+Gd.string.format('env TZ=GMT LANG=en_US.UTF-8 find %s %s \\( %s \\) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd "$timeformat" "{}"',hc,Db.re?"-E ":"",Tc,fb,Ld)};Gd.convertDirectoryUploadEntriesToFileInfos=
rd;Gd.runCommand=ad;Gd.string=Ab;Gd.promise=Qb;Gd.arr=dc;Gd.fileInfo=Nd;Gd.fileInfo=Nd;Gd.parseDirectoryListFromLs=dd;Gd.parseDirectoryListFromLs=dd;var ke=function(fb){this.rootDirectory=fb;this.fileName=this.path="";this.isDirectory=!1;this.lastModified=null;this.mode="";this.isLink=!1;this.linkCount=0;this.group=this.user="";this.size=0;this.rootDirectory=null};ke.prototype.readFromDirectoryListLine=function(fb){var Db=this;if(!fb.trim().length)return null;var mc=fb;this.reader.forEach(function(hc){return mc=
hc(mc,Db)});return this};ke.prototype.toString=function(){return this.path};$jscomp.global.Object.defineProperties(ke.prototype,{reader:{configurable:!0,enumerable:!0,get:function(){return[function(fb,Db){var mc=fb.indexOf(" ");Db.mode=fb.slice(0,mc);Db.isDirectory="d"===Db.mode[0];return fb.slice(mc+1).trim()},function(fb,Db){var mc=fb.indexOf(" ");Db.linkCount=Number(fb.slice(0,mc));return fb.slice(mc+1).trim()},function(fb,Db){var mc=fb.indexOf(" ");Db.user=fb.slice(0,mc);return fb.slice(mc+1).trim()},
function(fb,Db){var mc=Gd.string.peekRight(fb,0,/\s+[0-9]/);Db.group=fb.slice(0,mc).trim();return fb.slice(mc).trim()},function(fb,Db){var mc=fb.indexOf(" ");Db.size=Number(fb.slice(0,mc));return fb.slice(mc+1).trim()},function(fb,Db){var mc=Gd.string.reMatches(fb,/[^s]+\s+[0-9:\s]+/);if(!mc||!mc[0])return fb;Db.lastModified=new Date(mc[0].match+" GMT");return fb.slice(mc[0].end).trim()},function(fb,Db){var mc=(fb=fb.replace(/^\.\/+/g,"").replace(/\/\//g,"/"))&&fb.split(" -> "),hc=""===fb?!1:fb&&
2===mc.length,Tc=(mc=hc?mc[0]:fb)&&0===mc.indexOf(Db.rootDirectory)?mc.slice(Db.rootDirectory.length):mc;Db.fileName=""===fb?".":Tc;Db.path=mc;Db.isLink=hc;return Tc}]}}});Gd.FileInfo=ke;Gd.findFilesProcesses={};Gd.findFiles=Lc;Gd.findFiles=Lc;Gd.defaultExcludes=[".svn",".git","node_modules",".module_cache"];Gd.convertDirectoryUploadEntriesToFileInfos=rd;Gd.convertDirectoryUploadEntriesToFileInfos=rd;var Kd=lively.FreezerRuntime.recorderFor("lively.shell/client-resource.js");Kd.Resource=Xb;Kd.runCommand=
ad;Kd.fileInfo=Nd;Kd.findFiles=Lc;Kd.string=Ab;Kd.promise=Qb;Kd.arr=dc;Kd.obj=Xd;ke=function(fb,Db,mc){mc=void 0===mc?{}:mc;fb=Kd.Resource.call(this,fb)||this;fb.options=Object.assign({},mc,{l2lClient:Db||fb.constructor.defaultL2lClient});return fb};$jscomp.inherits(ke,Kd.Resource);ke.prototype.newResource=function(fb){return new this.constructor(fb,this.options.l2lClient,this.options)};ke.prototype.read=function(){var fb=this,Db=Kd.runCommand('cat "'+this.url+'"',this.options);return Db.whenDone().then(function(){if(Db.exitCode)throw Error("Read "+
fb.url+" failed: "+Db.stderr);return Db.output})};ke.prototype.write=function(fb){var Db=this,mc,hc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Tc){switch(Tc.nextAddress){case 1:return fb?Tc.yield(Kd.runCommand('touch "'+Db.url+'" && tee "'+Db.url+'"',Object.assign({stdin:String(fb)},Db.options)).whenDone(),4):Tc.yield(Kd.runCommand('echo -n > "'+Db.url+'"',Object.assign({},Db.options)).whenDone(),5);case 4:mc=Tc.yieldResult;Tc.jumpTo(3);break;case 5:mc=Tc.yieldResult;case 3:hc=mc;
if(hc.exitCode)throw Error("Write "+Db.url+" failed: "+hc.stderr);return Tc.return(Db)}})};ke.prototype.mkdir=function(){var fb=this,Db;return $jscomp.asyncExecutePromiseGeneratorProgram(function(mc){if(1==mc.nextAddress)return mc.yield(Kd.runCommand('mkdir -p "'+fb.url+'"',fb.options).whenDone(),2);Db=mc.yieldResult;if(Db.exitCode)throw Error(fb+" cannot create directory: "+Db.stderr);return mc.return(fb)})};ke.prototype.exists=function(){var fb=Kd.runCommand('test -d "'+this.url+'" || test -f "'+
this.url+'"',this.options);return fb.whenDone().then(function(){return 0===fb.exitCode})};ke.prototype.remove=function(){var fb=this,Db=Kd.runCommand('rm -rf "'+this.url+'"',this.options);return Db.whenDone().then(function(){if(Db.exitCode)throw Error("Remove of "+fb.url+" failed: "+Db.stderr);return fb})};ke.prototype.gzip=function(fb){var Db=this,mc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hc){mc=Kd.runCommand('gzip > "'+Db.url+'"',Object.assign({stdin:String(fb)},Db.options));
return hc.return(mc.whenDone().then(function(){if(mc.exitCode)throw Error("Gzip compression of "+Db.url+" failed: "+mc.stderr);return Db}))})};ke.prototype.brotli=function(fb){var Db=this,mc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hc){mc=Kd.runCommand('brotli > "'+Db.url+'"',Object.assign({stdin:String(fb)},Db.options));return hc.return(mc.whenDone().then(function(){if(mc.exitCode)throw Error("Brotli compression of "+Db.url+" failed: "+mc.stderr);return Db}))})};ke.prototype.readProperties=
function(){var fb=this,Db;return $jscomp.asyncExecutePromiseGeneratorProgram(function(mc){if(1==mc.nextAddress)return mc.yield(Kd.fileInfo(fb.url,fb.options),2);Db=mc.yieldResult;fb.assignProperties(Kd.obj.dissoc(Db,["fileName","path","rootDirectory"]));return mc.return(fb)})};ke.prototype.dirList=function(fb,Db){fb=void 0===fb?1:fb;Db=void 0===Db?{}:Db;var mc=this,hc,Tc,Ld,oc,pc,Nb,Dc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vc){if(1==Vc.nextAddress)return hc=Db,Tc=hc.exclude,
Array.isArray(Tc)&&(Tc="-iname "+Tc.map(Kd.string.print).join(" -o -iname ")),Ld=mc,oc=Ld.url,pc=Ld.options,Nb=pc.l2lClient,Vc.yield(Kd.findFiles("*",{exclude:Tc,depth:fb,rootDirectory:oc,l2lClient:Nb}),2);Dc=Vc.yieldResult;Dc[0].path.replace(/\/$/,"")===mc.url.replace(/\/$/,"")&&Dc.shift();return Vc.return(Dc.map(function(Hd){var Id=Hd.path;Hd.isDirectory&&(Id=Id.replace(/\/?$/,"/"));Id=new mc.constructor(Id,Nb,mc.options);Id.assignProperties(Kd.obj.dissoc(Hd,["fileName","path","rootDirectory"]));
return Id}))})};$jscomp.global.Object.defineProperties(ke,{defaultL2lClient:{configurable:!0,enumerable:!0,get:function(){return this._defaultL2lClient||Kd._defaultL2LClient},set:function(fb){this._defaultL2lClient=Kd._defaultL2LClient=fb}}});Ba("default",ke);Kd.ShellClientResource=ke;Kd._defaultL2LClient=Kd._defaultL2LClient||void 0;var Hc=Ba("resourceExtension",{name:"shell-client",matches:function(fb){return fb.startsWith("/")||fb.match(/[a-z]:\\/i)},resourceClass:Kd.ShellClientResource});Kd.resourceExtension=
Hc;Kd.resourceExtension=Hc;Kd.resourceExtension=Hc;Kd.default=ke}}});