System.register(["./__root_module__-64e296ea.js","kld-intersections","./index-997f10f9.js","./index-2a6f00a9.js"],function(){var Ba,Ab,Qb,dc,Xb,Xd,ad,Nd,dd,Lc,rd,Gd,ke,Kd;return{setters:[function(Hc){Ba=Hc.aj;Ab=Hc.aE;Qb=Hc.aC;dc=Hc.ao;Xb=Hc.Z;Xd=Hc.bS;ad=Hc.$;Nd=Hc.a5;dd=Hc.s;Lc=Hc.a6;rd=Hc.C;Gd=Hc.a3;ke=Hc.L;Kd=Hc.at},function(){},function(){},function(){}],execute:function(){var Hc=lively.FreezerRuntime.recorderFor("WorldVersionViewer/index.js");Hc.Morph=Ba;Hc.World=Ab;Hc.HorizontalLayout=
Qb;Hc.morph=dc;Hc.MorphicDB=Xb;Hc.graph=Xd;Hc.promise=ad;Hc.date=Nd;Hc.string=dd;Hc.arr=Lc;Hc.Color=rd;Hc.pt=Gd;Hc.LoadingIndicator=ke;(function(Db){var mc=lively.FreezerRuntime.recorderFor("WorldVersionViewer/index.js"),hc=mc.hasOwnProperty("WorldVersion")&&"function"===typeof mc.WorldVersion?mc.WorldVersion:mc.WorldVersion=function(Tc){Tc&&Tc[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Kd(hc,Db,[{key:"update",value:function(){var Tc=
$jscomp.makeIterator(this.submorphs),Ld=Tc.next().value;Tc=Tc.next().value;Ld.imageUrl=this.commit.preview;Tc.textAndAttributes=this.info;Tc.fontColor=this.selected?Hc.Color.white:Hc.Color.darkGray}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"WorldVersion"}},{key:"properties",get:function(){return{commit:{},fill:{defaultValue:Hc.Color.transparent},info:{derived:!0,get:function(){var Tc=this.commit,Ld=Tc.message,oc=Tc.name,pc=Tc.timestamp;return[Tc._id.slice(0,6)+" ",{fontWeight:"bold"},
Hc.string.truncate(Ld.split("\n")[0],40)+" ",{}," ("+oc+" ",{},""+Hc.date.format(new Date(pc),"yyyy-mm-dd HH:MM Z"),{}]}},selected:{set:function(Tc){this.setProperty("selected",Tc);this.update()}},layout:{initialize:function(){this.layout=new Hc.HorizontalLayout({align:"center",spacing:5})}},submorphs:{initialize:function(){this.submorphs=[{type:"image",extent:Hc.pt(30,30),name:"preview",reactsToPointer:!1},{reactsToPointer:!1,type:"label",fill:null,name:"commit info",fontFamily:"Nunito",fontColor:Hc.Color.gray}]}}}}}],
mc,{pathInPackage:function(){return"index.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"WorldVersionViewer",version:"0.1.1-34"}}},{start:274,end:1824})})(Hc.Morph);var fb=function(Db){var mc=lively.FreezerRuntime.recorderFor("WorldVersionViewer/index.js"),hc=mc.hasOwnProperty("WorldVersionViewer")&&"function"===typeof mc.WorldVersionViewer?mc.WorldVersionViewer:mc.WorldVersionViewer=
function(Tc){Tc&&Tc[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Kd(hc,Db,[{key:"reset",value:function(){this.getSubmorphNamed("version list").items=[];this.getSubmorphNamed("version list spinner").visible=!1}},{key:"onMouseDown",value:function(Tc){switch(Tc.targetMorph.name){case "visit button":this.visitSelectedCommit();break;case "revert button":this.revertToSelectedCommit()}}},{key:"visitSelectedCommit",value:function(){var Tc=
this,Ld,oc,pc,Nb,Dc,Vc,Hd,Id;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rb){switch(rb.nextAddress){case 1:return Ld=Tc.get("version list").selection,oc=Hc.LoadingIndicator.open("Loading "+Ld.name+"..."),pc=$world,Nb=Tc.db||Hc.MorphicDB.default,Dc=Ld._id,rb.setCatchFinallyBlocks(2,3),Dc?rb.yield(Hc.World.loadFromCommit(Dc,void 0,{morphicDB:Nb}),8):rb.yield(Hc.World.loadFromDB(Ld.name,Ld.ref,void 0,{morphicDB:Nb}),7);case 7:Vc=rb.yieldResult;rb.jumpTo(6);break;case 8:Vc=rb.yieldResult;
case 6:return Hd=Vc,rb.return(Hd);case 3:rb.enterFinallyBlock();oc.remove();rb.leaveFinallyBlock(0);break;case 2:Id=rb.enterCatchBlock(),console.error(Id),pc.showError("Error loading world:"+Id),rb.jumpTo(3)}})}},{key:"revertToSelectedCommit",value:function(){var Tc=this,Ld,oc,pc,Nb,Dc,Vc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Hd){if(1==Hd.nextAddress){Ld=Tc.get("version list").selection;if(!Ld)return Hd.return();oc=Tc.db||Hc.MorphicDB.default;pc=Ld;Nb=pc._id;Dc=pc.name;Vc=pc.type;
return Hd.yield(oc.revert(Vc,Dc,Nb,"HEAD"),2)}return Hd.return(Tc.initializeFromStartCommit(Ld,oc,{showRevertButton:!0}))})}},{key:"initializeFromStartCommit",value:function(Tc,Ld,oc){Ld=void 0===Ld?Hc.MorphicDB.default:Ld;oc=void 0===oc?{}:oc;var pc=this,Nb,Dc,Vc,Hd,Id,rb,Hb,Mc,qb,tb,eb,ob,wb,cb,Oa,Gb,sc,vc,fc,rc,Q,ha,Ga;return $jscomp.asyncExecutePromiseGeneratorProgram(function(La){switch(La.nextAddress){case 1:return Nb=oc,Dc=void 0===Nb.showRefs?!0:Nb.showRefs,Vc=pc.startCommit=Tc,Hd=Vc._id,
Id=Vc.type,rb=Vc.name,Hb=pc.getSubmorphNamed("version list spinner"),Hb.visible=!0,Hb.center=pc.get("version list").center,pc.db=Ld,La.yield(Ld.history(Id,rb),2);case 2:Mc=La.yieldResult,qb=Mc.refs,tb=Mc.history,eb=Hd,ob=Hc.graph.invert(tb),wb=Hc.graph.hull(ob,Hd),cb={_id:!0},Oa=[Tc],Gb=$jscomp.makeIterator(wb),sc=Gb.next();case 3:if(sc.done)return rc=Hc.arr.max(Oa,function(Yb){return Yb.timestamp}),eb=rc._id,La.yield(Ld.log(eb,void 0,!0),7);vc=sc.value;return La.yield(Ld.log(vc,void 0,!0,cb),6);
case 6:fc=La.yieldResult;Oa.push.apply(Oa,$jscomp.arrayFromIterable(fc));fc.forEach(function(Yb){return cb[Yb._id]=!0});sc=Gb.next();La.jumpTo(3);break;case 7:Q=La.yieldResult;if(Dc)for(ha in qb);Ga=Q.map(function(Yb){var kc=new Hc.WorldVersion({reactsToPointer:!1,commit:Yb});kc.update();return{isListItem:!0,morph:kc,value:Yb}});pc.get("version list").items=Ga;Hb.visible=!1;La.jumpToEnd()}})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"WorldVersionViewer"}}],mc,{pathInPackage:function(){return"index.js"},
unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"WorldVersionViewer",version:"0.1.1-34"}}},{start:1841,end:5718})}(Hc.Morph);fb=Hc.WorldVersionViewer;Hc.default=fb}}});