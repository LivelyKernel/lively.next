System.register(["./__root_module__-7efb35ac.js","kld-intersections","./client-command-da2eead4.js"],function(Ba){var Cb,Sb,jc,lc,Xd,ed;return{setters:[function(Yd){Cb=Yd.s;Sb=Yd._;jc=Yd.a4;lc=Yd.bD;Xd=Yd.a5},function(){},function(Yd){ed=Yd.runCommand}],execute:function(){function Yd(bb,Fb){var vc,pc,sd,pd,tc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(bd){if(1==bd.nextAddress)return vc=Cd.fileInfoCommandString(bb,Fb),pc=Cd.runCommand(vc,Fb),bd.yield(pc.whenDone(),2);if(sd=0!=
pc.exitCode?pc.output:null)throw sd;pd=$jscomp.makeIterator(Cd.parseDirectoryListFromLs(pc.stdout,Fb.rootDirectory||"."));tc=pd.next().value;return bd.return(tc)})}function id(bb,Fb){return Cd.string.lines(bb).map(function(vc){return vc.trim().length?(new Cd.FileInfo(Fb)).readFromDirectoryListLine(vc):null}).filter(Boolean)}function Wc(bb,Fb){var vc,pc,sd,pd,tc,bd,Xb,Tb,Oc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(td){vc=Object.assign({findFilesGroup:"default-find-files-process"},
Fb);pc=vc.findFilesGroup;sd=vc.rootDirectory;tc=pd=Cd.findFilesProcesses[pc]||(Cd.findFilesProcesses[pc]={promiseState:null,commands:[]});bd=tc.commands;Xb=tc.promiseState;Xb||(pd.promiseState=Xb=Cd.promise.deferred());Tb=Cd.findFilesCommandString(bb,Fb);bd.forEach(function(Pb){return Pb.kill()});Oc=Cd.runCommand(Tb,Fb);bd.push(Oc);Oc.whenDone().then(function(){Cd.arr.remove(bd,Oc);if(bd.some(function(tb){return tb.startTime>Oc.startTime}))console.log("[findFiles] command "+Oc+" exited but a newer findFiles command was started for group "+
pc+", discarding output");else{var Pb=0!=Oc.exitCode?Oc.output:null;Pb&&console.warn(Pb);Pb=Pb?[]:Cd.parseDirectoryListFromLs(Oc.stdout,sd)||[];Xb.resolve(Pb);Object.assign(pd,{promiseState:null,commands:[]})}}).catch(function(Pb){return console.error(Pb)});return td.return(Xb.promise)})}function Ad(bb){function Fb(vc){return Array.prototype.concat.apply([vc],vc.children?vc.children.map(Fb):[])}return Fb(bb).map(function(vc){var pc=vc.fullPath.replace(/^\//,"");return{fileName:pc,path:pc,rootDirectory:"./",
isDirectory:vc.isDirectory,isLink:void 0,lastModified:void 0,linkCount:void 0,mode:void 0,size:void 0,group:void 0,user:void 0}})}var Cd=lively.FreezerRuntime.recorderFor("lively.shell/client-fs-helper.js");Cd.fileInfo=Yd;Cd.fileInfoCommandString=function(bb,Fb){var vc=Fb=void 0===Fb?{}:Fb;Fb=vc.rootDirectory;vc=vc.platform;Fb=Fb||".";var pc="win32"===vc?"\\":"/";"win32"===vc||Fb.endsWith(pc)||(Fb+=pc);return"win32"===vc?"cd "+Fb+' && ls -lLd --time-style=locale "'+bb+'"':'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && env TZ=GMT LANG=en_US.UTF-8 cd '+
(Fb+' && ls -lLd "$timeformat" "'+bb+'"')};Cd.parseDirectoryListFromLs=id;Cd.findFiles=Wc;Cd.findFilesCommandString=function(bb,Fb){var vc=Fb=void 0===Fb?{}:Fb,pc=vc.rootDirectory,sd=vc.exclude,pd=vc.depth;vc=vc.platform;pc=pc||".";sd=sd||"-iname "+Cd.defaultExcludes.map(Cd.string.print).join(" -o -iname ");var tc="win32"===vc?"\\":"/";"win32"===vc||pc.endsWith(tc)||(pc+=tc);bb=Cd.string.format('%s "%s"',Fb.re?"-iregex":Fb.matchPath?"-ipath":"-iname",bb);pd="number"===typeof pd?" -maxdepth "+pd:"";
return"win32"===vc?Cd.string.format("find %s %s ( %s ) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd --time-style=locale {}",pc,Fb.re?"-E ":"",sd.replace(/"/g,""),bb.replace(/"/g,""),pd):'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && '+Cd.string.format('env TZ=GMT LANG=en_US.UTF-8 find %s %s \\( %s \\) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd "$timeformat" "{}"',pc,Fb.re?"-E ":"",sd,bb,pd)};Cd.convertDirectoryUploadEntriesToFileInfos=
Ad;Cd.runCommand=ed;Cd.string=Cb;Cd.promise=Sb;Cd.arr=jc;Cd.fileInfo=Yd;Cd.fileInfo=Yd;Cd.parseDirectoryListFromLs=id;Cd.parseDirectoryListFromLs=id;var fe=function(bb){this.rootDirectory=bb;this.fileName=this.path="";this.isDirectory=!1;this.lastModified=null;this.mode="";this.isLink=!1;this.linkCount=0;this.group=this.user="";this.size=0;this.rootDirectory=null};fe.prototype.readFromDirectoryListLine=function(bb){var Fb=this;if(!bb.trim().length)return null;var vc=bb;this.reader.forEach(function(pc){return vc=
pc(vc,Fb)});return this};fe.prototype.toString=function(){return this.path};$jscomp.global.Object.defineProperties(fe.prototype,{reader:{configurable:!0,enumerable:!0,get:function(){return[function(bb,Fb){var vc=bb.indexOf(" ");Fb.mode=bb.slice(0,vc);Fb.isDirectory="d"===Fb.mode[0];return bb.slice(vc+1).trim()},function(bb,Fb){var vc=bb.indexOf(" ");Fb.linkCount=Number(bb.slice(0,vc));return bb.slice(vc+1).trim()},function(bb,Fb){var vc=bb.indexOf(" ");Fb.user=bb.slice(0,vc);return bb.slice(vc+1).trim()},
function(bb,Fb){var vc=Cd.string.peekRight(bb,0,/\s+[0-9]/);Fb.group=bb.slice(0,vc).trim();return bb.slice(vc).trim()},function(bb,Fb){var vc=bb.indexOf(" ");Fb.size=Number(bb.slice(0,vc));return bb.slice(vc+1).trim()},function(bb,Fb){var vc=Cd.string.reMatches(bb,/[^s]+\s+[0-9:\s]+/);if(!vc||!vc[0])return bb;Fb.lastModified=new Date(vc[0].match+" GMT");return bb.slice(vc[0].end).trim()},function(bb,Fb){var vc=(bb=bb.replace(/^\.\/+/g,"").replace(/\/\//g,"/"))&&bb.split(" -> "),pc=""===bb?!1:bb&&
2===vc.length,sd=(vc=pc?vc[0]:bb)&&0===vc.indexOf(Fb.rootDirectory)?vc.slice(Fb.rootDirectory.length):vc;Fb.fileName=""===bb?".":sd;Fb.path=vc;Fb.isLink=pc;return sd}]}}});Cd.FileInfo=fe;Cd.findFilesProcesses={};Cd.findFiles=Wc;Cd.findFiles=Wc;Cd.defaultExcludes=[".svn",".git","node_modules",".module_cache"];Cd.convertDirectoryUploadEntriesToFileInfos=Ad;Cd.convertDirectoryUploadEntriesToFileInfos=Ad;var Sd=lively.FreezerRuntime.recorderFor("lively.shell/client-resource.js");Sd.Resource=lc;Sd.runCommand=
ed;Sd.fileInfo=Yd;Sd.findFiles=Wc;Sd.string=Cb;Sd.promise=Sb;Sd.arr=jc;Sd.obj=Xd;fe=function(bb,Fb,vc){vc=void 0===vc?{}:vc;bb=Sd.Resource.call(this,bb)||this;bb.options=Object.assign({},vc,{l2lClient:Fb||bb.constructor.defaultL2lClient});return bb};$jscomp.inherits(fe,Sd.Resource);fe.prototype.newResource=function(bb){return new this.constructor(bb,this.options.l2lClient,this.options)};fe.prototype.read=function(){var bb=this,Fb=Sd.runCommand('cat "'+this.url+'"',this.options);return Fb.whenDone().then(function(){if(Fb.exitCode)throw Error("Read "+
bb.url+" failed: "+Fb.stderr);return Fb.output})};fe.prototype.write=function(bb){var Fb=this,vc,pc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sd){switch(sd.nextAddress){case 1:return bb?sd.yield(Sd.runCommand('touch "'+Fb.url+'" && tee "'+Fb.url+'"',Object.assign({stdin:String(bb)},Fb.options)).whenDone(),4):sd.yield(Sd.runCommand('echo -n > "'+Fb.url+'"',Object.assign({},Fb.options)).whenDone(),5);case 4:vc=sd.yieldResult;sd.jumpTo(3);break;case 5:vc=sd.yieldResult;case 3:pc=vc;
if(pc.exitCode)throw Error("Write "+Fb.url+" failed: "+pc.stderr);return sd.return(Fb)}})};fe.prototype.mkdir=function(){var bb=this,Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vc){if(1==vc.nextAddress)return vc.yield(Sd.runCommand('mkdir -p "'+bb.url+'"',bb.options).whenDone(),2);Fb=vc.yieldResult;if(Fb.exitCode)throw Error(bb+" cannot create directory: "+Fb.stderr);return vc.return(bb)})};fe.prototype.exists=function(){var bb=Sd.runCommand('test -d "'+this.url+'" || test -f "'+
this.url+'"',this.options);return bb.whenDone().then(function(){return 0===bb.exitCode})};fe.prototype.remove=function(){var bb=this,Fb=Sd.runCommand('rm -rf "'+this.url+'"',this.options);return Fb.whenDone().then(function(){if(Fb.exitCode)throw Error("Remove of "+bb.url+" failed: "+Fb.stderr);return bb})};fe.prototype.gzip=function(bb){var Fb=this,vc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pc){vc=Sd.runCommand('gzip > "'+Fb.url+'"',Object.assign({stdin:String(bb)},Fb.options));
return pc.return(vc.whenDone().then(function(){if(vc.exitCode)throw Error("Gzip compression of "+Fb.url+" failed: "+vc.stderr);return Fb}))})};fe.prototype.brotli=function(bb){var Fb=this,vc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pc){vc=Sd.runCommand('brotli > "'+Fb.url+'"',Object.assign({stdin:String(bb)},Fb.options));return pc.return(vc.whenDone().then(function(){if(vc.exitCode)throw Error("Brotli compression of "+Fb.url+" failed: "+vc.stderr);return Fb}))})};fe.prototype.readProperties=
function(){var bb=this,Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vc){if(1==vc.nextAddress)return vc.yield(Sd.fileInfo(bb.url,bb.options),2);Fb=vc.yieldResult;bb.assignProperties(Sd.obj.dissoc(Fb,["fileName","path","rootDirectory"]));return vc.return(bb)})};fe.prototype.dirList=function(bb,Fb){bb=void 0===bb?1:bb;Fb=void 0===Fb?{}:Fb;var vc=this,pc,sd,pd,tc,bd,Xb,Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Oc){if(1==Oc.nextAddress)return pc=Fb,sd=pc.exclude,
Array.isArray(sd)&&(sd="-iname "+sd.map(Sd.string.print).join(" -o -iname ")),pd=vc,tc=pd.url,bd=pd.options,Xb=bd.l2lClient,Oc.yield(Sd.findFiles("*",{exclude:sd,depth:bb,rootDirectory:tc,l2lClient:Xb}),2);Tb=Oc.yieldResult;Tb[0].path.replace(/\/$/,"")===vc.url.replace(/\/$/,"")&&Tb.shift();return Oc.return(Tb.map(function(td){var Pb=td.path;td.isDirectory&&(Pb=Pb.replace(/\/?$/,"/"));Pb=new vc.constructor(Pb,Xb,vc.options);Pb.assignProperties(Sd.obj.dissoc(td,["fileName","path","rootDirectory"]));
return Pb}))})};$jscomp.global.Object.defineProperties(fe,{defaultL2lClient:{configurable:!0,enumerable:!0,get:function(){return this._defaultL2lClient||Sd._defaultL2LClient},set:function(bb){this._defaultL2lClient=Sd._defaultL2LClient=bb}}});Ba("default",fe);Sd.ShellClientResource=fe;Sd._defaultL2LClient=Sd._defaultL2LClient||void 0;var jd=Ba("resourceExtension",{name:"shell-client",matches:function(bb){return bb.startsWith("/")||bb.match(/[a-z]:\\/i)},resourceClass:Sd.ShellClientResource});Sd.resourceExtension=
jd;Sd.resourceExtension=jd;Sd.resourceExtension=jd;Sd.default=fe}}});