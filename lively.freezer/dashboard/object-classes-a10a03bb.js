System.register(["./__root_module__-cddb8267.js","kld-intersections"],function(Ea){var Cb,Kb,lc,$b,Qd,Zc,Rd,ad,Nc,nd,he,af,Af,rd,cc;return{setters:[function(Ic){Cb=Ic.a7;Kb=Ic.P;lc=Ic.a6;$b=Ic.p;Qd=Ic.bE;Zc=Ic.B;Rd=Ic.bF;ad=Ic.r;Nc=Ic.aU;nd=Ic.bG;he=Ic.bH;af=Ic.bI;Af=Ic.bJ;rd=Ic.bK;cc=Ic.l},function(){}],execute:function(){function Ic(yc,Cc,Pb,Dc){Dc=void 0===Dc?{}:Dc;Dc=Dc.package||Kc.ObjectPackage.lookupPackageForObject(yc,Dc);if(!Dc)throw Error("Object is not part of an object package: "+yc);
return Dc.addScript(yc,Cc,Pb)}function Kd(yc,Cc){Cc=Kc.normalizeOptions(Cc).System;yc=(yc=yc[Symbol.for("lively-module-meta")])?yc.package.name:null;return(Cc=(yc?Kc.lookupPackage(Cc,yc):{}).pkg)?!!Kc.ObjectPackage.forSystemPackage(Cc):!1}Ea({addScript:Ic,isObjectClass:Kd});var Kc=lively.FreezerRuntime.recorderFor("lively.classes/object-classes.js");Kc.normalizeOptions=function(yc){yc=Object.assign({baseURL:Kc.defaultBaseURL,System:System},yc);yc.baseURL=yc.baseURL.replace(/\/$/,"");return yc};Kc.addScript=
Ic;Kc.isObjectClass=Kd;Kc.string=Cb;Kc.Path=Kb;Kc.arr=lc;Kc.parse=$b;Kc.isValidIdentifier=Qd;Kc.stringify=Zc;Kc.parseFunction=Rd;Kc.resource=ad;Kc.runEval=Nc;Kc.scripting=nd;Kc.ExportLookup=he;var Bd=Kc.scripting;Kc.ensurePackage=Bd.ensurePackage;Kc.registerPackage=Bd.registerPackage;Kc.importPackage=Bd.importPackage;Kc.lookupPackage=Bd.lookupPackage;Kc.module=Bd.module;Kc.ImportInjector=Bd.ImportInjector;Kc.RuntimeSourceDescriptor=af;Kc.toJsIdentifier=Af;Kc.adoptObject=rd;Kc.classToFunctionTransform=
cc;Kc.objectPackageSym=Symbol.for("lively-object-package-data");Kc.defaultBaseURL="local://lively-object-modules";Kc.globalClasses=Object.keys(System.global).map(function(yc){yc=System.global[yc];return"function"===typeof yc&&yc.name&&yc}).filter(Boolean);Kc.addScript=Ic;Kc.addScript=Ic;Kc.isObjectClass=Kd;Kc.isObjectClass=Kd;Kc._packageStore=Kc._packageStore||{};Bd=function(yc,Cc){this._id=yc;this.options=Kc.normalizeOptions(Cc)};Bd.lookupPackageForObject=function(yc,Cc){return this.lookupPackageForClass(yc.constructor,
Cc)};Bd.lookupPackageForClass=function(yc,Cc){Cc=Kc.normalizeOptions(Cc).System;yc=(yc=yc[Symbol.for("lively-module-meta")])?yc.package.name:null;return(Cc=(yc?Kc.lookupPackage(Cc,yc):{}).pkg)?Kc.ObjectPackage.forSystemPackage(Cc):null};Bd.forSystemPackage=function(yc){return this.packageStore[yc.name]};Bd.withId=function(yc,Cc){return this.packageStore[yc]||(this.packageStore[yc]=new this(yc,Cc))};Bd.prototype.resource=function(yc){yc=void 0===yc?"":yc;return Kc.resource(this.packageURL).join(yc)};
Bd.prototype.load=function(){return Kc.importPackage(this.System,this.packageURL)};Bd.prototype.ensureExistance=function(){var yc=this,Cc,Pb,Dc,Xc,Cd,Od,Gb,sb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bc){switch(Bc.nextAddress){case 1:return Cc=yc.resource("/"),Bc.yield(Cc.exists(),2);case 2:if(Bc.yieldResult)return Bc.return();Pb=[{resource:Cc}];Dc=[{resource:yc.resource("package.json"),content:JSON.stringify(yc.config,null,2)}];return Bc.yield(Promise.all(Pb.map(function(gb){return gb.resource.mkdir()})),
3);case 3:return Bc.yield(Promise.all(Dc.map(function(gb){var rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sa){switch(Sa.nextAddress){case 1:return Sa.yield(gb.resource.exists(),2);case 2:if(!(rb=!Sa.yieldResult)){Sa.jumpTo(3);break}return Sa.yield(gb.resource.write(gb.content),4);case 4:rb=Sa.yieldResult;case 3:return Sa.return(rb)}})})),4);case 4:return Bc.yield(yc.objectModule.ensureExistance(),5);case 5:return Xc=yc,Cd=Xc.System,Od=Xc.packageURL,Gb=Xc.config,Bc.yield(Kc.ensurePackage(Cd,
Od),6);case 6:return sb=Bc.yieldResult,sb.registerWithConfig(Gb),console.log(yc.packageURL+" REGISTERED"),Bc.return(yc)}})};Bd.prototype.ensureObjectClass=function(yc){var Cc=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pb){return 1==Pb.nextAddress?Pb.yield(Cc.ensureExistance(),2):Pb.return(Cc.objectModule.ensureObjectClass(yc))})};Bd.prototype.adoptObject=function(yc){var Cc=this,Pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Dc){if(1==Dc.nextAddress)return Cc.objectClass===
yc.constructor?Dc.return():Dc.yield(Cc.ensureObjectClass(yc.constructor),2);Pb=Dc.yieldResult;Kc.adoptObject(yc,Pb);Dc.jumpToEnd()})};Bd.prototype.addScript=function(yc,Cc,Pb){return this.objectModule.addScript(yc,Cc,Pb)};Bd.prototype.remove=function(){this.systemPackage.remove();delete Kc.ObjectPackage.packageStore[this.id];return this.resource().remove()};Bd.prototype.renameObjectClass=function(yc,Cc){Cc=void 0===Cc?[]:Cc;var Pb=this,Dc,Xc,Cd,Od,Gb,sb,Bc,gb,rb,Sa,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cb){if(1==
cb.nextAddress){Dc=Pb;Xc=Dc.objectClass;Cd=Dc.System;if(!Xc||Xc[Symbol.for("__LivelyClassName__")]===yc)return cb.return(Xc);if(!Kc.isValidIdentifier(yc))throw Error(yc+" is not a valid name for a class");Gb=Od=Kc.RuntimeSourceDescriptor.for(Xc,Cd);sb=Gb.source;Bc=Gb.ast;gb=Bc.id;rb=gb.start;Sa=gb.end;return cb.yield(Od.changeSource(sb.slice(0,rb)+yc+sb.slice(Sa)),2)}Ua=Pb.objectClass;Cc.forEach(function(ab){ab.constructor=Ua;ab.__proto__=Ua.prototype});return cb.return(Ua)})};Bd.prototype.fork=function(yc,
Cc){var Pb=this,Dc,Xc,Cd,Od,Gb,sb,Bc,gb,rb,Sa,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cb){switch(cb.nextAddress){case 1:return Dc=Pb,Xc=Dc.System,Cd=Dc.baseURL,Od=Dc.objectClass,Cc=Object.assign({System:Xc,baseURL:Cd},Cc),Gb=Kc.RuntimeSourceDescriptor.for(Od),sb=Gb._renamedSource(yc),Bc=sb.moduleSource,gb=Kc.ObjectPackage.withId(yc,Cc),cb.yield(gb.ensureExistance(),2);case 2:return rb=gb,Sa=rb.objectModule,Ua=Sa.systemModule,cb.yield(Ua.load({format:"esm"}),3);case 3:return cb.yield(Ua.changeSource(Bc),
4);case 4:return cb.return(gb)}})};$jscomp.global.Object.defineProperties(Bd.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return this._id}},name:{configurable:!0,enumerable:!0,get:function(){return this.id}},System:{configurable:!0,enumerable:!0,get:function(){return this.options.System}},baseURL:{configurable:!0,enumerable:!0,get:function(){return this.options.baseURL}},packageURL:{configurable:!0,enumerable:!0,get:function(){return this.baseURL+("/"+this.id)}},config:{configurable:!0,
enumerable:!0,get:function(){return{name:this.name,version:"0.1.0",lively:{isObjectPackage:!0}}}},systemPackage:{configurable:!0,enumerable:!0,get:function(){return Kc.lookupPackage(this.System,this.packageURL,!0).pkg}},objectModule:{configurable:!0,enumerable:!0,get:function(){return this._objectModule||(this._objectModule=new Kc.ObjectModule("index.js",this))}},objectClass:{configurable:!0,enumerable:!0,get:function(){return this.objectModule.objectClass}}});$jscomp.global.Object.defineProperties(Bd,
{packageStore:{configurable:!0,enumerable:!0,get:function(){return this._packageStore||(this._packageStore=Kc._packageStore)}}});Ea("default",Bd);Kc.ObjectPackage=Bd;var be=function(yc,Cc){if(!yc)throw Error("ObjectModule needs package!");if(!Cc)throw Error("ObjectModule needs package!");this._moduleName=yc;this._objectPackage=Cc};be.prototype.read=function(){return this.resource.read()};be.prototype.write=function(yc){return this.resource.write(yc)};be.prototype.ensureExistance=function(){var yc=
this,Cc,Pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Dc){switch(Dc.nextAddress){case 1:return Cc=yc.resource,Dc.yield(Cc.exists(),2);case 2:if(Dc.yieldResult){Dc.jumpTo(3);break}return Dc.yield(Cc.write("'format esm';\n"),4);case 4:Pb={},yc.System.config({meta:(Pb[yc.url]={format:"esm"},Pb)});case 3:return Dc.return(yc)}})};be.prototype.ensureObjectClass=function(yc){var Cc=this,Pb=this.objectClass;return Pb&&Pb.prototype.__proto__===yc.prototype?Pb:Promise.resolve(this.ensureObjectClassSource(yc)).then(function(Dc){var Xc=
Dc.source,Cd=Dc.moduleId,Od=Dc.className,Gb=Dc.bindings,sb=Cc.System;Dc=Kc.module(sb,Cd);if(Gb)for(var Bc in Gb)Dc.define(Bc,Gb[Bc]);Xc=Kc.runEval(Xc,{classTransform:Kc.classToFunctionTransform,sync:!0,targetModule:Cd,System:sb});if(Xc.isError)throw Xc.value;Xc=Dc.recorder[Od];if(!Xc)throw Error("Failed to define class "+Od+" in "+Cd);return Xc})};be.prototype.ensureObjectClassSource=function(yc){return this.createDefaultClassDeclaration(yc)};be.prototype.createDefaultClassDeclaration=function(yc){yc=
void 0===yc?Object:yc;var Cc=this,Pb,Dc,Xc,Cd,Od,Gb,sb,Bc,gb,rb,Sa,Ua,cb,ab,qb,Zb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kc){switch(kc.nextAddress){case 1:Pb=Cc;Dc=Pb.System;Xc=Pb.systemModule;Cd=Pb.objectPackage;Od=Kc.string.capitalize(Kc.toJsIdentifier(Cd.id));Gb=yc[Symbol.for("__LivelyClassName__")];sb=!Gb;Bc=Kc.globalClasses.includes(yc);gb="";rb=null;if(sb){Gb="__anonymous_superclass__";Sa={};rb=(Sa[Gb]=yc,Sa);kc.jumpTo(2);break}if(Bc){kc.jumpTo(2);break}return kc.yield(Kc.ExportLookup.findExportOfValue(yc,
Dc),4);case 4:(Ua=kc.yieldResult)?(cb=Kc.ImportInjector.run(Dc,Xc.id,Xc.package(),"",Ua),ab=cb.standaloneImport,gb+=ab+"\n\n"):(qb={},rb=(qb[Gb]=yc,qb));case 2:return Od===Gb&&(Od="Object"+Od),Zb="Object"===Gb?"class "+Od+" {}\n":"class "+Od+" extends "+Gb+" {}\n",gb+="export default "+Zb+"\n",kc.yield(Xc.changeSource(gb),5);case 5:return kc.yield(Xc.load(),6);case 6:return kc.return({source:gb,className:Od,moduleId:Cc.url,bindings:rb})}})};be.prototype.addScript=function(yc,Cc,Pb){var Dc=this,Xc,
Cd,Od,Gb,sb,Bc,gb,rb,Sa,Ua,cb,ab,qb,Zb,kc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rb){switch(Rb.nextAddress){case 1:if(yc.constructor===Dc.objectClass){Xc=yc.constructor;Rb.jumpTo(2);break}return Rb.yield(Dc.ensureObjectClass(yc.constructor),3);case 3:Xc=Rb.yieldResult;case 2:Cd=Xc;Od="function"===typeof Cc?String(Cc):Cc;Gb=Kc.parseFunction(Od);sb=Kc.RuntimeSourceDescriptor.for(Cd,Dc.System);Pb||(Pb=Kc.Path("id.name").get(Gb));if(!Pb)throw Error("No name, cannot add "+Kc.string.truncate(Od,
30).replace(/\n/g,"")+"!");Bc=Kc.toJsIdentifier(Pb);console.assert("FunctionExpression"===Gb.type||"ArrowFunctionExpression"===Gb.type,"not a function expression but: "+Gb.type);gb=Gb.params.map(function(ma){return Od.slice(ma.start,ma.end)});rb="BlockStatement"===Gb.body.type?Od.slice(Gb.body.start,Gb.body.end):"{ return "+Od.slice(Gb.body.start,Gb.body.end)+" }";Sa=Bc+"("+gb.join(",")+") "+rb;"ArrowFunctionExpression"===Gb.type&&(Gb.type="FunctionExpression");Ua=sb.source;cb=sb.ast;if(!cb)throw Error("cannot find class decl of "+
sb.module.id);(ab=cb.body.body.find(function(ma){return ma.key.name===Bc&&!ma.static}))?Ua=Ua.slice(0,ab.start)+Sa+Ua.slice(ab.end):(qb=Ua.lastIndexOf("}"),Zb=Ua.slice(0,qb),kc=Ua.slice(qb),/\n\s*$/m.test(Zb)||(Zb+="\n"),Sa=Kc.string.changeIndent(Sa,"  ",1),/^[ ]*\n/m.test(kc)||(kc="\n"+kc),Ua=Zb+Sa+kc);return Rb.yield(sb.changeSource(Ua),4);case 4:return Rb.return({script:Cd.prototype[Bc],klass:Cd,module:sb.module.id,methodName:Bc})}})};$jscomp.global.Object.defineProperties(be.prototype,{objectPackage:{configurable:!0,
enumerable:!0,get:function(){return this._objectPackage}},objectClass:{configurable:!0,enumerable:!0,get:function(){var yc=this.systemModule;return yc.isLoaded()?yc.System.get(yc.id).default:null}},moduleName:{configurable:!0,enumerable:!0,get:function(){return this._moduleName}},systemModule:{configurable:!0,enumerable:!0,get:function(){return Kc.module(this.System,this.url)}},System:{configurable:!0,enumerable:!0,get:function(){return this.objectPackage.System}},resource:{configurable:!0,enumerable:!0,
get:function(){return this.objectPackage.resource(this.moduleName)}},url:{configurable:!0,enumerable:!0,get:function(){return this.resource.url}}});Kc.ObjectModule=be;Kc.default=Bd}}});