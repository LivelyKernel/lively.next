System.register(["./__root_module__-cd530690.js","kld-intersections","./client-command-9f1fd52c.js"],function(Da){var zb,Rb,kc,dc,ke,hd;return{setters:[function($d){zb=$d.s;Rb=$d._;kc=$d.a5;dc=$d.bE;ke=$d.a6},function(){},function($d){hd=$d.runCommand}],execute:function(){function $d(Za,Cb){var bc,ic,id,fe,Zb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){if(1==rc.nextAddress)return bc=Od.fileInfoCommandString(Za,Cb),ic=Od.runCommand(bc,Cb),rc.yield(ic.whenDone(),2);if(id=0!=
ic.exitCode?ic.output:null)throw id;fe=$jscomp.makeIterator(Od.parseDirectoryListFromLs(ic.stdout,Cb.rootDirectory||"."));Zb=fe.next().value;return rc.return(Zb)})}function md(Za,Cb){return Od.string.lines(Za).map(function(bc){return bc.trim().length?(new Od.FileInfo(Cb)).readFromDirectoryListLine(bc):null}).filter(Boolean)}function Qc(Za,Cb){var bc,ic,id,fe,Zb,rc,Lb,Gc,$c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ed){bc=Object.assign({findFilesGroup:"default-find-files-process"},
Cb);ic=bc.findFilesGroup;id=bc.rootDirectory;Zb=fe=Od.findFilesProcesses[ic]||(Od.findFilesProcesses[ic]={promiseState:null,commands:[]});rc=Zb.commands;Lb=Zb.promiseState;Lb||(fe.promiseState=Lb=Od.promise.deferred());Gc=Od.findFilesCommandString(Za,Cb);rc.forEach(function($b){return $b.kill()});$c=Od.runCommand(Gc,Cb);rc.push($c);$c.whenDone().then(function(){Od.arr.remove(rc,$c);if(rc.some(function(ob){return ob.startTime>$c.startTime}))console.log("[findFiles] command "+$c+" exited but a newer findFiles command was started for group "+
ic+", discarding output");else{var $b=0!=$c.exitCode?$c.output:null;$b&&console.warn($b);$b=$b?[]:Od.parseDirectoryListFromLs($c.stdout,id)||[];Lb.resolve($b);Object.assign(fe,{promiseState:null,commands:[]})}}).catch(function($b){return console.error($b)});return ed.return(Lb.promise)})}function xd(Za){function Cb(bc){return Array.prototype.concat.apply([bc],bc.children?bc.children.map(Cb):[])}return Cb(Za).map(function(bc){var ic=bc.fullPath.replace(/^\//,"");return{fileName:ic,path:ic,rootDirectory:"./",
isDirectory:bc.isDirectory,isLink:void 0,lastModified:void 0,linkCount:void 0,mode:void 0,size:void 0,group:void 0,user:void 0}})}var Od=lively.FreezerRuntime.recorderFor("lively.shell/client-fs-helper.js");Od.fileInfo=$d;Od.fileInfoCommandString=function(Za,Cb){var bc=Cb=void 0===Cb?{}:Cb;Cb=bc.rootDirectory;bc=bc.platform;Cb=Cb||".";var ic="win32"===bc?"\\":"/";"win32"===bc||Cb.endsWith(ic)||(Cb+=ic);return"win32"===bc?"cd "+Cb+' && ls -lLd --time-style=locale "'+Za+'"':'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && env TZ=GMT LANG=en_US.UTF-8 cd '+
(Cb+' && ls -lLd "$timeformat" "'+Za+'"')};Od.parseDirectoryListFromLs=md;Od.findFiles=Qc;Od.findFilesCommandString=function(Za,Cb){var bc=Cb=void 0===Cb?{}:Cb,ic=bc.rootDirectory,id=bc.exclude,fe=bc.depth;bc=bc.platform;ic=ic||".";id=id||"-iname "+Od.defaultExcludes.map(Od.string.print).join(" -o -iname ");var Zb="win32"===bc?"\\":"/";"win32"===bc||ic.endsWith(Zb)||(ic+=Zb);Za=Od.string.format('%s "%s"',Cb.re?"-iregex":Cb.matchPath?"-ipath":"-iname",Za);fe="number"===typeof fe?" -maxdepth "+fe:"";
return"win32"===bc?Od.string.format("find %s %s ( %s ) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd --time-style=locale {}",ic,Cb.re?"-E ":"",id.replace(/"/g,""),Za.replace(/"/g,""),fe):'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && '+Od.string.format('env TZ=GMT LANG=en_US.UTF-8 find %s %s \\( %s \\) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd "$timeformat" "{}"',ic,Cb.re?"-E ":"",id,Za,fe)};Od.convertDirectoryUploadEntriesToFileInfos=
xd;Od.runCommand=hd;Od.string=zb;Od.promise=Rb;Od.arr=kc;Od.fileInfo=$d;Od.fileInfo=$d;Od.parseDirectoryListFromLs=md;Od.parseDirectoryListFromLs=md;var ge=function(Za){this.rootDirectory=Za;this.fileName=this.path="";this.isDirectory=!1;this.lastModified=null;this.mode="";this.isLink=!1;this.linkCount=0;this.group=this.user="";this.size=0;this.rootDirectory=null};ge.prototype.readFromDirectoryListLine=function(Za){var Cb=this;if(!Za.trim().length)return null;var bc=Za;this.reader.forEach(function(ic){return bc=
ic(bc,Cb)});return this};ge.prototype.toString=function(){return this.path};$jscomp.global.Object.defineProperties(ge.prototype,{reader:{configurable:!0,enumerable:!0,get:function(){return[function(Za,Cb){var bc=Za.indexOf(" ");Cb.mode=Za.slice(0,bc);Cb.isDirectory="d"===Cb.mode[0];return Za.slice(bc+1).trim()},function(Za,Cb){var bc=Za.indexOf(" ");Cb.linkCount=Number(Za.slice(0,bc));return Za.slice(bc+1).trim()},function(Za,Cb){var bc=Za.indexOf(" ");Cb.user=Za.slice(0,bc);return Za.slice(bc+1).trim()},
function(Za,Cb){var bc=Od.string.peekRight(Za,0,/\s+[0-9]/);Cb.group=Za.slice(0,bc).trim();return Za.slice(bc).trim()},function(Za,Cb){var bc=Za.indexOf(" ");Cb.size=Number(Za.slice(0,bc));return Za.slice(bc+1).trim()},function(Za,Cb){var bc=Od.string.reMatches(Za,/[^s]+\s+[0-9:\s]+/);if(!bc||!bc[0])return Za;Cb.lastModified=new Date(bc[0].match+" GMT");return Za.slice(bc[0].end).trim()},function(Za,Cb){var bc=(Za=Za.replace(/^\.\/+/g,"").replace(/\/\//g,"/"))&&Za.split(" -> "),ic=""===Za?!1:Za&&
2===bc.length,id=(bc=ic?bc[0]:Za)&&0===bc.indexOf(Cb.rootDirectory)?bc.slice(Cb.rootDirectory.length):bc;Cb.fileName=""===Za?".":id;Cb.path=bc;Cb.isLink=ic;return id}]}}});Od.FileInfo=ge;Od.findFilesProcesses={};Od.findFiles=Qc;Od.findFiles=Qc;Od.defaultExcludes=[".svn",".git","node_modules",".module_cache"];Od.convertDirectoryUploadEntriesToFileInfos=xd;Od.convertDirectoryUploadEntriesToFileInfos=xd;var Ud=lively.FreezerRuntime.recorderFor("lively.shell/client-resource.js");Ud.Resource=dc;Ud.runCommand=
hd;Ud.fileInfo=$d;Ud.findFiles=Qc;Ud.string=zb;Ud.promise=Rb;Ud.arr=kc;Ud.obj=ke;ge=function(Za,Cb,bc){bc=void 0===bc?{}:bc;Za=Ud.Resource.call(this,Za)||this;Za.options=Object.assign({},bc,{l2lClient:Cb||Za.constructor.defaultL2lClient});return Za};$jscomp.inherits(ge,Ud.Resource);ge.prototype.newResource=function(Za){return new this.constructor(Za,this.options.l2lClient,this.options)};ge.prototype.read=function(){var Za=this,Cb=Ud.runCommand('cat "'+this.url+'"',this.options);return Cb.whenDone().then(function(){if(Cb.exitCode)throw Error("Read "+
Za.url+" failed: "+Cb.stderr);return Cb.output})};ge.prototype.write=function(Za){var Cb=this,bc,ic;return $jscomp.asyncExecutePromiseGeneratorProgram(function(id){switch(id.nextAddress){case 1:return Za?id.yield(Ud.runCommand('touch "'+Cb.url+'" && tee "'+Cb.url+'"',Object.assign({stdin:String(Za)},Cb.options)).whenDone(),4):id.yield(Ud.runCommand('echo -n > "'+Cb.url+'"',Object.assign({},Cb.options)).whenDone(),5);case 4:bc=id.yieldResult;id.jumpTo(3);break;case 5:bc=id.yieldResult;case 3:ic=bc;
if(ic.exitCode)throw Error("Write "+Cb.url+" failed: "+ic.stderr);return id.return(Cb)}})};ge.prototype.mkdir=function(){var Za=this,Cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(bc){if(1==bc.nextAddress)return bc.yield(Ud.runCommand('mkdir -p "'+Za.url+'"',Za.options).whenDone(),2);Cb=bc.yieldResult;if(Cb.exitCode)throw Error(Za+" cannot create directory: "+Cb.stderr);return bc.return(Za)})};ge.prototype.exists=function(){var Za=Ud.runCommand('test -d "'+this.url+'" || test -f "'+
this.url+'"',this.options);return Za.whenDone().then(function(){return 0===Za.exitCode})};ge.prototype.remove=function(){var Za=this,Cb=Ud.runCommand('rm -rf "'+this.url+'"',this.options);return Cb.whenDone().then(function(){if(Cb.exitCode)throw Error("Remove of "+Za.url+" failed: "+Cb.stderr);return Za})};ge.prototype.gzip=function(Za){var Cb=this,bc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ic){bc=Ud.runCommand('gzip > "'+Cb.url+'"',Object.assign({stdin:String(Za)},Cb.options));
return ic.return(bc.whenDone().then(function(){if(bc.exitCode)throw Error("Gzip compression of "+Cb.url+" failed: "+bc.stderr);return Cb}))})};ge.prototype.brotli=function(Za){var Cb=this,bc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ic){bc=Ud.runCommand('brotli > "'+Cb.url+'"',Object.assign({stdin:String(Za)},Cb.options));return ic.return(bc.whenDone().then(function(){if(bc.exitCode)throw Error("Brotli compression of "+Cb.url+" failed: "+bc.stderr);return Cb}))})};ge.prototype.readProperties=
function(){var Za=this,Cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(bc){if(1==bc.nextAddress)return bc.yield(Ud.fileInfo(Za.url,Za.options),2);Cb=bc.yieldResult;Za.assignProperties(Ud.obj.dissoc(Cb,["fileName","path","rootDirectory"]));return bc.return(Za)})};ge.prototype.dirList=function(Za,Cb){Za=void 0===Za?1:Za;Cb=void 0===Cb?{}:Cb;var bc=this,ic,id,fe,Zb,rc,Lb,Gc;return $jscomp.asyncExecutePromiseGeneratorProgram(function($c){if(1==$c.nextAddress)return ic=Cb,id=ic.exclude,
Array.isArray(id)&&(id="-iname "+id.map(Ud.string.print).join(" -o -iname ")),fe=bc,Zb=fe.url,rc=fe.options,Lb=rc.l2lClient,$c.yield(Ud.findFiles("*",{exclude:id,depth:Za,rootDirectory:Zb,l2lClient:Lb}),2);Gc=$c.yieldResult;Gc[0].path.replace(/\/$/,"")===bc.url.replace(/\/$/,"")&&Gc.shift();return $c.return(Gc.map(function(ed){var $b=ed.path;ed.isDirectory&&($b=$b.replace(/\/?$/,"/"));$b=new bc.constructor($b,Lb,bc.options);$b.assignProperties(Ud.obj.dissoc(ed,["fileName","path","rootDirectory"]));
return $b}))})};$jscomp.global.Object.defineProperties(ge,{defaultL2lClient:{configurable:!0,enumerable:!0,get:function(){return this._defaultL2lClient||Ud._defaultL2LClient},set:function(Za){this._defaultL2lClient=Ud._defaultL2LClient=Za}}});Da("default",ge);Ud.ShellClientResource=ge;Ud._defaultL2LClient=Ud._defaultL2LClient||void 0;var nd=Da("resourceExtension",{name:"shell-client",matches:function(Za){return Za.startsWith("/")||Za.match(/[a-z]:\\/i)},resourceClass:Ud.ShellClientResource});Ud.resourceExtension=
nd;Ud.resourceExtension=nd;Ud.resourceExtension=nd;Ud.default=ge}}});