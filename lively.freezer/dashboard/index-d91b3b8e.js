System.register(["./__root_module__-cddb8267.js","kld-intersections"],function(Ea){var Cb,Kb,lc,$b,Qd,Zc,Rd,ad,Nc,nd,he,af,Af;return{setters:[function(rd){Cb=rd.bu;Kb=rd.a6;lc=rd.r;$b=rd.a8;Qd=rd.$;Zc=rd.bv;Rd=rd.bw;ad=rd.T;Nc=rd.a7;nd=rd.bx;he=rd.by;af=rd.l;Af=rd.bz},function(){}],execute:function(){function rd(ma){try{var Ia=eval("("+Bc.ast.transform.wrapInFunction("var _; _ = ("+ma+")")+")()")}catch(W){return JSON.parse(ma)}return"object"!==typeof Ia?null:Ia}function cc(ma,Ia){var W,sa,Za,
mb,rc,xd,sc,Na,Xd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gd){switch(Gd.nextAddress){case 1:return W=Ia.world(),Gd.yield(W.prompt("Enter package name",{requester:Ia,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:sa=Gd.yieldResult;if(!sa)throw"Canceled";Gd.setCatchFinallyBlocks(3);mb=gb.resource(sa);sa=mb.name();Za=mb.url;Gd.leaveTryBlock(4);break;case 3:return Gd.enterCatchBlock(),Gd.yield(ma.getConfig(),5);case 5:return rc=Gd.yieldResult.baseURL,
xd=gb.resource(rc).join(sa).asDirectory().url,Gd.yield(ma.normalize(xd),6);case 6:Za=Gd.yieldResult.replace(/\/\.js$/,"/");case 4:return Gd.yield(W.prompt("Confirm or change package location",{requester:Ia,input:Za,historyId:"lively.vm-editor-add-package-address"}),7);case 7:sc=Gd.yieldResult;if(!sc)throw"Canceled";Na=gb.resource(sc).asDirectory();Xd=Na.asFile().url;return Gd.yield(ma.removePackage(Xd),8);case 8:return Gd.yield(ma.resourceCreateFiles(Xd,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+
sa+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+sa+"\n\nNo description for package "+sa+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+sa+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return Gd.return(gb.loadPackage(ma,{name:sa,address:Xd,configFile:Na.join("package.json").url,main:Na.join("index.js").url,test:Na.join("tests/test.js").url,type:"package"}))}})}function Ic(ma,Ia,W){W=void 0===W?
null:W;var sa,Za,mb,rc,xd,sc,Na;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xd){switch(Xd.nextAddress){case 1:return sa={name:"",address:"",type:"package"},Xd.yield(ma.getConfig(),2);case 2:Za=Xd.yieldResult;if(!W){Xd.jumpTo(3);break}return Xd.yield(ma.getPackage(W),4);case 4:if(mb=Xd.yieldResult){Xd.jumpTo(5);break}return Xd.yield(ma.getPackageForModule(W),6);case 6:mb=Xd.yieldResult;case 5:rc=mb;case 3:return Xd.yield(Ia.world().prompt("What is the package directory?",{requester:Ia,
input:rc?rc.address:Za.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:xd=Xd.yieldResult;if(!xd)throw"Canceled";sa.address=xd.replace(/\/$/,"");sa.url=new URL(sa.address+"/");sa.configFile=gb.resource(sa.url).join("package.json").url;Xd.setCatchFinallyBlocks(8);sc=JSON;Na=sc.parse;return Xd.yield(ma.moduleRead(sa.configFile),10);case 10:Na.call(sc,Xd.yieldResult).name;Xd.leaveTryBlock(9);break;case 8:Xd.enterCatchBlock(),sa.name=String(sa.url).replace(/\/$/,""),
ma.resourceEnsureExistance(sa.configFile,'{\n  "name": "'+sa.name+'",\n  "version": "0.1.0"\n}');case 9:return Xd.return(gb.loadPackage(ma,sa))}})}function Kd(ma,Ia,W){var sa,Za,mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){switch(rc.nextAddress){case 1:return sa=gb.resource(W).asFile().url,rc.yield(ma.getPackage(sa),2);case 2:if(Za=rc.yieldResult){rc.jumpTo(3);break}return rc.yield(ma.getPackageForModule(sa),4);case 4:Za=rc.yieldResult;case 3:mb=Za;if(!mb)throw Error("Cannot find package for "+
sa);return rc.yield(ma.reloadPackage(sa),5);case 5:if(!Ia){rc.jumpTo(0);break}return rc.yield(Ia.updateModuleList(),7);case 7:return rc.yield(Ia.uiSelect(sa,!1),8);case 8:return rc.return(rc.yieldResult)}})}function Kc(ma,Ia,W,sa){var Za,mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){switch(rc.nextAddress){case 1:return rc.yield(ma.getPackage(W),2);case 2:return Za=rc.yieldResult,rc.yield((sa||$world).confirm("Unload package "+Za.name+"?",{requester:Ia}),3);case 3:mb=rc.yieldResult;
if(!mb)throw"Canceled";return rc.yield(ma.removePackage(W),4);case 4:if(!Ia){rc.jumpTo(0);break}return rc.yield(Ia.updateModuleList(),6);case 6:return rc.yield(Ia.uiSelect(null),0)}})}function Bd(ma,Ia,W){var sa,Za,mb,rc,xd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sc){switch(sc.nextAddress){case 1:return sa=Ia.world(),sc.yield(ma.getPackage(W),2);case 2:return Za=sc.yieldResult,Za?sc.yield(sa.confirm("Really remove package "+Za.name+"?",{requester:Ia}),3):($world.inform('No package "'+
W+'" found!',{requester:Ia}),sc.return());case 3:mb=sc.yieldResult;if(!mb)throw"Canceled";ma.removePackage(W);return sc.yield(sa.confirm("Also remove directory "+Za.name+" including "+Za.modules.length+" modules?"),4);case 4:rc=sc.yieldResult;if(!rc){sc.jumpTo(0);break}return sc.yield(sa.confirm("REALLY *remove* directory "+Za.name+"? No undo possible..."),6);case 6:if(xd=sc.yieldResult)return sc.yield(ma.resourceRemove(Za.address),0);sc.jumpTo(0)}})}function be(ma,Ia,W){W=void 0===W?$world:W;var sa,
Za,mb,rc,xd,sc,Na,Xd,Gd,td,Ib;return $jscomp.asyncExecutePromiseGeneratorProgram(function(jc){switch(jc.nextAddress){case 1:return jc.yield(ma.getPackage(Ia),2);case 2:sa=jc.yieldResult;if(!sa)throw Error("Cannot find package "+Ia);Za=[];mb=$jscomp.makeIterator(sa.modules);rc=mb.next();case 3:if(rc.done)return jc.yield(W.execCommand("open text window",{title:"imports and exports of "+Ia,content:Za.join("\n\n")}),0);xd=rc.value;if(!xd.name.match(/\.js$/)){jc.jumpTo(4);break}jc.setCatchFinallyBlocks(6);
sc=ma;Na=sc.importsAndExportsOf;Xd=xd.name;return jc.yield(ma.moduleRead(xd.name),9);case 9:return jc.yield(Na.call(sc,Xd,jc.yieldResult),8);case 8:Gd=jc.yieldResult;jc.leaveTryBlock(7);break;case 6:td=jc.enterCatchBlock();W.logError(Error("Error when getting imports/exports from module "+xd.name+":\n"+td.stack));jc.jumpTo(4);break;case 7:Ib=""+xd.name;if(!Gd.imports.length&&!Gd.exports.length){Ib+="\n  does not import / export anything";jc.jumpTo(4);break}Gd.imports.length&&(Ib+="\n  imports:\n",
Ib+=gb.arr.groupByKey(Gd.imports,"fromModule").mapGroups(function(tb,Sc){return"from "+tb+": "+Sc.map(function(vd){return vd.local||vd.imported?vd.imported&&vd.imported!==vd.local?vd.imported+" as "+vd.local:vd.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(tb){return"    "+tb}).join("\n"));Gd.exports.length&&(Ib+="\n  exports:\n",Ib+=Gd.exports.map(function(tb){return tb.local?tb.local&&tb.local!==tb.exported?tb.local+" as "+tb.exported:tb.exported:tb.exported+
" from "+tb.fromModule}).join(", ").split("\n").map(function(tb){return"    "+tb}).join("\n"));Za.push(Ib);case 4:rc=mb.next(),jc.jumpTo(3)}})}function yc(ma){return ma.match(/import.*['"]mocha(-es6)?['"]/)&&ma.match(/it\(['"]/)}function Cc(ma,Ia,W){W=W&&W.address;if(W&&0===Ia.indexOf(W))var sa=Ia.slice(W.length).replace(/^\//,"");else a:{W=ma.getConfig();if(!W||W.constructor!==Promise)try{sa=String((new rb.URL(Ia)).relativePathFrom(new rb.URL(ma.getConfig().baseURL)));break a}catch(Za){}sa=Ia}return sa}
function Pb(ma,Ia,W,sa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Za){return 1==Za.nextAddress?(sa=Object.assign({targetModule:Ia},sa),Za.yield(ma.normalize(Ia),2)):3!=Za.nextAddress?(Ia=Za.yieldResult,Za.yield(ma.moduleSourceChange(Ia,W,sa),3)):Za.return(Ia)})}function Dc(ma,Ia,W,sa,Za){sa=void 0===sa?!1:sa;Za=void 0===Za?!1:Za;var mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){switch(rc.nextAddress){case 1:return Ia&&Ia.setStatusMessage("Reloading "+W),rc.setCatchFinallyBlocks(2),
rc.yield(ma.reloadModule(W,{reloadDeps:sa,resetEnv:Za}),4);case 4:if(!Ia){rc.jumpTo(5);break}return rc.yield(Ia.updateModuleList(),6);case 6:case 5:Ia&&Ia.setStatusMessage("Reloded "+W);rc.leaveTryBlock(0);break;case 2:mb=rc.enterCatchBlock();rc.setCatchFinallyBlocks(7);if(!Ia){rc.jumpTo(9);break}return rc.yield(Ia.updateEditorWithSourceOf(W),10);case 10:case 9:rc.leaveTryBlock(8);break;case 7:rc.enterCatchBlock();case 8:throw Ia&&Ia.showError(mb),mb;}})}function Xc(ma,Ia,W){return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){switch(sa.nextAddress){case 1:return sa.yield(ma.forgetModule(W,
{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!Ia){sa.jumpTo(3);break}return sa.yield(Ia.updateModuleList(),4);case 4:case 3:sa.jumpToEnd()}})}function Cd(ma,Ia,W){var sa,Za,mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){switch(rc.nextAddress){case 1:return rc.yield(ma.normalize(W),2);case 2:return sa=rc.yieldResult,rc.yield(Ia.world().confirm("Remove file "+sa+"?",{requester:Ia}),3);case 3:Za=rc.yieldResult;if(!Za)throw"Canceled";return rc.yield(ma.forgetModule(sa),4);case 4:return rc.yield(ma.resourceRemove(sa),
5);case 5:return rc.yield(ma.getPackageForModule(sa),6);case 6:return mb=rc.yieldResult,rc.return(mb)}})}function Od(ma,Ia,W){var sa,Za,mb,rc,xd,sc,Na,Xd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gd){switch(Gd.nextAddress){case 1:return sa=rb.URL,Gd.yield(ma.getConfig(),2);case 2:Za=new sa(Gd.yieldResult.baseURL);mb=Ia.world();if(!W){Gd.jumpTo(3);break}return Gd.yield(ma.getPackage(W),4);case 4:if(rc=Gd.yieldResult){Gd.jumpTo(5);break}return Gd.yield(ma.getPackageForModule(W),6);
case 6:rc=Gd.yieldResult;case 5:(xd=rc)&&(Za=new rb.URL(xd.address));case 3:return Gd.yield(rb._searchForExistingFiles(Ia,String(Za),xd),7);case 7:sc=Gd.yieldResult;if(!sc.includes("[create new module]")){Gd.jumpTo(8);break}return Gd.yield(rb._askForModuleName(ma,W||String(Za),mb),9);case 9:Na=Gd.yieldResult,sc=[Na];case 8:return Gd.yield(rb._createAndLoadModules(ma,sc),10);case 10:return Xd=Gd.yieldResult,rb.arr.compact(Xd.map(function(td){return td.error})),Gd.return(Xd)}})}function Gb(ma,Ia){var W,
sa,Za,mb,rc,xd,sc,Na,Xd,Gd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(td){if(1==td.nextAddress)return td.yield(ma.getPackage(Ia),2);if(3!=td.nextAddress){W=td.yieldResult;if(!W||!W.address.match(/^http/))throw Error("Cannot load package "+Ia);sa=rb.resource(W.address);Za=[];mb=$jscomp;rc=mb.makeIterator;return td.yield(sa.dirList(5,{exclude:rb.modulesInPackage_defaultExclude}),3)}xd=rc.call(mb,td.yieldResult);for(sc=xd.next();!sc.done;sc=xd.next())Xd=Na=sc.value,Gd=Xd.url,Gd.match(/\.js$/)&&
ma.isModuleLoaded(Gd,!0)&&Za.push(ma.getModule(Gd));return td.return(Za)})}function sb(ma){ma||(ma="local");if(ma.isSystemInterface)var Ia=ma;else"string"===typeof ma&&ma.startsWith("l2l ")&&(ma={type:"l2l",id:ma.split(" ")[1]}),"string"!==typeof ma&&"l2l"===ma.type&&(Ia=Rb.l2lInterfaceFor(ma.id,ma.info)),"string"!==typeof ma&&($world.setStatusMessage("Unknown system interface "+ma),ma="local"),Ia||(Ia=ma&&"local"!==ma?Rb.serverInterfaceFor(ma):Rb.localInterface);return Ia}Ea("systemInterfaceNamed",
sb);var Bc=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");Bc.parseJsonLikeObj=rd;Bc.ast=Cb;Bc.parseJsonLikeObj=rd;Bc.parseJsonLikeObj=rd;var gb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");gb.loadPackage=function(ma,Ia){var W,sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Za){switch(Za.nextAddress){case 1:return Za.yield(ma.importPackage(Ia.address+"/"),2);case 2:if(!Ia.main){Za.jumpTo(3);break}return Za.yield(ma.importModule(Ia.main.toString()),
3);case 3:if(!Ia.test){Za.jumpTo(5);break}Za.setCatchFinallyBlocks(6);return Za.yield(ma.importPackage("mocha-es6"),8);case 8:return W=Za.yieldResult,Za.yield(W.installSystemInstantiateHook(),9);case 9:return Za.yield(ma.importModule(Ia.test.toString()),10);case 10:Za.leaveTryBlock(5);break;case 6:sa=Za.enterCatchBlock(),console.warn("Cannot load test of new package: "+sa);case 5:return Za.return(ma.getPackage(Ia.address))}})};gb.interactivelyCreatePackage=cc;gb.interactivelyLoadPackage=Ic;gb.interactivelyReloadPackage=
Kd;gb.interactivelyUnloadPackage=Kc;gb.interactivelyRemovePackage=Bd;gb.showExportsAndImportsOf=be;gb.parseJsonLikeObj=rd;gb.arr=Kb;gb.resource=lc;gb.interactivelyCreatePackage=cc;gb.interactivelyCreatePackage=cc;gb.interactivelyLoadPackage=Ic;gb.interactivelyLoadPackage=Ic;gb.interactivelyReloadPackage=Kd;gb.interactivelyReloadPackage=Kd;gb.interactivelyUnloadPackage=Kc;gb.interactivelyUnloadPackage=Kc;gb.interactivelyRemovePackage=Bd;gb.interactivelyRemovePackage=Bd;gb.showExportsAndImportsOf=be;
gb.showExportsAndImportsOf=be;var rb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");rb.isTestModule=yc;rb.shortModuleName=Cc;rb.interactivelyChangeModule=Pb;rb.interactivelyReloadModule=Dc;rb.interactivelyUnloadModule=Xc;rb.interactivelyRemoveModule=Cd;rb.interactivelyAddModule=Od;rb._askForModuleName=function(ma,Ia,W){var sa,Za;return $jscomp.asyncExecutePromiseGeneratorProgram(function(mb){switch(mb.nextAddress){case 1:return mb.yield(W.prompt("Enter module name",
{input:Ia,historyId:"lively.vm-editor-add-module-name"}),2);case 2:Ia=mb.yieldResult;if(!Ia)throw"Canceled";return mb.yield(ma.normalize(Ia),3);case 3:return sa=mb.yieldResult,mb.yield(W.confirm(["Create module \n",{},sa,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:Za=mb.yieldResult;if(!Za)throw"Canceled";return mb.return(sa)}})};rb._searchForExistingFiles=function(ma,Ia,W){return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){return String(Ia).match(/^http/)?sa.return(rb._searchForExistingFilesWeb(ma,
Ia,W)):sa.return(rb._searchForExistingFilesManually(ma,Ia,W))})};rb._searchForExistingFilesManually=function(ma,Ia,W){var sa,Za;return $jscomp.asyncExecutePromiseGeneratorProgram(function(mb){switch(mb.nextAddress){case 1:return mb.yield(ma.world().multipleChoicePrompt("Add Module",{requester:ma,choices:["Create New Module","Load Existing Module"]}),2);case 2:sa=mb.yieldResult;if("Create New Module"===sa)return mb.return("[create new module]");if("Load Existing Module"!==sa){mb.jumpTo(3);break}return mb.yield(ma.world().prompt("URL of module?",
{input:Ia,requester:ma,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),4);case 4:if(Za=mb.yieldResult)return mb.return([Za]);case 3:throw"Canceled";}})};rb._searchForExistingFilesWeb=function(ma,Ia,W){function sa(Xd){Xd.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(Xd.name())||W&&rb.arr.pluck(W.modules,"name").includes(Xd.url)?!0:!1}var Za,mb,rc,xd,sc,Na;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xd){switch(Xd.nextAddress){case 1:return(Za=
ma.world())&&(mb=Za.showLoadingIndicatorFor(ma,"Loading existing modules...")),Xd.yield(rb.resource(Ia).dirList(5,{exclude:sa}),3);case 3:return Xd.yield(Xd.yieldResult.map(function(Gd){return Gd.url}),2);case 2:return rc=Xd.yieldResult,xd=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(rc.filter(function(Gd){return Gd.endsWith(".js")}).map(function(Gd){return{isListItem:!0,string:W&&0==Gd.indexOf(W.address)?W.name+Gd.slice(W.address.length):Gd,value:Gd}})),Xd.yield(Promise.resolve(mb&&
mb.remove()).then(function(){return ma.world().filterableListPrompt("What module to load?",xd,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:ma},ma?{extent:ma.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:sc=Xd.yieldResult;if(!sc||"canceled"===sc.status||!sc.selected.length)throw"Canceled";Na=sc.selected||sc;Array.isArray(Na)||(Na=[Na]);return Xd.return(Na)}})};rb._createAndLoadModules=function(ma,Ia){var W,sa,Za,mb,rc,xd,sc,Na;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xd){switch(Xd.nextAddress){case 1:Array.isArray(Ia)||
(Ia=[Ia]),W=[],sa=$jscomp.makeIterator(Ia),Za=sa.next();case 2:if(Za.done){Xd.jumpTo(4);break}mb=Za.value;return Xd.yield(ma.forgetModule(mb,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return Xd.yield(ma.resourceEnsureExistance(mb,'"format esm";\n'),6);case 6:return rc=Xd.yieldResult,xd=rb,sc=xd.isTestModule,Xd.yield(rc.read(),7);case 7:if(!sc.call(xd,Xd.yieldResult)){Xd.jumpTo(8);break}if(window.Mocha&&window.chai){Xd.jumpTo(8);break}return Xd.yield(System.import("mocha-es6"),10);case 10:return Xd.yield(rb.promise.waitFor(function(){return!!window.Mocha&&
!!window.chai}),8);case 8:return Xd.setCatchFinallyBlocks(12),Xd.yield(ma.importModule(mb),14);case 14:W.push({name:mb});Xd.leaveTryBlock(3);break;case 12:Na=Xd.enterCatchBlock(),W.push({name:mb,error:Na});case 3:Za=sa.next();Xd.jumpTo(2);break;case 4:return Xd.return(W)}})};rb.modulesInPackage_defaultExclude=function(ma){return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(ma.name())?!0:!1};rb.modulesInPackage=Gb;rb.obj=$b;rb.promise=Qd;rb.arr=Kb;rb.resource=lc;rb.isTestModule=
yc;rb.isTestModule=yc;rb.shortModuleName=Cc;rb.shortModuleName=Cc;rb.interactivelyChangeModule=Pb;rb.interactivelyChangeModule=Pb;rb.interactivelyReloadModule=Dc;rb.interactivelyReloadModule=Dc;rb.interactivelyUnloadModule=Xc;rb.interactivelyUnloadModule=Xc;rb.interactivelyRemoveModule=Cd;rb.interactivelyRemoveModule=Cd;rb.interactivelyAddModule=Od;rb.interactivelyAddModule=Od;rb.modulesInPackage=Gb;rb.modulesInPackage=Gb;var Sa=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");
Sa.todo=function(ma){throw Error(ma+" is not yet implemented!");};Sa.parseJsonLikeObj=rd;Sa.arr=Kb;Sa.Closure=Zc;Sa.obj=$b;Sa.resource=lc;Sa.transform=Rd;Sa.modules=ad;var Ua=function(){};Ua.prototype.dynamicCompletionsForPrefix=function(ma,Ia,W){return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){Sa.todo("dynamicCompletionsForPrefix");sa.jumpToEnd()})};Ua.prototype.runEval=function(ma,Ia){Sa.todo("runEval")};Ua.prototype.resourceExists=function(ma){Sa.todo("resourceExists")};Ua.prototype.resourceEnsureExistance=
function(ma,Ia){Sa.todo("resourceEnsureExistance")};Ua.prototype.resourceMkdir=function(ma){Sa.todo("resourceMkdir")};Ua.prototype.resourceRead=function(ma){Sa.todo("resourceRead")};Ua.prototype.resourceRemove=function(ma){Sa.todo("resourceRemove")};Ua.prototype.resourceWrite=function(ma,Ia){Sa.todo("resourceWrite")};Ua.prototype.resourceCreateFiles=function(ma,Ia){Sa.todo("resourceCreateFiles")};Ua.prototype.resourceDirList=function(ma,Ia,W){Sa.todo("resourceDirList")};Ua.prototype.normalizeSync=
function(ma,Ia,W){Sa.todo("normalizeSync")};Ua.prototype.normalize=function(ma,Ia,W){Sa.todo("normalize")};Ua.prototype.printSystemConfig=function(){Sa.todo("printSystemConfig")};Ua.prototype.getConfig=function(){Sa.todo("getConfig")};Ua.prototype.setConfig=function(ma){Sa.todo("setConfig")};Ua.prototype.getPackages=function(ma){Sa.todo("getPackages")};Ua.prototype.isModuleLoaded=function(ma,Ia){Sa.todo("isModuleLoaded")};Ua.prototype.doesModuleExist=function(ma,Ia){Sa.todo("doesModuleExist")};Ua.prototype.getModules=
function(){var ma=this,Ia,W;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){return 1==sa.nextAddress?(Ia=Sa.arr,W=Ia.flatmap,sa.yield(ma.getPackages(),2)):sa.return(W.call(Ia,sa.yieldResult,function(Za){return Za.modules}))})};Ua.prototype.getModule=function(ma){var Ia=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(W){return 1==W.nextAddress?W.yield(Ia.getModules(),2):W.return(W.yieldResult.find(function(sa){return sa.name===ma}))})};Ua.prototype.getPackage=function(ma){var Ia=
this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(W){return 1==W.nextAddress?(ma=ma.replace(/\/+$/,""),W.yield(Ia.getPackages(),2)):W.return(W.yieldResult.find(function(sa){return sa.address===ma||sa.name===ma}))})};Ua.prototype.getPackageForModule=function(ma){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){Sa.todo("getPackageForModule");Ia.jumpToEnd()})};Ua.prototype.systemConfChange=function(ma){var Ia=Sa.parseJsonLikeObj(ma);["baseURL"].forEach(function(W){return delete Ia[W]});
return this.setConfig(Ia)};Ua.prototype.resourcesOfPackage=function(ma,Ia){return $jscomp.asyncExecutePromiseGeneratorProgram(function(W){Sa.todo("resourcesOfPackage");W.jumpToEnd()})};Ua.prototype.registerPackage=function(ma){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){Sa.todo("registerPackage");Ia.jumpToEnd()})};Ua.prototype.importPackage=function(ma){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){Sa.todo("importPackage");Ia.jumpToEnd()})};Ua.prototype.removePackage=
function(ma){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){Sa.todo("removePackage");Ia.jumpToEnd()})};Ua.prototype.reloadPackage=function(ma){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){Sa.todo("reloadPackage");Ia.jumpToEnd()})};Ua.prototype.packageConfChange=function(ma,Ia){return $jscomp.asyncExecutePromiseGeneratorProgram(function(W){Sa.todo("packageConfChange");W.jumpToEnd()})};Ua.prototype.importModule=function(ma){Sa.todo("importModule")};Ua.prototype.forgetModule=
function(ma,Ia){Sa.todo("forgetModule")};Ua.prototype.reloadModule=function(ma,Ia){Sa.todo("reloadModule")};Ua.prototype.moduleFormat=function(ma){Sa.todo("moduleFormat")};Ua.prototype.moduleRead=function(ma){Sa.todo("moduleRead")};Ua.prototype.moduleSourceChange=function(ma,Ia,W){Sa.todo("moduleSourceChange")};Ua.prototype.importsAndExportsOf=function(ma,Ia){Sa.todo("importsAndExportsOf")};Ua.prototype.keyValueListOfVariablesInModule=function(ma,Ia){Sa.todo("keyValueListOfVariablesInModule")};Ua.prototype.moduleWrite=
function(ma,Ia){return this.moduleSourceChange(ma,Ia)};Sa.AbstractCoreInterface=Ua;var cb=function(){var ma=Sa.AbstractCoreInterface.call(this)||this;ma.currentEval=null;return ma};$jscomp.inherits(cb,Sa.AbstractCoreInterface);cb.prototype.runEval=function(ma,Ia){throw Error("Not yet implemented");};cb.prototype.runEvalAndStringify=function(ma,Ia){var W=this;return this.currentEval?this.currentEval.then(function(){return W.runEvalAndStringify(ma,Ia)}):this.currentEval=Promise.resolve().then(function(){var sa,
Za,mb,rc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xd){switch(xd.nextAddress){case 1:return xd.yield(W.runEval("\n        Promise.resolve((async "+Sa.transform.wrapInFunction(ma)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},Ia)),2);case 2:if((sa=xd.yieldResult)&&sa.isError)throw Error(String(sa.value||sa.error));if(!sa||!sa.value)return xd.return(null);if(Za=sa.promisedValue){xd.jumpTo(3);break}return xd.yield(sa.value,4);case 4:Za=xd.yieldResult;case 3:mb=Za;if(!mb)return xd.return();if("undefined"===mb)return xd.return(void 0);if("null"===mb)return xd.return(null);if("true"===mb)return xd.return(!0);
if("false"===mb)return xd.return(!1);try{rc=JSON.parse(mb)}catch(sc){return xd.return(mb)}if(rc&&rc.isError)throw Error(String(rc.value));return xd.return(rc)}})}).then(function(sa){delete W.currentEval;return sa},function(sa){delete W.currentEval;return Promise.reject(sa)})};cb.prototype.dynamicCompletionsForPrefix=function(ma,Ia,W){var sa=this,Za,mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){Za=Sa.obj.isString(W.context)?W.context:!1;W=Sa.obj.dissoc(W,["systemInterface","System",
"context"]);mb="\n      var prefix = "+JSON.stringify(Ia)+",\n          opts = "+JSON.stringify(W)+";\n      opts.context = "+Za+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return rc.return(sa.runEvalAndStringify(mb))})};cb.prototype.evalWithResource=function(ma,Ia,W){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+ma+'").'+Ia+"("+(W?JSON.stringify(W):"")+");\n    ")};cb.prototype.resourceExists=function(ma){return this.evalWithResource(ma,"exists")};cb.prototype.resourceEnsureExistance=function(ma,Ia){return this.evalWithResource(ma,
"ensureExistance",Ia)};cb.prototype.resourceMkdir=function(ma){return this.evalWithResource(ma,"mkdir")};cb.prototype.resourceRead=function(ma){return this.evalWithResource(ma,"read")};cb.prototype.resourceRemove=function(ma){return this.evalWithResource(ma,"remove")};cb.prototype.resourceWrite=function(ma,Ia){return this.evalWithResource(ma,"write",Ia)};cb.prototype.resourceCreateFiles=function(ma,Ia){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
ma+'", '+JSON.stringify(Ia)+")")};cb.prototype.resourceDirList=function(ma,Ia,W){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+ma+'").dirList('+JSON.stringify(Ia)+", "+JSON.stringify(W)+"))\n        .map(({url}) => ({url}))")};cb.prototype.livelySystemAccessor=function(ma){ma=void 0===ma?"livelySystem":ma;return"var "+ma+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
ma+') throw new Error("lively-system-interface not available!");'};cb.prototype.normalizeSync=function(ma,Ia,W){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(ma)+", "+JSON.stringify(Ia)+", "+W+")")};cb.prototype.normalize=function(ma,Ia,W){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(ma)+", "+JSON.stringify(Ia)+", "+JSON.stringify(W)+")")};cb.prototype.printSystemConfig=function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")};
cb.prototype.getConfig=function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')};cb.prototype.setConfig=function(ma){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(ma)+")")};cb.prototype.getPackages=function(ma){ma=Object.assign({excluded:[]},ma);ma.excluded=ma.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(ma)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')};cb.prototype.getPackageForModule=function(ma){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(ma)+")")};cb.prototype.isModuleLoaded=function(ma,Ia){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+ma+'", '+Ia+")")};cb.prototype.doesModuleExist=function(ma,Ia){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+ma+'", '+Ia+")")};cb.prototype.registerPackage=function(ma){var Ia=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(W){return W.return(Ia.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(ma)+")"))})};
cb.prototype.importPackage=function(ma){var Ia=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(W){return W.return(Ia.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(ma)+")"))})};cb.prototype.removePackage=function(ma){var Ia=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(W){return W.return(Ia.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(ma)+")"))})};cb.prototype.reloadPackage=function(ma,Ia){var W=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){return sa.return(W.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(ma)+", "+JSON.stringify(Ia)+")"))})};cb.prototype.packageConfChange=function(ma,Ia){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(ma)+", "+JSON.stringify(Ia)+")")};cb.prototype.resourcesOfPackage=function(ma,Ia){Ia=void 0===Ia?[".git","node_modules",".module_cache","lively.next-node_modules"]:Ia;var W=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){ma.address&&
(ma=ma.address);return sa.return(W.runEvalAndStringify("\n      "+W.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(ma)+", "+JSON.stringify(Ia)+");"))})};cb.prototype.getModule=function(ma){var Ia=this,W;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){if(1==sa.nextAddress)return sa.yield(Ia.getModules(),2);W=sa.yieldResult.find(function(Za){return Za.name===ma});return sa.return(W?Sa.modules.module(W.name):null)})};cb.prototype.importModule=
function(ma){return this.runEvalAndStringify("lively.modules.System.import("+JSON.stringify(ma)+")")};cb.prototype.forgetModule=function(ma,Ia){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ma)+").unload("+JSON.stringify(Ia)+")")};cb.prototype.reloadModule=function(ma,Ia){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ma)+").reload("+JSON.stringify(Ia)+")")};cb.prototype.moduleFormat=function(ma){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(ma)+").format();")};cb.prototype.moduleRead=function(ma){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ma)+").source()")};cb.prototype.moduleSourceChange=function(ma,Ia,W){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ma)+").changeSource("+JSON.stringify(Ia)+", "+JSON.stringify(W)+")")};cb.prototype.keyValueListOfVariablesInModule=function(ma,Ia){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+
JSON.stringify(ma)+", "+JSON.stringify(Ia)+")")};cb.prototype.importsAndExportsOf=function(ma,Ia){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(ma)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(ma)+").exports()})")};cb.prototype.exportsOfModules=function(ma){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(ma)+";\n      options.excludedPackages = ["+ma.excludedPackages.map(function(Ia){return"function"===
typeof Ia?Ia.toString():JSON.stringify(Ia)}).join(",")+"]\n      await livelySystem.localInterface.exportsOfModules(options)")};cb.prototype.searchInPackage=function(ma,Ia,W){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(ma)+", "+JSON.stringify(Ia)+", "+JSON.stringify(W)+")")};cb.prototype.loadMochaTestFile=function(ma,Ia){Ia=void 0===Ia?[]:Ia;var W=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){return sa.return(W.runEvalAndStringify("\n      "+
W.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(ma)+", "+JSON.stringify(Ia)+"), result;\n      result = {testsByFile}"))})};cb.prototype.runMochaTests=function(ma,Ia,W,sa){var Za=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(mb){ma&&ma instanceof RegExp&&(ma={isRegExp:!0,value:String(ma).replace(/^\/|\/$/g,"")});return mb.return(Za.runEvalAndStringify("\n      var grep = "+JSON.stringify(ma)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
Za.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(Ia||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})};
Sa.RemoteCoreInterface=cb;var ab=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");ab.obj=$b;ab.string=Nc;ab.arr=Kb;ab.resource=lc;ab.createFiles=nd;ab.ast=Cb;ab.modules=ad;ab.vm=he;ab.parseJsonLikeObj=rd;ab.AbstractCoreInterface=Ua;ab.classToFunctionTransform=af;Ua=function(){return ab.AbstractCoreInterface.apply(this,arguments)||this};$jscomp.inherits(Ua,ab.AbstractCoreInterface);Ua.prototype.dynamicCompletionsForPrefix=function(ma,Ia,W){var sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Za){if(1==
Za.nextAddress)return Za.yield(ab.vm.completions.getCompletions(function(mb){return ab.vm.runEval(mb.replace("return ",""),Object.assign({targetModule:ma,classTransform:ab.classToFunctionTransform},W))},Ia),2);sa=Za.yieldResult;if(sa.isError)throw sa.value;return Za.return({completions:sa.completions,prefix:sa.startLetters})})};Ua.prototype.runEval=function(ma,Ia){return ab.vm.runEval(ma,Object.assign({classTransform:ab.classToFunctionTransform},Ia))};Ua.prototype.resourceExists=function(ma){return ab.resource(ma).exists()};
Ua.prototype.resourceEnsureExistance=function(ma,Ia){return ab.resource(ma).ensureExistance(Ia)};Ua.prototype.resourceMkdir=function(ma){return ab.resource(ma).mkdir()};Ua.prototype.resourceRead=function(ma){return ab.resource(ma).read()};Ua.prototype.resourceRemove=function(ma){return ab.resource(ma).remove()};Ua.prototype.resourceWrite=function(ma,Ia){return ab.resource(ma).write(Ia)};Ua.prototype.resourceCreateFiles=function(ma,Ia){return ab.createFiles(ma,Ia)};Ua.prototype.resourceDirList=function(ma,
Ia,W){return ab.resource(ma).dirList(Ia,W)};Ua.prototype.normalizeSync=function(ma,Ia,W){return System.decanonicalize(ma,Ia,W)};Ua.prototype.normalize=function(ma,Ia,W){return System.normalize(ma,Ia,W)};Ua.prototype.printSystemConfig=function(){return ab.modules.printSystemConfig()};Ua.prototype.getConfig=function(){return System.getConfig()};Ua.prototype.setConfig=function(ma){ab.modules.System.config(ma)};Ua.prototype.getPackages=function(ma){ma=Object.assign({},ma);ma=void 0===ma.excluded?[]:ma.excluded;
var Ia=ma.filter(function(sa){return"string"===typeof sa}),W=ma.filter(function(sa){return"function"===typeof sa});Ia=Ia.concat(Ia.map(function(sa){return System.decanonicalize(sa.replace(/\/?$/,"/")).replace(/\/$/,"")}));return ab.modules.getPackages().filter(function(sa){return!Ia.includes(sa.url)&&!W.some(function(Za){return Za(sa.url)})})};Ua.prototype.registerPackage=function(ma){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return Ia.return(ab.modules.registerPackage(ma))})};
Ua.prototype.importPackage=function(ma){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return Ia.return(ab.modules.importPackage(ma))})};Ua.prototype.removePackage=function(ma){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return Ia.return(ab.modules.removePackage(ma))})};Ua.prototype.reloadPackage=function(ma,Ia){return $jscomp.asyncExecutePromiseGeneratorProgram(function(W){return W.return(ab.modules.reloadPackage(ma,Ia))})};Ua.prototype.packageConfChange=function(ma,
Ia){var W=this,sa,Za,mb,rc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xd){if(1==xd.nextAddress)return sa=ab.modules.System,Za=ab.parseJsonLikeObj(ma),mb=JSON.stringify(Za,null,2),xd.yield(ab.modules.module(Ia).changeSource(mb,{doEval:!1}),2);if(3!=xd.nextAddress)return sa.set(Ia,sa.newModule(Za)),xd.yield(W.getPackageForModule(Ia),3);(rc=xd.yieldResult)&&ab.modules.applyPackageConfig(Za,rc.address);xd.jumpToEnd()})};Ua.prototype.resourcesOfPackage=function(ma,Ia){Ia=void 0===Ia?[".git",
"node_modules",".module_cache"]:Ia;var W,sa,Za;return $jscomp.asyncExecutePromiseGeneratorProgram(function(mb){if(1==mb.nextAddress)return mb.setCatchFinallyBlocks(2),W=ma.address?ma.address:ma,sa=ab.modules.getPackage(W),mb.yield(sa.resources(void 0,Ia),4);if(2!=mb.nextAddress)return mb.return(mb.yieldResult.map(function(rc){return Object.assign(rc,{package:rc.package.url})}));Za=mb.enterCatchBlock();console.warn("resourcesOfPackage error for "+ma+": "+Za);return mb.return([])})};Ua.prototype.getPackageForModule=
function(ma){return(ma=ab.modules.getPackageOfModule(ma))?ma.asSpec():ma};Ua.prototype.isModuleLoaded=function(ma,Ia){return ab.modules.isModuleLoaded(ma,Ia)};Ua.prototype.doesModuleExist=function(ma,Ia){return ab.modules.isModuleLoaded(ma,Ia)};Ua.prototype.getModule=function(ma){return ab.modules.module(ma)};Ua.prototype.importModule=function(ma){return ab.modules.System.import(ma)};Ua.prototype.forgetModule=function(ma,Ia){return ab.modules.module(ma).unload(Ia)};Ua.prototype.reloadModule=function(ma,
Ia){return ab.modules.module(ma).reload(Ia)};Ua.prototype.moduleFormat=function(ma){return ab.modules.module(ma).format()};Ua.prototype.moduleRead=function(ma){return ab.modules.module(ma).source()};Ua.prototype.moduleSourceChange=function(ma,Ia,W){return ab.modules.module(ma).changeSource(Ia,W)};Ua.prototype.keyValueListOfVariablesInModule=function(ma,Ia){var W=this,sa,Za,mb,rc,xd,sc,Na,Xd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gd){switch(Gd.nextAddress){case 1:if(Ia){Gd.jumpTo(2);
break}return Gd.yield(W.resourceRead(ma),3);case 3:Ia=Gd.yieldResult;case 2:return sa="string"===typeof Ia?ab.ast.parse(Ia):Ia,Za=W.normalizeSync(ma),W.moduleFormat(Za),mb=ab.modules.module(Za).env().recorder,Gd.yield(W.importsAndExportsOf(Za,sa),4);case 4:return rc=Gd.yieldResult,xd=ab.ast.query.topLevelDeclsAndRefs(sa),sc=ab.arr.sortByKey(ab.ast.query.declarationsOfScope(xd.scope,!0),"start"),Na=ab.arr.pluck(xd.scope.importSpecifiers,"name"),Xd=0,Gd.return(sc.map(function(td){var Ib=td.name.length,
jc=rc.exports.find(function(Sc){return Sc.local===td.name}),tb=ab.arr.include(Na,td.name);jc&&(Ib+=9);tb&&(Ib+=9);Xd=Math.max(Xd,Ib);return{isExport:jc,isImport:tb,name:td.name,value:mb[td.name],node:td,printedName:td.name+(jc?" [export]":"")+(tb?" [import]":""),printedValue:ab.obj.inspect(mb[td.name],{maxDepth:1}).replace(/\n/g,"")}}).map(function(td){return{isListItem:!0,value:td,string:td.printedName+ab.string.indent(" = "+td.printedValue," ",Xd-td.printedName.length)}}))}})};Ua.prototype.importsAndExportsOf=
function(ma,Ia){var W;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){return 1==sa.nextAddress?sa.yield(ab.modules.module(ma).imports(Ia),2):3!=sa.nextAddress?(W=sa.yieldResult,sa.yield(ab.modules.module(ma).exports(Ia),3)):sa.return({imports:W,exports:sa.yieldResult})})};Ua.prototype.exportsOfModules=function(ma){return ab.modules.ExportLookup.run(System,ma)};Ua.prototype.searchInPackage=function(ma,Ia,W){return ab.modules.getPackage(ma).search(Ia,W)};Ua.prototype.runMochaTests=function(ma,
Ia,W,sa){var Za,mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){if(1==rc.nextAddress)return rc.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);Za=rc.yieldResult;mb=Za.runMochaTests;return rc.return(mb(ma,Ia,W,sa))})};Ua.prototype.loadMochaTestFile=function(ma,Ia){var W,sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Za){if(1==Za.nextAddress)return Za.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);W=Za.yieldResult;
sa=W.loadMochaTestFile;return Za.return(sa(ma,Ia))})};$jscomp.global.Object.defineProperties(Ua.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"local"}}});ab.LocalCoreInterface=Ua;var qb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");qb.evalStrategies=Af;qb.RemoteCoreInterface=cb;var Zb=function(ma){var Ia=qb.RemoteCoreInterface.call(this)||this;Ia.currentEval=null;Ia.url=ma;Ia.server=new qb.evalStrategies.HttpEvalStrategy(ma);return Ia};
$jscomp.inherits(Zb,qb.RemoteCoreInterface);Zb.prototype.runEval=function(ma,Ia){return this.server.runEval(ma,Ia)};$jscomp.global.Object.defineProperties(Zb.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this.url}},description:{configurable:!0,enumerable:!0,get:function(){return this.url.replace(/^https?:\/\//,"")}}});qb.HTTPCoreInterface=Zb;var kc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");kc.evalStrategies=Af;kc.RemoteCoreInterface=
cb;cb=function(ma,Ia){var W=kc.RemoteCoreInterface.call(this)||this;W.targetId=ma;W.peer=Ia;return W};$jscomp.inherits(cb,kc.RemoteCoreInterface);cb.prototype.isConnected=function(){var ma=this,Ia,W,sa,Za,mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){if(1==rc.nextAddress)return Ia=ma,W=Ia.client,sa=Ia.targetId,rc.yield(W.sendToAndWait(W.trackerId,"getClients",{}),2);Za=rc.yieldResult;mb=Za.data;return rc.return(mb.some(function(xd){xd=$jscomp.makeIterator(xd).next().value;return sa===
xd}))})};cb.prototype.runEval=function(ma,Ia){var W=this,sa,Za;return $jscomp.asyncExecutePromiseGeneratorProgram(function(mb){sa=W.client;if(!sa)throw Error("No lively.2lively default client available!");Za=new kc.evalStrategies.L2LEvalStrategy(sa,W.targetId);return mb.return(Za.runEval(ma,Ia))})};$jscomp.global.Object.defineProperties(cb.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"l2l "+this.targetId}},description:{configurable:!0,enumerable:!0,get:function(){var ma=this.peer,
Ia="l2l "+this.targetId.slice(0,5);if(ma){var W=ma.location,sa=ma.type,Za=ma.user;ma=ma.world;sa&&(Ia+=", "+sa);W&&(Ia+=", "+W.replace(/^https?:\/\//,"")+(ma?"/"+ma:""));Za&&(Ia+=", "+Za.name)}return Ia}},client:{configurable:!0,enumerable:!0,get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}}});kc.L2LCoreInterface=cb;var Rb=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");Rb.systemInterfaceNamed=sb;
Rb.interactivelyCreatePackage=cc;Rb.interactivelyLoadPackage=Ic;Rb.interactivelyReloadPackage=Kd;Rb.interactivelyUnloadPackage=Kc;Rb.interactivelyRemovePackage=Bd;Rb.showExportsAndImportsOf=be;Rb.shortModuleName=Cc;Rb.interactivelyChangeModule=Pb;Rb.interactivelyReloadModule=Dc;Rb.interactivelyUnloadModule=Xc;Rb.interactivelyRemoveModule=Cd;Rb.interactivelyAddModule=Od;Rb.modulesInPackage=Gb;Rb.LocalCoreInterface=Ua;Rb.HTTPCoreInterface=Zb;Rb.L2LCoreInterface=cb;cb=function(ma){this.coreInterface=
ma};cb.prototype.dynamicCompletionsForPrefix=function(ma,Ia,W){return this.coreInterface.dynamicCompletionsForPrefix(ma,Ia,W)};cb.prototype.runEval=function(ma,Ia){return this.coreInterface.runEval(ma,Ia)};cb.prototype.printSystemConfig=function(ma,Ia,W){return this.coreInterface.printSystemConfig(ma,Ia,W)};cb.prototype.getConfig=function(ma,Ia,W){return this.coreInterface.getConfig(ma,Ia,W)};cb.prototype.getPackages=function(ma){return this.coreInterface.getPackages(ma)};cb.prototype.getModules=
function(ma,Ia,W){return this.coreInterface.getModules(ma,Ia,W)};cb.prototype.getModule=function(ma,Ia,W){return this.coreInterface.getModule(ma,Ia,W)};cb.prototype.getPackage=function(ma,Ia,W){return this.coreInterface.getPackage(ma,Ia,W)};cb.prototype.getPackageForModule=function(ma,Ia,W){return this.coreInterface.getPackageForModule(ma,Ia,W)};cb.prototype.resourcesOfPackage=function(ma,Ia){return this.coreInterface.resourcesOfPackage(ma,Ia)};cb.prototype.systemConfChange=function(ma,Ia,W){return this.coreInterface.systemConfChange(ma,
Ia,W)};cb.prototype.registerPackage=function(ma){return this.coreInterface.registerPackage(ma)};cb.prototype.importPackage=function(ma){return this.coreInterface.importPackage(ma)};cb.prototype.removePackage=function(ma){return this.coreInterface.removePackage(ma)};cb.prototype.reloadPackage=function(ma){return this.coreInterface.reloadPackage(ma)};cb.prototype.packageConfChange=function(ma,Ia){return this.coreInterface.packageConfChange(ma,Ia)};cb.prototype.keyValueListOfVariablesInModule=function(ma,
Ia){return this.coreInterface.keyValueListOfVariablesInModule(ma,Ia)};cb.prototype.interactivelyCreatePackage=function(ma){return Rb.interactivelyCreatePackage(this.coreInterface,ma)};cb.prototype.interactivelyLoadPackage=function(ma,Ia){return Rb.interactivelyLoadPackage(this.coreInterface,ma,Ia)};cb.prototype.interactivelyReloadPackage=function(ma,Ia){return Rb.interactivelyReloadPackage(this.coreInterface,ma,Ia)};cb.prototype.interactivelyUnloadPackage=function(ma,Ia,W){return Rb.interactivelyUnloadPackage(this.coreInterface,
ma,Ia,W)};cb.prototype.interactivelyRemovePackage=function(ma,Ia){return Rb.interactivelyRemovePackage(this.coreInterface,ma,Ia)};cb.prototype.isModuleLoaded=function(ma,Ia){return this.coreInterface.isModuleLoaded(ma,Ia)};cb.prototype.doesModuleExist=function(ma,Ia){return this.coreInterface.doesModuleExist(ma,Ia)};cb.prototype.importModule=function(ma){return this.coreInterface.importModule(ma)};cb.prototype.forgetModule=function(ma,Ia){return this.coreInterface.forgetModule(ma,Ia)};cb.prototype.reloadModule=
function(ma,Ia){return this.coreInterface.reloadModule(ma,Ia)};cb.prototype.moduleFormat=function(ma){return this.coreInterface.moduleFormat(ma)};cb.prototype.moduleRead=function(ma){return this.coreInterface.moduleRead(ma)};cb.prototype.moduleWrite=function(ma,Ia){return this.coreInterface.moduleWrite(ma,Ia)};cb.prototype.getModulesInPackage=function(ma){return Rb.modulesInPackage(this.coreInterface,ma)};cb.prototype.shortModuleName=function(ma,Ia){return Rb.shortModuleName(this.coreInterface,ma,
Ia)};cb.prototype.interactivelyChangeModule=function(ma,Ia,W){return Rb.interactivelyChangeModule(this.coreInterface,ma,Ia,W)};cb.prototype.interactivelyReloadModule=function(ma,Ia){return Rb.interactivelyReloadModule(this.coreInterface,ma,Ia)};cb.prototype.interactivelyUnloadModule=function(ma,Ia){return Rb.interactivelyUnloadModule(this.coreInterface,ma,Ia)};cb.prototype.interactivelyRemoveModule=function(ma,Ia){return Rb.interactivelyRemoveModule(this.coreInterface,ma,Ia)};cb.prototype.interactivelyAddModule=
function(ma,Ia){return Rb.interactivelyAddModule(this.coreInterface,ma,Ia)};cb.prototype.showExportsAndImportsOf=function(ma,Ia){return Rb.showExportsAndImportsOf(this.coreInterface,ma,Ia)};cb.prototype.exportsOfModules=function(ma){return this.coreInterface.exportsOfModules(ma)};cb.prototype.searchInPackage=function(ma,Ia,W){return this.coreInterface.searchInPackage(ma,Ia,W)};cb.prototype.searchInAllPackages=function(ma,Ia){Ia=void 0===Ia?{}:Ia;var W=this,sa,Za,mb,rc,xd,sc,Na,Xd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gd){switch(Gd.nextAddress){case 1:return(sa=
Ia.progress)&&sa.step("Fetching Packages...",0),Gd.yield(W.coreInterface.getPackages({excluded:Ia.excludedPackages}),2);case 2:Za=Gd.yieldResult,mb=[],sa&&sa.step("Fetching Packages...",.1),rc=0;case 3:if(!(rc<Za.length)){Gd.jumpTo(5);break}xd=Za[rc];sc=xd.url;if(!sc||"no group"===sc){Gd.jumpTo(4);break}sa&&sa.step(sc.replace(System.baseURL,"").slice(0,20),.1+rc/Za.length*.9);Gd.setCatchFinallyBlocks(6);return Gd.yield(W.coreInterface.searchInPackage(sc,ma,Ia),8);case 8:Na=Gd.yieldResult;mb=mb.concat(Na);
Gd.leaveTryBlock(4);break;case 6:Xd=Gd.enterCatchBlock(),console.error("Error searching in package "+sc+":\n"+Xd.stack);case 4:rc++;Gd.jumpTo(3);break;case 5:return Gd.return(mb)}})};cb.prototype.loadMochaTestFile=function(ma,Ia){return this.coreInterface.loadMochaTestFile(ma,Ia)};cb.prototype.runMochaTests=function(ma,Ia,W,sa){return this.coreInterface.runMochaTests(ma,Ia,W,sa)};$jscomp.global.Object.defineProperties(cb.prototype,{isSystemInterface:{configurable:!0,enumerable:!0,get:function(){return!0}},
name:{configurable:!0,enumerable:!0,get:function(){return this.coreInterface.name}}});Ea("Interface",cb);Rb.Interface=cb;Rb.systemInterfaceNamed=sb;Rb.systemInterfaceNamed=sb;cb=Ea("localInterface",new Rb.Interface(new Rb.LocalCoreInterface));Rb.localInterface=cb;Rb.localInterface=cb;Rb.localInterface=cb;Rb.httpInterfaces={};cb=Ea("serverInterfaceFor",function(ma){return Rb.httpInterfaces[ma]||(Rb.httpInterfaces[ma]=new Rb.Interface(new Rb.HTTPCoreInterface(ma)))});Rb.serverInterfaceFor=cb;Rb.serverInterfaceFor=
cb;Rb.serverInterfaceFor=cb;Rb.l2lInterfaces={};cb=Ea("l2lInterfaceFor",function(ma,Ia){return Rb.l2lInterfaces[ma]||(Rb.l2lInterfaces[ma]=new Rb.Interface(new Rb.L2LCoreInterface(ma,Ia)))});Rb.l2lInterfaceFor=cb;Rb.l2lInterfaceFor=cb;Rb.l2lInterfaceFor=cb}}});