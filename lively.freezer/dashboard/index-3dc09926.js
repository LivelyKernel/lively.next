System.register(["./__root_module__-dce2a509.js","kld-intersections"],function(Ba){var zb,Ib,nc,bc,Sd,Vc,Ud,Yc,Oc,qd,ie,Ye,sf;return{setters:[function(ne){zb=ne.bv;Ib=ne.a6;nc=ne.r;bc=ne.a8;Sd=ne.$;Vc=ne.bw;Ud=ne.bx;Yc=ne.T;Oc=ne.a7;qd=ne.by;ie=ne.bz;Ye=ne.l;sf=ne.bA},function(){}],execute:function(){function ne(pa){try{var Ja=eval("("+Mb.ast.transform.wrapInFunction("var _; _ = ("+pa+")")+")()")}catch(X){return JSON.parse(pa)}return"object"!==typeof Ja?null:Ja}function cc(pa,Ja){var X,ua,ab,
rb,vc,Bd,sc,Nb,Yd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Cd){switch(Cd.nextAddress){case 1:return X=Ja.world(),Cd.yield(X.prompt("Enter package name",{requester:Ja,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:ua=Cd.yieldResult;if(!ua)throw"Canceled";Cd.setCatchFinallyBlocks(3);rb=Na.resource(ua);ua=rb.name();ab=rb.url;Cd.leaveTryBlock(4);break;case 3:return Cd.enterCatchBlock(),Cd.yield(pa.getConfig(),5);case 5:return vc=Cd.yieldResult.baseURL,
Bd=Na.resource(vc).join(ua).asDirectory().url,Cd.yield(pa.normalize(Bd),6);case 6:ab=Cd.yieldResult.replace(/\/\.js$/,"/");case 4:return Cd.yield(X.prompt("Confirm or change package location",{requester:Ja,input:ab,historyId:"lively.vm-editor-add-package-address"}),7);case 7:sc=Cd.yieldResult;if(!sc)throw"Canceled";Nb=Na.resource(sc).asDirectory();Yd=Nb.asFile().url;return Cd.yield(pa.removePackage(Yd),8);case 8:return Cd.yield(pa.resourceCreateFiles(Yd,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+
ua+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+ua+"\n\nNo description for package "+ua+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+ua+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return Cd.return(Na.loadPackage(pa,{name:ua,address:Yd,configFile:Nb.join("package.json").url,main:Nb.join("index.js").url,test:Nb.join("tests/test.js").url,type:"package"}))}})}function Hc(pa,Ja,X){X=void 0===X?
null:X;var ua,ab,rb,vc,Bd,sc,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yd){switch(Yd.nextAddress){case 1:return ua={name:"",address:"",type:"package"},Yd.yield(pa.getConfig(),2);case 2:ab=Yd.yieldResult;if(!X){Yd.jumpTo(3);break}return Yd.yield(pa.getPackage(X),4);case 4:if(rb=Yd.yieldResult){Yd.jumpTo(5);break}return Yd.yield(pa.getPackageForModule(X),6);case 6:rb=Yd.yieldResult;case 5:vc=rb;case 3:return Yd.yield(Ja.world().prompt("What is the package directory?",{requester:Ja,
input:vc?vc.address:ab.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:Bd=Yd.yieldResult;if(!Bd)throw"Canceled";ua.address=Bd.replace(/\/$/,"");ua.url=new URL(ua.address+"/");ua.configFile=Na.resource(ua.url).join("package.json").url;Yd.setCatchFinallyBlocks(8);sc=JSON;Nb=sc.parse;return Yd.yield(pa.moduleRead(ua.configFile),10);case 10:Nb.call(sc,Yd.yieldResult).name;Yd.leaveTryBlock(9);break;case 8:Yd.enterCatchBlock(),ua.name=String(ua.url).replace(/\/$/,""),
pa.resourceEnsureExistance(ua.configFile,'{\n  "name": "'+ua.name+'",\n  "version": "0.1.0"\n}');case 9:return Yd.return(Na.loadPackage(pa,ua))}})}function Md(pa,Ja,X){var ua,ab,rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vc){switch(vc.nextAddress){case 1:return ua=Na.resource(X).asFile().url,vc.yield(pa.getPackage(ua),2);case 2:if(ab=vc.yieldResult){vc.jumpTo(3);break}return vc.yield(pa.getPackageForModule(ua),4);case 4:ab=vc.yieldResult;case 3:rb=ab;if(!rb)throw Error("Cannot find package for "+
ua);return vc.yield(pa.reloadPackage(ua),5);case 5:if(!Ja){vc.jumpTo(0);break}return vc.yield(Ja.updateModuleList(),7);case 7:return vc.yield(Ja.uiSelect(ua,!1),8);case 8:return vc.return(vc.yieldResult)}})}function fc(pa,Ja,X,ua){var ab,rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vc){switch(vc.nextAddress){case 1:return vc.yield(pa.getPackage(X),2);case 2:return ab=vc.yieldResult,vc.yield((ua||$world).confirm("Unload package "+ab.name+"?",{requester:Ja}),3);case 3:rb=vc.yieldResult;
if(!rb)throw"Canceled";return vc.yield(pa.removePackage(X),4);case 4:if(!Ja){vc.jumpTo(0);break}return vc.yield(Ja.updateModuleList(),6);case 6:return vc.yield(Ja.uiSelect(null),0)}})}function $d(pa,Ja,X){var ua,ab,rb,vc,Bd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sc){switch(sc.nextAddress){case 1:return ua=Ja.world(),sc.yield(pa.getPackage(X),2);case 2:return ab=sc.yieldResult,ab?sc.yield(ua.confirm("Really remove package "+ab.name+"?",{requester:Ja}),3):($world.inform('No package "'+
X+'" found!',{requester:Ja}),sc.return());case 3:rb=sc.yieldResult;if(!rb)throw"Canceled";pa.removePackage(X);return sc.yield(ua.confirm("Also remove directory "+ab.name+" including "+ab.modules.length+" modules?"),4);case 4:vc=sc.yieldResult;if(!vc){sc.jumpTo(0);break}return sc.yield(ua.confirm("REALLY *remove* directory "+ab.name+"? No undo possible..."),6);case 6:if(Bd=sc.yieldResult)return sc.yield(pa.resourceRemove(ab.address),0);sc.jumpTo(0)}})}function pe(pa,Ja,X){X=void 0===X?$world:X;var ua,
ab,rb,vc,Bd,sc,Nb,Yd,Cd,kb,Cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function($c){switch($c.nextAddress){case 1:return $c.yield(pa.getPackage(Ja),2);case 2:ua=$c.yieldResult;if(!ua)throw Error("Cannot find package "+Ja);ab=[];rb=$jscomp.makeIterator(ua.modules);vc=rb.next();case 3:if(vc.done)return $c.yield(X.execCommand("open text window",{title:"imports and exports of "+Ja,content:ab.join("\n\n")}),0);Bd=vc.value;if(!Bd.name.match(/\.js$/)){$c.jumpTo(4);break}$c.setCatchFinallyBlocks(6);
sc=pa;Nb=sc.importsAndExportsOf;Yd=Bd.name;return $c.yield(pa.moduleRead(Bd.name),9);case 9:return $c.yield(Nb.call(sc,Yd,$c.yieldResult),8);case 8:Cd=$c.yieldResult;$c.leaveTryBlock(7);break;case 6:kb=$c.enterCatchBlock();X.logError(Error("Error when getting imports/exports from module "+Bd.name+":\n"+kb.stack));$c.jumpTo(4);break;case 7:Cb=""+Bd.name;if(!Cd.imports.length&&!Cd.exports.length){Cb+="\n  does not import / export anything";$c.jumpTo(4);break}Cd.imports.length&&(Cb+="\n  imports:\n",
Cb+=Na.arr.groupByKey(Cd.imports,"fromModule").mapGroups(function(sb,hd){return"from "+sb+": "+hd.map(function(md){return md.local||md.imported?md.imported&&md.imported!==md.local?md.imported+" as "+md.local:md.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(sb){return"    "+sb}).join("\n"));Cd.exports.length&&(Cb+="\n  exports:\n",Cb+=Cd.exports.map(function(sb){return sb.local?sb.local&&sb.local!==sb.exported?sb.local+" as "+sb.exported:sb.exported:sb.exported+
" from "+sb.fromModule}).join(", ").split("\n").map(function(sb){return"    "+sb}).join("\n"));ab.push(Cb);case 4:vc=rb.next(),$c.jumpTo(3)}})}function Cc(pa){return pa.match(/import.*['"]mocha(-es6)?['"]/)&&pa.match(/it\(['"]/)}function Ic(pa,Ja,X){X=X&&X.address;if(X&&0===Ja.indexOf(X))var ua=Ja.slice(X.length).replace(/^\//,"");else a:{X=pa.getConfig();if(!X||X.constructor!==Promise)try{ua=String((new Ua.URL(Ja)).relativePathFrom(new Ua.URL(pa.getConfig().baseURL)));break a}catch(ab){}ua=Ja}return ua}
function Sb(pa,Ja,X,ua){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){return 1==ab.nextAddress?(ua=Object.assign({targetModule:Ja},ua),ab.yield(pa.normalize(Ja),2)):3!=ab.nextAddress?(Ja=ab.yieldResult,ab.yield(pa.moduleSourceChange(Ja,X,ua),3)):ab.return(Ja)})}function Jc(pa,Ja,X,ua,ab){ua=void 0===ua?!1:ua;ab=void 0===ab?!1:ab;var rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vc){switch(vc.nextAddress){case 1:return Ja&&Ja.setStatusMessage("Reloading "+X),vc.setCatchFinallyBlocks(2),
vc.yield(pa.reloadModule(X,{reloadDeps:ua,resetEnv:ab}),4);case 4:if(!Ja){vc.jumpTo(5);break}return vc.yield(Ja.updateModuleList(),6);case 6:case 5:Ja&&Ja.setStatusMessage("Reloded "+X);vc.leaveTryBlock(0);break;case 2:rb=vc.enterCatchBlock();vc.setCatchFinallyBlocks(7);if(!Ja){vc.jumpTo(9);break}return vc.yield(Ja.updateEditorWithSourceOf(X),10);case 10:case 9:vc.leaveTryBlock(8);break;case 7:vc.enterCatchBlock();case 8:throw Ja&&Ja.showError(rb),rb;}})}function dd(pa,Ja,X){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ua){switch(ua.nextAddress){case 1:return ua.yield(pa.forgetModule(X,
{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!Ja){ua.jumpTo(3);break}return ua.yield(Ja.updateModuleList(),4);case 4:case 3:ua.jumpToEnd()}})}function Jd(pa,Ja,X){var ua,ab,rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vc){switch(vc.nextAddress){case 1:return vc.yield(pa.normalize(X),2);case 2:return ua=vc.yieldResult,vc.yield(Ja.world().confirm("Remove file "+ua+"?",{requester:Ja}),3);case 3:ab=vc.yieldResult;if(!ab)throw"Canceled";return vc.yield(pa.forgetModule(ua),4);case 4:return vc.yield(pa.resourceRemove(ua),
5);case 5:return vc.yield(pa.getPackageForModule(ua),6);case 6:return rb=vc.yieldResult,vc.return(rb)}})}function Kd(pa,Ja,X){var ua,ab,rb,vc,Bd,sc,Nb,Yd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Cd){switch(Cd.nextAddress){case 1:return ua=Ua.URL,Cd.yield(pa.getConfig(),2);case 2:ab=new ua(Cd.yieldResult.baseURL);rb=Ja.world();if(!X){Cd.jumpTo(3);break}return Cd.yield(pa.getPackage(X),4);case 4:if(vc=Cd.yieldResult){Cd.jumpTo(5);break}return Cd.yield(pa.getPackageForModule(X),6);
case 6:vc=Cd.yieldResult;case 5:(Bd=vc)&&(ab=new Ua.URL(Bd.address));case 3:return Cd.yield(Ua._searchForExistingFiles(Ja,String(ab),Bd),7);case 7:sc=Cd.yieldResult;if(!sc.includes("[create new module]")){Cd.jumpTo(8);break}return Cd.yield(Ua._askForModuleName(pa,X||String(ab),rb),9);case 9:Nb=Cd.yieldResult,sc=[Nb];case 8:return Cd.yield(Ua._createAndLoadModules(pa,sc),10);case 10:return Yd=Cd.yieldResult,Ua.arr.compact(Yd.map(function(kb){return kb.error})),Cd.return(Yd)}})}function Hb(pa,Ja){var X,
ua,ab,rb,vc,Bd,sc,Nb,Yd,Cd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kb){if(1==kb.nextAddress)return kb.yield(pa.getPackage(Ja),2);if(3!=kb.nextAddress){X=kb.yieldResult;if(!X||!X.address.match(/^http/))throw Error("Cannot load package "+Ja);ua=Ua.resource(X.address);ab=[];rb=$jscomp;vc=rb.makeIterator;return kb.yield(ua.dirList(5,{exclude:Ua.modulesInPackage_defaultExclude}),3)}Bd=vc.call(rb,kb.yieldResult);for(sc=Bd.next();!sc.done;sc=Bd.next())Yd=Nb=sc.value,Cd=Yd.url,Cd.match(/\.js$/)&&
pa.isModuleLoaded(Cd,!0)&&ab.push(pa.getModule(Cd));return kb.return(ab)})}function Bb(pa){pa||(pa="local");if(pa.isSystemInterface)var Ja=pa;else"string"===typeof pa&&pa.startsWith("l2l ")&&(pa={type:"l2l",id:pa.split(" ")[1]}),"string"!==typeof pa&&"l2l"===pa.type&&(Ja=Tb.l2lInterfaceFor(pa.id,pa.info)),"string"!==typeof pa&&($world.setStatusMessage("Unknown system interface "+pa),pa="local"),Ja||(Ja=pa&&"local"!==pa?Tb.serverInterfaceFor(pa):Tb.localInterface);return Ja}Ba("systemInterfaceNamed",
Bb);var Mb=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");Mb.parseJsonLikeObj=ne;Mb.ast=zb;Mb.parseJsonLikeObj=ne;Mb.parseJsonLikeObj=ne;var Na=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");Na.loadPackage=function(pa,Ja){var X,ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){switch(ab.nextAddress){case 1:return ab.yield(pa.importPackage(Ja.address+"/"),2);case 2:if(!Ja.main){ab.jumpTo(3);break}return ab.yield(pa.importModule(Ja.main.toString()),
3);case 3:if(!Ja.test){ab.jumpTo(5);break}ab.setCatchFinallyBlocks(6);return ab.yield(pa.importPackage("mocha-es6"),8);case 8:return X=ab.yieldResult,ab.yield(X.installSystemInstantiateHook(),9);case 9:return ab.yield(pa.importModule(Ja.test.toString()),10);case 10:ab.leaveTryBlock(5);break;case 6:ua=ab.enterCatchBlock(),console.warn("Cannot load test of new package: "+ua);case 5:return ab.return(pa.getPackage(Ja.address))}})};Na.interactivelyCreatePackage=cc;Na.interactivelyLoadPackage=Hc;Na.interactivelyReloadPackage=
Md;Na.interactivelyUnloadPackage=fc;Na.interactivelyRemovePackage=$d;Na.showExportsAndImportsOf=pe;Na.parseJsonLikeObj=ne;Na.arr=Ib;Na.resource=nc;Na.interactivelyCreatePackage=cc;Na.interactivelyCreatePackage=cc;Na.interactivelyLoadPackage=Hc;Na.interactivelyLoadPackage=Hc;Na.interactivelyReloadPackage=Md;Na.interactivelyReloadPackage=Md;Na.interactivelyUnloadPackage=fc;Na.interactivelyUnloadPackage=fc;Na.interactivelyRemovePackage=$d;Na.interactivelyRemovePackage=$d;Na.showExportsAndImportsOf=pe;
Na.showExportsAndImportsOf=pe;var Ua=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");Ua.isTestModule=Cc;Ua.shortModuleName=Ic;Ua.interactivelyChangeModule=Sb;Ua.interactivelyReloadModule=Jc;Ua.interactivelyUnloadModule=dd;Ua.interactivelyRemoveModule=Jd;Ua.interactivelyAddModule=Kd;Ua._askForModuleName=function(pa,Ja,X){var ua,ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rb){switch(rb.nextAddress){case 1:return rb.yield(X.prompt("Enter module name",
{input:Ja,historyId:"lively.vm-editor-add-module-name"}),2);case 2:Ja=rb.yieldResult;if(!Ja)throw"Canceled";return rb.yield(pa.normalize(Ja),3);case 3:return ua=rb.yieldResult,rb.yield(X.confirm(["Create module \n",{},ua,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:ab=rb.yieldResult;if(!ab)throw"Canceled";return rb.return(ua)}})};Ua._searchForExistingFiles=function(pa,Ja,X){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ua){return String(Ja).match(/^http/)?ua.return(Ua._searchForExistingFilesWeb(pa,
Ja,X)):ua.return(Ua._searchForExistingFilesManually(pa,Ja,X))})};Ua._searchForExistingFilesManually=function(pa,Ja,X){var ua,ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rb){switch(rb.nextAddress){case 1:return rb.yield(pa.world().multipleChoicePrompt("Add Module",{requester:pa,choices:["Create New Module","Load Existing Module"]}),2);case 2:ua=rb.yieldResult;if("Create New Module"===ua)return rb.return("[create new module]");if("Load Existing Module"!==ua){rb.jumpTo(3);break}return rb.yield(pa.world().prompt("URL of module?",
{input:Ja,requester:pa,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),4);case 4:if(ab=rb.yieldResult)return rb.return([ab]);case 3:throw"Canceled";}})};Ua._searchForExistingFilesWeb=function(pa,Ja,X){function ua(Yd){Yd.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(Yd.name())||X&&Ua.arr.pluck(X.modules,"name").includes(Yd.url)?!0:!1}var ab,rb,vc,Bd,sc,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yd){switch(Yd.nextAddress){case 1:return(ab=
pa.world())&&(rb=ab.showLoadingIndicatorFor(pa,"Loading existing modules...")),Yd.yield(Ua.resource(Ja).dirList(5,{exclude:ua}),3);case 3:return Yd.yield(Yd.yieldResult.map(function(Cd){return Cd.url}),2);case 2:return vc=Yd.yieldResult,Bd=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(vc.filter(function(Cd){return Cd.endsWith(".js")}).map(function(Cd){return{isListItem:!0,string:X&&0==Cd.indexOf(X.address)?X.name+Cd.slice(X.address.length):Cd,value:Cd}})),Yd.yield(Promise.resolve(rb&&
rb.remove()).then(function(){return pa.world().filterableListPrompt("What module to load?",Bd,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:pa},pa?{extent:pa.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:sc=Yd.yieldResult;if(!sc||"canceled"===sc.status||!sc.selected.length)throw"Canceled";Nb=sc.selected||sc;Array.isArray(Nb)||(Nb=[Nb]);return Yd.return(Nb)}})};Ua._createAndLoadModules=function(pa,Ja){var X,ua,ab,rb,vc,Bd,sc,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yd){switch(Yd.nextAddress){case 1:Array.isArray(Ja)||
(Ja=[Ja]),X=[],ua=$jscomp.makeIterator(Ja),ab=ua.next();case 2:if(ab.done){Yd.jumpTo(4);break}rb=ab.value;return Yd.yield(pa.forgetModule(rb,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return Yd.yield(pa.resourceEnsureExistance(rb,'"format esm";\n'),6);case 6:return vc=Yd.yieldResult,Bd=Ua,sc=Bd.isTestModule,Yd.yield(vc.read(),7);case 7:if(!sc.call(Bd,Yd.yieldResult)){Yd.jumpTo(8);break}if(window.Mocha&&window.chai){Yd.jumpTo(8);break}return Yd.yield(System.import("mocha-es6"),10);case 10:return Yd.yield(Ua.promise.waitFor(function(){return!!window.Mocha&&
!!window.chai}),8);case 8:return Yd.setCatchFinallyBlocks(12),Yd.yield(pa.importModule(rb),14);case 14:X.push({name:rb});Yd.leaveTryBlock(3);break;case 12:Nb=Yd.enterCatchBlock(),X.push({name:rb,error:Nb});case 3:ab=ua.next();Yd.jumpTo(2);break;case 4:return Yd.return(X)}})};Ua.modulesInPackage_defaultExclude=function(pa){return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(pa.name())?!0:!1};Ua.modulesInPackage=Hb;Ua.obj=bc;Ua.promise=Sd;Ua.arr=Ib;Ua.resource=nc;Ua.isTestModule=
Cc;Ua.isTestModule=Cc;Ua.shortModuleName=Ic;Ua.shortModuleName=Ic;Ua.interactivelyChangeModule=Sb;Ua.interactivelyChangeModule=Sb;Ua.interactivelyReloadModule=Jc;Ua.interactivelyReloadModule=Jc;Ua.interactivelyUnloadModule=dd;Ua.interactivelyUnloadModule=dd;Ua.interactivelyRemoveModule=Jd;Ua.interactivelyRemoveModule=Jd;Ua.interactivelyAddModule=Kd;Ua.interactivelyAddModule=Kd;Ua.modulesInPackage=Hb;Ua.modulesInPackage=Hb;var Oa=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");
Oa.todo=function(pa){throw Error(pa+" is not yet implemented!");};Oa.parseJsonLikeObj=ne;Oa.arr=Ib;Oa.Closure=Vc;Oa.obj=bc;Oa.resource=nc;Oa.transform=Ud;Oa.modules=Yc;var Ia=function(){};Ia.prototype.dynamicCompletionsForPrefix=function(pa,Ja,X){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ua){Oa.todo("dynamicCompletionsForPrefix");ua.jumpToEnd()})};Ia.prototype.runEval=function(pa,Ja){Oa.todo("runEval")};Ia.prototype.resourceExists=function(pa){Oa.todo("resourceExists")};Ia.prototype.resourceEnsureExistance=
function(pa,Ja){Oa.todo("resourceEnsureExistance")};Ia.prototype.resourceMkdir=function(pa){Oa.todo("resourceMkdir")};Ia.prototype.resourceRead=function(pa){Oa.todo("resourceRead")};Ia.prototype.resourceRemove=function(pa){Oa.todo("resourceRemove")};Ia.prototype.resourceWrite=function(pa,Ja){Oa.todo("resourceWrite")};Ia.prototype.resourceCreateFiles=function(pa,Ja){Oa.todo("resourceCreateFiles")};Ia.prototype.resourceDirList=function(pa,Ja,X){Oa.todo("resourceDirList")};Ia.prototype.normalizeSync=
function(pa,Ja,X){Oa.todo("normalizeSync")};Ia.prototype.normalize=function(pa,Ja,X){Oa.todo("normalize")};Ia.prototype.printSystemConfig=function(){Oa.todo("printSystemConfig")};Ia.prototype.getConfig=function(){Oa.todo("getConfig")};Ia.prototype.setConfig=function(pa){Oa.todo("setConfig")};Ia.prototype.getPackages=function(pa){Oa.todo("getPackages")};Ia.prototype.isModuleLoaded=function(pa,Ja){Oa.todo("isModuleLoaded")};Ia.prototype.doesModuleExist=function(pa,Ja){Oa.todo("doesModuleExist")};Ia.prototype.getModules=
function(){var pa=this,Ja,X;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ua){return 1==ua.nextAddress?(Ja=Oa.arr,X=Ja.flatmap,ua.yield(pa.getPackages(),2)):ua.return(X.call(Ja,ua.yieldResult,function(ab){return ab.modules}))})};Ia.prototype.getModule=function(pa){var Ja=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(X){return 1==X.nextAddress?X.yield(Ja.getModules(),2):X.return(X.yieldResult.find(function(ua){return ua.name===pa}))})};Ia.prototype.getPackage=function(pa){var Ja=
this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(X){return 1==X.nextAddress?(pa=pa.replace(/\/+$/,""),X.yield(Ja.getPackages(),2)):X.return(X.yieldResult.find(function(ua){return ua.address===pa||ua.name===pa}))})};Ia.prototype.getPackageForModule=function(pa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){Oa.todo("getPackageForModule");Ja.jumpToEnd()})};Ia.prototype.systemConfChange=function(pa){var Ja=Oa.parseJsonLikeObj(pa);["baseURL"].forEach(function(X){return delete Ja[X]});
return this.setConfig(Ja)};Ia.prototype.resourcesOfPackage=function(pa,Ja){return $jscomp.asyncExecutePromiseGeneratorProgram(function(X){Oa.todo("resourcesOfPackage");X.jumpToEnd()})};Ia.prototype.registerPackage=function(pa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){Oa.todo("registerPackage");Ja.jumpToEnd()})};Ia.prototype.importPackage=function(pa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){Oa.todo("importPackage");Ja.jumpToEnd()})};Ia.prototype.removePackage=
function(pa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){Oa.todo("removePackage");Ja.jumpToEnd()})};Ia.prototype.reloadPackage=function(pa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){Oa.todo("reloadPackage");Ja.jumpToEnd()})};Ia.prototype.packageConfChange=function(pa,Ja){return $jscomp.asyncExecutePromiseGeneratorProgram(function(X){Oa.todo("packageConfChange");X.jumpToEnd()})};Ia.prototype.importModule=function(pa){Oa.todo("importModule")};Ia.prototype.forgetModule=
function(pa,Ja){Oa.todo("forgetModule")};Ia.prototype.reloadModule=function(pa,Ja){Oa.todo("reloadModule")};Ia.prototype.moduleFormat=function(pa){Oa.todo("moduleFormat")};Ia.prototype.moduleRead=function(pa){Oa.todo("moduleRead")};Ia.prototype.moduleSourceChange=function(pa,Ja,X){Oa.todo("moduleSourceChange")};Ia.prototype.importsAndExportsOf=function(pa,Ja){Oa.todo("importsAndExportsOf")};Ia.prototype.keyValueListOfVariablesInModule=function(pa,Ja){Oa.todo("keyValueListOfVariablesInModule")};Ia.prototype.moduleWrite=
function(pa,Ja){return this.moduleSourceChange(pa,Ja)};Oa.AbstractCoreInterface=Ia;var eb=function(){var pa=Oa.AbstractCoreInterface.call(this)||this;pa.currentEval=null;return pa};$jscomp.inherits(eb,Oa.AbstractCoreInterface);eb.prototype.runEval=function(pa,Ja){throw Error("Not yet implemented");};eb.prototype.runEvalAndStringify=function(pa,Ja){var X=this;return this.currentEval?this.currentEval.then(function(){return X.runEvalAndStringify(pa,Ja)}):this.currentEval=Promise.resolve().then(function(){var ua,
ab,rb,vc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bd){switch(Bd.nextAddress){case 1:return Bd.yield(X.runEval("\n        Promise.resolve((async "+Oa.transform.wrapInFunction(pa)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},Ja)),2);case 2:if((ua=Bd.yieldResult)&&ua.isError)throw Error(String(ua.value||ua.error));if(!ua||!ua.value)return Bd.return(null);if(ab=ua.promisedValue){Bd.jumpTo(3);break}return Bd.yield(ua.value,4);case 4:ab=Bd.yieldResult;case 3:rb=ab;if(!rb)return Bd.return();if("undefined"===rb)return Bd.return(void 0);if("null"===rb)return Bd.return(null);if("true"===rb)return Bd.return(!0);
if("false"===rb)return Bd.return(!1);try{vc=JSON.parse(rb)}catch(sc){return Bd.return(rb)}if(vc&&vc.isError)throw Error(String(vc.value));return Bd.return(vc)}})}).then(function(ua){delete X.currentEval;return ua},function(ua){delete X.currentEval;return Promise.reject(ua)})};eb.prototype.dynamicCompletionsForPrefix=function(pa,Ja,X){var ua=this,ab,rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vc){ab=Oa.obj.isString(X.context)?X.context:!1;X=Oa.obj.dissoc(X,["systemInterface","System",
"context"]);rb="\n      var prefix = "+JSON.stringify(Ja)+",\n          opts = "+JSON.stringify(X)+";\n      opts.context = "+ab+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return vc.return(ua.runEvalAndStringify(rb))})};eb.prototype.evalWithResource=function(pa,Ja,X){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+pa+'").'+Ja+"("+(X?JSON.stringify(X):"")+");\n    ")};eb.prototype.resourceExists=function(pa){return this.evalWithResource(pa,"exists")};eb.prototype.resourceEnsureExistance=function(pa,Ja){return this.evalWithResource(pa,
"ensureExistance",Ja)};eb.prototype.resourceMkdir=function(pa){return this.evalWithResource(pa,"mkdir")};eb.prototype.resourceRead=function(pa){return this.evalWithResource(pa,"read")};eb.prototype.resourceRemove=function(pa){return this.evalWithResource(pa,"remove")};eb.prototype.resourceWrite=function(pa,Ja){return this.evalWithResource(pa,"write",Ja)};eb.prototype.resourceCreateFiles=function(pa,Ja){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
pa+'", '+JSON.stringify(Ja)+")")};eb.prototype.resourceDirList=function(pa,Ja,X){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+pa+'").dirList('+JSON.stringify(Ja)+", "+JSON.stringify(X)+"))\n        .map(({url}) => ({url}))")};eb.prototype.livelySystemAccessor=function(pa){pa=void 0===pa?"livelySystem":pa;return"var "+pa+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
pa+') throw new Error("lively-system-interface not available!");'};eb.prototype.normalizeSync=function(pa,Ja,X){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(pa)+", "+JSON.stringify(Ja)+", "+X+")")};eb.prototype.normalize=function(pa,Ja,X){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(pa)+", "+JSON.stringify(Ja)+", "+JSON.stringify(X)+")")};eb.prototype.printSystemConfig=function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")};
eb.prototype.getConfig=function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')};eb.prototype.setConfig=function(pa){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(pa)+")")};eb.prototype.getPackages=function(pa){pa=Object.assign({excluded:[]},pa);pa.excluded=pa.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(pa)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')};eb.prototype.getPackageForModule=function(pa){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(pa)+")")};eb.prototype.isModuleLoaded=function(pa,Ja){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+pa+'", '+Ja+")")};eb.prototype.doesModuleExist=function(pa,Ja){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+pa+'", '+Ja+")")};eb.prototype.registerPackage=function(pa){var Ja=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(X){return X.return(Ja.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(pa)+")"))})};
eb.prototype.importPackage=function(pa){var Ja=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(X){return X.return(Ja.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(pa)+")"))})};eb.prototype.removePackage=function(pa){var Ja=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(X){return X.return(Ja.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(pa)+")"))})};eb.prototype.reloadPackage=function(pa,Ja){var X=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ua){return ua.return(X.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(pa)+", "+JSON.stringify(Ja)+")"))})};eb.prototype.packageConfChange=function(pa,Ja){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(pa)+", "+JSON.stringify(Ja)+")")};eb.prototype.resourcesOfPackage=function(pa,Ja){Ja=void 0===Ja?[".git","node_modules",".module_cache","lively.next-node_modules"]:Ja;var X=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ua){pa.address&&
(pa=pa.address);return ua.return(X.runEvalAndStringify("\n      "+X.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(pa)+", "+JSON.stringify(Ja)+");"))})};eb.prototype.getModule=function(pa){var Ja=this,X;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ua){if(1==ua.nextAddress)return ua.yield(Ja.getModules(),2);X=ua.yieldResult.find(function(ab){return ab.name===pa});return ua.return(X?Oa.modules.module(X.name):null)})};eb.prototype.importModule=
function(pa){return this.runEvalAndStringify("lively.modules.System.import("+JSON.stringify(pa)+")")};eb.prototype.forgetModule=function(pa,Ja){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(pa)+").unload("+JSON.stringify(Ja)+")")};eb.prototype.reloadModule=function(pa,Ja){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(pa)+").reload("+JSON.stringify(Ja)+")")};eb.prototype.moduleFormat=function(pa){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(pa)+").format();")};eb.prototype.moduleRead=function(pa){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(pa)+").source()")};eb.prototype.moduleSourceChange=function(pa,Ja,X){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(pa)+").changeSource("+JSON.stringify(Ja)+", "+JSON.stringify(X)+")")};eb.prototype.keyValueListOfVariablesInModule=function(pa,Ja){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+
JSON.stringify(pa)+", "+JSON.stringify(Ja)+")")};eb.prototype.importsAndExportsOf=function(pa,Ja){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(pa)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(pa)+").exports()})")};eb.prototype.exportsOfModules=function(pa){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(pa)+";\n      options.excludedPackages = ["+pa.excludedPackages.map(function(Ja){return"function"===
typeof Ja?Ja.toString():JSON.stringify(Ja)}).join(",")+"]\n      await livelySystem.localInterface.exportsOfModules(options)")};eb.prototype.searchInPackage=function(pa,Ja,X){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(pa)+", "+JSON.stringify(Ja)+", "+JSON.stringify(X)+")")};eb.prototype.loadMochaTestFile=function(pa,Ja){Ja=void 0===Ja?[]:Ja;var X=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ua){return ua.return(X.runEvalAndStringify("\n      "+
X.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(pa)+", "+JSON.stringify(Ja)+"), result;\n      result = {testsByFile}"))})};eb.prototype.runMochaTests=function(pa,Ja,X,ua){var ab=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rb){pa&&pa instanceof RegExp&&(pa={isRegExp:!0,value:String(pa).replace(/^\/|\/$/g,"")});return rb.return(ab.runEvalAndStringify("\n      var grep = "+JSON.stringify(pa)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
ab.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(Ja||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})};
Oa.RemoteCoreInterface=eb;var cb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");cb.obj=bc;cb.string=Oc;cb.arr=Ib;cb.resource=nc;cb.createFiles=qd;cb.ast=zb;cb.modules=Yc;cb.vm=ie;cb.parseJsonLikeObj=ne;cb.AbstractCoreInterface=Ia;cb.classToFunctionTransform=Ye;Ia=function(){return cb.AbstractCoreInterface.apply(this,arguments)||this};$jscomp.inherits(Ia,cb.AbstractCoreInterface);Ia.prototype.dynamicCompletionsForPrefix=function(pa,Ja,X){var ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){if(1==
ab.nextAddress)return ab.yield(cb.vm.completions.getCompletions(function(rb){return cb.vm.runEval(rb.replace("return ",""),Object.assign({targetModule:pa,classTransform:cb.classToFunctionTransform},X))},Ja),2);ua=ab.yieldResult;if(ua.isError)throw ua.value;return ab.return({completions:ua.completions,prefix:ua.startLetters})})};Ia.prototype.runEval=function(pa,Ja){return cb.vm.runEval(pa,Object.assign({classTransform:cb.classToFunctionTransform},Ja))};Ia.prototype.resourceExists=function(pa){return cb.resource(pa).exists()};
Ia.prototype.resourceEnsureExistance=function(pa,Ja){return cb.resource(pa).ensureExistance(Ja)};Ia.prototype.resourceMkdir=function(pa){return cb.resource(pa).mkdir()};Ia.prototype.resourceRead=function(pa){return cb.resource(pa).read()};Ia.prototype.resourceRemove=function(pa){return cb.resource(pa).remove()};Ia.prototype.resourceWrite=function(pa,Ja){return cb.resource(pa).write(Ja)};Ia.prototype.resourceCreateFiles=function(pa,Ja){return cb.createFiles(pa,Ja)};Ia.prototype.resourceDirList=function(pa,
Ja,X){return cb.resource(pa).dirList(Ja,X)};Ia.prototype.normalizeSync=function(pa,Ja,X){return System.decanonicalize(pa,Ja,X)};Ia.prototype.normalize=function(pa,Ja,X){return System.normalize(pa,Ja,X)};Ia.prototype.printSystemConfig=function(){return cb.modules.printSystemConfig()};Ia.prototype.getConfig=function(){return System.getConfig()};Ia.prototype.setConfig=function(pa){cb.modules.System.config(pa)};Ia.prototype.getPackages=function(pa){pa=Object.assign({},pa);pa=void 0===pa.excluded?[]:pa.excluded;
var Ja=pa.filter(function(ua){return"string"===typeof ua}),X=pa.filter(function(ua){return"function"===typeof ua});Ja=Ja.concat(Ja.map(function(ua){return System.decanonicalize(ua.replace(/\/?$/,"/")).replace(/\/$/,"")}));return cb.modules.getPackages().filter(function(ua){return!Ja.includes(ua.url)&&!X.some(function(ab){return ab(ua.url)})})};Ia.prototype.registerPackage=function(pa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){return Ja.return(cb.modules.registerPackage(pa))})};
Ia.prototype.importPackage=function(pa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){return Ja.return(cb.modules.importPackage(pa))})};Ia.prototype.removePackage=function(pa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){return Ja.return(cb.modules.removePackage(pa))})};Ia.prototype.reloadPackage=function(pa,Ja){return $jscomp.asyncExecutePromiseGeneratorProgram(function(X){return X.return(cb.modules.reloadPackage(pa,Ja))})};Ia.prototype.packageConfChange=function(pa,
Ja){var X=this,ua,ab,rb,vc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bd){if(1==Bd.nextAddress)return ua=cb.modules.System,ab=cb.parseJsonLikeObj(pa),rb=JSON.stringify(ab,null,2),Bd.yield(cb.modules.module(Ja).changeSource(rb,{doEval:!1}),2);if(3!=Bd.nextAddress)return ua.set(Ja,ua.newModule(ab)),Bd.yield(X.getPackageForModule(Ja),3);(vc=Bd.yieldResult)&&cb.modules.applyPackageConfig(ab,vc.address);Bd.jumpToEnd()})};Ia.prototype.resourcesOfPackage=function(pa,Ja){Ja=void 0===Ja?[".git",
"node_modules",".module_cache"]:Ja;var X,ua,ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rb){if(1==rb.nextAddress)return rb.setCatchFinallyBlocks(2),X=pa.address?pa.address:pa,ua=cb.modules.getPackage(X),rb.yield(ua.resources(void 0,Ja),4);if(2!=rb.nextAddress)return rb.return(rb.yieldResult.map(function(vc){return Object.assign(vc,{package:vc.package.url})}));ab=rb.enterCatchBlock();console.warn("resourcesOfPackage error for "+pa+": "+ab);return rb.return([])})};Ia.prototype.getPackageForModule=
function(pa){return(pa=cb.modules.getPackageOfModule(pa))?pa.asSpec():pa};Ia.prototype.isModuleLoaded=function(pa,Ja){return cb.modules.isModuleLoaded(pa,Ja)};Ia.prototype.doesModuleExist=function(pa,Ja){return cb.modules.isModuleLoaded(pa,Ja)};Ia.prototype.getModule=function(pa){return cb.modules.module(pa)};Ia.prototype.importModule=function(pa){return cb.modules.System.import(pa)};Ia.prototype.forgetModule=function(pa,Ja){return cb.modules.module(pa).unload(Ja)};Ia.prototype.reloadModule=function(pa,
Ja){return cb.modules.module(pa).reload(Ja)};Ia.prototype.moduleFormat=function(pa){return cb.modules.module(pa).format()};Ia.prototype.moduleRead=function(pa){return cb.modules.module(pa).source()};Ia.prototype.moduleSourceChange=function(pa,Ja,X){return cb.modules.module(pa).changeSource(Ja,X)};Ia.prototype.keyValueListOfVariablesInModule=function(pa,Ja){var X=this,ua,ab,rb,vc,Bd,sc,Nb,Yd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Cd){switch(Cd.nextAddress){case 1:if(Ja){Cd.jumpTo(2);
break}return Cd.yield(X.resourceRead(pa),3);case 3:Ja=Cd.yieldResult;case 2:return ua="string"===typeof Ja?cb.ast.parse(Ja):Ja,ab=X.normalizeSync(pa),X.moduleFormat(ab),rb=cb.modules.module(ab).env().recorder,Cd.yield(X.importsAndExportsOf(ab,ua),4);case 4:return vc=Cd.yieldResult,Bd=cb.ast.query.topLevelDeclsAndRefs(ua),sc=cb.arr.sortByKey(cb.ast.query.declarationsOfScope(Bd.scope,!0),"start"),Nb=cb.arr.pluck(Bd.scope.importSpecifiers,"name"),Yd=0,Cd.return(sc.map(function(kb){var Cb=kb.name.length,
$c=vc.exports.find(function(hd){return hd.local===kb.name}),sb=cb.arr.include(Nb,kb.name);$c&&(Cb+=9);sb&&(Cb+=9);Yd=Math.max(Yd,Cb);return{isExport:$c,isImport:sb,name:kb.name,value:rb[kb.name],node:kb,printedName:kb.name+($c?" [export]":"")+(sb?" [import]":""),printedValue:cb.obj.inspect(rb[kb.name],{maxDepth:1}).replace(/\n/g,"")}}).map(function(kb){return{isListItem:!0,value:kb,string:kb.printedName+cb.string.indent(" = "+kb.printedValue," ",Yd-kb.printedName.length)}}))}})};Ia.prototype.importsAndExportsOf=
function(pa,Ja){var X;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ua){return 1==ua.nextAddress?ua.yield(cb.modules.module(pa).imports(Ja),2):3!=ua.nextAddress?(X=ua.yieldResult,ua.yield(cb.modules.module(pa).exports(Ja),3)):ua.return({imports:X,exports:ua.yieldResult})})};Ia.prototype.exportsOfModules=function(pa){return cb.modules.ExportLookup.run(System,pa)};Ia.prototype.searchInPackage=function(pa,Ja,X){return cb.modules.getPackage(pa).search(Ja,X)};Ia.prototype.runMochaTests=function(pa,
Ja,X,ua){var ab,rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vc){if(1==vc.nextAddress)return vc.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);ab=vc.yieldResult;rb=ab.runMochaTests;return vc.return(rb(pa,Ja,X,ua))})};Ia.prototype.loadMochaTestFile=function(pa,Ja){var X,ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){if(1==ab.nextAddress)return ab.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);X=ab.yieldResult;
ua=X.loadMochaTestFile;return ab.return(ua(pa,Ja))})};$jscomp.global.Object.defineProperties(Ia.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"local"}}});cb.LocalCoreInterface=Ia;var ob=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");ob.evalStrategies=sf;ob.RemoteCoreInterface=eb;var Zb=function(pa){var Ja=ob.RemoteCoreInterface.call(this)||this;Ja.currentEval=null;Ja.url=pa;Ja.server=new ob.evalStrategies.HttpEvalStrategy(pa);return Ja};
$jscomp.inherits(Zb,ob.RemoteCoreInterface);Zb.prototype.runEval=function(pa,Ja){return this.server.runEval(pa,Ja)};$jscomp.global.Object.defineProperties(Zb.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this.url}},description:{configurable:!0,enumerable:!0,get:function(){return this.url.replace(/^https?:\/\//,"")}}});ob.HTTPCoreInterface=Zb;var mc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");mc.evalStrategies=sf;mc.RemoteCoreInterface=
eb;eb=function(pa,Ja){var X=mc.RemoteCoreInterface.call(this)||this;X.targetId=pa;X.peer=Ja;return X};$jscomp.inherits(eb,mc.RemoteCoreInterface);eb.prototype.isConnected=function(){var pa=this,Ja,X,ua,ab,rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vc){if(1==vc.nextAddress)return Ja=pa,X=Ja.client,ua=Ja.targetId,vc.yield(X.sendToAndWait(X.trackerId,"getClients",{}),2);ab=vc.yieldResult;rb=ab.data;return vc.return(rb.some(function(Bd){Bd=$jscomp.makeIterator(Bd).next().value;return ua===
Bd}))})};eb.prototype.runEval=function(pa,Ja){var X=this,ua,ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rb){ua=X.client;if(!ua)throw Error("No lively.2lively default client available!");ab=new mc.evalStrategies.L2LEvalStrategy(ua,X.targetId);return rb.return(ab.runEval(pa,Ja))})};$jscomp.global.Object.defineProperties(eb.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"l2l "+this.targetId}},description:{configurable:!0,enumerable:!0,get:function(){var pa=this.peer,
Ja="l2l "+this.targetId.slice(0,5);if(pa){var X=pa.location,ua=pa.type,ab=pa.user;pa=pa.world;ua&&(Ja+=", "+ua);X&&(Ja+=", "+X.replace(/^https?:\/\//,"")+(pa?"/"+pa:""));ab&&(Ja+=", "+ab.name)}return Ja}},client:{configurable:!0,enumerable:!0,get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}}});mc.L2LCoreInterface=eb;var Tb=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");Tb.systemInterfaceNamed=Bb;
Tb.interactivelyCreatePackage=cc;Tb.interactivelyLoadPackage=Hc;Tb.interactivelyReloadPackage=Md;Tb.interactivelyUnloadPackage=fc;Tb.interactivelyRemovePackage=$d;Tb.showExportsAndImportsOf=pe;Tb.shortModuleName=Ic;Tb.interactivelyChangeModule=Sb;Tb.interactivelyReloadModule=Jc;Tb.interactivelyUnloadModule=dd;Tb.interactivelyRemoveModule=Jd;Tb.interactivelyAddModule=Kd;Tb.modulesInPackage=Hb;Tb.LocalCoreInterface=Ia;Tb.HTTPCoreInterface=Zb;Tb.L2LCoreInterface=eb;eb=function(pa){this.coreInterface=
pa};eb.prototype.dynamicCompletionsForPrefix=function(pa,Ja,X){return this.coreInterface.dynamicCompletionsForPrefix(pa,Ja,X)};eb.prototype.runEval=function(pa,Ja){return this.coreInterface.runEval(pa,Ja)};eb.prototype.printSystemConfig=function(pa,Ja,X){return this.coreInterface.printSystemConfig(pa,Ja,X)};eb.prototype.getConfig=function(pa,Ja,X){return this.coreInterface.getConfig(pa,Ja,X)};eb.prototype.getPackages=function(pa){return this.coreInterface.getPackages(pa)};eb.prototype.getModules=
function(pa,Ja,X){return this.coreInterface.getModules(pa,Ja,X)};eb.prototype.getModule=function(pa,Ja,X){return this.coreInterface.getModule(pa,Ja,X)};eb.prototype.getPackage=function(pa,Ja,X){return this.coreInterface.getPackage(pa,Ja,X)};eb.prototype.getPackageForModule=function(pa,Ja,X){return this.coreInterface.getPackageForModule(pa,Ja,X)};eb.prototype.resourcesOfPackage=function(pa,Ja){return this.coreInterface.resourcesOfPackage(pa,Ja)};eb.prototype.systemConfChange=function(pa,Ja,X){return this.coreInterface.systemConfChange(pa,
Ja,X)};eb.prototype.registerPackage=function(pa){return this.coreInterface.registerPackage(pa)};eb.prototype.importPackage=function(pa){return this.coreInterface.importPackage(pa)};eb.prototype.removePackage=function(pa){return this.coreInterface.removePackage(pa)};eb.prototype.reloadPackage=function(pa){return this.coreInterface.reloadPackage(pa)};eb.prototype.packageConfChange=function(pa,Ja){return this.coreInterface.packageConfChange(pa,Ja)};eb.prototype.keyValueListOfVariablesInModule=function(pa,
Ja){return this.coreInterface.keyValueListOfVariablesInModule(pa,Ja)};eb.prototype.interactivelyCreatePackage=function(pa){return Tb.interactivelyCreatePackage(this.coreInterface,pa)};eb.prototype.interactivelyLoadPackage=function(pa,Ja){return Tb.interactivelyLoadPackage(this.coreInterface,pa,Ja)};eb.prototype.interactivelyReloadPackage=function(pa,Ja){return Tb.interactivelyReloadPackage(this.coreInterface,pa,Ja)};eb.prototype.interactivelyUnloadPackage=function(pa,Ja,X){return Tb.interactivelyUnloadPackage(this.coreInterface,
pa,Ja,X)};eb.prototype.interactivelyRemovePackage=function(pa,Ja){return Tb.interactivelyRemovePackage(this.coreInterface,pa,Ja)};eb.prototype.isModuleLoaded=function(pa,Ja){return this.coreInterface.isModuleLoaded(pa,Ja)};eb.prototype.doesModuleExist=function(pa,Ja){return this.coreInterface.doesModuleExist(pa,Ja)};eb.prototype.importModule=function(pa){return this.coreInterface.importModule(pa)};eb.prototype.forgetModule=function(pa,Ja){return this.coreInterface.forgetModule(pa,Ja)};eb.prototype.reloadModule=
function(pa,Ja){return this.coreInterface.reloadModule(pa,Ja)};eb.prototype.moduleFormat=function(pa){return this.coreInterface.moduleFormat(pa)};eb.prototype.moduleRead=function(pa){return this.coreInterface.moduleRead(pa)};eb.prototype.moduleWrite=function(pa,Ja){return this.coreInterface.moduleWrite(pa,Ja)};eb.prototype.getModulesInPackage=function(pa){return Tb.modulesInPackage(this.coreInterface,pa)};eb.prototype.shortModuleName=function(pa,Ja){return Tb.shortModuleName(this.coreInterface,pa,
Ja)};eb.prototype.interactivelyChangeModule=function(pa,Ja,X){return Tb.interactivelyChangeModule(this.coreInterface,pa,Ja,X)};eb.prototype.interactivelyReloadModule=function(pa,Ja){return Tb.interactivelyReloadModule(this.coreInterface,pa,Ja)};eb.prototype.interactivelyUnloadModule=function(pa,Ja){return Tb.interactivelyUnloadModule(this.coreInterface,pa,Ja)};eb.prototype.interactivelyRemoveModule=function(pa,Ja){return Tb.interactivelyRemoveModule(this.coreInterface,pa,Ja)};eb.prototype.interactivelyAddModule=
function(pa,Ja){return Tb.interactivelyAddModule(this.coreInterface,pa,Ja)};eb.prototype.showExportsAndImportsOf=function(pa,Ja){return Tb.showExportsAndImportsOf(this.coreInterface,pa,Ja)};eb.prototype.exportsOfModules=function(pa){return this.coreInterface.exportsOfModules(pa)};eb.prototype.searchInPackage=function(pa,Ja,X){return this.coreInterface.searchInPackage(pa,Ja,X)};eb.prototype.searchInAllPackages=function(pa,Ja){Ja=void 0===Ja?{}:Ja;var X=this,ua,ab,rb,vc,Bd,sc,Nb,Yd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Cd){switch(Cd.nextAddress){case 1:return(ua=
Ja.progress)&&ua.step("Fetching Packages...",0),Cd.yield(X.coreInterface.getPackages({excluded:Ja.excludedPackages}),2);case 2:ab=Cd.yieldResult,rb=[],ua&&ua.step("Fetching Packages...",.1),vc=0;case 3:if(!(vc<ab.length)){Cd.jumpTo(5);break}Bd=ab[vc];sc=Bd.url;if(!sc||"no group"===sc){Cd.jumpTo(4);break}ua&&ua.step(sc.replace(System.baseURL,"").slice(0,20),.1+vc/ab.length*.9);Cd.setCatchFinallyBlocks(6);return Cd.yield(X.coreInterface.searchInPackage(sc,pa,Ja),8);case 8:Nb=Cd.yieldResult;rb=rb.concat(Nb);
Cd.leaveTryBlock(4);break;case 6:Yd=Cd.enterCatchBlock(),console.error("Error searching in package "+sc+":\n"+Yd.stack);case 4:vc++;Cd.jumpTo(3);break;case 5:return Cd.return(rb)}})};eb.prototype.loadMochaTestFile=function(pa,Ja){return this.coreInterface.loadMochaTestFile(pa,Ja)};eb.prototype.runMochaTests=function(pa,Ja,X,ua){return this.coreInterface.runMochaTests(pa,Ja,X,ua)};$jscomp.global.Object.defineProperties(eb.prototype,{isSystemInterface:{configurable:!0,enumerable:!0,get:function(){return!0}},
name:{configurable:!0,enumerable:!0,get:function(){return this.coreInterface.name}}});Ba("Interface",eb);Tb.Interface=eb;Tb.systemInterfaceNamed=Bb;Tb.systemInterfaceNamed=Bb;eb=Ba("localInterface",new Tb.Interface(new Tb.LocalCoreInterface));Tb.localInterface=eb;Tb.localInterface=eb;Tb.localInterface=eb;Tb.httpInterfaces={};eb=Ba("serverInterfaceFor",function(pa){return Tb.httpInterfaces[pa]||(Tb.httpInterfaces[pa]=new Tb.Interface(new Tb.HTTPCoreInterface(pa)))});Tb.serverInterfaceFor=eb;Tb.serverInterfaceFor=
eb;Tb.serverInterfaceFor=eb;Tb.l2lInterfaces={};eb=Ba("l2lInterfaceFor",function(pa,Ja){return Tb.l2lInterfaces[pa]||(Tb.l2lInterfaces[pa]=new Tb.Interface(new Tb.L2LCoreInterface(pa,Ja)))});Tb.l2lInterfaceFor=eb;Tb.l2lInterfaceFor=eb;Tb.l2lInterfaceFor=eb}}});