System.register(["./__root_module__-aa47e4cd.js","kld-intersections","./client-command-8f9bbcf2.js"],function(Ca){var ub,Tb,lc,mc,Zd,id;return{setters:[function(ce){ub=ce.s;Tb=ce._;lc=ce.a4;mc=ce.bD;Zd=ce.a5},function(){},function(ce){id=ce.runCommand}],execute:function(){function ce(eb,Hb){var Cc,qc,ld,wd,Xc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gd){if(1==gd.nextAddress)return Cc=Fd.fileInfoCommandString(eb,Hb),qc=Fd.runCommand(Cc,Hb),gd.yield(qc.whenDone(),2);if(ld=0!=
qc.exitCode?qc.output:null)throw ld;wd=$jscomp.makeIterator(Fd.parseDirectoryListFromLs(qc.stdout,Hb.rootDirectory||"."));Xc=wd.next().value;return gd.return(Xc)})}function kd(eb,Hb){return Fd.string.lines(eb).map(function(Cc){return Cc.trim().length?(new Fd.FileInfo(Hb)).readFromDirectoryListLine(Cc):null}).filter(Boolean)}function $c(eb,Hb){var Cc,qc,ld,wd,Xc,gd,bc,ad,ed;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Id){Cc=Object.assign({findFilesGroup:"default-find-files-process"},
Hb);qc=Cc.findFilesGroup;ld=Cc.rootDirectory;Xc=wd=Fd.findFilesProcesses[qc]||(Fd.findFilesProcesses[qc]={promiseState:null,commands:[]});gd=Xc.commands;bc=Xc.promiseState;bc||(wd.promiseState=bc=Fd.promise.deferred());ad=Fd.findFilesCommandString(eb,Hb);gd.forEach(function(hc){return hc.kill()});ed=Fd.runCommand(ad,Hb);gd.push(ed);ed.whenDone().then(function(){Fd.arr.remove(gd,ed);if(gd.some(function(Qb){return Qb.startTime>ed.startTime}))console.log("[findFiles] command "+ed+" exited but a newer findFiles command was started for group "+
qc+", discarding output");else{var hc=0!=ed.exitCode?ed.output:null;hc&&console.warn(hc);hc=hc?[]:Fd.parseDirectoryListFromLs(ed.stdout,ld)||[];bc.resolve(hc);Object.assign(wd,{promiseState:null,commands:[]})}}).catch(function(hc){return console.error(hc)});return Id.return(bc.promise)})}function Cd(eb){function Hb(Cc){return Array.prototype.concat.apply([Cc],Cc.children?Cc.children.map(Hb):[])}return Hb(eb).map(function(Cc){var qc=Cc.fullPath.replace(/^\//,"");return{fileName:qc,path:qc,rootDirectory:"./",
isDirectory:Cc.isDirectory,isLink:void 0,lastModified:void 0,linkCount:void 0,mode:void 0,size:void 0,group:void 0,user:void 0}})}var Fd=lively.FreezerRuntime.recorderFor("lively.shell/client-fs-helper.js");Fd.fileInfo=ce;Fd.fileInfoCommandString=function(eb,Hb){var Cc=Hb=void 0===Hb?{}:Hb;Hb=Cc.rootDirectory;Cc=Cc.platform;Hb=Hb||".";var qc="win32"===Cc?"\\":"/";"win32"===Cc||Hb.endsWith(qc)||(Hb+=qc);return"win32"===Cc?"cd "+Hb+' && ls -lLd --time-style=locale "'+eb+'"':'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && env TZ=GMT LANG=en_US.UTF-8 cd '+
(Hb+' && ls -lLd "$timeformat" "'+eb+'"')};Fd.parseDirectoryListFromLs=kd;Fd.findFiles=$c;Fd.findFilesCommandString=function(eb,Hb){var Cc=Hb=void 0===Hb?{}:Hb,qc=Cc.rootDirectory,ld=Cc.exclude,wd=Cc.depth;Cc=Cc.platform;qc=qc||".";ld=ld||"-iname "+Fd.defaultExcludes.map(Fd.string.print).join(" -o -iname ");var Xc="win32"===Cc?"\\":"/";"win32"===Cc||qc.endsWith(Xc)||(qc+=Xc);eb=Fd.string.format('%s "%s"',Hb.re?"-iregex":Hb.matchPath?"-ipath":"-iname",eb);wd="number"===typeof wd?" -maxdepth "+wd:"";
return"win32"===Cc?Fd.string.format("find %s %s ( %s ) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd --time-style=locale {}",qc,Hb.re?"-E ":"",ld.replace(/"/g,""),eb.replace(/"/g,""),wd):'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && '+Fd.string.format('env TZ=GMT LANG=en_US.UTF-8 find %s %s \\( %s \\) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd "$timeformat" "{}"',qc,Hb.re?"-E ":"",ld,eb,wd)};Fd.convertDirectoryUploadEntriesToFileInfos=
Cd;Fd.runCommand=id;Fd.string=ub;Fd.promise=Tb;Fd.arr=lc;Fd.fileInfo=ce;Fd.fileInfo=ce;Fd.parseDirectoryListFromLs=kd;Fd.parseDirectoryListFromLs=kd;var pe=function(eb){this.rootDirectory=eb;this.fileName=this.path="";this.isDirectory=!1;this.lastModified=null;this.mode="";this.isLink=!1;this.linkCount=0;this.group=this.user="";this.size=0;this.rootDirectory=null};pe.prototype.readFromDirectoryListLine=function(eb){var Hb=this;if(!eb.trim().length)return null;var Cc=eb;this.reader.forEach(function(qc){return Cc=
qc(Cc,Hb)});return this};pe.prototype.toString=function(){return this.path};$jscomp.global.Object.defineProperties(pe.prototype,{reader:{configurable:!0,enumerable:!0,get:function(){return[function(eb,Hb){var Cc=eb.indexOf(" ");Hb.mode=eb.slice(0,Cc);Hb.isDirectory="d"===Hb.mode[0];return eb.slice(Cc+1).trim()},function(eb,Hb){var Cc=eb.indexOf(" ");Hb.linkCount=Number(eb.slice(0,Cc));return eb.slice(Cc+1).trim()},function(eb,Hb){var Cc=eb.indexOf(" ");Hb.user=eb.slice(0,Cc);return eb.slice(Cc+1).trim()},
function(eb,Hb){var Cc=Fd.string.peekRight(eb,0,/\s+[0-9]/);Hb.group=eb.slice(0,Cc).trim();return eb.slice(Cc).trim()},function(eb,Hb){var Cc=eb.indexOf(" ");Hb.size=Number(eb.slice(0,Cc));return eb.slice(Cc+1).trim()},function(eb,Hb){var Cc=Fd.string.reMatches(eb,/[^s]+\s+[0-9:\s]+/);if(!Cc||!Cc[0])return eb;Hb.lastModified=new Date(Cc[0].match+" GMT");return eb.slice(Cc[0].end).trim()},function(eb,Hb){var Cc=(eb=eb.replace(/^\.\/+/g,"").replace(/\/\//g,"/"))&&eb.split(" -> "),qc=""===eb?!1:eb&&
2===Cc.length,ld=(Cc=qc?Cc[0]:eb)&&0===Cc.indexOf(Hb.rootDirectory)?Cc.slice(Hb.rootDirectory.length):Cc;Hb.fileName=""===eb?".":ld;Hb.path=Cc;Hb.isLink=qc;return ld}]}}});Fd.FileInfo=pe;Fd.findFilesProcesses={};Fd.findFiles=$c;Fd.findFiles=$c;Fd.defaultExcludes=[".svn",".git","node_modules",".module_cache"];Fd.convertDirectoryUploadEntriesToFileInfos=Cd;Fd.convertDirectoryUploadEntriesToFileInfos=Cd;var Xd=lively.FreezerRuntime.recorderFor("lively.shell/client-resource.js");Xd.Resource=mc;Xd.runCommand=
id;Xd.fileInfo=ce;Xd.findFiles=$c;Xd.string=ub;Xd.promise=Tb;Xd.arr=lc;Xd.obj=Zd;pe=function(eb,Hb,Cc){Cc=void 0===Cc?{}:Cc;eb=Xd.Resource.call(this,eb)||this;eb.options=Object.assign({},Cc,{l2lClient:Hb||eb.constructor.defaultL2lClient});return eb};$jscomp.inherits(pe,Xd.Resource);pe.prototype.newResource=function(eb){return new this.constructor(eb,this.options.l2lClient,this.options)};pe.prototype.read=function(){var eb=this,Hb=Xd.runCommand('cat "'+this.url+'"',this.options);return Hb.whenDone().then(function(){if(Hb.exitCode)throw Error("Read "+
eb.url+" failed: "+Hb.stderr);return Hb.output})};pe.prototype.write=function(eb){var Hb=this,Cc,qc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ld){switch(ld.nextAddress){case 1:return eb?ld.yield(Xd.runCommand('touch "'+Hb.url+'" && tee "'+Hb.url+'"',Object.assign({stdin:String(eb)},Hb.options)).whenDone(),4):ld.yield(Xd.runCommand('echo -n > "'+Hb.url+'"',Object.assign({},Hb.options)).whenDone(),5);case 4:Cc=ld.yieldResult;ld.jumpTo(3);break;case 5:Cc=ld.yieldResult;case 3:qc=Cc;
if(qc.exitCode)throw Error("Write "+Hb.url+" failed: "+qc.stderr);return ld.return(Hb)}})};pe.prototype.mkdir=function(){var eb=this,Hb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Cc){if(1==Cc.nextAddress)return Cc.yield(Xd.runCommand('mkdir -p "'+eb.url+'"',eb.options).whenDone(),2);Hb=Cc.yieldResult;if(Hb.exitCode)throw Error(eb+" cannot create directory: "+Hb.stderr);return Cc.return(eb)})};pe.prototype.exists=function(){var eb=Xd.runCommand('test -d "'+this.url+'" || test -f "'+
this.url+'"',this.options);return eb.whenDone().then(function(){return 0===eb.exitCode})};pe.prototype.remove=function(){var eb=this,Hb=Xd.runCommand('rm -rf "'+this.url+'"',this.options);return Hb.whenDone().then(function(){if(Hb.exitCode)throw Error("Remove of "+eb.url+" failed: "+Hb.stderr);return eb})};pe.prototype.gzip=function(eb){var Hb=this,Cc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qc){Cc=Xd.runCommand('gzip > "'+Hb.url+'"',Object.assign({stdin:String(eb)},Hb.options));
return qc.return(Cc.whenDone().then(function(){if(Cc.exitCode)throw Error("Gzip compression of "+Hb.url+" failed: "+Cc.stderr);return Hb}))})};pe.prototype.brotli=function(eb){var Hb=this,Cc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qc){Cc=Xd.runCommand('brotli > "'+Hb.url+'"',Object.assign({stdin:String(eb)},Hb.options));return qc.return(Cc.whenDone().then(function(){if(Cc.exitCode)throw Error("Brotli compression of "+Hb.url+" failed: "+Cc.stderr);return Hb}))})};pe.prototype.readProperties=
function(){var eb=this,Hb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Cc){if(1==Cc.nextAddress)return Cc.yield(Xd.fileInfo(eb.url,eb.options),2);Hb=Cc.yieldResult;eb.assignProperties(Xd.obj.dissoc(Hb,["fileName","path","rootDirectory"]));return Cc.return(eb)})};pe.prototype.dirList=function(eb,Hb){eb=void 0===eb?1:eb;Hb=void 0===Hb?{}:Hb;var Cc=this,qc,ld,wd,Xc,gd,bc,ad;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ed){if(1==ed.nextAddress)return qc=Hb,ld=qc.exclude,
Array.isArray(ld)&&(ld="-iname "+ld.map(Xd.string.print).join(" -o -iname ")),wd=Cc,Xc=wd.url,gd=wd.options,bc=gd.l2lClient,ed.yield(Xd.findFiles("*",{exclude:ld,depth:eb,rootDirectory:Xc,l2lClient:bc}),2);ad=ed.yieldResult;ad[0].path.replace(/\/$/,"")===Cc.url.replace(/\/$/,"")&&ad.shift();return ed.return(ad.map(function(Id){var hc=Id.path;Id.isDirectory&&(hc=hc.replace(/\/?$/,"/"));hc=new Cc.constructor(hc,bc,Cc.options);hc.assignProperties(Xd.obj.dissoc(Id,["fileName","path","rootDirectory"]));
return hc}))})};$jscomp.global.Object.defineProperties(pe,{defaultL2lClient:{configurable:!0,enumerable:!0,get:function(){return this._defaultL2lClient||Xd._defaultL2LClient},set:function(eb){this._defaultL2lClient=Xd._defaultL2LClient=eb}}});Ca("default",pe);Xd.ShellClientResource=pe;Xd._defaultL2LClient=Xd._defaultL2LClient||void 0;var nd=Ca("resourceExtension",{name:"shell-client",matches:function(eb){return eb.startsWith("/")||eb.match(/[a-z]:\\/i)},resourceClass:Xd.ShellClientResource});Xd.resourceExtension=
nd;Xd.resourceExtension=nd;Xd.resourceExtension=nd;Xd.default=pe}}});