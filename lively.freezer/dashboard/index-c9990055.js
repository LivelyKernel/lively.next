System.register(["./__root_module__-7efb35ac.js","kld-intersections"],function(Ba){var Cb,Sb,jc,lc,Xd,ed,Yd,id,Wc,Ad,Cd,fe,Sd;return{setters:[function(jd){Cb=jd.bt;Sb=jd.a4;jc=jd.r;lc=jd.a5;Xd=jd.bn;ed=jd.bu;Yd=jd.bv;id=jd.T;Wc=jd.s;Ad=jd.bw;Cd=jd.bx;fe=jd.n;Sd=jd.by},function(){}],execute:function(){function jd(Q){try{var fa=eval("("+za.ast.transform.wrapInFunction("var _; _ = ("+Q+")")+")()")}catch(Ia){return JSON.parse(Q)}return"object"!==typeof fa?null:fa}function bb(Q,fa){var Ia,Qa,ec,Nb,
Za,ic,ld,xd,Yc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){switch(Ua.nextAddress){case 1:return Ia=fa.world(),Ua.yield(Ia.prompt("Enter package name",{requester:fa,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:Qa=Ua.yieldResult;if(!Qa)throw"Canceled";Ua.setCatchFinallyBlocks(3);Nb=cb.resource(Qa);Qa=Nb.name();ec=Nb.url;Ua.leaveTryBlock(4);break;case 3:return Ua.enterCatchBlock(),Ua.yield(Q.getConfig(),5);case 5:return Za=Ua.yieldResult.baseURL,
ic=cb.resource(Za).join(Qa).asDirectory().url,Ua.yield(Q.normalize(ic),6);case 6:ec=Ua.yieldResult.replace(/\/\.js$/,"/");case 4:return Ua.yield(Ia.prompt("Confirm or change package location",{requester:fa,input:ec,historyId:"lively.vm-editor-add-package-address"}),7);case 7:ld=Ua.yieldResult;if(!ld)throw"Canceled";xd=cb.resource(ld).asDirectory();Yc=xd.asFile().url;return Ua.yield(Q.removePackage(Yc),8);case 8:return Ua.yield(Q.resourceCreateFiles(Yc,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+
Qa+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+Qa+"\n\nNo description for package "+Qa+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+Qa+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return Ua.return(cb.loadPackage(Q,{name:Qa,address:Yc,configFile:xd.join("package.json").url,main:xd.join("index.js").url,test:xd.join("tests/test.js").url,type:"package"}))}})}function Fb(Q,fa,Ia){Ia=void 0===Ia?
null:Ia;var Qa,ec,Nb,Za,ic,ld,xd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yc){switch(Yc.nextAddress){case 1:return Qa={name:"",address:"",type:"package"},Yc.yield(Q.getConfig(),2);case 2:ec=Yc.yieldResult;if(!Ia){Yc.jumpTo(3);break}return Yc.yield(Q.getPackage(Ia),4);case 4:if(Nb=Yc.yieldResult){Yc.jumpTo(5);break}return Yc.yield(Q.getPackageForModule(Ia),6);case 6:Nb=Yc.yieldResult;case 5:Za=Nb;case 3:return Yc.yield(fa.world().prompt("What is the package directory?",{requester:fa,
input:Za?Za.address:ec.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:ic=Yc.yieldResult;if(!ic)throw"Canceled";Qa.address=ic.replace(/\/$/,"");Qa.url=new URL(Qa.address+"/");Qa.configFile=cb.resource(Qa.url).join("package.json").url;Yc.setCatchFinallyBlocks(8);ld=JSON;xd=ld.parse;return Yc.yield(Q.moduleRead(Qa.configFile),10);case 10:xd.call(ld,Yc.yieldResult).name;Yc.leaveTryBlock(9);break;case 8:Yc.enterCatchBlock(),Qa.name=String(Qa.url).replace(/\/$/,""),
Q.resourceEnsureExistance(Qa.configFile,'{\n  "name": "'+Qa.name+'",\n  "version": "0.1.0"\n}');case 9:return Yc.return(cb.loadPackage(Q,Qa))}})}function vc(Q,fa,Ia){var Qa,ec,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Za){switch(Za.nextAddress){case 1:return Qa=cb.resource(Ia).asFile().url,Za.yield(Q.getPackage(Qa),2);case 2:if(ec=Za.yieldResult){Za.jumpTo(3);break}return Za.yield(Q.getPackageForModule(Qa),4);case 4:ec=Za.yieldResult;case 3:Nb=ec;if(!Nb)throw Error("Cannot find package for "+
Qa);return Za.yield(Q.reloadPackage(Qa),5);case 5:if(!fa){Za.jumpTo(0);break}return Za.yield(fa.updateModuleList(),7);case 7:return Za.yield(fa.uiSelect(Qa,!1),8);case 8:return Za.return(Za.yieldResult)}})}function pc(Q,fa,Ia,Qa){var ec,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Za){switch(Za.nextAddress){case 1:return Za.yield(Q.getPackage(Ia),2);case 2:return ec=Za.yieldResult,Za.yield((Qa||$world).confirm("Unload package "+ec.name+"?",{requester:fa}),3);case 3:Nb=Za.yieldResult;
if(!Nb)throw"Canceled";return Za.yield(Q.removePackage(Ia),4);case 4:if(!fa){Za.jumpTo(0);break}return Za.yield(fa.updateModuleList(),6);case 6:return Za.yield(fa.uiSelect(null),0)}})}function sd(Q,fa,Ia){var Qa,ec,Nb,Za,ic;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ld){switch(ld.nextAddress){case 1:return Qa=fa.world(),ld.yield(Q.getPackage(Ia),2);case 2:return ec=ld.yieldResult,ec?ld.yield(Qa.confirm("Really remove package "+ec.name+"?",{requester:fa}),3):($world.inform('No package "'+
Ia+'" found!',{requester:fa}),ld.return());case 3:Nb=ld.yieldResult;if(!Nb)throw"Canceled";Q.removePackage(Ia);return ld.yield(Qa.confirm("Also remove directory "+ec.name+" including "+ec.modules.length+" modules?"),4);case 4:Za=ld.yieldResult;if(!Za){ld.jumpTo(0);break}return ld.yield(Qa.confirm("REALLY *remove* directory "+ec.name+"? No undo possible..."),6);case 6:if(ic=ld.yieldResult)return ld.yield(Q.resourceRemove(ec.address),0);ld.jumpTo(0)}})}function pd(Q,fa,Ia){Ia=void 0===Ia?$world:Ia;
var Qa,ec,Nb,Za,ic,ld,xd,Yc,Ua,Mc,pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fb){switch(fb.nextAddress){case 1:return fb.yield(Q.getPackage(fa),2);case 2:Qa=fb.yieldResult;if(!Qa)throw Error("Cannot find package "+fa);ec=[];Nb=$jscomp.makeIterator(Qa.modules);Za=Nb.next();case 3:if(Za.done)return fb.yield(Ia.execCommand("open text window",{title:"imports and exports of "+fa,content:ec.join("\n\n")}),0);ic=Za.value;if(!ic.name.match(/\.js$/)){fb.jumpTo(4);break}fb.setCatchFinallyBlocks(6);
ld=Q;xd=ld.importsAndExportsOf;Yc=ic.name;return fb.yield(Q.moduleRead(ic.name),9);case 9:return fb.yield(xd.call(ld,Yc,fb.yieldResult),8);case 8:Ua=fb.yieldResult;fb.leaveTryBlock(7);break;case 6:Mc=fb.enterCatchBlock();Ia.logError(Error("Error when getting imports/exports from module "+ic.name+":\n"+Mc.stack));fb.jumpTo(4);break;case 7:pb=""+ic.name;if(!Ua.imports.length&&!Ua.exports.length){pb+="\n  does not import / export anything";fb.jumpTo(4);break}Ua.imports.length&&(pb+="\n  imports:\n",
pb+=cb.arr.groupByKey(Ua.imports,"fromModule").mapGroups(function(eb,bc){return"from "+eb+": "+bc.map(function(ac){return ac.local||ac.imported?ac.imported&&ac.imported!==ac.local?ac.imported+" as "+ac.local:ac.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(eb){return"    "+eb}).join("\n"));Ua.exports.length&&(pb+="\n  exports:\n",pb+=Ua.exports.map(function(eb){return eb.local?eb.local&&eb.local!==eb.exported?eb.local+" as "+eb.exported:eb.exported:eb.exported+
" from "+eb.fromModule}).join(", ").split("\n").map(function(eb){return"    "+eb}).join("\n"));ec.push(pb);case 4:Za=Nb.next(),fb.jumpTo(3)}})}function tc(Q,fa,Ia){Ia=Ia&&Ia.address;if(Ia&&0===fa.indexOf(Ia))var Qa=fa.slice(Ia.length).replace(/^\//,"");else a:{Ia=Q.getConfig();if(!Ia||Ia.constructor!==Promise)try{Qa=String((new URL(fa)).relativePathFrom(new URL(Q.getConfig().baseURL)));break a}catch(ec){}Qa=fa}return Qa}function bd(Q,fa,Ia,Qa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ec){return 1==
ec.nextAddress?(Qa=Object.assign({targetModule:fa},Qa),ec.yield(Q.normalize(fa),2)):3!=ec.nextAddress?(fa=ec.yieldResult,ec.yield(Q.moduleSourceChange(fa,Ia,Qa),3)):ec.return(fa)})}function Xb(Q,fa,Ia,Qa,ec){Qa=void 0===Qa?!1:Qa;ec=void 0===ec?!1:ec;var Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Za){switch(Za.nextAddress){case 1:return fa&&fa.setStatusMessage("Reloading "+Ia),Za.setCatchFinallyBlocks(2),Za.yield(Q.reloadModule(Ia,{reloadDeps:Qa,resetEnv:ec}),4);case 4:if(!fa){Za.jumpTo(5);
break}return Za.yield(fa.updateModuleList(),6);case 6:case 5:fa&&fa.setStatusMessage("Reloded "+Ia);Za.leaveTryBlock(0);break;case 2:Nb=Za.enterCatchBlock();Za.setCatchFinallyBlocks(7);if(!fa){Za.jumpTo(9);break}return Za.yield(fa.updateEditorWithSourceOf(Ia),10);case 10:case 9:Za.leaveTryBlock(8);break;case 7:Za.enterCatchBlock();case 8:throw fa&&fa.showError(Nb),Nb;}})}function Tb(Q,fa,Ia){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){switch(Qa.nextAddress){case 1:return Qa.yield(Q.forgetModule(Ia,
{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!fa){Qa.jumpTo(3);break}return Qa.yield(fa.updateModuleList(),4);case 4:case 3:Qa.jumpToEnd()}})}function Oc(Q,fa,Ia){var Qa,ec,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Za){switch(Za.nextAddress){case 1:return Za.yield(Q.normalize(Ia),2);case 2:return Qa=Za.yieldResult,Za.yield(fa.world().confirm("Remove file "+Qa+"?",{requester:fa}),3);case 3:ec=Za.yieldResult;if(!ec)throw"Canceled";return Za.yield(Q.forgetModule(Qa),4);case 4:return Za.yield(Q.resourceRemove(Qa),
5);case 5:return Za.yield(Q.getPackageForModule(Qa),6);case 6:return Nb=Za.yieldResult,Za.return(Nb)}})}function td(Q,fa,Ia){var Qa,ec,Nb,Za,ic,ld,xd,Yc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){switch(Ua.nextAddress){case 1:return Qa=URL,Ua.yield(Q.getConfig(),2);case 2:ec=new Qa(Ua.yieldResult.baseURL);Nb=fa.world();if(!Ia){Ua.jumpTo(3);break}return Ua.yield(Q.getPackage(Ia),4);case 4:if(Za=Ua.yieldResult){Ua.jumpTo(5);break}return Ua.yield(Q.getPackageForModule(Ia),6);case 6:Za=
Ua.yieldResult;case 5:(ic=Za)&&(ec=new URL(ic.address));case 3:return Ua.yield(wb._searchForExistingFiles(fa,String(ec),ic),7);case 7:ld=Ua.yieldResult;if(!ld.includes("[create new module]")){Ua.jumpTo(8);break}return Ua.yield(wb._askForModuleName(Q,Ia||String(ec),Nb),9);case 9:xd=Ua.yieldResult,ld=[xd];case 8:return Ua.yield(wb._createAndLoadModules(Q,ld),10);case 10:return Yc=Ua.yieldResult,wb.arr.compact(Yc.map(function(Mc){return Mc.error})),Ua.return(Yc)}})}function Pb(Q,fa){var Ia,Qa,ec,Nb,
Za,ic,ld,xd,Yc,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Mc){if(1==Mc.nextAddress)return Mc.yield(Q.getPackage(fa),2);if(3!=Mc.nextAddress){Ia=Mc.yieldResult;if(!Ia||!Ia.address.match(/^http/))throw Error("Cannot load package "+fa);Qa=wb.resource(Ia.address);ec=[];Nb=$jscomp;Za=Nb.makeIterator;return Mc.yield(Qa.dirList(5,{exclude:wb.modulesInPackage_defaultExclude}),3)}ic=Za.call(Nb,Mc.yieldResult);for(ld=ic.next();!ld.done;ld=ic.next())Yc=xd=ld.value,Ua=Yc.url,Ua.match(/\.js$/)&&
Q.isModuleLoaded(Ua,!0)&&ec.push(Q.getModule(Ua));return Mc.return(ec)})}function tb(Q,fa){fa=void 0===fa?[]:fa;var Ia;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){if(1==Qa.nextAddress)return Qa.yield(System.import("mocha-es6/index.js"),2);Ia=Qa.yieldResult;return Qa.return(Ia.loadTestModuleAndExtractTestState(Q,fa))})}function hb(Q,fa,Ia,Qa){function ec(Mc){return new Promise(function(pb,fb){var eb=Hb.arr.compact(Mc.suite.suites).map(function(ac){return ac.file}),bc=Hb.chain(fa).filter(function(ac){return eb.includes(ac.file)}).pluck("tests").flatten().value();
if(!bc||!bc.length)return fb(Error("Trying to run tests of "+eb.join(", ")+" but cannot find them in loaded tests!"));Mc.reporter(function(ac){ac.on("test",function(Fd){try{var we=bc.find(function(Je){return Je.fullTitle===Fd.fullTitle()});we.state="running";"function"===typeof Ia&&Ia(we,"test")}catch(Je){"function"===typeof Qa&&Qa(Je,"test")}});ac.on("pass",function(Fd){try{var we=bc.find(function(Je){return Je.fullTitle===Fd.fullTitle()});we.state="succeeded";we.duration=Fd.duration;"function"===
typeof Ia&&Ia(we,"pass")}catch(Je){"function"===typeof Qa&&Qa(Je,"pass")}});ac.on("fail",function(Fd,we){try{var Je=function(Fe,Pd,Rb){Fe.state="failed";Fe.duration=Fe.duration;Fe.error=Pd},Lf=bc.find(function(Fe){return Fe.fullTitle===Fd.fullTitle()});if(Lf)Je(Lf,we,Fd.duration);else{var ud=Hb.arr.invoke(Fd.parent.tests,"fullTitle");bc.filter(function(Fe){return ud.includes(Fe.fullTitle)}).forEach(function(Fe){return Je(Fe,we,Fd.duration)})}"function"===typeof Ia&&Ia(Lf,"fail")}catch(Fe){"function"===
typeof Qa&&Qa(Fe,"fail")}})});Mc.run(function(ac){return pb({testsByFile:fa,mocha:Mc})})})}var Nb,Za,ic,ld,xd,Yc,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Mc){switch(Mc.nextAddress){case 1:Nb=$jscomp.makeIterator(fa),Za=Nb.next();case 2:if(Za.done){Mc.jumpTo(4);break}ld=ic=Za.value;xd=ld.file;return Mc.yield(Hb.loadMochaTestFile(xd,fa),5);case 5:return Yc=Mc.yieldResult,Ua=Yc.mocha,Q&&(Ua=Ua.grep(Q)),Mc.yield(ec(Ua),3);case 3:Za=Nb.next();Mc.jumpTo(2);break;case 4:return Mc.return({mocha:Ua,
testsByFile:fa})}})}function qb(Q){Q||(Q="local");if(Q.isSystemInterface)var fa=Q;else"string"===typeof Q&&Q.startsWith("l2l ")&&(Q={type:"l2l",id:Q.split(" ")[1]}),"string"!==typeof Q&&"l2l"===Q.type&&(fa=Xc.l2lInterfaceFor(Q.id,Q.info)),"string"!==typeof Q&&($world.setStatusMessage("Unknown system interface "+Q),Q="local"),fa||(fa=Q&&"local"!==Q?Xc.serverInterfaceFor(Q):Xc.localInterface);return fa}Ba("systemInterfaceNamed",qb);var za=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");
za.parseJsonLikeObj=jd;za.ast=Cb;za.parseJsonLikeObj=jd;za.parseJsonLikeObj=jd;var cb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");cb.loadPackage=function(Q,fa){var Ia,Qa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ec){switch(ec.nextAddress){case 1:return ec.yield(Q.importPackage(fa.address+"/"),2);case 2:if(!fa.main){ec.jumpTo(3);break}return ec.yield(Q.importModule(fa.main.toString()),3);case 3:if(!fa.test){ec.jumpTo(5);break}ec.setCatchFinallyBlocks(6);
return ec.yield(Q.importPackage("mocha-es6"),8);case 8:return Ia=ec.yieldResult,ec.yield(Ia.installSystemInstantiateHook(),9);case 9:return ec.yield(Q.importModule(fa.test.toString()),10);case 10:ec.leaveTryBlock(5);break;case 6:Qa=ec.enterCatchBlock(),console.warn("Cannot load test of new package: "+Qa);case 5:return ec.return(Q.getPackage(fa.address))}})};cb.interactivelyCreatePackage=bb;cb.interactivelyLoadPackage=Fb;cb.interactivelyReloadPackage=vc;cb.interactivelyUnloadPackage=pc;cb.interactivelyRemovePackage=
sd;cb.showExportsAndImportsOf=pd;cb.parseJsonLikeObj=jd;cb.arr=Sb;cb.resource=jc;cb.interactivelyCreatePackage=bb;cb.interactivelyCreatePackage=bb;cb.interactivelyLoadPackage=Fb;cb.interactivelyLoadPackage=Fb;cb.interactivelyReloadPackage=vc;cb.interactivelyReloadPackage=vc;cb.interactivelyUnloadPackage=pc;cb.interactivelyUnloadPackage=pc;cb.interactivelyRemovePackage=sd;cb.interactivelyRemovePackage=sd;cb.showExportsAndImportsOf=pd;cb.showExportsAndImportsOf=pd;var wb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");
wb.shortModuleName=tc;wb.interactivelyChangeModule=bd;wb.interactivelyReloadModule=Xb;wb.interactivelyUnloadModule=Tb;wb.interactivelyRemoveModule=Oc;wb.interactivelyAddModule=td;wb._askForModuleName=function(Q,fa,Ia){var Qa,ec;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){switch(Nb.nextAddress){case 1:return Nb.yield(Ia.prompt("Enter module name",{input:fa,historyId:"lively.vm-editor-add-module-name"}),2);case 2:fa=Nb.yieldResult;if(!fa)throw"Canceled";return Nb.yield(Q.normalize(fa),
3);case 3:return Qa=Nb.yieldResult,Nb.yield(Ia.confirm(["Create module \n",{},Qa,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:ec=Nb.yieldResult;if(!ec)throw"Canceled";return Nb.return(Qa)}})};wb._searchForExistingFiles=function(Q,fa,Ia){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){return String(fa).match(/^http/)?Qa.return(wb._searchForExistingFilesWeb(Q,fa,Ia)):Qa.return(wb._searchForExistingFilesManually(Q,fa,Ia))})};wb._searchForExistingFilesManually=function(Q,
fa,Ia){var Qa,ec;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){switch(Nb.nextAddress){case 1:return Nb.yield(Q.world().multipleChoicePrompt("Add Module",{requester:Q,choices:["Create New Module","Load Existing Module"]}),2);case 2:Qa=Nb.yieldResult;if("Create New Module"===Qa)return Nb.return("[create new module]");if("Load Existing Module"!==Qa){Nb.jumpTo(3);break}return Nb.yield(Q.world().prompt("URL of module?",{input:fa,requester:Q,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),
4);case 4:if(ec=Nb.yieldResult)return Nb.return([ec]);case 3:throw"Canceled";}})};wb._searchForExistingFilesWeb=function(Q,fa,Ia){function Qa(Yc){Yc.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(Yc.name())||Ia&&wb.arr.pluck(Ia.modules,"name").includes(Yc.url)?!0:!1}var ec,Nb,Za,ic,ld,xd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yc){switch(Yc.nextAddress){case 1:return(ec=Q.world())&&(Nb=ec.showLoadingIndicatorFor(Q,"Loading existing modules...")),
Yc.yield(wb.resource(fa).dirList(5,{exclude:Qa}),3);case 3:return Yc.yield(Yc.yieldResult.map(function(Ua){return Ua.url}),2);case 2:return Za=Yc.yieldResult,ic=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(Za.filter(function(Ua){return Ua.endsWith(".js")}).map(function(Ua){return{isListItem:!0,string:Ia&&0==Ua.indexOf(Ia.address)?Ia.name+Ua.slice(Ia.address.length):Ua,value:Ua}})),Yc.yield(Promise.resolve(Nb&&Nb.remove()).then(function(){return Q.world().filterableListPrompt("What module to load?",
ic,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:Q},Q?{extent:Q.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:ld=Yc.yieldResult;if(!ld||"canceled"===ld.status||!ld.selected.length)throw"Canceled";xd=ld.selected||ld;Array.isArray(xd)||(xd=[xd]);return Yc.return(xd)}})};wb._createAndLoadModules=function(Q,fa){var Ia,Qa,ec,Nb,Za;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ic){switch(ic.nextAddress){case 1:Array.isArray(fa)||(fa=[fa]),Ia=[],Qa=$jscomp.makeIterator(fa),
ec=Qa.next();case 2:if(ec.done){ic.jumpTo(4);break}Nb=ec.value;return ic.yield(Q.forgetModule(Nb,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return ic.yield(Q.resourceEnsureExistance(Nb,'"format esm";\n'),6);case 6:return ic.setCatchFinallyBlocks(7),ic.yield(Q.importModule(Nb),9);case 9:Ia.push({name:Nb});ic.leaveTryBlock(3);break;case 7:Za=ic.enterCatchBlock(),Ia.push({name:Nb,error:Za});case 3:ec=Qa.next();ic.jumpTo(2);break;case 4:return ic.return(Ia)}})};wb.modulesInPackage_defaultExclude=function(Q){return[".git",
"node_modules",".optimized-loading-cache",".module_cache"].includes(Q.name())?!0:!1};wb.modulesInPackage=Pb;wb.obj=lc;wb.arr=Sb;wb.resource=jc;wb.shortModuleName=tc;wb.shortModuleName=tc;wb.interactivelyChangeModule=bd;wb.interactivelyChangeModule=bd;wb.interactivelyReloadModule=Xb;wb.interactivelyReloadModule=Xb;wb.interactivelyUnloadModule=Tb;wb.interactivelyUnloadModule=Tb;wb.interactivelyRemoveModule=Oc;wb.interactivelyRemoveModule=Oc;wb.interactivelyAddModule=td;wb.interactivelyAddModule=td;
wb.modulesInPackage=Pb;wb.modulesInPackage=Pb;var Hb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/mocha-tests.js");Hb.loadMochaTestFile=tb;Hb.runMochaTests=hb;Hb.arr=Sb;Hb.chain=Xd;Hb.loadMochaTestFile=tb;Hb.loadMochaTestFile=tb;Hb.runMochaTests=hb;Hb.runMochaTests=hb;var Ub=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");Ub.todo=function(Q){throw Error(Q+" is not yet implemented!");};Ub.parseJsonLikeObj=jd;Ub.arr=Sb;Ub.Closure=ed;Ub.obj=
lc;Ub.resource=jc;Ub.transform=Yd;Ub.modules=id;var lb=function(){};lb.prototype.dynamicCompletionsForPrefix=function(Q,fa,Ia){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){Ub.todo("dynamicCompletionsForPrefix");Qa.jumpToEnd()})};lb.prototype.runEval=function(Q,fa){Ub.todo("runEval")};lb.prototype.resourceExists=function(Q){Ub.todo("resourceExists")};lb.prototype.resourceEnsureExistance=function(Q,fa){Ub.todo("resourceEnsureExistance")};lb.prototype.resourceMkdir=function(Q){Ub.todo("resourceMkdir")};
lb.prototype.resourceRead=function(Q){Ub.todo("resourceRead")};lb.prototype.resourceRemove=function(Q){Ub.todo("resourceRemove")};lb.prototype.resourceWrite=function(Q,fa){Ub.todo("resourceWrite")};lb.prototype.resourceCreateFiles=function(Q,fa){Ub.todo("resourceCreateFiles")};lb.prototype.resourceDirList=function(Q,fa,Ia){Ub.todo("resourceDirList")};lb.prototype.normalizeSync=function(Q,fa,Ia){Ub.todo("normalizeSync")};lb.prototype.normalize=function(Q,fa,Ia){Ub.todo("normalize")};lb.prototype.printSystemConfig=
function(){Ub.todo("printSystemConfig")};lb.prototype.getConfig=function(){Ub.todo("getConfig")};lb.prototype.setConfig=function(Q){Ub.todo("setConfig")};lb.prototype.getPackages=function(Q){Ub.todo("getPackages")};lb.prototype.isModuleLoaded=function(Q,fa){Ub.todo("isModuleLoaded")};lb.prototype.doesModuleExist=function(Q,fa){Ub.todo("doesModuleExist")};lb.prototype.getModules=function(){var Q=this,fa,Ia;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){return 1==Qa.nextAddress?(fa=
Ub.arr,Ia=fa.flatmap,Qa.yield(Q.getPackages(),2)):Qa.return(Ia.call(fa,Qa.yieldResult,function(ec){return ec.modules}))})};lb.prototype.getModule=function(Q){var fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return 1==Ia.nextAddress?Ia.yield(fa.getModules(),2):Ia.return(Ia.yieldResult.find(function(Qa){return Qa.name===Q}))})};lb.prototype.getPackage=function(Q){var fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return 1==Ia.nextAddress?(Q=Q.replace(/\/+$/,
""),Ia.yield(fa.getPackages(),2)):Ia.return(Ia.yieldResult.find(function(Qa){return Qa.address===Q||Qa.name===Q}))})};lb.prototype.getPackageForModule=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){Ub.todo("getPackageForModule");fa.jumpToEnd()})};lb.prototype.systemConfChange=function(Q){var fa=Ub.parseJsonLikeObj(Q);["baseURL"].forEach(function(Ia){return delete fa[Ia]});return this.setConfig(fa)};lb.prototype.resourcesOfPackage=function(Q,fa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){Ub.todo("resourcesOfPackage");
Ia.jumpToEnd()})};lb.prototype.registerPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){Ub.todo("registerPackage");fa.jumpToEnd()})};lb.prototype.importPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){Ub.todo("importPackage");fa.jumpToEnd()})};lb.prototype.removePackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){Ub.todo("removePackage");fa.jumpToEnd()})};lb.prototype.reloadPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){Ub.todo("reloadPackage");
fa.jumpToEnd()})};lb.prototype.packageConfChange=function(Q,fa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){Ub.todo("packageConfChange");Ia.jumpToEnd()})};lb.prototype.importModule=function(Q){Ub.todo("importModule")};lb.prototype.forgetModule=function(Q,fa){Ub.todo("forgetModule")};lb.prototype.reloadModule=function(Q,fa){Ub.todo("reloadModule")};lb.prototype.moduleFormat=function(Q){Ub.todo("moduleFormat")};lb.prototype.moduleRead=function(Q){Ub.todo("moduleRead")};lb.prototype.moduleSourceChange=
function(Q,fa,Ia){Ub.todo("moduleSourceChange")};lb.prototype.importsAndExportsOf=function(Q,fa){Ub.todo("importsAndExportsOf")};lb.prototype.keyValueListOfVariablesInModule=function(Q,fa){Ub.todo("keyValueListOfVariablesInModule")};lb.prototype.moduleWrite=function(Q,fa){return this.moduleSourceChange(Q,fa)};Ub.AbstractCoreInterface=lb;var mb=function(){var Q=Ub.AbstractCoreInterface.call(this)||this;Q.currentEval=null;return Q};$jscomp.inherits(mb,Ub.AbstractCoreInterface);mb.prototype.runEval=
function(Q,fa){throw Error("Not yet implemented");};mb.prototype.runEvalAndStringify=function(Q,fa){var Ia=this;return this.currentEval?this.currentEval.then(function(){return Ia.runEvalAndStringify(Q,fa)}):this.currentEval=Promise.resolve().then(function(){var Qa,ec,Nb,Za;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ic){switch(ic.nextAddress){case 1:return ic.yield(Ia.runEval("\n        Promise.resolve((async "+Ub.transform.wrapInFunction(Q)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},fa)),2);case 2:if((Qa=ic.yieldResult)&&Qa.isError)throw Error(String(Qa.value||Qa.error));if(!Qa||!Qa.value)return ic.return(null);if(ec=Qa.promisedValue){ic.jumpTo(3);break}return ic.yield(Qa.value,4);case 4:ec=ic.yieldResult;case 3:Nb=ec;if(!Nb)return ic.return();if("undefined"===Nb)return ic.return(void 0);if("null"===Nb)return ic.return(null);if("true"===Nb)return ic.return(!0);
if("false"===Nb)return ic.return(!1);try{Za=JSON.parse(Nb)}catch(ld){return ic.return(Nb)}if(Za&&Za.isError)throw Error(String(Za.value));return ic.return(Za)}})}).then(function(Qa){delete Ia.currentEval;return Qa},function(Qa){delete Ia.currentEval;return Promise.reject(Qa)})};mb.prototype.dynamicCompletionsForPrefix=function(Q,fa,Ia){var Qa=this,ec,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Za){ec=Ub.obj.isString(Ia.context)?Ia.context:!1;Ia=Ub.obj.dissoc(Ia,["systemInterface",
"System","context"]);Nb="\n      var prefix = "+JSON.stringify(fa)+",\n          opts = "+JSON.stringify(Ia)+";\n      opts.context = "+ec+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return Za.return(Qa.runEvalAndStringify(Nb))})};mb.prototype.evalWithResource=function(Q,fa,Ia){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+Q+'").'+fa+"("+(Ia?JSON.stringify(Ia):"")+");\n    ")};mb.prototype.resourceExists=function(Q){return this.evalWithResource(Q,"exists")};mb.prototype.resourceEnsureExistance=function(Q,fa){return this.evalWithResource(Q,
"ensureExistance",fa)};mb.prototype.resourceMkdir=function(Q){return this.evalWithResource(Q,"mkdir")};mb.prototype.resourceRead=function(Q){return this.evalWithResource(Q,"read")};mb.prototype.resourceRemove=function(Q){return this.evalWithResource(Q,"remove")};mb.prototype.resourceWrite=function(Q,fa){return this.evalWithResource(Q,"write",fa)};mb.prototype.resourceCreateFiles=function(Q,fa){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
Q+'", '+JSON.stringify(fa)+")")};mb.prototype.resourceDirList=function(Q,fa,Ia){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+Q+'").dirList('+JSON.stringify(fa)+", "+JSON.stringify(Ia)+"))\n        .map(({url}) => ({url}))")};mb.prototype.livelySystemAccessor=function(Q){Q=void 0===Q?"livelySystem":Q;return"var "+Q+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
Q+') throw new Error("lively-system-interface not available!");'};mb.prototype.normalizeSync=function(Q,fa,Ia){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(Q)+", "+JSON.stringify(fa)+", "+Ia+")")};mb.prototype.normalize=function(Q,fa,Ia){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(Q)+", "+JSON.stringify(fa)+", "+JSON.stringify(Ia)+")")};mb.prototype.printSystemConfig=function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")};
mb.prototype.getConfig=function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')};mb.prototype.setConfig=function(Q){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(Q)+")")};mb.prototype.getPackages=function(Q){Q=Object.assign({excluded:[]},Q);Q.excluded=Q.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(Q)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')};mb.prototype.getPackageForModule=function(Q){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(Q)+")")};mb.prototype.isModuleLoaded=function(Q,fa){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+Q+'", '+fa+")")};mb.prototype.doesModuleExist=function(Q,fa){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+Q+'", '+fa+")")};mb.prototype.registerPackage=function(Q){var fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return Ia.return(fa.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(Q)+")"))})};mb.prototype.importPackage=
function(Q){var fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return Ia.return(fa.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(Q)+")"))})};mb.prototype.removePackage=function(Q){var fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return Ia.return(fa.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(Q)+")"))})};mb.prototype.reloadPackage=function(Q,fa){var Ia=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){return Qa.return(Ia.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(Q)+", "+JSON.stringify(fa)+")"))})};mb.prototype.packageConfChange=function(Q,fa){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(Q)+", "+JSON.stringify(fa)+")")};mb.prototype.resourcesOfPackage=function(Q,fa){fa=void 0===fa?[".git","node_modules",".module_cache","lively.next-node_modules"]:fa;var Ia=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){Q.address&&(Q=
Q.address);return Qa.return(Ia.runEvalAndStringify("\n      "+Ia.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(Q)+", "+JSON.stringify(fa)+");"))})};mb.prototype.getModule=function(Q){var fa=this,Ia;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){if(1==Qa.nextAddress)return Qa.yield(fa.getModules(),2);Ia=Qa.yieldResult.find(function(ec){return ec.name===Q});return Qa.return(Ia?Ub.modules.module(Ia.name):null)})};mb.prototype.importModule=
function(Q){return this.runEvalAndStringify("lively.modules.System.import("+JSON.stringify(Q)+")")};mb.prototype.forgetModule=function(Q,fa){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").unload("+JSON.stringify(fa)+")")};mb.prototype.reloadModule=function(Q,fa){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").reload("+JSON.stringify(fa)+")")};mb.prototype.moduleFormat=function(Q){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(Q)+").format();")};mb.prototype.moduleRead=function(Q){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").source()")};mb.prototype.moduleSourceChange=function(Q,fa,Ia){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").changeSource("+JSON.stringify(fa)+", "+JSON.stringify(Ia)+")")};mb.prototype.keyValueListOfVariablesInModule=function(Q,fa){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+
JSON.stringify(Q)+", "+JSON.stringify(fa)+")")};mb.prototype.importsAndExportsOf=function(Q,fa){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(Q)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(Q)+").exports()})")};mb.prototype.exportsOfModules=function(Q){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(Q)+";\n      options.excludedPackages = ["+Q.excludedPackages.map(function(fa){return"function"===
typeof fa?fa.toString():JSON.stringify(fa)}).join(",")+"]\n      await livelySystem.localInterface.exportsOfModules(options)")};mb.prototype.searchInPackage=function(Q,fa,Ia){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(Q)+", "+JSON.stringify(fa)+", "+JSON.stringify(Ia)+")")};mb.prototype.loadMochaTestFile=function(Q,fa){fa=void 0===fa?[]:fa;var Ia=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){return Qa.return(Ia.runEvalAndStringify("\n      "+
Ia.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(Q)+", "+JSON.stringify(fa)+"), result;\n      result = {testsByFile}"))})};mb.prototype.runMochaTests=function(Q,fa,Ia,Qa){var ec=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){Q&&Q instanceof RegExp&&(Q={isRegExp:!0,value:String(Q).replace(/^\/|\/$/g,"")});return Nb.return(ec.runEvalAndStringify("\n      var grep = "+JSON.stringify(Q)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
ec.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(fa||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})};
Ub.RemoteCoreInterface=mb;var Qb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");Qb.obj=lc;Qb.string=Wc;Qb.arr=Sb;Qb.resource=jc;Qb.createFiles=Ad;Qb.ast=Cb;Qb.modules=id;Qb.vm=Cd;Qb.loadMochaTestFile=tb;Qb.runMochaTests=hb;Qb.parseJsonLikeObj=jd;Qb.AbstractCoreInterface=lb;Qb.classToFunctionTransform=fe;lb=function(){return Qb.AbstractCoreInterface.apply(this,arguments)||this};$jscomp.inherits(lb,Qb.AbstractCoreInterface);lb.prototype.dynamicCompletionsForPrefix=
function(Q,fa,Ia){var Qa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ec){if(1==ec.nextAddress)return ec.yield(Qb.vm.completions.getCompletions(function(Nb){return Qb.vm.runEval(Nb.replace("return ",""),Object.assign({targetModule:Q,classTransform:Qb.classToFunctionTransform},Ia))},fa),2);Qa=ec.yieldResult;if(Qa.isError)throw Qa.value;return ec.return({completions:Qa.completions,prefix:Qa.startLetters})})};lb.prototype.runEval=function(Q,fa){return Qb.vm.runEval(Q,Object.assign({classTransform:Qb.classToFunctionTransform},
fa))};lb.prototype.resourceExists=function(Q){return Qb.resource(Q).exists()};lb.prototype.resourceEnsureExistance=function(Q,fa){return Qb.resource(Q).ensureExistance(fa)};lb.prototype.resourceMkdir=function(Q){return Qb.resource(Q).mkdir()};lb.prototype.resourceRead=function(Q){return Qb.resource(Q).read()};lb.prototype.resourceRemove=function(Q){return Qb.resource(Q).remove()};lb.prototype.resourceWrite=function(Q,fa){return Qb.resource(Q).write(fa)};lb.prototype.resourceCreateFiles=function(Q,
fa){return Qb.createFiles(Q,fa)};lb.prototype.resourceDirList=function(Q,fa,Ia){return Qb.resource(Q).dirList(fa,Ia)};lb.prototype.normalizeSync=function(Q,fa,Ia){return System.decanonicalize(Q,fa,Ia)};lb.prototype.normalize=function(Q,fa,Ia){return System.normalize(Q,fa,Ia)};lb.prototype.printSystemConfig=function(){return Qb.modules.printSystemConfig()};lb.prototype.getConfig=function(){return System.getConfig()};lb.prototype.setConfig=function(Q){Qb.modules.System.config(Q)};lb.prototype.getPackages=
function(Q){Q=Object.assign({},Q);Q=void 0===Q.excluded?[]:Q.excluded;var fa=Q.filter(function(Qa){return"string"===typeof Qa}),Ia=Q.filter(function(Qa){return"function"===typeof Qa});fa=fa.concat(fa.map(function(Qa){return System.decanonicalize(Qa.replace(/\/?$/,"/")).replace(/\/$/,"")}));return Qb.modules.getPackages().filter(function(Qa){return!fa.includes(Qa.url)&&!Ia.some(function(ec){return ec(Qa.url)})})};lb.prototype.registerPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){return fa.return(Qb.modules.registerPackage(Q))})};
lb.prototype.importPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){return fa.return(Qb.modules.importPackage(Q))})};lb.prototype.removePackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){return fa.return(Qb.modules.removePackage(Q))})};lb.prototype.reloadPackage=function(Q,fa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return Ia.return(Qb.modules.reloadPackage(Q,fa))})};lb.prototype.packageConfChange=function(Q,
fa){var Ia=this,Qa,ec,Nb,Za;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ic){if(1==ic.nextAddress)return Qa=Qb.modules.System,ec=Qb.parseJsonLikeObj(Q),Nb=JSON.stringify(ec,null,2),ic.yield(Qb.modules.module(fa).changeSource(Nb,{doEval:!1}),2);if(3!=ic.nextAddress)return Qa.set(fa,Qa.newModule(ec)),ic.yield(Ia.getPackageForModule(fa),3);(Za=ic.yieldResult)&&Qb.modules.applyPackageConfig(ec,Za.address);ic.jumpToEnd()})};lb.prototype.resourcesOfPackage=function(Q,fa){fa=void 0===fa?[".git",
"node_modules",".module_cache"]:fa;var Ia,Qa,ec;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){if(1==Nb.nextAddress)return Nb.setCatchFinallyBlocks(2),Ia=Q.address?Q.address:Q,Qa=Qb.modules.getPackage(Ia),Nb.yield(Qa.resources(void 0,fa),4);if(2!=Nb.nextAddress)return Nb.return(Nb.yieldResult.map(function(Za){return Object.assign(Za,{package:Za.package.url})}));ec=Nb.enterCatchBlock();console.warn("resourcesOfPackage error for "+Q+": "+ec);return Nb.return([])})};lb.prototype.getPackageForModule=
function(Q){return(Q=Qb.modules.getPackageOfModule(Q))?Q.asSpec():Q};lb.prototype.isModuleLoaded=function(Q,fa){return Qb.modules.isModuleLoaded(Q,fa)};lb.prototype.doesModuleExist=function(Q,fa){return Qb.modules.isModuleLoaded(Q,fa)};lb.prototype.getModule=function(Q){return Qb.modules.module(Q)};lb.prototype.importModule=function(Q){return Qb.modules.System.import(Q)};lb.prototype.forgetModule=function(Q,fa){return Qb.modules.module(Q).unload(fa)};lb.prototype.reloadModule=function(Q,fa){return Qb.modules.module(Q).reload(fa)};
lb.prototype.moduleFormat=function(Q){return Qb.modules.module(Q).format()};lb.prototype.moduleRead=function(Q){return Qb.modules.module(Q).source()};lb.prototype.moduleSourceChange=function(Q,fa,Ia){return Qb.modules.module(Q).changeSource(fa,Ia)};lb.prototype.keyValueListOfVariablesInModule=function(Q,fa){var Ia=this,Qa,ec,Nb,Za,ic,ld,xd,Yc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){switch(Ua.nextAddress){case 1:if(fa){Ua.jumpTo(2);break}return Ua.yield(Ia.resourceRead(Q),3);
case 3:fa=Ua.yieldResult;case 2:return Qa="string"===typeof fa?Qb.ast.parse(fa):fa,ec=Ia.normalizeSync(Q),Ia.moduleFormat(ec),Nb=Qb.modules.module(ec).env().recorder,Ua.yield(Ia.importsAndExportsOf(ec,Qa),4);case 4:return Za=Ua.yieldResult,ic=Qb.ast.query.topLevelDeclsAndRefs(Qa),ld=Qb.arr.sortByKey(Qb.ast.query.declarationsOfScope(ic.scope,!0),"start"),xd=Qb.arr.pluck(ic.scope.importSpecifiers,"name"),Yc=0,Ua.return(ld.map(function(Mc){var pb=Mc.name.length,fb=Za.exports.find(function(bc){return bc.local===
Mc.name}),eb=Qb.arr.include(xd,Mc.name);fb&&(pb+=9);eb&&(pb+=9);Yc=Math.max(Yc,pb);return{isExport:fb,isImport:eb,name:Mc.name,value:Nb[Mc.name],node:Mc,printedName:Mc.name+(fb?" [export]":"")+(eb?" [import]":""),printedValue:Qb.obj.inspect(Nb[Mc.name],{maxDepth:1}).replace(/\n/g,"")}}).map(function(Mc){return{isListItem:!0,value:Mc,string:Mc.printedName+Qb.string.indent(" = "+Mc.printedValue," ",Yc-Mc.printedName.length)}}))}})};lb.prototype.importsAndExportsOf=function(Q,fa){var Ia;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){return 1==
Qa.nextAddress?Qa.yield(Qb.modules.module(Q).imports(fa),2):3!=Qa.nextAddress?(Ia=Qa.yieldResult,Qa.yield(Qb.modules.module(Q).exports(fa),3)):Qa.return({imports:Ia,exports:Qa.yieldResult})})};lb.prototype.exportsOfModules=function(Q){return Qb.modules.ExportLookup.run(System,Q)};lb.prototype.searchInPackage=function(Q,fa,Ia){return Qb.modules.getPackage(Q).search(fa,Ia)};lb.prototype.runMochaTests=function(Q,fa,Ia,Qa){return Qb.runMochaTests(Q,fa,Ia,Qa)};lb.prototype.loadMochaTestFile=function(Q,
fa){return Qb.loadMochaTestFile(Q,fa)};$jscomp.global.Object.defineProperties(lb.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"local"}}});Qb.LocalCoreInterface=lb;var Gc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");Gc.evalStrategies=Sd;Gc.RemoteCoreInterface=mb;var mc=function(Q){var fa=Gc.RemoteCoreInterface.call(this)||this;fa.currentEval=null;fa.url=Q;fa.server=new Gc.evalStrategies.HttpEvalStrategy(Q);return fa};$jscomp.inherits(mc,
Gc.RemoteCoreInterface);mc.prototype.runEval=function(Q,fa){return this.server.runEval(Q,fa)};$jscomp.global.Object.defineProperties(mc.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this.url}},description:{configurable:!0,enumerable:!0,get:function(){return this.url.replace(/^https?:\/\//,"")}}});Gc.HTTPCoreInterface=mc;var Pc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");Pc.evalStrategies=Sd;Pc.RemoteCoreInterface=mb;mb=function(Q,
fa){var Ia=Pc.RemoteCoreInterface.call(this)||this;Ia.targetId=Q;Ia.peer=fa;return Ia};$jscomp.inherits(mb,Pc.RemoteCoreInterface);mb.prototype.isConnected=function(){var Q=this,fa,Ia,Qa,ec,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Za){if(1==Za.nextAddress)return fa=Q,Ia=fa.client,Qa=fa.targetId,Za.yield(Ia.sendToAndWait(Ia.trackerId,"getClients",{}),2);ec=Za.yieldResult;Nb=ec.data;return Za.return(Nb.some(function(ic){ic=$jscomp.makeIterator(ic).next().value;return Qa===ic}))})};
mb.prototype.runEval=function(Q,fa){var Ia=this,Qa,ec;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){Qa=Ia.client;if(!Qa)throw Error("No lively.2lively default client available!");ec=new Pc.evalStrategies.L2LEvalStrategy(Qa,Ia.targetId);return Nb.return(ec.runEval(Q,fa))})};$jscomp.global.Object.defineProperties(mb.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"l2l "+this.targetId}},description:{configurable:!0,enumerable:!0,get:function(){var Q=this.peer,fa=
"l2l "+this.targetId.slice(0,5);if(Q){var Ia=Q.location,Qa=Q.type,ec=Q.user;Q=Q.world;Qa&&(fa+=", "+Qa);Ia&&(fa+=", "+Ia.replace(/^https?:\/\//,"")+(Q?"/"+Q:""));ec&&(fa+=", "+ec.name)}return fa}},client:{configurable:!0,enumerable:!0,get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}}});Pc.L2LCoreInterface=mb;var Xc=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");Xc.systemInterfaceNamed=qb;Xc.interactivelyCreatePackage=
bb;Xc.interactivelyLoadPackage=Fb;Xc.interactivelyReloadPackage=vc;Xc.interactivelyUnloadPackage=pc;Xc.interactivelyRemovePackage=sd;Xc.showExportsAndImportsOf=pd;Xc.shortModuleName=tc;Xc.interactivelyChangeModule=bd;Xc.interactivelyReloadModule=Xb;Xc.interactivelyUnloadModule=Tb;Xc.interactivelyRemoveModule=Oc;Xc.interactivelyAddModule=td;Xc.modulesInPackage=Pb;Xc.LocalCoreInterface=lb;Xc.HTTPCoreInterface=mc;Xc.L2LCoreInterface=mb;mb=function(Q){this.coreInterface=Q};mb.prototype.dynamicCompletionsForPrefix=
function(Q,fa,Ia){return this.coreInterface.dynamicCompletionsForPrefix(Q,fa,Ia)};mb.prototype.runEval=function(Q,fa){return this.coreInterface.runEval(Q,fa)};mb.prototype.printSystemConfig=function(Q,fa,Ia){return this.coreInterface.printSystemConfig(Q,fa,Ia)};mb.prototype.getConfig=function(Q,fa,Ia){return this.coreInterface.getConfig(Q,fa,Ia)};mb.prototype.getPackages=function(Q){return this.coreInterface.getPackages(Q)};mb.prototype.getModules=function(Q,fa,Ia){return this.coreInterface.getModules(Q,
fa,Ia)};mb.prototype.getModule=function(Q,fa,Ia){return this.coreInterface.getModule(Q,fa,Ia)};mb.prototype.getPackage=function(Q,fa,Ia){return this.coreInterface.getPackage(Q,fa,Ia)};mb.prototype.getPackageForModule=function(Q,fa,Ia){return this.coreInterface.getPackageForModule(Q,fa,Ia)};mb.prototype.resourcesOfPackage=function(Q,fa){return this.coreInterface.resourcesOfPackage(Q,fa)};mb.prototype.systemConfChange=function(Q,fa,Ia){return this.coreInterface.systemConfChange(Q,fa,Ia)};mb.prototype.registerPackage=
function(Q){return this.coreInterface.registerPackage(Q)};mb.prototype.importPackage=function(Q){return this.coreInterface.importPackage(Q)};mb.prototype.removePackage=function(Q){return this.coreInterface.removePackage(Q)};mb.prototype.reloadPackage=function(Q){return this.coreInterface.reloadPackage(Q)};mb.prototype.packageConfChange=function(Q,fa){return this.coreInterface.packageConfChange(Q,fa)};mb.prototype.keyValueListOfVariablesInModule=function(Q,fa){return this.coreInterface.keyValueListOfVariablesInModule(Q,
fa)};mb.prototype.interactivelyCreatePackage=function(Q){return Xc.interactivelyCreatePackage(this.coreInterface,Q)};mb.prototype.interactivelyLoadPackage=function(Q,fa){return Xc.interactivelyLoadPackage(this.coreInterface,Q,fa)};mb.prototype.interactivelyReloadPackage=function(Q,fa){return Xc.interactivelyReloadPackage(this.coreInterface,Q,fa)};mb.prototype.interactivelyUnloadPackage=function(Q,fa,Ia){return Xc.interactivelyUnloadPackage(this.coreInterface,Q,fa,Ia)};mb.prototype.interactivelyRemovePackage=
function(Q,fa){return Xc.interactivelyRemovePackage(this.coreInterface,Q,fa)};mb.prototype.isModuleLoaded=function(Q,fa){return this.coreInterface.isModuleLoaded(Q,fa)};mb.prototype.doesModuleExist=function(Q,fa){return this.coreInterface.doesModuleExist(Q,fa)};mb.prototype.importModule=function(Q){return this.coreInterface.importModule(Q)};mb.prototype.forgetModule=function(Q,fa){return this.coreInterface.forgetModule(Q,fa)};mb.prototype.reloadModule=function(Q,fa){return this.coreInterface.reloadModule(Q,
fa)};mb.prototype.moduleFormat=function(Q){return this.coreInterface.moduleFormat(Q)};mb.prototype.moduleRead=function(Q){return this.coreInterface.moduleRead(Q)};mb.prototype.moduleWrite=function(Q,fa){return this.coreInterface.moduleWrite(Q,fa)};mb.prototype.getModulesInPackage=function(Q){return Xc.modulesInPackage(this.coreInterface,Q)};mb.prototype.shortModuleName=function(Q,fa){return Xc.shortModuleName(this.coreInterface,Q,fa)};mb.prototype.interactivelyChangeModule=function(Q,fa,Ia){return Xc.interactivelyChangeModule(this.coreInterface,
Q,fa,Ia)};mb.prototype.interactivelyReloadModule=function(Q,fa){return Xc.interactivelyReloadModule(this.coreInterface,Q,fa)};mb.prototype.interactivelyUnloadModule=function(Q,fa){return Xc.interactivelyUnloadModule(this.coreInterface,Q,fa)};mb.prototype.interactivelyRemoveModule=function(Q,fa){return Xc.interactivelyRemoveModule(this.coreInterface,Q,fa)};mb.prototype.interactivelyAddModule=function(Q,fa){return Xc.interactivelyAddModule(this.coreInterface,Q,fa)};mb.prototype.showExportsAndImportsOf=
function(Q,fa){return Xc.showExportsAndImportsOf(this.coreInterface,Q,fa)};mb.prototype.exportsOfModules=function(Q){return this.coreInterface.exportsOfModules(Q)};mb.prototype.searchInPackage=function(Q,fa,Ia){return this.coreInterface.searchInPackage(Q,fa,Ia)};mb.prototype.searchInAllPackages=function(Q,fa){fa=void 0===fa?{}:fa;var Ia=this,Qa,ec,Nb,Za,ic,ld,xd,Yc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){switch(Ua.nextAddress){case 1:return(Qa=fa.progress)&&Qa.step("Fetching Packages...",
0),Ua.yield(Ia.coreInterface.getPackages({excluded:fa.excludedPackages}),2);case 2:ec=Ua.yieldResult,Nb=[],Qa&&Qa.step("Fetching Packages...",.1),Za=0;case 3:if(!(Za<ec.length)){Ua.jumpTo(5);break}ic=ec[Za];ld=ic.url;if(!ld||"no group"===ld){Ua.jumpTo(4);break}Qa&&Qa.step(ld.replace(System.baseURL,"").slice(0,20),.1+Za/ec.length*.9);Ua.setCatchFinallyBlocks(6);return Ua.yield(Ia.coreInterface.searchInPackage(ld,Q,fa),8);case 8:xd=Ua.yieldResult;Nb=Nb.concat(xd);Ua.leaveTryBlock(4);break;case 6:Yc=
Ua.enterCatchBlock(),console.error("Error searching in package "+ld+":\n"+Yc.stack);case 4:Za++;Ua.jumpTo(3);break;case 5:return Ua.return(Nb)}})};mb.prototype.loadMochaTestFile=function(Q,fa){return this.coreInterface.loadMochaTestFile(Q,fa)};mb.prototype.runMochaTests=function(Q,fa,Ia,Qa){return this.coreInterface.runMochaTests(Q,fa,Ia,Qa)};$jscomp.global.Object.defineProperties(mb.prototype,{isSystemInterface:{configurable:!0,enumerable:!0,get:function(){return!0}},name:{configurable:!0,enumerable:!0,
get:function(){return this.coreInterface.name}}});Ba("Interface",mb);Xc.Interface=mb;Xc.systemInterfaceNamed=qb;Xc.systemInterfaceNamed=qb;mb=Ba("localInterface",new Xc.Interface(new Xc.LocalCoreInterface));Xc.localInterface=mb;Xc.localInterface=mb;Xc.localInterface=mb;Xc.httpInterfaces={};mb=Ba("serverInterfaceFor",function(Q){return Xc.httpInterfaces[Q]||(Xc.httpInterfaces[Q]=new Xc.Interface(new Xc.HTTPCoreInterface(Q)))});Xc.serverInterfaceFor=mb;Xc.serverInterfaceFor=mb;Xc.serverInterfaceFor=
mb;Xc.l2lInterfaces={};mb=Ba("l2lInterfaceFor",function(Q,fa){return Xc.l2lInterfaces[Q]||(Xc.l2lInterfaces[Q]=new Xc.Interface(new Xc.L2LCoreInterface(Q,fa)))});Xc.l2lInterfaceFor=mb;Xc.l2lInterfaceFor=mb;Xc.l2lInterfaceFor=mb}}});