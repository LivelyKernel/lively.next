System.register(["./__root_module__-7cbd94df.js","kld-intersections"],function(Da){var Ab,Rb,jc,cc,je,fd,Yd,jd,Pc,vd,Ld,ge,Td;return{setters:[function(md){Ab=md.bv;Rb=md.a6;jc=md.r;cc=md.a7;je=md.bp;fd=md.bw;Yd=md.bx;jd=md.U;Pc=md.s;vd=md.by;Ld=md.bz;ge=md.n;Td=md.bA},function(){}],execute:function(){function md(Q){try{var fa=eval("("+Ga.ast.transform.wrapInFunction("var _; _ = ("+Q+")")+")()")}catch(Ia){return JSON.parse(Q)}return"object"!==typeof fa?null:fa}function Za(Q,fa){var Ia,Sa,ec,Vb,
Ua,wc,oe,Md,id;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ta){switch(Ta.nextAddress){case 1:return Ia=fa.world(),Ta.yield(Ia.prompt("Enter package name",{requester:fa,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:Sa=Ta.yieldResult;if(!Sa)throw"Canceled";Ta.setCatchFinallyBlocks(3);Vb=Ra.resource(Sa);Sa=Vb.name();ec=Vb.url;Ta.leaveTryBlock(4);break;case 3:return Ta.enterCatchBlock(),Ta.yield(Q.getConfig(),5);case 5:return Ua=Ta.yieldResult.baseURL,
wc=Ra.resource(Ua).join(Sa).asDirectory().url,Ta.yield(Q.normalize(wc),6);case 6:ec=Ta.yieldResult.replace(/\/\.js$/,"/");case 4:return Ta.yield(Ia.prompt("Confirm or change package location",{requester:fa,input:ec,historyId:"lively.vm-editor-add-package-address"}),7);case 7:oe=Ta.yieldResult;if(!oe)throw"Canceled";Md=Ra.resource(oe).asDirectory();id=Md.asFile().url;return Ta.yield(Q.removePackage(id),8);case 8:return Ta.yield(Q.resourceCreateFiles(id,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+
Sa+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+Sa+"\n\nNo description for package "+Sa+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+Sa+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return Ta.return(Ra.loadPackage(Q,{name:Sa,address:id,configFile:Md.join("package.json").url,main:Md.join("index.js").url,test:Md.join("tests/test.js").url,type:"package"}))}})}function Db(Q,fa,Ia){Ia=void 0===Ia?
null:Ia;var Sa,ec,Vb,Ua,wc,oe,Md;return $jscomp.asyncExecutePromiseGeneratorProgram(function(id){switch(id.nextAddress){case 1:return Sa={name:"",address:"",type:"package"},id.yield(Q.getConfig(),2);case 2:ec=id.yieldResult;if(!Ia){id.jumpTo(3);break}return id.yield(Q.getPackage(Ia),4);case 4:if(Vb=id.yieldResult){id.jumpTo(5);break}return id.yield(Q.getPackageForModule(Ia),6);case 6:Vb=id.yieldResult;case 5:Ua=Vb;case 3:return id.yield(fa.world().prompt("What is the package directory?",{requester:fa,
input:Ua?Ua.address:ec.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:wc=id.yieldResult;if(!wc)throw"Canceled";Sa.address=wc.replace(/\/$/,"");Sa.url=new URL(Sa.address+"/");Sa.configFile=Ra.resource(Sa.url).join("package.json").url;id.setCatchFinallyBlocks(8);oe=JSON;Md=oe.parse;return id.yield(Q.moduleRead(Sa.configFile),10);case 10:Md.call(oe,id.yieldResult).name;id.leaveTryBlock(9);break;case 8:id.enterCatchBlock(),Sa.name=String(Sa.url).replace(/\/$/,""),
Q.resourceEnsureExistance(Sa.configFile,'{\n  "name": "'+Sa.name+'",\n  "version": "0.1.0"\n}');case 9:return id.return(Ra.loadPackage(Q,Sa))}})}function ac(Q,fa,Ia){var Sa,ec,Vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){switch(Ua.nextAddress){case 1:return Sa=Ra.resource(Ia).asFile().url,Ua.yield(Q.getPackage(Sa),2);case 2:if(ec=Ua.yieldResult){Ua.jumpTo(3);break}return Ua.yield(Q.getPackageForModule(Sa),4);case 4:ec=Ua.yieldResult;case 3:Vb=ec;if(!Vb)throw Error("Cannot find package for "+
Sa);return Ua.yield(Q.reloadPackage(Sa),5);case 5:if(!fa){Ua.jumpTo(0);break}return Ua.yield(fa.updateModuleList(),7);case 7:return Ua.yield(fa.uiSelect(Sa,!1),8);case 8:return Ua.return(Ua.yieldResult)}})}function ic(Q,fa,Ia,Sa){var ec,Vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){switch(Ua.nextAddress){case 1:return Ua.yield(Q.getPackage(Ia),2);case 2:return ec=Ua.yieldResult,Ua.yield((Sa||$world).confirm("Unload package "+ec.name+"?",{requester:fa}),3);case 3:Vb=Ua.yieldResult;
if(!Vb)throw"Canceled";return Ua.yield(Q.removePackage(Ia),4);case 4:if(!fa){Ua.jumpTo(0);break}return Ua.yield(fa.updateModuleList(),6);case 6:return Ua.yield(fa.uiSelect(null),0)}})}function gd(Q,fa,Ia){var Sa,ec,Vb,Ua,wc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(oe){switch(oe.nextAddress){case 1:return Sa=fa.world(),oe.yield(Q.getPackage(Ia),2);case 2:return ec=oe.yieldResult,ec?oe.yield(Sa.confirm("Really remove package "+ec.name+"?",{requester:fa}),3):($world.inform('No package "'+
Ia+'" found!',{requester:fa}),oe.return());case 3:Vb=oe.yieldResult;if(!Vb)throw"Canceled";Q.removePackage(Ia);return oe.yield(Sa.confirm("Also remove directory "+ec.name+" including "+ec.modules.length+" modules?"),4);case 4:Ua=oe.yieldResult;if(!Ua){oe.jumpTo(0);break}return oe.yield(Sa.confirm("REALLY *remove* directory "+ec.name+"? No undo possible..."),6);case 6:if(wc=oe.yieldResult)return oe.yield(Q.resourceRemove(ec.address),0);oe.jumpTo(0)}})}function fe(Q,fa,Ia){Ia=void 0===Ia?$world:Ia;
var Sa,ec,Vb,Ua,wc,oe,Md,id,Ta,rd,jb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qd){switch(Qd.nextAddress){case 1:return Qd.yield(Q.getPackage(fa),2);case 2:Sa=Qd.yieldResult;if(!Sa)throw Error("Cannot find package "+fa);ec=[];Vb=$jscomp.makeIterator(Sa.modules);Ua=Vb.next();case 3:if(Ua.done)return Qd.yield(Ia.execCommand("open text window",{title:"imports and exports of "+fa,content:ec.join("\n\n")}),0);wc=Ua.value;if(!wc.name.match(/\.js$/)){Qd.jumpTo(4);break}Qd.setCatchFinallyBlocks(6);
oe=Q;Md=oe.importsAndExportsOf;id=wc.name;return Qd.yield(Q.moduleRead(wc.name),9);case 9:return Qd.yield(Md.call(oe,id,Qd.yieldResult),8);case 8:Ta=Qd.yieldResult;Qd.leaveTryBlock(7);break;case 6:rd=Qd.enterCatchBlock();Ia.logError(Error("Error when getting imports/exports from module "+wc.name+":\n"+rd.stack));Qd.jumpTo(4);break;case 7:jb=""+wc.name;if(!Ta.imports.length&&!Ta.exports.length){jb+="\n  does not import / export anything";Qd.jumpTo(4);break}Ta.imports.length&&(jb+="\n  imports:\n",
jb+=Ra.arr.groupByKey(Ta.imports,"fromModule").mapGroups(function(ab,lb){return"from "+ab+": "+lb.map(function(vb){return vb.local||vb.imported?vb.imported&&vb.imported!==vb.local?vb.imported+" as "+vb.local:vb.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(ab){return"    "+ab}).join("\n"));Ta.exports.length&&(jb+="\n  exports:\n",jb+=Ta.exports.map(function(ab){return ab.local?ab.local&&ab.local!==ab.exported?ab.local+" as "+ab.exported:ab.exported:ab.exported+
" from "+ab.fromModule}).join(", ").split("\n").map(function(ab){return"    "+ab}).join("\n"));ec.push(jb);case 4:Ua=Vb.next(),Qd.jumpTo(3)}})}function Yb(Q,fa,Ia){Ia=Ia&&Ia.address;if(Ia&&0===fa.indexOf(Ia))var Sa=fa.slice(Ia.length).replace(/^\//,"");else a:{Ia=Q.getConfig();if(!Ia||Ia.constructor!==Promise)try{Sa=String((new URL(fa)).relativePathFrom(new URL(Q.getConfig().baseURL)));break a}catch(ec){}Sa=fa}return Sa}function qc(Q,fa,Ia,Sa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ec){return 1==
ec.nextAddress?(Sa=Object.assign({targetModule:fa},Sa),ec.yield(Q.normalize(fa),2)):3!=ec.nextAddress?(fa=ec.yieldResult,ec.yield(Q.moduleSourceChange(fa,Ia,Sa),3)):ec.return(fa)})}function Ob(Q,fa,Ia,Sa,ec){Sa=void 0===Sa?!1:Sa;ec=void 0===ec?!1:ec;var Vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){switch(Ua.nextAddress){case 1:return fa&&fa.setStatusMessage("Reloading "+Ia),Ua.setCatchFinallyBlocks(2),Ua.yield(Q.reloadModule(Ia,{reloadDeps:Sa,resetEnv:ec}),4);case 4:if(!fa){Ua.jumpTo(5);
break}return Ua.yield(fa.updateModuleList(),6);case 6:case 5:fa&&fa.setStatusMessage("Reloded "+Ia);Ua.leaveTryBlock(0);break;case 2:Vb=Ua.enterCatchBlock();Ua.setCatchFinallyBlocks(7);if(!fa){Ua.jumpTo(9);break}return Ua.yield(fa.updateEditorWithSourceOf(Ia),10);case 10:case 9:Ua.leaveTryBlock(8);break;case 7:Ua.enterCatchBlock();case 8:throw fa&&fa.showError(Vb),Vb;}})}function Hc(Q,fa,Ia){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sa){switch(Sa.nextAddress){case 1:return Sa.yield(Q.forgetModule(Ia,
{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!fa){Sa.jumpTo(3);break}return Sa.yield(fa.updateModuleList(),4);case 4:case 3:Sa.jumpToEnd()}})}function Yc(Q,fa,Ia){var Sa,ec,Vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){switch(Ua.nextAddress){case 1:return Ua.yield(Q.normalize(Ia),2);case 2:return Sa=Ua.yieldResult,Ua.yield(fa.world().confirm("Remove file "+Sa+"?",{requester:fa}),3);case 3:ec=Ua.yieldResult;if(!ec)throw"Canceled";return Ua.yield(Q.forgetModule(Sa),4);case 4:return Ua.yield(Q.resourceRemove(Sa),
5);case 5:return Ua.yield(Q.getPackageForModule(Sa),6);case 6:return Vb=Ua.yieldResult,Ua.return(Vb)}})}function cd(Q,fa,Ia){var Sa,ec,Vb,Ua,wc,oe,Md,id;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ta){switch(Ta.nextAddress){case 1:return Sa=URL,Ta.yield(Q.getConfig(),2);case 2:ec=new Sa(Ta.yieldResult.baseURL);Vb=fa.world();if(!Ia){Ta.jumpTo(3);break}return Ta.yield(Q.getPackage(Ia),4);case 4:if(Ua=Ta.yieldResult){Ta.jumpTo(5);break}return Ta.yield(Q.getPackageForModule(Ia),6);case 6:Ua=
Ta.yieldResult;case 5:(wc=Ua)&&(ec=new URL(wc.address));case 3:return Ta.yield(rb._searchForExistingFiles(fa,String(ec),wc),7);case 7:oe=Ta.yieldResult;if(!oe.includes("[create new module]")){Ta.jumpTo(8);break}return Ta.yield(rb._askForModuleName(Q,Ia||String(ec),Vb),9);case 9:Md=Ta.yieldResult,oe=[Md];case 8:return Ta.yield(rb._createAndLoadModules(Q,oe),10);case 10:return id=Ta.yieldResult,rb.arr.compact(id.map(function(rd){return rd.error})),Ta.return(id)}})}function $b(Q,fa){var Ia,Sa,ec,Vb,
Ua,wc,oe,Md,id,Ta;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rd){if(1==rd.nextAddress)return rd.yield(Q.getPackage(fa),2);if(3!=rd.nextAddress){Ia=rd.yieldResult;if(!Ia||!Ia.address.match(/^http/))throw Error("Cannot load package "+fa);Sa=rb.resource(Ia.address);ec=[];Vb=$jscomp;Ua=Vb.makeIterator;return rd.yield(Sa.dirList(5,{exclude:rb.modulesInPackage_defaultExclude}),3)}wc=Ua.call(Vb,rd.yieldResult);for(oe=wc.next();!oe.done;oe=wc.next())id=Md=oe.value,Ta=id.url,Ta.match(/\.js$/)&&
Q.isModuleLoaded(Ta,!0)&&ec.push(Q.getModule(Ta));return rd.return(ec)})}function pb(Q,fa){fa=void 0===fa?[]:fa;var Ia;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sa){if(1==Sa.nextAddress)return Sa.yield(System.import("mocha-es6/index.js"),2);Ia=Sa.yieldResult;return Sa.return(Ia.loadTestModuleAndExtractTestState(Q,fa))})}function xc(Q,fa,Ia,Sa){function ec(rd){return new Promise(function(jb,Qd){var ab=Kb.arr.compact(rd.suite.suites).map(function(vb){return vb.file}),lb=Kb.chain(fa).filter(function(vb){return ab.includes(vb.file)}).pluck("tests").flatten().value();
if(!lb||!lb.length)return Qd(Error("Trying to run tests of "+ab.join(", ")+" but cannot find them in loaded tests!"));rd.reporter(function(vb){vb.on("test",function(Bd){try{var de=lb.find(function(Ee){return Ee.fullTitle===Bd.fullTitle()});de.state="running";"function"===typeof Ia&&Ia(de,"test")}catch(Ee){"function"===typeof Sa&&Sa(Ee,"test")}});vb.on("pass",function(Bd){try{var de=lb.find(function(Ee){return Ee.fullTitle===Bd.fullTitle()});de.state="succeeded";de.duration=Bd.duration;"function"===
typeof Ia&&Ia(de,"pass")}catch(Ee){"function"===typeof Sa&&Sa(Ee,"pass")}});vb.on("fail",function(Bd,de){try{var Ee=function(ye,Hd,Zb){ye.state="failed";ye.duration=ye.duration;ye.error=Hd},Ze=lb.find(function(ye){return ye.fullTitle===Bd.fullTitle()});if(Ze)Ee(Ze,de,Bd.duration);else{var Zc=Kb.arr.invoke(Bd.parent.tests,"fullTitle");lb.filter(function(ye){return Zc.includes(ye.fullTitle)}).forEach(function(ye){return Ee(ye,de,Bd.duration)})}"function"===typeof Ia&&Ia(Ze,"fail")}catch(ye){"function"===
typeof Sa&&Sa(ye,"fail")}})});rd.run(function(vb){return jb({testsByFile:fa,mocha:rd})})})}var Vb,Ua,wc,oe,Md,id,Ta;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rd){switch(rd.nextAddress){case 1:Vb=$jscomp.makeIterator(fa),Ua=Vb.next();case 2:if(Ua.done){rd.jumpTo(4);break}oe=wc=Ua.value;Md=oe.file;return rd.yield(Kb.loadMochaTestFile(Md,fa),5);case 5:return id=rd.yieldResult,Ta=id.mocha,Q&&(Ta=Ta.grep(Q)),rd.yield(ec(Ta),3);case 3:Ua=Vb.next();rd.jumpTo(2);break;case 4:return rd.return({mocha:Ta,
testsByFile:fa})}})}function Lc(Q){Q||(Q="local");if(Q.isSystemInterface)var fa=Q;else"string"===typeof Q&&Q.startsWith("l2l ")&&(Q={type:"l2l",id:Q.split(" ")[1]}),"string"!==typeof Q&&"l2l"===Q.type&&(fa=Vc.l2lInterfaceFor(Q.id,Q.info)),"string"!==typeof Q&&($world.setStatusMessage("Unknown system interface "+Q),Q="local"),fa||(fa=Q&&"local"!==Q?Vc.serverInterfaceFor(Q):Vc.localInterface);return fa}Da("systemInterfaceNamed",Lc);var Ga=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");
Ga.parseJsonLikeObj=md;Ga.ast=Ab;Ga.parseJsonLikeObj=md;Ga.parseJsonLikeObj=md;var Ra=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");Ra.loadPackage=function(Q,fa){var Ia,Sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ec){switch(ec.nextAddress){case 1:return ec.yield(Q.importPackage(fa.address+"/"),2);case 2:if(!fa.main){ec.jumpTo(3);break}return ec.yield(Q.importModule(fa.main.toString()),3);case 3:if(!fa.test){ec.jumpTo(5);break}ec.setCatchFinallyBlocks(6);
return ec.yield(Q.importPackage("mocha-es6"),8);case 8:return Ia=ec.yieldResult,ec.yield(Ia.installSystemInstantiateHook(),9);case 9:return ec.yield(Q.importModule(fa.test.toString()),10);case 10:ec.leaveTryBlock(5);break;case 6:Sa=ec.enterCatchBlock(),console.warn("Cannot load test of new package: "+Sa);case 5:return ec.return(Q.getPackage(fa.address))}})};Ra.interactivelyCreatePackage=Za;Ra.interactivelyLoadPackage=Db;Ra.interactivelyReloadPackage=ac;Ra.interactivelyUnloadPackage=ic;Ra.interactivelyRemovePackage=
gd;Ra.showExportsAndImportsOf=fe;Ra.parseJsonLikeObj=md;Ra.arr=Rb;Ra.resource=jc;Ra.interactivelyCreatePackage=Za;Ra.interactivelyCreatePackage=Za;Ra.interactivelyLoadPackage=Db;Ra.interactivelyLoadPackage=Db;Ra.interactivelyReloadPackage=ac;Ra.interactivelyReloadPackage=ac;Ra.interactivelyUnloadPackage=ic;Ra.interactivelyUnloadPackage=ic;Ra.interactivelyRemovePackage=gd;Ra.interactivelyRemovePackage=gd;Ra.showExportsAndImportsOf=fe;Ra.showExportsAndImportsOf=fe;var rb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");
rb.shortModuleName=Yb;rb.interactivelyChangeModule=qc;rb.interactivelyReloadModule=Ob;rb.interactivelyUnloadModule=Hc;rb.interactivelyRemoveModule=Yc;rb.interactivelyAddModule=cd;rb._askForModuleName=function(Q,fa,Ia){var Sa,ec;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vb){switch(Vb.nextAddress){case 1:return Vb.yield(Ia.prompt("Enter module name",{input:fa,historyId:"lively.vm-editor-add-module-name"}),2);case 2:fa=Vb.yieldResult;if(!fa)throw"Canceled";return Vb.yield(Q.normalize(fa),
3);case 3:return Sa=Vb.yieldResult,Vb.yield(Ia.confirm(["Create module \n",{},Sa,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:ec=Vb.yieldResult;if(!ec)throw"Canceled";return Vb.return(Sa)}})};rb._searchForExistingFiles=function(Q,fa,Ia){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sa){return String(fa).match(/^http/)?Sa.return(rb._searchForExistingFilesWeb(Q,fa,Ia)):Sa.return(rb._searchForExistingFilesManually(Q,fa,Ia))})};rb._searchForExistingFilesManually=function(Q,
fa,Ia){var Sa,ec;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vb){switch(Vb.nextAddress){case 1:return Vb.yield(Q.world().multipleChoicePrompt("Add Module",{requester:Q,choices:["Create New Module","Load Existing Module"]}),2);case 2:Sa=Vb.yieldResult;if("Create New Module"===Sa)return Vb.return("[create new module]");if("Load Existing Module"!==Sa){Vb.jumpTo(3);break}return Vb.yield(Q.world().prompt("URL of module?",{input:fa,requester:Q,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),
4);case 4:if(ec=Vb.yieldResult)return Vb.return([ec]);case 3:throw"Canceled";}})};rb._searchForExistingFilesWeb=function(Q,fa,Ia){function Sa(id){id.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(id.name())||Ia&&rb.arr.pluck(Ia.modules,"name").includes(id.url)?!0:!1}var ec,Vb,Ua,wc,oe,Md;return $jscomp.asyncExecutePromiseGeneratorProgram(function(id){switch(id.nextAddress){case 1:return(ec=Q.world())&&(Vb=ec.showLoadingIndicatorFor(Q,"Loading existing modules...")),
id.yield(rb.resource(fa).dirList(5,{exclude:Sa}),3);case 3:return id.yield(id.yieldResult.map(function(Ta){return Ta.url}),2);case 2:return Ua=id.yieldResult,wc=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(Ua.filter(function(Ta){return Ta.endsWith(".js")}).map(function(Ta){return{isListItem:!0,string:Ia&&0==Ta.indexOf(Ia.address)?Ia.name+Ta.slice(Ia.address.length):Ta,value:Ta}})),id.yield(Promise.resolve(Vb&&Vb.remove()).then(function(){return Q.world().filterableListPrompt("What module to load?",
wc,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:Q},Q?{extent:Q.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:oe=id.yieldResult;if(!oe||"canceled"===oe.status||!oe.selected.length)throw"Canceled";Md=oe.selected||oe;Array.isArray(Md)||(Md=[Md]);return id.return(Md)}})};rb._createAndLoadModules=function(Q,fa){var Ia,Sa,ec,Vb,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wc){switch(wc.nextAddress){case 1:Array.isArray(fa)||(fa=[fa]),Ia=[],Sa=$jscomp.makeIterator(fa),
ec=Sa.next();case 2:if(ec.done){wc.jumpTo(4);break}Vb=ec.value;return wc.yield(Q.forgetModule(Vb,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return wc.yield(Q.resourceEnsureExistance(Vb,'"format esm";\n'),6);case 6:return wc.setCatchFinallyBlocks(7),wc.yield(Q.importModule(Vb),9);case 9:Ia.push({name:Vb});wc.leaveTryBlock(3);break;case 7:Ua=wc.enterCatchBlock(),Ia.push({name:Vb,error:Ua});case 3:ec=Sa.next();wc.jumpTo(2);break;case 4:return wc.return(Ia)}})};rb.modulesInPackage_defaultExclude=function(Q){return[".git",
"node_modules",".optimized-loading-cache",".module_cache"].includes(Q.name())?!0:!1};rb.modulesInPackage=$b;rb.obj=cc;rb.arr=Rb;rb.resource=jc;rb.shortModuleName=Yb;rb.shortModuleName=Yb;rb.interactivelyChangeModule=qc;rb.interactivelyChangeModule=qc;rb.interactivelyReloadModule=Ob;rb.interactivelyReloadModule=Ob;rb.interactivelyUnloadModule=Hc;rb.interactivelyUnloadModule=Hc;rb.interactivelyRemoveModule=Yc;rb.interactivelyRemoveModule=Yc;rb.interactivelyAddModule=cd;rb.interactivelyAddModule=cd;
rb.modulesInPackage=$b;rb.modulesInPackage=$b;var Kb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/mocha-tests.js");Kb.loadMochaTestFile=pb;Kb.runMochaTests=xc;Kb.arr=Rb;Kb.chain=je;Kb.loadMochaTestFile=pb;Kb.loadMochaTestFile=pb;Kb.runMochaTests=xc;Kb.runMochaTests=xc;var Ib=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");Ib.todo=function(Q){throw Error(Q+" is not yet implemented!");};Ib.parseJsonLikeObj=md;Ib.arr=Rb;Ib.Closure=fd;Ib.obj=
cc;Ib.resource=jc;Ib.transform=Yd;Ib.modules=jd;var gb=function(){};gb.prototype.dynamicCompletionsForPrefix=function(Q,fa,Ia){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sa){Ib.todo("dynamicCompletionsForPrefix");Sa.jumpToEnd()})};gb.prototype.runEval=function(Q,fa){Ib.todo("runEval")};gb.prototype.resourceExists=function(Q){Ib.todo("resourceExists")};gb.prototype.resourceEnsureExistance=function(Q,fa){Ib.todo("resourceEnsureExistance")};gb.prototype.resourceMkdir=function(Q){Ib.todo("resourceMkdir")};
gb.prototype.resourceRead=function(Q){Ib.todo("resourceRead")};gb.prototype.resourceRemove=function(Q){Ib.todo("resourceRemove")};gb.prototype.resourceWrite=function(Q,fa){Ib.todo("resourceWrite")};gb.prototype.resourceCreateFiles=function(Q,fa){Ib.todo("resourceCreateFiles")};gb.prototype.resourceDirList=function(Q,fa,Ia){Ib.todo("resourceDirList")};gb.prototype.normalizeSync=function(Q,fa,Ia){Ib.todo("normalizeSync")};gb.prototype.normalize=function(Q,fa,Ia){Ib.todo("normalize")};gb.prototype.printSystemConfig=
function(){Ib.todo("printSystemConfig")};gb.prototype.getConfig=function(){Ib.todo("getConfig")};gb.prototype.setConfig=function(Q){Ib.todo("setConfig")};gb.prototype.getPackages=function(Q){Ib.todo("getPackages")};gb.prototype.isModuleLoaded=function(Q,fa){Ib.todo("isModuleLoaded")};gb.prototype.doesModuleExist=function(Q,fa){Ib.todo("doesModuleExist")};gb.prototype.getModules=function(){var Q=this,fa,Ia;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sa){return 1==Sa.nextAddress?(fa=
Ib.arr,Ia=fa.flatmap,Sa.yield(Q.getPackages(),2)):Sa.return(Ia.call(fa,Sa.yieldResult,function(ec){return ec.modules}))})};gb.prototype.getModule=function(Q){var fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return 1==Ia.nextAddress?Ia.yield(fa.getModules(),2):Ia.return(Ia.yieldResult.find(function(Sa){return Sa.name===Q}))})};gb.prototype.getPackage=function(Q){var fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return 1==Ia.nextAddress?(Q=Q.replace(/\/+$/,
""),Ia.yield(fa.getPackages(),2)):Ia.return(Ia.yieldResult.find(function(Sa){return Sa.address===Q||Sa.name===Q}))})};gb.prototype.getPackageForModule=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){Ib.todo("getPackageForModule");fa.jumpToEnd()})};gb.prototype.systemConfChange=function(Q){var fa=Ib.parseJsonLikeObj(Q);["baseURL"].forEach(function(Ia){return delete fa[Ia]});return this.setConfig(fa)};gb.prototype.resourcesOfPackage=function(Q,fa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){Ib.todo("resourcesOfPackage");
Ia.jumpToEnd()})};gb.prototype.registerPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){Ib.todo("registerPackage");fa.jumpToEnd()})};gb.prototype.importPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){Ib.todo("importPackage");fa.jumpToEnd()})};gb.prototype.removePackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){Ib.todo("removePackage");fa.jumpToEnd()})};gb.prototype.reloadPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){Ib.todo("reloadPackage");
fa.jumpToEnd()})};gb.prototype.packageConfChange=function(Q,fa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){Ib.todo("packageConfChange");Ia.jumpToEnd()})};gb.prototype.importModule=function(Q){Ib.todo("importModule")};gb.prototype.forgetModule=function(Q,fa){Ib.todo("forgetModule")};gb.prototype.reloadModule=function(Q,fa){Ib.todo("reloadModule")};gb.prototype.moduleFormat=function(Q){Ib.todo("moduleFormat")};gb.prototype.moduleRead=function(Q){Ib.todo("moduleRead")};gb.prototype.moduleSourceChange=
function(Q,fa,Ia){Ib.todo("moduleSourceChange")};gb.prototype.importsAndExportsOf=function(Q,fa){Ib.todo("importsAndExportsOf")};gb.prototype.keyValueListOfVariablesInModule=function(Q,fa){Ib.todo("keyValueListOfVariablesInModule")};gb.prototype.moduleWrite=function(Q,fa){return this.moduleSourceChange(Q,fa)};Ib.AbstractCoreInterface=gb;var ib=function(){var Q=Ib.AbstractCoreInterface.call(this)||this;Q.currentEval=null;return Q};$jscomp.inherits(ib,Ib.AbstractCoreInterface);ib.prototype.runEval=
function(Q,fa){throw Error("Not yet implemented");};ib.prototype.runEvalAndStringify=function(Q,fa){var Ia=this;return this.currentEval?this.currentEval.then(function(){return Ia.runEvalAndStringify(Q,fa)}):this.currentEval=Promise.resolve().then(function(){var Sa,ec,Vb,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wc){switch(wc.nextAddress){case 1:return wc.yield(Ia.runEval("\n        Promise.resolve((async "+Ib.transform.wrapInFunction(Q)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},fa)),2);case 2:if((Sa=wc.yieldResult)&&Sa.isError)throw Error(String(Sa.value||Sa.error));if(!Sa||!Sa.value)return wc.return(null);if(ec=Sa.promisedValue){wc.jumpTo(3);break}return wc.yield(Sa.value,4);case 4:ec=wc.yieldResult;case 3:Vb=ec;if(!Vb)return wc.return();if("undefined"===Vb)return wc.return(void 0);if("null"===Vb)return wc.return(null);if("true"===Vb)return wc.return(!0);
if("false"===Vb)return wc.return(!1);try{Ua=JSON.parse(Vb)}catch(oe){return wc.return(Vb)}if(Ua&&Ua.isError)throw Error(String(Ua.value));return wc.return(Ua)}})}).then(function(Sa){delete Ia.currentEval;return Sa},function(Sa){delete Ia.currentEval;return Promise.reject(Sa)})};ib.prototype.dynamicCompletionsForPrefix=function(Q,fa,Ia){var Sa=this,ec,Vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){ec=Ib.obj.isString(Ia.context)?Ia.context:!1;Ia=Ib.obj.dissoc(Ia,["systemInterface",
"System","context"]);Vb="\n      var prefix = "+JSON.stringify(fa)+",\n          opts = "+JSON.stringify(Ia)+";\n      opts.context = "+ec+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return Ua.return(Sa.runEvalAndStringify(Vb))})};ib.prototype.evalWithResource=function(Q,fa,Ia){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+Q+'").'+fa+"("+(Ia?JSON.stringify(Ia):"")+");\n    ")};ib.prototype.resourceExists=function(Q){return this.evalWithResource(Q,"exists")};ib.prototype.resourceEnsureExistance=function(Q,fa){return this.evalWithResource(Q,
"ensureExistance",fa)};ib.prototype.resourceMkdir=function(Q){return this.evalWithResource(Q,"mkdir")};ib.prototype.resourceRead=function(Q){return this.evalWithResource(Q,"read")};ib.prototype.resourceRemove=function(Q){return this.evalWithResource(Q,"remove")};ib.prototype.resourceWrite=function(Q,fa){return this.evalWithResource(Q,"write",fa)};ib.prototype.resourceCreateFiles=function(Q,fa){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
Q+'", '+JSON.stringify(fa)+")")};ib.prototype.resourceDirList=function(Q,fa,Ia){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+Q+'").dirList('+JSON.stringify(fa)+", "+JSON.stringify(Ia)+"))\n        .map(({url}) => ({url}))")};ib.prototype.livelySystemAccessor=function(Q){Q=void 0===Q?"livelySystem":Q;return"var "+Q+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
Q+') throw new Error("lively-system-interface not available!");'};ib.prototype.normalizeSync=function(Q,fa,Ia){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(Q)+", "+JSON.stringify(fa)+", "+Ia+")")};ib.prototype.normalize=function(Q,fa,Ia){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(Q)+", "+JSON.stringify(fa)+", "+JSON.stringify(Ia)+")")};ib.prototype.printSystemConfig=function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")};
ib.prototype.getConfig=function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')};ib.prototype.setConfig=function(Q){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(Q)+")")};ib.prototype.getPackages=function(Q){Q=Object.assign({excluded:[]},Q);Q.excluded=Q.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(Q)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')};ib.prototype.getPackageForModule=function(Q){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(Q)+")")};ib.prototype.isModuleLoaded=function(Q,fa){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+Q+'", '+fa+")")};ib.prototype.doesModuleExist=function(Q,fa){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+Q+'", '+fa+")")};ib.prototype.registerPackage=function(Q){var fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return Ia.return(fa.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(Q)+")"))})};ib.prototype.importPackage=
function(Q){var fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return Ia.return(fa.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(Q)+")"))})};ib.prototype.removePackage=function(Q){var fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return Ia.return(fa.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(Q)+")"))})};ib.prototype.reloadPackage=function(Q,fa){var Ia=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sa){return Sa.return(Ia.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(Q)+", "+JSON.stringify(fa)+")"))})};ib.prototype.packageConfChange=function(Q,fa){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(Q)+", "+JSON.stringify(fa)+")")};ib.prototype.resourcesOfPackage=function(Q,fa){fa=void 0===fa?[".git","node_modules",".module_cache","lively.next-node_modules"]:fa;var Ia=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sa){Q.address&&(Q=
Q.address);return Sa.return(Ia.runEvalAndStringify("\n      "+Ia.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(Q)+", "+JSON.stringify(fa)+");"))})};ib.prototype.getModule=function(Q){var fa=this,Ia;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sa){if(1==Sa.nextAddress)return Sa.yield(fa.getModules(),2);Ia=Sa.yieldResult.find(function(ec){return ec.name===Q});return Sa.return(Ia?Ib.modules.module(Ia.name):null)})};ib.prototype.importModule=
function(Q){return this.runEvalAndStringify("lively.modules.System.import("+JSON.stringify(Q)+")")};ib.prototype.forgetModule=function(Q,fa){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").unload("+JSON.stringify(fa)+")")};ib.prototype.reloadModule=function(Q,fa){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").reload("+JSON.stringify(fa)+")")};ib.prototype.moduleFormat=function(Q){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(Q)+").format();")};ib.prototype.moduleRead=function(Q){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").source()")};ib.prototype.moduleSourceChange=function(Q,fa,Ia){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").changeSource("+JSON.stringify(fa)+", "+JSON.stringify(Ia)+")")};ib.prototype.keyValueListOfVariablesInModule=function(Q,fa){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+
JSON.stringify(Q)+", "+JSON.stringify(fa)+")")};ib.prototype.importsAndExportsOf=function(Q,fa){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(Q)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(Q)+").exports()})")};ib.prototype.exportsOfModules=function(Q){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(Q)+";\n      options.excludedPackages = ["+Q.excludedPackages.map(function(fa){return"function"===
typeof fa?fa.toString():JSON.stringify(fa)}).join(",")+"]\n      await livelySystem.localInterface.exportsOfModules(options)")};ib.prototype.searchInPackage=function(Q,fa,Ia){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(Q)+", "+JSON.stringify(fa)+", "+JSON.stringify(Ia)+")")};ib.prototype.loadMochaTestFile=function(Q,fa){fa=void 0===fa?[]:fa;var Ia=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sa){return Sa.return(Ia.runEvalAndStringify("\n      "+
Ia.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(Q)+", "+JSON.stringify(fa)+"), result;\n      result = {testsByFile}"))})};ib.prototype.runMochaTests=function(Q,fa,Ia,Sa){var ec=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vb){Q&&Q instanceof RegExp&&(Q={isRegExp:!0,value:String(Q).replace(/^\/|\/$/g,"")});return Vb.return(ec.runEvalAndStringify("\n      var grep = "+JSON.stringify(Q)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
ec.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(fa||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})};
Ib.RemoteCoreInterface=ib;var Lb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");Lb.obj=cc;Lb.string=Pc;Lb.arr=Rb;Lb.resource=jc;Lb.createFiles=vd;Lb.ast=Ab;Lb.modules=jd;Lb.vm=Ld;Lb.loadMochaTestFile=pb;Lb.runMochaTests=xc;Lb.parseJsonLikeObj=md;Lb.AbstractCoreInterface=gb;Lb.classToFunctionTransform=ge;gb=function(){return Lb.AbstractCoreInterface.apply(this,arguments)||this};$jscomp.inherits(gb,Lb.AbstractCoreInterface);gb.prototype.dynamicCompletionsForPrefix=
function(Q,fa,Ia){var Sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ec){if(1==ec.nextAddress)return ec.yield(Lb.vm.completions.getCompletions(function(Vb){return Lb.vm.runEval(Vb.replace("return ",""),Object.assign({targetModule:Q,classTransform:Lb.classToFunctionTransform},Ia))},fa),2);Sa=ec.yieldResult;if(Sa.isError)throw Sa.value;return ec.return({completions:Sa.completions,prefix:Sa.startLetters})})};gb.prototype.runEval=function(Q,fa){return Lb.vm.runEval(Q,Object.assign({classTransform:Lb.classToFunctionTransform},
fa))};gb.prototype.resourceExists=function(Q){return Lb.resource(Q).exists()};gb.prototype.resourceEnsureExistance=function(Q,fa){return Lb.resource(Q).ensureExistance(fa)};gb.prototype.resourceMkdir=function(Q){return Lb.resource(Q).mkdir()};gb.prototype.resourceRead=function(Q){return Lb.resource(Q).read()};gb.prototype.resourceRemove=function(Q){return Lb.resource(Q).remove()};gb.prototype.resourceWrite=function(Q,fa){return Lb.resource(Q).write(fa)};gb.prototype.resourceCreateFiles=function(Q,
fa){return Lb.createFiles(Q,fa)};gb.prototype.resourceDirList=function(Q,fa,Ia){return Lb.resource(Q).dirList(fa,Ia)};gb.prototype.normalizeSync=function(Q,fa,Ia){return System.decanonicalize(Q,fa,Ia)};gb.prototype.normalize=function(Q,fa,Ia){return System.normalize(Q,fa,Ia)};gb.prototype.printSystemConfig=function(){return Lb.modules.printSystemConfig()};gb.prototype.getConfig=function(){return System.getConfig()};gb.prototype.setConfig=function(Q){Lb.modules.System.config(Q)};gb.prototype.getPackages=
function(Q){Q=Object.assign({},Q);Q=void 0===Q.excluded?[]:Q.excluded;var fa=Q.filter(function(Sa){return"string"===typeof Sa}),Ia=Q.filter(function(Sa){return"function"===typeof Sa});fa=fa.concat(fa.map(function(Sa){return System.decanonicalize(Sa.replace(/\/?$/,"/")).replace(/\/$/,"")}));return Lb.modules.getPackages().filter(function(Sa){return!fa.includes(Sa.url)&&!Ia.some(function(ec){return ec(Sa.url)})})};gb.prototype.registerPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){return fa.return(Lb.modules.registerPackage(Q))})};
gb.prototype.importPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){return fa.return(Lb.modules.importPackage(Q))})};gb.prototype.removePackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){return fa.return(Lb.modules.removePackage(Q))})};gb.prototype.reloadPackage=function(Q,fa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return Ia.return(Lb.modules.reloadPackage(Q,fa))})};gb.prototype.packageConfChange=function(Q,
fa){var Ia=this,Sa,ec,Vb,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wc){if(1==wc.nextAddress)return Sa=Lb.modules.System,ec=Lb.parseJsonLikeObj(Q),Vb=JSON.stringify(ec,null,2),wc.yield(Lb.modules.module(fa).changeSource(Vb,{doEval:!1}),2);if(3!=wc.nextAddress)return Sa.set(fa,Sa.newModule(ec)),wc.yield(Ia.getPackageForModule(fa),3);(Ua=wc.yieldResult)&&Lb.modules.applyPackageConfig(ec,Ua.address);wc.jumpToEnd()})};gb.prototype.resourcesOfPackage=function(Q,fa){fa=void 0===fa?[".git",
"node_modules",".module_cache"]:fa;var Ia,Sa,ec;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vb){if(1==Vb.nextAddress)return Vb.setCatchFinallyBlocks(2),Ia=Q.address?Q.address:Q,Sa=Lb.modules.getPackage(Ia),Vb.yield(Sa.resources(void 0,fa),4);if(2!=Vb.nextAddress)return Vb.return(Vb.yieldResult.map(function(Ua){return Object.assign(Ua,{package:Ua.package.url})}));ec=Vb.enterCatchBlock();console.warn("resourcesOfPackage error for "+Q+": "+ec);return Vb.return([])})};gb.prototype.getPackageForModule=
function(Q){return(Q=Lb.modules.getPackageOfModule(Q))?Q.asSpec():Q};gb.prototype.isModuleLoaded=function(Q,fa){return Lb.modules.isModuleLoaded(Q,fa)};gb.prototype.doesModuleExist=function(Q,fa){return Lb.modules.isModuleLoaded(Q,fa)};gb.prototype.getModule=function(Q){return Lb.modules.module(Q)};gb.prototype.importModule=function(Q){return Lb.modules.System.import(Q)};gb.prototype.forgetModule=function(Q,fa){return Lb.modules.module(Q).unload(fa)};gb.prototype.reloadModule=function(Q,fa){return Lb.modules.module(Q).reload(fa)};
gb.prototype.moduleFormat=function(Q){return Lb.modules.module(Q).format()};gb.prototype.moduleRead=function(Q){return Lb.modules.module(Q).source()};gb.prototype.moduleSourceChange=function(Q,fa,Ia){return Lb.modules.module(Q).changeSource(fa,Ia)};gb.prototype.keyValueListOfVariablesInModule=function(Q,fa){var Ia=this,Sa,ec,Vb,Ua,wc,oe,Md,id;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ta){switch(Ta.nextAddress){case 1:if(fa){Ta.jumpTo(2);break}return Ta.yield(Ia.resourceRead(Q),3);
case 3:fa=Ta.yieldResult;case 2:return Sa="string"===typeof fa?Lb.ast.parse(fa):fa,ec=Ia.normalizeSync(Q),Ia.moduleFormat(ec),Vb=Lb.modules.module(ec).env().recorder,Ta.yield(Ia.importsAndExportsOf(ec,Sa),4);case 4:return Ua=Ta.yieldResult,wc=Lb.ast.query.topLevelDeclsAndRefs(Sa),oe=Lb.arr.sortByKey(Lb.ast.query.declarationsOfScope(wc.scope,!0),"start"),Md=Lb.arr.pluck(wc.scope.importSpecifiers,"name"),id=0,Ta.return(oe.map(function(rd){var jb=rd.name.length,Qd=Ua.exports.find(function(lb){return lb.local===
rd.name}),ab=Lb.arr.include(Md,rd.name);Qd&&(jb+=9);ab&&(jb+=9);id=Math.max(id,jb);return{isExport:Qd,isImport:ab,name:rd.name,value:Vb[rd.name],node:rd,printedName:rd.name+(Qd?" [export]":"")+(ab?" [import]":""),printedValue:Lb.obj.inspect(Vb[rd.name],{maxDepth:1}).replace(/\n/g,"")}}).map(function(rd){return{isListItem:!0,value:rd,string:rd.printedName+Lb.string.indent(" = "+rd.printedValue," ",id-rd.printedName.length)}}))}})};gb.prototype.importsAndExportsOf=function(Q,fa){var Ia;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sa){return 1==
Sa.nextAddress?Sa.yield(Lb.modules.module(Q).imports(fa),2):3!=Sa.nextAddress?(Ia=Sa.yieldResult,Sa.yield(Lb.modules.module(Q).exports(fa),3)):Sa.return({imports:Ia,exports:Sa.yieldResult})})};gb.prototype.exportsOfModules=function(Q){return Lb.modules.ExportLookup.run(System,Q)};gb.prototype.searchInPackage=function(Q,fa,Ia){return Lb.modules.getPackage(Q).search(fa,Ia)};gb.prototype.runMochaTests=function(Q,fa,Ia,Sa){return Lb.runMochaTests(Q,fa,Ia,Sa)};gb.prototype.loadMochaTestFile=function(Q,
fa){return Lb.loadMochaTestFile(Q,fa)};$jscomp.global.Object.defineProperties(gb.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"local"}}});Lb.LocalCoreInterface=gb;var tc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");tc.evalStrategies=Td;tc.RemoteCoreInterface=ib;var Qc=function(Q){var fa=tc.RemoteCoreInterface.call(this)||this;fa.currentEval=null;fa.url=Q;fa.server=new tc.evalStrategies.HttpEvalStrategy(Q);return fa};$jscomp.inherits(Qc,
tc.RemoteCoreInterface);Qc.prototype.runEval=function(Q,fa){return this.server.runEval(Q,fa)};$jscomp.global.Object.defineProperties(Qc.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this.url}},description:{configurable:!0,enumerable:!0,get:function(){return this.url.replace(/^https?:\/\//,"")}}});tc.HTTPCoreInterface=Qc;var sc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");sc.evalStrategies=Td;sc.RemoteCoreInterface=ib;ib=function(Q,
fa){var Ia=sc.RemoteCoreInterface.call(this)||this;Ia.targetId=Q;Ia.peer=fa;return Ia};$jscomp.inherits(ib,sc.RemoteCoreInterface);ib.prototype.isConnected=function(){var Q=this,fa,Ia,Sa,ec,Vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){if(1==Ua.nextAddress)return fa=Q,Ia=fa.client,Sa=fa.targetId,Ua.yield(Ia.sendToAndWait(Ia.trackerId,"getClients",{}),2);ec=Ua.yieldResult;Vb=ec.data;return Ua.return(Vb.some(function(wc){wc=$jscomp.makeIterator(wc).next().value;return Sa===wc}))})};
ib.prototype.runEval=function(Q,fa){var Ia=this,Sa,ec;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vb){Sa=Ia.client;if(!Sa)throw Error("No lively.2lively default client available!");ec=new sc.evalStrategies.L2LEvalStrategy(Sa,Ia.targetId);return Vb.return(ec.runEval(Q,fa))})};$jscomp.global.Object.defineProperties(ib.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"l2l "+this.targetId}},description:{configurable:!0,enumerable:!0,get:function(){var Q=this.peer,fa=
"l2l "+this.targetId.slice(0,5);if(Q){var Ia=Q.location,Sa=Q.type,ec=Q.user;Q=Q.world;Sa&&(fa+=", "+Sa);Ia&&(fa+=", "+Ia.replace(/^https?:\/\//,"")+(Q?"/"+Q:""));ec&&(fa+=", "+ec.name)}return fa}},client:{configurable:!0,enumerable:!0,get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}}});sc.L2LCoreInterface=ib;var Vc=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");Vc.systemInterfaceNamed=Lc;Vc.interactivelyCreatePackage=
Za;Vc.interactivelyLoadPackage=Db;Vc.interactivelyReloadPackage=ac;Vc.interactivelyUnloadPackage=ic;Vc.interactivelyRemovePackage=gd;Vc.showExportsAndImportsOf=fe;Vc.shortModuleName=Yb;Vc.interactivelyChangeModule=qc;Vc.interactivelyReloadModule=Ob;Vc.interactivelyUnloadModule=Hc;Vc.interactivelyRemoveModule=Yc;Vc.interactivelyAddModule=cd;Vc.modulesInPackage=$b;Vc.LocalCoreInterface=gb;Vc.HTTPCoreInterface=Qc;Vc.L2LCoreInterface=ib;ib=function(Q){this.coreInterface=Q};ib.prototype.dynamicCompletionsForPrefix=
function(Q,fa,Ia){return this.coreInterface.dynamicCompletionsForPrefix(Q,fa,Ia)};ib.prototype.runEval=function(Q,fa){return this.coreInterface.runEval(Q,fa)};ib.prototype.printSystemConfig=function(Q,fa,Ia){return this.coreInterface.printSystemConfig(Q,fa,Ia)};ib.prototype.getConfig=function(Q,fa,Ia){return this.coreInterface.getConfig(Q,fa,Ia)};ib.prototype.getPackages=function(Q){return this.coreInterface.getPackages(Q)};ib.prototype.getModules=function(Q,fa,Ia){return this.coreInterface.getModules(Q,
fa,Ia)};ib.prototype.getModule=function(Q,fa,Ia){return this.coreInterface.getModule(Q,fa,Ia)};ib.prototype.getPackage=function(Q,fa,Ia){return this.coreInterface.getPackage(Q,fa,Ia)};ib.prototype.getPackageForModule=function(Q,fa,Ia){return this.coreInterface.getPackageForModule(Q,fa,Ia)};ib.prototype.resourcesOfPackage=function(Q,fa){return this.coreInterface.resourcesOfPackage(Q,fa)};ib.prototype.systemConfChange=function(Q,fa,Ia){return this.coreInterface.systemConfChange(Q,fa,Ia)};ib.prototype.registerPackage=
function(Q){return this.coreInterface.registerPackage(Q)};ib.prototype.importPackage=function(Q){return this.coreInterface.importPackage(Q)};ib.prototype.removePackage=function(Q){return this.coreInterface.removePackage(Q)};ib.prototype.reloadPackage=function(Q){return this.coreInterface.reloadPackage(Q)};ib.prototype.packageConfChange=function(Q,fa){return this.coreInterface.packageConfChange(Q,fa)};ib.prototype.keyValueListOfVariablesInModule=function(Q,fa){return this.coreInterface.keyValueListOfVariablesInModule(Q,
fa)};ib.prototype.interactivelyCreatePackage=function(Q){return Vc.interactivelyCreatePackage(this.coreInterface,Q)};ib.prototype.interactivelyLoadPackage=function(Q,fa){return Vc.interactivelyLoadPackage(this.coreInterface,Q,fa)};ib.prototype.interactivelyReloadPackage=function(Q,fa){return Vc.interactivelyReloadPackage(this.coreInterface,Q,fa)};ib.prototype.interactivelyUnloadPackage=function(Q,fa,Ia){return Vc.interactivelyUnloadPackage(this.coreInterface,Q,fa,Ia)};ib.prototype.interactivelyRemovePackage=
function(Q,fa){return Vc.interactivelyRemovePackage(this.coreInterface,Q,fa)};ib.prototype.isModuleLoaded=function(Q,fa){return this.coreInterface.isModuleLoaded(Q,fa)};ib.prototype.doesModuleExist=function(Q,fa){return this.coreInterface.doesModuleExist(Q,fa)};ib.prototype.importModule=function(Q){return this.coreInterface.importModule(Q)};ib.prototype.forgetModule=function(Q,fa){return this.coreInterface.forgetModule(Q,fa)};ib.prototype.reloadModule=function(Q,fa){return this.coreInterface.reloadModule(Q,
fa)};ib.prototype.moduleFormat=function(Q){return this.coreInterface.moduleFormat(Q)};ib.prototype.moduleRead=function(Q){return this.coreInterface.moduleRead(Q)};ib.prototype.moduleWrite=function(Q,fa){return this.coreInterface.moduleWrite(Q,fa)};ib.prototype.getModulesInPackage=function(Q){return Vc.modulesInPackage(this.coreInterface,Q)};ib.prototype.shortModuleName=function(Q,fa){return Vc.shortModuleName(this.coreInterface,Q,fa)};ib.prototype.interactivelyChangeModule=function(Q,fa,Ia){return Vc.interactivelyChangeModule(this.coreInterface,
Q,fa,Ia)};ib.prototype.interactivelyReloadModule=function(Q,fa){return Vc.interactivelyReloadModule(this.coreInterface,Q,fa)};ib.prototype.interactivelyUnloadModule=function(Q,fa){return Vc.interactivelyUnloadModule(this.coreInterface,Q,fa)};ib.prototype.interactivelyRemoveModule=function(Q,fa){return Vc.interactivelyRemoveModule(this.coreInterface,Q,fa)};ib.prototype.interactivelyAddModule=function(Q,fa){return Vc.interactivelyAddModule(this.coreInterface,Q,fa)};ib.prototype.showExportsAndImportsOf=
function(Q,fa){return Vc.showExportsAndImportsOf(this.coreInterface,Q,fa)};ib.prototype.exportsOfModules=function(Q){return this.coreInterface.exportsOfModules(Q)};ib.prototype.searchInPackage=function(Q,fa,Ia){return this.coreInterface.searchInPackage(Q,fa,Ia)};ib.prototype.searchInAllPackages=function(Q,fa){fa=void 0===fa?{}:fa;var Ia=this,Sa,ec,Vb,Ua,wc,oe,Md,id;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ta){switch(Ta.nextAddress){case 1:return(Sa=fa.progress)&&Sa.step("Fetching Packages...",
0),Ta.yield(Ia.coreInterface.getPackages({excluded:fa.excludedPackages}),2);case 2:ec=Ta.yieldResult,Vb=[],Sa&&Sa.step("Fetching Packages...",.1),Ua=0;case 3:if(!(Ua<ec.length)){Ta.jumpTo(5);break}wc=ec[Ua];oe=wc.url;if(!oe||"no group"===oe){Ta.jumpTo(4);break}Sa&&Sa.step(oe.replace(System.baseURL,"").slice(0,20),.1+Ua/ec.length*.9);Ta.setCatchFinallyBlocks(6);return Ta.yield(Ia.coreInterface.searchInPackage(oe,Q,fa),8);case 8:Md=Ta.yieldResult;Vb=Vb.concat(Md);Ta.leaveTryBlock(4);break;case 6:id=
Ta.enterCatchBlock(),console.error("Error searching in package "+oe+":\n"+id.stack);case 4:Ua++;Ta.jumpTo(3);break;case 5:return Ta.return(Vb)}})};ib.prototype.loadMochaTestFile=function(Q,fa){return this.coreInterface.loadMochaTestFile(Q,fa)};ib.prototype.runMochaTests=function(Q,fa,Ia,Sa){return this.coreInterface.runMochaTests(Q,fa,Ia,Sa)};$jscomp.global.Object.defineProperties(ib.prototype,{isSystemInterface:{configurable:!0,enumerable:!0,get:function(){return!0}},name:{configurable:!0,enumerable:!0,
get:function(){return this.coreInterface.name}}});Da("Interface",ib);Vc.Interface=ib;Vc.systemInterfaceNamed=Lc;Vc.systemInterfaceNamed=Lc;ib=Da("localInterface",new Vc.Interface(new Vc.LocalCoreInterface));Vc.localInterface=ib;Vc.localInterface=ib;Vc.localInterface=ib;Vc.httpInterfaces={};ib=Da("serverInterfaceFor",function(Q){return Vc.httpInterfaces[Q]||(Vc.httpInterfaces[Q]=new Vc.Interface(new Vc.HTTPCoreInterface(Q)))});Vc.serverInterfaceFor=ib;Vc.serverInterfaceFor=ib;Vc.serverInterfaceFor=
ib;Vc.l2lInterfaces={};ib=Da("l2lInterfaceFor",function(Q,fa){return Vc.l2lInterfaces[Q]||(Vc.l2lInterfaces[Q]=new Vc.Interface(new Vc.L2LCoreInterface(Q,fa)))});Vc.l2lInterfaceFor=ib;Vc.l2lInterfaceFor=ib;Vc.l2lInterfaceFor=ib}}});