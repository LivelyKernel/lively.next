System.register(["./__root_module__-255c8c26.js","kld-intersections"],function(Da){var Ab,Tb,kc,ec,he,gd,Zd,kd,Sc,yd,Od,fe,Ud,md,db;return{setters:[function(Fb){Ab=Fb.s;Tb=Fb.P;kc=Fb.a5;ec=Fb.p;he=Fb.bF;gd=Fb.B;Zd=Fb.bG;kd=Fb.r;Sc=Fb.aR;yd=Fb.bH;Od=Fb.bI;fe=Fb.bJ;Ud=Fb.bK;md=Fb.bL;db=Fb.n},function(){}],execute:function(){function Fb(zc,Ec,Pb,Qb){Qb=void 0===Qb?{}:Qb;Qb=Qb.package||nc.ObjectPackage.lookupPackageForObject(zc,Qb);if(!Qb)throw Error("Object is not part of an object package: "+zc);
return Qb.addScript(zc,Ec,Pb)}function tc(zc,Ec){Ec=nc.normalizeOptions(Ec).System;zc=(zc=zc[Symbol.for("lively-module-meta")])?zc.package.name:null;return(Ec=(zc?nc.lookupPackage(Ec,zc):{}).pkg)?!!nc.ObjectPackage.forSystemPackage(Ec):!1}Da({addScript:Fb,isObjectClass:tc});var nc=lively.FreezerRuntime.recorderFor("lively.classes/object-classes.js");nc.normalizeOptions=function(zc){zc=Object.assign({baseURL:nc.defaultBaseURL,System:System},zc);zc.baseURL=zc.baseURL.replace(/\/$/,"");return zc};nc.addScript=
Fb;nc.isObjectClass=tc;nc.string=Ab;nc.Path=Tb;nc.arr=kc;nc.parse=ec;nc.isValidIdentifier=he;nc.stringify=gd;nc.parseFunction=Zd;nc.resource=kd;nc.runEval=Sc;nc.scripting=yd;nc.ExportLookup=Od;var td=nc.scripting;nc.ensurePackage=td.ensurePackage;nc.registerPackage=td.registerPackage;nc.importPackage=td.importPackage;nc.lookupPackage=td.lookupPackage;nc.module=td.module;nc.ImportInjector=td.ImportInjector;nc.RuntimeSourceDescriptor=fe;nc.toJsIdentifier=Ud;nc.adoptObject=md;nc.classToFunctionTransform=
db;nc.objectPackageSym=Symbol.for("lively-object-package-data");nc.defaultBaseURL="local://lively-object-modules";nc.globalClasses=Object.keys(System.global).map(function(zc){zc=System.global[zc];return"function"===typeof zc&&zc.name&&zc}).filter(Boolean);nc.addScript=Fb;nc.addScript=Fb;nc.isObjectClass=tc;nc.isObjectClass=tc;nc._packageStore=nc._packageStore||{};td=function(zc,Ec){this._id=zc;this.options=nc.normalizeOptions(Ec)};td.lookupPackageForObject=function(zc,Ec){return this.lookupPackageForClass(zc.constructor,
Ec)};td.lookupPackageForClass=function(zc,Ec){Ec=nc.normalizeOptions(Ec).System;zc=(zc=zc[Symbol.for("lively-module-meta")])?zc.package.name:null;return(Ec=(zc?nc.lookupPackage(Ec,zc):{}).pkg)?nc.ObjectPackage.forSystemPackage(Ec):null};td.forSystemPackage=function(zc){return this.packageStore[zc.name]};td.withId=function(zc,Ec){return this.packageStore[zc]||(this.packageStore[zc]=new this(zc,Ec))};td.prototype.resource=function(zc){zc=void 0===zc?"":zc;return nc.resource(this.packageURL).join(zc)};
td.prototype.load=function(){return nc.importPackage(this.System,this.packageURL)};td.prototype.ensureExistance=function(){var zc=this,Ec,Pb,Qb,Tc,ld,Rb,qb,bc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ic){switch(Ic.nextAddress){case 1:return Ec=zc.resource("/"),Ic.yield(Ec.exists(),2);case 2:if(Ic.yieldResult)return Ic.return();Pb=[{resource:Ec}];Qb=[{resource:zc.resource("package.json"),content:JSON.stringify(zc.config,null,2)}];return Ic.yield(Promise.all(Pb.map(function(ra){return ra.resource.mkdir()})),
3);case 3:return Ic.yield(Promise.all(Qb.map(function(ra){var Fa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(mb){switch(mb.nextAddress){case 1:return mb.yield(ra.resource.exists(),2);case 2:if(!(Fa=!mb.yieldResult)){mb.jumpTo(3);break}return mb.yield(ra.resource.write(ra.content),4);case 4:Fa=mb.yieldResult;case 3:return mb.return(Fa)}})})),4);case 4:return Ic.yield(zc.objectModule.ensureExistance(),5);case 5:return Tc=zc,ld=Tc.System,Rb=Tc.packageURL,qb=Tc.config,Ic.yield(nc.ensurePackage(ld,
Rb),6);case 6:return bc=Ic.yieldResult,bc.registerWithConfig(qb),console.log(zc.packageURL+" REGISTERED"),Ic.return(zc)}})};td.prototype.ensureObjectClass=function(zc){var Ec=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pb){return 1==Pb.nextAddress?Pb.yield(Ec.ensureExistance(),2):Pb.return(Ec.objectModule.ensureObjectClass(zc))})};td.prototype.adoptObject=function(zc){var Ec=this,Pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qb){if(1==Qb.nextAddress)return Ec.objectClass===
zc.constructor?Qb.return():Qb.yield(Ec.ensureObjectClass(zc.constructor),2);Pb=Qb.yieldResult;nc.adoptObject(zc,Pb);Qb.jumpToEnd()})};td.prototype.addScript=function(zc,Ec,Pb){return this.objectModule.addScript(zc,Ec,Pb)};td.prototype.remove=function(){this.systemPackage.remove();delete nc.ObjectPackage.packageStore[this.id];return this.resource().remove()};td.prototype.renameObjectClass=function(zc,Ec){Ec=void 0===Ec?[]:Ec;var Pb=this,Qb,Tc,ld,Rb,qb,bc,Ic,ra,Fa,mb,ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Db){if(1==
Db.nextAddress){Qb=Pb;Tc=Qb.objectClass;ld=Qb.System;if(!Tc||Tc.className===zc)return Db.return(Tc);if(!nc.isValidIdentifier(zc))throw Error(zc+" is not a valid name for a class");qb=Rb=nc.RuntimeSourceDescriptor.for(Tc,ld);bc=qb.source;Ic=qb.ast;ra=Ic.id;Fa=ra.start;mb=ra.end;return Db.yield(Rb.changeSource(bc.slice(0,Fa)+zc+bc.slice(mb)),2)}ub=Pb.objectClass;Ec.forEach(function(cb){cb.constructor=ub;cb.__proto__=ub.prototype});return Db.return(ub)})};td.prototype.fork=function(zc,Ec){var Pb=this,
Qb,Tc,ld,Rb,qb,bc,Ic,ra,Fa,mb,ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Db){switch(Db.nextAddress){case 1:return Qb=Pb,Tc=Qb.System,ld=Qb.baseURL,Rb=Qb.objectClass,Ec=Object.assign({System:Tc,baseURL:ld},Ec),qb=nc.RuntimeSourceDescriptor.for(Rb),bc=qb._renamedSource(zc),Ic=bc.moduleSource,ra=nc.ObjectPackage.withId(zc,Ec),Db.yield(ra.ensureExistance(),2);case 2:return Fa=ra,mb=Fa.objectModule,ub=mb.systemModule,Db.yield(ub.load({format:"esm"}),3);case 3:return Db.yield(ub.changeSource(Ic),
4);case 4:return Db.return(ra)}})};$jscomp.global.Object.defineProperties(td.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return this._id}},name:{configurable:!0,enumerable:!0,get:function(){return this.id}},System:{configurable:!0,enumerable:!0,get:function(){return this.options.System}},baseURL:{configurable:!0,enumerable:!0,get:function(){return this.options.baseURL}},packageURL:{configurable:!0,enumerable:!0,get:function(){return this.baseURL+("/"+this.id)}},config:{configurable:!0,
enumerable:!0,get:function(){return{name:this.name,version:"0.1.0",lively:{isObjectPackage:!0}}}},systemPackage:{configurable:!0,enumerable:!0,get:function(){return nc.lookupPackage(this.System,this.packageURL,!0).pkg}},objectModule:{configurable:!0,enumerable:!0,get:function(){return this._objectModule||(this._objectModule=new nc.ObjectModule("index.js",this))}},objectClass:{configurable:!0,enumerable:!0,get:function(){return this.objectModule.objectClass}}});$jscomp.global.Object.defineProperties(td,
{packageStore:{configurable:!0,enumerable:!0,get:function(){return this._packageStore||(this._packageStore=nc._packageStore)}}});Da("default",td);nc.ObjectPackage=td;var ke=function(zc,Ec){if(!zc)throw Error("ObjectModule needs package!");if(!Ec)throw Error("ObjectModule needs package!");this._moduleName=zc;this._objectPackage=Ec};ke.prototype.read=function(){return this.resource.read()};ke.prototype.write=function(zc){return this.resource.write(zc)};ke.prototype.ensureExistance=function(){var zc=
this,Ec,Pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qb){switch(Qb.nextAddress){case 1:return Ec=zc.resource,Qb.yield(Ec.exists(),2);case 2:if(Qb.yieldResult){Qb.jumpTo(3);break}return Qb.yield(Ec.write("'format esm';\n"),4);case 4:Pb={},zc.System.config({meta:(Pb[zc.url]={format:"esm"},Pb)});case 3:return Qb.return(zc)}})};ke.prototype.ensureObjectClass=function(zc){var Ec=this,Pb=this.objectClass;return Pb&&Pb.prototype.__proto__===zc.prototype?Pb:Promise.resolve(this.ensureObjectClassSource(zc)).then(function(Qb){var Tc=
Qb.source,ld=Qb.moduleId,Rb=Qb.className,qb=Qb.bindings,bc=Ec.System;Qb=nc.module(bc,ld);if(qb)for(var Ic in qb)Qb.define(Ic,qb[Ic]);Tc=nc.runEval(Tc,{classTransform:nc.classToFunctionTransform,sync:!0,targetModule:ld,System:bc});if(Tc.isError)throw Tc.value;Tc=Qb.recorder[Rb];if(!Tc)throw Error("Failed to define class "+Rb+" in "+ld);return Tc})};ke.prototype.ensureObjectClassSource=function(zc){return this.createDefaultClassDeclaration(zc)};ke.prototype.createDefaultClassDeclaration=function(zc){zc=
void 0===zc?Object:zc;var Ec=this,Pb,Qb,Tc,ld,Rb,qb,bc,Ic,ra,Fa,mb,ub,Db,cb,fb,Eb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qc){switch(qc.nextAddress){case 1:Pb=Ec;Qb=Pb.System;Tc=Pb.systemModule;ld=Pb.objectPackage;Rb=nc.string.capitalize(nc.toJsIdentifier(ld.id));qb=zc.className;bc=!qb;Ic=nc.globalClasses.includes(zc);ra="";Fa=null;if(bc){qb="__anonymous_superclass__";mb={};Fa=(mb[qb]=zc,mb);qc.jumpTo(2);break}if(Ic){qc.jumpTo(2);break}return qc.yield(nc.ExportLookup.findExportOfValue(zc,
Qb),4);case 4:(ub=qc.yieldResult)?(Db=nc.ImportInjector.run(Qb,Tc.id,Tc.package(),"",ub),cb=Db.standaloneImport,ra+=cb+"\n\n"):(fb={},Fa=(fb[qb]=zc,fb));case 2:return Rb===qb&&(Rb="Object"+Rb),Eb="Object"===qb?"class "+Rb+" {}\n":"class "+Rb+" extends "+qb+" {}\n",ra+="export default "+Eb+"\n",qc.yield(Tc.changeSource(ra),5);case 5:return qc.yield(Tc.load(),6);case 6:return qc.return({source:ra,className:Rb,moduleId:Ec.url,bindings:Fa})}})};ke.prototype.addScript=function(zc,Ec,Pb){var Qb=this,Tc,
ld,Rb,qb,bc,Ic,ra,Fa,mb,ub,Db,cb,fb,Eb,qc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gc){switch(gc.nextAddress){case 1:if(zc.constructor===Qb.objectClass){Tc=zc.constructor;gc.jumpTo(2);break}return gc.yield(Qb.ensureObjectClass(zc.constructor),3);case 3:Tc=gc.yieldResult;case 2:ld=Tc;Rb="function"===typeof Ec?String(Ec):Ec;qb=nc.parseFunction(Rb);bc=nc.RuntimeSourceDescriptor.for(ld,Qb.System);Pb||(Pb=nc.Path("id.name").get(qb));if(!Pb)throw Error("No name, cannot add "+nc.string.truncate(Rb,
30).replace(/\n/g,"")+"!");Ic=nc.toJsIdentifier(Pb);console.assert("FunctionExpression"===qb.type||"ArrowFunctionExpression"===qb.type,"not a function expression but: "+qb.type);ra=qb.params.map(function(Oc){return Rb.slice(Oc.start,Oc.end)});Fa="BlockStatement"===qb.body.type?Rb.slice(qb.body.start,qb.body.end):"{ return "+Rb.slice(qb.body.start,qb.body.end)+" }";mb=Ic+"("+ra.join(",")+") "+Fa;"ArrowFunctionExpression"===qb.type&&(qb.type="FunctionExpression");ub=bc.source;Db=bc.ast;if(!Db)throw Error("cannot find class decl of "+
bc.module.id);(cb=Db.body.body.find(function(Oc){return Oc.key.name===Ic&&!Oc.static}))?ub=ub.slice(0,cb.start)+mb+ub.slice(cb.end):(fb=ub.lastIndexOf("}"),Eb=ub.slice(0,fb),qc=ub.slice(fb),/\n\s*$/m.test(Eb)||(Eb+="\n"),mb=nc.string.changeIndent(mb,"  ",1),/^[ ]*\n/m.test(qc)||(qc="\n"+qc),ub=Eb+mb+qc);return gc.yield(bc.changeSource(ub),4);case 4:return gc.return({script:ld.prototype[Ic],klass:ld,module:bc.module.id,methodName:Ic})}})};$jscomp.global.Object.defineProperties(ke.prototype,{objectPackage:{configurable:!0,
enumerable:!0,get:function(){return this._objectPackage}},objectClass:{configurable:!0,enumerable:!0,get:function(){var zc=this.systemModule;return zc.isLoaded()?zc.System.get(zc.id).default:null}},moduleName:{configurable:!0,enumerable:!0,get:function(){return this._moduleName}},systemModule:{configurable:!0,enumerable:!0,get:function(){return nc.module(this.System,this.url)}},System:{configurable:!0,enumerable:!0,get:function(){return this.objectPackage.System}},resource:{configurable:!0,enumerable:!0,
get:function(){return this.objectPackage.resource(this.moduleName)}},url:{configurable:!0,enumerable:!0,get:function(){return this.resource.url}}});nc.ObjectModule=ke;nc.default=td}}});