System.register("./__root_module__-896eff71.js ./index-8182bffa.js kld-intersections ./index-344072cc.js ./index-e10873ad.js ./color-picker-d23d43ea.js".split(" "),function($a){var Vb,jc,Wc,wc,Ud,Kd,he,xd,gd,Ld,Pd,af,bf,Ve,Ad,xe,qc,td,be,Bd,pe,Se,nc,$c,ge,ad,ie,Yb,zb,Rc,Mc,tc,Tc,fb,uc,Rb,Fc,Uc,vd,Xd,vc,Oc,pc,bb,Ma,oa,La,Ua,Sb,Ca,Va,dc,sb,od,bc,Td,rd,dd,Ub,Ne,gc,Tb,Ya,ha,Pa,nb,cc,Lc,pd,ce,Ie,Gd,Af,Ce,zf,C,uf,Cf,fh,mg,we,$f,dg,tg,Ah;return{setters:[function(Ze){Vb=Ze.W;jc=Ze.R;Wc=Ze.a2;wc=Ze.C;
Ud=Ze.p;Kd=Ze.a3;he=Ze.a4;xd=Ze.P;gd=Ze.b;Ld=Ze.c;Pd=Ze._;af=Ze.a5;bf=Ze.e;Ve=Ze.m;Ad=Ze.O;xe=Ze.h;qc=Ze.a6;td=Ze.a7;be=Ze.u;Bd=Ze.a8;pe=Ze.v;Se=Ze.k;nc=Ze.r;$c=Ze.a9;ge=Ze.o;ad=Ze.aa;ie=Ze.ab;Yb=Ze.ac;zb=Ze.M;Rc=Ze.T;Mc=Ze.ad;tc=Ze.ae;Tc=Ze.Y;fb=Ze.I;uc=Ze.n;Rb=Ze.d;Fc=Ze.g;Uc=Ze.af;vd=Ze.i;Xd=Ze.f;vc=Ze.a;Oc=Ze.ag;pc=Ze.X;bb=Ze.S;Ma=Ze.V;oa=Ze.Q;La=Ze.t;Ua=Ze.ah;Sb=Ze.ai;Ca=Ze.aj;Va=Ze.l;dc=Ze.ak;sb=Ze.al;od=Ze.am;bc=Ze.an;Td=Ze.ao;rd=Ze.ap;dd=Ze.aq;Ub=Ze.ar;Ne=Ze.as;gc=Ze.L;Tb=Ze.at;Ya=Ze.j;ha=
Ze.au;Pa=Ze.D;nb=Ze.a0;cc=Ze.av;Lc=Ze.$;pd=Ze.aw},function(Ze){ce=Ze.i},function(){},function(Ze){Ie=Ze.s;Gd=Ze.a;Af=Ze.r;Ce=Ze._;zf=Ze.P;C=Ze.H;uf=Ze.M;Cf=Ze.S;fh=Ze.b;mg=Ze.c;we=Ze.G;$f=Ze.F},function(){},function(Ze){dg=Ze.C;tg=Ze.a;Ah=Ze.c}],execute:function(){function Ze(){}function ld(qa,ba,cb){var za;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){return 1==Wa.nextAddress?ba.startsWith("image/")?Wa.yield(fi.fileReadAsDataURL(qa),3):Wa.jumpTo(2):2!=Wa.nextAddress?(za=Wa.yieldResult,
Wa.return(new fi.Image({imageUrl:za,autoResize:!0,name:qa.name}))):Wa.return(null)})}var fi=lively.FreezerRuntime.recorderFor("lively.morphic/events/html-drop-handler.js");fi.uploadItem=Ze;fi.uploadFile=ld;fi.fileReadAsDataURL=function(qa){return new Promise(function(ba,cb){cb=new fi.FileReader;cb.onload=function(za){return ba(za.target.result)};cb.readAsDataURL(qa)})};fi.Image=Vb;fi.uploadItem=Ze;fi.uploadItem=Ze;fi.uploadFile=ld;fi.uploadFile=ld;var Vd=lively.FreezerRuntime.recorderFor("lively.ide/world-commands.js");
Vd.Rectangle=jc;Vd.rect=Wc;Vd.Color=wc;Vd.pt=Ud;Vd.tree=Kd;Vd.date=he;Vd.Path=xd;Vd.arr=gd;Vd.string=Ld;Vd.obj=Pd;Vd.inspect=af;Vd.easings=bf;Vd.morph=Ve;Vd.Text=Ad;Vd.config=xe;Vd.KeyHandler=qc;Vd.loadObjectFromPartsbinFolder=td;Vd.loadPart=be;Vd.interactivelySaveWorld=Bd;Vd.show=Ie;Vd.showAndSnapToGuides=Gd;Vd.removeSnapToGuidesOf=Af;Vd.LoadingIndicator=pe;Vd.createMorphSnapshot=Se;Vd.interactivelyFreezeWorld=ce;Vd.resource=nc;Vd.BrowserModuleTranslationCache=$c;Vd.CommentBrowser=Ce;Vd.once=ge;
Vd.commands=[{name:"clear storage and reload",exec:function(){var qa,ba;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cb){if(1==cb.nextAddress)return cb.yield($world.confirm(["Caution\n",{},"Proceeding will clear all local storage and reload the page! Make sure if you want to save your world before you continue.",{fontSize:15,fontWeight:"normal"}],{width:400}),2);if(qa=cb.yieldResult)localStorage.clear(),ba=new Vd.BrowserModuleTranslationCache("2"),ba.closeDb(),ba.deleteDb(),window.location.reload(!0);
cb.jumpToEnd()})}},{name:"undo",exec:function(qa){if(qa.focusedMorph&&qa.focusedMorph!==qa&&qa.focusedMorph.undoManager)return!1;qa.env.undoManager.undo();return!0}},{name:"redo",exec:function(qa){if(qa.focusedMorph&&qa.focusedMorph!==qa&&qa.focusedMorph.undoManager)return!1;qa.env.undoManager.redo();return!0}},{name:"run command",handlesCount:!0,exec:function(qa,ba,cb){var za,Wa,gb,ac,fc,xc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ed){if(1==ed.nextAddress)return za=qa.focusedMorph||
qa,Wa=Vd.KeyHandler.generateCommandToKeybindingMap(za,!0).map(function(kd){var Qd=kd.prettyKeys,Ge=kd.command.name,cf=kd.target.constructor.name;Qd=Qd?Qd.join(", "):"";return{isListItem:!0,value:kd,label:[""+cf,{fontSize:"80%",textStyleClasses:["v-center-text"],paddingRight:"10px"},""+Ge,null],annotation:[Qd,{fontSize:"80%",textStyleClasses:["truncated-text"],paddingRight:"5px",maxWidth:140}]}}),ed.yield(qa.filterableListPrompt("Run command",Wa,{historyId:"lively.morphic-run command",requester:za,
extent:Vd.pt(700,600),prompt:qa._cachedRunCommandPrompt}),2);gb=ed.yieldResult;ac=gb.prompt;fc=$jscomp.makeIterator(gb.selected);xc=fc.next().value;qa._cachedRunCommandPrompt=ac;return ed.return(xc?xc.target.execCommand(xc.command,ba,cb):!0)})}},{name:"show command history",exec:function(qa,ba){var cb=qa.commandHandler;ba=Vd.arr.sortBy(cb.history,function(za){return-za.time}).map(function(za){return{isListItem:!0,string:cb.printCommand(za),value:za}});$world.editListPrompt("select commands",ba,{multiSelect:!0,
requester:qa});return!0}},{name:"show halo for focused morph",exec:function(qa){var ba=qa.focusedMorph;qa.showHaloFor(ba.getWindow()||ba,qa.firstHand.pointerId);return!0}},{name:"show morph",exec:function(qa,ba){Vd.show(ba.morph,void 0===ba.loop?!1:ba.loop)}},{name:"show and snap to guides",exec:function(qa,ba){Vd.showAndSnapToGuides(ba.target,ba.showGuides,ba.snap)}},{name:"remove snap to guides",exec:function(qa,ba){Vd.removeSnapToGuidesOf(ba)}},{name:"copy morph",exec:function(qa){var ba=qa.focusedMorph;
if(!ba||ba===qa)return $world.setStatusMessage("no morph selected"),!0;qa=ba.getWindow()||ba;ba=qa.copy();ba.openInWorld(qa.globalPosition.addXY(10,10));ba.isWindow&&ba.activate();return ba}},{name:"select morph",exec:function(qa,ba){ba=void 0===ba?{root:qa,selectionFn:null,justReturn:!1,requester:qa,filterFn:null,prependItems:[],prompt:null,remote:!1}:ba;var cb,za,Wa,gb,ac,fc,xc,ed,kd,Qd,Ge;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cf){if(1==cf.nextAddress)return cb=0,za=ba.filterFn||
function(){return!0},Wa=ba.selectionFn||function(ne,qf,pf){return qa.filterableListPrompt(ne,qf,pf)},cf.yield(System.import("lively.classes/object-classes.js"),2);if(3!=cf.nextAddress)return gb=cf.yieldResult,ac=gb.default,fc=Vd.arr.compact(Vd.tree.map(ba.root||qa,function(ne,qf){if(!za(ne))return null;var pf=!!ac.lookupPackageForObject(ne);return{isListItem:!0,label:[""+String(++cb)+"\u2003".repeat(qf),{fontSize:"80%",textStyleClasses:["v-center-text"],paddingRight:"10px"},""+ne,{fontWeight:pf?"bolder":
"normal",fontStyle:pf?"normal":"italic",fontFamily:"Inconsolata",fontSize:16},pf?" [Object Class]":"",{opacity:.5}],value:ne}},function(ne){return za(ne)?ne.submorphs:[]})),xc=["show halo","open object editor","open object inspector"],cf.yield(Wa(ba.prompt||"Choose morph",(ba.prependItems||[]).concat(fc),{historyId:"lively.morphic-select morph",onSelection:function(ne){(void 0).lastSelectionHalo&&(void 0).lastSelectionHalo.remove();ne&&ne.show&&ed!=ne&&((void 0).lastSelectionHalo=ne.show(),ed=ne)},
selectedAction:"show halo",actions:xc}),3);kd=cf.yieldResult;Qd=kd.selected;Ge=kd.action;if(ba.justReturn)return cf.return(Qd);Qd.forEach(function(ne){Ge===xc[0]?qa.showHaloFor(ne):Ge===xc[1]?qa.execCommand("open object editor",{target:ne}):Ge===xc[2]&&qa.execCommand("open object inspector",{target:ne})});return cf.return(Qd)})}},{name:"print morph(s)",exec:function(qa){var ba,cb,za,Wa,gb,ac,fc,xc,ed,kd,Qd,Ge,cf,ne,qf,pf,ff,vf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xg){switch(xg.nextAddress){case 1:ba=
!1,cb=[];case 2:if(ba)return fc=Vd.LoadingIndicator.open("printing morph..."),xg.yield(System.import("lively.2lively/client.js"),6);za=$jscomp;Wa=za.makeIterator;return xg.yield(qa.execCommand("select morph",{justReturn:!0}),4);case 4:return gb=Wa.call(za,xg.yieldResult),ac=gb.next().value,cb.push(ac),xg.yield(qa.confirm("Select additional morphs?",{rejectLabel:"NO"}),5);case 5:ba=!xg.yieldResult;xg.jumpTo(2);break;case 6:return xc=xg.yieldResult,ed=xc.default,kd=ed.default(),xg.yield(kd.listPeers(!0),
7);case 7:return Qd=xg.yieldResult,Ge=Qd.find(function(dh){return"pdf printer"===dh.type}),cf={ackTimeout:3E4},ne=kd,qf=ne.sendToAndWait,pf=Ge.id,xg.yield(Promise.all(cb.map(function(dh){return Vd.createMorphSnapshot(dh,{addPreview:!1,testLoad:!1})})),9);case 9:return xg.yield(qf.call(ne,pf,"[PDF printer] print",xg.yieldResult,cf),8);case 8:ff=xg.yieldResult;if(vf=ff.error||ff.data.error)throw qa.showError(vf),vf;qa.serveFileAsDownload(ff.data,{fileName:cb[0].name+(1<cb.length?".etc":"")+".pdf",type:"application/pdf"});
fc.remove();xg.jumpToEnd()}})}},{name:"escape",exec:function(qa,ba,cb,za){ba=qa.env.eventDispatcher.eventState;ba.menu&&ba.menu.remove();ba=qa.halos();ba.forEach(function(Wa){return Wa.remove()});qa.hands.forEach(function(Wa){return Wa.cancelGrab(!0,za)});qa=Vd.arr.last(ba)&&Vd.arr.last(ba).target||qa.focusedMorph||qa;qa.focus();qa.isText&&qa.selection.disableMultiSelect&&qa.selection.disableMultiSelect();return!1}},{name:"move or resize halo target",exec:function(qa,ba){ba=void 0===ba?{direction:"left",
offset:1,what:"move"}:ba;var cb=qa.halos()[0];if(!cb||cb.changingName||qa.focusedMorph!=cb)return!1;var za=ba;qa=za.direction;ba=za.offset;za=za.what;var Wa=cb.target;ba=ba||1;switch(qa){case "left":Wa["move"===za?"left":"width"]-=ba;break;case "right":Wa["move"===za?"left":"width"]+=ba;break;case "up":Wa["move"===za?"top":"height"]-=ba;break;case "down":Wa["move"===za?"top":"height"]+=ba}cb.alignWithTarget();return!0}},{name:"close halo target",exec:function(qa){qa=qa.halos()[0];if(!qa||qa.changingName)return!1;
qa.target.selectedMorphs?qa.target.selectedMorphs.forEach(function(ba){return ba.abandon()}):qa.target.abandon();return!0}},{name:"resize manually",exec:function(qa,ba){ba=void 0===ba?{}:ba;var cb,za,Wa,gb,ac,fc,xc,ed;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kd){switch(kd.nextAddress){case 1:Wa=qa.windowBounds();gb=qa.bounds();ac=Number;if(fc=ba.width){kd.jumpTo(2);break}return kd.yield(qa.prompt("Enter world width",{input:Math.max(gb.width,Wa.width),requester:qa}),3);case 3:fc=
kd.yieldResult;case 2:cb=ac(fc);if("number"!==typeof cb){kd.jumpTo(4);break}xc=Number;if(ed=ba.height){kd.jumpTo(5);break}return kd.yield(qa.prompt("Enter world height",{input:Math.max(gb.height,Wa.height),requester:qa}),6);case 6:ed=kd.yieldResult;case 5:za=xc(ed);case 4:return"number"!==typeof cb||isNaN(cb)||"number"!==typeof za||isNaN(za)||(qa.extent=Vd.pt(cb,za)),kd.return(!0)}})}},{name:"resize windows to fit visible world bounds",exec:function(qa){var ba=qa.getWindows().filter(function(gb){return!gb.minimized});
if(!ba.length)return!0;qa=qa.visibleBoundsExcludingTopBar();var cb=ba.reduce(function(gb,ac){return ac.bounds().union(gb)},new Vd.Rectangle(0,0,0,0)),za=qa.width/cb.width,Wa=qa.height/cb.height;ba.forEach(function(gb){var ac=gb.bounds();gb.setBounds(new Vd.Rectangle(ac.x*za,ac.y*Wa,ac.width*za,ac.height*Wa))});return!0}},{name:"window switcher",exec:function(qa){var ba,cb,za,Wa,gb,ac,fc,xc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ed){if(1==ed.nextAddress){if((ba=qa.activePrompt())&&
"lively.morphic-window switcher"===ba.historyId)return ba.focus(),ed.return(ba.get("list").execCommand("select down"));cb=qa.submorphs.filter(function(kd){return kd.isWindow}).reverse().map(function(kd){return{isListItem:!0,string:kd.title||String(kd),value:kd}});cb.forEach(function(kd){kd.value.opacity=.5;kd.value.blur=1});return ed.yield(qa.filterableListPrompt("Choose window",cb,{preselect:1,requester:qa,historyId:"lively.morphic-window switcher",onSelection:function(kd){za&&(za.minimized=Wa,za.blur=
1,za.animate({opacity:.3,duration:200}));if(za=kd)kd.animate({opacity:1,duration:200}),kd.blur=0,Wa=kd.minimized,kd.minimized=!1},width:1*qa.visibleBounds().extent().x/3,itemPadding:Vd.Rectangle.inset(4)}),2)}ac=gb=ed.yieldResult;fc=$jscomp.makeIterator(ac.selected);xc=fc.next().value;cb.forEach(function(kd){kd.value.opacity=1;kd.value.blur=0});xc&&(xc.activate(),xc.minimized=!1);return ed.return(!0)})}},{name:"close active window or morph",exec:function(qa){var ba=qa.focusedMorph;if(!ba)return!0;
var cb=ba.getWindow();qa.undoStart("window close");cb?cb.close():(Vd.arr.last(Vd.arr.without(ba.ownerChain(),qa)).remove(),(cb=qa.activeWindow())&&cb.activate());qa.undoStop("window close");return!0}},{name:"toggle minimize active window",exec:function(qa){(qa=qa.activeWindow())&&qa.toggleMinimize();return!0}},{name:"toggle minimize all windows",exec:function(qa){(qa=qa.getWindows())&&qa.map(function(ba){return ba.toggleMinimize()});return!0}},{name:"toggle minimize all except active window",exec:function(qa){(qa=
qa.getWindows().filter(function(ba){return!ba.isActive()}))&&qa.map(function(ba){return ba.toggleMinimize()});return!0}},{name:"close all except active window",exec:function(qa){(qa=qa.getWindows().filter(function(ba){return!ba.isActive()}))&&qa.map(function(ba){return ba.close()});return!0}},{name:"close all windows",exec:function(qa){(qa=qa.getWindows())&&qa.map(function(ba){return ba.close()});return!0}},{name:"open status message of focused morph",exec:function(qa){var ba=qa.focusedMorph;if(qa=
$jscomp.makeIterator(ba?qa.visibleStatusMessagesFor(ba):[]).next().value)qa.expand(),qa.focus();return qa||!0}},{name:"resize active window",exec:function(qa,ba){function cb(){var Ge,cf,ne;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qf){if(1==qf.nextAddress)return qf.yield(qa.filterableListPrompt("How to resize the window?","full center right left bottom top reset".split(" "),{requester:qa}),2);Ge=qf.yieldResult;cf=$jscomp.makeIterator(Ge.selected);ne=cf.next().value;return qf.return(ne)})}
function za(Ge,cf){switch(Ge){case "full":return xc;case "col1":case "left":return Qd.withTopLeft(xc.topLeft());case "col2":case "center":return Qd.withCenter(xc.center());case "col3":case "right":return Qd.translatedBy(Vd.pt(xc.width-kd,0));case "top":return xc.divide([Vd.rect(0,0,1,.5)])[0];case "bottom":return xc.divide([Vd.rect(0,.5,1,.5)])[0];case "reset":return fc._normalBounds||Vd.pt(500,400).extentAsRectangle().withCenter(cf.center());default:return cf}}ba=void 0===ba?{how:null,window:null}:
ba;var Wa,gb,ac,fc,xc,ed,kd,Qd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ge){if(1==Ge.nextAddress){Wa=ba;gb=Wa.window;ac=Wa.how;fc=gb||qa.activeWindow();if(!fc)return Ge.return();xc=qa.visibleBoundsExcludingTopBar().insetBy(15);ed=fc.bounds();fc._normalBounds||(fc._normalBounds=ed);kd=Math.min(700,Math.max(1E3,xc.width/3));Qd=xc.withWidth(kd);return ac?Ge.jumpTo(2):Ge.yield(cb(),3)}2!=Ge.nextAddress&&(ac=Ge.yieldResult);if(!ac)return Ge.return();fc.setBounds(za(ac,xc));"reset"===
ac&&delete fc._normalBounds;return Ge.return(!0)})}},{name:"[recovery] show last object editor saves",exec:function(qa,ba){return qa.execCommand("[recovery] show last doits",Object.assign({},ba,{title:"logged ObjectEditor save",logAccessFn:function(){return JSON.parse(localStorage["oe helper"]).saves}}))}},{name:"[recovery] show last doits",description:"browse a list of your last doits",exec:function(qa,ba){ba=void 0===ba?{}:ba;var cb,za,Wa,gb,ac,fc,xc,ed,kd,Qd,Ge,cf,ne,qf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pf){if(1==
pf.nextAddress){cb=ba;(za=cb.logAccessFn)||(za=function(){return JSON.parse(localStorage["lively.next-js-ide-doitlog"])});try{Wa=za()}catch(ff){}if(!Wa)return pf.return(qa.inform("no log yet"));gb=Vd.arr.sortBy(Wa.map(function(ff,vf){var xg="string"===typeof ff?ff:ff.source;ff="string"===typeof ff?vf:ff.time||vf;vf=Vd.date.format(new Date(ff),"yy-mm-dd HH:MM");return{time:ff,source:xg,printedTime:vf}}),function(ff){return-ff.time});ac=gb.map(function(ff,vf){return{isListItem:!0,string:"["+ff.printedTime+
"] "+ff.source.slice(0,100).replace(/\n/g,"").trim(),value:ff}});return pf.yield(qa.filterableListPrompt("select doit code",ac,{multiSelect:!0,requester:qa}),2)}fc=pf.yieldResult;xc=fc.selected;if(xc.length){ed=[];kd=$jscomp.makeIterator(xc);for(Qd=kd.next();!Qd.done;Qd=kd.next())cf=Ge=Qd.value,ne=cf.source,qf=cf.printedTime,ed.push("// "+qf+"\n"+ne);return pf.return(qa.execCommand("open workspace",Object.assign({title:"logged doits",mode:"js"},ba,{content:ed.join("\n\n")})))}return pf.return(!0)})}},
{name:"open loading indicator",exec:function(qa,ba){qa={};"object"===typeof ba&&(qa=ba,ba=qa.label);return Vd.LoadingIndicator.open(ba,qa)}},{name:"open workspace",exec:function(qa,ba,cb,za){ba=void 0===ba?{}:ba;var Wa,gb,ac,fc,xc,ed,kd,Qd,Ge,cf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ne){switch(ne.nextAddress){case 1:if(Wa=za&&qa.relayCommandExecutionToFocusedMorph(za))return ne.return(Wa);gb=ba.language||ba.mode||"javascript";ac={javascript:"lively.ide/js/workspace.js",shell:"lively.ide/shell/workspace.js",
html:"lively.ide/html/workspace.js",py:"lively.ide/py/workspace.js",md:"lively.ide/md/workspace.js",sql:"lively.ide/sql/workspace.js",css:"lively.ide/css/workspace.js",less:"lively.ide/css/less/workspace.js",text:null};fc=Object.keys(Vd.config.ide.modes.aliases).reduce(function(qf,pf){var ff={};return Object.assign(qf,(ff[Vd.config.ide.modes.aliases[pf]]=pf,ff))},{});if(!ba.askForMode){ne.jumpTo(2);break}xc=Object.keys(ac).concat("javascript console");return ne.yield(qa.filterableListPrompt("Open workspace for...",
xc),3);case 3:if(ed=ne.yieldResult,kd=$jscomp.makeIterator(ed.selected),gb=kd.next().value,!gb)return ne.return(!0);case 2:if("javascript console"===gb)return ne.return(qa.execCommand("open console",ba));ba=Object.assign({content:""},ba,{mode:gb,language:gb});Qd=ac[ba.language]||ac[fc[ba.language]];return"text"!==gb&&Qd?ne.yield(System.import(Qd),4):ne.return(qa.execCommand("open text window",Object.assign({},Vd.config.codeEditor.modes.text,{},ba)));case 4:return Ge=ne.yieldResult,cf=Ge.default,ne.return((new cf({title:ba.title||
ba.language+" workspace",center:qa.center,content:ba.content,target:ba.target,systemInterface:ba.systemInterface||ba.backend})).activate())}})}},{name:"open console",exec:function(qa,ba){var cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(za){if(1==za.nextAddress)return za.yield(Vd.loadObjectFromPartsbinFolder("Console"),2);cb=za.yieldResult;return za.return(cb.openInWorldNearHand())})}},{name:"open shell workspace",exec:function(qa,ba){return qa.execCommand("open workspace",Object.assign({},
ba,{language:"shell"}))}},{name:"open javascript workspace",exec:function(qa,ba){return qa.execCommand("open workspace",Object.assign({},ba,{language:"javascript"}))}},{name:"open shell terminal",exec:function(qa,ba){var cb,za;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){if(1==Wa.nextAddress)return Wa.yield(System.import("lively.ide/shell/terminal.js"),2);cb=Wa.yieldResult;za=cb.default;return Wa.return(za.open(ba).openInWorldNearHand())})}},{name:"open text window",exec:function(qa,
ba){var cb=ba=void 0===ba?{}:ba,za=cb.title,Wa=cb.extent,gb=cb.content,ac=cb.mode,fc=cb.name;cb=cb.rangesAndStyles;za=za||"text window";gb=gb||"";Wa=Wa||Vd.pt(500,400);fc=fc||"text workspace";gb="string"===typeof gb?[gb,null]:gb;ba=new Vd.Text(Object.assign({padding:Vd.Rectangle.inset(3)},Vd.obj.dissoc(ba,["title","content"]),{textAndAttributes:gb,clipMode:"auto",name:fc,extent:Wa}));cb&&ba.setTextAttributesWithSortedRanges(cb);ac&&ba.changeEditorMode(ac);return qa.openInWindow(ba,{title:za}).activate()}},
{name:"merge and open in window",exec:function(qa,ba){ba=void 0===ba?{a:"",b:"",format:null,extent:Vd.pt(500,600)}:ba;var cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(za){if(1==za.nextAddress)return za.yield(Vd.loadObjectFromPartsbinFolder("text merger"),2);cb=za.yieldResult;return za.return(cb.targetMorph.open(ba.a,ba.b,ba))})}},{name:"diff and open in window",exec:function(qa,ba){var cb,za,Wa;function gb(cf,ne,qf){var pf,ff,vf,xg,dh,nh,Vg,qg,Hi,xj,Th,sg,eh,vh;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wi){if(1==
wi.nextAddress){pf=qf;ff=pf.format;vf=null;if("patch"!==ff)return Ge=Qd[ff](cf,ne,qf),xg=Vd.arr.flatmap(Ge,function(Ff){var yj=Ff.added;return[Ff.value,Ff.removed?{fontWeight:"normal",textDecoration:"line-through",fontColor:Vd.Color.red}:yj?{fontWeight:"bold",textDecoration:"",fontColor:Vd.Color.green}:{fontWeight:"normal",textDecoration:"",fontColor:Vd.Color.darkGray}]}),wi.jumpTo(2);dh=qf;nh=dh.headerA;Vg=dh.headerB;qg=dh.filenameA;Hi=dh.filenameB;xj=dh.context;xg=[Qd.createTwoFilesPatch(qg||"a",
Hi||"b",cf,ne,nh,Vg,"number"===typeof xj?{context:xj}:void 0),{}];return wi.yield(System.import("lively.ide/diff/editor-plugin.js"),3)}2!=wi.nextAddress&&(Th=wi.yieldResult,sg=Th.default,vf=new sg);eh=qa.execCommand("open text window",qf);vh=eh.targetMorph;eh.extent=kd||Vd.pt(300,200).maxPt(vh.textBounds().extent());vh.textAndAttributes=xg;vf&&vh.addPlugin(vf);return wi.return(vh)})}ba=void 0===ba?{a:"",b:"",format:null,extent:Vd.pt(500,600)}:ba;var ac,fc,xc,ed,kd,Qd,Ge;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cf){if(1==
cf.nextAddress){ac=ba;fc=ac.a;xc=ac.b;ed=ac.format;kd=ac.extent;if(ed)fc=String(fc),xc=String(xc);else{a:{var ne=fc,qf=xc;if(Vd.obj.isPrimitive(ne)||ne instanceof RegExp||Vd.obj.isPrimitive(qf)||qf instanceof RegExp)ne=String(ne),qf=String(qf);if("string"!==typeof ne||"string"!==typeof qf)try{JSON.stringify(ne);JSON.stringify(qf);cb="diffJson";za=ne;Wa=qf;break a}catch(pf){ne=String(ne),qf=String(qf)}cb="diffLines";za=ne;Wa=qf}fc=za;xc=Wa;ed=cb}return cf.yield(System.import("https://jspm.dev/diff"),
2)}if(3!=cf.nextAddress)return Qd=cf.yieldResult,cf.yield(gb(fc,xc,Object.assign({fontFamily:"monospace"},ba,{format:ed})),3);Ge=cf.yieldResult;return cf.return(Ge)})}},{name:"merge workspaces",exec:function(qa,ba){return qa.execCommand("diff workspace",Object.assign({},ba,{merge:!0}))}},{name:"diff workspaces",exec:function(qa,ba){function cb(kd,Qd){var Ge=kd.pluginFind(function(ne){return ne.evalEnvironment});Ge=Ge&&Ge.evalEnvironment.targetModule||"no file";var cf=Qd.pluginFind(function(ne){return ne.evalEnvironment});
return qa.execCommand("diff and open in window",{a:kd.textString,b:Qd.textString,filenameA:Ge,filenameB:cf&&cf.evalEnvironment.targetModule||"no file"})}function za(kd,Qd){var Ge;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cf){if(1==cf.nextAddress)return cf.yield(Vd.loadObjectFromPartsbinFolder("text merger"),2);Ge=cf.yieldResult;return cf.return(Ge.targetMorph.open(kd.textString,Qd.textString))})}function Wa(kd,Qd){var Ge,cf,ne,qf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pf){if(1==
pf.nextAddress)return Ge=kd.map(function(ff){return{isListItem:!0,value:ff,string:ff.name||String(ff)}}),pf.yield(qa.filterableListPrompt("choose text: ",Ge,{onSelection:function(ff){ff&&ff.show()}}),2);cf=pf.yieldResult;ne=$jscomp.makeIterator(cf.selected);qf=ne.next().value;return pf.return(qf)})}ba=void 0===ba?{}:ba;var gb,ac,fc,xc,ed;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kd){switch(kd.nextAddress){case 1:gb=ba;ac=gb.editor1;fc=gb.editor2;xc=gb.merge;ac&&fc||(ed=qa.withAllSubmorphsSelect(function(Qd){return Qd.isText&&
!Qd.isInputLine&&!Qd.isUsedAsEpiMorph()}).reverse());if(ac){kd.jumpTo(2);break}return kd.yield(Wa(ed),3);case 3:ac=kd.yieldResult;case 2:if(!ac)return kd.return(qa.setStatusMessage("Canceled"));if(fc){kd.jumpTo(4);break}return kd.yield(Wa(Vd.arr.without(ed,ac)),5);case 5:fc=kd.yieldResult;case 4:return fc?kd.return(xc?za(ac,fc):cb(ac,fc)):kd.return(qa.setStatusMessage("Canceled"))}})}},{name:"search workspaces",exec:function(){function qa(kd,Qd){return kd.map(function(Ge){var cf=Ge.world()?Ge.getWindow():
$world.withAllSubmorphsDetect(function(ff){return ff.isWindow&&ff.targetMorph===Ve}),ne=0,qf=Vd.string.lines(Ge.textString).find(function(ff,vf){ff=ff.toLowerCase();ne=vf;return Qd.every(function(xg){return ff.includes(xg)})}),pf=cf?cf.title:Ge.toString();return qf?{isListItem:!0,string:pf+" | "+qf,value:{window:cf,morph:Ge,row:ne}}:null}).filter(Boolean)}function ba(kd){return $world.withAllSubmorphsDo(function(Qd){Qd.isWindow&&Qd.minimized&&Qd.targetMorph&&Qd.targetMorph.isText&&(Qd=Qd.targetMorph);
if(!Qd.textString||!Qd.isText||Qd.isUsedAsEpiMorph())return null;var Ge=Qd.textString.toLowerCase();return kd.every(function(cf){return Ge.includes(cf)})?Qd:null}).filter(Boolean)}var cb=this,za,Wa,gb,ac,fc,xc,ed;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kd){if(1==kd.nextAddress)return kd.yield($world.filterableListPrompt("search workspaces",[],{historyId:"lively.morphic-ide-search-workspaces-hist",customize:function(Qd){Qd.getSubmorphNamed("list").updateFilter=function(){var Ge=
this.parseInput();if(!(3>Ge.input.length)){var cf=ba(Ge.lowercasedTokens);this.listMorph.items=qa(cf,Ge.lowercasedTokens)}}}}),2);za=kd.yieldResult;Wa=$jscomp.makeIterator(za.selected);return(gb=Wa.next().value)?(ac=gb,fc=ac.morph,xc=ac.window,ed=ac.row,xc&&(xc.minimized&&xc.toggleMinimize(),xc.activate()),(xc||fc).show(),cb.cursorPosition={row:ed,column:0},kd.return(fc)):kd.return(null)})}},{name:"open PartsBin",exec:function(qa){var ba,cb,za,Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gb){if(1==
gb.nextAddress)return ba=Vd.LoadingIndicator.open("Loading Partsbin..."),gb.yield(System.import("lively.morphic/partsbin.js"),2);if(3!=gb.nextAddress)return cb=gb.yieldResult,za=cb.loadPart,gb.yield(za("PartsBin"),3);Wa=gb.yieldResult;Wa.openInWorldNearHand();Wa.targetMorph.selectedCategory="*basics*";Wa.focus();ba.remove();Wa.getWindow().activate();return gb.return(Wa)})}},{name:"browse and load component",exec:function(qa){var ba,cb,za,Wa,gb,ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fc){switch(fc.nextAddress){case 1:ba=
Vd.LoadingIndicator.open("loading component browser");if(qa._componentsBrowser){fc.jumpTo(2);break}return fc.yield(ba.whenRendered(),2);case 2:if(cb=qa._componentsBrowser){fc.jumpTo(4);break}Wa=za=qa;return fc.yield(Vd.resource("part://SystemDialogs/master component browser").read(),5);case 5:cb=Wa._componentsBrowser=fc.yieldResult;case 4:return gb=cb,ba.remove(),fc.yield(gb.activate(),6);case 6:(ac=fc.yieldResult)&&!ac.world()&&ac.openInWorld(),fc.jumpToEnd()}})}},{name:"load object from PartsBin",
exec:function(qa,ba){ba=void 0===ba?{}:ba;var cb,za,Wa,gb,ac,fc,xc,ed;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kd){switch(kd.nextAddress){case 1:return za=ba,Wa=za.name,gb=void 0===za.open?!0:za.open,Wa?kd.yield(System.import("lively.morphic/partsbin.js"),6):kd.yield(System.import("lively.morphic/partsbin.js"),4);case 4:return ac=kd.yieldResult,fc=ac.interactivelyLoadObjectFromPartsBinFolder,kd.yield(fc(),5);case 5:cb=kd.yieldResult;kd.jumpTo(3);break;case 6:return xc=kd.yieldResult,
ed=xc.loadObjectFromPartsbinFolder,kd.yield(ed(Wa),7);case 7:cb=kd.yieldResult;case 3:return cb&&gb&&cb.openInWorldNearHand(),kd.return(cb)}})}},{name:"open object drawer",exec:function(qa){var ba,cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(za){if(1==za.nextAddress)return za.yield(System.import("lively.components/object-drawer.js"),2);ba=za.yieldResult;cb=ba.default;return za.return((new cb).openInWorldNearHand())})}},{name:"open object editor",exec:function(qa,ba){ba=void 0===
ba?{target:null,selectedClass:null,selectedMethod:null,evalEnvironment:null}:ba;var cb,za,Wa,gb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ac){if(1==ac.nextAddress){if(!ba.target)return qa.setStatusMessage("No target for ObjectEditor"),ac.return(null);cb=ba.loadingIndicator=Vd.LoadingIndicator.open("Open Object Editor...");return ac.yield(System.import("lively.ide/js/objecteditor/index.js"),2)}if(3!=ac.nextAddress)return za=ac.yieldResult,Wa=za.ObjectEditor,ac.yield(Wa.open(ba),3);
gb=ac.yieldResult;cb.remove();return ac.return(gb)})}},{name:"open object inspector",exec:function(qa,ba){ba=void 0===ba?{target:null}:ba;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cb){return ba.target?cb.return(Vd.inspect(ba.target)):(qa.setStatusMessage("no target for Inspector"),cb.return(null))})}},{name:"inspect server",exec:function(qa){var ba,cb,za,Wa,gb,ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fc){switch(fc.nextAddress){case 1:return fc.yield(System.import("lively.ide/js/inspector.js"),
2);case 2:return ba=fc.yieldResult,cb=ba.default,fc.yield(System.import("lively-system-interface"),3);case 3:return za=fc.yieldResult,Wa=za.serverInterfaceFor,gb=Wa(System.baseURL+"eval"),ac={format:"esm",context:"global",targetModule:"lively://lively.next-workspace/world",sourceURL:"inspect-server_"+Date.now(),systemInterface:gb},fc.yield(gb.runEval('\n           import LivelyServer from "lively.server/server.js";\n           let server = LivelyServer.servers.values().next().value;\n        ',ac),
4);case 4:cb.openInWindow({remoteTarget:{code:"server",evalEnvironment:ac}}),fc.jumpToEnd()}})}},{name:"open scene graph inspector",exec:function(qa,ba){ba=void 0===ba?{target:null}:ba;var cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(za){if(1==za.nextAddress)return za.yield(Vd.loadObjectFromPartsbinFolder("scene graph inspector"),2);cb=za.yieldResult;cb.targetMorph=ba.target||qa;return za.return(cb.openInWindow({title:"morph graph"}))})}},{name:"open browser",progressIndicator:"opening browser...",
exec:function(qa,ba,cb,za){ba=void 0===ba?{packageName:"lively.morphic",moduleName:"morph.js"}:ba;var Wa,gb,ac,fc,xc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ed){switch(ed.nextAddress){case 1:return(Wa=za&&qa.relayCommandExecutionToFocusedMorph(za))?ed.return(Wa):ed.yield(System.import("lively.ide/js/browser/index.js"),2);case 2:return gb=ed.yieldResult,ac=gb.default,ba?(xc=Vd.obj.select(ba,["packageName","moduleName","textPosition","codeEntity","systemInterface"]),ed.yield(ac.browse(xc,
{extent:Vd.pt(700,600)}),6)):ed.yield(ac.open(),5);case 5:fc=ed.yieldResult;ed.jumpTo(4);break;case 6:fc=ed.yieldResult;case 4:return fc.getWindow().activate(),ed.return(fc)}})}},{name:"choose and browse package resources",progressIndicator:"browsing resources...",exec:function(qa,ba,cb,za){ba=void 0===ba?{browser:null,systemInterface:null}:ba;var Wa,gb,ac,fc,xc,ed,kd,Qd,Ge,cf,ne,qf,pf,ff,vf,xg,dh,nh,Vg,qg,Hi,xj,Th,sg;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eh){switch(eh.nextAddress){case 1:if(Wa=
za&&qa.relayCommandExecutionToFocusedMorph(za))return eh.return(Wa);gb=(gb=ba.browser||qa.focusedMorph&&qa.focusedMorph.ownerChain().find(function(vh){return vh.isBrowser}))&&gb.isBrowser?gb.getWindow():null;return eh.yield(System.import("lively-system-interface"),2);case 2:return ac=eh.yieldResult,fc=ac.localInterface,xc=ba&&ba.systemInterface?ba.systemInterface:gb?gb.systemInterface:fc,eh.yield(xc.getPackages({excluded:Vd.config.ide.js.ignoredPackages}),3);case 3:ed=eh.yieldResult,kd=[],Qd={},Ge=
$jscomp.makeIterator(ed),cf=Ge.next();case 4:if(cf.done)return eh.yield(qa.filterableListPrompt("Choose module to open",kd,{historyId:"lively.morphic-choose and browse package resources",requester:gb,width:700,multiSelect:!0,fuzzy:"value.shortName"}),8);Qd.$jscomp$loop$prop$p$2966=cf.value;Qd.$jscomp$loop$prop$excluded$2965=(Vd.Path("lively.ide.exclude").get(Qd.$jscomp$loop$prop$p$2966)||[]).map(function(vh){return vh.includes("*")?new RegExp(vh.replace(/\*/g,".*")):vh});Qd.$jscomp$loop$prop$excluded$2965.push(".git",
"node_modules",".module_cache");ne=kd.push;qf=ne.apply;pf=kd;ff=$jscomp;vf=ff.arrayFromIterable;xg=function(vh){return function(wi){return{isListItem:!0,string:"["+vh.$jscomp$loop$prop$p$2966.name+"] "+wi.nameInPackage+(wi.isLoaded?"":" [not loaded]"),value:wi}}}(Qd);dh=function(vh){return function(wi){var Ff=wi.url;return!Ff.endsWith("/")&&!vh.$jscomp$loop$prop$excluded$2965.some(function(yj){return yj instanceof RegExp?yj.test(Ff):Ff.includes(yj)})}}(Qd);return eh.yield(xc.resourcesOfPackage(Qd.$jscomp$loop$prop$p$2966,
Qd.$jscomp$loop$prop$excluded$2965),7);case 7:qf.call(ne,pf,vf.call(ff,eh.yieldResult.filter(dh).sort(function(vh,wi){return vh.isLoaded&&!wi.isLoaded?-1:!vh.isLoaded&&wi.isLoaded?1:vh.nameInPackage.toLowerCase()<wi.nameInPackage.toLowerCase()?-1:vh.nameInPackage.toLowerCase()==wi.nameInPackage.toLowerCase()?0:1}).map(xg)));Qd={$jscomp$loop$prop$excluded$2965:Qd.$jscomp$loop$prop$excluded$2965,$jscomp$loop$prop$p$2966:Qd.$jscomp$loop$prop$p$2966};cf=Ge.next();eh.jumpTo(4);break;case 8:return nh=eh.yieldResult,
Vg=nh.selected,qg=$jscomp.makeIterator(Vd.arr.partition(Vg,function(vh){return vh.url.match(/\.js(on)?/)})),Hi=qg.next().value,xj=qg.next().value,eh.yield(System.import("lively.ide/js/browser/index.js"),9);case 9:return Th=eh.yieldResult,sg=Th.default,eh.yield(Promise.all(Hi.map(function(vh){return sg.browse({packageName:vh.package,moduleName:vh.url},gb,xc).then(function(wi){return wi.activate()})})),10);case 10:if(!xj.length){eh.jumpTo(11);break}return eh.yield(Promise.all(xj.map(function(vh){return qa.execCommand("open file",
{url:vh.url})})),11);case 11:return eh.return(!0)}})}},{name:"choose and browse module",progressIndicator:"browsing module...",handlesCount:!0,exec:function(qa,ba,cb){ba=void 0===ba?{browser:void 0,systemInterface:void 0}:ba;var za,Wa,gb,ac,fc,xc,ed,kd,Qd,Ge,cf,ne,qf,pf,ff,vf,xg,dh,nh;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vg){switch(Vg.nextAddress){case 1:if(!ba.browser&&(Wa=(za=qa.focusedMorph)&&za.getWindow())&&Wa.targetMorph&&Wa.targetMorph.isFileBrowser)return Vg.return(Wa.targetMorph.execCommand("find file and select",
ba,cb));gb=ba.browser||za&&za.ownerChain().find(function(qg){return qg.isBrowser});return Vg.yield(System.import("lively.ide/js/browser/index.js"),2);case 2:return ac=Vg.yieldResult,fc=ac.default,Vg.yield(System.import("lively-system-interface"),3);case 3:return xc=Vg.yieldResult,ed=xc.localInterface,kd=ba&&ba.systemInterface?ba.systemInterface:gb?gb.systemInterface:ed,Qd="local"==kd.name?"":" on ["+Vd.string.truncate(kd.name,35,"...")+"]",Vg.yield(kd.getPackages(),4);case 4:Ge=Vg.yieldResult;cf=
[];ne=$jscomp.makeIterator(Ge);for(qf=ne.next();!qf.done;qf=ne.next())for(pf=qf.value,ff=Vd.Path("lively.ide.exclude").get(pf)||[],ff=ff.map(function(qg){return qg.includes("*")?new RegExp(qg.replace(/\*/g,".*")):qg}),vf={},xg=$jscomp.makeIterator(pf.modules),dh=xg.next();!dh.done;vf={$jscomp$loop$prop$m$2968:vf.$jscomp$loop$prop$m$2968},dh=xg.next())vf.$jscomp$loop$prop$m$2968=dh.value,ff.some(function(qg){return function(Hi){return Hi instanceof RegExp?Hi.test(qg.$jscomp$loop$prop$m$2968.name):
qg.$jscomp$loop$prop$m$2968.name.includes(Hi)}}(vf))||(nh=kd.shortModuleName(vf.$jscomp$loop$prop$m$2968.name,pf),cf.push({isListItem:!0,string:"["+pf.name+"] "+nh,value:{package:pf,module:vf.$jscomp$loop$prop$m$2968,shortName:nh}}));cf=Vd.arr.sortBy(cf,function(qg){return qg.string});(function(){var qg,Hi,xj,Th,sg,eh,vh,wi,Ff;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yj){switch(yj.nextAddress){case 1:return qg=gb||za,yj.yield(qa.filterableListPrompt("Choose module to open"+Qd,cf,
{historyId:"lively.morphic-choose and browse module",requester:qg,height:Math.min(qg.height,700),width:500,multiSelect:!0,listFontColor:"white",fuzzy:"value.shortName"}),2);case 2:Hi=yj.yieldResult,xj=Hi.selected,Th=0;case 3:if(!(Th<xj.length)){yj.jumpTo(0);break}sg=xj[Th];eh=sg.package;vh=sg.shortName;wi={packageName:eh.name,moduleName:vh};return yj.yield(fc.browse(wi,0===Th?gb:void 0,kd),6);case 6:Ff=yj.yieldResult,Ff.moveBy(Vd.pt(20*Th,20*Th)),Ff.getWindow().activate(),Th++,yj.jumpTo(3)}})})();
return Vg.return(!0)}})}},{name:"open code search",progressIndicator:"opening code search...",exec:function(qa,ba){ba=void 0===ba?{browser:null,systemInterface:null,input:null}:ba;var cb,za,Wa,gb,ac,fc,xc,ed;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kd){if(1==kd.nextAddress){cb=qa.focusedMorph?qa.focusedMorph.ownerChain():[];za=ba.browser||cb.find(function(Qd){return Qd.isBrowser});Wa=Vd.LoadingIndicator.open("loading code search");if(za&&za.isBrowser){if(za.state.associatedSearchPanel)return kd.return(za.state.associatedSearchPanel.getWindow().activate())}else za=
null;return kd.yield(System.import("lively-system-interface"),2)}if(3!=kd.nextAddress)return gb=kd.yieldResult,ac=gb.localInterface,fc=ba.systemInterface||za&&za.systemInterface,fc||(fc=(xc=cb.find(function(Qd){return Qd.isText&&Qd.editorPlugin&&Qd.editorPlugin.isJSEditorPlugin}))?xc.editorPlugin.systemInterface():ac),kd.yield(Vd.resource("part://SystemIDE/code search").read(),3);ed=kd.yieldResult;Object.assign(ed,{browser:za,input:ba.input,systemInterface:fc});ed.openInWindow();ed.focus();Wa.remove();
za&&(za.state.associatedSearchPanel=ed);return kd.return(ed)})}},{name:"open grep search",progressIndicator:"opening code search...",exec:function(qa,ba){var cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(za){if(1==za.nextAddress)return za.yield(Vd.loadObjectFromPartsbinFolder("grep search"),2);cb=za.yieldResult;return za.return(cb.openInWorldNearHand(qa).activate())})}},{name:"open test runner",progressIndicator:"opening test runner...",exec:function(qa){var ba,cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(za){return 1==
za.nextAddress?za.yield(System.import("lively.ide/test-runner.js"),2):3!=za.nextAddress?(ba=za.yieldResult,cb=ba.default,za.yield(cb.open(),3)):za.return(za.yieldResult)})}},{name:"open file browser",progressIndicator:"opening file browser...",exec:function(qa,ba){ba=void 0===ba?{}:ba;var cb,za,Wa,gb,ac,fc,xc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ed){if(1==ed.nextAddress)return ed.yield(System.import("lively.ide/http-file-browser.js"),2);cb=ed.yieldResult;za=cb.default;Wa=ba;
gb=Wa.location;ac=Wa.url;xc=(fc=Wa.file)?za.forFile(fc,gb):za.forLocation(ac||gb||document.location.origin);return ed.return(qa.openInWindow(xc).activate())})}},{name:"open file",progressIndicator:"opening file...",exec:function(qa,ba){ba=void 0===ba?{url:null,lineNumber:null,reuse:!1}:ba;var cb,za,Wa,gb,ac,fc,xc,ed;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kd){switch(kd.nextAddress){case 1:cb=ba;za=cb.url;Wa=cb.lineNumber;gb=cb.reuse;ac=qa.commandHandler.progressIndicator;if(za){kd.jumpTo(2);
break}ac.visible=!1;return kd.yield(qa.prompt("Enter file location",{historyId:"lively.morphic-text editor url",useLastInput:!0}),3);case 3:za=kd.yieldResult,ac.visible=!0;case 2:if(gb&&(qa.getWindows().slice(-2),fc=Vd.arr.findAndGet(qa.getWindows(),function(Qd){return(Qd=Qd.targetMorph)&&Qd.isTextEditor&&Qd.location.split(":")[0]===za?Qd:null})))return"number"===typeof Wa&&(fc.lineNumber=Wa),kd.return(fc.getWindow().activate());Wa&&(za+=":"+Wa);return kd.yield(System.import("lively.ide/text-editor.js"),
4);case 4:return xc=kd.yieldResult,ed=xc.default,kd.return(za?ed.openURL(za,Vd.obj.dissoc(ba,["url"])):null)}})}},{name:"open file for EDITOR",exec:function(qa,ba){ba=void 0===ba?{url:null,lineNumber:null}:ba;var cb,za,Wa,gb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ac){return 1==ac.nextAddress?ac.yield(System.import("lively.ide/text-editor.js"),2):3!=ac.nextAddress?(cb=ac.yieldResult,za=cb.default,Wa=ba,gb=Wa.url,ac.yield(za.openAsEDITOR(gb,{}),3)):ac.return(ac.yieldResult)})}},
{name:"open subserver controller",exec:function(qa,ba){var cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(za){if(1==za.nextAddress)return za.yield(Vd.loadPart("subserver controller"),2);cb=za.yieldResult;return za.return(cb.openInWorld())})}},{name:"[lively.installer] publish new version of a package",exec:function(qa){var ba,cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(za){switch(za.nextAddress){case 1:return za.yield(lively.modules.registerPackage(document.location.origin+
"/lively.installer"),2);case 2:return za.yield(System.import("lively.installer/packages/publish-new-package-version.js"),3);case 3:return ba=za.yieldResult,cb=ba.default,za.yield(cb(),4);case 4:return za.return(!0)}})}},{name:"report a bug",exec:function(qa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ba){window.open("https://github.com/LivelyKernel/lively.next/issues/new","_blank");return ba.return(!0)})}},{name:"fix font metric",exec:function(qa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ba){qa.env.fontMetric.reset();
qa.withAllSubmorphsDo(function(cb){return cb.isText&&cb.textLayout&&cb.textLayout.reset()});return ba.return(!0)})}},{name:"delete change history",exec:function(qa){var ba=qa.env,cb=ba.printStatus();ba.deleteHistory();qa.setStatusMessage(cb);qa._componentsBrowser&&qa._componentsBrowser.reset();return!0}},{name:"install global inspect and show",exec:function(qa){window.show=Vd.show;window.inspect=Vd.inspect;qa.setStatusMessage("inspect() and show() are now globally available");return!0}},{name:"save world",
exec:function(qa,ba,cb,za){var Wa,gb,ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fc){if(1==fc.nextAddress){if(Wa=za&&qa.relayCommandExecutionToFocusedMorph(za))return fc.return(Wa);ba=Object.assign({confirmOverwrite:!0,showSaveDialog:!0},ba);gb=qa.focusedMorph;return fc.yield(Vd.interactivelySaveWorld(qa,ba),2)}ac=fc.yieldResult;gb&&gb.focus();return fc.return(ac)})}},{name:"freeze world",exec:function(qa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ba){return ba.yield(Vd.interactivelyFreezeWorld(qa),
0)})}},{name:"save this world",exec:function(qa,ba,cb,za){return qa.execCommand("save world",Object.assign({confirmOverwrite:!0},ba,{showSaveDialog:!1}))}},{name:"load world",exec:function(qa,ba){ba=void 0===ba?{}:ba;var cb,za,Wa,gb,ac,fc,xc,ed,kd,Qd,Ge;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cf){switch(cf.nextAddress){case 1:cb=ba;za=cb.id;Wa=cb.commit;gb=cb.name;ac=cb.ref;fc=cb.world;xc=qa.constructor;if(fc)return cf.return(xc.loadWorld(fc,qa));if(za||Wa)return cf.return(xc.loadFromCommit(za||
Wa,qa));if(gb)return cf.return(xc.loadFromDB(gb,ac,qa));ed=Vd.LoadingIndicator.open("loading project browser...");return cf.yield(ed.whenRendered(),2);case 2:kd=Vd.morph({fill:Vd.Color.black.withA(.5),extent:qa.extent,name:"dark overlay",opacity:0,reactsToPointer:!1,renderOnGPU:!0,halosEnabled:!1});kd.openInWorld(Vd.pt(0,0));kd.animate({opacity:1,duration:300});if(Qd=qa.get("a project browser")){cf.jumpTo(3);break}return cf.yield(Vd.resource("part://partial freezing/project browser").read(),4);case 4:Qd=
cf.yieldResult;case 3:return Ge=Qd,Ge.name="a project browser",Ge.hasFixedPosition=!0,Ge.epiMorph=!0,Ge.bringToFront().alignInWorld(qa),Ge.update(),Ge.focus(),Vd.once(Ge,"remove",function(){return kd.animate({opacity:0}).then(function(){return kd.remove()})}),ed.remove(),cf.return(Ge)}})}},{name:"add external package dependency to object",exec:function(qa,ba){ba=void 0===ba?{}:ba;var cb,za,Wa,gb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ac){if(1==ac.nextAddress)return cb=ba.target||
qa,za=cb.metadata&&cb.metadata.externalPackages||[],ac.yield(qa.editListPrompt("modify package dependencies of "+cb,za),2);Wa=ac.yieldResult;gb=Wa.list;if(!gb)return ac.return();gb.length?(cb.metadata||(cb.metadata={}),cb.metadata.externalPackages=gb):cb.metadata&&delete cb.metadata.externalPackages;return ac.return(!0)})}},{name:"toggle comment browser",exec:function(qa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ba){Vd.CommentBrowser.toggle();ba.jumpToEnd()})}}];var si=Vd.commands;
Vd.default=si;var wd=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js");wd.RadialGradient=ad;wd.Point=ie;wd.pt=Ud;wd.rect=Wc;wd.Color=wc;wd.LinearGradient=Yb;wd.Morph=zb;wd.Tooltip=Rc;wd.Image=Vb;wd.VerticalLayout=Mc;wd.GridLayout=tc;wd.Text=Ad;wd.Ellipse=Tc;wd.morph=Ve;wd.Icon=fb;wd.num=uc;wd.arr=gd;wd.connect=Rb;wd.signal=Fc;wd.Popover=zf;wd.ColorPalette=dg;wd.ColorPicker=tg;wd.colorWidgets=Ah;wd.joinPath=Uc;wd.WHEEL_URL=wd.joinPath(System.baseURL,"/lively.ide/assets/color-wheel.png");
(function(qa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),cb=ba.hasOwnProperty("GradientTypeSelector")&&"function"===typeof ba.GradientTypeSelector?ba.GradientTypeSelector:ba.GradientTypeSelector=function(za){za&&za[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return vd(cb,qa,[{key:"defaultLinearGradient",get:function(){return new wd.LinearGradient({stops:[{color:wd.Color.white,offset:0},{color:wd.Color.black,
offset:1}]})}},{key:"defaultRadialGradient",get:function(){return new wd.RadialGradient({stops:[{color:wd.Color.white,offset:0},{color:wd.Color.black,offset:1}],focus:wd.pt(.5,.5),bounds:wd.rect(0,0,30,30)})}},{key:"update",value:function(za){var Wa=$jscomp.makeIterator(this.submorphs),gb=Wa.next().value;Wa=Wa.next().value;gb.borderColor=Wa.borderColor=wd.Color.gray.darker();za instanceof wd.RadialGradient?gb.borderColor=wd.Color.orange:za instanceof wd.LinearGradient&&(Wa.borderColor=wd.Color.orange)}}],
[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientTypeSelector"}},{key:"properties",get:function(){return{fill:{defaultValue:wd.Color.transparent},layout:{initialize:function(){this.extent=wd.pt(180,40);this.layout=new wd.GridLayout({grid:[[null,"radialMode",null,"linearMode",null]],autoAssign:!1,fitToCell:!1})}},submorphs:{initialize:function(){var za=this,Wa=$jscomp.makeIterator(this.submorphs=[wd.morph({type:"ellipse",master:{auto:"styleguide://SystemWidgets/gradient mode/deselected"},
name:"radialMode",fill:this.defaultRadialGradient}),wd.morph({type:"ellipse",master:{auto:"styleguide://SystemWidgets/gradient mode/deselected"},name:"linearMode",fill:this.defaultLinearGradient})]),gb=Wa.next().value;Wa=Wa.next().value;wd.connect(gb,"onMouseDown",function(){return wd.signal(za,"radial")});wd.connect(Wa,"onMouseDown",function(){return wd.signal(za,"linear")})}}}}}],ba,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:660,end:2566})})(wd.Morph);var hb=function(qa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),cb=ba.hasOwnProperty("GradientEditor")&&"function"===typeof ba.GradientEditor?ba.GradientEditor:ba.GradientEditor=function(za){za&&za[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return vd(cb,qa,[{key:"remove",value:function(){vd._get(Object.getPrototypeOf(cb.prototype),"remove",this).call(this);this.gradientHandle&&this.gradientHandle.remove()}},{key:"selectRadialGradient",value:function(){var za=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){return 1==Wa.nextAddress?(za.get("linearMode").borderColor=wd.Color.gray.darker(),za.get("radialMode").borderColor=wd.Color.orange,Wa.yield(za.applyGradient(wd.RadialGradient),2)):Wa.yield(za.updateGradientHandles(),
0)})}},{key:"selectLinearGradient",value:function(){var za=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){return 1==Wa.nextAddress?(za.get("radialMode").borderColor=wd.Color.gray.darker(),za.get("linearMode").borderColor=wd.Color.orange,Wa.yield(za.applyGradient(wd.LinearGradient),2)):Wa.yield(za.updateGradientHandles(),0)})}},{key:"applyGradient",value:function(za){var Wa=this,gb,ac,fc,xc,ed;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kd){gb=Wa.gradientValue;
Wa.get("gradientEditor");gb&&gb.isGradient?(ac=gb,fc=ac.stops,xc=ac.focus,ed=ac.vector,Wa.gradientValue=new za({stops:fc,bounds:Wa.gradientBounds,focus:xc,vector:ed})):Wa.gradientValue=new za({stops:[{color:wd.Color.white,offset:0},{color:wd.Color.black,offset:1}],bounds:Wa.gradientBounds});Wa.update(Wa.gradientValue);kd.jumpToEnd()})}},{key:"showGradientHandlesOn",value:function(za){this.handleMorph=za;this.updateGradientHandles()}},{key:"updateGradientHandles",value:function(){var za=this,Wa,gb;
return $jscomp.asyncExecutePromiseGeneratorProgram(function(ac){if(1==ac.nextAddress)return Wa=300,gb=za.gradientValue.__proto__.constructor,za.handleMorph?za.gradientHandle?ac.yield(za.gradientHandle.fadeOut(Wa),3):ac.jumpTo(2):ac.return();gb==wd.RadialGradient?za.gradientHandle=new wd.GradientFocusHandle({target:za.handleMorph}):gb==wd.LinearGradient&&(za.gradientHandle=new wd.GradientDirectionHandle({target:za.handleMorph}));za.gradientHandle&&(wd.signal(za,"openHandle",za.gradientHandle),za.gradientHandle.relayout(),
za.gradientHandle.opacity=0,za.gradientHandle.animate({opacity:1,duration:Wa}));ac.jumpToEnd()})}},{key:"update",value:function(za){(za=void 0===za?this.gradientValue:za)&&za.isGradient&&this.get("gradientEditor").update(za)}},{key:"build",value:function(){var za;this.submorphs=[za=new wd.GradientTypeSelector({name:"typeSelector"}),this.gradientEditor()];wd.connect(za,"radial",this,"selectRadialGradient");wd.connect(za,"linear",this,"selectLinearGradient");wd.connect(this,"gradientValue",this,"update");
this.update(this.gradientValue);za.update(this.gradientValue);this.gradientValue&&this.updateGradientHandles()}},{key:"gradientEditor",value:function(){return wd.morph({fill:null,clipMode:"hidden",extent:wd.pt(190,80),submorphs:[new wd.GradientStopVisualizer({position:wd.pt(5,30),name:"gradientEditor",gradientEditor:this})]})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientEditor"}},{key:"properties",get:function(){return{layout:{initialize:function(){this.layout=new wd.VerticalLayout({spacing:3})}},
fill:{defaultValue:wd.Color.transparent},handleMorph:{},gradientValue:{set:function(za){za&&za.isGradient||(za=!1);this.setProperty("gradientValue",za)}},submorphs:{initialize:function(){this.build()}}}}}],ba,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:2575,end:6191})}(wd.Morph);
wd.GradientEditor=hb;wd.GradientEditor=hb;wd.GradientEditor=hb;(function(qa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),cb=ba.hasOwnProperty("StopControlHead")&&"function"===typeof ba.StopControlHead?ba.StopControlHead:ba.StopControlHead=function(za){za&&za[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return vd(cb,qa,[{key:"update",value:function(za){var Wa=this.getSubmorphNamed("paletteField");
this.getSubmorphNamed("pickerField");Wa||(this.submorphs=[Wa=this.paletteField(wd.pt(10,10))]);Wa.fill=this.stopColor=za.stops[this.index].color}},{key:"onHoverIn",value:function(){var za=this.targetProperty.stops[this.index].color;this.palette=this.palette||new wd.Popover({name:"Color Palette",targetMorph:new wd.ColorPalette({color:za})});wd.connect(this.palette.targetMorph,"color",this.palette,"color");this.picker=this.picker||new wd.ColorPicker({color:za});this.picker.color=za;this.scheduleExpand()}},
{key:"onHoverOut",value:function(){this.scheduleShrink()}},{key:"scheduleExpand",value:function(){this.queue.pop()||(this.queue.push(this.expand),this.dequeue())}},{key:"scheduleShrink",value:function(){this.queue.pop()||(this.queue.push(this.shrink),this.dequeue())}},{key:"dequeue",value:function(){var za=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){if(1==Wa.nextAddress){if(za.queueActive)return Wa.return();za.queueActive=!0}if(3!=Wa.nextAddress)return 0<za.queue.length?Wa.yield(za.queue.shift().bind(za)(),
2):Wa.jumpTo(3);za.queueActive=!1;Wa.jumpToEnd()})}},{key:"expand",value:function(){var za=this,Wa,gb,ac,fc,xc,ed,kd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qd){if(1<za.submorphs.length)return Qd.return();Wa=za.get("paletteField");ac=wd.pt(2,-14);za.submorphs=[za.closeButton(),Wa,za.pickerField()];za.master={auto:"styleguide://SystemWidgets/stop control head/expanded"};gb=za.get("gradientEditor");fc=za.transformRectToMorph(gb,za.innerBounds());xc=fc.x;ed=fc.width;kd=xc+ed-gb.width;
xc<za.width/2&&(ac=ac.addXY(za.width/3-xc,0));kd>za.width/2&&(ac=ac.addXY(za.width/3-kd,0));Wa.extent=wd.pt(15,15);za.center=ac;za.stopVisualizer.gradientEditor.update();Qd.jumpToEnd()})}},{key:"shrink",value:function(){var za=this,Wa,gb,ac,fc,xc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ed){if(3>za.submorphs.length)return ed.return();Wa=wd.pt(2,-14);gb=$jscomp.makeIterator([za.get("close"),za.get("paletteField"),za.get("pickerField")]);ac=gb.next().value;fc=gb.next().value;xc=gb.next().value;
fc.bringToFront();ac.remove();xc.remove();za.master={auto:"styleguide://SystemWidgets/stop control head/collapsed"};za.center=Wa;ed.jumpToEnd()})}},{key:"onWidgetClosed",value:function(){this.palette=this.picker=null;this.shrink()}},{key:"removeStop",value:function(){this.stopVisualizer.removeStop(this.index)&&this.remove()}},{key:"closeButton",value:function(){var za=new wd.Morph({name:"close",extent:wd.pt(15,15),fill:wd.Color.transparent,origin:wd.pt(0,-3),clipMode:"hidden",submorphs:[wd.Icon.makeLabel("times",
{styleClasses:["closeButton"]})]});wd.connect(za,"onMouseDown",this,"removeStop");return za}},{key:"updateColor",value:function(za){this.stopVisualizer.updateStop(this.index,{color:za})}},{key:"openColorWidget",value:function(za){this.stopVisualizer.stopControls.forEach(function(Wa){return Wa.head.closeAllWidgets()});this[za].topLeft=wd.pt(0,0);wd.connect(this[za],"color",this,"updateColor");wd.connect(this[za],"close",this,"onWidgetClosed");wd.connect(this.stopVisualizer,"remove",this[za],"remove");
wd.connect(this[za],"onBlur",this,"removeWhenLostFocus",{converter:function(){return za},varMapping:{name:za}});this[za].fadeIntoWorld(this.globalBounds().bottomCenter());this[za].focus()}},{key:"removeWhenLostFocus",value:function(za){var Wa=this;setTimeout(function(){$world.focusedMorph.ownerChain().includes(Wa[za])||$world.focusedMorph.isMenuItem?Wa[za].focus():Wa.closeColorWidget(za)},100)}},{key:"closeColorWidget",value:function(za){this[za]&&this[za].remove()}},{key:"closeAllWidgets",value:function(){this.closeColorWidget("palette");
this.closeColorWidget("picker")}},{key:"paletteField",value:function(za){za=wd.morph({type:"ellipse",name:"paletteField",extent:za,styleClasses:["paletteField"]});wd.connect(za,"onMouseDown",this,"openColorWidget",{converter:function(){return"palette"}});return za}},{key:"pickerField",value:function(){var za=new wd.Image({name:"pickerField",styleClasses:["pickerField"]});wd.connect(za,"onMouseDown",this,"openColorWidget",{converter:function(){return"picker"}});return za}}],[{key:Symbol.for("__LivelyClassName__"),
get:function(){return"StopControlHead"}},{key:"properties",get:function(){return{stopVisualizer:{},gradientEditor:{},targetProperty:{get:function(){return this.stopVisualizer.targetProperty}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/stop control head/collapsed"}}},index:{},queue:{defaultValue:[]},isHaloItem:{defaultValue:!0}}}}],ba,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:6193,end:11487})})(wd.Morph);(function(qa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),cb=ba.hasOwnProperty("GradientStopVisualizer")&&"function"===typeof ba.GradientStopVisualizer?ba.GradientStopVisualizer:ba.GradientStopVisualizer=function(za){za&&za[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return vd(cb,qa,[{key:"update",value:function(za){this.fill=new wd.LinearGradient({stops:za.stops,vector:"eastwest"});this.get("instruction").animate({visible:!1,duration:300});this.renderStopControls(za)}},{key:"onHoverOut",value:function(){this.toggleStopPreview(!1)}},{key:"onMouseMove",value:function(za){var Wa=za.positionIn(this);za=Wa.x;this.stopControls&&this.stopControls.find(function(gb){return gb.bounds().containsPoint(Wa)})?this.toggleStopPreview(!1):(this.toggleStopPreview(!0),
this.get("stopControlPreview").position=wd.pt(za,0))}},{key:"onMouseDown",value:function(za){if(this.get("stopControlPreview").visible){var Wa=za.positionIn(this).x/this.width;za=this.targetProperty.stops.findIndex(function(gb){return gb.offset>Wa});za=0>za?this.targetProperty.stops.length-1:za;this.insertStop(za,Wa)}}},{key:"toggleStopPreview",value:function(za){this.get("instruction").visible||(this.get("stopControlPreview").visible=za)}},{key:"removeStop",value:function(za){var Wa=this.targetProperty;
return 2<Wa.stops.length?(wd.arr.removeAt(Wa.stops,za),this.targetProperty=Wa,!0):!1}},{key:"insertStop",value:function(za,Wa){var gb=this.targetProperty;wd.arr.pushAt(gb.stops,{offset:Wa,color:gb.stops[za].color},za);this.targetProperty=gb}},{key:"updateStop",value:function(za,Wa){var gb=this.targetProperty;gb.stops[za]=Object.assign({},gb.stops[za],{},Wa);this.targetProperty=gb}},{key:"renderStopControls",value:function(za){var Wa=this;if(!this.stopControls||this.stopControls.length!=za.stops.length){var gb=
$jscomp.makeIterator(this.submorphs),ac=gb.next().value;gb=gb.next().value;this.stopControls=za.stops.map(function(fc,xc){return new wd.GradientStopControl({stopVisualizer:Wa,index:xc})});this.submorphs=[ac,gb].concat($jscomp.arrayFromIterable(this.stopControls));wd.arr.invoke(this.stopControls,"update",za)}wd.arr.invoke(this.stopControls,"update",za)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientStopVisualizer"}},{key:"properties",get:function(){return{fill:{defaultValue:wd.Color.gray},
gradientEditor:{},draggable:{defaultValue:!1},targetProperty:{derived:!0,get:function(){return this.gradientEditor&&this.gradientEditor.gradientValue},set:function(za){this.gradientEditor.gradientValue=za}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient stop visualizer"}}},submorphs:{after:["gradientEditor"],initialize:function(){this.submorphs=[{type:"label",name:"instruction",value:"Select Gradient Type",visible:!(this.targetProperty&&this.targetProperty.isGradient)},
{name:"stopControlPreview",visible:!1,master:{auto:"styleguide://SystemWidgets/stop control preview"},submorphs:[wd.Icon.makeLabel("plus-circle",{name:"addStopLabel"})]}]}}}}}],ba,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:11489,end:14883})})(wd.Morph);(function(qa){var ba=
lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),cb=ba.hasOwnProperty("GradientStopControl")&&"function"===typeof ba.GradientStopControl?ba.GradientStopControl:ba.GradientStopControl=function(za){za&&za[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return vd(cb,qa,[{key:"update",value:function(za){this.position=this.stopVisualizer.extent.subPt(wd.pt(10,0)).scaleByPt(wd.pt(za.stops[this.index].offset,0)).addPt(wd.pt(5,
0));this.head.update(za)}},{key:"onDragStart",value:function(za){this.nativeCursor="-webkit-grabbing";this.stopVisualizer.nativeCursor="-webkit-grabbing";this.offsetView=(new wd.Tooltip).openInWorld(za.hand.position.addPt(wd.pt(10,10)))}},{key:"onDrag",value:function(za){var Wa=Math.max(0,Math.min(1,(this.position.x-5+za.state.dragDelta.x)/(this.stopVisualizer.width-10)));this.stopVisualizer.updateStop(this.index,{offset:Wa});this.offsetView.description=(100*Wa).toFixed(2)+"%";this.offsetView.position=
za.hand.position.addPt(wd.pt(10,10))}},{key:"onDragEnd",value:function(){this.nativeCursor="-webkit-grab";this.stopVisualizer.nativeCursor="auto";this.offsetView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientStopControl"}},{key:"properties",get:function(){return{index:{},head:{},stopVisualizer:{},styleClasses:{defaultValue:["stopControlLine"]},nativeCursor:{defaultValue:"-webkit-grab"},draggable:{defaultValue:!0},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient stop control"}}},
submorphs:{after:["index","stopVisualizer"],initialize:function(){this.head=new wd.StopControlHead({name:"stop control head",stopVisualizer:this.stopVisualizer,index:this.index});this.head.stopControl=this;this.addMorph(this.head)}}}}}],ba,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},
{start:14885,end:16661})})(wd.Morph);(function(qa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),cb=ba.hasOwnProperty("FocusHandle")&&"function"===typeof ba.FocusHandle?ba.FocusHandle:ba.FocusHandle=function(za){za&&za[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return vd(cb,qa,[{key:"relayout",value:function(){this.center=this.gradientHandle.innerBounds().center()}},{key:"onDragStart",value:function(za){this.tfm=
this.gradientHandle.target.getGlobalTransform().inverse();this.focusView=(new wd.Tooltip).openInWorld(za.hand.position.addPt(wd.pt(10,10)))}},{key:"onDrag",value:function(za){var Wa=za.state.dragDelta,gb=this.gradientHandle,ac=gb.target.fill;ac.focus=ac.focus.addXY(Wa.x/gb.target.width,Wa.y/gb.target.height);this.focusView.description="x: "+(100*ac.focus.x).toFixed()+"%, y: "+(100*ac.focus.y).toFixed()+"%";this.focusView.position=za.hand.position.addPt(wd.pt(10,10));gb.target.makeDirty();gb.relayout()}},
{key:"onDragEnd",value:function(za){this.focusView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"FocusHandle"}},{key:"properties",get:function(){return{gradientHandle:{},styleClasses:{defaultValue:["focusHandle"]},extent:{defaultValue:wd.pt(20,20)},fill:{defaultValue:wd.Color.orange}}}}],ba,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},
package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:16663,end:17666})})(wd.Ellipse);(function(qa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),cb=ba.hasOwnProperty("BoundsHandle")&&"function"===typeof ba.BoundsHandle?ba.BoundsHandle:ba.BoundsHandle=function(za){za&&za[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return vd(cb,qa,[{key:"relayout",value:function(){this.center=this.gradientHandle.innerBounds().partNamed(this.side);
this.scale=1/this.gradientHandle.target.getGlobalTransform().getScale()}},{key:"onDragStart",value:function(za){this.boundsView=(new wd.Tooltip).openInWorld(za.hand.position.addPt(wd.pt(10,10)))}},{key:"onDrag",value:function(za){var Wa=this.gradientHandle,gb=Wa.target.fill,ac=gb.bounds.partNamed(this.side).addPt(za.state.dragDelta.scaleBy(2));gb.bounds=gb.bounds.withPartNamed(this.side,ac);this.boundsView.description="w: "+gb.bounds.width.toFixed()+"px h: "+gb.bounds.height.toFixed()+"px";this.boundsView.position=
za.hand.position.addPt(wd.pt(10,10));Wa.target.makeDirty();Wa.relayout()}},{key:"onDragEnd",value:function(za){this.boundsView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"BoundsHandle"}},{key:"properties",get:function(){return{side:{},gradientHandle:{},styleClasses:{after:["side"],initialize:function(){this.styleClasses=["boundsHandle",this.side]}}}}}],ba,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:17668,end:18747})})(wd.Ellipse);var yb=function(qa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),cb=ba.hasOwnProperty("GradientFocusHandle")&&"function"===typeof ba.GradientFocusHandle?ba.GradientFocusHandle:ba.GradientFocusHandle=function(za){za&&za[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return vd(cb,qa,[{key:"relayout",value:function(){var za=this.target.fill,Wa=za.focus;this.extent=za.bounds.extent();this.submorphs.forEach(function(gb){return gb.relayout()});this.rotation=this.target.rotation;this.scale=this.target.scale;this.borderWidth=2/this.scale;this.owner&&(this.center=this.owner.localizePointFrom(this.target.extent.scaleByPt(Wa),this.target))}},{key:"initBoundsHandles",value:function(){var za=this;this.bounds().sides.forEach(function(Wa){za.addMorph(new wd.BoundsHandle({gradientHandle:za,
side:Wa,name:"bounds handle "+Wa.split("C")[0]}))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientFocusHandle"}},{key:"properties",get:function(){return{target:{},isHaloItem:{defaultValue:!0},hasFixedPosition:{defaultValue:!0},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient focus handle"}}},submorphs:{initialize:function(){this.submorps=[];this.initBoundsHandles();this.addMorph(new wd.FocusHandle({gradientHandle:this}));this.relayout()}}}}}],
ba,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:18756,end:20039})}(wd.Ellipse);wd.GradientFocusHandle=yb;wd.GradientFocusHandle=yb;wd.GradientFocusHandle=yb;(function(qa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),cb=ba.hasOwnProperty("RotationPoint")&&
"function"===typeof ba.RotationPoint?ba.RotationPoint:ba.RotationPoint=function(za){za&&za[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return vd(cb,qa,[{key:"relayout",value:function(){this.center=wd.Point.polar(this.gradientHandle.width/2,this.gradientHandle.target.fill.vectorAsAngle())}},{key:"onDragStart",value:function(za){this.angleView=(new wd.Tooltip).openInWorld(za.hand.position.addPt(wd.pt(10,10)));this.angleView.rotation=
0}},{key:"onDrag",value:function(za){var Wa=this.gradientHandle;Wa.target.fill.vector=za.positionIn(Wa).theta();Wa.target.makeDirty();Wa.relayout();this.angleView.description=(wd.num.toDegrees(Wa.target.fill.vectorAsAngle())+180).toFixed()+"\u00b0";this.angleView.position=za.hand.position.addPt(wd.pt(10,10))}},{key:"onDragEnd",value:function(za){this.angleView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"RotationPoint"}},{key:"properties",get:function(){return{gradientHandle:{}}}}],
ba,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:20041,end:20838})})(wd.Ellipse);(function(qa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),cb=ba.hasOwnProperty("GradientDirectionHandle")&&"function"===typeof ba.GradientDirectionHandle?
ba.GradientDirectionHandle:ba.GradientDirectionHandle=function(za){za&&za[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return vd(cb,qa,[{key:"isHaloItem",get:function(){return!0}},{key:"relayout",value:function(){this.owner&&(this.position=this.owner.localizePointFrom(this.target.extent.scaleBy(.5),this.target));this.rotationPoint.relayout()}},{key:"initRotationPoint",value:function(){this.rotationPoint=this.addMorph(new wd.RotationPoint({gradientHandle:this,
name:"rotation point"}))}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientDirectionHandle"}},{key:"properties",get:function(){return{target:{},origin:{defaultValue:wd.pt(25,25)},extent:{defaultValue:wd.pt(50,50)},hasFixedPosition:{defaultValue:!0},submorphs:{initialize:function(){this.initRotationPoint();this.relayout()}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient direction handle"}}}}}}],ba,{pathInPackage:function(){return"styling/gradient-editor.js"},
unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:20840,end:21812})})(wd.Ellipse);wd.colorWidgets.GradientEditor=wd.GradientEditor;var lb=lively.FreezerRuntime.recorderFor("lively.ide/world.js");lb.resource=nc;lb.Rectangle=jc;lb.Color=wc;lb.pt=Ud;lb.arr=gd;lb.fun=Xd;lb.obj=Pd;lb.promise=vc;lb.PropertyPath=xd;lb.once=ge;lb.GridLayout=tc;lb.MorphicDB=
Oc;lb.easings=bf;lb.HTMLMorph=pc;lb.Text=Ad;lb.Label=bb;lb.Path=Ma;lb.Polygon=oa;lb.morph=Ve;lb.Ellipse=Tc;lb.touchInputDevice=La;lb.Icon=fb;lb.Morph=zb;lb.VerticalLayout=Mc;lb.HorizontalLayout=Ua;lb.ProportionalLayout=Sb;lb.Tooltip=Rc;lb.Image=Vb;lb.inspect=af;lb.config=xe;lb.World=Ca;lb.loadMorphFromSnapshot=Va;lb.loadObjectFromPartsbinFolder=td;lb.loadPart=be;lb.uploadFile=ld;lb.InformPrompt=dc;lb.ConfirmPrompt=sb;lb.MultipleChoicePrompt=od;lb.TextPrompt=bc;lb.EditPrompt=Td;lb.PasswordPrompt=rd;
lb.ListPrompt=dd;lb.EditListPrompt=Ub;lb.LoadingIndicator=pe;lb.Halo=C;lb.MorphHighlighter=uf;lb.StatusMessage=Cf;lb.StatusMessageForMorph=fh;lb.ProportionalLayoutHalo=mg;lb.GridLayoutHalo=we;lb.FlexLayoutHalo=$f;lb.Window=Ne;lb.List=gc;lb.FilterableList=Tb;lb.Menu=Ya;lb.worldCommands=si;lb.GradientEditor=hb;lb.completions=ha;lb.runEval=Pa;lb.getClassName=nb;lb.serialize=cc;lb.Canvas=Lc;lb.CommentBrowser=Ce;lb.prefetchCoreStyleguides=pd;si=$a("LivelyWorld",function(qa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),
cb=ba.hasOwnProperty("LivelyWorld")&&"function"===typeof ba.LivelyWorld?ba.LivelyWorld:ba.LivelyWorld=function(za){za&&za[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return vd(cb,qa,[{key:"visibleBoundsExcludingTopBar",value:function(){var za=$world.getSubmorphNamed("lively top bar"),Wa=this.visibleBounds();return za?new lb.Rectangle(Wa.x,Wa.y+za.height,Wa.width,Wa.height-za.height):Wa}},{key:"getListedComponents",value:function(){var za=
this,Wa=this.withAllSubmorphsSelect(function(gb){return gb.isComponent&&!za.hiddenComponents.includes(gb.name)});return lb.arr.uniq([].concat($jscomp.arrayFromIterable(Wa),$jscomp.arrayFromIterable(this.localComponents)))}},{key:"activeWindow",value:function(){return this.getWindows().reverse().find(function(za){return za.isActive()})}},{key:"getWindows",value:function(){return this.submorphs.filter(function(za){return za.isWindow})}},{key:"activePrompt",value:function(){return this.getPrompts().reverse().find(function(za){return za.isActive()})}},
{key:"getPrompts",value:function(){return this.submorphs.filter(function(za){return za.isPrompt})}},{key:"openInWindow",value:function(za,Wa){Wa=void 0===Wa?{title:za.name,name:"window for "+za.name}:Wa;za=(new lb.Window(Object.assign({},Wa,{extent:za.extent.addXY(0,25),targetMorph:za}))).openInWorld();za.ensureNotOverTheTop();return za}},{key:"withTopBarDo",value:function(za){var Wa=this.get("lively top bar");Wa&&za(Wa)}},{key:"onTopBarLoaded",value:function(){}},{key:"onKeyUp",value:function(za){this.withTopBarDo(function(Wa){return Wa.onKeyUp(za)})}},
{key:"onKeyDown",value:function(za){vd._get(Object.getPrototypeOf(cb.prototype),"onKeyDown",this).call(this,za);za.targetMorph==this&&this.withTopBarDo(function(Wa){return Wa.onKeyDown(za)})}},{key:"onMouseDown",value:function(za){vd._get(Object.getPrototypeOf(cb.prototype),"onMouseDown",this).call(this,za);var Wa=za.state.clickedOnMorph,gb=this.activeWindow();gb&&Wa==this&&gb.deactivate();this.handleHaloCycle(za);za.state.menu&&za.state.menu.remove();this._tooltipViewer.mouseDown(za)}},{key:"onMouseUp",
value:function(za){za.isCommandKey()&&za.stop();if(za.isAltDown()&&lb.config.altClickDefinesThat){var Wa=this.morphsContainingPoint(za.position)[0];setTimeout(function(){return System.global.that=Wa},100);Wa.show();za.stop();console.log('Set global "that" to '+Wa)}}},{key:"onDrag",value:function(za){}},{key:"whenReady",value:function(){var za=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){return 1==Wa.nextAddress?Wa.yield(za._styleLoading,2):Wa.return(!0)})}},{key:"onLoad",value:function(){var za=
this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){if(1==Wa.nextAddress){za.opacity=0;za.onWindowResize();lively.modules&&lively.modules.removeHook("fetch",window.__logFetch);za.animate({opacity:1,blur:3,duration:1E3,easing:lb.easings.inOutExpo}).then(function(){var gb,ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fc){if(1==fc.nextAddress){if(!(gb=window.worldLoadingIndicator))return fc.jumpTo(0);ac=gb.world();if(ac.env==za.env)return fc.jumpTo(0);gb.withAllSubmorphsDo(function(xc){return xc._env=
za.env});za.addMorph(gb);return fc.yield(ac.whenRendered(),4)}ac.env.renderer.stopRenderWorldLoop();fc.jumpToEnd()})});if(!za.showsUserFlap&&!lb.resource(document.location.href).query().showsUserFlap)return Wa.jumpTo(2);za._styleLoading=lb.prefetchCoreStyleguides(window.worldLoadingIndicator);return Wa.yield(za._styleLoading,2)}za.animate({blur:0,duration:1E3,easing:lb.easings.inOutExpo});document.body.style.overflowX="visible";document.body.style.overflowY="visible";Wa.jumpToEnd()})}},{key:"isNotUnique",
value:function(za){var Wa,gb,ac,fc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xc){switch(xc.nextAddress){case 1:return xc.yield(lb.MorphicDB.default.exists("world",za),2);case 2:if(Wa=xc.yieldResult.exists){xc.jumpTo(3);break}gb=za+".json";ac=lb;fc=ac.resource;return xc.yield(System.decanonicalize("lively.morphic/styleguides"),5);case 5:return xc.yield(fc.call(ac,xc.yieldResult).join(gb).exists(),4);case 4:Wa=xc.yieldResult;case 3:return xc.return(Wa)}})}},{key:"askForName",value:function(){var za=
this,Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gb){switch(gb.nextAddress){case 1:return gb.yield(za.whenRendered(),3);case 3:if(Wa){gb.jumpTo(4);break}return gb.yield(za.prompt(["New Project\n",{},"Enter a name for this project:",{fontWeight:"normal"}],{width:400,hasFixedPosition:!0,forceConfirm:!0}),5);case 5:return Wa=gb.yieldResult,gb.yield(za.isNotUnique(Wa),6);case 6:if(!gb.yieldResult){gb.jumpTo(3);break}return gb.yield(za.confirm("This Project name is already taken. Please pick a different one!",
{hasFixedPosition:!0,width:400}),8);case 8:Wa=!1;gb.jumpTo(3);break;case 4:return gb.return(Wa)}})}},{key:"onWindowResize",value:function(za){vd._get(Object.getPrototypeOf(cb.prototype),"onWindowResize",this).call(this,za);"elastic"===this.resizePolicy&&this.execCommand("resize to fit window")}},{key:"nativeDrop_ensureUploadIndicator",value:function(){var za=this,Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gb){if(1==gb.nextAddress)return za._cachedDragIndicator||(za._cachedDragIndicator=
lb.loadObjectFromPartsbinFolder("upload-indicator")),gb.yield(za._cachedDragIndicator,2);Wa=gb.yieldResult;Wa.world()||Wa.openInWorld();lb.fun.debounceNamed("remove-upload-indicator",1E3,function(){za.nativeDrop_removeUploadIndicator()})();gb.jumpToEnd()})}},{key:"nativeDrop_removeUploadIndicator",value:function(){this._cachedDragIndicator&&this._cachedDragIndicator.then(function(za){return za.remove()})}},{key:"onNativeDragover",value:function(za){za.targetMorph===this&&this.nativeDrop_ensureUploadIndicator()}},
{key:"onNativeDrop",value:function(za){var Wa=this,gb,ac,fc,xc,ed,kd,Qd,Ge,cf,ne,qf,pf,ff,vf,xg,dh,nh,Vg,qg,Hi,xj,Th,sg,eh,vh,wi,Ff,yj,Jc,Rd,Re,re,jg,$g,ih,bn,zm,zl,pl,dm,go,Fn,ho,En,zj,Hm;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lg){switch(Lg.nextAddress){case 1:Wa.nativeDrop_removeUploadIndicator();if(za.targetMorph!=Wa)return Lg.return();gb=za;ac=gb.domEvt;fc=ac.dataTransfer;xc=fc.files;ed=document.location.origin;if(!xc.length){Lg.jumpTo(2);break}kd=Wa.getCurrentUser();Qd=kd.isGuestUser?
"uploads/":"users/"+$world.getCurrentUser().name+"/uploads";if(!za.isAltDown()){Lg.jumpTo(3);break}return Lg.yield(Wa.prompt("Choose upload location",{history:"lively.morphic-html-drop-file-upload-location",input:Qd}),4);case 4:if(Qd=Lg.yieldResult,!Qd)return Lg.return(Wa.setStatusMessage("Canceled upload"));case 3:return Lg.yield(Wa.confirm("Upload "+xc.length+" file"+(1<xc.length?"s":"")+"?"),5);case 5:Ge=Lg.yieldResult;if(!Ge)return Lg.return();cf=new lb.FormData;for(ne=0;ne<xc.length;ne++)cf.append("file",
xc[ne],xc[ne].name);ff=lb.LoadingIndicator.open("Uploading File");Lg.setCatchFinallyBlocks(6);vf={};xg=function(ok){ok=ok.loaded/ok.total;ff.progress=ok;ff.status="Uploaded "+(100*ok).toFixed()+"%"};kd.isGuestUser||(vf.Authorization="Bearer "+kd.token);qf=lb.resource(System.baseURL,{headers:vf,onProgress:xg,onLoad:function(ok){return pf=ok}});qf=qf.join("/upload?uploadPath="+encodeURIComponent(Qd));return Lg.yield(qf.write(cf),8);case 8:Lg.leaveTryBlock(7);break;case 6:return dh=Lg.enterCatchBlock(),
Lg.return(Wa.showError("Upload failed: "+dh.message+"\n"));case 7:ff.remove();Lg.setCatchFinallyBlocks(9);Wa.setStatusMessage("Uploaded "+pf.uploadedFiles.length+" file");nh=pf.uploadedFiles.map(function(ok){var em=lb.resource(ed).join(ok.path);return Object.assign({},ok,{url:em.url,name:em.name()})});Vg=[];qg=[];Hi=[];xj=$jscomp.makeIterator(nh);for(Th=xj.next();!Th.done;Th=xj.next())sg=Th.value,sg.type.startsWith("image/")?Vg.push(sg):sg.type.startsWith("video")?qg.push(sg):Hi.push(sg);if(!qg.length){Lg.jumpTo(11);
break}eh=$jscomp.makeIterator(qg);vh=eh.next();case 12:if(vh.done){Lg.jumpTo(11);break}wi=vh.value;Ff=Object;yj=Ff.assign;return Lg.yield(lb.loadObjectFromPartsbinFolder("video morph"),15);case 15:yj.call(Ff,Lg.yieldResult,{videoURL:wi.url,name:wi.name}).openInWorld();vh=eh.next();Lg.jumpTo(12);break;case 11:Vg.length&&Vg.forEach(function(ok){var em=new lb.Image({imageUrl:ok.url,autoResize:!0,name:ok.name});em.whenLoaded().then(function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gn){if(1==
Gn.nextAddress)return em.extent=em.naturalExtent.scaleBy(.8*Wa.visibleBounds().height/em.height),em.openInWorld(),Gn.yield(em.whenRendered(),2);em.center=Wa.visibleBounds().center();Gn.jumpToEnd()})})});if(!Hi.length){Lg.jumpTo(16);break}Jc=$jscomp.makeIterator(Hi);Rd=Jc.next();case 17:if(Rd.done){Lg.jumpTo(16);break}Re=Rd.value;return Lg.yield(Wa.confirm("open file "+Re.name+" ("+Re.type+")?"),20);case 20:(re=Lg.yieldResult)&&Wa.execCommand("open file",{url:Re.url});Rd=Jc.next();Lg.jumpTo(17);break;
case 16:Lg.leaveTryBlock(10);break;case 9:jg=Lg.enterCatchBlock(),Wa.showError(jg);case 10:return Lg.return();case 2:$g=ac.dataTransfer.types;if(!$g.includes("text/html")){Lg.jumpTo(21);break}ih=ac.dataTransfer.getData("text/html");bn=(new lb.DOMParser).parseFromString(ih,"text/html");zm=bn.querySelectorAll("img");if(1===zm.length&&zm[0].src&&$g.includes("text/uri-list")){zl=zm[0].src;pl=new lb.Image({imageUrl:zl,autoResize:!0,name:lb.arr.last(zl.split("/"))});pl.whenLoaded().then(function(){return pl.openInWorld()});
Lg.jumpTo(22);break}dm=Object;go=dm.assign;return Lg.yield(lb.loadObjectFromPartsbinFolder("html-morph"),23);case 23:go.call(dm,Lg.yieldResult,{html:ih}).openInWorld();case 22:return Lg.return();case 21:Fn=0;case 24:if(!(Fn<ac.dataTransfer.items.length)){Lg.jumpTo(0);break}ho=ac.dataTransfer.items[Fn];if("file"!==ho.kind){"string"===ho.kind&&ho.getAsString(function(ok){return lb.inspect(ok)});Lg.jumpTo(25);break}En=ho.getAsFile();return Lg.yield(Wa.confirm("Upload "+En.name+"?"),28);case 28:zj=Lg.yieldResult;
if(!zj){Lg.jumpTo(25);break}return Lg.yield(lb.uploadFile(En,En.type),30);case 30:(Hm=Lg.yieldResult)&&Hm.openInWorld(),Hm.center=Wa.visibleBounds().center();case 25:Fn++,Lg.jumpTo(24)}})}},{key:"menuItems",value:function(){var za=this;return[{title:"World menu"},{command:"undo",target:this},{command:"redo",target:this},{isDivider:!0},["Debugging",[{command:"delete change history",target:this},{command:"fix font metric",target:this},{command:"inspect server",target:this}]],["Tools",[{command:"open javascript workspace",
target:this},{command:"open browser",target:this},{command:"choose and browse module",target:this},{command:"open code search",target:this},{command:"open file browser",target:this},{command:"open shell workspace",target:this,tooltip:"Opens a workspace like interface\nthat allows you to trigger shell comands\nvia select + eval by pressing either "+(new lb.Text).keysForCommand("doit")+" or "+(new lb.Text).keysForCommand("printit")},{command:"open shell terminal",target:this,tooltip:"Opens a classic remote shell interface,\nthat allows you to send commands to a\nbash session running on the server.\nAlso comes with advanced git support."},
{command:"open workspace",args:{askForMode:!0},target:this}]],{isDivider:!0},{command:"run command",target:this},{command:"select morph",target:this},{command:"window switcher",target:this},["Exported Components",[["Toggle Select All",function(){0==za.getListedComponents().length?za.hiddenComponents=[]:za.hiddenComponents=za.withAllSubmorphsSelect(function(Wa){return Wa.isComponent}).map(function(Wa){return Wa.name})}]].concat($jscomp.arrayFromIterable(this.withAllSubmorphsSelect(function(Wa){return Wa.isComponent}).map(function(Wa){var gb=
za.hiddenComponents.includes(Wa.name);return[[].concat($jscomp.arrayFromIterable(lb.Icon.textAttribute(gb?"square":"check-square")),["  "+Wa.name,{}]),function(){za.hiddenComponents=gb?lb.arr.without(za.hiddenComponents,Wa.name):[Wa.name].concat($jscomp.arrayFromIterable(za.hiddenComponents))}]})))],["Resize","static"===this.resizePolicy?[{command:"resize to fit window",target:this},{command:"resize manually",target:this},["switch to automatic resizing of world",function(){return za.resizePolicy=
"elastic"}]]:[["switch to manual resizing of world",function(){return za.resizePolicy="static"}]]],["Troubleshooting",[{command:"report a bug",target:this},{command:"clear storage and reload",target:this}]],{isDivider:!0},["Windows",[{command:"toggle minimize all windows",target:this},{command:"close all windows",target:this}]],{isDivider:!0},{command:"save world",target:this},{command:"load world",target:this}]}},{key:"openWorldMenu",value:function(za,Wa){var gb=this.env.eventDispatcher.eventState;
gb.menu&&gb.menu.remove();return gb.menu=Wa&&Wa.length?lb.Menu.openAtHand(Wa,{hand:za&&za.hand||this.firstHand}):null}},{key:"onPaste",value:function(za){var Wa=this,gb,ac,fc,xc,ed,kd,Qd,Ge,cf,ne,qf,pf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ff){switch(ff.nextAddress){case 1:ff.setCatchFinallyBlocks(2,3);ac=za.domEvt.clipboardData;if(!ac.types.includes("application/morphic")){ff.jumpTo(3);break}za.stop();fc=JSON.parse(ac.getData("application/morphic"));xc=[];Array.isArray(fc)||
(fc=[fc]);gb=lb.LoadingIndicator.open("pasting morphs...");ed=$jscomp.makeIterator(fc);kd=ed.next();case 6:if(kd.done){ff.jumpTo(8);break}Qd=kd.value;return ff.yield(lb.loadMorphFromSnapshot(Qd),9);case 9:Ge=ff.yieldResult;Ge.openInWorld(za.hand.position);Qd.copyMeta&&Qd.copyMeta.offset&&(cf=Qd.copyMeta.offset,ne=cf.x,qf=cf.y,Ge.moveBy(lb.pt(ne,qf)));xc.push(Ge);kd=ed.next();ff.jumpTo(6);break;case 8:Wa.showHaloFor(xc);case 3:ff.enterFinallyBlock();gb&&gb.remove();ff.leaveFinallyBlock(0);break;case 2:pf=
ff.enterCatchBlock(),Wa.showError(pf),ff.jumpTo(3)}})}},{key:"commands",get:function(){return lb.worldCommands.concat(vd._get(Object.getPrototypeOf(cb.prototype),"commands",this)).concat([{name:"open in prototype box",exec:function(za,Wa){var gb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ac){if(1==ac.nextAddress)return ac.yield(lb.loadPart("prototype box"),2);gb=ac.yieldResult;gb.wrapProto(Wa.target);ac.jumpToEnd()})}}])}},{key:"keybindings",get:function(){return vd._get(Object.getPrototypeOf(cb.prototype),
"keybindings",this).concat(lb.config.globalKeyBindings)}},{key:"keybindings",set:function(za){vd._set(Object.getPrototypeOf(cb.prototype),"keybindings",za,this)}},{key:"halos",value:function(){return this.submorphs.filter(function(za){return za.isHalo})}},{key:"haloForPointerId",value:function(za){return this.submorphs.find(function(Wa){return Wa.isHalo&&Wa.state&&Wa.state.pointerId===za})}},{key:"showHaloFor",value:function(za,Wa,gb){Wa=void 0===Wa?this.firstHand&&this.firstHand.pointerId:Wa;gb=
void 0===gb?!0:gb;if(lb.Halo)return za="function"===typeof za.createHalo?za.createHalo(lb.Halo,Wa):new lb.Halo({pointerId:Wa,target:za}),this.addMorph(za),gb&&za.focus(),za.alignWithTarget(),za}},{key:"showHaloForSelection",value:function(za,Wa){return 0<za.length&&this.showHaloFor(za,Wa)}},{key:"layoutHaloForPointerId",value:function(za){za=void 0===za?this.firstHand&&this.firstHand.pointerId:za;return this.submorphs.find(function(Wa){return Wa.isLayoutHalo&&Wa.state&&Wa.state.pointerId===za})}},
{key:"showLayoutHaloFor",value:function(za,Wa){Wa=void 0===Wa?this.firstHand&&this.firstHand.pointerId:Wa;var gb=za===this?null:za.owner===this?za:za.ownerChain().slice(-2)[0];gb=gb?this.submorphs.indexOf(gb)+1:this.submorphs.length;switch(za.layout.constructor){case lb.ProportionalLayout:var ac=new lb.ProportionalLayoutHalo({container:za,pointerId:Wa});break;case lb.HorizontalLayout:case lb.VerticalLayout:ac=new lb.FlexLayoutHalo({container:za,pointerId:Wa});break;case lb.GridLayout:ac=new lb.GridLayoutHalo({container:this.container,
pointerId:Wa})}return ac&&this.addMorphAt(ac,gb)}},{key:"highlightMorph",value:function(za,Wa,gb,ac){ac=void 0===ac?[]:ac;return lb.MorphHighlighter.for(za,Wa,void 0===gb?!1:gb,ac)}},{key:"removeHighlighters",value:function(za){return lb.MorphHighlighter.removeHighlighters(void 0===za?this:za)}},{key:"visibleStatusMessages",value:function(){return this.submorphs.filter(function(za){return za.isStatusMessage})}},{key:"visibleStatusMessagesFor",value:function(za){return this.submorphs.filter(function(Wa){return Wa.isStatusMessage&&
Wa.targetMorph===za})}},{key:"logErrorPreperation",value:function(za){var Wa=String(za),gb=za.stack||"";gb&&za.message!==za.stack&&(gb=String(gb),0===gb.indexOf(Wa)&&(gb=gb.slice(Wa.length)),Wa+="\n"+gb);return Wa}},{key:"logError",value:function(za){this.setStatusMessage(this.logErrorPreperation(za),lb.Color.red)}},{key:"showError",value:function(za){return this.logError(za)}},{key:"showErrorFor",value:function(za,Wa){return this.setStatusMessageFor(za,this.logErrorPreperation(Wa),lb.Color.red)}},
{key:"setStatusMessageFor",value:function(za,Wa,gb,ac,fc){ac=void 0===ac?5E3:ac;if(lb.StatusMessageForMorph){this.visibleStatusMessagesFor(za).forEach(function(xc){return xc.remove()});Wa=new lb.StatusMessageForMorph(Object.assign({message:Wa,color:gb},fc));this.openStatusMessage(Wa,ac);Wa.targetMorph=za;Wa.fadeIn(300);if(Wa.removeOnTargetMorphChange&&za.isText)lb.once(za,"selectionChange",Wa,"fadeOut",{converter:function(){return 200},garbageCollect:!0});return Wa}}},{key:"setStatusMessage",value:function(za,
Wa,gb,ac){gb=void 0===gb?5E3:gb;ac=void 0===ac?{}:ac;if(lb.StatusMessage)return console[Wa==lb.Color.red?"error":"log"](za),lb.config.verboseLogging?this.openStatusMessage(new lb.StatusMessage(Object.assign({message:za,color:Wa,hasFixedPosition:!0},ac)),gb):null}},{key:"openStatusMessage",value:function(za,Wa){this.addMorph(za);if(za.slidable){for(var gb=this.visibleStatusMessages(),ac=$jscomp.makeIterator(gb),fc=ac.next();!fc.done;fc=ac.next()){fc=fc.value;if(gb.length<=(lb.config.maxStatusMessages||
0))break;!fc.stayOpen&&fc.slidable&&(fc.remove(),lb.arr.remove(gb,fc))}lb.arr.without(gb,za).forEach(function(xc){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ed){!xc.isMaximized&&xc.slidable&&xc.slideTo(xc.position.addPt(lb.pt(0,-za.extent.y-10)));ed.jumpToEnd()})});gb=this.visibleBounds().bottomRight().addXY(-20,-20);za.align(za.bounds().bottomRight(),gb);za.topRight=gb.addPt(lb.pt(0,40));za.animate({bottomRight:gb,duration:500})}"number"===typeof Wa&&setTimeout(function(){return za.stayOpen||
za.fadeOut()},Wa);return za}},{key:"addProgressBar",value:function(za){za=void 0===za?{}:za;var Wa=this,gb,ac,fc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xc){if(1==xc.nextAddress)return gb=za,ac=void 0===gb.location?"center":gb.location,xc.yield(lb.loadObjectFromPartsbinFolder("progress bar"),2);fc=xc.yieldResult;Object.assign(fc,{progress:0},lb.obj.dissoc(za,["location"]));Wa.addMorph(fc);fc.align(fc[ac],Wa.visibleBounds()[ac]());return xc.return(fc)})}},{key:"withProgressBarDo",
value:function(za,Wa){var gb=this,ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fc){switch(fc.nextAddress){case 1:return fc.yield(gb.addProgressBar(Wa),2);case 2:return ac=fc.yieldResult,fc.setFinallyBlock(3),fc.yield(za(ac),5);case 5:return fc.return(fc.yieldResult);case 3:fc.enterFinallyBlock(),ac.remove(),fc.leaveFinallyBlock(0)}})}},{key:"openPrompt",value:function(za,Wa){Wa=void 0===Wa?{requester:null,animated:!1}:Wa;var gb=this,ac,fc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xc){ac=
gb.focusedMorph;fc=gb.visibleBounds();return xc.return(gb.withRequesterDo(Wa.requester,function(ed){return $jscomp.asyncExecutePromiseGeneratorProgram(function(kd){za.openInWorldNear(ed,gb);za.height>fc.height&&(za.height=fc.height-5);"function"===typeof Wa.customize&&Wa.customize(za);Wa.animated&&gb.previousPrompt&&gb.previousPrompt.world()&&gb.previousPrompt.transitionTo(za);gb.previousPrompt=za;return kd.return(lb.promise.finally(za.activate(Wa),function(){return ac&&ac.focus()}))})}))})}},{key:"withRequesterDo",
value:function(za,Wa){var gb=this,ac,fc,xc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ed){switch(ed.nextAddress){case 1:fc=gb.visibleBounds().center();if(!za){ed.jumpTo(2);break}fc=za.globalBounds().center();za.isWorld&&(fc=za.visibleBounds().center());if(!(ac=za.getWindow())){ed.jumpTo(2);break}return ed.yield(ac.toggleFader(!0),4);case 4:fc=ac.globalBounds().center();case 2:return ed.yield(Wa(fc),5);case 5:return xc=ed.yieldResult,ac&&ac.toggleFader(!1),ed.return(xc)}})}},{key:"inform",
value:function(za,Wa){Wa=void 0===Wa?{fontSize:16,requester:null,animated:!0}:Wa;return this.openPrompt(new lb.InformPrompt(Object.assign({label:void 0===za?"no message":za},Wa)),Wa)}},{key:"prompt",value:function(za,Wa){Wa=void 0===Wa?{requester:null,input:"",historyId:null,useLastInput:!1,selectInput:!1}:Wa;za=new lb.TextPrompt(Object.assign({label:za},Wa));Wa.forceConfirm&&za.get("cancel button").disable();return this.openPrompt(za,Wa)}},{key:"editPrompt",value:function(za,Wa){Wa=void 0===Wa?{requester:null,
input:"",historyId:null,useLastInput:!1,textStyle:null,mode:null,evalEnvironment:null}:Wa;return this.openPrompt(new lb.EditPrompt(Object.assign({label:za},Wa)),Wa)}},{key:"passwordPrompt",value:function(za,Wa){Wa=void 0===Wa?{requester:null,input:""}:Wa;return this.openPrompt(new lb.PasswordPrompt(Object.assign({label:za},Wa)),Wa)}},{key:"confirm",value:function(za,Wa){Wa=void 0===Wa?{requester:null,animated:!0}:Wa;return this.openPrompt(new lb.ConfirmPrompt(Object.assign({label:za},Wa)),Wa)}},{key:"multipleChoicePrompt",
value:function(za,Wa){Wa=void 0===Wa?{requester:null,animated:!0,choices:[]}:Wa;return this.openPrompt(new lb.MultipleChoicePrompt(Object.assign({label:za},Wa)),Wa)}},{key:"listPrompt",value:function(za,Wa,gb){za=void 0===za?"":za;Wa=void 0===Wa?[]:Wa;gb=void 0===gb?{requester:null,onSelection:null,preselect:0}:gb;return this.openPrompt(new lb.ListPrompt(Object.assign({filterable:!1,padding:lb.Rectangle.inset(3),label:za,items:Wa},gb)),gb)}},{key:"filterableListPrompt",value:function(za,Wa,gb){za=
void 0===za?"":za;Wa=void 0===Wa?[]:Wa;gb=void 0===gb?{requester:null,onSelection:null,preselect:0,multiSelect:!1,historyId:null,fuzzy:!1,actions:["default"],selectedAction:"default",theme:"dark"}:gb;return gb.prompt?(za=gb.prompt.get("list"),za.items=Wa,za.selectedIndex=gb.preselect||0,this.openPrompt(gb.prompt,gb)):this.openPrompt(new lb.ListPrompt(Object.assign({filterable:!0,padding:lb.Rectangle.inset(3),label:za,items:Wa},gb)),gb)}},{key:"editListPrompt",value:function(za,Wa,gb){Wa=void 0===
Wa?[]:Wa;gb=void 0===gb?{requester:null,multiSelect:!0,historyId:null}:gb;return this.openPrompt(new lb.EditListPrompt(Object.assign({label:void 0===za?"":za,multiSelect:!0,items:Wa,padding:lb.Rectangle.inset(3)},gb)),gb)}},{key:"showLoadingIndicatorFor",value:function(za,Wa){return this.addMorph(lb.LoadingIndicator.open(Wa,{center:za.globalBounds().center()}))}},{key:"defaultMenuItems",value:function(za,Wa){function gb(ne){var qf=this,pf=fc.morphsContainingPoint(ed.worldPoint(lb.pt(0,0)));pf.pop();
var ff=pf.indexOf(ed);pf=pf.slice(ff+1);return pf.map(function(vf){return[String(vf),ne.bind(qf,vf)]})}var ac=this,fc=this,xc=[],ed=za;this.reset&&"function"===typeof this.reset&&xc.push(["Reset",function(){ac.reset()}]);xc.push(["Open in...",[["Window",function(){ed.openInWindow()}]]]);xc.push(["Add morph to...",{getItems:gb.bind(ed,function(ne){return ne.addMorph(ed)})}]);xc.push(["Get halo on...",{getItems:gb.bind(ed,function(ne){return ne.world().showHaloFor(ne)})}]);ed.owner&&1<ed.owner.submorphs.length&&
xc.push(["Arrange morph",[["Bring to front",function(){return ed.owner.addMorph(ed)}],["Send to back",function(){return ed.owner.addMorphBack(ed)}],["Fit to submorphs",function(){var ne,qf,pf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ff){if(1==ff.nextAddress)return ff.yield(ed.world().prompt("Padding around submorphs:",{input:"Rectangle.inset(5)",historyId:"lively.morphic-fit-to-submorphs-padding-hist",requester:ed}),2);if(3!=ff.nextAddress)return ne=ff.yieldResult,"string"!==typeof ne?
ff.return():ff.yield(lb.runEval(ne,{topLevelVarRecorder:{Rectangle:lb.Rectangle}}),3);qf=ff.yieldResult;ne=(pf=qf.value)&&pf.isRectangle?pf:lb.Rectangle.inset(0);ed.undoStart("fitToSubmorphs");ed.fitToSubmorphs(ne);ed.undoStop("fitToSubmorphs");ff.jumpToEnd()})}]].concat($jscomp.arrayFromIterable(lb.PropertyPath("master.auto").get(ed)?[["Adjust to Master Component Submorph Hierarchy",function(){return ed.master.reconcileSubmorphs()}]]:[]))]);this.submorphs.length&&xc.push(["Select all submorphs",
function(){return ed.world().showHaloFor(ed.submorphs.slice())}]);var kd=[];ed.startSteppingScripts?kd.push(["Start stepping",function(){ed.startSteppingScripts()}]):kd.push(["Start stepping",function(){var ne,qf,pf,ff,vf,xg,dh,nh,Vg,qg,Hi,xj,Th,sg,eh,vh,wi,Ff,yj,Jc,Rd,Re,re,jg,$g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ih){switch(ih.nextAddress){case 1:return ne=[],qf=$jscomp,pf=qf.makeIterator,ih.yield(lb.completions.getCompletions(function(){return ed},""),2);case 2:ff=pf.call(qf,
ih.yieldResult.completions);for(vf=ff.next();!vf.done;vf=ff.next())for(xg=vf.value,dh=$jscomp.makeIterator(xg),nh=dh.next().value,Vg=dh.next().value,qg=$jscomp.makeIterator(Vg),Hi=qg.next();!Hi.done;Hi=qg.next())xj=Hi.value,xj.startsWith("_")||xj.startsWith("$")||(Th=$jscomp.makeIterator(xj.match(/^([^\(]+)\(?([^\)]+)?\)?$/)||[]),Th.next(),sg=Th.next().value,eh=Th.next().value,sg&&"function"===typeof ed[sg]&&ne.push({isListItem:!0,string:nh+" "+xj,value:{selector:sg,args:eh}}));return ih.yield($world.filterableListPrompt("Select method to start",
ne,{requester:ed,historyId:"lively.morphic-start-stepping-chooser"}),3);case 3:return vh=ih.yieldResult,wi=$jscomp.makeIterator(vh.selected),(Ff=wi.next().value)?ih.yield($world.prompt("Steptime in ms (how of the method will be called)?",{input:100}),4):ih.return();case 4:yj=ih.yieldResult;yj=Number(yj);if(isNaN(yj))return ih.return();Jc=[yj,Ff.selector];if(!Ff.args){ih.jumpTo(5);break}Rd={targetModule:"lively://lively.morphic-stepping-args/eval.js"};return ih.yield($world.editPrompt("Arguments to pass",
{input:"["+Ff.args+"]",mode:"js",evalEnvironment:Rd}),6);case 6:return Re=ih.yieldResult,ih.yield(lb.runEval(Re,Rd),7);case 7:re=ih.yieldResult;jg=re.value;if($g=re.isError)return $world.inform("Error evaluating the arguments: "+jg),ih.return();Array.isArray(jg)&&Jc.push.apply(Jc,$jscomp.arrayFromIterable(jg));case 5:ed.startStepping.apply(ed,$jscomp.arrayFromIterable(Jc)),ih.jumpToEnd()}})}]);0!=ed.tickingScripts.length&&kd.push(["Stop stepping",function(){return ed.stopStepping()}]);0!=kd.length&&
xc.push(["Stepping",kd]);xc.push(["Change Tooltip",function(){var ne;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qf){if(1==qf.nextAddress)return ne=ed,qf.yield(ed.world().prompt("Enter Tooltip",{placeholder:"Description",input:ed.tooltip||""}),2);ne.tooltip=qf.yieldResult;qf.jumpToEnd()})}]);var Qd=["Morphic properties",[]];xc.push(Qd);xc.push(["display serialization info",function(){var ne,qf,pf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ff){if(1==ff.nextAddress)return ff.yield(System.import("lively.serializer2/debugging.js"),
2);ne=ff.yieldResult;qf=ne.SnapshotInspector;pf=lb.serialize(ed);qf.forSnapshot(pf).openSummary();ff.jumpToEnd()})}]);xc.push(["display object report",function(){var ne,qf,pf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ff){if(1==ff.nextAddress)return ff.yield(System.import("lively.serializer2/debugging.js"),2);ne=ff.yieldResult;qf=ne.SnapshotInspector;pf=lb.serialize(ed);qf.forSnapshot(pf).openObjectReport();ff.jumpToEnd()})}]);var Ge=lb.Icon.textAttribute("check-square"),cf=lb.Icon.textAttribute("square");
Object.assign(Ge[1],{float:"none",display:"inline"});["grabbable","draggable","acceptsDrops","halosEnabled"].forEach(function(ne){return Qd[1].push([[].concat($jscomp.arrayFromIterable(za[ne]?Ge:cf),[" "+ne,{float:"none"}]),function(){return za[ne]=!za[ne]}])});xc.push(["export to HTML",function(){var ne,qf,pf,ff;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vf){if(1==vf.nextAddress)return vf.yield(System.import("lively.morphic/rendering/html-generator.js"),2);if(3!=vf.nextAddress)return ne=
vf.yieldResult,qf=ne.generateHTML,pf=lb.HTMLMorph,ff="exported-"+za.name,vf.yield(qf(za,null,{isFragment:!0,addStyles:!1}),3);(new pf({name:ff,html:vf.yieldResult})).openInWorld();vf.jumpToEnd()})}]);xc.push({isDivider:!0});xc.push(["Add comment",function(){var ne,qf,pf,ff;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vf){if(1==vf.nextAddress)return vf.yield($world.prompt("Enter comment"),2);if(4!=vf.nextAddress){ne=vf.yieldResult;if(!ne)return $world.setStatusMessage("Comment not saved",
"red"),vf.jumpTo(0);qf=lb.pt(0,0);Wa&&!Wa.halo&&(pf=ed.localize(Wa.position).x/ed.width,ff=ed.localize(Wa.position).y/ed.height,qf=lb.pt(pf,ff));return vf.yield(ed.addComment(ne,qf),4)}$world.setStatusMessage("Comment saved","green");vf.jumpToEnd()})}]);return xc}},{key:"defaultConnectionMenuItems",value:function(za){return za.attributeConnections&&za.attributeConnections.length?za.attributeConnections.map(function(Wa){return[String(Wa),[["show",function(){var gb,ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fc){if(1==
fc.nextAddress)return fc.yield(System.import("lively.ide/fabrik.js"),2);gb=fc.yieldResult;ac=gb.interactivelyShowConnection;ac(Wa);fc.jumpToEnd()})}],["edit",function(){var gb,ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fc){if(1==fc.nextAddress)return fc.yield(System.import("lively.ide/fabrik.js"),2);gb=fc.yieldResult;ac=gb.interactivelyReEvaluateConnection;ac(Wa);fc.jumpToEnd()})}],["disconnect",function(){Wa.disconnect();$world.setStatusMessage("disconnected "+Wa)}]]]}):null}},
{key:"defaultSourceDataBindings",value:function(za){var Wa=za.propertiesAndPropertySettings().properties,gb=lb.arr.groupByKey(Object.keys(Wa).map(function(fc){fc=Object.assign({name:fc},Wa[fc]);return fc.group&&fc.group.startsWith("_")?null:fc}).filter(Boolean),"group");za=["core","geometry","interaction","styling","layouting"];var ac=[];za.forEach(function(fc){return ac.push(gb[fc])});lb.arr.withoutAll(gb.keys(),za).forEach(function(fc){return ac.push(gb[fc])});return ac}},{key:"targetDataBindings",
value:function(za){for(var Wa=[],gb=za;gb!==Object.prototype;){var ac=gb===za?String(this):lb.getClassName(gb),fc=null,xc=lb.obj.getOwnPropertyDescriptors(gb),ed=Object.getPrototypeOf(gb),kd;for(kd in xc){var Qd=xc[kd].value;"function"!==typeof Qd||Qd===gb.constructor||kd.startsWith("$")||kd.startsWith("_")||(fc||(fc=[]),Qd=lb.fun.argumentNames(Qd),fc.push({group:ac+" methods",signature:kd+"("+Qd.join(", ")+")",name:kd}))}fc&&Wa.push(fc);gb=ed}return this.defaultSourceDataBindings(za).concat(Wa)}},
{key:"defaultConnectMenuItems",value:function(za,Wa){var gb=this,ac=this.defaultSourceDataBindings(Wa),fc=Wa.world();ac=ac.map(function(xc){return[xc[0].group||"uncategorized",xc.map(function(ed){return[ed.name,za?function(){return za(ed.name,Wa,ed)}:function(){var kd,Qd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ge){if(1==Ge.nextAddress)return Ge.yield(System.import("lively.ide/fabrik.js"),2);kd=Ge.yieldResult;Qd=kd.interactiveConnectGivenSource;Qd(Wa,ed.name);Ge.jumpToEnd()})}]})]});
fc&&ac.push(["custom...",za?function(){return za("custom...",Wa,null)}:function(){var xc,ed,kd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qd){if(1==Qd.nextAddress)return Qd.yield(System.import("lively.ide/fabrik.js"),2);if(3!=Qd.nextAddress)return xc=Qd.yieldResult,ed=xc.interactiveConnectGivenSource,Qd.yield(fc.prompt("Enter custom connection point",{requester:Wa,historyId:"lively.morphic-custom-connection-points",useLastInput:!0}),3);(kd=Qd.yieldResult)&&ed(gb,kd);Qd.jumpToEnd()})}]);
return ac}},{key:"updateVisibleWindowMorphs",value:function(){var za=this;vd._get(Object.getPrototypeOf(cb.prototype),"updateVisibleWindowMorphs",this).call(this);this.halos().forEach(function(Wa){Wa.maskBounds=za.visibleBounds()})}},{key:"handleHaloCycle",value:function(za){var Wa=za.state.clickedOnMorph,gb=za.isCommandKey(),ac=za.isShiftDown(),fc;gb&&!Wa.isHalo&&(gb=fc=za.world.morphsContainingPoint(za.position),fc=fc.filter(function(xc){return xc.halosEnabled}),gb=gb.filter(function(xc){return xc.halosEnabled}),
fc=gb[0]||fc[0]);ac&&!Wa.isHaloItem&&fc&&za.halo&&za.halo.borderBox!=fc?za.halo.addMorphToSelection(fc):(Wa=za.halo&&!za.targetMorphs.find(function(xc){return xc.isHaloItem||xc.keepHalo&&xc.keepHalo(za)}),ac=za.layoutHalo&&!za.targetMorphs.find(function(xc){return xc.isHaloItem}),gb=(!za.halo||Wa)&&fc,ac&&za.layoutHalo.remove(),Wa&&za.halo.remove(),gb&&(za.stop(),this.showHaloFor(fc,za.domEvt.pointerId)))}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"LivelyWorld"}},{key:"properties",
get:function(){return{localComponents:{initialize:function(){var za=this;this.whenRendered().then(function(){za.localComponents?za.localComponents.forEach(function(Wa){var gb,ac,fc,xc,ed,kd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qd){switch(Qd.nextAddress){case 1:if(Wa.owner){Qd.jumpTo(0);break}gb=Wa.withAllSubmorphsSelect(function(Ge){return Ge.master&&!Ge.master._appliedMaster});ac=$jscomp.makeIterator(gb);fc=ac.next();case 3:if(fc.done){Qd.jumpTo(5);break}xc=fc.value;return Qd.yield(xc.master.applyIfNeeded(!0),
4);case 4:fc=ac.next();Qd.jumpTo(3);break;case 5:ed=za.withAllSubmorphsSelect(function(Ge){return Ge.master&&Ge.master.uses(Wa)}),kd=za.localComponents.filter(function(Ge){return Ge.master&&Ge.master.uses(Wa)}),ed.forEach(function(Ge){Ge.requestMasterStyling()}),kd.forEach(function(Ge){return Ge.master.applyIfNeeded(!0)}),Qd.jumpToEnd()}})}):za.localComponents=za.withAllSubmorphsSelect(function(Wa){return Wa.isComponent})})}},name:{set:function(za){this.setProperty("name",za);document.title="lively.next - "+
za}},hiddenComponents:{initialize:function(){this.hiddenComponents=[]}},fill:{defaultValue:lb.Color.rgb(81,90,90)},draggable:{readOnly:!0,get:function(){return!lb.touchInputDevice}},commentBrowser:{}}}}],ba,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:1664,end:42744})}(lb.World));lb.LivelyWorld=
si;lb.LivelyWorld=si;lb.LivelyWorld=si;si=$a("SelectionElement",function(qa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),cb=ba.hasOwnProperty("SelectionElement")&&"function"===typeof ba.SelectionElement?ba.SelectionElement:ba.SelectionElement=function(za){za&&za[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return vd(cb,qa,void 0,[{key:Symbol.for("__LivelyClassName__"),get:function(){return"SelectionElement"}},{key:"properties",
get:function(){return{borderColor:{defaultValue:lb.Color.red},borderWidth:{defaultValue:1},fill:{defaultValue:lb.Color.transparent},epiMorph:{defaultValue:!0},isSelectionElement:{readOnly:!0,get:function(){return!0}}}}}],ba,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:42753,end:43115})}(lb.Morph));
lb.SelectionElement=si;lb.SelectionElement=si;lb.SelectionElement=si;si=$a("Selection",function(qa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),cb=ba.hasOwnProperty("Selection")&&"function"===typeof ba.Selection?ba.Selection:ba.Selection=function(za){za&&za[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return vd(cb,qa,void 0,[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Selection"}},{key:"properties",
get:function(){return{fill:{defaultValue:lb.Color.gray.withA(.2)},borderWidth:{defaultValue:2},borderColor:{defaultValue:lb.Color.gray},isSelectionElement:{readOnly:!0,get:function(){return!0}}}}}],ba,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:43124,end:43444})}(lb.Morph));lb.Selection=si;
lb.Selection=si;lb.Selection=si}}});