System.register(["./__root_module__-06ff41f6.js","kld-intersections"],function(Ca){var Bb,Kb,lc,bc,Td,Xc,Wd,$c,Pc,md,ge,Qe,kf,ke,cc;return{setters:[function(Jc){Bb=Jc.a7;Kb=Jc.P;lc=Jc.a6;bc=Jc.p;Td=Jc.bF;Xc=Jc.B;Wd=Jc.bG;$c=Jc.r;Pc=Jc.aU;md=Jc.bH;ge=Jc.bI;Qe=Jc.bJ;kf=Jc.bK;ke=Jc.bL;cc=Jc.l},function(){}],execute:function(){function Jc(yc,Gc,Qb,Ec){Ec=void 0===Ec?{}:Ec;Ec=Ec.package||ec.ObjectPackage.lookupPackageForObject(yc,Ec);if(!Ec)throw Error("Object is not part of an object package: "+yc);
return Ec.addScript(yc,Gc,Qb)}function Nd(yc,Gc){Gc=ec.normalizeOptions(Gc).System;yc=(yc=yc[Symbol.for("lively-module-meta")])?yc.package.name:null;return(Gc=(yc?ec.lookupPackage(Gc,yc):{}).pkg)?!!ec.ObjectPackage.forSystemPackage(Gc):!1}Ca({addScript:Jc,isObjectClass:Nd});var ec=lively.FreezerRuntime.recorderFor("lively.classes/object-classes.js");ec.normalizeOptions=function(yc){yc=Object.assign({baseURL:ec.defaultBaseURL,System:System},yc);yc.baseURL=yc.baseURL.replace(/\/$/,"");return yc};ec.addScript=
Jc;ec.isObjectClass=Nd;ec.string=Bb;ec.Path=Kb;ec.arr=lc;ec.parse=bc;ec.isValidIdentifier=Td;ec.stringify=Xc;ec.parseFunction=Wd;ec.resource=$c;ec.runEval=Pc;ec.scripting=md;ec.ExportLookup=ge;var Zd=ec.scripting;ec.ensurePackage=Zd.ensurePackage;ec.registerPackage=Zd.registerPackage;ec.importPackage=Zd.importPackage;ec.lookupPackage=Zd.lookupPackage;ec.module=Zd.module;ec.ImportInjector=Zd.ImportInjector;ec.RuntimeSourceDescriptor=Qe;ec.toJsIdentifier=kf;ec.adoptObject=ke;ec.classToFunctionTransform=
cc;ec.objectPackageSym=Symbol.for("lively-object-package-data");ec.defaultBaseURL="local://lively-object-modules";ec.globalClasses=Object.keys(System.global).map(function(yc){yc=System.global[yc];return"function"===typeof yc&&yc.name&&yc}).filter(Boolean);ec.addScript=Jc;ec.addScript=Jc;ec.isObjectClass=Nd;ec.isObjectClass=Nd;ec._packageStore=ec._packageStore||{};Zd=function(yc,Gc){this._id=yc;this.options=ec.normalizeOptions(Gc)};Zd.lookupPackageForObject=function(yc,Gc){return this.lookupPackageForClass(yc.constructor,
Gc)};Zd.lookupPackageForClass=function(yc,Gc){Gc=ec.normalizeOptions(Gc).System;yc=(yc=yc[Symbol.for("lively-module-meta")])?yc.package.name:null;return(Gc=(yc?ec.lookupPackage(Gc,yc):{}).pkg)?ec.ObjectPackage.forSystemPackage(Gc):null};Zd.forSystemPackage=function(yc){return this.packageStore[yc.name]};Zd.withId=function(yc,Gc){return this.packageStore[yc]||(this.packageStore[yc]=new this(yc,Gc))};Zd.prototype.ensureSubModule=function(yc){yc=void 0===yc?"index":yc;var Gc=this,Qb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ec){return 1==
Ec.nextAddress?(Qb=new ec.ObjectModule(yc,Gc),Ec.yield(Qb.ensureExistance(),2)):Ec.return(Qb)})};Zd.prototype.resource=function(yc){yc=void 0===yc?"":yc;return ec.resource(this.packageURL).join(yc)};Zd.prototype.load=function(){return ec.importPackage(this.System,this.packageURL)};Zd.prototype.ensureExistance=function(){var yc=this,Gc,Qb,Ec,dd,Hd,Ld,uc,rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gb){switch(Gb.nextAddress){case 1:return Gc=yc.resource("/"),Gb.yield(Gc.exists(),2);
case 2:if(Gb.yieldResult)return Gb.return();Qb=[{resource:Gc}];Ec=[{resource:yc.resource("package.json"),content:JSON.stringify(yc.config,null,2)}];return Gb.yield(Promise.all(Qb.map(function(Oa){return Oa.resource.mkdir()})),3);case 3:return Gb.yield(Promise.all(Ec.map(function(Oa){var ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){switch(Qa.nextAddress){case 1:return Qa.yield(Oa.resource.exists(),2);case 2:if(!(ab=!Qa.yieldResult)){Qa.jumpTo(3);break}return Qa.yield(Oa.resource.write(Oa.content),
4);case 4:ab=Qa.yieldResult;case 3:return Qa.return(ab)}})})),4);case 4:return Gb.yield(yc.objectModule.ensureExistance(),5);case 5:return dd=yc,Hd=dd.System,Ld=dd.packageURL,uc=dd.config,Gb.yield(ec.ensurePackage(Hd,Ld),6);case 6:return rb=Gb.yieldResult,rb.registerWithConfig(uc),console.log(yc.packageURL+" REGISTERED"),Gb.return(yc)}})};Zd.prototype.ensureObjectClass=function(yc){var Gc=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qb){return 1==Qb.nextAddress?Qb.yield(Gc.ensureExistance(),
2):Qb.return(Gc.objectModule.ensureObjectClass(yc))})};Zd.prototype.adoptObject=function(yc){var Gc=this,Qb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ec){if(1==Ec.nextAddress)return Gc.objectClass===yc.constructor?Ec.return():Ec.yield(Gc.ensureObjectClass(yc.constructor),2);Qb=Ec.yieldResult;ec.adoptObject(yc,Qb);Ec.jumpToEnd()})};Zd.prototype.addScript=function(yc,Gc,Qb){return this.objectModule.addScript(yc,Gc,Qb)};Zd.prototype.remove=function(){this.systemPackage.remove();delete ec.ObjectPackage.packageStore[this.id];
return this.resource().remove()};Zd.prototype.renameObjectClass=function(yc,Gc){Gc=void 0===Gc?[]:Gc;var Qb=this,Ec,dd,Hd,Ld,uc,rb,Gb,Oa,ab,Qa,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){if(1==eb.nextAddress){Ec=Qb;dd=Ec.objectClass;Hd=Ec.System;if(!dd||dd[Symbol.for("__LivelyClassName__")]===yc)return eb.return(dd);if(!ec.isValidIdentifier(yc))throw Error(yc+" is not a valid name for a class");uc=Ld=ec.RuntimeSourceDescriptor.for(dd,Hd);rb=uc.source;Gb=uc.ast;Oa=Gb.id;ab=Oa.start;
Qa=Oa.end;return eb.yield(Ld.changeSource(rb.slice(0,ab)+yc+rb.slice(Qa)),2)}Ja=Qb.objectClass;Gc.forEach(function(Sb){Sb.constructor=Ja;Sb.__proto__=Ja.prototype});return eb.return(Ja)})};Zd.prototype.fork=function(yc,Gc){var Qb=this,Ec,dd,Hd,Ld,uc,rb,Gb,Oa,ab,Qa,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){switch(eb.nextAddress){case 1:return Ec=Qb,dd=Ec.System,Hd=Ec.baseURL,Ld=Ec.objectClass,Gc=Object.assign({System:dd,baseURL:Hd},Gc),uc=ec.RuntimeSourceDescriptor.for(Ld),
rb=uc._renamedSource(yc),Gb=rb.moduleSource,Oa=ec.ObjectPackage.withId(yc,Gc),eb.yield(Oa.ensureExistance(),2);case 2:return ab=Oa,Qa=ab.objectModule,Ja=Qa.systemModule,eb.yield(Ja.load({format:"esm"}),3);case 3:return eb.yield(Ja.changeSource(Gb),4);case 4:return eb.return(Oa)}})};$jscomp.global.Object.defineProperties(Zd.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return this._id}},name:{configurable:!0,enumerable:!0,get:function(){return this.id}},System:{configurable:!0,enumerable:!0,
get:function(){return this.options.System}},baseURL:{configurable:!0,enumerable:!0,get:function(){return this.options.baseURL}},packageURL:{configurable:!0,enumerable:!0,get:function(){return this.baseURL+("/"+this.id)}},config:{configurable:!0,enumerable:!0,get:function(){return{name:this.name,version:"0.1.0",lively:{isObjectPackage:!0}}}},systemPackage:{configurable:!0,enumerable:!0,get:function(){return ec.lookupPackage(this.System,this.packageURL,!0).pkg}},objectModule:{configurable:!0,enumerable:!0,
get:function(){return this._objectModule||(this._objectModule=new ec.ObjectModule("index.js",this))}},objectClass:{configurable:!0,enumerable:!0,get:function(){return this.objectModule.objectClass}}});$jscomp.global.Object.defineProperties(Zd,{packageStore:{configurable:!0,enumerable:!0,get:function(){return this._packageStore||(this._packageStore=ec._packageStore)}}});Ca("default",Zd);ec.ObjectPackage=Zd;var le=function(yc,Gc){if(!yc)throw Error("ObjectModule needs package!");if(!Gc)throw Error("ObjectModule needs package!");
this._moduleName=yc;this._objectPackage=Gc};le.prototype.read=function(){return this.resource.read()};le.prototype.write=function(yc){return this.resource.write(yc)};le.prototype.ensureExistance=function(){var yc=this,Gc,Qb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ec){switch(Ec.nextAddress){case 1:return Gc=yc.resource,Ec.yield(Gc.exists(),2);case 2:if(Ec.yieldResult){Ec.jumpTo(3);break}return Ec.yield(Gc.write("'format esm';\n"),4);case 4:Qb={},yc.System.config({meta:(Qb[yc.url]=
{format:"esm"},Qb)});case 3:return Ec.return(yc)}})};le.prototype.adoptObject=function(yc){var Gc=this,Qb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ec){if(1==Ec.nextAddress)return Gc.objectClass===yc.constructor?Ec.return():Ec.yield(Gc.ensureObjectClass(yc.constructor),2);Qb=Ec.yieldResult;ec.adoptObject(yc,Qb);Ec.jumpToEnd()})};le.prototype.ensureObjectClass=function(yc){var Gc=this,Qb=this.objectClass;return Qb&&Qb.prototype.__proto__===yc.prototype?Qb:Promise.resolve(this.ensureObjectClassSource(yc)).then(function(Ec){var dd=
Ec.source,Hd=Ec.moduleId,Ld=Ec.className,uc=Ec.bindings,rb=Gc.System;Ec=ec.module(rb,Hd);if(uc)for(var Gb in uc)Ec.define(Gb,uc[Gb]);dd=ec.runEval(dd,{classTransform:ec.classToFunctionTransform,sync:!0,targetModule:Hd,System:rb});if(dd.isError)throw dd.value;dd=Ec.recorder[Ld];if(!dd)throw Error("Failed to define class "+Ld+" in "+Hd);return dd})};le.prototype.ensureObjectClassSource=function(yc){return this.createDefaultClassDeclaration(yc)};le.prototype.createDefaultClassDeclaration=function(yc){yc=
void 0===yc?Object:yc;var Gc=this,Qb,Ec,dd,Hd,Ld,uc,rb,Gb,Oa,ab,Qa,Ja,eb,Sb,Ac,sb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ab){switch(Ab.nextAddress){case 1:Qb=Gc;Ec=Qb.System;dd=Qb.systemModule;Hd=Qb.objectPackage;Ld=ec.string.capitalize(ec.toJsIdentifier(Hd.id));uc=yc[Symbol.for("__LivelyClassName__")];rb=!uc;Gb=ec.globalClasses.includes(yc);Oa="";ab=null;if(rb){uc="__anonymous_superclass__";Qa={};ab=(Qa[uc]=yc,Qa);Ab.jumpTo(2);break}if(Gb){Ab.jumpTo(2);break}return Ab.yield(ec.ExportLookup.findExportOfValue(yc,
Ec),4);case 4:(Ja=Ab.yieldResult)?(eb=ec.ImportInjector.run(Ec,dd.id,dd.package(),"",Ja),Sb=eb.standaloneImport,Oa+=Sb+"\n\n"):(Ac={},ab=(Ac[uc]=yc,Ac));case 2:return Ld===uc&&(Ld="Object"+Ld),sb="Object"===uc?"class "+Ld+" {}\n":"class "+Ld+" extends "+uc+" {}\n",Oa+="export default "+sb+"\n",Ab.yield(dd.changeSource(Oa),5);case 5:return Ab.yield(dd.load(),6);case 6:return Ab.return({source:Oa,className:Ld,moduleId:Gc.url,bindings:ab})}})};le.prototype.addScript=function(yc,Gc,Qb){var Ec=this,dd,
Hd,Ld,uc,rb,Gb,Oa,ab,Qa,Ja,eb,Sb,Ac,sb,Ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){switch(vb.nextAddress){case 1:if(yc.constructor===Ec.objectClass){dd=yc.constructor;vb.jumpTo(2);break}return vb.yield(Ec.ensureObjectClass(yc.constructor),3);case 3:dd=vb.yieldResult;case 2:Hd=dd;Ld="function"===typeof Gc?String(Gc):Gc;uc=ec.parseFunction(Ld);rb=ec.RuntimeSourceDescriptor.for(Hd,Ec.System);Qb||(Qb=ec.Path("id.name").get(uc));if(!Qb)throw Error("No name, cannot add "+ec.string.truncate(Ld,
30).replace(/\n/g,"")+"!");Gb=ec.toJsIdentifier(Qb);console.assert("FunctionExpression"===uc.type||"ArrowFunctionExpression"===uc.type,"not a function expression but: "+uc.type);Oa=uc.params.map(function(ha){return Ld.slice(ha.start,ha.end)});ab="BlockStatement"===uc.body.type?Ld.slice(uc.body.start,uc.body.end):"{ return "+Ld.slice(uc.body.start,uc.body.end)+" }";Qa=Gb+"("+Oa.join(",")+") "+ab;"ArrowFunctionExpression"===uc.type&&(uc.type="FunctionExpression");Ja=rb.source;eb=rb.ast;if(!eb)throw Error("cannot find class decl of "+
rb.module.id);(Sb=eb.body.body.find(function(ha){return ha.key.name===Gb&&!ha.static}))?Ja=Ja.slice(0,Sb.start)+Qa+Ja.slice(Sb.end):(Ac=Ja.lastIndexOf("}"),sb=Ja.slice(0,Ac),Ab=Ja.slice(Ac),/\n\s*$/m.test(sb)||(sb+="\n"),Qa=ec.string.changeIndent(Qa,"  ",1),/^[ ]*\n/m.test(Ab)||(Ab="\n"+Ab),Ja=sb+Qa+Ab);return vb.yield(rb.changeSource(Ja),4);case 4:return vb.return({script:Hd.prototype[Gb],klass:Hd,module:rb.module.id,methodName:Gb})}})};$jscomp.global.Object.defineProperties(le.prototype,{objectPackage:{configurable:!0,
enumerable:!0,get:function(){return this._objectPackage}},objectClass:{configurable:!0,enumerable:!0,get:function(){var yc=this.systemModule;return yc.isLoaded()?yc.System.get(yc.id).default:null}},moduleName:{configurable:!0,enumerable:!0,get:function(){return this._moduleName}},systemModule:{configurable:!0,enumerable:!0,get:function(){return ec.module(this.System,this.url)}},System:{configurable:!0,enumerable:!0,get:function(){return this.objectPackage.System}},resource:{configurable:!0,enumerable:!0,
get:function(){return this.objectPackage.resource(this.moduleName)}},url:{configurable:!0,enumerable:!0,get:function(){return this.resource.url}}});ec.ObjectModule=le;ec.default=Zd}}});