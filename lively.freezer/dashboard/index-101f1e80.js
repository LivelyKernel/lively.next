System.register(["./__root_module__-cd530690.js","kld-intersections"],function(Da){var zb,Rb,kc,dc,ke,hd,$d,md,Qc,xd,Od,ge,Ud;return{setters:[function(nd){zb=nd.bu;Rb=nd.a5;kc=nd.r;dc=nd.a6;ke=nd.bo;hd=nd.bv;$d=nd.bw;md=nd.T;Qc=nd.s;xd=nd.bx;Od=nd.by;ge=nd.n;Ud=nd.bz},function(){}],execute:function(){function nd(Q){try{var fa=eval("("+Ja.ast.transform.wrapInFunction("var _; _ = ("+Q+")")+")()")}catch(Ha){return JSON.parse(Q)}return"object"!==typeof fa?null:fa}function Za(Q,fa){var Ha,Qa,fc,Nb,
ab,lc,rd,Bd,ad;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xa){switch(Xa.nextAddress){case 1:return Ha=fa.world(),Xa.yield(Ha.prompt("Enter package name",{requester:fa,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:Qa=Xa.yieldResult;if(!Qa)throw"Canceled";Xa.setCatchFinallyBlocks(3);Nb=Ra.resource(Qa);Qa=Nb.name();fc=Nb.url;Xa.leaveTryBlock(4);break;case 3:return Xa.enterCatchBlock(),Xa.yield(Q.getConfig(),5);case 5:return ab=Xa.yieldResult.baseURL,
lc=Ra.resource(ab).join(Qa).asDirectory().url,Xa.yield(Q.normalize(lc),6);case 6:fc=Xa.yieldResult.replace(/\/\.js$/,"/");case 4:return Xa.yield(Ha.prompt("Confirm or change package location",{requester:fa,input:fc,historyId:"lively.vm-editor-add-package-address"}),7);case 7:rd=Xa.yieldResult;if(!rd)throw"Canceled";Bd=Ra.resource(rd).asDirectory();ad=Bd.asFile().url;return Xa.yield(Q.removePackage(ad),8);case 8:return Xa.yield(Q.resourceCreateFiles(ad,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+
Qa+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+Qa+"\n\nNo description for package "+Qa+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+Qa+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return Xa.return(Ra.loadPackage(Q,{name:Qa,address:ad,configFile:Bd.join("package.json").url,main:Bd.join("index.js").url,test:Bd.join("tests/test.js").url,type:"package"}))}})}function Cb(Q,fa,Ha){Ha=void 0===Ha?
null:Ha;var Qa,fc,Nb,ab,lc,rd,Bd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ad){switch(ad.nextAddress){case 1:return Qa={name:"",address:"",type:"package"},ad.yield(Q.getConfig(),2);case 2:fc=ad.yieldResult;if(!Ha){ad.jumpTo(3);break}return ad.yield(Q.getPackage(Ha),4);case 4:if(Nb=ad.yieldResult){ad.jumpTo(5);break}return ad.yield(Q.getPackageForModule(Ha),6);case 6:Nb=ad.yieldResult;case 5:ab=Nb;case 3:return ad.yield(fa.world().prompt("What is the package directory?",{requester:fa,
input:ab?ab.address:fc.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:lc=ad.yieldResult;if(!lc)throw"Canceled";Qa.address=lc.replace(/\/$/,"");Qa.url=new URL(Qa.address+"/");Qa.configFile=Ra.resource(Qa.url).join("package.json").url;ad.setCatchFinallyBlocks(8);rd=JSON;Bd=rd.parse;return ad.yield(Q.moduleRead(Qa.configFile),10);case 10:Bd.call(rd,ad.yieldResult).name;ad.leaveTryBlock(9);break;case 8:ad.enterCatchBlock(),Qa.name=String(Qa.url).replace(/\/$/,""),
Q.resourceEnsureExistance(Qa.configFile,'{\n  "name": "'+Qa.name+'",\n  "version": "0.1.0"\n}');case 9:return ad.return(Ra.loadPackage(Q,Qa))}})}function bc(Q,fa,Ha){var Qa,fc,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){switch(ab.nextAddress){case 1:return Qa=Ra.resource(Ha).asFile().url,ab.yield(Q.getPackage(Qa),2);case 2:if(fc=ab.yieldResult){ab.jumpTo(3);break}return ab.yield(Q.getPackageForModule(Qa),4);case 4:fc=ab.yieldResult;case 3:Nb=fc;if(!Nb)throw Error("Cannot find package for "+
Qa);return ab.yield(Q.reloadPackage(Qa),5);case 5:if(!fa){ab.jumpTo(0);break}return ab.yield(fa.updateModuleList(),7);case 7:return ab.yield(fa.uiSelect(Qa,!1),8);case 8:return ab.return(ab.yieldResult)}})}function ic(Q,fa,Ha,Qa){var fc,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){switch(ab.nextAddress){case 1:return ab.yield(Q.getPackage(Ha),2);case 2:return fc=ab.yieldResult,ab.yield((Qa||$world).confirm("Unload package "+fc.name+"?",{requester:fa}),3);case 3:Nb=ab.yieldResult;
if(!Nb)throw"Canceled";return ab.yield(Q.removePackage(Ha),4);case 4:if(!fa){ab.jumpTo(0);break}return ab.yield(fa.updateModuleList(),6);case 6:return ab.yield(fa.uiSelect(null),0)}})}function id(Q,fa,Ha){var Qa,fc,Nb,ab,lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rd){switch(rd.nextAddress){case 1:return Qa=fa.world(),rd.yield(Q.getPackage(Ha),2);case 2:return fc=rd.yieldResult,fc?rd.yield(Qa.confirm("Really remove package "+fc.name+"?",{requester:fa}),3):($world.inform('No package "'+
Ha+'" found!',{requester:fa}),rd.return());case 3:Nb=rd.yieldResult;if(!Nb)throw"Canceled";Q.removePackage(Ha);return rd.yield(Qa.confirm("Also remove directory "+fc.name+" including "+fc.modules.length+" modules?"),4);case 4:ab=rd.yieldResult;if(!ab){rd.jumpTo(0);break}return rd.yield(Qa.confirm("REALLY *remove* directory "+fc.name+"? No undo possible..."),6);case 6:if(lc=rd.yieldResult)return rd.yield(Q.resourceRemove(fc.address),0);rd.jumpTo(0)}})}function fe(Q,fa,Ha){Ha=void 0===Ha?$world:Ha;
var Qa,fc,Nb,ab,lc,rd,Bd,ad,Xa,Rc,pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){switch(eb.nextAddress){case 1:return eb.yield(Q.getPackage(fa),2);case 2:Qa=eb.yieldResult;if(!Qa)throw Error("Cannot find package "+fa);fc=[];Nb=$jscomp.makeIterator(Qa.modules);ab=Nb.next();case 3:if(ab.done)return eb.yield(Ha.execCommand("open text window",{title:"imports and exports of "+fa,content:fc.join("\n\n")}),0);lc=ab.value;if(!lc.name.match(/\.js$/)){eb.jumpTo(4);break}eb.setCatchFinallyBlocks(6);
rd=Q;Bd=rd.importsAndExportsOf;ad=lc.name;return eb.yield(Q.moduleRead(lc.name),9);case 9:return eb.yield(Bd.call(rd,ad,eb.yieldResult),8);case 8:Xa=eb.yieldResult;eb.leaveTryBlock(7);break;case 6:Rc=eb.enterCatchBlock();Ha.logError(Error("Error when getting imports/exports from module "+lc.name+":\n"+Rc.stack));eb.jumpTo(4);break;case 7:pb=""+lc.name;if(!Xa.imports.length&&!Xa.exports.length){pb+="\n  does not import / export anything";eb.jumpTo(4);break}Xa.imports.length&&(pb+="\n  imports:\n",
pb+=Ra.arr.groupByKey(Xa.imports,"fromModule").mapGroups(function(hb,ac){return"from "+hb+": "+ac.map(function(Wb){return Wb.local||Wb.imported?Wb.imported&&Wb.imported!==Wb.local?Wb.imported+" as "+Wb.local:Wb.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(hb){return"    "+hb}).join("\n"));Xa.exports.length&&(pb+="\n  exports:\n",pb+=Xa.exports.map(function(hb){return hb.local?hb.local&&hb.local!==hb.exported?hb.local+" as "+hb.exported:hb.exported:hb.exported+
" from "+hb.fromModule}).join(", ").split("\n").map(function(hb){return"    "+hb}).join("\n"));fc.push(pb);case 4:ab=Nb.next(),eb.jumpTo(3)}})}function Zb(Q,fa,Ha){Ha=Ha&&Ha.address;if(Ha&&0===fa.indexOf(Ha))var Qa=fa.slice(Ha.length).replace(/^\//,"");else a:{Ha=Q.getConfig();if(!Ha||Ha.constructor!==Promise)try{Qa=String((new URL(fa)).relativePathFrom(new URL(Q.getConfig().baseURL)));break a}catch(fc){}Qa=fa}return Qa}function rc(Q,fa,Ha,Qa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fc){return 1==
fc.nextAddress?(Qa=Object.assign({targetModule:fa},Qa),fc.yield(Q.normalize(fa),2)):3!=fc.nextAddress?(fa=fc.yieldResult,fc.yield(Q.moduleSourceChange(fa,Ha,Qa),3)):fc.return(fa)})}function Lb(Q,fa,Ha,Qa,fc){Qa=void 0===Qa?!1:Qa;fc=void 0===fc?!1:fc;var Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){switch(ab.nextAddress){case 1:return fa&&fa.setStatusMessage("Reloading "+Ha),ab.setCatchFinallyBlocks(2),ab.yield(Q.reloadModule(Ha,{reloadDeps:Qa,resetEnv:fc}),4);case 4:if(!fa){ab.jumpTo(5);
break}return ab.yield(fa.updateModuleList(),6);case 6:case 5:fa&&fa.setStatusMessage("Reloded "+Ha);ab.leaveTryBlock(0);break;case 2:Nb=ab.enterCatchBlock();ab.setCatchFinallyBlocks(7);if(!fa){ab.jumpTo(9);break}return ab.yield(fa.updateEditorWithSourceOf(Ha),10);case 10:case 9:ab.leaveTryBlock(8);break;case 7:ab.enterCatchBlock();case 8:throw fa&&fa.showError(Nb),Nb;}})}function Gc(Q,fa,Ha){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){switch(Qa.nextAddress){case 1:return Qa.yield(Q.forgetModule(Ha,
{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!fa){Qa.jumpTo(3);break}return Qa.yield(fa.updateModuleList(),4);case 4:case 3:Qa.jumpToEnd()}})}function $c(Q,fa,Ha){var Qa,fc,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){switch(ab.nextAddress){case 1:return ab.yield(Q.normalize(Ha),2);case 2:return Qa=ab.yieldResult,ab.yield(fa.world().confirm("Remove file "+Qa+"?",{requester:fa}),3);case 3:fc=ab.yieldResult;if(!fc)throw"Canceled";return ab.yield(Q.forgetModule(Qa),4);case 4:return ab.yield(Q.resourceRemove(Qa),
5);case 5:return ab.yield(Q.getPackageForModule(Qa),6);case 6:return Nb=ab.yieldResult,ab.return(Nb)}})}function ed(Q,fa,Ha){var Qa,fc,Nb,ab,lc,rd,Bd,ad;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xa){switch(Xa.nextAddress){case 1:return Qa=URL,Xa.yield(Q.getConfig(),2);case 2:fc=new Qa(Xa.yieldResult.baseURL);Nb=fa.world();if(!Ha){Xa.jumpTo(3);break}return Xa.yield(Q.getPackage(Ha),4);case 4:if(ab=Xa.yieldResult){Xa.jumpTo(5);break}return Xa.yield(Q.getPackageForModule(Ha),6);case 6:ab=
Xa.yieldResult;case 5:(lc=ab)&&(fc=new URL(lc.address));case 3:return Xa.yield(ub._searchForExistingFiles(fa,String(fc),lc),7);case 7:rd=Xa.yieldResult;if(!rd.includes("[create new module]")){Xa.jumpTo(8);break}return Xa.yield(ub._askForModuleName(Q,Ha||String(fc),Nb),9);case 9:Bd=Xa.yieldResult,rd=[Bd];case 8:return Xa.yield(ub._createAndLoadModules(Q,rd),10);case 10:return ad=Xa.yieldResult,ub.arr.compact(ad.map(function(Rc){return Rc.error})),Xa.return(ad)}})}function $b(Q,fa){var Ha,Qa,fc,Nb,
ab,lc,rd,Bd,ad,Xa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rc){if(1==Rc.nextAddress)return Rc.yield(Q.getPackage(fa),2);if(3!=Rc.nextAddress){Ha=Rc.yieldResult;if(!Ha||!Ha.address.match(/^http/))throw Error("Cannot load package "+fa);Qa=ub.resource(Ha.address);fc=[];Nb=$jscomp;ab=Nb.makeIterator;return Rc.yield(Qa.dirList(5,{exclude:ub.modulesInPackage_defaultExclude}),3)}lc=ab.call(Nb,Rc.yieldResult);for(rd=lc.next();!rd.done;rd=lc.next())ad=Bd=rd.value,Xa=ad.url,Xa.match(/\.js$/)&&
Q.isModuleLoaded(Xa,!0)&&fc.push(Q.getModule(Xa));return Rc.return(fc)})}function ob(Q,fa){fa=void 0===fa?[]:fa;var Ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){if(1==Qa.nextAddress)return Qa.yield(System.import("mocha-es6/index.js"),2);Ha=Qa.yieldResult;return Qa.return(Ha.loadTestModuleAndExtractTestState(Q,fa))})}function zc(Q,fa,Ha,Qa){function fc(Rc){return new Promise(function(pb,eb){var hb=Mb.arr.compact(Rc.suite.suites).map(function(Wb){return Wb.file}),ac=Mb.chain(fa).filter(function(Wb){return hb.includes(Wb.file)}).pluck("tests").flatten().value();
if(!ac||!ac.length)return eb(Error("Trying to run tests of "+hb.join(", ")+" but cannot find them in loaded tests!"));Rc.reporter(function(Wb){Wb.on("test",function(Fd){try{var Be=ac.find(function(Ie){return Ie.fullTitle===Fd.fullTitle()});Be.state="running";"function"===typeof Ha&&Ha(Be,"test")}catch(Ie){"function"===typeof Qa&&Qa(Ie,"test")}});Wb.on("pass",function(Fd){try{var Be=ac.find(function(Ie){return Ie.fullTitle===Fd.fullTitle()});Be.state="succeeded";Be.duration=Fd.duration;"function"===
typeof Ha&&Ha(Be,"pass")}catch(Ie){"function"===typeof Qa&&Qa(Ie,"pass")}});Wb.on("fail",function(Fd,Be){try{var Ie=function(ue,Md,Vb){ue.state="failed";ue.duration=ue.duration;ue.error=Md},Lf=ac.find(function(ue){return ue.fullTitle===Fd.fullTitle()});if(Lf)Ie(Lf,Be,Fd.duration);else{var fd=Mb.arr.invoke(Fd.parent.tests,"fullTitle");ac.filter(function(ue){return fd.includes(ue.fullTitle)}).forEach(function(ue){return Ie(ue,Be,Fd.duration)})}"function"===typeof Ha&&Ha(Lf,"fail")}catch(ue){"function"===
typeof Qa&&Qa(ue,"fail")}})});Rc.run(function(Wb){return pb({testsByFile:fa,mocha:Rc})})})}var Nb,ab,lc,rd,Bd,ad,Xa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rc){switch(Rc.nextAddress){case 1:Nb=$jscomp.makeIterator(fa),ab=Nb.next();case 2:if(ab.done){Rc.jumpTo(4);break}rd=lc=ab.value;Bd=rd.file;return Rc.yield(Mb.loadMochaTestFile(Bd,fa),5);case 5:return ad=Rc.yieldResult,Xa=ad.mocha,Q&&(Xa=Xa.grep(Q)),Rc.yield(fc(Xa),3);case 3:ab=Nb.next();Rc.jumpTo(2);break;case 4:return Rc.return({mocha:Xa,
testsByFile:fa})}})}function Mc(Q){Q||(Q="local");if(Q.isSystemInterface)var fa=Q;else"string"===typeof Q&&Q.startsWith("l2l ")&&(Q={type:"l2l",id:Q.split(" ")[1]}),"string"!==typeof Q&&"l2l"===Q.type&&(fa=Xc.l2lInterfaceFor(Q.id,Q.info)),"string"!==typeof Q&&($world.setStatusMessage("Unknown system interface "+Q),Q="local"),fa||(fa=Q&&"local"!==Q?Xc.serverInterfaceFor(Q):Xc.localInterface);return fa}Da("systemInterfaceNamed",Mc);var Ja=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");
Ja.parseJsonLikeObj=nd;Ja.ast=zb;Ja.parseJsonLikeObj=nd;Ja.parseJsonLikeObj=nd;var Ra=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");Ra.loadPackage=function(Q,fa){var Ha,Qa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fc){switch(fc.nextAddress){case 1:return fc.yield(Q.importPackage(fa.address+"/"),2);case 2:if(!fa.main){fc.jumpTo(3);break}return fc.yield(Q.importModule(fa.main.toString()),3);case 3:if(!fa.test){fc.jumpTo(5);break}fc.setCatchFinallyBlocks(6);
return fc.yield(Q.importPackage("mocha-es6"),8);case 8:return Ha=fc.yieldResult,fc.yield(Ha.installSystemInstantiateHook(),9);case 9:return fc.yield(Q.importModule(fa.test.toString()),10);case 10:fc.leaveTryBlock(5);break;case 6:Qa=fc.enterCatchBlock(),console.warn("Cannot load test of new package: "+Qa);case 5:return fc.return(Q.getPackage(fa.address))}})};Ra.interactivelyCreatePackage=Za;Ra.interactivelyLoadPackage=Cb;Ra.interactivelyReloadPackage=bc;Ra.interactivelyUnloadPackage=ic;Ra.interactivelyRemovePackage=
id;Ra.showExportsAndImportsOf=fe;Ra.parseJsonLikeObj=nd;Ra.arr=Rb;Ra.resource=kc;Ra.interactivelyCreatePackage=Za;Ra.interactivelyCreatePackage=Za;Ra.interactivelyLoadPackage=Cb;Ra.interactivelyLoadPackage=Cb;Ra.interactivelyReloadPackage=bc;Ra.interactivelyReloadPackage=bc;Ra.interactivelyUnloadPackage=ic;Ra.interactivelyUnloadPackage=ic;Ra.interactivelyRemovePackage=id;Ra.interactivelyRemovePackage=id;Ra.showExportsAndImportsOf=fe;Ra.showExportsAndImportsOf=fe;var ub=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");
ub.shortModuleName=Zb;ub.interactivelyChangeModule=rc;ub.interactivelyReloadModule=Lb;ub.interactivelyUnloadModule=Gc;ub.interactivelyRemoveModule=$c;ub.interactivelyAddModule=ed;ub._askForModuleName=function(Q,fa,Ha){var Qa,fc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){switch(Nb.nextAddress){case 1:return Nb.yield(Ha.prompt("Enter module name",{input:fa,historyId:"lively.vm-editor-add-module-name"}),2);case 2:fa=Nb.yieldResult;if(!fa)throw"Canceled";return Nb.yield(Q.normalize(fa),
3);case 3:return Qa=Nb.yieldResult,Nb.yield(Ha.confirm(["Create module \n",{},Qa,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:fc=Nb.yieldResult;if(!fc)throw"Canceled";return Nb.return(Qa)}})};ub._searchForExistingFiles=function(Q,fa,Ha){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){return String(fa).match(/^http/)?Qa.return(ub._searchForExistingFilesWeb(Q,fa,Ha)):Qa.return(ub._searchForExistingFilesManually(Q,fa,Ha))})};ub._searchForExistingFilesManually=function(Q,
fa,Ha){var Qa,fc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){switch(Nb.nextAddress){case 1:return Nb.yield(Q.world().multipleChoicePrompt("Add Module",{requester:Q,choices:["Create New Module","Load Existing Module"]}),2);case 2:Qa=Nb.yieldResult;if("Create New Module"===Qa)return Nb.return("[create new module]");if("Load Existing Module"!==Qa){Nb.jumpTo(3);break}return Nb.yield(Q.world().prompt("URL of module?",{input:fa,requester:Q,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),
4);case 4:if(fc=Nb.yieldResult)return Nb.return([fc]);case 3:throw"Canceled";}})};ub._searchForExistingFilesWeb=function(Q,fa,Ha){function Qa(ad){ad.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(ad.name())||Ha&&ub.arr.pluck(Ha.modules,"name").includes(ad.url)?!0:!1}var fc,Nb,ab,lc,rd,Bd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ad){switch(ad.nextAddress){case 1:return(fc=Q.world())&&(Nb=fc.showLoadingIndicatorFor(Q,"Loading existing modules...")),
ad.yield(ub.resource(fa).dirList(5,{exclude:Qa}),3);case 3:return ad.yield(ad.yieldResult.map(function(Xa){return Xa.url}),2);case 2:return ab=ad.yieldResult,lc=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(ab.filter(function(Xa){return Xa.endsWith(".js")}).map(function(Xa){return{isListItem:!0,string:Ha&&0==Xa.indexOf(Ha.address)?Ha.name+Xa.slice(Ha.address.length):Xa,value:Xa}})),ad.yield(Promise.resolve(Nb&&Nb.remove()).then(function(){return Q.world().filterableListPrompt("What module to load?",
lc,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:Q},Q?{extent:Q.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:rd=ad.yieldResult;if(!rd||"canceled"===rd.status||!rd.selected.length)throw"Canceled";Bd=rd.selected||rd;Array.isArray(Bd)||(Bd=[Bd]);return ad.return(Bd)}})};ub._createAndLoadModules=function(Q,fa){var Ha,Qa,fc,Nb,ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lc){switch(lc.nextAddress){case 1:Array.isArray(fa)||(fa=[fa]),Ha=[],Qa=$jscomp.makeIterator(fa),
fc=Qa.next();case 2:if(fc.done){lc.jumpTo(4);break}Nb=fc.value;return lc.yield(Q.forgetModule(Nb,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return lc.yield(Q.resourceEnsureExistance(Nb,'"format esm";\n'),6);case 6:return lc.setCatchFinallyBlocks(7),lc.yield(Q.importModule(Nb),9);case 9:Ha.push({name:Nb});lc.leaveTryBlock(3);break;case 7:ab=lc.enterCatchBlock(),Ha.push({name:Nb,error:ab});case 3:fc=Qa.next();lc.jumpTo(2);break;case 4:return lc.return(Ha)}})};ub.modulesInPackage_defaultExclude=function(Q){return[".git",
"node_modules",".optimized-loading-cache",".module_cache"].includes(Q.name())?!0:!1};ub.modulesInPackage=$b;ub.obj=dc;ub.arr=Rb;ub.resource=kc;ub.shortModuleName=Zb;ub.shortModuleName=Zb;ub.interactivelyChangeModule=rc;ub.interactivelyChangeModule=rc;ub.interactivelyReloadModule=Lb;ub.interactivelyReloadModule=Lb;ub.interactivelyUnloadModule=Gc;ub.interactivelyUnloadModule=Gc;ub.interactivelyRemoveModule=$c;ub.interactivelyRemoveModule=$c;ub.interactivelyAddModule=ed;ub.interactivelyAddModule=ed;
ub.modulesInPackage=$b;ub.modulesInPackage=$b;var Mb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/mocha-tests.js");Mb.loadMochaTestFile=ob;Mb.runMochaTests=zc;Mb.arr=Rb;Mb.chain=ke;Mb.loadMochaTestFile=ob;Mb.loadMochaTestFile=ob;Mb.runMochaTests=zc;Mb.runMochaTests=zc;var Ob=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");Ob.todo=function(Q){throw Error(Q+" is not yet implemented!");};Ob.parseJsonLikeObj=nd;Ob.arr=Rb;Ob.Closure=hd;Ob.obj=
dc;Ob.resource=kc;Ob.transform=$d;Ob.modules=md;var kb=function(){};kb.prototype.dynamicCompletionsForPrefix=function(Q,fa,Ha){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){Ob.todo("dynamicCompletionsForPrefix");Qa.jumpToEnd()})};kb.prototype.runEval=function(Q,fa){Ob.todo("runEval")};kb.prototype.resourceExists=function(Q){Ob.todo("resourceExists")};kb.prototype.resourceEnsureExistance=function(Q,fa){Ob.todo("resourceEnsureExistance")};kb.prototype.resourceMkdir=function(Q){Ob.todo("resourceMkdir")};
kb.prototype.resourceRead=function(Q){Ob.todo("resourceRead")};kb.prototype.resourceRemove=function(Q){Ob.todo("resourceRemove")};kb.prototype.resourceWrite=function(Q,fa){Ob.todo("resourceWrite")};kb.prototype.resourceCreateFiles=function(Q,fa){Ob.todo("resourceCreateFiles")};kb.prototype.resourceDirList=function(Q,fa,Ha){Ob.todo("resourceDirList")};kb.prototype.normalizeSync=function(Q,fa,Ha){Ob.todo("normalizeSync")};kb.prototype.normalize=function(Q,fa,Ha){Ob.todo("normalize")};kb.prototype.printSystemConfig=
function(){Ob.todo("printSystemConfig")};kb.prototype.getConfig=function(){Ob.todo("getConfig")};kb.prototype.setConfig=function(Q){Ob.todo("setConfig")};kb.prototype.getPackages=function(Q){Ob.todo("getPackages")};kb.prototype.isModuleLoaded=function(Q,fa){Ob.todo("isModuleLoaded")};kb.prototype.doesModuleExist=function(Q,fa){Ob.todo("doesModuleExist")};kb.prototype.getModules=function(){var Q=this,fa,Ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){return 1==Qa.nextAddress?(fa=
Ob.arr,Ha=fa.flatmap,Qa.yield(Q.getPackages(),2)):Qa.return(Ha.call(fa,Qa.yieldResult,function(fc){return fc.modules}))})};kb.prototype.getModule=function(Q){var fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){return 1==Ha.nextAddress?Ha.yield(fa.getModules(),2):Ha.return(Ha.yieldResult.find(function(Qa){return Qa.name===Q}))})};kb.prototype.getPackage=function(Q){var fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){return 1==Ha.nextAddress?(Q=Q.replace(/\/+$/,
""),Ha.yield(fa.getPackages(),2)):Ha.return(Ha.yieldResult.find(function(Qa){return Qa.address===Q||Qa.name===Q}))})};kb.prototype.getPackageForModule=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){Ob.todo("getPackageForModule");fa.jumpToEnd()})};kb.prototype.systemConfChange=function(Q){var fa=Ob.parseJsonLikeObj(Q);["baseURL"].forEach(function(Ha){return delete fa[Ha]});return this.setConfig(fa)};kb.prototype.resourcesOfPackage=function(Q,fa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){Ob.todo("resourcesOfPackage");
Ha.jumpToEnd()})};kb.prototype.registerPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){Ob.todo("registerPackage");fa.jumpToEnd()})};kb.prototype.importPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){Ob.todo("importPackage");fa.jumpToEnd()})};kb.prototype.removePackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){Ob.todo("removePackage");fa.jumpToEnd()})};kb.prototype.reloadPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){Ob.todo("reloadPackage");
fa.jumpToEnd()})};kb.prototype.packageConfChange=function(Q,fa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){Ob.todo("packageConfChange");Ha.jumpToEnd()})};kb.prototype.importModule=function(Q){Ob.todo("importModule")};kb.prototype.forgetModule=function(Q,fa){Ob.todo("forgetModule")};kb.prototype.reloadModule=function(Q,fa){Ob.todo("reloadModule")};kb.prototype.moduleFormat=function(Q){Ob.todo("moduleFormat")};kb.prototype.moduleRead=function(Q){Ob.todo("moduleRead")};kb.prototype.moduleSourceChange=
function(Q,fa,Ha){Ob.todo("moduleSourceChange")};kb.prototype.importsAndExportsOf=function(Q,fa){Ob.todo("importsAndExportsOf")};kb.prototype.keyValueListOfVariablesInModule=function(Q,fa){Ob.todo("keyValueListOfVariablesInModule")};kb.prototype.moduleWrite=function(Q,fa){return this.moduleSourceChange(Q,fa)};Ob.AbstractCoreInterface=kb;var ib=function(){var Q=Ob.AbstractCoreInterface.call(this)||this;Q.currentEval=null;return Q};$jscomp.inherits(ib,Ob.AbstractCoreInterface);ib.prototype.runEval=
function(Q,fa){throw Error("Not yet implemented");};ib.prototype.runEvalAndStringify=function(Q,fa){var Ha=this;return this.currentEval?this.currentEval.then(function(){return Ha.runEvalAndStringify(Q,fa)}):this.currentEval=Promise.resolve().then(function(){var Qa,fc,Nb,ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lc){switch(lc.nextAddress){case 1:return lc.yield(Ha.runEval("\n        Promise.resolve((async "+Ob.transform.wrapInFunction(Q)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},fa)),2);case 2:if((Qa=lc.yieldResult)&&Qa.isError)throw Error(String(Qa.value||Qa.error));if(!Qa||!Qa.value)return lc.return(null);if(fc=Qa.promisedValue){lc.jumpTo(3);break}return lc.yield(Qa.value,4);case 4:fc=lc.yieldResult;case 3:Nb=fc;if(!Nb)return lc.return();if("undefined"===Nb)return lc.return(void 0);if("null"===Nb)return lc.return(null);if("true"===Nb)return lc.return(!0);
if("false"===Nb)return lc.return(!1);try{ab=JSON.parse(Nb)}catch(rd){return lc.return(Nb)}if(ab&&ab.isError)throw Error(String(ab.value));return lc.return(ab)}})}).then(function(Qa){delete Ha.currentEval;return Qa},function(Qa){delete Ha.currentEval;return Promise.reject(Qa)})};ib.prototype.dynamicCompletionsForPrefix=function(Q,fa,Ha){var Qa=this,fc,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){fc=Ob.obj.isString(Ha.context)?Ha.context:!1;Ha=Ob.obj.dissoc(Ha,["systemInterface",
"System","context"]);Nb="\n      var prefix = "+JSON.stringify(fa)+",\n          opts = "+JSON.stringify(Ha)+";\n      opts.context = "+fc+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return ab.return(Qa.runEvalAndStringify(Nb))})};ib.prototype.evalWithResource=function(Q,fa,Ha){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+Q+'").'+fa+"("+(Ha?JSON.stringify(Ha):"")+");\n    ")};ib.prototype.resourceExists=function(Q){return this.evalWithResource(Q,"exists")};ib.prototype.resourceEnsureExistance=function(Q,fa){return this.evalWithResource(Q,
"ensureExistance",fa)};ib.prototype.resourceMkdir=function(Q){return this.evalWithResource(Q,"mkdir")};ib.prototype.resourceRead=function(Q){return this.evalWithResource(Q,"read")};ib.prototype.resourceRemove=function(Q){return this.evalWithResource(Q,"remove")};ib.prototype.resourceWrite=function(Q,fa){return this.evalWithResource(Q,"write",fa)};ib.prototype.resourceCreateFiles=function(Q,fa){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
Q+'", '+JSON.stringify(fa)+")")};ib.prototype.resourceDirList=function(Q,fa,Ha){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+Q+'").dirList('+JSON.stringify(fa)+", "+JSON.stringify(Ha)+"))\n        .map(({url}) => ({url}))")};ib.prototype.livelySystemAccessor=function(Q){Q=void 0===Q?"livelySystem":Q;return"var "+Q+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
Q+') throw new Error("lively-system-interface not available!");'};ib.prototype.normalizeSync=function(Q,fa,Ha){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(Q)+", "+JSON.stringify(fa)+", "+Ha+")")};ib.prototype.normalize=function(Q,fa,Ha){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(Q)+", "+JSON.stringify(fa)+", "+JSON.stringify(Ha)+")")};ib.prototype.printSystemConfig=function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")};
ib.prototype.getConfig=function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')};ib.prototype.setConfig=function(Q){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(Q)+")")};ib.prototype.getPackages=function(Q){Q=Object.assign({excluded:[]},Q);Q.excluded=Q.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(Q)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')};ib.prototype.getPackageForModule=function(Q){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(Q)+")")};ib.prototype.isModuleLoaded=function(Q,fa){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+Q+'", '+fa+")")};ib.prototype.doesModuleExist=function(Q,fa){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+Q+'", '+fa+")")};ib.prototype.registerPackage=function(Q){var fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){return Ha.return(fa.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(Q)+")"))})};ib.prototype.importPackage=
function(Q){var fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){return Ha.return(fa.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(Q)+")"))})};ib.prototype.removePackage=function(Q){var fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){return Ha.return(fa.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(Q)+")"))})};ib.prototype.reloadPackage=function(Q,fa){var Ha=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){return Qa.return(Ha.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(Q)+", "+JSON.stringify(fa)+")"))})};ib.prototype.packageConfChange=function(Q,fa){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(Q)+", "+JSON.stringify(fa)+")")};ib.prototype.resourcesOfPackage=function(Q,fa){fa=void 0===fa?[".git","node_modules",".module_cache","lively.next-node_modules"]:fa;var Ha=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){Q.address&&(Q=
Q.address);return Qa.return(Ha.runEvalAndStringify("\n      "+Ha.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(Q)+", "+JSON.stringify(fa)+");"))})};ib.prototype.getModule=function(Q){var fa=this,Ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){if(1==Qa.nextAddress)return Qa.yield(fa.getModules(),2);Ha=Qa.yieldResult.find(function(fc){return fc.name===Q});return Qa.return(Ha?Ob.modules.module(Ha.name):null)})};ib.prototype.importModule=
function(Q){return this.runEvalAndStringify("lively.modules.System.import("+JSON.stringify(Q)+")")};ib.prototype.forgetModule=function(Q,fa){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").unload("+JSON.stringify(fa)+")")};ib.prototype.reloadModule=function(Q,fa){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").reload("+JSON.stringify(fa)+")")};ib.prototype.moduleFormat=function(Q){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(Q)+").format();")};ib.prototype.moduleRead=function(Q){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").source()")};ib.prototype.moduleSourceChange=function(Q,fa,Ha){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").changeSource("+JSON.stringify(fa)+", "+JSON.stringify(Ha)+")")};ib.prototype.keyValueListOfVariablesInModule=function(Q,fa){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+
JSON.stringify(Q)+", "+JSON.stringify(fa)+")")};ib.prototype.importsAndExportsOf=function(Q,fa){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(Q)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(Q)+").exports()})")};ib.prototype.exportsOfModules=function(Q){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(Q)+";\n      options.excludedPackages = ["+Q.excludedPackages.map(function(fa){return"function"===
typeof fa?fa.toString():JSON.stringify(fa)}).join(",")+"]\n      await livelySystem.localInterface.exportsOfModules(options)")};ib.prototype.searchInPackage=function(Q,fa,Ha){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(Q)+", "+JSON.stringify(fa)+", "+JSON.stringify(Ha)+")")};ib.prototype.loadMochaTestFile=function(Q,fa){fa=void 0===fa?[]:fa;var Ha=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){return Qa.return(Ha.runEvalAndStringify("\n      "+
Ha.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(Q)+", "+JSON.stringify(fa)+"), result;\n      result = {testsByFile}"))})};ib.prototype.runMochaTests=function(Q,fa,Ha,Qa){var fc=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){Q&&Q instanceof RegExp&&(Q={isRegExp:!0,value:String(Q).replace(/^\/|\/$/g,"")});return Nb.return(fc.runEvalAndStringify("\n      var grep = "+JSON.stringify(Q)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
fc.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(fa||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})};
Ob.RemoteCoreInterface=ib;var Jb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");Jb.obj=dc;Jb.string=Qc;Jb.arr=Rb;Jb.resource=kc;Jb.createFiles=xd;Jb.ast=zb;Jb.modules=md;Jb.vm=Od;Jb.loadMochaTestFile=ob;Jb.runMochaTests=zc;Jb.parseJsonLikeObj=nd;Jb.AbstractCoreInterface=kb;Jb.classToFunctionTransform=ge;kb=function(){return Jb.AbstractCoreInterface.apply(this,arguments)||this};$jscomp.inherits(kb,Jb.AbstractCoreInterface);kb.prototype.dynamicCompletionsForPrefix=
function(Q,fa,Ha){var Qa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fc){if(1==fc.nextAddress)return fc.yield(Jb.vm.completions.getCompletions(function(Nb){return Jb.vm.runEval(Nb.replace("return ",""),Object.assign({targetModule:Q,classTransform:Jb.classToFunctionTransform},Ha))},fa),2);Qa=fc.yieldResult;if(Qa.isError)throw Qa.value;return fc.return({completions:Qa.completions,prefix:Qa.startLetters})})};kb.prototype.runEval=function(Q,fa){return Jb.vm.runEval(Q,Object.assign({classTransform:Jb.classToFunctionTransform},
fa))};kb.prototype.resourceExists=function(Q){return Jb.resource(Q).exists()};kb.prototype.resourceEnsureExistance=function(Q,fa){return Jb.resource(Q).ensureExistance(fa)};kb.prototype.resourceMkdir=function(Q){return Jb.resource(Q).mkdir()};kb.prototype.resourceRead=function(Q){return Jb.resource(Q).read()};kb.prototype.resourceRemove=function(Q){return Jb.resource(Q).remove()};kb.prototype.resourceWrite=function(Q,fa){return Jb.resource(Q).write(fa)};kb.prototype.resourceCreateFiles=function(Q,
fa){return Jb.createFiles(Q,fa)};kb.prototype.resourceDirList=function(Q,fa,Ha){return Jb.resource(Q).dirList(fa,Ha)};kb.prototype.normalizeSync=function(Q,fa,Ha){return System.decanonicalize(Q,fa,Ha)};kb.prototype.normalize=function(Q,fa,Ha){return System.normalize(Q,fa,Ha)};kb.prototype.printSystemConfig=function(){return Jb.modules.printSystemConfig()};kb.prototype.getConfig=function(){return System.getConfig()};kb.prototype.setConfig=function(Q){Jb.modules.System.config(Q)};kb.prototype.getPackages=
function(Q){Q=Object.assign({},Q);Q=void 0===Q.excluded?[]:Q.excluded;var fa=Q.filter(function(Qa){return"string"===typeof Qa}),Ha=Q.filter(function(Qa){return"function"===typeof Qa});fa=fa.concat(fa.map(function(Qa){return System.decanonicalize(Qa.replace(/\/?$/,"/")).replace(/\/$/,"")}));return Jb.modules.getPackages().filter(function(Qa){return!fa.includes(Qa.url)&&!Ha.some(function(fc){return fc(Qa.url)})})};kb.prototype.registerPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){return fa.return(Jb.modules.registerPackage(Q))})};
kb.prototype.importPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){return fa.return(Jb.modules.importPackage(Q))})};kb.prototype.removePackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){return fa.return(Jb.modules.removePackage(Q))})};kb.prototype.reloadPackage=function(Q,fa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){return Ha.return(Jb.modules.reloadPackage(Q,fa))})};kb.prototype.packageConfChange=function(Q,
fa){var Ha=this,Qa,fc,Nb,ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lc){if(1==lc.nextAddress)return Qa=Jb.modules.System,fc=Jb.parseJsonLikeObj(Q),Nb=JSON.stringify(fc,null,2),lc.yield(Jb.modules.module(fa).changeSource(Nb,{doEval:!1}),2);if(3!=lc.nextAddress)return Qa.set(fa,Qa.newModule(fc)),lc.yield(Ha.getPackageForModule(fa),3);(ab=lc.yieldResult)&&Jb.modules.applyPackageConfig(fc,ab.address);lc.jumpToEnd()})};kb.prototype.resourcesOfPackage=function(Q,fa){fa=void 0===fa?[".git",
"node_modules",".module_cache"]:fa;var Ha,Qa,fc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){if(1==Nb.nextAddress)return Nb.setCatchFinallyBlocks(2),Ha=Q.address?Q.address:Q,Qa=Jb.modules.getPackage(Ha),Nb.yield(Qa.resources(void 0,fa),4);if(2!=Nb.nextAddress)return Nb.return(Nb.yieldResult.map(function(ab){return Object.assign(ab,{package:ab.package.url})}));fc=Nb.enterCatchBlock();console.warn("resourcesOfPackage error for "+Q+": "+fc);return Nb.return([])})};kb.prototype.getPackageForModule=
function(Q){return(Q=Jb.modules.getPackageOfModule(Q))?Q.asSpec():Q};kb.prototype.isModuleLoaded=function(Q,fa){return Jb.modules.isModuleLoaded(Q,fa)};kb.prototype.doesModuleExist=function(Q,fa){return Jb.modules.isModuleLoaded(Q,fa)};kb.prototype.getModule=function(Q){return Jb.modules.module(Q)};kb.prototype.importModule=function(Q){return Jb.modules.System.import(Q)};kb.prototype.forgetModule=function(Q,fa){return Jb.modules.module(Q).unload(fa)};kb.prototype.reloadModule=function(Q,fa){return Jb.modules.module(Q).reload(fa)};
kb.prototype.moduleFormat=function(Q){return Jb.modules.module(Q).format()};kb.prototype.moduleRead=function(Q){return Jb.modules.module(Q).source()};kb.prototype.moduleSourceChange=function(Q,fa,Ha){return Jb.modules.module(Q).changeSource(fa,Ha)};kb.prototype.keyValueListOfVariablesInModule=function(Q,fa){var Ha=this,Qa,fc,Nb,ab,lc,rd,Bd,ad;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xa){switch(Xa.nextAddress){case 1:if(fa){Xa.jumpTo(2);break}return Xa.yield(Ha.resourceRead(Q),3);
case 3:fa=Xa.yieldResult;case 2:return Qa="string"===typeof fa?Jb.ast.parse(fa):fa,fc=Ha.normalizeSync(Q),Ha.moduleFormat(fc),Nb=Jb.modules.module(fc).env().recorder,Xa.yield(Ha.importsAndExportsOf(fc,Qa),4);case 4:return ab=Xa.yieldResult,lc=Jb.ast.query.topLevelDeclsAndRefs(Qa),rd=Jb.arr.sortByKey(Jb.ast.query.declarationsOfScope(lc.scope,!0),"start"),Bd=Jb.arr.pluck(lc.scope.importSpecifiers,"name"),ad=0,Xa.return(rd.map(function(Rc){var pb=Rc.name.length,eb=ab.exports.find(function(ac){return ac.local===
Rc.name}),hb=Jb.arr.include(Bd,Rc.name);eb&&(pb+=9);hb&&(pb+=9);ad=Math.max(ad,pb);return{isExport:eb,isImport:hb,name:Rc.name,value:Nb[Rc.name],node:Rc,printedName:Rc.name+(eb?" [export]":"")+(hb?" [import]":""),printedValue:Jb.obj.inspect(Nb[Rc.name],{maxDepth:1}).replace(/\n/g,"")}}).map(function(Rc){return{isListItem:!0,value:Rc,string:Rc.printedName+Jb.string.indent(" = "+Rc.printedValue," ",ad-Rc.printedName.length)}}))}})};kb.prototype.importsAndExportsOf=function(Q,fa){var Ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){return 1==
Qa.nextAddress?Qa.yield(Jb.modules.module(Q).imports(fa),2):3!=Qa.nextAddress?(Ha=Qa.yieldResult,Qa.yield(Jb.modules.module(Q).exports(fa),3)):Qa.return({imports:Ha,exports:Qa.yieldResult})})};kb.prototype.exportsOfModules=function(Q){return Jb.modules.ExportLookup.run(System,Q)};kb.prototype.searchInPackage=function(Q,fa,Ha){return Jb.modules.getPackage(Q).search(fa,Ha)};kb.prototype.runMochaTests=function(Q,fa,Ha,Qa){return Jb.runMochaTests(Q,fa,Ha,Qa)};kb.prototype.loadMochaTestFile=function(Q,
fa){return Jb.loadMochaTestFile(Q,fa)};$jscomp.global.Object.defineProperties(kb.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"local"}}});Jb.LocalCoreInterface=kb;var vc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");vc.evalStrategies=Ud;vc.RemoteCoreInterface=ib;var sc=function(Q){var fa=vc.RemoteCoreInterface.call(this)||this;fa.currentEval=null;fa.url=Q;fa.server=new vc.evalStrategies.HttpEvalStrategy(Q);return fa};$jscomp.inherits(sc,
vc.RemoteCoreInterface);sc.prototype.runEval=function(Q,fa){return this.server.runEval(Q,fa)};$jscomp.global.Object.defineProperties(sc.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this.url}},description:{configurable:!0,enumerable:!0,get:function(){return this.url.replace(/^https?:\/\//,"")}}});vc.HTTPCoreInterface=sc;var Uc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");Uc.evalStrategies=Ud;Uc.RemoteCoreInterface=ib;ib=function(Q,
fa){var Ha=Uc.RemoteCoreInterface.call(this)||this;Ha.targetId=Q;Ha.peer=fa;return Ha};$jscomp.inherits(ib,Uc.RemoteCoreInterface);ib.prototype.isConnected=function(){var Q=this,fa,Ha,Qa,fc,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){if(1==ab.nextAddress)return fa=Q,Ha=fa.client,Qa=fa.targetId,ab.yield(Ha.sendToAndWait(Ha.trackerId,"getClients",{}),2);fc=ab.yieldResult;Nb=fc.data;return ab.return(Nb.some(function(lc){lc=$jscomp.makeIterator(lc).next().value;return Qa===lc}))})};
ib.prototype.runEval=function(Q,fa){var Ha=this,Qa,fc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){Qa=Ha.client;if(!Qa)throw Error("No lively.2lively default client available!");fc=new Uc.evalStrategies.L2LEvalStrategy(Qa,Ha.targetId);return Nb.return(fc.runEval(Q,fa))})};$jscomp.global.Object.defineProperties(ib.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"l2l "+this.targetId}},description:{configurable:!0,enumerable:!0,get:function(){var Q=this.peer,fa=
"l2l "+this.targetId.slice(0,5);if(Q){var Ha=Q.location,Qa=Q.type,fc=Q.user;Q=Q.world;Qa&&(fa+=", "+Qa);Ha&&(fa+=", "+Ha.replace(/^https?:\/\//,"")+(Q?"/"+Q:""));fc&&(fa+=", "+fc.name)}return fa}},client:{configurable:!0,enumerable:!0,get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}}});Uc.L2LCoreInterface=ib;var Xc=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");Xc.systemInterfaceNamed=Mc;Xc.interactivelyCreatePackage=
Za;Xc.interactivelyLoadPackage=Cb;Xc.interactivelyReloadPackage=bc;Xc.interactivelyUnloadPackage=ic;Xc.interactivelyRemovePackage=id;Xc.showExportsAndImportsOf=fe;Xc.shortModuleName=Zb;Xc.interactivelyChangeModule=rc;Xc.interactivelyReloadModule=Lb;Xc.interactivelyUnloadModule=Gc;Xc.interactivelyRemoveModule=$c;Xc.interactivelyAddModule=ed;Xc.modulesInPackage=$b;Xc.LocalCoreInterface=kb;Xc.HTTPCoreInterface=sc;Xc.L2LCoreInterface=ib;ib=function(Q){this.coreInterface=Q};ib.prototype.dynamicCompletionsForPrefix=
function(Q,fa,Ha){return this.coreInterface.dynamicCompletionsForPrefix(Q,fa,Ha)};ib.prototype.runEval=function(Q,fa){return this.coreInterface.runEval(Q,fa)};ib.prototype.printSystemConfig=function(Q,fa,Ha){return this.coreInterface.printSystemConfig(Q,fa,Ha)};ib.prototype.getConfig=function(Q,fa,Ha){return this.coreInterface.getConfig(Q,fa,Ha)};ib.prototype.getPackages=function(Q){return this.coreInterface.getPackages(Q)};ib.prototype.getModules=function(Q,fa,Ha){return this.coreInterface.getModules(Q,
fa,Ha)};ib.prototype.getModule=function(Q,fa,Ha){return this.coreInterface.getModule(Q,fa,Ha)};ib.prototype.getPackage=function(Q,fa,Ha){return this.coreInterface.getPackage(Q,fa,Ha)};ib.prototype.getPackageForModule=function(Q,fa,Ha){return this.coreInterface.getPackageForModule(Q,fa,Ha)};ib.prototype.resourcesOfPackage=function(Q,fa){return this.coreInterface.resourcesOfPackage(Q,fa)};ib.prototype.systemConfChange=function(Q,fa,Ha){return this.coreInterface.systemConfChange(Q,fa,Ha)};ib.prototype.registerPackage=
function(Q){return this.coreInterface.registerPackage(Q)};ib.prototype.importPackage=function(Q){return this.coreInterface.importPackage(Q)};ib.prototype.removePackage=function(Q){return this.coreInterface.removePackage(Q)};ib.prototype.reloadPackage=function(Q){return this.coreInterface.reloadPackage(Q)};ib.prototype.packageConfChange=function(Q,fa){return this.coreInterface.packageConfChange(Q,fa)};ib.prototype.keyValueListOfVariablesInModule=function(Q,fa){return this.coreInterface.keyValueListOfVariablesInModule(Q,
fa)};ib.prototype.interactivelyCreatePackage=function(Q){return Xc.interactivelyCreatePackage(this.coreInterface,Q)};ib.prototype.interactivelyLoadPackage=function(Q,fa){return Xc.interactivelyLoadPackage(this.coreInterface,Q,fa)};ib.prototype.interactivelyReloadPackage=function(Q,fa){return Xc.interactivelyReloadPackage(this.coreInterface,Q,fa)};ib.prototype.interactivelyUnloadPackage=function(Q,fa,Ha){return Xc.interactivelyUnloadPackage(this.coreInterface,Q,fa,Ha)};ib.prototype.interactivelyRemovePackage=
function(Q,fa){return Xc.interactivelyRemovePackage(this.coreInterface,Q,fa)};ib.prototype.isModuleLoaded=function(Q,fa){return this.coreInterface.isModuleLoaded(Q,fa)};ib.prototype.doesModuleExist=function(Q,fa){return this.coreInterface.doesModuleExist(Q,fa)};ib.prototype.importModule=function(Q){return this.coreInterface.importModule(Q)};ib.prototype.forgetModule=function(Q,fa){return this.coreInterface.forgetModule(Q,fa)};ib.prototype.reloadModule=function(Q,fa){return this.coreInterface.reloadModule(Q,
fa)};ib.prototype.moduleFormat=function(Q){return this.coreInterface.moduleFormat(Q)};ib.prototype.moduleRead=function(Q){return this.coreInterface.moduleRead(Q)};ib.prototype.moduleWrite=function(Q,fa){return this.coreInterface.moduleWrite(Q,fa)};ib.prototype.getModulesInPackage=function(Q){return Xc.modulesInPackage(this.coreInterface,Q)};ib.prototype.shortModuleName=function(Q,fa){return Xc.shortModuleName(this.coreInterface,Q,fa)};ib.prototype.interactivelyChangeModule=function(Q,fa,Ha){return Xc.interactivelyChangeModule(this.coreInterface,
Q,fa,Ha)};ib.prototype.interactivelyReloadModule=function(Q,fa){return Xc.interactivelyReloadModule(this.coreInterface,Q,fa)};ib.prototype.interactivelyUnloadModule=function(Q,fa){return Xc.interactivelyUnloadModule(this.coreInterface,Q,fa)};ib.prototype.interactivelyRemoveModule=function(Q,fa){return Xc.interactivelyRemoveModule(this.coreInterface,Q,fa)};ib.prototype.interactivelyAddModule=function(Q,fa){return Xc.interactivelyAddModule(this.coreInterface,Q,fa)};ib.prototype.showExportsAndImportsOf=
function(Q,fa){return Xc.showExportsAndImportsOf(this.coreInterface,Q,fa)};ib.prototype.exportsOfModules=function(Q){return this.coreInterface.exportsOfModules(Q)};ib.prototype.searchInPackage=function(Q,fa,Ha){return this.coreInterface.searchInPackage(Q,fa,Ha)};ib.prototype.searchInAllPackages=function(Q,fa){fa=void 0===fa?{}:fa;var Ha=this,Qa,fc,Nb,ab,lc,rd,Bd,ad;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xa){switch(Xa.nextAddress){case 1:return(Qa=fa.progress)&&Qa.step("Fetching Packages...",
0),Xa.yield(Ha.coreInterface.getPackages({excluded:fa.excludedPackages}),2);case 2:fc=Xa.yieldResult,Nb=[],Qa&&Qa.step("Fetching Packages...",.1),ab=0;case 3:if(!(ab<fc.length)){Xa.jumpTo(5);break}lc=fc[ab];rd=lc.url;if(!rd||"no group"===rd){Xa.jumpTo(4);break}Qa&&Qa.step(rd.replace(System.baseURL,"").slice(0,20),.1+ab/fc.length*.9);Xa.setCatchFinallyBlocks(6);return Xa.yield(Ha.coreInterface.searchInPackage(rd,Q,fa),8);case 8:Bd=Xa.yieldResult;Nb=Nb.concat(Bd);Xa.leaveTryBlock(4);break;case 6:ad=
Xa.enterCatchBlock(),console.error("Error searching in package "+rd+":\n"+ad.stack);case 4:ab++;Xa.jumpTo(3);break;case 5:return Xa.return(Nb)}})};ib.prototype.loadMochaTestFile=function(Q,fa){return this.coreInterface.loadMochaTestFile(Q,fa)};ib.prototype.runMochaTests=function(Q,fa,Ha,Qa){return this.coreInterface.runMochaTests(Q,fa,Ha,Qa)};$jscomp.global.Object.defineProperties(ib.prototype,{isSystemInterface:{configurable:!0,enumerable:!0,get:function(){return!0}},name:{configurable:!0,enumerable:!0,
get:function(){return this.coreInterface.name}}});Da("Interface",ib);Xc.Interface=ib;Xc.systemInterfaceNamed=Mc;Xc.systemInterfaceNamed=Mc;ib=Da("localInterface",new Xc.Interface(new Xc.LocalCoreInterface));Xc.localInterface=ib;Xc.localInterface=ib;Xc.localInterface=ib;Xc.httpInterfaces={};ib=Da("serverInterfaceFor",function(Q){return Xc.httpInterfaces[Q]||(Xc.httpInterfaces[Q]=new Xc.Interface(new Xc.HTTPCoreInterface(Q)))});Xc.serverInterfaceFor=ib;Xc.serverInterfaceFor=ib;Xc.serverInterfaceFor=
ib;Xc.l2lInterfaces={};ib=Da("l2lInterfaceFor",function(Q,fa){return Xc.l2lInterfaces[Q]||(Xc.l2lInterfaces[Q]=new Xc.Interface(new Xc.L2LCoreInterface(Q,fa)))});Xc.l2lInterfaceFor=ib;Xc.l2lInterfaceFor=ib;Xc.l2lInterfaceFor=ib}}});