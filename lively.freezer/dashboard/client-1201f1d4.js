System.register(["./__root_module__-7cbd94df.js","kld-intersections"],function(Da){var Ab,Rb,jc,cc,je,fd,Yd,jd;return{setters:[function(Pc){Ab=Pc.s;Rb=Pc.$;jc=Pc.bl;cc=Pc.bm;je=Pc.at;fd=Pc.a7;Yd=Pc.bn;jd=Pc.ap},function(){}],execute:function(){function Pc(){function Ba(ub,Eb){var zc={};Eb.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(ld,pd,lc){pd&&(zc[pd]=lc)});return zc}if(jb)return rd;jb=!0;var sb=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
Cb="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");return rd=function(ub){var Eb=ub,zc=ub.indexOf("["),ld=ub.indexOf("]");-1!=zc&&-1!=ld&&(ub=ub.substring(0,zc)+ub.substring(zc,ld).replace(/:/g,";")+ub.substring(ld,ub.length));var pd=sb.exec(ub||"");ub={};for(var lc=14;lc--;)ub[Cb[lc]]=pd[lc]||"";-1!=zc&&-1!=ld&&(ub.source=Eb,ub.host=ub.host.substring(1,ub.host.length-1).replace(/;/g,":"),ub.authority=ub.authority.replace("[","").replace("]",
"").replace(/;/g,":"),ub.ipv6uri=!0);Eb=ub.path;zc=Eb.replace(/\/{2,9}/g,"/").split("/");"/"!=Eb.substr(0,1)&&0!==Eb.length||zc.splice(0,1);"/"==Eb.substr(Eb.length-1,1)&&zc.splice(zc.length-1,1);ub.pathNames=zc;ub.queryKey=Ba(ub,ub.query);return ub}}function vd(){function Ba(Eb){Eb=String(Eb);if(!(100<Eb.length)&&(Eb=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(Eb))){var zc=parseFloat(Eb[1]);switch((Eb[2]||"ms").toLowerCase()){case "years":case "year":case "yrs":case "yr":case "y":return zc*
ub;case "days":case "day":case "d":return zc*Cb;case "hours":case "hour":case "hrs":case "hr":case "h":return 36E5*zc;case "minutes":case "minute":case "mins":case "min":case "m":return 6E4*zc;case "seconds":case "second":case "secs":case "sec":case "s":return 1E3*zc;case "milliseconds":case "millisecond":case "msecs":case "msec":case "ms":return zc}}}function sb(Eb,zc,ld){if(!(Eb<zc))return Eb<1.5*zc?Math.floor(Eb/zc)+" "+ld:Math.ceil(Eb/zc)+" "+ld+"s"}if(ab)return Qd;ab=!0;var Cb=864E5,ub=365.25*
Cb;return Qd=function(Eb,zc){zc=zc||{};var ld=typeof Eb;if("string"===ld&&0<Eb.length)return Ba(Eb);if("number"===ld&&!1===isNaN(Eb))return zc.long?sb(Eb,Cb,"day")||sb(Eb,36E5,"hour")||sb(Eb,6E4,"minute")||sb(Eb,1E3,"second")||Eb+" ms":Eb>=Cb?Math.round(Eb/Cb)+"d":36E5<=Eb?Math.round(Eb/36E5)+"h":6E4<=Eb?Math.round(Eb/6E4)+"m":1E3<=Eb?Math.round(Eb/1E3)+"s":Eb+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(Eb));}}function Ld(){function Ba(ub){var Eb=0,zc;for(zc in ub)Eb=
(Eb<<5)-Eb+ub.charCodeAt(zc),Eb|=0;return lb.colors[Math.abs(Eb)%lb.colors.length]}function sb(ub){function Eb(){if(Eb.enabled){var ld=+new Date;Eb.diff=ld-(zc||ld);Eb.prev=zc;zc=Eb.curr=ld;var pd=Array(arguments.length);for(ld=0;ld<pd.length;ld++)pd[ld]=arguments[ld];pd[0]=lb.coerce(pd[0]);"string"!==typeof pd[0]&&pd.unshift("%O");var lc=0;pd[0]=pd[0].replace(/%([a-zA-Z%])/g,function(hc,Mc){if("%%"===hc)return hc;lc++;Mc=lb.formatters[Mc];"function"===typeof Mc&&(hc=Mc.call(Eb,pd[lc]),pd.splice(lc,
1),lc--);return hc});lb.formatArgs.call(Eb,pd);(Eb.log||lb.log||console.log.bind(console)).apply(Eb,pd)}}var zc;Eb.namespace=ub;Eb.enabled=lb.enabled(ub);Eb.useColors=lb.useColors();Eb.color=Ba(ub);Eb.destroy=Cb;"function"===typeof lb.init&&lb.init(Eb);lb.instances.push(Eb);return Eb}function Cb(){var ub=lb.instances.indexOf(this||Bd);return-1!==ub?(lb.instances.splice(ub,1),!0):!1}if(vb)return lb;vb=!0;lb=lb=sb.debug=sb["default"]=sb;lb.coerce=function(ub){return ub instanceof Error?ub.stack||ub.message:
ub};lb.disable=function(){lb.enable("")};lb.enable=function(ub){lb.save(ub);lb.names=[];lb.skips=[];var Eb,zc=("string"===typeof ub?ub:"").split(/[\s,]+/),ld=zc.length;for(Eb=0;Eb<ld;Eb++)zc[Eb]&&(ub=zc[Eb].replace(/\*/g,".*?"),"-"===ub[0]?lb.skips.push(new RegExp("^"+ub.substr(1)+"$")):lb.names.push(new RegExp("^"+ub+"$")));for(Eb=0;Eb<lb.instances.length;Eb++)ub=lb.instances[Eb],ub.enabled=lb.enabled(ub.namespace)};lb.enabled=function(ub){if("*"===ub[ub.length-1])return!0;var Eb;var zc=0;for(Eb=
lb.skips.length;zc<Eb;zc++)if(lb.skips[zc].test(ub))return!1;zc=0;for(Eb=lb.names.length;zc<Eb;zc++)if(lb.names[zc].test(ub))return!0;return!1};lb.humanize=vd();lb.instances=[];lb.names=[];lb.skips=[];lb.formatters={};return lb}function ge(){function Ba(){try{var Eb=de.storage.debug}catch(zc){}!Eb&&"undefined"!==typeof sb&&"env"in sb&&(Eb=sb.env.DEBUG);return Eb}if(Ee)return de;Ee=!0;var sb=jc;de=de=Ld();de.log=function(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,
console,arguments)};de.formatArgs=function(Eb){var zc=(this||Ze).useColors;Eb[0]=(zc?"%c":"")+(this||Ze).namespace+(zc?" %c":" ")+Eb[0]+(zc?"%c ":" ")+"+"+de.humanize((this||Ze).diff);if(zc){zc="color: "+(this||Ze).color;Eb.splice(1,0,zc,"color: inherit");var ld=0,pd=0;Eb[0].replace(/%[a-zA-Z%]/g,function(lc){"%%"!==lc&&(ld++,"%c"===lc&&(pd=ld))});Eb.splice(pd,0,zc)}};de.save=function(Eb){try{null==Eb?de.storage.removeItem("debug"):de.storage.debug=Eb}catch(zc){}};de.load=Ba;de.useColors=function(){return"undefined"!==
typeof window&&window.process&&"renderer"===window.process.type?!0:"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:"undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&
31<=parseInt(RegExp.$1,10)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)};var Cb=de;if("undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage)var ub=chrome.storage.local;else a:{try{ub=window.localStorage;break a}catch(Eb){}ub=void 0}Cb.storage=ub;de.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" ");
de.formatters.j=function(Eb){try{return JSON.stringify(Eb)}catch(zc){return"[UnexpectedJSONParseError]: "+zc.message}};de.enable(Ba());return de}function Td(){if(ye)return Zc;ye=!0;var Ba=Pc(),sb=ge()("socket.io-client:url");return Zc=function(Cb,ub){var Eb=Cb;ub=ub||"undefined"!==typeof location&&location;null==Cb&&(Cb=ub.protocol+"//"+ub.host);"string"===typeof Cb&&("/"===Cb.charAt(0)&&(Cb="/"===Cb.charAt(1)?ub.protocol+Cb:ub.host+Cb),/^(https?|wss?):\/\//.test(Cb)||(sb("protocol-less url %s",Cb),
Cb="undefined"!==typeof ub?ub.protocol+"//"+Cb:"https://"+Cb),sb("parse %s",Cb),Eb=Ba(Cb));Eb.port||(/^(http|ws)$/.test(Eb.protocol)?Eb.port="80":/^(http|ws)s$/.test(Eb.protocol)&&(Eb.port="443"));Eb.path=Eb.path||"/";Cb=-1!==Eb.host.indexOf(":")?"["+Eb.host+"]":Eb.host;Eb.id=Eb.protocol+"://"+Cb+":"+Eb.port;Eb.href=Eb.protocol+"://"+Cb+(ub&&ub.port===Eb.port?"":":"+Eb.port);return Eb}}function md(){function Ba(sb){if(sb){for(var Cb in Ba.prototype)sb[Cb]=Ba.prototype[Cb];return sb}}if(Zb)return Hd;
Zb=!0;Hd=Ba;Ba.prototype.on=Ba.prototype.addEventListener=function(sb,Cb){(this||sa)._callbacks=(this||sa)._callbacks||{};((this||sa)._callbacks["$"+sb]=(this||sa)._callbacks["$"+sb]||[]).push(Cb);return this||sa};Ba.prototype.once=function(sb,Cb){function ub(){this.off(sb,ub);Cb.apply(this||sa,arguments)}ub.fn=Cb;this.on(sb,ub);return this||sa};Ba.prototype.off=Ba.prototype.removeListener=Ba.prototype.removeAllListeners=Ba.prototype.removeEventListener=function(sb,Cb){(this||sa)._callbacks=(this||
sa)._callbacks||{};if(0==arguments.length)return(this||sa)._callbacks={},this||sa;var ub=(this||sa)._callbacks["$"+sb];if(!ub)return this||sa;if(1==arguments.length)return delete (this||sa)._callbacks["$"+sb],this||sa;for(var Eb,zc=0;zc<ub.length;zc++)if(Eb=ub[zc],Eb===Cb||Eb.fn===Cb){ub.splice(zc,1);break}0===ub.length&&delete (this||sa)._callbacks["$"+sb];return this||sa};Ba.prototype.emit=function(sb){(this||sa)._callbacks=(this||sa)._callbacks||{};for(var Cb=Array(arguments.length-1),ub=(this||
sa)._callbacks["$"+sb],Eb=1;Eb<arguments.length;Eb++)Cb[Eb-1]=arguments[Eb];if(ub){ub=ub.slice(0);Eb=0;for(var zc=ub.length;Eb<zc;++Eb)ub[Eb].apply(this||sa,Cb)}return this||sa};Ba.prototype.listeners=function(sb){(this||sa)._callbacks=(this||sa)._callbacks||{};return(this||sa)._callbacks["$"+sb]||[]};Ba.prototype.hasListeners=function(sb){return!!this.listeners(sb).length};return Hd}function Za(){if(Mb)return Aa;Mb=!0;var Ba={}.toString;return Aa=Array.isArray||function(sb){return"[object Array]"==
Ba.call(sb)}}function Db(){if(wa)return P;wa=!0;var Ba=cc.Buffer;P=function(ub){var Eb;!(Eb=sb&&Ba.isBuffer(ub))&&(Eb=Cb)&&((Eb=ub instanceof ArrayBuffer)||(Eb="function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(ub):ub.buffer instanceof ArrayBuffer));return Eb};var sb="function"===typeof Ba&&"function"===typeof Ba.isBuffer,Cb="function"===typeof ArrayBuffer;return P}function ac(){function Ba(pd,lc){if(!pd)return pd;if(ub(pd)){var hc={_placeholder:!0,num:lc.length};lc.push(pd);return hc}if(Cb(pd)){hc=
Array(pd.length);for(var Mc=0;Mc<pd.length;Mc++)hc[Mc]=Ba(pd[Mc],lc);return hc}if("object"===typeof pd&&!(pd instanceof Date)){hc={};for(Mc in pd)hc[Mc]=Ba(pd[Mc],lc);return hc}return pd}function sb(pd,lc){if(!pd)return pd;if(pd&&pd._placeholder)return lc[pd.num];if(Cb(pd))for(var hc=0;hc<pd.length;hc++)pd[hc]=sb(pd[hc],lc);else if("object"===typeof pd)for(hc in pd)pd[hc]=sb(pd[hc],lc);return pd}if(Nb)return Qa;Nb=!0;var Cb=Za(),ub=Db(),Eb=Object.prototype.toString,zc="function"===typeof Blob||"undefined"!==
typeof Blob&&"[object BlobConstructor]"===Eb.call(Blob),ld="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===Eb.call(File);Qa.deconstructPacket=function(pd){var lc=[];pd.data=Ba(pd.data,lc);pd.attachments=lc.length;return{packet:pd,buffers:lc}};Qa.reconstructPacket=function(pd,lc){pd.data=sb(pd.data,lc);pd.attachments=void 0;return pd};Qa.removeBlobs=function(pd,lc){function hc(kd,ke,df){if(!kd)return kd;if(zc&&kd instanceof Blob||ld&&kd instanceof File){Mc++;var be=
new FileReader;be.onload=function(){df?df[ke]=(this||Gc).result:wb=(this||Gc).result;--Mc||lc(wb)};be.readAsArrayBuffer(kd)}else if(Cb(kd))for(be=0;be<kd.length;be++)hc(kd[be],be,kd);else if("object"===typeof kd&&!ub(kd))for(be in kd)hc(kd[be],be,kd)}var Mc=0,wb=pd;hc(wb);Mc||lc(wb)};return Qa}function ic(){function Ba(){}function sb(wb){var kd=""+wb.type;if(Uc.BINARY_EVENT===wb.type||Uc.BINARY_ACK===wb.type)kd+=wb.attachments+"-";wb.nsp&&"/"!==wb.nsp&&(kd+=wb.nsp+",");null!=wb.id&&(kd+=wb.id);if(null!=
wb.data){try{var ke=JSON.stringify(wb.data)}catch(df){ke=!1}if(!1!==ke)kd+=ke;else return Mc}zc("encoded %j as %s",wb,kd);return kd}function Cb(wb,kd){pd.removeBlobs(wb,function(ke){var df=pd.deconstructPacket(ke);ke=sb(df.packet);df=df.buffers;df.unshift(ke);kd(df)})}function ub(){(this||Od).reconstructor=null}function Eb(wb){(this||Od).reconPack=wb;(this||Od).buffers=[]}if(le)return Uc;le=!0;var zc=ge()("socket.io-parser"),ld=md(),pd=ac(),lc=Za(),hc=Db();Uc.protocol=4;Uc.types="CONNECT DISCONNECT EVENT ACK ERROR BINARY_EVENT BINARY_ACK".split(" ");
Uc.CONNECT=0;Uc.DISCONNECT=1;Uc.EVENT=2;Uc.ACK=3;Uc.ERROR=4;Uc.BINARY_EVENT=5;Uc.BINARY_ACK=6;Uc.Encoder=Ba;Uc.Decoder=ub;var Mc=Uc.ERROR+'"encode error"';Ba.prototype.encode=function(wb,kd){zc("encoding packet %j",wb);Uc.BINARY_EVENT===wb.type||Uc.BINARY_ACK===wb.type?Cb(wb,kd):(wb=sb(wb),kd([wb]))};ld(ub.prototype);ub.prototype.add=function(wb){if("string"===typeof wb){a:{var kd=0,ke={type:Number(wb.charAt(0))};if(null==Uc.types[ke.type])wb={type:Uc.ERROR,data:"parser error: unknown packet type "+
ke.type};else{if(Uc.BINARY_EVENT===ke.type||Uc.BINARY_ACK===ke.type){for(var df="";"-"!==wb.charAt(++kd)&&(df+=wb.charAt(kd),kd!=wb.length););if(df!=Number(df)||"-"!==wb.charAt(kd))throw Error("Illegal attachments");ke.attachments=Number(df)}if("/"===wb.charAt(kd+1))for(ke.nsp="";++kd;){df=wb.charAt(kd);if(","===df)break;ke.nsp+=df;if(kd===wb.length)break}else ke.nsp="/";df=wb.charAt(kd+1);if(""!==df&&Number(df)==df){for(ke.id="";++kd;){df=wb.charAt(kd);if(null==df||Number(df)!=df){--kd;break}ke.id+=
wb.charAt(kd);if(kd===wb.length)break}ke.id=Number(ke.id)}if(wb.charAt(++kd)){kd=wb.substr(kd);try{var be=JSON.parse(kd)}catch(Re){be=!1}if(!1===be||ke.type!==Uc.ERROR&&!lc(be)){wb={type:Uc.ERROR,data:"parser error: invalid payload"};break a}else ke.data=be}zc("decoded %s as %j",wb,ke);wb=ke}}Uc.BINARY_EVENT===wb.type||Uc.BINARY_ACK===wb.type?((this||Od).reconstructor=new Eb(wb),0===(this||Od).reconstructor.reconPack.attachments&&this.emit("decoded",wb)):this.emit("decoded",wb)}else if(hc(wb)||wb.base64)if((this||
Od).reconstructor){if(wb=(this||Od).reconstructor.takeBinaryData(wb))(this||Od).reconstructor=null,this.emit("decoded",wb)}else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+wb);};ub.prototype.destroy=function(){(this||Od).reconstructor&&(this||Od).reconstructor.finishedReconstruction()};Eb.prototype.takeBinaryData=function(wb){(this||Od).buffers.push(wb);return(this||Od).buffers.length===(this||Od).reconPack.attachments?(wb=pd.reconstructPacket((this||
Od).reconPack,(this||Od).buffers),this.finishedReconstruction(),wb):null};Eb.prototype.finishedReconstruction=function(){(this||Od).reconPack=null;(this||Od).buffers=[]};return Uc}function gd(){if($e)return Ke;$e=!0;return Ke="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")()}function fe(){if(rg)return Cf;rg=!0;if(!ae){ae=!0;try{kf="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Cb){kf=!1}}var Ba=kf;var sb=gd();return Cf=function(Cb){var ub=
Cb.xdomain,Eb=Cb.xscheme;Cb=Cb.enablesXDR;try{if("undefined"!==typeof XMLHttpRequest&&(!ub||Ba))return new XMLHttpRequest}catch(zc){}try{if("undefined"!==typeof XDomainRequest&&!Eb&&Cb)return new XDomainRequest}catch(zc){}if(!ub)try{return new (sb[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(zc){}}}function Yb(){if(Tc)return Qf;Tc=!0;return Qf=Object.keys||function(Ba){var sb=[],Cb=Object.prototype.hasOwnProperty,ub;for(ub in Ba)Cb.call(Ba,ub)&&sb.push(ub);return sb}}function qc(){function Ba(ld){if(!ld||
"object"!==typeof ld)return!1;if(Cb(ld)){for(var pd=0,lc=ld.length;pd<lc;pd++)if(Ba(ld[pd]))return!0;return!1}if("function"===typeof sb&&sb.isBuffer&&sb.isBuffer(ld)||"function"===typeof ArrayBuffer&&ld instanceof ArrayBuffer||Eb&&ld instanceof Blob||zc&&ld instanceof File)return!0;if(ld.toJSON&&"function"===typeof ld.toJSON&&1===arguments.length)return Ba(ld.toJSON(),!0);for(pd in ld)if(Object.prototype.hasOwnProperty.call(ld,pd)&&Ba(ld[pd]))return!0;return!1}if(Fg)return Rf;Fg=!0;var sb=cc.Buffer,
Cb=Za(),ub=Object.prototype.toString,Eb="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===ub.call(Blob),zc="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===ub.call(File);return Rf=Ba}function Ob(){if(rf)return Gg;rf=!0;return Gg=function(Ba,sb,Cb){var ub=Ba.byteLength;sb=sb||0;Cb=Cb||ub;if(Ba.slice)return Ba.slice(sb,Cb);0>sb&&(sb+=ub);0>Cb&&(Cb+=ub);Cb>ub&&(Cb=ub);if(sb>=ub||sb>=Cb||0===ub)return new ArrayBuffer(0);Ba=new Uint8Array(Ba);
ub=new Uint8Array(Cb-sb);for(var Eb=0;sb<Cb;sb++,Eb++)ub[Eb]=Ba[sb];return ub.buffer}}function Hc(){function Ba(){}if(cb)return Ha;cb=!0;return Ha=function(sb,Cb,ub){function Eb(ld,pd){if(0>=Eb.count)throw Error("after called too many times");--Eb.count;ld?(zc=!0,Cb(ld),Cb=ub):0!==Eb.count||zc||Cb(null,pd)}var zc=!1;ub=ub||Ba;Eb.count=sb;return 0===sb?Cb():Eb}}function Yc(){function Ba(lc){for(var hc=[],Mc=0,wb=lc.length,kd,ke;Mc<wb;)kd=lc.charCodeAt(Mc++),55296<=kd&&56319>=kd&&Mc<wb?(ke=lc.charCodeAt(Mc++),
56320==(ke&64512)?hc.push(((kd&1023)<<10)+(ke&1023)+65536):(hc.push(kd),Mc--)):hc.push(kd);return hc}function sb(lc,hc){if(55296<=lc&&57343>=lc){if(hc)throw Error("Lone surrogate U+"+lc.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function Cb(){if(pd>=ld)throw Error("Invalid byte index");var lc=zc[pd]&255;pd++;if(128==(lc&192))return lc&63;throw Error("Invalid continuation byte");}function ub(lc){if(pd>ld)throw Error("Invalid byte index");if(pd==ld)return!1;var hc=zc[pd]&
255;pd++;if(0==(hc&128))return hc;if(192==(hc&224)){var Mc=Cb();hc=(hc&31)<<6|Mc;if(128<=hc)return hc;throw Error("Invalid continuation byte");}if(224==(hc&240)){Mc=Cb();var wb=Cb();hc=(hc&15)<<12|Mc<<6|wb;if(2048<=hc)return sb(hc,lc)?hc:65533;throw Error("Invalid continuation byte");}if(240==(hc&248)&&(Mc=Cb(),wb=Cb(),lc=Cb(),hc=(hc&7)<<18|Mc<<12|wb<<6|lc,65536<=hc&&1114111>=hc))return hc;throw Error("Invalid UTF-8 detected");}if(ba)return Hb;ba=!0;var Eb=String.fromCharCode,zc,ld,pd;return Hb={version:"2.1.2",
encode:function(lc,hc){hc=hc||{};hc=!1!==hc.strict;lc=Ba(lc);for(var Mc=lc.length,wb=-1,kd,ke="";++wb<Mc;){kd=lc[wb];var df=hc;if(0==(kd&4294967168))kd=Eb(kd);else{var be="";0==(kd&4294965248)?be=Eb(kd>>6&31|192):0==(kd&4294901760)?(sb(kd,df)||(kd=65533),be=Eb(kd>>12&15|224),be+=Eb(kd>>6&63|128)):0==(kd&4292870144)&&(be=Eb(kd>>18&7|240),be+=Eb(kd>>12&63|128),be+=Eb(kd>>6&63|128));kd=be+=Eb(kd&63|128)}ke+=kd}return ke},decode:function(lc,hc){hc=hc||{};hc=!1!==hc.strict;zc=Ba(lc);ld=zc.length;pd=0;
lc=[];for(var Mc;!1!==(Mc=ub(hc));)lc.push(Mc);hc=lc.length;Mc=-1;for(var wb,kd="";++Mc<hc;)wb=lc[Mc],65535<wb&&(wb-=65536,kd+=Eb(wb>>>10&1023|55296),wb=56320|wb&1023),kd+=Eb(wb);return kd}}}function cd(){if(nb)return Ja;nb=!0;(function(Ba){Ja.encode=function(sb){sb=new Uint8Array(sb);var Cb,ub=sb.length,Eb="";for(Cb=0;Cb<ub;Cb+=3)Eb+=Ba[sb[Cb]>>2],Eb+=Ba[(sb[Cb]&3)<<4|sb[Cb+1]>>4],Eb+=Ba[(sb[Cb+1]&15)<<2|sb[Cb+2]>>6],Eb+=Ba[sb[Cb+2]&63];2===ub%3?Eb=Eb.substring(0,Eb.length-1)+"=":1===ub%3&&(Eb=Eb.substring(0,
Eb.length-2)+"==");return Eb};Ja.decode=function(sb){var Cb=.75*sb.length,ub=sb.length,Eb=0;"="===sb[sb.length-1]&&(Cb--,"="===sb[sb.length-2]&&Cb--);var zc=new ArrayBuffer(Cb),ld=new Uint8Array(zc);for(Cb=0;Cb<ub;Cb+=4){var pd=Ba.indexOf(sb[Cb]);var lc=Ba.indexOf(sb[Cb+1]);var hc=Ba.indexOf(sb[Cb+2]);var Mc=Ba.indexOf(sb[Cb+3]);ld[Eb++]=pd<<2|lc>>4;ld[Eb++]=(lc&15)<<4|hc>>2;ld[Eb++]=(hc&3)<<6|Mc&63}return zc}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/");return Ja}function $b(){function Ba(pd){return pd.map(function(lc){if(lc.buffer instanceof
ArrayBuffer){var hc=lc.buffer;if(lc.byteLength!==hc.byteLength){var Mc=new Uint8Array(lc.byteLength);Mc.set(new Uint8Array(hc,lc.byteOffset,lc.byteLength));hc=Mc.buffer}return hc}return lc})}function sb(pd,lc){lc=lc||{};var hc=new ub;Ba(pd).forEach(function(Mc){hc.append(Mc)});return lc.type?hc.getBlob(lc.type):hc.getBlob()}function Cb(pd,lc){return new Blob(Ba(pd),lc||{})}if(Ic)return zb;Ic=!0;var ub="undefined"!==typeof ub?ub:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!==
typeof MSBlobBuilder?MSBlobBuilder:"undefined"!==typeof MozBlobBuilder?MozBlobBuilder:!1;try{var Eb=2===(new Blob(["hi"])).size}catch(pd){Eb=!1}var zc;if(zc=Eb)try{zc=2===(new Blob([new Uint8Array([1,2])])).size}catch(pd){zc=!1}var ld=ub&&ub.prototype.append&&ub.prototype.getBlob;"undefined"!==typeof Blob&&(sb.prototype=Blob.prototype,Cb.prototype=Blob.prototype);zb=Eb?zc?Blob:Cb:ld?sb:void 0;return zb}function pb(){function Ba(be,Re,sf){if(!Re)return vc.encodeBase64Packet(be,sf);var Df=new FileReader;
Df.onload=function(){vc.encodePacket({type:be.type,data:Df.result},Re,!0,sf)};return Df.readAsArrayBuffer(be.data)}function sb(be,Re,sf){var Df=Array(be.length);sf=zc(be.length,sf);for(var If=function(Tg,lh,Oj){Re(lh,function(va,Ka){Df[Tg]=Ka;Oj(va,Df)})},vg=0;vg<be.length;vg++)If(vg,be[vg],sf)}if(Ad)return vc;Ad=!0;var Cb=Yb(),ub=qc(),Eb=Ob(),zc=Hc(),ld=Yc(),pd;"undefined"!==typeof ArrayBuffer&&(pd=cd());var lc="undefined"!==typeof navigator&&/Android/i.test(navigator.userAgent),hc="undefined"!==
typeof navigator&&/PhantomJS/i.test(navigator.userAgent),Mc=lc||hc;vc.protocol=3;var wb=vc.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},kd=Cb(wb),ke={type:"error",data:"parser error"},df=$b();vc.encodePacket=function(be,Re,sf,Df){"function"===typeof Re&&(Df=Re,Re=!1);"function"===typeof sf&&(Df=sf,sf=null);var If=void 0===be.data?void 0:be.data.buffer||be.data;if("undefined"!==typeof ArrayBuffer&&If instanceof ArrayBuffer){if(Re){sf=be.data;Re=new Uint8Array(sf);sf=new Uint8Array(1+
sf.byteLength);sf[0]=wb[be.type];for(be=0;be<Re.length;be++)sf[be+1]=Re[be];be=Df(sf.buffer)}else be=vc.encodeBase64Packet(be,Df);return be}if("undefined"!==typeof df&&If instanceof df)return Re?Mc?be=Ba(be,Re,Df):(Re=new Uint8Array(1),Re[0]=wb[be.type],be=new df([Re.buffer,be.data]),be=Df(be)):be=vc.encodeBase64Packet(be,Df),be;if(If&&If.base64)return Df("b"+vc.packets[be.type]+be.data.data);Re=wb[be.type];void 0!==be.data&&(Re+=sf?ld.encode(String(be.data),{strict:!1}):String(be.data));return Df(""+
Re)};vc.encodeBase64Packet=function(be,Re){var sf="b"+vc.packets[be.type];if("undefined"!==typeof df&&be.data instanceof df){var Df=new FileReader;Df.onload=function(){var Tg=Df.result.split(",")[1];Re(sf+Tg)};return Df.readAsDataURL(be.data)}try{var If=String.fromCharCode.apply(null,new Uint8Array(be.data))}catch(Tg){be=new Uint8Array(be.data);If=Array(be.length);for(var vg=0;vg<be.length;vg++)If[vg]=be[vg];If=String.fromCharCode.apply(null,If)}sf+=btoa(If);return Re(sf)};vc.decodePacket=function(be,
Re,sf){if(void 0===be)return ke;if("string"===typeof be){if("b"===be.charAt(0))return vc.decodeBase64Packet(be.substr(1),Re);if(sf){a:{Re=be;try{Re=ld.decode(Re,{strict:!1})}catch(Df){be=!1;break a}be=Re}if(!1===be)return ke}sf=be.charAt(0);return Number(sf)==sf&&kd[sf]?1<be.length?{type:kd[sf],data:be.substring(1)}:{type:kd[sf]}:ke}sf=(new Uint8Array(be))[0];be=Eb(be,1);df&&"blob"===Re&&(be=new df([be]));return{type:kd[sf],data:be}};vc.decodeBase64Packet=function(be,Re){var sf=kd[be.charAt(0)];if(!pd)return{type:sf,
data:{base64:!0,data:be.substr(1)}};be=pd.decode(be.substr(1));"blob"===Re&&df&&(be=new df([be]));return{type:sf,data:be}};vc.encodePayload=function(be,Re,sf){"function"===typeof Re&&(sf=Re,Re=null);var Df=ub(be);if(Re&&Df)return df&&!Mc?vc.encodePayloadAsBlob(be,sf):vc.encodePayloadAsArrayBuffer(be,sf);if(!be.length)return sf("0:");sb(be,function(If,vg){vc.encodePacket(If,Df?Re:!1,!1,function(Tg){vg(null,Tg.length+":"+Tg)})},function(If,vg){return sf(vg.join(""))})};vc.decodePayload=function(be,
Re,sf){if("string"!==typeof be)return vc.decodePayloadAsBinary(be,Re,sf);"function"===typeof Re&&(sf=Re,Re=null);if(""===be)return sf(ke,0,1);var Df="";for(var If,vg,Tg=0,lh=be.length;Tg<lh;Tg++)if(vg=be.charAt(Tg),":"!==vg)Df+=vg;else{if(""===Df||Df!=(If=Number(Df)))return sf(ke,0,1);vg=be.substr(Tg+1,If);if(Df!=vg.length)return sf(ke,0,1);if(vg.length){Df=vc.decodePacket(vg,Re,!1);if(ke.type===Df.type&&ke.data===Df.data)return sf(ke,0,1);if(!1===sf(Df,Tg+If,lh))return}Tg+=If;Df=""}if(""!==Df)return sf(ke,
0,1)};vc.encodePayloadAsArrayBuffer=function(be,Re){if(!be.length)return Re(new ArrayBuffer(0));sb(be,function(sf,Df){vc.encodePacket(sf,!0,!0,function(If){return Df(null,If)})},function(sf,Df){sf=Df.reduce(function(Tg,lh){lh="string"===typeof lh?lh.length:lh.byteLength;return Tg+lh.toString().length+lh+2},0);var If=new Uint8Array(sf),vg=0;Df.forEach(function(Tg){var lh="string"===typeof Tg,Oj=Tg;if(lh){Oj=new Uint8Array(Tg.length);for(var va=0;va<Tg.length;va++)Oj[va]=Tg.charCodeAt(va);Oj=Oj.buffer}lh?
If[vg++]=0:If[vg++]=1;Tg=Oj.byteLength.toString();for(va=0;va<Tg.length;va++)If[vg++]=parseInt(Tg[va]);If[vg++]=255;Oj=new Uint8Array(Oj);for(va=0;va<Oj.length;va++)If[vg++]=Oj[va]});return Re(If.buffer)})};vc.encodePayloadAsBlob=function(be,Re){sb(be,function(sf,Df){vc.encodePacket(sf,!0,!0,function(If){var vg=new Uint8Array(1);vg[0]=1;if("string"===typeof If){for(var Tg=new Uint8Array(If.length),lh=0;lh<If.length;lh++)Tg[lh]=If.charCodeAt(lh);If=Tg.buffer;vg[0]=0}Tg=(If instanceof ArrayBuffer?If.byteLength:
If.size).toString();var Oj=new Uint8Array(Tg.length+1);for(lh=0;lh<Tg.length;lh++)Oj[lh]=parseInt(Tg[lh]);Oj[Tg.length]=255;df&&(If=new df([vg.buffer,Oj.buffer,If]),Df(null,If))})},function(sf,Df){return Re(new df(Df))})};vc.decodePayloadAsBinary=function(be,Re,sf){"function"===typeof Re&&(sf=Re,Re=null);for(var Df=[];0<be.byteLength;){for(var If=new Uint8Array(be),vg=0===If[0],Tg="",lh=1;255!==If[lh];lh++){if(310<Tg.length)return sf(ke,0,1);Tg+=If[lh]}be=Eb(be,2+Tg.length);Tg=parseInt(Tg);If=Eb(be,
0,Tg);if(vg)try{If=String.fromCharCode.apply(null,new Uint8Array(If))}catch(va){for(vg=new Uint8Array(If),If="",lh=0;lh<vg.length;lh++)If+=String.fromCharCode(vg[lh])}Df.push(If);be=Eb(be,Tg)}var Oj=Df.length;Df.forEach(function(va,Ka){sf(vc.decodePacket(va,Re,!0),Ka,Oj)})};return vc}function xc(){function Ba(ub){(this||He).path=ub.path;(this||He).hostname=ub.hostname;(this||He).port=ub.port;(this||He).secure=ub.secure;(this||He).query=ub.query;(this||He).timestampParam=ub.timestampParam;(this||He).timestampRequests=
ub.timestampRequests;(this||He).readyState="";(this||He).agent=ub.agent||!1;(this||He).socket=ub.socket;(this||He).enablesXDR=ub.enablesXDR;(this||He).withCredentials=ub.withCredentials;(this||He).pfx=ub.pfx;(this||He).key=ub.key;(this||He).passphrase=ub.passphrase;(this||He).cert=ub.cert;(this||He).ca=ub.ca;(this||He).ciphers=ub.ciphers;(this||He).rejectUnauthorized=ub.rejectUnauthorized;(this||He).forceNode=ub.forceNode;(this||He).isReactNative=ub.isReactNative;(this||He).extraHeaders=ub.extraHeaders;
(this||He).localAddress=ub.localAddress}if(yd)return wd;yd=!0;var sb=pb(),Cb=md();wd=Ba;Cb(Ba.prototype);Ba.prototype.onError=function(ub,Eb){ub=Error(ub);ub.type="TransportError";ub.description=Eb;this.emit("error",ub);return this||He};Ba.prototype.open=function(){if("closed"===(this||He).readyState||""===(this||He).readyState)(this||He).readyState="opening",this.doOpen();return this||He};Ba.prototype.close=function(){if("opening"===(this||He).readyState||"open"===(this||He).readyState)this.doClose(),
this.onClose();return this||He};Ba.prototype.send=function(ub){if("open"===(this||He).readyState)this.write(ub);else throw Error("Transport not open");};Ba.prototype.onOpen=function(){(this||He).readyState="open";(this||He).writable=!0;this.emit("open")};Ba.prototype.onData=function(ub){ub=sb.decodePacket(ub,(this||He).socket.binaryType);this.onPacket(ub)};Ba.prototype.onPacket=function(ub){this.emit("packet",ub)};Ba.prototype.onClose=function(){(this||He).readyState="closed";this.emit("close")};
return wd}function Lc(){if(ng)return gf;ng=!0;gf.encode=function(Ba){var sb="",Cb;for(Cb in Ba)Ba.hasOwnProperty(Cb)&&(sb.length&&(sb+="&"),sb+=encodeURIComponent(Cb)+"="+encodeURIComponent(Ba[Cb]));return sb};gf.decode=function(Ba){var sb={};Ba=Ba.split("&");for(var Cb=0,ub=Ba.length;Cb<ub;Cb++){var Eb=Ba[Cb].split("=");sb[decodeURIComponent(Eb[0])]=decodeURIComponent(Eb[1])}return sb};return gf}function Ga(){if(Mi)return Jh;Mi=!0;return Jh=function(Ba,sb){var Cb=function(){};Cb.prototype=sb.prototype;
Ba.prototype=new Cb;Ba.prototype.constructor=Ba}}function Ra(){function Ba(pd){var lc="";do lc=Cb[pd%64]+lc,pd=Math.floor(pd/64);while(0<pd);return lc}function sb(){var pd=Ba(+new Date);return pd!==ld?(Eb=0,ld=pd):pd+"."+Ba(Eb++)}if(Mj)return Th;Mj=!0;for(var Cb="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),ub={},Eb=0,zc=0,ld;64>zc;zc++)ub[Cb[zc]]=zc;sb.encode=Ba;sb.decode=function(pd){var lc=0;for(zc=0;zc<pd.length;zc++)lc=64*lc+ub[pd.charAt(zc)];return lc};return Th=
sb}function rb(){function Ba(lc){var hc=lc&&lc.forceBase64;if(!pd||hc)(this||Lf).supportsBinary=!1;sb.call(this||Lf,lc)}if(el)return Kh;el=!0;var sb=xc(),Cb=Lc(),ub=pb(),Eb=Ga(),zc=Ra(),ld=ge()("engine.io-client:polling");Kh=Ba;var pd=null!=(new (fe())({xdomain:!1})).responseType;Eb(Ba,sb);Ba.prototype.name="polling";Ba.prototype.doOpen=function(){this.poll()};Ba.prototype.pause=function(lc){function hc(){ld("paused");Mc.readyState="paused";lc()}var Mc=this||Lf;(this||Lf).readyState="pausing";if((this||
Lf).polling||!(this||Lf).writable){var wb=0;(this||Lf).polling&&(ld("we are currently polling - waiting to pause"),wb++,this.once("pollComplete",function(){ld("pre-pause polling complete");--wb||hc()}));(this||Lf).writable||(ld("we are currently writing - waiting to pause"),wb++,this.once("drain",function(){ld("pre-pause writing complete");--wb||hc()}))}else hc()};Ba.prototype.poll=function(){ld("polling");(this||Lf).polling=!0;this.doPoll();this.emit("poll")};Ba.prototype.onData=function(lc){var hc=
this||Lf;ld("polling got data %s",lc);ub.decodePayload(lc,(this||Lf).socket.binaryType,function(Mc,wb,kd){if("opening"===hc.readyState)hc.onOpen();if("close"===Mc.type)return hc.onClose(),!1;hc.onPacket(Mc)});"closed"!==(this||Lf).readyState&&((this||Lf).polling=!1,this.emit("pollComplete"),"open"===(this||Lf).readyState?this.poll():ld('ignoring poll - transport state "%s"',(this||Lf).readyState))};Ba.prototype.doClose=function(){function lc(){ld("writing close packet");hc.write([{type:"close"}])}
var hc=this||Lf;"open"===(this||Lf).readyState?(ld("transport open - closing"),lc()):(ld("transport not open - deferring close"),this.once("open",lc))};Ba.prototype.write=function(lc){var hc=this||Lf;(this||Lf).writable=!1;var Mc=function(){hc.writable=!0;hc.emit("drain")};ub.encodePayload(lc,(this||Lf).supportsBinary,function(wb){hc.doWrite(wb,Mc)})};Ba.prototype.uri=function(){var lc=(this||Lf).query||{},hc=(this||Lf).secure?"https":"http",Mc="";!1!==(this||Lf).timestampRequests&&(lc[(this||Lf).timestampParam]=
zc());(this||Lf).supportsBinary||lc.sid||(lc.b64=1);lc=Cb.encode(lc);(this||Lf).port&&("https"===hc&&443!==Number((this||Lf).port)||"http"===hc&&80!==Number((this||Lf).port))&&(Mc=":"+(this||Lf).port);lc.length&&(lc="?"+lc);var wb=-1!==(this||Lf).hostname.indexOf(":");return hc+"://"+(wb?"["+(this||Lf).hostname+"]":(this||Lf).hostname)+Mc+(this||Lf).path+lc};return Kh}function Kb(){function Ba(){}function sb(Mc){zc.call(this||Je,Mc);(this||Je).requestTimeout=Mc.requestTimeout;(this||Je).extraHeaders=
Mc.extraHeaders;if("undefined"!==typeof location){var wb="https:"===location.protocol,kd=location.port;kd||(kd=wb?443:80);(this||Je).xd="undefined"!==typeof location&&Mc.hostname!==location.hostname||kd!==Mc.port;(this||Je).xs=Mc.secure!==wb}}function Cb(Mc){(this||Je).method=Mc.method||"GET";(this||Je).uri=Mc.uri;(this||Je).xd=!!Mc.xd;(this||Je).xs=!!Mc.xs;(this||Je).async=!1!==Mc.async;(this||Je).data=void 0!==Mc.data?Mc.data:null;(this||Je).agent=Mc.agent;(this||Je).isBinary=Mc.isBinary;(this||
Je).supportsBinary=Mc.supportsBinary;(this||Je).enablesXDR=Mc.enablesXDR;(this||Je).withCredentials=Mc.withCredentials;(this||Je).requestTimeout=Mc.requestTimeout;(this||Je).pfx=Mc.pfx;(this||Je).key=Mc.key;(this||Je).passphrase=Mc.passphrase;(this||Je).cert=Mc.cert;(this||Je).ca=Mc.ca;(this||Je).ciphers=Mc.ciphers;(this||Je).rejectUnauthorized=Mc.rejectUnauthorized;(this||Je).extraHeaders=Mc.extraHeaders;this.create()}function ub(){for(var Mc in Cb.requests)Cb.requests.hasOwnProperty(Mc)&&Cb.requests[Mc].abort()}
if(qi)return Wj;qi=!0;var Eb=fe(),zc=rb(),ld=md(),pd=Ga(),lc=ge()("engine.io-client:polling-xhr"),hc=gd();Wj=sb;Wj.Request=Cb;pd(sb,zc);sb.prototype.supportsBinary=!0;sb.prototype.request=function(Mc){Mc=Mc||{};Mc.uri=this.uri();Mc.xd=(this||Je).xd;Mc.xs=(this||Je).xs;Mc.agent=(this||Je).agent||!1;Mc.supportsBinary=(this||Je).supportsBinary;Mc.enablesXDR=(this||Je).enablesXDR;Mc.withCredentials=(this||Je).withCredentials;Mc.pfx=(this||Je).pfx;Mc.key=(this||Je).key;Mc.passphrase=(this||Je).passphrase;
Mc.cert=(this||Je).cert;Mc.ca=(this||Je).ca;Mc.ciphers=(this||Je).ciphers;Mc.rejectUnauthorized=(this||Je).rejectUnauthorized;Mc.requestTimeout=(this||Je).requestTimeout;Mc.extraHeaders=(this||Je).extraHeaders;return new Cb(Mc)};sb.prototype.doWrite=function(Mc,wb){Mc=this.request({method:"POST",data:Mc,isBinary:"string"!==typeof Mc&&void 0!==Mc});var kd=this||Je;Mc.on("success",wb);Mc.on("error",function(ke){kd.onError("xhr post error",ke)});(this||Je).sendXhr=Mc};sb.prototype.doPoll=function(){lc("xhr poll");
var Mc=this.request(),wb=this||Je;Mc.on("data",function(kd){wb.onData(kd)});Mc.on("error",function(kd){wb.onError("xhr poll error",kd)});(this||Je).pollXhr=Mc};ld(Cb.prototype);Cb.prototype.create=function(){var Mc={agent:(this||Je).agent,xdomain:(this||Je).xd,xscheme:(this||Je).xs,enablesXDR:(this||Je).enablesXDR};Mc.pfx=(this||Je).pfx;Mc.key=(this||Je).key;Mc.passphrase=(this||Je).passphrase;Mc.cert=(this||Je).cert;Mc.ca=(this||Je).ca;Mc.ciphers=(this||Je).ciphers;Mc.rejectUnauthorized=(this||Je).rejectUnauthorized;
var wb=(this||Je).xhr=new Eb(Mc),kd=this||Je;try{lc("xhr open %s: %s",(this||Je).method,(this||Je).uri);wb.open((this||Je).method,(this||Je).uri,(this||Je).async);try{if((this||Je).extraHeaders){wb.setDisableHeaderCheck&&wb.setDisableHeaderCheck(!0);for(var ke in(this||Je).extraHeaders)(this||Je).extraHeaders.hasOwnProperty(ke)&&wb.setRequestHeader(ke,(this||Je).extraHeaders[ke])}}catch(df){}if("POST"===(this||Je).method)try{(this||Je).isBinary?wb.setRequestHeader("Content-type","application/octet-stream"):
wb.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(df){}try{wb.setRequestHeader("Accept","*/*")}catch(df){}"withCredentials"in wb&&(wb.withCredentials=(this||Je).withCredentials);(this||Je).requestTimeout&&(wb.timeout=(this||Je).requestTimeout);this.hasXDR()?(wb.onload=function(){kd.onLoad()},wb.onerror=function(){kd.onError(wb.responseText)}):wb.onreadystatechange=function(){if(2===wb.readyState)try{var df=wb.getResponseHeader("Content-Type");if(kd.supportsBinary&&"application/octet-stream"===
df||"application/octet-stream; charset=UTF-8"===df)wb.responseType="arraybuffer"}catch(be){}if(4===wb.readyState)if(200===wb.status||1223===wb.status)kd.onLoad();else setTimeout(function(){kd.onError("number"===typeof wb.status?wb.status:0)},0)};lc("xhr data %s",(this||Je).data);wb.send((this||Je).data)}catch(df){setTimeout(function(){kd.onError(df)},0);return}"undefined"!==typeof document&&((this||Je).index=Cb.requestsCount++,Cb.requests[(this||Je).index]=this||Je)};Cb.prototype.onSuccess=function(){this.emit("success");
this.cleanup()};Cb.prototype.onData=function(Mc){this.emit("data",Mc);this.onSuccess()};Cb.prototype.onError=function(Mc){this.emit("error",Mc);this.cleanup(!0)};Cb.prototype.cleanup=function(Mc){if("undefined"!==typeof(this||Je).xhr&&null!==(this||Je).xhr){this.hasXDR()?(this||Je).xhr.onload=(this||Je).xhr.onerror=Ba:(this||Je).xhr.onreadystatechange=Ba;if(Mc)try{(this||Je).xhr.abort()}catch(wb){}"undefined"!==typeof document&&delete Cb.requests[(this||Je).index];(this||Je).xhr=null}};Cb.prototype.onLoad=
function(){try{try{var Mc=(this||Je).xhr.getResponseHeader("Content-Type")}catch(kd){}var wb="application/octet-stream"===Mc||"application/octet-stream; charset=UTF-8"===Mc?(this||Je).xhr.response||(this||Je).xhr.responseText:(this||Je).xhr.responseText}catch(kd){this.onError(kd)}if(null!=wb)this.onData(wb)};Cb.prototype.hasXDR=function(){return"undefined"!==typeof XDomainRequest&&!(this||Je).xs&&(this||Je).enablesXDR};Cb.prototype.abort=function(){this.cleanup()};Cb.requestsCount=0;Cb.requests={};
"undefined"!==typeof document&&("function"===typeof attachEvent?attachEvent("onunload",ub):"function"===typeof addEventListener&&addEventListener("onpagehide"in hc?"pagehide":"unload",ub,!1));return Wj}function Ib(){function Ba(){}function sb(lc){Cb.call(this||bh,lc);(this||bh).query=(this||bh).query||{};pd||(pd=Eb.___eio=Eb.___eio||[]);(this||bh).index=pd.length;var hc=this||bh;pd.push(function(Mc){hc.onData(Mc)});(this||bh).query.j=(this||bh).index;"function"===typeof addEventListener&&addEventListener("beforeunload",
function(){hc.script&&(hc.script.onerror=Ba)},!1)}if(em)return Nk;em=!0;var Cb=rb(),ub=Ga(),Eb=gd();Nk=sb;var zc=/\n/g,ld=/\\n/g,pd;ub(sb,Cb);sb.prototype.supportsBinary=!1;sb.prototype.doClose=function(){(this||bh).script&&((this||bh).script.parentNode.removeChild((this||bh).script),(this||bh).script=null);(this||bh).form&&((this||bh).form.parentNode.removeChild((this||bh).form),(this||bh).form=null,(this||bh).iframe=null);Cb.prototype.doClose.call(this||bh)};sb.prototype.doPoll=function(){var lc=
this||bh,hc=document.createElement("script");(this||bh).script&&((this||bh).script.parentNode.removeChild((this||bh).script),(this||bh).script=null);hc.async=!0;hc.src=this.uri();hc.onerror=function(wb){lc.onError("jsonp poll error",wb)};var Mc=document.getElementsByTagName("script")[0];Mc?Mc.parentNode.insertBefore(hc,Mc):(document.head||document.body).appendChild(hc);(this||bh).script=hc;"undefined"!==typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var wb=document.createElement("iframe");
document.body.appendChild(wb);document.body.removeChild(wb)},100)};sb.prototype.doWrite=function(lc,hc){function Mc(){wb();hc()}function wb(){if(kd.iframe)try{kd.form.removeChild(kd.iframe)}catch(sf){kd.onError("jsonp polling iframe removal error",sf)}try{Re=document.createElement('<iframe src="javascript:0" name="'+kd.iframeId+'">')}catch(sf){Re=document.createElement("iframe"),Re.name=kd.iframeId,Re.src="javascript:0"}Re.id=kd.iframeId;kd.form.appendChild(Re);kd.iframe=Re}var kd=this||bh;if(!(this||
bh).form){var ke=document.createElement("form"),df=document.createElement("textarea"),be=(this||bh).iframeId="eio_iframe_"+(this||bh).index,Re;ke.className="socketio";ke.style.position="absolute";ke.style.top="-1000px";ke.style.left="-1000px";ke.target=be;ke.method="POST";ke.setAttribute("accept-charset","utf-8");df.name="d";ke.appendChild(df);document.body.appendChild(ke);(this||bh).form=ke;(this||bh).area=df}(this||bh).form.action=this.uri();wb();lc=lc.replace(ld,"\\\n");(this||bh).area.value=lc.replace(zc,
"\\n");try{(this||bh).form.submit()}catch(sf){}(this||bh).iframe.attachEvent?(this||bh).iframe.onreadystatechange=function(){"complete"===kd.iframe.readyState&&Mc()}:(this||bh).iframe.onload=Mc};return Nk}function gb(){if(Cl)return uk;Cl=!0;return uk=function(){throw Error("ws does not work in the browser. Browser clients must use the native WebSocket object");}}function ib(){function Ba(wb){wb&&wb.forceBase64&&((this||sg).supportsBinary=!1);(this||sg).perMessageDeflate=wb.perMessageDeflate;(this||
sg).usingBrowserWebSocket=lc&&!wb.forceNode;(this||sg).protocols=wb.protocols;(this||sg).usingBrowserWebSocket||(Mc=hc);Cb.call(this||sg,wb)}if(ok)return Dl;ok=!0;var sb=cc.Buffer,Cb=xc(),ub=pb(),Eb=Lc(),zc=Ga(),ld=Ra(),pd=ge()("engine.io-client:websocket"),lc;"undefined"!==typeof WebSocket?lc=WebSocket:"undefined"!==typeof self&&(lc=self.WebSocket||self.MozWebSocket);if("undefined"===typeof window)try{var hc=gb()}catch(wb){}var Mc=lc||hc;Dl=Ba;zc(Ba,Cb);Ba.prototype.name="websocket";Ba.prototype.supportsBinary=
!0;Ba.prototype.doOpen=function(){if(this.check()){var wb=this.uri(),kd=(this||sg).protocols,ke={};(this||sg).isReactNative||(ke.agent=(this||sg).agent,ke.perMessageDeflate=(this||sg).perMessageDeflate,ke.pfx=(this||sg).pfx,ke.key=(this||sg).key,ke.passphrase=(this||sg).passphrase,ke.cert=(this||sg).cert,ke.ca=(this||sg).ca,ke.ciphers=(this||sg).ciphers,ke.rejectUnauthorized=(this||sg).rejectUnauthorized);(this||sg).extraHeaders&&(ke.headers=(this||sg).extraHeaders);(this||sg).localAddress&&(ke.localAddress=
(this||sg).localAddress);try{(this||sg).ws=(this||sg).usingBrowserWebSocket&&!(this||sg).isReactNative?kd?new Mc(wb,kd):new Mc(wb):new Mc(wb,kd,ke)}catch(df){return this.emit("error",df)}void 0===(this||sg).ws.binaryType&&((this||sg).supportsBinary=!1);(this||sg).ws.supports&&(this||sg).ws.supports.binary?((this||sg).supportsBinary=!0,(this||sg).ws.binaryType="nodebuffer"):(this||sg).ws.binaryType="arraybuffer";this.addEventListeners()}};Ba.prototype.addEventListeners=function(){var wb=this||sg;(this||
sg).ws.onopen=function(){wb.onOpen()};(this||sg).ws.onclose=function(){wb.onClose()};(this||sg).ws.onmessage=function(kd){wb.onData(kd.data)};(this||sg).ws.onerror=function(kd){wb.onError("websocket error",kd)}};Ba.prototype.write=function(wb){function kd(){ke.emit("flush");setTimeout(function(){ke.writable=!0;ke.emit("drain")},0)}var ke=this||sg;(this||sg).writable=!1;for(var df=wb.length,be=0,Re=df;be<Re;be++)(function(sf){ub.encodePacket(sf,ke.supportsBinary,function(Df){if(!ke.usingBrowserWebSocket){var If=
{};sf.options&&(If.compress=sf.options.compress);ke.perMessageDeflate&&("string"===typeof Df?sb.byteLength(Df):Df.length)<ke.perMessageDeflate.threshold&&(If.compress=!1)}try{ke.usingBrowserWebSocket?ke.ws.send(Df):ke.ws.send(Df,If)}catch(vg){pd("websocket closed before onclose event")}--df||kd()})})(wb[be])};Ba.prototype.onClose=function(){Cb.prototype.onClose.call(this||sg)};Ba.prototype.doClose=function(){"undefined"!==typeof(this||sg).ws&&(this||sg).ws.close()};Ba.prototype.uri=function(){var wb=
(this||sg).query||{},kd=(this||sg).secure?"wss":"ws",ke="";(this||sg).port&&("wss"===kd&&443!==Number((this||sg).port)||"ws"===kd&&80!==Number((this||sg).port))&&(ke=":"+(this||sg).port);(this||sg).timestampRequests&&(wb[(this||sg).timestampParam]=ld());(this||sg).supportsBinary||(wb.b64=1);wb=Eb.encode(wb);wb.length&&(wb="?"+wb);var df=-1!==(this||sg).hostname.indexOf(":");return kd+"://"+(df?"["+(this||sg).hostname+"]":(this||sg).hostname)+ke+(this||sg).path+wb};Ba.prototype.check=function(){return!!Mc&&
!("__initialize"in Mc&&(this||sg).name===Ba.prototype.name)};return Dl}function Lb(){if($m)return Vf;$m=!0;var Ba=fe(),sb=Kb(),Cb=Ib(),ub=ib();Vf.polling=function(Eb){var zc=!1,ld=!1,pd=!1!==Eb.jsonp;"undefined"!==typeof location&&(ld="https:"===location.protocol,(zc=location.port)||(zc=ld?443:80),zc=Eb.hostname!==location.hostname||zc!==Eb.port,ld=Eb.secure!==ld);Eb.xdomain=zc;Eb.xscheme=ld;if("open"in new Ba(Eb)&&!Eb.forceJSONP)return new sb(Eb);if(!pd)throw Error("JSONP disabled");return new Cb(Eb)};
Vf.websocket=ub;return Vf}function tc(){if(zd)return Ub;zd=!0;var Ba=[].indexOf;return Ub=function(sb,Cb){if(Ba)return sb.indexOf(Cb);for(var ub=0;ub<sb.length;++ub)if(sb[ub]===Cb)return ub;return-1}}function Qc(){function Ba(lc,hc){if(!((this||hd)instanceof Ba))return new Ba(lc,hc);hc=hc||{};lc&&"object"===typeof lc&&(hc=lc,lc=null);lc?(lc=ld(lc),hc.hostname=lc.host,hc.secure="https"===lc.protocol||"wss"===lc.protocol,hc.port=lc.port,lc.query&&(hc.query=lc.query)):hc.host&&(hc.hostname=ld(hc.host).host);
(this||hd).secure=null!=hc.secure?hc.secure:"undefined"!==typeof location&&"https:"===location.protocol;hc.hostname&&!hc.port&&(hc.port=(this||hd).secure?"443":"80");(this||hd).agent=hc.agent||!1;(this||hd).hostname=hc.hostname||("undefined"!==typeof location?location.hostname:"localhost");(this||hd).port=hc.port||("undefined"!==typeof location&&location.port?location.port:(this||hd).secure?443:80);(this||hd).query=hc.query||{};"string"===typeof(this||hd).query&&((this||hd).query=pd.decode((this||
hd).query));(this||hd).upgrade=!1!==hc.upgrade;(this||hd).path=(hc.path||"/engine.io").replace(/\/$/,"")+"/";(this||hd).forceJSONP=!!hc.forceJSONP;(this||hd).jsonp=!1!==hc.jsonp;(this||hd).forceBase64=!!hc.forceBase64;(this||hd).enablesXDR=!!hc.enablesXDR;(this||hd).withCredentials=!1!==hc.withCredentials;(this||hd).timestampParam=hc.timestampParam||"t";(this||hd).timestampRequests=hc.timestampRequests;(this||hd).transports=hc.transports||["polling","websocket"];(this||hd).transportOptions=hc.transportOptions||
{};(this||hd).readyState="";(this||hd).writeBuffer=[];(this||hd).prevBufferLen=0;(this||hd).policyPort=hc.policyPort||843;(this||hd).rememberUpgrade=hc.rememberUpgrade||!1;(this||hd).binaryType=null;(this||hd).onlyBinaryUpgrades=hc.onlyBinaryUpgrades;(this||hd).perMessageDeflate=!1!==hc.perMessageDeflate?hc.perMessageDeflate||{}:!1;!0===(this||hd).perMessageDeflate&&((this||hd).perMessageDeflate={});(this||hd).perMessageDeflate&&null==(this||hd).perMessageDeflate.threshold&&((this||hd).perMessageDeflate.threshold=
1024);(this||hd).pfx=hc.pfx||null;(this||hd).key=hc.key||null;(this||hd).passphrase=hc.passphrase||null;(this||hd).cert=hc.cert||null;(this||hd).ca=hc.ca||null;(this||hd).ciphers=hc.ciphers||null;(this||hd).rejectUnauthorized=void 0===hc.rejectUnauthorized?!0:hc.rejectUnauthorized;(this||hd).forceNode=!!hc.forceNode;(this||hd).isReactNative="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();if("undefined"===typeof self||(this||hd).isReactNative)hc.extraHeaders&&
0<Object.keys(hc.extraHeaders).length&&((this||hd).extraHeaders=hc.extraHeaders),hc.localAddress&&((this||hd).localAddress=hc.localAddress);(this||hd).id=null;(this||hd).upgrades=null;(this||hd).pingInterval=null;(this||hd).pingTimeout=null;(this||hd).pingIntervalTimer=null;(this||hd).pingTimeoutTimer=null;this.open()}if(Ec)return Ce;Ec=!0;var sb=Lb(),Cb=md(),ub=ge()("engine.io-client:socket"),Eb=tc(),zc=pb(),ld=Pc(),pd=Lc();Ce=Ba;Ba.priorWebsocketSuccess=!1;Cb(Ba.prototype);Ba.protocol=zc.protocol;
Ba.Socket=Ba;Ba.Transport=xc();Ba.transports=Lb();Ba.parser=pb();Ba.prototype.createTransport=function(lc){ub('creating transport "%s"',lc);var hc=(this||hd).query,Mc={},wb;for(wb in hc)hc.hasOwnProperty(wb)&&(Mc[wb]=hc[wb]);Mc.EIO=zc.protocol;Mc.transport=lc;hc=(this||hd).transportOptions[lc]||{};(this||hd).id&&(Mc.sid=(this||hd).id);return new sb[lc]({query:Mc,socket:this||hd,agent:hc.agent||(this||hd).agent,hostname:hc.hostname||(this||hd).hostname,port:hc.port||(this||hd).port,secure:hc.secure||
(this||hd).secure,path:hc.path||(this||hd).path,forceJSONP:hc.forceJSONP||(this||hd).forceJSONP,jsonp:hc.jsonp||(this||hd).jsonp,forceBase64:hc.forceBase64||(this||hd).forceBase64,enablesXDR:hc.enablesXDR||(this||hd).enablesXDR,withCredentials:hc.withCredentials||(this||hd).withCredentials,timestampRequests:hc.timestampRequests||(this||hd).timestampRequests,timestampParam:hc.timestampParam||(this||hd).timestampParam,policyPort:hc.policyPort||(this||hd).policyPort,pfx:hc.pfx||(this||hd).pfx,key:hc.key||
(this||hd).key,passphrase:hc.passphrase||(this||hd).passphrase,cert:hc.cert||(this||hd).cert,ca:hc.ca||(this||hd).ca,ciphers:hc.ciphers||(this||hd).ciphers,rejectUnauthorized:hc.rejectUnauthorized||(this||hd).rejectUnauthorized,perMessageDeflate:hc.perMessageDeflate||(this||hd).perMessageDeflate,extraHeaders:hc.extraHeaders||(this||hd).extraHeaders,forceNode:hc.forceNode||(this||hd).forceNode,localAddress:hc.localAddress||(this||hd).localAddress,requestTimeout:hc.requestTimeout||(this||hd).requestTimeout,
protocols:hc.protocols||void 0,isReactNative:(this||hd).isReactNative})};Ba.prototype.open=function(){if((this||hd).rememberUpgrade&&Ba.priorWebsocketSuccess&&-1!==(this||hd).transports.indexOf("websocket"))var lc="websocket";else{if(0===(this||hd).transports.length){var hc=this||hd;setTimeout(function(){hc.emit("error","No transports available")},0);return}lc=(this||hd).transports[0]}(this||hd).readyState="opening";try{lc=this.createTransport(lc)}catch(Mc){(this||hd).transports.shift();this.open();
return}lc.open();this.setTransport(lc)};Ba.prototype.setTransport=function(lc){ub("setting transport %s",lc.name);var hc=this||hd;(this||hd).transport&&(ub("clearing existing transport %s",(this||hd).transport.name),(this||hd).transport.removeAllListeners());(this||hd).transport=lc;lc.on("drain",function(){hc.onDrain()}).on("packet",function(Mc){hc.onPacket(Mc)}).on("error",function(Mc){hc.onError(Mc)}).on("close",function(){hc.onClose("transport close")})};Ba.prototype.probe=function(lc){function hc(){if(Df.onlyBinaryUpgrades){var If=
!(this||hd).supportsBinary&&Df.transport.supportsBinary;sf=sf||If}sf||(ub('probe transport "%s" opened',lc),Re.send([{type:"ping",data:"probe"}]),Re.once("packet",function(vg){sf||("pong"===vg.type&&"probe"===vg.data?(ub('probe transport "%s" pong',lc),Df.upgrading=!0,Df.emit("upgrading",Re),Re&&(Ba.priorWebsocketSuccess="websocket"===Re.name,ub('pausing current transport "%s"',Df.transport.name),Df.transport.pause(function(){sf||"closed"===Df.readyState||(ub("changing transport and sending upgrade packet"),
be(),Df.setTransport(Re),Re.send([{type:"upgrade"}]),Df.emit("upgrade",Re),Re=null,Df.upgrading=!1,Df.flush())}))):(ub('probe transport "%s" failed',lc),vg=Error("probe error"),vg.transport=Re.name,Df.emit("upgradeError",vg)))}))}function Mc(){sf||(sf=!0,be(),Re.close(),Re=null)}function wb(If){var vg=Error("probe error: "+If);vg.transport=Re.name;Mc();ub('probe transport "%s" failed because of error: %s',lc,If);Df.emit("upgradeError",vg)}function kd(){wb("transport closed")}function ke(){wb("socket closed")}
function df(If){Re&&If.name!==Re.name&&(ub('"%s" works - aborting "%s"',If.name,Re.name),Mc())}function be(){Re.removeListener("open",hc);Re.removeListener("error",wb);Re.removeListener("close",kd);Df.removeListener("close",ke);Df.removeListener("upgrading",df)}ub('probing transport "%s"',lc);var Re=this.createTransport(lc,{probe:1}),sf=!1,Df=this||hd;Ba.priorWebsocketSuccess=!1;Re.once("open",hc);Re.once("error",wb);Re.once("close",kd);this.once("close",ke);this.once("upgrading",df);Re.open()};Ba.prototype.onOpen=
function(){ub("socket open");(this||hd).readyState="open";Ba.priorWebsocketSuccess="websocket"===(this||hd).transport.name;this.emit("open");this.flush();if("open"===(this||hd).readyState&&(this||hd).upgrade&&(this||hd).transport.pause){ub("starting upgrade probes");for(var lc=0,hc=(this||hd).upgrades.length;lc<hc;lc++)this.probe((this||hd).upgrades[lc])}};Ba.prototype.onPacket=function(lc){if("opening"===(this||hd).readyState||"open"===(this||hd).readyState||"closing"===(this||hd).readyState)switch(ub('socket receive: type "%s", data "%s"',
lc.type,lc.data),this.emit("packet",lc),this.emit("heartbeat"),lc.type){case "open":this.onHandshake(JSON.parse(lc.data));break;case "pong":this.setPing();this.emit("pong");break;case "error":var hc=Error("server error");hc.code=lc.data;this.onError(hc);break;case "message":this.emit("data",lc.data),this.emit("message",lc.data)}else ub('packet received with socket readyState "%s"',(this||hd).readyState)};Ba.prototype.onHandshake=function(lc){this.emit("handshake",lc);(this||hd).id=lc.sid;(this||hd).transport.query.sid=
lc.sid;(this||hd).upgrades=this.filterUpgrades(lc.upgrades);(this||hd).pingInterval=lc.pingInterval;(this||hd).pingTimeout=lc.pingTimeout;this.onOpen();"closed"!==(this||hd).readyState&&(this.setPing(),this.removeListener("heartbeat",(this||hd).onHeartbeat),this.on("heartbeat",(this||hd).onHeartbeat))};Ba.prototype.onHeartbeat=function(lc){clearTimeout((this||hd).pingTimeoutTimer);var hc=this||hd;hc.pingTimeoutTimer=setTimeout(function(){if("closed"!==hc.readyState)hc.onClose("ping timeout")},lc||
hc.pingInterval+hc.pingTimeout)};Ba.prototype.setPing=function(){var lc=this||hd;clearTimeout(lc.pingIntervalTimer);lc.pingIntervalTimer=setTimeout(function(){ub("writing ping packet - expecting pong within %sms",lc.pingTimeout);lc.ping();lc.onHeartbeat(lc.pingTimeout)},lc.pingInterval)};Ba.prototype.ping=function(){var lc=this||hd;this.sendPacket("ping",function(){lc.emit("ping")})};Ba.prototype.onDrain=function(){(this||hd).writeBuffer.splice(0,(this||hd).prevBufferLen);(this||hd).prevBufferLen=
0;0===(this||hd).writeBuffer.length?this.emit("drain"):this.flush()};Ba.prototype.flush=function(){"closed"!==(this||hd).readyState&&(this||hd).transport.writable&&!(this||hd).upgrading&&(this||hd).writeBuffer.length&&(ub("flushing %d packets in socket",(this||hd).writeBuffer.length),(this||hd).transport.send((this||hd).writeBuffer),(this||hd).prevBufferLen=(this||hd).writeBuffer.length,this.emit("flush"))};Ba.prototype.write=Ba.prototype.send=function(lc,hc,Mc){this.sendPacket("message",lc,hc,Mc);
return this||hd};Ba.prototype.sendPacket=function(lc,hc,Mc,wb){"function"===typeof hc&&(wb=hc,hc=void 0);"function"===typeof Mc&&(wb=Mc,Mc=null);if("closing"!==(this||hd).readyState&&"closed"!==(this||hd).readyState){Mc=Mc||{};Mc.compress=!1!==Mc.compress;lc={type:lc,data:hc,options:Mc};this.emit("packetCreate",lc);(this||hd).writeBuffer.push(lc);if(wb)this.once("flush",wb);this.flush()}};Ba.prototype.close=function(){function lc(){wb.onClose("forced close");ub("socket closing - telling transport to close");
wb.transport.close()}function hc(){wb.removeListener("upgrade",hc);wb.removeListener("upgradeError",hc);lc()}function Mc(){wb.once("upgrade",hc);wb.once("upgradeError",hc)}if("opening"===(this||hd).readyState||"open"===(this||hd).readyState){(this||hd).readyState="closing";var wb=this||hd;if((this||hd).writeBuffer.length)this.once("drain",function(){(this||hd).upgrading?Mc():lc()});else(this||hd).upgrading?Mc():lc()}return this||hd};Ba.prototype.onError=function(lc){ub("socket error %j",lc);Ba.priorWebsocketSuccess=
!1;this.emit("error",lc);this.onClose("transport error",lc)};Ba.prototype.onClose=function(lc,hc){if("opening"===(this||hd).readyState||"open"===(this||hd).readyState||"closing"===(this||hd).readyState){ub('socket close with reason: "%s"',lc);var Mc=this||hd;clearTimeout((this||hd).pingIntervalTimer);clearTimeout((this||hd).pingTimeoutTimer);(this||hd).transport.removeAllListeners("close");(this||hd).transport.close();(this||hd).transport.removeAllListeners();(this||hd).readyState="closed";(this||
hd).id=null;this.emit("close",lc,hc);Mc.writeBuffer=[];Mc.prevBufferLen=0}};Ba.prototype.filterUpgrades=function(lc){for(var hc=[],Mc=0,wb=lc.length;Mc<wb;Mc++)~Eb((this||hd).transports,lc[Mc])&&hc.push(lc[Mc]);return hc};return Ce}function sc(){if(wn)return Zm;wn=!0;return Zm=function(Ba,sb){for(var Cb=[],ub=(sb=sb||0)||0;ub<Ba.length;ub++)Cb[ub-sb]=Ba[ub];return Cb}}function Vc(){if(yo)return xo;yo=!0;return xo=function(Ba,sb,Cb){Ba.on(sb,Cb);return{destroy:function(){Ba.removeListener(sb,Cb)}}}}
function Q(){if(xn)return zo;xn=!0;var Ba=[].slice;return zo=function(sb,Cb){"string"==typeof Cb&&(Cb=sb[Cb]);if("function"!=typeof Cb)throw Error("bind() requires a function");var ub=Ba.call(arguments,2);return function(){return Cb.apply(sb,ub.concat(Ba.call(arguments)))}}}function fa(){function Ba(wb,kd,ke){(this||vf).io=wb;(this||vf).nsp=kd;(this||vf).json=this||vf;(this||vf).ids=0;(this||vf).acks={};(this||vf).receiveBuffer=[];(this||vf).sendBuffer=[];(this||vf).connected=!1;(this||vf).disconnected=
!0;(this||vf).flags={};ke&&ke.query&&((this||vf).query=ke.query);(this||vf).io.autoConnect&&this.open()}if(yn)return Vj;yn=!0;var sb=ic(),Cb=md(),ub=sc(),Eb=Vc(),zc=Q(),ld=ge()("socket.io-client:socket"),pd=Lc(),lc=qc();Vj=Vj=Ba;var hc={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},Mc=Cb.prototype.emit;Cb(Ba.prototype);Ba.prototype.subEvents=function(){if(!(this||vf).subs){var wb=
(this||vf).io;(this||vf).subs=[Eb(wb,"open",zc(this||vf,"onopen")),Eb(wb,"packet",zc(this||vf,"onpacket")),Eb(wb,"close",zc(this||vf,"onclose"))]}};Ba.prototype.open=Ba.prototype.connect=function(){if((this||vf).connected)return this||vf;this.subEvents();(this||vf).io.reconnecting||(this||vf).io.open();if("open"===(this||vf).io.readyState)this.onopen();this.emit("connecting");return this||vf};Ba.prototype.send=function(){var wb=ub(arguments);wb.unshift("message");(this||vf).emit.apply(this||vf,wb);
return this||vf};Ba.prototype.emit=function(wb){if(hc.hasOwnProperty(wb))return Mc.apply(this||vf,arguments),this||vf;var kd=ub(arguments),ke={type:(void 0!==(this||vf).flags.binary?(this||vf).flags.binary:lc(kd))?sb.BINARY_EVENT:sb.EVENT,data:kd,options:{}};ke.options.compress=!(this||vf).flags||!1!==(this||vf).flags.compress;"function"===typeof kd[kd.length-1]&&(ld("emitting packet with ack id %d",(this||vf).ids),(this||vf).acks[(this||vf).ids]=kd.pop(),ke.id=(this||vf).ids++);(this||vf).connected?
this.packet(ke):(this||vf).sendBuffer.push(ke);(this||vf).flags={};return this||vf};Ba.prototype.packet=function(wb){wb.nsp=(this||vf).nsp;(this||vf).io.packet(wb)};Ba.prototype.onopen=function(){ld("transport is open - connecting");if("/"!==(this||vf).nsp)if((this||vf).query){var wb="object"===typeof(this||vf).query?pd.encode((this||vf).query):(this||vf).query;ld("sending connect packet with query %s",wb);this.packet({type:sb.CONNECT,query:wb})}else this.packet({type:sb.CONNECT})};Ba.prototype.onclose=
function(wb){ld("close (%s)",wb);(this||vf).connected=!1;(this||vf).disconnected=!0;delete (this||vf).id;this.emit("disconnect",wb)};Ba.prototype.onpacket=function(wb){var kd=wb.type===sb.ERROR&&"/"===wb.nsp;if(wb.nsp===(this||vf).nsp||kd)switch(wb.type){case sb.CONNECT:this.onconnect();break;case sb.EVENT:this.onevent(wb);break;case sb.BINARY_EVENT:this.onevent(wb);break;case sb.ACK:this.onack(wb);break;case sb.BINARY_ACK:this.onack(wb);break;case sb.DISCONNECT:this.ondisconnect();break;case sb.ERROR:this.emit("error",
wb.data)}};Ba.prototype.onevent=function(wb){var kd=wb.data||[];ld("emitting event %j",kd);null!=wb.id&&(ld("attaching ack callback to event"),kd.push(this.ack(wb.id)));(this||vf).connected?Mc.apply(this||vf,kd):(this||vf).receiveBuffer.push(kd)};Ba.prototype.ack=function(wb){var kd=this||vf,ke=!1;return function(){if(!ke){ke=!0;var df=ub(arguments);ld("sending ack %j",df);kd.packet({type:lc(df)?sb.BINARY_ACK:sb.ACK,id:wb,data:df})}}};Ba.prototype.onack=function(wb){var kd=(this||vf).acks[wb.id];
"function"===typeof kd?(ld("calling ack %s with %j",wb.id,wb.data),kd.apply(this||vf,wb.data),delete (this||vf).acks[wb.id]):ld("bad ack %s",wb.id)};Ba.prototype.onconnect=function(){(this||vf).connected=!0;(this||vf).disconnected=!1;this.emit("connect");this.emitBuffered()};Ba.prototype.emitBuffered=function(){var wb;for(wb=0;wb<(this||vf).receiveBuffer.length;wb++)Mc.apply(this||vf,(this||vf).receiveBuffer[wb]);(this||vf).receiveBuffer=[];for(wb=0;wb<(this||vf).sendBuffer.length;wb++)this.packet((this||
vf).sendBuffer[wb]);(this||vf).sendBuffer=[]};Ba.prototype.ondisconnect=function(){ld("server disconnect (%s)",(this||vf).nsp);this.destroy();this.onclose("io server disconnect")};Ba.prototype.destroy=function(){if((this||vf).subs){for(var wb=0;wb<(this||vf).subs.length;wb++)(this||vf).subs[wb].destroy();(this||vf).subs=null}(this||vf).io.destroy(this||vf)};Ba.prototype.close=Ba.prototype.disconnect=function(){(this||vf).connected&&(ld("performing disconnect (%s)",(this||vf).nsp),this.packet({type:sb.DISCONNECT}));
this.destroy();if((this||vf).connected)this.onclose("io client disconnect");return this||vf};Ba.prototype.compress=function(wb){(this||vf).flags.compress=wb;return this||vf};Ba.prototype.binary=function(wb){(this||vf).flags.binary=wb;return this||vf};return Vj}function Ia(){function Ba(sb){sb=sb||{};(this||pk).ms=sb.min||100;(this||pk).max=sb.max||1E4;(this||pk).factor=sb.factor||2;(this||pk).jitter=0<sb.jitter&&1>=sb.jitter?sb.jitter:0;(this||pk).attempts=0}if(Ao)return Rl;Ao=!0;Rl=Ba;Ba.prototype.duration=
function(){var sb=(this||pk).ms*Math.pow((this||pk).factor,(this||pk).attempts++);if((this||pk).jitter){var Cb=Math.random(),ub=Math.floor(Cb*(this||pk).jitter*sb);sb=0==(Math.floor(10*Cb)&1)?sb-ub:sb+ub}return Math.min(sb,(this||pk).max)|0};Ba.prototype.reset=function(){(this||pk).attempts=0};Ba.prototype.setMin=function(sb){(this||pk).ms=sb};Ba.prototype.setMax=function(sb){(this||pk).max=sb};Ba.prototype.setJitter=function(sb){(this||pk).jitter=sb};return Rl}function Sa(){function Ba(wb,kd){if(!((this||
qe)instanceof Ba))return new Ba(wb,kd);wb&&"object"===typeof wb&&(kd=wb,wb=void 0);kd=kd||{};kd.path=kd.path||"/socket.io";(this||qe).nsps={};(this||qe).subs=[];(this||qe).opts=kd;this.reconnection(!1!==kd.reconnection);this.reconnectionAttempts(kd.reconnectionAttempts||Infinity);this.reconnectionDelay(kd.reconnectionDelay||1E3);this.reconnectionDelayMax(kd.reconnectionDelayMax||5E3);this.randomizationFactor(kd.randomizationFactor||.5);(this||qe).backoff=new hc({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),
jitter:this.randomizationFactor()});this.timeout(null==kd.timeout?2E4:kd.timeout);(this||qe).readyState="closed";(this||qe).uri=wb;(this||qe).connecting=[];(this||qe).lastPing=null;(this||qe).encoding=!1;(this||qe).packetBuffer=[];wb=kd.parser||Eb;(this||qe).encoder=new wb.Encoder;(this||qe).decoder=new wb.Decoder;(this||qe).autoConnect=!1!==kd.autoConnect;(this||qe).autoConnect&&this.open()}if(fm)return Sl;fm=!0;Nj||(Nj=!0,ch=Qc(),ch.parser=pb());var sb=ch;var Cb=fa(),ub=md(),Eb=ic(),zc=Vc(),ld=
Q(),pd=ge()("socket.io-client:manager"),lc=tc(),hc=Ia(),Mc=Object.prototype.hasOwnProperty;Sl=Ba;Ba.prototype.emitAll=function(){(this||qe).emit.apply(this||qe,arguments);for(var wb in(this||qe).nsps)Mc.call((this||qe).nsps,wb)&&(this||qe).nsps[wb].emit.apply((this||qe).nsps[wb],arguments)};Ba.prototype.updateSocketIds=function(){for(var wb in(this||qe).nsps)Mc.call((this||qe).nsps,wb)&&((this||qe).nsps[wb].id=this.generateId(wb))};Ba.prototype.generateId=function(wb){return("/"===wb?"":wb+"#")+(this||
qe).engine.id};ub(Ba.prototype);Ba.prototype.reconnection=function(wb){if(!arguments.length)return(this||qe)._reconnection;(this||qe)._reconnection=!!wb;return this||qe};Ba.prototype.reconnectionAttempts=function(wb){if(!arguments.length)return(this||qe)._reconnectionAttempts;(this||qe)._reconnectionAttempts=wb;return this||qe};Ba.prototype.reconnectionDelay=function(wb){if(!arguments.length)return(this||qe)._reconnectionDelay;(this||qe)._reconnectionDelay=wb;(this||qe).backoff&&(this||qe).backoff.setMin(wb);
return this||qe};Ba.prototype.randomizationFactor=function(wb){if(!arguments.length)return(this||qe)._randomizationFactor;(this||qe)._randomizationFactor=wb;(this||qe).backoff&&(this||qe).backoff.setJitter(wb);return this||qe};Ba.prototype.reconnectionDelayMax=function(wb){if(!arguments.length)return(this||qe)._reconnectionDelayMax;(this||qe)._reconnectionDelayMax=wb;(this||qe).backoff&&(this||qe).backoff.setMax(wb);return this||qe};Ba.prototype.timeout=function(wb){if(!arguments.length)return(this||
qe)._timeout;(this||qe)._timeout=wb;return this||qe};Ba.prototype.maybeReconnectOnOpen=function(){!(this||qe).reconnecting&&(this||qe)._reconnection&&0===(this||qe).backoff.attempts&&this.reconnect()};Ba.prototype.open=Ba.prototype.connect=function(wb,kd){pd("readyState %s",(this||qe).readyState);if(~(this||qe).readyState.indexOf("open"))return this||qe;pd("opening %s",(this||qe).uri);(this||qe).engine=sb((this||qe).uri,(this||qe).opts);var ke=(this||qe).engine,df=this||qe;(this||qe).readyState="opening";
(this||qe).skipReconnect=!1;var be=zc(ke,"open",function(){df.onopen();wb&&wb()});kd=zc(ke,"error",function(Df){pd("connect_error");df.cleanup();df.readyState="closed";df.emitAll("connect_error",Df);if(wb){var If=Error("Connection error");If.data=Df;wb(If)}else df.maybeReconnectOnOpen()});if(!1!==(this||qe)._timeout){var Re=(this||qe)._timeout;pd("connect attempt will timeout after %d",Re);0===Re&&be.destroy();var sf=setTimeout(function(){pd("connect attempt timed out after %d",Re);be.destroy();ke.close();
ke.emit("error","timeout");df.emitAll("connect_timeout",Re)},Re);(this||qe).subs.push({destroy:function(){clearTimeout(sf)}})}(this||qe).subs.push(be);(this||qe).subs.push(kd);return this||qe};Ba.prototype.onopen=function(){pd("open");this.cleanup();(this||qe).readyState="open";this.emit("open");var wb=(this||qe).engine;(this||qe).subs.push(zc(wb,"data",ld(this||qe,"ondata")));(this||qe).subs.push(zc(wb,"ping",ld(this||qe,"onping")));(this||qe).subs.push(zc(wb,"pong",ld(this||qe,"onpong")));(this||
qe).subs.push(zc(wb,"error",ld(this||qe,"onerror")));(this||qe).subs.push(zc(wb,"close",ld(this||qe,"onclose")));(this||qe).subs.push(zc((this||qe).decoder,"decoded",ld(this||qe,"ondecoded")))};Ba.prototype.onping=function(){(this||qe).lastPing=new Date;this.emitAll("ping")};Ba.prototype.onpong=function(){this.emitAll("pong",new Date-(this||qe).lastPing)};Ba.prototype.ondata=function(wb){(this||qe).decoder.add(wb)};Ba.prototype.ondecoded=function(wb){this.emit("packet",wb)};Ba.prototype.onerror=function(wb){pd("error",
wb);this.emitAll("error",wb)};Ba.prototype.socket=function(wb,kd){function ke(){~lc(be.connecting,df)||be.connecting.push(df)}var df=(this||qe).nsps[wb];if(!df){df=new Cb(this||qe,wb,kd);(this||qe).nsps[wb]=df;var be=this||qe;df.on("connecting",ke);df.on("connect",function(){df.id=be.generateId(wb)});(this||qe).autoConnect&&ke()}return df};Ba.prototype.destroy=function(wb){wb=lc((this||qe).connecting,wb);~wb&&(this||qe).connecting.splice(wb,1);(this||qe).connecting.length||this.close()};Ba.prototype.packet=
function(wb){pd("writing packet %j",wb);var kd=this||qe;wb.query&&0===wb.type&&(wb.nsp+="?"+wb.query);kd.encoding?kd.packetBuffer.push(wb):(kd.encoding=!0,(this||qe).encoder.encode(wb,function(ke){for(var df=0;df<ke.length;df++)kd.engine.write(ke[df],wb.options);kd.encoding=!1;kd.processPacketQueue()}))};Ba.prototype.processPacketQueue=function(){if(0<(this||qe).packetBuffer.length&&!(this||qe).encoding){var wb=(this||qe).packetBuffer.shift();this.packet(wb)}};Ba.prototype.cleanup=function(){pd("cleanup");
for(var wb=(this||qe).subs.length,kd=0;kd<wb;kd++)(this||qe).subs.shift().destroy();(this||qe).packetBuffer=[];(this||qe).encoding=!1;(this||qe).lastPing=null;(this||qe).decoder.destroy()};Ba.prototype.close=Ba.prototype.disconnect=function(){pd("disconnect");(this||qe).skipReconnect=!0;(this||qe).reconnecting=!1;"opening"===(this||qe).readyState&&this.cleanup();(this||qe).backoff.reset();(this||qe).readyState="closed";(this||qe).engine&&(this||qe).engine.close()};Ba.prototype.onclose=function(wb){pd("onclose");
this.cleanup();(this||qe).backoff.reset();(this||qe).readyState="closed";this.emit("close",wb);(this||qe)._reconnection&&!(this||qe).skipReconnect&&this.reconnect()};Ba.prototype.reconnect=function(){if((this||qe).reconnecting||(this||qe).skipReconnect)return this||qe;var wb=this||qe;if((this||qe).backoff.attempts>=(this||qe)._reconnectionAttempts)pd("reconnect failed"),(this||qe).backoff.reset(),this.emitAll("reconnect_failed"),(this||qe).reconnecting=!1;else{var kd=(this||qe).backoff.duration();
pd("will wait %dms before reconnect attempt",kd);(this||qe).reconnecting=!0;var ke=setTimeout(function(){wb.skipReconnect||(pd("attempting reconnect"),wb.emitAll("reconnect_attempt",wb.backoff.attempts),wb.emitAll("reconnecting",wb.backoff.attempts),wb.skipReconnect||wb.open(function(df){df?(pd("reconnect attempt error"),wb.reconnecting=!1,wb.reconnect(),wb.emitAll("reconnect_error",df.data)):(pd("reconnect success"),wb.onreconnect())}))},kd);(this||qe).subs.push({destroy:function(){clearTimeout(ke)}})}};
Ba.prototype.onreconnect=function(){var wb=(this||qe).backoff.attempts;(this||qe).reconnecting=!1;(this||qe).backoff.reset();this.updateSocketIds();this.emitAll("reconnect",wb)};return Sl}var ec=lively.FreezerRuntime.recorderFor("lively.2lively/interface.js");ec.nyi=function(Ba){throw Error("Not yet implemented: "+Ba);};ec.string=Ab;ec.promise=Rb;ec.debugMessageOrder=!1;var Vb=function(Ba){this.id=ec.string.newUUID();this.actions={};this.options={ackTimeout:3500,debug:!1};this._incomingOrderNumberingBySenders=
new Map;this._outgoingOrderNumberingByTargets=new Map;this._outOfOrderCacheBySenders=new Map};Vb.prototype.isOnline=function(){ec.nyi("isOnline")};Vb.prototype.open=function(){ec.nyi("isOnline")};Vb.prototype.close=function(){ec.nyi("close")};Vb.prototype.remove=function(){ec.nyi("remove")};Vb.prototype.whenOnline=function(Ba){var sb=this;return ec.promise.waitFor(Ba,function(){return sb.isOnline()}).then(function(){return sb}).catch(function(Cb){return Promise.reject(/timeout/i.test(String(Cb))?
Error("Timeout in "+sb+".whenOnline"):Cb)})};Vb.prototype.onError=function(Ba){this.debug&&console.log("["+this+"] error: "+Ba)};Vb.prototype.removeService=function(Ba){delete this.actions[Ba]};Vb.prototype.removeServices=function(Ba){var sb=this;Ba.forEach(function(Cb){return sb.removeService(Cb)})};Vb.prototype.addService=function(Ba,sb){this.actions[Ba]=sb};Vb.prototype.addServices=function(Ba){var sb=this;Object.keys(Ba).forEach(function(Cb){return sb.addService(Cb,Ba[Cb])})};Vb.prototype.ping=
function(Ba){var sb=this,Cb,ub,Eb,zc,ld;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pd){if(1==pd.nextAddress)return Cb=Date.now(),pd.yield(sb.sendToAndWait(Ba,"l2l-ping",{timestamp:Cb}),2);ub=pd.yieldResult;Eb=ub.data;zc=Eb.timestamp;ld=Date.now();return pd.return({to:zc-Cb,from:ld-zc,roundtrip:ld-Cb})})};Vb.prototype.send=function(Ba,sb){ec.nyi("send")};Vb.prototype.sendAndWait=function(Ba){var sb=this,Cb,ub,Eb,zc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ld){switch(ld.nextAddress){case 1:return Cb=
new Promise(function(pd,lc){return sb.send(Ba,pd)}),ub={},Eb=sb.options.ackTimeout+400,"ackTimeout"in Ba&&(Eb=!Ba.ackTimeout||0>Ba.ackTimeout?null:Ba.ackTimeout+400),Eb?ld.yield(Promise.race([ec.promise.delay(Eb,ub),Cb]),5):ld.yield(Cb,4);case 4:zc=ld.yieldResult;ld.jumpTo(3);break;case 5:zc=ld.yieldResult;case 3:if(zc===ub)throw Error("Timeout sending "+Ba.action);return ld.return(zc)}})};Vb.prototype.sendTo=function(Ba,sb,Cb,ub){return this.send({target:Ba,action:sb,data:Cb},ub)};Vb.prototype.sendToAndWait=
function(Ba,sb,Cb,ub){return this.sendAndWait(Object.assign({target:Ba,action:sb,data:Cb},ub))};Vb.prototype.prepareSend=function(Ba,sb){var Cb=Ba.target,ub=Ba.action,Eb=Ba.messageId,zc=Ba.sender;if(!ub)throw Error("Trying to send a message without specifying action!");if(!Cb)throw Error("Trying to send message "+ub+" without specifying target!");Eb||(Ba.messageId=ec.string.newUUID());zc||(Ba.sender=this.id);ub=Ba.n=this._outgoingOrderNumberingByTargets.get(Cb)||0;this._outgoingOrderNumberingByTargets.set(Cb,
ub+1);if("function"===typeof sb){zc=this;var ld=sb;sb=function(pd){var lc=zc._incomingOrderNumberingBySenders.get(pd.sender)||0;zc.debug&&ec.debugMessageOrder&&console.log("[MSG ORDER] "+zc+" received ack for "+pd.action+" as msg "+lc);try{ld.apply(null,arguments)}catch(hc){console.error("Error in ack fn of "+zc+": "+hc.stack)}zc._incomingOrderNumberingBySenders.set(pd.sender,lc+1);setTimeout(function(){return zc.invokeOutOfOrderMessages(pd.sender)},0)}}this.debug&&ec.debugMessageOrder&&console.log("[MSG ORDER] "+
this+" sending "+ub+" ("+Ba.action+") to "+Cb);return[Ba,sb]};Vb.prototype.prepareAnswerMessage=function(Ba,sb){return{action:Ba.action+"-response",inResponseTo:Ba.messageId,target:Ba.sender,data:sb,sender:this.id}};Vb.prototype.installEventToMessageTranslator=function(Ba){var sb=this,Cb=Ba.onevent;Ba.onevent=function(ub){var Eb=ub.data||[];Cb.call(this,ub);ub.data=["*"].concat(Eb);Cb.call(this,ub)};Ba.on("*",function(ub,Eb){ub&&"object"===typeof ub&&ub.action&&(Eb=ub,ub=Eb.action);var zc=arguments[arguments.length-
1];zc="function"===typeof zc?zc:null;(Eb=Eb===zc?null:Eb)&&Eb.data&&("number"===typeof Eb.n||Eb.broadcast)&&Eb.sender?sb.receive(Eb,Ba,zc):(console.warn(sb+" received non-conformant message "+ub+":",arguments),"function"===typeof zc&&zc({data:{error:"invalid l2l message"}}))})};Vb.prototype.receive=function(Ba,sb,Cb){this.dispatchL2LMessageToSelf(Ba,sb,Cb)};Vb.prototype.dispatchL2LMessageToSelf=function(Ba,sb,Cb){var ub=this,Eb=Ba.action;if(Ba.broadcast)this.safeInvokeServiceHandler(Eb,Ba,Cb,sb);
else try{var zc=this._incomingOrderNumberingBySenders.get(Ba.sender)||0,ld="register"===Eb||"unregister";if(!ld&&Ba.n<zc)console.error("[MSG ORDER] ["+this+"] received message no. "+Ba.n+" but expected >= "+zc+", dropping "+Eb);else if(!ld&&Ba.n>zc){this.debug&&ec.debugMessageOrder&&console.log("[MSG ORDER] ["+this+"] storing out of order message "+Eb+" ("+Ba.n+") for later invocation");var pd=this._outOfOrderCacheBySenders.get(Ba.sender);pd||(pd=[],this._outOfOrderCacheBySenders.set(Ba.sender,pd));
pd.push([Eb,Ba,Cb,sb])}else this.safeInvokeServiceHandler(Eb,Ba,Cb,sb),setTimeout(function(){return ub.invokeOutOfOrderMessages(Ba.sender)},0)}catch(lc){console.error("Error message ordering when handling "+Eb+": "+(lc.stack||lc)),"function"===typeof Cb&&Cb(this.prepareAnswerMessage(Ba,{isError:!0,error:String(lc.stack||lc)}))}};Vb.prototype.invokeOutOfOrderMessages=function(Ba){var sb=this._outOfOrderCacheBySenders.get(Ba);if(sb&&sb.length){var Cb=this._incomingOrderNumberingBySenders.get(Ba)||0;
Ba=sb.findIndex(function(ub){ub=$jscomp.makeIterator(ub);ub.next();return ub.next().value.n===Cb});-1!==Ba&&(sb.splice(Ba,1),this.invokeServiceHandler.apply(this,sb[Ba]))}};Vb.prototype.renameTarget=function(Ba,sb){if(Ba!==sb){var Cb=this._outgoingOrderNumberingByTargets.get(Ba);this._outgoingOrderNumberingByTargets.delete(Ba);this._outgoingOrderNumberingByTargets.set(sb,Cb)}};Vb.prototype.safeInvokeServiceHandler=function(Ba,sb,Cb,ub){try{"function"===typeof this.actions[Ba]?this.invokeServiceHandler(Ba,
sb,Cb,ub):ub._events&&Object.keys(ub._events).includes(Ba)||(console.warn("WARNING ["+this+"] Unhandled message: "+Ba),"function"===typeof Cb&&Cb(this.prepareAnswerMessage(sb,{isError:!0,error:"message not understood: "+Ba})))}catch(Eb){console.error("Error when handling "+Ba+": "+(Eb.stack||Eb)),"function"===typeof Cb&&Cb(this.prepareAnswerMessage(sb,{isError:!0,error:String(Eb.stack||Eb)}))}};Vb.prototype.invokeServiceHandler=function(Ba,sb,Cb,ub){var Eb=this;this.debug&&ec.debugMessageOrder&&console.log("[MSG ORDER] "+
this+" received "+sb.n+" ("+sb.action+") from "+sb.sender);this._incomingOrderNumberingBySenders.set(sb.sender,sb.n+1);if("function"===typeof Cb){var zc=!1,ld=!1,pd="ackTimeout"in sb?sb.ackTimeout:this.options.ackTimeout,lc=this._outgoingOrderNumberingByTargets.get(sb.sender)||0;this._outgoingOrderNumberingByTargets.set(sb.sender,lc+1);var hc=function(Mc){ld?console.warn("["+Eb+"] ackFn for "+sb.action+" called after it timed out, dropping answer!"):zc?console.warn("["+Eb+"] ack function called repeatedly when handling "+
sb.action):(zc=!0,Cb(Eb.prepareAnswerMessage(sb,Mc)),Eb.debug&&ec.debugMessageOrder&&console.log("[MSG ORDER] "+Eb+" sending "+lc+" (ack for "+sb.action+")"))};pd&&setTimeout(function(){zc||(hc({isError:!0,error:"Timeout error: "+Eb+" did not send answer for "+sb.action+" after "+pd+"ms"}),ld=!0)},pd)}try{this.actions[Ba].call(this,this,sb,hc,ub)}catch(Mc){console.error("["+this+"] Error handling "+Ba+": "+(Mc.stack||Mc)),hc&&hc({error:Mc.stack})}};$jscomp.global.Object.defineProperties(Vb.prototype,
{debug:{configurable:!0,enumerable:!0,get:function(){return this.options.debug},set:function(Ba){this.options.debug=Ba}}});ec.L2LConnection=Vb;ec.default=Vb;var Ua=lively.FreezerRuntime.recorderFor("lively.2lively/default-actions.js"),wc={"l2l-ping":function(Ba,sb,Cb,ub){ub=sb.sender;sb=sb.data.timestamp;var Eb=Date.now();"function"===typeof Cb&&Cb({timestamp:Eb});Ba.debug&&console.log("[undefined] got ping from "+ub+", time: "+(Eb-sb)+"ms")},"remote-eval":function(Ba,sb,Cb,ub){var Eb=sb.data.source;
Promise.resolve().then(function(){return eval(Eb)}).then(function(zc){return Cb({value:zc})}).catch(function(zc){zc.originalErr&&(zc=zc.originalErr);console.error("eval error: "+zc);"function"===typeof Cb&&Cb({isError:!0,value:String(zc.stack||zc)})})},"remote-eval-2":function(Ba,sb,Cb,ub){var Eb=sb.data.source;Promise.resolve().then(function(){var zc=eval(Eb);if(!(zc instanceof Promise))throw console.error("unexpected eval result:"+zc),Error("unexpected eval result:"+zc);return zc}).then(function(zc){return Cb(zc)}).catch(function(zc){console.error("eval error: "+
zc);zc.originalErr&&(zc=zc.originalErr);"function"===typeof Cb&&Cb({isError:!0,value:String(zc.stack||zc)})})}};Ua.defaultActions=wc;Ua.defaultActions=wc;Ua.defaultActions=wc;var oe={},Md=(oe["[broadcast] send"]=function(Ba,sb,Cb,ub){var Eb=sb.sender,zc=sb.data,ld,pd,lc,hc,Mc,wb,kd,ke,df,be,Re,sf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Df){ld=zc;pd=ld.action;lc=ld.broadcast;hc=ld.room;Mc=ld.namespace;wb=ld.isSystemBroadcast;kd=ld.isMultiServerBroadcast;ke=[];kd?(console.log(".......isMultiServerBroadcast"),
df=Ba,be=df.id,Re=Ba.getTrackerList(),console.log(Re),ke=Re.map(function(If){return If.id!=be?If.io.nsps["/"+If.namespace]:ub.broadcast})):(wb&&(Mc=Ba.namespace),ke.push(Mc?Ba.io.nsps["/"+Mc]:ub.broadcast));ke.forEach(function(If){return If.to(hc).emit({action:pd,sender:Eb,broadcast:!0,data:lc})});Cb&&"function"===typeof Cb&&(sf="message broadcasted to "+hc,Mc&&(sf+=" in namespace "+Mc),1<ke.length&&(sf+=" "+ke.length+" trackers"),console.log(sf),Cb({status:sf}));Df.jumpToEnd()})},oe["[broadcast] join room"]=
function(Ba,sb,Cb,ub){var Eb=sb.sender,zc=sb.data.room,ld,pd,lc,hc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Mc){if(1==Mc.nextAddress)return pd=!1,lc=Ba.io.nsps["/"+Ba.namespace].adapter.rooms,(hc=lc[zc]&&lc[zc].sockets&&lc[zc].sockets[ub.id])?(ld=Eb+" already in "+zc,Mc.jumpTo(2)):Mc.yield(new Promise(function(wb,kd){return ub.join(zc,function(ke){return ke?kd(ke):wb()})}),3);2!=Mc.nextAddress&&(ld=Eb+" joined "+zc,pd=!0);Cb&&"function"===typeof Cb&&Cb({status:ld,joined:pd});Mc.jumpToEnd()})},
oe["[broadcast] leave room"]=function(Ba,sb,Cb,ub){var Eb=sb.sender,zc=sb.data.room,ld,pd,lc,hc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Mc){if(1==Mc.nextAddress)return pd=!1,lc=Ba.io.nsps["/"+Ba.namespace].adapter.rooms,hc=lc[zc]&&lc[zc].sockets&&lc[zc].sockets[ub.id],hc?Mc.yield(new Promise(function(wb,kd){return ub.leave(zc,function(ke){return ke?kd(ke):wb()})}),3):(ld=Eb+" not in "+zc,Mc.jumpTo(2));2!=Mc.nextAddress&&(ld=Eb+" left room "+zc,pd=!0);console.log(ld);Cb&&"function"===
typeof Cb&&Cb({left:pd,status:ld});Mc.jumpToEnd()})},oe["[broadcast] my rooms"]=function(Ba,sb,Cb,ub){Cb(ub.rooms)},oe["[broadcast] all rooms"]=function(Ba,sb,Cb,ub){Cb(Ba.io.nsps["/"+Ba.namespace].adapter.rooms)},oe["[broadcast] list room members"]=function(Ba,sb,Cb,ub){sb=sb.data.room;ub=Ba.io;sb?(Ba=ub.nsps["/"+Ba.namespace].adapter.rooms[sb],Cb({room:sb,sockets:Ba?Ba.sockets:{},length:Ba?Ba.length:0})):Cb({isError:!0,error:"`room` paramerter missing!"})},oe.getClients=function(Ba,sb,Cb){Ba.removeDisconnectedClients();
Cb(Array.from(Ba.clients))},oe);Ua.defaultTrackerActions=Md;Ua.defaultTrackerActions=Md;Ua.defaultTrackerActions=Md;var id={},Ta=(id.getRoomList=function(Ba){var sb=Ba.client,Cb=Ba.ackFn,ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Eb){ub=sb._socketioClient.rooms;Cb(ub);Eb.jumpToEnd()})},id["ask for"]=function(Ba,sb,Cb,ub){var Eb=sb.sender,zc=sb.data.query,ld=this,pd,lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hc){if(1==hc.nextAddress)return pd=zc.match(/password|sudo/i)?
"passwordPrompt":"prompt",hc.yield($world[pd](zc),2);lc=hc.yieldResult;"function"===typeof Cb&&Cb({answer:lc});Ba.debug&&console.log("["+ld+"] message 'ask for' from "+Eb+", query: "+zc);hc.jumpToEnd()})},id["open editor"]=function(Ba,sb,Cb,ub){var Eb=sb.data.args,zc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ld){if(1==ld.nextAddress)return Eb.length?ld.yield($world.execCommand("open file for EDITOR",{url:Eb[0]}),2):(Cb({error:"no file specified"}),ld.return());zc=ld.yieldResult;
"function"===typeof Cb&&Cb("aborted"===zc?{error:String(zc)}:{status:zc});ld.jumpToEnd()})},id.changeWorkingDirectory=function(Ba,sb,Cb,ub){var Eb=sb.data.args,zc,ld,pd,lc,hc,Mc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wb){zc=$jscomp.makeIterator(Eb||[]);ld=zc.next().value;pd=zc.next().value;lc="OK";try{if(ld)if(pd){if(hc=$world.getMorphWithId(pd))if(hc.__lookupSetter__("cwd"))hc.cwd=ld;else if("function"===typeof hc.changeWorkingDirectory)hc.changeWorkingDirectory(ld);else if("function"===
typeof hc.pluginFind){if(Mc=hc.pluginFind(function(kd){return kd.isShellEditorPlugin}))Mc.cwd=ld}else lc="[changeWorkingDirectory] cannot figure pout how to set dir"}else lc="[changeWorkingDirectory] No command morph";else lc="[changeWorkingDirectory] No directory received"}catch(kd){lc=String(kd)}"OK"!==lc&&console.warn(lc);"function"===typeof Cb&&Cb(lc);wb.jumpToEnd()})},id);Ua.defaultClientActions=Ta;Ua.defaultClientActions=Ta;Ua.defaultClientActions=Ta;var rd={},jb=!1,Qd={},ab=!1,lb={},vb=!1,
Bd="undefined"!==typeof self?self:global,de={},Ee=!1,Ze="undefined"!==typeof self?self:global,Zc={},ye=!1,Hd={},Zb=!1,sa="undefined"!==typeof self?self:global,Aa={},Mb=!1,P={},wa=!1,Qa={},Nb=!1,Gc="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Uc={},le=!1,Od="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,kf={},ae=!1,Ke={},$e=!1,Cf={},rg=!1,Qf={},Tc=!1,Rf={},Fg=!1,Gg={},rf=!1,Ha={},cb=!1,Hb={},ba=!1,Ja={},nb=!1,zb={},Ic=!1,vc={},Ad=
!1,wd={},yd=!1,He="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,gf={},ng=!1,Jh={},Mi=!1,Th={},Mj=!1,Kh={},el=!1,Lf="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Wj={},qi=!1,Je="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Nk={},em=!1,bh="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,uk={},Cl=!1,Dl={},ok=!1,sg="undefined"!==typeof globalThis?globalThis:"undefined"!==
typeof self?self:global,Vf={},$m=!1,Ub={},zd=!1,Ce={},Ec=!1,hd="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,ch={},Nj=!1,Zm={},wn=!1,xo={},yo=!1,zo={},xn=!1,Vj={},yn=!1,vf="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Rl={},Ao=!1,pk="undefined"!==typeof self?self:global,Sl={},fm=!1,qe="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,qk={},vk=!1,zn=function(){function Ba(ld,pd){"object"===typeof ld&&
(pd=ld,ld=void 0);pd=pd||{};ld=sb(ld);var lc=ld.source,hc=ld.id,Mc=ld.path;Mc=zc[hc]&&Mc in zc[hc].nsps;pd.forceNew||pd["force new connection"]||!1===pd.multiplex||Mc?(Eb("ignoring socket cache for %s",lc),lc=ub(lc,pd)):(zc[hc]||(Eb("new io instance for %s",lc),zc[hc]=ub(lc,pd)),lc=zc[hc]);ld.query&&!pd.query&&(pd.query=ld.query);return lc.socket(ld.path,pd)}if(vk)return qk;vk=!0;var sb=Td(),Cb=ic(),ub=Sa(),Eb=ge()("socket.io-client");qk=qk=Ba;var zc=qk.managers={};qk.protocol=Cb.protocol;qk.connect=
Ba;qk.Manager=Sa();qk.Socket=fa();return qk}(),Ig=lively.FreezerRuntime.recorderFor("lively.2lively/client.js");Ig.determineLocation=function(){return"undefined"!==typeof document&&document.location?document.location.origin:Ig.isNode?System._nodeRequire("os").hostname():System.baseURL};Ig.promise=Rb;Ig.fun=je;Ig.obj=fd;Ig.events=Yd;Ig.num=jd;Ig.L2LConnection=Vb;Ig.defaultActions=wc;Ig.defaultClientActions=Ta;Ig.isNode="undefined"!==typeof System?System.get("@system-env").node:"undefined"!==typeof process&&
process.env;Ig._ioClient=zn;Ig.ioClient=Ig.ioClient||void 0;Ig.isNode?(Ig.require=System._nodeRequire("module")._load,Ig.ioClient=Ig.require("socket.io-client")):Ig.ioClient=Ig._ioClient;Ig.urlHelper={isRoot:function(Ba){return"/"===Ig.urlHelper.path(Ba)},root:function(Ba){return Ig.urlHelper.isRoot(Ba)?Ba:Ba.slice(0,-Ig.urlHelper.path(Ba).length)+"/"},path:function(){var Ba=/^[a-z0-9-_\.]+:/,sb=/^\/\/[^\/]+/;return function(Cb){Cb=Cb.replace(Ba,"").replace(sb,"");return""===Cb?"/":Cb}}(),join:function(Ba,
sb){Ba.endsWith("/")&&(Ba=Ba.slice(0,-1));sb.startsWith("/")&&(sb=sb.slice(1));return Ba+"/"+sb}};var Vh=function(Ba,sb,Cb,ub){var Eb=Ig.L2LConnection.call(this)||this;Ig.events.makeEmitter(Eb);Eb.info=ub;Eb.origin=Ba;Eb.path=sb;Eb.namespace=Cb.replace(/^\/?/,"/");Eb.trackerId=null;Eb._socketioClient=null;Eb._reconnectState={closed:!1,autoReconnect:!0,isReconnecting:!1,isReconnectingViaSocketio:!1,registerAttempt:0,registerProcess:null,isOpening:!1};Object.keys(Ig.defaultActions).forEach(function(zc){return Eb.addService(zc,
Ig.defaultActions[zc])});Object.keys(Ig.defaultClientActions).forEach(function(zc){return Eb.addService(zc,Ig.defaultClientActions[zc])});return Eb};$jscomp.inherits(Vh,Ig.L2LConnection);Vh.clientKey=function(Ba,sb,Cb){Ba=Ba.replace(/\/$/,"");sb=sb.replace(/^\//,"");Cb=Cb.replace(/^\//,"");return Ba+"-"+sb+"-"+Cb};Vh.forLivelyInBrowser=function(Ba){var sb=!!Ba;Ba=Object.assign({type:"lively.morphic browser"},Ba);var Cb=this.default();if(!Cb)return Ig.L2LClient.ensure({url:document.location.origin+
"/lively-socket.io",namespace:"l2l",info:Ba});sb&&!Ig.obj.equals(Cb.info,Ba)&&Cb.isRegistered()&&(Cb.info=Ba,Cb.unregister().then(function(){return Cb.register()}).catch(function(ub){return console.error("l2l re-register on info change errored: "+ub)}));return Cb};Vh.default=function(){var Ba=Ig.L2LClient.clients.keys().next().value;return Ig.L2LClient.clients.get(Ba)};Vh.create=function(Ba){var sb=Ba=void 0===Ba?{}:Ba;Ba=void 0===sb.debug?!1:sb.debug;var Cb=sb.url,ub=sb.namespace,Eb=void 0===sb.autoOpen?
!0:sb.autoOpen;sb=void 0===sb.info?{}:sb.info;if(!Cb)throw Error("L2LClient needs server url!");var zc=Ig.urlHelper.root(Cb).replace(/\/+$/,"");Cb=Ig.urlHelper.path(Cb);ub=new this(zc,Cb,ub||"",sb);Eb&&ub.register();ub.debug=Ba;return ub};Vh.ensure=function(Ba){var sb=Ba=void 0===Ba?{}:Ba,Cb=sb.url;sb=sb.namespace;if(!Cb)throw Error("L2LClient needs server url!");var ub=Ig.urlHelper.root(Cb).replace(/\/+$/,""),Eb=Ig.urlHelper.path(Cb);ub=this.clientKey(ub,Eb,sb||"");(Eb=this.clients.get(ub))||this.clients.set(ub,
Eb=this.create(Object.assign({},Ba,{url:Cb,namespace:sb})));return Eb};Vh.prototype.isOnline=function(){return this.socket&&this.socket.connected};Vh.prototype.isRegistered=function(){return this.isOnline()&&!!this.trackerId};Vh.prototype.open=function(){var Ba=this,sb,Cb,ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Eb){if(1==Eb.nextAddress)return Ba.isOnline()||Ba._reconnectState.isOpening?Eb.return(Ba):Eb.yield(Ba.close(),2);Ba._reconnectState.closed=!1;sb=Ig.urlHelper.join(Ba.origin,
Ba.namespace);Cb={path:Ba.path,transports:["websocket","polling"]};ub=Ba._socketioClient=Ig.ioClient(sb,Cb);Ba.debug&&console.log("["+Ba+"] connecting");ub.on("error",function(zc){Ba._reconnectState.isOpening=!1;Ba.debug&&console.log("["+Ba+"] errored: "+zc)});ub.on("close",function(zc){return Ba.debug&&console.log("["+Ba+"] closed: "+zc)});ub.on("reconnect_failed",function(){return Ba.debug&&console.log("["+Ba+"] could not reconnect")});ub.on("reconnect_error",function(zc){return Ba.debug&&console.log("["+
Ba+"] reconnect error "+zc)});ub.on("connect",function(){Ba.debug&&console.log("["+Ba+"] connected");Ba.emit("connected",Ba);Ba._reconnectState.isOpening=!1;Ba._reconnectState.isReconnecting=!1;Ba._reconnectState.isReconnectingViaSocketio=!1});ub.on("disconnect",function(){Ba._reconnectState.isOpening=!1;Ba.debug&&console.log("["+Ba+"] disconnected");Ba.emit("disconnected",Ba);Ba.trackerId?("tracker"!==Ba.trackerId&&(Ba.renameTarget(Ba.trackerId,"tracker"),Ba.trackerId=null),Ba._reconnectState.closed?
Ba.debug&&console.log("["+Ba+"] won't reconnect b/c client is marked as closed"):Ba._reconnectState.autoReconnect?(Ba._reconnectState.isReconnecting=!0,setTimeout(function(){Ba._reconnectState.closed?Ba.debug&&console.log("["+Ba+"] won't reconnect b/c client is marked as closed 2"):Ba._reconnectState.isReconnectingViaSocketio?Ba.debug&&console.log("["+Ba+"] won't reconnect again, client already reconnecting"):(Ba.debug&&console.log("["+Ba+"] initiating reconnection to tracker"),Ba.register())},20)):
Ba.debug&&console.log("["+Ba+"] won't reconnect b/c client has reconnection disabled")):(Ba.debug&&console.log("["+Ba+"] disconnect: don't have a tracker id, won't try reconnect"),Ba.trackerId="tracker")});ub.on("reconnecting",function(){Ba.debug&&console.log("["+Ba+"] reconnecting",Ba._reconnectState);Ba.emit("reconnecting",Ba);Ba._reconnectState.closed?(Ba._reconnectState.isReconnecting=!1,Ba._reconnectState.isReconnectingViaSocketio=!1,ub.close(),Ba.close()):(Ba._reconnectState.isReconnecting=
!0,Ba._reconnectState.isReconnectingViaSocketio=!0)});ub.on("reconnect",function(){Ba.debug&&console.log("["+Ba+"] reconnected");Ba._reconnectState.isReconnecting=!1;Ba._reconnectState.isReconnectingViaSocketio=!1;Ba.register()});Ba.installEventToMessageTranslator(ub);Ba._reconnectState.isOpening=!0;return Eb.return((new Promise(function(zc,ld){ub.once("error",ld);ub.once("connect",zc)})).then(function(){return Ba}))})};Vh.prototype.close=function(){var Ba=this,sb,Cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ub){if(1==
ub.nextAddress){Ba._reconnectState.closed=!0;if(sb=Ba.socket)sb.removeAllListeners("reconnect"),sb.removeAllListeners("reconnecting"),sb.removeAllListeners("disconnect"),sb.removeAllListeners("connect"),sb.removeAllListeners("reconnect_error"),sb.removeAllListeners("reconnect_failed"),sb.removeAllListeners("close"),sb.removeAllListeners("error"),sb.close();Ba.debug&&console.log("["+Ba+"] closing...");return Ba.isRegistered()?ub.yield(Ba.unregister(),2):ub.jumpTo(2)}return Ba.isOnline()||Ba.socket?
sb&&!sb.connected?(Ba.debug&&console.log("["+Ba+"] socket not connected, considering client closed"),ub.return(Ba)):ub.return(Promise.race([Ig.promise.delay(2E3).then(function(){return sb.removeAllListeners("disconnect")}),new Promise(function(Eb){return sb.once("disconnect",Eb)})]).then(function(){Ba.debug&&console.log("["+Ba+"] closed");return Ba})):(Ba.debug&&(Cb=Ba.isOnline()?"no socket":"not online",Ba.debug&&console.log("["+Ba+"] cannot close: "+Cb)),ub.return(Ba))})};Vh.prototype.remove=function(){var Ba=
this.constructor.clientKey(this.origin,this.path,this.namespace);this.constructor.clients.delete(Ba);return this.close()};Vh.prototype.register=function(){var Ba=this,sb,Cb,ub,Eb,zc,ld,pd,lc,hc,Mc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wb){switch(wb.nextAddress){case 1:if(Ba.isRegistered())return wb.return();if(Ba._reconnectState.closed)return Ba.debug&&console.log("["+Ba+"] not registering this b/c closed"),Ba._reconnectState.registerAttempt=0,wb.return();if(Ba._reconnectState.registerProcess)return Ba.debug&&
console.log("["+Ba+"] not registering this b/c register process exists"),wb.return();wb.setCatchFinallyBlocks(2);if(Ba.isOnline()){wb.jumpTo(4);break}return wb.yield(Ba.open(),4);case 4:return Ba.debug&&console.log("["+Ba+"] register"),wb.yield(Ba.sendToAndWait("tracker","register",Object.assign({userName:"unknown",type:"l2l "+(Ig.isNode?"node":"browser"),location:Ig.determineLocation()},Ba.info)),6);case 6:sb=wb.yieldResult;if(!sb.data)throw Cb=Error("Register answer is empty!"),Ba.emit("error",
Cb),Cb;if(sb.data.isError)throw ub=Error(sb.data.error),Ba.emit("error",ub),ub;Ba._reconnectState.registerAttempt=0;Eb=sb;zc=Eb.data;ld=zc.trackerId;pd=zc.messageNumber;Ba.trackerId=ld;Ba._incomingOrderNumberingBySenders.set(ld,pd||0);Ba.emit("registered",{trackerId:ld});wb.leaveTryBlock(0);break;case 2:lc=wb.enterCatchBlock(),console.error("Error in register request of "+Ba+": "+lc),hc=Ba._reconnectState.registerAttempt++,Mc=Ig.num.backoff(hc,4,3E5),Ba._reconnectState.registerProcess=setTimeout(function(){Ba._reconnectState.registerProcess=
null;Ba.register()},Mc),wb.jumpToEnd()}})};Vh.prototype.unregister=function(){var Ba=this,sb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Cb){switch(Cb.nextAddress){case 1:if(!Ba.isRegistered())return Cb.return();Ba.debug&&console.log("["+Ba+"] unregister");sb=Ba.trackerId;Cb.setCatchFinallyBlocks(2);return Cb.yield(Ba.sendToAndWait(Ba.trackerId,"unregister",{}),4);case 4:Cb.leaveTryBlock(3);break;case 2:Cb.enterCatchBlock();case 3:Ba.renameTarget(sb,"tracker"),Ba.trackerId=null,Ba.emit("unregistered",
Ba),Cb.jumpToEnd()}})};Vh.prototype.whenRegistered=function(Ba){var sb=this;return Ig.promise.waitFor(Ba,function(){return sb.isRegistered()}).catch(function(Cb){return Promise.reject(/timeout/i.test(String(Cb))?Error("Timeout in "+sb+".whenRegistered"):Cb)})};Vh.prototype.send=function(Ba,sb){var Cb=this,ub=$jscomp.makeIterator(this.prepareSend(Ba,sb));Ba=ub.next().value;sb=ub.next().value;this.whenOnline().then(function(){var Eb=Cb.socket,zc=Ba,ld=zc.action;zc=zc.target;if(!Eb)throw Error("Trying to send message "+
ld+" to "+zc+" but cannot find a connection to it!");"function"===typeof sb?Eb.emit(ld,Ba,sb):Eb.emit(ld,Ba)})};Vh.prototype.joinRoom=function(Ba){var sb=this;return this.whenOnline().then(function(){return sb.sendToAndWait(sb.trackerId,"[broadcast] join room",{room:Ba})})};Vh.prototype.leaveRoom=function(Ba){var sb=this;return this.whenOnline().then(function(){return sb.sendToAndWait(sb.trackerId,"[broadcast] leave room",{room:Ba})})};Vh.prototype.broadcast=function(Ba,sb,Cb,ub,Eb){var zc=this,ld=
{action:sb,room:Ba,broadcast:Cb};if(void 0===ub?0:ub)ld.isSystemBroadcast=!0;if(void 0===Eb?0:Eb)ld.isMultiServerBroadcast=!0;return this.whenOnline().then(function(){return zc.sendToAndWait(zc.trackerId,"[broadcast] send",ld)})};Vh.prototype.listRoomMembers=function(Ba){var sb=this,Cb,ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Eb){if(1==Eb.nextAddress)return Eb.yield(sb.sendToAndWait(sb.trackerId,"[broadcast] list room members",{room:Ba}),2);Cb=Eb.yieldResult;ub=Cb.data;return Eb.return(ub)})};
Vh.prototype.joinedRooms=function(){var Ba=this,sb,Cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ub){if(1==ub.nextAddress)return ub.yield(Ba.sendToAndWait(Ba.trackerId,"[broadcast] my rooms",{}),2);sb=ub.yieldResult;Cb=sb.data;return ub.return(Cb)})};Vh.prototype.listRooms=function(){var Ba=this,sb,Cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ub){if(1==ub.nextAddress)return ub.yield(Ba.sendToAndWait(Ba.trackerId,"[broadcast] all rooms",{}),2);sb=ub.yieldResult;Cb=
sb.data;return ub.return(Cb)})};Vh.prototype.listPeers=function(Ba){Ba=void 0===Ba?!1:Ba;var sb=this,Cb,ub,Eb,zc,ld,pd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lc){if(1==lc.nextAddress)return Cb=sb,ub=Cb._peersCached,Eb=Date.now(),!Ba&&ub&&1E3>Eb-ub.timestamp?lc.return(sb._peersCached.sessions):sb.isOnline()?lc.yield(sb.sendToAndWait(sb.trackerId,"getClients",{}),2):lc.return([]);zc=lc.yieldResult;ld=zc.data;pd=ld.map(function(hc){var Mc=$jscomp.makeIterator(hc);hc=Mc.next().value;
var wb=Mc.next().value,kd=wb.info||{};Mc=kd.userRealm;var ke=kd.userToken,df=kd.l2lUserToken,be=kd.location,Re=kd.type;kd=kd.world;hc=Object.assign({},Ig.obj.dissoc(wb,["info"]),{id:hc,world:kd,location:be,type:Re});(ke=ke||df)&&"null"!==ke&&(lively.user?hc.user=lively.user.ClientUser.fromToken(ke,Mc):(hc.userToken=ke,hc.userRealm=Mc));return hc});sb._peersCached={timestamp:Eb,sessions:pd};return lc.return(pd)})};Vh.prototype.toString=function(){var Ba=this.origin,sb=this.path,Cb=this.namespace,ub=
this.id,Eb=this.isOnline()?this.isRegistered()?"registered":"unregistered":"disconnected";return"L2LClient("+(ub||"").slice(0,5)+" "+Ba+sb+" - "+Cb+" "+Eb+")"};$jscomp.global.Object.defineProperties(Vh.prototype,{socket:{configurable:!0,enumerable:!0,get:function(){return this._socketioClient}},socketId:{configurable:!0,enumerable:!0,get:function(){return this.socket?this.socket.id:null}}});$jscomp.global.Object.defineProperties(Vh,{clients:{configurable:!0,enumerable:!0,get:function(){return this._clients||
(this._clients=new Map)}}});Da("default",Vh);Ig.L2LClient=Vh;Ig.default=Vh}}});