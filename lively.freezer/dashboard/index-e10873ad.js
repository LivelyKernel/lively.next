System.register(["./__root_module__-896eff71.js","kld-intersections"],function($a){var Vb,jc,Wc,wc,Ud,Kd,he,xd,gd,Ld,Pd,af,bf,Ve;return{setters:[function(Ad){Vb=Ad.a_;jc=Ad.b;Wc=Ad.r;wc=Ad._;Ud=Ad.a;Kd=Ad.Z;he=Ad.bv;xd=Ad.aZ;gd=Ad.i;Ld=Ad.c;Pd=Ad.bw;af=Ad.bx;bf=Ad.N;Ve=Ad.by},function(){}],execute:function(){function Ad(pc){try{var bb=eval("("+tc.ast.transform.wrapInFunction("var _; _ = ("+pc+")")+")()")}catch(Ma){return JSON.parse(pc)}return"object"!==typeof bb?null:bb}function xe(pc,bb){var Ma,
oa,La,Ua,Sb,Ca,Va,dc,sb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(od){switch(od.nextAddress){case 1:return Ma=bb.world(),od.yield(Ma.prompt("Enter package name",{requester:bb,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:oa=od.yieldResult;if(!oa)throw"Canceled";od.setCatchFinallyBlocks(3);Ua=Tc.resource(oa);oa=Ua.name();La=Ua.url;od.leaveTryBlock(4);break;case 3:return od.enterCatchBlock(),od.yield(pc.getConfig(),5);case 5:return Sb=od.yieldResult.baseURL,
Ca=Tc.resource(Sb).join(oa).asDirectory().url,od.yield(pc.normalize(Ca),6);case 6:La=od.yieldResult.replace(/\/\.js$/,"/");case 4:return od.yield(Ma.prompt("Confirm or change package location",{requester:bb,input:La,historyId:"lively.vm-editor-add-package-address"}),7);case 7:Va=od.yieldResult;if(!Va)throw"Canceled";dc=Tc.resource(Va).asDirectory();sb=dc.asFile().url;return od.yield(pc.removePackage(sb),8);case 8:return od.yield(pc.resourceCreateFiles(sb,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+
oa+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+oa+"\n\nNo description for package "+oa+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+oa+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return od.return(Tc.loadPackage(pc,{name:oa,address:sb,configFile:dc.join("package.json").url,main:dc.join("index.js").url,test:dc.join("tests/test.js").url,type:"package"}))}})}function qc(pc,bb,Ma){Ma=void 0===
Ma?null:Ma;var oa,La,Ua,Sb,Ca,Va,dc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sb){switch(sb.nextAddress){case 1:return oa={name:"",address:"",type:"package"},sb.yield(pc.getConfig(),2);case 2:La=sb.yieldResult;if(!Ma){sb.jumpTo(3);break}return sb.yield(pc.getPackage(Ma),4);case 4:if(Ua=sb.yieldResult){sb.jumpTo(5);break}return sb.yield(pc.getPackageForModule(Ma),6);case 6:Ua=sb.yieldResult;case 5:Sb=Ua;case 3:return sb.yield(bb.world().prompt("What is the package directory?",{requester:bb,
input:Sb?Sb.address:La.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:Ca=sb.yieldResult;if(!Ca)throw"Canceled";oa.address=Ca.replace(/\/$/,"");oa.url=new Tc.URL(oa.address+"/");oa.configFile=Tc.resource(oa.url).join("package.json").url;sb.setCatchFinallyBlocks(8);Va=JSON;dc=Va.parse;return sb.yield(pc.moduleRead(oa.configFile),10);case 10:dc.call(Va,sb.yieldResult).name;sb.leaveTryBlock(9);break;case 8:sb.enterCatchBlock(),oa.name=String(oa.url).replace(/\/$/,
""),pc.resourceEnsureExistance(oa.configFile,'{\n  "name": "'+oa.name+'",\n  "version": "0.1.0"\n}');case 9:return sb.return(Tc.loadPackage(pc,oa))}})}function td(pc,bb,Ma){var oa,La,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){switch(Sb.nextAddress){case 1:return oa=Tc.resource(Ma).asFile().url,Sb.yield(pc.getPackage(oa),2);case 2:if(La=Sb.yieldResult){Sb.jumpTo(3);break}return Sb.yield(pc.getPackageForModule(oa),4);case 4:La=Sb.yieldResult;case 3:Ua=La;if(!Ua)throw Error("Cannot find package for "+
oa);return Sb.yield(pc.reloadPackage(oa),5);case 5:if(!bb){Sb.jumpTo(0);break}return Sb.yield(bb.updateModuleList(),7);case 7:return Sb.yield(bb.uiSelect(oa,!1),8);case 8:return Sb.return(Sb.yieldResult)}})}function be(pc,bb,Ma,oa){var La,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){switch(Sb.nextAddress){case 1:return Sb.yield(pc.getPackage(Ma),2);case 2:return La=Sb.yieldResult,Sb.yield((oa||$world).confirm("Unload package "+La.name+"?",{requester:bb}),3);case 3:Ua=Sb.yieldResult;
if(!Ua)throw"Canceled";return Sb.yield(pc.removePackage(Ma),4);case 4:if(!bb){Sb.jumpTo(0);break}return Sb.yield(bb.updateModuleList(),6);case 6:return Sb.yield(bb.uiSelect(null),0)}})}function Bd(pc,bb,Ma){var oa,La,Ua,Sb,Ca;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Va){switch(Va.nextAddress){case 1:return oa=bb.world(),Va.yield(pc.getPackage(Ma),2);case 2:return La=Va.yieldResult,La?Va.yield(oa.confirm("Really remove package "+La.name+"?",{requester:bb}),3):($world.inform('No package "'+
Ma+'" found!',{requester:bb}),Va.return());case 3:Ua=Va.yieldResult;if(!Ua)throw"Canceled";pc.removePackage(Ma);return Va.yield(oa.confirm("Also remove directory "+La.name+" including "+La.modules.length+" modules?"),4);case 4:Sb=Va.yieldResult;if(!Sb){Va.jumpTo(0);break}return Va.yield(oa.confirm("REALLY *remove* directory "+La.name+"? No undo possible..."),6);case 6:if(Ca=Va.yieldResult)return Va.yield(pc.resourceRemove(La.address),0);Va.jumpTo(0)}})}function pe(pc,bb,Ma){Ma=void 0===Ma?$world:
Ma;var oa,La,Ua,Sb,Ca,Va,dc,sb,od,bc,Td;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rd){switch(rd.nextAddress){case 1:return rd.yield(pc.getPackage(bb),2);case 2:oa=rd.yieldResult;if(!oa)throw Error("Cannot find package "+bb);La=[];Ua=$jscomp.makeIterator(oa.modules);Sb=Ua.next();case 3:if(Sb.done)return rd.yield(Ma.execCommand("open text window",{title:"imports and exports of "+bb,content:La.join("\n\n")}),0);Ca=Sb.value;if(!Ca.name.match(/\.js$/)){rd.jumpTo(4);break}rd.setCatchFinallyBlocks(6);
Va=pc;dc=Va.importsAndExportsOf;sb=Ca.name;return rd.yield(pc.moduleRead(Ca.name),9);case 9:return rd.yield(dc.call(Va,sb,rd.yieldResult),8);case 8:od=rd.yieldResult;rd.leaveTryBlock(7);break;case 6:bc=rd.enterCatchBlock();Ma.logError(Error("Error when getting imports/exports from module "+Ca.name+":\n"+bc.stack));rd.jumpTo(4);break;case 7:Td=""+Ca.name;if(!od.imports.length&&!od.exports.length){Td+="\n  does not import / export anything";rd.jumpTo(4);break}od.imports.length&&(Td+="\n  imports:\n",
Td+=Tc.arr.groupByKey(od.imports,"fromModule").mapGroups(function(dd,Ub){return"from "+dd+": "+Ub.map(function(Ne){return Ne.local||Ne.imported?Ne.imported&&Ne.imported!==Ne.local?Ne.imported+" as "+Ne.local:Ne.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(dd){return"    "+dd}).join("\n"));od.exports.length&&(Td+="\n  exports:\n",Td+=od.exports.map(function(dd){return dd.local?dd.local&&dd.local!==dd.exported?dd.local+" as "+dd.exported:dd.exported:dd.exported+
" from "+dd.fromModule}).join(", ").split("\n").map(function(dd){return"    "+dd}).join("\n"));La.push(Td);case 4:Sb=Ua.next(),rd.jumpTo(3)}})}function Se(pc){return pc.match(/import.*['"]mocha(-es6)?['"]/)&&pc.match(/it\(['"]/)}function nc(pc,bb,Ma){Ma=Ma&&Ma.address;if(Ma&&0===bb.indexOf(Ma))var oa=bb.slice(Ma.length).replace(/^\//,"");else a:{Ma=pc.getConfig();if(!Ma||Ma.constructor!==Promise)try{oa=String((new fb.URL(bb)).relativePathFrom(new fb.URL(pc.getConfig().baseURL)));break a}catch(La){}oa=
bb}return oa}function $c(pc,bb,Ma,oa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(La){return 1==La.nextAddress?(oa=Object.assign({targetModule:bb},oa),La.yield(pc.normalize(bb),2)):3!=La.nextAddress?(bb=La.yieldResult,La.yield(pc.moduleSourceChange(bb,Ma,oa),3)):La.return(bb)})}function ge(pc,bb,Ma,oa,La){oa=void 0===oa?!1:oa;La=void 0===La?!1:La;var Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){switch(Sb.nextAddress){case 1:return bb&&bb.setStatusMessage("Reloading "+
Ma),Sb.setCatchFinallyBlocks(2),Sb.yield(pc.reloadModule(Ma,{reloadDeps:oa,resetEnv:La}),4);case 4:if(!bb){Sb.jumpTo(5);break}return Sb.yield(bb.updateModuleList(),6);case 6:case 5:bb&&bb.setStatusMessage("Reloded "+Ma);Sb.leaveTryBlock(0);break;case 2:Ua=Sb.enterCatchBlock();Sb.setCatchFinallyBlocks(7);if(!bb){Sb.jumpTo(9);break}return Sb.yield(bb.updateEditorWithSourceOf(Ma),10);case 10:case 9:Sb.leaveTryBlock(8);break;case 7:Sb.enterCatchBlock();case 8:throw bb&&bb.showError(Ua),Ua;}})}function ad(pc,
bb,Ma){return $jscomp.asyncExecutePromiseGeneratorProgram(function(oa){switch(oa.nextAddress){case 1:return oa.yield(pc.forgetModule(Ma,{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!bb){oa.jumpTo(3);break}return oa.yield(bb.updateModuleList(),4);case 4:case 3:oa.jumpToEnd()}})}function ie(pc,bb,Ma){var oa,La,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){switch(Sb.nextAddress){case 1:return Sb.yield(pc.normalize(Ma),2);case 2:return oa=Sb.yieldResult,Sb.yield(bb.world().confirm(["Really remove file:\n",
{},oa,{fontStyle:"italic",fontWeight:"bold"}," ?",{}],{requester:bb,lineWrapping:!1}),3);case 3:La=Sb.yieldResult;if(!La)throw"Canceled";return Sb.yield(pc.forgetModule(oa),4);case 4:return Sb.yield(pc.resourceRemove(oa),5);case 5:return Sb.yield(pc.getPackageForModule(oa),6);case 6:return Ua=Sb.yieldResult,Sb.return(Ua)}})}function Yb(pc,bb){var Ma,oa,La;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){if(1==Ua.nextAddress)return Ua.yield(fb._createAndLoadModules(pc,[bb]),2);Ma=Ua.yieldResult;
oa=fb.arr.compact(Ma.map(function(Sb){return Sb.error}));La=!!oa.length;return Ua.return(La)})}function zb(pc,bb,Ma){var oa,La,Ua,Sb,Ca,Va,dc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sb){switch(sb.nextAddress){case 1:return oa=fb.URL,sb.yield(pc.getConfig(),2);case 2:La=new oa(sb.yieldResult.baseURL);Ua=bb.world();if(!Ma){sb.jumpTo(3);break}return sb.yield(pc.getPackage(Ma),4);case 4:if(Sb=sb.yieldResult){sb.jumpTo(5);break}return sb.yield(pc.getPackageForModule(Ma),6);case 6:Sb=
sb.yieldResult;case 5:(Ca=Sb)&&(La=new fb.URL(Ca.address));case 3:return sb.yield(fb._searchForExistingFiles(bb,String(La),Ca),7);case 7:Va=sb.yieldResult;if(!Va.includes("[create new module]")){sb.jumpTo(8);break}return sb.yield(fb._askForModuleName(pc,Ma||String(La),Ua),9);case 9:dc=sb.yieldResult,Va=[dc];case 8:return sb.yield(fb._createAndLoadModules(pc,Va),10);case 10:return sb.return(sb.yieldResult)}})}function Rc(pc,bb){var Ma,oa,La,Ua,Sb,Ca,Va,dc,sb,od;return $jscomp.asyncExecutePromiseGeneratorProgram(function(bc){if(1==
bc.nextAddress)return bc.yield(pc.getPackage(bb),2);if(3!=bc.nextAddress){Ma=bc.yieldResult;if(!Ma||!Ma.address.match(/^http/))throw Error("Cannot load package "+bb);oa=fb.resource(Ma.address);La=[];Ua=$jscomp;Sb=Ua.makeIterator;return bc.yield(oa.dirList(5,{exclude:fb.modulesInPackage_defaultExclude}),3)}Ca=Sb.call(Ua,bc.yieldResult);for(Va=Ca.next();!Va.done;Va=Ca.next())sb=dc=Va.value,od=sb.url,od.match(/\.js$/)&&pc.isModuleLoaded(od,!0)&&La.push(pc.getModule(od));return bc.return(La)})}function Mc(pc){pc||
(pc="local");if(pc.isSystemInterface)var bb=pc;else"string"===typeof pc&&pc.startsWith("l2l ")&&(pc={type:"l2l",id:pc.split(" ")[1]}),"string"!==typeof pc&&"l2l"===pc.type&&(bb=Oc.l2lInterfaceFor(pc.id,pc.info)),"string"!==typeof pc&&($world.setStatusMessage("Unknown system interface "+pc),pc="local"),bb||(bb=pc&&"local"!==pc?Oc.serverInterfaceFor(pc):Oc.localInterface);return bb}$a("systemInterfaceNamed",Mc);var tc=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");tc.parseJsonLikeObj=
Ad;tc.ast=Vb;tc.parseJsonLikeObj=Ad;tc.parseJsonLikeObj=Ad;var Tc=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");Tc.loadPackage=function(pc,bb){var Ma,oa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(La){switch(La.nextAddress){case 1:return La.yield(pc.importPackage(bb.address+"/"),2);case 2:if(!bb.main){La.jumpTo(3);break}return La.yield(pc.importModule(bb.main.toString()),3);case 3:if(!bb.test){La.jumpTo(5);break}La.setCatchFinallyBlocks(6);return La.yield(pc.importPackage("mocha-es6"),
8);case 8:return Ma=La.yieldResult,La.yield(Ma.installSystemInstantiateHook(),9);case 9:return La.yield(pc.importModule(bb.test.toString()),10);case 10:La.leaveTryBlock(5);break;case 6:oa=La.enterCatchBlock(),console.warn("Cannot load test of new package: "+oa);case 5:return La.return(pc.getPackage(bb.address))}})};Tc.interactivelyCreatePackage=xe;Tc.interactivelyLoadPackage=qc;Tc.interactivelyReloadPackage=td;Tc.interactivelyUnloadPackage=be;Tc.interactivelyRemovePackage=Bd;Tc.showExportsAndImportsOf=
pe;Tc.parseJsonLikeObj=Ad;Tc.arr=jc;Tc.resource=Wc;Tc.interactivelyCreatePackage=xe;Tc.interactivelyCreatePackage=xe;Tc.interactivelyLoadPackage=qc;Tc.interactivelyLoadPackage=qc;Tc.interactivelyReloadPackage=td;Tc.interactivelyReloadPackage=td;Tc.interactivelyUnloadPackage=be;Tc.interactivelyUnloadPackage=be;Tc.interactivelyRemovePackage=Bd;Tc.interactivelyRemovePackage=Bd;Tc.showExportsAndImportsOf=pe;Tc.showExportsAndImportsOf=pe;var fb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");
fb.isTestModule=Se;fb.shortModuleName=nc;fb.interactivelyChangeModule=$c;fb.interactivelyReloadModule=ge;fb.interactivelyUnloadModule=ad;fb.interactivelyRemoveModule=ie;fb.addModule=Yb;fb.interactivelyAddModule=zb;fb._askForModuleName=function(pc,bb,Ma){var oa,La;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){switch(Ua.nextAddress){case 1:return Ua.yield(Ma.prompt("Enter module name",{input:bb,historyId:"lively.vm-editor-add-module-name"}),2);case 2:bb=Ua.yieldResult;if(!bb)throw"Canceled";
return Ua.yield(pc.normalize(bb),3);case 3:return oa=Ua.yieldResult,Ua.yield(Ma.confirm(["Create module \n",{},oa,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:La=Ua.yieldResult;if(!La)throw"Canceled";return Ua.return(oa)}})};fb._searchForExistingFiles=function(pc,bb,Ma){return $jscomp.asyncExecutePromiseGeneratorProgram(function(oa){return String(bb).match(/^http/)?oa.return(fb._searchForExistingFilesWeb(pc,bb,Ma)):oa.return(fb._searchForExistingFilesManually(pc,bb,Ma))})};fb._searchForExistingFilesManually=
function(pc,bb,Ma){var oa,La;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){switch(Ua.nextAddress){case 1:return Ua.yield(pc.world().multipleChoicePrompt("Add Module",{requester:pc,choices:["Create New Module","Load Existing Module"]}),2);case 2:oa=Ua.yieldResult;if("Create New Module"===oa)return Ua.return("[create new module]");if("Load Existing Module"!==oa){Ua.jumpTo(3);break}return Ua.yield(pc.world().prompt("URL of module?",{input:bb,requester:pc,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),
4);case 4:if(La=Ua.yieldResult)return Ua.return([La]);case 3:throw"Canceled";}})};fb._searchForExistingFilesWeb=function(pc,bb,Ma){function oa(sb){sb.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(sb.name())||Ma&&fb.arr.pluck(Ma.modules,"name").includes(sb.url)?!0:!1}var La,Ua,Sb,Ca,Va,dc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sb){switch(sb.nextAddress){case 1:return(La=pc.world())&&(Ua=La.showLoadingIndicatorFor(pc,"Loading existing modules...")),
sb.yield(fb.resource(bb).dirList(5,{exclude:oa}),3);case 3:return sb.yield(sb.yieldResult.map(function(od){return od.url}),2);case 2:return Sb=sb.yieldResult,Ca=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(Sb.filter(function(od){return od.endsWith(".js")}).map(function(od){return{isListItem:!0,string:Ma&&0==od.indexOf(Ma.address)?Ma.name+od.slice(Ma.address.length):od,value:od}})),sb.yield(Promise.resolve(Ua&&Ua.remove()).then(function(){return pc.world().filterableListPrompt("What module to load?",
Ca,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:pc},pc?{extent:pc.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:Va=sb.yieldResult;if(!Va||"canceled"===Va.status||!Va.selected.length)throw"Canceled";dc=Va.selected||Va;Array.isArray(dc)||(dc=[dc]);return sb.return(dc)}})};fb._createAndLoadModules=function(pc,bb){var Ma,oa,La,Ua,Sb,Ca,Va,dc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sb){switch(sb.nextAddress){case 1:Array.isArray(bb)||(bb=[bb]),Ma=[],oa=
$jscomp.makeIterator(bb),La=oa.next();case 2:if(La.done){sb.jumpTo(4);break}Ua=La.value;return sb.yield(pc.forgetModule(Ua,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return sb.yield(pc.resourceEnsureExistance(Ua,'"format esm";\n'),6);case 6:return Sb=sb.yieldResult,Ca=fb,Va=Ca.isTestModule,sb.yield(Sb.read(),7);case 7:if(!Va.call(Ca,sb.yieldResult)){sb.jumpTo(8);break}if(System.global.Mocha&&System.global.chai){sb.jumpTo(8);break}return sb.yield(System.import("mocha-es6"),10);case 10:return sb.yield(fb.promise.waitFor(function(){return!!System.global.Mocha&&
!!System.global.chai}),8);case 8:return sb.setCatchFinallyBlocks(12),sb.yield(pc.importModule(Ua),14);case 14:Ma.push({name:Ua});sb.leaveTryBlock(3);break;case 12:dc=sb.enterCatchBlock(),Ma.push({name:Ua,error:dc});case 3:La=oa.next();sb.jumpTo(2);break;case 4:return sb.return(Ma)}})};fb.modulesInPackage_defaultExclude=function(pc){return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(pc.name())?!0:!1};fb.modulesInPackage=Rc;fb.obj=wc;fb.promise=Ud;fb.arr=jc;fb.resource=
Wc;fb.isTestModule=Se;fb.isTestModule=Se;fb.shortModuleName=nc;fb.shortModuleName=nc;fb.interactivelyChangeModule=$c;fb.interactivelyChangeModule=$c;fb.interactivelyReloadModule=ge;fb.interactivelyReloadModule=ge;fb.interactivelyUnloadModule=ad;fb.interactivelyUnloadModule=ad;fb.interactivelyRemoveModule=ie;fb.interactivelyRemoveModule=ie;fb.addModule=Yb;fb.addModule=Yb;fb.interactivelyAddModule=zb;fb.interactivelyAddModule=zb;fb.modulesInPackage=Rc;fb.modulesInPackage=Rc;var uc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");
uc.todo=function(pc){throw Error(pc+" is not yet implemented!");};uc.parseJsonLikeObj=Ad;uc.arr=jc;uc.Closure=Kd;uc.obj=wc;uc.resource=Wc;uc.transform=he;uc.modules=xd;var Rb=function(pc){var bb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js"),Ma=bb.hasOwnProperty("AbstractCoreInterface")&&"function"===typeof bb.AbstractCoreInterface?bb.AbstractCoreInterface:bb.AbstractCoreInterface=function(oa){oa&&oa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return gd(Ma,pc,[{key:"dynamicCompletionsForPrefix",value:function(oa,La,Ua){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){uc.todo("dynamicCompletionsForPrefix");Sb.jumpToEnd()})}},{key:"runEval",value:function(oa,La){uc.todo("runEval")}},{key:"resourceExists",value:function(oa){uc.todo("resourceExists")}},{key:"resourceEnsureExistance",value:function(oa,La){uc.todo("resourceEnsureExistance")}},{key:"resourceMkdir",value:function(oa){uc.todo("resourceMkdir")}},{key:"resourceRead",
value:function(oa){uc.todo("resourceRead")}},{key:"resourceRemove",value:function(oa){uc.todo("resourceRemove")}},{key:"resourceWrite",value:function(oa,La){uc.todo("resourceWrite")}},{key:"resourceCreateFiles",value:function(oa,La){uc.todo("resourceCreateFiles")}},{key:"resourceDirList",value:function(oa,La,Ua){uc.todo("resourceDirList")}},{key:"normalizeSync",value:function(oa,La,Ua){uc.todo("normalizeSync")}},{key:"normalize",value:function(oa,La,Ua){uc.todo("normalize")}},{key:"printSystemConfig",
value:function(){uc.todo("printSystemConfig")}},{key:"getConfig",value:function(){uc.todo("getConfig")}},{key:"setConfig",value:function(oa){uc.todo("setConfig")}},{key:"getPackages",value:function(oa){uc.todo("getPackages")}},{key:"isModuleLoaded",value:function(oa,La){uc.todo("isModuleLoaded")}},{key:"doesModuleExist",value:function(oa,La){uc.todo("doesModuleExist")}},{key:"getModules",value:function(){var oa=this,La,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){return 1==Sb.nextAddress?
(La=uc.arr,Ua=La.flatmap,Sb.yield(oa.getPackages(),2)):Sb.return(Ua.call(La,Sb.yieldResult,function(Ca){return Ca.modules}))})}},{key:"getModule",value:function(oa){var La=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){return 1==Ua.nextAddress?Ua.yield(La.getModules(),2):Ua.return(Ua.yieldResult.find(function(Sb){return Sb.name===oa}))})}},{key:"getPackage",value:function(oa){var La=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){return 1==Ua.nextAddress?
(oa=oa.replace(/\/+$/,""),Ua.yield(La.getPackages(),2)):Ua.return(Ua.yieldResult.find(function(Sb){return Sb.address===oa||Sb.name===oa}))})}},{key:"getPackageForModule",value:function(oa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(La){uc.todo("getPackageForModule");La.jumpToEnd()})}},{key:"systemConfChange",value:function(oa){var La=uc.parseJsonLikeObj(oa);["baseURL"].forEach(function(Ua){return delete La[Ua]});return this.setConfig(La)}},{key:"resourcesOfPackage",value:function(oa,
La){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){uc.todo("resourcesOfPackage");Ua.jumpToEnd()})}},{key:"registerPackage",value:function(oa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(La){uc.todo("registerPackage");La.jumpToEnd()})}},{key:"importPackage",value:function(oa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(La){uc.todo("importPackage");La.jumpToEnd()})}},{key:"removePackage",value:function(oa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(La){uc.todo("removePackage");
La.jumpToEnd()})}},{key:"reloadPackage",value:function(oa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(La){uc.todo("reloadPackage");La.jumpToEnd()})}},{key:"packageConfChange",value:function(oa,La){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){uc.todo("packageConfChange");Ua.jumpToEnd()})}},{key:"importModule",value:function(oa){uc.todo("importModule")}},{key:"forgetModule",value:function(oa,La){uc.todo("forgetModule")}},{key:"reloadModule",value:function(oa,La){uc.todo("reloadModule")}},
{key:"moduleFormat",value:function(oa){uc.todo("moduleFormat")}},{key:"moduleRead",value:function(oa){uc.todo("moduleRead")}},{key:"moduleSourceChange",value:function(oa,La,Ua){uc.todo("moduleSourceChange")}},{key:"importsAndExportsOf",value:function(oa,La){uc.todo("importsAndExportsOf")}},{key:"keyValueListOfVariablesInModule",value:function(oa,La){uc.todo("keyValueListOfVariablesInModule")}},{key:"moduleWrite",value:function(oa,La){return this.moduleSourceChange(oa,La)}}],[{key:Symbol.for("__LivelyClassName__"),
get:function(){return"AbstractCoreInterface"}}],bb,{pathInPackage:function(){return"interfaces/interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:327,end:3944})}(void 0);uc.AbstractCoreInterface=Rb;uc.AbstractCoreInterface=Rb;uc.AbstractCoreInterface=Rb;var Fc=function(pc){var bb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js"),
Ma=bb.hasOwnProperty("RemoteCoreInterface")&&"function"===typeof bb.RemoteCoreInterface?bb.RemoteCoreInterface:bb.RemoteCoreInterface=function(oa){oa&&oa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return gd(Ma,pc,[{key:Symbol.for("lively-instance-initialize"),value:function(){gd._get(Object.getPrototypeOf(Ma.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.currentEval=null}},{key:"runEval",value:function(oa,
La){throw Error("Not yet implemented");}},{key:"runEvalAndStringify",value:function(oa,La){var Ua=this;return this.currentEval?this.currentEval.then(function(){return Ua.runEvalAndStringify(oa,La)}):this.currentEval=Promise.resolve().then(function(){var Sb,Ca,Va,dc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sb){switch(sb.nextAddress){case 1:return sb.yield(Ua.runEval("\n        Promise.resolve((async "+uc.transform.wrapInFunction(oa)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},La)),2);case 2:if((Sb=sb.yieldResult)&&Sb.isError)throw Error(String(Sb.value||Sb.error));if(!Sb||!Sb.value)return sb.return(null);if(Ca=Sb.promisedValue){sb.jumpTo(3);break}return sb.yield(Sb.value,4);case 4:Ca=sb.yieldResult;case 3:Va=Ca;if(!Va)return sb.return();if("undefined"===Va)return sb.return(void 0);if("null"===Va)return sb.return(null);if("true"===Va)return sb.return(!0);
if("false"===Va)return sb.return(!1);try{dc=JSON.parse(Va)}catch(od){return sb.return(Va)}if(dc&&dc.isError)throw Error(String(dc.value));return sb.return(dc)}})}).then(function(Sb){delete Ua.currentEval;return Sb},function(Sb){delete Ua.currentEval;return Promise.reject(Sb)})}},{key:"dynamicCompletionsForPrefix",value:function(oa,La,Ua){var Sb=this,Ca,Va;return $jscomp.asyncExecutePromiseGeneratorProgram(function(dc){Ca=uc.obj.isString(Ua.context)?Ua.context:!1;Ua=uc.obj.dissoc(Ua,["systemInterface",
"System","context"]);Va="\n      var prefix = "+JSON.stringify(La)+",\n          opts = "+JSON.stringify(Ua)+";\n      opts.context = "+Ca+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return dc.return(Sb.runEvalAndStringify(Va))})}},{key:"evalWithResource",value:function(oa,La,Ua){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+oa+'").'+La+"("+(Ua?JSON.stringify(Ua):"")+");\n    ")}},{key:"resourceExists",value:function(oa){return this.evalWithResource(oa,"exists")}},{key:"resourceEnsureExistance",value:function(oa,La){return this.evalWithResource(oa,
"ensureExistance",La)}},{key:"resourceMkdir",value:function(oa){return this.evalWithResource(oa,"mkdir")}},{key:"resourceRead",value:function(oa){return this.evalWithResource(oa,"read")}},{key:"resourceRemove",value:function(oa){return this.evalWithResource(oa,"remove")}},{key:"resourceWrite",value:function(oa,La){return this.evalWithResource(oa,"write",La)}},{key:"resourceCreateFiles",value:function(oa,La){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
oa+'", '+JSON.stringify(La)+")")}},{key:"resourceDirList",value:function(oa,La,Ua){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+oa+'").dirList('+JSON.stringify(La)+", "+JSON.stringify(Ua)+"))\n        .map(({url}) => ({url}))")}},{key:"livelySystemAccessor",value:function(oa){oa=void 0===oa?"livelySystem":oa;return"var "+oa+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
oa+') throw new Error("lively-system-interface not available!");'}},{key:"normalizeSync",value:function(oa,La,Ua){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(oa)+", "+JSON.stringify(La)+", "+Ua+")")}},{key:"normalize",value:function(oa,La,Ua){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(oa)+", "+JSON.stringify(La)+", "+JSON.stringify(Ua)+")")}},{key:"printSystemConfig",value:function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")}},
{key:"getConfig",value:function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')}},{key:"setConfig",value:function(oa){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(oa)+")")}},{key:"getPackages",value:function(oa){oa=Object.assign({excluded:[]},oa);oa.excluded=oa.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(oa)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')}},{key:"getPackageForModule",value:function(oa){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(oa)+")")}},{key:"isModuleLoaded",value:function(oa,La){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+oa+'", '+La+")")}},{key:"doesModuleExist",value:function(oa,La){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+oa+'", '+La+")")}},{key:"registerPackage",value:function(oa){var La=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){return Ua.return(La.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(oa)+")"))})}},
{key:"importPackage",value:function(oa){var La=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){return Ua.return(La.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(oa)+")"))})}},{key:"removePackage",value:function(oa){var La=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){return Ua.return(La.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(oa)+")"))})}},{key:"reloadPackage",value:function(oa,La){var Ua=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){return Sb.return(Ua.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(oa)+", "+JSON.stringify(La)+")"))})}},{key:"packageConfChange",value:function(oa,La){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(oa)+", "+JSON.stringify(La)+")")}},{key:"resourcesOfPackage",value:function(oa,La){La=void 0===La?[".git","node_modules",".module_cache","lively.next-node_modules"]:La;var Ua=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){oa.address&&
(oa=oa.address);return Sb.return(Ua.runEvalAndStringify("\n      "+Ua.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(oa)+", "+JSON.stringify(La)+");"))})}},{key:"getModule",value:function(oa){var La=this,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){if(1==Sb.nextAddress)return Sb.yield(La.getModules(),2);Ua=Sb.yieldResult.find(function(Ca){return Ca.name===oa});return Sb.return(Ua?uc.modules.module(Ua.name):null)})}},{key:"importModule",
value:function(oa){return this.runEvalAndStringify("lively.modules.System.import("+JSON.stringify(oa)+")")}},{key:"forgetModule",value:function(oa,La){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(oa)+").unload("+JSON.stringify(La)+")")}},{key:"reloadModule",value:function(oa,La){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(oa)+").reload("+JSON.stringify(La)+")")}},{key:"moduleFormat",value:function(oa){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(oa)+").format();")}},{key:"moduleRead",value:function(oa){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(oa)+").source()")}},{key:"moduleSourceChange",value:function(oa,La,Ua){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(oa)+").changeSource("+JSON.stringify(La)+", "+JSON.stringify(Ua)+")")}},{key:"keyValueListOfVariablesInModule",value:function(oa,La){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+
JSON.stringify(oa)+", "+JSON.stringify(La)+")")}},{key:"importsAndExportsOf",value:function(oa,La){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(oa)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(oa)+").exports()})")}},{key:"exportsOfModules",value:function(oa){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(oa)+";\n      options.excludedPackages = ["+oa.excludedPackages.map(function(La){return"function"===
typeof La?La.toString():JSON.stringify(La)}).join(",")+"]\n      await livelySystem.localInterface.exportsOfModules(options)")}},{key:"searchInPackage",value:function(oa,La,Ua){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(oa)+", "+JSON.stringify(La)+", "+JSON.stringify(Ua)+")")}},{key:"loadMochaTestFile",value:function(oa,La){La=void 0===La?[]:La;var Ua=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){return Sb.return(Ua.runEvalAndStringify("\n      "+
Ua.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(oa)+", "+JSON.stringify(La)+"), result;\n      result = {testsByFile}"))})}},{key:"runMochaTests",value:function(oa,La,Ua,Sb){var Ca=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Va){oa&&oa instanceof RegExp&&(oa={isRegExp:!0,value:String(oa).replace(/^\/|\/$/g,"")});return Va.return(Ca.runEvalAndStringify("\n      var grep = "+JSON.stringify(oa)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
Ca.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(La||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})}}],
[{key:Symbol.for("__LivelyClassName__"),get:function(){return"RemoteCoreInterface"}}],bb,{pathInPackage:function(){return"interfaces/interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:3953,end:16249})}(uc.AbstractCoreInterface);uc.RemoteCoreInterface=Fc;uc.RemoteCoreInterface=Fc;uc.RemoteCoreInterface=Fc;var Uc=
lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");Uc.obj=wc;Uc.string=Ld;Uc.arr=jc;Uc.resource=Wc;Uc.createFiles=Pd;Uc.ast=Vb;Uc.modules=xd;Uc.vm=af;Uc.parseJsonLikeObj=Ad;Uc.AbstractCoreInterface=Rb;Uc.classToFunctionTransform=bf;Rb=function(pc){var bb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js"),Ma=bb.hasOwnProperty("LocalCoreInterface")&&"function"===typeof bb.LocalCoreInterface?bb.LocalCoreInterface:bb.LocalCoreInterface=
function(oa){oa&&oa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return gd(Ma,pc,[{key:"name",get:function(){return"local"}},{key:"dynamicCompletionsForPrefix",value:function(oa,La,Ua){var Sb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){if(1==Ca.nextAddress)return Ca.yield(Uc.vm.completions.getCompletions(function(Va){return Uc.vm.runEval(Va.replace("return ",""),Object.assign({targetModule:oa,classTransform:Uc.classToFunctionTransform},
Ua))},La),2);Sb=Ca.yieldResult;if(Sb.isError)throw Sb.value;return Ca.return({completions:Sb.completions,prefix:Sb.startLetters})})}},{key:"runEval",value:function(oa,La){return Uc.vm.runEval(oa,Object.assign({classTransform:Uc.classToFunctionTransform},La))}},{key:"resourceExists",value:function(oa){return Uc.resource(oa).exists()}},{key:"resourceEnsureExistance",value:function(oa,La){return Uc.resource(oa).ensureExistance(La)}},{key:"resourceMkdir",value:function(oa){return Uc.resource(oa).mkdir()}},
{key:"resourceRead",value:function(oa){return Uc.resource(oa).read()}},{key:"resourceRemove",value:function(oa){return Uc.resource(oa).remove()}},{key:"resourceWrite",value:function(oa,La){return Uc.resource(oa).write(La)}},{key:"resourceCreateFiles",value:function(oa,La){return Uc.createFiles(oa,La)}},{key:"resourceDirList",value:function(oa,La,Ua){return Uc.resource(oa).dirList(La,Ua)}},{key:"normalizeSync",value:function(oa,La,Ua){return System.decanonicalize(oa,La,Ua)}},{key:"normalize",value:function(oa,
La,Ua){return System.normalize(oa,La,Ua)}},{key:"printSystemConfig",value:function(){return Uc.modules.printSystemConfig()}},{key:"getConfig",value:function(){return System.getConfig()}},{key:"setConfig",value:function(oa){Uc.modules.System.config(oa)}},{key:"getPackages",value:function(oa){oa=Object.assign({},oa);oa=void 0===oa.excluded?[]:oa.excluded;var La=oa.filter(function(Sb){return"string"===typeof Sb}),Ua=oa.filter(function(Sb){return"function"===typeof Sb});La=La.concat(La.map(function(Sb){return System.decanonicalize(Sb.replace(/\/?$/,
"/")).replace(/\/$/,"")}));return Uc.modules.getPackages().filter(function(Sb){return!La.includes(Sb.url)&&!Ua.some(function(Ca){return Ca(Sb.url)})})}},{key:"registerPackage",value:function(oa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(La){return La.return(Uc.modules.registerPackage(oa))})}},{key:"importPackage",value:function(oa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(La){return La.return(Uc.modules.importPackage(oa))})}},{key:"removePackage",value:function(oa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(La){return La.return(Uc.modules.removePackage(oa))})}},
{key:"reloadPackage",value:function(oa,La){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){return Ua.return(Uc.modules.reloadPackage(oa,La))})}},{key:"packageConfChange",value:function(oa,La){var Ua=this,Sb,Ca,Va,dc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sb){if(1==sb.nextAddress)return Sb=Uc.modules.System,Ca=Uc.parseJsonLikeObj(oa),Va=JSON.stringify(Ca,null,2),sb.yield(Uc.modules.module(La).changeSource(Va,{doEval:!1}),2);if(3!=sb.nextAddress)return Sb.set(La,
Sb.newModule(Ca)),sb.yield(Ua.getPackageForModule(La),3);(dc=sb.yieldResult)&&Uc.modules.applyPackageConfig(Ca,dc.address);sb.jumpToEnd()})}},{key:"resourcesOfPackage",value:function(oa,La){La=void 0===La?[".git","node_modules",".module_cache"]:La;var Ua,Sb,Ca;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Va){if(1==Va.nextAddress)return Va.setCatchFinallyBlocks(2),Ua=oa.address?oa.address:oa,Sb=Uc.modules.getPackage(Ua),Va.yield(Sb.resources(void 0,La),4);if(2!=Va.nextAddress)return Va.return(Va.yieldResult.map(function(dc){return Object.assign(dc,
{package:dc.package.url})}));Ca=Va.enterCatchBlock();console.warn("resourcesOfPackage error for "+oa+": "+Ca);return Va.return([])})}},{key:"getPackageForModule",value:function(oa){return(oa=Uc.modules.getPackageOfModule(oa))?oa.asSpec():oa}},{key:"isModuleLoaded",value:function(oa,La){return Uc.modules.isModuleLoaded(oa,La)}},{key:"doesModuleExist",value:function(oa,La){return Uc.modules.isModuleLoaded(oa,La)}},{key:"getModule",value:function(oa){return Uc.modules.module(oa)}},{key:"importModule",
value:function(oa){return Uc.modules.System.import(oa)}},{key:"forgetModule",value:function(oa,La){return Uc.modules.module(oa).unload(La)}},{key:"reloadModule",value:function(oa,La){return Uc.modules.module(oa).reload(La)}},{key:"moduleFormat",value:function(oa){return Uc.modules.module(oa).format()}},{key:"moduleRead",value:function(oa){return Uc.modules.module(oa).source()}},{key:"moduleSourceChange",value:function(oa,La,Ua){return Uc.modules.module(oa).changeSource(La,Ua)}},{key:"keyValueListOfVariablesInModule",
value:function(oa,La){var Ua=this,Sb,Ca,Va,dc,sb,od,bc,Td;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rd){switch(rd.nextAddress){case 1:if(La){rd.jumpTo(2);break}return rd.yield(Ua.resourceRead(oa),3);case 3:La=rd.yieldResult;case 2:return Sb="string"===typeof La?Uc.ast.parse(La):La,Ca=Ua.normalizeSync(oa),Ua.moduleFormat(Ca),Va=Uc.modules.module(Ca).env().recorder,rd.yield(Ua.importsAndExportsOf(Ca,Sb),4);case 4:return dc=rd.yieldResult,sb=Uc.ast.query.topLevelDeclsAndRefs(Sb),od=
Uc.arr.sortByKey(Uc.ast.query.declarationsOfScope(sb.scope,!0),"start"),bc=Uc.arr.pluck(sb.scope.importSpecifiers,"name"),Td=0,rd.return(od.map(function(dd){var Ub=dd.name.length,Ne=dc.exports.find(function(Tb){return Tb.local===dd.name}),gc=Uc.arr.include(bc,dd.name);Ne&&(Ub+=9);gc&&(Ub+=9);Td=Math.max(Td,Ub);return{isExport:Ne,isImport:gc,name:dd.name,value:Va[dd.name],node:dd,printedName:dd.name+(Ne?" [export]":"")+(gc?" [import]":""),printedValue:Uc.obj.inspect(Va[dd.name],{maxDepth:1}).replace(/\n/g,
"")}}).map(function(dd){return{isListItem:!0,value:dd,string:dd.printedName+Uc.string.indent(" = "+dd.printedValue," ",Td-dd.printedName.length)}}))}})}},{key:"importsAndExportsOf",value:function(oa,La){var Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){return 1==Sb.nextAddress?Sb.yield(Uc.modules.module(oa).imports(La),2):3!=Sb.nextAddress?(Ua=Sb.yieldResult,Sb.yield(Uc.modules.module(oa).exports(La),3)):Sb.return({imports:Ua,exports:Sb.yieldResult})})}},{key:"exportsOfModules",
value:function(oa){return Uc.modules.ExportLookup.run(System,oa)}},{key:"searchInPackage",value:function(oa,La,Ua){return Uc.modules.getPackage(oa).search(La,Ua)}},{key:"runMochaTests",value:function(oa,La,Ua,Sb){var Ca,Va;return $jscomp.asyncExecutePromiseGeneratorProgram(function(dc){if(1==dc.nextAddress)return dc.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);Ca=dc.yieldResult;Va=Ca.runMochaTests;return dc.return(Va(oa,La,Ua,Sb))})}},{key:"loadMochaTestFile",value:function(oa,
La){var Ua,Sb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){if(1==Ca.nextAddress)return Ca.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);Ua=Ca.yieldResult;Sb=Ua.loadMochaTestFile;return Ca.return(Sb(oa,La))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"LocalCoreInterface"}}],bb,{pathInPackage:function(){return"interfaces/local-system.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},
package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:411,end:8203})}(Uc.AbstractCoreInterface);Uc.LocalCoreInterface=Rb;Uc.LocalCoreInterface=Rb;Uc.LocalCoreInterface=Rb;var vd=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");vd.evalStrategies=Ve;vd.RemoteCoreInterface=Fc;var Xd=function(pc){var bb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js"),Ma=bb.hasOwnProperty("HTTPCoreInterface")&&
"function"===typeof bb.HTTPCoreInterface?bb.HTTPCoreInterface:bb.HTTPCoreInterface=function(oa){oa&&oa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return gd(Ma,pc,[{key:Symbol.for("lively-instance-initialize"),value:function(oa){gd._get(Object.getPrototypeOf(Ma.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.currentEval=null;this.url=oa;this.server=new vd.evalStrategies.HttpEvalStrategy(oa)}},{key:"name",
get:function(){return this.url}},{key:"description",get:function(){return this.url.replace(/^https?:\/\//,"")}},{key:"runEval",value:function(oa,La){return this.server.runEval(oa,La)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"HTTPCoreInterface"}}],bb,{pathInPackage:function(){return"interfaces/http-interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",
version:"0.2.1"}}},{start:106,end:512})}(vd.RemoteCoreInterface);vd.HTTPCoreInterface=Xd;vd.HTTPCoreInterface=Xd;vd.HTTPCoreInterface=Xd;var vc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");vc.evalStrategies=Ve;vc.RemoteCoreInterface=Fc;Fc=function(pc){var bb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js"),Ma=bb.hasOwnProperty("L2LCoreInterface")&&"function"===typeof bb.L2LCoreInterface?bb.L2LCoreInterface:bb.L2LCoreInterface=
function(oa){oa&&oa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return gd(Ma,pc,[{key:Symbol.for("lively-instance-initialize"),value:function(oa,La){gd._get(Object.getPrototypeOf(Ma.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.targetId=oa;this.peer=La}},{key:"name",get:function(){return"l2l "+this.targetId}},{key:"description",get:function(){var oa=this.peer,La="l2l "+this.targetId.slice(0,5);if(oa){var Ua=
oa.location,Sb=oa.type,Ca=oa.user;oa=oa.world;Sb&&(La+=", "+Sb);Ua&&(La+=", "+Ua.replace(/^https?:\/\//,"")+(oa?"/"+oa:""));Ca&&(La+=", "+Ca.name)}return La}},{key:"client",get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}},{key:"isConnected",value:function(){var oa=this,La,Ua,Sb,Ca,Va;return $jscomp.asyncExecutePromiseGeneratorProgram(function(dc){if(1==dc.nextAddress)return La=oa,Ua=La.client,Sb=La.targetId,dc.yield(Ua.sendToAndWait(Ua.trackerId,
"getClients",{}),2);Ca=dc.yieldResult;Va=Ca.data;return dc.return(Va.some(function(sb){sb=$jscomp.makeIterator(sb).next().value;return Sb===sb}))})}},{key:"runEval",value:function(oa,La){var Ua=this,Sb,Ca;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Va){Sb=Ua.client;if(!Sb)throw Error("No lively.2lively default client available!");Ca=new vc.evalStrategies.L2LEvalStrategy(Sb,Ua.targetId);return Va.return(Ca.runEval(oa,La))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"L2LCoreInterface"}}],
bb,{pathInPackage:function(){return"interfaces/l2l-interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:106,end:1449})}(vc.RemoteCoreInterface);vc.L2LCoreInterface=Fc;vc.L2LCoreInterface=Fc;vc.L2LCoreInterface=Fc;var Oc=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");Oc.systemInterfaceNamed=
Mc;Oc.interactivelyCreatePackage=xe;Oc.interactivelyLoadPackage=qc;Oc.interactivelyReloadPackage=td;Oc.interactivelyUnloadPackage=be;Oc.interactivelyRemovePackage=Bd;Oc.showExportsAndImportsOf=pe;Oc.shortModuleName=nc;Oc.addModule=Yb;Oc.interactivelyChangeModule=$c;Oc.interactivelyReloadModule=ge;Oc.interactivelyUnloadModule=ad;Oc.interactivelyRemoveModule=ie;Oc.interactivelyAddModule=zb;Oc.modulesInPackage=Rc;Oc.LocalCoreInterface=Rb;Oc.HTTPCoreInterface=Xd;Oc.L2LCoreInterface=Fc;Fc=$a("Interface",
function(pc){var bb=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js"),Ma=bb.hasOwnProperty("Interface")&&"function"===typeof bb.Interface?bb.Interface:bb.Interface=function(oa){oa&&oa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return gd(Ma,pc,[{key:Symbol.for("lively-instance-initialize"),value:function(oa){this.coreInterface=oa}},{key:"isSystemInterface",get:function(){return!0}},{key:"name",get:function(){return this.coreInterface.name}},
{key:"dynamicCompletionsForPrefix",value:function(oa,La,Ua){return this.coreInterface.dynamicCompletionsForPrefix(oa,La,Ua)}},{key:"runEval",value:function(oa,La){return this.coreInterface.runEval(oa,La)}},{key:"printSystemConfig",value:function(oa,La,Ua){return this.coreInterface.printSystemConfig(oa,La,Ua)}},{key:"getConfig",value:function(oa,La,Ua){return this.coreInterface.getConfig(oa,La,Ua)}},{key:"getPackages",value:function(oa){return this.coreInterface.getPackages(oa)}},{key:"getModules",
value:function(oa,La,Ua){return this.coreInterface.getModules(oa,La,Ua)}},{key:"getModule",value:function(oa,La,Ua){return this.coreInterface.getModule(oa,La,Ua)}},{key:"getPackage",value:function(oa,La,Ua){return this.coreInterface.getPackage(oa,La,Ua)}},{key:"getPackageForModule",value:function(oa,La,Ua){return this.coreInterface.getPackageForModule(oa,La,Ua)}},{key:"resourcesOfPackage",value:function(oa,La){return this.coreInterface.resourcesOfPackage(oa,La)}},{key:"systemConfChange",value:function(oa,
La,Ua){return this.coreInterface.systemConfChange(oa,La,Ua)}},{key:"registerPackage",value:function(oa){return this.coreInterface.registerPackage(oa)}},{key:"importPackage",value:function(oa){return this.coreInterface.importPackage(oa)}},{key:"removePackage",value:function(oa){return this.coreInterface.removePackage(oa)}},{key:"reloadPackage",value:function(oa){return this.coreInterface.reloadPackage(oa)}},{key:"packageConfChange",value:function(oa,La){return this.coreInterface.packageConfChange(oa,
La)}},{key:"keyValueListOfVariablesInModule",value:function(oa,La){return this.coreInterface.keyValueListOfVariablesInModule(oa,La)}},{key:"interactivelyCreatePackage",value:function(oa){return Oc.interactivelyCreatePackage(this.coreInterface,oa)}},{key:"interactivelyLoadPackage",value:function(oa,La){return Oc.interactivelyLoadPackage(this.coreInterface,oa,La)}},{key:"interactivelyReloadPackage",value:function(oa,La){return Oc.interactivelyReloadPackage(this.coreInterface,oa,La)}},{key:"interactivelyUnloadPackage",
value:function(oa,La,Ua){return Oc.interactivelyUnloadPackage(this.coreInterface,oa,La,Ua)}},{key:"interactivelyRemovePackage",value:function(oa,La){return Oc.interactivelyRemovePackage(this.coreInterface,oa,La)}},{key:"isModuleLoaded",value:function(oa,La){return this.coreInterface.isModuleLoaded(oa,La)}},{key:"doesModuleExist",value:function(oa,La){return this.coreInterface.doesModuleExist(oa,La)}},{key:"createModule",value:function(oa){return Oc.addModule(this.coreInterface,oa)}},{key:"importModule",
value:function(oa){return this.coreInterface.importModule(oa)}},{key:"forgetModule",value:function(oa,La){return this.coreInterface.forgetModule(oa,La)}},{key:"reloadModule",value:function(oa,La){return this.coreInterface.reloadModule(oa,La)}},{key:"moduleFormat",value:function(oa){return this.coreInterface.moduleFormat(oa)}},{key:"moduleRead",value:function(oa){return this.coreInterface.moduleRead(oa)}},{key:"moduleWrite",value:function(oa,La){return this.coreInterface.moduleWrite(oa,La)}},{key:"getModulesInPackage",
value:function(oa){return Oc.modulesInPackage(this.coreInterface,oa)}},{key:"shortModuleName",value:function(oa,La){return Oc.shortModuleName(this.coreInterface,oa,La)}},{key:"interactivelyChangeModule",value:function(oa,La,Ua){return Oc.interactivelyChangeModule(this.coreInterface,oa,La,Ua)}},{key:"interactivelyReloadModule",value:function(oa,La){return Oc.interactivelyReloadModule(this.coreInterface,oa,La)}},{key:"interactivelyUnloadModule",value:function(oa,La){return Oc.interactivelyUnloadModule(this.coreInterface,
oa,La)}},{key:"interactivelyRemoveModule",value:function(oa,La){return Oc.interactivelyRemoveModule(this.coreInterface,oa,La)}},{key:"interactivelyAddModule",value:function(oa,La){return Oc.interactivelyAddModule(this.coreInterface,oa,La)}},{key:"showExportsAndImportsOf",value:function(oa,La){return Oc.showExportsAndImportsOf(this.coreInterface,oa,La)}},{key:"exportsOfModules",value:function(oa){return this.coreInterface.exportsOfModules(oa)}},{key:"searchInPackage",value:function(oa,La,Ua){return this.coreInterface.searchInPackage(oa,
La,Ua)}},{key:"searchInAllPackages",value:function(oa,La){La=void 0===La?{}:La;var Ua=this,Sb,Ca,Va,dc,sb,od,bc,Td;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rd){switch(rd.nextAddress){case 1:return(Sb=La.progress)&&Sb.step("Fetching Packages...",0),rd.yield(Ua.coreInterface.getPackages({excluded:La.excludedPackages}),2);case 2:Ca=rd.yieldResult,Va=[],Sb&&Sb.step("Fetching Packages...",.1),dc=0;case 3:if(!(dc<Ca.length)){rd.jumpTo(5);break}sb=Ca[dc];od=sb.url;if(!od||"no group"===
od){rd.jumpTo(4);break}Sb&&Sb.step(od.replace(System.baseURL,"").slice(0,20),.1+dc/Ca.length*.9);rd.setCatchFinallyBlocks(6);return rd.yield(Ua.coreInterface.searchInPackage(od,oa,La),8);case 8:bc=rd.yieldResult;Va=Va.concat(bc);rd.leaveTryBlock(4);break;case 6:Td=rd.enterCatchBlock(),console.error("Error searching in package "+od+":\n"+Td.stack);case 4:dc++;rd.jumpTo(3);break;case 5:return rd.return(Va)}})}},{key:"loadMochaTestFile",value:function(oa,La){return this.coreInterface.loadMochaTestFile(oa,
La)}},{key:"runMochaTests",value:function(oa,La,Ua,Sb){return this.coreInterface.runMochaTests(oa,La,Ua,Sb)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Interface"}}],bb,{pathInPackage:function(){return"index.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:679,end:6188})}(void 0));Oc.Interface=Fc;Oc.Interface=
Fc;Oc.Interface=Fc;Oc.systemInterfaceNamed=Mc;Oc.systemInterfaceNamed=Mc;Fc=$a("localInterface",new Oc.Interface(new Oc.LocalCoreInterface));Oc.localInterface=Fc;Oc.localInterface=Fc;Oc.localInterface=Fc;Oc.httpInterfaces={};Fc=$a("serverInterfaceFor",function(pc){return Oc.httpInterfaces[pc]||(Oc.httpInterfaces[pc]=new Oc.Interface(new Oc.HTTPCoreInterface(pc)))});Oc.serverInterfaceFor=Fc;Oc.serverInterfaceFor=Fc;Oc.serverInterfaceFor=Fc;Oc.l2lInterfaces={};Fc=$a("l2lInterfaceFor",function(pc,bb){return Oc.l2lInterfaces[pc]||
(Oc.l2lInterfaces[pc]=new Oc.Interface(new Oc.L2LCoreInterface(pc,bb)))});Oc.l2lInterfaceFor=Fc;Oc.l2lInterfaceFor=Fc;Oc.l2lInterfaceFor=Fc}}});