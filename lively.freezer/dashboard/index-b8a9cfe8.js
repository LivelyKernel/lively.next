System.register(["./__root_module__-aa47e4cd.js","kld-intersections"],function(Ca){var ub,Tb,lc,mc,Zd,id,ce,kd,$c,Cd,Fd,pe,Xd;return{setters:[function(nd){ub=nd.bt;Tb=nd.a4;lc=nd.r;mc=nd.a5;Zd=nd.bn;id=nd.bu;ce=nd.bv;kd=nd.T;$c=nd.s;Cd=nd.bw;Fd=nd.bx;pe=nd.n;Xd=nd.by},function(){}],execute:function(){function nd(Q){try{var ea=eval("("+kb.ast.transform.wrapInFunction("var _; _ = ("+Q+")")+")()")}catch(Ga){return JSON.parse(Q)}return"object"!==typeof ea?null:ea}function eb(Q,ea){var Ga,Ua,fc,Fb,
Va,Ab,td,Pc,Vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Oa){switch(Oa.nextAddress){case 1:return Ga=ea.world(),Oa.yield(Ga.prompt("Enter package name",{requester:ea,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:Ua=Oa.yieldResult;if(!Ua)throw"Canceled";Oa.setCatchFinallyBlocks(3);Fb=Db.resource(Ua);Ua=Fb.name();fc=Fb.url;Oa.leaveTryBlock(4);break;case 3:return Oa.enterCatchBlock(),Oa.yield(Q.getConfig(),5);case 5:return Va=Oa.yieldResult.baseURL,
Ab=Db.resource(Va).join(Ua).asDirectory().url,Oa.yield(Q.normalize(Ab),6);case 6:fc=Oa.yieldResult.replace(/\/\.js$/,"/");case 4:return Oa.yield(Ga.prompt("Confirm or change package location",{requester:ea,input:fc,historyId:"lively.vm-editor-add-package-address"}),7);case 7:td=Oa.yieldResult;if(!td)throw"Canceled";Pc=Db.resource(td).asDirectory();Vb=Pc.asFile().url;return Oa.yield(Q.removePackage(Vb),8);case 8:return Oa.yield(Q.resourceCreateFiles(Vb,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+
Ua+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+Ua+"\n\nNo description for package "+Ua+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+Ua+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return Oa.return(Db.loadPackage(Q,{name:Ua,address:Vb,configFile:Pc.join("package.json").url,main:Pc.join("index.js").url,test:Pc.join("tests/test.js").url,type:"package"}))}})}function Hb(Q,ea,Ga){Ga=void 0===Ga?
null:Ga;var Ua,fc,Fb,Va,Ab,td,Pc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vb){switch(Vb.nextAddress){case 1:return Ua={name:"",address:"",type:"package"},Vb.yield(Q.getConfig(),2);case 2:fc=Vb.yieldResult;if(!Ga){Vb.jumpTo(3);break}return Vb.yield(Q.getPackage(Ga),4);case 4:if(Fb=Vb.yieldResult){Vb.jumpTo(5);break}return Vb.yield(Q.getPackageForModule(Ga),6);case 6:Fb=Vb.yieldResult;case 5:Va=Fb;case 3:return Vb.yield(ea.world().prompt("What is the package directory?",{requester:ea,
input:Va?Va.address:fc.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:Ab=Vb.yieldResult;if(!Ab)throw"Canceled";Ua.address=Ab.replace(/\/$/,"");Ua.url=new URL(Ua.address+"/");Ua.configFile=Db.resource(Ua.url).join("package.json").url;Vb.setCatchFinallyBlocks(8);td=JSON;Pc=td.parse;return Vb.yield(Q.moduleRead(Ua.configFile),10);case 10:Pc.call(td,Vb.yieldResult).name;Vb.leaveTryBlock(9);break;case 8:Vb.enterCatchBlock(),Ua.name=String(Ua.url).replace(/\/$/,""),
Q.resourceEnsureExistance(Ua.configFile,'{\n  "name": "'+Ua.name+'",\n  "version": "0.1.0"\n}');case 9:return Vb.return(Db.loadPackage(Q,Ua))}})}function Cc(Q,ea,Ga){var Ua,fc,Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Va){switch(Va.nextAddress){case 1:return Ua=Db.resource(Ga).asFile().url,Va.yield(Q.getPackage(Ua),2);case 2:if(fc=Va.yieldResult){Va.jumpTo(3);break}return Va.yield(Q.getPackageForModule(Ua),4);case 4:fc=Va.yieldResult;case 3:Fb=fc;if(!Fb)throw Error("Cannot find package for "+
Ua);return Va.yield(Q.reloadPackage(Ua),5);case 5:if(!ea){Va.jumpTo(0);break}return Va.yield(ea.updateModuleList(),7);case 7:return Va.yield(ea.uiSelect(Ua,!1),8);case 8:return Va.return(Va.yieldResult)}})}function qc(Q,ea,Ga,Ua){var fc,Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Va){switch(Va.nextAddress){case 1:return Va.yield(Q.getPackage(Ga),2);case 2:return fc=Va.yieldResult,Va.yield((Ua||$world).confirm("Unload package "+fc.name+"?",{requester:ea}),3);case 3:Fb=Va.yieldResult;
if(!Fb)throw"Canceled";return Va.yield(Q.removePackage(Ga),4);case 4:if(!ea){Va.jumpTo(0);break}return Va.yield(ea.updateModuleList(),6);case 6:return Va.yield(ea.uiSelect(null),0)}})}function ld(Q,ea,Ga){var Ua,fc,Fb,Va,Ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(td){switch(td.nextAddress){case 1:return Ua=ea.world(),td.yield(Q.getPackage(Ga),2);case 2:return fc=td.yieldResult,fc?td.yield(Ua.confirm("Really remove package "+fc.name+"?",{requester:ea}),3):($world.inform('No package "'+
Ga+'" found!',{requester:ea}),td.return());case 3:Fb=td.yieldResult;if(!Fb)throw"Canceled";Q.removePackage(Ga);return td.yield(Ua.confirm("Also remove directory "+fc.name+" including "+fc.modules.length+" modules?"),4);case 4:Va=td.yieldResult;if(!Va){td.jumpTo(0);break}return td.yield(Ua.confirm("REALLY *remove* directory "+fc.name+"? No undo possible..."),6);case 6:if(Ab=td.yieldResult)return td.yield(Q.resourceRemove(fc.address),0);td.jumpTo(0)}})}function wd(Q,ea,Ga){Ga=void 0===Ga?$world:Ga;
var Ua,fc,Fb,Va,Ab,td,Pc,Vb,Oa,Qa,Aa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(za){switch(za.nextAddress){case 1:return za.yield(Q.getPackage(ea),2);case 2:Ua=za.yieldResult;if(!Ua)throw Error("Cannot find package "+ea);fc=[];Fb=$jscomp.makeIterator(Ua.modules);Va=Fb.next();case 3:if(Va.done)return za.yield(Ga.execCommand("open text window",{title:"imports and exports of "+ea,content:fc.join("\n\n")}),0);Ab=Va.value;if(!Ab.name.match(/\.js$/)){za.jumpTo(4);break}za.setCatchFinallyBlocks(6);
td=Q;Pc=td.importsAndExportsOf;Vb=Ab.name;return za.yield(Q.moduleRead(Ab.name),9);case 9:return za.yield(Pc.call(td,Vb,za.yieldResult),8);case 8:Oa=za.yieldResult;za.leaveTryBlock(7);break;case 6:Qa=za.enterCatchBlock();Ga.logError(Error("Error when getting imports/exports from module "+Ab.name+":\n"+Qa.stack));za.jumpTo(4);break;case 7:Aa=""+Ab.name;if(!Oa.imports.length&&!Oa.exports.length){Aa+="\n  does not import / export anything";za.jumpTo(4);break}Oa.imports.length&&(Aa+="\n  imports:\n",
Aa+=Db.arr.groupByKey(Oa.imports,"fromModule").mapGroups(function(Ka,tb){return"from "+Ka+": "+tb.map(function(yb){return yb.local||yb.imported?yb.imported&&yb.imported!==yb.local?yb.imported+" as "+yb.local:yb.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(Ka){return"    "+Ka}).join("\n"));Oa.exports.length&&(Aa+="\n  exports:\n",Aa+=Oa.exports.map(function(Ka){return Ka.local?Ka.local&&Ka.local!==Ka.exported?Ka.local+" as "+Ka.exported:Ka.exported:Ka.exported+
" from "+Ka.fromModule}).join(", ").split("\n").map(function(Ka){return"    "+Ka}).join("\n"));fc.push(Aa);case 4:Va=Fb.next(),za.jumpTo(3)}})}function Xc(Q,ea,Ga){Ga=Ga&&Ga.address;if(Ga&&0===ea.indexOf(Ga))var Ua=ea.slice(Ga.length).replace(/^\//,"");else a:{Ga=Q.getConfig();if(!Ga||Ga.constructor!==Promise)try{Ua=String((new URL(ea)).relativePathFrom(new URL(Q.getConfig().baseURL)));break a}catch(fc){}Ua=ea}return Ua}function gd(Q,ea,Ga,Ua){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fc){return 1==
fc.nextAddress?(Ua=Object.assign({targetModule:ea},Ua),fc.yield(Q.normalize(ea),2)):3!=fc.nextAddress?(ea=fc.yieldResult,fc.yield(Q.moduleSourceChange(ea,Ga,Ua),3)):fc.return(ea)})}function bc(Q,ea,Ga,Ua,fc){Ua=void 0===Ua?!1:Ua;fc=void 0===fc?!1:fc;var Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Va){switch(Va.nextAddress){case 1:return ea&&ea.setStatusMessage("Reloading "+Ga),Va.setCatchFinallyBlocks(2),Va.yield(Q.reloadModule(Ga,{reloadDeps:Ua,resetEnv:fc}),4);case 4:if(!ea){Va.jumpTo(5);
break}return Va.yield(ea.updateModuleList(),6);case 6:case 5:ea&&ea.setStatusMessage("Reloded "+Ga);Va.leaveTryBlock(0);break;case 2:Fb=Va.enterCatchBlock();Va.setCatchFinallyBlocks(7);if(!ea){Va.jumpTo(9);break}return Va.yield(ea.updateEditorWithSourceOf(Ga),10);case 10:case 9:Va.leaveTryBlock(8);break;case 7:Va.enterCatchBlock();case 8:throw ea&&ea.showError(Fb),Fb;}})}function ad(Q,ea,Ga){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){switch(Ua.nextAddress){case 1:return Ua.yield(Q.forgetModule(Ga,
{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!ea){Ua.jumpTo(3);break}return Ua.yield(ea.updateModuleList(),4);case 4:case 3:Ua.jumpToEnd()}})}function ed(Q,ea,Ga){var Ua,fc,Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Va){switch(Va.nextAddress){case 1:return Va.yield(Q.normalize(Ga),2);case 2:return Ua=Va.yieldResult,Va.yield(ea.world().confirm("Remove file "+Ua+"?",{requester:ea}),3);case 3:fc=Va.yieldResult;if(!fc)throw"Canceled";return Va.yield(Q.forgetModule(Ua),4);case 4:return Va.yield(Q.resourceRemove(Ua),
5);case 5:return Va.yield(Q.getPackageForModule(Ua),6);case 6:return Fb=Va.yieldResult,Va.return(Fb)}})}function Id(Q,ea,Ga){var Ua,fc,Fb,Va,Ab,td,Pc,Vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Oa){switch(Oa.nextAddress){case 1:return Ua=URL,Oa.yield(Q.getConfig(),2);case 2:fc=new Ua(Oa.yieldResult.baseURL);Fb=ea.world();if(!Ga){Oa.jumpTo(3);break}return Oa.yield(Q.getPackage(Ga),4);case 4:if(Va=Oa.yieldResult){Oa.jumpTo(5);break}return Oa.yield(Q.getPackageForModule(Ga),6);case 6:Va=
Oa.yieldResult;case 5:(Ab=Va)&&(fc=new URL(Ab.address));case 3:return Oa.yield(Rb._searchForExistingFiles(ea,String(fc),Ab),7);case 7:td=Oa.yieldResult;if(!td.includes("[create new module]")){Oa.jumpTo(8);break}return Oa.yield(Rb._askForModuleName(Q,Ga||String(fc),Fb),9);case 9:Pc=Oa.yieldResult,td=[Pc];case 8:return Oa.yield(Rb._createAndLoadModules(Q,td),10);case 10:return Vb=Oa.yieldResult,Rb.arr.compact(Vb.map(function(Qa){return Qa.error})),Oa.return(Vb)}})}function hc(Q,ea){var Ga,Ua,fc,Fb,
Va,Ab,td,Pc,Vb,Oa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){if(1==Qa.nextAddress)return Qa.yield(Q.getPackage(ea),2);if(3!=Qa.nextAddress){Ga=Qa.yieldResult;if(!Ga||!Ga.address.match(/^http/))throw Error("Cannot load package "+ea);Ua=Rb.resource(Ga.address);fc=[];Fb=$jscomp;Va=Fb.makeIterator;return Qa.yield(Ua.dirList(5,{exclude:Rb.modulesInPackage_defaultExclude}),3)}Ab=Va.call(Fb,Qa.yieldResult);for(td=Ab.next();!td.done;td=Ab.next())Vb=Pc=td.value,Oa=Vb.url,Oa.match(/\.js$/)&&
Q.isModuleLoaded(Oa,!0)&&fc.push(Q.getModule(Oa));return Qa.return(fc)})}function Qb(Q,ea){ea=void 0===ea?[]:ea;var Ga;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){if(1==Ua.nextAddress)return Ua.yield(System.import("mocha-es6/index.js"),2);Ga=Ua.yieldResult;return Ua.return(Ga.loadTestModuleAndExtractTestState(Q,ea))})}function xb(Q,ea,Ga,Ua){function fc(Qa){return new Promise(function(Aa,za){var Ka=vc.arr.compact(Qa.suite.suites).map(function(yb){return yb.file}),tb=vc.chain(ea).filter(function(yb){return Ka.includes(yb.file)}).pluck("tests").flatten().value();
if(!tb||!tb.length)return za(Error("Trying to run tests of "+Ka.join(", ")+" but cannot find them in loaded tests!"));Qa.reporter(function(yb){yb.on("test",function(zc){try{var pd=tb.find(function(Yd){return Yd.fullTitle===zc.fullTitle()});pd.state="running";"function"===typeof Ga&&Ga(pd,"test")}catch(Yd){"function"===typeof Ua&&Ua(Yd,"test")}});yb.on("pass",function(zc){try{var pd=tb.find(function(Yd){return Yd.fullTitle===zc.fullTitle()});pd.state="succeeded";pd.duration=zc.duration;"function"===
typeof Ga&&Ga(pd,"pass")}catch(Yd){"function"===typeof Ua&&Ua(Yd,"pass")}});yb.on("fail",function(zc,pd){try{var Yd=function(ye,Gd,Sb){ye.state="failed";ye.duration=ye.duration;ye.error=Gd},Ge=tb.find(function(ye){return ye.fullTitle===zc.fullTitle()});if(Ge)Yd(Ge,pd,zc.duration);else{var Sc=vc.arr.invoke(zc.parent.tests,"fullTitle");tb.filter(function(ye){return Sc.includes(ye.fullTitle)}).forEach(function(ye){return Yd(ye,pd,zc.duration)})}"function"===typeof Ga&&Ga(Ge,"fail")}catch(ye){"function"===
typeof Ua&&Ua(ye,"fail")}})});Qa.run(function(yb){return Aa({testsByFile:ea,mocha:Qa})})})}var Fb,Va,Ab,td,Pc,Vb,Oa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){switch(Qa.nextAddress){case 1:Fb=$jscomp.makeIterator(ea),Va=Fb.next();case 2:if(Va.done){Qa.jumpTo(4);break}td=Ab=Va.value;Pc=td.file;return Qa.yield(vc.loadMochaTestFile(Pc,ea),5);case 5:return Vb=Qa.yieldResult,Oa=Vb.mocha,Q&&(Oa=Oa.grep(Q)),Qa.yield(fc(Oa),3);case 3:Va=Fb.next();Qa.jumpTo(2);break;case 4:return Qa.return({mocha:Oa,
testsByFile:ea})}})}function Nb(Q){Q||(Q="local");if(Q.isSystemInterface)var ea=Q;else"string"===typeof Q&&Q.startsWith("l2l ")&&(Q={type:"l2l",id:Q.split(" ")[1]}),"string"!==typeof Q&&"l2l"===Q.type&&(ea=kc.l2lInterfaceFor(Q.id,Q.info)),"string"!==typeof Q&&($world.setStatusMessage("Unknown system interface "+Q),Q="local"),ea||(ea=Q&&"local"!==Q?kc.serverInterfaceFor(Q):kc.localInterface);return ea}Ca("systemInterfaceNamed",Nb);var kb=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");
kb.parseJsonLikeObj=nd;kb.ast=ub;kb.parseJsonLikeObj=nd;kb.parseJsonLikeObj=nd;var Db=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");Db.loadPackage=function(Q,ea){var Ga,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fc){switch(fc.nextAddress){case 1:return fc.yield(Q.importPackage(ea.address+"/"),2);case 2:if(!ea.main){fc.jumpTo(3);break}return fc.yield(Q.importModule(ea.main.toString()),3);case 3:if(!ea.test){fc.jumpTo(5);break}fc.setCatchFinallyBlocks(6);
return fc.yield(Q.importPackage("mocha-es6"),8);case 8:return Ga=fc.yieldResult,fc.yield(Ga.installSystemInstantiateHook(),9);case 9:return fc.yield(Q.importModule(ea.test.toString()),10);case 10:fc.leaveTryBlock(5);break;case 6:Ua=fc.enterCatchBlock(),console.warn("Cannot load test of new package: "+Ua);case 5:return fc.return(Q.getPackage(ea.address))}})};Db.interactivelyCreatePackage=eb;Db.interactivelyLoadPackage=Hb;Db.interactivelyReloadPackage=Cc;Db.interactivelyUnloadPackage=qc;Db.interactivelyRemovePackage=
ld;Db.showExportsAndImportsOf=wd;Db.parseJsonLikeObj=nd;Db.arr=Tb;Db.resource=lc;Db.interactivelyCreatePackage=eb;Db.interactivelyCreatePackage=eb;Db.interactivelyLoadPackage=Hb;Db.interactivelyLoadPackage=Hb;Db.interactivelyReloadPackage=Cc;Db.interactivelyReloadPackage=Cc;Db.interactivelyUnloadPackage=qc;Db.interactivelyUnloadPackage=qc;Db.interactivelyRemovePackage=ld;Db.interactivelyRemovePackage=ld;Db.showExportsAndImportsOf=wd;Db.showExportsAndImportsOf=wd;var Rb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");
Rb.shortModuleName=Xc;Rb.interactivelyChangeModule=gd;Rb.interactivelyReloadModule=bc;Rb.interactivelyUnloadModule=ad;Rb.interactivelyRemoveModule=ed;Rb.interactivelyAddModule=Id;Rb._askForModuleName=function(Q,ea,Ga){var Ua,fc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){switch(Fb.nextAddress){case 1:return Fb.yield(Ga.prompt("Enter module name",{input:ea,historyId:"lively.vm-editor-add-module-name"}),2);case 2:ea=Fb.yieldResult;if(!ea)throw"Canceled";return Fb.yield(Q.normalize(ea),
3);case 3:return Ua=Fb.yieldResult,Fb.yield(Ga.confirm(["Create module \n",{},Ua,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:fc=Fb.yieldResult;if(!fc)throw"Canceled";return Fb.return(Ua)}})};Rb._searchForExistingFiles=function(Q,ea,Ga){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){return String(ea).match(/^http/)?Ua.return(Rb._searchForExistingFilesWeb(Q,ea,Ga)):Ua.return(Rb._searchForExistingFilesManually(Q,ea,Ga))})};Rb._searchForExistingFilesManually=function(Q,
ea,Ga){var Ua,fc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){switch(Fb.nextAddress){case 1:return Fb.yield(Q.world().multipleChoicePrompt("Add Module",{requester:Q,choices:["Create New Module","Load Existing Module"]}),2);case 2:Ua=Fb.yieldResult;if("Create New Module"===Ua)return Fb.return("[create new module]");if("Load Existing Module"!==Ua){Fb.jumpTo(3);break}return Fb.yield(Q.world().prompt("URL of module?",{input:ea,requester:Q,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),
4);case 4:if(fc=Fb.yieldResult)return Fb.return([fc]);case 3:throw"Canceled";}})};Rb._searchForExistingFilesWeb=function(Q,ea,Ga){function Ua(Vb){Vb.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(Vb.name())||Ga&&Rb.arr.pluck(Ga.modules,"name").includes(Vb.url)?!0:!1}var fc,Fb,Va,Ab,td,Pc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vb){switch(Vb.nextAddress){case 1:return(fc=Q.world())&&(Fb=fc.showLoadingIndicatorFor(Q,"Loading existing modules...")),
Vb.yield(Rb.resource(ea).dirList(5,{exclude:Ua}),3);case 3:return Vb.yield(Vb.yieldResult.map(function(Oa){return Oa.url}),2);case 2:return Va=Vb.yieldResult,Ab=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(Va.filter(function(Oa){return Oa.endsWith(".js")}).map(function(Oa){return{isListItem:!0,string:Ga&&0==Oa.indexOf(Ga.address)?Ga.name+Oa.slice(Ga.address.length):Oa,value:Oa}})),Vb.yield(Promise.resolve(Fb&&Fb.remove()).then(function(){return Q.world().filterableListPrompt("What module to load?",
Ab,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:Q},Q?{extent:Q.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:td=Vb.yieldResult;if(!td||"canceled"===td.status||!td.selected.length)throw"Canceled";Pc=td.selected||td;Array.isArray(Pc)||(Pc=[Pc]);return Vb.return(Pc)}})};Rb._createAndLoadModules=function(Q,ea){var Ga,Ua,fc,Fb,Va;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ab){switch(Ab.nextAddress){case 1:Array.isArray(ea)||(ea=[ea]),Ga=[],Ua=$jscomp.makeIterator(ea),
fc=Ua.next();case 2:if(fc.done){Ab.jumpTo(4);break}Fb=fc.value;return Ab.yield(Q.forgetModule(Fb,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return Ab.yield(Q.resourceEnsureExistance(Fb,'"format esm";\n'),6);case 6:return Ab.setCatchFinallyBlocks(7),Ab.yield(Q.importModule(Fb),9);case 9:Ga.push({name:Fb});Ab.leaveTryBlock(3);break;case 7:Va=Ab.enterCatchBlock(),Ga.push({name:Fb,error:Va});case 3:fc=Ua.next();Ab.jumpTo(2);break;case 4:return Ab.return(Ga)}})};Rb.modulesInPackage_defaultExclude=function(Q){return[".git",
"node_modules",".optimized-loading-cache",".module_cache"].includes(Q.name())?!0:!1};Rb.modulesInPackage=hc;Rb.obj=mc;Rb.arr=Tb;Rb.resource=lc;Rb.shortModuleName=Xc;Rb.shortModuleName=Xc;Rb.interactivelyChangeModule=gd;Rb.interactivelyChangeModule=gd;Rb.interactivelyReloadModule=bc;Rb.interactivelyReloadModule=bc;Rb.interactivelyUnloadModule=ad;Rb.interactivelyUnloadModule=ad;Rb.interactivelyRemoveModule=ed;Rb.interactivelyRemoveModule=ed;Rb.interactivelyAddModule=Id;Rb.interactivelyAddModule=Id;
Rb.modulesInPackage=hc;Rb.modulesInPackage=hc;var vc=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/mocha-tests.js");vc.loadMochaTestFile=Qb;vc.runMochaTests=xb;vc.arr=Tb;vc.chain=Zd;vc.loadMochaTestFile=Qb;vc.loadMochaTestFile=Qb;vc.runMochaTests=xb;vc.runMochaTests=xb;var jc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");jc.todo=function(Q){throw Error(Q+" is not yet implemented!");};jc.parseJsonLikeObj=nd;jc.arr=Tb;jc.Closure=id;jc.obj=
mc;jc.resource=lc;jc.transform=ce;jc.modules=kd;var qb=function(){};qb.prototype.dynamicCompletionsForPrefix=function(Q,ea,Ga){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){jc.todo("dynamicCompletionsForPrefix");Ua.jumpToEnd()})};qb.prototype.runEval=function(Q,ea){jc.todo("runEval")};qb.prototype.resourceExists=function(Q){jc.todo("resourceExists")};qb.prototype.resourceEnsureExistance=function(Q,ea){jc.todo("resourceEnsureExistance")};qb.prototype.resourceMkdir=function(Q){jc.todo("resourceMkdir")};
qb.prototype.resourceRead=function(Q){jc.todo("resourceRead")};qb.prototype.resourceRemove=function(Q){jc.todo("resourceRemove")};qb.prototype.resourceWrite=function(Q,ea){jc.todo("resourceWrite")};qb.prototype.resourceCreateFiles=function(Q,ea){jc.todo("resourceCreateFiles")};qb.prototype.resourceDirList=function(Q,ea,Ga){jc.todo("resourceDirList")};qb.prototype.normalizeSync=function(Q,ea,Ga){jc.todo("normalizeSync")};qb.prototype.normalize=function(Q,ea,Ga){jc.todo("normalize")};qb.prototype.printSystemConfig=
function(){jc.todo("printSystemConfig")};qb.prototype.getConfig=function(){jc.todo("getConfig")};qb.prototype.setConfig=function(Q){jc.todo("setConfig")};qb.prototype.getPackages=function(Q){jc.todo("getPackages")};qb.prototype.isModuleLoaded=function(Q,ea){jc.todo("isModuleLoaded")};qb.prototype.doesModuleExist=function(Q,ea){jc.todo("doesModuleExist")};qb.prototype.getModules=function(){var Q=this,ea,Ga;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){return 1==Ua.nextAddress?(ea=
jc.arr,Ga=ea.flatmap,Ua.yield(Q.getPackages(),2)):Ua.return(Ga.call(ea,Ua.yieldResult,function(fc){return fc.modules}))})};qb.prototype.getModule=function(Q){var ea=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){return 1==Ga.nextAddress?Ga.yield(ea.getModules(),2):Ga.return(Ga.yieldResult.find(function(Ua){return Ua.name===Q}))})};qb.prototype.getPackage=function(Q){var ea=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){return 1==Ga.nextAddress?(Q=Q.replace(/\/+$/,
""),Ga.yield(ea.getPackages(),2)):Ga.return(Ga.yieldResult.find(function(Ua){return Ua.address===Q||Ua.name===Q}))})};qb.prototype.getPackageForModule=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){jc.todo("getPackageForModule");ea.jumpToEnd()})};qb.prototype.systemConfChange=function(Q){var ea=jc.parseJsonLikeObj(Q);["baseURL"].forEach(function(Ga){return delete ea[Ga]});return this.setConfig(ea)};qb.prototype.resourcesOfPackage=function(Q,ea){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){jc.todo("resourcesOfPackage");
Ga.jumpToEnd()})};qb.prototype.registerPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){jc.todo("registerPackage");ea.jumpToEnd()})};qb.prototype.importPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){jc.todo("importPackage");ea.jumpToEnd()})};qb.prototype.removePackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){jc.todo("removePackage");ea.jumpToEnd()})};qb.prototype.reloadPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){jc.todo("reloadPackage");
ea.jumpToEnd()})};qb.prototype.packageConfChange=function(Q,ea){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){jc.todo("packageConfChange");Ga.jumpToEnd()})};qb.prototype.importModule=function(Q){jc.todo("importModule")};qb.prototype.forgetModule=function(Q,ea){jc.todo("forgetModule")};qb.prototype.reloadModule=function(Q,ea){jc.todo("reloadModule")};qb.prototype.moduleFormat=function(Q){jc.todo("moduleFormat")};qb.prototype.moduleRead=function(Q){jc.todo("moduleRead")};qb.prototype.moduleSourceChange=
function(Q,ea,Ga){jc.todo("moduleSourceChange")};qb.prototype.importsAndExportsOf=function(Q,ea){jc.todo("importsAndExportsOf")};qb.prototype.keyValueListOfVariablesInModule=function(Q,ea){jc.todo("keyValueListOfVariablesInModule")};qb.prototype.moduleWrite=function(Q,ea){return this.moduleSourceChange(Q,ea)};jc.AbstractCoreInterface=qb;var rb=function(){var Q=jc.AbstractCoreInterface.call(this)||this;Q.currentEval=null;return Q};$jscomp.inherits(rb,jc.AbstractCoreInterface);rb.prototype.runEval=
function(Q,ea){throw Error("Not yet implemented");};rb.prototype.runEvalAndStringify=function(Q,ea){var Ga=this;return this.currentEval?this.currentEval.then(function(){return Ga.runEvalAndStringify(Q,ea)}):this.currentEval=Promise.resolve().then(function(){var Ua,fc,Fb,Va;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ab){switch(Ab.nextAddress){case 1:return Ab.yield(Ga.runEval("\n        Promise.resolve((async "+jc.transform.wrapInFunction(Q)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},ea)),2);case 2:if((Ua=Ab.yieldResult)&&Ua.isError)throw Error(String(Ua.value||Ua.error));if(!Ua||!Ua.value)return Ab.return(null);if(fc=Ua.promisedValue){Ab.jumpTo(3);break}return Ab.yield(Ua.value,4);case 4:fc=Ab.yieldResult;case 3:Fb=fc;if(!Fb)return Ab.return();if("undefined"===Fb)return Ab.return(void 0);if("null"===Fb)return Ab.return(null);if("true"===Fb)return Ab.return(!0);
if("false"===Fb)return Ab.return(!1);try{Va=JSON.parse(Fb)}catch(td){return Ab.return(Fb)}if(Va&&Va.isError)throw Error(String(Va.value));return Ab.return(Va)}})}).then(function(Ua){delete Ga.currentEval;return Ua},function(Ua){delete Ga.currentEval;return Promise.reject(Ua)})};rb.prototype.dynamicCompletionsForPrefix=function(Q,ea,Ga){var Ua=this,fc,Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Va){fc=jc.obj.isString(Ga.context)?Ga.context:!1;Ga=jc.obj.dissoc(Ga,["systemInterface",
"System","context"]);Fb="\n      var prefix = "+JSON.stringify(ea)+",\n          opts = "+JSON.stringify(Ga)+";\n      opts.context = "+fc+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return Va.return(Ua.runEvalAndStringify(Fb))})};rb.prototype.evalWithResource=function(Q,ea,Ga){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+Q+'").'+ea+"("+(Ga?JSON.stringify(Ga):"")+");\n    ")};rb.prototype.resourceExists=function(Q){return this.evalWithResource(Q,"exists")};rb.prototype.resourceEnsureExistance=function(Q,ea){return this.evalWithResource(Q,
"ensureExistance",ea)};rb.prototype.resourceMkdir=function(Q){return this.evalWithResource(Q,"mkdir")};rb.prototype.resourceRead=function(Q){return this.evalWithResource(Q,"read")};rb.prototype.resourceRemove=function(Q){return this.evalWithResource(Q,"remove")};rb.prototype.resourceWrite=function(Q,ea){return this.evalWithResource(Q,"write",ea)};rb.prototype.resourceCreateFiles=function(Q,ea){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
Q+'", '+JSON.stringify(ea)+")")};rb.prototype.resourceDirList=function(Q,ea,Ga){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+Q+'").dirList('+JSON.stringify(ea)+", "+JSON.stringify(Ga)+"))\n        .map(({url}) => ({url}))")};rb.prototype.livelySystemAccessor=function(Q){Q=void 0===Q?"livelySystem":Q;return"var "+Q+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
Q+') throw new Error("lively-system-interface not available!");'};rb.prototype.normalizeSync=function(Q,ea,Ga){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(Q)+", "+JSON.stringify(ea)+", "+Ga+")")};rb.prototype.normalize=function(Q,ea,Ga){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(Q)+", "+JSON.stringify(ea)+", "+JSON.stringify(Ga)+")")};rb.prototype.printSystemConfig=function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")};
rb.prototype.getConfig=function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')};rb.prototype.setConfig=function(Q){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(Q)+")")};rb.prototype.getPackages=function(Q){Q=Object.assign({excluded:[]},Q);Q.excluded=Q.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(Q)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')};rb.prototype.getPackageForModule=function(Q){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(Q)+")")};rb.prototype.isModuleLoaded=function(Q,ea){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+Q+'", '+ea+")")};rb.prototype.doesModuleExist=function(Q,ea){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+Q+'", '+ea+")")};rb.prototype.registerPackage=function(Q){var ea=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){return Ga.return(ea.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(Q)+")"))})};rb.prototype.importPackage=
function(Q){var ea=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){return Ga.return(ea.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(Q)+")"))})};rb.prototype.removePackage=function(Q){var ea=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){return Ga.return(ea.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(Q)+")"))})};rb.prototype.reloadPackage=function(Q,ea){var Ga=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){return Ua.return(Ga.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(Q)+", "+JSON.stringify(ea)+")"))})};rb.prototype.packageConfChange=function(Q,ea){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(Q)+", "+JSON.stringify(ea)+")")};rb.prototype.resourcesOfPackage=function(Q,ea){ea=void 0===ea?[".git","node_modules",".module_cache","lively.next-node_modules"]:ea;var Ga=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){Q.address&&(Q=
Q.address);return Ua.return(Ga.runEvalAndStringify("\n      "+Ga.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(Q)+", "+JSON.stringify(ea)+");"))})};rb.prototype.getModule=function(Q){var ea=this,Ga;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){if(1==Ua.nextAddress)return Ua.yield(ea.getModules(),2);Ga=Ua.yieldResult.find(function(fc){return fc.name===Q});return Ua.return(Ga?jc.modules.module(Ga.name):null)})};rb.prototype.importModule=
function(Q){return this.runEvalAndStringify("lively.modules.System.import("+JSON.stringify(Q)+")")};rb.prototype.forgetModule=function(Q,ea){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").unload("+JSON.stringify(ea)+")")};rb.prototype.reloadModule=function(Q,ea){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").reload("+JSON.stringify(ea)+")")};rb.prototype.moduleFormat=function(Q){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(Q)+").format();")};rb.prototype.moduleRead=function(Q){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").source()")};rb.prototype.moduleSourceChange=function(Q,ea,Ga){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").changeSource("+JSON.stringify(ea)+", "+JSON.stringify(Ga)+")")};rb.prototype.keyValueListOfVariablesInModule=function(Q,ea){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+
JSON.stringify(Q)+", "+JSON.stringify(ea)+")")};rb.prototype.importsAndExportsOf=function(Q,ea){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(Q)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(Q)+").exports()})")};rb.prototype.exportsOfModules=function(Q){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(Q)+";\n      options.excludedPackages = ["+Q.excludedPackages.map(function(ea){return"function"===
typeof ea?ea.toString():JSON.stringify(ea)}).join(",")+"]\n      await livelySystem.localInterface.exportsOfModules(options)")};rb.prototype.searchInPackage=function(Q,ea,Ga){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(Q)+", "+JSON.stringify(ea)+", "+JSON.stringify(Ga)+")")};rb.prototype.loadMochaTestFile=function(Q,ea){ea=void 0===ea?[]:ea;var Ga=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){return Ua.return(Ga.runEvalAndStringify("\n      "+
Ga.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(Q)+", "+JSON.stringify(ea)+"), result;\n      result = {testsByFile}"))})};rb.prototype.runMochaTests=function(Q,ea,Ga,Ua){var fc=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){Q&&Q instanceof RegExp&&(Q={isRegExp:!0,value:String(Q).replace(/^\/|\/$/g,"")});return Fb.return(fc.runEvalAndStringify("\n      var grep = "+JSON.stringify(Q)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
fc.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(ea||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})};
jc.RemoteCoreInterface=rb;var cc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");cc.obj=mc;cc.string=$c;cc.arr=Tb;cc.resource=lc;cc.createFiles=Cd;cc.ast=ub;cc.modules=kd;cc.vm=Fd;cc.loadMochaTestFile=Qb;cc.runMochaTests=xb;cc.parseJsonLikeObj=nd;cc.AbstractCoreInterface=qb;cc.classToFunctionTransform=pe;qb=function(){return cc.AbstractCoreInterface.apply(this,arguments)||this};$jscomp.inherits(qb,cc.AbstractCoreInterface);qb.prototype.dynamicCompletionsForPrefix=
function(Q,ea,Ga){var Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fc){if(1==fc.nextAddress)return fc.yield(cc.vm.completions.getCompletions(function(Fb){return cc.vm.runEval(Fb.replace("return ",""),Object.assign({targetModule:Q,classTransform:cc.classToFunctionTransform},Ga))},ea),2);Ua=fc.yieldResult;if(Ua.isError)throw Ua.value;return fc.return({completions:Ua.completions,prefix:Ua.startLetters})})};qb.prototype.runEval=function(Q,ea){return cc.vm.runEval(Q,Object.assign({classTransform:cc.classToFunctionTransform},
ea))};qb.prototype.resourceExists=function(Q){return cc.resource(Q).exists()};qb.prototype.resourceEnsureExistance=function(Q,ea){return cc.resource(Q).ensureExistance(ea)};qb.prototype.resourceMkdir=function(Q){return cc.resource(Q).mkdir()};qb.prototype.resourceRead=function(Q){return cc.resource(Q).read()};qb.prototype.resourceRemove=function(Q){return cc.resource(Q).remove()};qb.prototype.resourceWrite=function(Q,ea){return cc.resource(Q).write(ea)};qb.prototype.resourceCreateFiles=function(Q,
ea){return cc.createFiles(Q,ea)};qb.prototype.resourceDirList=function(Q,ea,Ga){return cc.resource(Q).dirList(ea,Ga)};qb.prototype.normalizeSync=function(Q,ea,Ga){return System.decanonicalize(Q,ea,Ga)};qb.prototype.normalize=function(Q,ea,Ga){return System.normalize(Q,ea,Ga)};qb.prototype.printSystemConfig=function(){return cc.modules.printSystemConfig()};qb.prototype.getConfig=function(){return System.getConfig()};qb.prototype.setConfig=function(Q){cc.modules.System.config(Q)};qb.prototype.getPackages=
function(Q){Q=Object.assign({},Q);Q=void 0===Q.excluded?[]:Q.excluded;var ea=Q.filter(function(Ua){return"string"===typeof Ua}),Ga=Q.filter(function(Ua){return"function"===typeof Ua});ea=ea.concat(ea.map(function(Ua){return System.decanonicalize(Ua.replace(/\/?$/,"/")).replace(/\/$/,"")}));return cc.modules.getPackages().filter(function(Ua){return!ea.includes(Ua.url)&&!Ga.some(function(fc){return fc(Ua.url)})})};qb.prototype.registerPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){return ea.return(cc.modules.registerPackage(Q))})};
qb.prototype.importPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){return ea.return(cc.modules.importPackage(Q))})};qb.prototype.removePackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){return ea.return(cc.modules.removePackage(Q))})};qb.prototype.reloadPackage=function(Q,ea){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){return Ga.return(cc.modules.reloadPackage(Q,ea))})};qb.prototype.packageConfChange=function(Q,
ea){var Ga=this,Ua,fc,Fb,Va;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ab){if(1==Ab.nextAddress)return Ua=cc.modules.System,fc=cc.parseJsonLikeObj(Q),Fb=JSON.stringify(fc,null,2),Ab.yield(cc.modules.module(ea).changeSource(Fb,{doEval:!1}),2);if(3!=Ab.nextAddress)return Ua.set(ea,Ua.newModule(fc)),Ab.yield(Ga.getPackageForModule(ea),3);(Va=Ab.yieldResult)&&cc.modules.applyPackageConfig(fc,Va.address);Ab.jumpToEnd()})};qb.prototype.resourcesOfPackage=function(Q,ea){ea=void 0===ea?[".git",
"node_modules",".module_cache"]:ea;var Ga,Ua,fc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){if(1==Fb.nextAddress)return Fb.setCatchFinallyBlocks(2),Ga=Q.address?Q.address:Q,Ua=cc.modules.getPackage(Ga),Fb.yield(Ua.resources(void 0,ea),4);if(2!=Fb.nextAddress)return Fb.return(Fb.yieldResult.map(function(Va){return Object.assign(Va,{package:Va.package.url})}));fc=Fb.enterCatchBlock();console.warn("resourcesOfPackage error for "+Q+": "+fc);return Fb.return([])})};qb.prototype.getPackageForModule=
function(Q){return(Q=cc.modules.getPackageOfModule(Q))?Q.asSpec():Q};qb.prototype.isModuleLoaded=function(Q,ea){return cc.modules.isModuleLoaded(Q,ea)};qb.prototype.doesModuleExist=function(Q,ea){return cc.modules.isModuleLoaded(Q,ea)};qb.prototype.getModule=function(Q){return cc.modules.module(Q)};qb.prototype.importModule=function(Q){return cc.modules.System.import(Q)};qb.prototype.forgetModule=function(Q,ea){return cc.modules.module(Q).unload(ea)};qb.prototype.reloadModule=function(Q,ea){return cc.modules.module(Q).reload(ea)};
qb.prototype.moduleFormat=function(Q){return cc.modules.module(Q).format()};qb.prototype.moduleRead=function(Q){return cc.modules.module(Q).source()};qb.prototype.moduleSourceChange=function(Q,ea,Ga){return cc.modules.module(Q).changeSource(ea,Ga)};qb.prototype.keyValueListOfVariablesInModule=function(Q,ea){var Ga=this,Ua,fc,Fb,Va,Ab,td,Pc,Vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Oa){switch(Oa.nextAddress){case 1:if(ea){Oa.jumpTo(2);break}return Oa.yield(Ga.resourceRead(Q),3);
case 3:ea=Oa.yieldResult;case 2:return Ua="string"===typeof ea?cc.ast.parse(ea):ea,fc=Ga.normalizeSync(Q),Ga.moduleFormat(fc),Fb=cc.modules.module(fc).env().recorder,Oa.yield(Ga.importsAndExportsOf(fc,Ua),4);case 4:return Va=Oa.yieldResult,Ab=cc.ast.query.topLevelDeclsAndRefs(Ua),td=cc.arr.sortByKey(cc.ast.query.declarationsOfScope(Ab.scope,!0),"start"),Pc=cc.arr.pluck(Ab.scope.importSpecifiers,"name"),Vb=0,Oa.return(td.map(function(Qa){var Aa=Qa.name.length,za=Va.exports.find(function(tb){return tb.local===
Qa.name}),Ka=cc.arr.include(Pc,Qa.name);za&&(Aa+=9);Ka&&(Aa+=9);Vb=Math.max(Vb,Aa);return{isExport:za,isImport:Ka,name:Qa.name,value:Fb[Qa.name],node:Qa,printedName:Qa.name+(za?" [export]":"")+(Ka?" [import]":""),printedValue:cc.obj.inspect(Fb[Qa.name],{maxDepth:1}).replace(/\n/g,"")}}).map(function(Qa){return{isListItem:!0,value:Qa,string:Qa.printedName+cc.string.indent(" = "+Qa.printedValue," ",Vb-Qa.printedName.length)}}))}})};qb.prototype.importsAndExportsOf=function(Q,ea){var Ga;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){return 1==
Ua.nextAddress?Ua.yield(cc.modules.module(Q).imports(ea),2):3!=Ua.nextAddress?(Ga=Ua.yieldResult,Ua.yield(cc.modules.module(Q).exports(ea),3)):Ua.return({imports:Ga,exports:Ua.yieldResult})})};qb.prototype.exportsOfModules=function(Q){return cc.modules.ExportLookup.run(System,Q)};qb.prototype.searchInPackage=function(Q,ea,Ga){return cc.modules.getPackage(Q).search(ea,Ga)};qb.prototype.runMochaTests=function(Q,ea,Ga,Ua){return cc.runMochaTests(Q,ea,Ga,Ua)};qb.prototype.loadMochaTestFile=function(Q,
ea){return cc.loadMochaTestFile(Q,ea)};$jscomp.global.Object.defineProperties(qb.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"local"}}});cc.LocalCoreInterface=qb;var Vc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");Vc.evalStrategies=Xd;Vc.RemoteCoreInterface=rb;var Bc=function(Q){var ea=Vc.RemoteCoreInterface.call(this)||this;ea.currentEval=null;ea.url=Q;ea.server=new Vc.evalStrategies.HttpEvalStrategy(Q);return ea};$jscomp.inherits(Bc,
Vc.RemoteCoreInterface);Bc.prototype.runEval=function(Q,ea){return this.server.runEval(Q,ea)};$jscomp.global.Object.defineProperties(Bc.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this.url}},description:{configurable:!0,enumerable:!0,get:function(){return this.url.replace(/^https?:\/\//,"")}}});Vc.HTTPCoreInterface=Bc;var xc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");xc.evalStrategies=Xd;xc.RemoteCoreInterface=rb;rb=function(Q,
ea){var Ga=xc.RemoteCoreInterface.call(this)||this;Ga.targetId=Q;Ga.peer=ea;return Ga};$jscomp.inherits(rb,xc.RemoteCoreInterface);rb.prototype.isConnected=function(){var Q=this,ea,Ga,Ua,fc,Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Va){if(1==Va.nextAddress)return ea=Q,Ga=ea.client,Ua=ea.targetId,Va.yield(Ga.sendToAndWait(Ga.trackerId,"getClients",{}),2);fc=Va.yieldResult;Fb=fc.data;return Va.return(Fb.some(function(Ab){Ab=$jscomp.makeIterator(Ab).next().value;return Ua===Ab}))})};
rb.prototype.runEval=function(Q,ea){var Ga=this,Ua,fc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){Ua=Ga.client;if(!Ua)throw Error("No lively.2lively default client available!");fc=new xc.evalStrategies.L2LEvalStrategy(Ua,Ga.targetId);return Fb.return(fc.runEval(Q,ea))})};$jscomp.global.Object.defineProperties(rb.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"l2l "+this.targetId}},description:{configurable:!0,enumerable:!0,get:function(){var Q=this.peer,ea=
"l2l "+this.targetId.slice(0,5);if(Q){var Ga=Q.location,Ua=Q.type,fc=Q.user;Q=Q.world;Ua&&(ea+=", "+Ua);Ga&&(ea+=", "+Ga.replace(/^https?:\/\//,"")+(Q?"/"+Q:""));fc&&(ea+=", "+fc.name)}return ea}},client:{configurable:!0,enumerable:!0,get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}}});xc.L2LCoreInterface=rb;var kc=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");kc.systemInterfaceNamed=Nb;kc.interactivelyCreatePackage=
eb;kc.interactivelyLoadPackage=Hb;kc.interactivelyReloadPackage=Cc;kc.interactivelyUnloadPackage=qc;kc.interactivelyRemovePackage=ld;kc.showExportsAndImportsOf=wd;kc.shortModuleName=Xc;kc.interactivelyChangeModule=gd;kc.interactivelyReloadModule=bc;kc.interactivelyUnloadModule=ad;kc.interactivelyRemoveModule=ed;kc.interactivelyAddModule=Id;kc.modulesInPackage=hc;kc.LocalCoreInterface=qb;kc.HTTPCoreInterface=Bc;kc.L2LCoreInterface=rb;rb=function(Q){this.coreInterface=Q};rb.prototype.dynamicCompletionsForPrefix=
function(Q,ea,Ga){return this.coreInterface.dynamicCompletionsForPrefix(Q,ea,Ga)};rb.prototype.runEval=function(Q,ea){return this.coreInterface.runEval(Q,ea)};rb.prototype.printSystemConfig=function(Q,ea,Ga){return this.coreInterface.printSystemConfig(Q,ea,Ga)};rb.prototype.getConfig=function(Q,ea,Ga){return this.coreInterface.getConfig(Q,ea,Ga)};rb.prototype.getPackages=function(Q){return this.coreInterface.getPackages(Q)};rb.prototype.getModules=function(Q,ea,Ga){return this.coreInterface.getModules(Q,
ea,Ga)};rb.prototype.getModule=function(Q,ea,Ga){return this.coreInterface.getModule(Q,ea,Ga)};rb.prototype.getPackage=function(Q,ea,Ga){return this.coreInterface.getPackage(Q,ea,Ga)};rb.prototype.getPackageForModule=function(Q,ea,Ga){return this.coreInterface.getPackageForModule(Q,ea,Ga)};rb.prototype.resourcesOfPackage=function(Q,ea){return this.coreInterface.resourcesOfPackage(Q,ea)};rb.prototype.systemConfChange=function(Q,ea,Ga){return this.coreInterface.systemConfChange(Q,ea,Ga)};rb.prototype.registerPackage=
function(Q){return this.coreInterface.registerPackage(Q)};rb.prototype.importPackage=function(Q){return this.coreInterface.importPackage(Q)};rb.prototype.removePackage=function(Q){return this.coreInterface.removePackage(Q)};rb.prototype.reloadPackage=function(Q){return this.coreInterface.reloadPackage(Q)};rb.prototype.packageConfChange=function(Q,ea){return this.coreInterface.packageConfChange(Q,ea)};rb.prototype.keyValueListOfVariablesInModule=function(Q,ea){return this.coreInterface.keyValueListOfVariablesInModule(Q,
ea)};rb.prototype.interactivelyCreatePackage=function(Q){return kc.interactivelyCreatePackage(this.coreInterface,Q)};rb.prototype.interactivelyLoadPackage=function(Q,ea){return kc.interactivelyLoadPackage(this.coreInterface,Q,ea)};rb.prototype.interactivelyReloadPackage=function(Q,ea){return kc.interactivelyReloadPackage(this.coreInterface,Q,ea)};rb.prototype.interactivelyUnloadPackage=function(Q,ea,Ga){return kc.interactivelyUnloadPackage(this.coreInterface,Q,ea,Ga)};rb.prototype.interactivelyRemovePackage=
function(Q,ea){return kc.interactivelyRemovePackage(this.coreInterface,Q,ea)};rb.prototype.isModuleLoaded=function(Q,ea){return this.coreInterface.isModuleLoaded(Q,ea)};rb.prototype.doesModuleExist=function(Q,ea){return this.coreInterface.doesModuleExist(Q,ea)};rb.prototype.importModule=function(Q){return this.coreInterface.importModule(Q)};rb.prototype.forgetModule=function(Q,ea){return this.coreInterface.forgetModule(Q,ea)};rb.prototype.reloadModule=function(Q,ea){return this.coreInterface.reloadModule(Q,
ea)};rb.prototype.moduleFormat=function(Q){return this.coreInterface.moduleFormat(Q)};rb.prototype.moduleRead=function(Q){return this.coreInterface.moduleRead(Q)};rb.prototype.moduleWrite=function(Q,ea){return this.coreInterface.moduleWrite(Q,ea)};rb.prototype.getModulesInPackage=function(Q){return kc.modulesInPackage(this.coreInterface,Q)};rb.prototype.shortModuleName=function(Q,ea){return kc.shortModuleName(this.coreInterface,Q,ea)};rb.prototype.interactivelyChangeModule=function(Q,ea,Ga){return kc.interactivelyChangeModule(this.coreInterface,
Q,ea,Ga)};rb.prototype.interactivelyReloadModule=function(Q,ea){return kc.interactivelyReloadModule(this.coreInterface,Q,ea)};rb.prototype.interactivelyUnloadModule=function(Q,ea){return kc.interactivelyUnloadModule(this.coreInterface,Q,ea)};rb.prototype.interactivelyRemoveModule=function(Q,ea){return kc.interactivelyRemoveModule(this.coreInterface,Q,ea)};rb.prototype.interactivelyAddModule=function(Q,ea){return kc.interactivelyAddModule(this.coreInterface,Q,ea)};rb.prototype.showExportsAndImportsOf=
function(Q,ea){return kc.showExportsAndImportsOf(this.coreInterface,Q,ea)};rb.prototype.exportsOfModules=function(Q){return this.coreInterface.exportsOfModules(Q)};rb.prototype.searchInPackage=function(Q,ea,Ga){return this.coreInterface.searchInPackage(Q,ea,Ga)};rb.prototype.searchInAllPackages=function(Q,ea){ea=void 0===ea?{}:ea;var Ga=this,Ua,fc,Fb,Va,Ab,td,Pc,Vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Oa){switch(Oa.nextAddress){case 1:return(Ua=ea.progress)&&Ua.step("Fetching Packages...",
0),Oa.yield(Ga.coreInterface.getPackages({excluded:ea.excludedPackages}),2);case 2:fc=Oa.yieldResult,Fb=[],Ua&&Ua.step("Fetching Packages...",.1),Va=0;case 3:if(!(Va<fc.length)){Oa.jumpTo(5);break}Ab=fc[Va];td=Ab.url;if(!td||"no group"===td){Oa.jumpTo(4);break}Ua&&Ua.step(td.replace(System.baseURL,"").slice(0,20),.1+Va/fc.length*.9);Oa.setCatchFinallyBlocks(6);return Oa.yield(Ga.coreInterface.searchInPackage(td,Q,ea),8);case 8:Pc=Oa.yieldResult;Fb=Fb.concat(Pc);Oa.leaveTryBlock(4);break;case 6:Vb=
Oa.enterCatchBlock(),console.error("Error searching in package "+td+":\n"+Vb.stack);case 4:Va++;Oa.jumpTo(3);break;case 5:return Oa.return(Fb)}})};rb.prototype.loadMochaTestFile=function(Q,ea){return this.coreInterface.loadMochaTestFile(Q,ea)};rb.prototype.runMochaTests=function(Q,ea,Ga,Ua){return this.coreInterface.runMochaTests(Q,ea,Ga,Ua)};$jscomp.global.Object.defineProperties(rb.prototype,{isSystemInterface:{configurable:!0,enumerable:!0,get:function(){return!0}},name:{configurable:!0,enumerable:!0,
get:function(){return this.coreInterface.name}}});Ca("Interface",rb);kc.Interface=rb;kc.systemInterfaceNamed=Nb;kc.systemInterfaceNamed=Nb;rb=Ca("localInterface",new kc.Interface(new kc.LocalCoreInterface));kc.localInterface=rb;kc.localInterface=rb;kc.localInterface=rb;kc.httpInterfaces={};rb=Ca("serverInterfaceFor",function(Q){return kc.httpInterfaces[Q]||(kc.httpInterfaces[Q]=new kc.Interface(new kc.HTTPCoreInterface(Q)))});kc.serverInterfaceFor=rb;kc.serverInterfaceFor=rb;kc.serverInterfaceFor=
rb;kc.l2lInterfaces={};rb=Ca("l2lInterfaceFor",function(Q,ea){return kc.l2lInterfaces[Q]||(kc.l2lInterfaces[Q]=new kc.Interface(new kc.L2LCoreInterface(Q,ea)))});kc.l2lInterfaceFor=rb;kc.l2lInterfaceFor=rb;kc.l2lInterfaceFor=rb}}});