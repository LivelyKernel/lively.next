System.register(["./__root_module__-255c8c26.js","kld-intersections"],function(Da){var Ab,Tb,kc,ec,he,gd,Zd,kd;return{setters:[function(Sc){Ab=Sc.s;Tb=Sc._;kc=Sc.bk;ec=Sc.bl;he=Sc.as;gd=Sc.a6;Zd=Sc.bm;kd=Sc.ao},function(){}],execute:function(){function Sc(){function Ca(vb,Gb){var yc={};Gb.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(rd,pd,oc){pd&&(yc[pd]=oc)});return yc}if(pb)return Nc;pb=!0;var sb=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
Cb="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");return Nc=function(vb){var Gb=vb,yc=vb.indexOf("["),rd=vb.indexOf("]");-1!=yc&&-1!=rd&&(vb=vb.substring(0,yc)+vb.substring(yc,rd).replace(/:/g,";")+vb.substring(rd,vb.length));var pd=sb.exec(vb||"");vb={};for(var oc=14;oc--;)vb[Cb[oc]]=pd[oc]||"";-1!=yc&&-1!=rd&&(vb.source=Gb,vb.host=vb.host.substring(1,vb.host.length-1).replace(/;/g,":"),vb.authority=vb.authority.replace("[","").replace("]",
"").replace(/;/g,":"),vb.ipv6uri=!0);Gb=vb.path;yc=Gb.replace(/\/{2,9}/g,"/").split("/");"/"!=Gb.substr(0,1)&&0!==Gb.length||yc.splice(0,1);"/"==Gb.substr(Gb.length-1,1)&&yc.splice(yc.length-1,1);vb.pathNames=yc;vb.queryKey=Ca(vb,vb.query);return vb}}function yd(){function Ca(Gb){Gb=String(Gb);if(!(100<Gb.length)&&(Gb=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(Gb))){var yc=parseFloat(Gb[1]);switch((Gb[2]||"ms").toLowerCase()){case "years":case "year":case "yrs":case "yr":case "y":return yc*
vb;case "days":case "day":case "d":return yc*Cb;case "hours":case "hour":case "hrs":case "hr":case "h":return 36E5*yc;case "minutes":case "minute":case "mins":case "min":case "m":return 6E4*yc;case "seconds":case "second":case "secs":case "sec":case "s":return 1E3*yc;case "milliseconds":case "millisecond":case "msecs":case "msec":case "ms":return yc}}}function sb(Gb,yc,rd){if(!(Gb<yc))return Gb<1.5*yc?Math.floor(Gb/yc)+" "+rd:Math.ceil(Gb/yc)+" "+rd+"s"}if(hb)return gb;hb=!0;var Cb=864E5,vb=365.25*
Cb;return gb=function(Gb,yc){yc=yc||{};var rd=typeof Gb;if("string"===rd&&0<Gb.length)return Ca(Gb);if("number"===rd&&!1===isNaN(Gb))return yc.long?sb(Gb,Cb,"day")||sb(Gb,36E5,"hour")||sb(Gb,6E4,"minute")||sb(Gb,1E3,"second")||Gb+" ms":Gb>=Cb?Math.round(Gb/Cb)+"d":36E5<=Gb?Math.round(Gb/36E5)+"h":6E4<=Gb?Math.round(Gb/6E4)+"m":1E3<=Gb?Math.round(Gb/1E3)+"s":Gb+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(Gb));}}function Od(){function Ca(vb){var Gb=0,yc;for(yc in vb)Gb=
(Gb<<5)-Gb+vb.charCodeAt(yc),Gb|=0;return Yb.colors[Math.abs(Gb)%Yb.colors.length]}function sb(vb){function Gb(){if(Gb.enabled){var rd=+new Date;Gb.diff=rd-(yc||rd);Gb.prev=yc;yc=Gb.curr=rd;var pd=Array(arguments.length);for(rd=0;rd<pd.length;rd++)pd[rd]=arguments[rd];pd[0]=Yb.coerce(pd[0]);"string"!==typeof pd[0]&&pd.unshift("%O");var oc=0;pd[0]=pd[0].replace(/%([a-zA-Z%])/g,function(lc,Qc){if("%%"===lc)return lc;oc++;Qc=Yb.formatters[Qc];"function"===typeof Qc&&(lc=Qc.call(Gb,pd[oc]),pd.splice(oc,
1),oc--);return lc});Yb.formatArgs.call(Gb,pd);(Gb.log||Yb.log||console.log.bind(console)).apply(Gb,pd)}}var yc;Gb.namespace=vb;Gb.enabled=Yb.enabled(vb);Gb.useColors=Yb.useColors();Gb.color=Ca(vb);Gb.destroy=Cb;"function"===typeof Yb.init&&Yb.init(Gb);Yb.instances.push(Gb);return Gb}function Cb(){var vb=Yb.instances.indexOf(this||Fd);return-1!==vb?(Yb.instances.splice(vb,1),!0):!1}if(Xb)return Yb;Xb=!0;Yb=Yb=sb.debug=sb["default"]=sb;Yb.coerce=function(vb){return vb instanceof Error?vb.stack||vb.message:
vb};Yb.disable=function(){Yb.enable("")};Yb.enable=function(vb){Yb.save(vb);Yb.names=[];Yb.skips=[];var Gb,yc=("string"===typeof vb?vb:"").split(/[\s,]+/),rd=yc.length;for(Gb=0;Gb<rd;Gb++)yc[Gb]&&(vb=yc[Gb].replace(/\*/g,".*?"),"-"===vb[0]?Yb.skips.push(new RegExp("^"+vb.substr(1)+"$")):Yb.names.push(new RegExp("^"+vb+"$")));for(Gb=0;Gb<Yb.instances.length;Gb++)vb=Yb.instances[Gb],vb.enabled=Yb.enabled(vb.namespace)};Yb.enabled=function(vb){if("*"===vb[vb.length-1])return!0;var Gb;var yc=0;for(Gb=
Yb.skips.length;yc<Gb;yc++)if(Yb.skips[yc].test(vb))return!1;yc=0;for(Gb=Yb.names.length;yc<Gb;yc++)if(Yb.names[yc].test(vb))return!0;return!1};Yb.humanize=yd();Yb.instances=[];Yb.names=[];Yb.skips=[];Yb.formatters={};return Yb}function fe(){function Ca(){try{var Gb=Be.storage.debug}catch(yc){}!Gb&&"undefined"!==typeof sb&&"env"in sb&&(Gb=sb.env.DEBUG);return Gb}if(Ie)return Be;Ie=!0;var sb=kc;Be=Be=Od();Be.log=function(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,
console,arguments)};Be.formatArgs=function(Gb){var yc=(this||Lf).useColors;Gb[0]=(yc?"%c":"")+(this||Lf).namespace+(yc?" %c":" ")+Gb[0]+(yc?"%c ":" ")+"+"+Be.humanize((this||Lf).diff);if(yc){yc="color: "+(this||Lf).color;Gb.splice(1,0,yc,"color: inherit");var rd=0,pd=0;Gb[0].replace(/%[a-zA-Z%]/g,function(oc){"%%"!==oc&&(rd++,"%c"===oc&&(pd=rd))});Gb.splice(pd,0,yc)}};Be.save=function(Gb){try{null==Gb?Be.storage.removeItem("debug"):Be.storage.debug=Gb}catch(yc){}};Be.load=Ca;Be.useColors=function(){return"undefined"!==
typeof window&&window.process&&"renderer"===window.process.type?!0:"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:"undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&
31<=parseInt(RegExp.$1,10)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)};var Cb=Be;if("undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage)var vb=chrome.storage.local;else a:{try{vb=window.localStorage;break a}catch(Gb){}vb=void 0}Cb.storage=vb;Be.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" ");
Be.formatters.j=function(Gb){try{return JSON.stringify(Gb)}catch(yc){return"[UnexpectedJSONParseError]: "+yc.message}};Be.enable(Ca());return Be}function Ud(){if(ue)return ed;ue=!0;var Ca=Sc(),sb=fe()("socket.io-client:url");return ed=function(Cb,vb){var Gb=Cb;vb=vb||"undefined"!==typeof location&&location;null==Cb&&(Cb=vb.protocol+"//"+vb.host);"string"===typeof Cb&&("/"===Cb.charAt(0)&&(Cb="/"===Cb.charAt(1)?vb.protocol+Cb:vb.host+Cb),/^(https?|wss?):\/\//.test(Cb)||(sb("protocol-less url %s",Cb),
Cb="undefined"!==typeof vb?vb.protocol+"//"+Cb:"https://"+Cb),sb("parse %s",Cb),Gb=Ca(Cb));Gb.port||(/^(http|ws)$/.test(Gb.protocol)?Gb.port="80":/^(http|ws)s$/.test(Gb.protocol)&&(Gb.port="443"));Gb.path=Gb.path||"/";Cb=-1!==Gb.host.indexOf(":")?"["+Gb.host+"]":Gb.host;Gb.id=Gb.protocol+"://"+Cb+":"+Gb.port;Gb.href=Gb.protocol+"://"+Cb+(vb&&vb.port===Gb.port?"":":"+Gb.port);return Gb}}function md(){function Ca(sb){if(sb){for(var Cb in Ca.prototype)sb[Cb]=Ca.prototype[Cb];return sb}}if(Zb)return Md;
Zb=!0;Md=Ca;Ca.prototype.on=Ca.prototype.addEventListener=function(sb,Cb){(this||ta)._callbacks=(this||ta)._callbacks||{};((this||ta)._callbacks["$"+sb]=(this||ta)._callbacks["$"+sb]||[]).push(Cb);return this||ta};Ca.prototype.once=function(sb,Cb){function vb(){this.off(sb,vb);Cb.apply(this||ta,arguments)}vb.fn=Cb;this.on(sb,vb);return this||ta};Ca.prototype.off=Ca.prototype.removeListener=Ca.prototype.removeAllListeners=Ca.prototype.removeEventListener=function(sb,Cb){(this||ta)._callbacks=(this||
ta)._callbacks||{};if(0==arguments.length)return(this||ta)._callbacks={},this||ta;var vb=(this||ta)._callbacks["$"+sb];if(!vb)return this||ta;if(1==arguments.length)return delete (this||ta)._callbacks["$"+sb],this||ta;for(var Gb,yc=0;yc<vb.length;yc++)if(Gb=vb[yc],Gb===Cb||Gb.fn===Cb){vb.splice(yc,1);break}0===vb.length&&delete (this||ta)._callbacks["$"+sb];return this||ta};Ca.prototype.emit=function(sb){(this||ta)._callbacks=(this||ta)._callbacks||{};for(var Cb=Array(arguments.length-1),vb=(this||
ta)._callbacks["$"+sb],Gb=1;Gb<arguments.length;Gb++)Cb[Gb-1]=arguments[Gb];if(vb){vb=vb.slice(0);Gb=0;for(var yc=vb.length;Gb<yc;++Gb)vb[Gb].apply(this||ta,Cb)}return this||ta};Ca.prototype.listeners=function(sb){(this||ta)._callbacks=(this||ta)._callbacks||{};return(this||ta)._callbacks["$"+sb]||[]};Ca.prototype.hasListeners=function(sb){return!!this.listeners(sb).length};return Md}function db(){if(Mb)return Ba;Mb=!0;var Ca={}.toString;return Ba=Array.isArray||function(sb){return"[object Array]"==
Ca.call(sb)}}function Fb(){if(xa)return P;xa=!0;var Ca=ec.Buffer;P=function(vb){var Gb;!(Gb=sb&&Ca.isBuffer(vb))&&(Gb=Cb)&&((Gb=vb instanceof ArrayBuffer)||(Gb="function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(vb):vb.buffer instanceof ArrayBuffer));return Gb};var sb="function"===typeof Ca&&"function"===typeof Ca.isBuffer,Cb="function"===typeof ArrayBuffer;return P}function tc(){function Ca(pd,oc){if(!pd)return pd;if(vb(pd)){var lc={_placeholder:!0,num:oc.length};oc.push(pd);return lc}if(Cb(pd)){lc=
Array(pd.length);for(var Qc=0;Qc<pd.length;Qc++)lc[Qc]=Ca(pd[Qc],oc);return lc}if("object"===typeof pd&&!(pd instanceof Date)){lc={};for(Qc in pd)lc[Qc]=Ca(pd[Qc],oc);return lc}return pd}function sb(pd,oc){if(!pd)return pd;if(pd&&pd._placeholder)return oc[pd.num];if(Cb(pd))for(var lc=0;lc<pd.length;lc++)pd[lc]=sb(pd[lc],oc);else if("object"===typeof pd)for(lc in pd)pd[lc]=sb(pd[lc],oc);return pd}if(Kb)return Qa;Kb=!0;var Cb=db(),vb=Fb(),Gb=Object.prototype.toString,yc="function"===typeof Blob||"undefined"!==
typeof Blob&&"[object BlobConstructor]"===Gb.call(Blob),rd="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===Gb.call(File);Qa.deconstructPacket=function(pd){var oc=[];pd.data=Ca(pd.data,oc);pd.attachments=oc.length;return{packet:pd,buffers:oc}};Qa.reconstructPacket=function(pd,oc){pd.data=sb(pd.data,oc);pd.attachments=void 0;return pd};Qa.removeBlobs=function(pd,oc){function lc(jd,ne,bf){if(!jd)return jd;if(yc&&jd instanceof Blob||rd&&jd instanceof File){Qc++;var ee=
new FileReader;ee.onload=function(){bf?bf[ne]=(this||Pc).result:wb=(this||Pc).result;--Qc||oc(wb)};ee.readAsArrayBuffer(jd)}else if(Cb(jd))for(ee=0;ee<jd.length;ee++)lc(jd[ee],ee,jd);else if("object"===typeof jd&&!vb(jd))for(ee in jd)lc(jd[ee],ee,jd)}var Qc=0,wb=pd;lc(wb);Qc||oc(wb)};return Qa}function nc(){function Ca(){}function sb(wb){var jd=""+wb.type;if(Zc.BINARY_EVENT===wb.type||Zc.BINARY_ACK===wb.type)jd+=wb.attachments+"-";wb.nsp&&"/"!==wb.nsp&&(jd+=wb.nsp+",");null!=wb.id&&(jd+=wb.id);if(null!=
wb.data){try{var ne=JSON.stringify(wb.data)}catch(bf){ne=!1}if(!1!==ne)jd+=ne;else return Qc}yc("encoded %j as %s",wb,jd);return jd}function Cb(wb,jd){pd.removeBlobs(wb,function(ne){var bf=pd.deconstructPacket(ne);ne=sb(bf.packet);bf=bf.buffers;bf.unshift(ne);jd(bf)})}function vb(){(this||Rd).reconstructor=null}function Gb(wb){(this||Rd).reconPack=wb;(this||Rd).buffers=[]}if(le)return Zc;le=!0;var yc=fe()("socket.io-parser"),rd=md(),pd=tc(),oc=db(),lc=Fb();Zc.protocol=4;Zc.types="CONNECT DISCONNECT EVENT ACK ERROR BINARY_EVENT BINARY_ACK".split(" ");
Zc.CONNECT=0;Zc.DISCONNECT=1;Zc.EVENT=2;Zc.ACK=3;Zc.ERROR=4;Zc.BINARY_EVENT=5;Zc.BINARY_ACK=6;Zc.Encoder=Ca;Zc.Decoder=vb;var Qc=Zc.ERROR+'"encode error"';Ca.prototype.encode=function(wb,jd){yc("encoding packet %j",wb);Zc.BINARY_EVENT===wb.type||Zc.BINARY_ACK===wb.type?Cb(wb,jd):(wb=sb(wb),jd([wb]))};rd(vb.prototype);vb.prototype.add=function(wb){if("string"===typeof wb){a:{var jd=0,ne={type:Number(wb.charAt(0))};if(null==Zc.types[ne.type])wb={type:Zc.ERROR,data:"parser error: unknown packet type "+
ne.type};else{if(Zc.BINARY_EVENT===ne.type||Zc.BINARY_ACK===ne.type){for(var bf="";"-"!==wb.charAt(++jd)&&(bf+=wb.charAt(jd),jd!=wb.length););if(bf!=Number(bf)||"-"!==wb.charAt(jd))throw Error("Illegal attachments");ne.attachments=Number(bf)}if("/"===wb.charAt(jd+1))for(ne.nsp="";++jd;){bf=wb.charAt(jd);if(","===bf)break;ne.nsp+=bf;if(jd===wb.length)break}else ne.nsp="/";bf=wb.charAt(jd+1);if(""!==bf&&Number(bf)==bf){for(ne.id="";++jd;){bf=wb.charAt(jd);if(null==bf||Number(bf)!=bf){--jd;break}ne.id+=
wb.charAt(jd);if(jd===wb.length)break}ne.id=Number(ne.id)}if(wb.charAt(++jd)){jd=wb.substr(jd);try{var ee=JSON.parse(jd)}catch(Re){ee=!1}if(!1===ee||ne.type!==Zc.ERROR&&!oc(ee)){wb={type:Zc.ERROR,data:"parser error: invalid payload"};break a}else ne.data=ee}yc("decoded %s as %j",wb,ne);wb=ne}}Zc.BINARY_EVENT===wb.type||Zc.BINARY_ACK===wb.type?((this||Rd).reconstructor=new Gb(wb),0===(this||Rd).reconstructor.reconPack.attachments&&this.emit("decoded",wb)):this.emit("decoded",wb)}else if(lc(wb)||wb.base64)if((this||
Rd).reconstructor){if(wb=(this||Rd).reconstructor.takeBinaryData(wb))(this||Rd).reconstructor=null,this.emit("decoded",wb)}else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+wb);};vb.prototype.destroy=function(){(this||Rd).reconstructor&&(this||Rd).reconstructor.finishedReconstruction()};Gb.prototype.takeBinaryData=function(wb){(this||Rd).buffers.push(wb);return(this||Rd).buffers.length===(this||Rd).reconPack.attachments?(wb=pd.reconstructPacket((this||
Rd).reconPack,(this||Rd).buffers),this.finishedReconstruction(),wb):null};Gb.prototype.finishedReconstruction=function(){(this||Rd).reconPack=null;(this||Rd).buffers=[]};return Zc}function td(){if(Mf)return we;Mf=!0;return we="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")()}function ke(){if(rg)return Bf;rg=!0;if(!ce){ce=!0;try{jf="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Cb){jf=!1}}var Ca=jf;var sb=td();return Bf=function(Cb){var vb=
Cb.xdomain,Gb=Cb.xscheme;Cb=Cb.enablesXDR;try{if("undefined"!==typeof XMLHttpRequest&&(!vb||Ca))return new XMLHttpRequest}catch(yc){}try{if("undefined"!==typeof XDomainRequest&&!Gb&&Cb)return new XDomainRequest}catch(yc){}if(!vb)try{return new (sb[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(yc){}}}function zc(){if(Yc)return Qf;Yc=!0;return Qf=Object.keys||function(Ca){var sb=[],Cb=Object.prototype.hasOwnProperty,vb;for(vb in Ca)Cb.call(Ca,vb)&&sb.push(vb);return sb}}function Ec(){function Ca(rd){if(!rd||
"object"!==typeof rd)return!1;if(Cb(rd)){for(var pd=0,oc=rd.length;pd<oc;pd++)if(Ca(rd[pd]))return!0;return!1}if("function"===typeof sb&&sb.isBuffer&&sb.isBuffer(rd)||"function"===typeof ArrayBuffer&&rd instanceof ArrayBuffer||Gb&&rd instanceof Blob||yc&&rd instanceof File)return!0;if(rd.toJSON&&"function"===typeof rd.toJSON&&1===arguments.length)return Ca(rd.toJSON(),!0);for(pd in rd)if(Object.prototype.hasOwnProperty.call(rd,pd)&&Ca(rd[pd]))return!0;return!1}if(Fg)return Rf;Fg=!0;var sb=ec.Buffer,
Cb=db(),vb=Object.prototype.toString,Gb="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===vb.call(Blob),yc="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===vb.call(File);return Rf=Ca}function Pb(){if(qf)return Hg;qf=!0;return Hg=function(Ca,sb,Cb){var vb=Ca.byteLength;sb=sb||0;Cb=Cb||vb;if(Ca.slice)return Ca.slice(sb,Cb);0>sb&&(sb+=vb);0>Cb&&(Cb+=vb);Cb>vb&&(Cb=vb);if(sb>=vb||sb>=Cb||0===vb)return new ArrayBuffer(0);Ca=new Uint8Array(Ca);
vb=new Uint8Array(Cb-sb);for(var Gb=0;sb<Cb;sb++,Gb++)vb[Gb]=Ca[sb];return vb.buffer}}function Qb(){function Ca(){}if(ab)return Ja;ab=!0;return Ja=function(sb,Cb,vb){function Gb(rd,pd){if(0>=Gb.count)throw Error("after called too many times");--Gb.count;rd?(yc=!0,Cb(rd),Cb=vb):0!==Gb.count||yc||Cb(null,pd)}var yc=!1;vb=vb||Ca;Gb.count=sb;return 0===sb?Cb():Gb}}function Tc(){function Ca(oc){for(var lc=[],Qc=0,wb=oc.length,jd,ne;Qc<wb;)jd=oc.charCodeAt(Qc++),55296<=jd&&56319>=jd&&Qc<wb?(ne=oc.charCodeAt(Qc++),
56320==(ne&64512)?lc.push(((jd&1023)<<10)+(ne&1023)+65536):(lc.push(jd),Qc--)):lc.push(jd);return lc}function sb(oc,lc){if(55296<=oc&&57343>=oc){if(lc)throw Error("Lone surrogate U+"+oc.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function Cb(){if(pd>=rd)throw Error("Invalid byte index");var oc=yc[pd]&255;pd++;if(128==(oc&192))return oc&63;throw Error("Invalid continuation byte");}function vb(oc){if(pd>rd)throw Error("Invalid byte index");if(pd==rd)return!1;var lc=yc[pd]&
255;pd++;if(0==(lc&128))return lc;if(192==(lc&224)){var Qc=Cb();lc=(lc&31)<<6|Qc;if(128<=lc)return lc;throw Error("Invalid continuation byte");}if(224==(lc&240)){Qc=Cb();var wb=Cb();lc=(lc&15)<<12|Qc<<6|wb;if(2048<=lc)return sb(lc,oc)?lc:65533;throw Error("Invalid continuation byte");}if(240==(lc&248)&&(Qc=Cb(),wb=Cb(),oc=Cb(),lc=(lc&7)<<18|Qc<<12|wb<<6|oc,65536<=lc&&1114111>=lc))return lc;throw Error("Invalid UTF-8 detected");}if(ba)return Jb;ba=!0;var Gb=String.fromCharCode,yc,rd,pd;return Jb={version:"2.1.2",
encode:function(oc,lc){lc=lc||{};lc=!1!==lc.strict;oc=Ca(oc);for(var Qc=oc.length,wb=-1,jd,ne="";++wb<Qc;){jd=oc[wb];var bf=lc;if(0==(jd&4294967168))jd=Gb(jd);else{var ee="";0==(jd&4294965248)?ee=Gb(jd>>6&31|192):0==(jd&4294901760)?(sb(jd,bf)||(jd=65533),ee=Gb(jd>>12&15|224),ee+=Gb(jd>>6&63|128)):0==(jd&4292870144)&&(ee=Gb(jd>>18&7|240),ee+=Gb(jd>>12&63|128),ee+=Gb(jd>>6&63|128));jd=ee+=Gb(jd&63|128)}ne+=jd}return ne},decode:function(oc,lc){lc=lc||{};lc=!1!==lc.strict;yc=Ca(oc);rd=yc.length;pd=0;
oc=[];for(var Qc;!1!==(Qc=vb(lc));)oc.push(Qc);lc=oc.length;Qc=-1;for(var wb,jd="";++Qc<lc;)wb=oc[Qc],65535<wb&&(wb-=65536,jd+=Gb(wb>>>10&1023|55296),wb=56320|wb&1023),jd+=Gb(wb);return jd}}}function ld(){if(ob)return Ka;ob=!0;(function(Ca){Ka.encode=function(sb){sb=new Uint8Array(sb);var Cb,vb=sb.length,Gb="";for(Cb=0;Cb<vb;Cb+=3)Gb+=Ca[sb[Cb]>>2],Gb+=Ca[(sb[Cb]&3)<<4|sb[Cb+1]>>4],Gb+=Ca[(sb[Cb+1]&15)<<2|sb[Cb+2]>>6],Gb+=Ca[sb[Cb+2]&63];2===vb%3?Gb=Gb.substring(0,Gb.length-1)+"=":1===vb%3&&(Gb=Gb.substring(0,
Gb.length-2)+"==");return Gb};Ka.decode=function(sb){var Cb=.75*sb.length,vb=sb.length,Gb=0;"="===sb[sb.length-1]&&(Cb--,"="===sb[sb.length-2]&&Cb--);var yc=new ArrayBuffer(Cb),rd=new Uint8Array(yc);for(Cb=0;Cb<vb;Cb+=4){var pd=Ca.indexOf(sb[Cb]);var oc=Ca.indexOf(sb[Cb+1]);var lc=Ca.indexOf(sb[Cb+2]);var Qc=Ca.indexOf(sb[Cb+3]);rd[Gb++]=pd<<2|oc>>4;rd[Gb++]=(oc&15)<<4|lc>>2;rd[Gb++]=(lc&3)<<6|Qc&63}return yc}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/");return Ka}function Rb(){function Ca(pd){return pd.map(function(oc){if(oc.buffer instanceof
ArrayBuffer){var lc=oc.buffer;if(oc.byteLength!==lc.byteLength){var Qc=new Uint8Array(oc.byteLength);Qc.set(new Uint8Array(lc,oc.byteOffset,oc.byteLength));lc=Qc.buffer}return lc}return oc})}function sb(pd,oc){oc=oc||{};var lc=new vb;Ca(pd).forEach(function(Qc){lc.append(Qc)});return oc.type?lc.getBlob(oc.type):lc.getBlob()}function Cb(pd,oc){return new Blob(Ca(pd),oc||{})}if(Jc)return yb;Jc=!0;var vb="undefined"!==typeof vb?vb:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!==
typeof MSBlobBuilder?MSBlobBuilder:"undefined"!==typeof MozBlobBuilder?MozBlobBuilder:!1;try{var Gb=2===(new Blob(["hi"])).size}catch(pd){Gb=!1}var yc;if(yc=Gb)try{yc=2===(new Blob([new Uint8Array([1,2])])).size}catch(pd){yc=!1}var rd=vb&&vb.prototype.append&&vb.prototype.getBlob;"undefined"!==typeof Blob&&(sb.prototype=Blob.prototype,Cb.prototype=Blob.prototype);yb=Gb?yc?Blob:Cb:rd?sb:void 0;return yb}function qb(){function Ca(ee,Re,kf){if(!Re)return wc.encodeBase64Packet(ee,kf);var Hf=new FileReader;
Hf.onload=function(){wc.encodePacket({type:ee.type,data:Hf.result},Re,!0,kf)};return Hf.readAsArrayBuffer(ee.data)}function sb(ee,Re,kf){var Hf=Array(ee.length);kf=yc(ee.length,kf);for(var Af=function(Ug,kh,Lj){Re(kh,function(sa,Pa){Hf[Ug]=Pa;Lj(sa,Hf)})},yg=0;yg<ee.length;yg++)Af(yg,ee[yg],kf)}if(Dd)return wc;Dd=!0;var Cb=zc(),vb=Ec(),Gb=Pb(),yc=Qb(),rd=Tc(),pd;"undefined"!==typeof ArrayBuffer&&(pd=ld());var oc="undefined"!==typeof navigator&&/Android/i.test(navigator.userAgent),lc="undefined"!==
typeof navigator&&/PhantomJS/i.test(navigator.userAgent),Qc=oc||lc;wc.protocol=3;var wb=wc.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},jd=Cb(wb),ne={type:"error",data:"parser error"},bf=Rb();wc.encodePacket=function(ee,Re,kf,Hf){"function"===typeof Re&&(Hf=Re,Re=!1);"function"===typeof kf&&(Hf=kf,kf=null);var Af=void 0===ee.data?void 0:ee.data.buffer||ee.data;if("undefined"!==typeof ArrayBuffer&&Af instanceof ArrayBuffer){if(Re){kf=ee.data;Re=new Uint8Array(kf);kf=new Uint8Array(1+
kf.byteLength);kf[0]=wb[ee.type];for(ee=0;ee<Re.length;ee++)kf[ee+1]=Re[ee];ee=Hf(kf.buffer)}else ee=wc.encodeBase64Packet(ee,Hf);return ee}if("undefined"!==typeof bf&&Af instanceof bf)return Re?Qc?ee=Ca(ee,Re,Hf):(Re=new Uint8Array(1),Re[0]=wb[ee.type],ee=new bf([Re.buffer,ee.data]),ee=Hf(ee)):ee=wc.encodeBase64Packet(ee,Hf),ee;if(Af&&Af.base64)return Hf("b"+wc.packets[ee.type]+ee.data.data);Re=wb[ee.type];void 0!==ee.data&&(Re+=kf?rd.encode(String(ee.data),{strict:!1}):String(ee.data));return Hf(""+
Re)};wc.encodeBase64Packet=function(ee,Re){var kf="b"+wc.packets[ee.type];if("undefined"!==typeof bf&&ee.data instanceof bf){var Hf=new FileReader;Hf.onload=function(){var Ug=Hf.result.split(",")[1];Re(kf+Ug)};return Hf.readAsDataURL(ee.data)}try{var Af=String.fromCharCode.apply(null,new Uint8Array(ee.data))}catch(Ug){ee=new Uint8Array(ee.data);Af=Array(ee.length);for(var yg=0;yg<ee.length;yg++)Af[yg]=ee[yg];Af=String.fromCharCode.apply(null,Af)}kf+=btoa(Af);return Re(kf)};wc.decodePacket=function(ee,
Re,kf){if(void 0===ee)return ne;if("string"===typeof ee){if("b"===ee.charAt(0))return wc.decodeBase64Packet(ee.substr(1),Re);if(kf){a:{Re=ee;try{Re=rd.decode(Re,{strict:!1})}catch(Hf){ee=!1;break a}ee=Re}if(!1===ee)return ne}kf=ee.charAt(0);return Number(kf)==kf&&jd[kf]?1<ee.length?{type:jd[kf],data:ee.substring(1)}:{type:jd[kf]}:ne}kf=(new Uint8Array(ee))[0];ee=Gb(ee,1);bf&&"blob"===Re&&(ee=new bf([ee]));return{type:jd[kf],data:ee}};wc.decodeBase64Packet=function(ee,Re){var kf=jd[ee.charAt(0)];if(!pd)return{type:kf,
data:{base64:!0,data:ee.substr(1)}};ee=pd.decode(ee.substr(1));"blob"===Re&&bf&&(ee=new bf([ee]));return{type:kf,data:ee}};wc.encodePayload=function(ee,Re,kf){"function"===typeof Re&&(kf=Re,Re=null);var Hf=vb(ee);if(Re&&Hf)return bf&&!Qc?wc.encodePayloadAsBlob(ee,kf):wc.encodePayloadAsArrayBuffer(ee,kf);if(!ee.length)return kf("0:");sb(ee,function(Af,yg){wc.encodePacket(Af,Hf?Re:!1,!1,function(Ug){yg(null,Ug.length+":"+Ug)})},function(Af,yg){return kf(yg.join(""))})};wc.decodePayload=function(ee,
Re,kf){if("string"!==typeof ee)return wc.decodePayloadAsBinary(ee,Re,kf);"function"===typeof Re&&(kf=Re,Re=null);if(""===ee)return kf(ne,0,1);var Hf="";for(var Af,yg,Ug=0,kh=ee.length;Ug<kh;Ug++)if(yg=ee.charAt(Ug),":"!==yg)Hf+=yg;else{if(""===Hf||Hf!=(Af=Number(Hf)))return kf(ne,0,1);yg=ee.substr(Ug+1,Af);if(Hf!=yg.length)return kf(ne,0,1);if(yg.length){Hf=wc.decodePacket(yg,Re,!1);if(ne.type===Hf.type&&ne.data===Hf.data)return kf(ne,0,1);if(!1===kf(Hf,Ug+Af,kh))return}Ug+=Af;Hf=""}if(""!==Hf)return kf(ne,
0,1)};wc.encodePayloadAsArrayBuffer=function(ee,Re){if(!ee.length)return Re(new ArrayBuffer(0));sb(ee,function(kf,Hf){wc.encodePacket(kf,!0,!0,function(Af){return Hf(null,Af)})},function(kf,Hf){kf=Hf.reduce(function(Ug,kh){kh="string"===typeof kh?kh.length:kh.byteLength;return Ug+kh.toString().length+kh+2},0);var Af=new Uint8Array(kf),yg=0;Hf.forEach(function(Ug){var kh="string"===typeof Ug,Lj=Ug;if(kh){Lj=new Uint8Array(Ug.length);for(var sa=0;sa<Ug.length;sa++)Lj[sa]=Ug.charCodeAt(sa);Lj=Lj.buffer}kh?
Af[yg++]=0:Af[yg++]=1;Ug=Lj.byteLength.toString();for(sa=0;sa<Ug.length;sa++)Af[yg++]=parseInt(Ug[sa]);Af[yg++]=255;Lj=new Uint8Array(Lj);for(sa=0;sa<Lj.length;sa++)Af[yg++]=Lj[sa]});return Re(Af.buffer)})};wc.encodePayloadAsBlob=function(ee,Re){sb(ee,function(kf,Hf){wc.encodePacket(kf,!0,!0,function(Af){var yg=new Uint8Array(1);yg[0]=1;if("string"===typeof Af){for(var Ug=new Uint8Array(Af.length),kh=0;kh<Af.length;kh++)Ug[kh]=Af.charCodeAt(kh);Af=Ug.buffer;yg[0]=0}Ug=(Af instanceof ArrayBuffer?Af.byteLength:
Af.size).toString();var Lj=new Uint8Array(Ug.length+1);for(kh=0;kh<Ug.length;kh++)Lj[kh]=parseInt(Ug[kh]);Lj[Ug.length]=255;bf&&(Af=new bf([yg.buffer,Lj.buffer,Af]),Hf(null,Af))})},function(kf,Hf){return Re(new bf(Hf))})};wc.decodePayloadAsBinary=function(ee,Re,kf){"function"===typeof Re&&(kf=Re,Re=null);for(var Hf=[];0<ee.byteLength;){for(var Af=new Uint8Array(ee),yg=0===Af[0],Ug="",kh=1;255!==Af[kh];kh++){if(310<Ug.length)return kf(ne,0,1);Ug+=Af[kh]}ee=Gb(ee,2+Ug.length);Ug=parseInt(Ug);Af=Gb(ee,
0,Ug);if(yg)try{Af=String.fromCharCode.apply(null,new Uint8Array(Af))}catch(sa){for(yg=new Uint8Array(Af),Af="",kh=0;kh<yg.length;kh++)Af+=String.fromCharCode(yg[kh])}Hf.push(Af);ee=Gb(ee,Ug)}var Lj=Hf.length;Hf.forEach(function(sa,Pa){kf(wc.decodePacket(sa,Re,!0),Pa,Lj)})};return wc}function bc(){function Ca(vb){(this||He).path=vb.path;(this||He).hostname=vb.hostname;(this||He).port=vb.port;(this||He).secure=vb.secure;(this||He).query=vb.query;(this||He).timestampParam=vb.timestampParam;(this||He).timestampRequests=
vb.timestampRequests;(this||He).readyState="";(this||He).agent=vb.agent||!1;(this||He).socket=vb.socket;(this||He).enablesXDR=vb.enablesXDR;(this||He).withCredentials=vb.withCredentials;(this||He).pfx=vb.pfx;(this||He).key=vb.key;(this||He).passphrase=vb.passphrase;(this||He).cert=vb.cert;(this||He).ca=vb.ca;(this||He).ciphers=vb.ciphers;(this||He).rejectUnauthorized=vb.rejectUnauthorized;(this||He).forceNode=vb.forceNode;(this||He).isReactNative=vb.isReactNative;(this||He).extraHeaders=vb.extraHeaders;
(this||He).localAddress=vb.localAddress}if(Ad)return zd;Ad=!0;var sb=qb(),Cb=md();zd=Ca;Cb(Ca.prototype);Ca.prototype.onError=function(vb,Gb){vb=Error(vb);vb.type="TransportError";vb.description=Gb;this.emit("error",vb);return this||He};Ca.prototype.open=function(){if("closed"===(this||He).readyState||""===(this||He).readyState)(this||He).readyState="opening",this.doOpen();return this||He};Ca.prototype.close=function(){if("opening"===(this||He).readyState||"open"===(this||He).readyState)this.doClose(),
this.onClose();return this||He};Ca.prototype.send=function(vb){if("open"===(this||He).readyState)this.write(vb);else throw Error("Transport not open");};Ca.prototype.onOpen=function(){(this||He).readyState="open";(this||He).writable=!0;this.emit("open")};Ca.prototype.onData=function(vb){vb=sb.decodePacket(vb,(this||He).socket.binaryType);this.onPacket(vb)};Ca.prototype.onPacket=function(vb){this.emit("packet",vb)};Ca.prototype.onClose=function(){(this||He).readyState="closed";this.emit("close")};
return zd}function Ic(){if(og)return df;og=!0;df.encode=function(Ca){var sb="",Cb;for(Cb in Ca)Ca.hasOwnProperty(Cb)&&(sb.length&&(sb+="&"),sb+=encodeURIComponent(Cb)+"="+encodeURIComponent(Ca[Cb]));return sb};df.decode=function(Ca){var sb={};Ca=Ca.split("&");for(var Cb=0,vb=Ca.length;Cb<vb;Cb++){var Gb=Ca[Cb].split("=");sb[decodeURIComponent(Gb[0])]=decodeURIComponent(Gb[1])}return sb};return df}function ra(){if(Oi)return Jh;Oi=!0;return Jh=function(Ca,sb){var Cb=function(){};Cb.prototype=sb.prototype;
Ca.prototype=new Cb;Ca.prototype.constructor=Ca}}function Fa(){function Ca(pd){var oc="";do oc=Cb[pd%64]+oc,pd=Math.floor(pd/64);while(0<pd);return oc}function sb(){var pd=Ca(+new Date);return pd!==rd?(Gb=0,rd=pd):pd+"."+Ca(Gb++)}if(Kj)return Th;Kj=!0;for(var Cb="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),vb={},Gb=0,yc=0,rd;64>yc;yc++)vb[Cb[yc]]=yc;sb.encode=Ca;sb.decode=function(pd){var oc=0;for(yc=0;yc<pd.length;yc++)oc=64*oc+vb[pd.charAt(yc)];return oc};return Th=
sb}function mb(){function Ca(oc){var lc=oc&&oc.forceBase64;if(!pd||lc)(this||Kf).supportsBinary=!1;sb.call(this||Kf,oc)}if(gl)return Kh;gl=!0;var sb=bc(),Cb=Ic(),vb=qb(),Gb=ra(),yc=Fa(),rd=fe()("engine.io-client:polling");Kh=Ca;var pd=null!=(new (ke())({xdomain:!1})).responseType;Gb(Ca,sb);Ca.prototype.name="polling";Ca.prototype.doOpen=function(){this.poll()};Ca.prototype.pause=function(oc){function lc(){rd("paused");Qc.readyState="paused";oc()}var Qc=this||Kf;(this||Kf).readyState="pausing";if((this||
Kf).polling||!(this||Kf).writable){var wb=0;(this||Kf).polling&&(rd("we are currently polling - waiting to pause"),wb++,this.once("pollComplete",function(){rd("pre-pause polling complete");--wb||lc()}));(this||Kf).writable||(rd("we are currently writing - waiting to pause"),wb++,this.once("drain",function(){rd("pre-pause writing complete");--wb||lc()}))}else lc()};Ca.prototype.poll=function(){rd("polling");(this||Kf).polling=!0;this.doPoll();this.emit("poll")};Ca.prototype.onData=function(oc){var lc=
this||Kf;rd("polling got data %s",oc);vb.decodePayload(oc,(this||Kf).socket.binaryType,function(Qc,wb,jd){if("opening"===lc.readyState)lc.onOpen();if("close"===Qc.type)return lc.onClose(),!1;lc.onPacket(Qc)});"closed"!==(this||Kf).readyState&&((this||Kf).polling=!1,this.emit("pollComplete"),"open"===(this||Kf).readyState?this.poll():rd('ignoring poll - transport state "%s"',(this||Kf).readyState))};Ca.prototype.doClose=function(){function oc(){rd("writing close packet");lc.write([{type:"close"}])}
var lc=this||Kf;"open"===(this||Kf).readyState?(rd("transport open - closing"),oc()):(rd("transport not open - deferring close"),this.once("open",oc))};Ca.prototype.write=function(oc){var lc=this||Kf;(this||Kf).writable=!1;var Qc=function(){lc.writable=!0;lc.emit("drain")};vb.encodePayload(oc,(this||Kf).supportsBinary,function(wb){lc.doWrite(wb,Qc)})};Ca.prototype.uri=function(){var oc=(this||Kf).query||{},lc=(this||Kf).secure?"https":"http",Qc="";!1!==(this||Kf).timestampRequests&&(oc[(this||Kf).timestampParam]=
yc());(this||Kf).supportsBinary||oc.sid||(oc.b64=1);oc=Cb.encode(oc);(this||Kf).port&&("https"===lc&&443!==Number((this||Kf).port)||"http"===lc&&80!==Number((this||Kf).port))&&(Qc=":"+(this||Kf).port);oc.length&&(oc="?"+oc);var wb=-1!==(this||Kf).hostname.indexOf(":");return lc+"://"+(wb?"["+(this||Kf).hostname+"]":(this||Kf).hostname)+Qc+(this||Kf).path+oc};return Kh}function ub(){function Ca(){}function sb(Qc){yc.call(this||Ke,Qc);(this||Ke).requestTimeout=Qc.requestTimeout;(this||Ke).extraHeaders=
Qc.extraHeaders;if("undefined"!==typeof location){var wb="https:"===location.protocol,jd=location.port;jd||(jd=wb?443:80);(this||Ke).xd="undefined"!==typeof location&&Qc.hostname!==location.hostname||jd!==Qc.port;(this||Ke).xs=Qc.secure!==wb}}function Cb(Qc){(this||Ke).method=Qc.method||"GET";(this||Ke).uri=Qc.uri;(this||Ke).xd=!!Qc.xd;(this||Ke).xs=!!Qc.xs;(this||Ke).async=!1!==Qc.async;(this||Ke).data=void 0!==Qc.data?Qc.data:null;(this||Ke).agent=Qc.agent;(this||Ke).isBinary=Qc.isBinary;(this||
Ke).supportsBinary=Qc.supportsBinary;(this||Ke).enablesXDR=Qc.enablesXDR;(this||Ke).withCredentials=Qc.withCredentials;(this||Ke).requestTimeout=Qc.requestTimeout;(this||Ke).pfx=Qc.pfx;(this||Ke).key=Qc.key;(this||Ke).passphrase=Qc.passphrase;(this||Ke).cert=Qc.cert;(this||Ke).ca=Qc.ca;(this||Ke).ciphers=Qc.ciphers;(this||Ke).rejectUnauthorized=Qc.rejectUnauthorized;(this||Ke).extraHeaders=Qc.extraHeaders;this.create()}function vb(){for(var Qc in Cb.requests)Cb.requests.hasOwnProperty(Qc)&&Cb.requests[Qc].abort()}
if(oi)return Uj;oi=!0;var Gb=ke(),yc=mb(),rd=md(),pd=ra(),oc=fe()("engine.io-client:polling-xhr"),lc=td();Uj=sb;Uj.Request=Cb;pd(sb,yc);sb.prototype.supportsBinary=!0;sb.prototype.request=function(Qc){Qc=Qc||{};Qc.uri=this.uri();Qc.xd=(this||Ke).xd;Qc.xs=(this||Ke).xs;Qc.agent=(this||Ke).agent||!1;Qc.supportsBinary=(this||Ke).supportsBinary;Qc.enablesXDR=(this||Ke).enablesXDR;Qc.withCredentials=(this||Ke).withCredentials;Qc.pfx=(this||Ke).pfx;Qc.key=(this||Ke).key;Qc.passphrase=(this||Ke).passphrase;
Qc.cert=(this||Ke).cert;Qc.ca=(this||Ke).ca;Qc.ciphers=(this||Ke).ciphers;Qc.rejectUnauthorized=(this||Ke).rejectUnauthorized;Qc.requestTimeout=(this||Ke).requestTimeout;Qc.extraHeaders=(this||Ke).extraHeaders;return new Cb(Qc)};sb.prototype.doWrite=function(Qc,wb){Qc=this.request({method:"POST",data:Qc,isBinary:"string"!==typeof Qc&&void 0!==Qc});var jd=this||Ke;Qc.on("success",wb);Qc.on("error",function(ne){jd.onError("xhr post error",ne)});(this||Ke).sendXhr=Qc};sb.prototype.doPoll=function(){oc("xhr poll");
var Qc=this.request(),wb=this||Ke;Qc.on("data",function(jd){wb.onData(jd)});Qc.on("error",function(jd){wb.onError("xhr poll error",jd)});(this||Ke).pollXhr=Qc};rd(Cb.prototype);Cb.prototype.create=function(){var Qc={agent:(this||Ke).agent,xdomain:(this||Ke).xd,xscheme:(this||Ke).xs,enablesXDR:(this||Ke).enablesXDR};Qc.pfx=(this||Ke).pfx;Qc.key=(this||Ke).key;Qc.passphrase=(this||Ke).passphrase;Qc.cert=(this||Ke).cert;Qc.ca=(this||Ke).ca;Qc.ciphers=(this||Ke).ciphers;Qc.rejectUnauthorized=(this||Ke).rejectUnauthorized;
var wb=(this||Ke).xhr=new Gb(Qc),jd=this||Ke;try{oc("xhr open %s: %s",(this||Ke).method,(this||Ke).uri);wb.open((this||Ke).method,(this||Ke).uri,(this||Ke).async);try{if((this||Ke).extraHeaders){wb.setDisableHeaderCheck&&wb.setDisableHeaderCheck(!0);for(var ne in(this||Ke).extraHeaders)(this||Ke).extraHeaders.hasOwnProperty(ne)&&wb.setRequestHeader(ne,(this||Ke).extraHeaders[ne])}}catch(bf){}if("POST"===(this||Ke).method)try{(this||Ke).isBinary?wb.setRequestHeader("Content-type","application/octet-stream"):
wb.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(bf){}try{wb.setRequestHeader("Accept","*/*")}catch(bf){}"withCredentials"in wb&&(wb.withCredentials=(this||Ke).withCredentials);(this||Ke).requestTimeout&&(wb.timeout=(this||Ke).requestTimeout);this.hasXDR()?(wb.onload=function(){jd.onLoad()},wb.onerror=function(){jd.onError(wb.responseText)}):wb.onreadystatechange=function(){if(2===wb.readyState)try{var bf=wb.getResponseHeader("Content-Type");if(jd.supportsBinary&&"application/octet-stream"===
bf||"application/octet-stream; charset=UTF-8"===bf)wb.responseType="arraybuffer"}catch(ee){}if(4===wb.readyState)if(200===wb.status||1223===wb.status)jd.onLoad();else setTimeout(function(){jd.onError("number"===typeof wb.status?wb.status:0)},0)};oc("xhr data %s",(this||Ke).data);wb.send((this||Ke).data)}catch(bf){setTimeout(function(){jd.onError(bf)},0);return}"undefined"!==typeof document&&((this||Ke).index=Cb.requestsCount++,Cb.requests[(this||Ke).index]=this||Ke)};Cb.prototype.onSuccess=function(){this.emit("success");
this.cleanup()};Cb.prototype.onData=function(Qc){this.emit("data",Qc);this.onSuccess()};Cb.prototype.onError=function(Qc){this.emit("error",Qc);this.cleanup(!0)};Cb.prototype.cleanup=function(Qc){if("undefined"!==typeof(this||Ke).xhr&&null!==(this||Ke).xhr){this.hasXDR()?(this||Ke).xhr.onload=(this||Ke).xhr.onerror=Ca:(this||Ke).xhr.onreadystatechange=Ca;if(Qc)try{(this||Ke).xhr.abort()}catch(wb){}"undefined"!==typeof document&&delete Cb.requests[(this||Ke).index];(this||Ke).xhr=null}};Cb.prototype.onLoad=
function(){try{try{var Qc=(this||Ke).xhr.getResponseHeader("Content-Type")}catch(jd){}var wb="application/octet-stream"===Qc||"application/octet-stream; charset=UTF-8"===Qc?(this||Ke).xhr.response||(this||Ke).xhr.responseText:(this||Ke).xhr.responseText}catch(jd){this.onError(jd)}if(null!=wb)this.onData(wb)};Cb.prototype.hasXDR=function(){return"undefined"!==typeof XDomainRequest&&!(this||Ke).xs&&(this||Ke).enablesXDR};Cb.prototype.abort=function(){this.cleanup()};Cb.requestsCount=0;Cb.requests={};
"undefined"!==typeof document&&("function"===typeof attachEvent?attachEvent("onunload",vb):"function"===typeof addEventListener&&addEventListener("onpagehide"in lc?"pagehide":"unload",vb,!1));return Uj}function Db(){function Ca(){}function sb(oc){Cb.call(this||ch,oc);(this||ch).query=(this||ch).query||{};pd||(pd=Gb.___eio=Gb.___eio||[]);(this||ch).index=pd.length;var lc=this||ch;pd.push(function(Qc){lc.onData(Qc)});(this||ch).query.j=(this||ch).index;"function"===typeof addEventListener&&addEventListener("beforeunload",
function(){lc.script&&(lc.script.onerror=Ca)},!1)}if(cm)return Kk;cm=!0;var Cb=mb(),vb=ra(),Gb=td();Kk=sb;var yc=/\n/g,rd=/\\n/g,pd;vb(sb,Cb);sb.prototype.supportsBinary=!1;sb.prototype.doClose=function(){(this||ch).script&&((this||ch).script.parentNode.removeChild((this||ch).script),(this||ch).script=null);(this||ch).form&&((this||ch).form.parentNode.removeChild((this||ch).form),(this||ch).form=null,(this||ch).iframe=null);Cb.prototype.doClose.call(this||ch)};sb.prototype.doPoll=function(){var oc=
this||ch,lc=document.createElement("script");(this||ch).script&&((this||ch).script.parentNode.removeChild((this||ch).script),(this||ch).script=null);lc.async=!0;lc.src=this.uri();lc.onerror=function(wb){oc.onError("jsonp poll error",wb)};var Qc=document.getElementsByTagName("script")[0];Qc?Qc.parentNode.insertBefore(lc,Qc):(document.head||document.body).appendChild(lc);(this||ch).script=lc;"undefined"!==typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var wb=document.createElement("iframe");
document.body.appendChild(wb);document.body.removeChild(wb)},100)};sb.prototype.doWrite=function(oc,lc){function Qc(){wb();lc()}function wb(){if(jd.iframe)try{jd.form.removeChild(jd.iframe)}catch(kf){jd.onError("jsonp polling iframe removal error",kf)}try{Re=document.createElement('<iframe src="javascript:0" name="'+jd.iframeId+'">')}catch(kf){Re=document.createElement("iframe"),Re.name=jd.iframeId,Re.src="javascript:0"}Re.id=jd.iframeId;jd.form.appendChild(Re);jd.iframe=Re}var jd=this||ch;if(!(this||
ch).form){var ne=document.createElement("form"),bf=document.createElement("textarea"),ee=(this||ch).iframeId="eio_iframe_"+(this||ch).index,Re;ne.className="socketio";ne.style.position="absolute";ne.style.top="-1000px";ne.style.left="-1000px";ne.target=ee;ne.method="POST";ne.setAttribute("accept-charset","utf-8");bf.name="d";ne.appendChild(bf);document.body.appendChild(ne);(this||ch).form=ne;(this||ch).area=bf}(this||ch).form.action=this.uri();wb();oc=oc.replace(rd,"\\\n");(this||ch).area.value=oc.replace(yc,
"\\n");try{(this||ch).form.submit()}catch(kf){}(this||ch).iframe.attachEvent?(this||ch).iframe.onreadystatechange=function(){"complete"===jd.iframe.readyState&&Qc()}:(this||ch).iframe.onload=Qc};return Kk}function cb(){if(Fl)return ok;Fl=!0;return ok=function(){throw Error("ws does not work in the browser. Browser clients must use the native WebSocket object");}}function fb(){function Ca(wb){wb&&wb.forceBase64&&((this||sg).supportsBinary=!1);(this||sg).perMessageDeflate=wb.perMessageDeflate;(this||
sg).usingBrowserWebSocket=oc&&!wb.forceNode;(this||sg).protocols=wb.protocols;(this||sg).usingBrowserWebSocket||(Qc=lc);Cb.call(this||sg,wb)}if(lk)return Gl;lk=!0;var sb=ec.Buffer,Cb=bc(),vb=qb(),Gb=Ic(),yc=ra(),rd=Fa(),pd=fe()("engine.io-client:websocket"),oc;"undefined"!==typeof WebSocket?oc=WebSocket:"undefined"!==typeof self&&(oc=self.WebSocket||self.MozWebSocket);if("undefined"===typeof window)try{var lc=cb()}catch(wb){}var Qc=oc||lc;Gl=Ca;yc(Ca,Cb);Ca.prototype.name="websocket";Ca.prototype.supportsBinary=
!0;Ca.prototype.doOpen=function(){if(this.check()){var wb=this.uri(),jd=(this||sg).protocols,ne={};(this||sg).isReactNative||(ne.agent=(this||sg).agent,ne.perMessageDeflate=(this||sg).perMessageDeflate,ne.pfx=(this||sg).pfx,ne.key=(this||sg).key,ne.passphrase=(this||sg).passphrase,ne.cert=(this||sg).cert,ne.ca=(this||sg).ca,ne.ciphers=(this||sg).ciphers,ne.rejectUnauthorized=(this||sg).rejectUnauthorized);(this||sg).extraHeaders&&(ne.headers=(this||sg).extraHeaders);(this||sg).localAddress&&(ne.localAddress=
(this||sg).localAddress);try{(this||sg).ws=(this||sg).usingBrowserWebSocket&&!(this||sg).isReactNative?jd?new Qc(wb,jd):new Qc(wb):new Qc(wb,jd,ne)}catch(bf){return this.emit("error",bf)}void 0===(this||sg).ws.binaryType&&((this||sg).supportsBinary=!1);(this||sg).ws.supports&&(this||sg).ws.supports.binary?((this||sg).supportsBinary=!0,(this||sg).ws.binaryType="nodebuffer"):(this||sg).ws.binaryType="arraybuffer";this.addEventListeners()}};Ca.prototype.addEventListeners=function(){var wb=this||sg;(this||
sg).ws.onopen=function(){wb.onOpen()};(this||sg).ws.onclose=function(){wb.onClose()};(this||sg).ws.onmessage=function(jd){wb.onData(jd.data)};(this||sg).ws.onerror=function(jd){wb.onError("websocket error",jd)}};Ca.prototype.write=function(wb){function jd(){ne.emit("flush");setTimeout(function(){ne.writable=!0;ne.emit("drain")},0)}var ne=this||sg;(this||sg).writable=!1;for(var bf=wb.length,ee=0,Re=bf;ee<Re;ee++)(function(kf){vb.encodePacket(kf,ne.supportsBinary,function(Hf){if(!ne.usingBrowserWebSocket){var Af=
{};kf.options&&(Af.compress=kf.options.compress);ne.perMessageDeflate&&("string"===typeof Hf?sb.byteLength(Hf):Hf.length)<ne.perMessageDeflate.threshold&&(Af.compress=!1)}try{ne.usingBrowserWebSocket?ne.ws.send(Hf):ne.ws.send(Hf,Af)}catch(yg){pd("websocket closed before onclose event")}--bf||jd()})})(wb[ee])};Ca.prototype.onClose=function(){Cb.prototype.onClose.call(this||sg)};Ca.prototype.doClose=function(){"undefined"!==typeof(this||sg).ws&&(this||sg).ws.close()};Ca.prototype.uri=function(){var wb=
(this||sg).query||{},jd=(this||sg).secure?"wss":"ws",ne="";(this||sg).port&&("wss"===jd&&443!==Number((this||sg).port)||"ws"===jd&&80!==Number((this||sg).port))&&(ne=":"+(this||sg).port);(this||sg).timestampRequests&&(wb[(this||sg).timestampParam]=rd());(this||sg).supportsBinary||(wb.b64=1);wb=Gb.encode(wb);wb.length&&(wb="?"+wb);var bf=-1!==(this||sg).hostname.indexOf(":");return jd+"://"+(bf?"["+(this||sg).hostname+"]":(this||sg).hostname)+ne+(this||sg).path+wb};Ca.prototype.check=function(){return!!Qc&&
!("__initialize"in Qc&&(this||sg).name===Ca.prototype.name)};return Gl}function Eb(){if(Vm)return Wf;Vm=!0;var Ca=ke(),sb=ub(),Cb=Db(),vb=fb();Wf.polling=function(Gb){var yc=!1,rd=!1,pd=!1!==Gb.jsonp;"undefined"!==typeof location&&(rd="https:"===location.protocol,(yc=location.port)||(yc=rd?443:80),yc=Gb.hostname!==location.hostname||yc!==Gb.port,rd=Gb.secure!==rd);Gb.xdomain=yc;Gb.xscheme=rd;if("open"in new Ca(Gb)&&!Gb.forceJSONP)return new sb(Gb);if(!pd)throw Error("JSONP disabled");return new Cb(Gb)};
Wf.websocket=vb;return Wf}function qc(){if(Bd)return Wb;Bd=!0;var Ca=[].indexOf;return Wb=function(sb,Cb){if(Ca)return sb.indexOf(Cb);for(var vb=0;vb<sb.length;++vb)if(sb[vb]===Cb)return vb;return-1}}function gc(){function Ca(oc,lc){if(!((this||id)instanceof Ca))return new Ca(oc,lc);lc=lc||{};oc&&"object"===typeof oc&&(lc=oc,oc=null);oc?(oc=rd(oc),lc.hostname=oc.host,lc.secure="https"===oc.protocol||"wss"===oc.protocol,lc.port=oc.port,oc.query&&(lc.query=oc.query)):lc.host&&(lc.hostname=rd(lc.host).host);
(this||id).secure=null!=lc.secure?lc.secure:"undefined"!==typeof location&&"https:"===location.protocol;lc.hostname&&!lc.port&&(lc.port=(this||id).secure?"443":"80");(this||id).agent=lc.agent||!1;(this||id).hostname=lc.hostname||("undefined"!==typeof location?location.hostname:"localhost");(this||id).port=lc.port||("undefined"!==typeof location&&location.port?location.port:(this||id).secure?443:80);(this||id).query=lc.query||{};"string"===typeof(this||id).query&&((this||id).query=pd.decode((this||
id).query));(this||id).upgrade=!1!==lc.upgrade;(this||id).path=(lc.path||"/engine.io").replace(/\/$/,"")+"/";(this||id).forceJSONP=!!lc.forceJSONP;(this||id).jsonp=!1!==lc.jsonp;(this||id).forceBase64=!!lc.forceBase64;(this||id).enablesXDR=!!lc.enablesXDR;(this||id).withCredentials=!1!==lc.withCredentials;(this||id).timestampParam=lc.timestampParam||"t";(this||id).timestampRequests=lc.timestampRequests;(this||id).transports=lc.transports||["polling","websocket"];(this||id).transportOptions=lc.transportOptions||
{};(this||id).readyState="";(this||id).writeBuffer=[];(this||id).prevBufferLen=0;(this||id).policyPort=lc.policyPort||843;(this||id).rememberUpgrade=lc.rememberUpgrade||!1;(this||id).binaryType=null;(this||id).onlyBinaryUpgrades=lc.onlyBinaryUpgrades;(this||id).perMessageDeflate=!1!==lc.perMessageDeflate?lc.perMessageDeflate||{}:!1;!0===(this||id).perMessageDeflate&&((this||id).perMessageDeflate={});(this||id).perMessageDeflate&&null==(this||id).perMessageDeflate.threshold&&((this||id).perMessageDeflate.threshold=
1024);(this||id).pfx=lc.pfx||null;(this||id).key=lc.key||null;(this||id).passphrase=lc.passphrase||null;(this||id).cert=lc.cert||null;(this||id).ca=lc.ca||null;(this||id).ciphers=lc.ciphers||null;(this||id).rejectUnauthorized=void 0===lc.rejectUnauthorized?!0:lc.rejectUnauthorized;(this||id).forceNode=!!lc.forceNode;(this||id).isReactNative="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();if("undefined"===typeof self||(this||id).isReactNative)lc.extraHeaders&&
0<Object.keys(lc.extraHeaders).length&&((this||id).extraHeaders=lc.extraHeaders),lc.localAddress&&((this||id).localAddress=lc.localAddress);(this||id).id=null;(this||id).upgrades=null;(this||id).pingInterval=null;(this||id).pingTimeout=null;(this||id).pingIntervalTimer=null;(this||id).pingTimeoutTimer=null;this.open()}if(ze)return Lc;ze=!0;var sb=Eb(),Cb=md(),vb=fe()("engine.io-client:socket"),Gb=qc(),yc=qb(),rd=Sc(),pd=Ic();Lc=Ca;Ca.priorWebsocketSuccess=!1;Cb(Ca.prototype);Ca.protocol=yc.protocol;
Ca.Socket=Ca;Ca.Transport=bc();Ca.transports=Eb();Ca.parser=qb();Ca.prototype.createTransport=function(oc){vb('creating transport "%s"',oc);var lc=(this||id).query,Qc={},wb;for(wb in lc)lc.hasOwnProperty(wb)&&(Qc[wb]=lc[wb]);Qc.EIO=yc.protocol;Qc.transport=oc;lc=(this||id).transportOptions[oc]||{};(this||id).id&&(Qc.sid=(this||id).id);return new sb[oc]({query:Qc,socket:this||id,agent:lc.agent||(this||id).agent,hostname:lc.hostname||(this||id).hostname,port:lc.port||(this||id).port,secure:lc.secure||
(this||id).secure,path:lc.path||(this||id).path,forceJSONP:lc.forceJSONP||(this||id).forceJSONP,jsonp:lc.jsonp||(this||id).jsonp,forceBase64:lc.forceBase64||(this||id).forceBase64,enablesXDR:lc.enablesXDR||(this||id).enablesXDR,withCredentials:lc.withCredentials||(this||id).withCredentials,timestampRequests:lc.timestampRequests||(this||id).timestampRequests,timestampParam:lc.timestampParam||(this||id).timestampParam,policyPort:lc.policyPort||(this||id).policyPort,pfx:lc.pfx||(this||id).pfx,key:lc.key||
(this||id).key,passphrase:lc.passphrase||(this||id).passphrase,cert:lc.cert||(this||id).cert,ca:lc.ca||(this||id).ca,ciphers:lc.ciphers||(this||id).ciphers,rejectUnauthorized:lc.rejectUnauthorized||(this||id).rejectUnauthorized,perMessageDeflate:lc.perMessageDeflate||(this||id).perMessageDeflate,extraHeaders:lc.extraHeaders||(this||id).extraHeaders,forceNode:lc.forceNode||(this||id).forceNode,localAddress:lc.localAddress||(this||id).localAddress,requestTimeout:lc.requestTimeout||(this||id).requestTimeout,
protocols:lc.protocols||void 0,isReactNative:(this||id).isReactNative})};Ca.prototype.open=function(){if((this||id).rememberUpgrade&&Ca.priorWebsocketSuccess&&-1!==(this||id).transports.indexOf("websocket"))var oc="websocket";else{if(0===(this||id).transports.length){var lc=this||id;setTimeout(function(){lc.emit("error","No transports available")},0);return}oc=(this||id).transports[0]}(this||id).readyState="opening";try{oc=this.createTransport(oc)}catch(Qc){(this||id).transports.shift();this.open();
return}oc.open();this.setTransport(oc)};Ca.prototype.setTransport=function(oc){vb("setting transport %s",oc.name);var lc=this||id;(this||id).transport&&(vb("clearing existing transport %s",(this||id).transport.name),(this||id).transport.removeAllListeners());(this||id).transport=oc;oc.on("drain",function(){lc.onDrain()}).on("packet",function(Qc){lc.onPacket(Qc)}).on("error",function(Qc){lc.onError(Qc)}).on("close",function(){lc.onClose("transport close")})};Ca.prototype.probe=function(oc){function lc(){if(Hf.onlyBinaryUpgrades){var Af=
!(this||id).supportsBinary&&Hf.transport.supportsBinary;kf=kf||Af}kf||(vb('probe transport "%s" opened',oc),Re.send([{type:"ping",data:"probe"}]),Re.once("packet",function(yg){kf||("pong"===yg.type&&"probe"===yg.data?(vb('probe transport "%s" pong',oc),Hf.upgrading=!0,Hf.emit("upgrading",Re),Re&&(Ca.priorWebsocketSuccess="websocket"===Re.name,vb('pausing current transport "%s"',Hf.transport.name),Hf.transport.pause(function(){kf||"closed"===Hf.readyState||(vb("changing transport and sending upgrade packet"),
ee(),Hf.setTransport(Re),Re.send([{type:"upgrade"}]),Hf.emit("upgrade",Re),Re=null,Hf.upgrading=!1,Hf.flush())}))):(vb('probe transport "%s" failed',oc),yg=Error("probe error"),yg.transport=Re.name,Hf.emit("upgradeError",yg)))}))}function Qc(){kf||(kf=!0,ee(),Re.close(),Re=null)}function wb(Af){var yg=Error("probe error: "+Af);yg.transport=Re.name;Qc();vb('probe transport "%s" failed because of error: %s',oc,Af);Hf.emit("upgradeError",yg)}function jd(){wb("transport closed")}function ne(){wb("socket closed")}
function bf(Af){Re&&Af.name!==Re.name&&(vb('"%s" works - aborting "%s"',Af.name,Re.name),Qc())}function ee(){Re.removeListener("open",lc);Re.removeListener("error",wb);Re.removeListener("close",jd);Hf.removeListener("close",ne);Hf.removeListener("upgrading",bf)}vb('probing transport "%s"',oc);var Re=this.createTransport(oc,{probe:1}),kf=!1,Hf=this||id;Ca.priorWebsocketSuccess=!1;Re.once("open",lc);Re.once("error",wb);Re.once("close",jd);this.once("close",ne);this.once("upgrading",bf);Re.open()};Ca.prototype.onOpen=
function(){vb("socket open");(this||id).readyState="open";Ca.priorWebsocketSuccess="websocket"===(this||id).transport.name;this.emit("open");this.flush();if("open"===(this||id).readyState&&(this||id).upgrade&&(this||id).transport.pause){vb("starting upgrade probes");for(var oc=0,lc=(this||id).upgrades.length;oc<lc;oc++)this.probe((this||id).upgrades[oc])}};Ca.prototype.onPacket=function(oc){if("opening"===(this||id).readyState||"open"===(this||id).readyState||"closing"===(this||id).readyState)switch(vb('socket receive: type "%s", data "%s"',
oc.type,oc.data),this.emit("packet",oc),this.emit("heartbeat"),oc.type){case "open":this.onHandshake(JSON.parse(oc.data));break;case "pong":this.setPing();this.emit("pong");break;case "error":var lc=Error("server error");lc.code=oc.data;this.onError(lc);break;case "message":this.emit("data",oc.data),this.emit("message",oc.data)}else vb('packet received with socket readyState "%s"',(this||id).readyState)};Ca.prototype.onHandshake=function(oc){this.emit("handshake",oc);(this||id).id=oc.sid;(this||id).transport.query.sid=
oc.sid;(this||id).upgrades=this.filterUpgrades(oc.upgrades);(this||id).pingInterval=oc.pingInterval;(this||id).pingTimeout=oc.pingTimeout;this.onOpen();"closed"!==(this||id).readyState&&(this.setPing(),this.removeListener("heartbeat",(this||id).onHeartbeat),this.on("heartbeat",(this||id).onHeartbeat))};Ca.prototype.onHeartbeat=function(oc){clearTimeout((this||id).pingTimeoutTimer);var lc=this||id;lc.pingTimeoutTimer=setTimeout(function(){if("closed"!==lc.readyState)lc.onClose("ping timeout")},oc||
lc.pingInterval+lc.pingTimeout)};Ca.prototype.setPing=function(){var oc=this||id;clearTimeout(oc.pingIntervalTimer);oc.pingIntervalTimer=setTimeout(function(){vb("writing ping packet - expecting pong within %sms",oc.pingTimeout);oc.ping();oc.onHeartbeat(oc.pingTimeout)},oc.pingInterval)};Ca.prototype.ping=function(){var oc=this||id;this.sendPacket("ping",function(){oc.emit("ping")})};Ca.prototype.onDrain=function(){(this||id).writeBuffer.splice(0,(this||id).prevBufferLen);(this||id).prevBufferLen=
0;0===(this||id).writeBuffer.length?this.emit("drain"):this.flush()};Ca.prototype.flush=function(){"closed"!==(this||id).readyState&&(this||id).transport.writable&&!(this||id).upgrading&&(this||id).writeBuffer.length&&(vb("flushing %d packets in socket",(this||id).writeBuffer.length),(this||id).transport.send((this||id).writeBuffer),(this||id).prevBufferLen=(this||id).writeBuffer.length,this.emit("flush"))};Ca.prototype.write=Ca.prototype.send=function(oc,lc,Qc){this.sendPacket("message",oc,lc,Qc);
return this||id};Ca.prototype.sendPacket=function(oc,lc,Qc,wb){"function"===typeof lc&&(wb=lc,lc=void 0);"function"===typeof Qc&&(wb=Qc,Qc=null);if("closing"!==(this||id).readyState&&"closed"!==(this||id).readyState){Qc=Qc||{};Qc.compress=!1!==Qc.compress;oc={type:oc,data:lc,options:Qc};this.emit("packetCreate",oc);(this||id).writeBuffer.push(oc);if(wb)this.once("flush",wb);this.flush()}};Ca.prototype.close=function(){function oc(){wb.onClose("forced close");vb("socket closing - telling transport to close");
wb.transport.close()}function lc(){wb.removeListener("upgrade",lc);wb.removeListener("upgradeError",lc);oc()}function Qc(){wb.once("upgrade",lc);wb.once("upgradeError",lc)}if("opening"===(this||id).readyState||"open"===(this||id).readyState){(this||id).readyState="closing";var wb=this||id;if((this||id).writeBuffer.length)this.once("drain",function(){(this||id).upgrading?Qc():oc()});else(this||id).upgrading?Qc():oc()}return this||id};Ca.prototype.onError=function(oc){vb("socket error %j",oc);Ca.priorWebsocketSuccess=
!1;this.emit("error",oc);this.onClose("transport error",oc)};Ca.prototype.onClose=function(oc,lc){if("opening"===(this||id).readyState||"open"===(this||id).readyState||"closing"===(this||id).readyState){vb('socket close with reason: "%s"',oc);var Qc=this||id;clearTimeout((this||id).pingIntervalTimer);clearTimeout((this||id).pingTimeoutTimer);(this||id).transport.removeAllListeners("close");(this||id).transport.close();(this||id).transport.removeAllListeners();(this||id).readyState="closed";(this||
id).id=null;this.emit("close",oc,lc);Qc.writeBuffer=[];Qc.prevBufferLen=0}};Ca.prototype.filterUpgrades=function(oc){for(var lc=[],Qc=0,wb=oc.length;Qc<wb;Qc++)~Gb((this||id).transports,oc[Qc])&&lc.push(oc[Qc]);return lc};return Lc}function Oc(){if(Sm)return Cm;Sm=!0;return Cm=function(Ca,sb){for(var Cb=[],vb=(sb=sb||0)||0;vb<Ca.length;vb++)Cb[vb-sb]=Ca[vb];return Cb}}function Wc(){if(ao)return Vo;ao=!0;return Vo=function(Ca,sb,Cb){Ca.on(sb,Cb);return{destroy:function(){Ca.removeListener(sb,Cb)}}}}
function Q(){if(qk)return to;qk=!0;var Ca=[].slice;return to=function(sb,Cb){"string"==typeof Cb&&(Cb=sb[Cb]);if("function"!=typeof Cb)throw Error("bind() requires a function");var vb=Ca.call(arguments,2);return function(){return Cb.apply(sb,vb.concat(Ca.call(arguments)))}}}function ea(){function Ca(wb,jd,ne){(this||uf).io=wb;(this||uf).nsp=jd;(this||uf).json=this||uf;(this||uf).ids=0;(this||uf).acks={};(this||uf).receiveBuffer=[];(this||uf).sendBuffer=[];(this||uf).connected=!1;(this||uf).disconnected=
!0;(this||uf).flags={};ne&&ne.query&&((this||uf).query=ne.query);(this||uf).io.autoConnect&&this.open()}if(Tm)return om;Tm=!0;var sb=nc(),Cb=md(),vb=Oc(),Gb=Wc(),yc=Q(),rd=fe()("socket.io-client:socket"),pd=Ic(),oc=Ec();om=om=Ca;var lc={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},Qc=Cb.prototype.emit;Cb(Ca.prototype);Ca.prototype.subEvents=function(){if(!(this||uf).subs){var wb=
(this||uf).io;(this||uf).subs=[Gb(wb,"open",yc(this||uf,"onopen")),Gb(wb,"packet",yc(this||uf,"onpacket")),Gb(wb,"close",yc(this||uf,"onclose"))]}};Ca.prototype.open=Ca.prototype.connect=function(){if((this||uf).connected)return this||uf;this.subEvents();(this||uf).io.reconnecting||(this||uf).io.open();if("open"===(this||uf).io.readyState)this.onopen();this.emit("connecting");return this||uf};Ca.prototype.send=function(){var wb=vb(arguments);wb.unshift("message");(this||uf).emit.apply(this||uf,wb);
return this||uf};Ca.prototype.emit=function(wb){if(lc.hasOwnProperty(wb))return Qc.apply(this||uf,arguments),this||uf;var jd=vb(arguments),ne={type:(void 0!==(this||uf).flags.binary?(this||uf).flags.binary:oc(jd))?sb.BINARY_EVENT:sb.EVENT,data:jd,options:{}};ne.options.compress=!(this||uf).flags||!1!==(this||uf).flags.compress;"function"===typeof jd[jd.length-1]&&(rd("emitting packet with ack id %d",(this||uf).ids),(this||uf).acks[(this||uf).ids]=jd.pop(),ne.id=(this||uf).ids++);(this||uf).connected?
this.packet(ne):(this||uf).sendBuffer.push(ne);(this||uf).flags={};return this||uf};Ca.prototype.packet=function(wb){wb.nsp=(this||uf).nsp;(this||uf).io.packet(wb)};Ca.prototype.onopen=function(){rd("transport is open - connecting");if("/"!==(this||uf).nsp)if((this||uf).query){var wb="object"===typeof(this||uf).query?pd.encode((this||uf).query):(this||uf).query;rd("sending connect packet with query %s",wb);this.packet({type:sb.CONNECT,query:wb})}else this.packet({type:sb.CONNECT})};Ca.prototype.onclose=
function(wb){rd("close (%s)",wb);(this||uf).connected=!1;(this||uf).disconnected=!0;delete (this||uf).id;this.emit("disconnect",wb)};Ca.prototype.onpacket=function(wb){var jd=wb.type===sb.ERROR&&"/"===wb.nsp;if(wb.nsp===(this||uf).nsp||jd)switch(wb.type){case sb.CONNECT:this.onconnect();break;case sb.EVENT:this.onevent(wb);break;case sb.BINARY_EVENT:this.onevent(wb);break;case sb.ACK:this.onack(wb);break;case sb.BINARY_ACK:this.onack(wb);break;case sb.DISCONNECT:this.ondisconnect();break;case sb.ERROR:this.emit("error",
wb.data)}};Ca.prototype.onevent=function(wb){var jd=wb.data||[];rd("emitting event %j",jd);null!=wb.id&&(rd("attaching ack callback to event"),jd.push(this.ack(wb.id)));(this||uf).connected?Qc.apply(this||uf,jd):(this||uf).receiveBuffer.push(jd)};Ca.prototype.ack=function(wb){var jd=this||uf,ne=!1;return function(){if(!ne){ne=!0;var bf=vb(arguments);rd("sending ack %j",bf);jd.packet({type:oc(bf)?sb.BINARY_ACK:sb.ACK,id:wb,data:bf})}}};Ca.prototype.onack=function(wb){var jd=(this||uf).acks[wb.id];
"function"===typeof jd?(rd("calling ack %s with %j",wb.id,wb.data),jd.apply(this||uf,wb.data),delete (this||uf).acks[wb.id]):rd("bad ack %s",wb.id)};Ca.prototype.onconnect=function(){(this||uf).connected=!0;(this||uf).disconnected=!1;this.emit("connect");this.emitBuffered()};Ca.prototype.emitBuffered=function(){var wb;for(wb=0;wb<(this||uf).receiveBuffer.length;wb++)Qc.apply(this||uf,(this||uf).receiveBuffer[wb]);(this||uf).receiveBuffer=[];for(wb=0;wb<(this||uf).sendBuffer.length;wb++)this.packet((this||
uf).sendBuffer[wb]);(this||uf).sendBuffer=[]};Ca.prototype.ondisconnect=function(){rd("server disconnect (%s)",(this||uf).nsp);this.destroy();this.onclose("io server disconnect")};Ca.prototype.destroy=function(){if((this||uf).subs){for(var wb=0;wb<(this||uf).subs.length;wb++)(this||uf).subs[wb].destroy();(this||uf).subs=null}(this||uf).io.destroy(this||uf)};Ca.prototype.close=Ca.prototype.disconnect=function(){(this||uf).connected&&(rd("performing disconnect (%s)",(this||uf).nsp),this.packet({type:sb.DISCONNECT}));
this.destroy();if((this||uf).connected)this.onclose("io client disconnect");return this||uf};Ca.prototype.compress=function(wb){(this||uf).flags.compress=wb;return this||uf};Ca.prototype.binary=function(wb){(this||uf).flags.binary=wb;return this||uf};return om}function Ia(){function Ca(sb){sb=sb||{};(this||Tj).ms=sb.min||100;(this||Tj).max=sb.max||1E4;(this||Tj).factor=sb.factor||2;(this||Tj).jitter=0<sb.jitter&&1>=sb.jitter?sb.jitter:0;(this||Tj).attempts=0}if(bo)return pm;bo=!0;pm=Ca;Ca.prototype.duration=
function(){var sb=(this||Tj).ms*Math.pow((this||Tj).factor,(this||Tj).attempts++);if((this||Tj).jitter){var Cb=Math.random(),vb=Math.floor(Cb*(this||Tj).jitter*sb);sb=0==(Math.floor(10*Cb)&1)?sb-vb:sb+vb}return Math.min(sb,(this||Tj).max)|0};Ca.prototype.reset=function(){(this||Tj).attempts=0};Ca.prototype.setMin=function(sb){(this||Tj).ms=sb};Ca.prototype.setMax=function(sb){(this||Tj).max=sb};Ca.prototype.setJitter=function(sb){(this||Tj).jitter=sb};return pm}function Ra(){function Ca(wb,jd){if(!((this||
ge)instanceof Ca))return new Ca(wb,jd);wb&&"object"===typeof wb&&(jd=wb,wb=void 0);jd=jd||{};jd.path=jd.path||"/socket.io";(this||ge).nsps={};(this||ge).subs=[];(this||ge).opts=jd;this.reconnection(!1!==jd.reconnection);this.reconnectionAttempts(jd.reconnectionAttempts||Infinity);this.reconnectionDelay(jd.reconnectionDelay||1E3);this.reconnectionDelayMax(jd.reconnectionDelayMax||5E3);this.randomizationFactor(jd.randomizationFactor||.5);(this||ge).backoff=new lc({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),
jitter:this.randomizationFactor()});this.timeout(null==jd.timeout?2E4:jd.timeout);(this||ge).readyState="closed";(this||ge).uri=wb;(this||ge).connecting=[];(this||ge).lastPing=null;(this||ge).encoding=!1;(this||ge).packetBuffer=[];wb=jd.parser||Gb;(this||ge).encoder=new wb.Encoder;(this||ge).decoder=new wb.Decoder;(this||ge).autoConnect=!1!==jd.autoConnect;(this||ge).autoConnect&&this.open()}if(qm)return em;qm=!0;pk||(pk=!0,Wg=gc(),Wg.parser=qb());var sb=Wg;var Cb=ea(),vb=md(),Gb=nc(),yc=Wc(),rd=
Q(),pd=fe()("socket.io-client:manager"),oc=qc(),lc=Ia(),Qc=Object.prototype.hasOwnProperty;em=Ca;Ca.prototype.emitAll=function(){(this||ge).emit.apply(this||ge,arguments);for(var wb in(this||ge).nsps)Qc.call((this||ge).nsps,wb)&&(this||ge).nsps[wb].emit.apply((this||ge).nsps[wb],arguments)};Ca.prototype.updateSocketIds=function(){for(var wb in(this||ge).nsps)Qc.call((this||ge).nsps,wb)&&((this||ge).nsps[wb].id=this.generateId(wb))};Ca.prototype.generateId=function(wb){return("/"===wb?"":wb+"#")+(this||
ge).engine.id};vb(Ca.prototype);Ca.prototype.reconnection=function(wb){if(!arguments.length)return(this||ge)._reconnection;(this||ge)._reconnection=!!wb;return this||ge};Ca.prototype.reconnectionAttempts=function(wb){if(!arguments.length)return(this||ge)._reconnectionAttempts;(this||ge)._reconnectionAttempts=wb;return this||ge};Ca.prototype.reconnectionDelay=function(wb){if(!arguments.length)return(this||ge)._reconnectionDelay;(this||ge)._reconnectionDelay=wb;(this||ge).backoff&&(this||ge).backoff.setMin(wb);
return this||ge};Ca.prototype.randomizationFactor=function(wb){if(!arguments.length)return(this||ge)._randomizationFactor;(this||ge)._randomizationFactor=wb;(this||ge).backoff&&(this||ge).backoff.setJitter(wb);return this||ge};Ca.prototype.reconnectionDelayMax=function(wb){if(!arguments.length)return(this||ge)._reconnectionDelayMax;(this||ge)._reconnectionDelayMax=wb;(this||ge).backoff&&(this||ge).backoff.setMax(wb);return this||ge};Ca.prototype.timeout=function(wb){if(!arguments.length)return(this||
ge)._timeout;(this||ge)._timeout=wb;return this||ge};Ca.prototype.maybeReconnectOnOpen=function(){!(this||ge).reconnecting&&(this||ge)._reconnection&&0===(this||ge).backoff.attempts&&this.reconnect()};Ca.prototype.open=Ca.prototype.connect=function(wb,jd){pd("readyState %s",(this||ge).readyState);if(~(this||ge).readyState.indexOf("open"))return this||ge;pd("opening %s",(this||ge).uri);(this||ge).engine=sb((this||ge).uri,(this||ge).opts);var ne=(this||ge).engine,bf=this||ge;(this||ge).readyState="opening";
(this||ge).skipReconnect=!1;var ee=yc(ne,"open",function(){bf.onopen();wb&&wb()});jd=yc(ne,"error",function(Hf){pd("connect_error");bf.cleanup();bf.readyState="closed";bf.emitAll("connect_error",Hf);if(wb){var Af=Error("Connection error");Af.data=Hf;wb(Af)}else bf.maybeReconnectOnOpen()});if(!1!==(this||ge)._timeout){var Re=(this||ge)._timeout;pd("connect attempt will timeout after %d",Re);0===Re&&ee.destroy();var kf=setTimeout(function(){pd("connect attempt timed out after %d",Re);ee.destroy();ne.close();
ne.emit("error","timeout");bf.emitAll("connect_timeout",Re)},Re);(this||ge).subs.push({destroy:function(){clearTimeout(kf)}})}(this||ge).subs.push(ee);(this||ge).subs.push(jd);return this||ge};Ca.prototype.onopen=function(){pd("open");this.cleanup();(this||ge).readyState="open";this.emit("open");var wb=(this||ge).engine;(this||ge).subs.push(yc(wb,"data",rd(this||ge,"ondata")));(this||ge).subs.push(yc(wb,"ping",rd(this||ge,"onping")));(this||ge).subs.push(yc(wb,"pong",rd(this||ge,"onpong")));(this||
ge).subs.push(yc(wb,"error",rd(this||ge,"onerror")));(this||ge).subs.push(yc(wb,"close",rd(this||ge,"onclose")));(this||ge).subs.push(yc((this||ge).decoder,"decoded",rd(this||ge,"ondecoded")))};Ca.prototype.onping=function(){(this||ge).lastPing=new Date;this.emitAll("ping")};Ca.prototype.onpong=function(){this.emitAll("pong",new Date-(this||ge).lastPing)};Ca.prototype.ondata=function(wb){(this||ge).decoder.add(wb)};Ca.prototype.ondecoded=function(wb){this.emit("packet",wb)};Ca.prototype.onerror=function(wb){pd("error",
wb);this.emitAll("error",wb)};Ca.prototype.socket=function(wb,jd){function ne(){~oc(ee.connecting,bf)||ee.connecting.push(bf)}var bf=(this||ge).nsps[wb];if(!bf){bf=new Cb(this||ge,wb,jd);(this||ge).nsps[wb]=bf;var ee=this||ge;bf.on("connecting",ne);bf.on("connect",function(){bf.id=ee.generateId(wb)});(this||ge).autoConnect&&ne()}return bf};Ca.prototype.destroy=function(wb){wb=oc((this||ge).connecting,wb);~wb&&(this||ge).connecting.splice(wb,1);(this||ge).connecting.length||this.close()};Ca.prototype.packet=
function(wb){pd("writing packet %j",wb);var jd=this||ge;wb.query&&0===wb.type&&(wb.nsp+="?"+wb.query);jd.encoding?jd.packetBuffer.push(wb):(jd.encoding=!0,(this||ge).encoder.encode(wb,function(ne){for(var bf=0;bf<ne.length;bf++)jd.engine.write(ne[bf],wb.options);jd.encoding=!1;jd.processPacketQueue()}))};Ca.prototype.processPacketQueue=function(){if(0<(this||ge).packetBuffer.length&&!(this||ge).encoding){var wb=(this||ge).packetBuffer.shift();this.packet(wb)}};Ca.prototype.cleanup=function(){pd("cleanup");
for(var wb=(this||ge).subs.length,jd=0;jd<wb;jd++)(this||ge).subs.shift().destroy();(this||ge).packetBuffer=[];(this||ge).encoding=!1;(this||ge).lastPing=null;(this||ge).decoder.destroy()};Ca.prototype.close=Ca.prototype.disconnect=function(){pd("disconnect");(this||ge).skipReconnect=!0;(this||ge).reconnecting=!1;"opening"===(this||ge).readyState&&this.cleanup();(this||ge).backoff.reset();(this||ge).readyState="closed";(this||ge).engine&&(this||ge).engine.close()};Ca.prototype.onclose=function(wb){pd("onclose");
this.cleanup();(this||ge).backoff.reset();(this||ge).readyState="closed";this.emit("close",wb);(this||ge)._reconnection&&!(this||ge).skipReconnect&&this.reconnect()};Ca.prototype.reconnect=function(){if((this||ge).reconnecting||(this||ge).skipReconnect)return this||ge;var wb=this||ge;if((this||ge).backoff.attempts>=(this||ge)._reconnectionAttempts)pd("reconnect failed"),(this||ge).backoff.reset(),this.emitAll("reconnect_failed"),(this||ge).reconnecting=!1;else{var jd=(this||ge).backoff.duration();
pd("will wait %dms before reconnect attempt",jd);(this||ge).reconnecting=!0;var ne=setTimeout(function(){wb.skipReconnect||(pd("attempting reconnect"),wb.emitAll("reconnect_attempt",wb.backoff.attempts),wb.emitAll("reconnecting",wb.backoff.attempts),wb.skipReconnect||wb.open(function(bf){bf?(pd("reconnect attempt error"),wb.reconnecting=!1,wb.reconnect(),wb.emitAll("reconnect_error",bf.data)):(pd("reconnect success"),wb.onreconnect())}))},jd);(this||ge).subs.push({destroy:function(){clearTimeout(ne)}})}};
Ca.prototype.onreconnect=function(){var wb=(this||ge).backoff.attempts;(this||ge).reconnecting=!1;(this||ge).backoff.reset();this.updateSocketIds();this.emitAll("reconnect",wb)};return em}var cc=lively.FreezerRuntime.recorderFor("lively.2lively/interface.js");cc.nyi=function(Ca){throw Error("Not yet implemented: "+Ca);};cc.string=Ab;cc.promise=Tb;cc.debugMessageOrder=!1;var Nb=function(Ca){this.id=cc.string.newUUID();this.actions={};this.options={ackTimeout:3500,debug:!1};this._incomingOrderNumberingBySenders=
new Map;this._outgoingOrderNumberingByTargets=new Map;this._outOfOrderCacheBySenders=new Map};Nb.prototype.isOnline=function(){cc.nyi("isOnline")};Nb.prototype.open=function(){cc.nyi("isOnline")};Nb.prototype.close=function(){cc.nyi("close")};Nb.prototype.remove=function(){cc.nyi("remove")};Nb.prototype.whenOnline=function(Ca){var sb=this;return cc.promise.waitFor(Ca,function(){return sb.isOnline()}).then(function(){return sb}).catch(function(Cb){return Promise.reject(/timeout/i.test(String(Cb))?
Error("Timeout in "+sb+".whenOnline"):Cb)})};Nb.prototype.onError=function(Ca){this.debug&&console.log("["+this+"] error: "+Ca)};Nb.prototype.removeService=function(Ca){delete this.actions[Ca]};Nb.prototype.removeServices=function(Ca){var sb=this;Ca.forEach(function(Cb){return sb.removeService(Cb)})};Nb.prototype.addService=function(Ca,sb){this.actions[Ca]=sb};Nb.prototype.addServices=function(Ca){var sb=this;Object.keys(Ca).forEach(function(Cb){return sb.addService(Cb,Ca[Cb])})};Nb.prototype.ping=
function(Ca){var sb=this,Cb,vb,Gb,yc,rd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pd){if(1==pd.nextAddress)return Cb=Date.now(),pd.yield(sb.sendToAndWait(Ca,"l2l-ping",{timestamp:Cb}),2);vb=pd.yieldResult;Gb=vb.data;yc=Gb.timestamp;rd=Date.now();return pd.return({to:yc-Cb,from:rd-yc,roundtrip:rd-Cb})})};Nb.prototype.send=function(Ca,sb){cc.nyi("send")};Nb.prototype.sendAndWait=function(Ca){var sb=this,Cb,vb,Gb,yc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rd){switch(rd.nextAddress){case 1:return Cb=
new Promise(function(pd,oc){return sb.send(Ca,pd)}),vb={},Gb=sb.options.ackTimeout+400,"ackTimeout"in Ca&&(Gb=!Ca.ackTimeout||0>Ca.ackTimeout?null:Ca.ackTimeout+400),Gb?rd.yield(Promise.race([cc.promise.delay(Gb,vb),Cb]),5):rd.yield(Cb,4);case 4:yc=rd.yieldResult;rd.jumpTo(3);break;case 5:yc=rd.yieldResult;case 3:if(yc===vb)throw Error("Timeout sending "+Ca.action);return rd.return(yc)}})};Nb.prototype.sendTo=function(Ca,sb,Cb,vb){return this.send({target:Ca,action:sb,data:Cb},vb)};Nb.prototype.sendToAndWait=
function(Ca,sb,Cb,vb){return this.sendAndWait(Object.assign({target:Ca,action:sb,data:Cb},vb))};Nb.prototype.prepareSend=function(Ca,sb){var Cb=Ca.target,vb=Ca.action,Gb=Ca.messageId,yc=Ca.sender;if(!vb)throw Error("Trying to send a message without specifying action!");if(!Cb)throw Error("Trying to send message "+vb+" without specifying target!");Gb||(Ca.messageId=cc.string.newUUID());yc||(Ca.sender=this.id);vb=Ca.n=this._outgoingOrderNumberingByTargets.get(Cb)||0;this._outgoingOrderNumberingByTargets.set(Cb,
vb+1);if("function"===typeof sb){yc=this;var rd=sb;sb=function(pd){var oc=yc._incomingOrderNumberingBySenders.get(pd.sender)||0;yc.debug&&cc.debugMessageOrder&&console.log("[MSG ORDER] "+yc+" received ack for "+pd.action+" as msg "+oc);try{rd.apply(null,arguments)}catch(lc){console.error("Error in ack fn of "+yc+": "+lc.stack)}yc._incomingOrderNumberingBySenders.set(pd.sender,oc+1);setTimeout(function(){return yc.invokeOutOfOrderMessages(pd.sender)},0)}}this.debug&&cc.debugMessageOrder&&console.log("[MSG ORDER] "+
this+" sending "+vb+" ("+Ca.action+") to "+Cb);return[Ca,sb]};Nb.prototype.prepareAnswerMessage=function(Ca,sb){return{action:Ca.action+"-response",inResponseTo:Ca.messageId,target:Ca.sender,data:sb,sender:this.id}};Nb.prototype.installEventToMessageTranslator=function(Ca){var sb=this,Cb=Ca.onevent;Ca.onevent=function(vb){var Gb=vb.data||[];Cb.call(this,vb);vb.data=["*"].concat(Gb);Cb.call(this,vb)};Ca.on("*",function(vb,Gb){vb&&"object"===typeof vb&&vb.action&&(Gb=vb,vb=Gb.action);var yc=arguments[arguments.length-
1];yc="function"===typeof yc?yc:null;(Gb=Gb===yc?null:Gb)&&Gb.data&&("number"===typeof Gb.n||Gb.broadcast)&&Gb.sender?sb.receive(Gb,Ca,yc):(console.warn(sb+" received non-conformant message "+vb+":",arguments),"function"===typeof yc&&yc({data:{error:"invalid l2l message"}}))})};Nb.prototype.receive=function(Ca,sb,Cb){this.dispatchL2LMessageToSelf(Ca,sb,Cb)};Nb.prototype.dispatchL2LMessageToSelf=function(Ca,sb,Cb){var vb=this,Gb=Ca.action;if(Ca.broadcast)this.safeInvokeServiceHandler(Gb,Ca,Cb,sb);
else try{var yc=this._incomingOrderNumberingBySenders.get(Ca.sender)||0,rd="register"===Gb||"unregister";if(!rd&&Ca.n<yc)console.error("[MSG ORDER] ["+this+"] received message no. "+Ca.n+" but expected >= "+yc+", dropping "+Gb);else if(!rd&&Ca.n>yc){this.debug&&cc.debugMessageOrder&&console.log("[MSG ORDER] ["+this+"] storing out of order message "+Gb+" ("+Ca.n+") for later invocation");var pd=this._outOfOrderCacheBySenders.get(Ca.sender);pd||(pd=[],this._outOfOrderCacheBySenders.set(Ca.sender,pd));
pd.push([Gb,Ca,Cb,sb])}else this.safeInvokeServiceHandler(Gb,Ca,Cb,sb),setTimeout(function(){return vb.invokeOutOfOrderMessages(Ca.sender)},0)}catch(oc){console.error("Error message ordering when handling "+Gb+": "+(oc.stack||oc)),"function"===typeof Cb&&Cb(this.prepareAnswerMessage(Ca,{isError:!0,error:String(oc.stack||oc)}))}};Nb.prototype.invokeOutOfOrderMessages=function(Ca){var sb=this._outOfOrderCacheBySenders.get(Ca);if(sb&&sb.length){var Cb=this._incomingOrderNumberingBySenders.get(Ca)||0;
Ca=sb.findIndex(function(vb){vb=$jscomp.makeIterator(vb);vb.next();return vb.next().value.n===Cb});-1!==Ca&&(sb.splice(Ca,1),this.invokeServiceHandler.apply(this,sb[Ca]))}};Nb.prototype.renameTarget=function(Ca,sb){if(Ca!==sb){var Cb=this._outgoingOrderNumberingByTargets.get(Ca);this._outgoingOrderNumberingByTargets.delete(Ca);this._outgoingOrderNumberingByTargets.set(sb,Cb)}};Nb.prototype.safeInvokeServiceHandler=function(Ca,sb,Cb,vb){try{"function"===typeof this.actions[Ca]?this.invokeServiceHandler(Ca,
sb,Cb,vb):vb._events&&Object.keys(vb._events).includes(Ca)||(console.warn("WARNING ["+this+"] Unhandled message: "+Ca),"function"===typeof Cb&&Cb(this.prepareAnswerMessage(sb,{isError:!0,error:"message not understood: "+Ca})))}catch(Gb){console.error("Error when handling "+Ca+": "+(Gb.stack||Gb)),"function"===typeof Cb&&Cb(this.prepareAnswerMessage(sb,{isError:!0,error:String(Gb.stack||Gb)}))}};Nb.prototype.invokeServiceHandler=function(Ca,sb,Cb,vb){var Gb=this;this.debug&&cc.debugMessageOrder&&console.log("[MSG ORDER] "+
this+" received "+sb.n+" ("+sb.action+") from "+sb.sender);this._incomingOrderNumberingBySenders.set(sb.sender,sb.n+1);if("function"===typeof Cb){var yc=!1,rd=!1,pd="ackTimeout"in sb?sb.ackTimeout:this.options.ackTimeout,oc=this._outgoingOrderNumberingByTargets.get(sb.sender)||0;this._outgoingOrderNumberingByTargets.set(sb.sender,oc+1);var lc=function(Qc){rd?console.warn("["+Gb+"] ackFn for "+sb.action+" called after it timed out, dropping answer!"):yc?console.warn("["+Gb+"] ack function called repeatedly when handling "+
sb.action):(yc=!0,Cb(Gb.prepareAnswerMessage(sb,Qc)),Gb.debug&&cc.debugMessageOrder&&console.log("[MSG ORDER] "+Gb+" sending "+oc+" (ack for "+sb.action+")"))};pd&&setTimeout(function(){yc||(lc({isError:!0,error:"Timeout error: "+Gb+" did not send answer for "+sb.action+" after "+pd+"ms"}),rd=!0)},pd)}try{this.actions[Ca].call(this,this,sb,lc,vb)}catch(Qc){console.error("["+this+"] Error handling "+Ca+": "+(Qc.stack||Qc)),lc&&lc({error:Qc.stack})}};$jscomp.global.Object.defineProperties(Nb.prototype,
{debug:{configurable:!0,enumerable:!0,get:function(){return this.options.debug},set:function(Ca){this.options.debug=Ca}}});cc.L2LConnection=Nb;cc.default=Nb;var $a=lively.FreezerRuntime.recorderFor("lively.2lively/default-actions.js"),ic={"l2l-ping":function(Ca,sb,Cb,vb){vb=sb.sender;sb=sb.data.timestamp;var Gb=Date.now();"function"===typeof Cb&&Cb({timestamp:Gb});Ca.debug&&console.log("[undefined] got ping from "+vb+", time: "+(Gb-sb)+"ms")},"remote-eval":function(Ca,sb,Cb,vb){var Gb=sb.data.source;
Promise.resolve().then(function(){return eval(Gb)}).then(function(yc){return Cb({value:yc})}).catch(function(yc){yc.originalErr&&(yc=yc.originalErr);console.error("eval error: "+yc);"function"===typeof Cb&&Cb({isError:!0,value:String(yc.stack||yc)})})},"remote-eval-2":function(Ca,sb,Cb,vb){var Gb=sb.data.source;Promise.resolve().then(function(){var yc=eval(Gb);if(!(yc instanceof Promise))throw console.error("unexpected eval result:"+yc),Error("unexpected eval result:"+yc);return yc}).then(function(yc){return Cb(yc)}).catch(function(yc){console.error("eval error: "+
yc);yc.originalErr&&(yc=yc.originalErr);"function"===typeof Cb&&Cb({isError:!0,value:String(yc.stack||yc)})})}};$a.defaultActions=ic;$a.defaultActions=ic;$a.defaultActions=ic;var nd={},vd=(nd["[broadcast] send"]=function(Ca,sb,Cb,vb){var Gb=sb.sender,yc=sb.data,rd,pd,oc,lc,Qc,wb,jd,ne,bf,ee,Re,kf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Hf){rd=yc;pd=rd.action;oc=rd.broadcast;lc=rd.room;Qc=rd.namespace;wb=rd.isSystemBroadcast;jd=rd.isMultiServerBroadcast;ne=[];jd?(console.log(".......isMultiServerBroadcast"),
bf=Ca,ee=bf.id,Re=Ca.getTrackerList(),console.log(Re),ne=Re.map(function(Af){return Af.id!=ee?Af.io.nsps["/"+Af.namespace]:vb.broadcast})):(wb&&(Qc=Ca.namespace),ne.push(Qc?Ca.io.nsps["/"+Qc]:vb.broadcast));ne.forEach(function(Af){return Af.to(lc).emit({action:pd,sender:Gb,broadcast:!0,data:oc})});Cb&&"function"===typeof Cb&&(kf="message broadcasted to "+lc,Qc&&(kf+=" in namespace "+Qc),1<ne.length&&(kf+=" "+ne.length+" trackers"),console.log(kf),Cb({status:kf}));Hf.jumpToEnd()})},nd["[broadcast] join room"]=
function(Ca,sb,Cb,vb){var Gb=sb.sender,yc=sb.data.room,rd,pd,oc,lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qc){if(1==Qc.nextAddress)return pd=!1,oc=Ca.io.nsps["/"+Ca.namespace].adapter.rooms,(lc=oc[yc]&&oc[yc].sockets&&oc[yc].sockets[vb.id])?(rd=Gb+" already in "+yc,Qc.jumpTo(2)):Qc.yield(new Promise(function(wb,jd){return vb.join(yc,function(ne){return ne?jd(ne):wb()})}),3);2!=Qc.nextAddress&&(rd=Gb+" joined "+yc,pd=!0);Cb&&"function"===typeof Cb&&Cb({status:rd,joined:pd});Qc.jumpToEnd()})},
nd["[broadcast] leave room"]=function(Ca,sb,Cb,vb){var Gb=sb.sender,yc=sb.data.room,rd,pd,oc,lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qc){if(1==Qc.nextAddress)return pd=!1,oc=Ca.io.nsps["/"+Ca.namespace].adapter.rooms,lc=oc[yc]&&oc[yc].sockets&&oc[yc].sockets[vb.id],lc?Qc.yield(new Promise(function(wb,jd){return vb.leave(yc,function(ne){return ne?jd(ne):wb()})}),3):(rd=Gb+" not in "+yc,Qc.jumpTo(2));2!=Qc.nextAddress&&(rd=Gb+" left room "+yc,pd=!0);console.log(rd);Cb&&"function"===
typeof Cb&&Cb({left:pd,status:rd});Qc.jumpToEnd()})},nd["[broadcast] my rooms"]=function(Ca,sb,Cb,vb){Cb(vb.rooms)},nd["[broadcast] all rooms"]=function(Ca,sb,Cb,vb){Cb(Ca.io.nsps["/"+Ca.namespace].adapter.rooms)},nd["[broadcast] list room members"]=function(Ca,sb,Cb,vb){sb=sb.data.room;vb=Ca.io;sb?(Ca=vb.nsps["/"+Ca.namespace].adapter.rooms[sb],Cb({room:sb,sockets:Ca?Ca.sockets:{},length:Ca?Ca.length:0})):Cb({isError:!0,error:"`room` paramerter missing!"})},nd.getClients=function(Ca,sb,Cb){Ca.removeDisconnectedClients();
Cb(Array.from(Ca.clients))},nd);$a.defaultTrackerActions=vd;$a.defaultTrackerActions=vd;$a.defaultTrackerActions=vd;var Xc={},Wa=(Xc.getRoomList=function(Ca){var sb=Ca.client,Cb=Ca.ackFn,vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gb){vb=sb._socketioClient.rooms;Cb(vb);Gb.jumpToEnd()})},Xc["ask for"]=function(Ca,sb,Cb,vb){var Gb=sb.sender,yc=sb.data.query,rd=this,pd,oc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lc){if(1==lc.nextAddress)return pd=yc.match(/password|sudo/i)?
"passwordPrompt":"prompt",lc.yield($world[pd](yc),2);oc=lc.yieldResult;"function"===typeof Cb&&Cb({answer:oc});Ca.debug&&console.log("["+rd+"] message 'ask for' from "+Gb+", query: "+yc);lc.jumpToEnd()})},Xc["open editor"]=function(Ca,sb,Cb,vb){var Gb=sb.data.args,yc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rd){if(1==rd.nextAddress)return Gb.length?rd.yield($world.execCommand("open file for EDITOR",{url:Gb[0]}),2):(Cb({error:"no file specified"}),rd.return());yc=rd.yieldResult;
"function"===typeof Cb&&Cb("aborted"===yc?{error:String(yc)}:{status:yc});rd.jumpToEnd()})},Xc.changeWorkingDirectory=function(Ca,sb,Cb,vb){var Gb=sb.data.args,yc,rd,pd,oc,lc,Qc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wb){yc=$jscomp.makeIterator(Gb||[]);rd=yc.next().value;pd=yc.next().value;oc="OK";try{if(rd)if(pd){if(lc=$world.getMorphWithId(pd))if(lc.__lookupSetter__("cwd"))lc.cwd=rd;else if("function"===typeof lc.changeWorkingDirectory)lc.changeWorkingDirectory(rd);else if("function"===
typeof lc.pluginFind){if(Qc=lc.pluginFind(function(jd){return jd.isShellEditorPlugin}))Qc.cwd=rd}else oc="[changeWorkingDirectory] cannot figure pout how to set dir"}else oc="[changeWorkingDirectory] No command morph";else oc="[changeWorkingDirectory] No directory received"}catch(jd){oc=String(jd)}"OK"!==oc&&console.warn(oc);"function"===typeof Cb&&Cb(oc);wb.jumpToEnd()})},Xc);$a.defaultClientActions=Wa;$a.defaultClientActions=Wa;$a.defaultClientActions=Wa;var Nc={},pb=!1,gb={},hb=!1,Yb={},Xb=!1,
Fd="undefined"!==typeof self?self:global,Be={},Ie=!1,Lf="undefined"!==typeof self?self:global,ed={},ue=!1,Md={},Zb=!1,ta="undefined"!==typeof self?self:global,Ba={},Mb=!1,P={},xa=!1,Qa={},Kb=!1,Pc="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Zc={},le=!1,Rd="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,jf={},ce=!1,we={},Mf=!1,Bf={},rg=!1,Qf={},Yc=!1,Rf={},Fg=!1,Hg={},qf=!1,Ja={},ab=!1,Jb={},ba=!1,Ka={},ob=!1,yb={},Jc=!1,wc={},Dd=
!1,zd={},Ad=!1,He="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,df={},og=!1,Jh={},Oi=!1,Th={},Kj=!1,Kh={},gl=!1,Kf="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Uj={},oi=!1,Ke="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Kk={},cm=!1,ch="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,ok={},Fl=!1,Gl={},lk=!1,sg="undefined"!==typeof globalThis?globalThis:"undefined"!==
typeof self?self:global,Wf={},Vm=!1,Wb={},Bd=!1,Lc={},ze=!1,id="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Wg={},pk=!1,Cm={},Sm=!1,Vo={},ao=!1,to={},qk=!1,om={},Tm=!1,uf="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,pm={},bo=!1,Tj="undefined"!==typeof self?self:global,em={},qm=!1,ge="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,rk={},fl=!1,Um=function(){function Ca(rd,pd){"object"===typeof rd&&
(pd=rd,rd=void 0);pd=pd||{};rd=sb(rd);var oc=rd.source,lc=rd.id,Qc=rd.path;Qc=yc[lc]&&Qc in yc[lc].nsps;pd.forceNew||pd["force new connection"]||!1===pd.multiplex||Qc?(Gb("ignoring socket cache for %s",oc),oc=vb(oc,pd)):(yc[lc]||(Gb("new io instance for %s",oc),yc[lc]=vb(oc,pd)),oc=yc[lc]);rd.query&&!pd.query&&(pd.query=rd.query);return oc.socket(rd.path,pd)}if(fl)return rk;fl=!0;var sb=Ud(),Cb=nc(),vb=Ra(),Gb=fe()("socket.io-client");rk=rk=Ca;var yc=rk.managers={};rk.protocol=Cb.protocol;rk.connect=
Ca;rk.Manager=Ra();rk.Socket=ea();return rk}(),Eg=lively.FreezerRuntime.recorderFor("lively.2lively/client.js");Eg.determineLocation=function(){return"undefined"!==typeof document&&document.location?document.location.origin:Eg.isNode?System._nodeRequire("os").hostname():System.baseURL};Eg.promise=Tb;Eg.fun=he;Eg.obj=gd;Eg.events=Zd;Eg.num=kd;Eg.L2LConnection=Nb;Eg.defaultActions=ic;Eg.defaultClientActions=Wa;Eg.isNode="undefined"!==typeof System?System.get("@system-env").node:"undefined"!==typeof process&&
process.env;Eg._ioClient=Um;Eg.ioClient=Eg.ioClient||void 0;Eg.isNode?(Eg.require=System._nodeRequire("module")._load,Eg.ioClient=Eg.require("socket.io-client")):Eg.ioClient=Eg._ioClient;Eg.urlHelper={isRoot:function(Ca){return"/"===Eg.urlHelper.path(Ca)},root:function(Ca){return Eg.urlHelper.isRoot(Ca)?Ca:Ca.slice(0,-Eg.urlHelper.path(Ca).length)+"/"},path:function(){var Ca=/^[a-z0-9-_\.]+:/,sb=/^\/\/[^\/]+/;return function(Cb){Cb=Cb.replace(Ca,"").replace(sb,"");return""===Cb?"/":Cb}}(),join:function(Ca,
sb){Ca.endsWith("/")&&(Ca=Ca.slice(0,-1));sb.startsWith("/")&&(sb=sb.slice(1));return Ca+"/"+sb}};var Ni=function(Ca,sb,Cb,vb){var Gb=Eg.L2LConnection.call(this)||this;Eg.events.makeEmitter(Gb);Gb.info=vb;Gb.origin=Ca;Gb.path=sb;Gb.namespace=Cb.replace(/^\/?/,"/");Gb.trackerId=null;Gb._socketioClient=null;Gb._reconnectState={closed:!1,autoReconnect:!0,isReconnecting:!1,isReconnectingViaSocketio:!1,registerAttempt:0,registerProcess:null,isOpening:!1};Object.keys(Eg.defaultActions).forEach(function(yc){return Gb.addService(yc,
Eg.defaultActions[yc])});Object.keys(Eg.defaultClientActions).forEach(function(yc){return Gb.addService(yc,Eg.defaultClientActions[yc])});return Gb};$jscomp.inherits(Ni,Eg.L2LConnection);Ni.clientKey=function(Ca,sb,Cb){Ca=Ca.replace(/\/$/,"");sb=sb.replace(/^\//,"");Cb=Cb.replace(/^\//,"");return Ca+"-"+sb+"-"+Cb};Ni.forLivelyInBrowser=function(Ca){var sb=!!Ca;Ca=Object.assign({type:"lively.morphic browser"},Ca);var Cb=this.default();if(!Cb)return Eg.L2LClient.ensure({url:document.location.origin+
"/lively-socket.io",namespace:"l2l",info:Ca});sb&&!Eg.obj.equals(Cb.info,Ca)&&Cb.isRegistered()&&(Cb.info=Ca,Cb.unregister().then(function(){return Cb.register()}).catch(function(vb){return console.error("l2l re-register on info change errored: "+vb)}));return Cb};Ni.default=function(){var Ca=Eg.L2LClient.clients.keys().next().value;return Eg.L2LClient.clients.get(Ca)};Ni.create=function(Ca){var sb=Ca=void 0===Ca?{}:Ca;Ca=void 0===sb.debug?!1:sb.debug;var Cb=sb.url,vb=sb.namespace,Gb=void 0===sb.autoOpen?
!0:sb.autoOpen;sb=void 0===sb.info?{}:sb.info;if(!Cb)throw Error("L2LClient needs server url!");var yc=Eg.urlHelper.root(Cb).replace(/\/+$/,"");Cb=Eg.urlHelper.path(Cb);vb=new this(yc,Cb,vb||"",sb);Gb&&vb.register();vb.debug=Ca;return vb};Ni.ensure=function(Ca){var sb=Ca=void 0===Ca?{}:Ca,Cb=sb.url;sb=sb.namespace;if(!Cb)throw Error("L2LClient needs server url!");var vb=Eg.urlHelper.root(Cb).replace(/\/+$/,""),Gb=Eg.urlHelper.path(Cb);vb=this.clientKey(vb,Gb,sb||"");(Gb=this.clients.get(vb))||this.clients.set(vb,
Gb=this.create(Object.assign({},Ca,{url:Cb,namespace:sb})));return Gb};Ni.prototype.isOnline=function(){return this.socket&&this.socket.connected};Ni.prototype.isRegistered=function(){return this.isOnline()&&!!this.trackerId};Ni.prototype.open=function(){var Ca=this,sb,Cb,vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gb){if(1==Gb.nextAddress)return Ca.isOnline()||Ca._reconnectState.isOpening?Gb.return(Ca):Gb.yield(Ca.close(),2);Ca._reconnectState.closed=!1;sb=Eg.urlHelper.join(Ca.origin,
Ca.namespace);Cb={path:Ca.path,transports:["websocket","polling"]};vb=Ca._socketioClient=Eg.ioClient(sb,Cb);Ca.debug&&console.log("["+Ca+"] connecting");vb.on("error",function(yc){Ca._reconnectState.isOpening=!1;Ca.debug&&console.log("["+Ca+"] errored: "+yc)});vb.on("close",function(yc){return Ca.debug&&console.log("["+Ca+"] closed: "+yc)});vb.on("reconnect_failed",function(){return Ca.debug&&console.log("["+Ca+"] could not reconnect")});vb.on("reconnect_error",function(yc){return Ca.debug&&console.log("["+
Ca+"] reconnect error "+yc)});vb.on("connect",function(){Ca.debug&&console.log("["+Ca+"] connected");Ca.emit("connected",Ca);Ca._reconnectState.isOpening=!1;Ca._reconnectState.isReconnecting=!1;Ca._reconnectState.isReconnectingViaSocketio=!1});vb.on("disconnect",function(){Ca._reconnectState.isOpening=!1;Ca.debug&&console.log("["+Ca+"] disconnected");Ca.emit("disconnected",Ca);Ca.trackerId?("tracker"!==Ca.trackerId&&(Ca.renameTarget(Ca.trackerId,"tracker"),Ca.trackerId=null),Ca._reconnectState.closed?
Ca.debug&&console.log("["+Ca+"] won't reconnect b/c client is marked as closed"):Ca._reconnectState.autoReconnect?(Ca._reconnectState.isReconnecting=!0,setTimeout(function(){Ca._reconnectState.closed?Ca.debug&&console.log("["+Ca+"] won't reconnect b/c client is marked as closed 2"):Ca._reconnectState.isReconnectingViaSocketio?Ca.debug&&console.log("["+Ca+"] won't reconnect again, client already reconnecting"):(Ca.debug&&console.log("["+Ca+"] initiating reconnection to tracker"),Ca.register())},20)):
Ca.debug&&console.log("["+Ca+"] won't reconnect b/c client has reconnection disabled")):(Ca.debug&&console.log("["+Ca+"] disconnect: don't have a tracker id, won't try reconnect"),Ca.trackerId="tracker")});vb.on("reconnecting",function(){Ca.debug&&console.log("["+Ca+"] reconnecting",Ca._reconnectState);Ca.emit("reconnecting",Ca);Ca._reconnectState.closed?(Ca._reconnectState.isReconnecting=!1,Ca._reconnectState.isReconnectingViaSocketio=!1,vb.close(),Ca.close()):(Ca._reconnectState.isReconnecting=
!0,Ca._reconnectState.isReconnectingViaSocketio=!0)});vb.on("reconnect",function(){Ca.debug&&console.log("["+Ca+"] reconnected");Ca._reconnectState.isReconnecting=!1;Ca._reconnectState.isReconnectingViaSocketio=!1;Ca.register()});Ca.installEventToMessageTranslator(vb);Ca._reconnectState.isOpening=!0;return Gb.return((new Promise(function(yc,rd){vb.once("error",rd);vb.once("connect",yc)})).then(function(){return Ca}))})};Ni.prototype.close=function(){var Ca=this,sb,Cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){if(1==
vb.nextAddress){Ca._reconnectState.closed=!0;if(sb=Ca.socket)sb.removeAllListeners("reconnect"),sb.removeAllListeners("reconnecting"),sb.removeAllListeners("disconnect"),sb.removeAllListeners("connect"),sb.removeAllListeners("reconnect_error"),sb.removeAllListeners("reconnect_failed"),sb.removeAllListeners("close"),sb.removeAllListeners("error"),sb.close();Ca.debug&&console.log("["+Ca+"] closing...");return Ca.isRegistered()?vb.yield(Ca.unregister(),2):vb.jumpTo(2)}return Ca.isOnline()||Ca.socket?
sb&&!sb.connected?(Ca.debug&&console.log("["+Ca+"] socket not connected, considering client closed"),vb.return(Ca)):vb.return(Promise.race([Eg.promise.delay(2E3).then(function(){return sb.removeAllListeners("disconnect")}),new Promise(function(Gb){return sb.once("disconnect",Gb)})]).then(function(){Ca.debug&&console.log("["+Ca+"] closed");return Ca})):(Ca.debug&&(Cb=Ca.isOnline()?"no socket":"not online",Ca.debug&&console.log("["+Ca+"] cannot close: "+Cb)),vb.return(Ca))})};Ni.prototype.remove=function(){var Ca=
this.constructor.clientKey(this.origin,this.path,this.namespace);this.constructor.clients.delete(Ca);return this.close()};Ni.prototype.register=function(){var Ca=this,sb,Cb,vb,Gb,yc,rd,pd,oc,lc,Qc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wb){switch(wb.nextAddress){case 1:if(Ca.isRegistered())return wb.return();if(Ca._reconnectState.closed)return Ca.debug&&console.log("["+Ca+"] not registering this b/c closed"),Ca._reconnectState.registerAttempt=0,wb.return();if(Ca._reconnectState.registerProcess)return Ca.debug&&
console.log("["+Ca+"] not registering this b/c register process exists"),wb.return();wb.setCatchFinallyBlocks(2);if(Ca.isOnline()){wb.jumpTo(4);break}return wb.yield(Ca.open(),4);case 4:return Ca.debug&&console.log("["+Ca+"] register"),wb.yield(Ca.sendToAndWait("tracker","register",Object.assign({userName:"unknown",type:"l2l "+(Eg.isNode?"node":"browser"),location:Eg.determineLocation()},Ca.info)),6);case 6:sb=wb.yieldResult;if(!sb.data)throw Cb=Error("Register answer is empty!"),Ca.emit("error",
Cb),Cb;if(sb.data.isError)throw vb=Error(sb.data.error),Ca.emit("error",vb),vb;Ca._reconnectState.registerAttempt=0;Gb=sb;yc=Gb.data;rd=yc.trackerId;pd=yc.messageNumber;Ca.trackerId=rd;Ca._incomingOrderNumberingBySenders.set(rd,pd||0);Ca.emit("registered",{trackerId:rd});wb.leaveTryBlock(0);break;case 2:oc=wb.enterCatchBlock(),console.error("Error in register request of "+Ca+": "+oc),lc=Ca._reconnectState.registerAttempt++,Qc=Eg.num.backoff(lc,4,3E5),Ca._reconnectState.registerProcess=setTimeout(function(){Ca._reconnectState.registerProcess=
null;Ca.register()},Qc),wb.jumpToEnd()}})};Ni.prototype.unregister=function(){var Ca=this,sb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Cb){switch(Cb.nextAddress){case 1:if(!Ca.isRegistered())return Cb.return();Ca.debug&&console.log("["+Ca+"] unregister");sb=Ca.trackerId;Cb.setCatchFinallyBlocks(2);return Cb.yield(Ca.sendToAndWait(Ca.trackerId,"unregister",{}),4);case 4:Cb.leaveTryBlock(3);break;case 2:Cb.enterCatchBlock();case 3:Ca.renameTarget(sb,"tracker"),Ca.trackerId=null,Ca.emit("unregistered",
Ca),Cb.jumpToEnd()}})};Ni.prototype.whenRegistered=function(Ca){var sb=this;return Eg.promise.waitFor(Ca,function(){return sb.isRegistered()}).catch(function(Cb){return Promise.reject(/timeout/i.test(String(Cb))?Error("Timeout in "+sb+".whenRegistered"):Cb)})};Ni.prototype.send=function(Ca,sb){var Cb=this,vb=$jscomp.makeIterator(this.prepareSend(Ca,sb));Ca=vb.next().value;sb=vb.next().value;this.whenOnline().then(function(){var Gb=Cb.socket,yc=Ca,rd=yc.action;yc=yc.target;if(!Gb)throw Error("Trying to send message "+
rd+" to "+yc+" but cannot find a connection to it!");"function"===typeof sb?Gb.emit(rd,Ca,sb):Gb.emit(rd,Ca)})};Ni.prototype.joinRoom=function(Ca){var sb=this;return this.whenOnline().then(function(){return sb.sendToAndWait(sb.trackerId,"[broadcast] join room",{room:Ca})})};Ni.prototype.leaveRoom=function(Ca){var sb=this;return this.whenOnline().then(function(){return sb.sendToAndWait(sb.trackerId,"[broadcast] leave room",{room:Ca})})};Ni.prototype.broadcast=function(Ca,sb,Cb,vb,Gb){var yc=this,rd=
{action:sb,room:Ca,broadcast:Cb};if(void 0===vb?0:vb)rd.isSystemBroadcast=!0;if(void 0===Gb?0:Gb)rd.isMultiServerBroadcast=!0;return this.whenOnline().then(function(){return yc.sendToAndWait(yc.trackerId,"[broadcast] send",rd)})};Ni.prototype.listRoomMembers=function(Ca){var sb=this,Cb,vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gb){if(1==Gb.nextAddress)return Gb.yield(sb.sendToAndWait(sb.trackerId,"[broadcast] list room members",{room:Ca}),2);Cb=Gb.yieldResult;vb=Cb.data;return Gb.return(vb)})};
Ni.prototype.joinedRooms=function(){var Ca=this,sb,Cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){if(1==vb.nextAddress)return vb.yield(Ca.sendToAndWait(Ca.trackerId,"[broadcast] my rooms",{}),2);sb=vb.yieldResult;Cb=sb.data;return vb.return(Cb)})};Ni.prototype.listRooms=function(){var Ca=this,sb,Cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){if(1==vb.nextAddress)return vb.yield(Ca.sendToAndWait(Ca.trackerId,"[broadcast] all rooms",{}),2);sb=vb.yieldResult;Cb=
sb.data;return vb.return(Cb)})};Ni.prototype.listPeers=function(Ca){Ca=void 0===Ca?!1:Ca;var sb=this,Cb,vb,Gb,yc,rd,pd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(oc){if(1==oc.nextAddress)return Cb=sb,vb=Cb._peersCached,Gb=Date.now(),!Ca&&vb&&1E3>Gb-vb.timestamp?oc.return(sb._peersCached.sessions):sb.isOnline()?oc.yield(sb.sendToAndWait(sb.trackerId,"getClients",{}),2):oc.return([]);yc=oc.yieldResult;rd=yc.data;pd=rd.map(function(lc){var Qc=$jscomp.makeIterator(lc);lc=Qc.next().value;
var wb=Qc.next().value,jd=wb.info||{};Qc=jd.userRealm;var ne=jd.userToken,bf=jd.l2lUserToken,ee=jd.location,Re=jd.type;jd=jd.world;lc=Object.assign({},Eg.obj.dissoc(wb,["info"]),{id:lc,world:jd,location:ee,type:Re});(ne=ne||bf)&&"null"!==ne&&(lively.user?lc.user=lively.user.ClientUser.fromToken(ne,Qc):(lc.userToken=ne,lc.userRealm=Qc));return lc});sb._peersCached={timestamp:Gb,sessions:pd};return oc.return(pd)})};Ni.prototype.toString=function(){var Ca=this.origin,sb=this.path,Cb=this.namespace,vb=
this.id,Gb=this.isOnline()?this.isRegistered()?"registered":"unregistered":"disconnected";return"L2LClient("+(vb||"").slice(0,5)+" "+Ca+sb+" - "+Cb+" "+Gb+")"};$jscomp.global.Object.defineProperties(Ni.prototype,{socket:{configurable:!0,enumerable:!0,get:function(){return this._socketioClient}},socketId:{configurable:!0,enumerable:!0,get:function(){return this.socket?this.socket.id:null}}});$jscomp.global.Object.defineProperties(Ni,{clients:{configurable:!0,enumerable:!0,get:function(){return this._clients||
(this._clients=new Map)}}});Da("default",Ni);Eg.L2LClient=Ni;Eg.default=Ni}}});