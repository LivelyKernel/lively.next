System.register(["./__root_module__-5a58cfed.js","kld-intersections","./client-command-4ab15d59.js"],function(Ca){var Cb,Vb,lc,gc,fe,fd;return{setters:[function(Zd){Cb=Zd.s;Vb=Zd._;lc=Zd.a4;gc=Zd.bD;fe=Zd.a5},function(){},function(Zd){fd=Zd.runCommand}],execute:function(){function Zd(cb,Fb){var vc,pc,sd,pd,tc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(bd){if(1==bd.nextAddress)return vc=Nd.fileInfoCommandString(cb,Fb),pc=Nd.runCommand(vc,Fb),bd.yield(pc.whenDone(),2);if(sd=0!=
pc.exitCode?pc.output:null)throw sd;pd=$jscomp.makeIterator(Nd.parseDirectoryListFromLs(pc.stdout,Fb.rootDirectory||"."));tc=pd.next().value;return bd.return(tc)})}function id(cb,Fb){return Nd.string.lines(cb).map(function(vc){return vc.trim().length?(new Nd.FileInfo(Fb)).readFromDirectoryListLine(vc):null}).filter(Boolean)}function Uc(cb,Fb){var vc,pc,sd,pd,tc,bd,Xb,Tb,Oc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(td){vc=Object.assign({findFilesGroup:"default-find-files-process"},
Fb);pc=vc.findFilesGroup;sd=vc.rootDirectory;tc=pd=Nd.findFilesProcesses[pc]||(Nd.findFilesProcesses[pc]={promiseState:null,commands:[]});bd=tc.commands;Xb=tc.promiseState;Xb||(pd.promiseState=Xb=Nd.promise.deferred());Tb=Nd.findFilesCommandString(cb,Fb);bd.forEach(function(Ob){return Ob.kill()});Oc=Nd.runCommand(Tb,Fb);bd.push(Oc);Oc.whenDone().then(function(){Nd.arr.remove(bd,Oc);if(bd.some(function(sb){return sb.startTime>Oc.startTime}))console.log("[findFiles] command "+Oc+" exited but a newer findFiles command was started for group "+
pc+", discarding output");else{var Ob=0!=Oc.exitCode?Oc.output:null;Ob&&console.warn(Ob);Ob=Ob?[]:Nd.parseDirectoryListFromLs(Oc.stdout,sd)||[];Xb.resolve(Ob);Object.assign(pd,{promiseState:null,commands:[]})}}).catch(function(Ob){return console.error(Ob)});return td.return(Xb.promise)})}function Ad(cb){function Fb(vc){return Array.prototype.concat.apply([vc],vc.children?vc.children.map(Fb):[])}return Fb(cb).map(function(vc){var pc=vc.fullPath.replace(/^\//,"");return{fileName:pc,path:pc,rootDirectory:"./",
isDirectory:vc.isDirectory,isLink:void 0,lastModified:void 0,linkCount:void 0,mode:void 0,size:void 0,group:void 0,user:void 0}})}var Nd=lively.FreezerRuntime.recorderFor("lively.shell/client-fs-helper.js");Nd.fileInfo=Zd;Nd.fileInfoCommandString=function(cb,Fb){var vc=Fb=void 0===Fb?{}:Fb;Fb=vc.rootDirectory;vc=vc.platform;Fb=Fb||".";var pc="win32"===vc?"\\":"/";"win32"===vc||Fb.endsWith(pc)||(Fb+=pc);return"win32"===vc?"cd "+Fb+' && ls -lLd --time-style=locale "'+cb+'"':'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && env TZ=GMT LANG=en_US.UTF-8 cd '+
(Fb+' && ls -lLd "$timeformat" "'+cb+'"')};Nd.parseDirectoryListFromLs=id;Nd.findFiles=Uc;Nd.findFilesCommandString=function(cb,Fb){var vc=Fb=void 0===Fb?{}:Fb,pc=vc.rootDirectory,sd=vc.exclude,pd=vc.depth;vc=vc.platform;pc=pc||".";sd=sd||"-iname "+Nd.defaultExcludes.map(Nd.string.print).join(" -o -iname ");var tc="win32"===vc?"\\":"/";"win32"===vc||pc.endsWith(tc)||(pc+=tc);cb=Nd.string.format('%s "%s"',Fb.re?"-iregex":Fb.matchPath?"-ipath":"-iname",cb);pd="number"===typeof pd?" -maxdepth "+pd:"";
return"win32"===vc?Nd.string.format("find %s %s ( %s ) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd --time-style=locale {}",pc,Fb.re?"-E ":"",sd.replace(/"/g,""),cb.replace(/"/g,""),pd):'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && '+Nd.string.format('env TZ=GMT LANG=en_US.UTF-8 find %s %s \\( %s \\) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd "$timeformat" "{}"',pc,Fb.re?"-E ":"",sd,cb,pd)};Nd.convertDirectoryUploadEntriesToFileInfos=
Ad;Nd.runCommand=fd;Nd.string=Cb;Nd.promise=Vb;Nd.arr=lc;Nd.fileInfo=Zd;Nd.fileInfo=Zd;Nd.parseDirectoryListFromLs=id;Nd.parseDirectoryListFromLs=id;var ee=function(cb){this.rootDirectory=cb;this.fileName=this.path="";this.isDirectory=!1;this.lastModified=null;this.mode="";this.isLink=!1;this.linkCount=0;this.group=this.user="";this.size=0;this.rootDirectory=null};ee.prototype.readFromDirectoryListLine=function(cb){var Fb=this;if(!cb.trim().length)return null;var vc=cb;this.reader.forEach(function(pc){return vc=
pc(vc,Fb)});return this};ee.prototype.toString=function(){return this.path};$jscomp.global.Object.defineProperties(ee.prototype,{reader:{configurable:!0,enumerable:!0,get:function(){return[function(cb,Fb){var vc=cb.indexOf(" ");Fb.mode=cb.slice(0,vc);Fb.isDirectory="d"===Fb.mode[0];return cb.slice(vc+1).trim()},function(cb,Fb){var vc=cb.indexOf(" ");Fb.linkCount=Number(cb.slice(0,vc));return cb.slice(vc+1).trim()},function(cb,Fb){var vc=cb.indexOf(" ");Fb.user=cb.slice(0,vc);return cb.slice(vc+1).trim()},
function(cb,Fb){var vc=Nd.string.peekRight(cb,0,/\s+[0-9]/);Fb.group=cb.slice(0,vc).trim();return cb.slice(vc).trim()},function(cb,Fb){var vc=cb.indexOf(" ");Fb.size=Number(cb.slice(0,vc));return cb.slice(vc+1).trim()},function(cb,Fb){var vc=Nd.string.reMatches(cb,/[^s]+\s+[0-9:\s]+/);if(!vc||!vc[0])return cb;Fb.lastModified=new Date(vc[0].match+" GMT");return cb.slice(vc[0].end).trim()},function(cb,Fb){var vc=(cb=cb.replace(/^\.\/+/g,"").replace(/\/\//g,"/"))&&cb.split(" -> "),pc=""===cb?!1:cb&&
2===vc.length,sd=(vc=pc?vc[0]:cb)&&0===vc.indexOf(Fb.rootDirectory)?vc.slice(Fb.rootDirectory.length):vc;Fb.fileName=""===cb?".":sd;Fb.path=vc;Fb.isLink=pc;return sd}]}}});Nd.FileInfo=ee;Nd.findFilesProcesses={};Nd.findFiles=Uc;Nd.findFiles=Uc;Nd.defaultExcludes=[".svn",".git","node_modules",".module_cache"];Nd.convertDirectoryUploadEntriesToFileInfos=Ad;Nd.convertDirectoryUploadEntriesToFileInfos=Ad;var Ud=lively.FreezerRuntime.recorderFor("lively.shell/client-resource.js");Ud.Resource=gc;Ud.runCommand=
fd;Ud.fileInfo=Zd;Ud.findFiles=Uc;Ud.string=Cb;Ud.promise=Vb;Ud.arr=lc;Ud.obj=fe;ee=function(cb,Fb,vc){vc=void 0===vc?{}:vc;cb=Ud.Resource.call(this,cb)||this;cb.options=Object.assign({},vc,{l2lClient:Fb||cb.constructor.defaultL2lClient});return cb};$jscomp.inherits(ee,Ud.Resource);ee.prototype.newResource=function(cb){return new this.constructor(cb,this.options.l2lClient,this.options)};ee.prototype.read=function(){var cb=this,Fb=Ud.runCommand('cat "'+this.url+'"',this.options);return Fb.whenDone().then(function(){if(Fb.exitCode)throw Error("Read "+
cb.url+" failed: "+Fb.stderr);return Fb.output})};ee.prototype.write=function(cb){var Fb=this,vc,pc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sd){switch(sd.nextAddress){case 1:return cb?sd.yield(Ud.runCommand('touch "'+Fb.url+'" && tee "'+Fb.url+'"',Object.assign({stdin:String(cb)},Fb.options)).whenDone(),4):sd.yield(Ud.runCommand('echo -n > "'+Fb.url+'"',Object.assign({},Fb.options)).whenDone(),5);case 4:vc=sd.yieldResult;sd.jumpTo(3);break;case 5:vc=sd.yieldResult;case 3:pc=vc;
if(pc.exitCode)throw Error("Write "+Fb.url+" failed: "+pc.stderr);return sd.return(Fb)}})};ee.prototype.mkdir=function(){var cb=this,Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vc){if(1==vc.nextAddress)return vc.yield(Ud.runCommand('mkdir -p "'+cb.url+'"',cb.options).whenDone(),2);Fb=vc.yieldResult;if(Fb.exitCode)throw Error(cb+" cannot create directory: "+Fb.stderr);return vc.return(cb)})};ee.prototype.exists=function(){var cb=Ud.runCommand('test -d "'+this.url+'" || test -f "'+
this.url+'"',this.options);return cb.whenDone().then(function(){return 0===cb.exitCode})};ee.prototype.remove=function(){var cb=this,Fb=Ud.runCommand('rm -rf "'+this.url+'"',this.options);return Fb.whenDone().then(function(){if(Fb.exitCode)throw Error("Remove of "+cb.url+" failed: "+Fb.stderr);return cb})};ee.prototype.gzip=function(cb){var Fb=this,vc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pc){vc=Ud.runCommand('gzip > "'+Fb.url+'"',Object.assign({stdin:String(cb)},Fb.options));
return pc.return(vc.whenDone().then(function(){if(vc.exitCode)throw Error("Gzip compression of "+Fb.url+" failed: "+vc.stderr);return Fb}))})};ee.prototype.brotli=function(cb){var Fb=this,vc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pc){vc=Ud.runCommand('brotli > "'+Fb.url+'"',Object.assign({stdin:String(cb)},Fb.options));return pc.return(vc.whenDone().then(function(){if(vc.exitCode)throw Error("Brotli compression of "+Fb.url+" failed: "+vc.stderr);return Fb}))})};ee.prototype.readProperties=
function(){var cb=this,Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vc){if(1==vc.nextAddress)return vc.yield(Ud.fileInfo(cb.url,cb.options),2);Fb=vc.yieldResult;cb.assignProperties(Ud.obj.dissoc(Fb,["fileName","path","rootDirectory"]));return vc.return(cb)})};ee.prototype.dirList=function(cb,Fb){cb=void 0===cb?1:cb;Fb=void 0===Fb?{}:Fb;var vc=this,pc,sd,pd,tc,bd,Xb,Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Oc){if(1==Oc.nextAddress)return pc=Fb,sd=pc.exclude,
Array.isArray(sd)&&(sd="-iname "+sd.map(Ud.string.print).join(" -o -iname ")),pd=vc,tc=pd.url,bd=pd.options,Xb=bd.l2lClient,Oc.yield(Ud.findFiles("*",{exclude:sd,depth:cb,rootDirectory:tc,l2lClient:Xb}),2);Tb=Oc.yieldResult;Tb[0].path.replace(/\/$/,"")===vc.url.replace(/\/$/,"")&&Tb.shift();return Oc.return(Tb.map(function(td){var Ob=td.path;td.isDirectory&&(Ob=Ob.replace(/\/?$/,"/"));Ob=new vc.constructor(Ob,Xb,vc.options);Ob.assignProperties(Ud.obj.dissoc(td,["fileName","path","rootDirectory"]));
return Ob}))})};$jscomp.global.Object.defineProperties(ee,{defaultL2lClient:{configurable:!0,enumerable:!0,get:function(){return this._defaultL2lClient||Ud._defaultL2LClient},set:function(cb){this._defaultL2lClient=Ud._defaultL2LClient=cb}}});Ca("default",ee);Ud.ShellClientResource=ee;Ud._defaultL2LClient=Ud._defaultL2LClient||void 0;var kd=Ca("resourceExtension",{name:"shell-client",matches:function(cb){return cb.startsWith("/")||cb.match(/[a-z]:\\/i)},resourceClass:Ud.ShellClientResource});Ud.resourceExtension=
kd;Ud.resourceExtension=kd;Ud.resourceExtension=kd;Ud.default=ee}}});