System.register(["./__root_module__-aa47e4cd.js","kld-intersections"],function(Ca){var ub,Tb,lc,mc,Zd,id,ce,kd;return{setters:[function($c){ub=$c.s;Tb=$c._;lc=$c.bj;mc=$c.bk;Zd=$c.ar;id=$c.a5;ce=$c.bl;kd=$c.an},function(){}],execute:function(){function $c(){function Ja(nb,Eb){var Fc={};Eb.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(ud,rd,rc){rd&&(Fc[rd]=rc)});return Fc}if(Aa)return Qa;Aa=!0;var pb=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
Gb="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");return Qa=function(nb){var Eb=nb,Fc=nb.indexOf("["),ud=nb.indexOf("]");-1!=Fc&&-1!=ud&&(nb=nb.substring(0,Fc)+nb.substring(Fc,ud).replace(/:/g,";")+nb.substring(ud,nb.length));var rd=pb.exec(nb||"");nb={};for(var rc=14;rc--;)nb[Gb[rc]]=rd[rc]||"";-1!=Fc&&-1!=ud&&(nb.source=Eb,nb.host=nb.host.substring(1,nb.host.length-1).replace(/;/g,":"),nb.authority=nb.authority.replace("[","").replace("]",
"").replace(/;/g,":"),nb.ipv6uri=!0);Eb=nb.path;Fc=Eb.replace(/\/{2,9}/g,"/").split("/");"/"!=Eb.substr(0,1)&&0!==Eb.length||Fc.splice(0,1);"/"==Eb.substr(Eb.length-1,1)&&Fc.splice(Fc.length-1,1);nb.pathNames=Fc;nb.queryKey=Ja(nb,nb.query);return nb}}function Cd(){function Ja(Eb){Eb=String(Eb);if(!(100<Eb.length)&&(Eb=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(Eb))){var Fc=parseFloat(Eb[1]);switch((Eb[2]||"ms").toLowerCase()){case "years":case "year":case "yrs":case "yr":case "y":return Fc*
nb;case "days":case "day":case "d":return Fc*Gb;case "hours":case "hour":case "hrs":case "hr":case "h":return 36E5*Fc;case "minutes":case "minute":case "mins":case "min":case "m":return 6E4*Fc;case "seconds":case "second":case "secs":case "sec":case "s":return 1E3*Fc;case "milliseconds":case "millisecond":case "msecs":case "msec":case "ms":return Fc}}}function pb(Eb,Fc,ud){if(!(Eb<Fc))return Eb<1.5*Fc?Math.floor(Eb/Fc)+" "+ud:Math.ceil(Eb/Fc)+" "+ud+"s"}if(Ka)return za;Ka=!0;var Gb=864E5,nb=365.25*
Gb;return za=function(Eb,Fc){Fc=Fc||{};var ud=typeof Eb;if("string"===ud&&0<Eb.length)return Ja(Eb);if("number"===ud&&!1===isNaN(Eb))return Fc.long?pb(Eb,Gb,"day")||pb(Eb,36E5,"hour")||pb(Eb,6E4,"minute")||pb(Eb,1E3,"second")||Eb+" ms":Eb>=Gb?Math.round(Eb/Gb)+"d":36E5<=Eb?Math.round(Eb/36E5)+"h":6E4<=Eb?Math.round(Eb/6E4)+"m":1E3<=Eb?Math.round(Eb/1E3)+"s":Eb+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(Eb));}}function Fd(){function Ja(nb){var Eb=0,Fc;for(Fc in nb)Eb=
(Eb<<5)-Eb+nb.charCodeAt(Fc),Eb|=0;return tb.colors[Math.abs(Eb)%tb.colors.length]}function pb(nb){function Eb(){if(Eb.enabled){var ud=+new Date;Eb.diff=ud-(Fc||ud);Eb.prev=Fc;Fc=Eb.curr=ud;var rd=Array(arguments.length);for(ud=0;ud<rd.length;ud++)rd[ud]=arguments[ud];rd[0]=tb.coerce(rd[0]);"string"!==typeof rd[0]&&rd.unshift("%O");var rc=0;rd[0]=rd[0].replace(/%([a-zA-Z%])/g,function(ic,Tc){if("%%"===ic)return ic;rc++;Tc=tb.formatters[Tc];"function"===typeof Tc&&(ic=Tc.call(Eb,rd[rc]),rd.splice(rc,
1),rc--);return ic});tb.formatArgs.call(Eb,rd);(Eb.log||tb.log||console.log.bind(console)).apply(Eb,rd)}}var Fc;Eb.namespace=nb;Eb.enabled=tb.enabled(nb);Eb.useColors=tb.useColors();Eb.color=Ja(nb);Eb.destroy=Gb;"function"===typeof tb.init&&tb.init(Eb);tb.instances.push(Eb);return Eb}function Gb(){var nb=tb.instances.indexOf(this||zc);return-1!==nb?(tb.instances.splice(nb,1),!0):!1}if(yb)return tb;yb=!0;tb=tb=pb.debug=pb["default"]=pb;tb.coerce=function(nb){return nb instanceof Error?nb.stack||nb.message:
nb};tb.disable=function(){tb.enable("")};tb.enable=function(nb){tb.save(nb);tb.names=[];tb.skips=[];var Eb,Fc=("string"===typeof nb?nb:"").split(/[\s,]+/),ud=Fc.length;for(Eb=0;Eb<ud;Eb++)Fc[Eb]&&(nb=Fc[Eb].replace(/\*/g,".*?"),"-"===nb[0]?tb.skips.push(new RegExp("^"+nb.substr(1)+"$")):tb.names.push(new RegExp("^"+nb+"$")));for(Eb=0;Eb<tb.instances.length;Eb++)nb=tb.instances[Eb],nb.enabled=tb.enabled(nb.namespace)};tb.enabled=function(nb){if("*"===nb[nb.length-1])return!0;var Eb;var Fc=0;for(Eb=
tb.skips.length;Fc<Eb;Fc++)if(tb.skips[Fc].test(nb))return!1;Fc=0;for(Eb=tb.names.length;Fc<Eb;Fc++)if(tb.names[Fc].test(nb))return!0;return!1};tb.humanize=Cd();tb.instances=[];tb.names=[];tb.skips=[];tb.formatters={};return tb}function pe(){function Ja(){try{var Eb=pd.storage.debug}catch(Fc){}!Eb&&"undefined"!==typeof pb&&"env"in pb&&(Eb=pb.env.DEBUG);return Eb}if(Yd)return pd;Yd=!0;var pb=lc;pd=pd=Fd();pd.log=function(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,
console,arguments)};pd.formatArgs=function(Eb){var Fc=(this||Ge).useColors;Eb[0]=(Fc?"%c":"")+(this||Ge).namespace+(Fc?" %c":" ")+Eb[0]+(Fc?"%c ":" ")+"+"+pd.humanize((this||Ge).diff);if(Fc){Fc="color: "+(this||Ge).color;Eb.splice(1,0,Fc,"color: inherit");var ud=0,rd=0;Eb[0].replace(/%[a-zA-Z%]/g,function(rc){"%%"!==rc&&(ud++,"%c"===rc&&(rd=ud))});Eb.splice(rd,0,Fc)}};pd.save=function(Eb){try{null==Eb?pd.storage.removeItem("debug"):pd.storage.debug=Eb}catch(Fc){}};pd.load=Ja;pd.useColors=function(){return"undefined"!==
typeof window&&window.process&&"renderer"===window.process.type?!0:"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:"undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&
31<=parseInt(RegExp.$1,10)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)};var Gb=pd;if("undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage)var nb=chrome.storage.local;else a:{try{nb=window.localStorage;break a}catch(Eb){}nb=void 0}Gb.storage=nb;pd.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" ");
pd.formatters.j=function(Eb){try{return JSON.stringify(Eb)}catch(Fc){return"[UnexpectedJSONParseError]: "+Fc.message}};pd.enable(Ja());return pd}function Xd(){if(ye)return Sc;ye=!0;var Ja=$c(),pb=pe()("socket.io-client:url");return Sc=function(Gb,nb){var Eb=Gb;nb=nb||"undefined"!==typeof location&&location;null==Gb&&(Gb=nb.protocol+"//"+nb.host);"string"===typeof Gb&&("/"===Gb.charAt(0)&&(Gb="/"===Gb.charAt(1)?nb.protocol+Gb:nb.host+Gb),/^(https?|wss?):\/\//.test(Gb)||(pb("protocol-less url %s",Gb),
Gb="undefined"!==typeof nb?nb.protocol+"//"+Gb:"https://"+Gb),pb("parse %s",Gb),Eb=Ja(Gb));Eb.port||(/^(http|ws)$/.test(Eb.protocol)?Eb.port="80":/^(http|ws)s$/.test(Eb.protocol)&&(Eb.port="443"));Eb.path=Eb.path||"/";Gb=-1!==Eb.host.indexOf(":")?"["+Eb.host+"]":Eb.host;Eb.id=Eb.protocol+"://"+Gb+":"+Eb.port;Eb.href=Eb.protocol+"://"+Gb+(nb&&nb.port===Eb.port?"":":"+Eb.port);return Eb}}function nd(){function Ja(pb){if(pb){for(var Gb in Ja.prototype)pb[Gb]=Ja.prototype[Gb];return pb}}if(Sb)return Gd;
Sb=!0;Gd=Ja;Ja.prototype.on=Ja.prototype.addEventListener=function(pb,Gb){(this||oa)._callbacks=(this||oa)._callbacks||{};((this||oa)._callbacks["$"+pb]=(this||oa)._callbacks["$"+pb]||[]).push(Gb);return this||oa};Ja.prototype.once=function(pb,Gb){function nb(){this.off(pb,nb);Gb.apply(this||oa,arguments)}nb.fn=Gb;this.on(pb,nb);return this||oa};Ja.prototype.off=Ja.prototype.removeListener=Ja.prototype.removeAllListeners=Ja.prototype.removeEventListener=function(pb,Gb){(this||oa)._callbacks=(this||
oa)._callbacks||{};if(0==arguments.length)return(this||oa)._callbacks={},this||oa;var nb=(this||oa)._callbacks["$"+pb];if(!nb)return this||oa;if(1==arguments.length)return delete (this||oa)._callbacks["$"+pb],this||oa;for(var Eb,Fc=0;Fc<nb.length;Fc++)if(Eb=nb[Fc],Eb===Gb||Eb.fn===Gb){nb.splice(Fc,1);break}0===nb.length&&delete (this||oa)._callbacks["$"+pb];return this||oa};Ja.prototype.emit=function(pb){(this||oa)._callbacks=(this||oa)._callbacks||{};for(var Gb=Array(arguments.length-1),nb=(this||
oa)._callbacks["$"+pb],Eb=1;Eb<arguments.length;Eb++)Gb[Eb-1]=arguments[Eb];if(nb){nb=nb.slice(0);Eb=0;for(var Fc=nb.length;Eb<Fc;++Eb)nb[Eb].apply(this||oa,Gb)}return this||oa};Ja.prototype.listeners=function(pb){(this||oa)._callbacks=(this||oa)._callbacks||{};return(this||oa)._callbacks["$"+pb]||[]};Ja.prototype.hasListeners=function(pb){return!!this.listeners(pb).length};return Gd}function eb(){if(Kb)return Ha;Kb=!0;var Ja={}.toString;return Ha=Array.isArray||function(pb){return"[object Array]"==
Ja.call(pb)}}function Hb(){if(sa)return P;sa=!0;var Ja=mc.Buffer;P=function(nb){var Eb;!(Eb=pb&&Ja.isBuffer(nb))&&(Eb=Gb)&&((Eb=nb instanceof ArrayBuffer)||(Eb="function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(nb):nb.buffer instanceof ArrayBuffer));return Eb};var pb="function"===typeof Ja&&"function"===typeof Ja.isBuffer,Gb="function"===typeof ArrayBuffer;return P}function Cc(){function Ja(rd,rc){if(!rd)return rd;if(nb(rd)){var ic={_placeholder:!0,num:rc.length};rc.push(rd);return ic}if(Gb(rd)){ic=
Array(rd.length);for(var Tc=0;Tc<rd.length;Tc++)ic[Tc]=Ja(rd[Tc],rc);return ic}if("object"===typeof rd&&!(rd instanceof Date)){ic={};for(Tc in rd)ic[Tc]=Ja(rd[Tc],rc);return ic}return rd}function pb(rd,rc){if(!rd)return rd;if(rd&&rd._placeholder)return rc[rd.num];if(Gb(rd))for(var ic=0;ic<rd.length;ic++)rd[ic]=pb(rd[ic],rc);else if("object"===typeof rd)for(ic in rd)rd[ic]=pb(rd[ic],rc);return rd}if(Ib)return Ta;Ib=!0;var Gb=eb(),nb=Hb(),Eb=Object.prototype.toString,Fc="function"===typeof Blob||"undefined"!==
typeof Blob&&"[object BlobConstructor]"===Eb.call(Blob),ud="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===Eb.call(File);Ta.deconstructPacket=function(rd){var rc=[];rd.data=Ja(rd.data,rc);rd.attachments=rc.length;return{packet:rd,buffers:rc}};Ta.reconstructPacket=function(rd,rc){rd.data=pb(rd.data,rc);rd.attachments=void 0;return rd};Ta.removeBlobs=function(rd,rc){function ic(od,ne,Te){if(!od)return od;if(Fc&&od instanceof Blob||ud&&od instanceof File){Tc++;var ge=
new FileReader;ge.onload=function(){Te?Te[ne]=(this||Lc).result:vb=(this||Lc).result;--Tc||rc(vb)};ge.readAsArrayBuffer(od)}else if(Gb(od))for(ge=0;ge<od.length;ge++)ic(od[ge],ge,od);else if("object"===typeof od&&!nb(od))for(ge in od)ic(od[ge],ge,od)}var Tc=0,vb=rd;ic(vb);Tc||rc(vb)};return Ta}function qc(){function Ja(){}function pb(vb){var od=""+vb.type;if(Wc.BINARY_EVENT===vb.type||Wc.BINARY_ACK===vb.type)od+=vb.attachments+"-";vb.nsp&&"/"!==vb.nsp&&(od+=vb.nsp+",");null!=vb.id&&(od+=vb.id);if(null!=
vb.data){try{var ne=JSON.stringify(vb.data)}catch(Te){ne=!1}if(!1!==ne)od+=ne;else return Tc}Fc("encoded %j as %s",vb,od);return od}function Gb(vb,od){rd.removeBlobs(vb,function(ne){var Te=rd.deconstructPacket(ne);ne=pb(Te.packet);Te=Te.buffers;Te.unshift(ne);od(Te)})}function nb(){(this||ie).reconstructor=null}function Eb(vb){(this||ie).reconPack=vb;(this||ie).buffers=[]}if(he)return Wc;he=!0;var Fc=pe()("socket.io-parser"),ud=nd(),rd=Cc(),rc=eb(),ic=Hb();Wc.protocol=4;Wc.types="CONNECT DISCONNECT EVENT ACK ERROR BINARY_EVENT BINARY_ACK".split(" ");
Wc.CONNECT=0;Wc.DISCONNECT=1;Wc.EVENT=2;Wc.ACK=3;Wc.ERROR=4;Wc.BINARY_EVENT=5;Wc.BINARY_ACK=6;Wc.Encoder=Ja;Wc.Decoder=nb;var Tc=Wc.ERROR+'"encode error"';Ja.prototype.encode=function(vb,od){Fc("encoding packet %j",vb);Wc.BINARY_EVENT===vb.type||Wc.BINARY_ACK===vb.type?Gb(vb,od):(vb=pb(vb),od([vb]))};ud(nb.prototype);nb.prototype.add=function(vb){if("string"===typeof vb){a:{var od=0,ne={type:Number(vb.charAt(0))};if(null==Wc.types[ne.type])vb={type:Wc.ERROR,data:"parser error: unknown packet type "+
ne.type};else{if(Wc.BINARY_EVENT===ne.type||Wc.BINARY_ACK===ne.type){for(var Te="";"-"!==vb.charAt(++od)&&(Te+=vb.charAt(od),od!=vb.length););if(Te!=Number(Te)||"-"!==vb.charAt(od))throw Error("Illegal attachments");ne.attachments=Number(Te)}if("/"===vb.charAt(od+1))for(ne.nsp="";++od;){Te=vb.charAt(od);if(","===Te)break;ne.nsp+=Te;if(od===vb.length)break}else ne.nsp="/";Te=vb.charAt(od+1);if(""!==Te&&Number(Te)==Te){for(ne.id="";++od;){Te=vb.charAt(od);if(null==Te||Number(Te)!=Te){--od;break}ne.id+=
vb.charAt(od);if(od===vb.length)break}ne.id=Number(ne.id)}if(vb.charAt(++od)){od=vb.substr(od);try{var ge=JSON.parse(od)}catch(Qe){ge=!1}if(!1===ge||ne.type!==Wc.ERROR&&!rc(ge)){vb={type:Wc.ERROR,data:"parser error: invalid payload"};break a}else ne.data=ge}Fc("decoded %s as %j",vb,ne);vb=ne}}Wc.BINARY_EVENT===vb.type||Wc.BINARY_ACK===vb.type?((this||ie).reconstructor=new Eb(vb),0===(this||ie).reconstructor.reconPack.attachments&&this.emit("decoded",vb)):this.emit("decoded",vb)}else if(ic(vb)||vb.base64)if((this||
ie).reconstructor){if(vb=(this||ie).reconstructor.takeBinaryData(vb))(this||ie).reconstructor=null,this.emit("decoded",vb)}else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+vb);};nb.prototype.destroy=function(){(this||ie).reconstructor&&(this||ie).reconstructor.finishedReconstruction()};Eb.prototype.takeBinaryData=function(vb){(this||ie).buffers.push(vb);return(this||ie).buffers.length===(this||ie).reconPack.attachments?(vb=rd.reconstructPacket((this||
ie).reconPack,(this||ie).buffers),this.finishedReconstruction(),vb):null};Eb.prototype.finishedReconstruction=function(){(this||ie).reconPack=null;(this||ie).buffers=[]};return Wc}function ld(){if(df)return qe;df=!0;return qe="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")()}function wd(){if(rg)return Af;rg=!0;if(!Qd){Qd=!0;try{kf="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Gb){kf=!1}}var Ja=kf;var pb=ld();return Af=function(Gb){var nb=
Gb.xdomain,Eb=Gb.xscheme;Gb=Gb.enablesXDR;try{if("undefined"!==typeof XMLHttpRequest&&(!nb||Ja))return new XMLHttpRequest}catch(Fc){}try{if("undefined"!==typeof XDomainRequest&&!Eb&&Gb)return new XDomainRequest}catch(Fc){}if(!nb)try{return new (pb[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(Fc){}}}function Xc(){if(Yc)return mg;Yc=!0;return mg=Object.keys||function(Ja){var pb=[],Gb=Object.prototype.hasOwnProperty,nb;for(nb in Ja)Gb.call(Ja,nb)&&pb.push(nb);return pb}}function gd(){function Ja(ud){if(!ud||
"object"!==typeof ud)return!1;if(Gb(ud)){for(var rd=0,rc=ud.length;rd<rc;rd++)if(Ja(ud[rd]))return!0;return!1}if("function"===typeof pb&&pb.isBuffer&&pb.isBuffer(ud)||"function"===typeof ArrayBuffer&&ud instanceof ArrayBuffer||Eb&&ud instanceof Blob||Fc&&ud instanceof File)return!0;if(ud.toJSON&&"function"===typeof ud.toJSON&&1===arguments.length)return Ja(ud.toJSON(),!0);for(rd in ud)if(Object.prototype.hasOwnProperty.call(ud,rd)&&Ja(ud[rd]))return!0;return!1}if(dg)return Bf;dg=!0;var pb=mc.Buffer,
Gb=eb(),nb=Object.prototype.toString,Eb="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===nb.call(Blob),Fc="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===nb.call(File);return Bf=Ja}function bc(){if(pf)return Gg;pf=!0;return Gg=function(Ja,pb,Gb){var nb=Ja.byteLength;pb=pb||0;Gb=Gb||nb;if(Ja.slice)return Ja.slice(pb,Gb);0>pb&&(pb+=nb);0>Gb&&(Gb+=nb);Gb>nb&&(Gb=nb);if(pb>=nb||pb>=Gb||0===nb)return new ArrayBuffer(0);Ja=new Uint8Array(Ja);
nb=new Uint8Array(Gb-pb);for(var Eb=0;pb<Gb;pb++,Eb++)nb[Eb]=Ja[pb];return nb.buffer}}function ad(){function Ja(){}if(cb)return Ma;cb=!0;return Ma=function(pb,Gb,nb){function Eb(ud,rd){if(0>=Eb.count)throw Error("after called too many times");--Eb.count;ud?(Fc=!0,Gb(ud),Gb=nb):0!==Eb.count||Fc||Gb(null,rd)}var Fc=!1;nb=nb||Ja;Eb.count=pb;return 0===pb?Gb():Eb}}function ed(){function Ja(rc){for(var ic=[],Tc=0,vb=rc.length,od,ne;Tc<vb;)od=rc.charCodeAt(Tc++),55296<=od&&56319>=od&&Tc<vb?(ne=rc.charCodeAt(Tc++),
56320==(ne&64512)?ic.push(((od&1023)<<10)+(ne&1023)+65536):(ic.push(od),Tc--)):ic.push(od);return ic}function pb(rc,ic){if(55296<=rc&&57343>=rc){if(ic)throw Error("Lone surrogate U+"+rc.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function Gb(){if(rd>=ud)throw Error("Invalid byte index");var rc=Fc[rd]&255;rd++;if(128==(rc&192))return rc&63;throw Error("Invalid continuation byte");}function nb(rc){if(rd>ud)throw Error("Invalid byte index");if(rd==ud)return!1;var ic=Fc[rd]&
255;rd++;if(0==(ic&128))return ic;if(192==(ic&224)){var Tc=Gb();ic=(ic&31)<<6|Tc;if(128<=ic)return ic;throw Error("Invalid continuation byte");}if(224==(ic&240)){Tc=Gb();var vb=Gb();ic=(ic&15)<<12|Tc<<6|vb;if(2048<=ic)return pb(ic,rc)?ic:65533;throw Error("Invalid continuation byte");}if(240==(ic&248)&&(Tc=Gb(),vb=Gb(),rc=Gb(),ic=(ic&7)<<18|Tc<<12|vb<<6|rc,65536<=ic&&1114111>=ic))return ic;throw Error("Invalid UTF-8 detected");}if(ba)return Mb;ba=!0;var Eb=String.fromCharCode,Fc,ud,rd;return Mb={version:"2.1.2",
encode:function(rc,ic){ic=ic||{};ic=!1!==ic.strict;rc=Ja(rc);for(var Tc=rc.length,vb=-1,od,ne="";++vb<Tc;){od=rc[vb];var Te=ic;if(0==(od&4294967168))od=Eb(od);else{var ge="";0==(od&4294965248)?ge=Eb(od>>6&31|192):0==(od&4294901760)?(pb(od,Te)||(od=65533),ge=Eb(od>>12&15|224),ge+=Eb(od>>6&63|128)):0==(od&4292870144)&&(ge=Eb(od>>18&7|240),ge+=Eb(od>>12&63|128),ge+=Eb(od>>6&63|128));od=ge+=Eb(od&63|128)}ne+=od}return ne},decode:function(rc,ic){ic=ic||{};ic=!1!==ic.strict;Fc=Ja(rc);ud=Fc.length;rd=0;
rc=[];for(var Tc;!1!==(Tc=nb(ic));)rc.push(Tc);ic=rc.length;Tc=-1;for(var vb,od="";++Tc<ic;)vb=rc[Tc],65535<vb&&(vb-=65536,od+=Eb(vb>>>10&1023|55296),vb=56320|vb&1023),od+=Eb(vb);return od}}}function Id(){if(mb)return La;mb=!0;(function(Ja){La.encode=function(pb){pb=new Uint8Array(pb);var Gb,nb=pb.length,Eb="";for(Gb=0;Gb<nb;Gb+=3)Eb+=Ja[pb[Gb]>>2],Eb+=Ja[(pb[Gb]&3)<<4|pb[Gb+1]>>4],Eb+=Ja[(pb[Gb+1]&15)<<2|pb[Gb+2]>>6],Eb+=Ja[pb[Gb+2]&63];2===nb%3?Eb=Eb.substring(0,Eb.length-1)+"=":1===nb%3&&(Eb=Eb.substring(0,
Eb.length-2)+"==");return Eb};La.decode=function(pb){var Gb=.75*pb.length,nb=pb.length,Eb=0;"="===pb[pb.length-1]&&(Gb--,"="===pb[pb.length-2]&&Gb--);var Fc=new ArrayBuffer(Gb),ud=new Uint8Array(Fc);for(Gb=0;Gb<nb;Gb+=4){var rd=Ja.indexOf(pb[Gb]);var rc=Ja.indexOf(pb[Gb+1]);var ic=Ja.indexOf(pb[Gb+2]);var Tc=Ja.indexOf(pb[Gb+3]);ud[Eb++]=rd<<2|rc>>4;ud[Eb++]=(rc&15)<<4|ic>>2;ud[Eb++]=(ic&3)<<6|Tc&63}return Fc}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/");return La}function hc(){function Ja(rd){return rd.map(function(rc){if(rc.buffer instanceof
ArrayBuffer){var ic=rc.buffer;if(rc.byteLength!==ic.byteLength){var Tc=new Uint8Array(rc.byteLength);Tc.set(new Uint8Array(ic,rc.byteOffset,rc.byteLength));ic=Tc.buffer}return ic}return rc})}function pb(rd,rc){rc=rc||{};var ic=new nb;Ja(rd).forEach(function(Tc){ic.append(Tc)});return rc.type?ic.getBlob(rc.type):ic.getBlob()}function Gb(rd,rc){return new Blob(Ja(rd),rc||{})}if(Qc)return zb;Qc=!0;var nb="undefined"!==typeof nb?nb:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!==
typeof MSBlobBuilder?MSBlobBuilder:"undefined"!==typeof MozBlobBuilder?MozBlobBuilder:!1;try{var Eb=2===(new Blob(["hi"])).size}catch(rd){Eb=!1}var Fc;if(Fc=Eb)try{Fc=2===(new Blob([new Uint8Array([1,2])])).size}catch(rd){Fc=!1}var ud=nb&&nb.prototype.append&&nb.prototype.getBlob;"undefined"!==typeof Blob&&(pb.prototype=Blob.prototype,Gb.prototype=Blob.prototype);zb=Eb?Fc?Blob:Gb:ud?pb:void 0;return zb}function Qb(){function Ja(ge,Qe,qf){if(!Qe)return yc.encodeBase64Packet(ge,qf);var Jf=new FileReader;
Jf.onload=function(){yc.encodePacket({type:ge.type,data:Jf.result},Qe,!0,qf)};return Jf.readAsArrayBuffer(ge.data)}function pb(ge,Qe,qf){var Jf=Array(ge.length);qf=Fc(ge.length,qf);for(var Lf=function(ch,wh,tg){Qe(wh,function(va,Ia){Jf[ch]=Ia;tg(va,Jf)})},Ig=0;Ig<ge.length;Ig++)Lf(Ig,ge[Ig],qf)}if(Ed)return yc;Ed=!0;var Gb=Xc(),nb=gd(),Eb=bc(),Fc=ad(),ud=ed(),rd;"undefined"!==typeof ArrayBuffer&&(rd=Id());var rc="undefined"!==typeof navigator&&/Android/i.test(navigator.userAgent),ic="undefined"!==
typeof navigator&&/PhantomJS/i.test(navigator.userAgent),Tc=rc||ic;yc.protocol=3;var vb=yc.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},od=Gb(vb),ne={type:"error",data:"parser error"},Te=hc();yc.encodePacket=function(ge,Qe,qf,Jf){"function"===typeof Qe&&(Jf=Qe,Qe=!1);"function"===typeof qf&&(Jf=qf,qf=null);var Lf=void 0===ge.data?void 0:ge.data.buffer||ge.data;if("undefined"!==typeof ArrayBuffer&&Lf instanceof ArrayBuffer){if(Qe){qf=ge.data;Qe=new Uint8Array(qf);qf=new Uint8Array(1+
qf.byteLength);qf[0]=vb[ge.type];for(ge=0;ge<Qe.length;ge++)qf[ge+1]=Qe[ge];ge=Jf(qf.buffer)}else ge=yc.encodeBase64Packet(ge,Jf);return ge}if("undefined"!==typeof Te&&Lf instanceof Te)return Qe?Tc?ge=Ja(ge,Qe,Jf):(Qe=new Uint8Array(1),Qe[0]=vb[ge.type],ge=new Te([Qe.buffer,ge.data]),ge=Jf(ge)):ge=yc.encodeBase64Packet(ge,Jf),ge;if(Lf&&Lf.base64)return Jf("b"+yc.packets[ge.type]+ge.data.data);Qe=vb[ge.type];void 0!==ge.data&&(Qe+=qf?ud.encode(String(ge.data),{strict:!1}):String(ge.data));return Jf(""+
Qe)};yc.encodeBase64Packet=function(ge,Qe){var qf="b"+yc.packets[ge.type];if("undefined"!==typeof Te&&ge.data instanceof Te){var Jf=new FileReader;Jf.onload=function(){var ch=Jf.result.split(",")[1];Qe(qf+ch)};return Jf.readAsDataURL(ge.data)}try{var Lf=String.fromCharCode.apply(null,new Uint8Array(ge.data))}catch(ch){ge=new Uint8Array(ge.data);Lf=Array(ge.length);for(var Ig=0;Ig<ge.length;Ig++)Lf[Ig]=ge[Ig];Lf=String.fromCharCode.apply(null,Lf)}qf+=btoa(Lf);return Qe(qf)};yc.decodePacket=function(ge,
Qe,qf){if(void 0===ge)return ne;if("string"===typeof ge){if("b"===ge.charAt(0))return yc.decodeBase64Packet(ge.substr(1),Qe);if(qf){a:{Qe=ge;try{Qe=ud.decode(Qe,{strict:!1})}catch(Jf){ge=!1;break a}ge=Qe}if(!1===ge)return ne}qf=ge.charAt(0);return Number(qf)==qf&&od[qf]?1<ge.length?{type:od[qf],data:ge.substring(1)}:{type:od[qf]}:ne}qf=(new Uint8Array(ge))[0];ge=Eb(ge,1);Te&&"blob"===Qe&&(ge=new Te([ge]));return{type:od[qf],data:ge}};yc.decodeBase64Packet=function(ge,Qe){var qf=od[ge.charAt(0)];if(!rd)return{type:qf,
data:{base64:!0,data:ge.substr(1)}};ge=rd.decode(ge.substr(1));"blob"===Qe&&Te&&(ge=new Te([ge]));return{type:qf,data:ge}};yc.encodePayload=function(ge,Qe,qf){"function"===typeof Qe&&(qf=Qe,Qe=null);var Jf=nb(ge);if(Qe&&Jf)return Te&&!Tc?yc.encodePayloadAsBlob(ge,qf):yc.encodePayloadAsArrayBuffer(ge,qf);if(!ge.length)return qf("0:");pb(ge,function(Lf,Ig){yc.encodePacket(Lf,Jf?Qe:!1,!1,function(ch){Ig(null,ch.length+":"+ch)})},function(Lf,Ig){return qf(Ig.join(""))})};yc.decodePayload=function(ge,
Qe,qf){if("string"!==typeof ge)return yc.decodePayloadAsBinary(ge,Qe,qf);"function"===typeof Qe&&(qf=Qe,Qe=null);if(""===ge)return qf(ne,0,1);var Jf="";for(var Lf,Ig,ch=0,wh=ge.length;ch<wh;ch++)if(Ig=ge.charAt(ch),":"!==Ig)Jf+=Ig;else{if(""===Jf||Jf!=(Lf=Number(Jf)))return qf(ne,0,1);Ig=ge.substr(ch+1,Lf);if(Jf!=Ig.length)return qf(ne,0,1);if(Ig.length){Jf=yc.decodePacket(Ig,Qe,!1);if(ne.type===Jf.type&&ne.data===Jf.data)return qf(ne,0,1);if(!1===qf(Jf,ch+Lf,wh))return}ch+=Lf;Jf=""}if(""!==Jf)return qf(ne,
0,1)};yc.encodePayloadAsArrayBuffer=function(ge,Qe){if(!ge.length)return Qe(new ArrayBuffer(0));pb(ge,function(qf,Jf){yc.encodePacket(qf,!0,!0,function(Lf){return Jf(null,Lf)})},function(qf,Jf){qf=Jf.reduce(function(ch,wh){wh="string"===typeof wh?wh.length:wh.byteLength;return ch+wh.toString().length+wh+2},0);var Lf=new Uint8Array(qf),Ig=0;Jf.forEach(function(ch){var wh="string"===typeof ch,tg=ch;if(wh){tg=new Uint8Array(ch.length);for(var va=0;va<ch.length;va++)tg[va]=ch.charCodeAt(va);tg=tg.buffer}wh?
Lf[Ig++]=0:Lf[Ig++]=1;ch=tg.byteLength.toString();for(va=0;va<ch.length;va++)Lf[Ig++]=parseInt(ch[va]);Lf[Ig++]=255;tg=new Uint8Array(tg);for(va=0;va<tg.length;va++)Lf[Ig++]=tg[va]});return Qe(Lf.buffer)})};yc.encodePayloadAsBlob=function(ge,Qe){pb(ge,function(qf,Jf){yc.encodePacket(qf,!0,!0,function(Lf){var Ig=new Uint8Array(1);Ig[0]=1;if("string"===typeof Lf){for(var ch=new Uint8Array(Lf.length),wh=0;wh<Lf.length;wh++)ch[wh]=Lf.charCodeAt(wh);Lf=ch.buffer;Ig[0]=0}ch=(Lf instanceof ArrayBuffer?Lf.byteLength:
Lf.size).toString();var tg=new Uint8Array(ch.length+1);for(wh=0;wh<ch.length;wh++)tg[wh]=parseInt(ch[wh]);tg[ch.length]=255;Te&&(Lf=new Te([Ig.buffer,tg.buffer,Lf]),Jf(null,Lf))})},function(qf,Jf){return Qe(new Te(Jf))})};yc.decodePayloadAsBinary=function(ge,Qe,qf){"function"===typeof Qe&&(qf=Qe,Qe=null);for(var Jf=[];0<ge.byteLength;){for(var Lf=new Uint8Array(ge),Ig=0===Lf[0],ch="",wh=1;255!==Lf[wh];wh++){if(310<ch.length)return qf(ne,0,1);ch+=Lf[wh]}ge=Eb(ge,2+ch.length);ch=parseInt(ch);Lf=Eb(ge,
0,ch);if(Ig)try{Lf=String.fromCharCode.apply(null,new Uint8Array(Lf))}catch(va){for(Ig=new Uint8Array(Lf),Lf="",wh=0;wh<Ig.length;wh++)Lf+=String.fromCharCode(Ig[wh])}Jf.push(Lf);ge=Eb(ge,ch)}var tg=Jf.length;Jf.forEach(function(va,Ia){qf(yc.decodePacket(va,Qe,!0),Ia,tg)})};return yc}function xb(){function Ja(nb){(this||Ke).path=nb.path;(this||Ke).hostname=nb.hostname;(this||Ke).port=nb.port;(this||Ke).secure=nb.secure;(this||Ke).query=nb.query;(this||Ke).timestampParam=nb.timestampParam;(this||Ke).timestampRequests=
nb.timestampRequests;(this||Ke).readyState="";(this||Ke).agent=nb.agent||!1;(this||Ke).socket=nb.socket;(this||Ke).enablesXDR=nb.enablesXDR;(this||Ke).withCredentials=nb.withCredentials;(this||Ke).pfx=nb.pfx;(this||Ke).key=nb.key;(this||Ke).passphrase=nb.passphrase;(this||Ke).cert=nb.cert;(this||Ke).ca=nb.ca;(this||Ke).ciphers=nb.ciphers;(this||Ke).rejectUnauthorized=nb.rejectUnauthorized;(this||Ke).forceNode=nb.forceNode;(this||Ke).isReactNative=nb.isReactNative;(this||Ke).extraHeaders=nb.extraHeaders;
(this||Ke).localAddress=nb.localAddress}if(Bd)return Ad;Bd=!0;var pb=Qb(),Gb=nd();Ad=Ja;Gb(Ja.prototype);Ja.prototype.onError=function(nb,Eb){nb=Error(nb);nb.type="TransportError";nb.description=Eb;this.emit("error",nb);return this||Ke};Ja.prototype.open=function(){if("closed"===(this||Ke).readyState||""===(this||Ke).readyState)(this||Ke).readyState="opening",this.doOpen();return this||Ke};Ja.prototype.close=function(){if("opening"===(this||Ke).readyState||"open"===(this||Ke).readyState)this.doClose(),
this.onClose();return this||Ke};Ja.prototype.send=function(nb){if("open"===(this||Ke).readyState)this.write(nb);else throw Error("Transport not open");};Ja.prototype.onOpen=function(){(this||Ke).readyState="open";(this||Ke).writable=!0;this.emit("open")};Ja.prototype.onData=function(nb){nb=pb.decodePacket(nb,(this||Ke).socket.binaryType);this.onPacket(nb)};Ja.prototype.onPacket=function(nb){this.emit("packet",nb)};Ja.prototype.onClose=function(){(this||Ke).readyState="closed";this.emit("close")};
return Ad}function Nb(){if(wg)return Jg;wg=!0;Jg.encode=function(Ja){var pb="",Gb;for(Gb in Ja)Ja.hasOwnProperty(Gb)&&(pb.length&&(pb+="&"),pb+=encodeURIComponent(Gb)+"="+encodeURIComponent(Ja[Gb]));return pb};Jg.decode=function(Ja){var pb={};Ja=Ja.split("&");for(var Gb=0,nb=Ja.length;Gb<nb;Gb++){var Eb=Ja[Gb].split("=");pb[decodeURIComponent(Eb[0])]=decodeURIComponent(Eb[1])}return pb};return Jg}function kb(){if(Uf)return Qh;Uf=!0;return Qh=function(Ja,pb){var Gb=function(){};Gb.prototype=pb.prototype;
Ja.prototype=new Gb;Ja.prototype.constructor=Ja}}function Db(){function Ja(rd){var rc="";do rc=Gb[rd%64]+rc,rd=Math.floor(rd/64);while(0<rd);return rc}function pb(){var rd=Ja(+new Date);return rd!==ud?(Eb=0,ud=rd):rd+"."+Ja(Eb++)}if(ek)return Hh;ek=!0;for(var Gb="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),nb={},Eb=0,Fc=0,ud;64>Fc;Fc++)nb[Gb[Fc]]=Fc;pb.encode=Ja;pb.decode=function(rd){var rc=0;for(Fc=0;Fc<rd.length;Fc++)rc=64*rc+nb[rd.charAt(Fc)];return rc};return Hh=
pb}function Rb(){function Ja(rc){var ic=rc&&rc.forceBase64;if(!rd||ic)(this||If).supportsBinary=!1;pb.call(this||If,rc)}if(ml)return Zh;ml=!0;var pb=xb(),Gb=Nb(),nb=Qb(),Eb=kb(),Fc=Db(),ud=pe()("engine.io-client:polling");Zh=Ja;var rd=null!=(new (wd())({xdomain:!1})).responseType;Eb(Ja,pb);Ja.prototype.name="polling";Ja.prototype.doOpen=function(){this.poll()};Ja.prototype.pause=function(rc){function ic(){ud("paused");Tc.readyState="paused";rc()}var Tc=this||If;(this||If).readyState="pausing";if((this||
If).polling||!(this||If).writable){var vb=0;(this||If).polling&&(ud("we are currently polling - waiting to pause"),vb++,this.once("pollComplete",function(){ud("pre-pause polling complete");--vb||ic()}));(this||If).writable||(ud("we are currently writing - waiting to pause"),vb++,this.once("drain",function(){ud("pre-pause writing complete");--vb||ic()}))}else ic()};Ja.prototype.poll=function(){ud("polling");(this||If).polling=!0;this.doPoll();this.emit("poll")};Ja.prototype.onData=function(rc){var ic=
this||If;ud("polling got data %s",rc);nb.decodePayload(rc,(this||If).socket.binaryType,function(Tc,vb,od){if("opening"===ic.readyState)ic.onOpen();if("close"===Tc.type)return ic.onClose(),!1;ic.onPacket(Tc)});"closed"!==(this||If).readyState&&((this||If).polling=!1,this.emit("pollComplete"),"open"===(this||If).readyState?this.poll():ud('ignoring poll - transport state "%s"',(this||If).readyState))};Ja.prototype.doClose=function(){function rc(){ud("writing close packet");ic.write([{type:"close"}])}
var ic=this||If;"open"===(this||If).readyState?(ud("transport open - closing"),rc()):(ud("transport not open - deferring close"),this.once("open",rc))};Ja.prototype.write=function(rc){var ic=this||If;(this||If).writable=!1;var Tc=function(){ic.writable=!0;ic.emit("drain")};nb.encodePayload(rc,(this||If).supportsBinary,function(vb){ic.doWrite(vb,Tc)})};Ja.prototype.uri=function(){var rc=(this||If).query||{},ic=(this||If).secure?"https":"http",Tc="";!1!==(this||If).timestampRequests&&(rc[(this||If).timestampParam]=
Fc());(this||If).supportsBinary||rc.sid||(rc.b64=1);rc=Gb.encode(rc);(this||If).port&&("https"===ic&&443!==Number((this||If).port)||"http"===ic&&80!==Number((this||If).port))&&(Tc=":"+(this||If).port);rc.length&&(rc="?"+rc);var vb=-1!==(this||If).hostname.indexOf(":");return ic+"://"+(vb?"["+(this||If).hostname+"]":(this||If).hostname)+Tc+(this||If).path+rc};return Zh}function vc(){function Ja(){}function pb(Tc){Fc.call(this||Pe,Tc);(this||Pe).requestTimeout=Tc.requestTimeout;(this||Pe).extraHeaders=
Tc.extraHeaders;if("undefined"!==typeof location){var vb="https:"===location.protocol,od=location.port;od||(od=vb?443:80);(this||Pe).xd="undefined"!==typeof location&&Tc.hostname!==location.hostname||od!==Tc.port;(this||Pe).xs=Tc.secure!==vb}}function Gb(Tc){(this||Pe).method=Tc.method||"GET";(this||Pe).uri=Tc.uri;(this||Pe).xd=!!Tc.xd;(this||Pe).xs=!!Tc.xs;(this||Pe).async=!1!==Tc.async;(this||Pe).data=void 0!==Tc.data?Tc.data:null;(this||Pe).agent=Tc.agent;(this||Pe).isBinary=Tc.isBinary;(this||
Pe).supportsBinary=Tc.supportsBinary;(this||Pe).enablesXDR=Tc.enablesXDR;(this||Pe).withCredentials=Tc.withCredentials;(this||Pe).requestTimeout=Tc.requestTimeout;(this||Pe).pfx=Tc.pfx;(this||Pe).key=Tc.key;(this||Pe).passphrase=Tc.passphrase;(this||Pe).cert=Tc.cert;(this||Pe).ca=Tc.ca;(this||Pe).ciphers=Tc.ciphers;(this||Pe).rejectUnauthorized=Tc.rejectUnauthorized;(this||Pe).extraHeaders=Tc.extraHeaders;this.create()}function nb(){for(var Tc in Gb.requests)Gb.requests.hasOwnProperty(Tc)&&Gb.requests[Tc].abort()}
if(bj)return Gj;bj=!0;var Eb=wd(),Fc=Rb(),ud=nd(),rd=kb(),rc=pe()("engine.io-client:polling-xhr"),ic=ld();Gj=pb;Gj.Request=Gb;rd(pb,Fc);pb.prototype.supportsBinary=!0;pb.prototype.request=function(Tc){Tc=Tc||{};Tc.uri=this.uri();Tc.xd=(this||Pe).xd;Tc.xs=(this||Pe).xs;Tc.agent=(this||Pe).agent||!1;Tc.supportsBinary=(this||Pe).supportsBinary;Tc.enablesXDR=(this||Pe).enablesXDR;Tc.withCredentials=(this||Pe).withCredentials;Tc.pfx=(this||Pe).pfx;Tc.key=(this||Pe).key;Tc.passphrase=(this||Pe).passphrase;
Tc.cert=(this||Pe).cert;Tc.ca=(this||Pe).ca;Tc.ciphers=(this||Pe).ciphers;Tc.rejectUnauthorized=(this||Pe).rejectUnauthorized;Tc.requestTimeout=(this||Pe).requestTimeout;Tc.extraHeaders=(this||Pe).extraHeaders;return new Gb(Tc)};pb.prototype.doWrite=function(Tc,vb){Tc=this.request({method:"POST",data:Tc,isBinary:"string"!==typeof Tc&&void 0!==Tc});var od=this||Pe;Tc.on("success",vb);Tc.on("error",function(ne){od.onError("xhr post error",ne)});(this||Pe).sendXhr=Tc};pb.prototype.doPoll=function(){rc("xhr poll");
var Tc=this.request(),vb=this||Pe;Tc.on("data",function(od){vb.onData(od)});Tc.on("error",function(od){vb.onError("xhr poll error",od)});(this||Pe).pollXhr=Tc};ud(Gb.prototype);Gb.prototype.create=function(){var Tc={agent:(this||Pe).agent,xdomain:(this||Pe).xd,xscheme:(this||Pe).xs,enablesXDR:(this||Pe).enablesXDR};Tc.pfx=(this||Pe).pfx;Tc.key=(this||Pe).key;Tc.passphrase=(this||Pe).passphrase;Tc.cert=(this||Pe).cert;Tc.ca=(this||Pe).ca;Tc.ciphers=(this||Pe).ciphers;Tc.rejectUnauthorized=(this||Pe).rejectUnauthorized;
var vb=(this||Pe).xhr=new Eb(Tc),od=this||Pe;try{rc("xhr open %s: %s",(this||Pe).method,(this||Pe).uri);vb.open((this||Pe).method,(this||Pe).uri,(this||Pe).async);try{if((this||Pe).extraHeaders){vb.setDisableHeaderCheck&&vb.setDisableHeaderCheck(!0);for(var ne in(this||Pe).extraHeaders)(this||Pe).extraHeaders.hasOwnProperty(ne)&&vb.setRequestHeader(ne,(this||Pe).extraHeaders[ne])}}catch(Te){}if("POST"===(this||Pe).method)try{(this||Pe).isBinary?vb.setRequestHeader("Content-type","application/octet-stream"):
vb.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(Te){}try{vb.setRequestHeader("Accept","*/*")}catch(Te){}"withCredentials"in vb&&(vb.withCredentials=(this||Pe).withCredentials);(this||Pe).requestTimeout&&(vb.timeout=(this||Pe).requestTimeout);this.hasXDR()?(vb.onload=function(){od.onLoad()},vb.onerror=function(){od.onError(vb.responseText)}):vb.onreadystatechange=function(){if(2===vb.readyState)try{var Te=vb.getResponseHeader("Content-Type");if(od.supportsBinary&&"application/octet-stream"===
Te||"application/octet-stream; charset=UTF-8"===Te)vb.responseType="arraybuffer"}catch(ge){}if(4===vb.readyState)if(200===vb.status||1223===vb.status)od.onLoad();else setTimeout(function(){od.onError("number"===typeof vb.status?vb.status:0)},0)};rc("xhr data %s",(this||Pe).data);vb.send((this||Pe).data)}catch(Te){setTimeout(function(){od.onError(Te)},0);return}"undefined"!==typeof document&&((this||Pe).index=Gb.requestsCount++,Gb.requests[(this||Pe).index]=this||Pe)};Gb.prototype.onSuccess=function(){this.emit("success");
this.cleanup()};Gb.prototype.onData=function(Tc){this.emit("data",Tc);this.onSuccess()};Gb.prototype.onError=function(Tc){this.emit("error",Tc);this.cleanup(!0)};Gb.prototype.cleanup=function(Tc){if("undefined"!==typeof(this||Pe).xhr&&null!==(this||Pe).xhr){this.hasXDR()?(this||Pe).xhr.onload=(this||Pe).xhr.onerror=Ja:(this||Pe).xhr.onreadystatechange=Ja;if(Tc)try{(this||Pe).xhr.abort()}catch(vb){}"undefined"!==typeof document&&delete Gb.requests[(this||Pe).index];(this||Pe).xhr=null}};Gb.prototype.onLoad=
function(){try{try{var Tc=(this||Pe).xhr.getResponseHeader("Content-Type")}catch(od){}var vb="application/octet-stream"===Tc||"application/octet-stream; charset=UTF-8"===Tc?(this||Pe).xhr.response||(this||Pe).xhr.responseText:(this||Pe).xhr.responseText}catch(od){this.onError(od)}if(null!=vb)this.onData(vb)};Gb.prototype.hasXDR=function(){return"undefined"!==typeof XDomainRequest&&!(this||Pe).xs&&(this||Pe).enablesXDR};Gb.prototype.abort=function(){this.cleanup()};Gb.requestsCount=0;Gb.requests={};
"undefined"!==typeof document&&("function"===typeof attachEvent?attachEvent("onunload",nb):"function"===typeof addEventListener&&addEventListener("onpagehide"in ic?"pagehide":"unload",nb,!1));return Gj}function jc(){function Ja(){}function pb(rc){Gb.call(this||ih,rc);(this||ih).query=(this||ih).query||{};rd||(rd=Eb.___eio=Eb.___eio||[]);(this||ih).index=rd.length;var ic=this||ih;rd.push(function(Tc){ic.onData(Tc)});(this||ih).query.j=(this||ih).index;"function"===typeof addEventListener&&addEventListener("beforeunload",
function(){ic.script&&(ic.script.onerror=Ja)},!1)}if(kl)return Kk;kl=!0;var Gb=Rb(),nb=kb(),Eb=ld();Kk=pb;var Fc=/\n/g,ud=/\\n/g,rd;nb(pb,Gb);pb.prototype.supportsBinary=!1;pb.prototype.doClose=function(){(this||ih).script&&((this||ih).script.parentNode.removeChild((this||ih).script),(this||ih).script=null);(this||ih).form&&((this||ih).form.parentNode.removeChild((this||ih).form),(this||ih).form=null,(this||ih).iframe=null);Gb.prototype.doClose.call(this||ih)};pb.prototype.doPoll=function(){var rc=
this||ih,ic=document.createElement("script");(this||ih).script&&((this||ih).script.parentNode.removeChild((this||ih).script),(this||ih).script=null);ic.async=!0;ic.src=this.uri();ic.onerror=function(vb){rc.onError("jsonp poll error",vb)};var Tc=document.getElementsByTagName("script")[0];Tc?Tc.parentNode.insertBefore(ic,Tc):(document.head||document.body).appendChild(ic);(this||ih).script=ic;"undefined"!==typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var vb=document.createElement("iframe");
document.body.appendChild(vb);document.body.removeChild(vb)},100)};pb.prototype.doWrite=function(rc,ic){function Tc(){vb();ic()}function vb(){if(od.iframe)try{od.form.removeChild(od.iframe)}catch(qf){od.onError("jsonp polling iframe removal error",qf)}try{Qe=document.createElement('<iframe src="javascript:0" name="'+od.iframeId+'">')}catch(qf){Qe=document.createElement("iframe"),Qe.name=od.iframeId,Qe.src="javascript:0"}Qe.id=od.iframeId;od.form.appendChild(Qe);od.iframe=Qe}var od=this||ih;if(!(this||
ih).form){var ne=document.createElement("form"),Te=document.createElement("textarea"),ge=(this||ih).iframeId="eio_iframe_"+(this||ih).index,Qe;ne.className="socketio";ne.style.position="absolute";ne.style.top="-1000px";ne.style.left="-1000px";ne.target=ge;ne.method="POST";ne.setAttribute("accept-charset","utf-8");Te.name="d";ne.appendChild(Te);document.body.appendChild(ne);(this||ih).form=ne;(this||ih).area=Te}(this||ih).form.action=this.uri();vb();rc=rc.replace(ud,"\\\n");(this||ih).area.value=rc.replace(Fc,
"\\n");try{(this||ih).form.submit()}catch(qf){}(this||ih).iframe.attachEvent?(this||ih).iframe.onreadystatechange=function(){"complete"===od.iframe.readyState&&Tc()}:(this||ih).iframe.onload=Tc};return Kk}function qb(){if(ul)return dm;ul=!0;return dm=function(){throw Error("ws does not work in the browser. Browser clients must use the native WebSocket object");}}function rb(){function Ja(vb){vb&&vb.forceBase64&&((this||sg).supportsBinary=!1);(this||sg).perMessageDeflate=vb.perMessageDeflate;(this||
sg).usingBrowserWebSocket=rc&&!vb.forceNode;(this||sg).protocols=vb.protocols;(this||sg).usingBrowserWebSocket||(Tc=ic);Gb.call(this||sg,vb)}if(Si)return dl;Si=!0;var pb=mc.Buffer,Gb=xb(),nb=Qb(),Eb=Nb(),Fc=kb(),ud=Db(),rd=pe()("engine.io-client:websocket"),rc;"undefined"!==typeof WebSocket?rc=WebSocket:"undefined"!==typeof self&&(rc=self.WebSocket||self.MozWebSocket);if("undefined"===typeof window)try{var ic=qb()}catch(vb){}var Tc=rc||ic;dl=Ja;Fc(Ja,Gb);Ja.prototype.name="websocket";Ja.prototype.supportsBinary=
!0;Ja.prototype.doOpen=function(){if(this.check()){var vb=this.uri(),od=(this||sg).protocols,ne={};(this||sg).isReactNative||(ne.agent=(this||sg).agent,ne.perMessageDeflate=(this||sg).perMessageDeflate,ne.pfx=(this||sg).pfx,ne.key=(this||sg).key,ne.passphrase=(this||sg).passphrase,ne.cert=(this||sg).cert,ne.ca=(this||sg).ca,ne.ciphers=(this||sg).ciphers,ne.rejectUnauthorized=(this||sg).rejectUnauthorized);(this||sg).extraHeaders&&(ne.headers=(this||sg).extraHeaders);(this||sg).localAddress&&(ne.localAddress=
(this||sg).localAddress);try{(this||sg).ws=(this||sg).usingBrowserWebSocket&&!(this||sg).isReactNative?od?new Tc(vb,od):new Tc(vb):new Tc(vb,od,ne)}catch(Te){return this.emit("error",Te)}void 0===(this||sg).ws.binaryType&&((this||sg).supportsBinary=!1);(this||sg).ws.supports&&(this||sg).ws.supports.binary?((this||sg).supportsBinary=!0,(this||sg).ws.binaryType="nodebuffer"):(this||sg).ws.binaryType="arraybuffer";this.addEventListeners()}};Ja.prototype.addEventListeners=function(){var vb=this||sg;(this||
sg).ws.onopen=function(){vb.onOpen()};(this||sg).ws.onclose=function(){vb.onClose()};(this||sg).ws.onmessage=function(od){vb.onData(od.data)};(this||sg).ws.onerror=function(od){vb.onError("websocket error",od)}};Ja.prototype.write=function(vb){function od(){ne.emit("flush");setTimeout(function(){ne.writable=!0;ne.emit("drain")},0)}var ne=this||sg;(this||sg).writable=!1;for(var Te=vb.length,ge=0,Qe=Te;ge<Qe;ge++)(function(qf){nb.encodePacket(qf,ne.supportsBinary,function(Jf){if(!ne.usingBrowserWebSocket){var Lf=
{};qf.options&&(Lf.compress=qf.options.compress);ne.perMessageDeflate&&("string"===typeof Jf?pb.byteLength(Jf):Jf.length)<ne.perMessageDeflate.threshold&&(Lf.compress=!1)}try{ne.usingBrowserWebSocket?ne.ws.send(Jf):ne.ws.send(Jf,Lf)}catch(Ig){rd("websocket closed before onclose event")}--Te||od()})})(vb[ge])};Ja.prototype.onClose=function(){Gb.prototype.onClose.call(this||sg)};Ja.prototype.doClose=function(){"undefined"!==typeof(this||sg).ws&&(this||sg).ws.close()};Ja.prototype.uri=function(){var vb=
(this||sg).query||{},od=(this||sg).secure?"wss":"ws",ne="";(this||sg).port&&("wss"===od&&443!==Number((this||sg).port)||"ws"===od&&80!==Number((this||sg).port))&&(ne=":"+(this||sg).port);(this||sg).timestampRequests&&(vb[(this||sg).timestampParam]=ud());(this||sg).supportsBinary||(vb.b64=1);vb=Eb.encode(vb);vb.length&&(vb="?"+vb);var Te=-1!==(this||sg).hostname.indexOf(":");return od+"://"+(Te?"["+(this||sg).hostname+"]":(this||sg).hostname)+ne+(this||sg).path+vb};Ja.prototype.check=function(){return!!Tc&&
!("__initialize"in Tc&&(this||sg).name===Ja.prototype.name)};return dl}function cc(){if(Xm)return Qf;Xm=!0;var Ja=wd(),pb=vc(),Gb=jc(),nb=rb();Qf.polling=function(Eb){var Fc=!1,ud=!1,rd=!1!==Eb.jsonp;"undefined"!==typeof location&&(ud="https:"===location.protocol,(Fc=location.port)||(Fc=ud?443:80),Fc=Eb.hostname!==location.hostname||Fc!==Eb.port,ud=Eb.secure!==ud);Eb.xdomain=Fc;Eb.xscheme=ud;if("open"in new Ja(Eb)&&!Eb.forceJSONP)return new pb(Eb);if(!rd)throw Error("JSONP disabled");return new Gb(Eb)};
Qf.websocket=nb;return Qf}function Vc(){if(Zb)return Yb;Zb=!0;var Ja=[].indexOf;return Yb=function(pb,Gb){if(Ja)return pb.indexOf(Gb);for(var nb=0;nb<pb.length;++nb)if(pb[nb]===Gb)return nb;return-1}}function Bc(){function Ja(rc,ic){if(!((this||md)instanceof Ja))return new Ja(rc,ic);ic=ic||{};rc&&"object"===typeof rc&&(ic=rc,rc=null);rc?(rc=ud(rc),ic.hostname=rc.host,ic.secure="https"===rc.protocol||"wss"===rc.protocol,ic.port=rc.port,rc.query&&(ic.query=rc.query)):ic.host&&(ic.hostname=ud(ic.host).host);
(this||md).secure=null!=ic.secure?ic.secure:"undefined"!==typeof location&&"https:"===location.protocol;ic.hostname&&!ic.port&&(ic.port=(this||md).secure?"443":"80");(this||md).agent=ic.agent||!1;(this||md).hostname=ic.hostname||("undefined"!==typeof location?location.hostname:"localhost");(this||md).port=ic.port||("undefined"!==typeof location&&location.port?location.port:(this||md).secure?443:80);(this||md).query=ic.query||{};"string"===typeof(this||md).query&&((this||md).query=rd.decode((this||
md).query));(this||md).upgrade=!1!==ic.upgrade;(this||md).path=(ic.path||"/engine.io").replace(/\/$/,"")+"/";(this||md).forceJSONP=!!ic.forceJSONP;(this||md).jsonp=!1!==ic.jsonp;(this||md).forceBase64=!!ic.forceBase64;(this||md).enablesXDR=!!ic.enablesXDR;(this||md).withCredentials=!1!==ic.withCredentials;(this||md).timestampParam=ic.timestampParam||"t";(this||md).timestampRequests=ic.timestampRequests;(this||md).transports=ic.transports||["polling","websocket"];(this||md).transportOptions=ic.transportOptions||
{};(this||md).readyState="";(this||md).writeBuffer=[];(this||md).prevBufferLen=0;(this||md).policyPort=ic.policyPort||843;(this||md).rememberUpgrade=ic.rememberUpgrade||!1;(this||md).binaryType=null;(this||md).onlyBinaryUpgrades=ic.onlyBinaryUpgrades;(this||md).perMessageDeflate=!1!==ic.perMessageDeflate?ic.perMessageDeflate||{}:!1;!0===(this||md).perMessageDeflate&&((this||md).perMessageDeflate={});(this||md).perMessageDeflate&&null==(this||md).perMessageDeflate.threshold&&((this||md).perMessageDeflate.threshold=
1024);(this||md).pfx=ic.pfx||null;(this||md).key=ic.key||null;(this||md).passphrase=ic.passphrase||null;(this||md).cert=ic.cert||null;(this||md).ca=ic.ca||null;(this||md).ciphers=ic.ciphers||null;(this||md).rejectUnauthorized=void 0===ic.rejectUnauthorized?!0:ic.rejectUnauthorized;(this||md).forceNode=!!ic.forceNode;(this||md).isReactNative="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();if("undefined"===typeof self||(this||md).isReactNative)ic.extraHeaders&&
0<Object.keys(ic.extraHeaders).length&&((this||md).extraHeaders=ic.extraHeaders),ic.localAddress&&((this||md).localAddress=ic.localAddress);(this||md).id=null;(this||md).upgrades=null;(this||md).pingInterval=null;(this||md).pingTimeout=null;(this||md).pingIntervalTimer=null;(this||md).pingTimeoutTimer=null;this.open()}if(Ce)return Ee;Ce=!0;var pb=cc(),Gb=nd(),nb=pe()("engine.io-client:socket"),Eb=Vc(),Fc=Qb(),ud=$c(),rd=Nb();Ee=Ja;Ja.priorWebsocketSuccess=!1;Gb(Ja.prototype);Ja.protocol=Fc.protocol;
Ja.Socket=Ja;Ja.Transport=xb();Ja.transports=cc();Ja.parser=Qb();Ja.prototype.createTransport=function(rc){nb('creating transport "%s"',rc);var ic=(this||md).query,Tc={},vb;for(vb in ic)ic.hasOwnProperty(vb)&&(Tc[vb]=ic[vb]);Tc.EIO=Fc.protocol;Tc.transport=rc;ic=(this||md).transportOptions[rc]||{};(this||md).id&&(Tc.sid=(this||md).id);return new pb[rc]({query:Tc,socket:this||md,agent:ic.agent||(this||md).agent,hostname:ic.hostname||(this||md).hostname,port:ic.port||(this||md).port,secure:ic.secure||
(this||md).secure,path:ic.path||(this||md).path,forceJSONP:ic.forceJSONP||(this||md).forceJSONP,jsonp:ic.jsonp||(this||md).jsonp,forceBase64:ic.forceBase64||(this||md).forceBase64,enablesXDR:ic.enablesXDR||(this||md).enablesXDR,withCredentials:ic.withCredentials||(this||md).withCredentials,timestampRequests:ic.timestampRequests||(this||md).timestampRequests,timestampParam:ic.timestampParam||(this||md).timestampParam,policyPort:ic.policyPort||(this||md).policyPort,pfx:ic.pfx||(this||md).pfx,key:ic.key||
(this||md).key,passphrase:ic.passphrase||(this||md).passphrase,cert:ic.cert||(this||md).cert,ca:ic.ca||(this||md).ca,ciphers:ic.ciphers||(this||md).ciphers,rejectUnauthorized:ic.rejectUnauthorized||(this||md).rejectUnauthorized,perMessageDeflate:ic.perMessageDeflate||(this||md).perMessageDeflate,extraHeaders:ic.extraHeaders||(this||md).extraHeaders,forceNode:ic.forceNode||(this||md).forceNode,localAddress:ic.localAddress||(this||md).localAddress,requestTimeout:ic.requestTimeout||(this||md).requestTimeout,
protocols:ic.protocols||void 0,isReactNative:(this||md).isReactNative})};Ja.prototype.open=function(){if((this||md).rememberUpgrade&&Ja.priorWebsocketSuccess&&-1!==(this||md).transports.indexOf("websocket"))var rc="websocket";else{if(0===(this||md).transports.length){var ic=this||md;setTimeout(function(){ic.emit("error","No transports available")},0);return}rc=(this||md).transports[0]}(this||md).readyState="opening";try{rc=this.createTransport(rc)}catch(Tc){(this||md).transports.shift();this.open();
return}rc.open();this.setTransport(rc)};Ja.prototype.setTransport=function(rc){nb("setting transport %s",rc.name);var ic=this||md;(this||md).transport&&(nb("clearing existing transport %s",(this||md).transport.name),(this||md).transport.removeAllListeners());(this||md).transport=rc;rc.on("drain",function(){ic.onDrain()}).on("packet",function(Tc){ic.onPacket(Tc)}).on("error",function(Tc){ic.onError(Tc)}).on("close",function(){ic.onClose("transport close")})};Ja.prototype.probe=function(rc){function ic(){if(Jf.onlyBinaryUpgrades){var Lf=
!(this||md).supportsBinary&&Jf.transport.supportsBinary;qf=qf||Lf}qf||(nb('probe transport "%s" opened',rc),Qe.send([{type:"ping",data:"probe"}]),Qe.once("packet",function(Ig){qf||("pong"===Ig.type&&"probe"===Ig.data?(nb('probe transport "%s" pong',rc),Jf.upgrading=!0,Jf.emit("upgrading",Qe),Qe&&(Ja.priorWebsocketSuccess="websocket"===Qe.name,nb('pausing current transport "%s"',Jf.transport.name),Jf.transport.pause(function(){qf||"closed"===Jf.readyState||(nb("changing transport and sending upgrade packet"),
ge(),Jf.setTransport(Qe),Qe.send([{type:"upgrade"}]),Jf.emit("upgrade",Qe),Qe=null,Jf.upgrading=!1,Jf.flush())}))):(nb('probe transport "%s" failed',rc),Ig=Error("probe error"),Ig.transport=Qe.name,Jf.emit("upgradeError",Ig)))}))}function Tc(){qf||(qf=!0,ge(),Qe.close(),Qe=null)}function vb(Lf){var Ig=Error("probe error: "+Lf);Ig.transport=Qe.name;Tc();nb('probe transport "%s" failed because of error: %s',rc,Lf);Jf.emit("upgradeError",Ig)}function od(){vb("transport closed")}function ne(){vb("socket closed")}
function Te(Lf){Qe&&Lf.name!==Qe.name&&(nb('"%s" works - aborting "%s"',Lf.name,Qe.name),Tc())}function ge(){Qe.removeListener("open",ic);Qe.removeListener("error",vb);Qe.removeListener("close",od);Jf.removeListener("close",ne);Jf.removeListener("upgrading",Te)}nb('probing transport "%s"',rc);var Qe=this.createTransport(rc,{probe:1}),qf=!1,Jf=this||md;Ja.priorWebsocketSuccess=!1;Qe.once("open",ic);Qe.once("error",vb);Qe.once("close",od);this.once("close",ne);this.once("upgrading",Te);Qe.open()};Ja.prototype.onOpen=
function(){nb("socket open");(this||md).readyState="open";Ja.priorWebsocketSuccess="websocket"===(this||md).transport.name;this.emit("open");this.flush();if("open"===(this||md).readyState&&(this||md).upgrade&&(this||md).transport.pause){nb("starting upgrade probes");for(var rc=0,ic=(this||md).upgrades.length;rc<ic;rc++)this.probe((this||md).upgrades[rc])}};Ja.prototype.onPacket=function(rc){if("opening"===(this||md).readyState||"open"===(this||md).readyState||"closing"===(this||md).readyState)switch(nb('socket receive: type "%s", data "%s"',
rc.type,rc.data),this.emit("packet",rc),this.emit("heartbeat"),rc.type){case "open":this.onHandshake(JSON.parse(rc.data));break;case "pong":this.setPing();this.emit("pong");break;case "error":var ic=Error("server error");ic.code=rc.data;this.onError(ic);break;case "message":this.emit("data",rc.data),this.emit("message",rc.data)}else nb('packet received with socket readyState "%s"',(this||md).readyState)};Ja.prototype.onHandshake=function(rc){this.emit("handshake",rc);(this||md).id=rc.sid;(this||md).transport.query.sid=
rc.sid;(this||md).upgrades=this.filterUpgrades(rc.upgrades);(this||md).pingInterval=rc.pingInterval;(this||md).pingTimeout=rc.pingTimeout;this.onOpen();"closed"!==(this||md).readyState&&(this.setPing(),this.removeListener("heartbeat",(this||md).onHeartbeat),this.on("heartbeat",(this||md).onHeartbeat))};Ja.prototype.onHeartbeat=function(rc){clearTimeout((this||md).pingTimeoutTimer);var ic=this||md;ic.pingTimeoutTimer=setTimeout(function(){if("closed"!==ic.readyState)ic.onClose("ping timeout")},rc||
ic.pingInterval+ic.pingTimeout)};Ja.prototype.setPing=function(){var rc=this||md;clearTimeout(rc.pingIntervalTimer);rc.pingIntervalTimer=setTimeout(function(){nb("writing ping packet - expecting pong within %sms",rc.pingTimeout);rc.ping();rc.onHeartbeat(rc.pingTimeout)},rc.pingInterval)};Ja.prototype.ping=function(){var rc=this||md;this.sendPacket("ping",function(){rc.emit("ping")})};Ja.prototype.onDrain=function(){(this||md).writeBuffer.splice(0,(this||md).prevBufferLen);(this||md).prevBufferLen=
0;0===(this||md).writeBuffer.length?this.emit("drain"):this.flush()};Ja.prototype.flush=function(){"closed"!==(this||md).readyState&&(this||md).transport.writable&&!(this||md).upgrading&&(this||md).writeBuffer.length&&(nb("flushing %d packets in socket",(this||md).writeBuffer.length),(this||md).transport.send((this||md).writeBuffer),(this||md).prevBufferLen=(this||md).writeBuffer.length,this.emit("flush"))};Ja.prototype.write=Ja.prototype.send=function(rc,ic,Tc){this.sendPacket("message",rc,ic,Tc);
return this||md};Ja.prototype.sendPacket=function(rc,ic,Tc,vb){"function"===typeof ic&&(vb=ic,ic=void 0);"function"===typeof Tc&&(vb=Tc,Tc=null);if("closing"!==(this||md).readyState&&"closed"!==(this||md).readyState){Tc=Tc||{};Tc.compress=!1!==Tc.compress;rc={type:rc,data:ic,options:Tc};this.emit("packetCreate",rc);(this||md).writeBuffer.push(rc);if(vb)this.once("flush",vb);this.flush()}};Ja.prototype.close=function(){function rc(){vb.onClose("forced close");nb("socket closing - telling transport to close");
vb.transport.close()}function ic(){vb.removeListener("upgrade",ic);vb.removeListener("upgradeError",ic);rc()}function Tc(){vb.once("upgrade",ic);vb.once("upgradeError",ic)}if("opening"===(this||md).readyState||"open"===(this||md).readyState){(this||md).readyState="closing";var vb=this||md;if((this||md).writeBuffer.length)this.once("drain",function(){(this||md).upgrading?Tc():rc()});else(this||md).upgrading?Tc():rc()}return this||md};Ja.prototype.onError=function(rc){nb("socket error %j",rc);Ja.priorWebsocketSuccess=
!1;this.emit("error",rc);this.onClose("transport error",rc)};Ja.prototype.onClose=function(rc,ic){if("opening"===(this||md).readyState||"open"===(this||md).readyState||"closing"===(this||md).readyState){nb('socket close with reason: "%s"',rc);var Tc=this||md;clearTimeout((this||md).pingIntervalTimer);clearTimeout((this||md).pingTimeoutTimer);(this||md).transport.removeAllListeners("close");(this||md).transport.close();(this||md).transport.removeAllListeners();(this||md).readyState="closed";(this||
md).id=null;this.emit("close",rc,ic);Tc.writeBuffer=[];Tc.prevBufferLen=0}};Ja.prototype.filterUpgrades=function(rc){for(var ic=[],Tc=0,vb=rc.length;Tc<vb;Tc++)~Eb((this||md).transports,rc[Tc])&&ic.push(rc[Tc]);return ic};return Ee}function xc(){if(Oo)return rm;Oo=!0;return rm=function(Ja,pb){for(var Gb=[],nb=(pb=pb||0)||0;nb<Ja.length;nb++)Gb[nb-pb]=Ja[nb];return Gb}}function kc(){if(so)return Po;so=!0;return Po=function(Ja,pb,Gb){Ja.on(pb,Gb);return{destroy:function(){Ja.removeListener(pb,Gb)}}}}
function Q(){if(Vm)return ok;Vm=!0;var Ja=[].slice;return ok=function(pb,Gb){"string"==typeof Gb&&(Gb=pb[Gb]);if("function"!=typeof Gb)throw Error("bind() requires a function");var nb=Ja.call(arguments,2);return function(){return Gb.apply(pb,nb.concat(Ja.call(arguments)))}}}function ea(){function Ja(vb,od,ne){(this||yf).io=vb;(this||yf).nsp=od;(this||yf).json=this||yf;(this||yf).ids=0;(this||yf).acks={};(this||yf).receiveBuffer=[];(this||yf).sendBuffer=[];(this||yf).connected=!1;(this||yf).disconnected=
!0;(this||yf).flags={};ne&&ne.query&&((this||yf).query=ne.query);(this||yf).io.autoConnect&&this.open()}if(zm)return em;zm=!0;var pb=qc(),Gb=nd(),nb=xc(),Eb=kc(),Fc=Q(),ud=pe()("socket.io-client:socket"),rd=Nb(),rc=gd();em=em=Ja;var ic={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},Tc=Gb.prototype.emit;Gb(Ja.prototype);Ja.prototype.subEvents=function(){if(!(this||yf).subs){var vb=
(this||yf).io;(this||yf).subs=[Eb(vb,"open",Fc(this||yf,"onopen")),Eb(vb,"packet",Fc(this||yf,"onpacket")),Eb(vb,"close",Fc(this||yf,"onclose"))]}};Ja.prototype.open=Ja.prototype.connect=function(){if((this||yf).connected)return this||yf;this.subEvents();(this||yf).io.reconnecting||(this||yf).io.open();if("open"===(this||yf).io.readyState)this.onopen();this.emit("connecting");return this||yf};Ja.prototype.send=function(){var vb=nb(arguments);vb.unshift("message");(this||yf).emit.apply(this||yf,vb);
return this||yf};Ja.prototype.emit=function(vb){if(ic.hasOwnProperty(vb))return Tc.apply(this||yf,arguments),this||yf;var od=nb(arguments),ne={type:(void 0!==(this||yf).flags.binary?(this||yf).flags.binary:rc(od))?pb.BINARY_EVENT:pb.EVENT,data:od,options:{}};ne.options.compress=!(this||yf).flags||!1!==(this||yf).flags.compress;"function"===typeof od[od.length-1]&&(ud("emitting packet with ack id %d",(this||yf).ids),(this||yf).acks[(this||yf).ids]=od.pop(),ne.id=(this||yf).ids++);(this||yf).connected?
this.packet(ne):(this||yf).sendBuffer.push(ne);(this||yf).flags={};return this||yf};Ja.prototype.packet=function(vb){vb.nsp=(this||yf).nsp;(this||yf).io.packet(vb)};Ja.prototype.onopen=function(){ud("transport is open - connecting");if("/"!==(this||yf).nsp)if((this||yf).query){var vb="object"===typeof(this||yf).query?rd.encode((this||yf).query):(this||yf).query;ud("sending connect packet with query %s",vb);this.packet({type:pb.CONNECT,query:vb})}else this.packet({type:pb.CONNECT})};Ja.prototype.onclose=
function(vb){ud("close (%s)",vb);(this||yf).connected=!1;(this||yf).disconnected=!0;delete (this||yf).id;this.emit("disconnect",vb)};Ja.prototype.onpacket=function(vb){var od=vb.type===pb.ERROR&&"/"===vb.nsp;if(vb.nsp===(this||yf).nsp||od)switch(vb.type){case pb.CONNECT:this.onconnect();break;case pb.EVENT:this.onevent(vb);break;case pb.BINARY_EVENT:this.onevent(vb);break;case pb.ACK:this.onack(vb);break;case pb.BINARY_ACK:this.onack(vb);break;case pb.DISCONNECT:this.ondisconnect();break;case pb.ERROR:this.emit("error",
vb.data)}};Ja.prototype.onevent=function(vb){var od=vb.data||[];ud("emitting event %j",od);null!=vb.id&&(ud("attaching ack callback to event"),od.push(this.ack(vb.id)));(this||yf).connected?Tc.apply(this||yf,od):(this||yf).receiveBuffer.push(od)};Ja.prototype.ack=function(vb){var od=this||yf,ne=!1;return function(){if(!ne){ne=!0;var Te=nb(arguments);ud("sending ack %j",Te);od.packet({type:rc(Te)?pb.BINARY_ACK:pb.ACK,id:vb,data:Te})}}};Ja.prototype.onack=function(vb){var od=(this||yf).acks[vb.id];
"function"===typeof od?(ud("calling ack %s with %j",vb.id,vb.data),od.apply(this||yf,vb.data),delete (this||yf).acks[vb.id]):ud("bad ack %s",vb.id)};Ja.prototype.onconnect=function(){(this||yf).connected=!0;(this||yf).disconnected=!1;this.emit("connect");this.emitBuffered()};Ja.prototype.emitBuffered=function(){var vb;for(vb=0;vb<(this||yf).receiveBuffer.length;vb++)Tc.apply(this||yf,(this||yf).receiveBuffer[vb]);(this||yf).receiveBuffer=[];for(vb=0;vb<(this||yf).sendBuffer.length;vb++)this.packet((this||
yf).sendBuffer[vb]);(this||yf).sendBuffer=[]};Ja.prototype.ondisconnect=function(){ud("server disconnect (%s)",(this||yf).nsp);this.destroy();this.onclose("io server disconnect")};Ja.prototype.destroy=function(){if((this||yf).subs){for(var vb=0;vb<(this||yf).subs.length;vb++)(this||yf).subs[vb].destroy();(this||yf).subs=null}(this||yf).io.destroy(this||yf)};Ja.prototype.close=Ja.prototype.disconnect=function(){(this||yf).connected&&(ud("performing disconnect (%s)",(this||yf).nsp),this.packet({type:pb.DISCONNECT}));
this.destroy();if((this||yf).connected)this.onclose("io client disconnect");return this||yf};Ja.prototype.compress=function(vb){(this||yf).flags.compress=vb;return this||yf};Ja.prototype.binary=function(vb){(this||yf).flags.binary=vb;return this||yf};return em}function Ga(){function Ja(pb){pb=pb||{};(this||zk).ms=pb.min||100;(this||zk).max=pb.max||1E4;(this||zk).factor=pb.factor||2;(this||zk).jitter=0<pb.jitter&&1>=pb.jitter?pb.jitter:0;(this||zk).attempts=0}if(vn)return Wm;vn=!0;Wm=Ja;Ja.prototype.duration=
function(){var pb=(this||zk).ms*Math.pow((this||zk).factor,(this||zk).attempts++);if((this||zk).jitter){var Gb=Math.random(),nb=Math.floor(Gb*(this||zk).jitter*pb);pb=0==(Math.floor(10*Gb)&1)?pb-nb:pb+nb}return Math.min(pb,(this||zk).max)|0};Ja.prototype.reset=function(){(this||zk).attempts=0};Ja.prototype.setMin=function(pb){(this||zk).ms=pb};Ja.prototype.setMax=function(pb){(this||zk).max=pb};Ja.prototype.setJitter=function(pb){(this||zk).jitter=pb};return Wm}function Ua(){function Ja(vb,od){if(!((this||
le)instanceof Ja))return new Ja(vb,od);vb&&"object"===typeof vb&&(od=vb,vb=void 0);od=od||{};od.path=od.path||"/socket.io";(this||le).nsps={};(this||le).subs=[];(this||le).opts=od;this.reconnection(!1!==od.reconnection);this.reconnectionAttempts(od.reconnectionAttempts||Infinity);this.reconnectionDelay(od.reconnectionDelay||1E3);this.reconnectionDelayMax(od.reconnectionDelayMax||5E3);this.randomizationFactor(od.randomizationFactor||.5);(this||le).backoff=new ic({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),
jitter:this.randomizationFactor()});this.timeout(null==od.timeout?2E4:od.timeout);(this||le).readyState="closed";(this||le).uri=vb;(this||le).connecting=[];(this||le).lastPing=null;(this||le).encoding=!1;(this||le).packetBuffer=[];vb=od.parser||Eb;(this||le).encoder=new vb.Encoder;(this||le).decoder=new vb.Decoder;(this||le).autoConnect=!1!==od.autoConnect;(this||le).autoConnect&&this.open()}if(vl)return Fl;vl=!0;Oj||(Oj=!0,jh=Bc(),jh.parser=Qb());var pb=jh;var Gb=ea(),nb=nd(),Eb=qc(),Fc=kc(),ud=
Q(),rd=pe()("socket.io-client:manager"),rc=Vc(),ic=Ga(),Tc=Object.prototype.hasOwnProperty;Fl=Ja;Ja.prototype.emitAll=function(){(this||le).emit.apply(this||le,arguments);for(var vb in(this||le).nsps)Tc.call((this||le).nsps,vb)&&(this||le).nsps[vb].emit.apply((this||le).nsps[vb],arguments)};Ja.prototype.updateSocketIds=function(){for(var vb in(this||le).nsps)Tc.call((this||le).nsps,vb)&&((this||le).nsps[vb].id=this.generateId(vb))};Ja.prototype.generateId=function(vb){return("/"===vb?"":vb+"#")+(this||
le).engine.id};nb(Ja.prototype);Ja.prototype.reconnection=function(vb){if(!arguments.length)return(this||le)._reconnection;(this||le)._reconnection=!!vb;return this||le};Ja.prototype.reconnectionAttempts=function(vb){if(!arguments.length)return(this||le)._reconnectionAttempts;(this||le)._reconnectionAttempts=vb;return this||le};Ja.prototype.reconnectionDelay=function(vb){if(!arguments.length)return(this||le)._reconnectionDelay;(this||le)._reconnectionDelay=vb;(this||le).backoff&&(this||le).backoff.setMin(vb);
return this||le};Ja.prototype.randomizationFactor=function(vb){if(!arguments.length)return(this||le)._randomizationFactor;(this||le)._randomizationFactor=vb;(this||le).backoff&&(this||le).backoff.setJitter(vb);return this||le};Ja.prototype.reconnectionDelayMax=function(vb){if(!arguments.length)return(this||le)._reconnectionDelayMax;(this||le)._reconnectionDelayMax=vb;(this||le).backoff&&(this||le).backoff.setMax(vb);return this||le};Ja.prototype.timeout=function(vb){if(!arguments.length)return(this||
le)._timeout;(this||le)._timeout=vb;return this||le};Ja.prototype.maybeReconnectOnOpen=function(){!(this||le).reconnecting&&(this||le)._reconnection&&0===(this||le).backoff.attempts&&this.reconnect()};Ja.prototype.open=Ja.prototype.connect=function(vb,od){rd("readyState %s",(this||le).readyState);if(~(this||le).readyState.indexOf("open"))return this||le;rd("opening %s",(this||le).uri);(this||le).engine=pb((this||le).uri,(this||le).opts);var ne=(this||le).engine,Te=this||le;(this||le).readyState="opening";
(this||le).skipReconnect=!1;var ge=Fc(ne,"open",function(){Te.onopen();vb&&vb()});od=Fc(ne,"error",function(Jf){rd("connect_error");Te.cleanup();Te.readyState="closed";Te.emitAll("connect_error",Jf);if(vb){var Lf=Error("Connection error");Lf.data=Jf;vb(Lf)}else Te.maybeReconnectOnOpen()});if(!1!==(this||le)._timeout){var Qe=(this||le)._timeout;rd("connect attempt will timeout after %d",Qe);0===Qe&&ge.destroy();var qf=setTimeout(function(){rd("connect attempt timed out after %d",Qe);ge.destroy();ne.close();
ne.emit("error","timeout");Te.emitAll("connect_timeout",Qe)},Qe);(this||le).subs.push({destroy:function(){clearTimeout(qf)}})}(this||le).subs.push(ge);(this||le).subs.push(od);return this||le};Ja.prototype.onopen=function(){rd("open");this.cleanup();(this||le).readyState="open";this.emit("open");var vb=(this||le).engine;(this||le).subs.push(Fc(vb,"data",ud(this||le,"ondata")));(this||le).subs.push(Fc(vb,"ping",ud(this||le,"onping")));(this||le).subs.push(Fc(vb,"pong",ud(this||le,"onpong")));(this||
le).subs.push(Fc(vb,"error",ud(this||le,"onerror")));(this||le).subs.push(Fc(vb,"close",ud(this||le,"onclose")));(this||le).subs.push(Fc((this||le).decoder,"decoded",ud(this||le,"ondecoded")))};Ja.prototype.onping=function(){(this||le).lastPing=new Date;this.emitAll("ping")};Ja.prototype.onpong=function(){this.emitAll("pong",new Date-(this||le).lastPing)};Ja.prototype.ondata=function(vb){(this||le).decoder.add(vb)};Ja.prototype.ondecoded=function(vb){this.emit("packet",vb)};Ja.prototype.onerror=function(vb){rd("error",
vb);this.emitAll("error",vb)};Ja.prototype.socket=function(vb,od){function ne(){~rc(ge.connecting,Te)||ge.connecting.push(Te)}var Te=(this||le).nsps[vb];if(!Te){Te=new Gb(this||le,vb,od);(this||le).nsps[vb]=Te;var ge=this||le;Te.on("connecting",ne);Te.on("connect",function(){Te.id=ge.generateId(vb)});(this||le).autoConnect&&ne()}return Te};Ja.prototype.destroy=function(vb){vb=rc((this||le).connecting,vb);~vb&&(this||le).connecting.splice(vb,1);(this||le).connecting.length||this.close()};Ja.prototype.packet=
function(vb){rd("writing packet %j",vb);var od=this||le;vb.query&&0===vb.type&&(vb.nsp+="?"+vb.query);od.encoding?od.packetBuffer.push(vb):(od.encoding=!0,(this||le).encoder.encode(vb,function(ne){for(var Te=0;Te<ne.length;Te++)od.engine.write(ne[Te],vb.options);od.encoding=!1;od.processPacketQueue()}))};Ja.prototype.processPacketQueue=function(){if(0<(this||le).packetBuffer.length&&!(this||le).encoding){var vb=(this||le).packetBuffer.shift();this.packet(vb)}};Ja.prototype.cleanup=function(){rd("cleanup");
for(var vb=(this||le).subs.length,od=0;od<vb;od++)(this||le).subs.shift().destroy();(this||le).packetBuffer=[];(this||le).encoding=!1;(this||le).lastPing=null;(this||le).decoder.destroy()};Ja.prototype.close=Ja.prototype.disconnect=function(){rd("disconnect");(this||le).skipReconnect=!0;(this||le).reconnecting=!1;"opening"===(this||le).readyState&&this.cleanup();(this||le).backoff.reset();(this||le).readyState="closed";(this||le).engine&&(this||le).engine.close()};Ja.prototype.onclose=function(vb){rd("onclose");
this.cleanup();(this||le).backoff.reset();(this||le).readyState="closed";this.emit("close",vb);(this||le)._reconnection&&!(this||le).skipReconnect&&this.reconnect()};Ja.prototype.reconnect=function(){if((this||le).reconnecting||(this||le).skipReconnect)return this||le;var vb=this||le;if((this||le).backoff.attempts>=(this||le)._reconnectionAttempts)rd("reconnect failed"),(this||le).backoff.reset(),this.emitAll("reconnect_failed"),(this||le).reconnecting=!1;else{var od=(this||le).backoff.duration();
rd("will wait %dms before reconnect attempt",od);(this||le).reconnecting=!0;var ne=setTimeout(function(){vb.skipReconnect||(rd("attempting reconnect"),vb.emitAll("reconnect_attempt",vb.backoff.attempts),vb.emitAll("reconnecting",vb.backoff.attempts),vb.skipReconnect||vb.open(function(Te){Te?(rd("reconnect attempt error"),vb.reconnecting=!1,vb.reconnect(),vb.emitAll("reconnect_error",Te.data)):(rd("reconnect success"),vb.onreconnect())}))},od);(this||le).subs.push({destroy:function(){clearTimeout(ne)}})}};
Ja.prototype.onreconnect=function(){var vb=(this||le).backoff.attempts;(this||le).reconnecting=!1;(this||le).backoff.reset();this.updateSocketIds();this.emitAll("reconnect",vb)};return Fl}var fc=lively.FreezerRuntime.recorderFor("lively.2lively/interface.js");fc.nyi=function(Ja){throw Error("Not yet implemented: "+Ja);};fc.string=ub;fc.promise=Tb;fc.debugMessageOrder=!1;var Fb=function(Ja){this.id=fc.string.newUUID();this.actions={};this.options={ackTimeout:3500,debug:!1};this._incomingOrderNumberingBySenders=
new Map;this._outgoingOrderNumberingByTargets=new Map;this._outOfOrderCacheBySenders=new Map};Fb.prototype.isOnline=function(){fc.nyi("isOnline")};Fb.prototype.open=function(){fc.nyi("isOnline")};Fb.prototype.close=function(){fc.nyi("close")};Fb.prototype.remove=function(){fc.nyi("remove")};Fb.prototype.whenOnline=function(Ja){var pb=this;return fc.promise.waitFor(Ja,function(){return pb.isOnline()}).then(function(){return pb}).catch(function(Gb){return Promise.reject(/timeout/i.test(String(Gb))?
Error("Timeout in "+pb+".whenOnline"):Gb)})};Fb.prototype.onError=function(Ja){this.debug&&console.log("["+this+"] error: "+Ja)};Fb.prototype.removeService=function(Ja){delete this.actions[Ja]};Fb.prototype.removeServices=function(Ja){var pb=this;Ja.forEach(function(Gb){return pb.removeService(Gb)})};Fb.prototype.addService=function(Ja,pb){this.actions[Ja]=pb};Fb.prototype.addServices=function(Ja){var pb=this;Object.keys(Ja).forEach(function(Gb){return pb.addService(Gb,Ja[Gb])})};Fb.prototype.ping=
function(Ja){var pb=this,Gb,nb,Eb,Fc,ud;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rd){if(1==rd.nextAddress)return Gb=Date.now(),rd.yield(pb.sendToAndWait(Ja,"l2l-ping",{timestamp:Gb}),2);nb=rd.yieldResult;Eb=nb.data;Fc=Eb.timestamp;ud=Date.now();return rd.return({to:Fc-Gb,from:ud-Fc,roundtrip:ud-Gb})})};Fb.prototype.send=function(Ja,pb){fc.nyi("send")};Fb.prototype.sendAndWait=function(Ja){var pb=this,Gb,nb,Eb,Fc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ud){switch(ud.nextAddress){case 1:return Gb=
new Promise(function(rd,rc){return pb.send(Ja,rd)}),nb={},Eb=pb.options.ackTimeout+400,"ackTimeout"in Ja&&(Eb=!Ja.ackTimeout||0>Ja.ackTimeout?null:Ja.ackTimeout+400),Eb?ud.yield(Promise.race([fc.promise.delay(Eb,nb),Gb]),5):ud.yield(Gb,4);case 4:Fc=ud.yieldResult;ud.jumpTo(3);break;case 5:Fc=ud.yieldResult;case 3:if(Fc===nb)throw Error("Timeout sending "+Ja.action);return ud.return(Fc)}})};Fb.prototype.sendTo=function(Ja,pb,Gb,nb){return this.send({target:Ja,action:pb,data:Gb},nb)};Fb.prototype.sendToAndWait=
function(Ja,pb,Gb,nb){return this.sendAndWait(Object.assign({target:Ja,action:pb,data:Gb},nb))};Fb.prototype.prepareSend=function(Ja,pb){var Gb=Ja.target,nb=Ja.action,Eb=Ja.messageId,Fc=Ja.sender;if(!nb)throw Error("Trying to send a message without specifying action!");if(!Gb)throw Error("Trying to send message "+nb+" without specifying target!");Eb||(Ja.messageId=fc.string.newUUID());Fc||(Ja.sender=this.id);nb=Ja.n=this._outgoingOrderNumberingByTargets.get(Gb)||0;this._outgoingOrderNumberingByTargets.set(Gb,
nb+1);if("function"===typeof pb){Fc=this;var ud=pb;pb=function(rd){var rc=Fc._incomingOrderNumberingBySenders.get(rd.sender)||0;Fc.debug&&fc.debugMessageOrder&&console.log("[MSG ORDER] "+Fc+" received ack for "+rd.action+" as msg "+rc);try{ud.apply(null,arguments)}catch(ic){console.error("Error in ack fn of "+Fc+": "+ic.stack)}Fc._incomingOrderNumberingBySenders.set(rd.sender,rc+1);setTimeout(function(){return Fc.invokeOutOfOrderMessages(rd.sender)},0)}}this.debug&&fc.debugMessageOrder&&console.log("[MSG ORDER] "+
this+" sending "+nb+" ("+Ja.action+") to "+Gb);return[Ja,pb]};Fb.prototype.prepareAnswerMessage=function(Ja,pb){return{action:Ja.action+"-response",inResponseTo:Ja.messageId,target:Ja.sender,data:pb,sender:this.id}};Fb.prototype.installEventToMessageTranslator=function(Ja){var pb=this,Gb=Ja.onevent;Ja.onevent=function(nb){var Eb=nb.data||[];Gb.call(this,nb);nb.data=["*"].concat(Eb);Gb.call(this,nb)};Ja.on("*",function(nb,Eb){nb&&"object"===typeof nb&&nb.action&&(Eb=nb,nb=Eb.action);var Fc=arguments[arguments.length-
1];Fc="function"===typeof Fc?Fc:null;(Eb=Eb===Fc?null:Eb)&&Eb.data&&("number"===typeof Eb.n||Eb.broadcast)&&Eb.sender?pb.receive(Eb,Ja,Fc):(console.warn(pb+" received non-conformant message "+nb+":",arguments),"function"===typeof Fc&&Fc({data:{error:"invalid l2l message"}}))})};Fb.prototype.receive=function(Ja,pb,Gb){this.dispatchL2LMessageToSelf(Ja,pb,Gb)};Fb.prototype.dispatchL2LMessageToSelf=function(Ja,pb,Gb){var nb=this,Eb=Ja.action;if(Ja.broadcast)this.safeInvokeServiceHandler(Eb,Ja,Gb,pb);
else try{var Fc=this._incomingOrderNumberingBySenders.get(Ja.sender)||0,ud="register"===Eb||"unregister";if(!ud&&Ja.n<Fc)console.error("[MSG ORDER] ["+this+"] received message no. "+Ja.n+" but expected >= "+Fc+", dropping "+Eb);else if(!ud&&Ja.n>Fc){this.debug&&fc.debugMessageOrder&&console.log("[MSG ORDER] ["+this+"] storing out of order message "+Eb+" ("+Ja.n+") for later invocation");var rd=this._outOfOrderCacheBySenders.get(Ja.sender);rd||(rd=[],this._outOfOrderCacheBySenders.set(Ja.sender,rd));
rd.push([Eb,Ja,Gb,pb])}else this.safeInvokeServiceHandler(Eb,Ja,Gb,pb),setTimeout(function(){return nb.invokeOutOfOrderMessages(Ja.sender)},0)}catch(rc){console.error("Error message ordering when handling "+Eb+": "+(rc.stack||rc)),"function"===typeof Gb&&Gb(this.prepareAnswerMessage(Ja,{isError:!0,error:String(rc.stack||rc)}))}};Fb.prototype.invokeOutOfOrderMessages=function(Ja){var pb=this._outOfOrderCacheBySenders.get(Ja);if(pb&&pb.length){var Gb=this._incomingOrderNumberingBySenders.get(Ja)||0;
Ja=pb.findIndex(function(nb){nb=$jscomp.makeIterator(nb);nb.next();return nb.next().value.n===Gb});-1!==Ja&&(pb.splice(Ja,1),this.invokeServiceHandler.apply(this,pb[Ja]))}};Fb.prototype.renameTarget=function(Ja,pb){if(Ja!==pb){var Gb=this._outgoingOrderNumberingByTargets.get(Ja);this._outgoingOrderNumberingByTargets.delete(Ja);this._outgoingOrderNumberingByTargets.set(pb,Gb)}};Fb.prototype.safeInvokeServiceHandler=function(Ja,pb,Gb,nb){try{"function"===typeof this.actions[Ja]?this.invokeServiceHandler(Ja,
pb,Gb,nb):nb._events&&Object.keys(nb._events).includes(Ja)||(console.warn("WARNING ["+this+"] Unhandled message: "+Ja),"function"===typeof Gb&&Gb(this.prepareAnswerMessage(pb,{isError:!0,error:"message not understood: "+Ja})))}catch(Eb){console.error("Error when handling "+Ja+": "+(Eb.stack||Eb)),"function"===typeof Gb&&Gb(this.prepareAnswerMessage(pb,{isError:!0,error:String(Eb.stack||Eb)}))}};Fb.prototype.invokeServiceHandler=function(Ja,pb,Gb,nb){var Eb=this;this.debug&&fc.debugMessageOrder&&console.log("[MSG ORDER] "+
this+" received "+pb.n+" ("+pb.action+") from "+pb.sender);this._incomingOrderNumberingBySenders.set(pb.sender,pb.n+1);if("function"===typeof Gb){var Fc=!1,ud=!1,rd="ackTimeout"in pb?pb.ackTimeout:this.options.ackTimeout,rc=this._outgoingOrderNumberingByTargets.get(pb.sender)||0;this._outgoingOrderNumberingByTargets.set(pb.sender,rc+1);var ic=function(Tc){ud?console.warn("["+Eb+"] ackFn for "+pb.action+" called after it timed out, dropping answer!"):Fc?console.warn("["+Eb+"] ack function called repeatedly when handling "+
pb.action):(Fc=!0,Gb(Eb.prepareAnswerMessage(pb,Tc)),Eb.debug&&fc.debugMessageOrder&&console.log("[MSG ORDER] "+Eb+" sending "+rc+" (ack for "+pb.action+")"))};rd&&setTimeout(function(){Fc||(ic({isError:!0,error:"Timeout error: "+Eb+" did not send answer for "+pb.action+" after "+rd+"ms"}),ud=!0)},rd)}try{this.actions[Ja].call(this,this,pb,ic,nb)}catch(Tc){console.error("["+this+"] Error handling "+Ja+": "+(Tc.stack||Tc)),ic&&ic({error:Tc.stack})}};$jscomp.global.Object.defineProperties(Fb.prototype,
{debug:{configurable:!0,enumerable:!0,get:function(){return this.options.debug},set:function(Ja){this.options.debug=Ja}}});fc.L2LConnection=Fb;fc.default=Fb;var Va=lively.FreezerRuntime.recorderFor("lively.2lively/default-actions.js"),Ab={"l2l-ping":function(Ja,pb,Gb,nb){nb=pb.sender;pb=pb.data.timestamp;var Eb=Date.now();"function"===typeof Gb&&Gb({timestamp:Eb});Ja.debug&&console.log("[undefined] got ping from "+nb+", time: "+(Eb-pb)+"ms")},"remote-eval":function(Ja,pb,Gb,nb){var Eb=pb.data.source;
Promise.resolve().then(function(){return eval(Eb)}).then(function(Fc){return Gb({value:Fc})}).catch(function(Fc){Fc.originalErr&&(Fc=Fc.originalErr);console.error("eval error: "+Fc);"function"===typeof Gb&&Gb({isError:!0,value:String(Fc.stack||Fc)})})},"remote-eval-2":function(Ja,pb,Gb,nb){var Eb=pb.data.source;Promise.resolve().then(function(){var Fc=eval(Eb);if(!(Fc instanceof Promise))throw console.error("unexpected eval result:"+Fc),Error("unexpected eval result:"+Fc);return Fc}).then(function(Fc){return Gb(Fc)}).catch(function(Fc){console.error("eval error: "+
Fc);Fc.originalErr&&(Fc=Fc.originalErr);"function"===typeof Gb&&Gb({isError:!0,value:String(Fc.stack||Fc)})})}};Va.defaultActions=Ab;Va.defaultActions=Ab;Va.defaultActions=Ab;var td={},Pc=(td["[broadcast] send"]=function(Ja,pb,Gb,nb){var Eb=pb.sender,Fc=pb.data,ud,rd,rc,ic,Tc,vb,od,ne,Te,ge,Qe,qf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Jf){ud=Fc;rd=ud.action;rc=ud.broadcast;ic=ud.room;Tc=ud.namespace;vb=ud.isSystemBroadcast;od=ud.isMultiServerBroadcast;ne=[];od?(console.log(".......isMultiServerBroadcast"),
Te=Ja,ge=Te.id,Qe=Ja.getTrackerList(),console.log(Qe),ne=Qe.map(function(Lf){return Lf.id!=ge?Lf.io.nsps["/"+Lf.namespace]:nb.broadcast})):(vb&&(Tc=Ja.namespace),ne.push(Tc?Ja.io.nsps["/"+Tc]:nb.broadcast));ne.forEach(function(Lf){return Lf.to(ic).emit({action:rd,sender:Eb,broadcast:!0,data:rc})});Gb&&"function"===typeof Gb&&(qf="message broadcasted to "+ic,Tc&&(qf+=" in namespace "+Tc),1<ne.length&&(qf+=" "+ne.length+" trackers"),console.log(qf),Gb({status:qf}));Jf.jumpToEnd()})},td["[broadcast] join room"]=
function(Ja,pb,Gb,nb){var Eb=pb.sender,Fc=pb.data.room,ud,rd,rc,ic;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Tc){if(1==Tc.nextAddress)return rd=!1,rc=Ja.io.nsps["/"+Ja.namespace].adapter.rooms,(ic=rc[Fc]&&rc[Fc].sockets&&rc[Fc].sockets[nb.id])?(ud=Eb+" already in "+Fc,Tc.jumpTo(2)):Tc.yield(new Promise(function(vb,od){return nb.join(Fc,function(ne){return ne?od(ne):vb()})}),3);2!=Tc.nextAddress&&(ud=Eb+" joined "+Fc,rd=!0);Gb&&"function"===typeof Gb&&Gb({status:ud,joined:rd});Tc.jumpToEnd()})},
td["[broadcast] leave room"]=function(Ja,pb,Gb,nb){var Eb=pb.sender,Fc=pb.data.room,ud,rd,rc,ic;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Tc){if(1==Tc.nextAddress)return rd=!1,rc=Ja.io.nsps["/"+Ja.namespace].adapter.rooms,ic=rc[Fc]&&rc[Fc].sockets&&rc[Fc].sockets[nb.id],ic?Tc.yield(new Promise(function(vb,od){return nb.leave(Fc,function(ne){return ne?od(ne):vb()})}),3):(ud=Eb+" not in "+Fc,Tc.jumpTo(2));2!=Tc.nextAddress&&(ud=Eb+" left room "+Fc,rd=!0);console.log(ud);Gb&&"function"===
typeof Gb&&Gb({left:rd,status:ud});Tc.jumpToEnd()})},td["[broadcast] my rooms"]=function(Ja,pb,Gb,nb){Gb(nb.rooms)},td["[broadcast] all rooms"]=function(Ja,pb,Gb,nb){Gb(Ja.io.nsps["/"+Ja.namespace].adapter.rooms)},td["[broadcast] list room members"]=function(Ja,pb,Gb,nb){pb=pb.data.room;nb=Ja.io;pb?(Ja=nb.nsps["/"+Ja.namespace].adapter.rooms[pb],Gb({room:pb,sockets:Ja?Ja.sockets:{},length:Ja?Ja.length:0})):Gb({isError:!0,error:"`room` paramerter missing!"})},td.getClients=function(Ja,pb,Gb){Ja.removeDisconnectedClients();
Gb(Array.from(Ja.clients))},td);Va.defaultTrackerActions=Pc;Va.defaultTrackerActions=Pc;Va.defaultTrackerActions=Pc;var Vb={},Oa=(Vb.getRoomList=function(Ja){var pb=Ja.client,Gb=Ja.ackFn,nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Eb){nb=pb._socketioClient.rooms;Gb(nb);Eb.jumpToEnd()})},Vb["ask for"]=function(Ja,pb,Gb,nb){var Eb=pb.sender,Fc=pb.data.query,ud=this,rd,rc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ic){if(1==ic.nextAddress)return rd=Fc.match(/password|sudo/i)?
"passwordPrompt":"prompt",ic.yield($world[rd](Fc),2);rc=ic.yieldResult;"function"===typeof Gb&&Gb({answer:rc});Ja.debug&&console.log("["+ud+"] message 'ask for' from "+Eb+", query: "+Fc);ic.jumpToEnd()})},Vb["open editor"]=function(Ja,pb,Gb,nb){var Eb=pb.data.args,Fc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ud){if(1==ud.nextAddress)return Eb.length?ud.yield($world.execCommand("open file for EDITOR",{url:Eb[0]}),2):(Gb({error:"no file specified"}),ud.return());Fc=ud.yieldResult;
"function"===typeof Gb&&Gb("aborted"===Fc?{error:String(Fc)}:{status:Fc});ud.jumpToEnd()})},Vb.changeWorkingDirectory=function(Ja,pb,Gb,nb){var Eb=pb.data.args,Fc,ud,rd,rc,ic,Tc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){Fc=$jscomp.makeIterator(Eb||[]);ud=Fc.next().value;rd=Fc.next().value;rc="OK";try{if(ud)if(rd){if(ic=$world.getMorphWithId(rd))if(ic.__lookupSetter__("cwd"))ic.cwd=ud;else if("function"===typeof ic.changeWorkingDirectory)ic.changeWorkingDirectory(ud);else if("function"===
typeof ic.pluginFind){if(Tc=ic.pluginFind(function(od){return od.isShellEditorPlugin}))Tc.cwd=ud}else rc="[changeWorkingDirectory] cannot figure pout how to set dir"}else rc="[changeWorkingDirectory] No command morph";else rc="[changeWorkingDirectory] No directory received"}catch(od){rc=String(od)}"OK"!==rc&&console.warn(rc);"function"===typeof Gb&&Gb(rc);vb.jumpToEnd()})},Vb);Va.defaultClientActions=Oa;Va.defaultClientActions=Oa;Va.defaultClientActions=Oa;var Qa={},Aa=!1,za={},Ka=!1,tb={},yb=!1,
zc="undefined"!==typeof self?self:global,pd={},Yd=!1,Ge="undefined"!==typeof self?self:global,Sc={},ye=!1,Gd={},Sb=!1,oa="undefined"!==typeof self?self:global,Ha={},Kb=!1,P={},sa=!1,Ta={},Ib=!1,Lc="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Wc={},he=!1,ie="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,kf={},Qd=!1,qe={},df=!1,Af={},rg=!1,mg={},Yc=!1,Bf={},dg=!1,Gg={},pf=!1,Ma={},cb=!1,Mb={},ba=!1,La={},mb=!1,zb={},Qc=!1,yc={},Ed=
!1,Ad={},Bd=!1,Ke="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Jg={},wg=!1,Qh={},Uf=!1,Hh={},ek=!1,Zh={},ml=!1,If="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Gj={},bj=!1,Pe="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Kk={},kl=!1,ih="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,dm={},ul=!1,dl={},Si=!1,sg="undefined"!==typeof globalThis?globalThis:"undefined"!==
typeof self?self:global,Qf={},Xm=!1,Yb={},Zb=!1,Ee={},Ce=!1,md="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,jh={},Oj=!1,rm={},Oo=!1,Po={},so=!1,ok={},Vm=!1,em={},zm=!1,yf="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Wm={},vn=!1,zk="undefined"!==typeof self?self:global,Fl={},vl=!1,le="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,ll={},cl=!1,wl=function(){function Ja(ud,rd){"object"===typeof ud&&
(rd=ud,ud=void 0);rd=rd||{};ud=pb(ud);var rc=ud.source,ic=ud.id,Tc=ud.path;Tc=Fc[ic]&&Tc in Fc[ic].nsps;rd.forceNew||rd["force new connection"]||!1===rd.multiplex||Tc?(Eb("ignoring socket cache for %s",rc),rc=nb(rc,rd)):(Fc[ic]||(Eb("new io instance for %s",rc),Fc[ic]=nb(rc,rd)),rc=Fc[ic]);ud.query&&!rd.query&&(rd.query=ud.query);return rc.socket(ud.path,rd)}if(cl)return ll;cl=!0;var pb=Xd(),Gb=qc(),nb=Ua(),Eb=pe()("socket.io-client");ll=ll=Ja;var Fc=ll.managers={};ll.protocol=Gb.protocol;ll.connect=
Ja;ll.Manager=Ua();ll.Socket=ea();return ll}(),Mg=lively.FreezerRuntime.recorderFor("lively.2lively/client.js");Mg.determineLocation=function(){return"undefined"!==typeof document&&document.location?document.location.origin:Mg.isNode?System._nodeRequire("os").hostname():System.baseURL};Mg.promise=Tb;Mg.fun=Zd;Mg.obj=id;Mg.events=ce;Mg.num=kd;Mg.L2LConnection=Fb;Mg.defaultActions=Ab;Mg.defaultClientActions=Oa;Mg.isNode="undefined"!==typeof System?System.get("@system-env").node:"undefined"!==typeof process&&
process.env;Mg._ioClient=wl;Mg.ioClient=Mg.ioClient||void 0;Mg.isNode?(Mg.require=System._nodeRequire("module")._load,Mg.ioClient=Mg.require("socket.io-client")):Mg.ioClient=Mg._ioClient;Mg.urlHelper={isRoot:function(Ja){return"/"===Mg.urlHelper.path(Ja)},root:function(Ja){return Mg.urlHelper.isRoot(Ja)?Ja:Ja.slice(0,-Mg.urlHelper.path(Ja).length)+"/"},path:function(){var Ja=/^[a-z0-9-_\.]+:/,pb=/^\/\/[^\/]+/;return function(Gb){Gb=Gb.replace(Ja,"").replace(pb,"");return""===Gb?"/":Gb}}(),join:function(Ja,
pb){Ja.endsWith("/")&&(Ja=Ja.slice(0,-1));pb.startsWith("/")&&(pb=pb.slice(1));return Ja+"/"+pb}};var Yh=function(Ja,pb,Gb,nb){var Eb=Mg.L2LConnection.call(this)||this;Mg.events.makeEmitter(Eb);Eb.info=nb;Eb.origin=Ja;Eb.path=pb;Eb.namespace=Gb.replace(/^\/?/,"/");Eb.trackerId=null;Eb._socketioClient=null;Eb._reconnectState={closed:!1,autoReconnect:!0,isReconnecting:!1,isReconnectingViaSocketio:!1,registerAttempt:0,registerProcess:null,isOpening:!1};Object.keys(Mg.defaultActions).forEach(function(Fc){return Eb.addService(Fc,
Mg.defaultActions[Fc])});Object.keys(Mg.defaultClientActions).forEach(function(Fc){return Eb.addService(Fc,Mg.defaultClientActions[Fc])});return Eb};$jscomp.inherits(Yh,Mg.L2LConnection);Yh.clientKey=function(Ja,pb,Gb){Ja=Ja.replace(/\/$/,"");pb=pb.replace(/^\//,"");Gb=Gb.replace(/^\//,"");return Ja+"-"+pb+"-"+Gb};Yh.forLivelyInBrowser=function(Ja){var pb=!!Ja;Ja=Object.assign({type:"lively.morphic browser"},Ja);var Gb=this.default();if(!Gb)return Mg.L2LClient.ensure({url:document.location.origin+
"/lively-socket.io",namespace:"l2l",info:Ja});pb&&!Mg.obj.equals(Gb.info,Ja)&&Gb.isRegistered()&&(Gb.info=Ja,Gb.unregister().then(function(){return Gb.register()}).catch(function(nb){return console.error("l2l re-register on info change errored: "+nb)}));return Gb};Yh.default=function(){var Ja=Mg.L2LClient.clients.keys().next().value;return Mg.L2LClient.clients.get(Ja)};Yh.create=function(Ja){var pb=Ja=void 0===Ja?{}:Ja;Ja=void 0===pb.debug?!1:pb.debug;var Gb=pb.url,nb=pb.namespace,Eb=void 0===pb.autoOpen?
!0:pb.autoOpen;pb=void 0===pb.info?{}:pb.info;if(!Gb)throw Error("L2LClient needs server url!");var Fc=Mg.urlHelper.root(Gb).replace(/\/+$/,"");Gb=Mg.urlHelper.path(Gb);nb=new this(Fc,Gb,nb||"",pb);Eb&&nb.register();nb.debug=Ja;return nb};Yh.ensure=function(Ja){var pb=Ja=void 0===Ja?{}:Ja,Gb=pb.url;pb=pb.namespace;if(!Gb)throw Error("L2LClient needs server url!");var nb=Mg.urlHelper.root(Gb).replace(/\/+$/,""),Eb=Mg.urlHelper.path(Gb);nb=this.clientKey(nb,Eb,pb||"");(Eb=this.clients.get(nb))||this.clients.set(nb,
Eb=this.create(Object.assign({},Ja,{url:Gb,namespace:pb})));return Eb};Yh.prototype.isOnline=function(){return this.socket&&this.socket.connected};Yh.prototype.isRegistered=function(){return this.isOnline()&&!!this.trackerId};Yh.prototype.open=function(){var Ja=this,pb,Gb,nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Eb){if(1==Eb.nextAddress)return Ja.isOnline()||Ja._reconnectState.isOpening?Eb.return(Ja):Eb.yield(Ja.close(),2);Ja._reconnectState.closed=!1;pb=Mg.urlHelper.join(Ja.origin,
Ja.namespace);Gb={path:Ja.path,transports:["websocket","polling"]};nb=Ja._socketioClient=Mg.ioClient(pb,Gb);Ja.debug&&console.log("["+Ja+"] connecting");nb.on("error",function(Fc){Ja._reconnectState.isOpening=!1;Ja.debug&&console.log("["+Ja+"] errored: "+Fc)});nb.on("close",function(Fc){return Ja.debug&&console.log("["+Ja+"] closed: "+Fc)});nb.on("reconnect_failed",function(){return Ja.debug&&console.log("["+Ja+"] could not reconnect")});nb.on("reconnect_error",function(Fc){return Ja.debug&&console.log("["+
Ja+"] reconnect error "+Fc)});nb.on("connect",function(){Ja.debug&&console.log("["+Ja+"] connected");Ja.emit("connected",Ja);Ja._reconnectState.isOpening=!1;Ja._reconnectState.isReconnecting=!1;Ja._reconnectState.isReconnectingViaSocketio=!1});nb.on("disconnect",function(){Ja._reconnectState.isOpening=!1;Ja.debug&&console.log("["+Ja+"] disconnected");Ja.emit("disconnected",Ja);Ja.trackerId?("tracker"!==Ja.trackerId&&(Ja.renameTarget(Ja.trackerId,"tracker"),Ja.trackerId=null),Ja._reconnectState.closed?
Ja.debug&&console.log("["+Ja+"] won't reconnect b/c client is marked as closed"):Ja._reconnectState.autoReconnect?(Ja._reconnectState.isReconnecting=!0,setTimeout(function(){Ja._reconnectState.closed?Ja.debug&&console.log("["+Ja+"] won't reconnect b/c client is marked as closed 2"):Ja._reconnectState.isReconnectingViaSocketio?Ja.debug&&console.log("["+Ja+"] won't reconnect again, client already reconnecting"):(Ja.debug&&console.log("["+Ja+"] initiating reconnection to tracker"),Ja.register())},20)):
Ja.debug&&console.log("["+Ja+"] won't reconnect b/c client has reconnection disabled")):(Ja.debug&&console.log("["+Ja+"] disconnect: don't have a tracker id, won't try reconnect"),Ja.trackerId="tracker")});nb.on("reconnecting",function(){Ja.debug&&console.log("["+Ja+"] reconnecting",Ja._reconnectState);Ja.emit("reconnecting",Ja);Ja._reconnectState.closed?(Ja._reconnectState.isReconnecting=!1,Ja._reconnectState.isReconnectingViaSocketio=!1,nb.close(),Ja.close()):(Ja._reconnectState.isReconnecting=
!0,Ja._reconnectState.isReconnectingViaSocketio=!0)});nb.on("reconnect",function(){Ja.debug&&console.log("["+Ja+"] reconnected");Ja._reconnectState.isReconnecting=!1;Ja._reconnectState.isReconnectingViaSocketio=!1;Ja.register()});Ja.installEventToMessageTranslator(nb);Ja._reconnectState.isOpening=!0;return Eb.return((new Promise(function(Fc,ud){nb.once("error",ud);nb.once("connect",Fc)})).then(function(){return Ja}))})};Yh.prototype.close=function(){var Ja=this,pb,Gb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nb){if(1==
nb.nextAddress){Ja._reconnectState.closed=!0;if(pb=Ja.socket)pb.removeAllListeners("reconnect"),pb.removeAllListeners("reconnecting"),pb.removeAllListeners("disconnect"),pb.removeAllListeners("connect"),pb.removeAllListeners("reconnect_error"),pb.removeAllListeners("reconnect_failed"),pb.removeAllListeners("close"),pb.removeAllListeners("error"),pb.close();Ja.debug&&console.log("["+Ja+"] closing...");return Ja.isRegistered()?nb.yield(Ja.unregister(),2):nb.jumpTo(2)}return Ja.isOnline()||Ja.socket?
pb&&!pb.connected?(Ja.debug&&console.log("["+Ja+"] socket not connected, considering client closed"),nb.return(Ja)):nb.return(Promise.race([Mg.promise.delay(2E3).then(function(){return pb.removeAllListeners("disconnect")}),new Promise(function(Eb){return pb.once("disconnect",Eb)})]).then(function(){Ja.debug&&console.log("["+Ja+"] closed");return Ja})):(Ja.debug&&(Gb=Ja.isOnline()?"no socket":"not online",Ja.debug&&console.log("["+Ja+"] cannot close: "+Gb)),nb.return(Ja))})};Yh.prototype.remove=function(){var Ja=
this.constructor.clientKey(this.origin,this.path,this.namespace);this.constructor.clients.delete(Ja);return this.close()};Yh.prototype.register=function(){var Ja=this,pb,Gb,nb,Eb,Fc,ud,rd,rc,ic,Tc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){switch(vb.nextAddress){case 1:if(Ja.isRegistered())return vb.return();if(Ja._reconnectState.closed)return Ja.debug&&console.log("["+Ja+"] not registering this b/c closed"),Ja._reconnectState.registerAttempt=0,vb.return();if(Ja._reconnectState.registerProcess)return Ja.debug&&
console.log("["+Ja+"] not registering this b/c register process exists"),vb.return();vb.setCatchFinallyBlocks(2);if(Ja.isOnline()){vb.jumpTo(4);break}return vb.yield(Ja.open(),4);case 4:return Ja.debug&&console.log("["+Ja+"] register"),vb.yield(Ja.sendToAndWait("tracker","register",Object.assign({userName:"unknown",type:"l2l "+(Mg.isNode?"node":"browser"),location:Mg.determineLocation()},Ja.info)),6);case 6:pb=vb.yieldResult;if(!pb.data)throw Gb=Error("Register answer is empty!"),Ja.emit("error",
Gb),Gb;if(pb.data.isError)throw nb=Error(pb.data.error),Ja.emit("error",nb),nb;Ja._reconnectState.registerAttempt=0;Eb=pb;Fc=Eb.data;ud=Fc.trackerId;rd=Fc.messageNumber;Ja.trackerId=ud;Ja._incomingOrderNumberingBySenders.set(ud,rd||0);Ja.emit("registered",{trackerId:ud});vb.leaveTryBlock(0);break;case 2:rc=vb.enterCatchBlock(),console.error("Error in register request of "+Ja+": "+rc),ic=Ja._reconnectState.registerAttempt++,Tc=Mg.num.backoff(ic,4,3E5),Ja._reconnectState.registerProcess=setTimeout(function(){Ja._reconnectState.registerProcess=
null;Ja.register()},Tc),vb.jumpToEnd()}})};Yh.prototype.unregister=function(){var Ja=this,pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gb){switch(Gb.nextAddress){case 1:if(!Ja.isRegistered())return Gb.return();Ja.debug&&console.log("["+Ja+"] unregister");pb=Ja.trackerId;Gb.setCatchFinallyBlocks(2);return Gb.yield(Ja.sendToAndWait(Ja.trackerId,"unregister",{}),4);case 4:Gb.leaveTryBlock(3);break;case 2:Gb.enterCatchBlock();case 3:Ja.renameTarget(pb,"tracker"),Ja.trackerId=null,Ja.emit("unregistered",
Ja),Gb.jumpToEnd()}})};Yh.prototype.whenRegistered=function(Ja){var pb=this;return Mg.promise.waitFor(Ja,function(){return pb.isRegistered()}).catch(function(Gb){return Promise.reject(/timeout/i.test(String(Gb))?Error("Timeout in "+pb+".whenRegistered"):Gb)})};Yh.prototype.send=function(Ja,pb){var Gb=this,nb=$jscomp.makeIterator(this.prepareSend(Ja,pb));Ja=nb.next().value;pb=nb.next().value;this.whenOnline().then(function(){var Eb=Gb.socket,Fc=Ja,ud=Fc.action;Fc=Fc.target;if(!Eb)throw Error("Trying to send message "+
ud+" to "+Fc+" but cannot find a connection to it!");"function"===typeof pb?Eb.emit(ud,Ja,pb):Eb.emit(ud,Ja)})};Yh.prototype.joinRoom=function(Ja){var pb=this;return this.whenOnline().then(function(){return pb.sendToAndWait(pb.trackerId,"[broadcast] join room",{room:Ja})})};Yh.prototype.leaveRoom=function(Ja){var pb=this;return this.whenOnline().then(function(){return pb.sendToAndWait(pb.trackerId,"[broadcast] leave room",{room:Ja})})};Yh.prototype.broadcast=function(Ja,pb,Gb,nb,Eb){var Fc=this,ud=
{action:pb,room:Ja,broadcast:Gb};if(void 0===nb?0:nb)ud.isSystemBroadcast=!0;if(void 0===Eb?0:Eb)ud.isMultiServerBroadcast=!0;return this.whenOnline().then(function(){return Fc.sendToAndWait(Fc.trackerId,"[broadcast] send",ud)})};Yh.prototype.listRoomMembers=function(Ja){var pb=this,Gb,nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Eb){if(1==Eb.nextAddress)return Eb.yield(pb.sendToAndWait(pb.trackerId,"[broadcast] list room members",{room:Ja}),2);Gb=Eb.yieldResult;nb=Gb.data;return Eb.return(nb)})};
Yh.prototype.joinedRooms=function(){var Ja=this,pb,Gb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nb){if(1==nb.nextAddress)return nb.yield(Ja.sendToAndWait(Ja.trackerId,"[broadcast] my rooms",{}),2);pb=nb.yieldResult;Gb=pb.data;return nb.return(Gb)})};Yh.prototype.listRooms=function(){var Ja=this,pb,Gb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nb){if(1==nb.nextAddress)return nb.yield(Ja.sendToAndWait(Ja.trackerId,"[broadcast] all rooms",{}),2);pb=nb.yieldResult;Gb=
pb.data;return nb.return(Gb)})};Yh.prototype.listPeers=function(Ja){Ja=void 0===Ja?!1:Ja;var pb=this,Gb,nb,Eb,Fc,ud,rd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){if(1==rc.nextAddress)return Gb=pb,nb=Gb._peersCached,Eb=Date.now(),!Ja&&nb&&1E3>Eb-nb.timestamp?rc.return(pb._peersCached.sessions):pb.isOnline()?rc.yield(pb.sendToAndWait(pb.trackerId,"getClients",{}),2):rc.return([]);Fc=rc.yieldResult;ud=Fc.data;rd=ud.map(function(ic){var Tc=$jscomp.makeIterator(ic);ic=Tc.next().value;
var vb=Tc.next().value,od=vb.info||{};Tc=od.userRealm;var ne=od.userToken,Te=od.l2lUserToken,ge=od.location,Qe=od.type;od=od.world;ic=Object.assign({},Mg.obj.dissoc(vb,["info"]),{id:ic,world:od,location:ge,type:Qe});(ne=ne||Te)&&"null"!==ne&&(lively.user?ic.user=lively.user.ClientUser.fromToken(ne,Tc):(ic.userToken=ne,ic.userRealm=Tc));return ic});pb._peersCached={timestamp:Eb,sessions:rd};return rc.return(rd)})};Yh.prototype.toString=function(){var Ja=this.origin,pb=this.path,Gb=this.namespace,nb=
this.id,Eb=this.isOnline()?this.isRegistered()?"registered":"unregistered":"disconnected";return"L2LClient("+(nb||"").slice(0,5)+" "+Ja+pb+" - "+Gb+" "+Eb+")"};$jscomp.global.Object.defineProperties(Yh.prototype,{socket:{configurable:!0,enumerable:!0,get:function(){return this._socketioClient}},socketId:{configurable:!0,enumerable:!0,get:function(){return this.socket?this.socket.id:null}}});$jscomp.global.Object.defineProperties(Yh,{clients:{configurable:!0,enumerable:!0,get:function(){return this._clients||
(this._clients=new Map)}}});Ca("default",Yh);Mg.L2LClient=Yh;Mg.default=Yh}}});