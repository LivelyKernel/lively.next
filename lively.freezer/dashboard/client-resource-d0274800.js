System.register(["./__root_module__-aefa9179.js","kld-intersections","./client-command-6432b2cb.js"],function(Da){var Bb,Qb,hc,ac,be,bd;return{setters:[function(Sd){Bb=Sd.s;Qb=Sd.$;hc=Sd.a6;ac=Sd.bF;be=Sd.a7},function(){},function(Sd){bd=Sd.runCommand}],execute:function(){function Sd(cb,Ab){var Yb,gc,dd,Zd,Wb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(oc){if(1==oc.nextAddress)return Yb=Dd.fileInfoCommandString(cb,Ab),gc=Dd.runCommand(Yb,Ab),oc.yield(gc.whenDone(),2);if(dd=0!=
gc.exitCode?gc.output:null)throw dd;Zd=$jscomp.makeIterator(Dd.parseDirectoryListFromLs(gc.stdout,Ab.rootDirectory||"."));Wb=Zd.next().value;return oc.return(Wb)})}function ed(cb,Ab){return Dd.string.lines(cb).map(function(Yb){return Yb.trim().length?(new Dd.FileInfo(Ab)).readFromDirectoryListLine(Yb):null}).filter(Boolean)}function Mc(cb,Ab){var Yb,gc,dd,Zd,Wb,oc,Lb,Bc,Sc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yc){Yb=Object.assign({findFilesGroup:"default-find-files-process"},
Ab);gc=Yb.findFilesGroup;dd=Yb.rootDirectory;Wb=Zd=Dd.findFilesProcesses[gc]||(Dd.findFilesProcesses[gc]={promiseState:null,commands:[]});oc=Wb.commands;Lb=Wb.promiseState;Lb||(Zd.promiseState=Lb=Dd.promise.deferred());Bc=Dd.findFilesCommandString(cb,Ab);oc.forEach(function(Xb){return Xb.kill()});Sc=Dd.runCommand(Bc,Ab);oc.push(Sc);Sc.whenDone().then(function(){Dd.arr.remove(oc,Sc);if(oc.some(function(qb){return qb.startTime>Sc.startTime}))console.log("[findFiles] command "+Sc+" exited but a newer findFiles command was started for group "+
gc+", discarding output");else{var Xb=0!=Sc.exitCode?Sc.output:null;Xb&&console.warn(Xb);Xb=Xb?[]:Dd.parseDirectoryListFromLs(Sc.stdout,dd)||[];Lb.resolve(Xb);Object.assign(Zd,{promiseState:null,commands:[]})}}).catch(function(Xb){return console.error(Xb)});return Yc.return(Lb.promise)})}function pd(cb){function Ab(Yb){return Array.prototype.concat.apply([Yb],Yb.children?Yb.children.map(Ab):[])}return Ab(cb).map(function(Yb){var gc=Yb.fullPath.replace(/^\//,"");return{fileName:gc,path:gc,rootDirectory:"./",
isDirectory:Yb.isDirectory,isLink:void 0,lastModified:void 0,linkCount:void 0,mode:void 0,size:void 0,group:void 0,user:void 0}})}var Dd=lively.FreezerRuntime.recorderFor("lively.shell/client-fs-helper.js");Dd.fileInfo=Sd;Dd.fileInfoCommandString=function(cb,Ab){var Yb=Ab=void 0===Ab?{}:Ab;Ab=Yb.rootDirectory;Yb=Yb.platform;Ab=Ab||".";var gc="win32"===Yb?"\\":"/";"win32"===Yb||Ab.endsWith(gc)||(Ab+=gc);return"win32"===Yb?"cd "+Ab+' && ls -lLd --time-style=locale "'+cb+'"':'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && env TZ=GMT LANG=en_US.UTF-8 cd '+
(Ab+' && ls -lLd "$timeformat" "'+cb+'"')};Dd.parseDirectoryListFromLs=ed;Dd.findFiles=Mc;Dd.findFilesCommandString=function(cb,Ab){var Yb=Ab=void 0===Ab?{}:Ab,gc=Yb.rootDirectory,dd=Yb.exclude,Zd=Yb.depth;Yb=Yb.platform;gc=gc||".";dd=dd||"-iname "+Dd.defaultExcludes.map(Dd.string.print).join(" -o -iname ");var Wb="win32"===Yb?"\\":"/";"win32"===Yb||gc.endsWith(Wb)||(gc+=Wb);cb=Dd.string.format('%s "%s"',Ab.re?"-iregex":Ab.matchPath?"-ipath":"-iname",cb);Zd="number"===typeof Zd?" -maxdepth "+Zd:"";
return"win32"===Yb?Dd.string.format("find %s %s ( %s ) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd --time-style=locale {}",gc,Ab.re?"-E ":"",dd.replace(/"/g,""),cb.replace(/"/g,""),Zd):'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && '+Dd.string.format('env TZ=GMT LANG=en_US.UTF-8 find %s %s \\( %s \\) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd "$timeformat" "{}"',gc,Ab.re?"-E ":"",dd,cb,Zd)};Dd.convertDirectoryUploadEntriesToFileInfos=
pd;Dd.runCommand=bd;Dd.string=Bb;Dd.promise=Qb;Dd.arr=hc;Dd.fileInfo=Sd;Dd.fileInfo=Sd;Dd.parseDirectoryListFromLs=ed;Dd.parseDirectoryListFromLs=ed;var ke=function(cb){this.rootDirectory=cb;this.fileName=this.path="";this.isDirectory=!1;this.lastModified=null;this.mode="";this.isLink=!1;this.linkCount=0;this.group=this.user="";this.size=0;this.rootDirectory=null};ke.prototype.readFromDirectoryListLine=function(cb){var Ab=this;if(!cb.trim().length)return null;var Yb=cb;this.reader.forEach(function(gc){return Yb=
gc(Yb,Ab)});return this};ke.prototype.toString=function(){return this.path};$jscomp.global.Object.defineProperties(ke.prototype,{reader:{configurable:!0,enumerable:!0,get:function(){return[function(cb,Ab){var Yb=cb.indexOf(" ");Ab.mode=cb.slice(0,Yb);Ab.isDirectory="d"===Ab.mode[0];return cb.slice(Yb+1).trim()},function(cb,Ab){var Yb=cb.indexOf(" ");Ab.linkCount=Number(cb.slice(0,Yb));return cb.slice(Yb+1).trim()},function(cb,Ab){var Yb=cb.indexOf(" ");Ab.user=cb.slice(0,Yb);return cb.slice(Yb+1).trim()},
function(cb,Ab){var Yb=Dd.string.peekRight(cb,0,/\s+[0-9]/);Ab.group=cb.slice(0,Yb).trim();return cb.slice(Yb).trim()},function(cb,Ab){var Yb=cb.indexOf(" ");Ab.size=Number(cb.slice(0,Yb));return cb.slice(Yb+1).trim()},function(cb,Ab){var Yb=Dd.string.reMatches(cb,/[^s]+\s+[0-9:\s]+/);if(!Yb||!Yb[0])return cb;Ab.lastModified=new Date(Yb[0].match+" GMT");return cb.slice(Yb[0].end).trim()},function(cb,Ab){var Yb=(cb=cb.replace(/^\.\/+/g,"").replace(/\/\//g,"/"))&&cb.split(" -> "),gc=""===cb?!1:cb&&
2===Yb.length,dd=(Yb=gc?Yb[0]:cb)&&0===Yb.indexOf(Ab.rootDirectory)?Yb.slice(Ab.rootDirectory.length):Yb;Ab.fileName=""===cb?".":dd;Ab.path=Yb;Ab.isLink=gc;return dd}]}}});Dd.FileInfo=ke;Dd.findFilesProcesses={};Dd.findFiles=Mc;Dd.findFiles=Mc;Dd.defaultExcludes=[".svn",".git","node_modules",".module_cache"];Dd.convertDirectoryUploadEntriesToFileInfos=pd;Dd.convertDirectoryUploadEntriesToFileInfos=pd;var Kd=lively.FreezerRuntime.recorderFor("lively.shell/client-resource.js");Kd.Resource=ac;Kd.runCommand=
bd;Kd.fileInfo=Sd;Kd.findFiles=Mc;Kd.string=Bb;Kd.promise=Qb;Kd.arr=hc;Kd.obj=be;ke=function(cb,Ab,Yb){Yb=void 0===Yb?{}:Yb;cb=Kd.Resource.call(this,cb)||this;cb.options=Object.assign({},Yb,{l2lClient:Ab||cb.constructor.defaultL2lClient});return cb};$jscomp.inherits(ke,Kd.Resource);ke.prototype.newResource=function(cb){return new this.constructor(cb,this.options.l2lClient,this.options)};ke.prototype.read=function(){var cb=this,Ab=Kd.runCommand('cat "'+this.url+'"',this.options);return Ab.whenDone().then(function(){if(Ab.exitCode)throw Error("Read "+
cb.url+" failed: "+Ab.stderr);return Ab.output})};ke.prototype.write=function(cb){var Ab=this,Yb,gc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(dd){switch(dd.nextAddress){case 1:return cb?dd.yield(Kd.runCommand('touch "'+Ab.url+'" && tee "'+Ab.url+'"',Object.assign({stdin:String(cb)},Ab.options)).whenDone(),4):dd.yield(Kd.runCommand('echo -n > "'+Ab.url+'"',Object.assign({},Ab.options)).whenDone(),5);case 4:Yb=dd.yieldResult;dd.jumpTo(3);break;case 5:Yb=dd.yieldResult;case 3:gc=Yb;
if(gc.exitCode)throw Error("Write "+Ab.url+" failed: "+gc.stderr);return dd.return(Ab)}})};ke.prototype.mkdir=function(){var cb=this,Ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yb){if(1==Yb.nextAddress)return Yb.yield(Kd.runCommand('mkdir -p "'+cb.url+'"',cb.options).whenDone(),2);Ab=Yb.yieldResult;if(Ab.exitCode)throw Error(cb+" cannot create directory: "+Ab.stderr);return Yb.return(cb)})};ke.prototype.exists=function(){var cb=Kd.runCommand('test -d "'+this.url+'" || test -f "'+
this.url+'"',this.options);return cb.whenDone().then(function(){return 0===cb.exitCode})};ke.prototype.remove=function(){var cb=this,Ab=Kd.runCommand('rm -rf "'+this.url+'"',this.options);return Ab.whenDone().then(function(){if(Ab.exitCode)throw Error("Remove of "+cb.url+" failed: "+Ab.stderr);return cb})};ke.prototype.gzip=function(cb){var Ab=this,Yb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gc){Yb=Kd.runCommand('gzip > "'+Ab.url+'"',Object.assign({stdin:String(cb)},Ab.options));
return gc.return(Yb.whenDone().then(function(){if(Yb.exitCode)throw Error("Gzip compression of "+Ab.url+" failed: "+Yb.stderr);return Ab}))})};ke.prototype.brotli=function(cb){var Ab=this,Yb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gc){Yb=Kd.runCommand('brotli > "'+Ab.url+'"',Object.assign({stdin:String(cb)},Ab.options));return gc.return(Yb.whenDone().then(function(){if(Yb.exitCode)throw Error("Brotli compression of "+Ab.url+" failed: "+Yb.stderr);return Ab}))})};ke.prototype.readProperties=
function(){var cb=this,Ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yb){if(1==Yb.nextAddress)return Yb.yield(Kd.fileInfo(cb.url,cb.options),2);Ab=Yb.yieldResult;cb.assignProperties(Kd.obj.dissoc(Ab,["fileName","path","rootDirectory"]));return Yb.return(cb)})};ke.prototype.dirList=function(cb,Ab){cb=void 0===cb?1:cb;Ab=void 0===Ab?{}:Ab;var Yb=this,gc,dd,Zd,Wb,oc,Lb,Bc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sc){if(1==Sc.nextAddress)return gc=Ab,dd=gc.exclude,
Array.isArray(dd)&&(dd="-iname "+dd.map(Kd.string.print).join(" -o -iname ")),Zd=Yb,Wb=Zd.url,oc=Zd.options,Lb=oc.l2lClient,Sc.yield(Kd.findFiles("*",{exclude:dd,depth:cb,rootDirectory:Wb,l2lClient:Lb}),2);Bc=Sc.yieldResult;Bc[0].path.replace(/\/$/,"")===Yb.url.replace(/\/$/,"")&&Bc.shift();return Sc.return(Bc.map(function(Yc){var Xb=Yc.path;Yc.isDirectory&&(Xb=Xb.replace(/\/?$/,"/"));Xb=new Yb.constructor(Xb,Lb,Yb.options);Xb.assignProperties(Kd.obj.dissoc(Yc,["fileName","path","rootDirectory"]));
return Xb}))})};$jscomp.global.Object.defineProperties(ke,{defaultL2lClient:{configurable:!0,enumerable:!0,get:function(){return this._defaultL2lClient||Kd._defaultL2LClient},set:function(cb){this._defaultL2lClient=Kd._defaultL2LClient=cb}}});Da("default",ke);Kd.ShellClientResource=ke;Kd._defaultL2LClient=Kd._defaultL2LClient||void 0;var jd=Da("resourceExtension",{name:"shell-client",matches:function(cb){return cb.startsWith("/")||cb.match(/[a-z]:\\/i)},resourceClass:Kd.ShellClientResource});Kd.resourceExtension=
jd;Kd.resourceExtension=jd;Kd.resourceExtension=jd;Kd.default=ke}}});