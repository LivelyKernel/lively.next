System.register(["./__root_module__-37c88ebd.js","kld-intersections"],function(Wa){var Ib,Sb,xc,ac,Cd,nd,Ud,bd,Ic,pd,yd,Ne,Pe,Ie;return{setters:[function(fd){Ib=fd.a_;Sb=fd.b;xc=fd.r;ac=fd._;Cd=fd.a;nd=fd.Z;Ud=fd.bv;bd=fd.aZ;Ic=fd.i;pd=fd.c;yd=fd.bw;Ne=fd.bx;Pe=fd.N;Ie=fd.by},function(){}],execute:function(){function fd(Jb){try{var Ra=eval("("+Zb.ast.transform.wrapInFunction("var _; _ = ("+Jb+")")+")()")}catch(Ga){return JSON.parse(Jb)}return"object"!==typeof Ra?null:Ra}function me(Jb,Ra){var Ga,
ea,Da,ta,Pa,Ha,tb,Ac,wb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ud){switch(ud.nextAddress){case 1:return Ga=Ra.world(),ud.yield(Ga.prompt("Enter package name",{requester:Ra,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:ea=ud.yieldResult;if(!ea)throw"Canceled";ud.setCatchFinallyBlocks(3);ta=Mc.resource(ea);ea=ta.name();Da=ta.url;ud.leaveTryBlock(4);break;case 3:return ud.enterCatchBlock(),ud.yield(Jb.getConfig(),5);case 5:return Pa=ud.yieldResult.baseURL,
Ha=Mc.resource(Pa).join(ea).asDirectory().url,ud.yield(Jb.normalize(Ha),6);case 6:Da=ud.yieldResult.replace(/\/\.js$/,"/");case 4:return ud.yield(Ga.prompt("Confirm or change package location",{requester:Ra,input:Da,historyId:"lively.vm-editor-add-package-address"}),7);case 7:tb=ud.yieldResult;if(!tb)throw"Canceled";Ac=Mc.resource(tb).asDirectory();wb=Ac.asFile().url;return ud.yield(Jb.removePackage(wb),8);case 8:return ud.yield(Jb.resourceCreateFiles(wb,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+
ea+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+ea+"\n\nNo description for package "+ea+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+ea+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return ud.return(Mc.loadPackage(Jb,{name:ea,address:wb,configFile:Ac.join("package.json").url,main:Ac.join("index.js").url,test:Ac.join("tests/test.js").url,type:"package"}))}})}function Yb(Jb,Ra,Ga){Ga=void 0===
Ga?null:Ga;var ea,Da,ta,Pa,Ha,tb,Ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wb){switch(wb.nextAddress){case 1:return ea={name:"",address:"",type:"package"},wb.yield(Jb.getConfig(),2);case 2:Da=wb.yieldResult;if(!Ga){wb.jumpTo(3);break}return wb.yield(Jb.getPackage(Ga),4);case 4:if(ta=wb.yieldResult){wb.jumpTo(5);break}return wb.yield(Jb.getPackageForModule(Ga),6);case 6:ta=wb.yieldResult;case 5:Pa=ta;case 3:return wb.yield(Ra.world().prompt("What is the package directory?",{requester:Ra,
input:Pa?Pa.address:Da.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:Ha=wb.yieldResult;if(!Ha)throw"Canceled";ea.address=Ha.replace(/\/$/,"");ea.url=new Mc.URL(ea.address+"/");ea.configFile=Mc.resource(ea.url).join("package.json").url;wb.setCatchFinallyBlocks(8);tb=JSON;Ac=tb.parse;return wb.yield(Jb.moduleRead(ea.configFile),10);case 10:Ac.call(tb,wb.yieldResult).name;wb.leaveTryBlock(9);break;case 8:wb.enterCatchBlock(),ea.name=String(ea.url).replace(/\/$/,
""),Jb.resourceEnsureExistance(ea.configFile,'{\n  "name": "'+ea.name+'",\n  "version": "0.1.0"\n}');case 9:return wb.return(Mc.loadPackage(Jb,ea))}})}function Yc(Jb,Ra,Ga){var ea,Da,ta;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){switch(Pa.nextAddress){case 1:return ea=Mc.resource(Ga).asFile().url,Pa.yield(Jb.getPackage(ea),2);case 2:if(Da=Pa.yieldResult){Pa.jumpTo(3);break}return Pa.yield(Jb.getPackageForModule(ea),4);case 4:Da=Pa.yieldResult;case 3:ta=Da;if(!ta)throw Error("Cannot find package for "+
ea);return Pa.yield(Jb.reloadPackage(ea),5);case 5:if(!Ra){Pa.jumpTo(0);break}return Pa.yield(Ra.updateModuleList(),7);case 7:return Pa.yield(Ra.uiSelect(ea,!1),8);case 8:return Pa.return(Pa.yieldResult)}})}function Nd(Jb,Ra,Ga,ea){var Da,ta;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){switch(Pa.nextAddress){case 1:return Pa.yield(Jb.getPackage(Ga),2);case 2:return Da=Pa.yieldResult,Pa.yield((ea||$world).confirm("Unload package "+Da.name+"?",{requester:Ra}),3);case 3:ta=Pa.yieldResult;
if(!ta)throw"Canceled";return Pa.yield(Jb.removePackage(Ga),4);case 4:if(!Ra){Pa.jumpTo(0);break}return Pa.yield(Ra.updateModuleList(),6);case 6:return Pa.yield(Ra.uiSelect(null),0)}})}function gd(Jb,Ra,Ga){var ea,Da,ta,Pa,Ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tb){switch(tb.nextAddress){case 1:return ea=Ra.world(),tb.yield(Jb.getPackage(Ga),2);case 2:return Da=tb.yieldResult,Da?tb.yield(ea.confirm("Really remove package "+Da.name+"?",{requester:Ra}),3):($world.inform('No package "'+
Ga+'" found!',{requester:Ra}),tb.return());case 3:ta=tb.yieldResult;if(!ta)throw"Canceled";Jb.removePackage(Ga);return tb.yield(ea.confirm("Also remove directory "+Da.name+" including "+Da.modules.length+" modules?"),4);case 4:Pa=tb.yieldResult;if(!Pa){tb.jumpTo(0);break}return tb.yield(ea.confirm("REALLY *remove* directory "+Da.name+"? No undo possible..."),6);case 6:if(Ha=tb.yieldResult)return tb.yield(Jb.resourceRemove(Da.address),0);tb.jumpTo(0)}})}function ae(Jb,Ra,Ga){Ga=void 0===Ga?$world:
Ga;var ea,Da,ta,Pa,Ha,tb,Ac,wb,ud,Tb,te;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cd){switch(cd.nextAddress){case 1:return cd.yield(Jb.getPackage(Ra),2);case 2:ea=cd.yieldResult;if(!ea)throw Error("Cannot find package "+Ra);Da=[];ta=$jscomp.makeIterator(ea.modules);Pa=ta.next();case 3:if(Pa.done)return cd.yield(Ga.execCommand("open text window",{title:"imports and exports of "+Ra,content:Da.join("\n\n")}),0);Ha=Pa.value;if(!Ha.name.match(/\.js$/)){cd.jumpTo(4);break}cd.setCatchFinallyBlocks(6);
tb=Jb;Ac=tb.importsAndExportsOf;wb=Ha.name;return cd.yield(Jb.moduleRead(Ha.name),9);case 9:return cd.yield(Ac.call(tb,wb,cd.yieldResult),8);case 8:ud=cd.yieldResult;cd.leaveTryBlock(7);break;case 6:Tb=cd.enterCatchBlock();Ga.logError(Error("Error when getting imports/exports from module "+Ha.name+":\n"+Tb.stack));cd.jumpTo(4);break;case 7:te=""+Ha.name;if(!ud.imports.length&&!ud.exports.length){te+="\n  does not import / export anything";cd.jumpTo(4);break}ud.imports.length&&(te+="\n  imports:\n",
te+=Mc.arr.groupByKey(ud.imports,"fromModule").mapGroups(function(Lc,Hb){return"from "+Lc+": "+Hb.map(function(Be){return Be.local||Be.imported?Be.imported&&Be.imported!==Be.local?Be.imported+" as "+Be.local:Be.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(Lc){return"    "+Lc}).join("\n"));ud.exports.length&&(te+="\n  exports:\n",te+=ud.exports.map(function(Lc){return Lc.local?Lc.local&&Lc.local!==Lc.exported?Lc.local+" as "+Lc.exported:Lc.exported:Lc.exported+
" from "+Lc.fromModule}).join(", ").split("\n").map(function(Lc){return"    "+Lc}).join("\n"));Da.push(te);case 4:Pa=ta.next(),cd.jumpTo(3)}})}function Fe(Jb){return Jb.match(/import.*['"]mocha(-es6)?['"]/)&&Jb.match(/it\(['"]/)}function Wb(Jb,Ra,Ga){Ga=Ga&&Ga.address;if(Ga&&0===Ra.indexOf(Ga))var ea=Ra.slice(Ga.length).replace(/^\//,"");else a:{Ga=Jb.getConfig();if(!Ga||Ga.constructor!==Promise)try{ea=String((new $a.URL(Ra)).relativePathFrom(new $a.URL(Jb.getConfig().baseURL)));break a}catch(Da){}ea=
Ra}return ea}function Cc(Jb,Ra,Ga,ea){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){return 1==Da.nextAddress?(ea=Object.assign({targetModule:Ra},ea),Da.yield(Jb.normalize(Ra),2)):3!=Da.nextAddress?(Ra=Da.yieldResult,Da.yield(Jb.moduleSourceChange(Ra,Ga,ea),3)):Da.return(Ra)})}function Td(Jb,Ra,Ga,ea,Da){ea=void 0===ea?!1:ea;Da=void 0===Da?!1:Da;var ta;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){switch(Pa.nextAddress){case 1:return Ra&&Ra.setStatusMessage("Reloading "+
Ga),Pa.setCatchFinallyBlocks(2),Pa.yield(Jb.reloadModule(Ga,{reloadDeps:ea,resetEnv:Da}),4);case 4:if(!Ra){Pa.jumpTo(5);break}return Pa.yield(Ra.updateModuleList(),6);case 6:case 5:Ra&&Ra.setStatusMessage("Reloded "+Ga);Pa.leaveTryBlock(0);break;case 2:ta=Pa.enterCatchBlock();Pa.setCatchFinallyBlocks(7);if(!Ra){Pa.jumpTo(9);break}return Pa.yield(Ra.updateEditorWithSourceOf(Ga),10);case 10:case 9:Pa.leaveTryBlock(8);break;case 7:Pa.enterCatchBlock();case 8:throw Ra&&Ra.showError(ta),ta;}})}function Ec(Jb,
Ra,Ga){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){switch(ea.nextAddress){case 1:return ea.yield(Jb.forgetModule(Ga,{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!Ra){ea.jumpTo(3);break}return ea.yield(Ra.updateModuleList(),4);case 4:case 3:ea.jumpToEnd()}})}function Vd(Jb,Ra,Ga){var ea,Da,ta;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){switch(Pa.nextAddress){case 1:return Pa.yield(Jb.normalize(Ga),2);case 2:return ea=Pa.yieldResult,Pa.yield(Ra.world().confirm(["Really remove file:\n",
{},ea,{fontStyle:"italic",fontWeight:"bold"}," ?",{}],{requester:Ra,lineWrapping:!1}),3);case 3:Da=Pa.yieldResult;if(!Da)throw"Canceled";return Pa.yield(Jb.forgetModule(ea),4);case 4:return Pa.yield(Jb.resourceRemove(ea),5);case 5:return Pa.yield(Jb.getPackageForModule(ea),6);case 6:return ta=Pa.yieldResult,Pa.return(ta)}})}function Lb(Jb,Ra){var Ga,ea,Da;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ta){if(1==ta.nextAddress)return ta.yield($a._createAndLoadModules(Jb,[Ra]),2);Ga=ta.yieldResult;
ea=$a.arr.compact(Ga.map(function(Pa){return Pa.error}));Da=!!ea.length;return ta.return(Da)})}function ub(Jb,Ra,Ga){var ea,Da,ta,Pa,Ha,tb,Ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wb){switch(wb.nextAddress){case 1:return ea=$a.URL,wb.yield(Jb.getConfig(),2);case 2:Da=new ea(wb.yieldResult.baseURL);ta=Ra.world();if(!Ga){wb.jumpTo(3);break}return wb.yield(Jb.getPackage(Ga),4);case 4:if(Pa=wb.yieldResult){wb.jumpTo(5);break}return wb.yield(Jb.getPackageForModule(Ga),6);case 6:Pa=
wb.yieldResult;case 5:(Ha=Pa)&&(Da=new $a.URL(Ha.address));case 3:return wb.yield($a._searchForExistingFiles(Ra,String(Da),Ha),7);case 7:tb=wb.yieldResult;if(!tb.includes("[create new module]")){wb.jumpTo(8);break}return wb.yield($a._askForModuleName(Jb,Ga||String(Da),ta),9);case 9:Ac=wb.yieldResult,tb=[Ac];case 8:return wb.yield($a._createAndLoadModules(Jb,tb),10);case 10:return wb.return(wb.yieldResult)}})}function uc(Jb,Ra){var Ga,ea,Da,ta,Pa,Ha,tb,Ac,wb,ud;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Tb){if(1==
Tb.nextAddress)return Tb.yield(Jb.getPackage(Ra),2);if(3!=Tb.nextAddress){Ga=Tb.yieldResult;if(!Ga||!Ga.address.match(/^http/))throw Error("Cannot load package "+Ra);ea=$a.resource(Ga.address);Da=[];ta=$jscomp;Pa=ta.makeIterator;return Tb.yield(ea.dirList(5,{exclude:$a.modulesInPackage_defaultExclude}),3)}Ha=Pa.call(ta,Tb.yieldResult);for(tb=Ha.next();!tb.done;tb=Ha.next())wb=Ac=tb.value,ud=wb.url,ud.match(/\.js$/)&&Jb.isModuleLoaded(ud,!0)&&Da.push(Jb.getModule(ud));return Tb.return(Da)})}function dc(Jb){Jb||
(Jb="local");if(Jb.isSystemInterface)var Ra=Jb;else"string"===typeof Jb&&Jb.startsWith("l2l ")&&(Jb={type:"l2l",id:Jb.split(" ")[1]}),"string"!==typeof Jb&&"l2l"===Jb.type&&(Ra=Xb.l2lInterfaceFor(Jb.id,Jb.info)),"string"!==typeof Jb&&($world.setStatusMessage("Unknown system interface "+Jb),Jb="local"),Ra||(Ra=Jb&&"local"!==Jb?Xb.serverInterfaceFor(Jb):Xb.localInterface);return Ra}Wa("systemInterfaceNamed",dc);var Zb=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");Zb.parseJsonLikeObj=
fd;Zb.ast=Ib;Zb.parseJsonLikeObj=fd;Zb.parseJsonLikeObj=fd;var Mc=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");Mc.loadPackage=function(Jb,Ra){var Ga,ea;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){switch(Da.nextAddress){case 1:return Da.yield(Jb.importPackage(Ra.address+"/"),2);case 2:if(!Ra.main){Da.jumpTo(3);break}return Da.yield(Jb.importModule(Ra.main.toString()),3);case 3:if(!Ra.test){Da.jumpTo(5);break}Da.setCatchFinallyBlocks(6);return Da.yield(Jb.importPackage("mocha-es6"),
8);case 8:return Ga=Da.yieldResult,Da.yield(Ga.installSystemInstantiateHook(),9);case 9:return Da.yield(Jb.importModule(Ra.test.toString()),10);case 10:Da.leaveTryBlock(5);break;case 6:ea=Da.enterCatchBlock(),console.warn("Cannot load test of new package: "+ea);case 5:return Da.return(Jb.getPackage(Ra.address))}})};Mc.interactivelyCreatePackage=me;Mc.interactivelyLoadPackage=Yb;Mc.interactivelyReloadPackage=Yc;Mc.interactivelyUnloadPackage=Nd;Mc.interactivelyRemovePackage=gd;Mc.showExportsAndImportsOf=
ae;Mc.parseJsonLikeObj=fd;Mc.arr=Sb;Mc.resource=xc;Mc.interactivelyCreatePackage=me;Mc.interactivelyCreatePackage=me;Mc.interactivelyLoadPackage=Yb;Mc.interactivelyLoadPackage=Yb;Mc.interactivelyReloadPackage=Yc;Mc.interactivelyReloadPackage=Yc;Mc.interactivelyUnloadPackage=Nd;Mc.interactivelyUnloadPackage=Nd;Mc.interactivelyRemovePackage=gd;Mc.interactivelyRemovePackage=gd;Mc.showExportsAndImportsOf=ae;Mc.showExportsAndImportsOf=ae;var $a=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");
$a.isTestModule=Fe;$a.shortModuleName=Wb;$a.interactivelyChangeModule=Cc;$a.interactivelyReloadModule=Td;$a.interactivelyUnloadModule=Ec;$a.interactivelyRemoveModule=Vd;$a.addModule=Lb;$a.interactivelyAddModule=ub;$a._askForModuleName=function(Jb,Ra,Ga){var ea,Da;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ta){switch(ta.nextAddress){case 1:return ta.yield(Ga.prompt("Enter module name",{input:Ra,historyId:"lively.vm-editor-add-module-name"}),2);case 2:Ra=ta.yieldResult;if(!Ra)throw"Canceled";
return ta.yield(Jb.normalize(Ra),3);case 3:return ea=ta.yieldResult,ta.yield(Ga.confirm(["Create module \n",{},ea,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:Da=ta.yieldResult;if(!Da)throw"Canceled";return ta.return(ea)}})};$a._searchForExistingFiles=function(Jb,Ra,Ga){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){return String(Ra).match(/^http/)?ea.return($a._searchForExistingFilesWeb(Jb,Ra,Ga)):ea.return($a._searchForExistingFilesManually(Jb,Ra,Ga))})};$a._searchForExistingFilesManually=
function(Jb,Ra,Ga){var ea,Da;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ta){switch(ta.nextAddress){case 1:return ta.yield(Jb.world().multipleChoicePrompt("Add Module",{requester:Jb,choices:["Create New Module","Load Existing Module"]}),2);case 2:ea=ta.yieldResult;if("Create New Module"===ea)return ta.return("[create new module]");if("Load Existing Module"!==ea){ta.jumpTo(3);break}return ta.yield(Jb.world().prompt("URL of module?",{input:Ra,requester:Jb,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),
4);case 4:if(Da=ta.yieldResult)return ta.return([Da]);case 3:throw"Canceled";}})};$a._searchForExistingFilesWeb=function(Jb,Ra,Ga){function ea(wb){wb.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(wb.name())||Ga&&$a.arr.pluck(Ga.modules,"name").includes(wb.url)?!0:!1}var Da,ta,Pa,Ha,tb,Ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wb){switch(wb.nextAddress){case 1:return(Da=Jb.world())&&(ta=Da.showLoadingIndicatorFor(Jb,"Loading existing modules...")),
wb.yield($a.resource(Ra).dirList(5,{exclude:ea}),3);case 3:return wb.yield(wb.yieldResult.map(function(ud){return ud.url}),2);case 2:return Pa=wb.yieldResult,Ha=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(Pa.filter(function(ud){return ud.endsWith(".js")}).map(function(ud){return{isListItem:!0,string:Ga&&0==ud.indexOf(Ga.address)?Ga.name+ud.slice(Ga.address.length):ud,value:ud}})),wb.yield(Promise.resolve(ta&&ta.remove()).then(function(){return Jb.world().filterableListPrompt("What module to load?",
Ha,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:Jb},Jb?{extent:Jb.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:tb=wb.yieldResult;if(!tb||"canceled"===tb.status||!tb.selected.length)throw"Canceled";Ac=tb.selected||tb;Array.isArray(Ac)||(Ac=[Ac]);return wb.return(Ac)}})};$a._createAndLoadModules=function(Jb,Ra){var Ga,ea,Da,ta,Pa,Ha,tb,Ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wb){switch(wb.nextAddress){case 1:Array.isArray(Ra)||(Ra=[Ra]),Ga=[],ea=
$jscomp.makeIterator(Ra),Da=ea.next();case 2:if(Da.done){wb.jumpTo(4);break}ta=Da.value;return wb.yield(Jb.forgetModule(ta,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return wb.yield(Jb.resourceEnsureExistance(ta,'"format esm";\n'),6);case 6:return Pa=wb.yieldResult,Ha=$a,tb=Ha.isTestModule,wb.yield(Pa.read(),7);case 7:if(!tb.call(Ha,wb.yieldResult)){wb.jumpTo(8);break}if(System.global.Mocha&&System.global.chai){wb.jumpTo(8);break}return wb.yield(System.import("mocha-es6"),10);case 10:return wb.yield($a.promise.waitFor(function(){return!!System.global.Mocha&&
!!System.global.chai}),8);case 8:return wb.setCatchFinallyBlocks(12),wb.yield(Jb.importModule(ta),14);case 14:Ga.push({name:ta});wb.leaveTryBlock(3);break;case 12:Ac=wb.enterCatchBlock(),Ga.push({name:ta,error:Ac});case 3:Da=ea.next();wb.jumpTo(2);break;case 4:return wb.return(Ga)}})};$a.modulesInPackage_defaultExclude=function(Jb){return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(Jb.name())?!0:!1};$a.modulesInPackage=uc;$a.obj=ac;$a.promise=Cd;$a.arr=Sb;$a.resource=
xc;$a.isTestModule=Fe;$a.isTestModule=Fe;$a.shortModuleName=Wb;$a.shortModuleName=Wb;$a.interactivelyChangeModule=Cc;$a.interactivelyChangeModule=Cc;$a.interactivelyReloadModule=Td;$a.interactivelyReloadModule=Td;$a.interactivelyUnloadModule=Ec;$a.interactivelyUnloadModule=Ec;$a.interactivelyRemoveModule=Vd;$a.interactivelyRemoveModule=Vd;$a.addModule=Lb;$a.addModule=Lb;$a.interactivelyAddModule=ub;$a.interactivelyAddModule=ub;$a.modulesInPackage=uc;$a.modulesInPackage=uc;var $b=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");
$b.todo=function(Jb){throw Error(Jb+" is not yet implemented!");};$b.parseJsonLikeObj=fd;$b.arr=Sb;$b.Closure=nd;$b.obj=ac;$b.resource=xc;$b.transform=Ud;$b.modules=bd;var Eb=function(Jb){var Ra=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js"),Ga=Ra.hasOwnProperty("AbstractCoreInterface")&&"function"===typeof Ra.AbstractCoreInterface?Ra.AbstractCoreInterface:Ra.AbstractCoreInterface=function(ea){ea&&ea[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return Ic(Ga,Jb,[{key:"dynamicCompletionsForPrefix",value:function(ea,Da,ta){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){$b.todo("dynamicCompletionsForPrefix");Pa.jumpToEnd()})}},{key:"runEval",value:function(ea,Da){$b.todo("runEval")}},{key:"resourceExists",value:function(ea){$b.todo("resourceExists")}},{key:"resourceEnsureExistance",value:function(ea,Da){$b.todo("resourceEnsureExistance")}},{key:"resourceMkdir",value:function(ea){$b.todo("resourceMkdir")}},{key:"resourceRead",
value:function(ea){$b.todo("resourceRead")}},{key:"resourceRemove",value:function(ea){$b.todo("resourceRemove")}},{key:"resourceWrite",value:function(ea,Da){$b.todo("resourceWrite")}},{key:"resourceCreateFiles",value:function(ea,Da){$b.todo("resourceCreateFiles")}},{key:"resourceDirList",value:function(ea,Da,ta){$b.todo("resourceDirList")}},{key:"normalizeSync",value:function(ea,Da,ta){$b.todo("normalizeSync")}},{key:"normalize",value:function(ea,Da,ta){$b.todo("normalize")}},{key:"printSystemConfig",
value:function(){$b.todo("printSystemConfig")}},{key:"getConfig",value:function(){$b.todo("getConfig")}},{key:"setConfig",value:function(ea){$b.todo("setConfig")}},{key:"getPackages",value:function(ea){$b.todo("getPackages")}},{key:"isModuleLoaded",value:function(ea,Da){$b.todo("isModuleLoaded")}},{key:"doesModuleExist",value:function(ea,Da){$b.todo("doesModuleExist")}},{key:"getModules",value:function(){var ea=this,Da,ta;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){return 1==Pa.nextAddress?
(Da=$b.arr,ta=Da.flatmap,Pa.yield(ea.getPackages(),2)):Pa.return(ta.call(Da,Pa.yieldResult,function(Ha){return Ha.modules}))})}},{key:"getModule",value:function(ea){var Da=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ta){return 1==ta.nextAddress?ta.yield(Da.getModules(),2):ta.return(ta.yieldResult.find(function(Pa){return Pa.name===ea}))})}},{key:"getPackage",value:function(ea){var Da=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ta){return 1==ta.nextAddress?
(ea=ea.replace(/\/+$/,""),ta.yield(Da.getPackages(),2)):ta.return(ta.yieldResult.find(function(Pa){return Pa.address===ea||Pa.name===ea}))})}},{key:"getPackageForModule",value:function(ea){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){$b.todo("getPackageForModule");Da.jumpToEnd()})}},{key:"systemConfChange",value:function(ea){var Da=$b.parseJsonLikeObj(ea);["baseURL"].forEach(function(ta){return delete Da[ta]});return this.setConfig(Da)}},{key:"resourcesOfPackage",value:function(ea,
Da){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ta){$b.todo("resourcesOfPackage");ta.jumpToEnd()})}},{key:"registerPackage",value:function(ea){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){$b.todo("registerPackage");Da.jumpToEnd()})}},{key:"importPackage",value:function(ea){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){$b.todo("importPackage");Da.jumpToEnd()})}},{key:"removePackage",value:function(ea){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){$b.todo("removePackage");
Da.jumpToEnd()})}},{key:"reloadPackage",value:function(ea){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){$b.todo("reloadPackage");Da.jumpToEnd()})}},{key:"packageConfChange",value:function(ea,Da){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ta){$b.todo("packageConfChange");ta.jumpToEnd()})}},{key:"importModule",value:function(ea){$b.todo("importModule")}},{key:"forgetModule",value:function(ea,Da){$b.todo("forgetModule")}},{key:"reloadModule",value:function(ea,Da){$b.todo("reloadModule")}},
{key:"moduleFormat",value:function(ea){$b.todo("moduleFormat")}},{key:"moduleRead",value:function(ea){$b.todo("moduleRead")}},{key:"moduleSourceChange",value:function(ea,Da,ta){$b.todo("moduleSourceChange")}},{key:"importsAndExportsOf",value:function(ea,Da){$b.todo("importsAndExportsOf")}},{key:"keyValueListOfVariablesInModule",value:function(ea,Da){$b.todo("keyValueListOfVariablesInModule")}},{key:"moduleWrite",value:function(ea,Da){return this.moduleSourceChange(ea,Da)}}],[{key:Symbol.for("__LivelyClassName__"),
get:function(){return"AbstractCoreInterface"}}],Ra,{pathInPackage:function(){return"interfaces/interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:327,end:3944})}(void 0);$b.AbstractCoreInterface=Eb;$b.AbstractCoreInterface=Eb;$b.AbstractCoreInterface=Eb;var kc=function(Jb){var Ra=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js"),
Ga=Ra.hasOwnProperty("RemoteCoreInterface")&&"function"===typeof Ra.RemoteCoreInterface?Ra.RemoteCoreInterface:Ra.RemoteCoreInterface=function(ea){ea&&ea[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Ic(Ga,Jb,[{key:Symbol.for("lively-instance-initialize"),value:function(){Ic._get(Object.getPrototypeOf(Ga.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.currentEval=null}},{key:"runEval",value:function(ea,
Da){throw Error("Not yet implemented");}},{key:"runEvalAndStringify",value:function(ea,Da){var ta=this;return this.currentEval?this.currentEval.then(function(){return ta.runEvalAndStringify(ea,Da)}):this.currentEval=Promise.resolve().then(function(){var Pa,Ha,tb,Ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wb){switch(wb.nextAddress){case 1:return wb.yield(ta.runEval("\n        Promise.resolve((async "+$b.transform.wrapInFunction(ea)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},Da)),2);case 2:if((Pa=wb.yieldResult)&&Pa.isError)throw Error(String(Pa.value||Pa.error));if(!Pa||!Pa.value)return wb.return(null);if(Ha=Pa.promisedValue){wb.jumpTo(3);break}return wb.yield(Pa.value,4);case 4:Ha=wb.yieldResult;case 3:tb=Ha;if(!tb)return wb.return();if("undefined"===tb)return wb.return(void 0);if("null"===tb)return wb.return(null);if("true"===tb)return wb.return(!0);
if("false"===tb)return wb.return(!1);try{Ac=JSON.parse(tb)}catch(ud){return wb.return(tb)}if(Ac&&Ac.isError)throw Error(String(Ac.value));return wb.return(Ac)}})}).then(function(Pa){delete ta.currentEval;return Pa},function(Pa){delete ta.currentEval;return Promise.reject(Pa)})}},{key:"dynamicCompletionsForPrefix",value:function(ea,Da,ta){var Pa=this,Ha,tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ac){Ha=$b.obj.isString(ta.context)?ta.context:!1;ta=$b.obj.dissoc(ta,["systemInterface",
"System","context"]);tb="\n      var prefix = "+JSON.stringify(Da)+",\n          opts = "+JSON.stringify(ta)+";\n      opts.context = "+Ha+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return Ac.return(Pa.runEvalAndStringify(tb))})}},{key:"evalWithResource",value:function(ea,Da,ta){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+ea+'").'+Da+"("+(ta?JSON.stringify(ta):"")+");\n    ")}},{key:"resourceExists",value:function(ea){return this.evalWithResource(ea,"exists")}},{key:"resourceEnsureExistance",value:function(ea,Da){return this.evalWithResource(ea,
"ensureExistance",Da)}},{key:"resourceMkdir",value:function(ea){return this.evalWithResource(ea,"mkdir")}},{key:"resourceRead",value:function(ea){return this.evalWithResource(ea,"read")}},{key:"resourceRemove",value:function(ea){return this.evalWithResource(ea,"remove")}},{key:"resourceWrite",value:function(ea,Da){return this.evalWithResource(ea,"write",Da)}},{key:"resourceCreateFiles",value:function(ea,Da){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
ea+'", '+JSON.stringify(Da)+")")}},{key:"resourceDirList",value:function(ea,Da,ta){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+ea+'").dirList('+JSON.stringify(Da)+", "+JSON.stringify(ta)+"))\n        .map(({url}) => ({url}))")}},{key:"livelySystemAccessor",value:function(ea){ea=void 0===ea?"livelySystem":ea;return"var "+ea+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
ea+') throw new Error("lively-system-interface not available!");'}},{key:"normalizeSync",value:function(ea,Da,ta){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(ea)+", "+JSON.stringify(Da)+", "+ta+")")}},{key:"normalize",value:function(ea,Da,ta){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(ea)+", "+JSON.stringify(Da)+", "+JSON.stringify(ta)+")")}},{key:"printSystemConfig",value:function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")}},
{key:"getConfig",value:function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')}},{key:"setConfig",value:function(ea){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(ea)+")")}},{key:"getPackages",value:function(ea){ea=Object.assign({excluded:[]},ea);ea.excluded=ea.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(ea)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')}},{key:"getPackageForModule",value:function(ea){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(ea)+")")}},{key:"isModuleLoaded",value:function(ea,Da){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+ea+'", '+Da+")")}},{key:"doesModuleExist",value:function(ea,Da){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+ea+'", '+Da+")")}},{key:"registerPackage",value:function(ea){var Da=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ta){return ta.return(Da.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(ea)+")"))})}},
{key:"importPackage",value:function(ea){var Da=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ta){return ta.return(Da.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(ea)+")"))})}},{key:"removePackage",value:function(ea){var Da=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ta){return ta.return(Da.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(ea)+")"))})}},{key:"reloadPackage",value:function(ea,Da){var ta=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){return Pa.return(ta.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(ea)+", "+JSON.stringify(Da)+")"))})}},{key:"packageConfChange",value:function(ea,Da){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(ea)+", "+JSON.stringify(Da)+")")}},{key:"resourcesOfPackage",value:function(ea,Da){Da=void 0===Da?[".git","node_modules",".module_cache","lively.next-node_modules"]:Da;var ta=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){ea.address&&
(ea=ea.address);return Pa.return(ta.runEvalAndStringify("\n      "+ta.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(ea)+", "+JSON.stringify(Da)+");"))})}},{key:"getModule",value:function(ea){var Da=this,ta;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){if(1==Pa.nextAddress)return Pa.yield(Da.getModules(),2);ta=Pa.yieldResult.find(function(Ha){return Ha.name===ea});return Pa.return(ta?$b.modules.module(ta.name):null)})}},{key:"importModule",
value:function(ea){return this.runEvalAndStringify("lively.modules.System.import("+JSON.stringify(ea)+")")}},{key:"forgetModule",value:function(ea,Da){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ea)+").unload("+JSON.stringify(Da)+")")}},{key:"reloadModule",value:function(ea,Da){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ea)+").reload("+JSON.stringify(Da)+")")}},{key:"moduleFormat",value:function(ea){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(ea)+").format();")}},{key:"moduleRead",value:function(ea){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ea)+").source()")}},{key:"moduleSourceChange",value:function(ea,Da,ta){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ea)+").changeSource("+JSON.stringify(Da)+", "+JSON.stringify(ta)+")")}},{key:"keyValueListOfVariablesInModule",value:function(ea,Da){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+
JSON.stringify(ea)+", "+JSON.stringify(Da)+")")}},{key:"importsAndExportsOf",value:function(ea,Da){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(ea)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(ea)+").exports()})")}},{key:"exportsOfModules",value:function(ea){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(ea)+";\n      options.excludedPackages = ["+ea.excludedPackages.map(function(Da){return"function"===
typeof Da?Da.toString():JSON.stringify(Da)}).join(",")+"]\n      await livelySystem.localInterface.exportsOfModules(options)")}},{key:"searchInPackage",value:function(ea,Da,ta){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(ea)+", "+JSON.stringify(Da)+", "+JSON.stringify(ta)+")")}},{key:"loadMochaTestFile",value:function(ea,Da){Da=void 0===Da?[]:Da;var ta=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){return Pa.return(ta.runEvalAndStringify("\n      "+
ta.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(ea)+", "+JSON.stringify(Da)+"), result;\n      result = {testsByFile}"))})}},{key:"runMochaTests",value:function(ea,Da,ta,Pa){var Ha=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tb){ea&&ea instanceof RegExp&&(ea={isRegExp:!0,value:String(ea).replace(/^\/|\/$/g,"")});return tb.return(Ha.runEvalAndStringify("\n      var grep = "+JSON.stringify(ea)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
Ha.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(Da||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})}}],
[{key:Symbol.for("__LivelyClassName__"),get:function(){return"RemoteCoreInterface"}}],Ra,{pathInPackage:function(){return"interfaces/interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:3953,end:16249})}($b.AbstractCoreInterface);$b.RemoteCoreInterface=kc;$b.RemoteCoreInterface=kc;$b.RemoteCoreInterface=kc;var tc=
lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");tc.obj=ac;tc.string=pd;tc.arr=Sb;tc.resource=xc;tc.createFiles=yd;tc.ast=Ib;tc.modules=bd;tc.vm=Ne;tc.parseJsonLikeObj=fd;tc.AbstractCoreInterface=Eb;tc.classToFunctionTransform=Pe;Eb=function(Jb){var Ra=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js"),Ga=Ra.hasOwnProperty("LocalCoreInterface")&&"function"===typeof Ra.LocalCoreInterface?Ra.LocalCoreInterface:Ra.LocalCoreInterface=
function(ea){ea&&ea[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Ic(Ga,Jb,[{key:"name",get:function(){return"local"}},{key:"dynamicCompletionsForPrefix",value:function(ea,Da,ta){var Pa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){if(1==Ha.nextAddress)return Ha.yield(tc.vm.completions.getCompletions(function(tb){return tc.vm.runEval(tb.replace("return ",""),Object.assign({targetModule:ea,classTransform:tc.classToFunctionTransform},
ta))},Da),2);Pa=Ha.yieldResult;if(Pa.isError)throw Pa.value;return Ha.return({completions:Pa.completions,prefix:Pa.startLetters})})}},{key:"runEval",value:function(ea,Da){return tc.vm.runEval(ea,Object.assign({classTransform:tc.classToFunctionTransform},Da))}},{key:"resourceExists",value:function(ea){return tc.resource(ea).exists()}},{key:"resourceEnsureExistance",value:function(ea,Da){return tc.resource(ea).ensureExistance(Da)}},{key:"resourceMkdir",value:function(ea){return tc.resource(ea).mkdir()}},
{key:"resourceRead",value:function(ea){return tc.resource(ea).read()}},{key:"resourceRemove",value:function(ea){return tc.resource(ea).remove()}},{key:"resourceWrite",value:function(ea,Da){return tc.resource(ea).write(Da)}},{key:"resourceCreateFiles",value:function(ea,Da){return tc.createFiles(ea,Da)}},{key:"resourceDirList",value:function(ea,Da,ta){return tc.resource(ea).dirList(Da,ta)}},{key:"normalizeSync",value:function(ea,Da,ta){return System.decanonicalize(ea,Da,ta)}},{key:"normalize",value:function(ea,
Da,ta){return System.normalize(ea,Da,ta)}},{key:"printSystemConfig",value:function(){return tc.modules.printSystemConfig()}},{key:"getConfig",value:function(){return System.getConfig()}},{key:"setConfig",value:function(ea){tc.modules.System.config(ea)}},{key:"getPackages",value:function(ea){ea=Object.assign({},ea);ea=void 0===ea.excluded?[]:ea.excluded;var Da=ea.filter(function(Pa){return"string"===typeof Pa}),ta=ea.filter(function(Pa){return"function"===typeof Pa});Da=Da.concat(Da.map(function(Pa){return System.decanonicalize(Pa.replace(/\/?$/,
"/")).replace(/\/$/,"")}));return tc.modules.getPackages().filter(function(Pa){return!Da.includes(Pa.url)&&!ta.some(function(Ha){return Ha(Pa.url)})})}},{key:"registerPackage",value:function(ea){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){return Da.return(tc.modules.registerPackage(ea))})}},{key:"importPackage",value:function(ea){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){return Da.return(tc.modules.importPackage(ea))})}},{key:"removePackage",value:function(ea){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){return Da.return(tc.modules.removePackage(ea))})}},
{key:"reloadPackage",value:function(ea,Da){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ta){return ta.return(tc.modules.reloadPackage(ea,Da))})}},{key:"packageConfChange",value:function(ea,Da){var ta=this,Pa,Ha,tb,Ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wb){if(1==wb.nextAddress)return Pa=tc.modules.System,Ha=tc.parseJsonLikeObj(ea),tb=JSON.stringify(Ha,null,2),wb.yield(tc.modules.module(Da).changeSource(tb,{doEval:!1}),2);if(3!=wb.nextAddress)return Pa.set(Da,
Pa.newModule(Ha)),wb.yield(ta.getPackageForModule(Da),3);(Ac=wb.yieldResult)&&tc.modules.applyPackageConfig(Ha,Ac.address);wb.jumpToEnd()})}},{key:"resourcesOfPackage",value:function(ea,Da){Da=void 0===Da?[".git","node_modules",".module_cache"]:Da;var ta,Pa,Ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tb){if(1==tb.nextAddress)return tb.setCatchFinallyBlocks(2),ta=ea.address?ea.address:ea,Pa=tc.modules.getPackage(ta),tb.yield(Pa.resources(void 0,Da),4);if(2!=tb.nextAddress)return tb.return(tb.yieldResult.map(function(Ac){return Object.assign(Ac,
{package:Ac.package.url})}));Ha=tb.enterCatchBlock();console.warn("resourcesOfPackage error for "+ea+": "+Ha);return tb.return([])})}},{key:"getPackageForModule",value:function(ea){return(ea=tc.modules.getPackageOfModule(ea))?ea.asSpec():ea}},{key:"isModuleLoaded",value:function(ea,Da){return tc.modules.isModuleLoaded(ea,Da)}},{key:"doesModuleExist",value:function(ea,Da){return tc.modules.isModuleLoaded(ea,Da)}},{key:"getModule",value:function(ea){return tc.modules.module(ea)}},{key:"importModule",
value:function(ea){return tc.modules.System.import(ea)}},{key:"forgetModule",value:function(ea,Da){return tc.modules.module(ea).unload(Da)}},{key:"reloadModule",value:function(ea,Da){return tc.modules.module(ea).reload(Da)}},{key:"moduleFormat",value:function(ea){return tc.modules.module(ea).format()}},{key:"moduleRead",value:function(ea){return tc.modules.module(ea).source()}},{key:"moduleSourceChange",value:function(ea,Da,ta){return tc.modules.module(ea).changeSource(Da,ta)}},{key:"keyValueListOfVariablesInModule",
value:function(ea,Da){var ta=this,Pa,Ha,tb,Ac,wb,ud,Tb,te;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cd){switch(cd.nextAddress){case 1:if(Da){cd.jumpTo(2);break}return cd.yield(ta.resourceRead(ea),3);case 3:Da=cd.yieldResult;case 2:return Pa="string"===typeof Da?tc.ast.parse(Da):Da,Ha=ta.normalizeSync(ea),ta.moduleFormat(Ha),tb=tc.modules.module(Ha).env().recorder,cd.yield(ta.importsAndExportsOf(Ha,Pa),4);case 4:return Ac=cd.yieldResult,wb=tc.ast.query.topLevelDeclsAndRefs(Pa),ud=
tc.arr.sortByKey(tc.ast.query.declarationsOfScope(wb.scope,!0),"start"),Tb=tc.arr.pluck(wb.scope.importSpecifiers,"name"),te=0,cd.return(ud.map(function(Lc){var Hb=Lc.name.length,Be=Ac.exports.find(function(Gb){return Gb.local===Lc.name}),Ob=tc.arr.include(Tb,Lc.name);Be&&(Hb+=9);Ob&&(Hb+=9);te=Math.max(te,Hb);return{isExport:Be,isImport:Ob,name:Lc.name,value:tb[Lc.name],node:Lc,printedName:Lc.name+(Be?" [export]":"")+(Ob?" [import]":""),printedValue:tc.obj.inspect(tb[Lc.name],{maxDepth:1}).replace(/\n/g,
"")}}).map(function(Lc){return{isListItem:!0,value:Lc,string:Lc.printedName+tc.string.indent(" = "+Lc.printedValue," ",te-Lc.printedName.length)}}))}})}},{key:"importsAndExportsOf",value:function(ea,Da){var ta;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){return 1==Pa.nextAddress?Pa.yield(tc.modules.module(ea).imports(Da),2):3!=Pa.nextAddress?(ta=Pa.yieldResult,Pa.yield(tc.modules.module(ea).exports(Da),3)):Pa.return({imports:ta,exports:Pa.yieldResult})})}},{key:"exportsOfModules",
value:function(ea){return tc.modules.ExportLookup.run(System,ea)}},{key:"searchInPackage",value:function(ea,Da,ta){return tc.modules.getPackage(ea).search(Da,ta)}},{key:"runMochaTests",value:function(ea,Da,ta,Pa){var Ha,tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ac){if(1==Ac.nextAddress)return Ac.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);Ha=Ac.yieldResult;tb=Ha.runMochaTests;return Ac.return(tb(ea,Da,ta,Pa))})}},{key:"loadMochaTestFile",value:function(ea,
Da){var ta,Pa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){if(1==Ha.nextAddress)return Ha.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);ta=Ha.yieldResult;Pa=ta.loadMochaTestFile;return Ha.return(Pa(ea,Da))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"LocalCoreInterface"}}],Ra,{pathInPackage:function(){return"interfaces/local-system.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},
package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:411,end:8203})}(tc.AbstractCoreInterface);tc.LocalCoreInterface=Eb;tc.LocalCoreInterface=Eb;tc.LocalCoreInterface=Eb;var Sc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");Sc.evalStrategies=Ie;Sc.RemoteCoreInterface=kc;var Pd=function(Jb){var Ra=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js"),Ga=Ra.hasOwnProperty("HTTPCoreInterface")&&
"function"===typeof Ra.HTTPCoreInterface?Ra.HTTPCoreInterface:Ra.HTTPCoreInterface=function(ea){ea&&ea[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Ic(Ga,Jb,[{key:Symbol.for("lively-instance-initialize"),value:function(ea){Ic._get(Object.getPrototypeOf(Ga.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.currentEval=null;this.url=ea;this.server=new Sc.evalStrategies.HttpEvalStrategy(ea)}},{key:"name",
get:function(){return this.url}},{key:"description",get:function(){return this.url.replace(/^https?:\/\//,"")}},{key:"runEval",value:function(ea,Da){return this.server.runEval(ea,Da)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"HTTPCoreInterface"}}],Ra,{pathInPackage:function(){return"interfaces/http-interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",
version:"0.2.1"}}},{start:106,end:512})}(Sc.RemoteCoreInterface);Sc.HTTPCoreInterface=Pd;Sc.HTTPCoreInterface=Pd;Sc.HTTPCoreInterface=Pd;var ec=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");ec.evalStrategies=Ie;ec.RemoteCoreInterface=kc;kc=function(Jb){var Ra=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js"),Ga=Ra.hasOwnProperty("L2LCoreInterface")&&"function"===typeof Ra.L2LCoreInterface?Ra.L2LCoreInterface:Ra.L2LCoreInterface=
function(ea){ea&&ea[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Ic(Ga,Jb,[{key:Symbol.for("lively-instance-initialize"),value:function(ea,Da){Ic._get(Object.getPrototypeOf(Ga.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.targetId=ea;this.peer=Da}},{key:"name",get:function(){return"l2l "+this.targetId}},{key:"description",get:function(){var ea=this.peer,Da="l2l "+this.targetId.slice(0,5);if(ea){var ta=
ea.location,Pa=ea.type,Ha=ea.user;ea=ea.world;Pa&&(Da+=", "+Pa);ta&&(Da+=", "+ta.replace(/^https?:\/\//,"")+(ea?"/"+ea:""));Ha&&(Da+=", "+Ha.name)}return Da}},{key:"client",get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}},{key:"isConnected",value:function(){var ea=this,Da,ta,Pa,Ha,tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ac){if(1==Ac.nextAddress)return Da=ea,ta=Da.client,Pa=Da.targetId,Ac.yield(ta.sendToAndWait(ta.trackerId,
"getClients",{}),2);Ha=Ac.yieldResult;tb=Ha.data;return Ac.return(tb.some(function(wb){wb=$jscomp.makeIterator(wb).next().value;return Pa===wb}))})}},{key:"runEval",value:function(ea,Da){var ta=this,Pa,Ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tb){Pa=ta.client;if(!Pa)throw Error("No lively.2lively default client available!");Ha=new ec.evalStrategies.L2LEvalStrategy(Pa,ta.targetId);return tb.return(Ha.runEval(ea,Da))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"L2LCoreInterface"}}],
Ra,{pathInPackage:function(){return"interfaces/l2l-interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:106,end:1449})}(ec.RemoteCoreInterface);ec.L2LCoreInterface=kc;ec.L2LCoreInterface=kc;ec.L2LCoreInterface=kc;var Xb=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");Xb.systemInterfaceNamed=
dc;Xb.interactivelyCreatePackage=me;Xb.interactivelyLoadPackage=Yb;Xb.interactivelyReloadPackage=Yc;Xb.interactivelyUnloadPackage=Nd;Xb.interactivelyRemovePackage=gd;Xb.showExportsAndImportsOf=ae;Xb.shortModuleName=Wb;Xb.addModule=Lb;Xb.interactivelyChangeModule=Cc;Xb.interactivelyReloadModule=Td;Xb.interactivelyUnloadModule=Ec;Xb.interactivelyRemoveModule=Vd;Xb.interactivelyAddModule=ub;Xb.modulesInPackage=uc;Xb.LocalCoreInterface=Eb;Xb.HTTPCoreInterface=Pd;Xb.L2LCoreInterface=kc;kc=Wa("Interface",
function(Jb){var Ra=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js"),Ga=Ra.hasOwnProperty("Interface")&&"function"===typeof Ra.Interface?Ra.Interface:Ra.Interface=function(ea){ea&&ea[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Ic(Ga,Jb,[{key:Symbol.for("lively-instance-initialize"),value:function(ea){this.coreInterface=ea}},{key:"isSystemInterface",get:function(){return!0}},{key:"name",get:function(){return this.coreInterface.name}},
{key:"dynamicCompletionsForPrefix",value:function(ea,Da,ta){return this.coreInterface.dynamicCompletionsForPrefix(ea,Da,ta)}},{key:"runEval",value:function(ea,Da){return this.coreInterface.runEval(ea,Da)}},{key:"printSystemConfig",value:function(ea,Da,ta){return this.coreInterface.printSystemConfig(ea,Da,ta)}},{key:"getConfig",value:function(ea,Da,ta){return this.coreInterface.getConfig(ea,Da,ta)}},{key:"getPackages",value:function(ea){return this.coreInterface.getPackages(ea)}},{key:"getModules",
value:function(ea,Da,ta){return this.coreInterface.getModules(ea,Da,ta)}},{key:"getModule",value:function(ea,Da,ta){return this.coreInterface.getModule(ea,Da,ta)}},{key:"getPackage",value:function(ea,Da,ta){return this.coreInterface.getPackage(ea,Da,ta)}},{key:"getPackageForModule",value:function(ea,Da,ta){return this.coreInterface.getPackageForModule(ea,Da,ta)}},{key:"resourcesOfPackage",value:function(ea,Da){return this.coreInterface.resourcesOfPackage(ea,Da)}},{key:"systemConfChange",value:function(ea,
Da,ta){return this.coreInterface.systemConfChange(ea,Da,ta)}},{key:"registerPackage",value:function(ea){return this.coreInterface.registerPackage(ea)}},{key:"importPackage",value:function(ea){return this.coreInterface.importPackage(ea)}},{key:"removePackage",value:function(ea){return this.coreInterface.removePackage(ea)}},{key:"reloadPackage",value:function(ea){return this.coreInterface.reloadPackage(ea)}},{key:"packageConfChange",value:function(ea,Da){return this.coreInterface.packageConfChange(ea,
Da)}},{key:"keyValueListOfVariablesInModule",value:function(ea,Da){return this.coreInterface.keyValueListOfVariablesInModule(ea,Da)}},{key:"interactivelyCreatePackage",value:function(ea){return Xb.interactivelyCreatePackage(this.coreInterface,ea)}},{key:"interactivelyLoadPackage",value:function(ea,Da){return Xb.interactivelyLoadPackage(this.coreInterface,ea,Da)}},{key:"interactivelyReloadPackage",value:function(ea,Da){return Xb.interactivelyReloadPackage(this.coreInterface,ea,Da)}},{key:"interactivelyUnloadPackage",
value:function(ea,Da,ta){return Xb.interactivelyUnloadPackage(this.coreInterface,ea,Da,ta)}},{key:"interactivelyRemovePackage",value:function(ea,Da){return Xb.interactivelyRemovePackage(this.coreInterface,ea,Da)}},{key:"isModuleLoaded",value:function(ea,Da){return this.coreInterface.isModuleLoaded(ea,Da)}},{key:"doesModuleExist",value:function(ea,Da){return this.coreInterface.doesModuleExist(ea,Da)}},{key:"createModule",value:function(ea){return Xb.addModule(this.coreInterface,ea)}},{key:"importModule",
value:function(ea){return this.coreInterface.importModule(ea)}},{key:"forgetModule",value:function(ea,Da){return this.coreInterface.forgetModule(ea,Da)}},{key:"reloadModule",value:function(ea,Da){return this.coreInterface.reloadModule(ea,Da)}},{key:"moduleFormat",value:function(ea){return this.coreInterface.moduleFormat(ea)}},{key:"moduleRead",value:function(ea){return this.coreInterface.moduleRead(ea)}},{key:"moduleWrite",value:function(ea,Da){return this.coreInterface.moduleWrite(ea,Da)}},{key:"getModulesInPackage",
value:function(ea){return Xb.modulesInPackage(this.coreInterface,ea)}},{key:"shortModuleName",value:function(ea,Da){return Xb.shortModuleName(this.coreInterface,ea,Da)}},{key:"interactivelyChangeModule",value:function(ea,Da,ta){return Xb.interactivelyChangeModule(this.coreInterface,ea,Da,ta)}},{key:"interactivelyReloadModule",value:function(ea,Da){return Xb.interactivelyReloadModule(this.coreInterface,ea,Da)}},{key:"interactivelyUnloadModule",value:function(ea,Da){return Xb.interactivelyUnloadModule(this.coreInterface,
ea,Da)}},{key:"interactivelyRemoveModule",value:function(ea,Da){return Xb.interactivelyRemoveModule(this.coreInterface,ea,Da)}},{key:"interactivelyAddModule",value:function(ea,Da){return Xb.interactivelyAddModule(this.coreInterface,ea,Da)}},{key:"showExportsAndImportsOf",value:function(ea,Da){return Xb.showExportsAndImportsOf(this.coreInterface,ea,Da)}},{key:"exportsOfModules",value:function(ea){return this.coreInterface.exportsOfModules(ea)}},{key:"searchInPackage",value:function(ea,Da,ta){return this.coreInterface.searchInPackage(ea,
Da,ta)}},{key:"searchInAllPackages",value:function(ea,Da){Da=void 0===Da?{}:Da;var ta=this,Pa,Ha,tb,Ac,wb,ud,Tb,te;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cd){switch(cd.nextAddress){case 1:return(Pa=Da.progress)&&Pa.step("Fetching Packages...",0),cd.yield(ta.coreInterface.getPackages({excluded:Da.excludedPackages}),2);case 2:Ha=cd.yieldResult,tb=[],Pa&&Pa.step("Fetching Packages...",.1),Ac=0;case 3:if(!(Ac<Ha.length)){cd.jumpTo(5);break}wb=Ha[Ac];ud=wb.url;if(!ud||"no group"===
ud){cd.jumpTo(4);break}Pa&&Pa.step(ud.replace(System.baseURL,"").slice(0,20),.1+Ac/Ha.length*.9);cd.setCatchFinallyBlocks(6);return cd.yield(ta.coreInterface.searchInPackage(ud,ea,Da),8);case 8:Tb=cd.yieldResult;tb=tb.concat(Tb);cd.leaveTryBlock(4);break;case 6:te=cd.enterCatchBlock(),console.error("Error searching in package "+ud+":\n"+te.stack);case 4:Ac++;cd.jumpTo(3);break;case 5:return cd.return(tb)}})}},{key:"loadMochaTestFile",value:function(ea,Da){return this.coreInterface.loadMochaTestFile(ea,
Da)}},{key:"runMochaTests",value:function(ea,Da,ta,Pa){return this.coreInterface.runMochaTests(ea,Da,ta,Pa)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Interface"}}],Ra,{pathInPackage:function(){return"index.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:679,end:6188})}(void 0));Xb.Interface=kc;Xb.Interface=
kc;Xb.Interface=kc;Xb.systemInterfaceNamed=dc;Xb.systemInterfaceNamed=dc;kc=Wa("localInterface",new Xb.Interface(new Xb.LocalCoreInterface));Xb.localInterface=kc;Xb.localInterface=kc;Xb.localInterface=kc;Xb.httpInterfaces={};kc=Wa("serverInterfaceFor",function(Jb){return Xb.httpInterfaces[Jb]||(Xb.httpInterfaces[Jb]=new Xb.Interface(new Xb.HTTPCoreInterface(Jb)))});Xb.serverInterfaceFor=kc;Xb.serverInterfaceFor=kc;Xb.serverInterfaceFor=kc;Xb.l2lInterfaces={};kc=Wa("l2lInterfaceFor",function(Jb,Ra){return Xb.l2lInterfaces[Jb]||
(Xb.l2lInterfaces[Jb]=new Xb.Interface(new Xb.L2LCoreInterface(Jb,Ra)))});Xb.l2lInterfaceFor=kc;Xb.l2lInterfaceFor=kc;Xb.l2lInterfaceFor=kc}}});