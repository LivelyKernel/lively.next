System.register(["./__root_module__-fd8ea0c8.js","kld-intersections"],function(Ca){var Bb,Kb,lc,bc,Td,Xc,Wd,$c,Pc,md,ge,Qe,kf,ke,cc;return{setters:[function(Hc){Bb=Hc.a7;Kb=Hc.P;lc=Hc.a6;bc=Hc.p;Td=Hc.bF;Xc=Hc.B;Wd=Hc.bG;$c=Hc.r;Pc=Hc.aU;md=Hc.bH;ge=Hc.bI;Qe=Hc.bJ;kf=Hc.bK;ke=Hc.bL;cc=Hc.l},function(){}],execute:function(){function Hc(Dc,Ic,Vb,Lc){Lc=void 0===Lc?{}:Lc;Lc=Lc.package||ec.ObjectPackage.lookupPackageForObject(Dc,Lc);if(!Lc)throw Error("Object is not part of an object package: "+Dc);
return Lc.addScript(Dc,Ic,Vb)}function Nd(Dc,Ic){Ic=ec.normalizeOptions(Ic).System;Dc=(Dc=Dc[Symbol.for("lively-module-meta")])?Dc.package.name:null;return(Ic=(Dc?ec.lookupPackage(Ic,Dc):{}).pkg)?!!ec.ObjectPackage.forSystemPackage(Ic):!1}Ca({addScript:Hc,isObjectClass:Nd});var ec=lively.FreezerRuntime.recorderFor("lively.classes/object-classes.js");ec.normalizeOptions=function(Dc){Dc=Object.assign({baseURL:ec.defaultBaseURL,System:System},Dc);Dc.baseURL=Dc.baseURL.replace(/\/$/,"");return Dc};ec.addScript=
Hc;ec.isObjectClass=Nd;ec.string=Bb;ec.Path=Kb;ec.arr=lc;ec.parse=bc;ec.isValidIdentifier=Td;ec.stringify=Xc;ec.parseFunction=Wd;ec.resource=$c;ec.runEval=Pc;ec.scripting=md;ec.ExportLookup=ge;var $d=ec.scripting;ec.ensurePackage=$d.ensurePackage;ec.registerPackage=$d.registerPackage;ec.importPackage=$d.importPackage;ec.lookupPackage=$d.lookupPackage;ec.module=$d.module;ec.ImportInjector=$d.ImportInjector;ec.RuntimeSourceDescriptor=Qe;ec.toJsIdentifier=kf;ec.adoptObject=ke;ec.classToFunctionTransform=
cc;ec.objectPackageSym=Symbol.for("lively-object-package-data");ec.defaultBaseURL="local://lively-object-modules";ec.globalClasses=Object.keys(System.global).map(function(Dc){Dc=System.global[Dc];return"function"===typeof Dc&&Dc.name&&Dc}).filter(Boolean);ec.addScript=Hc;ec.addScript=Hc;ec.isObjectClass=Nd;ec.isObjectClass=Nd;ec._packageStore=ec._packageStore||{};$d=function(Dc,Ic){this._id=Dc;this.options=ec.normalizeOptions(Ic)};$d.lookupPackageForObject=function(Dc,Ic){return this.lookupPackageForClass(Dc.constructor,
Ic)};$d.lookupPackageForClass=function(Dc,Ic){Ic=ec.normalizeOptions(Ic).System;Dc=(Dc=Dc[Symbol.for("lively-module-meta")])?Dc.package.name:null;return(Ic=(Dc?ec.lookupPackage(Ic,Dc):{}).pkg)?ec.ObjectPackage.forSystemPackage(Ic):null};$d.forSystemPackage=function(Dc){return this.packageStore[Dc.name]};$d.withId=function(Dc,Ic){return this.packageStore[Dc]||(this.packageStore[Dc]=new this(Dc,Ic))};$d.prototype.resource=function(Dc){Dc=void 0===Dc?"":Dc;return ec.resource(this.packageURL).join(Dc)};
$d.prototype.load=function(){return ec.importPackage(this.System,this.packageURL)};$d.prototype.ensureExistance=function(){var Dc=this,Ic,Vb,Lc,dd,Hd,Ld,wc,rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gb){switch(Gb.nextAddress){case 1:return Ic=Dc.resource("/"),Gb.yield(Ic.exists(),2);case 2:if(Gb.yieldResult)return Gb.return();Vb=[{resource:Ic}];Lc=[{resource:Dc.resource("package.json"),content:JSON.stringify(Dc.config,null,2)}];return Gb.yield(Promise.all(Vb.map(function(Oa){return Oa.resource.mkdir()})),
3);case 3:return Gb.yield(Promise.all(Lc.map(function(Oa){var ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){switch(Qa.nextAddress){case 1:return Qa.yield(Oa.resource.exists(),2);case 2:if(!(ab=!Qa.yieldResult)){Qa.jumpTo(3);break}return Qa.yield(Oa.resource.write(Oa.content),4);case 4:ab=Qa.yieldResult;case 3:return Qa.return(ab)}})})),4);case 4:return Gb.yield(Dc.objectModule.ensureExistance(),5);case 5:return dd=Dc,Hd=dd.System,Ld=dd.packageURL,wc=dd.config,Gb.yield(ec.ensurePackage(Hd,
Ld),6);case 6:return rb=Gb.yieldResult,rb.registerWithConfig(wc),console.log(Dc.packageURL+" REGISTERED"),Gb.return(Dc)}})};$d.prototype.ensureObjectClass=function(Dc){var Ic=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vb){return 1==Vb.nextAddress?Vb.yield(Ic.ensureExistance(),2):Vb.return(Ic.objectModule.ensureObjectClass(Dc))})};$d.prototype.adoptObject=function(Dc){var Ic=this,Vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lc){if(1==Lc.nextAddress)return Ic.objectClass===
Dc.constructor?Lc.return():Lc.yield(Ic.ensureObjectClass(Dc.constructor),2);Vb=Lc.yieldResult;ec.adoptObject(Dc,Vb);Lc.jumpToEnd()})};$d.prototype.addScript=function(Dc,Ic,Vb){return this.objectModule.addScript(Dc,Ic,Vb)};$d.prototype.remove=function(){this.systemPackage.remove();delete ec.ObjectPackage.packageStore[this.id];return this.resource().remove()};$d.prototype.renameObjectClass=function(Dc,Ic){Ic=void 0===Ic?[]:Ic;var Vb=this,Lc,dd,Hd,Ld,wc,rb,Gb,Oa,ab,Qa,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){if(1==
eb.nextAddress){Lc=Vb;dd=Lc.objectClass;Hd=Lc.System;if(!dd||dd[Symbol.for("__LivelyClassName__")]===Dc)return eb.return(dd);if(!ec.isValidIdentifier(Dc))throw Error(Dc+" is not a valid name for a class");wc=Ld=ec.RuntimeSourceDescriptor.for(dd,Hd);rb=wc.source;Gb=wc.ast;Oa=Gb.id;ab=Oa.start;Qa=Oa.end;return eb.yield(Ld.changeSource(rb.slice(0,ab)+Dc+rb.slice(Qa)),2)}Ja=Vb.objectClass;Ic.forEach(function(Rb){Rb.constructor=Ja;Rb.__proto__=Ja.prototype});return eb.return(Ja)})};$d.prototype.fork=function(Dc,
Ic){var Vb=this,Lc,dd,Hd,Ld,wc,rb,Gb,Oa,ab,Qa,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){switch(eb.nextAddress){case 1:return Lc=Vb,dd=Lc.System,Hd=Lc.baseURL,Ld=Lc.objectClass,Ic=Object.assign({System:dd,baseURL:Hd},Ic),wc=ec.RuntimeSourceDescriptor.for(Ld),rb=wc._renamedSource(Dc),Gb=rb.moduleSource,Oa=ec.ObjectPackage.withId(Dc,Ic),eb.yield(Oa.ensureExistance(),2);case 2:return ab=Oa,Qa=ab.objectModule,Ja=Qa.systemModule,eb.yield(Ja.load({format:"esm"}),3);case 3:return eb.yield(Ja.changeSource(Gb),
4);case 4:return eb.return(Oa)}})};$jscomp.global.Object.defineProperties($d.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return this._id}},name:{configurable:!0,enumerable:!0,get:function(){return this.id}},System:{configurable:!0,enumerable:!0,get:function(){return this.options.System}},baseURL:{configurable:!0,enumerable:!0,get:function(){return this.options.baseURL}},packageURL:{configurable:!0,enumerable:!0,get:function(){return this.baseURL+("/"+this.id)}},config:{configurable:!0,
enumerable:!0,get:function(){return{name:this.name,version:"0.1.0",lively:{isObjectPackage:!0}}}},systemPackage:{configurable:!0,enumerable:!0,get:function(){return ec.lookupPackage(this.System,this.packageURL,!0).pkg}},objectModule:{configurable:!0,enumerable:!0,get:function(){return this._objectModule||(this._objectModule=new ec.ObjectModule("index.js",this))}},objectClass:{configurable:!0,enumerable:!0,get:function(){return this.objectModule.objectClass}}});$jscomp.global.Object.defineProperties($d,
{packageStore:{configurable:!0,enumerable:!0,get:function(){return this._packageStore||(this._packageStore=ec._packageStore)}}});Ca("default",$d);ec.ObjectPackage=$d;var le=function(Dc,Ic){if(!Dc)throw Error("ObjectModule needs package!");if(!Ic)throw Error("ObjectModule needs package!");this._moduleName=Dc;this._objectPackage=Ic};le.prototype.read=function(){return this.resource.read()};le.prototype.write=function(Dc){return this.resource.write(Dc)};le.prototype.ensureExistance=function(){var Dc=
this,Ic,Vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lc){switch(Lc.nextAddress){case 1:return Ic=Dc.resource,Lc.yield(Ic.exists(),2);case 2:if(Lc.yieldResult){Lc.jumpTo(3);break}return Lc.yield(Ic.write("'format esm';\n"),4);case 4:Vb={},Dc.System.config({meta:(Vb[Dc.url]={format:"esm"},Vb)});case 3:return Lc.return(Dc)}})};le.prototype.ensureObjectClass=function(Dc){var Ic=this,Vb=this.objectClass;return Vb&&Vb.prototype.__proto__===Dc.prototype?Vb:Promise.resolve(this.ensureObjectClassSource(Dc)).then(function(Lc){var dd=
Lc.source,Hd=Lc.moduleId,Ld=Lc.className,wc=Lc.bindings,rb=Ic.System;Lc=ec.module(rb,Hd);if(wc)for(var Gb in wc)Lc.define(Gb,wc[Gb]);dd=ec.runEval(dd,{classTransform:ec.classToFunctionTransform,sync:!0,targetModule:Hd,System:rb});if(dd.isError)throw dd.value;dd=Lc.recorder[Ld];if(!dd)throw Error("Failed to define class "+Ld+" in "+Hd);return dd})};le.prototype.ensureObjectClassSource=function(Dc){return this.createDefaultClassDeclaration(Dc)};le.prototype.createDefaultClassDeclaration=function(Dc){Dc=
void 0===Dc?Object:Dc;var Ic=this,Vb,Lc,dd,Hd,Ld,wc,rb,Gb,Oa,ab,Qa,Ja,eb,Rb,zc,sb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ab){switch(Ab.nextAddress){case 1:Vb=Ic;Lc=Vb.System;dd=Vb.systemModule;Hd=Vb.objectPackage;Ld=ec.string.capitalize(ec.toJsIdentifier(Hd.id));wc=Dc[Symbol.for("__LivelyClassName__")];rb=!wc;Gb=ec.globalClasses.includes(Dc);Oa="";ab=null;if(rb){wc="__anonymous_superclass__";Qa={};ab=(Qa[wc]=Dc,Qa);Ab.jumpTo(2);break}if(Gb){Ab.jumpTo(2);break}return Ab.yield(ec.ExportLookup.findExportOfValue(Dc,
Lc),4);case 4:(Ja=Ab.yieldResult)?(eb=ec.ImportInjector.run(Lc,dd.id,dd.package(),"",Ja),Rb=eb.standaloneImport,Oa+=Rb+"\n\n"):(zc={},ab=(zc[wc]=Dc,zc));case 2:return Ld===wc&&(Ld="Object"+Ld),sb="Object"===wc?"class "+Ld+" {}\n":"class "+Ld+" extends "+wc+" {}\n",Oa+="export default "+sb+"\n",Ab.yield(dd.changeSource(Oa),5);case 5:return Ab.yield(dd.load(),6);case 6:return Ab.return({source:Oa,className:Ld,moduleId:Ic.url,bindings:ab})}})};le.prototype.addScript=function(Dc,Ic,Vb){var Lc=this,dd,
Hd,Ld,wc,rb,Gb,Oa,ab,Qa,Ja,eb,Rb,zc,sb,Ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){switch(vb.nextAddress){case 1:if(Dc.constructor===Lc.objectClass){dd=Dc.constructor;vb.jumpTo(2);break}return vb.yield(Lc.ensureObjectClass(Dc.constructor),3);case 3:dd=vb.yieldResult;case 2:Hd=dd;Ld="function"===typeof Ic?String(Ic):Ic;wc=ec.parseFunction(Ld);rb=ec.RuntimeSourceDescriptor.for(Hd,Lc.System);Vb||(Vb=ec.Path("id.name").get(wc));if(!Vb)throw Error("No name, cannot add "+ec.string.truncate(Ld,
30).replace(/\n/g,"")+"!");Gb=ec.toJsIdentifier(Vb);console.assert("FunctionExpression"===wc.type||"ArrowFunctionExpression"===wc.type,"not a function expression but: "+wc.type);Oa=wc.params.map(function(ha){return Ld.slice(ha.start,ha.end)});ab="BlockStatement"===wc.body.type?Ld.slice(wc.body.start,wc.body.end):"{ return "+Ld.slice(wc.body.start,wc.body.end)+" }";Qa=Gb+"("+Oa.join(",")+") "+ab;"ArrowFunctionExpression"===wc.type&&(wc.type="FunctionExpression");Ja=rb.source;eb=rb.ast;if(!eb)throw Error("cannot find class decl of "+
rb.module.id);(Rb=eb.body.body.find(function(ha){return ha.key.name===Gb&&!ha.static}))?Ja=Ja.slice(0,Rb.start)+Qa+Ja.slice(Rb.end):(zc=Ja.lastIndexOf("}"),sb=Ja.slice(0,zc),Ab=Ja.slice(zc),/\n\s*$/m.test(sb)||(sb+="\n"),Qa=ec.string.changeIndent(Qa,"  ",1),/^[ ]*\n/m.test(Ab)||(Ab="\n"+Ab),Ja=sb+Qa+Ab);return vb.yield(rb.changeSource(Ja),4);case 4:return vb.return({script:Hd.prototype[Gb],klass:Hd,module:rb.module.id,methodName:Gb})}})};$jscomp.global.Object.defineProperties(le.prototype,{objectPackage:{configurable:!0,
enumerable:!0,get:function(){return this._objectPackage}},objectClass:{configurable:!0,enumerable:!0,get:function(){var Dc=this.systemModule;return Dc.isLoaded()?Dc.System.get(Dc.id).default:null}},moduleName:{configurable:!0,enumerable:!0,get:function(){return this._moduleName}},systemModule:{configurable:!0,enumerable:!0,get:function(){return ec.module(this.System,this.url)}},System:{configurable:!0,enumerable:!0,get:function(){return this.objectPackage.System}},resource:{configurable:!0,enumerable:!0,
get:function(){return this.objectPackage.resource(this.moduleName)}},url:{configurable:!0,enumerable:!0,get:function(){return this.resource.url}}});ec.ObjectModule=le;ec.default=$d}}});