System.register(["./__root_module__-5a58cfed.js","kld-intersections"],function(Ca){var Cb,Vb,lc,gc,fe,fd,Zd,id,Uc,Ad,Nd,ee,Ud,kd,cb;return{setters:[function(Fb){Cb=Fb.s;Vb=Fb.P;lc=Fb.a4;gc=Fb.p;fe=Fb.bE;fd=Fb.B;Zd=Fb.bF;id=Fb.r;Uc=Fb.aQ;Ad=Fb.bG;Nd=Fb.bH;ee=Fb.bI;Ud=Fb.bJ;kd=Fb.bK;cb=Fb.n},function(){}],execute:function(){function Fb(tc,bd,Xb,Tb){Tb=void 0===Tb?{}:Tb;Tb=Tb.package||pc.ObjectPackage.lookupPackageForObject(tc,Tb);if(!Tb)throw Error("Object is not part of an object package: "+tc);
return Tb.addScript(tc,bd,Xb)}function vc(tc,bd){bd=pc.normalizeOptions(bd).System;tc=(tc=tc[Symbol.for("lively-module-meta")])?tc.package.name:null;return(bd=(tc?pc.lookupPackage(bd,tc):{}).pkg)?!!pc.ObjectPackage.forSystemPackage(bd):!1}Ca({addScript:Fb,isObjectClass:vc});var pc=lively.FreezerRuntime.recorderFor("lively.classes/object-classes.js");pc.normalizeOptions=function(tc){tc=Object.assign({baseURL:pc.defaultBaseURL,System:System},tc);tc.baseURL=tc.baseURL.replace(/\/$/,"");return tc};pc.addScript=
Fb;pc.isObjectClass=vc;pc.string=Cb;pc.Path=Vb;pc.arr=lc;pc.parse=gc;pc.isValidIdentifier=fe;pc.stringify=fd;pc.parseFunction=Zd;pc.resource=id;pc.runEval=Uc;pc.scripting=Ad;pc.ExportLookup=Nd;var sd=pc.scripting;pc.ensurePackage=sd.ensurePackage;pc.registerPackage=sd.registerPackage;pc.importPackage=sd.importPackage;pc.lookupPackage=sd.lookupPackage;pc.module=sd.module;pc.ImportInjector=sd.ImportInjector;pc.RuntimeSourceDescriptor=ee;pc.toJsIdentifier=Ud;pc.adoptObject=kd;pc.classToFunctionTransform=
cb;pc.objectPackageSym=Symbol.for("lively-object-package-data");pc.defaultBaseURL="local://lively-object-modules";pc.globalClasses=Object.keys(System.global).map(function(tc){tc=System.global[tc];return"function"===typeof tc&&tc.name&&tc}).filter(Boolean);pc.addScript=Fb;pc.addScript=Fb;pc.isObjectClass=vc;pc.isObjectClass=vc;pc._packageStore=pc._packageStore||{};sd=function(tc,bd){this._id=tc;this.options=pc.normalizeOptions(bd)};sd.lookupPackageForObject=function(tc,bd){return this.lookupPackageForClass(tc.constructor,
bd)};sd.lookupPackageForClass=function(tc,bd){bd=pc.normalizeOptions(bd).System;tc=(tc=tc[Symbol.for("lively-module-meta")])?tc.package.name:null;return(bd=(tc?pc.lookupPackage(bd,tc):{}).pkg)?pc.ObjectPackage.forSystemPackage(bd):null};sd.forSystemPackage=function(tc){return this.packageStore[tc.name]};sd.withId=function(tc,bd){return this.packageStore[tc]||(this.packageStore[tc]=new this(tc,bd))};sd.prototype.resource=function(tc){tc=void 0===tc?"":tc;return pc.resource(this.packageURL).join(tc)};
sd.prototype.load=function(){return pc.importPackage(this.System,this.packageURL)};sd.prototype.ensureExistance=function(){var tc=this,bd,Xb,Tb,Oc,td,Ob,sb,hb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qb){switch(qb.nextAddress){case 1:return bd=tc.resource("/"),qb.yield(bd.exists(),2);case 2:if(qb.yieldResult)return qb.return();Xb=[{resource:bd}];Tb=[{resource:tc.resource("package.json"),content:JSON.stringify(tc.config,null,2)}];return qb.yield(Promise.all(Xb.map(function(Aa){return Aa.resource.mkdir()})),
3);case 3:return qb.yield(Promise.all(Tb.map(function(Aa){var bb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wb){switch(wb.nextAddress){case 1:return wb.yield(Aa.resource.exists(),2);case 2:if(!(bb=!wb.yieldResult)){wb.jumpTo(3);break}return wb.yield(Aa.resource.write(Aa.content),4);case 4:bb=wb.yieldResult;case 3:return wb.return(bb)}})})),4);case 4:return qb.yield(tc.objectModule.ensureExistance(),5);case 5:return Oc=tc,td=Oc.System,Ob=Oc.packageURL,sb=Oc.config,qb.yield(pc.ensurePackage(td,
Ob),6);case 6:return hb=qb.yieldResult,hb.registerWithConfig(sb),console.log(tc.packageURL+" REGISTERED"),qb.return(tc)}})};sd.prototype.ensureObjectClass=function(tc){var bd=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xb){return 1==Xb.nextAddress?Xb.yield(bd.ensureExistance(),2):Xb.return(bd.objectModule.ensureObjectClass(tc))})};sd.prototype.adoptObject=function(tc){var bd=this,Xb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Tb){if(1==Tb.nextAddress)return bd.objectClass===
tc.constructor?Tb.return():Tb.yield(bd.ensureObjectClass(tc.constructor),2);Xb=Tb.yieldResult;pc.adoptObject(tc,Xb);Tb.jumpToEnd()})};sd.prototype.addScript=function(tc,bd,Xb){return this.objectModule.addScript(tc,bd,Xb)};sd.prototype.remove=function(){this.systemPackage.remove();delete pc.ObjectPackage.packageStore[this.id];return this.resource().remove()};sd.prototype.renameObjectClass=function(tc,bd){bd=void 0===bd?[]:bd;var Xb=this,Tb,Oc,td,Ob,sb,hb,qb,Aa,bb,wb,Hb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qb){if(1==
Qb.nextAddress){Tb=Xb;Oc=Tb.objectClass;td=Tb.System;if(!Oc||Oc.className===tc)return Qb.return(Oc);if(!pc.isValidIdentifier(tc))throw Error(tc+" is not a valid name for a class");sb=Ob=pc.RuntimeSourceDescriptor.for(Oc,td);hb=sb.source;qb=sb.ast;Aa=qb.id;bb=Aa.start;wb=Aa.end;return Qb.yield(Ob.changeSource(hb.slice(0,bb)+tc+hb.slice(wb)),2)}Hb=Xb.objectClass;bd.forEach(function(lb){lb.constructor=Hb;lb.__proto__=Hb.prototype});return Qb.return(Hb)})};sd.prototype.fork=function(tc,bd){var Xb=this,
Tb,Oc,td,Ob,sb,hb,qb,Aa,bb,wb,Hb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qb){switch(Qb.nextAddress){case 1:return Tb=Xb,Oc=Tb.System,td=Tb.baseURL,Ob=Tb.objectClass,bd=Object.assign({System:Oc,baseURL:td},bd),sb=pc.RuntimeSourceDescriptor.for(Ob),hb=sb._renamedSource(tc),qb=hb.moduleSource,Aa=pc.ObjectPackage.withId(tc,bd),Qb.yield(Aa.ensureExistance(),2);case 2:return bb=Aa,wb=bb.objectModule,Hb=wb.systemModule,Qb.yield(Hb.load({format:"esm"}),3);case 3:return Qb.yield(Hb.changeSource(qb),
4);case 4:return Qb.return(Aa)}})};$jscomp.global.Object.defineProperties(sd.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return this._id}},name:{configurable:!0,enumerable:!0,get:function(){return this.id}},System:{configurable:!0,enumerable:!0,get:function(){return this.options.System}},baseURL:{configurable:!0,enumerable:!0,get:function(){return this.options.baseURL}},packageURL:{configurable:!0,enumerable:!0,get:function(){return this.baseURL+("/"+this.id)}},config:{configurable:!0,
enumerable:!0,get:function(){return{name:this.name,version:"0.1.0",lively:{isObjectPackage:!0}}}},systemPackage:{configurable:!0,enumerable:!0,get:function(){return pc.lookupPackage(this.System,this.packageURL,!0).pkg}},objectModule:{configurable:!0,enumerable:!0,get:function(){return this._objectModule||(this._objectModule=new pc.ObjectModule("index.js",this))}},objectClass:{configurable:!0,enumerable:!0,get:function(){return this.objectModule.objectClass}}});$jscomp.global.Object.defineProperties(sd,
{packageStore:{configurable:!0,enumerable:!0,get:function(){return this._packageStore||(this._packageStore=pc._packageStore)}}});Ca("default",sd);pc.ObjectPackage=sd;var pd=function(tc,bd){if(!tc)throw Error("ObjectModule needs package!");if(!bd)throw Error("ObjectModule needs package!");this._moduleName=tc;this._objectPackage=bd};pd.prototype.read=function(){return this.resource.read()};pd.prototype.write=function(tc){return this.resource.write(tc)};pd.prototype.ensureExistance=function(){var tc=
this,bd,Xb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Tb){switch(Tb.nextAddress){case 1:return bd=tc.resource,Tb.yield(bd.exists(),2);case 2:if(Tb.yieldResult){Tb.jumpTo(3);break}return Tb.yield(bd.write("'format esm';\n"),4);case 4:Xb={},tc.System.config({meta:(Xb[tc.url]={format:"esm"},Xb)});case 3:return Tb.return(tc)}})};pd.prototype.ensureObjectClass=function(tc){var bd=this,Xb=this.objectClass;return Xb&&Xb.prototype.__proto__===tc.prototype?Xb:Promise.resolve(this.ensureObjectClassSource(tc)).then(function(Tb){var Oc=
Tb.source,td=Tb.moduleId,Ob=Tb.className,sb=Tb.bindings,hb=bd.System;Tb=pc.module(hb,td);if(sb)for(var qb in sb)Tb.define(qb,sb[qb]);Oc=pc.runEval(Oc,{classTransform:pc.classToFunctionTransform,sync:!0,targetModule:td,System:hb});if(Oc.isError)throw Oc.value;Oc=Tb.recorder[Ob];if(!Oc)throw Error("Failed to define class "+Ob+" in "+td);return Oc})};pd.prototype.ensureObjectClassSource=function(tc){return this.createDefaultClassDeclaration(tc)};pd.prototype.createDefaultClassDeclaration=function(tc){tc=
void 0===tc?Object:tc;var bd=this,Xb,Tb,Oc,td,Ob,sb,hb,qb,Aa,bb,wb,Hb,Qb,lb,mb,Rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gc){switch(Gc.nextAddress){case 1:Xb=bd;Tb=Xb.System;Oc=Xb.systemModule;td=Xb.objectPackage;Ob=pc.string.capitalize(pc.toJsIdentifier(td.id));sb=tc.className;hb=!sb;qb=pc.globalClasses.includes(tc);Aa="";bb=null;if(hb){sb="__anonymous_superclass__";wb={};bb=(wb[sb]=tc,wb);Gc.jumpTo(2);break}if(qb){Gc.jumpTo(2);break}return Gc.yield(pc.ExportLookup.findExportOfValue(tc,
Tb),4);case 4:(Hb=Gc.yieldResult)?(Qb=pc.ImportInjector.run(Tb,Oc.id,Oc.package(),"",Hb),lb=Qb.standaloneImport,Aa+=lb+"\n\n"):(mb={},bb=(mb[sb]=tc,mb));case 2:return Ob===sb&&(Ob="Object"+Ob),Rb="Object"===sb?"class "+Ob+" {}\n":"class "+Ob+" extends "+sb+" {}\n",Aa+="export default "+Rb+"\n",Gc.yield(Oc.changeSource(Aa),5);case 5:return Gc.yield(Oc.load(),6);case 6:return Gc.return({source:Aa,className:Ob,moduleId:bd.url,bindings:bb})}})};pd.prototype.addScript=function(tc,bd,Xb){var Tb=this,Oc,
td,Ob,sb,hb,qb,Aa,bb,wb,Hb,Qb,lb,mb,Rb,Gc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(mc){switch(mc.nextAddress){case 1:if(tc.constructor===Tb.objectClass){Oc=tc.constructor;mc.jumpTo(2);break}return mc.yield(Tb.ensureObjectClass(tc.constructor),3);case 3:Oc=mc.yieldResult;case 2:td=Oc;Ob="function"===typeof bd?String(bd):bd;sb=pc.parseFunction(Ob);hb=pc.RuntimeSourceDescriptor.for(td,Tb.System);Xb||(Xb=pc.Path("id.name").get(sb));if(!Xb)throw Error("No name, cannot add "+pc.string.truncate(Ob,
30).replace(/\n/g,"")+"!");qb=pc.toJsIdentifier(Xb);console.assert("FunctionExpression"===sb.type||"ArrowFunctionExpression"===sb.type,"not a function expression but: "+sb.type);Aa=sb.params.map(function(Pc){return Ob.slice(Pc.start,Pc.end)});bb="BlockStatement"===sb.body.type?Ob.slice(sb.body.start,sb.body.end):"{ return "+Ob.slice(sb.body.start,sb.body.end)+" }";wb=qb+"("+Aa.join(",")+") "+bb;"ArrowFunctionExpression"===sb.type&&(sb.type="FunctionExpression");Hb=hb.source;Qb=hb.ast;if(!Qb)throw Error("cannot find class decl of "+
hb.module.id);(lb=Qb.body.body.find(function(Pc){return Pc.key.name===qb&&!Pc.static}))?Hb=Hb.slice(0,lb.start)+wb+Hb.slice(lb.end):(mb=Hb.lastIndexOf("}"),Rb=Hb.slice(0,mb),Gc=Hb.slice(mb),/\n\s*$/m.test(Rb)||(Rb+="\n"),wb=pc.string.changeIndent(wb,"  ",1),/^[ ]*\n/m.test(Gc)||(Gc="\n"+Gc),Hb=Rb+wb+Gc);return mc.yield(hb.changeSource(Hb),4);case 4:return mc.return({script:td.prototype[qb],klass:td,module:hb.module.id,methodName:qb})}})};$jscomp.global.Object.defineProperties(pd.prototype,{objectPackage:{configurable:!0,
enumerable:!0,get:function(){return this._objectPackage}},objectClass:{configurable:!0,enumerable:!0,get:function(){var tc=this.systemModule;return tc.isLoaded()?tc.System.get(tc.id).default:null}},moduleName:{configurable:!0,enumerable:!0,get:function(){return this._moduleName}},systemModule:{configurable:!0,enumerable:!0,get:function(){return pc.module(this.System,this.url)}},System:{configurable:!0,enumerable:!0,get:function(){return this.objectPackage.System}},resource:{configurable:!0,enumerable:!0,
get:function(){return this.objectPackage.resource(this.moduleName)}},url:{configurable:!0,enumerable:!0,get:function(){return this.resource.url}}});pc.ObjectModule=pd;pc.default=sd}}});