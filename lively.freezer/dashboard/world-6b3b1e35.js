System.register(["./__root_module__-db735625.js","./index-705f6bba.js","./index-2260babb.js","./index-7ce4e91c.js","./color-picker-ca0a3012.js"],function(db){var Zb,lc,Uc,Bc,Vd,Od,je,Bd,jd,zd,ge,We,kf,bf,Hd,Ae,uc,wd,ce,Gd,pe,Te,rc,bd,he,cd,ie,ac,Db,Tc,Nc,wc,Vc,hb,zc,Ub,Jc,Wc,Ad,Xd,xc,Pc,sc,Za,Pa,ua,Na,Wa,Vb,Fa,Xa,gc,ub,qd,fc,Ud,td,fd,Xb,Me,ic,Wb,$a,ma,Ta,qb,ec,Ic,ud,gd,me,ue,Uf,zf,qf,C,Df,Bf,Pe,Tf,fg,kg,wg,kh,rd;return{setters:[function(cf){Zb=cf.W;lc=cf.R;Uc=cf.a2;Bc=cf.C;Vd=cf.p;Od=cf.a3;je=
cf.a4;Bd=cf.P;jd=cf.b;zd=cf.c;ge=cf._;We=cf.a5;kf=cf.e;bf=cf.m;Hd=cf.O;Ae=cf.h;uc=cf.a6;wd=cf.a7;ce=cf.u;Gd=cf.a8;pe=cf.v;Te=cf.k;rc=cf.r;bd=cf.a9;he=cf.o;cd=cf.aa;ie=cf.ab;ac=cf.ac;Db=cf.M;Tc=cf.T;Nc=cf.ad;wc=cf.ae;Vc=cf.Y;hb=cf.I;zc=cf.n;Ub=cf.d;Jc=cf.g;Wc=cf.af;Ad=cf.i;Xd=cf.f;xc=cf.a;Pc=cf.ag;sc=cf.X;Za=cf.S;Pa=cf.V;ua=cf.Q;Na=cf.t;Wa=cf.ah;Vb=cf.ai;Fa=cf.aj;Xa=cf.l;gc=cf.ak;ub=cf.al;qd=cf.am;fc=cf.an;Ud=cf.ao;td=cf.ap;fd=cf.aq;Xb=cf.ar;Me=cf.as;ic=cf.L;Wb=cf.at;$a=cf.j;ma=cf.au;Ta=cf.D;qb=cf.a0;
ec=cf.av;Ic=cf.$;ud=cf.aw},function(cf){gd=cf.i},function(cf){me=cf.s;ue=cf.a;Uf=cf.r;zf=cf._;qf=cf.P;C=cf.H;Df=cf.M;Bf=cf.S;Pe=cf.b;Tf=cf.c;fg=cf.G;kg=cf.F},function(){},function(cf){wg=cf.C;kh=cf.a;rd=cf.c}],execute:function(){function cf(){}function Bg(Ya,oa,Tb){var Ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){return 1==ab.nextAddress?oa.startsWith("image/")?ab.yield(Eh.fileReadAsDataURL(Ya),3):ab.jumpTo(2):2!=ab.nextAddress?(Ha=ab.yieldResult,ab.return(new Eh.Image({imageUrl:Ha,
autoResize:!0,name:Ya.name}))):ab.return(null)})}var Eh=lively.FreezerRuntime.recorderFor("lively.morphic/events/html-drop-handler.js");Eh.uploadItem=cf;Eh.uploadFile=Bg;Eh.fileReadAsDataURL=function(Ya){return new Promise(function(oa,Tb){Tb=new Eh.FileReader;Tb.onload=function(Ha){return oa(Ha.target.result)};Tb.readAsDataURL(Ya)})};Eh.Image=Zb;Eh.uploadItem=cf;Eh.uploadItem=cf;Eh.uploadFile=Bg;Eh.uploadFile=Bg;var Kd=lively.FreezerRuntime.recorderFor("lively.ide/world-commands.js");Kd.Rectangle=
lc;Kd.rect=Uc;Kd.Color=Bc;Kd.pt=Vd;Kd.tree=Od;Kd.date=je;Kd.Path=Bd;Kd.arr=jd;Kd.string=zd;Kd.obj=ge;Kd.inspect=We;Kd.easings=kf;Kd.morph=bf;Kd.Text=Hd;Kd.config=Ae;Kd.KeyHandler=uc;Kd.loadObjectFromPartsbinFolder=wd;Kd.loadPart=ce;Kd.interactivelySaveWorld=Gd;Kd.show=me;Kd.showAndSnapToGuides=ue;Kd.removeSnapToGuidesOf=Uf;Kd.LoadingIndicator=pe;Kd.createMorphSnapshot=Te;Kd.interactivelyFreezeWorld=gd;Kd.resource=rc;Kd.BrowserModuleTranslationCache=bd;Kd.CommentBrowser=zf;Kd.once=he;Kd.commands=[{name:"clear storage and reload",
exec:function(){var Ya,oa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Tb){if(1==Tb.nextAddress)return Tb.yield($world.confirm(["Caution\n",{},"Proceeding will clear all local storage and reload the page! Make sure if you want to save your world before you continue.",{fontSize:15,fontWeight:"normal"}],{width:400}),2);if(Ya=Tb.yieldResult)localStorage.clear(),oa=new Kd.BrowserModuleTranslationCache("2"),oa.closeDb(),oa.deleteDb(),window.location.reload(!0);Tb.jumpToEnd()})}},{name:"undo",
exec:function(Ya){if(Ya.focusedMorph&&Ya.focusedMorph!==Ya&&Ya.focusedMorph.undoManager)return!1;Ya.env.undoManager.undo();return!0}},{name:"redo",exec:function(Ya){if(Ya.focusedMorph&&Ya.focusedMorph!==Ya&&Ya.focusedMorph.undoManager)return!1;Ya.env.undoManager.redo();return!0}},{name:"run command",handlesCount:!0,exec:function(Ya,oa,Tb){var Ha,ab,vb,oc,Sc,md;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xd){if(1==xd.nextAddress)return Ha=Ya.focusedMorph||Ya,ab=Kd.KeyHandler.generateCommandToKeybindingMap(Ha,
!0).map(function(nd){var $d=nd.prettyKeys,Ie=nd.command.name,lf=nd.target.constructor.name;$d=$d?$d.join(", "):"";return{isListItem:!0,value:nd,label:[""+lf,{fontSize:"80%",textStyleClasses:["v-center-text"],paddingRight:"10px"},""+Ie,null],annotation:[$d,{fontSize:"80%",textStyleClasses:["truncated-text"],paddingRight:"5px",maxWidth:140}]}}),xd.yield(Ya.filterableListPrompt("Run command",ab,{historyId:"lively.morphic-run command",requester:Ha,extent:Kd.pt(700,600),prompt:Ya._cachedRunCommandPrompt}),
2);vb=xd.yieldResult;oc=vb.prompt;Sc=$jscomp.makeIterator(vb.selected);md=Sc.next().value;Ya._cachedRunCommandPrompt=oc;return xd.return(md?md.target.execCommand(md.command,oa,Tb):!0)})}},{name:"show command history",exec:function(Ya,oa){var Tb=Ya.commandHandler;oa=Kd.arr.sortBy(Tb.history,function(Ha){return-Ha.time}).map(function(Ha){return{isListItem:!0,string:Tb.printCommand(Ha),value:Ha}});$world.editListPrompt("select commands",oa,{multiSelect:!0,requester:Ya});return!0}},{name:"show halo for focused morph",
exec:function(Ya){var oa=Ya.focusedMorph;Ya.showHaloFor(oa.getWindow()||oa,Ya.firstHand.pointerId);return!0}},{name:"show morph",exec:function(Ya,oa){Kd.show(oa.morph,void 0===oa.loop?!1:oa.loop)}},{name:"show and snap to guides",exec:function(Ya,oa){Kd.showAndSnapToGuides(oa.target,oa.showGuides,oa.snap)}},{name:"remove snap to guides",exec:function(Ya,oa){Kd.removeSnapToGuidesOf(oa)}},{name:"copy morph",exec:function(Ya){var oa=Ya.focusedMorph;if(!oa||oa===Ya)return $world.setStatusMessage("no morph selected"),
!0;Ya=oa.getWindow()||oa;oa=Ya.copy();oa.openInWorld(Ya.globalPosition.addXY(10,10));oa.isWindow&&oa.activate();return oa}},{name:"select morph",exec:function(Ya,oa){oa=void 0===oa?{root:Ya,selectionFn:null,justReturn:!1,requester:Ya,filterFn:null,prependItems:[],prompt:null,remote:!1}:oa;var Tb,Ha,ab,vb,oc,Sc,md,xd,nd,$d,Ie;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lf){if(1==lf.nextAddress)return Tb=0,Ha=oa.filterFn||function(){return!0},ab=oa.selectionFn||function(te,yf,df){return Ya.filterableListPrompt(te,
yf,df)},lf.yield(System.import("lively.classes/object-classes.js"),2);if(3!=lf.nextAddress)return vb=lf.yieldResult,oc=vb.default,Sc=Kd.arr.compact(Kd.tree.map(oa.root||Ya,function(te,yf){if(!Ha(te))return null;var df=!!oc.lookupPackageForObject(te);return{isListItem:!0,label:[""+String(++Tb)+"\u2003".repeat(yf),{fontSize:"80%",textStyleClasses:["v-center-text"],paddingRight:"10px"},""+te,{fontWeight:df?"bolder":"normal",fontStyle:df?"normal":"italic",fontFamily:"Inconsolata",fontSize:16},df?" [Object Class]":
"",{opacity:.5}],value:te}},function(te){return Ha(te)?te.submorphs:[]})),md=["show halo","open object editor","open object inspector"],lf.yield(ab(oa.prompt||"Choose morph",(oa.prependItems||[]).concat(Sc),{historyId:"lively.morphic-select morph",onSelection:function(te){(void 0).lastSelectionHalo&&(void 0).lastSelectionHalo.remove();te&&te.show&&xd!=te&&((void 0).lastSelectionHalo=te.show(),xd=te)},selectedAction:"show halo",actions:md}),3);nd=lf.yieldResult;$d=nd.selected;Ie=nd.action;if(oa.justReturn)return lf.return($d);
$d.forEach(function(te){Ie===md[0]?Ya.showHaloFor(te):Ie===md[1]?Ya.execCommand("open object editor",{target:te}):Ie===md[2]&&Ya.execCommand("open object inspector",{target:te})});return lf.return($d)})}},{name:"print morph(s)",exec:function(Ya){var oa,Tb,Ha,ab,vb,oc,Sc,md,xd,nd,$d,Ie,lf,te,yf,df,Xe,gg;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ug){switch(Ug.nextAddress){case 1:oa=!1,Tb=[];case 2:if(oa)return Sc=Kd.LoadingIndicator.open("printing morph..."),Ug.yield(System.import("lively.2lively/client.js"),
6);Ha=$jscomp;ab=Ha.makeIterator;return Ug.yield(Ya.execCommand("select morph",{justReturn:!0}),4);case 4:return vb=ab.call(Ha,Ug.yieldResult),oc=vb.next().value,Tb.push(oc),Ug.yield(Ya.confirm("Select additional morphs?",{rejectLabel:"NO"}),5);case 5:oa=!Ug.yieldResult;Ug.jumpTo(2);break;case 6:return md=Ug.yieldResult,xd=md.default,nd=xd.default(),Ug.yield(nd.listPeers(!0),7);case 7:return $d=Ug.yieldResult,Ie=$d.find(function(ci){return"pdf printer"===ci.type}),lf={ackTimeout:3E4},te=nd,yf=te.sendToAndWait,
df=Ie.id,Ug.yield(Promise.all(Tb.map(function(ci){return Kd.createMorphSnapshot(ci,{addPreview:!1,testLoad:!1})})),9);case 9:return Ug.yield(yf.call(te,df,"[PDF printer] print",Ug.yieldResult,lf),8);case 8:Xe=Ug.yieldResult;if(gg=Xe.error||Xe.data.error)throw Ya.showError(gg),gg;Ya.serveFileAsDownload(Xe.data,{fileName:Tb[0].name+(1<Tb.length?".etc":"")+".pdf",type:"application/pdf"});Sc.remove();Ug.jumpToEnd()}})}},{name:"escape",exec:function(Ya,oa,Tb,Ha){oa=Ya.env.eventDispatcher.eventState;oa.menu&&
oa.menu.remove();oa=Ya.halos();oa.forEach(function(ab){return ab.remove()});Ya.hands.forEach(function(ab){return ab.cancelGrab(!0,Ha)});Ya=Kd.arr.last(oa)&&Kd.arr.last(oa).target||Ya.focusedMorph||Ya;Ya.focus();Ya.isText&&Ya.selection.disableMultiSelect&&Ya.selection.disableMultiSelect();return!1}},{name:"move or resize halo target",exec:function(Ya,oa){oa=void 0===oa?{direction:"left",offset:1,what:"move"}:oa;var Tb=Ya.halos()[0];if(!Tb||Tb.changingName||Ya.focusedMorph!=Tb)return!1;var Ha=oa;Ya=
Ha.direction;oa=Ha.offset;Ha=Ha.what;var ab=Tb.target;oa=oa||1;switch(Ya){case "left":ab["move"===Ha?"left":"width"]-=oa;break;case "right":ab["move"===Ha?"left":"width"]+=oa;break;case "up":ab["move"===Ha?"top":"height"]-=oa;break;case "down":ab["move"===Ha?"top":"height"]+=oa}Tb.alignWithTarget();return!0}},{name:"close halo target",exec:function(Ya){Ya=Ya.halos()[0];if(!Ya||Ya.changingName)return!1;Ya.target.selectedMorphs?Ya.target.selectedMorphs.forEach(function(oa){return oa.abandon()}):Ya.target.abandon();
return!0}},{name:"resize manually",exec:function(Ya,oa){oa=void 0===oa?{}:oa;var Tb,Ha,ab,vb,oc,Sc,md,xd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nd){switch(nd.nextAddress){case 1:ab=Ya.windowBounds();vb=Ya.bounds();oc=Number;if(Sc=oa.width){nd.jumpTo(2);break}return nd.yield(Ya.prompt("Enter world width",{input:Math.max(vb.width,ab.width),requester:Ya}),3);case 3:Sc=nd.yieldResult;case 2:Tb=oc(Sc);if("number"!==typeof Tb){nd.jumpTo(4);break}md=Number;if(xd=oa.height){nd.jumpTo(5);
break}return nd.yield(Ya.prompt("Enter world height",{input:Math.max(vb.height,ab.height),requester:Ya}),6);case 6:xd=nd.yieldResult;case 5:Ha=md(xd);case 4:return"number"!==typeof Tb||isNaN(Tb)||"number"!==typeof Ha||isNaN(Ha)||(Ya.extent=Kd.pt(Tb,Ha)),nd.return(!0)}})}},{name:"resize windows to fit visible world bounds",exec:function(Ya){var oa=Ya.getWindows().filter(function(vb){return!vb.minimized});if(!oa.length)return!0;Ya=Ya.visibleBoundsExcludingTopBar();var Tb=oa.reduce(function(vb,oc){return oc.bounds().union(vb)},
new Kd.Rectangle(0,0,0,0)),Ha=Ya.width/Tb.width,ab=Ya.height/Tb.height;oa.forEach(function(vb){var oc=vb.bounds();vb.setBounds(new Kd.Rectangle(oc.x*Ha,oc.y*ab,oc.width*Ha,oc.height*ab))});return!0}},{name:"window switcher",exec:function(Ya){var oa,Tb,Ha,ab,vb,oc,Sc,md;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xd){if(1==xd.nextAddress){if((oa=Ya.activePrompt())&&"lively.morphic-window switcher"===oa.historyId)return oa.focus(),xd.return(oa.get("list").execCommand("select down"));
Tb=Ya.submorphs.filter(function(nd){return nd.isWindow}).reverse().map(function(nd){return{isListItem:!0,string:nd.title||String(nd),value:nd}});Tb.forEach(function(nd){nd.value.opacity=.5;nd.value.blur=1});return xd.yield(Ya.filterableListPrompt("Choose window",Tb,{preselect:1,requester:Ya,historyId:"lively.morphic-window switcher",onSelection:function(nd){Ha&&(Ha.minimized=ab,Ha.blur=1,Ha.animate({opacity:.3,duration:200}));if(Ha=nd)nd.animate({opacity:1,duration:200}),nd.blur=0,ab=nd.minimized,
nd.minimized=!1},width:1*Ya.visibleBounds().extent().x/3,itemPadding:Kd.Rectangle.inset(4)}),2)}oc=vb=xd.yieldResult;Sc=$jscomp.makeIterator(oc.selected);md=Sc.next().value;Tb.forEach(function(nd){nd.value.opacity=1;nd.value.blur=0});md&&(md.activate(),md.minimized=!1);return xd.return(!0)})}},{name:"close active window or morph",exec:function(Ya){var oa=Ya.focusedMorph;if(!oa)return!0;var Tb=oa.getWindow();Ya.undoStart("window close");Tb?Tb.close():(Kd.arr.last(Kd.arr.without(oa.ownerChain(),Ya)).remove(),
(Tb=Ya.activeWindow())&&Tb.activate());Ya.undoStop("window close");return!0}},{name:"toggle minimize active window",exec:function(Ya){(Ya=Ya.activeWindow())&&Ya.toggleMinimize();return!0}},{name:"toggle minimize all windows",exec:function(Ya){(Ya=Ya.getWindows())&&Ya.map(function(oa){return oa.toggleMinimize()});return!0}},{name:"toggle minimize all except active window",exec:function(Ya){(Ya=Ya.getWindows().filter(function(oa){return!oa.isActive()}))&&Ya.map(function(oa){return oa.toggleMinimize()});
return!0}},{name:"close all except active window",exec:function(Ya){(Ya=Ya.getWindows().filter(function(oa){return!oa.isActive()}))&&Ya.map(function(oa){return oa.close()});return!0}},{name:"close all windows",exec:function(Ya){(Ya=Ya.getWindows())&&Ya.map(function(oa){return oa.close()});return!0}},{name:"open status message of focused morph",exec:function(Ya){var oa=Ya.focusedMorph;if(Ya=$jscomp.makeIterator(oa?Ya.visibleStatusMessagesFor(oa):[]).next().value)Ya.expand(),Ya.focus();return Ya||!0}},
{name:"resize active window",exec:function(Ya,oa){function Tb(){var Ie,lf,te;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yf){if(1==yf.nextAddress)return yf.yield(Ya.filterableListPrompt("How to resize the window?","full center right left bottom top reset".split(" "),{requester:Ya}),2);Ie=yf.yieldResult;lf=$jscomp.makeIterator(Ie.selected);te=lf.next().value;return yf.return(te)})}function Ha(Ie,lf){switch(Ie){case "full":return md;case "col1":case "left":return $d.withTopLeft(md.topLeft());
case "col2":case "center":return $d.withCenter(md.center());case "col3":case "right":return $d.translatedBy(Kd.pt(md.width-nd,0));case "top":return md.divide([Kd.rect(0,0,1,.5)])[0];case "bottom":return md.divide([Kd.rect(0,.5,1,.5)])[0];case "reset":return Sc._normalBounds||Kd.pt(500,400).extentAsRectangle().withCenter(lf.center());default:return lf}}oa=void 0===oa?{how:null,window:null}:oa;var ab,vb,oc,Sc,md,xd,nd,$d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ie){if(1==Ie.nextAddress){ab=
oa;vb=ab.window;oc=ab.how;Sc=vb||Ya.activeWindow();if(!Sc)return Ie.return();md=Ya.visibleBoundsExcludingTopBar().insetBy(15);xd=Sc.bounds();Sc._normalBounds||(Sc._normalBounds=xd);nd=Math.min(700,Math.max(1E3,md.width/3));$d=md.withWidth(nd);return oc?Ie.jumpTo(2):Ie.yield(Tb(),3)}2!=Ie.nextAddress&&(oc=Ie.yieldResult);if(!oc)return Ie.return();Sc.setBounds(Ha(oc,md));"reset"===oc&&delete Sc._normalBounds;return Ie.return(!0)})}},{name:"[recovery] show last object editor saves",exec:function(Ya,
oa){return Ya.execCommand("[recovery] show last doits",Object.assign({},oa,{title:"logged ObjectEditor save",logAccessFn:function(){return JSON.parse(localStorage["oe helper"]).saves}}))}},{name:"[recovery] show last doits",description:"browse a list of your last doits",exec:function(Ya,oa){oa=void 0===oa?{}:oa;var Tb,Ha,ab,vb,oc,Sc,md,xd,nd,$d,Ie,lf,te,yf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(df){if(1==df.nextAddress){Tb=oa;(Ha=Tb.logAccessFn)||(Ha=function(){return JSON.parse(localStorage["lively.next-js-ide-doitlog"])});
try{ab=Ha()}catch(Xe){}if(!ab)return df.return(Ya.inform("no log yet"));vb=Kd.arr.sortBy(ab.map(function(Xe,gg){var Ug="string"===typeof Xe?Xe:Xe.source;Xe="string"===typeof Xe?gg:Xe.time||gg;gg=Kd.date.format(new Date(Xe),"yy-mm-dd HH:MM");return{time:Xe,source:Ug,printedTime:gg}}),function(Xe){return-Xe.time});oc=vb.map(function(Xe,gg){return{isListItem:!0,string:"["+Xe.printedTime+"] "+Xe.source.slice(0,100).replace(/\n/g,"").trim(),value:Xe}});return df.yield(Ya.filterableListPrompt("select doit code",
oc,{multiSelect:!0,requester:Ya}),2)}Sc=df.yieldResult;md=Sc.selected;if(md.length){xd=[];nd=$jscomp.makeIterator(md);for($d=nd.next();!$d.done;$d=nd.next())lf=Ie=$d.value,te=lf.source,yf=lf.printedTime,xd.push("// "+yf+"\n"+te);return df.return(Ya.execCommand("open workspace",Object.assign({title:"logged doits",mode:"js"},oa,{content:xd.join("\n\n")})))}return df.return(!0)})}},{name:"open loading indicator",exec:function(Ya,oa){Ya={};"object"===typeof oa&&(Ya=oa,oa=Ya.label);return Kd.LoadingIndicator.open(oa,
Ya)}},{name:"open workspace",exec:function(Ya,oa,Tb,Ha){oa=void 0===oa?{}:oa;var ab,vb,oc,Sc,md,xd,nd,$d,Ie,lf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(te){switch(te.nextAddress){case 1:if(ab=Ha&&Ya.relayCommandExecutionToFocusedMorph(Ha))return te.return(ab);vb=oa.language||oa.mode||"javascript";oc={javascript:"lively.ide/js/workspace.js",shell:"lively.ide/shell/workspace.js",html:"lively.ide/html/workspace.js",py:"lively.ide/py/workspace.js",md:"lively.ide/md/workspace.js",sql:"lively.ide/sql/workspace.js",
css:"lively.ide/css/workspace.js",less:"lively.ide/css/less/workspace.js",text:null};Sc=Object.keys(Kd.config.ide.modes.aliases).reduce(function(yf,df){var Xe={};return Object.assign(yf,(Xe[Kd.config.ide.modes.aliases[df]]=df,Xe))},{});if(!oa.askForMode){te.jumpTo(2);break}md=Object.keys(oc).concat("javascript console");return te.yield(Ya.filterableListPrompt("Open workspace for...",md),3);case 3:if(xd=te.yieldResult,nd=$jscomp.makeIterator(xd.selected),vb=nd.next().value,!vb)return te.return(!0);
case 2:if("javascript console"===vb)return te.return(Ya.execCommand("open console",oa));oa=Object.assign({content:""},oa,{mode:vb,language:vb});$d=oc[oa.language]||oc[Sc[oa.language]];return"text"!==vb&&$d?te.yield(System.import($d),4):te.return(Ya.execCommand("open text window",Object.assign({},Kd.config.codeEditor.modes.text,{},oa)));case 4:return Ie=te.yieldResult,lf=Ie.default,te.return((new lf({title:oa.title||oa.language+" workspace",center:Ya.center,content:oa.content,target:oa.target,systemInterface:oa.systemInterface||
oa.backend})).activate())}})}},{name:"open console",exec:function(Ya,oa){var Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){if(1==Ha.nextAddress)return Ha.yield(Kd.loadObjectFromPartsbinFolder("Console"),2);Tb=Ha.yieldResult;return Ha.return(Tb.openInWorldNearHand())})}},{name:"open shell workspace",exec:function(Ya,oa){return Ya.execCommand("open workspace",Object.assign({},oa,{language:"shell"}))}},{name:"open javascript workspace",exec:function(Ya,oa){return Ya.execCommand("open workspace",
Object.assign({},oa,{language:"javascript"}))}},{name:"open shell terminal",exec:function(Ya,oa){var Tb,Ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){if(1==ab.nextAddress)return ab.yield(System.import("lively.ide/shell/terminal.js"),2);Tb=ab.yieldResult;Ha=Tb.default;return ab.return(Ha.open(oa).openInWorldNearHand())})}},{name:"open text window",exec:function(Ya,oa){var Tb=oa=void 0===oa?{}:oa,Ha=Tb.title,ab=Tb.extent,vb=Tb.content,oc=Tb.mode,Sc=Tb.name;Tb=Tb.rangesAndStyles;
Ha=Ha||"text window";vb=vb||"";ab=ab||Kd.pt(500,400);Sc=Sc||"text workspace";vb="string"===typeof vb?[vb,null]:vb;oa=new Kd.Text(Object.assign({padding:Kd.Rectangle.inset(3)},Kd.obj.dissoc(oa,["title","content"]),{textAndAttributes:vb,clipMode:"auto",name:Sc,extent:ab}));Tb&&oa.setTextAttributesWithSortedRanges(Tb);oc&&oa.changeEditorMode(oc);return Ya.openInWindow(oa,{title:Ha}).activate()}},{name:"merge and open in window",exec:function(Ya,oa){oa=void 0===oa?{a:"",b:"",format:null,extent:Kd.pt(500,
600)}:oa;var Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){if(1==Ha.nextAddress)return Ha.yield(Kd.loadObjectFromPartsbinFolder("text merger"),2);Tb=Ha.yieldResult;return Ha.return(Tb.targetMorph.open(oa.a,oa.b,oa))})}},{name:"diff and open in window",exec:function(Ya,oa){var Tb,Ha,ab;function vb(lf,te,yf){var df,Xe,gg,Ug,ci,Vh,Zg,tg,Hi,zj,Wh,xg,gh,sh;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ei){if(1==Ei.nextAddress){df=yf;Xe=df.format;gg=null;if("patch"!==
Xe)return Ie=$d[Xe](lf,te,yf),Ug=Kd.arr.flatmap(Ie,function(Gf){var Aj=Gf.added;return[Gf.value,Gf.removed?{fontWeight:"normal",textDecoration:"line-through",fontColor:Kd.Color.red}:Aj?{fontWeight:"bold",textDecoration:"",fontColor:Kd.Color.green}:{fontWeight:"normal",textDecoration:"",fontColor:Kd.Color.darkGray}]}),Ei.jumpTo(2);ci=yf;Vh=ci.headerA;Zg=ci.headerB;tg=ci.filenameA;Hi=ci.filenameB;zj=ci.context;Ug=[$d.createTwoFilesPatch(tg||"a",Hi||"b",lf,te,Vh,Zg,"number"===typeof zj?{context:zj}:
void 0),{}];return Ei.yield(System.import("lively.ide/diff/editor-plugin.js"),3)}2!=Ei.nextAddress&&(Wh=Ei.yieldResult,xg=Wh.default,gg=new xg);gh=Ya.execCommand("open text window",yf);sh=gh.targetMorph;gh.extent=nd||Kd.pt(300,200).maxPt(sh.textBounds().extent());sh.textAndAttributes=Ug;gg&&sh.addPlugin(gg);return Ei.return(sh)})}oa=void 0===oa?{a:"",b:"",format:null,extent:Kd.pt(500,600)}:oa;var oc,Sc,md,xd,nd,$d,Ie;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lf){if(1==lf.nextAddress){oc=
oa;Sc=oc.a;md=oc.b;xd=oc.format;nd=oc.extent;if(xd)Sc=String(Sc),md=String(md);else{a:{var te=Sc,yf=md;if(Kd.obj.isPrimitive(te)||te instanceof RegExp||Kd.obj.isPrimitive(yf)||yf instanceof RegExp)te=String(te),yf=String(yf);if("string"!==typeof te||"string"!==typeof yf)try{JSON.stringify(te);JSON.stringify(yf);Tb="diffJson";Ha=te;ab=yf;break a}catch(df){te=String(te),yf=String(yf)}Tb="diffLines";Ha=te;ab=yf}Sc=Ha;md=ab;xd=Tb}return lf.yield(System.import("https://jspm.dev/diff"),2)}if(3!=lf.nextAddress)return $d=
lf.yieldResult,lf.yield(vb(Sc,md,Object.assign({fontFamily:"monospace"},oa,{format:xd})),3);Ie=lf.yieldResult;return lf.return(Ie)})}},{name:"merge workspaces",exec:function(Ya,oa){return Ya.execCommand("diff workspace",Object.assign({},oa,{merge:!0}))}},{name:"diff workspaces",exec:function(Ya,oa){function Tb(nd,$d){var Ie=nd.pluginFind(function(te){return te.evalEnvironment});Ie=Ie&&Ie.evalEnvironment.targetModule||"no file";var lf=$d.pluginFind(function(te){return te.evalEnvironment});return Ya.execCommand("diff and open in window",
{a:nd.textString,b:$d.textString,filenameA:Ie,filenameB:lf&&lf.evalEnvironment.targetModule||"no file"})}function Ha(nd,$d){var Ie;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lf){if(1==lf.nextAddress)return lf.yield(Kd.loadObjectFromPartsbinFolder("text merger"),2);Ie=lf.yieldResult;return lf.return(Ie.targetMorph.open(nd.textString,$d.textString))})}function ab(nd,$d){var Ie,lf,te,yf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(df){if(1==df.nextAddress)return Ie=nd.map(function(Xe){return{isListItem:!0,
value:Xe,string:Xe.name||String(Xe)}}),df.yield(Ya.filterableListPrompt("choose text: ",Ie,{onSelection:function(Xe){Xe&&Xe.show()}}),2);lf=df.yieldResult;te=$jscomp.makeIterator(lf.selected);yf=te.next().value;return df.return(yf)})}oa=void 0===oa?{}:oa;var vb,oc,Sc,md,xd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nd){switch(nd.nextAddress){case 1:vb=oa;oc=vb.editor1;Sc=vb.editor2;md=vb.merge;oc&&Sc||(xd=Ya.withAllSubmorphsSelect(function($d){return $d.isText&&!$d.isInputLine&&!$d.isUsedAsEpiMorph()}).reverse());
if(oc){nd.jumpTo(2);break}return nd.yield(ab(xd),3);case 3:oc=nd.yieldResult;case 2:if(!oc)return nd.return(Ya.setStatusMessage("Canceled"));if(Sc){nd.jumpTo(4);break}return nd.yield(ab(Kd.arr.without(xd,oc)),5);case 5:Sc=nd.yieldResult;case 4:return Sc?nd.return(md?Ha(oc,Sc):Tb(oc,Sc)):nd.return(Ya.setStatusMessage("Canceled"))}})}},{name:"search workspaces",exec:function(){function Ya(nd,$d){return nd.map(function(Ie){var lf=Ie.world()?Ie.getWindow():$world.withAllSubmorphsDetect(function(Xe){return Xe.isWindow&&
Xe.targetMorph===bf}),te=0,yf=Kd.string.lines(Ie.textString).find(function(Xe,gg){Xe=Xe.toLowerCase();te=gg;return $d.every(function(Ug){return Xe.includes(Ug)})}),df=lf?lf.title:Ie.toString();return yf?{isListItem:!0,string:df+" | "+yf,value:{window:lf,morph:Ie,row:te}}:null}).filter(Boolean)}function oa(nd){return $world.withAllSubmorphsDo(function($d){$d.isWindow&&$d.minimized&&$d.targetMorph&&$d.targetMorph.isText&&($d=$d.targetMorph);if(!$d.textString||!$d.isText||$d.isUsedAsEpiMorph())return null;
var Ie=$d.textString.toLowerCase();return nd.every(function(lf){return Ie.includes(lf)})?$d:null}).filter(Boolean)}var Tb=this,Ha,ab,vb,oc,Sc,md,xd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nd){if(1==nd.nextAddress)return nd.yield($world.filterableListPrompt("search workspaces",[],{historyId:"lively.morphic-ide-search-workspaces-hist",customize:function($d){$d.getSubmorphNamed("list").updateFilter=function(){var Ie=this.parseInput();if(!(3>Ie.input.length)){var lf=oa(Ie.lowercasedTokens);
this.listMorph.items=Ya(lf,Ie.lowercasedTokens)}}}}),2);Ha=nd.yieldResult;ab=$jscomp.makeIterator(Ha.selected);return(vb=ab.next().value)?(oc=vb,Sc=oc.morph,md=oc.window,xd=oc.row,md&&(md.minimized&&md.toggleMinimize(),md.activate()),(md||Sc).show(),Tb.cursorPosition={row:xd,column:0},nd.return(Sc)):nd.return(null)})}},{name:"open PartsBin",exec:function(Ya){var oa,Tb,Ha,ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){if(1==vb.nextAddress)return oa=Kd.LoadingIndicator.open("Loading Partsbin..."),
vb.yield(System.import("lively.morphic/partsbin.js"),2);if(3!=vb.nextAddress)return Tb=vb.yieldResult,Ha=Tb.loadPart,vb.yield(Ha("PartsBin"),3);ab=vb.yieldResult;ab.openInWorldNearHand();ab.targetMorph.selectedCategory="*basics*";ab.focus();oa.remove();ab.getWindow().activate();return vb.return(ab)})}},{name:"browse and load component",exec:function(Ya){var oa,Tb,Ha,ab,vb,oc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sc){switch(Sc.nextAddress){case 1:oa=Kd.LoadingIndicator.open("loading component browser");
if(Ya._componentsBrowser){Sc.jumpTo(2);break}return Sc.yield(oa.whenRendered(),2);case 2:if(Tb=Ya._componentsBrowser){Sc.jumpTo(4);break}ab=Ha=Ya;return Sc.yield(Kd.resource("part://SystemDialogs/master component browser").read(),5);case 5:Tb=ab._componentsBrowser=Sc.yieldResult;case 4:return vb=Tb,oa.remove(),Sc.yield(vb.activate(),6);case 6:(oc=Sc.yieldResult)&&!oc.world()&&oc.openInWorld(),Sc.jumpToEnd()}})}},{name:"load object from PartsBin",exec:function(Ya,oa){oa=void 0===oa?{}:oa;var Tb,Ha,
ab,vb,oc,Sc,md,xd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nd){switch(nd.nextAddress){case 1:return Ha=oa,ab=Ha.name,vb=void 0===Ha.open?!0:Ha.open,ab?nd.yield(System.import("lively.morphic/partsbin.js"),6):nd.yield(System.import("lively.morphic/partsbin.js"),4);case 4:return oc=nd.yieldResult,Sc=oc.interactivelyLoadObjectFromPartsBinFolder,nd.yield(Sc(),5);case 5:Tb=nd.yieldResult;nd.jumpTo(3);break;case 6:return md=nd.yieldResult,xd=md.loadObjectFromPartsbinFolder,nd.yield(xd(ab),
7);case 7:Tb=nd.yieldResult;case 3:return Tb&&vb&&Tb.openInWorldNearHand(),nd.return(Tb)}})}},{name:"open object drawer",exec:function(Ya){var oa,Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){if(1==Ha.nextAddress)return Ha.yield(System.import("lively.components/object-drawer.js"),2);oa=Ha.yieldResult;Tb=oa.default;return Ha.return((new Tb).openInWorldNearHand())})}},{name:"open object editor",exec:function(Ya,oa){oa=void 0===oa?{target:null,selectedClass:null,selectedMethod:null,
evalEnvironment:null}:oa;var Tb,Ha,ab,vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(oc){if(1==oc.nextAddress){if(!oa.target)return Ya.setStatusMessage("No target for ObjectEditor"),oc.return(null);Tb=oa.loadingIndicator=Kd.LoadingIndicator.open("Open Object Editor...");return oc.yield(System.import("lively.ide/js/objecteditor/index.js"),2)}if(3!=oc.nextAddress)return Ha=oc.yieldResult,ab=Ha.ObjectEditor,oc.yield(ab.open(oa),3);vb=oc.yieldResult;Tb.remove();return oc.return(vb)})}},
{name:"open object inspector",exec:function(Ya,oa){oa=void 0===oa?{target:null}:oa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Tb){return oa.target?Tb.return(Kd.inspect(oa.target)):(Ya.setStatusMessage("no target for Inspector"),Tb.return(null))})}},{name:"inspect server",exec:function(Ya){var oa,Tb,Ha,ab,vb,oc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sc){switch(Sc.nextAddress){case 1:return Sc.yield(System.import("lively.ide/js/inspector.js"),2);case 2:return oa=
Sc.yieldResult,Tb=oa.default,Sc.yield(System.import("lively-system-interface"),3);case 3:return Ha=Sc.yieldResult,ab=Ha.serverInterfaceFor,vb=ab(System.baseURL+"eval"),oc={format:"esm",context:"global",targetModule:"lively://lively.next-workspace/world",sourceURL:"inspect-server_"+Date.now(),systemInterface:vb},Sc.yield(vb.runEval('\n           import LivelyServer from "lively.server/server.js";\n           let server = LivelyServer.servers.values().next().value;\n        ',oc),4);case 4:Tb.openInWindow({remoteTarget:{code:"server",
evalEnvironment:oc}}),Sc.jumpToEnd()}})}},{name:"open scene graph inspector",exec:function(Ya,oa){oa=void 0===oa?{target:null}:oa;var Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){if(1==Ha.nextAddress)return Ha.yield(Kd.loadObjectFromPartsbinFolder("scene graph inspector"),2);Tb=Ha.yieldResult;Tb.targetMorph=oa.target||Ya;return Ha.return(Tb.openInWindow({title:"morph graph"}))})}},{name:"open browser",progressIndicator:"opening browser...",exec:function(Ya,oa,Tb,Ha){oa=void 0===
oa?{packageName:"lively.morphic",moduleName:"morph.js"}:oa;var ab,vb,oc,Sc,md;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xd){switch(xd.nextAddress){case 1:return(ab=Ha&&Ya.relayCommandExecutionToFocusedMorph(Ha))?xd.return(ab):xd.yield(System.import("lively.ide/js/browser/index.js"),2);case 2:return vb=xd.yieldResult,oc=vb.default,oa?(md=Kd.obj.select(oa,["packageName","moduleName","textPosition","codeEntity","systemInterface"]),xd.yield(oc.browse(md,{extent:Kd.pt(700,600)}),6)):
xd.yield(oc.open(),5);case 5:Sc=xd.yieldResult;xd.jumpTo(4);break;case 6:Sc=xd.yieldResult;case 4:return Sc.getWindow().activate(),xd.return(Sc)}})}},{name:"choose and browse package resources",progressIndicator:"browsing resources...",exec:function(Ya,oa,Tb,Ha){oa=void 0===oa?{browser:null,systemInterface:null}:oa;var ab,vb,oc,Sc,md,xd,nd,$d,Ie,lf,te,yf,df,Xe,gg,Ug,ci,Vh,Zg,tg,Hi,zj,Wh,xg;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gh){switch(gh.nextAddress){case 1:if(ab=Ha&&Ya.relayCommandExecutionToFocusedMorph(Ha))return gh.return(ab);
vb=(vb=oa.browser||Ya.focusedMorph&&Ya.focusedMorph.ownerChain().find(function(sh){return sh.isBrowser}))&&vb.isBrowser?vb.getWindow():null;return gh.yield(System.import("lively-system-interface"),2);case 2:return oc=gh.yieldResult,Sc=oc.localInterface,md=oa&&oa.systemInterface?oa.systemInterface:vb?vb.systemInterface:Sc,gh.yield(md.getPackages({excluded:Kd.config.ide.js.ignoredPackages}),3);case 3:xd=gh.yieldResult,nd=[],$d={},Ie=$jscomp.makeIterator(xd),lf=Ie.next();case 4:if(lf.done)return gh.yield(Ya.filterableListPrompt("Choose module to open",
nd,{historyId:"lively.morphic-choose and browse package resources",requester:vb,width:700,multiSelect:!0,fuzzy:"value.shortName"}),8);$d.$jscomp$loop$prop$p$2981=lf.value;$d.$jscomp$loop$prop$excluded$2980=(Kd.Path("lively.ide.exclude").get($d.$jscomp$loop$prop$p$2981)||[]).map(function(sh){return sh.includes("*")?new RegExp(sh.replace(/\*/g,".*")):sh});$d.$jscomp$loop$prop$excluded$2980.push(".git","node_modules",".module_cache");te=nd.push;yf=te.apply;df=nd;Xe=$jscomp;gg=Xe.arrayFromIterable;Ug=
function(sh){return function(Ei){return{isListItem:!0,string:"["+sh.$jscomp$loop$prop$p$2981.name+"] "+Ei.nameInPackage+(Ei.isLoaded?"":" [not loaded]"),value:Ei}}}($d);ci=function(sh){return function(Ei){var Gf=Ei.url;return!Gf.endsWith("/")&&!sh.$jscomp$loop$prop$excluded$2980.some(function(Aj){return Aj instanceof RegExp?Aj.test(Gf):Gf.includes(Aj)})}}($d);return gh.yield(md.resourcesOfPackage($d.$jscomp$loop$prop$p$2981,$d.$jscomp$loop$prop$excluded$2980),7);case 7:yf.call(te,df,gg.call(Xe,gh.yieldResult.filter(ci).sort(function(sh,
Ei){return sh.isLoaded&&!Ei.isLoaded?-1:!sh.isLoaded&&Ei.isLoaded?1:sh.nameInPackage.toLowerCase()<Ei.nameInPackage.toLowerCase()?-1:sh.nameInPackage.toLowerCase()==Ei.nameInPackage.toLowerCase()?0:1}).map(Ug)));$d={$jscomp$loop$prop$excluded$2980:$d.$jscomp$loop$prop$excluded$2980,$jscomp$loop$prop$p$2981:$d.$jscomp$loop$prop$p$2981};lf=Ie.next();gh.jumpTo(4);break;case 8:return Vh=gh.yieldResult,Zg=Vh.selected,tg=$jscomp.makeIterator(Kd.arr.partition(Zg,function(sh){return sh.url.match(/\.js(on)?/)})),
Hi=tg.next().value,zj=tg.next().value,gh.yield(System.import("lively.ide/js/browser/index.js"),9);case 9:return Wh=gh.yieldResult,xg=Wh.default,gh.yield(Promise.all(Hi.map(function(sh){return xg.browse({packageName:sh.package,moduleName:sh.url},vb,md).then(function(Ei){return Ei.activate()})})),10);case 10:if(!zj.length){gh.jumpTo(11);break}return gh.yield(Promise.all(zj.map(function(sh){return Ya.execCommand("open file",{url:sh.url})})),11);case 11:return gh.return(!0)}})}},{name:"choose and browse module",
progressIndicator:"browsing module...",handlesCount:!0,exec:function(Ya,oa,Tb){oa=void 0===oa?{browser:void 0,systemInterface:void 0}:oa;var Ha,ab,vb,oc,Sc,md,xd,nd,$d,Ie,lf,te,yf,df,Xe,gg,Ug,ci,Vh;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Zg){switch(Zg.nextAddress){case 1:if(!oa.browser&&(ab=(Ha=Ya.focusedMorph)&&Ha.getWindow())&&ab.targetMorph&&ab.targetMorph.isFileBrowser)return Zg.return(ab.targetMorph.execCommand("find file and select",oa,Tb));vb=oa.browser||Ha&&Ha.ownerChain().find(function(tg){return tg.isBrowser});
return Zg.yield(System.import("lively.ide/js/browser/index.js"),2);case 2:return oc=Zg.yieldResult,Sc=oc.default,Zg.yield(System.import("lively-system-interface"),3);case 3:return md=Zg.yieldResult,xd=md.localInterface,nd=oa&&oa.systemInterface?oa.systemInterface:vb?vb.systemInterface:xd,$d="local"==nd.name?"":" on ["+Kd.string.truncate(nd.name,35,"...")+"]",Zg.yield(nd.getPackages(),4);case 4:Ie=Zg.yieldResult;lf=[];te=$jscomp.makeIterator(Ie);for(yf=te.next();!yf.done;yf=te.next())for(df=yf.value,
Xe=Kd.Path("lively.ide.exclude").get(df)||[],Xe=Xe.map(function(tg){return tg.includes("*")?new RegExp(tg.replace(/\*/g,".*")):tg}),gg={},Ug=$jscomp.makeIterator(df.modules),ci=Ug.next();!ci.done;gg={$jscomp$loop$prop$m$2983:gg.$jscomp$loop$prop$m$2983},ci=Ug.next())gg.$jscomp$loop$prop$m$2983=ci.value,Xe.some(function(tg){return function(Hi){return Hi instanceof RegExp?Hi.test(tg.$jscomp$loop$prop$m$2983.name):tg.$jscomp$loop$prop$m$2983.name.includes(Hi)}}(gg))||(Vh=nd.shortModuleName(gg.$jscomp$loop$prop$m$2983.name,
df),lf.push({isListItem:!0,string:"["+df.name+"] "+Vh,value:{package:df,module:gg.$jscomp$loop$prop$m$2983,shortName:Vh}}));lf=Kd.arr.sortBy(lf,function(tg){return tg.string});(function(){var tg,Hi,zj,Wh,xg,gh,sh,Ei,Gf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Aj){switch(Aj.nextAddress){case 1:return tg=vb||Ha,Aj.yield(Ya.filterableListPrompt("Choose module to open"+$d,lf,{historyId:"lively.morphic-choose and browse module",requester:tg,height:Math.min(tg.height,700),width:500,multiSelect:!0,
listFontColor:"white",fuzzy:"value.shortName"}),2);case 2:Hi=Aj.yieldResult,zj=Hi.selected,Wh=0;case 3:if(!(Wh<zj.length)){Aj.jumpTo(0);break}xg=zj[Wh];gh=xg.package;sh=xg.shortName;Ei={packageName:gh.name,moduleName:sh};return Aj.yield(Sc.browse(Ei,0===Wh?vb:void 0,nd),6);case 6:Gf=Aj.yieldResult,Gf.moveBy(Kd.pt(20*Wh,20*Wh)),Gf.getWindow().activate(),Wh++,Aj.jumpTo(3)}})})();return Zg.return(!0)}})}},{name:"open code search",progressIndicator:"opening code search...",exec:function(Ya,oa){oa=void 0===
oa?{browser:null,systemInterface:null,input:null}:oa;var Tb,Ha,ab,vb,oc,Sc,md,xd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nd){if(1==nd.nextAddress){Tb=Ya.focusedMorph?Ya.focusedMorph.ownerChain():[];Ha=oa.browser||Tb.find(function($d){return $d.isBrowser});ab=Kd.LoadingIndicator.open("loading code search");if(Ha&&Ha.isBrowser){if(Ha.state.associatedSearchPanel)return nd.return(Ha.state.associatedSearchPanel.getWindow().activate())}else Ha=null;return nd.yield(System.import("lively-system-interface"),
2)}if(3!=nd.nextAddress)return vb=nd.yieldResult,oc=vb.localInterface,Sc=oa.systemInterface||Ha&&Ha.systemInterface,Sc||(Sc=(md=Tb.find(function($d){return $d.isText&&$d.editorPlugin&&$d.editorPlugin.isJSEditorPlugin}))?md.editorPlugin.systemInterface():oc),nd.yield(Kd.resource("part://SystemIDE/code search").read(),3);xd=nd.yieldResult;Object.assign(xd,{browser:Ha,input:oa.input,systemInterface:Sc});xd.openInWindow();xd.focus();ab.remove();Ha&&(Ha.state.associatedSearchPanel=xd);return nd.return(xd)})}},
{name:"open grep search",progressIndicator:"opening code search...",exec:function(Ya,oa){var Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){if(1==Ha.nextAddress)return Ha.yield(Kd.loadObjectFromPartsbinFolder("grep search"),2);Tb=Ha.yieldResult;return Ha.return(Tb.openInWorldNearHand(Ya).activate())})}},{name:"open test runner",progressIndicator:"opening test runner...",exec:function(Ya){var oa,Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){return 1==Ha.nextAddress?
Ha.yield(System.import("lively.ide/test-runner.js"),2):3!=Ha.nextAddress?(oa=Ha.yieldResult,Tb=oa.default,Ha.yield(Tb.open(),3)):Ha.return(Ha.yieldResult)})}},{name:"open file browser",progressIndicator:"opening file browser...",exec:function(Ya,oa){oa=void 0===oa?{}:oa;var Tb,Ha,ab,vb,oc,Sc,md;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xd){if(1==xd.nextAddress)return xd.yield(System.import("lively.ide/http-file-browser.js"),2);Tb=xd.yieldResult;Ha=Tb.default;ab=oa;vb=ab.location;
oc=ab.url;md=(Sc=ab.file)?Ha.forFile(Sc,vb):Ha.forLocation(oc||vb||document.location.origin);return xd.return(Ya.openInWindow(md).activate())})}},{name:"open file",progressIndicator:"opening file...",exec:function(Ya,oa){oa=void 0===oa?{url:null,lineNumber:null,reuse:!1}:oa;var Tb,Ha,ab,vb,oc,Sc,md,xd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nd){switch(nd.nextAddress){case 1:Tb=oa;Ha=Tb.url;ab=Tb.lineNumber;vb=Tb.reuse;oc=Ya.commandHandler.progressIndicator;if(Ha){nd.jumpTo(2);
break}oc.visible=!1;return nd.yield(Ya.prompt("Enter file location",{historyId:"lively.morphic-text editor url",useLastInput:!0}),3);case 3:Ha=nd.yieldResult,oc.visible=!0;case 2:if(vb&&(Ya.getWindows().slice(-2),Sc=Kd.arr.findAndGet(Ya.getWindows(),function($d){return($d=$d.targetMorph)&&$d.isTextEditor&&$d.location.split(":")[0]===Ha?$d:null})))return"number"===typeof ab&&(Sc.lineNumber=ab),nd.return(Sc.getWindow().activate());ab&&(Ha+=":"+ab);return nd.yield(System.import("lively.ide/text-editor.js"),
4);case 4:return md=nd.yieldResult,xd=md.default,nd.return(Ha?xd.openURL(Ha,Kd.obj.dissoc(oa,["url"])):null)}})}},{name:"open file for EDITOR",exec:function(Ya,oa){oa=void 0===oa?{url:null,lineNumber:null}:oa;var Tb,Ha,ab,vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(oc){return 1==oc.nextAddress?oc.yield(System.import("lively.ide/text-editor.js"),2):3!=oc.nextAddress?(Tb=oc.yieldResult,Ha=Tb.default,ab=oa,vb=ab.url,oc.yield(Ha.openAsEDITOR(vb,{}),3)):oc.return(oc.yieldResult)})}},
{name:"open subserver controller",exec:function(Ya,oa){var Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){if(1==Ha.nextAddress)return Ha.yield(Kd.loadPart("subserver controller"),2);Tb=Ha.yieldResult;return Ha.return(Tb.openInWorld())})}},{name:"[lively.installer] publish new version of a package",exec:function(Ya){var oa,Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){switch(Ha.nextAddress){case 1:return Ha.yield(lively.modules.registerPackage(document.location.origin+
"/lively.installer"),2);case 2:return Ha.yield(System.import("lively.installer/packages/publish-new-package-version.js"),3);case 3:return oa=Ha.yieldResult,Tb=oa.default,Ha.yield(Tb(),4);case 4:return Ha.return(!0)}})}},{name:"report a bug",exec:function(Ya){return $jscomp.asyncExecutePromiseGeneratorProgram(function(oa){window.open("https://github.com/LivelyKernel/lively.next/issues/new","_blank");return oa.return(!0)})}},{name:"fix font metric",exec:function(Ya){return $jscomp.asyncExecutePromiseGeneratorProgram(function(oa){Ya.env.fontMetric.reset();
Ya.withAllSubmorphsDo(function(Tb){return Tb.isText&&Tb.textLayout&&Tb.textLayout.reset()});return oa.return(!0)})}},{name:"delete change history",exec:function(Ya){var oa=Ya.env,Tb=oa.printStatus();oa.deleteHistory();Ya.setStatusMessage(Tb);Ya._componentsBrowser&&Ya._componentsBrowser.reset();return!0}},{name:"install global inspect and show",exec:function(Ya){window.show=Kd.show;window.inspect=Kd.inspect;Ya.setStatusMessage("inspect() and show() are now globally available");return!0}},{name:"save world",
exec:function(Ya,oa,Tb,Ha){var ab,vb,oc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sc){if(1==Sc.nextAddress){if(ab=Ha&&Ya.relayCommandExecutionToFocusedMorph(Ha))return Sc.return(ab);oa=Object.assign({confirmOverwrite:!0,showSaveDialog:!0},oa);vb=Ya.focusedMorph;return Sc.yield(Kd.interactivelySaveWorld(Ya,oa),2)}oc=Sc.yieldResult;vb&&vb.focus();return Sc.return(oc)})}},{name:"freeze world",exec:function(Ya){return $jscomp.asyncExecutePromiseGeneratorProgram(function(oa){return oa.yield(Kd.interactivelyFreezeWorld(Ya),
0)})}},{name:"save this world",exec:function(Ya,oa,Tb,Ha){return Ya.execCommand("save world",Object.assign({confirmOverwrite:!0},oa,{showSaveDialog:!1}))}},{name:"load world",exec:function(Ya,oa){oa=void 0===oa?{}:oa;var Tb,Ha,ab,vb,oc,Sc,md,xd,nd,$d,Ie;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lf){switch(lf.nextAddress){case 1:Tb=oa;Ha=Tb.id;ab=Tb.commit;vb=Tb.name;oc=Tb.ref;Sc=Tb.world;md=Ya.constructor;if(Sc)return lf.return(md.loadWorld(Sc,Ya));if(Ha||ab)return lf.return(md.loadFromCommit(Ha||
ab,Ya));if(vb)return lf.return(md.loadFromDB(vb,oc,Ya));xd=Kd.LoadingIndicator.open("loading project browser...");return lf.yield(xd.whenRendered(),2);case 2:nd=Kd.morph({fill:Kd.Color.black.withA(.5),extent:Ya.extent,name:"dark overlay",opacity:0,reactsToPointer:!1,renderOnGPU:!0,halosEnabled:!1});nd.openInWorld(Kd.pt(0,0));nd.animate({opacity:1,duration:300});if($d=Ya.get("a project browser")){lf.jumpTo(3);break}return lf.yield(Kd.resource("part://partial freezing/project browser").read(),4);case 4:$d=
lf.yieldResult;case 3:return Ie=$d,Ie.name="a project browser",Ie.hasFixedPosition=!0,Ie.epiMorph=!0,Ie.bringToFront().alignInWorld(Ya),Ie.update(),Ie.focus(),Kd.once(Ie,"remove",function(){return nd.animate({opacity:0}).then(function(){return nd.remove()})}),xd.remove(),lf.return(Ie)}})}},{name:"add external package dependency to object",exec:function(Ya,oa){oa=void 0===oa?{}:oa;var Tb,Ha,ab,vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(oc){if(1==oc.nextAddress)return Tb=oa.target||
Ya,Ha=Tb.metadata&&Tb.metadata.externalPackages||[],oc.yield(Ya.editListPrompt("modify package dependencies of "+Tb,Ha),2);ab=oc.yieldResult;vb=ab.list;if(!vb)return oc.return();vb.length?(Tb.metadata||(Tb.metadata={}),Tb.metadata.externalPackages=vb):Tb.metadata&&delete Tb.metadata.externalPackages;return oc.return(!0)})}},{name:"toggle comment browser",exec:function(Ya){return $jscomp.asyncExecutePromiseGeneratorProgram(function(oa){Kd.CommentBrowser.toggle();oa.jumpToEnd()})}}];var lb=Kd.commands;
Kd.default=lb;var cb=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js");cb.RadialGradient=cd;cb.Point=ie;cb.pt=Vd;cb.rect=Uc;cb.Color=Bc;cb.LinearGradient=ac;cb.Morph=Db;cb.Tooltip=Tc;cb.Image=Zb;cb.VerticalLayout=Nc;cb.GridLayout=wc;cb.Text=Hd;cb.Ellipse=Vc;cb.morph=bf;cb.Icon=hb;cb.num=zc;cb.arr=jd;cb.connect=Ub;cb.signal=Jc;cb.Popover=qf;cb.ColorPalette=wg;cb.ColorPicker=kh;cb.colorWidgets=rd;cb.joinPath=Wc;cb.WHEEL_URL=cb.joinPath(System.baseURL,"/lively.ide/assets/color-wheel.png");
(function(Ya){var oa=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Tb=oa.hasOwnProperty("GradientTypeSelector")&&"function"===typeof oa.GradientTypeSelector?oa.GradientTypeSelector:oa.GradientTypeSelector=function(Ha){Ha&&Ha[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Ad(Tb,Ya,[{key:"defaultLinearGradient",get:function(){return new cb.LinearGradient({stops:[{color:cb.Color.white,offset:0},{color:cb.Color.black,
offset:1}]})}},{key:"defaultRadialGradient",get:function(){return new cb.RadialGradient({stops:[{color:cb.Color.white,offset:0},{color:cb.Color.black,offset:1}],focus:cb.pt(.5,.5),bounds:cb.rect(0,0,30,30)})}},{key:"update",value:function(Ha){var ab=$jscomp.makeIterator(this.submorphs),vb=ab.next().value;ab=ab.next().value;vb.borderColor=ab.borderColor=cb.Color.gray.darker();Ha instanceof cb.RadialGradient?vb.borderColor=cb.Color.orange:Ha instanceof cb.LinearGradient&&(ab.borderColor=cb.Color.orange)}}],
[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientTypeSelector"}},{key:"properties",get:function(){return{fill:{defaultValue:cb.Color.transparent},layout:{initialize:function(){this.extent=cb.pt(180,40);this.layout=new cb.GridLayout({grid:[[null,"radialMode",null,"linearMode",null]],autoAssign:!1,fitToCell:!1})}},submorphs:{initialize:function(){var Ha=this,ab=$jscomp.makeIterator(this.submorphs=[cb.morph({type:"ellipse",master:{auto:"styleguide://SystemWidgets/gradient mode/deselected"},
name:"radialMode",fill:this.defaultRadialGradient}),cb.morph({type:"ellipse",master:{auto:"styleguide://SystemWidgets/gradient mode/deselected"},name:"linearMode",fill:this.defaultLinearGradient})]),vb=ab.next().value;ab=ab.next().value;cb.connect(vb,"onMouseDown",function(){return cb.signal(Ha,"radial")});cb.connect(ab,"onMouseDown",function(){return cb.signal(Ha,"linear")})}}}}}],oa,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:660,end:2566})})(cb.Morph);var Cc=function(Ya){var oa=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Tb=oa.hasOwnProperty("GradientEditor")&&"function"===typeof oa.GradientEditor?oa.GradientEditor:oa.GradientEditor=function(Ha){Ha&&Ha[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return Ad(Tb,Ya,[{key:"remove",value:function(){Ad._get(Object.getPrototypeOf(Tb.prototype),"remove",this).call(this);this.gradientHandle&&this.gradientHandle.remove()}},{key:"selectRadialGradient",value:function(){var Ha=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){return 1==ab.nextAddress?(Ha.get("linearMode").borderColor=cb.Color.gray.darker(),Ha.get("radialMode").borderColor=cb.Color.orange,ab.yield(Ha.applyGradient(cb.RadialGradient),2)):ab.yield(Ha.updateGradientHandles(),
0)})}},{key:"selectLinearGradient",value:function(){var Ha=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){return 1==ab.nextAddress?(Ha.get("radialMode").borderColor=cb.Color.gray.darker(),Ha.get("linearMode").borderColor=cb.Color.orange,ab.yield(Ha.applyGradient(cb.LinearGradient),2)):ab.yield(Ha.updateGradientHandles(),0)})}},{key:"applyGradient",value:function(Ha){var ab=this,vb,oc,Sc,md,xd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nd){vb=ab.gradientValue;
ab.get("gradientEditor");vb&&vb.isGradient?(oc=vb,Sc=oc.stops,md=oc.focus,xd=oc.vector,ab.gradientValue=new Ha({stops:Sc,bounds:ab.gradientBounds,focus:md,vector:xd})):ab.gradientValue=new Ha({stops:[{color:cb.Color.white,offset:0},{color:cb.Color.black,offset:1}],bounds:ab.gradientBounds});ab.update(ab.gradientValue);nd.jumpToEnd()})}},{key:"showGradientHandlesOn",value:function(Ha){this.handleMorph=Ha;this.updateGradientHandles()}},{key:"updateGradientHandles",value:function(){var Ha=this,ab,vb;
return $jscomp.asyncExecutePromiseGeneratorProgram(function(oc){if(1==oc.nextAddress)return ab=300,vb=Ha.gradientValue.__proto__.constructor,Ha.handleMorph?Ha.gradientHandle?oc.yield(Ha.gradientHandle.fadeOut(ab),3):oc.jumpTo(2):oc.return();vb==cb.RadialGradient?Ha.gradientHandle=new cb.GradientFocusHandle({target:Ha.handleMorph}):vb==cb.LinearGradient&&(Ha.gradientHandle=new cb.GradientDirectionHandle({target:Ha.handleMorph}));Ha.gradientHandle&&(cb.signal(Ha,"openHandle",Ha.gradientHandle),Ha.gradientHandle.relayout(),
Ha.gradientHandle.opacity=0,Ha.gradientHandle.animate({opacity:1,duration:ab}));oc.jumpToEnd()})}},{key:"update",value:function(Ha){(Ha=void 0===Ha?this.gradientValue:Ha)&&Ha.isGradient&&this.get("gradientEditor").update(Ha)}},{key:"build",value:function(){var Ha;this.submorphs=[Ha=new cb.GradientTypeSelector({name:"typeSelector"}),this.gradientEditor()];cb.connect(Ha,"radial",this,"selectRadialGradient");cb.connect(Ha,"linear",this,"selectLinearGradient");cb.connect(this,"gradientValue",this,"update");
this.update(this.gradientValue);Ha.update(this.gradientValue);this.gradientValue&&this.updateGradientHandles()}},{key:"gradientEditor",value:function(){return cb.morph({fill:null,clipMode:"hidden",extent:cb.pt(190,80),submorphs:[new cb.GradientStopVisualizer({position:cb.pt(5,30),name:"gradientEditor",gradientEditor:this})]})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientEditor"}},{key:"properties",get:function(){return{layout:{initialize:function(){this.layout=new cb.VerticalLayout({spacing:3})}},
fill:{defaultValue:cb.Color.transparent},handleMorph:{},gradientValue:{set:function(Ha){Ha&&Ha.isGradient||(Ha=!1);this.setProperty("gradientValue",Ha)}},submorphs:{initialize:function(){this.build()}}}}}],oa,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:2575,end:6191})}(cb.Morph);
cb.GradientEditor=Cc;cb.GradientEditor=Cc;cb.GradientEditor=Cc;(function(Ya){var oa=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Tb=oa.hasOwnProperty("StopControlHead")&&"function"===typeof oa.StopControlHead?oa.StopControlHead:oa.StopControlHead=function(Ha){Ha&&Ha[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Ad(Tb,Ya,[{key:"update",value:function(Ha){var ab=this.getSubmorphNamed("paletteField");
this.getSubmorphNamed("pickerField");ab||(this.submorphs=[ab=this.paletteField(cb.pt(10,10))]);ab.fill=this.stopColor=Ha.stops[this.index].color}},{key:"onHoverIn",value:function(){var Ha=this.targetProperty.stops[this.index].color;this.palette=this.palette||new cb.Popover({name:"Color Palette",targetMorph:new cb.ColorPalette({color:Ha})});cb.connect(this.palette.targetMorph,"color",this.palette,"color");this.picker=this.picker||new cb.ColorPicker({color:Ha});this.picker.color=Ha;this.scheduleExpand()}},
{key:"onHoverOut",value:function(){this.scheduleShrink()}},{key:"scheduleExpand",value:function(){this.queue.pop()||(this.queue.push(this.expand),this.dequeue())}},{key:"scheduleShrink",value:function(){this.queue.pop()||(this.queue.push(this.shrink),this.dequeue())}},{key:"dequeue",value:function(){var Ha=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){if(1==ab.nextAddress){if(Ha.queueActive)return ab.return();Ha.queueActive=!0}if(3!=ab.nextAddress)return 0<Ha.queue.length?ab.yield(Ha.queue.shift().bind(Ha)(),
2):ab.jumpTo(3);Ha.queueActive=!1;ab.jumpToEnd()})}},{key:"expand",value:function(){var Ha=this,ab,vb,oc,Sc,md,xd,nd;return $jscomp.asyncExecutePromiseGeneratorProgram(function($d){if(1<Ha.submorphs.length)return $d.return();ab=Ha.get("paletteField");oc=cb.pt(2,-14);Ha.submorphs=[Ha.closeButton(),ab,Ha.pickerField()];Ha.master={auto:"styleguide://SystemWidgets/stop control head/expanded"};vb=Ha.get("gradientEditor");Sc=Ha.transformRectToMorph(vb,Ha.innerBounds());md=Sc.x;xd=Sc.width;nd=md+xd-vb.width;
md<Ha.width/2&&(oc=oc.addXY(Ha.width/3-md,0));nd>Ha.width/2&&(oc=oc.addXY(Ha.width/3-nd,0));ab.extent=cb.pt(15,15);Ha.center=oc;Ha.stopVisualizer.gradientEditor.update();$d.jumpToEnd()})}},{key:"shrink",value:function(){var Ha=this,ab,vb,oc,Sc,md;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xd){if(3>Ha.submorphs.length)return xd.return();ab=cb.pt(2,-14);vb=$jscomp.makeIterator([Ha.get("close"),Ha.get("paletteField"),Ha.get("pickerField")]);oc=vb.next().value;Sc=vb.next().value;md=vb.next().value;
Sc.bringToFront();oc.remove();md.remove();Ha.master={auto:"styleguide://SystemWidgets/stop control head/collapsed"};Ha.center=ab;xd.jumpToEnd()})}},{key:"onWidgetClosed",value:function(){this.palette=this.picker=null;this.shrink()}},{key:"removeStop",value:function(){this.stopVisualizer.removeStop(this.index)&&this.remove()}},{key:"closeButton",value:function(){var Ha=new cb.Morph({name:"close",extent:cb.pt(15,15),fill:cb.Color.transparent,origin:cb.pt(0,-3),clipMode:"hidden",submorphs:[cb.Icon.makeLabel("times",
{styleClasses:["closeButton"]})]});cb.connect(Ha,"onMouseDown",this,"removeStop");return Ha}},{key:"updateColor",value:function(Ha){this.stopVisualizer.updateStop(this.index,{color:Ha})}},{key:"openColorWidget",value:function(Ha){this.stopVisualizer.stopControls.forEach(function(ab){return ab.head.closeAllWidgets()});this[Ha].topLeft=cb.pt(0,0);cb.connect(this[Ha],"color",this,"updateColor");cb.connect(this[Ha],"close",this,"onWidgetClosed");cb.connect(this.stopVisualizer,"remove",this[Ha],"remove");
cb.connect(this[Ha],"onBlur",this,"removeWhenLostFocus",{converter:function(){return Ha},varMapping:{name:Ha}});this[Ha].fadeIntoWorld(this.globalBounds().bottomCenter());this[Ha].focus()}},{key:"removeWhenLostFocus",value:function(Ha){var ab=this;setTimeout(function(){$world.focusedMorph.ownerChain().includes(ab[Ha])||$world.focusedMorph.isMenuItem?ab[Ha].focus():ab.closeColorWidget(Ha)},100)}},{key:"closeColorWidget",value:function(Ha){this[Ha]&&this[Ha].remove()}},{key:"closeAllWidgets",value:function(){this.closeColorWidget("palette");
this.closeColorWidget("picker")}},{key:"paletteField",value:function(Ha){Ha=cb.morph({type:"ellipse",name:"paletteField",extent:Ha,styleClasses:["paletteField"]});cb.connect(Ha,"onMouseDown",this,"openColorWidget",{converter:function(){return"palette"}});return Ha}},{key:"pickerField",value:function(){var Ha=new cb.Image({name:"pickerField",styleClasses:["pickerField"]});cb.connect(Ha,"onMouseDown",this,"openColorWidget",{converter:function(){return"picker"}});return Ha}}],[{key:Symbol.for("__LivelyClassName__"),
get:function(){return"StopControlHead"}},{key:"properties",get:function(){return{stopVisualizer:{},gradientEditor:{},targetProperty:{get:function(){return this.stopVisualizer.targetProperty}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/stop control head/collapsed"}}},index:{},queue:{defaultValue:[]},isHaloItem:{defaultValue:!0}}}}],oa,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:6193,end:11487})})(cb.Morph);(function(Ya){var oa=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Tb=oa.hasOwnProperty("GradientStopVisualizer")&&"function"===typeof oa.GradientStopVisualizer?oa.GradientStopVisualizer:oa.GradientStopVisualizer=function(Ha){Ha&&Ha[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return Ad(Tb,Ya,[{key:"update",value:function(Ha){this.fill=new cb.LinearGradient({stops:Ha.stops,vector:"eastwest"});this.get("instruction").animate({visible:!1,duration:300});this.renderStopControls(Ha)}},{key:"onHoverOut",value:function(){this.toggleStopPreview(!1)}},{key:"onMouseMove",value:function(Ha){var ab=Ha.positionIn(this);Ha=ab.x;this.stopControls&&this.stopControls.find(function(vb){return vb.bounds().containsPoint(ab)})?this.toggleStopPreview(!1):(this.toggleStopPreview(!0),
this.get("stopControlPreview").position=cb.pt(Ha,0))}},{key:"onMouseDown",value:function(Ha){if(this.get("stopControlPreview").visible){var ab=Ha.positionIn(this).x/this.width;Ha=this.targetProperty.stops.findIndex(function(vb){return vb.offset>ab});Ha=0>Ha?this.targetProperty.stops.length-1:Ha;this.insertStop(Ha,ab)}}},{key:"toggleStopPreview",value:function(Ha){this.get("instruction").visible||(this.get("stopControlPreview").visible=Ha)}},{key:"removeStop",value:function(Ha){var ab=this.targetProperty;
return 2<ab.stops.length?(cb.arr.removeAt(ab.stops,Ha),this.targetProperty=ab,!0):!1}},{key:"insertStop",value:function(Ha,ab){var vb=this.targetProperty;cb.arr.pushAt(vb.stops,{offset:ab,color:vb.stops[Ha].color},Ha);this.targetProperty=vb}},{key:"updateStop",value:function(Ha,ab){var vb=this.targetProperty;vb.stops[Ha]=Object.assign({},vb.stops[Ha],{},ab);this.targetProperty=vb}},{key:"renderStopControls",value:function(Ha){var ab=this;if(!this.stopControls||this.stopControls.length!=Ha.stops.length){var vb=
$jscomp.makeIterator(this.submorphs),oc=vb.next().value;vb=vb.next().value;this.stopControls=Ha.stops.map(function(Sc,md){return new cb.GradientStopControl({stopVisualizer:ab,index:md})});this.submorphs=[oc,vb].concat($jscomp.arrayFromIterable(this.stopControls));cb.arr.invoke(this.stopControls,"update",Ha)}cb.arr.invoke(this.stopControls,"update",Ha)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientStopVisualizer"}},{key:"properties",get:function(){return{fill:{defaultValue:cb.Color.gray},
gradientEditor:{},draggable:{defaultValue:!1},targetProperty:{derived:!0,get:function(){return this.gradientEditor&&this.gradientEditor.gradientValue},set:function(Ha){this.gradientEditor.gradientValue=Ha}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient stop visualizer"}}},submorphs:{after:["gradientEditor"],initialize:function(){this.submorphs=[{type:"label",name:"instruction",value:"Select Gradient Type",visible:!(this.targetProperty&&this.targetProperty.isGradient)},
{name:"stopControlPreview",visible:!1,master:{auto:"styleguide://SystemWidgets/stop control preview"},submorphs:[cb.Icon.makeLabel("plus-circle",{name:"addStopLabel"})]}]}}}}}],oa,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:11489,end:14883})})(cb.Morph);(function(Ya){var oa=
lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Tb=oa.hasOwnProperty("GradientStopControl")&&"function"===typeof oa.GradientStopControl?oa.GradientStopControl:oa.GradientStopControl=function(Ha){Ha&&Ha[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Ad(Tb,Ya,[{key:"update",value:function(Ha){this.position=this.stopVisualizer.extent.subPt(cb.pt(10,0)).scaleByPt(cb.pt(Ha.stops[this.index].offset,0)).addPt(cb.pt(5,
0));this.head.update(Ha)}},{key:"onDragStart",value:function(Ha){this.nativeCursor="-webkit-grabbing";this.stopVisualizer.nativeCursor="-webkit-grabbing";this.offsetView=(new cb.Tooltip).openInWorld(Ha.hand.position.addPt(cb.pt(10,10)))}},{key:"onDrag",value:function(Ha){var ab=Math.max(0,Math.min(1,(this.position.x-5+Ha.state.dragDelta.x)/(this.stopVisualizer.width-10)));this.stopVisualizer.updateStop(this.index,{offset:ab});this.offsetView.description=(100*ab).toFixed(2)+"%";this.offsetView.position=
Ha.hand.position.addPt(cb.pt(10,10))}},{key:"onDragEnd",value:function(){this.nativeCursor="-webkit-grab";this.stopVisualizer.nativeCursor="auto";this.offsetView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientStopControl"}},{key:"properties",get:function(){return{index:{},head:{},stopVisualizer:{},styleClasses:{defaultValue:["stopControlLine"]},nativeCursor:{defaultValue:"-webkit-grab"},draggable:{defaultValue:!0},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient stop control"}}},
submorphs:{after:["index","stopVisualizer"],initialize:function(){this.head=new cb.StopControlHead({name:"stop control head",stopVisualizer:this.stopVisualizer,index:this.index});this.head.stopControl=this;this.addMorph(this.head)}}}}}],oa,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},
{start:14885,end:16661})})(cb.Morph);(function(Ya){var oa=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Tb=oa.hasOwnProperty("FocusHandle")&&"function"===typeof oa.FocusHandle?oa.FocusHandle:oa.FocusHandle=function(Ha){Ha&&Ha[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Ad(Tb,Ya,[{key:"relayout",value:function(){this.center=this.gradientHandle.innerBounds().center()}},{key:"onDragStart",value:function(Ha){this.tfm=
this.gradientHandle.target.getGlobalTransform().inverse();this.focusView=(new cb.Tooltip).openInWorld(Ha.hand.position.addPt(cb.pt(10,10)))}},{key:"onDrag",value:function(Ha){var ab=Ha.state.dragDelta,vb=this.gradientHandle,oc=vb.target.fill;oc.focus=oc.focus.addXY(ab.x/vb.target.width,ab.y/vb.target.height);this.focusView.description="x: "+(100*oc.focus.x).toFixed()+"%, y: "+(100*oc.focus.y).toFixed()+"%";this.focusView.position=Ha.hand.position.addPt(cb.pt(10,10));vb.target.makeDirty();vb.relayout()}},
{key:"onDragEnd",value:function(Ha){this.focusView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"FocusHandle"}},{key:"properties",get:function(){return{gradientHandle:{},styleClasses:{defaultValue:["focusHandle"]},extent:{defaultValue:cb.pt(20,20)},fill:{defaultValue:cb.Color.orange}}}}],oa,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},
package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:16663,end:17666})})(cb.Ellipse);(function(Ya){var oa=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Tb=oa.hasOwnProperty("BoundsHandle")&&"function"===typeof oa.BoundsHandle?oa.BoundsHandle:oa.BoundsHandle=function(Ha){Ha&&Ha[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Ad(Tb,Ya,[{key:"relayout",value:function(){this.center=this.gradientHandle.innerBounds().partNamed(this.side);
this.scale=1/this.gradientHandle.target.getGlobalTransform().getScale()}},{key:"onDragStart",value:function(Ha){this.boundsView=(new cb.Tooltip).openInWorld(Ha.hand.position.addPt(cb.pt(10,10)))}},{key:"onDrag",value:function(Ha){var ab=this.gradientHandle,vb=ab.target.fill,oc=vb.bounds.partNamed(this.side).addPt(Ha.state.dragDelta.scaleBy(2));vb.bounds=vb.bounds.withPartNamed(this.side,oc);this.boundsView.description="w: "+vb.bounds.width.toFixed()+"px h: "+vb.bounds.height.toFixed()+"px";this.boundsView.position=
Ha.hand.position.addPt(cb.pt(10,10));ab.target.makeDirty();ab.relayout()}},{key:"onDragEnd",value:function(Ha){this.boundsView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"BoundsHandle"}},{key:"properties",get:function(){return{side:{},gradientHandle:{},styleClasses:{after:["side"],initialize:function(){this.styleClasses=["boundsHandle",this.side]}}}}}],oa,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:17668,end:18747})})(cb.Ellipse);var La=function(Ya){var oa=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Tb=oa.hasOwnProperty("GradientFocusHandle")&&"function"===typeof oa.GradientFocusHandle?oa.GradientFocusHandle:oa.GradientFocusHandle=function(Ha){Ha&&Ha[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return Ad(Tb,Ya,[{key:"relayout",value:function(){var Ha=this.target.fill,ab=Ha.focus;this.extent=Ha.bounds.extent();this.submorphs.forEach(function(vb){return vb.relayout()});this.rotation=this.target.rotation;this.scale=this.target.scale;this.borderWidth=2/this.scale;this.owner&&(this.center=this.owner.localizePointFrom(this.target.extent.scaleByPt(ab),this.target))}},{key:"initBoundsHandles",value:function(){var Ha=this;this.bounds().sides.forEach(function(ab){Ha.addMorph(new cb.BoundsHandle({gradientHandle:Ha,
side:ab,name:"bounds handle "+ab.split("C")[0]}))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientFocusHandle"}},{key:"properties",get:function(){return{target:{},isHaloItem:{defaultValue:!0},hasFixedPosition:{defaultValue:!0},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient focus handle"}}},submorphs:{initialize:function(){this.submorps=[];this.initBoundsHandles();this.addMorph(new cb.FocusHandle({gradientHandle:this}));this.relayout()}}}}}],
oa,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:18756,end:20039})}(cb.Ellipse);cb.GradientFocusHandle=La;cb.GradientFocusHandle=La;cb.GradientFocusHandle=La;(function(Ya){var oa=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Tb=oa.hasOwnProperty("RotationPoint")&&
"function"===typeof oa.RotationPoint?oa.RotationPoint:oa.RotationPoint=function(Ha){Ha&&Ha[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Ad(Tb,Ya,[{key:"relayout",value:function(){this.center=cb.Point.polar(this.gradientHandle.width/2,this.gradientHandle.target.fill.vectorAsAngle())}},{key:"onDragStart",value:function(Ha){this.angleView=(new cb.Tooltip).openInWorld(Ha.hand.position.addPt(cb.pt(10,10)));this.angleView.rotation=
0}},{key:"onDrag",value:function(Ha){var ab=this.gradientHandle;ab.target.fill.vector=Ha.positionIn(ab).theta();ab.target.makeDirty();ab.relayout();this.angleView.description=(cb.num.toDegrees(ab.target.fill.vectorAsAngle())+180).toFixed()+"\u00b0";this.angleView.position=Ha.hand.position.addPt(cb.pt(10,10))}},{key:"onDragEnd",value:function(Ha){this.angleView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"RotationPoint"}},{key:"properties",get:function(){return{gradientHandle:{}}}}],
oa,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:20041,end:20838})})(cb.Ellipse);(function(Ya){var oa=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Tb=oa.hasOwnProperty("GradientDirectionHandle")&&"function"===typeof oa.GradientDirectionHandle?
oa.GradientDirectionHandle:oa.GradientDirectionHandle=function(Ha){Ha&&Ha[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Ad(Tb,Ya,[{key:"isHaloItem",get:function(){return!0}},{key:"relayout",value:function(){this.owner&&(this.position=this.owner.localizePointFrom(this.target.extent.scaleBy(.5),this.target));this.rotationPoint.relayout()}},{key:"initRotationPoint",value:function(){this.rotationPoint=this.addMorph(new cb.RotationPoint({gradientHandle:this,
name:"rotation point"}))}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientDirectionHandle"}},{key:"properties",get:function(){return{target:{},origin:{defaultValue:cb.pt(25,25)},extent:{defaultValue:cb.pt(50,50)},hasFixedPosition:{defaultValue:!0},submorphs:{initialize:function(){this.initRotationPoint();this.relayout()}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient direction handle"}}}}}}],oa,{pathInPackage:function(){return"styling/gradient-editor.js"},
unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:20840,end:21812})})(cb.Ellipse);cb.colorWidgets.GradientEditor=cb.GradientEditor;var Sa=lively.FreezerRuntime.recorderFor("lively.ide/world.js");Sa.resource=rc;Sa.Rectangle=lc;Sa.Color=Bc;Sa.pt=Vd;Sa.arr=jd;Sa.fun=Xd;Sa.obj=ge;Sa.promise=xc;Sa.PropertyPath=Bd;Sa.once=he;Sa.GridLayout=wc;Sa.MorphicDB=
Pc;Sa.easings=kf;Sa.HTMLMorph=sc;Sa.Text=Hd;Sa.Label=Za;Sa.Path=Pa;Sa.Polygon=ua;Sa.morph=bf;Sa.Ellipse=Vc;Sa.touchInputDevice=Na;Sa.Icon=hb;Sa.Morph=Db;Sa.VerticalLayout=Nc;Sa.HorizontalLayout=Wa;Sa.ProportionalLayout=Vb;Sa.Tooltip=Tc;Sa.Image=Zb;Sa.inspect=We;Sa.config=Ae;Sa.World=Fa;Sa.loadMorphFromSnapshot=Xa;Sa.loadObjectFromPartsbinFolder=wd;Sa.loadPart=ce;Sa.uploadFile=Bg;Sa.InformPrompt=gc;Sa.ConfirmPrompt=ub;Sa.MultipleChoicePrompt=qd;Sa.TextPrompt=fc;Sa.EditPrompt=Ud;Sa.PasswordPrompt=td;
Sa.ListPrompt=fd;Sa.EditListPrompt=Xb;Sa.LoadingIndicator=pe;Sa.Halo=C;Sa.MorphHighlighter=Df;Sa.StatusMessage=Bf;Sa.StatusMessageForMorph=Pe;Sa.ProportionalLayoutHalo=Tf;Sa.GridLayoutHalo=fg;Sa.FlexLayoutHalo=kg;Sa.Window=Me;Sa.List=ic;Sa.FilterableList=Wb;Sa.Menu=$a;Sa.worldCommands=lb;Sa.GradientEditor=Cc;Sa.completions=ma;Sa.runEval=Ta;Sa.getClassName=qb;Sa.serialize=ec;Sa.Canvas=Ic;Sa.CommentBrowser=zf;Sa.prefetchCoreStyleguides=ud;lb=db("LivelyWorld",function(Ya){var oa=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),
Tb=oa.hasOwnProperty("LivelyWorld")&&"function"===typeof oa.LivelyWorld?oa.LivelyWorld:oa.LivelyWorld=function(Ha){Ha&&Ha[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Ad(Tb,Ya,[{key:"visibleBoundsExcludingTopBar",value:function(){var Ha=$world.getSubmorphNamed("lively top bar"),ab=this.visibleBounds();return Ha?new Sa.Rectangle(ab.x,ab.y+Ha.height,ab.width,ab.height-Ha.height):ab}},{key:"getListedComponents",value:function(){var Ha=
this,ab=this.withAllSubmorphsSelect(function(vb){return vb.isComponent&&!Ha.hiddenComponents.includes(vb.name)});return Sa.arr.uniq([].concat($jscomp.arrayFromIterable(ab),$jscomp.arrayFromIterable(this.localComponents)))}},{key:"activeWindow",value:function(){return this.getWindows().reverse().find(function(Ha){return Ha.isActive()})}},{key:"getWindows",value:function(){return this.submorphs.filter(function(Ha){return Ha.isWindow})}},{key:"activePrompt",value:function(){return this.getPrompts().reverse().find(function(Ha){return Ha.isActive()})}},
{key:"getPrompts",value:function(){return this.submorphs.filter(function(Ha){return Ha.isPrompt})}},{key:"openInWindow",value:function(Ha,ab){ab=void 0===ab?{title:Ha.name,name:"window for "+Ha.name}:ab;Ha=(new Sa.Window(Object.assign({},ab,{extent:Ha.extent.addXY(0,25),targetMorph:Ha}))).openInWorld();Ha.ensureNotOverTheTop();return Ha}},{key:"withTopBarDo",value:function(Ha){var ab=this.get("lively top bar");ab&&Ha(ab)}},{key:"onTopBarLoaded",value:function(){}},{key:"onKeyUp",value:function(Ha){this.withTopBarDo(function(ab){return ab.onKeyUp(Ha)})}},
{key:"onKeyDown",value:function(Ha){Ad._get(Object.getPrototypeOf(Tb.prototype),"onKeyDown",this).call(this,Ha);Ha.targetMorph==this&&this.withTopBarDo(function(ab){return ab.onKeyDown(Ha)})}},{key:"onMouseDown",value:function(Ha){Ad._get(Object.getPrototypeOf(Tb.prototype),"onMouseDown",this).call(this,Ha);var ab=Ha.state.clickedOnMorph,vb=this.activeWindow();vb&&ab==this&&vb.deactivate();this.handleHaloCycle(Ha);Ha.state.menu&&Ha.state.menu.remove();this._tooltipViewer.mouseDown(Ha)}},{key:"onMouseUp",
value:function(Ha){Ha.isCommandKey()&&Ha.stop();if(Ha.isAltDown()&&Sa.config.altClickDefinesThat){var ab=this.morphsContainingPoint(Ha.position)[0];setTimeout(function(){return System.global.that=ab},100);ab.show();Ha.stop();console.log('Set global "that" to '+ab)}}},{key:"onDrag",value:function(Ha){}},{key:"whenReady",value:function(){var Ha=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){return 1==ab.nextAddress?ab.yield(Ha._styleLoading,2):ab.return(!0)})}},{key:"onLoad",value:function(){var Ha=
this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){if(1==ab.nextAddress){Ha.opacity=0;Ha.onWindowResize();lively.modules&&lively.modules.removeHook("fetch",window.__logFetch);Ha.animate({opacity:1,blur:3,duration:1E3,easing:Sa.easings.inOutExpo}).then(function(){var vb,oc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sc){if(1==Sc.nextAddress){if(!(vb=window.worldLoadingIndicator))return Sc.jumpTo(0);oc=vb.world();if(oc==Ha)return Sc.jumpTo(0);vb.withAllSubmorphsDo(function(md){return md._env=
Ha.env});Ha.addMorph(vb);return Sc.yield(oc.whenRendered(),4)}oc.env.renderer.stopRenderWorldLoop();Sc.jumpToEnd()})});if(!Ha.showsUserFlap&&!Sa.resource(document.location.href).query().showsUserFlap)return ab.jumpTo(2);Ha._styleLoading=Sa.prefetchCoreStyleguides(window.worldLoadingIndicator);return ab.yield(Ha._styleLoading,2)}Ha.animate({blur:0,duration:1E3,easing:Sa.easings.inOutExpo});document.body.style.overflowX="visible";document.body.style.overflowY="visible";ab.jumpToEnd()})}},{key:"isNotUnique",
value:function(Ha){var ab,vb,oc,Sc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(md){switch(md.nextAddress){case 1:return md.yield(Sa.MorphicDB.default.exists("world",Ha),2);case 2:if(ab=md.yieldResult.exists){md.jumpTo(3);break}vb=Ha+".json";oc=Sa;Sc=oc.resource;return md.yield(System.decanonicalize("lively.morphic/styleguides"),5);case 5:return md.yield(Sc.call(oc,md.yieldResult).join(vb).exists(),4);case 4:ab=md.yieldResult;case 3:return md.return(ab)}})}},{key:"askForName",value:function(){var Ha=
this,ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){switch(vb.nextAddress){case 1:return vb.yield(Ha.whenRendered(),3);case 3:if(ab){vb.jumpTo(4);break}return vb.yield(Ha.prompt(["New Project\n",{},"Enter a name for this project:",{fontWeight:"normal"}],{width:400,hasFixedPosition:!0,forceConfirm:!0}),5);case 5:return ab=vb.yieldResult,vb.yield(Ha.isNotUnique(ab),6);case 6:if(!vb.yieldResult){vb.jumpTo(3);break}return vb.yield(Ha.confirm("This Project name is already taken. Please pick a different one!",
{hasFixedPosition:!0,width:400}),8);case 8:ab=!1;vb.jumpTo(3);break;case 4:return vb.return(ab)}})}},{key:"onWindowResize",value:function(Ha){Ad._get(Object.getPrototypeOf(Tb.prototype),"onWindowResize",this).call(this,Ha);"elastic"===this.resizePolicy&&this.execCommand("resize to fit window")}},{key:"nativeDrop_ensureUploadIndicator",value:function(){var Ha=this,ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){if(1==vb.nextAddress)return Ha._cachedDragIndicator||(Ha._cachedDragIndicator=
Sa.loadObjectFromPartsbinFolder("upload-indicator")),vb.yield(Ha._cachedDragIndicator,2);ab=vb.yieldResult;ab.world()||ab.openInWorld();Sa.fun.debounceNamed("remove-upload-indicator",1E3,function(){Ha.nativeDrop_removeUploadIndicator()})();vb.jumpToEnd()})}},{key:"nativeDrop_removeUploadIndicator",value:function(){this._cachedDragIndicator&&this._cachedDragIndicator.then(function(Ha){return Ha.remove()})}},{key:"onNativeDragover",value:function(Ha){Ha.targetMorph===this&&this.nativeDrop_ensureUploadIndicator()}},
{key:"onNativeDrop",value:function(Ha){var ab=this,vb,oc,Sc,md,xd,nd,$d,Ie,lf,te,yf,df,Xe,gg,Ug,ci,Vh,Zg,tg,Hi,zj,Wh,xg,gh,sh,Ei,Gf,Aj,Mc,Sd,Se,re,og,ch,hh,bn,Im,rl,Cl,gm,fo,En,go,Dn,Bj,Jm;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qg){switch(Qg.nextAddress){case 1:ab.nativeDrop_removeUploadIndicator();if(Ha.targetMorph!=ab)return Qg.return();vb=Ha;oc=vb.domEvt;Sc=oc.dataTransfer;md=Sc.files;xd=document.location.origin;if(!md.length){Qg.jumpTo(2);break}nd=ab.getCurrentUser();$d=nd.isGuestUser?
"uploads/":"users/"+$world.getCurrentUser().name+"/uploads";if(!Ha.isAltDown()){Qg.jumpTo(3);break}return Qg.yield(ab.prompt("Choose upload location",{history:"lively.morphic-html-drop-file-upload-location",input:$d}),4);case 4:if($d=Qg.yieldResult,!$d)return Qg.return(ab.setStatusMessage("Canceled upload"));case 3:return Qg.yield(ab.confirm("Upload "+md.length+" file"+(1<md.length?"s":"")+"?"),5);case 5:Ie=Qg.yieldResult;if(!Ie)return Qg.return();lf=new Sa.FormData;for(te=0;te<md.length;te++)lf.append("file",
md[te],md[te].name);Xe=Sa.LoadingIndicator.open("Uploading File");Qg.setCatchFinallyBlocks(6);gg={};Ug=function(rk){rk=rk.loaded/rk.total;Xe.progress=rk;Xe.status="Uploaded "+(100*rk).toFixed()+"%"};nd.isGuestUser||(gg.Authorization="Bearer "+nd.token);yf=Sa.resource(System.baseURL,{headers:gg,onProgress:Ug,onLoad:function(rk){return df=rk}});yf=yf.join("/upload?uploadPath="+encodeURIComponent($d));return Qg.yield(yf.write(lf),8);case 8:Qg.leaveTryBlock(7);break;case 6:return ci=Qg.enterCatchBlock(),
Qg.return(ab.showError("Upload failed: "+ci.message+"\n"));case 7:Xe.remove();Qg.setCatchFinallyBlocks(9);ab.setStatusMessage("Uploaded "+df.uploadedFiles.length+" file");Vh=df.uploadedFiles.map(function(rk){var hm=Sa.resource(xd).join(rk.path);return Object.assign({},rk,{url:hm.url,name:hm.name()})});Zg=[];tg=[];Hi=[];zj=$jscomp.makeIterator(Vh);for(Wh=zj.next();!Wh.done;Wh=zj.next())xg=Wh.value,xg.type.startsWith("image/")?Zg.push(xg):xg.type.startsWith("video")?tg.push(xg):Hi.push(xg);if(!tg.length){Qg.jumpTo(11);
break}gh=$jscomp.makeIterator(tg);sh=gh.next();case 12:if(sh.done){Qg.jumpTo(11);break}Ei=sh.value;Gf=Object;Aj=Gf.assign;return Qg.yield(Sa.loadObjectFromPartsbinFolder("video morph"),15);case 15:Aj.call(Gf,Qg.yieldResult,{videoURL:Ei.url,name:Ei.name}).openInWorld();sh=gh.next();Qg.jumpTo(12);break;case 11:Zg.length&&Zg.forEach(function(rk){var hm=new Sa.Image({imageUrl:rk.url,autoResize:!0,name:rk.name});hm.whenLoaded().then(function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fn){if(1==
Fn.nextAddress)return hm.extent=hm.naturalExtent.scaleBy(.8*ab.visibleBounds().height/hm.height),hm.openInWorld(),Fn.yield(hm.whenRendered(),2);hm.center=ab.visibleBounds().center();Fn.jumpToEnd()})})});if(!Hi.length){Qg.jumpTo(16);break}Mc=$jscomp.makeIterator(Hi);Sd=Mc.next();case 17:if(Sd.done){Qg.jumpTo(16);break}Se=Sd.value;return Qg.yield(ab.confirm("open file "+Se.name+" ("+Se.type+")?"),20);case 20:(re=Qg.yieldResult)&&ab.execCommand("open file",{url:Se.url});Sd=Mc.next();Qg.jumpTo(17);break;
case 16:Qg.leaveTryBlock(10);break;case 9:og=Qg.enterCatchBlock(),ab.showError(og);case 10:return Qg.return();case 2:ch=oc.dataTransfer.types;if(!ch.includes("text/html")){Qg.jumpTo(21);break}hh=oc.dataTransfer.getData("text/html");bn=(new Sa.DOMParser).parseFromString(hh,"text/html");Im=bn.querySelectorAll("img");if(1===Im.length&&Im[0].src&&ch.includes("text/uri-list")){rl=Im[0].src;Cl=new Sa.Image({imageUrl:rl,autoResize:!0,name:Sa.arr.last(rl.split("/"))});Cl.whenLoaded().then(function(){return Cl.openInWorld()});
Qg.jumpTo(22);break}gm=Object;fo=gm.assign;return Qg.yield(Sa.loadObjectFromPartsbinFolder("html-morph"),23);case 23:fo.call(gm,Qg.yieldResult,{html:hh}).openInWorld();case 22:return Qg.return();case 21:En=0;case 24:if(!(En<oc.dataTransfer.items.length)){Qg.jumpTo(0);break}go=oc.dataTransfer.items[En];if("file"!==go.kind){"string"===go.kind&&go.getAsString(function(rk){return Sa.inspect(rk)});Qg.jumpTo(25);break}Dn=go.getAsFile();return Qg.yield(ab.confirm("Upload "+Dn.name+"?"),28);case 28:Bj=Qg.yieldResult;
if(!Bj){Qg.jumpTo(25);break}return Qg.yield(Sa.uploadFile(Dn,Dn.type),30);case 30:(Jm=Qg.yieldResult)&&Jm.openInWorld(),Jm.center=ab.visibleBounds().center();case 25:En++,Qg.jumpTo(24)}})}},{key:"menuItems",value:function(){var Ha=this;return[{title:"World menu"},{command:"undo",target:this},{command:"redo",target:this},{isDivider:!0},["Debugging",[{command:"delete change history",target:this},{command:"fix font metric",target:this},{command:"inspect server",target:this}]],["Tools",[{command:"open javascript workspace",
target:this},{command:"open browser",target:this},{command:"choose and browse module",target:this},{command:"open code search",target:this},{command:"open file browser",target:this},{command:"open shell workspace",target:this,tooltip:"Opens a workspace like interface\nthat allows you to trigger shell comands\nvia select + eval by pressing either "+(new Sa.Text).keysForCommand("doit")+" or "+(new Sa.Text).keysForCommand("printit")},{command:"open shell terminal",target:this,tooltip:"Opens a classic remote shell interface,\nthat allows you to send commands to a\nbash session running on the server.\nAlso comes with advanced git support."},
{command:"open workspace",args:{askForMode:!0},target:this}]],{isDivider:!0},{command:"run command",target:this},{command:"select morph",target:this},{command:"window switcher",target:this},["Exported Components",[["Toggle Select All",function(){0==Ha.getListedComponents().length?Ha.hiddenComponents=[]:Ha.hiddenComponents=Ha.withAllSubmorphsSelect(function(ab){return ab.isComponent}).map(function(ab){return ab.name})}]].concat($jscomp.arrayFromIterable(this.withAllSubmorphsSelect(function(ab){return ab.isComponent}).map(function(ab){var vb=
Ha.hiddenComponents.includes(ab.name);return[[].concat($jscomp.arrayFromIterable(Sa.Icon.textAttribute(vb?"square":"check-square")),["  "+ab.name,{}]),function(){Ha.hiddenComponents=vb?Sa.arr.without(Ha.hiddenComponents,ab.name):[ab.name].concat($jscomp.arrayFromIterable(Ha.hiddenComponents))}]})))],["Resize","static"===this.resizePolicy?[{command:"resize to fit window",target:this},{command:"resize manually",target:this},["switch to automatic resizing of world",function(){return Ha.resizePolicy=
"elastic"}]]:[["switch to manual resizing of world",function(){return Ha.resizePolicy="static"}]]],["Troubleshooting",[{command:"report a bug",target:this},{command:"clear storage and reload",target:this}]],{isDivider:!0},["Windows",[{command:"toggle minimize all windows",target:this},{command:"close all windows",target:this}]],{isDivider:!0},{command:"save world",target:this},{command:"load world",target:this}]}},{key:"openWorldMenu",value:function(Ha,ab){var vb=this.env.eventDispatcher.eventState;
vb.menu&&vb.menu.remove();return vb.menu=ab&&ab.length?Sa.Menu.openAtHand(ab,{hand:Ha&&Ha.hand||this.firstHand}):null}},{key:"onPaste",value:function(Ha){var ab=this,vb,oc,Sc,md,xd,nd,$d,Ie,lf,te,yf,df;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xe){switch(Xe.nextAddress){case 1:Xe.setCatchFinallyBlocks(2,3);oc=Ha.domEvt.clipboardData;if(!oc.types.includes("application/morphic")){Xe.jumpTo(3);break}Ha.stop();Sc=JSON.parse(oc.getData("application/morphic"));md=[];Array.isArray(Sc)||
(Sc=[Sc]);vb=Sa.LoadingIndicator.open("pasting morphs...");xd=$jscomp.makeIterator(Sc);nd=xd.next();case 6:if(nd.done){Xe.jumpTo(8);break}$d=nd.value;return Xe.yield(Sa.loadMorphFromSnapshot($d),9);case 9:Ie=Xe.yieldResult;Ie.openInWorld(Ha.hand.position);$d.copyMeta&&$d.copyMeta.offset&&(lf=$d.copyMeta.offset,te=lf.x,yf=lf.y,Ie.moveBy(Sa.pt(te,yf)));md.push(Ie);nd=xd.next();Xe.jumpTo(6);break;case 8:ab.showHaloFor(md);case 3:Xe.enterFinallyBlock();vb&&vb.remove();Xe.leaveFinallyBlock(0);break;case 2:df=
Xe.enterCatchBlock(),ab.showError(df),Xe.jumpTo(3)}})}},{key:"commands",get:function(){return Sa.worldCommands.concat(Ad._get(Object.getPrototypeOf(Tb.prototype),"commands",this)).concat([{name:"open in prototype box",exec:function(Ha,ab){var vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(oc){if(1==oc.nextAddress)return oc.yield(Sa.loadPart("prototype box"),2);vb=oc.yieldResult;vb.wrapProto(ab.target);oc.jumpToEnd()})}}])}},{key:"keybindings",get:function(){return Ad._get(Object.getPrototypeOf(Tb.prototype),
"keybindings",this).concat(Sa.config.globalKeyBindings)}},{key:"keybindings",set:function(Ha){Ad._set(Object.getPrototypeOf(Tb.prototype),"keybindings",Ha,this)}},{key:"halos",value:function(){return this.submorphs.filter(function(Ha){return Ha.isHalo})}},{key:"haloForPointerId",value:function(Ha){return this.submorphs.find(function(ab){return ab.isHalo&&ab.state&&ab.state.pointerId===Ha})}},{key:"showHaloFor",value:function(Ha,ab,vb){ab=void 0===ab?this.firstHand&&this.firstHand.pointerId:ab;vb=
void 0===vb?!0:vb;if(Sa.Halo)return Ha="function"===typeof Ha.createHalo?Ha.createHalo(Sa.Halo,ab):new Sa.Halo({pointerId:ab,target:Ha}),this.addMorph(Ha),vb&&Ha.focus(),Ha.alignWithTarget(),Ha}},{key:"showHaloForSelection",value:function(Ha,ab){return 0<Ha.length&&this.showHaloFor(Ha,ab)}},{key:"layoutHaloForPointerId",value:function(Ha){Ha=void 0===Ha?this.firstHand&&this.firstHand.pointerId:Ha;return this.submorphs.find(function(ab){return ab.isLayoutHalo&&ab.state&&ab.state.pointerId===Ha})}},
{key:"showLayoutHaloFor",value:function(Ha,ab){ab=void 0===ab?this.firstHand&&this.firstHand.pointerId:ab;var vb=Ha===this?null:Ha.owner===this?Ha:Ha.ownerChain().slice(-2)[0];vb=vb?this.submorphs.indexOf(vb)+1:this.submorphs.length;switch(Ha.layout.constructor){case Sa.ProportionalLayout:var oc=new Sa.ProportionalLayoutHalo({container:Ha,pointerId:ab});break;case Sa.HorizontalLayout:case Sa.VerticalLayout:oc=new Sa.FlexLayoutHalo({container:Ha,pointerId:ab});break;case Sa.GridLayout:oc=new Sa.GridLayoutHalo({container:this.container,
pointerId:ab})}return oc&&this.addMorphAt(oc,vb)}},{key:"highlightMorph",value:function(Ha,ab,vb,oc){oc=void 0===oc?[]:oc;return Sa.MorphHighlighter.for(Ha,ab,void 0===vb?!1:vb,oc)}},{key:"removeHighlighters",value:function(Ha){return Sa.MorphHighlighter.removeHighlighters(void 0===Ha?this:Ha)}},{key:"visibleStatusMessages",value:function(){return this.submorphs.filter(function(Ha){return Ha.isStatusMessage})}},{key:"visibleStatusMessagesFor",value:function(Ha){return this.submorphs.filter(function(ab){return ab.isStatusMessage&&
ab.targetMorph===Ha})}},{key:"logErrorPreperation",value:function(Ha){var ab=String(Ha),vb=Ha.stack||"";vb&&Ha.message!==Ha.stack&&(vb=String(vb),0===vb.indexOf(ab)&&(vb=vb.slice(ab.length)),ab+="\n"+vb);return ab}},{key:"logError",value:function(Ha){this.setStatusMessage(this.logErrorPreperation(Ha),Sa.Color.red)}},{key:"showError",value:function(Ha){return this.logError(Ha)}},{key:"showErrorFor",value:function(Ha,ab){return this.setStatusMessageFor(Ha,this.logErrorPreperation(ab),Sa.Color.red)}},
{key:"setStatusMessageFor",value:function(Ha,ab,vb,oc,Sc){oc=void 0===oc?5E3:oc;if(Sa.StatusMessageForMorph){this.visibleStatusMessagesFor(Ha).forEach(function(md){return md.remove()});ab=new Sa.StatusMessageForMorph(Object.assign({message:ab,color:vb},Sc));this.openStatusMessage(ab,oc);ab.targetMorph=Ha;ab.fadeIn(300);if(ab.removeOnTargetMorphChange&&Ha.isText)Sa.once(Ha,"selectionChange",ab,"fadeOut",{converter:function(){return 200},garbageCollect:!0});return ab}}},{key:"setStatusMessage",value:function(Ha,
ab,vb,oc){vb=void 0===vb?5E3:vb;oc=void 0===oc?{}:oc;if(Sa.StatusMessage)return console[ab==Sa.Color.red?"error":"log"](Ha),Sa.config.verboseLogging?this.openStatusMessage(new Sa.StatusMessage(Object.assign({message:Ha,color:ab,hasFixedPosition:!0},oc)),vb):null}},{key:"openStatusMessage",value:function(Ha,ab){this.addMorph(Ha);if(Ha.slidable){for(var vb=this.visibleStatusMessages(),oc=$jscomp.makeIterator(vb),Sc=oc.next();!Sc.done;Sc=oc.next()){Sc=Sc.value;if(vb.length<=(Sa.config.maxStatusMessages||
0))break;!Sc.stayOpen&&Sc.slidable&&(Sc.remove(),Sa.arr.remove(vb,Sc))}Sa.arr.without(vb,Ha).forEach(function(md){return $jscomp.asyncExecutePromiseGeneratorProgram(function(xd){!md.isMaximized&&md.slidable&&md.slideTo(md.position.addPt(Sa.pt(0,-Ha.extent.y-10)));xd.jumpToEnd()})});vb=this.visibleBounds().bottomRight().addXY(-20,-20);Ha.align(Ha.bounds().bottomRight(),vb);Ha.topRight=vb.addPt(Sa.pt(0,40));Ha.animate({bottomRight:vb,duration:500})}"number"===typeof ab&&setTimeout(function(){return Ha.stayOpen||
Ha.fadeOut()},ab);return Ha}},{key:"addProgressBar",value:function(Ha){Ha=void 0===Ha?{}:Ha;var ab=this,vb,oc,Sc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(md){if(1==md.nextAddress)return vb=Ha,oc=void 0===vb.location?"center":vb.location,md.yield(Sa.loadObjectFromPartsbinFolder("progress bar"),2);Sc=md.yieldResult;Object.assign(Sc,{progress:0},Sa.obj.dissoc(Ha,["location"]));ab.addMorph(Sc);Sc.align(Sc[oc],ab.visibleBounds()[oc]());return md.return(Sc)})}},{key:"withProgressBarDo",
value:function(Ha,ab){var vb=this,oc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sc){switch(Sc.nextAddress){case 1:return Sc.yield(vb.addProgressBar(ab),2);case 2:return oc=Sc.yieldResult,Sc.setFinallyBlock(3),Sc.yield(Ha(oc),5);case 5:return Sc.return(Sc.yieldResult);case 3:Sc.enterFinallyBlock(),oc.remove(),Sc.leaveFinallyBlock(0)}})}},{key:"openPrompt",value:function(Ha,ab){ab=void 0===ab?{requester:null,animated:!1}:ab;var vb=this,oc,Sc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(md){oc=
vb.focusedMorph;Sc=vb.visibleBounds();return md.return(vb.withRequesterDo(ab.requester,function(xd){return $jscomp.asyncExecutePromiseGeneratorProgram(function(nd){Ha.openInWorldNear(xd,vb);Ha.height>Sc.height&&(Ha.height=Sc.height-5);"function"===typeof ab.customize&&ab.customize(Ha);ab.animated&&vb.previousPrompt&&vb.previousPrompt.world()&&vb.previousPrompt.transitionTo(Ha);vb.previousPrompt=Ha;return nd.return(Sa.promise.finally(Ha.activate(ab),function(){return oc&&oc.focus()}))})}))})}},{key:"withRequesterDo",
value:function(Ha,ab){var vb=this,oc,Sc,md;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xd){switch(xd.nextAddress){case 1:Sc=vb.visibleBounds().center();if(!Ha){xd.jumpTo(2);break}Sc=Ha.globalBounds().center();Ha.isWorld&&(Sc=Ha.visibleBounds().center());if(!(oc=Ha.getWindow())){xd.jumpTo(2);break}return xd.yield(oc.toggleFader(!0),4);case 4:Sc=oc.globalBounds().center();case 2:return xd.yield(ab(Sc),5);case 5:return md=xd.yieldResult,oc&&oc.toggleFader(!1),xd.return(md)}})}},{key:"inform",
value:function(Ha,ab){ab=void 0===ab?{fontSize:16,requester:null,animated:!0}:ab;return this.openPrompt(new Sa.InformPrompt(Object.assign({label:void 0===Ha?"no message":Ha},ab)),ab)}},{key:"prompt",value:function(Ha,ab){ab=void 0===ab?{requester:null,input:"",historyId:null,useLastInput:!1,selectInput:!1}:ab;Ha=new Sa.TextPrompt(Object.assign({label:Ha},ab));ab.forceConfirm&&Ha.get("cancel button").disable();return this.openPrompt(Ha,ab)}},{key:"editPrompt",value:function(Ha,ab){ab=void 0===ab?{requester:null,
input:"",historyId:null,useLastInput:!1,textStyle:null,mode:null,evalEnvironment:null}:ab;return this.openPrompt(new Sa.EditPrompt(Object.assign({label:Ha},ab)),ab)}},{key:"passwordPrompt",value:function(Ha,ab){ab=void 0===ab?{requester:null,input:""}:ab;return this.openPrompt(new Sa.PasswordPrompt(Object.assign({label:Ha},ab)),ab)}},{key:"confirm",value:function(Ha,ab){ab=void 0===ab?{requester:null,animated:!0}:ab;return this.openPrompt(new Sa.ConfirmPrompt(Object.assign({label:Ha},ab)),ab)}},{key:"multipleChoicePrompt",
value:function(Ha,ab){ab=void 0===ab?{requester:null,animated:!0,choices:[]}:ab;return this.openPrompt(new Sa.MultipleChoicePrompt(Object.assign({label:Ha},ab)),ab)}},{key:"listPrompt",value:function(Ha,ab,vb){Ha=void 0===Ha?"":Ha;ab=void 0===ab?[]:ab;vb=void 0===vb?{requester:null,onSelection:null,preselect:0}:vb;return this.openPrompt(new Sa.ListPrompt(Object.assign({filterable:!1,padding:Sa.Rectangle.inset(3),label:Ha,items:ab},vb)),vb)}},{key:"filterableListPrompt",value:function(Ha,ab,vb){Ha=
void 0===Ha?"":Ha;ab=void 0===ab?[]:ab;vb=void 0===vb?{requester:null,onSelection:null,preselect:0,multiSelect:!1,historyId:null,fuzzy:!1,actions:["default"],selectedAction:"default",theme:"dark"}:vb;return vb.prompt?(Ha=vb.prompt.get("list"),Ha.items=ab,Ha.selectedIndex=vb.preselect||0,this.openPrompt(vb.prompt,vb)):this.openPrompt(new Sa.ListPrompt(Object.assign({filterable:!0,padding:Sa.Rectangle.inset(3),label:Ha,items:ab},vb)),vb)}},{key:"editListPrompt",value:function(Ha,ab,vb){ab=void 0===
ab?[]:ab;vb=void 0===vb?{requester:null,multiSelect:!0,historyId:null}:vb;return this.openPrompt(new Sa.EditListPrompt(Object.assign({label:void 0===Ha?"":Ha,multiSelect:!0,items:ab,padding:Sa.Rectangle.inset(3)},vb)),vb)}},{key:"showLoadingIndicatorFor",value:function(Ha,ab){return this.addMorph(Sa.LoadingIndicator.open(ab,{center:Ha.globalBounds().center()}))}},{key:"defaultMenuItems",value:function(Ha,ab){function vb(te){var yf=this,df=Sc.morphsContainingPoint(xd.worldPoint(Sa.pt(0,0)));df.pop();
var Xe=df.indexOf(xd);df=df.slice(Xe+1);return df.map(function(gg){return[String(gg),te.bind(yf,gg)]})}var oc=this,Sc=this,md=[],xd=Ha;this.reset&&"function"===typeof this.reset&&md.push(["Reset",function(){oc.reset()}]);md.push(["Open in...",[["Window",function(){xd.openInWindow()}]]]);md.push(["Add morph to...",{getItems:vb.bind(xd,function(te){return te.addMorph(xd)})}]);md.push(["Get halo on...",{getItems:vb.bind(xd,function(te){return te.world().showHaloFor(te)})}]);xd.owner&&1<xd.owner.submorphs.length&&
md.push(["Arrange morph",[["Bring to front",function(){return xd.owner.addMorph(xd)}],["Send to back",function(){return xd.owner.addMorphBack(xd)}],["Fit to submorphs",function(){var te,yf,df;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xe){if(1==Xe.nextAddress)return Xe.yield(xd.world().prompt("Padding around submorphs:",{input:"Rectangle.inset(5)",historyId:"lively.morphic-fit-to-submorphs-padding-hist",requester:xd}),2);if(3!=Xe.nextAddress)return te=Xe.yieldResult,"string"!==typeof te?
Xe.return():Xe.yield(Sa.runEval(te,{topLevelVarRecorder:{Rectangle:Sa.Rectangle}}),3);yf=Xe.yieldResult;te=(df=yf.value)&&df.isRectangle?df:Sa.Rectangle.inset(0);xd.undoStart("fitToSubmorphs");xd.fitToSubmorphs(te);xd.undoStop("fitToSubmorphs");Xe.jumpToEnd()})}]].concat($jscomp.arrayFromIterable(Sa.PropertyPath("master.auto").get(xd)?[["Adjust to Master Component Submorph Hierarchy",function(){return xd.master.reconcileSubmorphs()}]]:[]))]);this.submorphs.length&&md.push(["Select all submorphs",
function(){return xd.world().showHaloFor(xd.submorphs.slice())}]);var nd=[];xd.startSteppingScripts?nd.push(["Start stepping",function(){xd.startSteppingScripts()}]):nd.push(["Start stepping",function(){var te,yf,df,Xe,gg,Ug,ci,Vh,Zg,tg,Hi,zj,Wh,xg,gh,sh,Ei,Gf,Aj,Mc,Sd,Se,re,og,ch;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hh){switch(hh.nextAddress){case 1:return te=[],yf=$jscomp,df=yf.makeIterator,hh.yield(Sa.completions.getCompletions(function(){return xd},""),2);case 2:Xe=df.call(yf,
hh.yieldResult.completions);for(gg=Xe.next();!gg.done;gg=Xe.next())for(Ug=gg.value,ci=$jscomp.makeIterator(Ug),Vh=ci.next().value,Zg=ci.next().value,tg=$jscomp.makeIterator(Zg),Hi=tg.next();!Hi.done;Hi=tg.next())zj=Hi.value,zj.startsWith("_")||zj.startsWith("$")||(Wh=$jscomp.makeIterator(zj.match(/^([^\(]+)\(?([^\)]+)?\)?$/)||[]),Wh.next(),xg=Wh.next().value,gh=Wh.next().value,xg&&"function"===typeof xd[xg]&&te.push({isListItem:!0,string:Vh+" "+zj,value:{selector:xg,args:gh}}));return hh.yield($world.filterableListPrompt("Select method to start",
te,{requester:xd,historyId:"lively.morphic-start-stepping-chooser"}),3);case 3:return sh=hh.yieldResult,Ei=$jscomp.makeIterator(sh.selected),(Gf=Ei.next().value)?hh.yield($world.prompt("Steptime in ms (how of the method will be called)?",{input:100}),4):hh.return();case 4:Aj=hh.yieldResult;Aj=Number(Aj);if(isNaN(Aj))return hh.return();Mc=[Aj,Gf.selector];if(!Gf.args){hh.jumpTo(5);break}Sd={targetModule:"lively://lively.morphic-stepping-args/eval.js"};return hh.yield($world.editPrompt("Arguments to pass",
{input:"["+Gf.args+"]",mode:"js",evalEnvironment:Sd}),6);case 6:return Se=hh.yieldResult,hh.yield(Sa.runEval(Se,Sd),7);case 7:re=hh.yieldResult;og=re.value;if(ch=re.isError)return $world.inform("Error evaluating the arguments: "+og),hh.return();Array.isArray(og)&&Mc.push.apply(Mc,$jscomp.arrayFromIterable(og));case 5:xd.startStepping.apply(xd,$jscomp.arrayFromIterable(Mc)),hh.jumpToEnd()}})}]);0!=xd.tickingScripts.length&&nd.push(["Stop stepping",function(){return xd.stopStepping()}]);0!=nd.length&&
md.push(["Stepping",nd]);md.push(["Change Tooltip",function(){var te;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yf){if(1==yf.nextAddress)return te=xd,yf.yield(xd.world().prompt("Enter Tooltip",{placeholder:"Description",input:xd.tooltip||""}),2);te.tooltip=yf.yieldResult;yf.jumpToEnd()})}]);var $d=["Morphic properties",[]];md.push($d);md.push(["display serialization info",function(){var te,yf,df;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xe){if(1==Xe.nextAddress)return Xe.yield(System.import("lively.serializer2/debugging.js"),
2);te=Xe.yieldResult;yf=te.SnapshotInspector;df=Sa.serialize(xd);yf.forSnapshot(df).openSummary();Xe.jumpToEnd()})}]);md.push(["display object report",function(){var te,yf,df;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xe){if(1==Xe.nextAddress)return Xe.yield(System.import("lively.serializer2/debugging.js"),2);te=Xe.yieldResult;yf=te.SnapshotInspector;df=Sa.serialize(xd);yf.forSnapshot(df).openObjectReport();Xe.jumpToEnd()})}]);var Ie=Sa.Icon.textAttribute("check-square"),lf=Sa.Icon.textAttribute("square");
Object.assign(Ie[1],{float:"none",display:"inline"});["grabbable","draggable","acceptsDrops","halosEnabled"].forEach(function(te){return $d[1].push([[].concat($jscomp.arrayFromIterable(Ha[te]?Ie:lf),[" "+te,{float:"none"}]),function(){return Ha[te]=!Ha[te]}])});md.push(["export to HTML",function(){var te,yf,df,Xe;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gg){if(1==gg.nextAddress)return gg.yield(System.import("lively.morphic/rendering/html-generator.js"),2);if(3!=gg.nextAddress)return te=
gg.yieldResult,yf=te.generateHTML,df=Sa.HTMLMorph,Xe="exported-"+Ha.name,gg.yield(yf(Ha,null,{isFragment:!0,addStyles:!1}),3);(new df({name:Xe,html:gg.yieldResult})).openInWorld();gg.jumpToEnd()})}]);md.push({isDivider:!0});md.push(["Add comment",function(){var te,yf,df,Xe;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gg){if(1==gg.nextAddress)return gg.yield($world.prompt("Enter comment"),2);if(4!=gg.nextAddress){te=gg.yieldResult;if(!te)return $world.setStatusMessage("Comment not saved",
"red"),gg.jumpTo(0);yf=Sa.pt(0,0);ab&&!ab.halo&&(df=xd.localize(ab.position).x/xd.width,Xe=xd.localize(ab.position).y/xd.height,yf=Sa.pt(df,Xe));return gg.yield(xd.addComment(te,yf),4)}$world.setStatusMessage("Comment saved","green");gg.jumpToEnd()})}]);return md}},{key:"defaultConnectionMenuItems",value:function(Ha){return Ha.attributeConnections&&Ha.attributeConnections.length?Ha.attributeConnections.map(function(ab){return[String(ab),[["show",function(){var vb,oc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sc){if(1==
Sc.nextAddress)return Sc.yield(System.import("lively.ide/fabrik.js"),2);vb=Sc.yieldResult;oc=vb.interactivelyShowConnection;oc(ab);Sc.jumpToEnd()})}],["edit",function(){var vb,oc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sc){if(1==Sc.nextAddress)return Sc.yield(System.import("lively.ide/fabrik.js"),2);vb=Sc.yieldResult;oc=vb.interactivelyReEvaluateConnection;oc(ab);Sc.jumpToEnd()})}],["disconnect",function(){ab.disconnect();$world.setStatusMessage("disconnected "+ab)}]]]}):null}},
{key:"defaultSourceDataBindings",value:function(Ha){var ab=Ha.propertiesAndPropertySettings().properties,vb=Sa.arr.groupByKey(Object.keys(ab).map(function(Sc){Sc=Object.assign({name:Sc},ab[Sc]);return Sc.group&&Sc.group.startsWith("_")?null:Sc}).filter(Boolean),"group");Ha=["core","geometry","interaction","styling","layouting"];var oc=[];Ha.forEach(function(Sc){return oc.push(vb[Sc])});Sa.arr.withoutAll(vb.keys(),Ha).forEach(function(Sc){return oc.push(vb[Sc])});return oc}},{key:"targetDataBindings",
value:function(Ha){for(var ab=[],vb=Ha;vb!==Object.prototype;){var oc=vb===Ha?String(this):Sa.getClassName(vb),Sc=null,md=Sa.obj.getOwnPropertyDescriptors(vb),xd=Object.getPrototypeOf(vb),nd;for(nd in md){var $d=md[nd].value;"function"!==typeof $d||$d===vb.constructor||nd.startsWith("$")||nd.startsWith("_")||(Sc||(Sc=[]),$d=Sa.fun.argumentNames($d),Sc.push({group:oc+" methods",signature:nd+"("+$d.join(", ")+")",name:nd}))}Sc&&ab.push(Sc);vb=xd}return this.defaultSourceDataBindings(Ha).concat(ab)}},
{key:"defaultConnectMenuItems",value:function(Ha,ab){var vb=this,oc=this.defaultSourceDataBindings(ab),Sc=ab.world();oc=oc.map(function(md){return[md[0].group||"uncategorized",md.map(function(xd){return[xd.name,Ha?function(){return Ha(xd.name,ab,xd)}:function(){var nd,$d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ie){if(1==Ie.nextAddress)return Ie.yield(System.import("lively.ide/fabrik.js"),2);nd=Ie.yieldResult;$d=nd.interactiveConnectGivenSource;$d(ab,xd.name);Ie.jumpToEnd()})}]})]});
Sc&&oc.push(["custom...",Ha?function(){return Ha("custom...",ab,null)}:function(){var md,xd,nd;return $jscomp.asyncExecutePromiseGeneratorProgram(function($d){if(1==$d.nextAddress)return $d.yield(System.import("lively.ide/fabrik.js"),2);if(3!=$d.nextAddress)return md=$d.yieldResult,xd=md.interactiveConnectGivenSource,$d.yield(Sc.prompt("Enter custom connection point",{requester:ab,historyId:"lively.morphic-custom-connection-points",useLastInput:!0}),3);(nd=$d.yieldResult)&&xd(vb,nd);$d.jumpToEnd()})}]);
return oc}},{key:"updateVisibleWindowMorphs",value:function(){var Ha=this;Ad._get(Object.getPrototypeOf(Tb.prototype),"updateVisibleWindowMorphs",this).call(this);this.halos().forEach(function(ab){ab.maskBounds=Ha.visibleBounds()})}},{key:"handleHaloCycle",value:function(Ha){var ab=Ha.state.clickedOnMorph,vb=Ha.isCommandKey(),oc=Ha.isShiftDown(),Sc;vb&&!ab.isHalo&&(vb=Sc=Ha.world.morphsContainingPoint(Ha.position),Sc=Sc.filter(function(md){return md.halosEnabled}),vb=vb.filter(function(md){return md.halosEnabled}),
Sc=vb[0]||Sc[0]);oc&&!ab.isHaloItem&&Sc&&Ha.halo&&Ha.halo.borderBox!=Sc?Ha.halo.addMorphToSelection(Sc):(ab=Ha.halo&&!Ha.targetMorphs.find(function(md){return md.isHaloItem||md.keepHalo&&md.keepHalo(Ha)}),oc=Ha.layoutHalo&&!Ha.targetMorphs.find(function(md){return md.isHaloItem}),vb=(!Ha.halo||ab)&&Sc,oc&&Ha.layoutHalo.remove(),ab&&Ha.halo.remove(),vb&&(Ha.stop(),this.showHaloFor(Sc,Ha.domEvt.pointerId)))}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"LivelyWorld"}},{key:"properties",
get:function(){return{localComponents:{initialize:function(){var Ha=this;this.whenRendered().then(function(){Ha.localComponents?Ha.localComponents.forEach(function(ab){var vb,oc,Sc,md,xd,nd;return $jscomp.asyncExecutePromiseGeneratorProgram(function($d){switch($d.nextAddress){case 1:if(ab.owner){$d.jumpTo(0);break}vb=ab.withAllSubmorphsSelect(function(Ie){return Ie.master&&!Ie.master._appliedMaster});oc=$jscomp.makeIterator(vb);Sc=oc.next();case 3:if(Sc.done){$d.jumpTo(5);break}md=Sc.value;return $d.yield(md.master.applyIfNeeded(!0),
4);case 4:Sc=oc.next();$d.jumpTo(3);break;case 5:xd=Ha.withAllSubmorphsSelect(function(Ie){return Ie.master&&Ie.master.uses(ab)}),nd=Ha.localComponents.filter(function(Ie){return Ie.master&&Ie.master.uses(ab)}),xd.forEach(function(Ie){Ie.requestMasterStyling()}),nd.forEach(function(Ie){return Ie.master.applyIfNeeded(!0)}),$d.jumpToEnd()}})}):Ha.localComponents=Ha.withAllSubmorphsSelect(function(ab){return ab.isComponent})})}},name:{set:function(Ha){this.setProperty("name",Ha);document.title="lively.next - "+
Ha}},hiddenComponents:{initialize:function(){this.hiddenComponents=[]}},fill:{defaultValue:Sa.Color.rgb(81,90,90)},draggable:{readOnly:!0,get:function(){return!Sa.touchInputDevice}},commentBrowser:{}}}}],oa,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:1664,end:42736})}(Sa.World));Sa.LivelyWorld=
lb;Sa.LivelyWorld=lb;Sa.LivelyWorld=lb;lb=db("SelectionElement",function(Ya){var oa=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),Tb=oa.hasOwnProperty("SelectionElement")&&"function"===typeof oa.SelectionElement?oa.SelectionElement:oa.SelectionElement=function(Ha){Ha&&Ha[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Ad(Tb,Ya,void 0,[{key:Symbol.for("__LivelyClassName__"),get:function(){return"SelectionElement"}},{key:"properties",
get:function(){return{borderColor:{defaultValue:Sa.Color.red},borderWidth:{defaultValue:1},fill:{defaultValue:Sa.Color.transparent},epiMorph:{defaultValue:!0},isSelectionElement:{readOnly:!0,get:function(){return!0}}}}}],oa,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:42745,end:43107})}(Sa.Morph));
Sa.SelectionElement=lb;Sa.SelectionElement=lb;Sa.SelectionElement=lb;lb=db("Selection",function(Ya){var oa=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),Tb=oa.hasOwnProperty("Selection")&&"function"===typeof oa.Selection?oa.Selection:oa.Selection=function(Ha){Ha&&Ha[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Ad(Tb,Ya,void 0,[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Selection"}},{key:"properties",
get:function(){return{fill:{defaultValue:Sa.Color.gray.withA(.2)},borderWidth:{defaultValue:2},borderColor:{defaultValue:Sa.Color.gray},isSelectionElement:{readOnly:!0,get:function(){return!0}}}}}],oa,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:43116,end:43436})}(Sa.Morph));Sa.Selection=lb;
Sa.Selection=lb;Sa.Selection=lb}}});