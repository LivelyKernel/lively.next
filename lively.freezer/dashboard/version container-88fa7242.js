System.register(["./__root_module__-cddb8267.js","kld-intersections","./index-6d7025d7.js","./index-5e61fbf0.js"],function(){var Ea,Cb,Kb,lc,$b,Qd,Zc,Rd,ad,Nc,nd,he,af,Af;return{setters:[function(rd){Ea=rd.an;Cb=rd.aF;Kb=rd.aD;lc=rd.ab;$b=rd.Y;Qd=rd.bP;Zc=rd.$;Rd=rd.a5;ad=rd.a7;Nc=rd.a6;nd=rd.C;he=rd.a3;af=rd.L;Af=rd.aw},function(){},function(){},function(){}],execute:function(){var rd=lively.FreezerRuntime.recorderFor("WorldVersionViewer/index.js");rd.Morph=Ea;rd.World=Cb;rd.HorizontalLayout=
Kb;rd.morph=lc;rd.MorphicDB=$b;rd.graph=Qd;rd.promise=Zc;rd.date=Rd;rd.string=ad;rd.arr=Nc;rd.Color=nd;rd.pt=he;rd.LoadingIndicator=af;(function(Ic){var Kd=lively.FreezerRuntime.recorderFor("WorldVersionViewer/index.js"),Kc=Kd.hasOwnProperty("WorldVersion")&&"function"===typeof Kd.WorldVersion?Kd.WorldVersion:Kd.WorldVersion=function(Bd){Bd&&Bd[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Af(Kc,Ic,[{key:"update",value:function(){var Bd=
$jscomp.makeIterator(this.submorphs),be=Bd.next().value;Bd=Bd.next().value;be.imageUrl=this.commit.preview;Bd.textAndAttributes=this.info;Bd.fontColor=this.selected?rd.Color.white:rd.Color.darkGray}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"WorldVersion"}},{key:"properties",get:function(){return{commit:{},fill:{defaultValue:rd.Color.transparent},info:{derived:!0,get:function(){var Bd=this.commit,be=Bd.message,yc=Bd.name,Cc=Bd.timestamp;return[Bd._id.slice(0,6)+" ",{fontWeight:"bold"},
rd.string.truncate(be.split("\n")[0],40)+" ",{}," ("+yc+" ",{},""+rd.date.format(new Date(Cc),"yyyy-mm-dd HH:MM Z"),{}]}},selected:{set:function(Bd){this.setProperty("selected",Bd);this.update()}},layout:{initialize:function(){this.layout=new rd.HorizontalLayout({align:"center",spacing:5})}},submorphs:{initialize:function(){this.submorphs=[{type:"image",extent:rd.pt(30,30),name:"preview",reactsToPointer:!1},{reactsToPointer:!1,type:"label",fill:null,name:"commit info",fontFamily:"Nunito",fontColor:rd.Color.gray}]}}}}}],
Kd,{pathInPackage:function(){return"index.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"WorldVersionViewer",version:"0.1.1-34"}}},{start:274,end:1824})})(rd.Morph);var cc=function(Ic){var Kd=lively.FreezerRuntime.recorderFor("WorldVersionViewer/index.js"),Kc=Kd.hasOwnProperty("WorldVersionViewer")&&"function"===typeof Kd.WorldVersionViewer?Kd.WorldVersionViewer:Kd.WorldVersionViewer=
function(Bd){Bd&&Bd[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Af(Kc,Ic,[{key:"reset",value:function(){this.getSubmorphNamed("version list").items=[];this.getSubmorphNamed("version list spinner").visible=!1}},{key:"onMouseDown",value:function(Bd){switch(Bd.targetMorph.name){case "visit button":this.visitSelectedCommit();break;case "revert button":this.revertToSelectedCommit()}}},{key:"visitSelectedCommit",value:function(){var Bd=
this,be,yc,Cc,Pb,Dc,Xc,Cd,Od;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gb){switch(Gb.nextAddress){case 1:return be=Bd.get("version list").selection,yc=rd.LoadingIndicator.open("Loading "+be.name+"..."),Cc=$world,Pb=Bd.db||rd.MorphicDB.default,Dc=be._id,Gb.setCatchFinallyBlocks(2,3),Dc?Gb.yield(rd.World.loadFromCommit(Dc,void 0,{morphicDB:Pb}),8):Gb.yield(rd.World.loadFromDB(be.name,be.ref,void 0,{morphicDB:Pb}),7);case 7:Xc=Gb.yieldResult;Gb.jumpTo(6);break;case 8:Xc=Gb.yieldResult;
case 6:return Cd=Xc,Gb.return(Cd);case 3:Gb.enterFinallyBlock();yc.remove();Gb.leaveFinallyBlock(0);break;case 2:Od=Gb.enterCatchBlock(),console.error(Od),Cc.showError("Error loading world:"+Od),Gb.jumpTo(3)}})}},{key:"revertToSelectedCommit",value:function(){var Bd=this,be,yc,Cc,Pb,Dc,Xc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Cd){if(1==Cd.nextAddress){be=Bd.get("version list").selection;if(!be)return Cd.return();yc=Bd.db||rd.MorphicDB.default;Cc=be;Pb=Cc._id;Dc=Cc.name;Xc=Cc.type;
return Cd.yield(yc.revert(Xc,Dc,Pb,"HEAD"),2)}return Cd.return(Bd.initializeFromStartCommit(be,yc,{showRevertButton:!0}))})}},{key:"initializeFromStartCommit",value:function(Bd,be,yc){be=void 0===be?rd.MorphicDB.default:be;yc=void 0===yc?{}:yc;var Cc=this,Pb,Dc,Xc,Cd,Od,Gb,sb,Bc,gb,rb,Sa,Ua,cb,ab,qb,Zb,kc,Rb,ma,Ia,W,sa,Za;return $jscomp.asyncExecutePromiseGeneratorProgram(function(mb){switch(mb.nextAddress){case 1:return Pb=yc,Dc=void 0===Pb.showRefs?!0:Pb.showRefs,Xc=Cc.startCommit=Bd,Cd=Xc._id,
Od=Xc.type,Gb=Xc.name,sb=Cc.getSubmorphNamed("version list spinner"),sb.visible=!0,sb.center=Cc.get("version list").center,Cc.db=be,mb.yield(be.history(Od,Gb),2);case 2:Bc=mb.yieldResult,gb=Bc.refs,rb=Bc.history,Sa=Cd,Ua=rd.graph.invert(rb),cb=rd.graph.hull(Ua,Cd),ab={_id:!0},qb=[Bd],Zb=$jscomp.makeIterator(cb),kc=Zb.next();case 3:if(kc.done)return Ia=rd.arr.max(qb,function(rc){return rc.timestamp}),Sa=Ia._id,mb.yield(be.log(Sa,void 0,!0),7);Rb=kc.value;return mb.yield(be.log(Rb,void 0,!0,ab),6);
case 6:ma=mb.yieldResult;qb.push.apply(qb,$jscomp.arrayFromIterable(ma));ma.forEach(function(rc){return ab[rc._id]=!0});kc=Zb.next();mb.jumpTo(3);break;case 7:W=mb.yieldResult;if(Dc)for(sa in gb);Za=W.map(function(rc){var xd=new rd.WorldVersion({reactsToPointer:!1,commit:rc});xd.update();return{isListItem:!0,morph:xd,value:rc}});Cc.get("version list").items=Za;sb.visible=!1;mb.jumpToEnd()}})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"WorldVersionViewer"}}],Kd,{pathInPackage:function(){return"index.js"},
unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"WorldVersionViewer",version:"0.1.1-34"}}},{start:1841,end:5718})}(rd.Morph);cc=rd.WorldVersionViewer;rd.default=cc}}});