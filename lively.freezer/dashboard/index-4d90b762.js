System.register(["./__root_module__-255c8c26.js","kld-intersections"],function(Da){var Ab,Tb,kc,ec,he,gd,Zd,kd,Sc,yd,Od,fe,Ud;return{setters:[function(md){Ab=md.bu;Tb=md.a5;kc=md.r;ec=md.a6;he=md.bo;gd=md.bv;Zd=md.bw;kd=md.T;Sc=md.s;yd=md.bx;Od=md.by;fe=md.n;Ud=md.bz},function(){}],execute:function(){function md(Q){try{var ea=eval("("+ra.ast.transform.wrapInFunction("var _; _ = ("+Q+")")+")()")}catch(Ia){return JSON.parse(Q)}return"object"!==typeof ea?null:ea}function db(Q,ea){var Ia,Ra,cc,Nb,
$a,ic,nd,vd,Xc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){switch(Wa.nextAddress){case 1:return Ia=ea.world(),Wa.yield(Ia.prompt("Enter package name",{requester:ea,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:Ra=Wa.yieldResult;if(!Ra)throw"Canceled";Wa.setCatchFinallyBlocks(3);Nb=Fa.resource(Ra);Ra=Nb.name();cc=Nb.url;Wa.leaveTryBlock(4);break;case 3:return Wa.enterCatchBlock(),Wa.yield(Q.getConfig(),5);case 5:return $a=Wa.yieldResult.baseURL,
ic=Fa.resource($a).join(Ra).asDirectory().url,Wa.yield(Q.normalize(ic),6);case 6:cc=Wa.yieldResult.replace(/\/\.js$/,"/");case 4:return Wa.yield(Ia.prompt("Confirm or change package location",{requester:ea,input:cc,historyId:"lively.vm-editor-add-package-address"}),7);case 7:nd=Wa.yieldResult;if(!nd)throw"Canceled";vd=Fa.resource(nd).asDirectory();Xc=vd.asFile().url;return Wa.yield(Q.removePackage(Xc),8);case 8:return Wa.yield(Q.resourceCreateFiles(Xc,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+
Ra+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+Ra+"\n\nNo description for package "+Ra+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+Ra+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return Wa.return(Fa.loadPackage(Q,{name:Ra,address:Xc,configFile:vd.join("package.json").url,main:vd.join("index.js").url,test:vd.join("tests/test.js").url,type:"package"}))}})}function Fb(Q,ea,Ia){Ia=void 0===Ia?
null:Ia;var Ra,cc,Nb,$a,ic,nd,vd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xc){switch(Xc.nextAddress){case 1:return Ra={name:"",address:"",type:"package"},Xc.yield(Q.getConfig(),2);case 2:cc=Xc.yieldResult;if(!Ia){Xc.jumpTo(3);break}return Xc.yield(Q.getPackage(Ia),4);case 4:if(Nb=Xc.yieldResult){Xc.jumpTo(5);break}return Xc.yield(Q.getPackageForModule(Ia),6);case 6:Nb=Xc.yieldResult;case 5:$a=Nb;case 3:return Xc.yield(ea.world().prompt("What is the package directory?",{requester:ea,
input:$a?$a.address:cc.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:ic=Xc.yieldResult;if(!ic)throw"Canceled";Ra.address=ic.replace(/\/$/,"");Ra.url=new URL(Ra.address+"/");Ra.configFile=Fa.resource(Ra.url).join("package.json").url;Xc.setCatchFinallyBlocks(8);nd=JSON;vd=nd.parse;return Xc.yield(Q.moduleRead(Ra.configFile),10);case 10:vd.call(nd,Xc.yieldResult).name;Xc.leaveTryBlock(9);break;case 8:Xc.enterCatchBlock(),Ra.name=String(Ra.url).replace(/\/$/,""),
Q.resourceEnsureExistance(Ra.configFile,'{\n  "name": "'+Ra.name+'",\n  "version": "0.1.0"\n}');case 9:return Xc.return(Fa.loadPackage(Q,Ra))}})}function tc(Q,ea,Ia){var Ra,cc,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function($a){switch($a.nextAddress){case 1:return Ra=Fa.resource(Ia).asFile().url,$a.yield(Q.getPackage(Ra),2);case 2:if(cc=$a.yieldResult){$a.jumpTo(3);break}return $a.yield(Q.getPackageForModule(Ra),4);case 4:cc=$a.yieldResult;case 3:Nb=cc;if(!Nb)throw Error("Cannot find package for "+
Ra);return $a.yield(Q.reloadPackage(Ra),5);case 5:if(!ea){$a.jumpTo(0);break}return $a.yield(ea.updateModuleList(),7);case 7:return $a.yield(ea.uiSelect(Ra,!1),8);case 8:return $a.return($a.yieldResult)}})}function nc(Q,ea,Ia,Ra){var cc,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function($a){switch($a.nextAddress){case 1:return $a.yield(Q.getPackage(Ia),2);case 2:return cc=$a.yieldResult,$a.yield((Ra||$world).confirm("Unload package "+cc.name+"?",{requester:ea}),3);case 3:Nb=$a.yieldResult;
if(!Nb)throw"Canceled";return $a.yield(Q.removePackage(Ia),4);case 4:if(!ea){$a.jumpTo(0);break}return $a.yield(ea.updateModuleList(),6);case 6:return $a.yield(ea.uiSelect(null),0)}})}function td(Q,ea,Ia){var Ra,cc,Nb,$a,ic;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nd){switch(nd.nextAddress){case 1:return Ra=ea.world(),nd.yield(Q.getPackage(Ia),2);case 2:return cc=nd.yieldResult,cc?nd.yield(Ra.confirm("Really remove package "+cc.name+"?",{requester:ea}),3):($world.inform('No package "'+
Ia+'" found!',{requester:ea}),nd.return());case 3:Nb=nd.yieldResult;if(!Nb)throw"Canceled";Q.removePackage(Ia);return nd.yield(Ra.confirm("Also remove directory "+cc.name+" including "+cc.modules.length+" modules?"),4);case 4:$a=nd.yieldResult;if(!$a){nd.jumpTo(0);break}return nd.yield(Ra.confirm("REALLY *remove* directory "+cc.name+"? No undo possible..."),6);case 6:if(ic=nd.yieldResult)return nd.yield(Q.resourceRemove(cc.address),0);nd.jumpTo(0)}})}function ke(Q,ea,Ia){Ia=void 0===Ia?$world:Ia;
var Ra,cc,Nb,$a,ic,nd,vd,Xc,Wa,Nc,pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gb){switch(gb.nextAddress){case 1:return gb.yield(Q.getPackage(ea),2);case 2:Ra=gb.yieldResult;if(!Ra)throw Error("Cannot find package "+ea);cc=[];Nb=$jscomp.makeIterator(Ra.modules);$a=Nb.next();case 3:if($a.done)return gb.yield(Ia.execCommand("open text window",{title:"imports and exports of "+ea,content:cc.join("\n\n")}),0);ic=$a.value;if(!ic.name.match(/\.js$/)){gb.jumpTo(4);break}gb.setCatchFinallyBlocks(6);
nd=Q;vd=nd.importsAndExportsOf;Xc=ic.name;return gb.yield(Q.moduleRead(ic.name),9);case 9:return gb.yield(vd.call(nd,Xc,gb.yieldResult),8);case 8:Wa=gb.yieldResult;gb.leaveTryBlock(7);break;case 6:Nc=gb.enterCatchBlock();Ia.logError(Error("Error when getting imports/exports from module "+ic.name+":\n"+Nc.stack));gb.jumpTo(4);break;case 7:pb=""+ic.name;if(!Wa.imports.length&&!Wa.exports.length){pb+="\n  does not import / export anything";gb.jumpTo(4);break}Wa.imports.length&&(pb+="\n  imports:\n",
pb+=Fa.arr.groupByKey(Wa.imports,"fromModule").mapGroups(function(hb,Yb){return"from "+hb+": "+Yb.map(function(Xb){return Xb.local||Xb.imported?Xb.imported&&Xb.imported!==Xb.local?Xb.imported+" as "+Xb.local:Xb.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(hb){return"    "+hb}).join("\n"));Wa.exports.length&&(pb+="\n  exports:\n",pb+=Wa.exports.map(function(hb){return hb.local?hb.local&&hb.local!==hb.exported?hb.local+" as "+hb.exported:hb.exported:hb.exported+
" from "+hb.fromModule}).join(", ").split("\n").map(function(hb){return"    "+hb}).join("\n"));cc.push(pb);case 4:$a=Nb.next(),gb.jumpTo(3)}})}function zc(Q,ea,Ia){Ia=Ia&&Ia.address;if(Ia&&0===ea.indexOf(Ia))var Ra=ea.slice(Ia.length).replace(/^\//,"");else a:{Ia=Q.getConfig();if(!Ia||Ia.constructor!==Promise)try{Ra=String((new URL(ea)).relativePathFrom(new URL(Q.getConfig().baseURL)));break a}catch(cc){}Ra=ea}return Ra}function Ec(Q,ea,Ia,Ra){return $jscomp.asyncExecutePromiseGeneratorProgram(function(cc){return 1==
cc.nextAddress?(Ra=Object.assign({targetModule:ea},Ra),cc.yield(Q.normalize(ea),2)):3!=cc.nextAddress?(ea=cc.yieldResult,cc.yield(Q.moduleSourceChange(ea,Ia,Ra),3)):cc.return(ea)})}function Pb(Q,ea,Ia,Ra,cc){Ra=void 0===Ra?!1:Ra;cc=void 0===cc?!1:cc;var Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function($a){switch($a.nextAddress){case 1:return ea&&ea.setStatusMessage("Reloading "+Ia),$a.setCatchFinallyBlocks(2),$a.yield(Q.reloadModule(Ia,{reloadDeps:Ra,resetEnv:cc}),4);case 4:if(!ea){$a.jumpTo(5);
break}return $a.yield(ea.updateModuleList(),6);case 6:case 5:ea&&ea.setStatusMessage("Reloded "+Ia);$a.leaveTryBlock(0);break;case 2:Nb=$a.enterCatchBlock();$a.setCatchFinallyBlocks(7);if(!ea){$a.jumpTo(9);break}return $a.yield(ea.updateEditorWithSourceOf(Ia),10);case 10:case 9:$a.leaveTryBlock(8);break;case 7:$a.enterCatchBlock();case 8:throw ea&&ea.showError(Nb),Nb;}})}function Qb(Q,ea,Ia){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ra){switch(Ra.nextAddress){case 1:return Ra.yield(Q.forgetModule(Ia,
{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!ea){Ra.jumpTo(3);break}return Ra.yield(ea.updateModuleList(),4);case 4:case 3:Ra.jumpToEnd()}})}function Tc(Q,ea,Ia){var Ra,cc,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function($a){switch($a.nextAddress){case 1:return $a.yield(Q.normalize(Ia),2);case 2:return Ra=$a.yieldResult,$a.yield(ea.world().confirm("Remove file "+Ra+"?",{requester:ea}),3);case 3:cc=$a.yieldResult;if(!cc)throw"Canceled";return $a.yield(Q.forgetModule(Ra),4);case 4:return $a.yield(Q.resourceRemove(Ra),
5);case 5:return $a.yield(Q.getPackageForModule(Ra),6);case 6:return Nb=$a.yieldResult,$a.return(Nb)}})}function ld(Q,ea,Ia){var Ra,cc,Nb,$a,ic,nd,vd,Xc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){switch(Wa.nextAddress){case 1:return Ra=URL,Wa.yield(Q.getConfig(),2);case 2:cc=new Ra(Wa.yieldResult.baseURL);Nb=ea.world();if(!Ia){Wa.jumpTo(3);break}return Wa.yield(Q.getPackage(Ia),4);case 4:if($a=Wa.yieldResult){Wa.jumpTo(5);break}return Wa.yield(Q.getPackageForModule(Ia),6);case 6:$a=
Wa.yieldResult;case 5:(ic=$a)&&(cc=new URL(ic.address));case 3:return Wa.yield(mb._searchForExistingFiles(ea,String(cc),ic),7);case 7:nd=Wa.yieldResult;if(!nd.includes("[create new module]")){Wa.jumpTo(8);break}return Wa.yield(mb._askForModuleName(Q,Ia||String(cc),Nb),9);case 9:vd=Wa.yieldResult,nd=[vd];case 8:return Wa.yield(mb._createAndLoadModules(Q,nd),10);case 10:return Xc=Wa.yieldResult,mb.arr.compact(Xc.map(function(Nc){return Nc.error})),Wa.return(Xc)}})}function Rb(Q,ea){var Ia,Ra,cc,Nb,
$a,ic,nd,vd,Xc,Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nc){if(1==Nc.nextAddress)return Nc.yield(Q.getPackage(ea),2);if(3!=Nc.nextAddress){Ia=Nc.yieldResult;if(!Ia||!Ia.address.match(/^http/))throw Error("Cannot load package "+ea);Ra=mb.resource(Ia.address);cc=[];Nb=$jscomp;$a=Nb.makeIterator;return Nc.yield(Ra.dirList(5,{exclude:mb.modulesInPackage_defaultExclude}),3)}ic=$a.call(Nb,Nc.yieldResult);for(nd=ic.next();!nd.done;nd=ic.next())Xc=vd=nd.value,Wa=Xc.url,Wa.match(/\.js$/)&&
Q.isModuleLoaded(Wa,!0)&&cc.push(Q.getModule(Wa));return Nc.return(cc)})}function qb(Q,ea){ea=void 0===ea?[]:ea;var Ia;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ra){if(1==Ra.nextAddress)return Ra.yield(System.import("mocha-es6/index.js"),2);Ia=Ra.yieldResult;return Ra.return(Ia.loadTestModuleAndExtractTestState(Q,ea))})}function bc(Q,ea,Ia,Ra){function cc(Nc){return new Promise(function(pb,gb){var hb=ub.arr.compact(Nc.suite.suites).map(function(Xb){return Xb.file}),Yb=ub.chain(ea).filter(function(Xb){return hb.includes(Xb.file)}).pluck("tests").flatten().value();
if(!Yb||!Yb.length)return gb(Error("Trying to run tests of "+hb.join(", ")+" but cannot find them in loaded tests!"));Nc.reporter(function(Xb){Xb.on("test",function(Fd){try{var Be=Yb.find(function(Ie){return Ie.fullTitle===Fd.fullTitle()});Be.state="running";"function"===typeof Ia&&Ia(Be,"test")}catch(Ie){"function"===typeof Ra&&Ra(Ie,"test")}});Xb.on("pass",function(Fd){try{var Be=Yb.find(function(Ie){return Ie.fullTitle===Fd.fullTitle()});Be.state="succeeded";Be.duration=Fd.duration;"function"===
typeof Ia&&Ia(Be,"pass")}catch(Ie){"function"===typeof Ra&&Ra(Ie,"pass")}});Xb.on("fail",function(Fd,Be){try{var Ie=function(ue,Md,Zb){ue.state="failed";ue.duration=ue.duration;ue.error=Md},Lf=Yb.find(function(ue){return ue.fullTitle===Fd.fullTitle()});if(Lf)Ie(Lf,Be,Fd.duration);else{var ed=ub.arr.invoke(Fd.parent.tests,"fullTitle");Yb.filter(function(ue){return ed.includes(ue.fullTitle)}).forEach(function(ue){return Ie(ue,Be,Fd.duration)})}"function"===typeof Ia&&Ia(Lf,"fail")}catch(ue){"function"===
typeof Ra&&Ra(ue,"fail")}})});Nc.run(function(Xb){return pb({testsByFile:ea,mocha:Nc})})})}var Nb,$a,ic,nd,vd,Xc,Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nc){switch(Nc.nextAddress){case 1:Nb=$jscomp.makeIterator(ea),$a=Nb.next();case 2:if($a.done){Nc.jumpTo(4);break}nd=ic=$a.value;vd=nd.file;return Nc.yield(ub.loadMochaTestFile(vd,ea),5);case 5:return Xc=Nc.yieldResult,Wa=Xc.mocha,Q&&(Wa=Wa.grep(Q)),Nc.yield(cc(Wa),3);case 3:$a=Nb.next();Nc.jumpTo(2);break;case 4:return Nc.return({mocha:Wa,
testsByFile:ea})}})}function Ic(Q){Q||(Q="local");if(Q.isSystemInterface)var ea=Q;else"string"===typeof Q&&Q.startsWith("l2l ")&&(Q={type:"l2l",id:Q.split(" ")[1]}),"string"!==typeof Q&&"l2l"===Q.type&&(ea=Wc.l2lInterfaceFor(Q.id,Q.info)),"string"!==typeof Q&&($world.setStatusMessage("Unknown system interface "+Q),Q="local"),ea||(ea=Q&&"local"!==Q?Wc.serverInterfaceFor(Q):Wc.localInterface);return ea}Da("systemInterfaceNamed",Ic);var ra=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");
ra.parseJsonLikeObj=md;ra.ast=Ab;ra.parseJsonLikeObj=md;ra.parseJsonLikeObj=md;var Fa=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");Fa.loadPackage=function(Q,ea){var Ia,Ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cc){switch(cc.nextAddress){case 1:return cc.yield(Q.importPackage(ea.address+"/"),2);case 2:if(!ea.main){cc.jumpTo(3);break}return cc.yield(Q.importModule(ea.main.toString()),3);case 3:if(!ea.test){cc.jumpTo(5);break}cc.setCatchFinallyBlocks(6);
return cc.yield(Q.importPackage("mocha-es6"),8);case 8:return Ia=cc.yieldResult,cc.yield(Ia.installSystemInstantiateHook(),9);case 9:return cc.yield(Q.importModule(ea.test.toString()),10);case 10:cc.leaveTryBlock(5);break;case 6:Ra=cc.enterCatchBlock(),console.warn("Cannot load test of new package: "+Ra);case 5:return cc.return(Q.getPackage(ea.address))}})};Fa.interactivelyCreatePackage=db;Fa.interactivelyLoadPackage=Fb;Fa.interactivelyReloadPackage=tc;Fa.interactivelyUnloadPackage=nc;Fa.interactivelyRemovePackage=
td;Fa.showExportsAndImportsOf=ke;Fa.parseJsonLikeObj=md;Fa.arr=Tb;Fa.resource=kc;Fa.interactivelyCreatePackage=db;Fa.interactivelyCreatePackage=db;Fa.interactivelyLoadPackage=Fb;Fa.interactivelyLoadPackage=Fb;Fa.interactivelyReloadPackage=tc;Fa.interactivelyReloadPackage=tc;Fa.interactivelyUnloadPackage=nc;Fa.interactivelyUnloadPackage=nc;Fa.interactivelyRemovePackage=td;Fa.interactivelyRemovePackage=td;Fa.showExportsAndImportsOf=ke;Fa.showExportsAndImportsOf=ke;var mb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");
mb.shortModuleName=zc;mb.interactivelyChangeModule=Ec;mb.interactivelyReloadModule=Pb;mb.interactivelyUnloadModule=Qb;mb.interactivelyRemoveModule=Tc;mb.interactivelyAddModule=ld;mb._askForModuleName=function(Q,ea,Ia){var Ra,cc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){switch(Nb.nextAddress){case 1:return Nb.yield(Ia.prompt("Enter module name",{input:ea,historyId:"lively.vm-editor-add-module-name"}),2);case 2:ea=Nb.yieldResult;if(!ea)throw"Canceled";return Nb.yield(Q.normalize(ea),
3);case 3:return Ra=Nb.yieldResult,Nb.yield(Ia.confirm(["Create module \n",{},Ra,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:cc=Nb.yieldResult;if(!cc)throw"Canceled";return Nb.return(Ra)}})};mb._searchForExistingFiles=function(Q,ea,Ia){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ra){return String(ea).match(/^http/)?Ra.return(mb._searchForExistingFilesWeb(Q,ea,Ia)):Ra.return(mb._searchForExistingFilesManually(Q,ea,Ia))})};mb._searchForExistingFilesManually=function(Q,
ea,Ia){var Ra,cc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){switch(Nb.nextAddress){case 1:return Nb.yield(Q.world().multipleChoicePrompt("Add Module",{requester:Q,choices:["Create New Module","Load Existing Module"]}),2);case 2:Ra=Nb.yieldResult;if("Create New Module"===Ra)return Nb.return("[create new module]");if("Load Existing Module"!==Ra){Nb.jumpTo(3);break}return Nb.yield(Q.world().prompt("URL of module?",{input:ea,requester:Q,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),
4);case 4:if(cc=Nb.yieldResult)return Nb.return([cc]);case 3:throw"Canceled";}})};mb._searchForExistingFilesWeb=function(Q,ea,Ia){function Ra(Xc){Xc.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(Xc.name())||Ia&&mb.arr.pluck(Ia.modules,"name").includes(Xc.url)?!0:!1}var cc,Nb,$a,ic,nd,vd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xc){switch(Xc.nextAddress){case 1:return(cc=Q.world())&&(Nb=cc.showLoadingIndicatorFor(Q,"Loading existing modules...")),
Xc.yield(mb.resource(ea).dirList(5,{exclude:Ra}),3);case 3:return Xc.yield(Xc.yieldResult.map(function(Wa){return Wa.url}),2);case 2:return $a=Xc.yieldResult,ic=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat($a.filter(function(Wa){return Wa.endsWith(".js")}).map(function(Wa){return{isListItem:!0,string:Ia&&0==Wa.indexOf(Ia.address)?Ia.name+Wa.slice(Ia.address.length):Wa,value:Wa}})),Xc.yield(Promise.resolve(Nb&&Nb.remove()).then(function(){return Q.world().filterableListPrompt("What module to load?",
ic,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:Q},Q?{extent:Q.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:nd=Xc.yieldResult;if(!nd||"canceled"===nd.status||!nd.selected.length)throw"Canceled";vd=nd.selected||nd;Array.isArray(vd)||(vd=[vd]);return Xc.return(vd)}})};mb._createAndLoadModules=function(Q,ea){var Ia,Ra,cc,Nb,$a;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ic){switch(ic.nextAddress){case 1:Array.isArray(ea)||(ea=[ea]),Ia=[],Ra=$jscomp.makeIterator(ea),
cc=Ra.next();case 2:if(cc.done){ic.jumpTo(4);break}Nb=cc.value;return ic.yield(Q.forgetModule(Nb,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return ic.yield(Q.resourceEnsureExistance(Nb,'"format esm";\n'),6);case 6:return ic.setCatchFinallyBlocks(7),ic.yield(Q.importModule(Nb),9);case 9:Ia.push({name:Nb});ic.leaveTryBlock(3);break;case 7:$a=ic.enterCatchBlock(),Ia.push({name:Nb,error:$a});case 3:cc=Ra.next();ic.jumpTo(2);break;case 4:return ic.return(Ia)}})};mb.modulesInPackage_defaultExclude=function(Q){return[".git",
"node_modules",".optimized-loading-cache",".module_cache"].includes(Q.name())?!0:!1};mb.modulesInPackage=Rb;mb.obj=ec;mb.arr=Tb;mb.resource=kc;mb.shortModuleName=zc;mb.shortModuleName=zc;mb.interactivelyChangeModule=Ec;mb.interactivelyChangeModule=Ec;mb.interactivelyReloadModule=Pb;mb.interactivelyReloadModule=Pb;mb.interactivelyUnloadModule=Qb;mb.interactivelyUnloadModule=Qb;mb.interactivelyRemoveModule=Tc;mb.interactivelyRemoveModule=Tc;mb.interactivelyAddModule=ld;mb.interactivelyAddModule=ld;
mb.modulesInPackage=Rb;mb.modulesInPackage=Rb;var ub=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/mocha-tests.js");ub.loadMochaTestFile=qb;ub.runMochaTests=bc;ub.arr=Tb;ub.chain=he;ub.loadMochaTestFile=qb;ub.loadMochaTestFile=qb;ub.runMochaTests=bc;ub.runMochaTests=bc;var Db=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");Db.todo=function(Q){throw Error(Q+" is not yet implemented!");};Db.parseJsonLikeObj=md;Db.arr=Tb;Db.Closure=gd;Db.obj=
ec;Db.resource=kc;Db.transform=Zd;Db.modules=kd;var cb=function(){};cb.prototype.dynamicCompletionsForPrefix=function(Q,ea,Ia){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ra){Db.todo("dynamicCompletionsForPrefix");Ra.jumpToEnd()})};cb.prototype.runEval=function(Q,ea){Db.todo("runEval")};cb.prototype.resourceExists=function(Q){Db.todo("resourceExists")};cb.prototype.resourceEnsureExistance=function(Q,ea){Db.todo("resourceEnsureExistance")};cb.prototype.resourceMkdir=function(Q){Db.todo("resourceMkdir")};
cb.prototype.resourceRead=function(Q){Db.todo("resourceRead")};cb.prototype.resourceRemove=function(Q){Db.todo("resourceRemove")};cb.prototype.resourceWrite=function(Q,ea){Db.todo("resourceWrite")};cb.prototype.resourceCreateFiles=function(Q,ea){Db.todo("resourceCreateFiles")};cb.prototype.resourceDirList=function(Q,ea,Ia){Db.todo("resourceDirList")};cb.prototype.normalizeSync=function(Q,ea,Ia){Db.todo("normalizeSync")};cb.prototype.normalize=function(Q,ea,Ia){Db.todo("normalize")};cb.prototype.printSystemConfig=
function(){Db.todo("printSystemConfig")};cb.prototype.getConfig=function(){Db.todo("getConfig")};cb.prototype.setConfig=function(Q){Db.todo("setConfig")};cb.prototype.getPackages=function(Q){Db.todo("getPackages")};cb.prototype.isModuleLoaded=function(Q,ea){Db.todo("isModuleLoaded")};cb.prototype.doesModuleExist=function(Q,ea){Db.todo("doesModuleExist")};cb.prototype.getModules=function(){var Q=this,ea,Ia;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ra){return 1==Ra.nextAddress?(ea=
Db.arr,Ia=ea.flatmap,Ra.yield(Q.getPackages(),2)):Ra.return(Ia.call(ea,Ra.yieldResult,function(cc){return cc.modules}))})};cb.prototype.getModule=function(Q){var ea=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return 1==Ia.nextAddress?Ia.yield(ea.getModules(),2):Ia.return(Ia.yieldResult.find(function(Ra){return Ra.name===Q}))})};cb.prototype.getPackage=function(Q){var ea=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return 1==Ia.nextAddress?(Q=Q.replace(/\/+$/,
""),Ia.yield(ea.getPackages(),2)):Ia.return(Ia.yieldResult.find(function(Ra){return Ra.address===Q||Ra.name===Q}))})};cb.prototype.getPackageForModule=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){Db.todo("getPackageForModule");ea.jumpToEnd()})};cb.prototype.systemConfChange=function(Q){var ea=Db.parseJsonLikeObj(Q);["baseURL"].forEach(function(Ia){return delete ea[Ia]});return this.setConfig(ea)};cb.prototype.resourcesOfPackage=function(Q,ea){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){Db.todo("resourcesOfPackage");
Ia.jumpToEnd()})};cb.prototype.registerPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){Db.todo("registerPackage");ea.jumpToEnd()})};cb.prototype.importPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){Db.todo("importPackage");ea.jumpToEnd()})};cb.prototype.removePackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){Db.todo("removePackage");ea.jumpToEnd()})};cb.prototype.reloadPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){Db.todo("reloadPackage");
ea.jumpToEnd()})};cb.prototype.packageConfChange=function(Q,ea){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){Db.todo("packageConfChange");Ia.jumpToEnd()})};cb.prototype.importModule=function(Q){Db.todo("importModule")};cb.prototype.forgetModule=function(Q,ea){Db.todo("forgetModule")};cb.prototype.reloadModule=function(Q,ea){Db.todo("reloadModule")};cb.prototype.moduleFormat=function(Q){Db.todo("moduleFormat")};cb.prototype.moduleRead=function(Q){Db.todo("moduleRead")};cb.prototype.moduleSourceChange=
function(Q,ea,Ia){Db.todo("moduleSourceChange")};cb.prototype.importsAndExportsOf=function(Q,ea){Db.todo("importsAndExportsOf")};cb.prototype.keyValueListOfVariablesInModule=function(Q,ea){Db.todo("keyValueListOfVariablesInModule")};cb.prototype.moduleWrite=function(Q,ea){return this.moduleSourceChange(Q,ea)};Db.AbstractCoreInterface=cb;var fb=function(){var Q=Db.AbstractCoreInterface.call(this)||this;Q.currentEval=null;return Q};$jscomp.inherits(fb,Db.AbstractCoreInterface);fb.prototype.runEval=
function(Q,ea){throw Error("Not yet implemented");};fb.prototype.runEvalAndStringify=function(Q,ea){var Ia=this;return this.currentEval?this.currentEval.then(function(){return Ia.runEvalAndStringify(Q,ea)}):this.currentEval=Promise.resolve().then(function(){var Ra,cc,Nb,$a;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ic){switch(ic.nextAddress){case 1:return ic.yield(Ia.runEval("\n        Promise.resolve((async "+Db.transform.wrapInFunction(Q)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},ea)),2);case 2:if((Ra=ic.yieldResult)&&Ra.isError)throw Error(String(Ra.value||Ra.error));if(!Ra||!Ra.value)return ic.return(null);if(cc=Ra.promisedValue){ic.jumpTo(3);break}return ic.yield(Ra.value,4);case 4:cc=ic.yieldResult;case 3:Nb=cc;if(!Nb)return ic.return();if("undefined"===Nb)return ic.return(void 0);if("null"===Nb)return ic.return(null);if("true"===Nb)return ic.return(!0);
if("false"===Nb)return ic.return(!1);try{$a=JSON.parse(Nb)}catch(nd){return ic.return(Nb)}if($a&&$a.isError)throw Error(String($a.value));return ic.return($a)}})}).then(function(Ra){delete Ia.currentEval;return Ra},function(Ra){delete Ia.currentEval;return Promise.reject(Ra)})};fb.prototype.dynamicCompletionsForPrefix=function(Q,ea,Ia){var Ra=this,cc,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function($a){cc=Db.obj.isString(Ia.context)?Ia.context:!1;Ia=Db.obj.dissoc(Ia,["systemInterface",
"System","context"]);Nb="\n      var prefix = "+JSON.stringify(ea)+",\n          opts = "+JSON.stringify(Ia)+";\n      opts.context = "+cc+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return $a.return(Ra.runEvalAndStringify(Nb))})};fb.prototype.evalWithResource=function(Q,ea,Ia){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+Q+'").'+ea+"("+(Ia?JSON.stringify(Ia):"")+");\n    ")};fb.prototype.resourceExists=function(Q){return this.evalWithResource(Q,"exists")};fb.prototype.resourceEnsureExistance=function(Q,ea){return this.evalWithResource(Q,
"ensureExistance",ea)};fb.prototype.resourceMkdir=function(Q){return this.evalWithResource(Q,"mkdir")};fb.prototype.resourceRead=function(Q){return this.evalWithResource(Q,"read")};fb.prototype.resourceRemove=function(Q){return this.evalWithResource(Q,"remove")};fb.prototype.resourceWrite=function(Q,ea){return this.evalWithResource(Q,"write",ea)};fb.prototype.resourceCreateFiles=function(Q,ea){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
Q+'", '+JSON.stringify(ea)+")")};fb.prototype.resourceDirList=function(Q,ea,Ia){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+Q+'").dirList('+JSON.stringify(ea)+", "+JSON.stringify(Ia)+"))\n        .map(({url}) => ({url}))")};fb.prototype.livelySystemAccessor=function(Q){Q=void 0===Q?"livelySystem":Q;return"var "+Q+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
Q+') throw new Error("lively-system-interface not available!");'};fb.prototype.normalizeSync=function(Q,ea,Ia){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(Q)+", "+JSON.stringify(ea)+", "+Ia+")")};fb.prototype.normalize=function(Q,ea,Ia){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(Q)+", "+JSON.stringify(ea)+", "+JSON.stringify(Ia)+")")};fb.prototype.printSystemConfig=function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")};
fb.prototype.getConfig=function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')};fb.prototype.setConfig=function(Q){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(Q)+")")};fb.prototype.getPackages=function(Q){Q=Object.assign({excluded:[]},Q);Q.excluded=Q.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(Q)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')};fb.prototype.getPackageForModule=function(Q){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(Q)+")")};fb.prototype.isModuleLoaded=function(Q,ea){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+Q+'", '+ea+")")};fb.prototype.doesModuleExist=function(Q,ea){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+Q+'", '+ea+")")};fb.prototype.registerPackage=function(Q){var ea=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return Ia.return(ea.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(Q)+")"))})};fb.prototype.importPackage=
function(Q){var ea=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return Ia.return(ea.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(Q)+")"))})};fb.prototype.removePackage=function(Q){var ea=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return Ia.return(ea.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(Q)+")"))})};fb.prototype.reloadPackage=function(Q,ea){var Ia=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ra){return Ra.return(Ia.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(Q)+", "+JSON.stringify(ea)+")"))})};fb.prototype.packageConfChange=function(Q,ea){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(Q)+", "+JSON.stringify(ea)+")")};fb.prototype.resourcesOfPackage=function(Q,ea){ea=void 0===ea?[".git","node_modules",".module_cache","lively.next-node_modules"]:ea;var Ia=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ra){Q.address&&(Q=
Q.address);return Ra.return(Ia.runEvalAndStringify("\n      "+Ia.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(Q)+", "+JSON.stringify(ea)+");"))})};fb.prototype.getModule=function(Q){var ea=this,Ia;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ra){if(1==Ra.nextAddress)return Ra.yield(ea.getModules(),2);Ia=Ra.yieldResult.find(function(cc){return cc.name===Q});return Ra.return(Ia?Db.modules.module(Ia.name):null)})};fb.prototype.importModule=
function(Q){return this.runEvalAndStringify("lively.modules.System.import("+JSON.stringify(Q)+")")};fb.prototype.forgetModule=function(Q,ea){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").unload("+JSON.stringify(ea)+")")};fb.prototype.reloadModule=function(Q,ea){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").reload("+JSON.stringify(ea)+")")};fb.prototype.moduleFormat=function(Q){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(Q)+").format();")};fb.prototype.moduleRead=function(Q){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").source()")};fb.prototype.moduleSourceChange=function(Q,ea,Ia){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").changeSource("+JSON.stringify(ea)+", "+JSON.stringify(Ia)+")")};fb.prototype.keyValueListOfVariablesInModule=function(Q,ea){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+
JSON.stringify(Q)+", "+JSON.stringify(ea)+")")};fb.prototype.importsAndExportsOf=function(Q,ea){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(Q)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(Q)+").exports()})")};fb.prototype.exportsOfModules=function(Q){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(Q)+";\n      options.excludedPackages = ["+Q.excludedPackages.map(function(ea){return"function"===
typeof ea?ea.toString():JSON.stringify(ea)}).join(",")+"]\n      await livelySystem.localInterface.exportsOfModules(options)")};fb.prototype.searchInPackage=function(Q,ea,Ia){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(Q)+", "+JSON.stringify(ea)+", "+JSON.stringify(Ia)+")")};fb.prototype.loadMochaTestFile=function(Q,ea){ea=void 0===ea?[]:ea;var Ia=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ra){return Ra.return(Ia.runEvalAndStringify("\n      "+
Ia.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(Q)+", "+JSON.stringify(ea)+"), result;\n      result = {testsByFile}"))})};fb.prototype.runMochaTests=function(Q,ea,Ia,Ra){var cc=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){Q&&Q instanceof RegExp&&(Q={isRegExp:!0,value:String(Q).replace(/^\/|\/$/g,"")});return Nb.return(cc.runEvalAndStringify("\n      var grep = "+JSON.stringify(Q)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
cc.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(ea||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})};
Db.RemoteCoreInterface=fb;var Eb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");Eb.obj=ec;Eb.string=Sc;Eb.arr=Tb;Eb.resource=kc;Eb.createFiles=yd;Eb.ast=Ab;Eb.modules=kd;Eb.vm=Od;Eb.loadMochaTestFile=qb;Eb.runMochaTests=bc;Eb.parseJsonLikeObj=md;Eb.AbstractCoreInterface=cb;Eb.classToFunctionTransform=fe;cb=function(){return Eb.AbstractCoreInterface.apply(this,arguments)||this};$jscomp.inherits(cb,Eb.AbstractCoreInterface);cb.prototype.dynamicCompletionsForPrefix=
function(Q,ea,Ia){var Ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cc){if(1==cc.nextAddress)return cc.yield(Eb.vm.completions.getCompletions(function(Nb){return Eb.vm.runEval(Nb.replace("return ",""),Object.assign({targetModule:Q,classTransform:Eb.classToFunctionTransform},Ia))},ea),2);Ra=cc.yieldResult;if(Ra.isError)throw Ra.value;return cc.return({completions:Ra.completions,prefix:Ra.startLetters})})};cb.prototype.runEval=function(Q,ea){return Eb.vm.runEval(Q,Object.assign({classTransform:Eb.classToFunctionTransform},
ea))};cb.prototype.resourceExists=function(Q){return Eb.resource(Q).exists()};cb.prototype.resourceEnsureExistance=function(Q,ea){return Eb.resource(Q).ensureExistance(ea)};cb.prototype.resourceMkdir=function(Q){return Eb.resource(Q).mkdir()};cb.prototype.resourceRead=function(Q){return Eb.resource(Q).read()};cb.prototype.resourceRemove=function(Q){return Eb.resource(Q).remove()};cb.prototype.resourceWrite=function(Q,ea){return Eb.resource(Q).write(ea)};cb.prototype.resourceCreateFiles=function(Q,
ea){return Eb.createFiles(Q,ea)};cb.prototype.resourceDirList=function(Q,ea,Ia){return Eb.resource(Q).dirList(ea,Ia)};cb.prototype.normalizeSync=function(Q,ea,Ia){return System.decanonicalize(Q,ea,Ia)};cb.prototype.normalize=function(Q,ea,Ia){return System.normalize(Q,ea,Ia)};cb.prototype.printSystemConfig=function(){return Eb.modules.printSystemConfig()};cb.prototype.getConfig=function(){return System.getConfig()};cb.prototype.setConfig=function(Q){Eb.modules.System.config(Q)};cb.prototype.getPackages=
function(Q){Q=Object.assign({},Q);Q=void 0===Q.excluded?[]:Q.excluded;var ea=Q.filter(function(Ra){return"string"===typeof Ra}),Ia=Q.filter(function(Ra){return"function"===typeof Ra});ea=ea.concat(ea.map(function(Ra){return System.decanonicalize(Ra.replace(/\/?$/,"/")).replace(/\/$/,"")}));return Eb.modules.getPackages().filter(function(Ra){return!ea.includes(Ra.url)&&!Ia.some(function(cc){return cc(Ra.url)})})};cb.prototype.registerPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){return ea.return(Eb.modules.registerPackage(Q))})};
cb.prototype.importPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){return ea.return(Eb.modules.importPackage(Q))})};cb.prototype.removePackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){return ea.return(Eb.modules.removePackage(Q))})};cb.prototype.reloadPackage=function(Q,ea){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return Ia.return(Eb.modules.reloadPackage(Q,ea))})};cb.prototype.packageConfChange=function(Q,
ea){var Ia=this,Ra,cc,Nb,$a;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ic){if(1==ic.nextAddress)return Ra=Eb.modules.System,cc=Eb.parseJsonLikeObj(Q),Nb=JSON.stringify(cc,null,2),ic.yield(Eb.modules.module(ea).changeSource(Nb,{doEval:!1}),2);if(3!=ic.nextAddress)return Ra.set(ea,Ra.newModule(cc)),ic.yield(Ia.getPackageForModule(ea),3);($a=ic.yieldResult)&&Eb.modules.applyPackageConfig(cc,$a.address);ic.jumpToEnd()})};cb.prototype.resourcesOfPackage=function(Q,ea){ea=void 0===ea?[".git",
"node_modules",".module_cache"]:ea;var Ia,Ra,cc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){if(1==Nb.nextAddress)return Nb.setCatchFinallyBlocks(2),Ia=Q.address?Q.address:Q,Ra=Eb.modules.getPackage(Ia),Nb.yield(Ra.resources(void 0,ea),4);if(2!=Nb.nextAddress)return Nb.return(Nb.yieldResult.map(function($a){return Object.assign($a,{package:$a.package.url})}));cc=Nb.enterCatchBlock();console.warn("resourcesOfPackage error for "+Q+": "+cc);return Nb.return([])})};cb.prototype.getPackageForModule=
function(Q){return(Q=Eb.modules.getPackageOfModule(Q))?Q.asSpec():Q};cb.prototype.isModuleLoaded=function(Q,ea){return Eb.modules.isModuleLoaded(Q,ea)};cb.prototype.doesModuleExist=function(Q,ea){return Eb.modules.isModuleLoaded(Q,ea)};cb.prototype.getModule=function(Q){return Eb.modules.module(Q)};cb.prototype.importModule=function(Q){return Eb.modules.System.import(Q)};cb.prototype.forgetModule=function(Q,ea){return Eb.modules.module(Q).unload(ea)};cb.prototype.reloadModule=function(Q,ea){return Eb.modules.module(Q).reload(ea)};
cb.prototype.moduleFormat=function(Q){return Eb.modules.module(Q).format()};cb.prototype.moduleRead=function(Q){return Eb.modules.module(Q).source()};cb.prototype.moduleSourceChange=function(Q,ea,Ia){return Eb.modules.module(Q).changeSource(ea,Ia)};cb.prototype.keyValueListOfVariablesInModule=function(Q,ea){var Ia=this,Ra,cc,Nb,$a,ic,nd,vd,Xc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){switch(Wa.nextAddress){case 1:if(ea){Wa.jumpTo(2);break}return Wa.yield(Ia.resourceRead(Q),3);
case 3:ea=Wa.yieldResult;case 2:return Ra="string"===typeof ea?Eb.ast.parse(ea):ea,cc=Ia.normalizeSync(Q),Ia.moduleFormat(cc),Nb=Eb.modules.module(cc).env().recorder,Wa.yield(Ia.importsAndExportsOf(cc,Ra),4);case 4:return $a=Wa.yieldResult,ic=Eb.ast.query.topLevelDeclsAndRefs(Ra),nd=Eb.arr.sortByKey(Eb.ast.query.declarationsOfScope(ic.scope,!0),"start"),vd=Eb.arr.pluck(ic.scope.importSpecifiers,"name"),Xc=0,Wa.return(nd.map(function(Nc){var pb=Nc.name.length,gb=$a.exports.find(function(Yb){return Yb.local===
Nc.name}),hb=Eb.arr.include(vd,Nc.name);gb&&(pb+=9);hb&&(pb+=9);Xc=Math.max(Xc,pb);return{isExport:gb,isImport:hb,name:Nc.name,value:Nb[Nc.name],node:Nc,printedName:Nc.name+(gb?" [export]":"")+(hb?" [import]":""),printedValue:Eb.obj.inspect(Nb[Nc.name],{maxDepth:1}).replace(/\n/g,"")}}).map(function(Nc){return{isListItem:!0,value:Nc,string:Nc.printedName+Eb.string.indent(" = "+Nc.printedValue," ",Xc-Nc.printedName.length)}}))}})};cb.prototype.importsAndExportsOf=function(Q,ea){var Ia;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ra){return 1==
Ra.nextAddress?Ra.yield(Eb.modules.module(Q).imports(ea),2):3!=Ra.nextAddress?(Ia=Ra.yieldResult,Ra.yield(Eb.modules.module(Q).exports(ea),3)):Ra.return({imports:Ia,exports:Ra.yieldResult})})};cb.prototype.exportsOfModules=function(Q){return Eb.modules.ExportLookup.run(System,Q)};cb.prototype.searchInPackage=function(Q,ea,Ia){return Eb.modules.getPackage(Q).search(ea,Ia)};cb.prototype.runMochaTests=function(Q,ea,Ia,Ra){return Eb.runMochaTests(Q,ea,Ia,Ra)};cb.prototype.loadMochaTestFile=function(Q,
ea){return Eb.loadMochaTestFile(Q,ea)};$jscomp.global.Object.defineProperties(cb.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"local"}}});Eb.LocalCoreInterface=cb;var qc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");qc.evalStrategies=Ud;qc.RemoteCoreInterface=fb;var gc=function(Q){var ea=qc.RemoteCoreInterface.call(this)||this;ea.currentEval=null;ea.url=Q;ea.server=new qc.evalStrategies.HttpEvalStrategy(Q);return ea};$jscomp.inherits(gc,
qc.RemoteCoreInterface);gc.prototype.runEval=function(Q,ea){return this.server.runEval(Q,ea)};$jscomp.global.Object.defineProperties(gc.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this.url}},description:{configurable:!0,enumerable:!0,get:function(){return this.url.replace(/^https?:\/\//,"")}}});qc.HTTPCoreInterface=gc;var Oc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");Oc.evalStrategies=Ud;Oc.RemoteCoreInterface=fb;fb=function(Q,
ea){var Ia=Oc.RemoteCoreInterface.call(this)||this;Ia.targetId=Q;Ia.peer=ea;return Ia};$jscomp.inherits(fb,Oc.RemoteCoreInterface);fb.prototype.isConnected=function(){var Q=this,ea,Ia,Ra,cc,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function($a){if(1==$a.nextAddress)return ea=Q,Ia=ea.client,Ra=ea.targetId,$a.yield(Ia.sendToAndWait(Ia.trackerId,"getClients",{}),2);cc=$a.yieldResult;Nb=cc.data;return $a.return(Nb.some(function(ic){ic=$jscomp.makeIterator(ic).next().value;return Ra===ic}))})};
fb.prototype.runEval=function(Q,ea){var Ia=this,Ra,cc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){Ra=Ia.client;if(!Ra)throw Error("No lively.2lively default client available!");cc=new Oc.evalStrategies.L2LEvalStrategy(Ra,Ia.targetId);return Nb.return(cc.runEval(Q,ea))})};$jscomp.global.Object.defineProperties(fb.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"l2l "+this.targetId}},description:{configurable:!0,enumerable:!0,get:function(){var Q=this.peer,ea=
"l2l "+this.targetId.slice(0,5);if(Q){var Ia=Q.location,Ra=Q.type,cc=Q.user;Q=Q.world;Ra&&(ea+=", "+Ra);Ia&&(ea+=", "+Ia.replace(/^https?:\/\//,"")+(Q?"/"+Q:""));cc&&(ea+=", "+cc.name)}return ea}},client:{configurable:!0,enumerable:!0,get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}}});Oc.L2LCoreInterface=fb;var Wc=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");Wc.systemInterfaceNamed=Ic;Wc.interactivelyCreatePackage=
db;Wc.interactivelyLoadPackage=Fb;Wc.interactivelyReloadPackage=tc;Wc.interactivelyUnloadPackage=nc;Wc.interactivelyRemovePackage=td;Wc.showExportsAndImportsOf=ke;Wc.shortModuleName=zc;Wc.interactivelyChangeModule=Ec;Wc.interactivelyReloadModule=Pb;Wc.interactivelyUnloadModule=Qb;Wc.interactivelyRemoveModule=Tc;Wc.interactivelyAddModule=ld;Wc.modulesInPackage=Rb;Wc.LocalCoreInterface=cb;Wc.HTTPCoreInterface=gc;Wc.L2LCoreInterface=fb;fb=function(Q){this.coreInterface=Q};fb.prototype.dynamicCompletionsForPrefix=
function(Q,ea,Ia){return this.coreInterface.dynamicCompletionsForPrefix(Q,ea,Ia)};fb.prototype.runEval=function(Q,ea){return this.coreInterface.runEval(Q,ea)};fb.prototype.printSystemConfig=function(Q,ea,Ia){return this.coreInterface.printSystemConfig(Q,ea,Ia)};fb.prototype.getConfig=function(Q,ea,Ia){return this.coreInterface.getConfig(Q,ea,Ia)};fb.prototype.getPackages=function(Q){return this.coreInterface.getPackages(Q)};fb.prototype.getModules=function(Q,ea,Ia){return this.coreInterface.getModules(Q,
ea,Ia)};fb.prototype.getModule=function(Q,ea,Ia){return this.coreInterface.getModule(Q,ea,Ia)};fb.prototype.getPackage=function(Q,ea,Ia){return this.coreInterface.getPackage(Q,ea,Ia)};fb.prototype.getPackageForModule=function(Q,ea,Ia){return this.coreInterface.getPackageForModule(Q,ea,Ia)};fb.prototype.resourcesOfPackage=function(Q,ea){return this.coreInterface.resourcesOfPackage(Q,ea)};fb.prototype.systemConfChange=function(Q,ea,Ia){return this.coreInterface.systemConfChange(Q,ea,Ia)};fb.prototype.registerPackage=
function(Q){return this.coreInterface.registerPackage(Q)};fb.prototype.importPackage=function(Q){return this.coreInterface.importPackage(Q)};fb.prototype.removePackage=function(Q){return this.coreInterface.removePackage(Q)};fb.prototype.reloadPackage=function(Q){return this.coreInterface.reloadPackage(Q)};fb.prototype.packageConfChange=function(Q,ea){return this.coreInterface.packageConfChange(Q,ea)};fb.prototype.keyValueListOfVariablesInModule=function(Q,ea){return this.coreInterface.keyValueListOfVariablesInModule(Q,
ea)};fb.prototype.interactivelyCreatePackage=function(Q){return Wc.interactivelyCreatePackage(this.coreInterface,Q)};fb.prototype.interactivelyLoadPackage=function(Q,ea){return Wc.interactivelyLoadPackage(this.coreInterface,Q,ea)};fb.prototype.interactivelyReloadPackage=function(Q,ea){return Wc.interactivelyReloadPackage(this.coreInterface,Q,ea)};fb.prototype.interactivelyUnloadPackage=function(Q,ea,Ia){return Wc.interactivelyUnloadPackage(this.coreInterface,Q,ea,Ia)};fb.prototype.interactivelyRemovePackage=
function(Q,ea){return Wc.interactivelyRemovePackage(this.coreInterface,Q,ea)};fb.prototype.isModuleLoaded=function(Q,ea){return this.coreInterface.isModuleLoaded(Q,ea)};fb.prototype.doesModuleExist=function(Q,ea){return this.coreInterface.doesModuleExist(Q,ea)};fb.prototype.importModule=function(Q){return this.coreInterface.importModule(Q)};fb.prototype.forgetModule=function(Q,ea){return this.coreInterface.forgetModule(Q,ea)};fb.prototype.reloadModule=function(Q,ea){return this.coreInterface.reloadModule(Q,
ea)};fb.prototype.moduleFormat=function(Q){return this.coreInterface.moduleFormat(Q)};fb.prototype.moduleRead=function(Q){return this.coreInterface.moduleRead(Q)};fb.prototype.moduleWrite=function(Q,ea){return this.coreInterface.moduleWrite(Q,ea)};fb.prototype.getModulesInPackage=function(Q){return Wc.modulesInPackage(this.coreInterface,Q)};fb.prototype.shortModuleName=function(Q,ea){return Wc.shortModuleName(this.coreInterface,Q,ea)};fb.prototype.interactivelyChangeModule=function(Q,ea,Ia){return Wc.interactivelyChangeModule(this.coreInterface,
Q,ea,Ia)};fb.prototype.interactivelyReloadModule=function(Q,ea){return Wc.interactivelyReloadModule(this.coreInterface,Q,ea)};fb.prototype.interactivelyUnloadModule=function(Q,ea){return Wc.interactivelyUnloadModule(this.coreInterface,Q,ea)};fb.prototype.interactivelyRemoveModule=function(Q,ea){return Wc.interactivelyRemoveModule(this.coreInterface,Q,ea)};fb.prototype.interactivelyAddModule=function(Q,ea){return Wc.interactivelyAddModule(this.coreInterface,Q,ea)};fb.prototype.showExportsAndImportsOf=
function(Q,ea){return Wc.showExportsAndImportsOf(this.coreInterface,Q,ea)};fb.prototype.exportsOfModules=function(Q){return this.coreInterface.exportsOfModules(Q)};fb.prototype.searchInPackage=function(Q,ea,Ia){return this.coreInterface.searchInPackage(Q,ea,Ia)};fb.prototype.searchInAllPackages=function(Q,ea){ea=void 0===ea?{}:ea;var Ia=this,Ra,cc,Nb,$a,ic,nd,vd,Xc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){switch(Wa.nextAddress){case 1:return(Ra=ea.progress)&&Ra.step("Fetching Packages...",
0),Wa.yield(Ia.coreInterface.getPackages({excluded:ea.excludedPackages}),2);case 2:cc=Wa.yieldResult,Nb=[],Ra&&Ra.step("Fetching Packages...",.1),$a=0;case 3:if(!($a<cc.length)){Wa.jumpTo(5);break}ic=cc[$a];nd=ic.url;if(!nd||"no group"===nd){Wa.jumpTo(4);break}Ra&&Ra.step(nd.replace(System.baseURL,"").slice(0,20),.1+$a/cc.length*.9);Wa.setCatchFinallyBlocks(6);return Wa.yield(Ia.coreInterface.searchInPackage(nd,Q,ea),8);case 8:vd=Wa.yieldResult;Nb=Nb.concat(vd);Wa.leaveTryBlock(4);break;case 6:Xc=
Wa.enterCatchBlock(),console.error("Error searching in package "+nd+":\n"+Xc.stack);case 4:$a++;Wa.jumpTo(3);break;case 5:return Wa.return(Nb)}})};fb.prototype.loadMochaTestFile=function(Q,ea){return this.coreInterface.loadMochaTestFile(Q,ea)};fb.prototype.runMochaTests=function(Q,ea,Ia,Ra){return this.coreInterface.runMochaTests(Q,ea,Ia,Ra)};$jscomp.global.Object.defineProperties(fb.prototype,{isSystemInterface:{configurable:!0,enumerable:!0,get:function(){return!0}},name:{configurable:!0,enumerable:!0,
get:function(){return this.coreInterface.name}}});Da("Interface",fb);Wc.Interface=fb;Wc.systemInterfaceNamed=Ic;Wc.systemInterfaceNamed=Ic;fb=Da("localInterface",new Wc.Interface(new Wc.LocalCoreInterface));Wc.localInterface=fb;Wc.localInterface=fb;Wc.localInterface=fb;Wc.httpInterfaces={};fb=Da("serverInterfaceFor",function(Q){return Wc.httpInterfaces[Q]||(Wc.httpInterfaces[Q]=new Wc.Interface(new Wc.HTTPCoreInterface(Q)))});Wc.serverInterfaceFor=fb;Wc.serverInterfaceFor=fb;Wc.serverInterfaceFor=
fb;Wc.l2lInterfaces={};fb=Da("l2lInterfaceFor",function(Q,ea){return Wc.l2lInterfaces[Q]||(Wc.l2lInterfaces[Q]=new Wc.Interface(new Wc.L2LCoreInterface(Q,ea)))});Wc.l2lInterfaceFor=fb;Wc.l2lInterfaceFor=fb;Wc.l2lInterfaceFor=fb}}});