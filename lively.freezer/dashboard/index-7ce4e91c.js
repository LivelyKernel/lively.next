System.register(["./__root_module__-db735625.js"],function(db){var Zb,lc,Uc,Bc,Vd,Od,je,Bd,jd,zd,ge,We,kf,bf;return{setters:[function(Hd){Zb=Hd.a_;lc=Hd.b;Uc=Hd.r;Bc=Hd._;Vd=Hd.a;Od=Hd.Z;je=Hd.bv;Bd=Hd.aZ;jd=Hd.i;zd=Hd.c;ge=Hd.bw;We=Hd.bx;kf=Hd.N;bf=Hd.by}],execute:function(){function Hd(sc){try{var Za=eval("("+wc.ast.transform.wrapInFunction("var _; _ = ("+sc+")")+")()")}catch(Pa){return JSON.parse(sc)}return"object"!==typeof Za?null:Za}function Ae(sc,Za){var Pa,ua,Na,Wa,Vb,Fa,Xa,gc,ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qd){switch(qd.nextAddress){case 1:return Pa=
Za.world(),qd.yield(Pa.prompt("Enter package name",{requester:Za,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:ua=qd.yieldResult;if(!ua)throw"Canceled";qd.setCatchFinallyBlocks(3);Wa=Vc.resource(ua);ua=Wa.name();Na=Wa.url;qd.leaveTryBlock(4);break;case 3:return qd.enterCatchBlock(),qd.yield(sc.getConfig(),5);case 5:return Vb=qd.yieldResult.baseURL,Fa=Vc.resource(Vb).join(ua).asDirectory().url,qd.yield(sc.normalize(Fa),6);case 6:Na=qd.yieldResult.replace(/\/\.js$/,
"/");case 4:return qd.yield(Pa.prompt("Confirm or change package location",{requester:Za,input:Na,historyId:"lively.vm-editor-add-package-address"}),7);case 7:Xa=qd.yieldResult;if(!Xa)throw"Canceled";gc=Vc.resource(Xa).asDirectory();ub=gc.asFile().url;return qd.yield(sc.removePackage(ub),8);case 8:return qd.yield(sc.resourceCreateFiles(ub,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+ua+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+ua+"\n\nNo description for package "+
ua+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+ua+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return qd.return(Vc.loadPackage(sc,{name:ua,address:ub,configFile:gc.join("package.json").url,main:gc.join("index.js").url,test:gc.join("tests/test.js").url,type:"package"}))}})}function uc(sc,Za,Pa){Pa=void 0===Pa?null:Pa;var ua,Na,Wa,Vb,Fa,Xa,gc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ub){switch(ub.nextAddress){case 1:return ua=
{name:"",address:"",type:"package"},ub.yield(sc.getConfig(),2);case 2:Na=ub.yieldResult;if(!Pa){ub.jumpTo(3);break}return ub.yield(sc.getPackage(Pa),4);case 4:if(Wa=ub.yieldResult){ub.jumpTo(5);break}return ub.yield(sc.getPackageForModule(Pa),6);case 6:Wa=ub.yieldResult;case 5:Vb=Wa;case 3:return ub.yield(Za.world().prompt("What is the package directory?",{requester:Za,input:Vb?Vb.address:Na.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:Fa=ub.yieldResult;if(!Fa)throw"Canceled";
ua.address=Fa.replace(/\/$/,"");ua.url=new Vc.URL(ua.address+"/");ua.configFile=Vc.resource(ua.url).join("package.json").url;ub.setCatchFinallyBlocks(8);Xa=JSON;gc=Xa.parse;return ub.yield(sc.moduleRead(ua.configFile),10);case 10:gc.call(Xa,ub.yieldResult).name;ub.leaveTryBlock(9);break;case 8:ub.enterCatchBlock(),ua.name=String(ua.url).replace(/\/$/,""),sc.resourceEnsureExistance(ua.configFile,'{\n  "name": "'+ua.name+'",\n  "version": "0.1.0"\n}');case 9:return ub.return(Vc.loadPackage(sc,ua))}})}
function wd(sc,Za,Pa){var ua,Na,Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vb){switch(Vb.nextAddress){case 1:return ua=Vc.resource(Pa).asFile().url,Vb.yield(sc.getPackage(ua),2);case 2:if(Na=Vb.yieldResult){Vb.jumpTo(3);break}return Vb.yield(sc.getPackageForModule(ua),4);case 4:Na=Vb.yieldResult;case 3:Wa=Na;if(!Wa)throw Error("Cannot find package for "+ua);return Vb.yield(sc.reloadPackage(ua),5);case 5:if(!Za){Vb.jumpTo(0);break}return Vb.yield(Za.updateModuleList(),7);case 7:return Vb.yield(Za.uiSelect(ua,
!1),8);case 8:return Vb.return(Vb.yieldResult)}})}function ce(sc,Za,Pa,ua){var Na,Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vb){switch(Vb.nextAddress){case 1:return Vb.yield(sc.getPackage(Pa),2);case 2:return Na=Vb.yieldResult,Vb.yield((ua||$world).confirm("Unload package "+Na.name+"?",{requester:Za}),3);case 3:Wa=Vb.yieldResult;if(!Wa)throw"Canceled";return Vb.yield(sc.removePackage(Pa),4);case 4:if(!Za){Vb.jumpTo(0);break}return Vb.yield(Za.updateModuleList(),6);case 6:return Vb.yield(Za.uiSelect(null),
0)}})}function Gd(sc,Za,Pa){var ua,Na,Wa,Vb,Fa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xa){switch(Xa.nextAddress){case 1:return ua=Za.world(),Xa.yield(sc.getPackage(Pa),2);case 2:return Na=Xa.yieldResult,Na?Xa.yield(ua.confirm("Really remove package "+Na.name+"?",{requester:Za}),3):($world.inform('No package "'+Pa+'" found!',{requester:Za}),Xa.return());case 3:Wa=Xa.yieldResult;if(!Wa)throw"Canceled";sc.removePackage(Pa);return Xa.yield(ua.confirm("Also remove directory "+Na.name+
" including "+Na.modules.length+" modules?"),4);case 4:Vb=Xa.yieldResult;if(!Vb){Xa.jumpTo(0);break}return Xa.yield(ua.confirm("REALLY *remove* directory "+Na.name+"? No undo possible..."),6);case 6:if(Fa=Xa.yieldResult)return Xa.yield(sc.resourceRemove(Na.address),0);Xa.jumpTo(0)}})}function pe(sc,Za,Pa){Pa=void 0===Pa?$world:Pa;var ua,Na,Wa,Vb,Fa,Xa,gc,ub,qd,fc,Ud;return $jscomp.asyncExecutePromiseGeneratorProgram(function(td){switch(td.nextAddress){case 1:return td.yield(sc.getPackage(Za),2);case 2:ua=
td.yieldResult;if(!ua)throw Error("Cannot find package "+Za);Na=[];Wa=$jscomp.makeIterator(ua.modules);Vb=Wa.next();case 3:if(Vb.done)return td.yield(Pa.execCommand("open text window",{title:"imports and exports of "+Za,content:Na.join("\n\n")}),0);Fa=Vb.value;if(!Fa.name.match(/\.js$/)){td.jumpTo(4);break}td.setCatchFinallyBlocks(6);Xa=sc;gc=Xa.importsAndExportsOf;ub=Fa.name;return td.yield(sc.moduleRead(Fa.name),9);case 9:return td.yield(gc.call(Xa,ub,td.yieldResult),8);case 8:qd=td.yieldResult;
td.leaveTryBlock(7);break;case 6:fc=td.enterCatchBlock();Pa.logError(Error("Error when getting imports/exports from module "+Fa.name+":\n"+fc.stack));td.jumpTo(4);break;case 7:Ud=""+Fa.name;if(!qd.imports.length&&!qd.exports.length){Ud+="\n  does not import / export anything";td.jumpTo(4);break}qd.imports.length&&(Ud+="\n  imports:\n",Ud+=Vc.arr.groupByKey(qd.imports,"fromModule").mapGroups(function(fd,Xb){return"from "+fd+": "+Xb.map(function(Me){return Me.local||Me.imported?Me.imported&&Me.imported!==
Me.local?Me.imported+" as "+Me.local:Me.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(fd){return"    "+fd}).join("\n"));qd.exports.length&&(Ud+="\n  exports:\n",Ud+=qd.exports.map(function(fd){return fd.local?fd.local&&fd.local!==fd.exported?fd.local+" as "+fd.exported:fd.exported:fd.exported+" from "+fd.fromModule}).join(", ").split("\n").map(function(fd){return"    "+fd}).join("\n"));Na.push(Ud);case 4:Vb=Wa.next(),td.jumpTo(3)}})}function Te(sc){return sc.match(/import.*['"]mocha(-es6)?['"]/)&&
sc.match(/it\(['"]/)}function rc(sc,Za,Pa){Pa=Pa&&Pa.address;if(Pa&&0===Za.indexOf(Pa))var ua=Za.slice(Pa.length).replace(/^\//,"");else a:{Pa=sc.getConfig();if(!Pa||Pa.constructor!==Promise)try{ua=String((new hb.URL(Za)).relativePathFrom(new hb.URL(sc.getConfig().baseURL)));break a}catch(Na){}ua=Za}return ua}function bd(sc,Za,Pa,ua){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Na){return 1==Na.nextAddress?(ua=Object.assign({targetModule:Za},ua),Na.yield(sc.normalize(Za),2)):3!=Na.nextAddress?
(Za=Na.yieldResult,Na.yield(sc.moduleSourceChange(Za,Pa,ua),3)):Na.return(Za)})}function he(sc,Za,Pa,ua,Na){ua=void 0===ua?!1:ua;Na=void 0===Na?!1:Na;var Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vb){switch(Vb.nextAddress){case 1:return Za&&Za.setStatusMessage("Reloading "+Pa),Vb.setCatchFinallyBlocks(2),Vb.yield(sc.reloadModule(Pa,{reloadDeps:ua,resetEnv:Na}),4);case 4:if(!Za){Vb.jumpTo(5);break}return Vb.yield(Za.updateModuleList(),6);case 6:case 5:Za&&Za.setStatusMessage("Reloded "+
Pa);Vb.leaveTryBlock(0);break;case 2:Wa=Vb.enterCatchBlock();Vb.setCatchFinallyBlocks(7);if(!Za){Vb.jumpTo(9);break}return Vb.yield(Za.updateEditorWithSourceOf(Pa),10);case 10:case 9:Vb.leaveTryBlock(8);break;case 7:Vb.enterCatchBlock();case 8:throw Za&&Za.showError(Wa),Wa;}})}function cd(sc,Za,Pa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ua){switch(ua.nextAddress){case 1:return ua.yield(sc.forgetModule(Pa,{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!Za){ua.jumpTo(3);break}return ua.yield(Za.updateModuleList(),
4);case 4:case 3:ua.jumpToEnd()}})}function ie(sc,Za,Pa){var ua,Na,Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vb){switch(Vb.nextAddress){case 1:return Vb.yield(sc.normalize(Pa),2);case 2:return ua=Vb.yieldResult,Vb.yield(Za.world().confirm(["Really remove file:\n",{},ua,{fontStyle:"italic",fontWeight:"bold"}," ?",{}],{requester:Za,lineWrapping:!1}),3);case 3:Na=Vb.yieldResult;if(!Na)throw"Canceled";return Vb.yield(sc.forgetModule(ua),4);case 4:return Vb.yield(sc.resourceRemove(ua),
5);case 5:return Vb.yield(sc.getPackageForModule(ua),6);case 6:return Wa=Vb.yieldResult,Vb.return(Wa)}})}function ac(sc,Za){var Pa,ua,Na;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){if(1==Wa.nextAddress)return Wa.yield(hb._createAndLoadModules(sc,[Za]),2);Pa=Wa.yieldResult;ua=hb.arr.compact(Pa.map(function(Vb){return Vb.error}));Na=!!ua.length;return Wa.return(Na)})}function Db(sc,Za,Pa){var ua,Na,Wa,Vb,Fa,Xa,gc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ub){switch(ub.nextAddress){case 1:return ua=
hb.URL,ub.yield(sc.getConfig(),2);case 2:Na=new ua(ub.yieldResult.baseURL);Wa=Za.world();if(!Pa){ub.jumpTo(3);break}return ub.yield(sc.getPackage(Pa),4);case 4:if(Vb=ub.yieldResult){ub.jumpTo(5);break}return ub.yield(sc.getPackageForModule(Pa),6);case 6:Vb=ub.yieldResult;case 5:(Fa=Vb)&&(Na=new hb.URL(Fa.address));case 3:return ub.yield(hb._searchForExistingFiles(Za,String(Na),Fa),7);case 7:Xa=ub.yieldResult;if(!Xa.includes("[create new module]")){ub.jumpTo(8);break}return ub.yield(hb._askForModuleName(sc,
Pa||String(Na),Wa),9);case 9:gc=ub.yieldResult,Xa=[gc];case 8:return ub.yield(hb._createAndLoadModules(sc,Xa),10);case 10:return ub.return(ub.yieldResult)}})}function Tc(sc,Za){var Pa,ua,Na,Wa,Vb,Fa,Xa,gc,ub,qd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fc){if(1==fc.nextAddress)return fc.yield(sc.getPackage(Za),2);if(3!=fc.nextAddress){Pa=fc.yieldResult;if(!Pa||!Pa.address.match(/^http/))throw Error("Cannot load package "+Za);ua=hb.resource(Pa.address);Na=[];Wa=$jscomp;Vb=Wa.makeIterator;
return fc.yield(ua.dirList(5,{exclude:hb.modulesInPackage_defaultExclude}),3)}Fa=Vb.call(Wa,fc.yieldResult);for(Xa=Fa.next();!Xa.done;Xa=Fa.next())ub=gc=Xa.value,qd=ub.url,qd.match(/\.js$/)&&sc.isModuleLoaded(qd,!0)&&Na.push(sc.getModule(qd));return fc.return(Na)})}function Nc(sc){sc||(sc="local");if(sc.isSystemInterface)var Za=sc;else"string"===typeof sc&&sc.startsWith("l2l ")&&(sc={type:"l2l",id:sc.split(" ")[1]}),"string"!==typeof sc&&"l2l"===sc.type&&(Za=Pc.l2lInterfaceFor(sc.id,sc.info)),"string"!==
typeof sc&&($world.setStatusMessage("Unknown system interface "+sc),sc="local"),Za||(Za=sc&&"local"!==sc?Pc.serverInterfaceFor(sc):Pc.localInterface);return Za}db("systemInterfaceNamed",Nc);var wc=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");wc.parseJsonLikeObj=Hd;wc.ast=Zb;wc.parseJsonLikeObj=Hd;wc.parseJsonLikeObj=Hd;var Vc=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");Vc.loadPackage=function(sc,Za){var Pa,ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Na){switch(Na.nextAddress){case 1:return Na.yield(sc.importPackage(Za.address+
"/"),2);case 2:if(!Za.main){Na.jumpTo(3);break}return Na.yield(sc.importModule(Za.main.toString()),3);case 3:if(!Za.test){Na.jumpTo(5);break}Na.setCatchFinallyBlocks(6);return Na.yield(sc.importPackage("mocha-es6"),8);case 8:return Pa=Na.yieldResult,Na.yield(Pa.installSystemInstantiateHook(),9);case 9:return Na.yield(sc.importModule(Za.test.toString()),10);case 10:Na.leaveTryBlock(5);break;case 6:ua=Na.enterCatchBlock(),console.warn("Cannot load test of new package: "+ua);case 5:return Na.return(sc.getPackage(Za.address))}})};
Vc.interactivelyCreatePackage=Ae;Vc.interactivelyLoadPackage=uc;Vc.interactivelyReloadPackage=wd;Vc.interactivelyUnloadPackage=ce;Vc.interactivelyRemovePackage=Gd;Vc.showExportsAndImportsOf=pe;Vc.parseJsonLikeObj=Hd;Vc.arr=lc;Vc.resource=Uc;Vc.interactivelyCreatePackage=Ae;Vc.interactivelyCreatePackage=Ae;Vc.interactivelyLoadPackage=uc;Vc.interactivelyLoadPackage=uc;Vc.interactivelyReloadPackage=wd;Vc.interactivelyReloadPackage=wd;Vc.interactivelyUnloadPackage=ce;Vc.interactivelyUnloadPackage=ce;
Vc.interactivelyRemovePackage=Gd;Vc.interactivelyRemovePackage=Gd;Vc.showExportsAndImportsOf=pe;Vc.showExportsAndImportsOf=pe;var hb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");hb.isTestModule=Te;hb.shortModuleName=rc;hb.interactivelyChangeModule=bd;hb.interactivelyReloadModule=he;hb.interactivelyUnloadModule=cd;hb.interactivelyRemoveModule=ie;hb.addModule=ac;hb.interactivelyAddModule=Db;hb._askForModuleName=function(sc,Za,Pa){var ua,Na;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){switch(Wa.nextAddress){case 1:return Wa.yield(Pa.prompt("Enter module name",
{input:Za,historyId:"lively.vm-editor-add-module-name"}),2);case 2:Za=Wa.yieldResult;if(!Za)throw"Canceled";return Wa.yield(sc.normalize(Za),3);case 3:return ua=Wa.yieldResult,Wa.yield(Pa.confirm(["Create module \n",{},ua,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:Na=Wa.yieldResult;if(!Na)throw"Canceled";return Wa.return(ua)}})};hb._searchForExistingFiles=function(sc,Za,Pa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ua){return String(Za).match(/^http/)?ua.return(hb._searchForExistingFilesWeb(sc,
Za,Pa)):ua.return(hb._searchForExistingFilesManually(sc,Za,Pa))})};hb._searchForExistingFilesManually=function(sc,Za,Pa){var ua,Na;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){switch(Wa.nextAddress){case 1:return Wa.yield(sc.world().multipleChoicePrompt("Add Module",{requester:sc,choices:["Create New Module","Load Existing Module"]}),2);case 2:ua=Wa.yieldResult;if("Create New Module"===ua)return Wa.return("[create new module]");if("Load Existing Module"!==ua){Wa.jumpTo(3);break}return Wa.yield(sc.world().prompt("URL of module?",
{input:Za,requester:sc,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),4);case 4:if(Na=Wa.yieldResult)return Wa.return([Na]);case 3:throw"Canceled";}})};hb._searchForExistingFilesWeb=function(sc,Za,Pa){function ua(ub){ub.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(ub.name())||Pa&&hb.arr.pluck(Pa.modules,"name").includes(ub.url)?!0:!1}var Na,Wa,Vb,Fa,Xa,gc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ub){switch(ub.nextAddress){case 1:return(Na=
sc.world())&&(Wa=Na.showLoadingIndicatorFor(sc,"Loading existing modules...")),ub.yield(hb.resource(Za).dirList(5,{exclude:ua}),3);case 3:return ub.yield(ub.yieldResult.map(function(qd){return qd.url}),2);case 2:return Vb=ub.yieldResult,Fa=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(Vb.filter(function(qd){return qd.endsWith(".js")}).map(function(qd){return{isListItem:!0,string:Pa&&0==qd.indexOf(Pa.address)?Pa.name+qd.slice(Pa.address.length):qd,value:qd}})),ub.yield(Promise.resolve(Wa&&
Wa.remove()).then(function(){return sc.world().filterableListPrompt("What module to load?",Fa,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:sc},sc?{extent:sc.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:Xa=ub.yieldResult;if(!Xa||"canceled"===Xa.status||!Xa.selected.length)throw"Canceled";gc=Xa.selected||Xa;Array.isArray(gc)||(gc=[gc]);return ub.return(gc)}})};hb._createAndLoadModules=function(sc,Za){var Pa,ua,Na,Wa,Vb,Fa,Xa,gc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ub){switch(ub.nextAddress){case 1:Array.isArray(Za)||
(Za=[Za]),Pa=[],ua=$jscomp.makeIterator(Za),Na=ua.next();case 2:if(Na.done){ub.jumpTo(4);break}Wa=Na.value;return ub.yield(sc.forgetModule(Wa,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return ub.yield(sc.resourceEnsureExistance(Wa,'"format esm";\n'),6);case 6:return Vb=ub.yieldResult,Fa=hb,Xa=Fa.isTestModule,ub.yield(Vb.read(),7);case 7:if(!Xa.call(Fa,ub.yieldResult)){ub.jumpTo(8);break}if(System.global.Mocha&&System.global.chai){ub.jumpTo(8);break}return ub.yield(System.import("mocha-es6"),10);case 10:return ub.yield(hb.promise.waitFor(function(){return!!System.global.Mocha&&
!!System.global.chai}),8);case 8:return ub.setCatchFinallyBlocks(12),ub.yield(sc.importModule(Wa),14);case 14:Pa.push({name:Wa});ub.leaveTryBlock(3);break;case 12:gc=ub.enterCatchBlock(),Pa.push({name:Wa,error:gc});case 3:Na=ua.next();ub.jumpTo(2);break;case 4:return ub.return(Pa)}})};hb.modulesInPackage_defaultExclude=function(sc){return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(sc.name())?!0:!1};hb.modulesInPackage=Tc;hb.obj=Bc;hb.promise=Vd;hb.arr=lc;hb.resource=
Uc;hb.isTestModule=Te;hb.isTestModule=Te;hb.shortModuleName=rc;hb.shortModuleName=rc;hb.interactivelyChangeModule=bd;hb.interactivelyChangeModule=bd;hb.interactivelyReloadModule=he;hb.interactivelyReloadModule=he;hb.interactivelyUnloadModule=cd;hb.interactivelyUnloadModule=cd;hb.interactivelyRemoveModule=ie;hb.interactivelyRemoveModule=ie;hb.addModule=ac;hb.addModule=ac;hb.interactivelyAddModule=Db;hb.interactivelyAddModule=Db;hb.modulesInPackage=Tc;hb.modulesInPackage=Tc;var zc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");
zc.todo=function(sc){throw Error(sc+" is not yet implemented!");};zc.parseJsonLikeObj=Hd;zc.arr=lc;zc.Closure=Od;zc.obj=Bc;zc.resource=Uc;zc.transform=je;zc.modules=Bd;var Ub=function(sc){var Za=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js"),Pa=Za.hasOwnProperty("AbstractCoreInterface")&&"function"===typeof Za.AbstractCoreInterface?Za.AbstractCoreInterface:Za.AbstractCoreInterface=function(ua){ua&&ua[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return jd(Pa,sc,[{key:"dynamicCompletionsForPrefix",value:function(ua,Na,Wa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vb){zc.todo("dynamicCompletionsForPrefix");Vb.jumpToEnd()})}},{key:"runEval",value:function(ua,Na){zc.todo("runEval")}},{key:"resourceExists",value:function(ua){zc.todo("resourceExists")}},{key:"resourceEnsureExistance",value:function(ua,Na){zc.todo("resourceEnsureExistance")}},{key:"resourceMkdir",value:function(ua){zc.todo("resourceMkdir")}},{key:"resourceRead",
value:function(ua){zc.todo("resourceRead")}},{key:"resourceRemove",value:function(ua){zc.todo("resourceRemove")}},{key:"resourceWrite",value:function(ua,Na){zc.todo("resourceWrite")}},{key:"resourceCreateFiles",value:function(ua,Na){zc.todo("resourceCreateFiles")}},{key:"resourceDirList",value:function(ua,Na,Wa){zc.todo("resourceDirList")}},{key:"normalizeSync",value:function(ua,Na,Wa){zc.todo("normalizeSync")}},{key:"normalize",value:function(ua,Na,Wa){zc.todo("normalize")}},{key:"printSystemConfig",
value:function(){zc.todo("printSystemConfig")}},{key:"getConfig",value:function(){zc.todo("getConfig")}},{key:"setConfig",value:function(ua){zc.todo("setConfig")}},{key:"getPackages",value:function(ua){zc.todo("getPackages")}},{key:"isModuleLoaded",value:function(ua,Na){zc.todo("isModuleLoaded")}},{key:"doesModuleExist",value:function(ua,Na){zc.todo("doesModuleExist")}},{key:"getModules",value:function(){var ua=this,Na,Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vb){return 1==Vb.nextAddress?
(Na=zc.arr,Wa=Na.flatmap,Vb.yield(ua.getPackages(),2)):Vb.return(Wa.call(Na,Vb.yieldResult,function(Fa){return Fa.modules}))})}},{key:"getModule",value:function(ua){var Na=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){return 1==Wa.nextAddress?Wa.yield(Na.getModules(),2):Wa.return(Wa.yieldResult.find(function(Vb){return Vb.name===ua}))})}},{key:"getPackage",value:function(ua){var Na=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){return 1==Wa.nextAddress?
(ua=ua.replace(/\/+$/,""),Wa.yield(Na.getPackages(),2)):Wa.return(Wa.yieldResult.find(function(Vb){return Vb.address===ua||Vb.name===ua}))})}},{key:"getPackageForModule",value:function(ua){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Na){zc.todo("getPackageForModule");Na.jumpToEnd()})}},{key:"systemConfChange",value:function(ua){var Na=zc.parseJsonLikeObj(ua);["baseURL"].forEach(function(Wa){return delete Na[Wa]});return this.setConfig(Na)}},{key:"resourcesOfPackage",value:function(ua,
Na){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){zc.todo("resourcesOfPackage");Wa.jumpToEnd()})}},{key:"registerPackage",value:function(ua){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Na){zc.todo("registerPackage");Na.jumpToEnd()})}},{key:"importPackage",value:function(ua){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Na){zc.todo("importPackage");Na.jumpToEnd()})}},{key:"removePackage",value:function(ua){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Na){zc.todo("removePackage");
Na.jumpToEnd()})}},{key:"reloadPackage",value:function(ua){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Na){zc.todo("reloadPackage");Na.jumpToEnd()})}},{key:"packageConfChange",value:function(ua,Na){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){zc.todo("packageConfChange");Wa.jumpToEnd()})}},{key:"importModule",value:function(ua){zc.todo("importModule")}},{key:"forgetModule",value:function(ua,Na){zc.todo("forgetModule")}},{key:"reloadModule",value:function(ua,Na){zc.todo("reloadModule")}},
{key:"moduleFormat",value:function(ua){zc.todo("moduleFormat")}},{key:"moduleRead",value:function(ua){zc.todo("moduleRead")}},{key:"moduleSourceChange",value:function(ua,Na,Wa){zc.todo("moduleSourceChange")}},{key:"importsAndExportsOf",value:function(ua,Na){zc.todo("importsAndExportsOf")}},{key:"keyValueListOfVariablesInModule",value:function(ua,Na){zc.todo("keyValueListOfVariablesInModule")}},{key:"moduleWrite",value:function(ua,Na){return this.moduleSourceChange(ua,Na)}}],[{key:Symbol.for("__LivelyClassName__"),
get:function(){return"AbstractCoreInterface"}}],Za,{pathInPackage:function(){return"interfaces/interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:327,end:3944})}(void 0);zc.AbstractCoreInterface=Ub;zc.AbstractCoreInterface=Ub;zc.AbstractCoreInterface=Ub;var Jc=function(sc){var Za=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js"),
Pa=Za.hasOwnProperty("RemoteCoreInterface")&&"function"===typeof Za.RemoteCoreInterface?Za.RemoteCoreInterface:Za.RemoteCoreInterface=function(ua){ua&&ua[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return jd(Pa,sc,[{key:Symbol.for("lively-instance-initialize"),value:function(){jd._get(Object.getPrototypeOf(Pa.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.currentEval=null}},{key:"runEval",value:function(ua,
Na){throw Error("Not yet implemented");}},{key:"runEvalAndStringify",value:function(ua,Na){var Wa=this;return this.currentEval?this.currentEval.then(function(){return Wa.runEvalAndStringify(ua,Na)}):this.currentEval=Promise.resolve().then(function(){var Vb,Fa,Xa,gc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ub){switch(ub.nextAddress){case 1:return ub.yield(Wa.runEval("\n        Promise.resolve((async "+zc.transform.wrapInFunction(ua)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},Na)),2);case 2:if((Vb=ub.yieldResult)&&Vb.isError)throw Error(String(Vb.value||Vb.error));if(!Vb||!Vb.value)return ub.return(null);if(Fa=Vb.promisedValue){ub.jumpTo(3);break}return ub.yield(Vb.value,4);case 4:Fa=ub.yieldResult;case 3:Xa=Fa;if(!Xa)return ub.return();if("undefined"===Xa)return ub.return(void 0);if("null"===Xa)return ub.return(null);if("true"===Xa)return ub.return(!0);
if("false"===Xa)return ub.return(!1);try{gc=JSON.parse(Xa)}catch(qd){return ub.return(Xa)}if(gc&&gc.isError)throw Error(String(gc.value));return ub.return(gc)}})}).then(function(Vb){delete Wa.currentEval;return Vb},function(Vb){delete Wa.currentEval;return Promise.reject(Vb)})}},{key:"dynamicCompletionsForPrefix",value:function(ua,Na,Wa){var Vb=this,Fa,Xa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gc){Fa=zc.obj.isString(Wa.context)?Wa.context:!1;Wa=zc.obj.dissoc(Wa,["systemInterface",
"System","context"]);Xa="\n      var prefix = "+JSON.stringify(Na)+",\n          opts = "+JSON.stringify(Wa)+";\n      opts.context = "+Fa+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return gc.return(Vb.runEvalAndStringify(Xa))})}},{key:"evalWithResource",value:function(ua,Na,Wa){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+ua+'").'+Na+"("+(Wa?JSON.stringify(Wa):"")+");\n    ")}},{key:"resourceExists",value:function(ua){return this.evalWithResource(ua,"exists")}},{key:"resourceEnsureExistance",value:function(ua,Na){return this.evalWithResource(ua,
"ensureExistance",Na)}},{key:"resourceMkdir",value:function(ua){return this.evalWithResource(ua,"mkdir")}},{key:"resourceRead",value:function(ua){return this.evalWithResource(ua,"read")}},{key:"resourceRemove",value:function(ua){return this.evalWithResource(ua,"remove")}},{key:"resourceWrite",value:function(ua,Na){return this.evalWithResource(ua,"write",Na)}},{key:"resourceCreateFiles",value:function(ua,Na){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
ua+'", '+JSON.stringify(Na)+")")}},{key:"resourceDirList",value:function(ua,Na,Wa){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+ua+'").dirList('+JSON.stringify(Na)+", "+JSON.stringify(Wa)+"))\n        .map(({url}) => ({url}))")}},{key:"livelySystemAccessor",value:function(ua){ua=void 0===ua?"livelySystem":ua;return"var "+ua+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
ua+') throw new Error("lively-system-interface not available!");'}},{key:"normalizeSync",value:function(ua,Na,Wa){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(ua)+", "+JSON.stringify(Na)+", "+Wa+")")}},{key:"normalize",value:function(ua,Na,Wa){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(ua)+", "+JSON.stringify(Na)+", "+JSON.stringify(Wa)+")")}},{key:"printSystemConfig",value:function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")}},
{key:"getConfig",value:function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')}},{key:"setConfig",value:function(ua){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(ua)+")")}},{key:"getPackages",value:function(ua){ua=Object.assign({excluded:[]},ua);ua.excluded=ua.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(ua)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')}},{key:"getPackageForModule",value:function(ua){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(ua)+")")}},{key:"isModuleLoaded",value:function(ua,Na){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+ua+'", '+Na+")")}},{key:"doesModuleExist",value:function(ua,Na){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+ua+'", '+Na+")")}},{key:"registerPackage",value:function(ua){var Na=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){return Wa.return(Na.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(ua)+")"))})}},
{key:"importPackage",value:function(ua){var Na=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){return Wa.return(Na.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(ua)+")"))})}},{key:"removePackage",value:function(ua){var Na=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){return Wa.return(Na.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(ua)+")"))})}},{key:"reloadPackage",value:function(ua,Na){var Wa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vb){return Vb.return(Wa.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(ua)+", "+JSON.stringify(Na)+")"))})}},{key:"packageConfChange",value:function(ua,Na){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(ua)+", "+JSON.stringify(Na)+")")}},{key:"resourcesOfPackage",value:function(ua,Na){Na=void 0===Na?[".git","node_modules",".module_cache","lively.next-node_modules"]:Na;var Wa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vb){ua.address&&
(ua=ua.address);return Vb.return(Wa.runEvalAndStringify("\n      "+Wa.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(ua)+", "+JSON.stringify(Na)+");"))})}},{key:"getModule",value:function(ua){var Na=this,Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vb){if(1==Vb.nextAddress)return Vb.yield(Na.getModules(),2);Wa=Vb.yieldResult.find(function(Fa){return Fa.name===ua});return Vb.return(Wa?zc.modules.module(Wa.name):null)})}},{key:"importModule",
value:function(ua){return this.runEvalAndStringify("lively.modules.System.import("+JSON.stringify(ua)+")")}},{key:"forgetModule",value:function(ua,Na){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ua)+").unload("+JSON.stringify(Na)+")")}},{key:"reloadModule",value:function(ua,Na){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ua)+").reload("+JSON.stringify(Na)+")")}},{key:"moduleFormat",value:function(ua){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(ua)+").format();")}},{key:"moduleRead",value:function(ua){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ua)+").source()")}},{key:"moduleSourceChange",value:function(ua,Na,Wa){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ua)+").changeSource("+JSON.stringify(Na)+", "+JSON.stringify(Wa)+")")}},{key:"keyValueListOfVariablesInModule",value:function(ua,Na){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+
JSON.stringify(ua)+", "+JSON.stringify(Na)+")")}},{key:"importsAndExportsOf",value:function(ua,Na){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(ua)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(ua)+").exports()})")}},{key:"exportsOfModules",value:function(ua){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(ua)+";\n      options.excludedPackages = ["+ua.excludedPackages.map(function(Na){return"function"===
typeof Na?Na.toString():JSON.stringify(Na)}).join(",")+"]\n      await livelySystem.localInterface.exportsOfModules(options)")}},{key:"searchInPackage",value:function(ua,Na,Wa){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(ua)+", "+JSON.stringify(Na)+", "+JSON.stringify(Wa)+")")}},{key:"loadMochaTestFile",value:function(ua,Na){Na=void 0===Na?[]:Na;var Wa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vb){return Vb.return(Wa.runEvalAndStringify("\n      "+
Wa.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(ua)+", "+JSON.stringify(Na)+"), result;\n      result = {testsByFile}"))})}},{key:"runMochaTests",value:function(ua,Na,Wa,Vb){var Fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xa){ua&&ua instanceof RegExp&&(ua={isRegExp:!0,value:String(ua).replace(/^\/|\/$/g,"")});return Xa.return(Fa.runEvalAndStringify("\n      var grep = "+JSON.stringify(ua)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
Fa.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(Na||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})}}],
[{key:Symbol.for("__LivelyClassName__"),get:function(){return"RemoteCoreInterface"}}],Za,{pathInPackage:function(){return"interfaces/interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:3953,end:16249})}(zc.AbstractCoreInterface);zc.RemoteCoreInterface=Jc;zc.RemoteCoreInterface=Jc;zc.RemoteCoreInterface=Jc;var Wc=
lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");Wc.obj=Bc;Wc.string=zd;Wc.arr=lc;Wc.resource=Uc;Wc.createFiles=ge;Wc.ast=Zb;Wc.modules=Bd;Wc.vm=We;Wc.parseJsonLikeObj=Hd;Wc.AbstractCoreInterface=Ub;Wc.classToFunctionTransform=kf;Ub=function(sc){var Za=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js"),Pa=Za.hasOwnProperty("LocalCoreInterface")&&"function"===typeof Za.LocalCoreInterface?Za.LocalCoreInterface:Za.LocalCoreInterface=
function(ua){ua&&ua[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return jd(Pa,sc,[{key:"name",get:function(){return"local"}},{key:"dynamicCompletionsForPrefix",value:function(ua,Na,Wa){var Vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){if(1==Fa.nextAddress)return Fa.yield(Wc.vm.completions.getCompletions(function(Xa){return Wc.vm.runEval(Xa.replace("return ",""),Object.assign({targetModule:ua,classTransform:Wc.classToFunctionTransform},
Wa))},Na),2);Vb=Fa.yieldResult;if(Vb.isError)throw Vb.value;return Fa.return({completions:Vb.completions,prefix:Vb.startLetters})})}},{key:"runEval",value:function(ua,Na){return Wc.vm.runEval(ua,Object.assign({classTransform:Wc.classToFunctionTransform},Na))}},{key:"resourceExists",value:function(ua){return Wc.resource(ua).exists()}},{key:"resourceEnsureExistance",value:function(ua,Na){return Wc.resource(ua).ensureExistance(Na)}},{key:"resourceMkdir",value:function(ua){return Wc.resource(ua).mkdir()}},
{key:"resourceRead",value:function(ua){return Wc.resource(ua).read()}},{key:"resourceRemove",value:function(ua){return Wc.resource(ua).remove()}},{key:"resourceWrite",value:function(ua,Na){return Wc.resource(ua).write(Na)}},{key:"resourceCreateFiles",value:function(ua,Na){return Wc.createFiles(ua,Na)}},{key:"resourceDirList",value:function(ua,Na,Wa){return Wc.resource(ua).dirList(Na,Wa)}},{key:"normalizeSync",value:function(ua,Na,Wa){return System.decanonicalize(ua,Na,Wa)}},{key:"normalize",value:function(ua,
Na,Wa){return System.normalize(ua,Na,Wa)}},{key:"printSystemConfig",value:function(){return Wc.modules.printSystemConfig()}},{key:"getConfig",value:function(){return System.getConfig()}},{key:"setConfig",value:function(ua){Wc.modules.System.config(ua)}},{key:"getPackages",value:function(ua){ua=Object.assign({},ua);ua=void 0===ua.excluded?[]:ua.excluded;var Na=ua.filter(function(Vb){return"string"===typeof Vb}),Wa=ua.filter(function(Vb){return"function"===typeof Vb});Na=Na.concat(Na.map(function(Vb){return System.decanonicalize(Vb.replace(/\/?$/,
"/")).replace(/\/$/,"")}));return Wc.modules.getPackages().filter(function(Vb){return!Na.includes(Vb.url)&&!Wa.some(function(Fa){return Fa(Vb.url)})})}},{key:"registerPackage",value:function(ua){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Na){return Na.return(Wc.modules.registerPackage(ua))})}},{key:"importPackage",value:function(ua){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Na){return Na.return(Wc.modules.importPackage(ua))})}},{key:"removePackage",value:function(ua){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Na){return Na.return(Wc.modules.removePackage(ua))})}},
{key:"reloadPackage",value:function(ua,Na){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){return Wa.return(Wc.modules.reloadPackage(ua,Na))})}},{key:"packageConfChange",value:function(ua,Na){var Wa=this,Vb,Fa,Xa,gc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ub){if(1==ub.nextAddress)return Vb=Wc.modules.System,Fa=Wc.parseJsonLikeObj(ua),Xa=JSON.stringify(Fa,null,2),ub.yield(Wc.modules.module(Na).changeSource(Xa,{doEval:!1}),2);if(3!=ub.nextAddress)return Vb.set(Na,
Vb.newModule(Fa)),ub.yield(Wa.getPackageForModule(Na),3);(gc=ub.yieldResult)&&Wc.modules.applyPackageConfig(Fa,gc.address);ub.jumpToEnd()})}},{key:"resourcesOfPackage",value:function(ua,Na){Na=void 0===Na?[".git","node_modules",".module_cache"]:Na;var Wa,Vb,Fa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xa){if(1==Xa.nextAddress)return Xa.setCatchFinallyBlocks(2),Wa=ua.address?ua.address:ua,Vb=Wc.modules.getPackage(Wa),Xa.yield(Vb.resources(void 0,Na),4);if(2!=Xa.nextAddress)return Xa.return(Xa.yieldResult.map(function(gc){return Object.assign(gc,
{package:gc.package.url})}));Fa=Xa.enterCatchBlock();console.warn("resourcesOfPackage error for "+ua+": "+Fa);return Xa.return([])})}},{key:"getPackageForModule",value:function(ua){return(ua=Wc.modules.getPackageOfModule(ua))?ua.asSpec():ua}},{key:"isModuleLoaded",value:function(ua,Na){return Wc.modules.isModuleLoaded(ua,Na)}},{key:"doesModuleExist",value:function(ua,Na){return Wc.modules.isModuleLoaded(ua,Na)}},{key:"getModule",value:function(ua){return Wc.modules.module(ua)}},{key:"importModule",
value:function(ua){return Wc.modules.System.import(ua)}},{key:"forgetModule",value:function(ua,Na){return Wc.modules.module(ua).unload(Na)}},{key:"reloadModule",value:function(ua,Na){return Wc.modules.module(ua).reload(Na)}},{key:"moduleFormat",value:function(ua){return Wc.modules.module(ua).format()}},{key:"moduleRead",value:function(ua){return Wc.modules.module(ua).source()}},{key:"moduleSourceChange",value:function(ua,Na,Wa){return Wc.modules.module(ua).changeSource(Na,Wa)}},{key:"keyValueListOfVariablesInModule",
value:function(ua,Na){var Wa=this,Vb,Fa,Xa,gc,ub,qd,fc,Ud;return $jscomp.asyncExecutePromiseGeneratorProgram(function(td){switch(td.nextAddress){case 1:if(Na){td.jumpTo(2);break}return td.yield(Wa.resourceRead(ua),3);case 3:Na=td.yieldResult;case 2:return Vb="string"===typeof Na?Wc.ast.parse(Na):Na,Fa=Wa.normalizeSync(ua),Wa.moduleFormat(Fa),Xa=Wc.modules.module(Fa).env().recorder,td.yield(Wa.importsAndExportsOf(Fa,Vb),4);case 4:return gc=td.yieldResult,ub=Wc.ast.query.topLevelDeclsAndRefs(Vb),qd=
Wc.arr.sortByKey(Wc.ast.query.declarationsOfScope(ub.scope,!0),"start"),fc=Wc.arr.pluck(ub.scope.importSpecifiers,"name"),Ud=0,td.return(qd.map(function(fd){var Xb=fd.name.length,Me=gc.exports.find(function(Wb){return Wb.local===fd.name}),ic=Wc.arr.include(fc,fd.name);Me&&(Xb+=9);ic&&(Xb+=9);Ud=Math.max(Ud,Xb);return{isExport:Me,isImport:ic,name:fd.name,value:Xa[fd.name],node:fd,printedName:fd.name+(Me?" [export]":"")+(ic?" [import]":""),printedValue:Wc.obj.inspect(Xa[fd.name],{maxDepth:1}).replace(/\n/g,
"")}}).map(function(fd){return{isListItem:!0,value:fd,string:fd.printedName+Wc.string.indent(" = "+fd.printedValue," ",Ud-fd.printedName.length)}}))}})}},{key:"importsAndExportsOf",value:function(ua,Na){var Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vb){return 1==Vb.nextAddress?Vb.yield(Wc.modules.module(ua).imports(Na),2):3!=Vb.nextAddress?(Wa=Vb.yieldResult,Vb.yield(Wc.modules.module(ua).exports(Na),3)):Vb.return({imports:Wa,exports:Vb.yieldResult})})}},{key:"exportsOfModules",
value:function(ua){return Wc.modules.ExportLookup.run(System,ua)}},{key:"searchInPackage",value:function(ua,Na,Wa){return Wc.modules.getPackage(ua).search(Na,Wa)}},{key:"runMochaTests",value:function(ua,Na,Wa,Vb){var Fa,Xa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gc){if(1==gc.nextAddress)return gc.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);Fa=gc.yieldResult;Xa=Fa.runMochaTests;return gc.return(Xa(ua,Na,Wa,Vb))})}},{key:"loadMochaTestFile",value:function(ua,
Na){var Wa,Vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){if(1==Fa.nextAddress)return Fa.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);Wa=Fa.yieldResult;Vb=Wa.loadMochaTestFile;return Fa.return(Vb(ua,Na))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"LocalCoreInterface"}}],Za,{pathInPackage:function(){return"interfaces/local-system.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},
package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:411,end:8203})}(Wc.AbstractCoreInterface);Wc.LocalCoreInterface=Ub;Wc.LocalCoreInterface=Ub;Wc.LocalCoreInterface=Ub;var Ad=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");Ad.evalStrategies=bf;Ad.RemoteCoreInterface=Jc;var Xd=function(sc){var Za=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js"),Pa=Za.hasOwnProperty("HTTPCoreInterface")&&
"function"===typeof Za.HTTPCoreInterface?Za.HTTPCoreInterface:Za.HTTPCoreInterface=function(ua){ua&&ua[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return jd(Pa,sc,[{key:Symbol.for("lively-instance-initialize"),value:function(ua){jd._get(Object.getPrototypeOf(Pa.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.currentEval=null;this.url=ua;this.server=new Ad.evalStrategies.HttpEvalStrategy(ua)}},{key:"name",
get:function(){return this.url}},{key:"description",get:function(){return this.url.replace(/^https?:\/\//,"")}},{key:"runEval",value:function(ua,Na){return this.server.runEval(ua,Na)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"HTTPCoreInterface"}}],Za,{pathInPackage:function(){return"interfaces/http-interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",
version:"0.2.1"}}},{start:106,end:512})}(Ad.RemoteCoreInterface);Ad.HTTPCoreInterface=Xd;Ad.HTTPCoreInterface=Xd;Ad.HTTPCoreInterface=Xd;var xc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");xc.evalStrategies=bf;xc.RemoteCoreInterface=Jc;Jc=function(sc){var Za=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js"),Pa=Za.hasOwnProperty("L2LCoreInterface")&&"function"===typeof Za.L2LCoreInterface?Za.L2LCoreInterface:Za.L2LCoreInterface=
function(ua){ua&&ua[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return jd(Pa,sc,[{key:Symbol.for("lively-instance-initialize"),value:function(ua,Na){jd._get(Object.getPrototypeOf(Pa.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.targetId=ua;this.peer=Na}},{key:"name",get:function(){return"l2l "+this.targetId}},{key:"description",get:function(){var ua=this.peer,Na="l2l "+this.targetId.slice(0,5);if(ua){var Wa=
ua.location,Vb=ua.type,Fa=ua.user;ua=ua.world;Vb&&(Na+=", "+Vb);Wa&&(Na+=", "+Wa.replace(/^https?:\/\//,"")+(ua?"/"+ua:""));Fa&&(Na+=", "+Fa.name)}return Na}},{key:"client",get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}},{key:"isConnected",value:function(){var ua=this,Na,Wa,Vb,Fa,Xa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gc){if(1==gc.nextAddress)return Na=ua,Wa=Na.client,Vb=Na.targetId,gc.yield(Wa.sendToAndWait(Wa.trackerId,
"getClients",{}),2);Fa=gc.yieldResult;Xa=Fa.data;return gc.return(Xa.some(function(ub){ub=$jscomp.makeIterator(ub).next().value;return Vb===ub}))})}},{key:"runEval",value:function(ua,Na){var Wa=this,Vb,Fa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xa){Vb=Wa.client;if(!Vb)throw Error("No lively.2lively default client available!");Fa=new xc.evalStrategies.L2LEvalStrategy(Vb,Wa.targetId);return Xa.return(Fa.runEval(ua,Na))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"L2LCoreInterface"}}],
Za,{pathInPackage:function(){return"interfaces/l2l-interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:106,end:1449})}(xc.RemoteCoreInterface);xc.L2LCoreInterface=Jc;xc.L2LCoreInterface=Jc;xc.L2LCoreInterface=Jc;var Pc=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");Pc.systemInterfaceNamed=
Nc;Pc.interactivelyCreatePackage=Ae;Pc.interactivelyLoadPackage=uc;Pc.interactivelyReloadPackage=wd;Pc.interactivelyUnloadPackage=ce;Pc.interactivelyRemovePackage=Gd;Pc.showExportsAndImportsOf=pe;Pc.shortModuleName=rc;Pc.addModule=ac;Pc.interactivelyChangeModule=bd;Pc.interactivelyReloadModule=he;Pc.interactivelyUnloadModule=cd;Pc.interactivelyRemoveModule=ie;Pc.interactivelyAddModule=Db;Pc.modulesInPackage=Tc;Pc.LocalCoreInterface=Ub;Pc.HTTPCoreInterface=Xd;Pc.L2LCoreInterface=Jc;Jc=db("Interface",
function(sc){var Za=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js"),Pa=Za.hasOwnProperty("Interface")&&"function"===typeof Za.Interface?Za.Interface:Za.Interface=function(ua){ua&&ua[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return jd(Pa,sc,[{key:Symbol.for("lively-instance-initialize"),value:function(ua){this.coreInterface=ua}},{key:"isSystemInterface",get:function(){return!0}},{key:"name",get:function(){return this.coreInterface.name}},
{key:"dynamicCompletionsForPrefix",value:function(ua,Na,Wa){return this.coreInterface.dynamicCompletionsForPrefix(ua,Na,Wa)}},{key:"runEval",value:function(ua,Na){return this.coreInterface.runEval(ua,Na)}},{key:"printSystemConfig",value:function(ua,Na,Wa){return this.coreInterface.printSystemConfig(ua,Na,Wa)}},{key:"getConfig",value:function(ua,Na,Wa){return this.coreInterface.getConfig(ua,Na,Wa)}},{key:"getPackages",value:function(ua){return this.coreInterface.getPackages(ua)}},{key:"getModules",
value:function(ua,Na,Wa){return this.coreInterface.getModules(ua,Na,Wa)}},{key:"getModule",value:function(ua,Na,Wa){return this.coreInterface.getModule(ua,Na,Wa)}},{key:"getPackage",value:function(ua,Na,Wa){return this.coreInterface.getPackage(ua,Na,Wa)}},{key:"getPackageForModule",value:function(ua,Na,Wa){return this.coreInterface.getPackageForModule(ua,Na,Wa)}},{key:"resourcesOfPackage",value:function(ua,Na){return this.coreInterface.resourcesOfPackage(ua,Na)}},{key:"systemConfChange",value:function(ua,
Na,Wa){return this.coreInterface.systemConfChange(ua,Na,Wa)}},{key:"registerPackage",value:function(ua){return this.coreInterface.registerPackage(ua)}},{key:"importPackage",value:function(ua){return this.coreInterface.importPackage(ua)}},{key:"removePackage",value:function(ua){return this.coreInterface.removePackage(ua)}},{key:"reloadPackage",value:function(ua){return this.coreInterface.reloadPackage(ua)}},{key:"packageConfChange",value:function(ua,Na){return this.coreInterface.packageConfChange(ua,
Na)}},{key:"keyValueListOfVariablesInModule",value:function(ua,Na){return this.coreInterface.keyValueListOfVariablesInModule(ua,Na)}},{key:"interactivelyCreatePackage",value:function(ua){return Pc.interactivelyCreatePackage(this.coreInterface,ua)}},{key:"interactivelyLoadPackage",value:function(ua,Na){return Pc.interactivelyLoadPackage(this.coreInterface,ua,Na)}},{key:"interactivelyReloadPackage",value:function(ua,Na){return Pc.interactivelyReloadPackage(this.coreInterface,ua,Na)}},{key:"interactivelyUnloadPackage",
value:function(ua,Na,Wa){return Pc.interactivelyUnloadPackage(this.coreInterface,ua,Na,Wa)}},{key:"interactivelyRemovePackage",value:function(ua,Na){return Pc.interactivelyRemovePackage(this.coreInterface,ua,Na)}},{key:"isModuleLoaded",value:function(ua,Na){return this.coreInterface.isModuleLoaded(ua,Na)}},{key:"doesModuleExist",value:function(ua,Na){return this.coreInterface.doesModuleExist(ua,Na)}},{key:"createModule",value:function(ua){return Pc.addModule(this.coreInterface,ua)}},{key:"importModule",
value:function(ua){return this.coreInterface.importModule(ua)}},{key:"forgetModule",value:function(ua,Na){return this.coreInterface.forgetModule(ua,Na)}},{key:"reloadModule",value:function(ua,Na){return this.coreInterface.reloadModule(ua,Na)}},{key:"moduleFormat",value:function(ua){return this.coreInterface.moduleFormat(ua)}},{key:"moduleRead",value:function(ua){return this.coreInterface.moduleRead(ua)}},{key:"moduleWrite",value:function(ua,Na){return this.coreInterface.moduleWrite(ua,Na)}},{key:"getModulesInPackage",
value:function(ua){return Pc.modulesInPackage(this.coreInterface,ua)}},{key:"shortModuleName",value:function(ua,Na){return Pc.shortModuleName(this.coreInterface,ua,Na)}},{key:"interactivelyChangeModule",value:function(ua,Na,Wa){return Pc.interactivelyChangeModule(this.coreInterface,ua,Na,Wa)}},{key:"interactivelyReloadModule",value:function(ua,Na){return Pc.interactivelyReloadModule(this.coreInterface,ua,Na)}},{key:"interactivelyUnloadModule",value:function(ua,Na){return Pc.interactivelyUnloadModule(this.coreInterface,
ua,Na)}},{key:"interactivelyRemoveModule",value:function(ua,Na){return Pc.interactivelyRemoveModule(this.coreInterface,ua,Na)}},{key:"interactivelyAddModule",value:function(ua,Na){return Pc.interactivelyAddModule(this.coreInterface,ua,Na)}},{key:"showExportsAndImportsOf",value:function(ua,Na){return Pc.showExportsAndImportsOf(this.coreInterface,ua,Na)}},{key:"exportsOfModules",value:function(ua){return this.coreInterface.exportsOfModules(ua)}},{key:"searchInPackage",value:function(ua,Na,Wa){return this.coreInterface.searchInPackage(ua,
Na,Wa)}},{key:"searchInAllPackages",value:function(ua,Na){Na=void 0===Na?{}:Na;var Wa=this,Vb,Fa,Xa,gc,ub,qd,fc,Ud;return $jscomp.asyncExecutePromiseGeneratorProgram(function(td){switch(td.nextAddress){case 1:return(Vb=Na.progress)&&Vb.step("Fetching Packages...",0),td.yield(Wa.coreInterface.getPackages({excluded:Na.excludedPackages}),2);case 2:Fa=td.yieldResult,Xa=[],Vb&&Vb.step("Fetching Packages...",.1),gc=0;case 3:if(!(gc<Fa.length)){td.jumpTo(5);break}ub=Fa[gc];qd=ub.url;if(!qd||"no group"===
qd){td.jumpTo(4);break}Vb&&Vb.step(qd.replace(System.baseURL,"").slice(0,20),.1+gc/Fa.length*.9);td.setCatchFinallyBlocks(6);return td.yield(Wa.coreInterface.searchInPackage(qd,ua,Na),8);case 8:fc=td.yieldResult;Xa=Xa.concat(fc);td.leaveTryBlock(4);break;case 6:Ud=td.enterCatchBlock(),console.error("Error searching in package "+qd+":\n"+Ud.stack);case 4:gc++;td.jumpTo(3);break;case 5:return td.return(Xa)}})}},{key:"loadMochaTestFile",value:function(ua,Na){return this.coreInterface.loadMochaTestFile(ua,
Na)}},{key:"runMochaTests",value:function(ua,Na,Wa,Vb){return this.coreInterface.runMochaTests(ua,Na,Wa,Vb)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Interface"}}],Za,{pathInPackage:function(){return"index.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:679,end:6188})}(void 0));Pc.Interface=Jc;Pc.Interface=
Jc;Pc.Interface=Jc;Pc.systemInterfaceNamed=Nc;Pc.systemInterfaceNamed=Nc;Jc=db("localInterface",new Pc.Interface(new Pc.LocalCoreInterface));Pc.localInterface=Jc;Pc.localInterface=Jc;Pc.localInterface=Jc;Pc.httpInterfaces={};Jc=db("serverInterfaceFor",function(sc){return Pc.httpInterfaces[sc]||(Pc.httpInterfaces[sc]=new Pc.Interface(new Pc.HTTPCoreInterface(sc)))});Pc.serverInterfaceFor=Jc;Pc.serverInterfaceFor=Jc;Pc.serverInterfaceFor=Jc;Pc.l2lInterfaces={};Jc=db("l2lInterfaceFor",function(sc,Za){return Pc.l2lInterfaces[sc]||
(Pc.l2lInterfaces[sc]=new Pc.Interface(new Pc.L2LCoreInterface(sc,Za)))});Pc.l2lInterfaceFor=Jc;Pc.l2lInterfaceFor=Jc;Pc.l2lInterfaceFor=Jc}}});