System.register("./__root_module__-37c88ebd.js ./index-02cc248f.js kld-intersections ./index-d63033cc.js ./index-9714fb53.js ./color-picker-ddc5b515.js".split(" "),function(Wa){var Ib,Sb,xc,ac,Cd,nd,Ud,bd,Ic,pd,yd,Ne,Pe,Ie,fd,me,Yb,Yc,Nd,gd,ae,Fe,Wb,Cc,Td,Ec,Vd,Lb,ub,uc,dc,Zb,Mc,$a,$b,Eb,kc,tc,Sc,Pd,ec,Xb,Jb,Ra,Ga,ea,Da,ta,Pa,Ha,tb,Ac,wb,ud,Tb,te,cd,Lc,Hb,Be,Ob,Gb,Ta,Y,Ma,gb,Nb,oc,Wc,Gc,Zd,je,Bf,lf,bf,z,pf,nf,De,Cf,Rf,Vf,dg,eg,$c;return{setters:[function(Oe){Ib=Oe.W;Sb=Oe.R;xc=Oe.a2;ac=Oe.C;
Cd=Oe.p;nd=Oe.a3;Ud=Oe.a4;bd=Oe.P;Ic=Oe.b;pd=Oe.c;yd=Oe._;Ne=Oe.a5;Pe=Oe.e;Ie=Oe.m;fd=Oe.O;me=Oe.h;Yb=Oe.a6;Yc=Oe.a7;Nd=Oe.u;gd=Oe.a8;ae=Oe.v;Fe=Oe.k;Wb=Oe.r;Cc=Oe.a9;Td=Oe.o;Ec=Oe.aa;Vd=Oe.ab;Lb=Oe.ac;ub=Oe.M;uc=Oe.T;dc=Oe.ad;Zb=Oe.ae;Mc=Oe.Y;$a=Oe.I;$b=Oe.n;Eb=Oe.d;kc=Oe.g;tc=Oe.af;Sc=Oe.i;Pd=Oe.f;ec=Oe.a;Xb=Oe.ag;Jb=Oe.X;Ra=Oe.S;Ga=Oe.V;ea=Oe.Q;Da=Oe.t;ta=Oe.ah;Pa=Oe.ai;Ha=Oe.aj;tb=Oe.l;Ac=Oe.ak;wb=Oe.al;ud=Oe.am;Tb=Oe.an;te=Oe.ao;cd=Oe.ap;Lc=Oe.aq;Hb=Oe.ar;Be=Oe.as;Ob=Oe.L;Gb=Oe.at;Ta=Oe.j;Y=
Oe.au;Ma=Oe.D;gb=Oe.a0;Nb=Oe.av;oc=Oe.$;Wc=Oe.aw},function(Oe){Gc=Oe.i},function(){},function(Oe){Zd=Oe.s;je=Oe.a;Bf=Oe.r;lf=Oe._;bf=Oe.P;z=Oe.H;pf=Oe.M;nf=Oe.S;De=Oe.b;Cf=Oe.c;Rf=Oe.G;Vf=Oe.F},function(){},function(Oe){dg=Oe.C;eg=Oe.a;$c=Oe.c}],execute:function(){function Oe(){}function og(Sa,ba,Fb){var va;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){return 1==Ua.nextAddress?ba.startsWith("image/")?Ua.yield(ph.fileReadAsDataURL(Sa),3):Ua.jumpTo(2):2!=Ua.nextAddress?(va=Ua.yieldResult,
Ua.return(new ph.Image({imageUrl:va,autoResize:!0,name:Sa.name}))):Ua.return(null)})}var ph=lively.FreezerRuntime.recorderFor("lively.morphic/events/html-drop-handler.js");ph.uploadItem=Oe;ph.uploadFile=og;ph.fileReadAsDataURL=function(Sa){return new Promise(function(ba,Fb){Fb=new ph.FileReader;Fb.onload=function(va){return ba(va.target.result)};Fb.readAsDataURL(Sa)})};ph.Image=Ib;ph.uploadItem=Oe;ph.uploadItem=Oe;ph.uploadFile=og;ph.uploadFile=og;var id=lively.FreezerRuntime.recorderFor("lively.ide/world-commands.js");
id.Rectangle=Sb;id.rect=xc;id.Color=ac;id.pt=Cd;id.tree=nd;id.date=Ud;id.Path=bd;id.arr=Ic;id.string=pd;id.obj=yd;id.inspect=Ne;id.easings=Pe;id.morph=Ie;id.Text=fd;id.config=me;id.KeyHandler=Yb;id.loadObjectFromPartsbinFolder=Yc;id.loadPart=Nd;id.interactivelySaveWorld=gd;id.show=Zd;id.showAndSnapToGuides=je;id.removeSnapToGuidesOf=Bf;id.LoadingIndicator=ae;id.createMorphSnapshot=Fe;id.interactivelyFreezeWorld=Gc;id.resource=Wb;id.BrowserModuleTranslationCache=Cc;id.CommentBrowser=lf;id.once=Td;
id.commands=[{name:"clear storage and reload",exec:function(){var Sa,ba;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){if(1==Fb.nextAddress)return Fb.yield($world.confirm(["Caution\n",{},"Proceeding will clear all local storage and reload the page! Make sure if you want to save your world before you continue.",{fontSize:15,fontWeight:"normal"}],{width:400}),2);if(Sa=Fb.yieldResult)localStorage.clear(),ba=new id.BrowserModuleTranslationCache("2"),ba.closeDb(),ba.deleteDb(),window.location.reload(!0);
Fb.jumpToEnd()})}},{name:"undo",exec:function(Sa){if(Sa.focusedMorph&&Sa.focusedMorph!==Sa&&Sa.focusedMorph.undoManager)return!1;Sa.env.undoManager.undo();return!0}},{name:"redo",exec:function(Sa){if(Sa.focusedMorph&&Sa.focusedMorph!==Sa&&Sa.focusedMorph.undoManager)return!1;Sa.env.undoManager.redo();return!0}},{name:"run command",handlesCount:!0,exec:function(Sa,ba,Fb){var va,Ua,mb,Ub,yc,Pc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Zc){if(1==Zc.nextAddress)return va=Sa.focusedMorph||
Sa,Ua=id.KeyHandler.generateCommandToKeybindingMap(va,!0).map(function(Qc){var Ld=Qc.prettyKeys,we=Qc.command.name,af=Qc.target.constructor.name;Ld=Ld?Ld.join(", "):"";return{isListItem:!0,value:Qc,label:[""+af,{fontSize:"80%",textStyleClasses:["v-center-text"],paddingRight:"10px"},""+we,null],annotation:[Ld,{fontSize:"80%",textStyleClasses:["truncated-text"],paddingRight:"5px",maxWidth:140}]}}),Zc.yield(Sa.filterableListPrompt("Run command",Ua,{historyId:"lively.morphic-run command",requester:va,
extent:id.pt(700,900),prompt:Sa._cachedRunCommandPrompt}),2);mb=Zc.yieldResult;Ub=mb.prompt;yc=$jscomp.makeIterator(mb.selected);Pc=yc.next().value;Sa._cachedRunCommandPrompt=Ub;return Zc.return(Pc?Pc.target.execCommand(Pc.command,ba,Fb):!0)})}},{name:"show command history",exec:function(Sa,ba){var Fb=Sa.commandHandler;ba=id.arr.sortBy(Fb.history,function(va){return-va.time}).map(function(va){return{isListItem:!0,string:Fb.printCommand(va),value:va}});$world.editListPrompt("select commands",ba,{multiSelect:!0,
requester:Sa});return!0}},{name:"show halo for focused morph",exec:function(Sa){var ba=Sa.focusedMorph;Sa.showHaloFor(ba.getWindow()||ba,Sa.firstHand.pointerId);return!0}},{name:"show morph",exec:function(Sa,ba){id.show(ba.morph,void 0===ba.loop?!1:ba.loop)}},{name:"show and snap to guides",exec:function(Sa,ba){id.showAndSnapToGuides(ba.target,ba.showGuides,ba.snap)}},{name:"remove snap to guides",exec:function(Sa,ba){id.removeSnapToGuidesOf(ba)}},{name:"copy morph",exec:function(Sa){var ba=Sa.focusedMorph;
if(!ba||ba===Sa)return $world.setStatusMessage("no morph selected"),!0;Sa=ba.getWindow()||ba;ba=Sa.copy();ba.openInWorld(Sa.globalPosition.addXY(10,10));ba.isWindow&&ba.activate();return ba}},{name:"select morph",exec:function(Sa,ba){ba=void 0===ba?{root:Sa,selectionFn:null,justReturn:!1,requester:Sa,filterFn:null,prependItems:[],prompt:null,remote:!1}:ba;var Fb,va,Ua,mb,Ub,yc,Pc,Zc,Qc,Ld,we;return $jscomp.asyncExecutePromiseGeneratorProgram(function(af){if(1==af.nextAddress)return Fb=0,va=ba.filterFn||
function(){return!0},Ua=ba.selectionFn||function(de,kf,Qe){return Sa.filterableListPrompt(de,kf,Qe)},af.yield(System.import("lively.classes/object-classes.js"),2);if(3!=af.nextAddress)return mb=af.yieldResult,Ub=mb.default,yc=id.arr.compact(id.tree.map(ba.root||Sa,function(de,kf){if(!va(de))return null;var Qe=!!Ub.lookupPackageForObject(de);return{isListItem:!0,label:[""+String(++Fb)+"\u2003".repeat(kf),{fontSize:"80%",textStyleClasses:["v-center-text"],paddingRight:"10px"},""+de,{fontWeight:Qe?"bolder":
"normal",fontStyle:Qe?"normal":"italic",fontFamily:"Inconsolata",fontSize:16},Qe?" [Object Class]":"",{opacity:.5}],value:de}},function(de){return va(de)?de.submorphs:[]})),Pc=["show halo","open object editor","open object inspector"],af.yield(Ua(ba.prompt||"Choose morph",(ba.prependItems||[]).concat(yc),{historyId:"lively.morphic-select morph",onSelection:function(de){(void 0).lastSelectionHalo&&(void 0).lastSelectionHalo.remove();de&&de.show&&Zc!=de&&((void 0).lastSelectionHalo=de.show(),Zc=de)},
selectedAction:"show halo",actions:Pc}),3);Qc=af.yieldResult;Ld=Qc.selected;we=Qc.action;if(ba.justReturn)return af.return(Ld);Ld.forEach(function(de){we===Pc[0]?Sa.showHaloFor(de):we===Pc[1]?Sa.execCommand("open object editor",{target:de}):we===Pc[2]&&Sa.execCommand("open object inspector",{target:de})});return af.return(Ld)})}},{name:"print morph(s)",exec:function(Sa){var ba,Fb,va,Ua,mb,Ub,yc,Pc,Zc,Qc,Ld,we,af,de,kf,Qe,Ke,Pf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xg){switch(xg.nextAddress){case 1:ba=
!1,Fb=[];case 2:if(ba)return yc=id.LoadingIndicator.open("printing morph..."),xg.yield(System.import("lively.2lively/client.js"),6);va=$jscomp;Ua=va.makeIterator;return xg.yield(Sa.execCommand("select morph",{justReturn:!0}),4);case 4:return mb=Ua.call(va,xg.yieldResult),Ub=mb.next().value,Fb.push(Ub),xg.yield(Sa.confirm("Select additional morphs?",{rejectLabel:"NO"}),5);case 5:ba=!xg.yieldResult;xg.jumpTo(2);break;case 6:return Pc=xg.yieldResult,Zc=Pc.default,Qc=Zc.default(),xg.yield(Qc.listPeers(!0),
7);case 7:return Ld=xg.yieldResult,we=Ld.find(function(Eg){return"pdf printer"===Eg.type}),af={ackTimeout:3E4},de=Qc,kf=de.sendToAndWait,Qe=we.id,xg.yield(Promise.all(Fb.map(function(Eg){return id.createMorphSnapshot(Eg,{addPreview:!1,testLoad:!1})})),9);case 9:return xg.yield(kf.call(de,Qe,"[PDF printer] print",xg.yieldResult,af),8);case 8:Ke=xg.yieldResult;if(Pf=Ke.error||Ke.data.error)throw Sa.showError(Pf),Pf;Sa.serveFileAsDownload(Ke.data,{fileName:Fb[0].name+(1<Fb.length?".etc":"")+".pdf",type:"application/pdf"});
yc.remove();xg.jumpToEnd()}})}},{name:"escape",exec:function(Sa,ba,Fb,va){ba=Sa.env.eventDispatcher.eventState;ba.menu&&ba.menu.remove();ba=Sa.halos();ba.forEach(function(Ua){return Ua.remove()});Sa.hands.forEach(function(Ua){return Ua.cancelGrab(!0,va)});Sa=id.arr.last(ba)&&id.arr.last(ba).target||Sa.focusedMorph||Sa;Sa.focus();Sa.isText&&Sa.selection.disableMultiSelect&&Sa.selection.disableMultiSelect();return!1}},{name:"move or resize halo target",exec:function(Sa,ba){ba=void 0===ba?{direction:"left",
offset:1,what:"move"}:ba;var Fb=Sa.halos()[0];if(!Fb||Fb.changingName||Sa.focusedMorph!=Fb)return!1;var va=ba;Sa=va.direction;ba=va.offset;va=va.what;var Ua=Fb.target;ba=ba||1;switch(Sa){case "left":Ua["move"===va?"left":"width"]-=ba;break;case "right":Ua["move"===va?"left":"width"]+=ba;break;case "up":Ua["move"===va?"top":"height"]-=ba;break;case "down":Ua["move"===va?"top":"height"]+=ba}Fb.alignWithTarget();return!0}},{name:"close halo target",exec:function(Sa){Sa=Sa.halos()[0];if(!Sa||Sa.changingName)return!1;
Sa.target.selectedMorphs?Sa.target.selectedMorphs.forEach(function(ba){return ba.abandon()}):Sa.target.abandon();return!0}},{name:"resize manually",exec:function(Sa,ba){ba=void 0===ba?{}:ba;var Fb,va,Ua,mb,Ub,yc,Pc,Zc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qc){switch(Qc.nextAddress){case 1:Ua=Sa.windowBounds();mb=Sa.bounds();Ub=Number;if(yc=ba.width){Qc.jumpTo(2);break}return Qc.yield(Sa.prompt("Enter world width",{input:Math.max(mb.width,Ua.width),requester:Sa}),3);case 3:yc=
Qc.yieldResult;case 2:Fb=Ub(yc);if("number"!==typeof Fb){Qc.jumpTo(4);break}Pc=Number;if(Zc=ba.height){Qc.jumpTo(5);break}return Qc.yield(Sa.prompt("Enter world height",{input:Math.max(mb.height,Ua.height),requester:Sa}),6);case 6:Zc=Qc.yieldResult;case 5:va=Pc(Zc);case 4:return"number"!==typeof Fb||isNaN(Fb)||"number"!==typeof va||isNaN(va)||(Sa.extent=id.pt(Fb,va)),Qc.return(!0)}})}},{name:"resize windows to fit visible world bounds",exec:function(Sa){var ba=Sa.getWindows().filter(function(mb){return!mb.minimized});
if(!ba.length)return!0;Sa=Sa.visibleBoundsExcludingTopBar();var Fb=ba.reduce(function(mb,Ub){return Ub.bounds().union(mb)},new id.Rectangle(0,0,0,0)),va=Sa.width/Fb.width,Ua=Sa.height/Fb.height;ba.forEach(function(mb){var Ub=mb.bounds();mb.setBounds(new id.Rectangle(Ub.x*va,Ub.y*Ua,Ub.width*va,Ub.height*Ua))});return!0}},{name:"window switcher",exec:function(Sa){var ba,Fb,va,Ua,mb,Ub,yc,Pc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Zc){if(1==Zc.nextAddress){if((ba=Sa.activePrompt())&&
"lively.morphic-window switcher"===ba.historyId)return ba.focus(),Zc.return(ba.get("list").execCommand("select down"));Fb=Sa.submorphs.filter(function(Qc){return Qc.isWindow}).reverse().map(function(Qc){return{isListItem:!0,string:Qc.title||String(Qc),value:Qc}});Fb.forEach(function(Qc){Qc.value.opacity=.5;Qc.value.blur=1});return Zc.yield(Sa.filterableListPrompt("Choose window",Fb,{preselect:1,requester:Sa,historyId:"lively.morphic-window switcher",onSelection:function(Qc){va&&(va.minimized=Ua,va.blur=
1,va.animate({opacity:.3,duration:200}));if(va=Qc)Qc.animate({opacity:1,duration:200}),Qc.blur=0,Ua=Qc.minimized,Qc.minimized=!1},width:1*Sa.visibleBounds().extent().x/3,itemPadding:id.Rectangle.inset(4)}),2)}Ub=mb=Zc.yieldResult;yc=$jscomp.makeIterator(Ub.selected);Pc=yc.next().value;Fb.forEach(function(Qc){Qc.value.opacity=1;Qc.value.blur=0});Pc&&(Pc.activate(),Pc.minimized=!1);return Zc.return(!0)})}},{name:"close active window or morph",exec:function(Sa){var ba=Sa.focusedMorph;if(!ba)return!0;
var Fb=ba.getWindow();Sa.undoStart("window close");Fb?Fb.close():(id.arr.last(id.arr.without(ba.ownerChain(),Sa)).remove(),(Fb=Sa.activeWindow())&&Fb.activate());Sa.undoStop("window close");return!0}},{name:"toggle minimize active window",exec:function(Sa){(Sa=Sa.activeWindow())&&Sa.toggleMinimize();return!0}},{name:"toggle minimize all windows",exec:function(Sa){(Sa=Sa.getWindows())&&Sa.map(function(ba){return ba.toggleMinimize()});return!0}},{name:"toggle minimize all except active window",exec:function(Sa){(Sa=
Sa.getWindows().filter(function(ba){return!ba.isActive()}))&&Sa.map(function(ba){return ba.toggleMinimize()});return!0}},{name:"close all except active window",exec:function(Sa){(Sa=Sa.getWindows().filter(function(ba){return!ba.isActive()}))&&Sa.map(function(ba){return ba.close()});return!0}},{name:"close all windows",exec:function(Sa){(Sa=Sa.getWindows())&&Sa.map(function(ba){return ba.close()});return!0}},{name:"open status message of focused morph",exec:function(Sa){var ba=Sa.focusedMorph;if(Sa=
$jscomp.makeIterator(ba?Sa.visibleStatusMessagesFor(ba):[]).next().value)Sa.expand(),Sa.focus();return Sa||!0}},{name:"resize active window",exec:function(Sa,ba){function Fb(){var we,af,de;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kf){if(1==kf.nextAddress)return kf.yield(Sa.filterableListPrompt("How to resize the window?","full center right left bottom top reset".split(" "),{requester:Sa}),2);we=kf.yieldResult;af=$jscomp.makeIterator(we.selected);de=af.next().value;return kf.return(de)})}
function va(we,af){switch(we){case "full":return Pc;case "col1":case "left":return Ld.withTopLeft(Pc.topLeft());case "col2":case "center":return Ld.withCenter(Pc.center());case "col3":case "right":return Ld.translatedBy(id.pt(Pc.width-Qc,0));case "top":return Pc.divide([id.rect(0,0,1,.5)])[0];case "bottom":return Pc.divide([id.rect(0,.5,1,.5)])[0];case "reset":return yc._normalBounds||id.pt(500,400).extentAsRectangle().withCenter(af.center());default:return af}}ba=void 0===ba?{how:null,window:null}:
ba;var Ua,mb,Ub,yc,Pc,Zc,Qc,Ld;return $jscomp.asyncExecutePromiseGeneratorProgram(function(we){if(1==we.nextAddress){Ua=ba;mb=Ua.window;Ub=Ua.how;yc=mb||Sa.activeWindow();if(!yc)return we.return();Pc=Sa.visibleBoundsExcludingTopBar().insetBy(15);Zc=yc.bounds();yc._normalBounds||(yc._normalBounds=Zc);Qc=Math.min(700,Math.max(1E3,Pc.width/3));Ld=Pc.withWidth(Qc);return Ub?we.jumpTo(2):we.yield(Fb(),3)}2!=we.nextAddress&&(Ub=we.yieldResult);if(!Ub)return we.return();yc.setBounds(va(Ub,Pc));"reset"===
Ub&&delete yc._normalBounds;return we.return(!0)})}},{name:"[recovery] show last object editor saves",exec:function(Sa,ba){return Sa.execCommand("[recovery] show last doits",Object.assign({},ba,{title:"logged ObjectEditor save",logAccessFn:function(){return JSON.parse(localStorage["oe helper"]).saves}}))}},{name:"[recovery] show last doits",description:"browse a list of your last doits",exec:function(Sa,ba){ba=void 0===ba?{}:ba;var Fb,va,Ua,mb,Ub,yc,Pc,Zc,Qc,Ld,we,af,de,kf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qe){if(1==
Qe.nextAddress){Fb=ba;(va=Fb.logAccessFn)||(va=function(){return JSON.parse(localStorage["lively.next-js-ide-doitlog"])});try{Ua=va()}catch(Ke){}if(!Ua)return Qe.return(Sa.inform("no log yet"));mb=id.arr.sortBy(Ua.map(function(Ke,Pf){var xg="string"===typeof Ke?Ke:Ke.source;Ke="string"===typeof Ke?Pf:Ke.time||Pf;Pf=id.date.format(new Date(Ke),"yy-mm-dd HH:MM");return{time:Ke,source:xg,printedTime:Pf}}),function(Ke){return-Ke.time});Ub=mb.map(function(Ke,Pf){return{isListItem:!0,string:"["+Ke.printedTime+
"] "+Ke.source.slice(0,100).replace(/\n/g,"").trim(),value:Ke}});return Qe.yield(Sa.filterableListPrompt("select doit code",Ub,{multiSelect:!0,requester:Sa}),2)}yc=Qe.yieldResult;Pc=yc.selected;if(Pc.length){Zc=[];Qc=$jscomp.makeIterator(Pc);for(Ld=Qc.next();!Ld.done;Ld=Qc.next())af=we=Ld.value,de=af.source,kf=af.printedTime,Zc.push("// "+kf+"\n"+de);return Qe.return(Sa.execCommand("open workspace",Object.assign({title:"logged doits",mode:"js"},ba,{content:Zc.join("\n\n")})))}return Qe.return(!0)})}},
{name:"open loading indicator",exec:function(Sa,ba){Sa={};"object"===typeof ba&&(Sa=ba,ba=Sa.label);return id.LoadingIndicator.open(ba,Sa)}},{name:"open workspace",exec:function(Sa,ba,Fb,va){ba=void 0===ba?{}:ba;var Ua,mb,Ub,yc,Pc,Zc,Qc,Ld,we,af;return $jscomp.asyncExecutePromiseGeneratorProgram(function(de){switch(de.nextAddress){case 1:if(Ua=va&&Sa.relayCommandExecutionToFocusedMorph(va))return de.return(Ua);mb=ba.language||ba.mode||"javascript";Ub={javascript:"lively.ide/js/workspace.js",shell:"lively.ide/shell/workspace.js",
html:"lively.ide/html/workspace.js",py:"lively.ide/py/workspace.js",md:"lively.ide/md/workspace.js",sql:"lively.ide/sql/workspace.js",css:"lively.ide/css/workspace.js",less:"lively.ide/css/less/workspace.js",text:null};yc=Object.keys(id.config.ide.modes.aliases).reduce(function(kf,Qe){var Ke={};return Object.assign(kf,(Ke[id.config.ide.modes.aliases[Qe]]=Qe,Ke))},{});if(!ba.askForMode){de.jumpTo(2);break}Pc=Object.keys(Ub).concat("javascript console");return de.yield(Sa.filterableListPrompt("Open workspace for...",
Pc),3);case 3:if(Zc=de.yieldResult,Qc=$jscomp.makeIterator(Zc.selected),mb=Qc.next().value,!mb)return de.return(!0);case 2:if("javascript console"===mb)return de.return(Sa.execCommand("open console",ba));ba=Object.assign({content:""},ba,{mode:mb,language:mb});Ld=Ub[ba.language]||Ub[yc[ba.language]];return"text"!==mb&&Ld?de.yield(System.import(Ld),4):de.return(Sa.execCommand("open text window",Object.assign({},id.config.codeEditor.modes.text,{},ba)));case 4:return we=de.yieldResult,af=we.default,de.return((new af({title:ba.title||
ba.language+" workspace",center:Sa.center,content:ba.content,target:ba.target,systemInterface:ba.systemInterface||ba.backend})).activate())}})}},{name:"open console",exec:function(Sa,ba){var Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){if(1==va.nextAddress)return va.yield(id.loadObjectFromPartsbinFolder("Console"),2);Fb=va.yieldResult;return va.return(Fb.openInWorldNearHand())})}},{name:"open shell workspace",exec:function(Sa,ba){return Sa.execCommand("open workspace",Object.assign({},
ba,{language:"shell"}))}},{name:"open javascript workspace",exec:function(Sa,ba){return Sa.execCommand("open workspace",Object.assign({},ba,{language:"javascript"}))}},{name:"open shell terminal",exec:function(Sa,ba){var Fb,va;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){if(1==Ua.nextAddress)return Ua.yield(System.import("lively.ide/shell/terminal.js"),2);Fb=Ua.yieldResult;va=Fb.default;return Ua.return(va.open(ba).openInWorldNearHand())})}},{name:"open text window",exec:function(Sa,
ba){var Fb=ba=void 0===ba?{}:ba,va=Fb.title,Ua=Fb.extent,mb=Fb.content,Ub=Fb.mode,yc=Fb.name;Fb=Fb.rangesAndStyles;va=va||"text window";mb=mb||"";Ua=Ua||id.pt(500,400);yc=yc||"text workspace";mb="string"===typeof mb?[mb,null]:mb;ba=new id.Text(Object.assign({padding:id.Rectangle.inset(3)},id.obj.dissoc(ba,["title","content"]),{textAndAttributes:mb,clipMode:"auto",name:yc,extent:Ua}));Fb&&ba.setTextAttributesWithSortedRanges(Fb);Ub&&ba.changeEditorMode(Ub);return Sa.openInWindow(ba,{title:va}).activate()}},
{name:"merge and open in window",exec:function(Sa,ba){ba=void 0===ba?{a:"",b:"",format:null,extent:id.pt(500,600)}:ba;var Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){if(1==va.nextAddress)return va.yield(id.loadObjectFromPartsbinFolder("text merger"),2);Fb=va.yieldResult;return va.return(Fb.targetMorph.open(ba.a,ba.b,ba))})}},{name:"diff and open in window",exec:function(Sa,ba){var Fb,va,Ua;function mb(af,de,kf){var Qe,Ke,Pf,xg,Eg,$g,Kg,Qg,Hi,Mi,Kf,Ui,Rg,ah;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ci){if(1==
ci.nextAddress){Qe=kf;Ke=Qe.format;Pf=null;if("patch"!==Ke)return we=Ld[Ke](af,de,kf),xg=id.arr.flatmap(we,function(rf){var aj=rf.added;return[rf.value,rf.removed?{fontWeight:"normal",textDecoration:"line-through",fontColor:id.Color.red}:aj?{fontWeight:"bold",textDecoration:"",fontColor:id.Color.green}:{fontWeight:"normal",textDecoration:"",fontColor:id.Color.darkGray}]}),ci.jumpTo(2);Eg=kf;$g=Eg.headerA;Kg=Eg.headerB;Qg=Eg.filenameA;Hi=Eg.filenameB;Mi=Eg.context;xg=[Ld.createTwoFilesPatch(Qg||"a",
Hi||"b",af,de,$g,Kg,"number"===typeof Mi?{context:Mi}:void 0),{}];return ci.yield(System.import("lively.ide/diff/editor-plugin.js"),3)}2!=ci.nextAddress&&(Kf=ci.yieldResult,Ui=Kf.default,Pf=new Ui);Rg=Sa.execCommand("open text window",kf);ah=Rg.targetMorph;Rg.extent=Qc||id.pt(300,200).maxPt(ah.textBounds().extent());ah.textAndAttributes=xg;Pf&&ah.addPlugin(Pf);return ci.return(ah)})}ba=void 0===ba?{a:"",b:"",format:null,extent:id.pt(500,600)}:ba;var Ub,yc,Pc,Zc,Qc,Ld,we;return $jscomp.asyncExecutePromiseGeneratorProgram(function(af){if(1==
af.nextAddress){Ub=ba;yc=Ub.a;Pc=Ub.b;Zc=Ub.format;Qc=Ub.extent;if(Zc)yc=String(yc),Pc=String(Pc);else{a:{var de=yc,kf=Pc;if(id.obj.isPrimitive(de)||de instanceof RegExp||id.obj.isPrimitive(kf)||kf instanceof RegExp)de=String(de),kf=String(kf);if("string"!==typeof de||"string"!==typeof kf)try{JSON.stringify(de);JSON.stringify(kf);Fb="diffJson";va=de;Ua=kf;break a}catch(Qe){de=String(de),kf=String(kf)}Fb="diffLines";va=de;Ua=kf}yc=va;Pc=Ua;Zc=Fb}return af.yield(System.import("https://jspm.dev/diff"),
2)}if(3!=af.nextAddress)return Ld=af.yieldResult,af.yield(mb(yc,Pc,Object.assign({fontFamily:"monospace"},ba,{format:Zc})),3);we=af.yieldResult;return af.return(we)})}},{name:"merge workspaces",exec:function(Sa,ba){return Sa.execCommand("diff workspace",Object.assign({},ba,{merge:!0}))}},{name:"diff workspaces",exec:function(Sa,ba){function Fb(Qc,Ld){var we=Qc.pluginFind(function(de){return de.evalEnvironment});we=we&&we.evalEnvironment.targetModule||"no file";var af=Ld.pluginFind(function(de){return de.evalEnvironment});
return Sa.execCommand("diff and open in window",{a:Qc.textString,b:Ld.textString,filenameA:we,filenameB:af&&af.evalEnvironment.targetModule||"no file"})}function va(Qc,Ld){var we;return $jscomp.asyncExecutePromiseGeneratorProgram(function(af){if(1==af.nextAddress)return af.yield(id.loadObjectFromPartsbinFolder("text merger"),2);we=af.yieldResult;return af.return(we.targetMorph.open(Qc.textString,Ld.textString))})}function Ua(Qc,Ld){var we,af,de,kf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qe){if(1==
Qe.nextAddress)return we=Qc.map(function(Ke){return{isListItem:!0,value:Ke,string:Ke.name||String(Ke)}}),Qe.yield(Sa.filterableListPrompt("choose text: ",we,{onSelection:function(Ke){Ke&&Ke.show()}}),2);af=Qe.yieldResult;de=$jscomp.makeIterator(af.selected);kf=de.next().value;return Qe.return(kf)})}ba=void 0===ba?{}:ba;var mb,Ub,yc,Pc,Zc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qc){switch(Qc.nextAddress){case 1:mb=ba;Ub=mb.editor1;yc=mb.editor2;Pc=mb.merge;Ub&&yc||(Zc=Sa.withAllSubmorphsSelect(function(Ld){return Ld.isText&&
!Ld.isInputLine&&!Ld.isUsedAsEpiMorph()}).reverse());if(Ub){Qc.jumpTo(2);break}return Qc.yield(Ua(Zc),3);case 3:Ub=Qc.yieldResult;case 2:if(!Ub)return Qc.return(Sa.setStatusMessage("Canceled"));if(yc){Qc.jumpTo(4);break}return Qc.yield(Ua(id.arr.without(Zc,Ub)),5);case 5:yc=Qc.yieldResult;case 4:return yc?Qc.return(Pc?va(Ub,yc):Fb(Ub,yc)):Qc.return(Sa.setStatusMessage("Canceled"))}})}},{name:"search workspaces",exec:function(){function Sa(Qc,Ld){return Qc.map(function(we){var af=we.world()?we.getWindow():
$world.withAllSubmorphsDetect(function(Ke){return Ke.isWindow&&Ke.targetMorph===Ie}),de=0,kf=id.string.lines(we.textString).find(function(Ke,Pf){Ke=Ke.toLowerCase();de=Pf;return Ld.every(function(xg){return Ke.includes(xg)})}),Qe=af?af.title:we.toString();return kf?{isListItem:!0,string:Qe+" | "+kf,value:{window:af,morph:we,row:de}}:null}).filter(Boolean)}function ba(Qc){return $world.withAllSubmorphsDo(function(Ld){Ld.isWindow&&Ld.minimized&&Ld.targetMorph&&Ld.targetMorph.isText&&(Ld=Ld.targetMorph);
if(!Ld.textString||!Ld.isText||Ld.isUsedAsEpiMorph())return null;var we=Ld.textString.toLowerCase();return Qc.every(function(af){return we.includes(af)})?Ld:null}).filter(Boolean)}var Fb=this,va,Ua,mb,Ub,yc,Pc,Zc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qc){if(1==Qc.nextAddress)return Qc.yield($world.filterableListPrompt("search workspaces",[],{historyId:"lively.morphic-ide-search-workspaces-hist",customize:function(Ld){Ld.getSubmorphNamed("list").updateFilter=function(){var we=
this.parseInput();if(!(3>we.input.length)){var af=ba(we.lowercasedTokens);this.listMorph.items=Sa(af,we.lowercasedTokens)}}}}),2);va=Qc.yieldResult;Ua=$jscomp.makeIterator(va.selected);return(mb=Ua.next().value)?(Ub=mb,yc=Ub.morph,Pc=Ub.window,Zc=Ub.row,Pc&&(Pc.minimized&&Pc.toggleMinimize(),Pc.activate()),(Pc||yc).show(),Fb.cursorPosition={row:Zc,column:0},Qc.return(yc)):Qc.return(null)})}},{name:"open PartsBin",exec:function(Sa){var ba,Fb,va,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(mb){if(1==
mb.nextAddress)return ba=id.LoadingIndicator.open("Loading Partsbin..."),mb.yield(System.import("lively.morphic/partsbin.js"),2);if(3!=mb.nextAddress)return Fb=mb.yieldResult,va=Fb.loadPart,mb.yield(va("PartsBin"),3);Ua=mb.yieldResult;Ua.openInWorldNearHand();Ua.targetMorph.selectedCategory="*basics*";Ua.focus();ba.remove();Ua.getWindow().activate();return mb.return(Ua)})}},{name:"browse and load component",exec:function(Sa){var ba,Fb,va,Ua,mb,Ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yc){switch(yc.nextAddress){case 1:ba=
id.LoadingIndicator.open("loading component browser");if(Sa._componentsBrowser){yc.jumpTo(2);break}return yc.yield(ba.whenRendered(),2);case 2:if(Fb=Sa._componentsBrowser){yc.jumpTo(4);break}Ua=va=Sa;return yc.yield(id.resource("part://SystemDialogs/master component browser").read(),5);case 5:Fb=Ua._componentsBrowser=yc.yieldResult;case 4:return mb=Fb,ba.remove(),yc.yield(mb.activate(),6);case 6:(Ub=yc.yieldResult)&&!Ub.world()&&Ub.openInWorld(),yc.jumpToEnd()}})}},{name:"load object from PartsBin",
exec:function(Sa,ba){ba=void 0===ba?{}:ba;var Fb,va,Ua,mb,Ub,yc,Pc,Zc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qc){switch(Qc.nextAddress){case 1:return va=ba,Ua=va.name,mb=void 0===va.open?!0:va.open,Ua?Qc.yield(System.import("lively.morphic/partsbin.js"),6):Qc.yield(System.import("lively.morphic/partsbin.js"),4);case 4:return Ub=Qc.yieldResult,yc=Ub.interactivelyLoadObjectFromPartsBinFolder,Qc.yield(yc(),5);case 5:Fb=Qc.yieldResult;Qc.jumpTo(3);break;case 6:return Pc=Qc.yieldResult,
Zc=Pc.loadObjectFromPartsbinFolder,Qc.yield(Zc(Ua),7);case 7:Fb=Qc.yieldResult;case 3:return Fb&&mb&&Fb.openInWorldNearHand(),Qc.return(Fb)}})}},{name:"open object drawer",exec:function(Sa){var ba,Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){if(1==va.nextAddress)return va.yield(System.import("lively.components/object-drawer.js"),2);ba=va.yieldResult;Fb=ba.default;return va.return((new Fb).openInWorldNearHand())})}},{name:"open object editor",exec:function(Sa,ba){ba=void 0===
ba?{target:null,selectedClass:null,selectedMethod:null,evalEnvironment:null}:ba;var Fb,va,Ua,mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ub){if(1==Ub.nextAddress){if(!ba.target)return Sa.setStatusMessage("No target for ObjectEditor"),Ub.return(null);Fb=ba.loadingIndicator=id.LoadingIndicator.open("Open Object Editor...");return Ub.yield(System.import("lively.ide/js/objecteditor/index.js"),2)}if(3!=Ub.nextAddress)return va=Ub.yieldResult,Ua=va.ObjectEditor,Ub.yield(Ua.open(ba),3);
mb=Ub.yieldResult;Fb.remove();return Ub.return(mb)})}},{name:"open object inspector",exec:function(Sa,ba){ba=void 0===ba?{target:null}:ba;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){return ba.target?Fb.return(id.inspect(ba.target)):(Sa.setStatusMessage("no target for Inspector"),Fb.return(null))})}},{name:"inspect server",exec:function(Sa){var ba,Fb,va,Ua,mb,Ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yc){switch(yc.nextAddress){case 1:return yc.yield(System.import("lively.ide/js/inspector.js"),
2);case 2:return ba=yc.yieldResult,Fb=ba.default,yc.yield(System.import("lively-system-interface"),3);case 3:return va=yc.yieldResult,Ua=va.serverInterfaceFor,mb=Ua(System.baseURL+"eval"),Ub={format:"esm",context:"global",targetModule:"lively://lively.next-workspace/world",sourceURL:"inspect-server_"+Date.now(),systemInterface:mb},yc.yield(mb.runEval('\n           import LivelyServer from "lively.server/server.js";\n           let server = LivelyServer.servers.values().next().value;\n        ',Ub),
4);case 4:Fb.openInWindow({remoteTarget:{code:"server",evalEnvironment:Ub}}),yc.jumpToEnd()}})}},{name:"open scene graph inspector",exec:function(Sa,ba){ba=void 0===ba?{target:null}:ba;var Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){if(1==va.nextAddress)return va.yield(id.loadObjectFromPartsbinFolder("scene graph inspector"),2);Fb=va.yieldResult;Fb.targetMorph=ba.target||Sa;return va.return(Fb.openInWindow({title:"morph graph"}))})}},{name:"open browser",progressIndicator:"opening browser...",
exec:function(Sa,ba,Fb,va){ba=void 0===ba?{packageName:"lively.morphic",moduleName:"morph.js"}:ba;var Ua,mb,Ub,yc,Pc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Zc){switch(Zc.nextAddress){case 1:return(Ua=va&&Sa.relayCommandExecutionToFocusedMorph(va))?Zc.return(Ua):Zc.yield(System.import("lively.ide/js/browser/index.js"),2);case 2:return mb=Zc.yieldResult,Ub=mb.default,ba?(Pc=id.obj.select(ba,["packageName","moduleName","textPosition","codeEntity","systemInterface"]),Zc.yield(Ub.browse(Pc,
{extent:id.pt(700,600)}),6)):Zc.yield(Ub.open(),5);case 5:yc=Zc.yieldResult;Zc.jumpTo(4);break;case 6:yc=Zc.yieldResult;case 4:return yc.getWindow().activate(),Zc.return(yc)}})}},{name:"choose and browse package resources",progressIndicator:"browsing resources...",exec:function(Sa,ba,Fb,va){ba=void 0===ba?{browser:null,systemInterface:null}:ba;var Ua,mb,Ub,yc,Pc,Zc,Qc,Ld,we,af,de,kf,Qe,Ke,Pf,xg,Eg,$g,Kg,Qg,Hi,Mi,Kf,Ui;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rg){switch(Rg.nextAddress){case 1:if(Ua=
va&&Sa.relayCommandExecutionToFocusedMorph(va))return Rg.return(Ua);mb=(mb=ba.browser||Sa.focusedMorph&&Sa.focusedMorph.ownerChain().find(function(ah){return ah.isBrowser}))&&mb.isBrowser?mb.getWindow():null;return Rg.yield(System.import("lively-system-interface"),2);case 2:return Ub=Rg.yieldResult,yc=Ub.localInterface,Pc=ba&&ba.systemInterface?ba.systemInterface:mb?mb.systemInterface:yc,Rg.yield(Pc.getPackages({excluded:id.config.ide.js.ignoredPackages}),3);case 3:Zc=Rg.yieldResult,Qc=[],Ld={},we=
$jscomp.makeIterator(Zc),af=we.next();case 4:if(af.done)return Rg.yield(Sa.filterableListPrompt("Choose module to open",Qc,{historyId:"lively.morphic-choose and browse package resources",requester:mb,width:700,multiSelect:!0,fuzzy:"value.shortName"}),8);Ld.$jscomp$loop$prop$p$2826=af.value;Ld.$jscomp$loop$prop$excluded$2825=(id.Path("lively.ide.exclude").get(Ld.$jscomp$loop$prop$p$2826)||[]).map(function(ah){return ah.includes("*")?new RegExp(ah.replace(/\*/g,".*")):ah});Ld.$jscomp$loop$prop$excluded$2825.push(".git",
"node_modules",".module_cache");de=Qc.push;kf=de.apply;Qe=Qc;Ke=$jscomp;Pf=Ke.arrayFromIterable;xg=function(ah){return function(ci){return{isListItem:!0,string:"["+ah.$jscomp$loop$prop$p$2826.name+"] "+ci.nameInPackage+(ci.isLoaded?"":" [not loaded]"),value:ci}}}(Ld);Eg=function(ah){return function(ci){var rf=ci.url;return!rf.endsWith("/")&&!ah.$jscomp$loop$prop$excluded$2825.some(function(aj){return aj instanceof RegExp?aj.test(rf):rf.includes(aj)})}}(Ld);return Rg.yield(Pc.resourcesOfPackage(Ld.$jscomp$loop$prop$p$2826,
Ld.$jscomp$loop$prop$excluded$2825),7);case 7:kf.call(de,Qe,Pf.call(Ke,Rg.yieldResult.filter(Eg).sort(function(ah,ci){return ah.isLoaded&&!ci.isLoaded?-1:!ah.isLoaded&&ci.isLoaded?1:ah.nameInPackage.toLowerCase()<ci.nameInPackage.toLowerCase()?-1:ah.nameInPackage.toLowerCase()==ci.nameInPackage.toLowerCase()?0:1}).map(xg)));Ld={$jscomp$loop$prop$excluded$2825:Ld.$jscomp$loop$prop$excluded$2825,$jscomp$loop$prop$p$2826:Ld.$jscomp$loop$prop$p$2826};af=we.next();Rg.jumpTo(4);break;case 8:return $g=Rg.yieldResult,
Kg=$g.selected,Qg=$jscomp.makeIterator(id.arr.partition(Kg,function(ah){return ah.url.match(/\.js(on)?/)})),Hi=Qg.next().value,Mi=Qg.next().value,Rg.yield(System.import("lively.ide/js/browser/index.js"),9);case 9:return Kf=Rg.yieldResult,Ui=Kf.default,Rg.yield(Promise.all(Hi.map(function(ah){return Ui.browse({packageName:ah.package,moduleName:ah.url},mb,Pc).then(function(ci){return ci.activate()})})),10);case 10:if(!Mi.length){Rg.jumpTo(11);break}return Rg.yield(Promise.all(Mi.map(function(ah){return Sa.execCommand("open file",
{url:ah.url})})),11);case 11:return Rg.return(!0)}})}},{name:"choose and browse module",progressIndicator:"browsing module...",handlesCount:!0,exec:function(Sa,ba,Fb){ba=void 0===ba?{browser:void 0,systemInterface:void 0}:ba;var va,Ua,mb,Ub,yc,Pc,Zc,Qc,Ld,we,af,de,kf,Qe,Ke,Pf,xg,Eg,$g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Kg){switch(Kg.nextAddress){case 1:if(!ba.browser&&(Ua=(va=Sa.focusedMorph)&&va.getWindow())&&Ua.targetMorph&&Ua.targetMorph.isFileBrowser)return Kg.return(Ua.targetMorph.execCommand("find file and select",
ba,Fb));mb=ba.browser||va&&va.ownerChain().find(function(Qg){return Qg.isBrowser});return Kg.yield(System.import("lively.ide/js/browser/index.js"),2);case 2:return Ub=Kg.yieldResult,yc=Ub.default,Kg.yield(System.import("lively-system-interface"),3);case 3:return Pc=Kg.yieldResult,Zc=Pc.localInterface,Qc=ba&&ba.systemInterface?ba.systemInterface:mb?mb.systemInterface:Zc,Ld="local"==Qc.name?"":" on ["+id.string.truncate(Qc.name,35,"...")+"]",Kg.yield(Qc.getPackages(),4);case 4:we=Kg.yieldResult;af=
[];de=$jscomp.makeIterator(we);for(kf=de.next();!kf.done;kf=de.next())for(Qe=kf.value,Ke=id.Path("lively.ide.exclude").get(Qe)||[],Ke=Ke.map(function(Qg){return Qg.includes("*")?new RegExp(Qg.replace(/\*/g,".*")):Qg}),Pf={},xg=$jscomp.makeIterator(Qe.modules),Eg=xg.next();!Eg.done;Pf={$jscomp$loop$prop$m$2828:Pf.$jscomp$loop$prop$m$2828},Eg=xg.next())Pf.$jscomp$loop$prop$m$2828=Eg.value,Ke.some(function(Qg){return function(Hi){return Hi instanceof RegExp?Hi.test(Qg.$jscomp$loop$prop$m$2828.name):
Qg.$jscomp$loop$prop$m$2828.name.includes(Hi)}}(Pf))||($g=Qc.shortModuleName(Pf.$jscomp$loop$prop$m$2828.name,Qe),af.push({isListItem:!0,string:"["+Qe.name+"] "+$g,value:{package:Qe,module:Pf.$jscomp$loop$prop$m$2828,shortName:$g}}));af=id.arr.sortBy(af,function(Qg){return Qg.string});(function(){var Qg,Hi,Mi,Kf,Ui,Rg,ah,ci,rf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(aj){switch(aj.nextAddress){case 1:return Qg=mb||va,aj.yield(Sa.filterableListPrompt("Choose module to open"+Ld,af,
{historyId:"lively.morphic-choose and browse module",requester:Qg,height:Math.min(Qg.height,700),width:500,multiSelect:!0,listFontColor:"white",fuzzy:"value.shortName"}),2);case 2:Hi=aj.yieldResult,Mi=Hi.selected,Kf=0;case 3:if(!(Kf<Mi.length)){aj.jumpTo(0);break}Ui=Mi[Kf];Rg=Ui.package;ah=Ui.shortName;ci={packageName:Rg.name,moduleName:ah};return aj.yield(yc.browse(ci,0===Kf?mb:void 0,Qc),6);case 6:rf=aj.yieldResult,rf.moveBy(id.pt(20*Kf,20*Kf)),rf.getWindow().activate(),Kf++,aj.jumpTo(3)}})})();
return Kg.return(!0)}})}},{name:"open code search",progressIndicator:"opening code search...",exec:function(Sa,ba){ba=void 0===ba?{browser:null,systemInterface:null,input:null}:ba;var Fb,va,Ua,mb,Ub,yc,Pc,Zc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qc){if(1==Qc.nextAddress){Fb=Sa.focusedMorph?Sa.focusedMorph.ownerChain():[];va=ba.browser||Fb.find(function(Ld){return Ld.isBrowser});Ua=id.LoadingIndicator.open("loading code search");if(va&&va.isBrowser){if(va.state.associatedSearchPanel)return Qc.return(va.state.associatedSearchPanel.getWindow().activate())}else va=
null;return Qc.yield(System.import("lively-system-interface"),2)}if(3!=Qc.nextAddress)return mb=Qc.yieldResult,Ub=mb.localInterface,yc=ba.systemInterface||va&&va.systemInterface,yc||(yc=(Pc=Fb.find(function(Ld){return Ld.isText&&Ld.editorPlugin&&Ld.editorPlugin.isJSEditorPlugin}))?Pc.editorPlugin.systemInterface():Ub),Qc.yield(id.resource("part://SystemIDE/code search").read(),3);Zc=Qc.yieldResult;Object.assign(Zc,{browser:va,input:ba.input,systemInterface:yc});Zc.openInWindow();Zc.focus();Ua.remove();
va&&(va.state.associatedSearchPanel=Zc);return Qc.return(Zc)})}},{name:"open grep search",progressIndicator:"opening code search...",exec:function(Sa,ba){var Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){if(1==va.nextAddress)return va.yield(id.loadObjectFromPartsbinFolder("grep search"),2);Fb=va.yieldResult;return va.return(Fb.openInWorldNearHand(Sa).activate())})}},{name:"open test runner",progressIndicator:"opening test runner...",exec:function(Sa){var ba,Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){return 1==
va.nextAddress?va.yield(System.import("lively.ide/test-runner.js"),2):3!=va.nextAddress?(ba=va.yieldResult,Fb=ba.default,va.yield(Fb.open(),3)):va.return(va.yieldResult)})}},{name:"open file browser",progressIndicator:"opening file browser...",exec:function(Sa,ba){ba=void 0===ba?{}:ba;var Fb,va,Ua,mb,Ub,yc,Pc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Zc){if(1==Zc.nextAddress)return Zc.yield(System.import("lively.ide/http-file-browser.js"),2);Fb=Zc.yieldResult;va=Fb.default;Ua=ba;
mb=Ua.location;Ub=Ua.url;Pc=(yc=Ua.file)?va.forFile(yc,mb):va.forLocation(Ub||mb||document.location.origin);return Zc.return(Sa.openInWindow(Pc).activate())})}},{name:"open file",progressIndicator:"opening file...",exec:function(Sa,ba){ba=void 0===ba?{url:null,lineNumber:null,reuse:!1}:ba;var Fb,va,Ua,mb,Ub,yc,Pc,Zc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qc){switch(Qc.nextAddress){case 1:Fb=ba;va=Fb.url;Ua=Fb.lineNumber;mb=Fb.reuse;Ub=Sa.commandHandler.progressIndicator;if(va){Qc.jumpTo(2);
break}Ub.visible=!1;return Qc.yield(Sa.prompt("Enter file location",{historyId:"lively.morphic-text editor url",useLastInput:!0}),3);case 3:va=Qc.yieldResult,Ub.visible=!0;case 2:if(mb&&(Sa.getWindows().slice(-2),yc=id.arr.findAndGet(Sa.getWindows(),function(Ld){return(Ld=Ld.targetMorph)&&Ld.isTextEditor&&Ld.location.split(":")[0]===va?Ld:null})))return"number"===typeof Ua&&(yc.lineNumber=Ua),Qc.return(yc.getWindow().activate());Ua&&(va+=":"+Ua);return Qc.yield(System.import("lively.ide/text-editor.js"),
4);case 4:return Pc=Qc.yieldResult,Zc=Pc.default,Qc.return(va?Zc.openURL(va,id.obj.dissoc(ba,["url"])):null)}})}},{name:"open file for EDITOR",exec:function(Sa,ba){ba=void 0===ba?{url:null,lineNumber:null}:ba;var Fb,va,Ua,mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ub){return 1==Ub.nextAddress?Ub.yield(System.import("lively.ide/text-editor.js"),2):3!=Ub.nextAddress?(Fb=Ub.yieldResult,va=Fb.default,Ua=ba,mb=Ua.url,Ub.yield(va.openAsEDITOR(mb,{}),3)):Ub.return(Ub.yieldResult)})}},
{name:"open subserver controller",exec:function(Sa,ba){var Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){if(1==va.nextAddress)return va.yield(id.loadPart("subserver controller"),2);Fb=va.yieldResult;return va.return(Fb.openInWorld())})}},{name:"[lively.installer] publish new version of a package",exec:function(Sa){var ba,Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){switch(va.nextAddress){case 1:return va.yield(lively.modules.registerPackage(document.location.origin+
"/lively.installer"),2);case 2:return va.yield(System.import("lively.installer/packages/publish-new-package-version.js"),3);case 3:return ba=va.yieldResult,Fb=ba.default,va.yield(Fb(),4);case 4:return va.return(!0)}})}},{name:"report a bug",exec:function(Sa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ba){window.open("https://github.com/LivelyKernel/lively.next/issues/new","_blank");return ba.return(!0)})}},{name:"fix font metric",exec:function(Sa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ba){Sa.env.fontMetric.reset();
Sa.withAllSubmorphsDo(function(Fb){return Fb.isText&&Fb.textLayout&&Fb.textLayout.reset()});return ba.return(!0)})}},{name:"delete change history",exec:function(Sa){var ba=Sa.env,Fb=ba.printStatus();ba.deleteHistory();Sa.setStatusMessage(Fb);Sa._componentsBrowser&&Sa._componentsBrowser.reset();return!0}},{name:"install global inspect and show",exec:function(Sa){window.show=id.show;window.inspect=id.inspect;Sa.setStatusMessage("inspect() and show() are now globally available");return!0}},{name:"save world",
exec:function(Sa,ba,Fb,va){var Ua,mb,Ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yc){if(1==yc.nextAddress){if(Ua=va&&Sa.relayCommandExecutionToFocusedMorph(va))return yc.return(Ua);ba=Object.assign({confirmOverwrite:!0,showSaveDialog:!0},ba);mb=Sa.focusedMorph;return yc.yield(id.interactivelySaveWorld(Sa,ba),2)}Ub=yc.yieldResult;mb&&mb.focus();return yc.return(Ub)})}},{name:"freeze world",exec:function(Sa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ba){return ba.yield(id.interactivelyFreezeWorld(Sa),
0)})}},{name:"save this world",exec:function(Sa,ba,Fb,va){return Sa.execCommand("save world",Object.assign({confirmOverwrite:!0},ba,{showSaveDialog:!1}))}},{name:"load world",exec:function(Sa,ba){ba=void 0===ba?{}:ba;var Fb,va,Ua,mb,Ub,yc,Pc,Zc,Qc,Ld,we;return $jscomp.asyncExecutePromiseGeneratorProgram(function(af){switch(af.nextAddress){case 1:Fb=ba;va=Fb.id;Ua=Fb.commit;mb=Fb.name;Ub=Fb.ref;yc=Fb.world;Pc=Sa.constructor;if(yc)return af.return(Pc.loadWorld(yc,Sa));if(va||Ua)return af.return(Pc.loadFromCommit(va||
Ua,Sa));if(mb)return af.return(Pc.loadFromDB(mb,Ub,Sa));Zc=id.LoadingIndicator.open("loading project browser...");return af.yield(Zc.whenRendered(),2);case 2:Qc=id.morph({fill:id.Color.black.withA(.5),extent:Sa.extent,name:"dark overlay",opacity:0,reactsToPointer:!1,renderOnGPU:!0,halosEnabled:!1});Qc.openInWorld(id.pt(0,0));Qc.animate({opacity:1,duration:300});if(Ld=Sa.get("a project browser")){af.jumpTo(3);break}return af.yield(id.resource("part://partial freezing/project browser").read(),4);case 4:Ld=
af.yieldResult;case 3:return we=Ld,we.name="a project browser",we.hasFixedPosition=!0,we.epiMorph=!0,we.bringToFront().alignInWorld(Sa),we.update(),we.focus(),id.once(we,"remove",function(){return Qc.animate({opacity:0}).then(function(){return Qc.remove()})}),Zc.remove(),af.return(we)}})}},{name:"add external package dependency to object",exec:function(Sa,ba){ba=void 0===ba?{}:ba;var Fb,va,Ua,mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ub){if(1==Ub.nextAddress)return Fb=ba.target||
Sa,va=Fb.metadata&&Fb.metadata.externalPackages||[],Ub.yield(Sa.editListPrompt("modify package dependencies of "+Fb,va),2);Ua=Ub.yieldResult;mb=Ua.list;if(!mb)return Ub.return();mb.length?(Fb.metadata||(Fb.metadata={}),Fb.metadata.externalPackages=mb):Fb.metadata&&delete Fb.metadata.externalPackages;return Ub.return(!0)})}},{name:"toggle comment browser",exec:function(Sa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ba){id.CommentBrowser.toggle();ba.jumpToEnd()})}}];var cb=id.commands;
id.default=cb;var Va=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js");Va.RadialGradient=Ec;Va.Point=Vd;Va.pt=Cd;Va.rect=xc;Va.Color=ac;Va.LinearGradient=Lb;Va.Morph=ub;Va.Tooltip=uc;Va.Image=Ib;Va.VerticalLayout=dc;Va.GridLayout=Zb;Va.Text=fd;Va.Ellipse=Mc;Va.morph=Ie;Va.Icon=$a;Va.num=$b;Va.arr=Ic;Va.connect=Eb;Va.signal=kc;Va.Popover=bf;Va.ColorPalette=dg;Va.ColorPicker=eg;Va.colorWidgets=$c;Va.joinPath=tc;Va.WHEEL_URL=Va.joinPath(System.baseURL,"/lively.ide/assets/color-wheel.png");
(function(Sa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Fb=ba.hasOwnProperty("GradientTypeSelector")&&"function"===typeof ba.GradientTypeSelector?ba.GradientTypeSelector:ba.GradientTypeSelector=function(va){va&&va[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Sc(Fb,Sa,[{key:"defaultLinearGradient",get:function(){return new Va.LinearGradient({stops:[{color:Va.Color.white,offset:0},{color:Va.Color.black,
offset:1}]})}},{key:"defaultRadialGradient",get:function(){return new Va.RadialGradient({stops:[{color:Va.Color.white,offset:0},{color:Va.Color.black,offset:1}],focus:Va.pt(.5,.5),bounds:Va.rect(0,0,30,30)})}},{key:"update",value:function(va){var Ua=$jscomp.makeIterator(this.submorphs),mb=Ua.next().value;Ua=Ua.next().value;mb.borderColor=Ua.borderColor=Va.Color.gray.darker();va instanceof Va.RadialGradient?mb.borderColor=Va.Color.orange:va instanceof Va.LinearGradient&&(Ua.borderColor=Va.Color.orange)}}],
[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientTypeSelector"}},{key:"properties",get:function(){return{fill:{defaultValue:Va.Color.transparent},layout:{initialize:function(){this.extent=Va.pt(180,40);this.layout=new Va.GridLayout({grid:[[null,"radialMode",null,"linearMode",null]],autoAssign:!1,fitToCell:!1})}},submorphs:{initialize:function(){var va=this,Ua=$jscomp.makeIterator(this.submorphs=[Va.morph({type:"ellipse",master:{auto:"styleguide://SystemWidgets/gradient mode/deselected"},
name:"radialMode",fill:this.defaultRadialGradient}),Va.morph({type:"ellipse",master:{auto:"styleguide://SystemWidgets/gradient mode/deselected"},name:"linearMode",fill:this.defaultLinearGradient})]),mb=Ua.next().value;Ua=Ua.next().value;Va.connect(mb,"onMouseDown",function(){return Va.signal(va,"radial")});Va.connect(Ua,"onMouseDown",function(){return Va.signal(va,"linear")})}}}}}],ba,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:660,end:2566})})(Va.Morph);var cc=function(Sa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Fb=ba.hasOwnProperty("GradientEditor")&&"function"===typeof ba.GradientEditor?ba.GradientEditor:ba.GradientEditor=function(va){va&&va[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return Sc(Fb,Sa,[{key:"remove",value:function(){Sc._get(Object.getPrototypeOf(Fb.prototype),"remove",this).call(this);this.gradientHandle&&this.gradientHandle.remove()}},{key:"selectRadialGradient",value:function(){var va=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){return 1==Ua.nextAddress?(va.get("linearMode").borderColor=Va.Color.gray.darker(),va.get("radialMode").borderColor=Va.Color.orange,Ua.yield(va.applyGradient(Va.RadialGradient),2)):Ua.yield(va.updateGradientHandles(),
0)})}},{key:"selectLinearGradient",value:function(){var va=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){return 1==Ua.nextAddress?(va.get("radialMode").borderColor=Va.Color.gray.darker(),va.get("linearMode").borderColor=Va.Color.orange,Ua.yield(va.applyGradient(Va.LinearGradient),2)):Ua.yield(va.updateGradientHandles(),0)})}},{key:"applyGradient",value:function(va){var Ua=this,mb,Ub,yc,Pc,Zc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qc){mb=Ua.gradientValue;
Ua.get("gradientEditor");mb&&mb.isGradient?(Ub=mb,yc=Ub.stops,Pc=Ub.focus,Zc=Ub.vector,Ua.gradientValue=new va({stops:yc,bounds:Ua.gradientBounds,focus:Pc,vector:Zc})):Ua.gradientValue=new va({stops:[{color:Va.Color.white,offset:0},{color:Va.Color.black,offset:1}],bounds:Ua.gradientBounds});Ua.update(Ua.gradientValue);Qc.jumpToEnd()})}},{key:"showGradientHandlesOn",value:function(va){this.handleMorph=va;this.updateGradientHandles()}},{key:"updateGradientHandles",value:function(){var va=this,Ua,mb;
return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ub){if(1==Ub.nextAddress)return Ua=300,mb=va.gradientValue.__proto__.constructor,va.handleMorph?va.gradientHandle?Ub.yield(va.gradientHandle.fadeOut(Ua),3):Ub.jumpTo(2):Ub.return();mb==Va.RadialGradient?va.gradientHandle=new Va.GradientFocusHandle({target:va.handleMorph}):mb==Va.LinearGradient&&(va.gradientHandle=new Va.GradientDirectionHandle({target:va.handleMorph}));va.gradientHandle&&(Va.signal(va,"openHandle",va.gradientHandle),va.gradientHandle.relayout(),
va.gradientHandle.opacity=0,va.gradientHandle.animate({opacity:1,duration:Ua}));Ub.jumpToEnd()})}},{key:"update",value:function(va){(va=void 0===va?this.gradientValue:va)&&va.isGradient&&this.get("gradientEditor").update(va)}},{key:"build",value:function(){var va;this.submorphs=[va=new Va.GradientTypeSelector({name:"typeSelector"}),this.gradientEditor()];Va.connect(va,"radial",this,"selectRadialGradient");Va.connect(va,"linear",this,"selectLinearGradient");Va.connect(this,"gradientValue",this,"update");
this.update(this.gradientValue);va.update(this.gradientValue);this.gradientValue&&this.updateGradientHandles()}},{key:"gradientEditor",value:function(){return Va.morph({fill:null,clipMode:"hidden",extent:Va.pt(190,80),submorphs:[new Va.GradientStopVisualizer({position:Va.pt(5,30),name:"gradientEditor",gradientEditor:this})]})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientEditor"}},{key:"properties",get:function(){return{layout:{initialize:function(){this.layout=new Va.VerticalLayout({spacing:3})}},
fill:{defaultValue:Va.Color.transparent},handleMorph:{},gradientValue:{set:function(va){va&&va.isGradient||(va=!1);this.setProperty("gradientValue",va)}},submorphs:{initialize:function(){this.build()}}}}}],ba,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:2575,end:6191})}(Va.Morph);
Va.GradientEditor=cc;Va.GradientEditor=cc;Va.GradientEditor=cc;(function(Sa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Fb=ba.hasOwnProperty("StopControlHead")&&"function"===typeof ba.StopControlHead?ba.StopControlHead:ba.StopControlHead=function(va){va&&va[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Sc(Fb,Sa,[{key:"update",value:function(va){var Ua=this.getSubmorphNamed("paletteField");
this.getSubmorphNamed("pickerField");Ua||(this.submorphs=[Ua=this.paletteField(Va.pt(10,10))]);Ua.fill=this.stopColor=va.stops[this.index].color}},{key:"onHoverIn",value:function(){var va=this.targetProperty.stops[this.index].color;this.palette=this.palette||new Va.Popover({name:"Color Palette",targetMorph:new Va.ColorPalette({color:va})});Va.connect(this.palette.targetMorph,"color",this.palette,"color");this.picker=this.picker||new Va.ColorPicker({color:va});this.picker.color=va;this.scheduleExpand()}},
{key:"onHoverOut",value:function(){this.scheduleShrink()}},{key:"scheduleExpand",value:function(){this.queue.pop()||(this.queue.push(this.expand),this.dequeue())}},{key:"scheduleShrink",value:function(){this.queue.pop()||(this.queue.push(this.shrink),this.dequeue())}},{key:"dequeue",value:function(){var va=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){if(1==Ua.nextAddress){if(va.queueActive)return Ua.return();va.queueActive=!0}if(3!=Ua.nextAddress)return 0<va.queue.length?Ua.yield(va.queue.shift().bind(va)(),
2):Ua.jumpTo(3);va.queueActive=!1;Ua.jumpToEnd()})}},{key:"expand",value:function(){var va=this,Ua,mb,Ub,yc,Pc,Zc,Qc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ld){if(1<va.submorphs.length)return Ld.return();Ua=va.get("paletteField");Ub=Va.pt(2,-14);va.submorphs=[va.closeButton(),Ua,va.pickerField()];va.master={auto:"styleguide://SystemWidgets/stop control head/expanded"};mb=va.get("gradientEditor");yc=va.transformRectToMorph(mb,va.innerBounds());Pc=yc.x;Zc=yc.width;Qc=Pc+Zc-mb.width;
Pc<va.width/2&&(Ub=Ub.addXY(va.width/3-Pc,0));Qc>va.width/2&&(Ub=Ub.addXY(va.width/3-Qc,0));Ua.extent=Va.pt(15,15);va.center=Ub;va.stopVisualizer.gradientEditor.update();Ld.jumpToEnd()})}},{key:"shrink",value:function(){var va=this,Ua,mb,Ub,yc,Pc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Zc){if(3>va.submorphs.length)return Zc.return();Ua=Va.pt(2,-14);mb=$jscomp.makeIterator([va.get("close"),va.get("paletteField"),va.get("pickerField")]);Ub=mb.next().value;yc=mb.next().value;Pc=mb.next().value;
yc.bringToFront();Ub.remove();Pc.remove();va.master={auto:"styleguide://SystemWidgets/stop control head/collapsed"};va.center=Ua;Zc.jumpToEnd()})}},{key:"onWidgetClosed",value:function(){this.palette=this.picker=null;this.shrink()}},{key:"removeStop",value:function(){this.stopVisualizer.removeStop(this.index)&&this.remove()}},{key:"closeButton",value:function(){var va=new Va.Morph({name:"close",extent:Va.pt(15,15),fill:Va.Color.transparent,origin:Va.pt(0,-3),clipMode:"hidden",submorphs:[Va.Icon.makeLabel("times",
{styleClasses:["closeButton"]})]});Va.connect(va,"onMouseDown",this,"removeStop");return va}},{key:"updateColor",value:function(va){this.stopVisualizer.updateStop(this.index,{color:va})}},{key:"openColorWidget",value:function(va){this.stopVisualizer.stopControls.forEach(function(Ua){return Ua.head.closeAllWidgets()});this[va].topLeft=Va.pt(0,0);Va.connect(this[va],"color",this,"updateColor");Va.connect(this[va],"close",this,"onWidgetClosed");Va.connect(this.stopVisualizer,"remove",this[va],"remove");
Va.connect(this[va],"onBlur",this,"removeWhenLostFocus",{converter:function(){return va},varMapping:{name:va}});this[va].fadeIntoWorld(this.globalBounds().bottomCenter());this[va].focus()}},{key:"removeWhenLostFocus",value:function(va){var Ua=this;setTimeout(function(){$world.focusedMorph.ownerChain().includes(Ua[va])||$world.focusedMorph.isMenuItem?Ua[va].focus():Ua.closeColorWidget(va)},100)}},{key:"closeColorWidget",value:function(va){this[va]&&this[va].remove()}},{key:"closeAllWidgets",value:function(){this.closeColorWidget("palette");
this.closeColorWidget("picker")}},{key:"paletteField",value:function(va){va=Va.morph({type:"ellipse",name:"paletteField",extent:va,styleClasses:["paletteField"]});Va.connect(va,"onMouseDown",this,"openColorWidget",{converter:function(){return"palette"}});return va}},{key:"pickerField",value:function(){var va=new Va.Image({name:"pickerField",styleClasses:["pickerField"]});Va.connect(va,"onMouseDown",this,"openColorWidget",{converter:function(){return"picker"}});return va}}],[{key:Symbol.for("__LivelyClassName__"),
get:function(){return"StopControlHead"}},{key:"properties",get:function(){return{stopVisualizer:{},gradientEditor:{},targetProperty:{get:function(){return this.stopVisualizer.targetProperty}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/stop control head/collapsed"}}},index:{},queue:{defaultValue:[]},isHaloItem:{defaultValue:!0}}}}],ba,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:6193,end:11487})})(Va.Morph);(function(Sa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Fb=ba.hasOwnProperty("GradientStopVisualizer")&&"function"===typeof ba.GradientStopVisualizer?ba.GradientStopVisualizer:ba.GradientStopVisualizer=function(va){va&&va[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return Sc(Fb,Sa,[{key:"update",value:function(va){this.fill=new Va.LinearGradient({stops:va.stops,vector:"eastwest"});this.get("instruction").animate({visible:!1,duration:300});this.renderStopControls(va)}},{key:"onHoverOut",value:function(){this.toggleStopPreview(!1)}},{key:"onMouseMove",value:function(va){var Ua=va.positionIn(this);va=Ua.x;this.stopControls&&this.stopControls.find(function(mb){return mb.bounds().containsPoint(Ua)})?this.toggleStopPreview(!1):(this.toggleStopPreview(!0),
this.get("stopControlPreview").position=Va.pt(va,0))}},{key:"onMouseDown",value:function(va){if(this.get("stopControlPreview").visible){var Ua=va.positionIn(this).x/this.width;va=this.targetProperty.stops.findIndex(function(mb){return mb.offset>Ua});va=0>va?this.targetProperty.stops.length-1:va;this.insertStop(va,Ua)}}},{key:"toggleStopPreview",value:function(va){this.get("instruction").visible||(this.get("stopControlPreview").visible=va)}},{key:"removeStop",value:function(va){var Ua=this.targetProperty;
return 2<Ua.stops.length?(Va.arr.removeAt(Ua.stops,va),this.targetProperty=Ua,!0):!1}},{key:"insertStop",value:function(va,Ua){var mb=this.targetProperty;Va.arr.pushAt(mb.stops,{offset:Ua,color:mb.stops[va].color},va);this.targetProperty=mb}},{key:"updateStop",value:function(va,Ua){var mb=this.targetProperty;mb.stops[va]=Object.assign({},mb.stops[va],{},Ua);this.targetProperty=mb}},{key:"renderStopControls",value:function(va){var Ua=this;if(!this.stopControls||this.stopControls.length!=va.stops.length){var mb=
$jscomp.makeIterator(this.submorphs),Ub=mb.next().value;mb=mb.next().value;this.stopControls=va.stops.map(function(yc,Pc){return new Va.GradientStopControl({stopVisualizer:Ua,index:Pc})});this.submorphs=[Ub,mb].concat($jscomp.arrayFromIterable(this.stopControls));Va.arr.invoke(this.stopControls,"update",va)}Va.arr.invoke(this.stopControls,"update",va)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientStopVisualizer"}},{key:"properties",get:function(){return{fill:{defaultValue:Va.Color.gray},
gradientEditor:{},draggable:{defaultValue:!1},targetProperty:{derived:!0,get:function(){return this.gradientEditor&&this.gradientEditor.gradientValue},set:function(va){this.gradientEditor.gradientValue=va}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient stop visualizer"}}},submorphs:{after:["gradientEditor"],initialize:function(){this.submorphs=[{type:"label",name:"instruction",value:"Select Gradient Type",visible:!(this.targetProperty&&this.targetProperty.isGradient)},
{name:"stopControlPreview",visible:!1,master:{auto:"styleguide://SystemWidgets/stop control preview"},submorphs:[Va.Icon.makeLabel("plus-circle",{name:"addStopLabel"})]}]}}}}}],ba,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:11489,end:14883})})(Va.Morph);(function(Sa){var ba=
lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Fb=ba.hasOwnProperty("GradientStopControl")&&"function"===typeof ba.GradientStopControl?ba.GradientStopControl:ba.GradientStopControl=function(va){va&&va[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Sc(Fb,Sa,[{key:"update",value:function(va){this.position=this.stopVisualizer.extent.subPt(Va.pt(10,0)).scaleByPt(Va.pt(va.stops[this.index].offset,0)).addPt(Va.pt(5,
0));this.head.update(va)}},{key:"onDragStart",value:function(va){this.nativeCursor="-webkit-grabbing";this.stopVisualizer.nativeCursor="-webkit-grabbing";this.offsetView=(new Va.Tooltip).openInWorld(va.hand.position.addPt(Va.pt(10,10)))}},{key:"onDrag",value:function(va){var Ua=Math.max(0,Math.min(1,(this.position.x-5+va.state.dragDelta.x)/(this.stopVisualizer.width-10)));this.stopVisualizer.updateStop(this.index,{offset:Ua});this.offsetView.description=(100*Ua).toFixed(2)+"%";this.offsetView.position=
va.hand.position.addPt(Va.pt(10,10))}},{key:"onDragEnd",value:function(){this.nativeCursor="-webkit-grab";this.stopVisualizer.nativeCursor="auto";this.offsetView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientStopControl"}},{key:"properties",get:function(){return{index:{},head:{},stopVisualizer:{},styleClasses:{defaultValue:["stopControlLine"]},nativeCursor:{defaultValue:"-webkit-grab"},draggable:{defaultValue:!0},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient stop control"}}},
submorphs:{after:["index","stopVisualizer"],initialize:function(){this.head=new Va.StopControlHead({name:"stop control head",stopVisualizer:this.stopVisualizer,index:this.index});this.head.stopControl=this;this.addMorph(this.head)}}}}}],ba,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},
{start:14885,end:16661})})(Va.Morph);(function(Sa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Fb=ba.hasOwnProperty("FocusHandle")&&"function"===typeof ba.FocusHandle?ba.FocusHandle:ba.FocusHandle=function(va){va&&va[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Sc(Fb,Sa,[{key:"relayout",value:function(){this.center=this.gradientHandle.innerBounds().center()}},{key:"onDragStart",value:function(va){this.tfm=
this.gradientHandle.target.getGlobalTransform().inverse();this.focusView=(new Va.Tooltip).openInWorld(va.hand.position.addPt(Va.pt(10,10)))}},{key:"onDrag",value:function(va){var Ua=va.state.dragDelta,mb=this.gradientHandle,Ub=mb.target.fill;Ub.focus=Ub.focus.addXY(Ua.x/mb.target.width,Ua.y/mb.target.height);this.focusView.description="x: "+(100*Ub.focus.x).toFixed()+"%, y: "+(100*Ub.focus.y).toFixed()+"%";this.focusView.position=va.hand.position.addPt(Va.pt(10,10));mb.target.makeDirty();mb.relayout()}},
{key:"onDragEnd",value:function(va){this.focusView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"FocusHandle"}},{key:"properties",get:function(){return{gradientHandle:{},styleClasses:{defaultValue:["focusHandle"]},extent:{defaultValue:Va.pt(20,20)},fill:{defaultValue:Va.Color.orange}}}}],ba,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},
package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:16663,end:17666})})(Va.Ellipse);(function(Sa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Fb=ba.hasOwnProperty("BoundsHandle")&&"function"===typeof ba.BoundsHandle?ba.BoundsHandle:ba.BoundsHandle=function(va){va&&va[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Sc(Fb,Sa,[{key:"relayout",value:function(){this.center=this.gradientHandle.innerBounds().partNamed(this.side);
this.scale=1/this.gradientHandle.target.getGlobalTransform().getScale()}},{key:"onDragStart",value:function(va){this.boundsView=(new Va.Tooltip).openInWorld(va.hand.position.addPt(Va.pt(10,10)))}},{key:"onDrag",value:function(va){var Ua=this.gradientHandle,mb=Ua.target.fill,Ub=mb.bounds.partNamed(this.side).addPt(va.state.dragDelta.scaleBy(2));mb.bounds=mb.bounds.withPartNamed(this.side,Ub);this.boundsView.description="w: "+mb.bounds.width.toFixed()+"px h: "+mb.bounds.height.toFixed()+"px";this.boundsView.position=
va.hand.position.addPt(Va.pt(10,10));Ua.target.makeDirty();Ua.relayout()}},{key:"onDragEnd",value:function(va){this.boundsView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"BoundsHandle"}},{key:"properties",get:function(){return{side:{},gradientHandle:{},styleClasses:{after:["side"],initialize:function(){this.styleClasses=["boundsHandle",this.side]}}}}}],ba,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:17668,end:18747})})(Va.Ellipse);var Ba=function(Sa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Fb=ba.hasOwnProperty("GradientFocusHandle")&&"function"===typeof ba.GradientFocusHandle?ba.GradientFocusHandle:ba.GradientFocusHandle=function(va){va&&va[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return Sc(Fb,Sa,[{key:"relayout",value:function(){var va=this.target.fill,Ua=va.focus;this.extent=va.bounds.extent();this.submorphs.forEach(function(mb){return mb.relayout()});this.rotation=this.target.rotation;this.scale=this.target.scale;this.borderWidth=2/this.scale;this.owner&&(this.center=this.owner.localizePointFrom(this.target.extent.scaleByPt(Ua),this.target))}},{key:"initBoundsHandles",value:function(){var va=this;this.bounds().sides.forEach(function(Ua){va.addMorph(new Va.BoundsHandle({gradientHandle:va,
side:Ua,name:"bounds handle "+Ua.split("C")[0]}))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientFocusHandle"}},{key:"properties",get:function(){return{target:{},isHaloItem:{defaultValue:!0},hasFixedPosition:{defaultValue:!0},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient focus handle"}}},submorphs:{initialize:function(){this.submorps=[];this.initBoundsHandles();this.addMorph(new Va.FocusHandle({gradientHandle:this}));this.relayout()}}}}}],
ba,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:18756,end:20039})}(Va.Ellipse);Va.GradientFocusHandle=Ba;Va.GradientFocusHandle=Ba;Va.GradientFocusHandle=Ba;(function(Sa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Fb=ba.hasOwnProperty("RotationPoint")&&
"function"===typeof ba.RotationPoint?ba.RotationPoint:ba.RotationPoint=function(va){va&&va[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Sc(Fb,Sa,[{key:"relayout",value:function(){this.center=Va.Point.polar(this.gradientHandle.width/2,this.gradientHandle.target.fill.vectorAsAngle())}},{key:"onDragStart",value:function(va){this.angleView=(new Va.Tooltip).openInWorld(va.hand.position.addPt(Va.pt(10,10)));this.angleView.rotation=
0}},{key:"onDrag",value:function(va){var Ua=this.gradientHandle;Ua.target.fill.vector=va.positionIn(Ua).theta();Ua.target.makeDirty();Ua.relayout();this.angleView.description=(Va.num.toDegrees(Ua.target.fill.vectorAsAngle())+180).toFixed()+"\u00b0";this.angleView.position=va.hand.position.addPt(Va.pt(10,10))}},{key:"onDragEnd",value:function(va){this.angleView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"RotationPoint"}},{key:"properties",get:function(){return{gradientHandle:{}}}}],
ba,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:20041,end:20838})})(Va.Ellipse);(function(Sa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Fb=ba.hasOwnProperty("GradientDirectionHandle")&&"function"===typeof ba.GradientDirectionHandle?
ba.GradientDirectionHandle:ba.GradientDirectionHandle=function(va){va&&va[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Sc(Fb,Sa,[{key:"isHaloItem",get:function(){return!0}},{key:"relayout",value:function(){this.owner&&(this.position=this.owner.localizePointFrom(this.target.extent.scaleBy(.5),this.target));this.rotationPoint.relayout()}},{key:"initRotationPoint",value:function(){this.rotationPoint=this.addMorph(new Va.RotationPoint({gradientHandle:this,
name:"rotation point"}))}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientDirectionHandle"}},{key:"properties",get:function(){return{target:{},origin:{defaultValue:Va.pt(25,25)},extent:{defaultValue:Va.pt(50,50)},hasFixedPosition:{defaultValue:!0},submorphs:{initialize:function(){this.initRotationPoint();this.relayout()}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient direction handle"}}}}}}],ba,{pathInPackage:function(){return"styling/gradient-editor.js"},
unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:20840,end:21812})})(Va.Ellipse);Va.colorWidgets.GradientEditor=Va.GradientEditor;var Ja=lively.FreezerRuntime.recorderFor("lively.ide/world.js");Ja.resource=Wb;Ja.Rectangle=Sb;Ja.Color=ac;Ja.pt=Cd;Ja.arr=Ic;Ja.fun=Pd;Ja.obj=yd;Ja.promise=ec;Ja.PropertyPath=bd;Ja.once=Td;Ja.GridLayout=Zb;Ja.MorphicDB=
Xb;Ja.easings=Pe;Ja.HTMLMorph=Jb;Ja.Text=fd;Ja.Label=Ra;Ja.Path=Ga;Ja.Polygon=ea;Ja.morph=Ie;Ja.Ellipse=Mc;Ja.touchInputDevice=Da;Ja.Icon=$a;Ja.Morph=ub;Ja.VerticalLayout=dc;Ja.HorizontalLayout=ta;Ja.ProportionalLayout=Pa;Ja.Tooltip=uc;Ja.Image=Ib;Ja.inspect=Ne;Ja.config=me;Ja.World=Ha;Ja.loadMorphFromSnapshot=tb;Ja.loadObjectFromPartsbinFolder=Yc;Ja.loadPart=Nd;Ja.uploadFile=og;Ja.InformPrompt=Ac;Ja.ConfirmPrompt=wb;Ja.MultipleChoicePrompt=ud;Ja.TextPrompt=Tb;Ja.EditPrompt=te;Ja.PasswordPrompt=cd;
Ja.ListPrompt=Lc;Ja.EditListPrompt=Hb;Ja.LoadingIndicator=ae;Ja.Halo=z;Ja.MorphHighlighter=pf;Ja.StatusMessage=nf;Ja.StatusMessageForMorph=De;Ja.ProportionalLayoutHalo=Cf;Ja.GridLayoutHalo=Rf;Ja.FlexLayoutHalo=Vf;Ja.Window=Be;Ja.List=Ob;Ja.FilterableList=Gb;Ja.Menu=Ta;Ja.worldCommands=cb;Ja.GradientEditor=cc;Ja.completions=Y;Ja.runEval=Ma;Ja.getClassName=gb;Ja.serialize=Nb;Ja.Canvas=oc;Ja.CommentBrowser=lf;Ja.prefetchCoreStyleguides=Wc;cb=Wa("LivelyWorld",function(Sa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),
Fb=ba.hasOwnProperty("LivelyWorld")&&"function"===typeof ba.LivelyWorld?ba.LivelyWorld:ba.LivelyWorld=function(va){va&&va[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Sc(Fb,Sa,[{key:"visibleBoundsExcludingTopBar",value:function(){var va=$world.getSubmorphNamed("lively top bar"),Ua=this.visibleBounds();return va?new Ja.Rectangle(Ua.x,Ua.y+va.height,Ua.width,Ua.height-va.height):Ua}},{key:"getListedComponents",value:function(){var va=
this,Ua=this.withAllSubmorphsSelect(function(mb){return mb.isComponent&&!va.hiddenComponents.includes(mb.name)});return Ja.arr.uniq([].concat($jscomp.arrayFromIterable(Ua),$jscomp.arrayFromIterable(this.localComponents)))}},{key:"activeWindow",value:function(){return this.getWindows().reverse().find(function(va){return va.isActive()})}},{key:"getWindows",value:function(){return this.submorphs.filter(function(va){return va.isWindow})}},{key:"activePrompt",value:function(){return this.getPrompts().reverse().find(function(va){return va.isActive()})}},
{key:"getPrompts",value:function(){return this.submorphs.filter(function(va){return va.isPrompt})}},{key:"openInWindow",value:function(va,Ua){Ua=void 0===Ua?{title:va.name,name:"window for "+va.name}:Ua;va=(new Ja.Window(Object.assign({},Ua,{extent:va.extent.addXY(0,25),targetMorph:va}))).openInWorld();va.ensureNotOverTheTop();return va}},{key:"withTopBarDo",value:function(va){var Ua=this.get("lively top bar");Ua&&va(Ua)}},{key:"onTopBarLoaded",value:function(){}},{key:"onKeyUp",value:function(va){this.withTopBarDo(function(Ua){return Ua.onKeyUp(va)})}},
{key:"onKeyDown",value:function(va){Sc._get(Object.getPrototypeOf(Fb.prototype),"onKeyDown",this).call(this,va);va.targetMorph==this&&this.withTopBarDo(function(Ua){return Ua.onKeyDown(va)})}},{key:"onMouseDown",value:function(va){Sc._get(Object.getPrototypeOf(Fb.prototype),"onMouseDown",this).call(this,va);var Ua=va.state.clickedOnMorph,mb=this.activeWindow();mb&&Ua==this&&mb.deactivate();this.handleHaloCycle(va);va.state.menu&&va.state.menu.remove();this._tooltipViewer.mouseDown(va)}},{key:"onMouseUp",
value:function(va){va.isCommandKey()&&va.stop();if(va.isAltDown()&&Ja.config.altClickDefinesThat){var Ua=this.morphsContainingPoint(va.position)[0];setTimeout(function(){return System.global.that=Ua},100);Ua.show();va.stop();console.log('Set global "that" to '+Ua)}}},{key:"onDrag",value:function(va){}},{key:"whenReady",value:function(){var va=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){return 1==Ua.nextAddress?Ua.yield(va._styleLoading,2):Ua.return(!0)})}},{key:"onLoad",value:function(){var va=
this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){if(1==Ua.nextAddress){va.opacity=0;va.onWindowResize();lively.modules&&lively.modules.removeHook("fetch",window.__logFetch);va.animate({opacity:1,blur:3,duration:1E3,easing:Ja.easings.inOutExpo});if(!va.showsUserFlap&&!Ja.resource(document.location.href).query().showsUserFlap)return Ua.jumpTo(2);va._styleLoading=Ja.prefetchCoreStyleguides(window.worldLoadingIndicator);return Ua.yield(va._styleLoading,2)}va.animate({blur:0,duration:1E3,
easing:Ja.easings.inOutExpo});document.body.style.overflowX="visible";document.body.style.overflowY="visible";Ua.jumpToEnd()})}},{key:"isNotUnique",value:function(va){var Ua,mb,Ub,yc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pc){switch(Pc.nextAddress){case 1:return Pc.yield(Ja.MorphicDB.default.exists("world",va),2);case 2:if(Ua=Pc.yieldResult.exists){Pc.jumpTo(3);break}mb=va+".json";Ub=Ja;yc=Ub.resource;return Pc.yield(System.decanonicalize("lively.morphic/styleguides"),5);case 5:return Pc.yield(yc.call(Ub,
Pc.yieldResult).join(mb).exists(),4);case 4:Ua=Pc.yieldResult;case 3:return Pc.return(Ua)}})}},{key:"askForName",value:function(){var va=this,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(mb){switch(mb.nextAddress){case 1:return mb.yield(va.whenRendered(),3);case 3:if(Ua){mb.jumpTo(4);break}return mb.yield(va.prompt(["New Project\n",{},"Enter a name for this project:",{fontWeight:"normal"}],{width:400,hasFixedPosition:!0,forceConfirm:!0}),5);case 5:return Ua=mb.yieldResult,mb.yield(va.isNotUnique(Ua),
6);case 6:if(!mb.yieldResult){mb.jumpTo(3);break}return mb.yield(va.confirm("This Project name is already taken. Please pick a different one!",{hasFixedPosition:!0,width:400}),8);case 8:Ua=!1;mb.jumpTo(3);break;case 4:return mb.return(Ua)}})}},{key:"onWindowResize",value:function(va){Sc._get(Object.getPrototypeOf(Fb.prototype),"onWindowResize",this).call(this,va);"elastic"===this.resizePolicy&&this.execCommand("resize to fit window")}},{key:"nativeDrop_ensureUploadIndicator",value:function(){var va=
this,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(mb){if(1==mb.nextAddress)return va._cachedDragIndicator||(va._cachedDragIndicator=Ja.loadObjectFromPartsbinFolder("upload-indicator")),mb.yield(va._cachedDragIndicator,2);Ua=mb.yieldResult;Ua.world()||Ua.openInWorld();Ja.fun.debounceNamed("remove-upload-indicator",1E3,function(){va.nativeDrop_removeUploadIndicator()})();mb.jumpToEnd()})}},{key:"nativeDrop_removeUploadIndicator",value:function(){this._cachedDragIndicator&&this._cachedDragIndicator.then(function(va){return va.remove()})}},
{key:"onNativeDragover",value:function(va){va.targetMorph===this&&this.nativeDrop_ensureUploadIndicator()}},{key:"onNativeDrop",value:function(va){var Ua=this,mb,Ub,yc,Pc,Zc,Qc,Ld,we,af,de,kf,Qe,Ke,Pf,xg,Eg,$g,Kg,Qg,Hi,Mi,Kf,Ui,Rg,ah,ci,rf,aj,mc,vd,ee,ye,jg,mg,Ah,kl,Tk,Uk,nn,wl,on,Nm,pn,xl,zj,Vl;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wg){switch(wg.nextAddress){case 1:Ua.nativeDrop_removeUploadIndicator();if(va.targetMorph!=Ua)return wg.return();mb=va;Ub=mb.domEvt;yc=Ub.dataTransfer;
Pc=yc.files;Zc=document.location.origin;if(!Pc.length){wg.jumpTo(2);break}Qc=Ua.getCurrentUser();Ld=Qc.isGuestUser?"uploads/":"users/"+$world.getCurrentUser().name+"/uploads";if(!va.isAltDown()){wg.jumpTo(3);break}return wg.yield(Ua.prompt("Choose upload location",{history:"lively.morphic-html-drop-file-upload-location",input:Ld}),4);case 4:if(Ld=wg.yieldResult,!Ld)return wg.return(Ua.setStatusMessage("Canceled upload"));case 3:return wg.yield(Ua.confirm("Upload "+Pc.length+" file"+(1<Pc.length?"s":
"")+"?"),5);case 5:we=wg.yieldResult;if(!we)return wg.return();af=new Ja.FormData;for(de=0;de<Pc.length;de++)af.append("file",Pc[de],Pc[de].name);Ke=Ja.LoadingIndicator.open("Uploading File");wg.setCatchFinallyBlocks(6);Pf={};xg=function(Yj){Yj=Yj.loaded/Yj.total;Ke.progress=Yj;Ke.status="Uploaded "+(100*Yj).toFixed()+"%"};Qc.isGuestUser||(Pf.Authorization="Bearer "+Qc.token);kf=Ja.resource(System.baseURL,{headers:Pf,onProgress:xg,onLoad:function(Yj){return Qe=Yj}});kf=kf.join("/upload?uploadPath="+
encodeURIComponent(Ld));return wg.yield(kf.write(af),8);case 8:wg.leaveTryBlock(7);break;case 6:return Eg=wg.enterCatchBlock(),wg.return(Ua.showError("Upload failed: "+Eg.message+"\n"));case 7:Ke.remove();wg.setCatchFinallyBlocks(9);Ua.setStatusMessage("Uploaded "+Qe.uploadedFiles.length+" file");$g=Qe.uploadedFiles.map(function(Yj){var ll=Ja.resource(Zc).join(Yj.path);return Object.assign({},Yj,{url:ll.url,name:ll.name()})});Kg=[];Qg=[];Hi=[];Mi=$jscomp.makeIterator($g);for(Kf=Mi.next();!Kf.done;Kf=
Mi.next())Ui=Kf.value,Ui.type.startsWith("image/")?Kg.push(Ui):Ui.type.startsWith("video")?Qg.push(Ui):Hi.push(Ui);if(!Qg.length){wg.jumpTo(11);break}Rg=$jscomp.makeIterator(Qg);ah=Rg.next();case 12:if(ah.done){wg.jumpTo(11);break}ci=ah.value;rf=Object;aj=rf.assign;return wg.yield(Ja.loadObjectFromPartsbinFolder("video morph"),15);case 15:aj.call(rf,wg.yieldResult,{videoURL:ci.url,name:ci.name}).openInWorld();ah=Rg.next();wg.jumpTo(12);break;case 11:Kg.length&&Kg.forEach(function(Yj){var ll=new Ja.Image({imageUrl:Yj.url,
autoResize:!0,name:Yj.name});ll.whenLoaded().then(function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(qn){if(1==qn.nextAddress)return ll.extent=ll.naturalExtent.scaleBy(.8*Ua.visibleBounds().height/ll.height),ll.openInWorld(),qn.yield(ll.whenRendered(),2);ll.center=Ua.visibleBounds().center();qn.jumpToEnd()})})});if(!Hi.length){wg.jumpTo(16);break}mc=$jscomp.makeIterator(Hi);vd=mc.next();case 17:if(vd.done){wg.jumpTo(16);break}ee=vd.value;return wg.yield(Ua.confirm("open file "+
ee.name+" ("+ee.type+")?"),20);case 20:(ye=wg.yieldResult)&&Ua.execCommand("open file",{url:ee.url});vd=mc.next();wg.jumpTo(17);break;case 16:wg.leaveTryBlock(10);break;case 9:jg=wg.enterCatchBlock(),Ua.showError(jg);case 10:return wg.return();case 2:mg=Ub.dataTransfer.types;if(!mg.includes("text/html")){wg.jumpTo(21);break}Ah=Ub.dataTransfer.getData("text/html");kl=(new Ja.DOMParser).parseFromString(Ah,"text/html");Tk=kl.querySelectorAll("img");if(1===Tk.length&&Tk[0].src&&mg.includes("text/uri-list")){Uk=
Tk[0].src;nn=new Ja.Image({imageUrl:Uk,autoResize:!0,name:Ja.arr.last(Uk.split("/"))});nn.whenLoaded().then(function(){return nn.openInWorld()});wg.jumpTo(22);break}wl=Object;on=wl.assign;return wg.yield(Ja.loadObjectFromPartsbinFolder("html-morph"),23);case 23:on.call(wl,wg.yieldResult,{html:Ah}).openInWorld();case 22:return wg.return();case 21:Nm=0;case 24:if(!(Nm<Ub.dataTransfer.items.length)){wg.jumpTo(0);break}pn=Ub.dataTransfer.items[Nm];if("file"!==pn.kind){"string"===pn.kind&&pn.getAsString(function(Yj){return Ja.inspect(Yj)});
wg.jumpTo(25);break}xl=pn.getAsFile();return wg.yield(Ua.confirm("Upload "+xl.name+"?"),28);case 28:zj=wg.yieldResult;if(!zj){wg.jumpTo(25);break}return wg.yield(Ja.uploadFile(xl,xl.type),30);case 30:(Vl=wg.yieldResult)&&Vl.openInWorld(),Vl.center=Ua.visibleBounds().center();case 25:Nm++,wg.jumpTo(24)}})}},{key:"menuItems",value:function(){var va=this;return[{title:"World menu"},{command:"undo",target:this},{command:"redo",target:this},{isDivider:!0},["Debugging",[{command:"delete change history",
target:this},{command:"fix font metric",target:this},{command:"inspect server",target:this}]],["Tools",[{command:"open javascript workspace",target:this},{command:"open browser",target:this},{command:"choose and browse module",target:this},{command:"open code search",target:this},{command:"open file browser",target:this},{command:"open shell workspace",target:this,tooltip:"Opens a workspace like interface\nthat allows you to trigger shell comands\nvia select + eval by pressing either "+(new Ja.Text).keysForCommand("doit")+
" or "+(new Ja.Text).keysForCommand("printit")},{command:"open shell terminal",target:this,tooltip:"Opens a classic remote shell interface,\nthat allows you to send commands to a\nbash session running on the server.\nAlso comes with advanced git support."},{command:"open workspace",args:{askForMode:!0},target:this}]],{isDivider:!0},{command:"run command",target:this},{command:"select morph",target:this},{command:"window switcher",target:this},["Exported Components",[["Toggle Select All",function(){0==
va.getListedComponents().length?va.hiddenComponents=[]:va.hiddenComponents=va.withAllSubmorphsSelect(function(Ua){return Ua.isComponent}).map(function(Ua){return Ua.name})}]].concat($jscomp.arrayFromIterable(this.withAllSubmorphsSelect(function(Ua){return Ua.isComponent}).map(function(Ua){var mb=va.hiddenComponents.includes(Ua.name);return[[].concat($jscomp.arrayFromIterable(Ja.Icon.textAttribute(mb?"square":"check-square")),["  "+Ua.name,{}]),function(){va.hiddenComponents=mb?Ja.arr.without(va.hiddenComponents,
Ua.name):[Ua.name].concat($jscomp.arrayFromIterable(va.hiddenComponents))}]})))],["Resize","static"===this.resizePolicy?[{command:"resize to fit window",target:this},{command:"resize manually",target:this},["switch to automatic resizing of world",function(){return va.resizePolicy="elastic"}]]:[["switch to manual resizing of world",function(){return va.resizePolicy="static"}]]],["Troubleshooting",[{command:"report a bug",target:this},{command:"clear storage and reload",target:this}]],{isDivider:!0},
["Windows",[{command:"toggle minimize all windows",target:this},{command:"close all windows",target:this}]],{isDivider:!0},{command:"save world",target:this},{command:"load world",target:this}]}},{key:"openWorldMenu",value:function(va,Ua){var mb=this.env.eventDispatcher.eventState;mb.menu&&mb.menu.remove();return mb.menu=Ua&&Ua.length?Ja.Menu.openAtHand(Ua,{hand:va&&va.hand||this.firstHand}):null}},{key:"onPaste",value:function(va){var Ua=this,mb,Ub,yc,Pc,Zc,Qc,Ld,we,af,de,kf,Qe;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ke){switch(Ke.nextAddress){case 1:Ke.setCatchFinallyBlocks(2,
3);Ub=va.domEvt.clipboardData;if(!Ub.types.includes("application/morphic")){Ke.jumpTo(3);break}va.stop();yc=JSON.parse(Ub.getData("application/morphic"));Pc=[];Array.isArray(yc)||(yc=[yc]);mb=Ja.LoadingIndicator.open("pasting morphs...");Zc=$jscomp.makeIterator(yc);Qc=Zc.next();case 6:if(Qc.done){Ke.jumpTo(8);break}Ld=Qc.value;return Ke.yield(Ja.loadMorphFromSnapshot(Ld),9);case 9:we=Ke.yieldResult;we.openInWorld(va.hand.position);Ld.copyMeta&&Ld.copyMeta.offset&&(af=Ld.copyMeta.offset,de=af.x,kf=
af.y,we.moveBy(Ja.pt(de,kf)));Pc.push(we);Qc=Zc.next();Ke.jumpTo(6);break;case 8:Ua.showHaloFor(Pc);case 3:Ke.enterFinallyBlock();mb&&mb.remove();Ke.leaveFinallyBlock(0);break;case 2:Qe=Ke.enterCatchBlock(),Ua.showError(Qe),Ke.jumpTo(3)}})}},{key:"commands",get:function(){return Ja.worldCommands.concat(Sc._get(Object.getPrototypeOf(Fb.prototype),"commands",this)).concat([{name:"open in prototype box",exec:function(va,Ua){var mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ub){if(1==
Ub.nextAddress)return Ub.yield(Ja.loadPart("prototype box"),2);mb=Ub.yieldResult;mb.wrapProto(Ua.target);Ub.jumpToEnd()})}}])}},{key:"keybindings",get:function(){return Sc._get(Object.getPrototypeOf(Fb.prototype),"keybindings",this).concat(Ja.config.globalKeyBindings)}},{key:"keybindings",set:function(va){Sc._set(Object.getPrototypeOf(Fb.prototype),"keybindings",va,this)}},{key:"halos",value:function(){return this.submorphs.filter(function(va){return va.isHalo})}},{key:"haloForPointerId",value:function(va){return this.submorphs.find(function(Ua){return Ua.isHalo&&
Ua.state&&Ua.state.pointerId===va})}},{key:"showHaloFor",value:function(va,Ua,mb){Ua=void 0===Ua?this.firstHand&&this.firstHand.pointerId:Ua;mb=void 0===mb?!0:mb;if(Ja.Halo)return va="function"===typeof va.createHalo?va.createHalo(Ja.Halo,Ua):new Ja.Halo({pointerId:Ua,target:va}),this.addMorph(va),mb&&va.focus(),va.alignWithTarget(),va}},{key:"showHaloForSelection",value:function(va,Ua){return 0<va.length&&this.showHaloFor(va,Ua)}},{key:"layoutHaloForPointerId",value:function(va){va=void 0===va?this.firstHand&&
this.firstHand.pointerId:va;return this.submorphs.find(function(Ua){return Ua.isLayoutHalo&&Ua.state&&Ua.state.pointerId===va})}},{key:"showLayoutHaloFor",value:function(va,Ua){Ua=void 0===Ua?this.firstHand&&this.firstHand.pointerId:Ua;var mb=va===this?null:va.owner===this?va:va.ownerChain().slice(-2)[0];mb=mb?this.submorphs.indexOf(mb)+1:this.submorphs.length;switch(va.layout.constructor){case Ja.ProportionalLayout:var Ub=new Ja.ProportionalLayoutHalo({container:va,pointerId:Ua});break;case Ja.HorizontalLayout:case Ja.VerticalLayout:Ub=
new Ja.FlexLayoutHalo({container:va,pointerId:Ua});break;case Ja.GridLayout:Ub=new Ja.GridLayoutHalo({container:this.container,pointerId:Ua})}return Ub&&this.addMorphAt(Ub,mb)}},{key:"highlightMorph",value:function(va,Ua,mb,Ub){Ub=void 0===Ub?[]:Ub;return Ja.MorphHighlighter.for(va,Ua,void 0===mb?!1:mb,Ub)}},{key:"removeHighlighters",value:function(va){return Ja.MorphHighlighter.removeHighlighters(void 0===va?this:va)}},{key:"visibleStatusMessages",value:function(){return this.submorphs.filter(function(va){return va.isStatusMessage})}},
{key:"visibleStatusMessagesFor",value:function(va){return this.submorphs.filter(function(Ua){return Ua.isStatusMessage&&Ua.targetMorph===va})}},{key:"logErrorPreperation",value:function(va){var Ua=String(va),mb=va.stack||"";mb&&va.message!==va.stack&&(mb=String(mb),0===mb.indexOf(Ua)&&(mb=mb.slice(Ua.length)),Ua+="\n"+mb);return Ua}},{key:"logError",value:function(va){this.setStatusMessage(this.logErrorPreperation(va),Ja.Color.red)}},{key:"showError",value:function(va){return this.logError(va)}},
{key:"showErrorFor",value:function(va,Ua){return this.setStatusMessageFor(va,this.logErrorPreperation(Ua),Ja.Color.red)}},{key:"setStatusMessageFor",value:function(va,Ua,mb,Ub,yc){Ub=void 0===Ub?5E3:Ub;if(Ja.StatusMessageForMorph){this.visibleStatusMessagesFor(va).forEach(function(Pc){return Pc.remove()});Ua=new Ja.StatusMessageForMorph(Object.assign({message:Ua,color:mb},yc));this.openStatusMessage(Ua,Ub);Ua.targetMorph=va;Ua.fadeIn(300);if(Ua.removeOnTargetMorphChange&&va.isText)Ja.once(va,"selectionChange",
Ua,"fadeOut",{converter:function(){return 200},garbageCollect:!0});return Ua}}},{key:"setStatusMessage",value:function(va,Ua,mb,Ub){mb=void 0===mb?5E3:mb;Ub=void 0===Ub?{}:Ub;if(Ja.StatusMessage)return console[Ua==Ja.Color.red?"error":"log"](va),Ja.config.verboseLogging?this.openStatusMessage(new Ja.StatusMessage(Object.assign({message:va,color:Ua,hasFixedPosition:!0},Ub)),mb):null}},{key:"openStatusMessage",value:function(va,Ua){this.addMorph(va);if(va.slidable){for(var mb=this.visibleStatusMessages(),
Ub=$jscomp.makeIterator(mb),yc=Ub.next();!yc.done;yc=Ub.next()){yc=yc.value;if(mb.length<=(Ja.config.maxStatusMessages||0))break;!yc.stayOpen&&yc.slidable&&(yc.remove(),Ja.arr.remove(mb,yc))}Ja.arr.without(mb,va).forEach(function(Pc){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Zc){!Pc.isMaximized&&Pc.slidable&&Pc.slideTo(Pc.position.addPt(Ja.pt(0,-va.extent.y-10)));Zc.jumpToEnd()})});mb=this.visibleBounds().bottomRight().addXY(-20,-20);va.align(va.bounds().bottomRight(),mb);va.topRight=
mb.addPt(Ja.pt(0,40));va.animate({bottomRight:mb,duration:500})}"number"===typeof Ua&&setTimeout(function(){return va.stayOpen||va.fadeOut()},Ua);return va}},{key:"addProgressBar",value:function(va){va=void 0===va?{}:va;var Ua=this,mb,Ub,yc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pc){if(1==Pc.nextAddress)return mb=va,Ub=void 0===mb.location?"center":mb.location,Pc.yield(Ja.loadObjectFromPartsbinFolder("progress bar"),2);yc=Pc.yieldResult;Object.assign(yc,{progress:0},Ja.obj.dissoc(va,
["location"]));Ua.addMorph(yc);yc.align(yc[Ub],Ua.visibleBounds()[Ub]());return Pc.return(yc)})}},{key:"withProgressBarDo",value:function(va,Ua){var mb=this,Ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yc){switch(yc.nextAddress){case 1:return yc.yield(mb.addProgressBar(Ua),2);case 2:return Ub=yc.yieldResult,yc.setFinallyBlock(3),yc.yield(va(Ub),5);case 5:return yc.return(yc.yieldResult);case 3:yc.enterFinallyBlock(),Ub.remove(),yc.leaveFinallyBlock(0)}})}},{key:"openPrompt",value:function(va,
Ua){Ua=void 0===Ua?{requester:null,animated:!1}:Ua;var mb=this,Ub,yc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pc){Ub=mb.focusedMorph;yc=mb.visibleBounds();return Pc.return(mb.withRequesterDo(Ua.requester,function(Zc){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qc){va.openInWorldNear(Zc,mb);va.height>yc.height&&(va.height=yc.height-5);"function"===typeof Ua.customize&&Ua.customize(va);Ua.animated&&mb.previousPrompt&&mb.previousPrompt.world()&&mb.previousPrompt.transitionTo(va);
mb.previousPrompt=va;return Qc.return(Ja.promise.finally(va.activate(Ua),function(){return Ub&&Ub.focus()}))})}))})}},{key:"withRequesterDo",value:function(va,Ua){var mb=this,Ub,yc,Pc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Zc){switch(Zc.nextAddress){case 1:yc=mb.visibleBounds().center();if(!va){Zc.jumpTo(2);break}yc=va.globalBounds().center();va.isWorld&&(yc=va.visibleBounds().center());if(!(Ub=va.getWindow())){Zc.jumpTo(2);break}return Zc.yield(Ub.toggleFader(!0),4);case 4:yc=
Ub.globalBounds().center();case 2:return Zc.yield(Ua(yc),5);case 5:return Pc=Zc.yieldResult,Ub&&Ub.toggleFader(!1),Zc.return(Pc)}})}},{key:"inform",value:function(va,Ua){Ua=void 0===Ua?{fontSize:16,requester:null,animated:!0}:Ua;return this.openPrompt(new Ja.InformPrompt(Object.assign({label:void 0===va?"no message":va},Ua)),Ua)}},{key:"prompt",value:function(va,Ua){Ua=void 0===Ua?{requester:null,input:"",historyId:null,useLastInput:!1,selectInput:!1}:Ua;va=new Ja.TextPrompt(Object.assign({label:va},
Ua));Ua.forceConfirm&&va.get("cancel button").disable();return this.openPrompt(va,Ua)}},{key:"editPrompt",value:function(va,Ua){Ua=void 0===Ua?{requester:null,input:"",historyId:null,useLastInput:!1,textStyle:null,mode:null,evalEnvironment:null}:Ua;return this.openPrompt(new Ja.EditPrompt(Object.assign({label:va},Ua)),Ua)}},{key:"passwordPrompt",value:function(va,Ua){Ua=void 0===Ua?{requester:null,input:""}:Ua;return this.openPrompt(new Ja.PasswordPrompt(Object.assign({label:va},Ua)),Ua)}},{key:"confirm",
value:function(va,Ua){Ua=void 0===Ua?{requester:null,animated:!0}:Ua;return this.openPrompt(new Ja.ConfirmPrompt(Object.assign({label:va},Ua)),Ua)}},{key:"multipleChoicePrompt",value:function(va,Ua){Ua=void 0===Ua?{requester:null,animated:!0,choices:[]}:Ua;return this.openPrompt(new Ja.MultipleChoicePrompt(Object.assign({label:va},Ua)),Ua)}},{key:"listPrompt",value:function(va,Ua,mb){va=void 0===va?"":va;Ua=void 0===Ua?[]:Ua;mb=void 0===mb?{requester:null,onSelection:null,preselect:0}:mb;return this.openPrompt(new Ja.ListPrompt(Object.assign({filterable:!1,
padding:Ja.Rectangle.inset(3),label:va,items:Ua},mb)),mb)}},{key:"filterableListPrompt",value:function(va,Ua,mb){va=void 0===va?"":va;Ua=void 0===Ua?[]:Ua;mb=void 0===mb?{requester:null,onSelection:null,preselect:0,multiSelect:!1,historyId:null,fuzzy:!1,actions:["default"],selectedAction:"default",theme:"dark"}:mb;return mb.prompt?(va=mb.prompt.get("list"),va.items=Ua,va.selectedIndex=mb.preselect||0,this.openPrompt(mb.prompt,mb)):this.openPrompt(new Ja.ListPrompt(Object.assign({filterable:!0,padding:Ja.Rectangle.inset(3),
label:va,items:Ua},mb)),mb)}},{key:"editListPrompt",value:function(va,Ua,mb){Ua=void 0===Ua?[]:Ua;mb=void 0===mb?{requester:null,multiSelect:!0,historyId:null}:mb;return this.openPrompt(new Ja.EditListPrompt(Object.assign({label:void 0===va?"":va,multiSelect:!0,items:Ua,padding:Ja.Rectangle.inset(3)},mb)),mb)}},{key:"showLoadingIndicatorFor",value:function(va,Ua){return this.addMorph(Ja.LoadingIndicator.open(Ua,{center:va.globalBounds().center()}))}},{key:"defaultMenuItems",value:function(va,Ua){function mb(de){var kf=
this,Qe=yc.morphsContainingPoint(Zc.worldPoint(Ja.pt(0,0)));Qe.pop();var Ke=Qe.indexOf(Zc);Qe=Qe.slice(Ke+1);return Qe.map(function(Pf){return[String(Pf),de.bind(kf,Pf)]})}var Ub=this,yc=this,Pc=[],Zc=va;this.reset&&"function"===typeof this.reset&&Pc.push(["Reset",function(){Ub.reset()}]);Pc.push(["Open in...",[["Window",function(){Zc.openInWindow()}]]]);Pc.push(["Add morph to...",{getItems:mb.bind(Zc,function(de){return de.addMorph(Zc)})}]);Pc.push(["Get halo on...",{getItems:mb.bind(Zc,function(de){return de.world().showHaloFor(de)})}]);
Zc.owner&&1<Zc.owner.submorphs.length&&Pc.push(["Arrange morph",[["Bring to front",function(){return Zc.owner.addMorph(Zc)}],["Send to back",function(){return Zc.owner.addMorphBack(Zc)}],["Fit to submorphs",function(){var de,kf,Qe;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ke){if(1==Ke.nextAddress)return Ke.yield(Zc.world().prompt("Padding around submorphs:",{input:"Rectangle.inset(5)",historyId:"lively.morphic-fit-to-submorphs-padding-hist",requester:Zc}),2);if(3!=Ke.nextAddress)return de=
Ke.yieldResult,"string"!==typeof de?Ke.return():Ke.yield(Ja.runEval(de,{topLevelVarRecorder:{Rectangle:Ja.Rectangle}}),3);kf=Ke.yieldResult;de=(Qe=kf.value)&&Qe.isRectangle?Qe:Ja.Rectangle.inset(0);Zc.undoStart("fitToSubmorphs");Zc.fitToSubmorphs(de);Zc.undoStop("fitToSubmorphs");Ke.jumpToEnd()})}]].concat($jscomp.arrayFromIterable(Ja.PropertyPath("master.auto").get(Zc)?[["Adjust to Master Component Submorph Hierarchy",function(){return Zc.master.reconcileSubmorphs()}]]:[]))]);this.submorphs.length&&
Pc.push(["Select all submorphs",function(){return Zc.world().showHaloFor(Zc.submorphs.slice())}]);var Qc=[];Zc.startSteppingScripts?Qc.push(["Start stepping",function(){Zc.startSteppingScripts()}]):Qc.push(["Start stepping",function(){var de,kf,Qe,Ke,Pf,xg,Eg,$g,Kg,Qg,Hi,Mi,Kf,Ui,Rg,ah,ci,rf,aj,mc,vd,ee,ye,jg,mg;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ah){switch(Ah.nextAddress){case 1:return de=[],kf=$jscomp,Qe=kf.makeIterator,Ah.yield(Ja.completions.getCompletions(function(){return Zc},
""),2);case 2:Ke=Qe.call(kf,Ah.yieldResult.completions);for(Pf=Ke.next();!Pf.done;Pf=Ke.next())for(xg=Pf.value,Eg=$jscomp.makeIterator(xg),$g=Eg.next().value,Kg=Eg.next().value,Qg=$jscomp.makeIterator(Kg),Hi=Qg.next();!Hi.done;Hi=Qg.next())Mi=Hi.value,Mi.startsWith("_")||Mi.startsWith("$")||(Kf=$jscomp.makeIterator(Mi.match(/^([^\(]+)\(?([^\)]+)?\)?$/)||[]),Kf.next(),Ui=Kf.next().value,Rg=Kf.next().value,Ui&&"function"===typeof Zc[Ui]&&de.push({isListItem:!0,string:$g+" "+Mi,value:{selector:Ui,args:Rg}}));
return Ah.yield($world.filterableListPrompt("Select method to start",de,{requester:Zc,historyId:"lively.morphic-start-stepping-chooser"}),3);case 3:return ah=Ah.yieldResult,ci=$jscomp.makeIterator(ah.selected),(rf=ci.next().value)?Ah.yield($world.prompt("Steptime in ms (how of the method will be called)?",{input:100}),4):Ah.return();case 4:aj=Ah.yieldResult;aj=Number(aj);if(isNaN(aj))return Ah.return();mc=[aj,rf.selector];if(!rf.args){Ah.jumpTo(5);break}vd={targetModule:"lively://lively.morphic-stepping-args/eval.js"};
return Ah.yield($world.editPrompt("Arguments to pass",{input:"["+rf.args+"]",mode:"js",evalEnvironment:vd}),6);case 6:return ee=Ah.yieldResult,Ah.yield(Ja.runEval(ee,vd),7);case 7:ye=Ah.yieldResult;jg=ye.value;if(mg=ye.isError)return $world.inform("Error evaluating the arguments: "+jg),Ah.return();Array.isArray(jg)&&mc.push.apply(mc,$jscomp.arrayFromIterable(jg));case 5:Zc.startStepping.apply(Zc,$jscomp.arrayFromIterable(mc)),Ah.jumpToEnd()}})}]);0!=Zc.tickingScripts.length&&Qc.push(["Stop stepping",
function(){return Zc.stopStepping()}]);0!=Qc.length&&Pc.push(["Stepping",Qc]);Pc.push(["Change Tooltip",function(){var de;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kf){if(1==kf.nextAddress)return de=Zc,kf.yield(Zc.world().prompt("Enter Tooltip",{placeholder:"Description",input:Zc.tooltip||""}),2);de.tooltip=kf.yieldResult;kf.jumpToEnd()})}]);var Ld=["Morphic properties",[]];Pc.push(Ld);Pc.push(["display serialization info",function(){var de,kf,Qe;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ke){if(1==
Ke.nextAddress)return Ke.yield(System.import("lively.serializer2/debugging.js"),2);de=Ke.yieldResult;kf=de.SnapshotInspector;Qe=Ja.serialize(Zc);kf.forSnapshot(Qe).openSummary();Ke.jumpToEnd()})}]);Pc.push(["display object report",function(){var de,kf,Qe;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ke){if(1==Ke.nextAddress)return Ke.yield(System.import("lively.serializer2/debugging.js"),2);de=Ke.yieldResult;kf=de.SnapshotInspector;Qe=Ja.serialize(Zc);kf.forSnapshot(Qe).openObjectReport();
Ke.jumpToEnd()})}]);var we=Ja.Icon.textAttribute("check-square"),af=Ja.Icon.textAttribute("square");Object.assign(we[1],{float:"none",display:"inline"});["grabbable","draggable","acceptsDrops","halosEnabled"].forEach(function(de){return Ld[1].push([[].concat($jscomp.arrayFromIterable(va[de]?we:af),[" "+de,{float:"none"}]),function(){return va[de]=!va[de]}])});Pc.push(["export to HTML",function(){var de,kf,Qe,Ke;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pf){if(1==Pf.nextAddress)return Pf.yield(System.import("lively.morphic/rendering/html-generator.js"),
2);if(3!=Pf.nextAddress)return de=Pf.yieldResult,kf=de.generateHTML,Qe=Ja.HTMLMorph,Ke="exported-"+va.name,Pf.yield(kf(va,null,{isFragment:!0,addStyles:!1}),3);(new Qe({name:Ke,html:Pf.yieldResult})).openInWorld();Pf.jumpToEnd()})}]);Pc.push({isDivider:!0});Pc.push(["Add comment",function(){var de,kf,Qe,Ke;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pf){if(1==Pf.nextAddress)return Pf.yield($world.prompt("Enter comment"),2);if(4!=Pf.nextAddress){de=Pf.yieldResult;if(!de)return $world.setStatusMessage("Comment not saved",
"red"),Pf.jumpTo(0);kf=Ja.pt(0,0);Ua&&!Ua.halo&&(Qe=Zc.localize(Ua.position).x/Zc.width,Ke=Zc.localize(Ua.position).y/Zc.height,kf=Ja.pt(Qe,Ke));return Pf.yield(Zc.addComment(de,kf),4)}$world.setStatusMessage("Comment saved","green");Pf.jumpToEnd()})}]);return Pc}},{key:"defaultConnectionMenuItems",value:function(va){return va.attributeConnections&&va.attributeConnections.length?va.attributeConnections.map(function(Ua){return[String(Ua),[["show",function(){var mb,Ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yc){if(1==
yc.nextAddress)return yc.yield(System.import("lively.ide/fabrik.js"),2);mb=yc.yieldResult;Ub=mb.interactivelyShowConnection;Ub(Ua);yc.jumpToEnd()})}],["edit",function(){var mb,Ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yc){if(1==yc.nextAddress)return yc.yield(System.import("lively.ide/fabrik.js"),2);mb=yc.yieldResult;Ub=mb.interactivelyReEvaluateConnection;Ub(Ua);yc.jumpToEnd()})}],["disconnect",function(){Ua.disconnect();$world.setStatusMessage("disconnected "+Ua)}]]]}):null}},
{key:"defaultSourceDataBindings",value:function(va){var Ua=va.propertiesAndPropertySettings().properties,mb=Ja.arr.groupByKey(Object.keys(Ua).map(function(yc){yc=Object.assign({name:yc},Ua[yc]);return yc.group&&yc.group.startsWith("_")?null:yc}).filter(Boolean),"group");va=["core","geometry","interaction","styling","layouting"];var Ub=[];va.forEach(function(yc){return Ub.push(mb[yc])});Ja.arr.withoutAll(mb.keys(),va).forEach(function(yc){return Ub.push(mb[yc])});return Ub}},{key:"targetDataBindings",
value:function(va){for(var Ua=[],mb=va;mb!==Object.prototype;){var Ub=mb===va?String(this):Ja.getClassName(mb),yc=null,Pc=Ja.obj.getOwnPropertyDescriptors(mb),Zc=Object.getPrototypeOf(mb),Qc;for(Qc in Pc){var Ld=Pc[Qc].value;"function"!==typeof Ld||Ld===mb.constructor||Qc.startsWith("$")||Qc.startsWith("_")||(yc||(yc=[]),Ld=Ja.fun.argumentNames(Ld),yc.push({group:Ub+" methods",signature:Qc+"("+Ld.join(", ")+")",name:Qc}))}yc&&Ua.push(yc);mb=Zc}return this.defaultSourceDataBindings(va).concat(Ua)}},
{key:"defaultConnectMenuItems",value:function(va,Ua){var mb=this,Ub=this.defaultSourceDataBindings(Ua),yc=Ua.world();Ub=Ub.map(function(Pc){return[Pc[0].group||"uncategorized",Pc.map(function(Zc){return[Zc.name,va?function(){return va(Zc.name,Ua,Zc)}:function(){var Qc,Ld;return $jscomp.asyncExecutePromiseGeneratorProgram(function(we){if(1==we.nextAddress)return we.yield(System.import("lively.ide/fabrik.js"),2);Qc=we.yieldResult;Ld=Qc.interactiveConnectGivenSource;Ld(Ua,Zc.name);we.jumpToEnd()})}]})]});
yc&&Ub.push(["custom...",va?function(){return va("custom...",Ua,null)}:function(){var Pc,Zc,Qc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ld){if(1==Ld.nextAddress)return Ld.yield(System.import("lively.ide/fabrik.js"),2);if(3!=Ld.nextAddress)return Pc=Ld.yieldResult,Zc=Pc.interactiveConnectGivenSource,Ld.yield(yc.prompt("Enter custom connection point",{requester:Ua,historyId:"lively.morphic-custom-connection-points",useLastInput:!0}),3);(Qc=Ld.yieldResult)&&Zc(mb,Qc);Ld.jumpToEnd()})}]);
return Ub}},{key:"updateVisibleWindowMorphs",value:function(){var va=this;Sc._get(Object.getPrototypeOf(Fb.prototype),"updateVisibleWindowMorphs",this).call(this);this.halos().forEach(function(Ua){Ua.maskBounds=va.visibleBounds()})}},{key:"handleHaloCycle",value:function(va){var Ua=va.state.clickedOnMorph,mb=va.isCommandKey(),Ub=va.isShiftDown(),yc;mb&&!Ua.isHalo&&(mb=yc=va.world.morphsContainingPoint(va.position),yc=yc.filter(function(Pc){return Pc.halosEnabled}),mb=mb.filter(function(Pc){return Pc.halosEnabled}),
yc=mb[0]||yc[0]);Ub&&!Ua.isHaloItem&&yc&&va.halo&&va.halo.borderBox!=yc?va.halo.addMorphToSelection(yc):(Ua=va.halo&&!va.targetMorphs.find(function(Pc){return Pc.isHaloItem||Pc.keepHalo&&Pc.keepHalo(va)}),Ub=va.layoutHalo&&!va.targetMorphs.find(function(Pc){return Pc.isHaloItem}),mb=(!va.halo||Ua)&&yc,Ub&&va.layoutHalo.remove(),Ua&&va.halo.remove(),mb&&(va.stop(),this.showHaloFor(yc,va.domEvt.pointerId)))}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"LivelyWorld"}},{key:"properties",
get:function(){return{localComponents:{initialize:function(){var va=this;this.whenRendered().then(function(){va.localComponents?va.localComponents.forEach(function(Ua){var mb,Ub,yc,Pc,Zc,Qc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ld){switch(Ld.nextAddress){case 1:if(Ua.owner){Ld.jumpTo(0);break}mb=Ua.withAllSubmorphsSelect(function(we){return we.master&&!we.master._appliedMaster});Ub=$jscomp.makeIterator(mb);yc=Ub.next();case 3:if(yc.done){Ld.jumpTo(5);break}Pc=yc.value;return Ld.yield(Pc.master.applyIfNeeded(!0),
4);case 4:yc=Ub.next();Ld.jumpTo(3);break;case 5:Zc=va.withAllSubmorphsSelect(function(we){return we.master&&we.master.uses(Ua)}),Qc=va.localComponents.filter(function(we){return we.master&&we.master.uses(Ua)}),Zc.forEach(function(we){we.requestMasterStyling()}),Qc.forEach(function(we){return we.master.applyIfNeeded(!0)}),Ld.jumpToEnd()}})}):va.localComponents=va.withAllSubmorphsSelect(function(Ua){return Ua.isComponent})})}},name:{set:function(va){this.setProperty("name",va);document.title="lively.next - "+
va}},hiddenComponents:{initialize:function(){this.hiddenComponents=[]}},fill:{defaultValue:Ja.Color.rgb(81,90,90)},draggable:{readOnly:!0,get:function(){return!Ja.touchInputDevice}},commentBrowser:{}}}}],ba,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:1664,end:42380})}(Ja.World));Ja.LivelyWorld=
cb;Ja.LivelyWorld=cb;Ja.LivelyWorld=cb;cb=Wa("SelectionElement",function(Sa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),Fb=ba.hasOwnProperty("SelectionElement")&&"function"===typeof ba.SelectionElement?ba.SelectionElement:ba.SelectionElement=function(va){va&&va[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Sc(Fb,Sa,void 0,[{key:Symbol.for("__LivelyClassName__"),get:function(){return"SelectionElement"}},{key:"properties",
get:function(){return{borderColor:{defaultValue:Ja.Color.red},borderWidth:{defaultValue:1},fill:{defaultValue:Ja.Color.transparent},epiMorph:{defaultValue:!0},isSelectionElement:{readOnly:!0,get:function(){return!0}}}}}],ba,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:42389,end:42751})}(Ja.Morph));
Ja.SelectionElement=cb;Ja.SelectionElement=cb;Ja.SelectionElement=cb;cb=Wa("Selection",function(Sa){var ba=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),Fb=ba.hasOwnProperty("Selection")&&"function"===typeof ba.Selection?ba.Selection:ba.Selection=function(va){va&&va[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Sc(Fb,Sa,void 0,[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Selection"}},{key:"properties",
get:function(){return{fill:{defaultValue:Ja.Color.gray.withA(.2)},borderWidth:{defaultValue:2},borderColor:{defaultValue:Ja.Color.gray},isSelectionElement:{readOnly:!0,get:function(){return!0}}}}}],ba,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:42760,end:43080})}(Ja.Morph));Ja.Selection=cb;
Ja.Selection=cb;Ja.Selection=cb}}});