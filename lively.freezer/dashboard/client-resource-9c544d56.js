System.register(["./__root_module__-255c8c26.js","kld-intersections","./client-command-a1095064.js"],function(Da){var Ab,Tb,kc,ec,he,gd;return{setters:[function(Zd){Ab=Zd.s;Tb=Zd._;kc=Zd.a5;ec=Zd.bE;he=Zd.a6},function(){},function(Zd){gd=Zd.runCommand}],execute:function(){function Zd(db,Fb){var tc,nc,td,ke,zc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ec){if(1==Ec.nextAddress)return tc=Od.fileInfoCommandString(db,Fb),nc=Od.runCommand(tc,Fb),Ec.yield(nc.whenDone(),2);if(td=0!=
nc.exitCode?nc.output:null)throw td;ke=$jscomp.makeIterator(Od.parseDirectoryListFromLs(nc.stdout,Fb.rootDirectory||"."));zc=ke.next().value;return Ec.return(zc)})}function kd(db,Fb){return Od.string.lines(db).map(function(tc){return tc.trim().length?(new Od.FileInfo(Fb)).readFromDirectoryListLine(tc):null}).filter(Boolean)}function Sc(db,Fb){var tc,nc,td,ke,zc,Ec,Pb,Qb,Tc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ld){tc=Object.assign({findFilesGroup:"default-find-files-process"},
Fb);nc=tc.findFilesGroup;td=tc.rootDirectory;zc=ke=Od.findFilesProcesses[nc]||(Od.findFilesProcesses[nc]={promiseState:null,commands:[]});Ec=zc.commands;Pb=zc.promiseState;Pb||(ke.promiseState=Pb=Od.promise.deferred());Qb=Od.findFilesCommandString(db,Fb);Ec.forEach(function(Rb){return Rb.kill()});Tc=Od.runCommand(Qb,Fb);Ec.push(Tc);Tc.whenDone().then(function(){Od.arr.remove(Ec,Tc);if(Ec.some(function(qb){return qb.startTime>Tc.startTime}))console.log("[findFiles] command "+Tc+" exited but a newer findFiles command was started for group "+
nc+", discarding output");else{var Rb=0!=Tc.exitCode?Tc.output:null;Rb&&console.warn(Rb);Rb=Rb?[]:Od.parseDirectoryListFromLs(Tc.stdout,td)||[];Pb.resolve(Rb);Object.assign(ke,{promiseState:null,commands:[]})}}).catch(function(Rb){return console.error(Rb)});return ld.return(Pb.promise)})}function yd(db){function Fb(tc){return Array.prototype.concat.apply([tc],tc.children?tc.children.map(Fb):[])}return Fb(db).map(function(tc){var nc=tc.fullPath.replace(/^\//,"");return{fileName:nc,path:nc,rootDirectory:"./",
isDirectory:tc.isDirectory,isLink:void 0,lastModified:void 0,linkCount:void 0,mode:void 0,size:void 0,group:void 0,user:void 0}})}var Od=lively.FreezerRuntime.recorderFor("lively.shell/client-fs-helper.js");Od.fileInfo=Zd;Od.fileInfoCommandString=function(db,Fb){var tc=Fb=void 0===Fb?{}:Fb;Fb=tc.rootDirectory;tc=tc.platform;Fb=Fb||".";var nc="win32"===tc?"\\":"/";"win32"===tc||Fb.endsWith(nc)||(Fb+=nc);return"win32"===tc?"cd "+Fb+' && ls -lLd --time-style=locale "'+db+'"':'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && env TZ=GMT LANG=en_US.UTF-8 cd '+
(Fb+' && ls -lLd "$timeformat" "'+db+'"')};Od.parseDirectoryListFromLs=kd;Od.findFiles=Sc;Od.findFilesCommandString=function(db,Fb){var tc=Fb=void 0===Fb?{}:Fb,nc=tc.rootDirectory,td=tc.exclude,ke=tc.depth;tc=tc.platform;nc=nc||".";td=td||"-iname "+Od.defaultExcludes.map(Od.string.print).join(" -o -iname ");var zc="win32"===tc?"\\":"/";"win32"===tc||nc.endsWith(zc)||(nc+=zc);db=Od.string.format('%s "%s"',Fb.re?"-iregex":Fb.matchPath?"-ipath":"-iname",db);ke="number"===typeof ke?" -maxdepth "+ke:"";
return"win32"===tc?Od.string.format("find %s %s ( %s ) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd --time-style=locale {}",nc,Fb.re?"-E ":"",td.replace(/"/g,""),db.replace(/"/g,""),ke):'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && '+Od.string.format('env TZ=GMT LANG=en_US.UTF-8 find %s %s \\( %s \\) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd "$timeformat" "{}"',nc,Fb.re?"-E ":"",td,db,ke)};Od.convertDirectoryUploadEntriesToFileInfos=
yd;Od.runCommand=gd;Od.string=Ab;Od.promise=Tb;Od.arr=kc;Od.fileInfo=Zd;Od.fileInfo=Zd;Od.parseDirectoryListFromLs=kd;Od.parseDirectoryListFromLs=kd;var fe=function(db){this.rootDirectory=db;this.fileName=this.path="";this.isDirectory=!1;this.lastModified=null;this.mode="";this.isLink=!1;this.linkCount=0;this.group=this.user="";this.size=0;this.rootDirectory=null};fe.prototype.readFromDirectoryListLine=function(db){var Fb=this;if(!db.trim().length)return null;var tc=db;this.reader.forEach(function(nc){return tc=
nc(tc,Fb)});return this};fe.prototype.toString=function(){return this.path};$jscomp.global.Object.defineProperties(fe.prototype,{reader:{configurable:!0,enumerable:!0,get:function(){return[function(db,Fb){var tc=db.indexOf(" ");Fb.mode=db.slice(0,tc);Fb.isDirectory="d"===Fb.mode[0];return db.slice(tc+1).trim()},function(db,Fb){var tc=db.indexOf(" ");Fb.linkCount=Number(db.slice(0,tc));return db.slice(tc+1).trim()},function(db,Fb){var tc=db.indexOf(" ");Fb.user=db.slice(0,tc);return db.slice(tc+1).trim()},
function(db,Fb){var tc=Od.string.peekRight(db,0,/\s+[0-9]/);Fb.group=db.slice(0,tc).trim();return db.slice(tc).trim()},function(db,Fb){var tc=db.indexOf(" ");Fb.size=Number(db.slice(0,tc));return db.slice(tc+1).trim()},function(db,Fb){var tc=Od.string.reMatches(db,/[^s]+\s+[0-9:\s]+/);if(!tc||!tc[0])return db;Fb.lastModified=new Date(tc[0].match+" GMT");return db.slice(tc[0].end).trim()},function(db,Fb){var tc=(db=db.replace(/^\.\/+/g,"").replace(/\/\//g,"/"))&&db.split(" -> "),nc=""===db?!1:db&&
2===tc.length,td=(tc=nc?tc[0]:db)&&0===tc.indexOf(Fb.rootDirectory)?tc.slice(Fb.rootDirectory.length):tc;Fb.fileName=""===db?".":td;Fb.path=tc;Fb.isLink=nc;return td}]}}});Od.FileInfo=fe;Od.findFilesProcesses={};Od.findFiles=Sc;Od.findFiles=Sc;Od.defaultExcludes=[".svn",".git","node_modules",".module_cache"];Od.convertDirectoryUploadEntriesToFileInfos=yd;Od.convertDirectoryUploadEntriesToFileInfos=yd;var Ud=lively.FreezerRuntime.recorderFor("lively.shell/client-resource.js");Ud.Resource=ec;Ud.runCommand=
gd;Ud.fileInfo=Zd;Ud.findFiles=Sc;Ud.string=Ab;Ud.promise=Tb;Ud.arr=kc;Ud.obj=he;fe=function(db,Fb,tc){tc=void 0===tc?{}:tc;db=Ud.Resource.call(this,db)||this;db.options=Object.assign({},tc,{l2lClient:Fb||db.constructor.defaultL2lClient});return db};$jscomp.inherits(fe,Ud.Resource);fe.prototype.newResource=function(db){return new this.constructor(db,this.options.l2lClient,this.options)};fe.prototype.read=function(){var db=this,Fb=Ud.runCommand('cat "'+this.url+'"',this.options);return Fb.whenDone().then(function(){if(Fb.exitCode)throw Error("Read "+
db.url+" failed: "+Fb.stderr);return Fb.output})};fe.prototype.write=function(db){var Fb=this,tc,nc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(td){switch(td.nextAddress){case 1:return db?td.yield(Ud.runCommand('touch "'+Fb.url+'" && tee "'+Fb.url+'"',Object.assign({stdin:String(db)},Fb.options)).whenDone(),4):td.yield(Ud.runCommand('echo -n > "'+Fb.url+'"',Object.assign({},Fb.options)).whenDone(),5);case 4:tc=td.yieldResult;td.jumpTo(3);break;case 5:tc=td.yieldResult;case 3:nc=tc;
if(nc.exitCode)throw Error("Write "+Fb.url+" failed: "+nc.stderr);return td.return(Fb)}})};fe.prototype.mkdir=function(){var db=this,Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tc){if(1==tc.nextAddress)return tc.yield(Ud.runCommand('mkdir -p "'+db.url+'"',db.options).whenDone(),2);Fb=tc.yieldResult;if(Fb.exitCode)throw Error(db+" cannot create directory: "+Fb.stderr);return tc.return(db)})};fe.prototype.exists=function(){var db=Ud.runCommand('test -d "'+this.url+'" || test -f "'+
this.url+'"',this.options);return db.whenDone().then(function(){return 0===db.exitCode})};fe.prototype.remove=function(){var db=this,Fb=Ud.runCommand('rm -rf "'+this.url+'"',this.options);return Fb.whenDone().then(function(){if(Fb.exitCode)throw Error("Remove of "+db.url+" failed: "+Fb.stderr);return db})};fe.prototype.gzip=function(db){var Fb=this,tc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nc){tc=Ud.runCommand('gzip > "'+Fb.url+'"',Object.assign({stdin:String(db)},Fb.options));
return nc.return(tc.whenDone().then(function(){if(tc.exitCode)throw Error("Gzip compression of "+Fb.url+" failed: "+tc.stderr);return Fb}))})};fe.prototype.brotli=function(db){var Fb=this,tc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nc){tc=Ud.runCommand('brotli > "'+Fb.url+'"',Object.assign({stdin:String(db)},Fb.options));return nc.return(tc.whenDone().then(function(){if(tc.exitCode)throw Error("Brotli compression of "+Fb.url+" failed: "+tc.stderr);return Fb}))})};fe.prototype.readProperties=
function(){var db=this,Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tc){if(1==tc.nextAddress)return tc.yield(Ud.fileInfo(db.url,db.options),2);Fb=tc.yieldResult;db.assignProperties(Ud.obj.dissoc(Fb,["fileName","path","rootDirectory"]));return tc.return(db)})};fe.prototype.dirList=function(db,Fb){db=void 0===db?1:db;Fb=void 0===Fb?{}:Fb;var tc=this,nc,td,ke,zc,Ec,Pb,Qb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Tc){if(1==Tc.nextAddress)return nc=Fb,td=nc.exclude,
Array.isArray(td)&&(td="-iname "+td.map(Ud.string.print).join(" -o -iname ")),ke=tc,zc=ke.url,Ec=ke.options,Pb=Ec.l2lClient,Tc.yield(Ud.findFiles("*",{exclude:td,depth:db,rootDirectory:zc,l2lClient:Pb}),2);Qb=Tc.yieldResult;Qb[0].path.replace(/\/$/,"")===tc.url.replace(/\/$/,"")&&Qb.shift();return Tc.return(Qb.map(function(ld){var Rb=ld.path;ld.isDirectory&&(Rb=Rb.replace(/\/?$/,"/"));Rb=new tc.constructor(Rb,Pb,tc.options);Rb.assignProperties(Ud.obj.dissoc(ld,["fileName","path","rootDirectory"]));
return Rb}))})};$jscomp.global.Object.defineProperties(fe,{defaultL2lClient:{configurable:!0,enumerable:!0,get:function(){return this._defaultL2lClient||Ud._defaultL2LClient},set:function(db){this._defaultL2lClient=Ud._defaultL2LClient=db}}});Da("default",fe);Ud.ShellClientResource=fe;Ud._defaultL2LClient=Ud._defaultL2LClient||void 0;var md=Da("resourceExtension",{name:"shell-client",matches:function(db){return db.startsWith("/")||db.match(/[a-z]:\\/i)},resourceClass:Ud.ShellClientResource});Ud.resourceExtension=
md;Ud.resourceExtension=md;Ud.resourceExtension=md;Ud.default=fe}}});