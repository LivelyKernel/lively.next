System.register(["./__root_module__-6d2e743c.js","kld-intersections"],function(Ma){var rb,Db,hc,Kb,id,Zc,yd,Kc,sc,bd,hd,se,xe,ne;return{setters:[function(Rc){rb=Rc.b0;Db=Rc.b;hc=Rc.r;Kb=Rc._;id=Rc.a;Zc=Rc.Z;yd=Rc.bx;Kc=Rc.a$;sc=Rc.i;bd=Rc.c;hd=Rc.by;se=Rc.bz;xe=Rc.N;ne=Rc.bA},function(){}],execute:function(){function Rc(Ub){try{var Ga=eval("("+Mb.ast.transform.wrapInFunction("var _; _ = ("+Ub+")")+")()")}catch(jb){return JSON.parse(Ub)}return"object"!==typeof Ga?null:Ga}function Pd(Ub,Ga){var jb,
X,ha,Fa,Ja,Ca,ra,tb,Na;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lc){switch(lc.nextAddress){case 1:return jb=Ga.world(),lc.yield(jb.prompt("Enter package name",{requester:Ga,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:X=lc.yieldResult;if(!X)throw"Canceled";lc.setCatchFinallyBlocks(3);Fa=ub.resource(X);X=Fa.name();ha=Fa.url;lc.leaveTryBlock(4);break;case 3:return lc.enterCatchBlock(),lc.yield(Ub.getConfig(),5);case 5:return Ja=lc.yieldResult.baseURL,
Ca=ub.resource(Ja).join(X).asDirectory().url,lc.yield(Ub.normalize(Ca),6);case 6:ha=lc.yieldResult.replace(/\/\.js$/,"/");case 4:return lc.yield(jb.prompt("Confirm or change package location",{requester:Ga,input:ha,historyId:"lively.vm-editor-add-package-address"}),7);case 7:ra=lc.yieldResult;if(!ra)throw"Canceled";tb=ub.resource(ra).asDirectory();Na=tb.asFile().url;return lc.yield(Ub.removePackage(Na),8);case 8:return lc.yield(Ub.resourceCreateFiles(Na,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+
X+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+X+"\n\nNo description for package "+X+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+X+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return lc.return(ub.loadPackage(Ub,{name:X,address:Na,configFile:tb.join("package.json").url,main:tb.join("index.js").url,test:tb.join("tests/test.js").url,type:"package"}))}})}function Hb(Ub,Ga,jb){jb=void 0===jb?null:
jb;var X,ha,Fa,Ja,Ca,ra,tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Na){switch(Na.nextAddress){case 1:return X={name:"",address:"",type:"package"},Na.yield(Ub.getConfig(),2);case 2:ha=Na.yieldResult;if(!jb){Na.jumpTo(3);break}return Na.yield(Ub.getPackage(jb),4);case 4:if(Fa=Na.yieldResult){Na.jumpTo(5);break}return Na.yield(Ub.getPackageForModule(jb),6);case 6:Fa=Na.yieldResult;case 5:Ja=Fa;case 3:return Na.yield(Ga.world().prompt("What is the package directory?",{requester:Ga,
input:Ja?Ja.address:ha.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:Ca=Na.yieldResult;if(!Ca)throw"Canceled";X.address=Ca.replace(/\/$/,"");X.url=new ub.URL(X.address+"/");X.configFile=ub.resource(X.url).join("package.json").url;Na.setCatchFinallyBlocks(8);ra=JSON;tb=ra.parse;return Na.yield(Ub.moduleRead(X.configFile),10);case 10:tb.call(ra,Na.yieldResult).name;Na.leaveTryBlock(9);break;case 8:Na.enterCatchBlock(),X.name=String(X.url).replace(/\/$/,""),Ub.resourceEnsureExistance(X.configFile,
'{\n  "name": "'+X.name+'",\n  "version": "0.1.0"\n}');case 9:return Na.return(ub.loadPackage(Ub,X))}})}function Gc(Ub,Ga,jb){var X,ha,Fa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){switch(Ja.nextAddress){case 1:return X=ub.resource(jb).asFile().url,Ja.yield(Ub.getPackage(X),2);case 2:if(ha=Ja.yieldResult){Ja.jumpTo(3);break}return Ja.yield(Ub.getPackageForModule(X),4);case 4:ha=Ja.yieldResult;case 3:Fa=ha;if(!Fa)throw Error("Cannot find package for "+X);return Ja.yield(Ub.reloadPackage(X),
5);case 5:if(!Ga){Ja.jumpTo(0);break}return Ja.yield(Ga.updateModuleList(),7);case 7:return Ja.yield(Ga.uiSelect(X,!1),8);case 8:return Ja.return(Ja.yieldResult)}})}function ud(Ub,Ga,jb,X){var ha,Fa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){switch(Ja.nextAddress){case 1:return Ja.yield(Ub.getPackage(jb),2);case 2:return ha=Ja.yieldResult,Ja.yield((X||$world).confirm("Unload package "+ha.name+"?",{requester:Ga}),3);case 3:Fa=Ja.yieldResult;if(!Fa)throw"Canceled";return Ja.yield(Ub.removePackage(jb),
4);case 4:if(!Ga){Ja.jumpTo(0);break}return Ja.yield(Ga.updateModuleList(),6);case 6:return Ja.yield(Ga.uiSelect(null),0)}})}function Vc(Ub,Ga,jb){var X,ha,Fa,Ja,Ca;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){switch(ra.nextAddress){case 1:return X=Ga.world(),ra.yield(Ub.getPackage(jb),2);case 2:return ha=ra.yieldResult,ha?ra.yield(X.confirm("Really remove package "+ha.name+"?",{requester:Ga}),3):($world.inform('No package "'+jb+'" found!',{requester:Ga}),ra.return());case 3:Fa=
ra.yieldResult;if(!Fa)throw"Canceled";Ub.removePackage(jb);return ra.yield(X.confirm("Also remove directory "+ha.name+" including "+ha.modules.length+" modules?"),4);case 4:Ja=ra.yieldResult;if(!Ja){ra.jumpTo(0);break}return ra.yield(X.confirm("REALLY *remove* directory "+ha.name+"? No undo possible..."),6);case 6:if(Ca=ra.yieldResult)return ra.yield(Ub.resourceRemove(ha.address),0);ra.jumpTo(0)}})}function Id(Ub,Ga,jb){jb=void 0===jb?$world:jb;var X,ha,Fa,Ja,Ca,ra,tb,Na,lc,kd,Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(md){switch(md.nextAddress){case 1:return md.yield(Ub.getPackage(Ga),
2);case 2:X=md.yieldResult;if(!X)throw Error("Cannot find package "+Ga);ha=[];Fa=$jscomp.makeIterator(X.modules);Ja=Fa.next();case 3:if(Ja.done)return md.yield(jb.execCommand("open text window",{title:"imports and exports of "+Ga,content:ha.join("\n\n")}),0);Ca=Ja.value;if(!Ca.name.match(/\.js$/)){md.jumpTo(4);break}md.setCatchFinallyBlocks(6);ra=Ub;tb=ra.importsAndExportsOf;Na=Ca.name;return md.yield(Ub.moduleRead(Ca.name),9);case 9:return md.yield(tb.call(ra,Na,md.yieldResult),8);case 8:lc=md.yieldResult;
md.leaveTryBlock(7);break;case 6:kd=md.enterCatchBlock();jb.logError(Error("Error when getting imports/exports from module "+Ca.name+":\n"+kd.stack));md.jumpTo(4);break;case 7:Tb=""+Ca.name;if(!lc.imports.length&&!lc.exports.length){Tb+="\n  does not import / export anything";md.jumpTo(4);break}lc.imports.length&&(Tb+="\n  imports:\n",Tb+=ub.arr.groupByKey(lc.imports,"fromModule").mapGroups(function(wb,je){return"from "+wb+": "+je.map(function(bf){return bf.local||bf.imported?bf.imported&&bf.imported!==
bf.local?bf.imported+" as "+bf.local:bf.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(wb){return"    "+wb}).join("\n"));lc.exports.length&&(Tb+="\n  exports:\n",Tb+=lc.exports.map(function(wb){return wb.local?wb.local&&wb.local!==wb.exported?wb.local+" as "+wb.exported:wb.exported:wb.exported+" from "+wb.fromModule}).join(", ").split("\n").map(function(wb){return"    "+wb}).join("\n"));ha.push(Tb);case 4:Ja=Fa.next(),md.jumpTo(3)}})}function ie(Ub){return Ub.match(/import.*['"]mocha(-es6)?['"]/)&&
Ub.match(/it\(['"]/)}function Fb(Ub,Ga,jb){jb=jb&&jb.address;if(jb&&0===Ga.indexOf(jb))var X=Ga.slice(jb.length).replace(/^\//,"");else a:{jb=Ub.getConfig();if(!jb||jb.constructor!==Promise)try{X=String((new rc.URL(Ga)).relativePathFrom(new rc.URL(Ub.getConfig().baseURL)));break a}catch(ha){}X=Ga}return X}function Ac(Ub,Ga,jb,X){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){return 1==ha.nextAddress?(X=Object.assign({targetModule:Ga},X),ha.yield(Ub.normalize(Ga),2)):3!=ha.nextAddress?
(Ga=ha.yieldResult,ha.yield(Ub.moduleSourceChange(Ga,jb,X),3)):ha.return(Ga)})}function $c(Ub,Ga,jb,X,ha){X=void 0===X?!1:X;ha=void 0===ha?!1:ha;var Fa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){switch(Ja.nextAddress){case 1:return Ga&&Ga.setStatusMessage("Reloading "+jb),Ja.setCatchFinallyBlocks(2),Ja.yield(Ub.reloadModule(jb,{reloadDeps:X,resetEnv:ha}),4);case 4:if(!Ga){Ja.jumpTo(5);break}return Ja.yield(Ga.updateModuleList(),6);case 6:case 5:Ga&&Ga.setStatusMessage("Reloded "+
jb);Ja.leaveTryBlock(0);break;case 2:Fa=Ja.enterCatchBlock();Ja.setCatchFinallyBlocks(7);if(!Ga){Ja.jumpTo(9);break}return Ja.yield(Ga.updateEditorWithSourceOf(jb),10);case 10:case 9:Ja.leaveTryBlock(8);break;case 7:Ja.enterCatchBlock();case 8:throw Ga&&Ga.showError(Fa),Fa;}})}function Bc(Ub,Ga,jb){return $jscomp.asyncExecutePromiseGeneratorProgram(function(X){switch(X.nextAddress){case 1:return X.yield(Ub.forgetModule(jb,{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!Ga){X.jumpTo(3);break}return X.yield(Ga.updateModuleList(),
4);case 4:case 3:X.jumpToEnd()}})}function vd(Ub,Ga,jb){var X,ha,Fa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){switch(Ja.nextAddress){case 1:return Ja.yield(Ub.normalize(jb),2);case 2:return X=Ja.yieldResult,Ja.yield(Ga.world().confirm("Remove file "+X+"?",{requester:Ga}),3);case 3:ha=Ja.yieldResult;if(!ha)throw"Canceled";return Ja.yield(Ub.forgetModule(X),4);case 4:return Ja.yield(Ub.resourceRemove(X),5);case 5:return Ja.yield(Ub.getPackageForModule(X),6);case 6:return Fa=Ja.yieldResult,
Ja.return(Fa)}})}function pb(Ub,Ga,jb){var X,ha,Fa,Ja,Ca,ra,tb,Na;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lc){switch(lc.nextAddress){case 1:return X=rc.URL,lc.yield(Ub.getConfig(),2);case 2:ha=new X(lc.yieldResult.baseURL);Fa=Ga.world();if(!jb){lc.jumpTo(3);break}return lc.yield(Ub.getPackage(jb),4);case 4:if(Ja=lc.yieldResult){lc.jumpTo(5);break}return lc.yield(Ub.getPackageForModule(jb),6);case 6:Ja=lc.yieldResult;case 5:(Ca=Ja)&&(ha=new rc.URL(Ca.address));case 3:return lc.yield(rc._searchForExistingFiles(Ga,
String(ha),Ca),7);case 7:ra=lc.yieldResult;if(!ra.includes("[create new module]")){lc.jumpTo(8);break}return lc.yield(rc._askForModuleName(Ub,jb||String(ha),Fa),9);case 9:tb=lc.yieldResult,ra=[tb];case 8:return lc.yield(rc._createAndLoadModules(Ub,ra),10);case 10:return Na=lc.yieldResult,rc.arr.compact(Na.map(function(kd){return kd.error})),lc.return(Na)}})}function lb(Ub,Ga){var jb,X,ha,Fa,Ja,Ca,ra,tb,Na,lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kd){if(1==kd.nextAddress)return kd.yield(Ub.getPackage(Ga),
2);if(3!=kd.nextAddress){jb=kd.yieldResult;if(!jb||!jb.address.match(/^http/))throw Error("Cannot load package "+Ga);X=rc.resource(jb.address);ha=[];Fa=$jscomp;Ja=Fa.makeIterator;return kd.yield(X.dirList(5,{exclude:rc.modulesInPackage_defaultExclude}),3)}Ca=Ja.call(Fa,kd.yieldResult);for(ra=Ca.next();!ra.done;ra=Ca.next())Na=tb=ra.value,lc=Na.url,lc.match(/\.js$/)&&Ub.isModuleLoaded(lc,!0)&&ha.push(Ub.getModule(lc));return kd.return(ha)})}function Zb(Ub){Ub||(Ub="local");if(Ub.isSystemInterface)var Ga=
Ub;else"string"===typeof Ub&&Ub.startsWith("l2l ")&&(Ub={type:"l2l",id:Ub.split(" ")[1]}),"string"!==typeof Ub&&"l2l"===Ub.type&&(Ga=Vb.l2lInterfaceFor(Ub.id,Ub.info)),"string"!==typeof Ub&&($world.setStatusMessage("Unknown system interface "+Ub),Ub="local"),Ga||(Ga=Ub&&"local"!==Ub?Vb.serverInterfaceFor(Ub):Vb.localInterface);return Ga}Ma("systemInterfaceNamed",Zb);var Mb=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");Mb.parseJsonLikeObj=Rc;Mb.ast=rb;Mb.parseJsonLikeObj=
Rc;Mb.parseJsonLikeObj=Rc;var ub=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");ub.loadPackage=function(Ub,Ga){var jb,X;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){switch(ha.nextAddress){case 1:return ha.yield(Ub.importPackage(Ga.address+"/"),2);case 2:if(!Ga.main){ha.jumpTo(3);break}return ha.yield(Ub.importModule(Ga.main.toString()),3);case 3:if(!Ga.test){ha.jumpTo(5);break}ha.setCatchFinallyBlocks(6);return ha.yield(Ub.importPackage("mocha-es6"),
8);case 8:return jb=ha.yieldResult,ha.yield(jb.installSystemInstantiateHook(),9);case 9:return ha.yield(Ub.importModule(Ga.test.toString()),10);case 10:ha.leaveTryBlock(5);break;case 6:X=ha.enterCatchBlock(),console.warn("Cannot load test of new package: "+X);case 5:return ha.return(Ub.getPackage(Ga.address))}})};ub.interactivelyCreatePackage=Pd;ub.interactivelyLoadPackage=Hb;ub.interactivelyReloadPackage=Gc;ub.interactivelyUnloadPackage=ud;ub.interactivelyRemovePackage=Vc;ub.showExportsAndImportsOf=
Id;ub.parseJsonLikeObj=Rc;ub.arr=Db;ub.resource=hc;ub.interactivelyCreatePackage=Pd;ub.interactivelyCreatePackage=Pd;ub.interactivelyLoadPackage=Hb;ub.interactivelyLoadPackage=Hb;ub.interactivelyReloadPackage=Gc;ub.interactivelyReloadPackage=Gc;ub.interactivelyUnloadPackage=ud;ub.interactivelyUnloadPackage=ud;ub.interactivelyRemovePackage=Vc;ub.interactivelyRemovePackage=Vc;ub.showExportsAndImportsOf=Id;ub.showExportsAndImportsOf=Id;var rc=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");
rc.isTestModule=ie;rc.shortModuleName=Fb;rc.interactivelyChangeModule=Ac;rc.interactivelyReloadModule=$c;rc.interactivelyUnloadModule=Bc;rc.interactivelyRemoveModule=vd;rc.interactivelyAddModule=pb;rc._askForModuleName=function(Ub,Ga,jb){var X,ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){switch(Fa.nextAddress){case 1:return Fa.yield(jb.prompt("Enter module name",{input:Ga,historyId:"lively.vm-editor-add-module-name"}),2);case 2:Ga=Fa.yieldResult;if(!Ga)throw"Canceled";return Fa.yield(Ub.normalize(Ga),
3);case 3:return X=Fa.yieldResult,Fa.yield(jb.confirm(["Create module \n",{},X,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:ha=Fa.yieldResult;if(!ha)throw"Canceled";return Fa.return(X)}})};rc._searchForExistingFiles=function(Ub,Ga,jb){return $jscomp.asyncExecutePromiseGeneratorProgram(function(X){return String(Ga).match(/^http/)?X.return(rc._searchForExistingFilesWeb(Ub,Ga,jb)):X.return(rc._searchForExistingFilesManually(Ub,Ga,jb))})};rc._searchForExistingFilesManually=function(Ub,Ga,
jb){var X,ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){switch(Fa.nextAddress){case 1:return Fa.yield(Ub.world().multipleChoicePrompt("Add Module",{requester:Ub,choices:["Create New Module","Load Existing Module"]}),2);case 2:X=Fa.yieldResult;if("Create New Module"===X)return Fa.return("[create new module]");if("Load Existing Module"!==X){Fa.jumpTo(3);break}return Fa.yield(Ub.world().prompt("URL of module?",{input:Ga,requester:Ub,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),
4);case 4:if(ha=Fa.yieldResult)return Fa.return([ha]);case 3:throw"Canceled";}})};rc._searchForExistingFilesWeb=function(Ub,Ga,jb){function X(Na){Na.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(Na.name())||jb&&rc.arr.pluck(jb.modules,"name").includes(Na.url)?!0:!1}var ha,Fa,Ja,Ca,ra,tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Na){switch(Na.nextAddress){case 1:return(ha=Ub.world())&&(Fa=ha.showLoadingIndicatorFor(Ub,"Loading existing modules...")),
Na.yield(rc.resource(Ga).dirList(5,{exclude:X}),3);case 3:return Na.yield(Na.yieldResult.map(function(lc){return lc.url}),2);case 2:return Ja=Na.yieldResult,Ca=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(Ja.filter(function(lc){return lc.endsWith(".js")}).map(function(lc){return{isListItem:!0,string:jb&&0==lc.indexOf(jb.address)?jb.name+lc.slice(jb.address.length):lc,value:lc}})),Na.yield(Promise.resolve(Fa&&Fa.remove()).then(function(){return Ub.world().filterableListPrompt("What module to load?",
Ca,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:Ub},Ub?{extent:Ub.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:ra=Na.yieldResult;if(!ra||"canceled"===ra.status||!ra.selected.length)throw"Canceled";tb=ra.selected||ra;Array.isArray(tb)||(tb=[tb]);return Na.return(tb)}})};rc._createAndLoadModules=function(Ub,Ga){var jb,X,ha,Fa,Ja,Ca,ra,tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Na){switch(Na.nextAddress){case 1:Array.isArray(Ga)||(Ga=[Ga]),jb=[],X=
$jscomp.makeIterator(Ga),ha=X.next();case 2:if(ha.done){Na.jumpTo(4);break}Fa=ha.value;return Na.yield(Ub.forgetModule(Fa,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return Na.yield(Ub.resourceEnsureExistance(Fa,'"format esm";\n'),6);case 6:return Ja=Na.yieldResult,Ca=rc,ra=Ca.isTestModule,Na.yield(Ja.read(),7);case 7:if(!ra.call(Ca,Na.yieldResult)){Na.jumpTo(8);break}if(window.Mocha&&window.chai){Na.jumpTo(8);break}return Na.yield(System.import("mocha-es6"),10);case 10:return Na.yield(rc.promise.waitFor(function(){return!!window.Mocha&&
!!window.chai}),8);case 8:return Na.setCatchFinallyBlocks(12),Na.yield(Ub.importModule(Fa),14);case 14:jb.push({name:Fa});Na.leaveTryBlock(3);break;case 12:tb=Na.enterCatchBlock(),jb.push({name:Fa,error:tb});case 3:ha=X.next();Na.jumpTo(2);break;case 4:return Na.return(jb)}})};rc.modulesInPackage_defaultExclude=function(Ub){return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(Ub.name())?!0:!1};rc.modulesInPackage=lb;rc.obj=Kb;rc.promise=id;rc.arr=Db;rc.resource=hc;rc.isTestModule=
ie;rc.isTestModule=ie;rc.shortModuleName=Fb;rc.shortModuleName=Fb;rc.interactivelyChangeModule=Ac;rc.interactivelyChangeModule=Ac;rc.interactivelyReloadModule=$c;rc.interactivelyReloadModule=$c;rc.interactivelyUnloadModule=Bc;rc.interactivelyUnloadModule=Bc;rc.interactivelyRemoveModule=vd;rc.interactivelyRemoveModule=vd;rc.interactivelyAddModule=pb;rc.interactivelyAddModule=pb;rc.modulesInPackage=lb;rc.modulesInPackage=lb;var Ua=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");
Ua.todo=function(Ub){throw Error(Ub+" is not yet implemented!");};Ua.parseJsonLikeObj=Rc;Ua.arr=Db;Ua.Closure=Zc;Ua.obj=Kb;Ua.resource=hc;Ua.transform=yd;Ua.modules=Kc;var Lb=function(Ub){var Ga=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js"),jb=Ga.hasOwnProperty("AbstractCoreInterface")&&"function"===typeof Ga.AbstractCoreInterface?Ga.AbstractCoreInterface:Ga.AbstractCoreInterface=function(X){X&&X[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return sc(jb,Ub,[{key:"dynamicCompletionsForPrefix",value:function(X,ha,Fa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){Ua.todo("dynamicCompletionsForPrefix");Ja.jumpToEnd()})}},{key:"runEval",value:function(X,ha){Ua.todo("runEval")}},{key:"resourceExists",value:function(X){Ua.todo("resourceExists")}},{key:"resourceEnsureExistance",value:function(X,ha){Ua.todo("resourceEnsureExistance")}},{key:"resourceMkdir",value:function(X){Ua.todo("resourceMkdir")}},{key:"resourceRead",
value:function(X){Ua.todo("resourceRead")}},{key:"resourceRemove",value:function(X){Ua.todo("resourceRemove")}},{key:"resourceWrite",value:function(X,ha){Ua.todo("resourceWrite")}},{key:"resourceCreateFiles",value:function(X,ha){Ua.todo("resourceCreateFiles")}},{key:"resourceDirList",value:function(X,ha,Fa){Ua.todo("resourceDirList")}},{key:"normalizeSync",value:function(X,ha,Fa){Ua.todo("normalizeSync")}},{key:"normalize",value:function(X,ha,Fa){Ua.todo("normalize")}},{key:"printSystemConfig",value:function(){Ua.todo("printSystemConfig")}},
{key:"getConfig",value:function(){Ua.todo("getConfig")}},{key:"setConfig",value:function(X){Ua.todo("setConfig")}},{key:"getPackages",value:function(X){Ua.todo("getPackages")}},{key:"isModuleLoaded",value:function(X,ha){Ua.todo("isModuleLoaded")}},{key:"doesModuleExist",value:function(X,ha){Ua.todo("doesModuleExist")}},{key:"getModules",value:function(){var X=this,ha,Fa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){return 1==Ja.nextAddress?(ha=Ua.arr,Fa=ha.flatmap,Ja.yield(X.getPackages(),
2)):Ja.return(Fa.call(ha,Ja.yieldResult,function(Ca){return Ca.modules}))})}},{key:"getModule",value:function(X){var ha=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){return 1==Fa.nextAddress?Fa.yield(ha.getModules(),2):Fa.return(Fa.yieldResult.find(function(Ja){return Ja.name===X}))})}},{key:"getPackage",value:function(X){var ha=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){return 1==Fa.nextAddress?(X=X.replace(/\/+$/,""),Fa.yield(ha.getPackages(),2)):
Fa.return(Fa.yieldResult.find(function(Ja){return Ja.address===X||Ja.name===X}))})}},{key:"getPackageForModule",value:function(X){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){Ua.todo("getPackageForModule");ha.jumpToEnd()})}},{key:"systemConfChange",value:function(X){var ha=Ua.parseJsonLikeObj(X);["baseURL"].forEach(function(Fa){return delete ha[Fa]});return this.setConfig(ha)}},{key:"resourcesOfPackage",value:function(X,ha){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){Ua.todo("resourcesOfPackage");
Fa.jumpToEnd()})}},{key:"registerPackage",value:function(X){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){Ua.todo("registerPackage");ha.jumpToEnd()})}},{key:"importPackage",value:function(X){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){Ua.todo("importPackage");ha.jumpToEnd()})}},{key:"removePackage",value:function(X){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){Ua.todo("removePackage");ha.jumpToEnd()})}},{key:"reloadPackage",value:function(X){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){Ua.todo("reloadPackage");
ha.jumpToEnd()})}},{key:"packageConfChange",value:function(X,ha){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){Ua.todo("packageConfChange");Fa.jumpToEnd()})}},{key:"importModule",value:function(X){Ua.todo("importModule")}},{key:"forgetModule",value:function(X,ha){Ua.todo("forgetModule")}},{key:"reloadModule",value:function(X,ha){Ua.todo("reloadModule")}},{key:"moduleFormat",value:function(X){Ua.todo("moduleFormat")}},{key:"moduleRead",value:function(X){Ua.todo("moduleRead")}},{key:"moduleSourceChange",
value:function(X,ha,Fa){Ua.todo("moduleSourceChange")}},{key:"importsAndExportsOf",value:function(X,ha){Ua.todo("importsAndExportsOf")}},{key:"keyValueListOfVariablesInModule",value:function(X,ha){Ua.todo("keyValueListOfVariablesInModule")}},{key:"moduleWrite",value:function(X,ha){return this.moduleSourceChange(X,ha)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"AbstractCoreInterface"}}],Ga,{pathInPackage:function(){return"interfaces/interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:327,end:3944})}(void 0);Ua.AbstractCoreInterface=Lb;Ua.AbstractCoreInterface=Lb;Ua.AbstractCoreInterface=Lb;var mb=function(Ub){var Ga=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js"),jb=Ga.hasOwnProperty("RemoteCoreInterface")&&"function"===typeof Ga.RemoteCoreInterface?Ga.RemoteCoreInterface:Ga.RemoteCoreInterface=
function(X){X&&X[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return sc(jb,Ub,[{key:Symbol.for("lively-instance-initialize"),value:function(){sc._get(Object.getPrototypeOf(jb.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.currentEval=null}},{key:"runEval",value:function(X,ha){throw Error("Not yet implemented");}},{key:"runEvalAndStringify",value:function(X,ha){var Fa=this;return this.currentEval?this.currentEval.then(function(){return Fa.runEvalAndStringify(X,
ha)}):this.currentEval=Promise.resolve().then(function(){var Ja,Ca,ra,tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Na){switch(Na.nextAddress){case 1:return Na.yield(Fa.runEval("\n        Promise.resolve((async "+Ua.transform.wrapInFunction(X)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},ha)),2);case 2:if((Ja=Na.yieldResult)&&Ja.isError)throw Error(String(Ja.value||Ja.error));if(!Ja||!Ja.value)return Na.return(null);if(Ca=Ja.promisedValue){Na.jumpTo(3);break}return Na.yield(Ja.value,4);case 4:Ca=Na.yieldResult;case 3:ra=Ca;if(!ra)return Na.return();if("undefined"===ra)return Na.return(void 0);if("null"===ra)return Na.return(null);if("true"===ra)return Na.return(!0);
if("false"===ra)return Na.return(!1);try{tb=JSON.parse(ra)}catch(lc){return Na.return(ra)}if(tb&&tb.isError)throw Error(String(tb.value));return Na.return(tb)}})}).then(function(Ja){delete Fa.currentEval;return Ja},function(Ja){delete Fa.currentEval;return Promise.reject(Ja)})}},{key:"dynamicCompletionsForPrefix",value:function(X,ha,Fa){var Ja=this,Ca,ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tb){Ca=Ua.obj.isString(Fa.context)?Fa.context:!1;Fa=Ua.obj.dissoc(Fa,["systemInterface",
"System","context"]);ra="\n      var prefix = "+JSON.stringify(ha)+",\n          opts = "+JSON.stringify(Fa)+";\n      opts.context = "+Ca+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return tb.return(Ja.runEvalAndStringify(ra))})}},{key:"evalWithResource",value:function(X,ha,Fa){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+X+'").'+ha+"("+(Fa?JSON.stringify(Fa):"")+");\n    ")}},{key:"resourceExists",value:function(X){return this.evalWithResource(X,"exists")}},{key:"resourceEnsureExistance",value:function(X,ha){return this.evalWithResource(X,
"ensureExistance",ha)}},{key:"resourceMkdir",value:function(X){return this.evalWithResource(X,"mkdir")}},{key:"resourceRead",value:function(X){return this.evalWithResource(X,"read")}},{key:"resourceRemove",value:function(X){return this.evalWithResource(X,"remove")}},{key:"resourceWrite",value:function(X,ha){return this.evalWithResource(X,"write",ha)}},{key:"resourceCreateFiles",value:function(X,ha){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
X+'", '+JSON.stringify(ha)+")")}},{key:"resourceDirList",value:function(X,ha,Fa){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+X+'").dirList('+JSON.stringify(ha)+", "+JSON.stringify(Fa)+"))\n        .map(({url}) => ({url}))")}},{key:"livelySystemAccessor",value:function(X){X=void 0===X?"livelySystem":X;return"var "+X+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
X+') throw new Error("lively-system-interface not available!");'}},{key:"normalizeSync",value:function(X,ha,Fa){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(X)+", "+JSON.stringify(ha)+", "+Fa+")")}},{key:"normalize",value:function(X,ha,Fa){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(X)+", "+JSON.stringify(ha)+", "+JSON.stringify(Fa)+")")}},{key:"printSystemConfig",value:function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")}},
{key:"getConfig",value:function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')}},{key:"setConfig",value:function(X){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(X)+")")}},{key:"getPackages",value:function(X){X=Object.assign({excluded:[]},X);X.excluded=X.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(X)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')}},{key:"getPackageForModule",value:function(X){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(X)+")")}},{key:"isModuleLoaded",value:function(X,ha){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+X+'", '+ha+")")}},{key:"doesModuleExist",value:function(X,ha){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+X+'", '+ha+")")}},{key:"registerPackage",value:function(X){var ha=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){return Fa.return(ha.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(X)+")"))})}},{key:"importPackage",
value:function(X){var ha=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){return Fa.return(ha.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(X)+")"))})}},{key:"removePackage",value:function(X){var ha=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){return Fa.return(ha.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(X)+")"))})}},{key:"reloadPackage",value:function(X,ha){var Fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){return Ja.return(Fa.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(X)+", "+JSON.stringify(ha)+")"))})}},{key:"packageConfChange",value:function(X,ha){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(X)+", "+JSON.stringify(ha)+")")}},{key:"resourcesOfPackage",value:function(X,ha){ha=void 0===ha?[".git","node_modules",".module_cache","lively.next-node_modules"]:ha;var Fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){X.address&&
(X=X.address);return Ja.return(Fa.runEvalAndStringify("\n      "+Fa.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(X)+", "+JSON.stringify(ha)+");"))})}},{key:"getModule",value:function(X){var ha=this,Fa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){if(1==Ja.nextAddress)return Ja.yield(ha.getModules(),2);Fa=Ja.yieldResult.find(function(Ca){return Ca.name===X});return Ja.return(Fa?Ua.modules.module(Fa.name):null)})}},{key:"importModule",
value:function(X){return this.runEvalAndStringify("lively.modules.System.import("+JSON.stringify(X)+")")}},{key:"forgetModule",value:function(X,ha){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(X)+").unload("+JSON.stringify(ha)+")")}},{key:"reloadModule",value:function(X,ha){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(X)+").reload("+JSON.stringify(ha)+")")}},{key:"moduleFormat",value:function(X){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(X)+").format();")}},{key:"moduleRead",value:function(X){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(X)+").source()")}},{key:"moduleSourceChange",value:function(X,ha,Fa){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(X)+").changeSource("+JSON.stringify(ha)+", "+JSON.stringify(Fa)+")")}},{key:"keyValueListOfVariablesInModule",value:function(X,ha){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+
JSON.stringify(X)+", "+JSON.stringify(ha)+")")}},{key:"importsAndExportsOf",value:function(X,ha){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(X)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(X)+").exports()})")}},{key:"exportsOfModules",value:function(X){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(X)+";\n      options.excludedPackages = ["+X.excludedPackages.map(function(ha){return"function"===
typeof ha?ha.toString():JSON.stringify(ha)}).join(",")+"]\n      await livelySystem.localInterface.exportsOfModules(options)")}},{key:"searchInPackage",value:function(X,ha,Fa){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(X)+", "+JSON.stringify(ha)+", "+JSON.stringify(Fa)+")")}},{key:"loadMochaTestFile",value:function(X,ha){ha=void 0===ha?[]:ha;var Fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){return Ja.return(Fa.runEvalAndStringify("\n      "+
Fa.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(X)+", "+JSON.stringify(ha)+"), result;\n      result = {testsByFile}"))})}},{key:"runMochaTests",value:function(X,ha,Fa,Ja){var Ca=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){X&&X instanceof RegExp&&(X={isRegExp:!0,value:String(X).replace(/^\/|\/$/g,"")});return ra.return(Ca.runEvalAndStringify("\n      var grep = "+JSON.stringify(X)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
Ca.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(ha||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})}}],
[{key:Symbol.for("__LivelyClassName__"),get:function(){return"RemoteCoreInterface"}}],Ga,{pathInPackage:function(){return"interfaces/interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:3953,end:16249})}(Ua.AbstractCoreInterface);Ua.RemoteCoreInterface=mb;Ua.RemoteCoreInterface=mb;Ua.RemoteCoreInterface=mb;var Gb=
lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");Gb.obj=Kb;Gb.string=bd;Gb.arr=Db;Gb.resource=hc;Gb.createFiles=hd;Gb.ast=rb;Gb.modules=Kc;Gb.vm=se;Gb.parseJsonLikeObj=Rc;Gb.AbstractCoreInterface=Lb;Gb.classToFunctionTransform=xe;Lb=function(Ub){var Ga=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js"),jb=Ga.hasOwnProperty("LocalCoreInterface")&&"function"===typeof Ga.LocalCoreInterface?Ga.LocalCoreInterface:Ga.LocalCoreInterface=
function(X){X&&X[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return sc(jb,Ub,[{key:"name",get:function(){return"local"}},{key:"dynamicCompletionsForPrefix",value:function(X,ha,Fa){var Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){if(1==Ca.nextAddress)return Ca.yield(Gb.vm.completions.getCompletions(function(ra){return Gb.vm.runEval(ra.replace("return ",""),Object.assign({targetModule:X,classTransform:Gb.classToFunctionTransform},
Fa))},ha),2);Ja=Ca.yieldResult;if(Ja.isError)throw Ja.value;return Ca.return({completions:Ja.completions,prefix:Ja.startLetters})})}},{key:"runEval",value:function(X,ha){return Gb.vm.runEval(X,Object.assign({classTransform:Gb.classToFunctionTransform},ha))}},{key:"resourceExists",value:function(X){return Gb.resource(X).exists()}},{key:"resourceEnsureExistance",value:function(X,ha){return Gb.resource(X).ensureExistance(ha)}},{key:"resourceMkdir",value:function(X){return Gb.resource(X).mkdir()}},{key:"resourceRead",
value:function(X){return Gb.resource(X).read()}},{key:"resourceRemove",value:function(X){return Gb.resource(X).remove()}},{key:"resourceWrite",value:function(X,ha){return Gb.resource(X).write(ha)}},{key:"resourceCreateFiles",value:function(X,ha){return Gb.createFiles(X,ha)}},{key:"resourceDirList",value:function(X,ha,Fa){return Gb.resource(X).dirList(ha,Fa)}},{key:"normalizeSync",value:function(X,ha,Fa){return System.decanonicalize(X,ha,Fa)}},{key:"normalize",value:function(X,ha,Fa){return System.normalize(X,
ha,Fa)}},{key:"printSystemConfig",value:function(){return Gb.modules.printSystemConfig()}},{key:"getConfig",value:function(){return System.getConfig()}},{key:"setConfig",value:function(X){Gb.modules.System.config(X)}},{key:"getPackages",value:function(X){X=Object.assign({},X);X=void 0===X.excluded?[]:X.excluded;var ha=X.filter(function(Ja){return"string"===typeof Ja}),Fa=X.filter(function(Ja){return"function"===typeof Ja});ha=ha.concat(ha.map(function(Ja){return System.decanonicalize(Ja.replace(/\/?$/,
"/")).replace(/\/$/,"")}));return Gb.modules.getPackages().filter(function(Ja){return!ha.includes(Ja.url)&&!Fa.some(function(Ca){return Ca(Ja.url)})})}},{key:"registerPackage",value:function(X){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){return ha.return(Gb.modules.registerPackage(X))})}},{key:"importPackage",value:function(X){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){return ha.return(Gb.modules.importPackage(X))})}},{key:"removePackage",value:function(X){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){return ha.return(Gb.modules.removePackage(X))})}},
{key:"reloadPackage",value:function(X,ha){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){return Fa.return(Gb.modules.reloadPackage(X,ha))})}},{key:"packageConfChange",value:function(X,ha){var Fa=this,Ja,Ca,ra,tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Na){if(1==Na.nextAddress)return Ja=Gb.modules.System,Ca=Gb.parseJsonLikeObj(X),ra=JSON.stringify(Ca,null,2),Na.yield(Gb.modules.module(ha).changeSource(ra,{doEval:!1}),2);if(3!=Na.nextAddress)return Ja.set(ha,Ja.newModule(Ca)),
Na.yield(Fa.getPackageForModule(ha),3);(tb=Na.yieldResult)&&Gb.modules.applyPackageConfig(Ca,tb.address);Na.jumpToEnd()})}},{key:"resourcesOfPackage",value:function(X,ha){ha=void 0===ha?[".git","node_modules",".module_cache"]:ha;var Fa,Ja,Ca;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){if(1==ra.nextAddress)return ra.setCatchFinallyBlocks(2),Fa=X.address?X.address:X,Ja=Gb.modules.getPackage(Fa),ra.yield(Ja.resources(void 0,ha),4);if(2!=ra.nextAddress)return ra.return(ra.yieldResult.map(function(tb){return Object.assign(tb,
{package:tb.package.url})}));Ca=ra.enterCatchBlock();console.warn("resourcesOfPackage error for "+X+": "+Ca);return ra.return([])})}},{key:"getPackageForModule",value:function(X){return(X=Gb.modules.getPackageOfModule(X))?X.asSpec():X}},{key:"isModuleLoaded",value:function(X,ha){return Gb.modules.isModuleLoaded(X,ha)}},{key:"doesModuleExist",value:function(X,ha){return Gb.modules.isModuleLoaded(X,ha)}},{key:"getModule",value:function(X){return Gb.modules.module(X)}},{key:"importModule",value:function(X){return Gb.modules.System.import(X)}},
{key:"forgetModule",value:function(X,ha){return Gb.modules.module(X).unload(ha)}},{key:"reloadModule",value:function(X,ha){return Gb.modules.module(X).reload(ha)}},{key:"moduleFormat",value:function(X){return Gb.modules.module(X).format()}},{key:"moduleRead",value:function(X){return Gb.modules.module(X).source()}},{key:"moduleSourceChange",value:function(X,ha,Fa){return Gb.modules.module(X).changeSource(ha,Fa)}},{key:"keyValueListOfVariablesInModule",value:function(X,ha){var Fa=this,Ja,Ca,ra,tb,Na,
lc,kd,Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(md){switch(md.nextAddress){case 1:if(ha){md.jumpTo(2);break}return md.yield(Fa.resourceRead(X),3);case 3:ha=md.yieldResult;case 2:return Ja="string"===typeof ha?Gb.ast.parse(ha):ha,Ca=Fa.normalizeSync(X),Fa.moduleFormat(Ca),ra=Gb.modules.module(Ca).env().recorder,md.yield(Fa.importsAndExportsOf(Ca,Ja),4);case 4:return tb=md.yieldResult,Na=Gb.ast.query.topLevelDeclsAndRefs(Ja),lc=Gb.arr.sortByKey(Gb.ast.query.declarationsOfScope(Na.scope,
!0),"start"),kd=Gb.arr.pluck(Na.scope.importSpecifiers,"name"),Tb=0,md.return(lc.map(function(wb){var je=wb.name.length,bf=tb.exports.find(function(xb){return xb.local===wb.name}),Wc=Gb.arr.include(kd,wb.name);bf&&(je+=9);Wc&&(je+=9);Tb=Math.max(Tb,je);return{isExport:bf,isImport:Wc,name:wb.name,value:ra[wb.name],node:wb,printedName:wb.name+(bf?" [export]":"")+(Wc?" [import]":""),printedValue:Gb.obj.inspect(ra[wb.name],{maxDepth:1}).replace(/\n/g,"")}}).map(function(wb){return{isListItem:!0,value:wb,
string:wb.printedName+Gb.string.indent(" = "+wb.printedValue," ",Tb-wb.printedName.length)}}))}})}},{key:"importsAndExportsOf",value:function(X,ha){var Fa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){return 1==Ja.nextAddress?Ja.yield(Gb.modules.module(X).imports(ha),2):3!=Ja.nextAddress?(Fa=Ja.yieldResult,Ja.yield(Gb.modules.module(X).exports(ha),3)):Ja.return({imports:Fa,exports:Ja.yieldResult})})}},{key:"exportsOfModules",value:function(X){return Gb.modules.ExportLookup.run(System,
X)}},{key:"searchInPackage",value:function(X,ha,Fa){return Gb.modules.getPackage(X).search(ha,Fa)}},{key:"runMochaTests",value:function(X,ha,Fa,Ja){var Ca,ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tb){if(1==tb.nextAddress)return tb.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);Ca=tb.yieldResult;ra=Ca.runMochaTests;return tb.return(ra(X,ha,Fa,Ja))})}},{key:"loadMochaTestFile",value:function(X,ha){var Fa,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){if(1==
Ca.nextAddress)return Ca.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);Fa=Ca.yieldResult;Ja=Fa.loadMochaTestFile;return Ca.return(Ja(X,ha))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"LocalCoreInterface"}}],Ga,{pathInPackage:function(){return"interfaces/local-system.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",
version:"0.2.1"}}},{start:411,end:8203})}(Gb.AbstractCoreInterface);Gb.LocalCoreInterface=Lb;Gb.LocalCoreInterface=Lb;Gb.LocalCoreInterface=Lb;var vc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");vc.evalStrategies=ne;vc.RemoteCoreInterface=mb;var Lc=function(Ub){var Ga=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js"),jb=Ga.hasOwnProperty("HTTPCoreInterface")&&"function"===typeof Ga.HTTPCoreInterface?Ga.HTTPCoreInterface:
Ga.HTTPCoreInterface=function(X){X&&X[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return sc(jb,Ub,[{key:Symbol.for("lively-instance-initialize"),value:function(X){sc._get(Object.getPrototypeOf(jb.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.currentEval=null;this.url=X;this.server=new vc.evalStrategies.HttpEvalStrategy(X)}},{key:"name",get:function(){return this.url}},{key:"description",get:function(){return this.url.replace(/^https?:\/\//,
"")}},{key:"runEval",value:function(X,ha){return this.server.runEval(X,ha)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"HTTPCoreInterface"}}],Ga,{pathInPackage:function(){return"interfaces/http-interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:106,end:512})}(vc.RemoteCoreInterface);vc.HTTPCoreInterface=
Lc;vc.HTTPCoreInterface=Lc;vc.HTTPCoreInterface=Lc;var cc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");cc.evalStrategies=ne;cc.RemoteCoreInterface=mb;mb=function(Ub){var Ga=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js"),jb=Ga.hasOwnProperty("L2LCoreInterface")&&"function"===typeof Ga.L2LCoreInterface?Ga.L2LCoreInterface:Ga.L2LCoreInterface=function(X){X&&X[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return sc(jb,Ub,[{key:Symbol.for("lively-instance-initialize"),value:function(X,ha){sc._get(Object.getPrototypeOf(jb.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.targetId=X;this.peer=ha}},{key:"name",get:function(){return"l2l "+this.targetId}},{key:"description",get:function(){var X=this.peer,ha="l2l "+this.targetId.slice(0,5);if(X){var Fa=X.location,Ja=X.type,Ca=X.user;X=X.world;Ja&&(ha+=", "+Ja);Fa&&(ha+=", "+Fa.replace(/^https?:\/\//,"")+(X?"/"+X:""));Ca&&
(ha+=", "+Ca.name)}return ha}},{key:"client",get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}},{key:"isConnected",value:function(){var X=this,ha,Fa,Ja,Ca,ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tb){if(1==tb.nextAddress)return ha=X,Fa=ha.client,Ja=ha.targetId,tb.yield(Fa.sendToAndWait(Fa.trackerId,"getClients",{}),2);Ca=tb.yieldResult;ra=Ca.data;return tb.return(ra.some(function(Na){Na=$jscomp.makeIterator(Na).next().value;
return Ja===Na}))})}},{key:"runEval",value:function(X,ha){var Fa=this,Ja,Ca;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){Ja=Fa.client;if(!Ja)throw Error("No lively.2lively default client available!");Ca=new cc.evalStrategies.L2LEvalStrategy(Ja,Fa.targetId);return ra.return(Ca.runEval(X,ha))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"L2LCoreInterface"}}],Ga,{pathInPackage:function(){return"interfaces/l2l-interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:106,end:1449})}(cc.RemoteCoreInterface);cc.L2LCoreInterface=mb;cc.L2LCoreInterface=mb;cc.L2LCoreInterface=mb;var Vb=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");Vb.systemInterfaceNamed=Zb;Vb.interactivelyCreatePackage=Pd;Vb.interactivelyLoadPackage=Hb;Vb.interactivelyReloadPackage=Gc;Vb.interactivelyUnloadPackage=ud;Vb.interactivelyRemovePackage=
Vc;Vb.showExportsAndImportsOf=Id;Vb.shortModuleName=Fb;Vb.interactivelyChangeModule=Ac;Vb.interactivelyReloadModule=$c;Vb.interactivelyUnloadModule=Bc;Vb.interactivelyRemoveModule=vd;Vb.interactivelyAddModule=pb;Vb.modulesInPackage=lb;Vb.LocalCoreInterface=Lb;Vb.HTTPCoreInterface=Lc;Vb.L2LCoreInterface=mb;mb=Ma("Interface",function(Ub){var Ga=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js"),jb=Ga.hasOwnProperty("Interface")&&"function"===typeof Ga.Interface?Ga.Interface:Ga.Interface=
function(X){X&&X[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return sc(jb,Ub,[{key:Symbol.for("lively-instance-initialize"),value:function(X){this.coreInterface=X}},{key:"isSystemInterface",get:function(){return!0}},{key:"name",get:function(){return this.coreInterface.name}},{key:"dynamicCompletionsForPrefix",value:function(X,ha,Fa){return this.coreInterface.dynamicCompletionsForPrefix(X,ha,Fa)}},{key:"runEval",value:function(X,ha){return this.coreInterface.runEval(X,
ha)}},{key:"printSystemConfig",value:function(X,ha,Fa){return this.coreInterface.printSystemConfig(X,ha,Fa)}},{key:"getConfig",value:function(X,ha,Fa){return this.coreInterface.getConfig(X,ha,Fa)}},{key:"getPackages",value:function(X){return this.coreInterface.getPackages(X)}},{key:"getModules",value:function(X,ha,Fa){return this.coreInterface.getModules(X,ha,Fa)}},{key:"getModule",value:function(X,ha,Fa){return this.coreInterface.getModule(X,ha,Fa)}},{key:"getPackage",value:function(X,ha,Fa){return this.coreInterface.getPackage(X,
ha,Fa)}},{key:"getPackageForModule",value:function(X,ha,Fa){return this.coreInterface.getPackageForModule(X,ha,Fa)}},{key:"resourcesOfPackage",value:function(X,ha){return this.coreInterface.resourcesOfPackage(X,ha)}},{key:"systemConfChange",value:function(X,ha,Fa){return this.coreInterface.systemConfChange(X,ha,Fa)}},{key:"registerPackage",value:function(X){return this.coreInterface.registerPackage(X)}},{key:"importPackage",value:function(X){return this.coreInterface.importPackage(X)}},{key:"removePackage",
value:function(X){return this.coreInterface.removePackage(X)}},{key:"reloadPackage",value:function(X){return this.coreInterface.reloadPackage(X)}},{key:"packageConfChange",value:function(X,ha){return this.coreInterface.packageConfChange(X,ha)}},{key:"keyValueListOfVariablesInModule",value:function(X,ha){return this.coreInterface.keyValueListOfVariablesInModule(X,ha)}},{key:"interactivelyCreatePackage",value:function(X){return Vb.interactivelyCreatePackage(this.coreInterface,X)}},{key:"interactivelyLoadPackage",
value:function(X,ha){return Vb.interactivelyLoadPackage(this.coreInterface,X,ha)}},{key:"interactivelyReloadPackage",value:function(X,ha){return Vb.interactivelyReloadPackage(this.coreInterface,X,ha)}},{key:"interactivelyUnloadPackage",value:function(X,ha,Fa){return Vb.interactivelyUnloadPackage(this.coreInterface,X,ha,Fa)}},{key:"interactivelyRemovePackage",value:function(X,ha){return Vb.interactivelyRemovePackage(this.coreInterface,X,ha)}},{key:"isModuleLoaded",value:function(X,ha){return this.coreInterface.isModuleLoaded(X,
ha)}},{key:"doesModuleExist",value:function(X,ha){return this.coreInterface.doesModuleExist(X,ha)}},{key:"importModule",value:function(X){return this.coreInterface.importModule(X)}},{key:"forgetModule",value:function(X,ha){return this.coreInterface.forgetModule(X,ha)}},{key:"reloadModule",value:function(X,ha){return this.coreInterface.reloadModule(X,ha)}},{key:"moduleFormat",value:function(X){return this.coreInterface.moduleFormat(X)}},{key:"moduleRead",value:function(X){return this.coreInterface.moduleRead(X)}},
{key:"moduleWrite",value:function(X,ha){return this.coreInterface.moduleWrite(X,ha)}},{key:"getModulesInPackage",value:function(X){return Vb.modulesInPackage(this.coreInterface,X)}},{key:"shortModuleName",value:function(X,ha){return Vb.shortModuleName(this.coreInterface,X,ha)}},{key:"interactivelyChangeModule",value:function(X,ha,Fa){return Vb.interactivelyChangeModule(this.coreInterface,X,ha,Fa)}},{key:"interactivelyReloadModule",value:function(X,ha){return Vb.interactivelyReloadModule(this.coreInterface,
X,ha)}},{key:"interactivelyUnloadModule",value:function(X,ha){return Vb.interactivelyUnloadModule(this.coreInterface,X,ha)}},{key:"interactivelyRemoveModule",value:function(X,ha){return Vb.interactivelyRemoveModule(this.coreInterface,X,ha)}},{key:"interactivelyAddModule",value:function(X,ha){return Vb.interactivelyAddModule(this.coreInterface,X,ha)}},{key:"showExportsAndImportsOf",value:function(X,ha){return Vb.showExportsAndImportsOf(this.coreInterface,X,ha)}},{key:"exportsOfModules",value:function(X){return this.coreInterface.exportsOfModules(X)}},
{key:"searchInPackage",value:function(X,ha,Fa){return this.coreInterface.searchInPackage(X,ha,Fa)}},{key:"searchInAllPackages",value:function(X,ha){ha=void 0===ha?{}:ha;var Fa=this,Ja,Ca,ra,tb,Na,lc,kd,Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(md){switch(md.nextAddress){case 1:return(Ja=ha.progress)&&Ja.step("Fetching Packages...",0),md.yield(Fa.coreInterface.getPackages({excluded:ha.excludedPackages}),2);case 2:Ca=md.yieldResult,ra=[],Ja&&Ja.step("Fetching Packages...",.1),tb=
0;case 3:if(!(tb<Ca.length)){md.jumpTo(5);break}Na=Ca[tb];lc=Na.url;if(!lc||"no group"===lc){md.jumpTo(4);break}Ja&&Ja.step(lc.replace(System.baseURL,"").slice(0,20),.1+tb/Ca.length*.9);md.setCatchFinallyBlocks(6);return md.yield(Fa.coreInterface.searchInPackage(lc,X,ha),8);case 8:kd=md.yieldResult;ra=ra.concat(kd);md.leaveTryBlock(4);break;case 6:Tb=md.enterCatchBlock(),console.error("Error searching in package "+lc+":\n"+Tb.stack);case 4:tb++;md.jumpTo(3);break;case 5:return md.return(ra)}})}},
{key:"loadMochaTestFile",value:function(X,ha){return this.coreInterface.loadMochaTestFile(X,ha)}},{key:"runMochaTests",value:function(X,ha,Fa,Ja){return this.coreInterface.runMochaTests(X,ha,Fa,Ja)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Interface"}}],Ga,{pathInPackage:function(){return"index.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",
version:"0.2.1"}}},{start:668,end:6107})}(void 0));Vb.Interface=mb;Vb.Interface=mb;Vb.Interface=mb;Vb.systemInterfaceNamed=Zb;Vb.systemInterfaceNamed=Zb;mb=Ma("localInterface",new Vb.Interface(new Vb.LocalCoreInterface));Vb.localInterface=mb;Vb.localInterface=mb;Vb.localInterface=mb;Vb.httpInterfaces={};mb=Ma("serverInterfaceFor",function(Ub){return Vb.httpInterfaces[Ub]||(Vb.httpInterfaces[Ub]=new Vb.Interface(new Vb.HTTPCoreInterface(Ub)))});Vb.serverInterfaceFor=mb;Vb.serverInterfaceFor=mb;Vb.serverInterfaceFor=
mb;Vb.l2lInterfaces={};mb=Ma("l2lInterfaceFor",function(Ub,Ga){return Vb.l2lInterfaces[Ub]||(Vb.l2lInterfaces[Ub]=new Vb.Interface(new Vb.L2LCoreInterface(Ub,Ga)))});Vb.l2lInterfaceFor=mb;Vb.l2lInterfaceFor=mb;Vb.l2lInterfaceFor=mb}}});