System.register(["./__root_module__-5a58cfed.js","kld-intersections"],function(Ca){var Cb,Vb,lc,gc,fe,fd,Zd,id;return{setters:[function(Uc){Cb=Uc.s;Vb=Uc._;lc=Uc.bj;gc=Uc.bk;fe=Uc.ar;fd=Uc.a5;Zd=Uc.bl;id=Uc.an},function(){}],execute:function(){function Uc(){function Ga(rb,Db){var Cc={};Db.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(qd,nd,rc){nd&&(Cc[nd]=rc)});return Cc}if(pb)return Mc;pb=!0;var ub=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
Eb="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");return Mc=function(rb){var Db=rb,Cc=rb.indexOf("["),qd=rb.indexOf("]");-1!=Cc&&-1!=qd&&(rb=rb.substring(0,Cc)+rb.substring(Cc,qd).replace(/:/g,";")+rb.substring(qd,rb.length));var nd=ub.exec(rb||"");rb={};for(var rc=14;rc--;)rb[Eb[rc]]=nd[rc]||"";-1!=Cc&&-1!=qd&&(rb.source=Db,rb.host=rb.host.substring(1,rb.host.length-1).replace(/;/g,":"),rb.authority=rb.authority.replace("[","").replace("]",
"").replace(/;/g,":"),rb.ipv6uri=!0);Db=rb.path;Cc=Db.replace(/\/{2,9}/g,"/").split("/");"/"!=Db.substr(0,1)&&0!==Db.length||Cc.splice(0,1);"/"==Db.substr(Db.length-1,1)&&Cc.splice(Cc.length-1,1);rb.pathNames=Cc;rb.queryKey=Ga(rb,rb.query);return rb}}function Ad(){function Ga(Db){Db=String(Db);if(!(100<Db.length)&&(Db=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(Db))){var Cc=parseFloat(Db[1]);switch((Db[2]||"ms").toLowerCase()){case "years":case "year":case "yrs":case "yr":case "y":return Cc*
rb;case "days":case "day":case "d":return Cc*Eb;case "hours":case "hour":case "hrs":case "hr":case "h":return 36E5*Cc;case "minutes":case "minute":case "mins":case "min":case "m":return 6E4*Cc;case "seconds":case "second":case "secs":case "sec":case "s":return 1E3*Cc;case "milliseconds":case "millisecond":case "msecs":case "msec":case "ms":return Cc}}}function ub(Db,Cc,qd){if(!(Db<Cc))return Db<1.5*Cc?Math.floor(Db/Cc)+" "+qd:Math.ceil(Db/Cc)+" "+qd+"s"}if(eb)return fb;eb=!0;var Eb=864E5,rb=365.25*
Eb;return fb=function(Db,Cc){Cc=Cc||{};var qd=typeof Db;if("string"===qd&&0<Db.length)return Ga(Db);if("number"===qd&&!1===isNaN(Db))return Cc.long?ub(Db,Eb,"day")||ub(Db,36E5,"hour")||ub(Db,6E4,"minute")||ub(Db,1E3,"second")||Db+" ms":Db>=Eb?Math.round(Db/Eb)+"d":36E5<=Db?Math.round(Db/36E5)+"h":6E4<=Db?Math.round(Db/6E4)+"m":1E3<=Db?Math.round(Db/1E3)+"s":Db+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(Db));}}function Nd(){function Ga(rb){var Db=0,Cc;for(Cc in rb)Db=
(Db<<5)-Db+rb.charCodeAt(Cc),Db|=0;return bc.colors[Math.abs(Db)%bc.colors.length]}function ub(rb){function Db(){if(Db.enabled){var qd=+new Date;Db.diff=qd-(Cc||qd);Db.prev=Cc;Cc=Db.curr=qd;var nd=Array(arguments.length);for(qd=0;qd<nd.length;qd++)nd[qd]=arguments[qd];nd[0]=bc.coerce(nd[0]);"string"!==typeof nd[0]&&nd.unshift("%O");var rc=0;nd[0]=nd[0].replace(/%([a-zA-Z%])/g,function(kc,Sc){if("%%"===kc)return kc;rc++;Sc=bc.formatters[Sc];"function"===typeof Sc&&(kc=Sc.call(Db,nd[rc]),nd.splice(rc,
1),rc--);return kc});bc.formatArgs.call(Db,nd);(Db.log||bc.log||console.log.bind(console)).apply(Db,nd)}}var Cc;Db.namespace=rb;Db.enabled=bc.enabled(rb);Db.useColors=bc.useColors();Db.color=Ga(rb);Db.destroy=Eb;"function"===typeof bc.init&&bc.init(Db);bc.instances.push(Db);return Db}function Eb(){var rb=bc.instances.indexOf(this||Ed);return-1!==rb?(bc.instances.splice(rb,1),!0):!1}if(ac)return bc;ac=!0;bc=bc=ub.debug=ub["default"]=ub;bc.coerce=function(rb){return rb instanceof Error?rb.stack||rb.message:
rb};bc.disable=function(){bc.enable("")};bc.enable=function(rb){bc.save(rb);bc.names=[];bc.skips=[];var Db,Cc=("string"===typeof rb?rb:"").split(/[\s,]+/),qd=Cc.length;for(Db=0;Db<qd;Db++)Cc[Db]&&(rb=Cc[Db].replace(/\*/g,".*?"),"-"===rb[0]?bc.skips.push(new RegExp("^"+rb.substr(1)+"$")):bc.names.push(new RegExp("^"+rb+"$")));for(Db=0;Db<bc.instances.length;Db++)rb=bc.instances[Db],rb.enabled=bc.enabled(rb.namespace)};bc.enabled=function(rb){if("*"===rb[rb.length-1])return!0;var Db;var Cc=0;for(Db=
bc.skips.length;Cc<Db;Cc++)if(bc.skips[Cc].test(rb))return!1;Cc=0;for(Db=bc.names.length;Cc<Db;Cc++)if(bc.names[Cc].test(rb))return!0;return!1};bc.humanize=Ad();bc.instances=[];bc.names=[];bc.skips=[];bc.formatters={};return bc}function ee(){function Ga(){try{var Db=we.storage.debug}catch(Cc){}!Db&&"undefined"!==typeof ub&&"env"in ub&&(Db=ub.env.DEBUG);return Db}if(Je)return we;Je=!0;var ub=lc;we=we=Nd();we.log=function(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,
console,arguments)};we.formatArgs=function(Db){var Cc=(this||Lf).useColors;Db[0]=(Cc?"%c":"")+(this||Lf).namespace+(Cc?" %c":" ")+Db[0]+(Cc?"%c ":" ")+"+"+we.humanize((this||Lf).diff);if(Cc){Cc="color: "+(this||Lf).color;Db.splice(1,0,Cc,"color: inherit");var qd=0,nd=0;Db[0].replace(/%[a-zA-Z%]/g,function(rc){"%%"!==rc&&(qd++,"%c"===rc&&(nd=qd))});Db.splice(nd,0,Cc)}};we.save=function(Db){try{null==Db?we.storage.removeItem("debug"):we.storage.debug=Db}catch(Cc){}};we.load=Ga;we.useColors=function(){return"undefined"!==
typeof window&&window.process&&"renderer"===window.process.type?!0:"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:"undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&
31<=parseInt(RegExp.$1,10)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)};var Eb=we;if("undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage)var rb=chrome.storage.local;else a:{try{rb=window.localStorage;break a}catch(Db){}rb=void 0}Eb.storage=rb;we.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" ");
we.formatters.j=function(Db){try{return JSON.stringify(Db)}catch(Cc){return"[UnexpectedJSONParseError]: "+Cc.message}};we.enable(Ga());return we}function Ud(){if(Fe)return ud;Fe=!0;var Ga=Uc(),ub=ee()("socket.io-client:url");return ud=function(Eb,rb){var Db=Eb;rb=rb||"undefined"!==typeof location&&location;null==Eb&&(Eb=rb.protocol+"//"+rb.host);"string"===typeof Eb&&("/"===Eb.charAt(0)&&(Eb="/"===Eb.charAt(1)?rb.protocol+Eb:rb.host+Eb),/^(https?|wss?):\/\//.test(Eb)||(ub("protocol-less url %s",Eb),
Eb="undefined"!==typeof rb?rb.protocol+"//"+Eb:"https://"+Eb),ub("parse %s",Eb),Db=Ga(Eb));Db.port||(/^(http|ws)$/.test(Db.protocol)?Db.port="80":/^(http|ws)s$/.test(Db.protocol)&&(Db.port="443"));Db.path=Db.path||"/";Eb=-1!==Db.host.indexOf(":")?"["+Db.host+"]":Db.host;Db.id=Db.protocol+"://"+Eb+":"+Db.port;Db.href=Db.protocol+"://"+Eb+(rb&&rb.port===Db.port?"":":"+Db.port);return Db}}function kd(){function Ga(ub){if(ub){for(var Eb in Ga.prototype)ub[Eb]=Ga.prototype[Eb];return ub}}if(Sb)return Pd;
Sb=!0;Pd=Ga;Ga.prototype.on=Ga.prototype.addEventListener=function(ub,Eb){(this||oa)._callbacks=(this||oa)._callbacks||{};((this||oa)._callbacks["$"+ub]=(this||oa)._callbacks["$"+ub]||[]).push(Eb);return this||oa};Ga.prototype.once=function(ub,Eb){function rb(){this.off(ub,rb);Eb.apply(this||oa,arguments)}rb.fn=Eb;this.on(ub,rb);return this||oa};Ga.prototype.off=Ga.prototype.removeListener=Ga.prototype.removeAllListeners=Ga.prototype.removeEventListener=function(ub,Eb){(this||oa)._callbacks=(this||
oa)._callbacks||{};if(0==arguments.length)return(this||oa)._callbacks={},this||oa;var rb=(this||oa)._callbacks["$"+ub];if(!rb)return this||oa;if(1==arguments.length)return delete (this||oa)._callbacks["$"+ub],this||oa;for(var Db,Cc=0;Cc<rb.length;Cc++)if(Db=rb[Cc],Db===Eb||Db.fn===Eb){rb.splice(Cc,1);break}0===rb.length&&delete (this||oa)._callbacks["$"+ub];return this||oa};Ga.prototype.emit=function(ub){(this||oa)._callbacks=(this||oa)._callbacks||{};for(var Eb=Array(arguments.length-1),rb=(this||
oa)._callbacks["$"+ub],Db=1;Db<arguments.length;Db++)Eb[Db-1]=arguments[Db];if(rb){rb=rb.slice(0);Db=0;for(var Cc=rb.length;Db<Cc;++Db)rb[Db].apply(this||oa,Eb)}return this||oa};Ga.prototype.listeners=function(ub){(this||oa)._callbacks=(this||oa)._callbacks||{};return(this||oa)._callbacks["$"+ub]||[]};Ga.prototype.hasListeners=function(ub){return!!this.listeners(ub).length};return Pd}function cb(){if(Mb)return Ha;Mb=!0;var Ga={}.toString;return Ha=Array.isArray||function(ub){return"[object Array]"==
Ga.call(ub)}}function Fb(){if(ta)return P;ta=!0;var Ga=gc.Buffer;P=function(rb){var Db;!(Db=ub&&Ga.isBuffer(rb))&&(Db=Eb)&&((Db=rb instanceof ArrayBuffer)||(Db="function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(rb):rb.buffer instanceof ArrayBuffer));return Db};var ub="function"===typeof Ga&&"function"===typeof Ga.isBuffer,Eb="function"===typeof ArrayBuffer;return P}function vc(){function Ga(nd,rc){if(!nd)return nd;if(rb(nd)){var kc={_placeholder:!0,num:rc.length};rc.push(nd);return kc}if(Eb(nd)){kc=
Array(nd.length);for(var Sc=0;Sc<nd.length;Sc++)kc[Sc]=Ga(nd[Sc],rc);return kc}if("object"===typeof nd&&!(nd instanceof Date)){kc={};for(Sc in nd)kc[Sc]=Ga(nd[Sc],rc);return kc}return nd}function ub(nd,rc){if(!nd)return nd;if(nd&&nd._placeholder)return rc[nd.num];if(Eb(nd))for(var kc=0;kc<nd.length;kc++)nd[kc]=ub(nd[kc],rc);else if("object"===typeof nd)for(kc in nd)nd[kc]=ub(nd[kc],rc);return nd}if(Jb)return Pa;Jb=!0;var Eb=cb(),rb=Fb(),Db=Object.prototype.toString,Cc="function"===typeof Blob||"undefined"!==
typeof Blob&&"[object BlobConstructor]"===Db.call(Blob),qd="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===Db.call(File);Pa.deconstructPacket=function(nd){var rc=[];nd.data=Ga(nd.data,rc);nd.attachments=rc.length;return{packet:nd,buffers:rc}};Pa.reconstructPacket=function(nd,rc){nd.data=ub(nd.data,rc);nd.attachments=void 0;return nd};Pa.removeBlobs=function(nd,rc){function kc(jd,ke,Se){if(!jd)return jd;if(Cc&&jd instanceof Blob||qd&&jd instanceof File){Sc++;var de=
new FileReader;de.onload=function(){Se?Se[ke]=(this||Rc).result:xb=(this||Rc).result;--Sc||rc(xb)};de.readAsArrayBuffer(jd)}else if(Eb(jd))for(de=0;de<jd.length;de++)kc(jd[de],de,jd);else if("object"===typeof jd&&!rb(jd))for(de in jd)kc(jd[de],de,jd)}var Sc=0,xb=nd;kc(xb);Sc||rc(xb)};return Pa}function pc(){function Ga(){}function ub(xb){var jd=""+xb.type;if(Zc.BINARY_EVENT===xb.type||Zc.BINARY_ACK===xb.type)jd+=xb.attachments+"-";xb.nsp&&"/"!==xb.nsp&&(jd+=xb.nsp+",");null!=xb.id&&(jd+=xb.id);if(null!=
xb.data){try{var ke=JSON.stringify(xb.data)}catch(Se){ke=!1}if(!1!==ke)jd+=ke;else return Sc}Cc("encoded %j as %s",xb,jd);return jd}function Eb(xb,jd){nd.removeBlobs(xb,function(ke){var Se=nd.deconstructPacket(ke);ke=ub(Se.packet);Se=Se.buffers;Se.unshift(ke);jd(Se)})}function rb(){(this||se).reconstructor=null}function Db(xb){(this||se).reconPack=xb;(this||se).buffers=[]}if(oe)return Zc;oe=!0;var Cc=ee()("socket.io-parser"),qd=kd(),nd=vc(),rc=cb(),kc=Fb();Zc.protocol=4;Zc.types="CONNECT DISCONNECT EVENT ACK ERROR BINARY_EVENT BINARY_ACK".split(" ");
Zc.CONNECT=0;Zc.DISCONNECT=1;Zc.EVENT=2;Zc.ACK=3;Zc.ERROR=4;Zc.BINARY_EVENT=5;Zc.BINARY_ACK=6;Zc.Encoder=Ga;Zc.Decoder=rb;var Sc=Zc.ERROR+'"encode error"';Ga.prototype.encode=function(xb,jd){Cc("encoding packet %j",xb);Zc.BINARY_EVENT===xb.type||Zc.BINARY_ACK===xb.type?Eb(xb,jd):(xb=ub(xb),jd([xb]))};qd(rb.prototype);rb.prototype.add=function(xb){if("string"===typeof xb){a:{var jd=0,ke={type:Number(xb.charAt(0))};if(null==Zc.types[ke.type])xb={type:Zc.ERROR,data:"parser error: unknown packet type "+
ke.type};else{if(Zc.BINARY_EVENT===ke.type||Zc.BINARY_ACK===ke.type){for(var Se="";"-"!==xb.charAt(++jd)&&(Se+=xb.charAt(jd),jd!=xb.length););if(Se!=Number(Se)||"-"!==xb.charAt(jd))throw Error("Illegal attachments");ke.attachments=Number(Se)}if("/"===xb.charAt(jd+1))for(ke.nsp="";++jd;){Se=xb.charAt(jd);if(","===Se)break;ke.nsp+=Se;if(jd===xb.length)break}else ke.nsp="/";Se=xb.charAt(jd+1);if(""!==Se&&Number(Se)==Se){for(ke.id="";++jd;){Se=xb.charAt(jd);if(null==Se||Number(Se)!=Se){--jd;break}ke.id+=
xb.charAt(jd);if(jd===xb.length)break}ke.id=Number(ke.id)}if(xb.charAt(++jd)){jd=xb.substr(jd);try{var de=JSON.parse(jd)}catch(Pe){de=!1}if(!1===de||ke.type!==Zc.ERROR&&!rc(de)){xb={type:Zc.ERROR,data:"parser error: invalid payload"};break a}else ke.data=de}Cc("decoded %s as %j",xb,ke);xb=ke}}Zc.BINARY_EVENT===xb.type||Zc.BINARY_ACK===xb.type?((this||se).reconstructor=new Db(xb),0===(this||se).reconstructor.reconPack.attachments&&this.emit("decoded",xb)):this.emit("decoded",xb)}else if(kc(xb)||xb.base64)if((this||
se).reconstructor){if(xb=(this||se).reconstructor.takeBinaryData(xb))(this||se).reconstructor=null,this.emit("decoded",xb)}else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+xb);};rb.prototype.destroy=function(){(this||se).reconstructor&&(this||se).reconstructor.finishedReconstruction()};Db.prototype.takeBinaryData=function(xb){(this||se).buffers.push(xb);return(this||se).buffers.length===(this||se).reconPack.attachments?(xb=nd.reconstructPacket((this||
se).reconPack,(this||se).buffers),this.finishedReconstruction(),xb):null};Db.prototype.finishedReconstruction=function(){(this||se).reconPack=null;(this||se).buffers=[]};return Zc}function sd(){if(of)return ue;of=!0;return ue="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")()}function pd(){if(rg)return Gf;rg=!0;if(!Qd){Qd=!0;try{Df="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Eb){Df=!1}}var Ga=Df;var ub=sd();return Gf=function(Eb){var rb=
Eb.xdomain,Db=Eb.xscheme;Eb=Eb.enablesXDR;try{if("undefined"!==typeof XMLHttpRequest&&(!rb||Ga))return new XMLHttpRequest}catch(Cc){}try{if("undefined"!==typeof XDomainRequest&&!Db&&Eb)return new XDomainRequest}catch(Cc){}if(!rb)try{return new (ub[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(Cc){}}}function tc(){if(Vc)return mg;Vc=!0;return mg=Object.keys||function(Ga){var ub=[],Eb=Object.prototype.hasOwnProperty,rb;for(rb in Ga)Eb.call(Ga,rb)&&ub.push(rb);return ub}}function bd(){function Ga(qd){if(!qd||
"object"!==typeof qd)return!1;if(Eb(qd)){for(var nd=0,rc=qd.length;nd<rc;nd++)if(Ga(qd[nd]))return!0;return!1}if("function"===typeof ub&&ub.isBuffer&&ub.isBuffer(qd)||"function"===typeof ArrayBuffer&&qd instanceof ArrayBuffer||Db&&qd instanceof Blob||Cc&&qd instanceof File)return!0;if(qd.toJSON&&"function"===typeof qd.toJSON&&1===arguments.length)return Ga(qd.toJSON(),!0);for(nd in qd)if(Object.prototype.hasOwnProperty.call(qd,nd)&&Ga(qd[nd]))return!0;return!1}if(dg)return yf;dg=!0;var ub=gc.Buffer,
Eb=cb(),rb=Object.prototype.toString,Db="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===rb.call(Blob),Cc="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===rb.call(File);return yf=Ga}function Xb(){if(mf)return Gg;mf=!0;return Gg=function(Ga,ub,Eb){var rb=Ga.byteLength;ub=ub||0;Eb=Eb||rb;if(Ga.slice)return Ga.slice(ub,Eb);0>ub&&(ub+=rb);0>Eb&&(Eb+=rb);Eb>rb&&(Eb=rb);if(ub>=rb||ub>=Eb||0===rb)return new ArrayBuffer(0);Ga=new Uint8Array(Ga);
rb=new Uint8Array(Eb-ub);for(var Db=0;ub<Eb;ub++,Db++)rb[Db]=Ga[ub];return rb.buffer}}function Tb(){function Ga(){}if($a)return Ka;$a=!0;return Ka=function(ub,Eb,rb){function Db(qd,nd){if(0>=Db.count)throw Error("after called too many times");--Db.count;qd?(Cc=!0,Eb(qd),Eb=rb):0!==Db.count||Cc||Eb(null,nd)}var Cc=!1;rb=rb||Ga;Db.count=ub;return 0===ub?Eb():Db}}function Oc(){function Ga(rc){for(var kc=[],Sc=0,xb=rc.length,jd,ke;Sc<xb;)jd=rc.charCodeAt(Sc++),55296<=jd&&56319>=jd&&Sc<xb?(ke=rc.charCodeAt(Sc++),
56320==(ke&64512)?kc.push(((jd&1023)<<10)+(ke&1023)+65536):(kc.push(jd),Sc--)):kc.push(jd);return kc}function ub(rc,kc){if(55296<=rc&&57343>=rc){if(kc)throw Error("Lone surrogate U+"+rc.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function Eb(){if(nd>=qd)throw Error("Invalid byte index");var rc=Cc[nd]&255;nd++;if(128==(rc&192))return rc&63;throw Error("Invalid continuation byte");}function rb(rc){if(nd>qd)throw Error("Invalid byte index");if(nd==qd)return!1;var kc=Cc[nd]&
255;nd++;if(0==(kc&128))return kc;if(192==(kc&224)){var Sc=Eb();kc=(kc&31)<<6|Sc;if(128<=kc)return kc;throw Error("Invalid continuation byte");}if(224==(kc&240)){Sc=Eb();var xb=Eb();kc=(kc&15)<<12|Sc<<6|xb;if(2048<=kc)return ub(kc,rc)?kc:65533;throw Error("Invalid continuation byte");}if(240==(kc&248)&&(Sc=Eb(),xb=Eb(),rc=Eb(),kc=(kc&7)<<18|Sc<<12|xb<<6|rc,65536<=kc&&1114111>=kc))return kc;throw Error("Invalid UTF-8 detected");}if(ba)return Kb;ba=!0;var Db=String.fromCharCode,Cc,qd,nd;return Kb={version:"2.1.2",
encode:function(rc,kc){kc=kc||{};kc=!1!==kc.strict;rc=Ga(rc);for(var Sc=rc.length,xb=-1,jd,ke="";++xb<Sc;){jd=rc[xb];var Se=kc;if(0==(jd&4294967168))jd=Db(jd);else{var de="";0==(jd&4294965248)?de=Db(jd>>6&31|192):0==(jd&4294901760)?(ub(jd,Se)||(jd=65533),de=Db(jd>>12&15|224),de+=Db(jd>>6&63|128)):0==(jd&4292870144)&&(de=Db(jd>>18&7|240),de+=Db(jd>>12&63|128),de+=Db(jd>>6&63|128));jd=de+=Db(jd&63|128)}ke+=jd}return ke},decode:function(rc,kc){kc=kc||{};kc=!1!==kc.strict;Cc=Ga(rc);qd=Cc.length;nd=0;
rc=[];for(var Sc;!1!==(Sc=rb(kc));)rc.push(Sc);kc=rc.length;Sc=-1;for(var xb,jd="";++Sc<kc;)xb=rc[Sc],65535<xb&&(xb-=65536,jd+=Db(xb>>>10&1023|55296),xb=56320|xb&1023),jd+=Db(xb);return jd}}}function td(){if(ob)return Ja;ob=!0;(function(Ga){Ja.encode=function(ub){ub=new Uint8Array(ub);var Eb,rb=ub.length,Db="";for(Eb=0;Eb<rb;Eb+=3)Db+=Ga[ub[Eb]>>2],Db+=Ga[(ub[Eb]&3)<<4|ub[Eb+1]>>4],Db+=Ga[(ub[Eb+1]&15)<<2|ub[Eb+2]>>6],Db+=Ga[ub[Eb+2]&63];2===rb%3?Db=Db.substring(0,Db.length-1)+"=":1===rb%3&&(Db=Db.substring(0,
Db.length-2)+"==");return Db};Ja.decode=function(ub){var Eb=.75*ub.length,rb=ub.length,Db=0;"="===ub[ub.length-1]&&(Eb--,"="===ub[ub.length-2]&&Eb--);var Cc=new ArrayBuffer(Eb),qd=new Uint8Array(Cc);for(Eb=0;Eb<rb;Eb+=4){var nd=Ga.indexOf(ub[Eb]);var rc=Ga.indexOf(ub[Eb+1]);var kc=Ga.indexOf(ub[Eb+2]);var Sc=Ga.indexOf(ub[Eb+3]);qd[Db++]=nd<<2|rc>>4;qd[Db++]=(rc&15)<<4|kc>>2;qd[Db++]=(kc&3)<<6|Sc&63}return Cc}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/");return Ja}function Ob(){function Ga(nd){return nd.map(function(rc){if(rc.buffer instanceof
ArrayBuffer){var kc=rc.buffer;if(rc.byteLength!==kc.byteLength){var Sc=new Uint8Array(rc.byteLength);Sc.set(new Uint8Array(kc,rc.byteOffset,rc.byteLength));kc=Sc.buffer}return kc}return rc})}function ub(nd,rc){rc=rc||{};var kc=new rb;Ga(nd).forEach(function(Sc){kc.append(Sc)});return rc.type?kc.getBlob(rc.type):kc.getBlob()}function Eb(nd,rc){return new Blob(Ga(nd),rc||{})}if(Nc)return zb;Nc=!0;var rb="undefined"!==typeof rb?rb:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!==
typeof MSBlobBuilder?MSBlobBuilder:"undefined"!==typeof MozBlobBuilder?MozBlobBuilder:!1;try{var Db=2===(new Blob(["hi"])).size}catch(nd){Db=!1}var Cc;if(Cc=Db)try{Cc=2===(new Blob([new Uint8Array([1,2])])).size}catch(nd){Cc=!1}var qd=rb&&rb.prototype.append&&rb.prototype.getBlob;"undefined"!==typeof Blob&&(ub.prototype=Blob.prototype,Eb.prototype=Blob.prototype);zb=Db?Cc?Blob:Eb:qd?ub:void 0;return zb}function sb(){function Ga(de,Pe,nf){if(!Pe)return yc.encodeBase64Packet(de,nf);var If=new FileReader;
If.onload=function(){yc.encodePacket({type:de.type,data:If.result},Pe,!0,nf)};return If.readAsArrayBuffer(de.data)}function ub(de,Pe,nf){var If=Array(de.length);nf=Cc(de.length,nf);for(var Mf=function(ch,wh,tg){Pe(wh,function(va,Fa){If[ch]=Fa;tg(va,If)})},Ig=0;Ig<de.length;Ig++)Mf(Ig,de[Ig],nf)}if(Dd)return yc;Dd=!0;var Eb=tc(),rb=bd(),Db=Xb(),Cc=Tb(),qd=Oc(),nd;"undefined"!==typeof ArrayBuffer&&(nd=td());var rc="undefined"!==typeof navigator&&/Android/i.test(navigator.userAgent),kc="undefined"!==
typeof navigator&&/PhantomJS/i.test(navigator.userAgent),Sc=rc||kc;yc.protocol=3;var xb=yc.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},jd=Eb(xb),ke={type:"error",data:"parser error"},Se=Ob();yc.encodePacket=function(de,Pe,nf,If){"function"===typeof Pe&&(If=Pe,Pe=!1);"function"===typeof nf&&(If=nf,nf=null);var Mf=void 0===de.data?void 0:de.data.buffer||de.data;if("undefined"!==typeof ArrayBuffer&&Mf instanceof ArrayBuffer){if(Pe){nf=de.data;Pe=new Uint8Array(nf);nf=new Uint8Array(1+
nf.byteLength);nf[0]=xb[de.type];for(de=0;de<Pe.length;de++)nf[de+1]=Pe[de];de=If(nf.buffer)}else de=yc.encodeBase64Packet(de,If);return de}if("undefined"!==typeof Se&&Mf instanceof Se)return Pe?Sc?de=Ga(de,Pe,If):(Pe=new Uint8Array(1),Pe[0]=xb[de.type],de=new Se([Pe.buffer,de.data]),de=If(de)):de=yc.encodeBase64Packet(de,If),de;if(Mf&&Mf.base64)return If("b"+yc.packets[de.type]+de.data.data);Pe=xb[de.type];void 0!==de.data&&(Pe+=nf?qd.encode(String(de.data),{strict:!1}):String(de.data));return If(""+
Pe)};yc.encodeBase64Packet=function(de,Pe){var nf="b"+yc.packets[de.type];if("undefined"!==typeof Se&&de.data instanceof Se){var If=new FileReader;If.onload=function(){var ch=If.result.split(",")[1];Pe(nf+ch)};return If.readAsDataURL(de.data)}try{var Mf=String.fromCharCode.apply(null,new Uint8Array(de.data))}catch(ch){de=new Uint8Array(de.data);Mf=Array(de.length);for(var Ig=0;Ig<de.length;Ig++)Mf[Ig]=de[Ig];Mf=String.fromCharCode.apply(null,Mf)}nf+=btoa(Mf);return Pe(nf)};yc.decodePacket=function(de,
Pe,nf){if(void 0===de)return ke;if("string"===typeof de){if("b"===de.charAt(0))return yc.decodeBase64Packet(de.substr(1),Pe);if(nf){a:{Pe=de;try{Pe=qd.decode(Pe,{strict:!1})}catch(If){de=!1;break a}de=Pe}if(!1===de)return ke}nf=de.charAt(0);return Number(nf)==nf&&jd[nf]?1<de.length?{type:jd[nf],data:de.substring(1)}:{type:jd[nf]}:ke}nf=(new Uint8Array(de))[0];de=Db(de,1);Se&&"blob"===Pe&&(de=new Se([de]));return{type:jd[nf],data:de}};yc.decodeBase64Packet=function(de,Pe){var nf=jd[de.charAt(0)];if(!nd)return{type:nf,
data:{base64:!0,data:de.substr(1)}};de=nd.decode(de.substr(1));"blob"===Pe&&Se&&(de=new Se([de]));return{type:nf,data:de}};yc.encodePayload=function(de,Pe,nf){"function"===typeof Pe&&(nf=Pe,Pe=null);var If=rb(de);if(Pe&&If)return Se&&!Sc?yc.encodePayloadAsBlob(de,nf):yc.encodePayloadAsArrayBuffer(de,nf);if(!de.length)return nf("0:");ub(de,function(Mf,Ig){yc.encodePacket(Mf,If?Pe:!1,!1,function(ch){Ig(null,ch.length+":"+ch)})},function(Mf,Ig){return nf(Ig.join(""))})};yc.decodePayload=function(de,
Pe,nf){if("string"!==typeof de)return yc.decodePayloadAsBinary(de,Pe,nf);"function"===typeof Pe&&(nf=Pe,Pe=null);if(""===de)return nf(ke,0,1);var If="";for(var Mf,Ig,ch=0,wh=de.length;ch<wh;ch++)if(Ig=de.charAt(ch),":"!==Ig)If+=Ig;else{if(""===If||If!=(Mf=Number(If)))return nf(ke,0,1);Ig=de.substr(ch+1,Mf);if(If!=Ig.length)return nf(ke,0,1);if(Ig.length){If=yc.decodePacket(Ig,Pe,!1);if(ke.type===If.type&&ke.data===If.data)return nf(ke,0,1);if(!1===nf(If,ch+Mf,wh))return}ch+=Mf;If=""}if(""!==If)return nf(ke,
0,1)};yc.encodePayloadAsArrayBuffer=function(de,Pe){if(!de.length)return Pe(new ArrayBuffer(0));ub(de,function(nf,If){yc.encodePacket(nf,!0,!0,function(Mf){return If(null,Mf)})},function(nf,If){nf=If.reduce(function(ch,wh){wh="string"===typeof wh?wh.length:wh.byteLength;return ch+wh.toString().length+wh+2},0);var Mf=new Uint8Array(nf),Ig=0;If.forEach(function(ch){var wh="string"===typeof ch,tg=ch;if(wh){tg=new Uint8Array(ch.length);for(var va=0;va<ch.length;va++)tg[va]=ch.charCodeAt(va);tg=tg.buffer}wh?
Mf[Ig++]=0:Mf[Ig++]=1;ch=tg.byteLength.toString();for(va=0;va<ch.length;va++)Mf[Ig++]=parseInt(ch[va]);Mf[Ig++]=255;tg=new Uint8Array(tg);for(va=0;va<tg.length;va++)Mf[Ig++]=tg[va]});return Pe(Mf.buffer)})};yc.encodePayloadAsBlob=function(de,Pe){ub(de,function(nf,If){yc.encodePacket(nf,!0,!0,function(Mf){var Ig=new Uint8Array(1);Ig[0]=1;if("string"===typeof Mf){for(var ch=new Uint8Array(Mf.length),wh=0;wh<Mf.length;wh++)ch[wh]=Mf.charCodeAt(wh);Mf=ch.buffer;Ig[0]=0}ch=(Mf instanceof ArrayBuffer?Mf.byteLength:
Mf.size).toString();var tg=new Uint8Array(ch.length+1);for(wh=0;wh<ch.length;wh++)tg[wh]=parseInt(ch[wh]);tg[ch.length]=255;Se&&(Mf=new Se([Ig.buffer,tg.buffer,Mf]),If(null,Mf))})},function(nf,If){return Pe(new Se(If))})};yc.decodePayloadAsBinary=function(de,Pe,nf){"function"===typeof Pe&&(nf=Pe,Pe=null);for(var If=[];0<de.byteLength;){for(var Mf=new Uint8Array(de),Ig=0===Mf[0],ch="",wh=1;255!==Mf[wh];wh++){if(310<ch.length)return nf(ke,0,1);ch+=Mf[wh]}de=Db(de,2+ch.length);ch=parseInt(ch);Mf=Db(de,
0,ch);if(Ig)try{Mf=String.fromCharCode.apply(null,new Uint8Array(Mf))}catch(va){for(Ig=new Uint8Array(Mf),Mf="",wh=0;wh<Ig.length;wh++)Mf+=String.fromCharCode(Ig[wh])}If.push(Mf);de=Db(de,ch)}var tg=If.length;If.forEach(function(va,Fa){nf(yc.decodePacket(va,Pe,!0),Fa,tg)})};return yc}function hb(){function Ga(rb){(this||Ie).path=rb.path;(this||Ie).hostname=rb.hostname;(this||Ie).port=rb.port;(this||Ie).secure=rb.secure;(this||Ie).query=rb.query;(this||Ie).timestampParam=rb.timestampParam;(this||Ie).timestampRequests=
rb.timestampRequests;(this||Ie).readyState="";(this||Ie).agent=rb.agent||!1;(this||Ie).socket=rb.socket;(this||Ie).enablesXDR=rb.enablesXDR;(this||Ie).withCredentials=rb.withCredentials;(this||Ie).pfx=rb.pfx;(this||Ie).key=rb.key;(this||Ie).passphrase=rb.passphrase;(this||Ie).cert=rb.cert;(this||Ie).ca=rb.ca;(this||Ie).ciphers=rb.ciphers;(this||Ie).rejectUnauthorized=rb.rejectUnauthorized;(this||Ie).forceNode=rb.forceNode;(this||Ie).isReactNative=rb.isReactNative;(this||Ie).extraHeaders=rb.extraHeaders;
(this||Ie).localAddress=rb.localAddress}if(Bd)return zd;Bd=!0;var ub=sb(),Eb=kd();zd=Ga;Eb(Ga.prototype);Ga.prototype.onError=function(rb,Db){rb=Error(rb);rb.type="TransportError";rb.description=Db;this.emit("error",rb);return this||Ie};Ga.prototype.open=function(){if("closed"===(this||Ie).readyState||""===(this||Ie).readyState)(this||Ie).readyState="opening",this.doOpen();return this||Ie};Ga.prototype.close=function(){if("opening"===(this||Ie).readyState||"open"===(this||Ie).readyState)this.doClose(),
this.onClose();return this||Ie};Ga.prototype.send=function(rb){if("open"===(this||Ie).readyState)this.write(rb);else throw Error("Transport not open");};Ga.prototype.onOpen=function(){(this||Ie).readyState="open";(this||Ie).writable=!0;this.emit("open")};Ga.prototype.onData=function(rb){rb=ub.decodePacket(rb,(this||Ie).socket.binaryType);this.onPacket(rb)};Ga.prototype.onPacket=function(rb){this.emit("packet",rb)};Ga.prototype.onClose=function(){(this||Ie).readyState="closed";this.emit("close")};
return zd}function qb(){if(wg)return Jg;wg=!0;Jg.encode=function(Ga){var ub="",Eb;for(Eb in Ga)Ga.hasOwnProperty(Eb)&&(ub.length&&(ub+="&"),ub+=encodeURIComponent(Eb)+"="+encodeURIComponent(Ga[Eb]));return ub};Jg.decode=function(Ga){var ub={};Ga=Ga.split("&");for(var Eb=0,rb=Ga.length;Eb<rb;Eb++){var Db=Ga[Eb].split("=");ub[decodeURIComponent(Db[0])]=decodeURIComponent(Db[1])}return ub};return Jg}function Aa(){if(Vf)return Qh;Vf=!0;return Qh=function(Ga,ub){var Eb=function(){};Eb.prototype=ub.prototype;
Ga.prototype=new Eb;Ga.prototype.constructor=Ga}}function bb(){function Ga(nd){var rc="";do rc=Eb[nd%64]+rc,nd=Math.floor(nd/64);while(0<nd);return rc}function ub(){var nd=Ga(+new Date);return nd!==qd?(Db=0,qd=nd):nd+"."+Ga(Db++)}if(ek)return Hh;ek=!0;for(var Eb="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),rb={},Db=0,Cc=0,qd;64>Cc;Cc++)rb[Eb[Cc]]=Cc;ub.encode=Ga;ub.decode=function(nd){var rc=0;for(Cc=0;Cc<nd.length;Cc++)rc=64*rc+rb[nd.charAt(Cc)];return rc};return Hh=
ub}function wb(){function Ga(rc){var kc=rc&&rc.forceBase64;if(!nd||kc)(this||Hf).supportsBinary=!1;ub.call(this||Hf,rc)}if(ml)return Zh;ml=!0;var ub=hb(),Eb=qb(),rb=sb(),Db=Aa(),Cc=bb(),qd=ee()("engine.io-client:polling");Zh=Ga;var nd=null!=(new (pd())({xdomain:!1})).responseType;Db(Ga,ub);Ga.prototype.name="polling";Ga.prototype.doOpen=function(){this.poll()};Ga.prototype.pause=function(rc){function kc(){qd("paused");Sc.readyState="paused";rc()}var Sc=this||Hf;(this||Hf).readyState="pausing";if((this||
Hf).polling||!(this||Hf).writable){var xb=0;(this||Hf).polling&&(qd("we are currently polling - waiting to pause"),xb++,this.once("pollComplete",function(){qd("pre-pause polling complete");--xb||kc()}));(this||Hf).writable||(qd("we are currently writing - waiting to pause"),xb++,this.once("drain",function(){qd("pre-pause writing complete");--xb||kc()}))}else kc()};Ga.prototype.poll=function(){qd("polling");(this||Hf).polling=!0;this.doPoll();this.emit("poll")};Ga.prototype.onData=function(rc){var kc=
this||Hf;qd("polling got data %s",rc);rb.decodePayload(rc,(this||Hf).socket.binaryType,function(Sc,xb,jd){if("opening"===kc.readyState)kc.onOpen();if("close"===Sc.type)return kc.onClose(),!1;kc.onPacket(Sc)});"closed"!==(this||Hf).readyState&&((this||Hf).polling=!1,this.emit("pollComplete"),"open"===(this||Hf).readyState?this.poll():qd('ignoring poll - transport state "%s"',(this||Hf).readyState))};Ga.prototype.doClose=function(){function rc(){qd("writing close packet");kc.write([{type:"close"}])}
var kc=this||Hf;"open"===(this||Hf).readyState?(qd("transport open - closing"),rc()):(qd("transport not open - deferring close"),this.once("open",rc))};Ga.prototype.write=function(rc){var kc=this||Hf;(this||Hf).writable=!1;var Sc=function(){kc.writable=!0;kc.emit("drain")};rb.encodePayload(rc,(this||Hf).supportsBinary,function(xb){kc.doWrite(xb,Sc)})};Ga.prototype.uri=function(){var rc=(this||Hf).query||{},kc=(this||Hf).secure?"https":"http",Sc="";!1!==(this||Hf).timestampRequests&&(rc[(this||Hf).timestampParam]=
Cc());(this||Hf).supportsBinary||rc.sid||(rc.b64=1);rc=Eb.encode(rc);(this||Hf).port&&("https"===kc&&443!==Number((this||Hf).port)||"http"===kc&&80!==Number((this||Hf).port))&&(Sc=":"+(this||Hf).port);rc.length&&(rc="?"+rc);var xb=-1!==(this||Hf).hostname.indexOf(":");return kc+"://"+(xb?"["+(this||Hf).hostname+"]":(this||Hf).hostname)+Sc+(this||Hf).path+rc};return Zh}function Hb(){function Ga(){}function ub(Sc){Cc.call(this||Oe,Sc);(this||Oe).requestTimeout=Sc.requestTimeout;(this||Oe).extraHeaders=
Sc.extraHeaders;if("undefined"!==typeof location){var xb="https:"===location.protocol,jd=location.port;jd||(jd=xb?443:80);(this||Oe).xd="undefined"!==typeof location&&Sc.hostname!==location.hostname||jd!==Sc.port;(this||Oe).xs=Sc.secure!==xb}}function Eb(Sc){(this||Oe).method=Sc.method||"GET";(this||Oe).uri=Sc.uri;(this||Oe).xd=!!Sc.xd;(this||Oe).xs=!!Sc.xs;(this||Oe).async=!1!==Sc.async;(this||Oe).data=void 0!==Sc.data?Sc.data:null;(this||Oe).agent=Sc.agent;(this||Oe).isBinary=Sc.isBinary;(this||
Oe).supportsBinary=Sc.supportsBinary;(this||Oe).enablesXDR=Sc.enablesXDR;(this||Oe).withCredentials=Sc.withCredentials;(this||Oe).requestTimeout=Sc.requestTimeout;(this||Oe).pfx=Sc.pfx;(this||Oe).key=Sc.key;(this||Oe).passphrase=Sc.passphrase;(this||Oe).cert=Sc.cert;(this||Oe).ca=Sc.ca;(this||Oe).ciphers=Sc.ciphers;(this||Oe).rejectUnauthorized=Sc.rejectUnauthorized;(this||Oe).extraHeaders=Sc.extraHeaders;this.create()}function rb(){for(var Sc in Eb.requests)Eb.requests.hasOwnProperty(Sc)&&Eb.requests[Sc].abort()}
if(bj)return Gj;bj=!0;var Db=pd(),Cc=wb(),qd=kd(),nd=Aa(),rc=ee()("engine.io-client:polling-xhr"),kc=sd();Gj=ub;Gj.Request=Eb;nd(ub,Cc);ub.prototype.supportsBinary=!0;ub.prototype.request=function(Sc){Sc=Sc||{};Sc.uri=this.uri();Sc.xd=(this||Oe).xd;Sc.xs=(this||Oe).xs;Sc.agent=(this||Oe).agent||!1;Sc.supportsBinary=(this||Oe).supportsBinary;Sc.enablesXDR=(this||Oe).enablesXDR;Sc.withCredentials=(this||Oe).withCredentials;Sc.pfx=(this||Oe).pfx;Sc.key=(this||Oe).key;Sc.passphrase=(this||Oe).passphrase;
Sc.cert=(this||Oe).cert;Sc.ca=(this||Oe).ca;Sc.ciphers=(this||Oe).ciphers;Sc.rejectUnauthorized=(this||Oe).rejectUnauthorized;Sc.requestTimeout=(this||Oe).requestTimeout;Sc.extraHeaders=(this||Oe).extraHeaders;return new Eb(Sc)};ub.prototype.doWrite=function(Sc,xb){Sc=this.request({method:"POST",data:Sc,isBinary:"string"!==typeof Sc&&void 0!==Sc});var jd=this||Oe;Sc.on("success",xb);Sc.on("error",function(ke){jd.onError("xhr post error",ke)});(this||Oe).sendXhr=Sc};ub.prototype.doPoll=function(){rc("xhr poll");
var Sc=this.request(),xb=this||Oe;Sc.on("data",function(jd){xb.onData(jd)});Sc.on("error",function(jd){xb.onError("xhr poll error",jd)});(this||Oe).pollXhr=Sc};qd(Eb.prototype);Eb.prototype.create=function(){var Sc={agent:(this||Oe).agent,xdomain:(this||Oe).xd,xscheme:(this||Oe).xs,enablesXDR:(this||Oe).enablesXDR};Sc.pfx=(this||Oe).pfx;Sc.key=(this||Oe).key;Sc.passphrase=(this||Oe).passphrase;Sc.cert=(this||Oe).cert;Sc.ca=(this||Oe).ca;Sc.ciphers=(this||Oe).ciphers;Sc.rejectUnauthorized=(this||Oe).rejectUnauthorized;
var xb=(this||Oe).xhr=new Db(Sc),jd=this||Oe;try{rc("xhr open %s: %s",(this||Oe).method,(this||Oe).uri);xb.open((this||Oe).method,(this||Oe).uri,(this||Oe).async);try{if((this||Oe).extraHeaders){xb.setDisableHeaderCheck&&xb.setDisableHeaderCheck(!0);for(var ke in(this||Oe).extraHeaders)(this||Oe).extraHeaders.hasOwnProperty(ke)&&xb.setRequestHeader(ke,(this||Oe).extraHeaders[ke])}}catch(Se){}if("POST"===(this||Oe).method)try{(this||Oe).isBinary?xb.setRequestHeader("Content-type","application/octet-stream"):
xb.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(Se){}try{xb.setRequestHeader("Accept","*/*")}catch(Se){}"withCredentials"in xb&&(xb.withCredentials=(this||Oe).withCredentials);(this||Oe).requestTimeout&&(xb.timeout=(this||Oe).requestTimeout);this.hasXDR()?(xb.onload=function(){jd.onLoad()},xb.onerror=function(){jd.onError(xb.responseText)}):xb.onreadystatechange=function(){if(2===xb.readyState)try{var Se=xb.getResponseHeader("Content-Type");if(jd.supportsBinary&&"application/octet-stream"===
Se||"application/octet-stream; charset=UTF-8"===Se)xb.responseType="arraybuffer"}catch(de){}if(4===xb.readyState)if(200===xb.status||1223===xb.status)jd.onLoad();else setTimeout(function(){jd.onError("number"===typeof xb.status?xb.status:0)},0)};rc("xhr data %s",(this||Oe).data);xb.send((this||Oe).data)}catch(Se){setTimeout(function(){jd.onError(Se)},0);return}"undefined"!==typeof document&&((this||Oe).index=Eb.requestsCount++,Eb.requests[(this||Oe).index]=this||Oe)};Eb.prototype.onSuccess=function(){this.emit("success");
this.cleanup()};Eb.prototype.onData=function(Sc){this.emit("data",Sc);this.onSuccess()};Eb.prototype.onError=function(Sc){this.emit("error",Sc);this.cleanup(!0)};Eb.prototype.cleanup=function(Sc){if("undefined"!==typeof(this||Oe).xhr&&null!==(this||Oe).xhr){this.hasXDR()?(this||Oe).xhr.onload=(this||Oe).xhr.onerror=Ga:(this||Oe).xhr.onreadystatechange=Ga;if(Sc)try{(this||Oe).xhr.abort()}catch(xb){}"undefined"!==typeof document&&delete Eb.requests[(this||Oe).index];(this||Oe).xhr=null}};Eb.prototype.onLoad=
function(){try{try{var Sc=(this||Oe).xhr.getResponseHeader("Content-Type")}catch(jd){}var xb="application/octet-stream"===Sc||"application/octet-stream; charset=UTF-8"===Sc?(this||Oe).xhr.response||(this||Oe).xhr.responseText:(this||Oe).xhr.responseText}catch(jd){this.onError(jd)}if(null!=xb)this.onData(xb)};Eb.prototype.hasXDR=function(){return"undefined"!==typeof XDomainRequest&&!(this||Oe).xs&&(this||Oe).enablesXDR};Eb.prototype.abort=function(){this.cleanup()};Eb.requestsCount=0;Eb.requests={};
"undefined"!==typeof document&&("function"===typeof attachEvent?attachEvent("onunload",rb):"function"===typeof addEventListener&&addEventListener("onpagehide"in kc?"pagehide":"unload",rb,!1));return Gj}function Qb(){function Ga(){}function ub(rc){Eb.call(this||ih,rc);(this||ih).query=(this||ih).query||{};nd||(nd=Db.___eio=Db.___eio||[]);(this||ih).index=nd.length;var kc=this||ih;nd.push(function(Sc){kc.onData(Sc)});(this||ih).query.j=(this||ih).index;"function"===typeof addEventListener&&addEventListener("beforeunload",
function(){kc.script&&(kc.script.onerror=Ga)},!1)}if(kl)return Kk;kl=!0;var Eb=wb(),rb=Aa(),Db=sd();Kk=ub;var Cc=/\n/g,qd=/\\n/g,nd;rb(ub,Eb);ub.prototype.supportsBinary=!1;ub.prototype.doClose=function(){(this||ih).script&&((this||ih).script.parentNode.removeChild((this||ih).script),(this||ih).script=null);(this||ih).form&&((this||ih).form.parentNode.removeChild((this||ih).form),(this||ih).form=null,(this||ih).iframe=null);Eb.prototype.doClose.call(this||ih)};ub.prototype.doPoll=function(){var rc=
this||ih,kc=document.createElement("script");(this||ih).script&&((this||ih).script.parentNode.removeChild((this||ih).script),(this||ih).script=null);kc.async=!0;kc.src=this.uri();kc.onerror=function(xb){rc.onError("jsonp poll error",xb)};var Sc=document.getElementsByTagName("script")[0];Sc?Sc.parentNode.insertBefore(kc,Sc):(document.head||document.body).appendChild(kc);(this||ih).script=kc;"undefined"!==typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var xb=document.createElement("iframe");
document.body.appendChild(xb);document.body.removeChild(xb)},100)};ub.prototype.doWrite=function(rc,kc){function Sc(){xb();kc()}function xb(){if(jd.iframe)try{jd.form.removeChild(jd.iframe)}catch(nf){jd.onError("jsonp polling iframe removal error",nf)}try{Pe=document.createElement('<iframe src="javascript:0" name="'+jd.iframeId+'">')}catch(nf){Pe=document.createElement("iframe"),Pe.name=jd.iframeId,Pe.src="javascript:0"}Pe.id=jd.iframeId;jd.form.appendChild(Pe);jd.iframe=Pe}var jd=this||ih;if(!(this||
ih).form){var ke=document.createElement("form"),Se=document.createElement("textarea"),de=(this||ih).iframeId="eio_iframe_"+(this||ih).index,Pe;ke.className="socketio";ke.style.position="absolute";ke.style.top="-1000px";ke.style.left="-1000px";ke.target=de;ke.method="POST";ke.setAttribute("accept-charset","utf-8");Se.name="d";ke.appendChild(Se);document.body.appendChild(ke);(this||ih).form=ke;(this||ih).area=Se}(this||ih).form.action=this.uri();xb();rc=rc.replace(qd,"\\\n");(this||ih).area.value=rc.replace(Cc,
"\\n");try{(this||ih).form.submit()}catch(nf){}(this||ih).iframe.attachEvent?(this||ih).iframe.onreadystatechange=function(){"complete"===jd.iframe.readyState&&Sc()}:(this||ih).iframe.onload=Sc};return Kk}function lb(){if(ul)return dm;ul=!0;return dm=function(){throw Error("ws does not work in the browser. Browser clients must use the native WebSocket object");}}function mb(){function Ga(xb){xb&&xb.forceBase64&&((this||sg).supportsBinary=!1);(this||sg).perMessageDeflate=xb.perMessageDeflate;(this||
sg).usingBrowserWebSocket=rc&&!xb.forceNode;(this||sg).protocols=xb.protocols;(this||sg).usingBrowserWebSocket||(Sc=kc);Eb.call(this||sg,xb)}if(Si)return dl;Si=!0;var ub=gc.Buffer,Eb=hb(),rb=sb(),Db=qb(),Cc=Aa(),qd=bb(),nd=ee()("engine.io-client:websocket"),rc;"undefined"!==typeof WebSocket?rc=WebSocket:"undefined"!==typeof self&&(rc=self.WebSocket||self.MozWebSocket);if("undefined"===typeof window)try{var kc=lb()}catch(xb){}var Sc=rc||kc;dl=Ga;Cc(Ga,Eb);Ga.prototype.name="websocket";Ga.prototype.supportsBinary=
!0;Ga.prototype.doOpen=function(){if(this.check()){var xb=this.uri(),jd=(this||sg).protocols,ke={};(this||sg).isReactNative||(ke.agent=(this||sg).agent,ke.perMessageDeflate=(this||sg).perMessageDeflate,ke.pfx=(this||sg).pfx,ke.key=(this||sg).key,ke.passphrase=(this||sg).passphrase,ke.cert=(this||sg).cert,ke.ca=(this||sg).ca,ke.ciphers=(this||sg).ciphers,ke.rejectUnauthorized=(this||sg).rejectUnauthorized);(this||sg).extraHeaders&&(ke.headers=(this||sg).extraHeaders);(this||sg).localAddress&&(ke.localAddress=
(this||sg).localAddress);try{(this||sg).ws=(this||sg).usingBrowserWebSocket&&!(this||sg).isReactNative?jd?new Sc(xb,jd):new Sc(xb):new Sc(xb,jd,ke)}catch(Se){return this.emit("error",Se)}void 0===(this||sg).ws.binaryType&&((this||sg).supportsBinary=!1);(this||sg).ws.supports&&(this||sg).ws.supports.binary?((this||sg).supportsBinary=!0,(this||sg).ws.binaryType="nodebuffer"):(this||sg).ws.binaryType="arraybuffer";this.addEventListeners()}};Ga.prototype.addEventListeners=function(){var xb=this||sg;(this||
sg).ws.onopen=function(){xb.onOpen()};(this||sg).ws.onclose=function(){xb.onClose()};(this||sg).ws.onmessage=function(jd){xb.onData(jd.data)};(this||sg).ws.onerror=function(jd){xb.onError("websocket error",jd)}};Ga.prototype.write=function(xb){function jd(){ke.emit("flush");setTimeout(function(){ke.writable=!0;ke.emit("drain")},0)}var ke=this||sg;(this||sg).writable=!1;for(var Se=xb.length,de=0,Pe=Se;de<Pe;de++)(function(nf){rb.encodePacket(nf,ke.supportsBinary,function(If){if(!ke.usingBrowserWebSocket){var Mf=
{};nf.options&&(Mf.compress=nf.options.compress);ke.perMessageDeflate&&("string"===typeof If?ub.byteLength(If):If.length)<ke.perMessageDeflate.threshold&&(Mf.compress=!1)}try{ke.usingBrowserWebSocket?ke.ws.send(If):ke.ws.send(If,Mf)}catch(Ig){nd("websocket closed before onclose event")}--Se||jd()})})(xb[de])};Ga.prototype.onClose=function(){Eb.prototype.onClose.call(this||sg)};Ga.prototype.doClose=function(){"undefined"!==typeof(this||sg).ws&&(this||sg).ws.close()};Ga.prototype.uri=function(){var xb=
(this||sg).query||{},jd=(this||sg).secure?"wss":"ws",ke="";(this||sg).port&&("wss"===jd&&443!==Number((this||sg).port)||"ws"===jd&&80!==Number((this||sg).port))&&(ke=":"+(this||sg).port);(this||sg).timestampRequests&&(xb[(this||sg).timestampParam]=qd());(this||sg).supportsBinary||(xb.b64=1);xb=Db.encode(xb);xb.length&&(xb="?"+xb);var Se=-1!==(this||sg).hostname.indexOf(":");return jd+"://"+(Se?"["+(this||sg).hostname+"]":(this||sg).hostname)+ke+(this||sg).path+xb};Ga.prototype.check=function(){return!!Sc&&
!("__initialize"in Sc&&(this||sg).name===Ga.prototype.name)};return dl}function Rb(){if(Xm)return Rf;Xm=!0;var Ga=pd(),ub=Hb(),Eb=Qb(),rb=mb();Rf.polling=function(Db){var Cc=!1,qd=!1,nd=!1!==Db.jsonp;"undefined"!==typeof location&&(qd="https:"===location.protocol,(Cc=location.port)||(Cc=qd?443:80),Cc=Db.hostname!==location.hostname||Cc!==Db.port,qd=Db.secure!==qd);Db.xdomain=Cc;Db.xscheme=qd;if("open"in new Ga(Db)&&!Db.forceJSONP)return new ub(Db);if(!nd)throw Error("JSONP disabled");return new Eb(Db)};
Rf.websocket=rb;return Rf}function Gc(){if($b)return Zb;$b=!0;var Ga=[].indexOf;return Zb=function(ub,Eb){if(Ga)return ub.indexOf(Eb);for(var rb=0;rb<ub.length;++rb)if(ub[rb]===Eb)return rb;return-1}}function mc(){function Ga(rc,kc){if(!((this||hd)instanceof Ga))return new Ga(rc,kc);kc=kc||{};rc&&"object"===typeof rc&&(kc=rc,rc=null);rc?(rc=qd(rc),kc.hostname=rc.host,kc.secure="https"===rc.protocol||"wss"===rc.protocol,kc.port=rc.port,rc.query&&(kc.query=rc.query)):kc.host&&(kc.hostname=qd(kc.host).host);
(this||hd).secure=null!=kc.secure?kc.secure:"undefined"!==typeof location&&"https:"===location.protocol;kc.hostname&&!kc.port&&(kc.port=(this||hd).secure?"443":"80");(this||hd).agent=kc.agent||!1;(this||hd).hostname=kc.hostname||("undefined"!==typeof location?location.hostname:"localhost");(this||hd).port=kc.port||("undefined"!==typeof location&&location.port?location.port:(this||hd).secure?443:80);(this||hd).query=kc.query||{};"string"===typeof(this||hd).query&&((this||hd).query=nd.decode((this||
hd).query));(this||hd).upgrade=!1!==kc.upgrade;(this||hd).path=(kc.path||"/engine.io").replace(/\/$/,"")+"/";(this||hd).forceJSONP=!!kc.forceJSONP;(this||hd).jsonp=!1!==kc.jsonp;(this||hd).forceBase64=!!kc.forceBase64;(this||hd).enablesXDR=!!kc.enablesXDR;(this||hd).withCredentials=!1!==kc.withCredentials;(this||hd).timestampParam=kc.timestampParam||"t";(this||hd).timestampRequests=kc.timestampRequests;(this||hd).transports=kc.transports||["polling","websocket"];(this||hd).transportOptions=kc.transportOptions||
{};(this||hd).readyState="";(this||hd).writeBuffer=[];(this||hd).prevBufferLen=0;(this||hd).policyPort=kc.policyPort||843;(this||hd).rememberUpgrade=kc.rememberUpgrade||!1;(this||hd).binaryType=null;(this||hd).onlyBinaryUpgrades=kc.onlyBinaryUpgrades;(this||hd).perMessageDeflate=!1!==kc.perMessageDeflate?kc.perMessageDeflate||{}:!1;!0===(this||hd).perMessageDeflate&&((this||hd).perMessageDeflate={});(this||hd).perMessageDeflate&&null==(this||hd).perMessageDeflate.threshold&&((this||hd).perMessageDeflate.threshold=
1024);(this||hd).pfx=kc.pfx||null;(this||hd).key=kc.key||null;(this||hd).passphrase=kc.passphrase||null;(this||hd).cert=kc.cert||null;(this||hd).ca=kc.ca||null;(this||hd).ciphers=kc.ciphers||null;(this||hd).rejectUnauthorized=void 0===kc.rejectUnauthorized?!0:kc.rejectUnauthorized;(this||hd).forceNode=!!kc.forceNode;(this||hd).isReactNative="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();if("undefined"===typeof self||(this||hd).isReactNative)kc.extraHeaders&&
0<Object.keys(kc.extraHeaders).length&&((this||hd).extraHeaders=kc.extraHeaders),kc.localAddress&&((this||hd).localAddress=kc.localAddress);(this||hd).id=null;(this||hd).upgrades=null;(this||hd).pingInterval=null;(this||hd).pingTimeout=null;(this||hd).pingIntervalTimer=null;(this||hd).pingTimeoutTimer=null;this.open()}if(Ae)return Ce;Ae=!0;var ub=Rb(),Eb=kd(),rb=ee()("engine.io-client:socket"),Db=Gc(),Cc=sb(),qd=Uc(),nd=qb();Ce=Ga;Ga.priorWebsocketSuccess=!1;Eb(Ga.prototype);Ga.protocol=Cc.protocol;
Ga.Socket=Ga;Ga.Transport=hb();Ga.transports=Rb();Ga.parser=sb();Ga.prototype.createTransport=function(rc){rb('creating transport "%s"',rc);var kc=(this||hd).query,Sc={},xb;for(xb in kc)kc.hasOwnProperty(xb)&&(Sc[xb]=kc[xb]);Sc.EIO=Cc.protocol;Sc.transport=rc;kc=(this||hd).transportOptions[rc]||{};(this||hd).id&&(Sc.sid=(this||hd).id);return new ub[rc]({query:Sc,socket:this||hd,agent:kc.agent||(this||hd).agent,hostname:kc.hostname||(this||hd).hostname,port:kc.port||(this||hd).port,secure:kc.secure||
(this||hd).secure,path:kc.path||(this||hd).path,forceJSONP:kc.forceJSONP||(this||hd).forceJSONP,jsonp:kc.jsonp||(this||hd).jsonp,forceBase64:kc.forceBase64||(this||hd).forceBase64,enablesXDR:kc.enablesXDR||(this||hd).enablesXDR,withCredentials:kc.withCredentials||(this||hd).withCredentials,timestampRequests:kc.timestampRequests||(this||hd).timestampRequests,timestampParam:kc.timestampParam||(this||hd).timestampParam,policyPort:kc.policyPort||(this||hd).policyPort,pfx:kc.pfx||(this||hd).pfx,key:kc.key||
(this||hd).key,passphrase:kc.passphrase||(this||hd).passphrase,cert:kc.cert||(this||hd).cert,ca:kc.ca||(this||hd).ca,ciphers:kc.ciphers||(this||hd).ciphers,rejectUnauthorized:kc.rejectUnauthorized||(this||hd).rejectUnauthorized,perMessageDeflate:kc.perMessageDeflate||(this||hd).perMessageDeflate,extraHeaders:kc.extraHeaders||(this||hd).extraHeaders,forceNode:kc.forceNode||(this||hd).forceNode,localAddress:kc.localAddress||(this||hd).localAddress,requestTimeout:kc.requestTimeout||(this||hd).requestTimeout,
protocols:kc.protocols||void 0,isReactNative:(this||hd).isReactNative})};Ga.prototype.open=function(){if((this||hd).rememberUpgrade&&Ga.priorWebsocketSuccess&&-1!==(this||hd).transports.indexOf("websocket"))var rc="websocket";else{if(0===(this||hd).transports.length){var kc=this||hd;setTimeout(function(){kc.emit("error","No transports available")},0);return}rc=(this||hd).transports[0]}(this||hd).readyState="opening";try{rc=this.createTransport(rc)}catch(Sc){(this||hd).transports.shift();this.open();
return}rc.open();this.setTransport(rc)};Ga.prototype.setTransport=function(rc){rb("setting transport %s",rc.name);var kc=this||hd;(this||hd).transport&&(rb("clearing existing transport %s",(this||hd).transport.name),(this||hd).transport.removeAllListeners());(this||hd).transport=rc;rc.on("drain",function(){kc.onDrain()}).on("packet",function(Sc){kc.onPacket(Sc)}).on("error",function(Sc){kc.onError(Sc)}).on("close",function(){kc.onClose("transport close")})};Ga.prototype.probe=function(rc){function kc(){if(If.onlyBinaryUpgrades){var Mf=
!(this||hd).supportsBinary&&If.transport.supportsBinary;nf=nf||Mf}nf||(rb('probe transport "%s" opened',rc),Pe.send([{type:"ping",data:"probe"}]),Pe.once("packet",function(Ig){nf||("pong"===Ig.type&&"probe"===Ig.data?(rb('probe transport "%s" pong',rc),If.upgrading=!0,If.emit("upgrading",Pe),Pe&&(Ga.priorWebsocketSuccess="websocket"===Pe.name,rb('pausing current transport "%s"',If.transport.name),If.transport.pause(function(){nf||"closed"===If.readyState||(rb("changing transport and sending upgrade packet"),
de(),If.setTransport(Pe),Pe.send([{type:"upgrade"}]),If.emit("upgrade",Pe),Pe=null,If.upgrading=!1,If.flush())}))):(rb('probe transport "%s" failed',rc),Ig=Error("probe error"),Ig.transport=Pe.name,If.emit("upgradeError",Ig)))}))}function Sc(){nf||(nf=!0,de(),Pe.close(),Pe=null)}function xb(Mf){var Ig=Error("probe error: "+Mf);Ig.transport=Pe.name;Sc();rb('probe transport "%s" failed because of error: %s',rc,Mf);If.emit("upgradeError",Ig)}function jd(){xb("transport closed")}function ke(){xb("socket closed")}
function Se(Mf){Pe&&Mf.name!==Pe.name&&(rb('"%s" works - aborting "%s"',Mf.name,Pe.name),Sc())}function de(){Pe.removeListener("open",kc);Pe.removeListener("error",xb);Pe.removeListener("close",jd);If.removeListener("close",ke);If.removeListener("upgrading",Se)}rb('probing transport "%s"',rc);var Pe=this.createTransport(rc,{probe:1}),nf=!1,If=this||hd;Ga.priorWebsocketSuccess=!1;Pe.once("open",kc);Pe.once("error",xb);Pe.once("close",jd);this.once("close",ke);this.once("upgrading",Se);Pe.open()};Ga.prototype.onOpen=
function(){rb("socket open");(this||hd).readyState="open";Ga.priorWebsocketSuccess="websocket"===(this||hd).transport.name;this.emit("open");this.flush();if("open"===(this||hd).readyState&&(this||hd).upgrade&&(this||hd).transport.pause){rb("starting upgrade probes");for(var rc=0,kc=(this||hd).upgrades.length;rc<kc;rc++)this.probe((this||hd).upgrades[rc])}};Ga.prototype.onPacket=function(rc){if("opening"===(this||hd).readyState||"open"===(this||hd).readyState||"closing"===(this||hd).readyState)switch(rb('socket receive: type "%s", data "%s"',
rc.type,rc.data),this.emit("packet",rc),this.emit("heartbeat"),rc.type){case "open":this.onHandshake(JSON.parse(rc.data));break;case "pong":this.setPing();this.emit("pong");break;case "error":var kc=Error("server error");kc.code=rc.data;this.onError(kc);break;case "message":this.emit("data",rc.data),this.emit("message",rc.data)}else rb('packet received with socket readyState "%s"',(this||hd).readyState)};Ga.prototype.onHandshake=function(rc){this.emit("handshake",rc);(this||hd).id=rc.sid;(this||hd).transport.query.sid=
rc.sid;(this||hd).upgrades=this.filterUpgrades(rc.upgrades);(this||hd).pingInterval=rc.pingInterval;(this||hd).pingTimeout=rc.pingTimeout;this.onOpen();"closed"!==(this||hd).readyState&&(this.setPing(),this.removeListener("heartbeat",(this||hd).onHeartbeat),this.on("heartbeat",(this||hd).onHeartbeat))};Ga.prototype.onHeartbeat=function(rc){clearTimeout((this||hd).pingTimeoutTimer);var kc=this||hd;kc.pingTimeoutTimer=setTimeout(function(){if("closed"!==kc.readyState)kc.onClose("ping timeout")},rc||
kc.pingInterval+kc.pingTimeout)};Ga.prototype.setPing=function(){var rc=this||hd;clearTimeout(rc.pingIntervalTimer);rc.pingIntervalTimer=setTimeout(function(){rb("writing ping packet - expecting pong within %sms",rc.pingTimeout);rc.ping();rc.onHeartbeat(rc.pingTimeout)},rc.pingInterval)};Ga.prototype.ping=function(){var rc=this||hd;this.sendPacket("ping",function(){rc.emit("ping")})};Ga.prototype.onDrain=function(){(this||hd).writeBuffer.splice(0,(this||hd).prevBufferLen);(this||hd).prevBufferLen=
0;0===(this||hd).writeBuffer.length?this.emit("drain"):this.flush()};Ga.prototype.flush=function(){"closed"!==(this||hd).readyState&&(this||hd).transport.writable&&!(this||hd).upgrading&&(this||hd).writeBuffer.length&&(rb("flushing %d packets in socket",(this||hd).writeBuffer.length),(this||hd).transport.send((this||hd).writeBuffer),(this||hd).prevBufferLen=(this||hd).writeBuffer.length,this.emit("flush"))};Ga.prototype.write=Ga.prototype.send=function(rc,kc,Sc){this.sendPacket("message",rc,kc,Sc);
return this||hd};Ga.prototype.sendPacket=function(rc,kc,Sc,xb){"function"===typeof kc&&(xb=kc,kc=void 0);"function"===typeof Sc&&(xb=Sc,Sc=null);if("closing"!==(this||hd).readyState&&"closed"!==(this||hd).readyState){Sc=Sc||{};Sc.compress=!1!==Sc.compress;rc={type:rc,data:kc,options:Sc};this.emit("packetCreate",rc);(this||hd).writeBuffer.push(rc);if(xb)this.once("flush",xb);this.flush()}};Ga.prototype.close=function(){function rc(){xb.onClose("forced close");rb("socket closing - telling transport to close");
xb.transport.close()}function kc(){xb.removeListener("upgrade",kc);xb.removeListener("upgradeError",kc);rc()}function Sc(){xb.once("upgrade",kc);xb.once("upgradeError",kc)}if("opening"===(this||hd).readyState||"open"===(this||hd).readyState){(this||hd).readyState="closing";var xb=this||hd;if((this||hd).writeBuffer.length)this.once("drain",function(){(this||hd).upgrading?Sc():rc()});else(this||hd).upgrading?Sc():rc()}return this||hd};Ga.prototype.onError=function(rc){rb("socket error %j",rc);Ga.priorWebsocketSuccess=
!1;this.emit("error",rc);this.onClose("transport error",rc)};Ga.prototype.onClose=function(rc,kc){if("opening"===(this||hd).readyState||"open"===(this||hd).readyState||"closing"===(this||hd).readyState){rb('socket close with reason: "%s"',rc);var Sc=this||hd;clearTimeout((this||hd).pingIntervalTimer);clearTimeout((this||hd).pingTimeoutTimer);(this||hd).transport.removeAllListeners("close");(this||hd).transport.close();(this||hd).transport.removeAllListeners();(this||hd).readyState="closed";(this||
hd).id=null;this.emit("close",rc,kc);Sc.writeBuffer=[];Sc.prevBufferLen=0}};Ga.prototype.filterUpgrades=function(rc){for(var kc=[],Sc=0,xb=rc.length;Sc<xb;Sc++)~Db((this||hd).transports,rc[Sc])&&kc.push(rc[Sc]);return kc};return Ce}function Pc(){if(Oo)return rm;Oo=!0;return rm=function(Ga,ub){for(var Eb=[],rb=(ub=ub||0)||0;rb<Ga.length;rb++)Eb[rb-ub]=Ga[rb];return Eb}}function Xc(){if(so)return Po;so=!0;return Po=function(Ga,ub,Eb){Ga.on(ub,Eb);return{destroy:function(){Ga.removeListener(ub,Eb)}}}}
function Q(){if(Vm)return ok;Vm=!0;var Ga=[].slice;return ok=function(ub,Eb){"string"==typeof Eb&&(Eb=ub[Eb]);if("function"!=typeof Eb)throw Error("bind() requires a function");var rb=Ga.call(arguments,2);return function(){return Eb.apply(ub,rb.concat(Ga.call(arguments)))}}}function fa(){function Ga(xb,jd,ke){(this||wf).io=xb;(this||wf).nsp=jd;(this||wf).json=this||wf;(this||wf).ids=0;(this||wf).acks={};(this||wf).receiveBuffer=[];(this||wf).sendBuffer=[];(this||wf).connected=!1;(this||wf).disconnected=
!0;(this||wf).flags={};ke&&ke.query&&((this||wf).query=ke.query);(this||wf).io.autoConnect&&this.open()}if(zm)return em;zm=!0;var ub=pc(),Eb=kd(),rb=Pc(),Db=Xc(),Cc=Q(),qd=ee()("socket.io-client:socket"),nd=qb(),rc=bd();em=em=Ga;var kc={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},Sc=Eb.prototype.emit;Eb(Ga.prototype);Ga.prototype.subEvents=function(){if(!(this||wf).subs){var xb=
(this||wf).io;(this||wf).subs=[Db(xb,"open",Cc(this||wf,"onopen")),Db(xb,"packet",Cc(this||wf,"onpacket")),Db(xb,"close",Cc(this||wf,"onclose"))]}};Ga.prototype.open=Ga.prototype.connect=function(){if((this||wf).connected)return this||wf;this.subEvents();(this||wf).io.reconnecting||(this||wf).io.open();if("open"===(this||wf).io.readyState)this.onopen();this.emit("connecting");return this||wf};Ga.prototype.send=function(){var xb=rb(arguments);xb.unshift("message");(this||wf).emit.apply(this||wf,xb);
return this||wf};Ga.prototype.emit=function(xb){if(kc.hasOwnProperty(xb))return Sc.apply(this||wf,arguments),this||wf;var jd=rb(arguments),ke={type:(void 0!==(this||wf).flags.binary?(this||wf).flags.binary:rc(jd))?ub.BINARY_EVENT:ub.EVENT,data:jd,options:{}};ke.options.compress=!(this||wf).flags||!1!==(this||wf).flags.compress;"function"===typeof jd[jd.length-1]&&(qd("emitting packet with ack id %d",(this||wf).ids),(this||wf).acks[(this||wf).ids]=jd.pop(),ke.id=(this||wf).ids++);(this||wf).connected?
this.packet(ke):(this||wf).sendBuffer.push(ke);(this||wf).flags={};return this||wf};Ga.prototype.packet=function(xb){xb.nsp=(this||wf).nsp;(this||wf).io.packet(xb)};Ga.prototype.onopen=function(){qd("transport is open - connecting");if("/"!==(this||wf).nsp)if((this||wf).query){var xb="object"===typeof(this||wf).query?nd.encode((this||wf).query):(this||wf).query;qd("sending connect packet with query %s",xb);this.packet({type:ub.CONNECT,query:xb})}else this.packet({type:ub.CONNECT})};Ga.prototype.onclose=
function(xb){qd("close (%s)",xb);(this||wf).connected=!1;(this||wf).disconnected=!0;delete (this||wf).id;this.emit("disconnect",xb)};Ga.prototype.onpacket=function(xb){var jd=xb.type===ub.ERROR&&"/"===xb.nsp;if(xb.nsp===(this||wf).nsp||jd)switch(xb.type){case ub.CONNECT:this.onconnect();break;case ub.EVENT:this.onevent(xb);break;case ub.BINARY_EVENT:this.onevent(xb);break;case ub.ACK:this.onack(xb);break;case ub.BINARY_ACK:this.onack(xb);break;case ub.DISCONNECT:this.ondisconnect();break;case ub.ERROR:this.emit("error",
xb.data)}};Ga.prototype.onevent=function(xb){var jd=xb.data||[];qd("emitting event %j",jd);null!=xb.id&&(qd("attaching ack callback to event"),jd.push(this.ack(xb.id)));(this||wf).connected?Sc.apply(this||wf,jd):(this||wf).receiveBuffer.push(jd)};Ga.prototype.ack=function(xb){var jd=this||wf,ke=!1;return function(){if(!ke){ke=!0;var Se=rb(arguments);qd("sending ack %j",Se);jd.packet({type:rc(Se)?ub.BINARY_ACK:ub.ACK,id:xb,data:Se})}}};Ga.prototype.onack=function(xb){var jd=(this||wf).acks[xb.id];
"function"===typeof jd?(qd("calling ack %s with %j",xb.id,xb.data),jd.apply(this||wf,xb.data),delete (this||wf).acks[xb.id]):qd("bad ack %s",xb.id)};Ga.prototype.onconnect=function(){(this||wf).connected=!0;(this||wf).disconnected=!1;this.emit("connect");this.emitBuffered()};Ga.prototype.emitBuffered=function(){var xb;for(xb=0;xb<(this||wf).receiveBuffer.length;xb++)Sc.apply(this||wf,(this||wf).receiveBuffer[xb]);(this||wf).receiveBuffer=[];for(xb=0;xb<(this||wf).sendBuffer.length;xb++)this.packet((this||
wf).sendBuffer[xb]);(this||wf).sendBuffer=[]};Ga.prototype.ondisconnect=function(){qd("server disconnect (%s)",(this||wf).nsp);this.destroy();this.onclose("io server disconnect")};Ga.prototype.destroy=function(){if((this||wf).subs){for(var xb=0;xb<(this||wf).subs.length;xb++)(this||wf).subs[xb].destroy();(this||wf).subs=null}(this||wf).io.destroy(this||wf)};Ga.prototype.close=Ga.prototype.disconnect=function(){(this||wf).connected&&(qd("performing disconnect (%s)",(this||wf).nsp),this.packet({type:ub.DISCONNECT}));
this.destroy();if((this||wf).connected)this.onclose("io client disconnect");return this||wf};Ga.prototype.compress=function(xb){(this||wf).flags.compress=xb;return this||wf};Ga.prototype.binary=function(xb){(this||wf).flags.binary=xb;return this||wf};return em}function Ia(){function Ga(ub){ub=ub||{};(this||zk).ms=ub.min||100;(this||zk).max=ub.max||1E4;(this||zk).factor=ub.factor||2;(this||zk).jitter=0<ub.jitter&&1>=ub.jitter?ub.jitter:0;(this||zk).attempts=0}if(vn)return Wm;vn=!0;Wm=Ga;Ga.prototype.duration=
function(){var ub=(this||zk).ms*Math.pow((this||zk).factor,(this||zk).attempts++);if((this||zk).jitter){var Eb=Math.random(),rb=Math.floor(Eb*(this||zk).jitter*ub);ub=0==(Math.floor(10*Eb)&1)?ub-rb:ub+rb}return Math.min(ub,(this||zk).max)|0};Ga.prototype.reset=function(){(this||zk).attempts=0};Ga.prototype.setMin=function(ub){(this||zk).ms=ub};Ga.prototype.setMax=function(ub){(this||zk).max=ub};Ga.prototype.setJitter=function(ub){(this||zk).jitter=ub};return Wm}function Qa(){function Ga(xb,jd){if(!((this||
ie)instanceof Ga))return new Ga(xb,jd);xb&&"object"===typeof xb&&(jd=xb,xb=void 0);jd=jd||{};jd.path=jd.path||"/socket.io";(this||ie).nsps={};(this||ie).subs=[];(this||ie).opts=jd;this.reconnection(!1!==jd.reconnection);this.reconnectionAttempts(jd.reconnectionAttempts||Infinity);this.reconnectionDelay(jd.reconnectionDelay||1E3);this.reconnectionDelayMax(jd.reconnectionDelayMax||5E3);this.randomizationFactor(jd.randomizationFactor||.5);(this||ie).backoff=new kc({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),
jitter:this.randomizationFactor()});this.timeout(null==jd.timeout?2E4:jd.timeout);(this||ie).readyState="closed";(this||ie).uri=xb;(this||ie).connecting=[];(this||ie).lastPing=null;(this||ie).encoding=!1;(this||ie).packetBuffer=[];xb=jd.parser||Db;(this||ie).encoder=new xb.Encoder;(this||ie).decoder=new xb.Decoder;(this||ie).autoConnect=!1!==jd.autoConnect;(this||ie).autoConnect&&this.open()}if(vl)return Fl;vl=!0;Oj||(Oj=!0,jh=mc(),jh.parser=sb());var ub=jh;var Eb=fa(),rb=kd(),Db=pc(),Cc=Xc(),qd=
Q(),nd=ee()("socket.io-client:manager"),rc=Gc(),kc=Ia(),Sc=Object.prototype.hasOwnProperty;Fl=Ga;Ga.prototype.emitAll=function(){(this||ie).emit.apply(this||ie,arguments);for(var xb in(this||ie).nsps)Sc.call((this||ie).nsps,xb)&&(this||ie).nsps[xb].emit.apply((this||ie).nsps[xb],arguments)};Ga.prototype.updateSocketIds=function(){for(var xb in(this||ie).nsps)Sc.call((this||ie).nsps,xb)&&((this||ie).nsps[xb].id=this.generateId(xb))};Ga.prototype.generateId=function(xb){return("/"===xb?"":xb+"#")+(this||
ie).engine.id};rb(Ga.prototype);Ga.prototype.reconnection=function(xb){if(!arguments.length)return(this||ie)._reconnection;(this||ie)._reconnection=!!xb;return this||ie};Ga.prototype.reconnectionAttempts=function(xb){if(!arguments.length)return(this||ie)._reconnectionAttempts;(this||ie)._reconnectionAttempts=xb;return this||ie};Ga.prototype.reconnectionDelay=function(xb){if(!arguments.length)return(this||ie)._reconnectionDelay;(this||ie)._reconnectionDelay=xb;(this||ie).backoff&&(this||ie).backoff.setMin(xb);
return this||ie};Ga.prototype.randomizationFactor=function(xb){if(!arguments.length)return(this||ie)._randomizationFactor;(this||ie)._randomizationFactor=xb;(this||ie).backoff&&(this||ie).backoff.setJitter(xb);return this||ie};Ga.prototype.reconnectionDelayMax=function(xb){if(!arguments.length)return(this||ie)._reconnectionDelayMax;(this||ie)._reconnectionDelayMax=xb;(this||ie).backoff&&(this||ie).backoff.setMax(xb);return this||ie};Ga.prototype.timeout=function(xb){if(!arguments.length)return(this||
ie)._timeout;(this||ie)._timeout=xb;return this||ie};Ga.prototype.maybeReconnectOnOpen=function(){!(this||ie).reconnecting&&(this||ie)._reconnection&&0===(this||ie).backoff.attempts&&this.reconnect()};Ga.prototype.open=Ga.prototype.connect=function(xb,jd){nd("readyState %s",(this||ie).readyState);if(~(this||ie).readyState.indexOf("open"))return this||ie;nd("opening %s",(this||ie).uri);(this||ie).engine=ub((this||ie).uri,(this||ie).opts);var ke=(this||ie).engine,Se=this||ie;(this||ie).readyState="opening";
(this||ie).skipReconnect=!1;var de=Cc(ke,"open",function(){Se.onopen();xb&&xb()});jd=Cc(ke,"error",function(If){nd("connect_error");Se.cleanup();Se.readyState="closed";Se.emitAll("connect_error",If);if(xb){var Mf=Error("Connection error");Mf.data=If;xb(Mf)}else Se.maybeReconnectOnOpen()});if(!1!==(this||ie)._timeout){var Pe=(this||ie)._timeout;nd("connect attempt will timeout after %d",Pe);0===Pe&&de.destroy();var nf=setTimeout(function(){nd("connect attempt timed out after %d",Pe);de.destroy();ke.close();
ke.emit("error","timeout");Se.emitAll("connect_timeout",Pe)},Pe);(this||ie).subs.push({destroy:function(){clearTimeout(nf)}})}(this||ie).subs.push(de);(this||ie).subs.push(jd);return this||ie};Ga.prototype.onopen=function(){nd("open");this.cleanup();(this||ie).readyState="open";this.emit("open");var xb=(this||ie).engine;(this||ie).subs.push(Cc(xb,"data",qd(this||ie,"ondata")));(this||ie).subs.push(Cc(xb,"ping",qd(this||ie,"onping")));(this||ie).subs.push(Cc(xb,"pong",qd(this||ie,"onpong")));(this||
ie).subs.push(Cc(xb,"error",qd(this||ie,"onerror")));(this||ie).subs.push(Cc(xb,"close",qd(this||ie,"onclose")));(this||ie).subs.push(Cc((this||ie).decoder,"decoded",qd(this||ie,"ondecoded")))};Ga.prototype.onping=function(){(this||ie).lastPing=new Date;this.emitAll("ping")};Ga.prototype.onpong=function(){this.emitAll("pong",new Date-(this||ie).lastPing)};Ga.prototype.ondata=function(xb){(this||ie).decoder.add(xb)};Ga.prototype.ondecoded=function(xb){this.emit("packet",xb)};Ga.prototype.onerror=function(xb){nd("error",
xb);this.emitAll("error",xb)};Ga.prototype.socket=function(xb,jd){function ke(){~rc(de.connecting,Se)||de.connecting.push(Se)}var Se=(this||ie).nsps[xb];if(!Se){Se=new Eb(this||ie,xb,jd);(this||ie).nsps[xb]=Se;var de=this||ie;Se.on("connecting",ke);Se.on("connect",function(){Se.id=de.generateId(xb)});(this||ie).autoConnect&&ke()}return Se};Ga.prototype.destroy=function(xb){xb=rc((this||ie).connecting,xb);~xb&&(this||ie).connecting.splice(xb,1);(this||ie).connecting.length||this.close()};Ga.prototype.packet=
function(xb){nd("writing packet %j",xb);var jd=this||ie;xb.query&&0===xb.type&&(xb.nsp+="?"+xb.query);jd.encoding?jd.packetBuffer.push(xb):(jd.encoding=!0,(this||ie).encoder.encode(xb,function(ke){for(var Se=0;Se<ke.length;Se++)jd.engine.write(ke[Se],xb.options);jd.encoding=!1;jd.processPacketQueue()}))};Ga.prototype.processPacketQueue=function(){if(0<(this||ie).packetBuffer.length&&!(this||ie).encoding){var xb=(this||ie).packetBuffer.shift();this.packet(xb)}};Ga.prototype.cleanup=function(){nd("cleanup");
for(var xb=(this||ie).subs.length,jd=0;jd<xb;jd++)(this||ie).subs.shift().destroy();(this||ie).packetBuffer=[];(this||ie).encoding=!1;(this||ie).lastPing=null;(this||ie).decoder.destroy()};Ga.prototype.close=Ga.prototype.disconnect=function(){nd("disconnect");(this||ie).skipReconnect=!0;(this||ie).reconnecting=!1;"opening"===(this||ie).readyState&&this.cleanup();(this||ie).backoff.reset();(this||ie).readyState="closed";(this||ie).engine&&(this||ie).engine.close()};Ga.prototype.onclose=function(xb){nd("onclose");
this.cleanup();(this||ie).backoff.reset();(this||ie).readyState="closed";this.emit("close",xb);(this||ie)._reconnection&&!(this||ie).skipReconnect&&this.reconnect()};Ga.prototype.reconnect=function(){if((this||ie).reconnecting||(this||ie).skipReconnect)return this||ie;var xb=this||ie;if((this||ie).backoff.attempts>=(this||ie)._reconnectionAttempts)nd("reconnect failed"),(this||ie).backoff.reset(),this.emitAll("reconnect_failed"),(this||ie).reconnecting=!1;else{var jd=(this||ie).backoff.duration();
nd("will wait %dms before reconnect attempt",jd);(this||ie).reconnecting=!0;var ke=setTimeout(function(){xb.skipReconnect||(nd("attempting reconnect"),xb.emitAll("reconnect_attempt",xb.backoff.attempts),xb.emitAll("reconnecting",xb.backoff.attempts),xb.skipReconnect||xb.open(function(Se){Se?(nd("reconnect attempt error"),xb.reconnecting=!1,xb.reconnect(),xb.emitAll("reconnect_error",Se.data)):(nd("reconnect success"),xb.onreconnect())}))},jd);(this||ie).subs.push({destroy:function(){clearTimeout(ke)}})}};
Ga.prototype.onreconnect=function(){var xb=(this||ie).backoff.attempts;(this||ie).reconnecting=!1;(this||ie).backoff.reset();this.updateSocketIds();this.emitAll("reconnect",xb)};return Fl}var ec=lively.FreezerRuntime.recorderFor("lively.2lively/interface.js");ec.nyi=function(Ga){throw Error("Not yet implemented: "+Ga);};ec.string=Cb;ec.promise=Vb;ec.debugMessageOrder=!1;var Nb=function(Ga){this.id=ec.string.newUUID();this.actions={};this.options={ackTimeout:3500,debug:!1};this._incomingOrderNumberingBySenders=
new Map;this._outgoingOrderNumberingByTargets=new Map;this._outOfOrderCacheBySenders=new Map};Nb.prototype.isOnline=function(){ec.nyi("isOnline")};Nb.prototype.open=function(){ec.nyi("isOnline")};Nb.prototype.close=function(){ec.nyi("close")};Nb.prototype.remove=function(){ec.nyi("remove")};Nb.prototype.whenOnline=function(Ga){var ub=this;return ec.promise.waitFor(Ga,function(){return ub.isOnline()}).then(function(){return ub}).catch(function(Eb){return Promise.reject(/timeout/i.test(String(Eb))?
Error("Timeout in "+ub+".whenOnline"):Eb)})};Nb.prototype.onError=function(Ga){this.debug&&console.log("["+this+"] error: "+Ga)};Nb.prototype.removeService=function(Ga){delete this.actions[Ga]};Nb.prototype.removeServices=function(Ga){var ub=this;Ga.forEach(function(Eb){return ub.removeService(Eb)})};Nb.prototype.addService=function(Ga,ub){this.actions[Ga]=ub};Nb.prototype.addServices=function(Ga){var ub=this;Object.keys(Ga).forEach(function(Eb){return ub.addService(Eb,Ga[Eb])})};Nb.prototype.ping=
function(Ga){var ub=this,Eb,rb,Db,Cc,qd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nd){if(1==nd.nextAddress)return Eb=Date.now(),nd.yield(ub.sendToAndWait(Ga,"l2l-ping",{timestamp:Eb}),2);rb=nd.yieldResult;Db=rb.data;Cc=Db.timestamp;qd=Date.now();return nd.return({to:Cc-Eb,from:qd-Cc,roundtrip:qd-Eb})})};Nb.prototype.send=function(Ga,ub){ec.nyi("send")};Nb.prototype.sendAndWait=function(Ga){var ub=this,Eb,rb,Db,Cc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qd){switch(qd.nextAddress){case 1:return Eb=
new Promise(function(nd,rc){return ub.send(Ga,nd)}),rb={},Db=ub.options.ackTimeout+400,"ackTimeout"in Ga&&(Db=!Ga.ackTimeout||0>Ga.ackTimeout?null:Ga.ackTimeout+400),Db?qd.yield(Promise.race([ec.promise.delay(Db,rb),Eb]),5):qd.yield(Eb,4);case 4:Cc=qd.yieldResult;qd.jumpTo(3);break;case 5:Cc=qd.yieldResult;case 3:if(Cc===rb)throw Error("Timeout sending "+Ga.action);return qd.return(Cc)}})};Nb.prototype.sendTo=function(Ga,ub,Eb,rb){return this.send({target:Ga,action:ub,data:Eb},rb)};Nb.prototype.sendToAndWait=
function(Ga,ub,Eb,rb){return this.sendAndWait(Object.assign({target:Ga,action:ub,data:Eb},rb))};Nb.prototype.prepareSend=function(Ga,ub){var Eb=Ga.target,rb=Ga.action,Db=Ga.messageId,Cc=Ga.sender;if(!rb)throw Error("Trying to send a message without specifying action!");if(!Eb)throw Error("Trying to send message "+rb+" without specifying target!");Db||(Ga.messageId=ec.string.newUUID());Cc||(Ga.sender=this.id);rb=Ga.n=this._outgoingOrderNumberingByTargets.get(Eb)||0;this._outgoingOrderNumberingByTargets.set(Eb,
rb+1);if("function"===typeof ub){Cc=this;var qd=ub;ub=function(nd){var rc=Cc._incomingOrderNumberingBySenders.get(nd.sender)||0;Cc.debug&&ec.debugMessageOrder&&console.log("[MSG ORDER] "+Cc+" received ack for "+nd.action+" as msg "+rc);try{qd.apply(null,arguments)}catch(kc){console.error("Error in ack fn of "+Cc+": "+kc.stack)}Cc._incomingOrderNumberingBySenders.set(nd.sender,rc+1);setTimeout(function(){return Cc.invokeOutOfOrderMessages(nd.sender)},0)}}this.debug&&ec.debugMessageOrder&&console.log("[MSG ORDER] "+
this+" sending "+rb+" ("+Ga.action+") to "+Eb);return[Ga,ub]};Nb.prototype.prepareAnswerMessage=function(Ga,ub){return{action:Ga.action+"-response",inResponseTo:Ga.messageId,target:Ga.sender,data:ub,sender:this.id}};Nb.prototype.installEventToMessageTranslator=function(Ga){var ub=this,Eb=Ga.onevent;Ga.onevent=function(rb){var Db=rb.data||[];Eb.call(this,rb);rb.data=["*"].concat(Db);Eb.call(this,rb)};Ga.on("*",function(rb,Db){rb&&"object"===typeof rb&&rb.action&&(Db=rb,rb=Db.action);var Cc=arguments[arguments.length-
1];Cc="function"===typeof Cc?Cc:null;(Db=Db===Cc?null:Db)&&Db.data&&("number"===typeof Db.n||Db.broadcast)&&Db.sender?ub.receive(Db,Ga,Cc):(console.warn(ub+" received non-conformant message "+rb+":",arguments),"function"===typeof Cc&&Cc({data:{error:"invalid l2l message"}}))})};Nb.prototype.receive=function(Ga,ub,Eb){this.dispatchL2LMessageToSelf(Ga,ub,Eb)};Nb.prototype.dispatchL2LMessageToSelf=function(Ga,ub,Eb){var rb=this,Db=Ga.action;if(Ga.broadcast)this.safeInvokeServiceHandler(Db,Ga,Eb,ub);
else try{var Cc=this._incomingOrderNumberingBySenders.get(Ga.sender)||0,qd="register"===Db||"unregister";if(!qd&&Ga.n<Cc)console.error("[MSG ORDER] ["+this+"] received message no. "+Ga.n+" but expected >= "+Cc+", dropping "+Db);else if(!qd&&Ga.n>Cc){this.debug&&ec.debugMessageOrder&&console.log("[MSG ORDER] ["+this+"] storing out of order message "+Db+" ("+Ga.n+") for later invocation");var nd=this._outOfOrderCacheBySenders.get(Ga.sender);nd||(nd=[],this._outOfOrderCacheBySenders.set(Ga.sender,nd));
nd.push([Db,Ga,Eb,ub])}else this.safeInvokeServiceHandler(Db,Ga,Eb,ub),setTimeout(function(){return rb.invokeOutOfOrderMessages(Ga.sender)},0)}catch(rc){console.error("Error message ordering when handling "+Db+": "+(rc.stack||rc)),"function"===typeof Eb&&Eb(this.prepareAnswerMessage(Ga,{isError:!0,error:String(rc.stack||rc)}))}};Nb.prototype.invokeOutOfOrderMessages=function(Ga){var ub=this._outOfOrderCacheBySenders.get(Ga);if(ub&&ub.length){var Eb=this._incomingOrderNumberingBySenders.get(Ga)||0;
Ga=ub.findIndex(function(rb){rb=$jscomp.makeIterator(rb);rb.next();return rb.next().value.n===Eb});-1!==Ga&&(ub.splice(Ga,1),this.invokeServiceHandler.apply(this,ub[Ga]))}};Nb.prototype.renameTarget=function(Ga,ub){if(Ga!==ub){var Eb=this._outgoingOrderNumberingByTargets.get(Ga);this._outgoingOrderNumberingByTargets.delete(Ga);this._outgoingOrderNumberingByTargets.set(ub,Eb)}};Nb.prototype.safeInvokeServiceHandler=function(Ga,ub,Eb,rb){try{"function"===typeof this.actions[Ga]?this.invokeServiceHandler(Ga,
ub,Eb,rb):rb._events&&Object.keys(rb._events).includes(Ga)||(console.warn("WARNING ["+this+"] Unhandled message: "+Ga),"function"===typeof Eb&&Eb(this.prepareAnswerMessage(ub,{isError:!0,error:"message not understood: "+Ga})))}catch(Db){console.error("Error when handling "+Ga+": "+(Db.stack||Db)),"function"===typeof Eb&&Eb(this.prepareAnswerMessage(ub,{isError:!0,error:String(Db.stack||Db)}))}};Nb.prototype.invokeServiceHandler=function(Ga,ub,Eb,rb){var Db=this;this.debug&&ec.debugMessageOrder&&console.log("[MSG ORDER] "+
this+" received "+ub.n+" ("+ub.action+") from "+ub.sender);this._incomingOrderNumberingBySenders.set(ub.sender,ub.n+1);if("function"===typeof Eb){var Cc=!1,qd=!1,nd="ackTimeout"in ub?ub.ackTimeout:this.options.ackTimeout,rc=this._outgoingOrderNumberingByTargets.get(ub.sender)||0;this._outgoingOrderNumberingByTargets.set(ub.sender,rc+1);var kc=function(Sc){qd?console.warn("["+Db+"] ackFn for "+ub.action+" called after it timed out, dropping answer!"):Cc?console.warn("["+Db+"] ack function called repeatedly when handling "+
ub.action):(Cc=!0,Eb(Db.prepareAnswerMessage(ub,Sc)),Db.debug&&ec.debugMessageOrder&&console.log("[MSG ORDER] "+Db+" sending "+rc+" (ack for "+ub.action+")"))};nd&&setTimeout(function(){Cc||(kc({isError:!0,error:"Timeout error: "+Db+" did not send answer for "+ub.action+" after "+nd+"ms"}),qd=!0)},nd)}try{this.actions[Ga].call(this,this,ub,kc,rb)}catch(Sc){console.error("["+this+"] Error handling "+Ga+": "+(Sc.stack||Sc)),kc&&kc({error:Sc.stack})}};$jscomp.global.Object.defineProperties(Nb.prototype,
{debug:{configurable:!0,enumerable:!0,get:function(){return this.options.debug},set:function(Ga){this.options.debug=Ga}}});ec.L2LConnection=Nb;ec.default=Nb;var Za=lively.FreezerRuntime.recorderFor("lively.2lively/default-actions.js"),jc={"l2l-ping":function(Ga,ub,Eb,rb){rb=ub.sender;ub=ub.data.timestamp;var Db=Date.now();"function"===typeof Eb&&Eb({timestamp:Db});Ga.debug&&console.log("[undefined] got ping from "+rb+", time: "+(Db-ub)+"ms")},"remote-eval":function(Ga,ub,Eb,rb){var Db=ub.data.source;
Promise.resolve().then(function(){return eval(Db)}).then(function(Cc){return Eb({value:Cc})}).catch(function(Cc){Cc.originalErr&&(Cc=Cc.originalErr);console.error("eval error: "+Cc);"function"===typeof Eb&&Eb({isError:!0,value:String(Cc.stack||Cc)})})},"remote-eval-2":function(Ga,ub,Eb,rb){var Db=ub.data.source;Promise.resolve().then(function(){var Cc=eval(Db);if(!(Cc instanceof Promise))throw console.error("unexpected eval result:"+Cc),Error("unexpected eval result:"+Cc);return Cc}).then(function(Cc){return Eb(Cc)}).catch(function(Cc){console.error("eval error: "+
Cc);Cc.originalErr&&(Cc=Cc.originalErr);"function"===typeof Eb&&Eb({isError:!0,value:String(Cc.stack||Cc)})})}};Za.defaultActions=jc;Za.defaultActions=jc;Za.defaultActions=jc;var ld={},xd=(ld["[broadcast] send"]=function(Ga,ub,Eb,rb){var Db=ub.sender,Cc=ub.data,qd,nd,rc,kc,Sc,xb,jd,ke,Se,de,Pe,nf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(If){qd=Cc;nd=qd.action;rc=qd.broadcast;kc=qd.room;Sc=qd.namespace;xb=qd.isSystemBroadcast;jd=qd.isMultiServerBroadcast;ke=[];jd?(console.log(".......isMultiServerBroadcast"),
Se=Ga,de=Se.id,Pe=Ga.getTrackerList(),console.log(Pe),ke=Pe.map(function(Mf){return Mf.id!=de?Mf.io.nsps["/"+Mf.namespace]:rb.broadcast})):(xb&&(Sc=Ga.namespace),ke.push(Sc?Ga.io.nsps["/"+Sc]:rb.broadcast));ke.forEach(function(Mf){return Mf.to(kc).emit({action:nd,sender:Db,broadcast:!0,data:rc})});Eb&&"function"===typeof Eb&&(nf="message broadcasted to "+kc,Sc&&(nf+=" in namespace "+Sc),1<ke.length&&(nf+=" "+ke.length+" trackers"),console.log(nf),Eb({status:nf}));If.jumpToEnd()})},ld["[broadcast] join room"]=
function(Ga,ub,Eb,rb){var Db=ub.sender,Cc=ub.data.room,qd,nd,rc,kc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sc){if(1==Sc.nextAddress)return nd=!1,rc=Ga.io.nsps["/"+Ga.namespace].adapter.rooms,(kc=rc[Cc]&&rc[Cc].sockets&&rc[Cc].sockets[rb.id])?(qd=Db+" already in "+Cc,Sc.jumpTo(2)):Sc.yield(new Promise(function(xb,jd){return rb.join(Cc,function(ke){return ke?jd(ke):xb()})}),3);2!=Sc.nextAddress&&(qd=Db+" joined "+Cc,nd=!0);Eb&&"function"===typeof Eb&&Eb({status:qd,joined:nd});Sc.jumpToEnd()})},
ld["[broadcast] leave room"]=function(Ga,ub,Eb,rb){var Db=ub.sender,Cc=ub.data.room,qd,nd,rc,kc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sc){if(1==Sc.nextAddress)return nd=!1,rc=Ga.io.nsps["/"+Ga.namespace].adapter.rooms,kc=rc[Cc]&&rc[Cc].sockets&&rc[Cc].sockets[rb.id],kc?Sc.yield(new Promise(function(xb,jd){return rb.leave(Cc,function(ke){return ke?jd(ke):xb()})}),3):(qd=Db+" not in "+Cc,Sc.jumpTo(2));2!=Sc.nextAddress&&(qd=Db+" left room "+Cc,nd=!0);console.log(qd);Eb&&"function"===
typeof Eb&&Eb({left:nd,status:qd});Sc.jumpToEnd()})},ld["[broadcast] my rooms"]=function(Ga,ub,Eb,rb){Eb(rb.rooms)},ld["[broadcast] all rooms"]=function(Ga,ub,Eb,rb){Eb(Ga.io.nsps["/"+Ga.namespace].adapter.rooms)},ld["[broadcast] list room members"]=function(Ga,ub,Eb,rb){ub=ub.data.room;rb=Ga.io;ub?(Ga=rb.nsps["/"+Ga.namespace].adapter.rooms[ub],Eb({room:ub,sockets:Ga?Ga.sockets:{},length:Ga?Ga.length:0})):Eb({isError:!0,error:"`room` paramerter missing!"})},ld.getClients=function(Ga,ub,Eb){Ga.removeDisconnectedClients();
Eb(Array.from(Ga.clients))},ld);Za.defaultTrackerActions=xd;Za.defaultTrackerActions=xd;Za.defaultTrackerActions=xd;var Yc={},Ua=(Yc.getRoomList=function(Ga){var ub=Ga.client,Eb=Ga.ackFn,rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Db){rb=ub._socketioClient.rooms;Eb(rb);Db.jumpToEnd()})},Yc["ask for"]=function(Ga,ub,Eb,rb){var Db=ub.sender,Cc=ub.data.query,qd=this,nd,rc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kc){if(1==kc.nextAddress)return nd=Cc.match(/password|sudo/i)?
"passwordPrompt":"prompt",kc.yield($world[nd](Cc),2);rc=kc.yieldResult;"function"===typeof Eb&&Eb({answer:rc});Ga.debug&&console.log("["+qd+"] message 'ask for' from "+Db+", query: "+Cc);kc.jumpToEnd()})},Yc["open editor"]=function(Ga,ub,Eb,rb){var Db=ub.data.args,Cc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qd){if(1==qd.nextAddress)return Db.length?qd.yield($world.execCommand("open file for EDITOR",{url:Db[0]}),2):(Eb({error:"no file specified"}),qd.return());Cc=qd.yieldResult;
"function"===typeof Eb&&Eb("aborted"===Cc?{error:String(Cc)}:{status:Cc});qd.jumpToEnd()})},Yc.changeWorkingDirectory=function(Ga,ub,Eb,rb){var Db=ub.data.args,Cc,qd,nd,rc,kc,Sc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xb){Cc=$jscomp.makeIterator(Db||[]);qd=Cc.next().value;nd=Cc.next().value;rc="OK";try{if(qd)if(nd){if(kc=$world.getMorphWithId(nd))if(kc.__lookupSetter__("cwd"))kc.cwd=qd;else if("function"===typeof kc.changeWorkingDirectory)kc.changeWorkingDirectory(qd);else if("function"===
typeof kc.pluginFind){if(Sc=kc.pluginFind(function(jd){return jd.isShellEditorPlugin}))Sc.cwd=qd}else rc="[changeWorkingDirectory] cannot figure pout how to set dir"}else rc="[changeWorkingDirectory] No command morph";else rc="[changeWorkingDirectory] No directory received"}catch(jd){rc=String(jd)}"OK"!==rc&&console.warn(rc);"function"===typeof Eb&&Eb(rc);xb.jumpToEnd()})},Yc);Za.defaultClientActions=Ua;Za.defaultClientActions=Ua;Za.defaultClientActions=Ua;var Mc={},pb=!1,fb={},eb=!1,bc={},ac=!1,
Ed="undefined"!==typeof self?self:global,we={},Je=!1,Lf="undefined"!==typeof self?self:global,ud={},Fe=!1,Pd={},Sb=!1,oa="undefined"!==typeof self?self:global,Ha={},Mb=!1,P={},ta=!1,Pa={},Jb=!1,Rc="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Zc={},oe=!1,se="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Df={},Qd=!1,ue={},of=!1,Gf={},rg=!1,mg={},Vc=!1,yf={},dg=!1,Gg={},mf=!1,Ka={},$a=!1,Kb={},ba=!1,Ja={},ob=!1,zb={},Nc=!1,yc={},Dd=
!1,zd={},Bd=!1,Ie="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Jg={},wg=!1,Qh={},Vf=!1,Hh={},ek=!1,Zh={},ml=!1,Hf="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Gj={},bj=!1,Oe="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Kk={},kl=!1,ih="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,dm={},ul=!1,dl={},Si=!1,sg="undefined"!==typeof globalThis?globalThis:"undefined"!==
typeof self?self:global,Rf={},Xm=!1,Zb={},$b=!1,Ce={},Ae=!1,hd="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,jh={},Oj=!1,rm={},Oo=!1,Po={},so=!1,ok={},Vm=!1,em={},zm=!1,wf="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Wm={},vn=!1,zk="undefined"!==typeof self?self:global,Fl={},vl=!1,ie="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,ll={},cl=!1,wl=function(){function Ga(qd,nd){"object"===typeof qd&&
(nd=qd,qd=void 0);nd=nd||{};qd=ub(qd);var rc=qd.source,kc=qd.id,Sc=qd.path;Sc=Cc[kc]&&Sc in Cc[kc].nsps;nd.forceNew||nd["force new connection"]||!1===nd.multiplex||Sc?(Db("ignoring socket cache for %s",rc),rc=rb(rc,nd)):(Cc[kc]||(Db("new io instance for %s",rc),Cc[kc]=rb(rc,nd)),rc=Cc[kc]);qd.query&&!nd.query&&(nd.query=qd.query);return rc.socket(qd.path,nd)}if(cl)return ll;cl=!0;var ub=Ud(),Eb=pc(),rb=Qa(),Db=ee()("socket.io-client");ll=ll=Ga;var Cc=ll.managers={};ll.protocol=Eb.protocol;ll.connect=
Ga;ll.Manager=Qa();ll.Socket=fa();return ll}(),Mg=lively.FreezerRuntime.recorderFor("lively.2lively/client.js");Mg.determineLocation=function(){return"undefined"!==typeof document&&document.location?document.location.origin:Mg.isNode?System._nodeRequire("os").hostname():System.baseURL};Mg.promise=Vb;Mg.fun=fe;Mg.obj=fd;Mg.events=Zd;Mg.num=id;Mg.L2LConnection=Nb;Mg.defaultActions=jc;Mg.defaultClientActions=Ua;Mg.isNode="undefined"!==typeof System?System.get("@system-env").node:"undefined"!==typeof process&&
process.env;Mg._ioClient=wl;Mg.ioClient=Mg.ioClient||void 0;Mg.isNode?(Mg.require=System._nodeRequire("module")._load,Mg.ioClient=Mg.require("socket.io-client")):Mg.ioClient=Mg._ioClient;Mg.urlHelper={isRoot:function(Ga){return"/"===Mg.urlHelper.path(Ga)},root:function(Ga){return Mg.urlHelper.isRoot(Ga)?Ga:Ga.slice(0,-Mg.urlHelper.path(Ga).length)+"/"},path:function(){var Ga=/^[a-z0-9-_\.]+:/,ub=/^\/\/[^\/]+/;return function(Eb){Eb=Eb.replace(Ga,"").replace(ub,"");return""===Eb?"/":Eb}}(),join:function(Ga,
ub){Ga.endsWith("/")&&(Ga=Ga.slice(0,-1));ub.startsWith("/")&&(ub=ub.slice(1));return Ga+"/"+ub}};var Yh=function(Ga,ub,Eb,rb){var Db=Mg.L2LConnection.call(this)||this;Mg.events.makeEmitter(Db);Db.info=rb;Db.origin=Ga;Db.path=ub;Db.namespace=Eb.replace(/^\/?/,"/");Db.trackerId=null;Db._socketioClient=null;Db._reconnectState={closed:!1,autoReconnect:!0,isReconnecting:!1,isReconnectingViaSocketio:!1,registerAttempt:0,registerProcess:null,isOpening:!1};Object.keys(Mg.defaultActions).forEach(function(Cc){return Db.addService(Cc,
Mg.defaultActions[Cc])});Object.keys(Mg.defaultClientActions).forEach(function(Cc){return Db.addService(Cc,Mg.defaultClientActions[Cc])});return Db};$jscomp.inherits(Yh,Mg.L2LConnection);Yh.clientKey=function(Ga,ub,Eb){Ga=Ga.replace(/\/$/,"");ub=ub.replace(/^\//,"");Eb=Eb.replace(/^\//,"");return Ga+"-"+ub+"-"+Eb};Yh.forLivelyInBrowser=function(Ga){var ub=!!Ga;Ga=Object.assign({type:"lively.morphic browser"},Ga);var Eb=this.default();if(!Eb)return Mg.L2LClient.ensure({url:document.location.origin+
"/lively-socket.io",namespace:"l2l",info:Ga});ub&&!Mg.obj.equals(Eb.info,Ga)&&Eb.isRegistered()&&(Eb.info=Ga,Eb.unregister().then(function(){return Eb.register()}).catch(function(rb){return console.error("l2l re-register on info change errored: "+rb)}));return Eb};Yh.default=function(){var Ga=Mg.L2LClient.clients.keys().next().value;return Mg.L2LClient.clients.get(Ga)};Yh.create=function(Ga){var ub=Ga=void 0===Ga?{}:Ga;Ga=void 0===ub.debug?!1:ub.debug;var Eb=ub.url,rb=ub.namespace,Db=void 0===ub.autoOpen?
!0:ub.autoOpen;ub=void 0===ub.info?{}:ub.info;if(!Eb)throw Error("L2LClient needs server url!");var Cc=Mg.urlHelper.root(Eb).replace(/\/+$/,"");Eb=Mg.urlHelper.path(Eb);rb=new this(Cc,Eb,rb||"",ub);Db&&rb.register();rb.debug=Ga;return rb};Yh.ensure=function(Ga){var ub=Ga=void 0===Ga?{}:Ga,Eb=ub.url;ub=ub.namespace;if(!Eb)throw Error("L2LClient needs server url!");var rb=Mg.urlHelper.root(Eb).replace(/\/+$/,""),Db=Mg.urlHelper.path(Eb);rb=this.clientKey(rb,Db,ub||"");(Db=this.clients.get(rb))||this.clients.set(rb,
Db=this.create(Object.assign({},Ga,{url:Eb,namespace:ub})));return Db};Yh.prototype.isOnline=function(){return this.socket&&this.socket.connected};Yh.prototype.isRegistered=function(){return this.isOnline()&&!!this.trackerId};Yh.prototype.open=function(){var Ga=this,ub,Eb,rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Db){if(1==Db.nextAddress)return Ga.isOnline()||Ga._reconnectState.isOpening?Db.return(Ga):Db.yield(Ga.close(),2);Ga._reconnectState.closed=!1;ub=Mg.urlHelper.join(Ga.origin,
Ga.namespace);Eb={path:Ga.path,transports:["websocket","polling"]};rb=Ga._socketioClient=Mg.ioClient(ub,Eb);Ga.debug&&console.log("["+Ga+"] connecting");rb.on("error",function(Cc){Ga._reconnectState.isOpening=!1;Ga.debug&&console.log("["+Ga+"] errored: "+Cc)});rb.on("close",function(Cc){return Ga.debug&&console.log("["+Ga+"] closed: "+Cc)});rb.on("reconnect_failed",function(){return Ga.debug&&console.log("["+Ga+"] could not reconnect")});rb.on("reconnect_error",function(Cc){return Ga.debug&&console.log("["+
Ga+"] reconnect error "+Cc)});rb.on("connect",function(){Ga.debug&&console.log("["+Ga+"] connected");Ga.emit("connected",Ga);Ga._reconnectState.isOpening=!1;Ga._reconnectState.isReconnecting=!1;Ga._reconnectState.isReconnectingViaSocketio=!1});rb.on("disconnect",function(){Ga._reconnectState.isOpening=!1;Ga.debug&&console.log("["+Ga+"] disconnected");Ga.emit("disconnected",Ga);Ga.trackerId?("tracker"!==Ga.trackerId&&(Ga.renameTarget(Ga.trackerId,"tracker"),Ga.trackerId=null),Ga._reconnectState.closed?
Ga.debug&&console.log("["+Ga+"] won't reconnect b/c client is marked as closed"):Ga._reconnectState.autoReconnect?(Ga._reconnectState.isReconnecting=!0,setTimeout(function(){Ga._reconnectState.closed?Ga.debug&&console.log("["+Ga+"] won't reconnect b/c client is marked as closed 2"):Ga._reconnectState.isReconnectingViaSocketio?Ga.debug&&console.log("["+Ga+"] won't reconnect again, client already reconnecting"):(Ga.debug&&console.log("["+Ga+"] initiating reconnection to tracker"),Ga.register())},20)):
Ga.debug&&console.log("["+Ga+"] won't reconnect b/c client has reconnection disabled")):(Ga.debug&&console.log("["+Ga+"] disconnect: don't have a tracker id, won't try reconnect"),Ga.trackerId="tracker")});rb.on("reconnecting",function(){Ga.debug&&console.log("["+Ga+"] reconnecting",Ga._reconnectState);Ga.emit("reconnecting",Ga);Ga._reconnectState.closed?(Ga._reconnectState.isReconnecting=!1,Ga._reconnectState.isReconnectingViaSocketio=!1,rb.close(),Ga.close()):(Ga._reconnectState.isReconnecting=
!0,Ga._reconnectState.isReconnectingViaSocketio=!0)});rb.on("reconnect",function(){Ga.debug&&console.log("["+Ga+"] reconnected");Ga._reconnectState.isReconnecting=!1;Ga._reconnectState.isReconnectingViaSocketio=!1;Ga.register()});Ga.installEventToMessageTranslator(rb);Ga._reconnectState.isOpening=!0;return Db.return((new Promise(function(Cc,qd){rb.once("error",qd);rb.once("connect",Cc)})).then(function(){return Ga}))})};Yh.prototype.close=function(){var Ga=this,ub,Eb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rb){if(1==
rb.nextAddress){Ga._reconnectState.closed=!0;if(ub=Ga.socket)ub.removeAllListeners("reconnect"),ub.removeAllListeners("reconnecting"),ub.removeAllListeners("disconnect"),ub.removeAllListeners("connect"),ub.removeAllListeners("reconnect_error"),ub.removeAllListeners("reconnect_failed"),ub.removeAllListeners("close"),ub.removeAllListeners("error"),ub.close();Ga.debug&&console.log("["+Ga+"] closing...");return Ga.isRegistered()?rb.yield(Ga.unregister(),2):rb.jumpTo(2)}return Ga.isOnline()||Ga.socket?
ub&&!ub.connected?(Ga.debug&&console.log("["+Ga+"] socket not connected, considering client closed"),rb.return(Ga)):rb.return(Promise.race([Mg.promise.delay(2E3).then(function(){return ub.removeAllListeners("disconnect")}),new Promise(function(Db){return ub.once("disconnect",Db)})]).then(function(){Ga.debug&&console.log("["+Ga+"] closed");return Ga})):(Ga.debug&&(Eb=Ga.isOnline()?"no socket":"not online",Ga.debug&&console.log("["+Ga+"] cannot close: "+Eb)),rb.return(Ga))})};Yh.prototype.remove=function(){var Ga=
this.constructor.clientKey(this.origin,this.path,this.namespace);this.constructor.clients.delete(Ga);return this.close()};Yh.prototype.register=function(){var Ga=this,ub,Eb,rb,Db,Cc,qd,nd,rc,kc,Sc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xb){switch(xb.nextAddress){case 1:if(Ga.isRegistered())return xb.return();if(Ga._reconnectState.closed)return Ga.debug&&console.log("["+Ga+"] not registering this b/c closed"),Ga._reconnectState.registerAttempt=0,xb.return();if(Ga._reconnectState.registerProcess)return Ga.debug&&
console.log("["+Ga+"] not registering this b/c register process exists"),xb.return();xb.setCatchFinallyBlocks(2);if(Ga.isOnline()){xb.jumpTo(4);break}return xb.yield(Ga.open(),4);case 4:return Ga.debug&&console.log("["+Ga+"] register"),xb.yield(Ga.sendToAndWait("tracker","register",Object.assign({userName:"unknown",type:"l2l "+(Mg.isNode?"node":"browser"),location:Mg.determineLocation()},Ga.info)),6);case 6:ub=xb.yieldResult;if(!ub.data)throw Eb=Error("Register answer is empty!"),Ga.emit("error",
Eb),Eb;if(ub.data.isError)throw rb=Error(ub.data.error),Ga.emit("error",rb),rb;Ga._reconnectState.registerAttempt=0;Db=ub;Cc=Db.data;qd=Cc.trackerId;nd=Cc.messageNumber;Ga.trackerId=qd;Ga._incomingOrderNumberingBySenders.set(qd,nd||0);Ga.emit("registered",{trackerId:qd});xb.leaveTryBlock(0);break;case 2:rc=xb.enterCatchBlock(),console.error("Error in register request of "+Ga+": "+rc),kc=Ga._reconnectState.registerAttempt++,Sc=Mg.num.backoff(kc,4,3E5),Ga._reconnectState.registerProcess=setTimeout(function(){Ga._reconnectState.registerProcess=
null;Ga.register()},Sc),xb.jumpToEnd()}})};Yh.prototype.unregister=function(){var Ga=this,ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Eb){switch(Eb.nextAddress){case 1:if(!Ga.isRegistered())return Eb.return();Ga.debug&&console.log("["+Ga+"] unregister");ub=Ga.trackerId;Eb.setCatchFinallyBlocks(2);return Eb.yield(Ga.sendToAndWait(Ga.trackerId,"unregister",{}),4);case 4:Eb.leaveTryBlock(3);break;case 2:Eb.enterCatchBlock();case 3:Ga.renameTarget(ub,"tracker"),Ga.trackerId=null,Ga.emit("unregistered",
Ga),Eb.jumpToEnd()}})};Yh.prototype.whenRegistered=function(Ga){var ub=this;return Mg.promise.waitFor(Ga,function(){return ub.isRegistered()}).catch(function(Eb){return Promise.reject(/timeout/i.test(String(Eb))?Error("Timeout in "+ub+".whenRegistered"):Eb)})};Yh.prototype.send=function(Ga,ub){var Eb=this,rb=$jscomp.makeIterator(this.prepareSend(Ga,ub));Ga=rb.next().value;ub=rb.next().value;this.whenOnline().then(function(){var Db=Eb.socket,Cc=Ga,qd=Cc.action;Cc=Cc.target;if(!Db)throw Error("Trying to send message "+
qd+" to "+Cc+" but cannot find a connection to it!");"function"===typeof ub?Db.emit(qd,Ga,ub):Db.emit(qd,Ga)})};Yh.prototype.joinRoom=function(Ga){var ub=this;return this.whenOnline().then(function(){return ub.sendToAndWait(ub.trackerId,"[broadcast] join room",{room:Ga})})};Yh.prototype.leaveRoom=function(Ga){var ub=this;return this.whenOnline().then(function(){return ub.sendToAndWait(ub.trackerId,"[broadcast] leave room",{room:Ga})})};Yh.prototype.broadcast=function(Ga,ub,Eb,rb,Db){var Cc=this,qd=
{action:ub,room:Ga,broadcast:Eb};if(void 0===rb?0:rb)qd.isSystemBroadcast=!0;if(void 0===Db?0:Db)qd.isMultiServerBroadcast=!0;return this.whenOnline().then(function(){return Cc.sendToAndWait(Cc.trackerId,"[broadcast] send",qd)})};Yh.prototype.listRoomMembers=function(Ga){var ub=this,Eb,rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Db){if(1==Db.nextAddress)return Db.yield(ub.sendToAndWait(ub.trackerId,"[broadcast] list room members",{room:Ga}),2);Eb=Db.yieldResult;rb=Eb.data;return Db.return(rb)})};
Yh.prototype.joinedRooms=function(){var Ga=this,ub,Eb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rb){if(1==rb.nextAddress)return rb.yield(Ga.sendToAndWait(Ga.trackerId,"[broadcast] my rooms",{}),2);ub=rb.yieldResult;Eb=ub.data;return rb.return(Eb)})};Yh.prototype.listRooms=function(){var Ga=this,ub,Eb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rb){if(1==rb.nextAddress)return rb.yield(Ga.sendToAndWait(Ga.trackerId,"[broadcast] all rooms",{}),2);ub=rb.yieldResult;Eb=
ub.data;return rb.return(Eb)})};Yh.prototype.listPeers=function(Ga){Ga=void 0===Ga?!1:Ga;var ub=this,Eb,rb,Db,Cc,qd,nd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){if(1==rc.nextAddress)return Eb=ub,rb=Eb._peersCached,Db=Date.now(),!Ga&&rb&&1E3>Db-rb.timestamp?rc.return(ub._peersCached.sessions):ub.isOnline()?rc.yield(ub.sendToAndWait(ub.trackerId,"getClients",{}),2):rc.return([]);Cc=rc.yieldResult;qd=Cc.data;nd=qd.map(function(kc){var Sc=$jscomp.makeIterator(kc);kc=Sc.next().value;
var xb=Sc.next().value,jd=xb.info||{};Sc=jd.userRealm;var ke=jd.userToken,Se=jd.l2lUserToken,de=jd.location,Pe=jd.type;jd=jd.world;kc=Object.assign({},Mg.obj.dissoc(xb,["info"]),{id:kc,world:jd,location:de,type:Pe});(ke=ke||Se)&&"null"!==ke&&(lively.user?kc.user=lively.user.ClientUser.fromToken(ke,Sc):(kc.userToken=ke,kc.userRealm=Sc));return kc});ub._peersCached={timestamp:Db,sessions:nd};return rc.return(nd)})};Yh.prototype.toString=function(){var Ga=this.origin,ub=this.path,Eb=this.namespace,rb=
this.id,Db=this.isOnline()?this.isRegistered()?"registered":"unregistered":"disconnected";return"L2LClient("+(rb||"").slice(0,5)+" "+Ga+ub+" - "+Eb+" "+Db+")"};$jscomp.global.Object.defineProperties(Yh.prototype,{socket:{configurable:!0,enumerable:!0,get:function(){return this._socketioClient}},socketId:{configurable:!0,enumerable:!0,get:function(){return this.socket?this.socket.id:null}}});$jscomp.global.Object.defineProperties(Yh,{clients:{configurable:!0,enumerable:!0,get:function(){return this._clients||
(this._clients=new Map)}}});Ca("default",Yh);Mg.L2LClient=Yh;Mg.default=Yh}}});