System.register(["./__root_module__-aefa9179.js","kld-intersections"],function(Da){var Bb,Qb,hc,ac,be,bd,Sd,ed,Mc,pd,Dd,ke,Kd;return{setters:[function(jd){Bb=jd.bv;Qb=jd.a6;hc=jd.r;ac=jd.a7;be=jd.bp;bd=jd.bw;Sd=jd.bx;ed=jd.U;Mc=jd.s;pd=jd.by;Dd=jd.bz;ke=jd.n;Kd=jd.bA},function(){}],execute:function(){function jd(Q){try{var ha=eval("("+Ia.ast.transform.wrapInFunction("var _; _ = ("+Q+")")+")()")}catch(Ha){return JSON.parse(Q)}return"object"!==typeof ha?null:ha}function cb(Q,ha){var Ha,Pa,bc,ic,
Ra,tc,Qd,md,$c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){switch(Wa.nextAddress){case 1:return Ha=ha.world(),Wa.yield(Ha.prompt("Enter package name",{requester:ha,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:Pa=Wa.yieldResult;if(!Pa)throw"Canceled";Wa.setCatchFinallyBlocks(3);ic=Va.resource(Pa);Pa=ic.name();bc=ic.url;Wa.leaveTryBlock(4);break;case 3:return Wa.enterCatchBlock(),Wa.yield(Q.getConfig(),5);case 5:return Ra=Wa.yieldResult.baseURL,
tc=Va.resource(Ra).join(Pa).asDirectory().url,Wa.yield(Q.normalize(tc),6);case 6:bc=Wa.yieldResult.replace(/\/\.js$/,"/");case 4:return Wa.yield(Ha.prompt("Confirm or change package location",{requester:ha,input:bc,historyId:"lively.vm-editor-add-package-address"}),7);case 7:Qd=Wa.yieldResult;if(!Qd)throw"Canceled";md=Va.resource(Qd).asDirectory();$c=md.asFile().url;return Wa.yield(Q.removePackage($c),8);case 8:return Wa.yield(Q.resourceCreateFiles($c,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+
Pa+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+Pa+"\n\nNo description for package "+Pa+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+Pa+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return Wa.return(Va.loadPackage(Q,{name:Pa,address:$c,configFile:md.join("package.json").url,main:md.join("index.js").url,test:md.join("tests/test.js").url,type:"package"}))}})}function Ab(Q,ha,Ha){Ha=void 0===Ha?
null:Ha;var Pa,bc,ic,Ra,tc,Qd,md;return $jscomp.asyncExecutePromiseGeneratorProgram(function($c){switch($c.nextAddress){case 1:return Pa={name:"",address:"",type:"package"},$c.yield(Q.getConfig(),2);case 2:bc=$c.yieldResult;if(!Ha){$c.jumpTo(3);break}return $c.yield(Q.getPackage(Ha),4);case 4:if(ic=$c.yieldResult){$c.jumpTo(5);break}return $c.yield(Q.getPackageForModule(Ha),6);case 6:ic=$c.yieldResult;case 5:Ra=ic;case 3:return $c.yield(ha.world().prompt("What is the package directory?",{requester:ha,
input:Ra?Ra.address:bc.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:tc=$c.yieldResult;if(!tc)throw"Canceled";Pa.address=tc.replace(/\/$/,"");Pa.url=new URL(Pa.address+"/");Pa.configFile=Va.resource(Pa.url).join("package.json").url;$c.setCatchFinallyBlocks(8);Qd=JSON;md=Qd.parse;return $c.yield(Q.moduleRead(Pa.configFile),10);case 10:md.call(Qd,$c.yieldResult).name;$c.leaveTryBlock(9);break;case 8:$c.enterCatchBlock(),Pa.name=String(Pa.url).replace(/\/$/,""),
Q.resourceEnsureExistance(Pa.configFile,'{\n  "name": "'+Pa.name+'",\n  "version": "0.1.0"\n}');case 9:return $c.return(Va.loadPackage(Q,Pa))}})}function Yb(Q,ha,Ha){var Pa,bc,ic;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ra){switch(Ra.nextAddress){case 1:return Pa=Va.resource(Ha).asFile().url,Ra.yield(Q.getPackage(Pa),2);case 2:if(bc=Ra.yieldResult){Ra.jumpTo(3);break}return Ra.yield(Q.getPackageForModule(Pa),4);case 4:bc=Ra.yieldResult;case 3:ic=bc;if(!ic)throw Error("Cannot find package for "+
Pa);return Ra.yield(Q.reloadPackage(Pa),5);case 5:if(!ha){Ra.jumpTo(0);break}return Ra.yield(ha.updateModuleList(),7);case 7:return Ra.yield(ha.uiSelect(Pa,!1),8);case 8:return Ra.return(Ra.yieldResult)}})}function gc(Q,ha,Ha,Pa){var bc,ic;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ra){switch(Ra.nextAddress){case 1:return Ra.yield(Q.getPackage(Ha),2);case 2:return bc=Ra.yieldResult,Ra.yield((Pa||$world).confirm("Unload package "+bc.name+"?",{requester:ha}),3);case 3:ic=Ra.yieldResult;
if(!ic)throw"Canceled";return Ra.yield(Q.removePackage(Ha),4);case 4:if(!ha){Ra.jumpTo(0);break}return Ra.yield(ha.updateModuleList(),6);case 6:return Ra.yield(ha.uiSelect(null),0)}})}function dd(Q,ha,Ha){var Pa,bc,ic,Ra,tc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qd){switch(Qd.nextAddress){case 1:return Pa=ha.world(),Qd.yield(Q.getPackage(Ha),2);case 2:return bc=Qd.yieldResult,bc?Qd.yield(Pa.confirm("Really remove package "+bc.name+"?",{requester:ha}),3):($world.inform('No package "'+
Ha+'" found!',{requester:ha}),Qd.return());case 3:ic=Qd.yieldResult;if(!ic)throw"Canceled";Q.removePackage(Ha);return Qd.yield(Pa.confirm("Also remove directory "+bc.name+" including "+bc.modules.length+" modules?"),4);case 4:Ra=Qd.yieldResult;if(!Ra){Qd.jumpTo(0);break}return Qd.yield(Pa.confirm("REALLY *remove* directory "+bc.name+"? No undo possible..."),6);case 6:if(tc=Qd.yieldResult)return Qd.yield(Q.resourceRemove(bc.address),0);Qd.jumpTo(0)}})}function Zd(Q,ha,Ha){Ha=void 0===Ha?$world:Ha;
var Pa,bc,ic,Ra,tc,Qd,md,$c,Wa,fd,lb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Hd){switch(Hd.nextAddress){case 1:return Hd.yield(Q.getPackage(ha),2);case 2:Pa=Hd.yieldResult;if(!Pa)throw Error("Cannot find package "+ha);bc=[];ic=$jscomp.makeIterator(Pa.modules);Ra=ic.next();case 3:if(Ra.done)return Hd.yield(Ha.execCommand("open text window",{title:"imports and exports of "+ha,content:bc.join("\n\n")}),0);tc=Ra.value;if(!tc.name.match(/\.js$/)){Hd.jumpTo(4);break}Hd.setCatchFinallyBlocks(6);
Qd=Q;md=Qd.importsAndExportsOf;$c=tc.name;return Hd.yield(Q.moduleRead(tc.name),9);case 9:return Hd.yield(md.call(Qd,$c,Hd.yieldResult),8);case 8:Wa=Hd.yieldResult;Hd.leaveTryBlock(7);break;case 6:fd=Hd.enterCatchBlock();Ha.logError(Error("Error when getting imports/exports from module "+tc.name+":\n"+fd.stack));Hd.jumpTo(4);break;case 7:lb=""+tc.name;if(!Wa.imports.length&&!Wa.exports.length){lb+="\n  does not import / export anything";Hd.jumpTo(4);break}Wa.imports.length&&(lb+="\n  imports:\n",
lb+=Va.arr.groupByKey(Wa.imports,"fromModule").mapGroups(function(db,rb){return"from "+db+": "+rb.map(function(vb){return vb.local||vb.imported?vb.imported&&vb.imported!==vb.local?vb.imported+" as "+vb.local:vb.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(db){return"    "+db}).join("\n"));Wa.exports.length&&(lb+="\n  exports:\n",lb+=Wa.exports.map(function(db){return db.local?db.local&&db.local!==db.exported?db.local+" as "+db.exported:db.exported:db.exported+
" from "+db.fromModule}).join(", ").split("\n").map(function(db){return"    "+db}).join("\n"));bc.push(lb);case 4:Ra=ic.next(),Hd.jumpTo(3)}})}function Wb(Q,ha,Ha){Ha=Ha&&Ha.address;if(Ha&&0===ha.indexOf(Ha))var Pa=ha.slice(Ha.length).replace(/^\//,"");else a:{Ha=Q.getConfig();if(!Ha||Ha.constructor!==Promise)try{Pa=String((new URL(ha)).relativePathFrom(new URL(Q.getConfig().baseURL)));break a}catch(bc){}Pa=ha}return Pa}function oc(Q,ha,Ha,Pa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(bc){return 1==
bc.nextAddress?(Pa=Object.assign({targetModule:ha},Pa),bc.yield(Q.normalize(ha),2)):3!=bc.nextAddress?(ha=bc.yieldResult,bc.yield(Q.moduleSourceChange(ha,Ha,Pa),3)):bc.return(ha)})}function Lb(Q,ha,Ha,Pa,bc){Pa=void 0===Pa?!1:Pa;bc=void 0===bc?!1:bc;var ic;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ra){switch(Ra.nextAddress){case 1:return ha&&ha.setStatusMessage("Reloading "+Ha),Ra.setCatchFinallyBlocks(2),Ra.yield(Q.reloadModule(Ha,{reloadDeps:Pa,resetEnv:bc}),4);case 4:if(!ha){Ra.jumpTo(5);
break}return Ra.yield(ha.updateModuleList(),6);case 6:case 5:ha&&ha.setStatusMessage("Reloded "+Ha);Ra.leaveTryBlock(0);break;case 2:ic=Ra.enterCatchBlock();Ra.setCatchFinallyBlocks(7);if(!ha){Ra.jumpTo(9);break}return Ra.yield(ha.updateEditorWithSourceOf(Ha),10);case 10:case 9:Ra.leaveTryBlock(8);break;case 7:Ra.enterCatchBlock();case 8:throw ha&&ha.showError(ic),ic;}})}function Bc(Q,ha,Ha){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){switch(Pa.nextAddress){case 1:return Pa.yield(Q.forgetModule(Ha,
{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!ha){Pa.jumpTo(3);break}return Pa.yield(ha.updateModuleList(),4);case 4:case 3:Pa.jumpToEnd()}})}function Sc(Q,ha,Ha){var Pa,bc,ic;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ra){switch(Ra.nextAddress){case 1:return Ra.yield(Q.normalize(Ha),2);case 2:return Pa=Ra.yieldResult,Ra.yield(ha.world().confirm("Remove file "+Pa+"?",{requester:ha}),3);case 3:bc=Ra.yieldResult;if(!bc)throw"Canceled";return Ra.yield(Q.forgetModule(Pa),4);case 4:return Ra.yield(Q.resourceRemove(Pa),
5);case 5:return Ra.yield(Q.getPackageForModule(Pa),6);case 6:return ic=Ra.yieldResult,Ra.return(ic)}})}function Yc(Q,ha,Ha){var Pa,bc,ic,Ra,tc,Qd,md,$c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){switch(Wa.nextAddress){case 1:return Pa=URL,Wa.yield(Q.getConfig(),2);case 2:bc=new Pa(Wa.yieldResult.baseURL);ic=ha.world();if(!Ha){Wa.jumpTo(3);break}return Wa.yield(Q.getPackage(Ha),4);case 4:if(Ra=Wa.yieldResult){Wa.jumpTo(5);break}return Wa.yield(Q.getPackageForModule(Ha),6);case 6:Ra=
Wa.yieldResult;case 5:(tc=Ra)&&(bc=new URL(tc.address));case 3:return Wa.yield(tb._searchForExistingFiles(ha,String(bc),tc),7);case 7:Qd=Wa.yieldResult;if(!Qd.includes("[create new module]")){Wa.jumpTo(8);break}return Wa.yield(tb._askForModuleName(Q,Ha||String(bc),ic),9);case 9:md=Wa.yieldResult,Qd=[md];case 8:return Wa.yield(tb._createAndLoadModules(Q,Qd),10);case 10:return $c=Wa.yieldResult,tb.arr.compact($c.map(function(fd){return fd.error})),Wa.return($c)}})}function Xb(Q,ha){var Ha,Pa,bc,ic,
Ra,tc,Qd,md,$c,Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fd){if(1==fd.nextAddress)return fd.yield(Q.getPackage(ha),2);if(3!=fd.nextAddress){Ha=fd.yieldResult;if(!Ha||!Ha.address.match(/^http/))throw Error("Cannot load package "+ha);Pa=tb.resource(Ha.address);bc=[];ic=$jscomp;Ra=ic.makeIterator;return fd.yield(Pa.dirList(5,{exclude:tb.modulesInPackage_defaultExclude}),3)}tc=Ra.call(ic,fd.yieldResult);for(Qd=tc.next();!Qd.done;Qd=tc.next())$c=md=Qd.value,Wa=$c.url,Wa.match(/\.js$/)&&
Q.isModuleLoaded(Wa,!0)&&bc.push(Q.getModule(Wa));return fd.return(bc)})}function qb(Q,ha){ha=void 0===ha?[]:ha;var Ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){if(1==Pa.nextAddress)return Pa.yield(System.import("mocha-es6/index.js"),2);Ha=Pa.yieldResult;return Pa.return(Ha.loadTestModuleAndExtractTestState(Q,ha))})}function uc(Q,ha,Ha,Pa){function bc(fd){return new Promise(function(lb,Hd){var db=Jb.arr.compact(fd.suite.suites).map(function(vb){return vb.file}),rb=Jb.chain(ha).filter(function(vb){return db.includes(vb.file)}).pluck("tests").flatten().value();
if(!rb||!rb.length)return Hd(Error("Trying to run tests of "+db.join(", ")+" but cannot find them in loaded tests!"));fd.reporter(function(vb){vb.on("test",function(vd){try{var me=rb.find(function(ye){return ye.fullTitle===vd.fullTitle()});me.state="running";"function"===typeof Ha&&Ha(me,"test")}catch(ye){"function"===typeof Pa&&Pa(ye,"test")}});vb.on("pass",function(vd){try{var me=rb.find(function(ye){return ye.fullTitle===vd.fullTitle()});me.state="succeeded";me.duration=vd.duration;"function"===
typeof Ha&&Ha(me,"pass")}catch(ye){"function"===typeof Pa&&Pa(ye,"pass")}});vb.on("fail",function(vd,me){try{var ye=function(re,Ed,Nb){re.state="failed";re.duration=re.duration;re.error=Ed},Pe=rb.find(function(re){return re.fullTitle===vd.fullTitle()});if(Pe)ye(Pe,me,vd.duration);else{var Tc=Jb.arr.invoke(vd.parent.tests,"fullTitle");rb.filter(function(re){return Tc.includes(re.fullTitle)}).forEach(function(re){return ye(re,me,vd.duration)})}"function"===typeof Ha&&Ha(Pe,"fail")}catch(re){"function"===
typeof Pa&&Pa(re,"fail")}})});fd.run(function(vb){return lb({testsByFile:ha,mocha:fd})})})}var ic,Ra,tc,Qd,md,$c,Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fd){switch(fd.nextAddress){case 1:ic=$jscomp.makeIterator(ha),Ra=ic.next();case 2:if(Ra.done){fd.jumpTo(4);break}Qd=tc=Ra.value;md=Qd.file;return fd.yield(Jb.loadMochaTestFile(md,ha),5);case 5:return $c=fd.yieldResult,Wa=$c.mocha,Q&&(Wa=Wa.grep(Q)),fd.yield(bc(Wa),3);case 3:Ra=ic.next();fd.jumpTo(2);break;case 4:return fd.return({mocha:Wa,
testsByFile:ha})}})}function Hc(Q){Q||(Q="local");if(Q.isSystemInterface)var ha=Q;else"string"===typeof Q&&Q.startsWith("l2l ")&&(Q={type:"l2l",id:Q.split(" ")[1]}),"string"!==typeof Q&&"l2l"===Q.type&&(ha=Pc.l2lInterfaceFor(Q.id,Q.info)),"string"!==typeof Q&&($world.setStatusMessage("Unknown system interface "+Q),Q="local"),ha||(ha=Q&&"local"!==Q?Pc.serverInterfaceFor(Q):Pc.localInterface);return ha}Da("systemInterfaceNamed",Hc);var Ia=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");
Ia.parseJsonLikeObj=jd;Ia.ast=Bb;Ia.parseJsonLikeObj=jd;Ia.parseJsonLikeObj=jd;var Va=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");Va.loadPackage=function(Q,ha){var Ha,Pa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(bc){switch(bc.nextAddress){case 1:return bc.yield(Q.importPackage(ha.address+"/"),2);case 2:if(!ha.main){bc.jumpTo(3);break}return bc.yield(Q.importModule(ha.main.toString()),3);case 3:if(!ha.test){bc.jumpTo(5);break}bc.setCatchFinallyBlocks(6);
return bc.yield(Q.importPackage("mocha-es6"),8);case 8:return Ha=bc.yieldResult,bc.yield(Ha.installSystemInstantiateHook(),9);case 9:return bc.yield(Q.importModule(ha.test.toString()),10);case 10:bc.leaveTryBlock(5);break;case 6:Pa=bc.enterCatchBlock(),console.warn("Cannot load test of new package: "+Pa);case 5:return bc.return(Q.getPackage(ha.address))}})};Va.interactivelyCreatePackage=cb;Va.interactivelyLoadPackage=Ab;Va.interactivelyReloadPackage=Yb;Va.interactivelyUnloadPackage=gc;Va.interactivelyRemovePackage=
dd;Va.showExportsAndImportsOf=Zd;Va.parseJsonLikeObj=jd;Va.arr=Qb;Va.resource=hc;Va.interactivelyCreatePackage=cb;Va.interactivelyCreatePackage=cb;Va.interactivelyLoadPackage=Ab;Va.interactivelyLoadPackage=Ab;Va.interactivelyReloadPackage=Yb;Va.interactivelyReloadPackage=Yb;Va.interactivelyUnloadPackage=gc;Va.interactivelyUnloadPackage=gc;Va.interactivelyRemovePackage=dd;Va.interactivelyRemovePackage=dd;Va.showExportsAndImportsOf=Zd;Va.showExportsAndImportsOf=Zd;var tb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");
tb.shortModuleName=Wb;tb.interactivelyChangeModule=oc;tb.interactivelyReloadModule=Lb;tb.interactivelyUnloadModule=Bc;tb.interactivelyRemoveModule=Sc;tb.interactivelyAddModule=Yc;tb._askForModuleName=function(Q,ha,Ha){var Pa,bc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ic){switch(ic.nextAddress){case 1:return ic.yield(Ha.prompt("Enter module name",{input:ha,historyId:"lively.vm-editor-add-module-name"}),2);case 2:ha=ic.yieldResult;if(!ha)throw"Canceled";return ic.yield(Q.normalize(ha),
3);case 3:return Pa=ic.yieldResult,ic.yield(Ha.confirm(["Create module \n",{},Pa,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:bc=ic.yieldResult;if(!bc)throw"Canceled";return ic.return(Pa)}})};tb._searchForExistingFiles=function(Q,ha,Ha){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){return String(ha).match(/^http/)?Pa.return(tb._searchForExistingFilesWeb(Q,ha,Ha)):Pa.return(tb._searchForExistingFilesManually(Q,ha,Ha))})};tb._searchForExistingFilesManually=function(Q,
ha,Ha){var Pa,bc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ic){switch(ic.nextAddress){case 1:return ic.yield(Q.world().multipleChoicePrompt("Add Module",{requester:Q,choices:["Create New Module","Load Existing Module"]}),2);case 2:Pa=ic.yieldResult;if("Create New Module"===Pa)return ic.return("[create new module]");if("Load Existing Module"!==Pa){ic.jumpTo(3);break}return ic.yield(Q.world().prompt("URL of module?",{input:ha,requester:Q,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),
4);case 4:if(bc=ic.yieldResult)return ic.return([bc]);case 3:throw"Canceled";}})};tb._searchForExistingFilesWeb=function(Q,ha,Ha){function Pa($c){$c.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes($c.name())||Ha&&tb.arr.pluck(Ha.modules,"name").includes($c.url)?!0:!1}var bc,ic,Ra,tc,Qd,md;return $jscomp.asyncExecutePromiseGeneratorProgram(function($c){switch($c.nextAddress){case 1:return(bc=Q.world())&&(ic=bc.showLoadingIndicatorFor(Q,"Loading existing modules...")),
$c.yield(tb.resource(ha).dirList(5,{exclude:Pa}),3);case 3:return $c.yield($c.yieldResult.map(function(Wa){return Wa.url}),2);case 2:return Ra=$c.yieldResult,tc=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(Ra.filter(function(Wa){return Wa.endsWith(".js")}).map(function(Wa){return{isListItem:!0,string:Ha&&0==Wa.indexOf(Ha.address)?Ha.name+Wa.slice(Ha.address.length):Wa,value:Wa}})),$c.yield(Promise.resolve(ic&&ic.remove()).then(function(){return Q.world().filterableListPrompt("What module to load?",
tc,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:Q},Q?{extent:Q.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:Qd=$c.yieldResult;if(!Qd||"canceled"===Qd.status||!Qd.selected.length)throw"Canceled";md=Qd.selected||Qd;Array.isArray(md)||(md=[md]);return $c.return(md)}})};tb._createAndLoadModules=function(Q,ha){var Ha,Pa,bc,ic,Ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tc){switch(tc.nextAddress){case 1:Array.isArray(ha)||(ha=[ha]),Ha=[],Pa=$jscomp.makeIterator(ha),
bc=Pa.next();case 2:if(bc.done){tc.jumpTo(4);break}ic=bc.value;return tc.yield(Q.forgetModule(ic,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return tc.yield(Q.resourceEnsureExistance(ic,'"format esm";\n'),6);case 6:return tc.setCatchFinallyBlocks(7),tc.yield(Q.importModule(ic),9);case 9:Ha.push({name:ic});tc.leaveTryBlock(3);break;case 7:Ra=tc.enterCatchBlock(),Ha.push({name:ic,error:Ra});case 3:bc=Pa.next();tc.jumpTo(2);break;case 4:return tc.return(Ha)}})};tb.modulesInPackage_defaultExclude=function(Q){return[".git",
"node_modules",".optimized-loading-cache",".module_cache"].includes(Q.name())?!0:!1};tb.modulesInPackage=Xb;tb.obj=ac;tb.arr=Qb;tb.resource=hc;tb.shortModuleName=Wb;tb.shortModuleName=Wb;tb.interactivelyChangeModule=oc;tb.interactivelyChangeModule=oc;tb.interactivelyReloadModule=Lb;tb.interactivelyReloadModule=Lb;tb.interactivelyUnloadModule=Bc;tb.interactivelyUnloadModule=Bc;tb.interactivelyRemoveModule=Sc;tb.interactivelyRemoveModule=Sc;tb.interactivelyAddModule=Yc;tb.interactivelyAddModule=Yc;
tb.modulesInPackage=Xb;tb.modulesInPackage=Xb;var Jb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/mocha-tests.js");Jb.loadMochaTestFile=qb;Jb.runMochaTests=uc;Jb.arr=Qb;Jb.chain=be;Jb.loadMochaTestFile=qb;Jb.loadMochaTestFile=qb;Jb.runMochaTests=uc;Jb.runMochaTests=uc;var Ib=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");Ib.todo=function(Q){throw Error(Q+" is not yet implemented!");};Ib.parseJsonLikeObj=jd;Ib.arr=Qb;Ib.Closure=bd;Ib.obj=
ac;Ib.resource=hc;Ib.transform=Sd;Ib.modules=ed;var ib=function(){};ib.prototype.dynamicCompletionsForPrefix=function(Q,ha,Ha){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){Ib.todo("dynamicCompletionsForPrefix");Pa.jumpToEnd()})};ib.prototype.runEval=function(Q,ha){Ib.todo("runEval")};ib.prototype.resourceExists=function(Q){Ib.todo("resourceExists")};ib.prototype.resourceEnsureExistance=function(Q,ha){Ib.todo("resourceEnsureExistance")};ib.prototype.resourceMkdir=function(Q){Ib.todo("resourceMkdir")};
ib.prototype.resourceRead=function(Q){Ib.todo("resourceRead")};ib.prototype.resourceRemove=function(Q){Ib.todo("resourceRemove")};ib.prototype.resourceWrite=function(Q,ha){Ib.todo("resourceWrite")};ib.prototype.resourceCreateFiles=function(Q,ha){Ib.todo("resourceCreateFiles")};ib.prototype.resourceDirList=function(Q,ha,Ha){Ib.todo("resourceDirList")};ib.prototype.normalizeSync=function(Q,ha,Ha){Ib.todo("normalizeSync")};ib.prototype.normalize=function(Q,ha,Ha){Ib.todo("normalize")};ib.prototype.printSystemConfig=
function(){Ib.todo("printSystemConfig")};ib.prototype.getConfig=function(){Ib.todo("getConfig")};ib.prototype.setConfig=function(Q){Ib.todo("setConfig")};ib.prototype.getPackages=function(Q){Ib.todo("getPackages")};ib.prototype.isModuleLoaded=function(Q,ha){Ib.todo("isModuleLoaded")};ib.prototype.doesModuleExist=function(Q,ha){Ib.todo("doesModuleExist")};ib.prototype.getModules=function(){var Q=this,ha,Ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){return 1==Pa.nextAddress?(ha=
Ib.arr,Ha=ha.flatmap,Pa.yield(Q.getPackages(),2)):Pa.return(Ha.call(ha,Pa.yieldResult,function(bc){return bc.modules}))})};ib.prototype.getModule=function(Q){var ha=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){return 1==Ha.nextAddress?Ha.yield(ha.getModules(),2):Ha.return(Ha.yieldResult.find(function(Pa){return Pa.name===Q}))})};ib.prototype.getPackage=function(Q){var ha=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){return 1==Ha.nextAddress?(Q=Q.replace(/\/+$/,
""),Ha.yield(ha.getPackages(),2)):Ha.return(Ha.yieldResult.find(function(Pa){return Pa.address===Q||Pa.name===Q}))})};ib.prototype.getPackageForModule=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){Ib.todo("getPackageForModule");ha.jumpToEnd()})};ib.prototype.systemConfChange=function(Q){var ha=Ib.parseJsonLikeObj(Q);["baseURL"].forEach(function(Ha){return delete ha[Ha]});return this.setConfig(ha)};ib.prototype.resourcesOfPackage=function(Q,ha){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){Ib.todo("resourcesOfPackage");
Ha.jumpToEnd()})};ib.prototype.registerPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){Ib.todo("registerPackage");ha.jumpToEnd()})};ib.prototype.importPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){Ib.todo("importPackage");ha.jumpToEnd()})};ib.prototype.removePackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){Ib.todo("removePackage");ha.jumpToEnd()})};ib.prototype.reloadPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){Ib.todo("reloadPackage");
ha.jumpToEnd()})};ib.prototype.packageConfChange=function(Q,ha){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){Ib.todo("packageConfChange");Ha.jumpToEnd()})};ib.prototype.importModule=function(Q){Ib.todo("importModule")};ib.prototype.forgetModule=function(Q,ha){Ib.todo("forgetModule")};ib.prototype.reloadModule=function(Q,ha){Ib.todo("reloadModule")};ib.prototype.moduleFormat=function(Q){Ib.todo("moduleFormat")};ib.prototype.moduleRead=function(Q){Ib.todo("moduleRead")};ib.prototype.moduleSourceChange=
function(Q,ha,Ha){Ib.todo("moduleSourceChange")};ib.prototype.importsAndExportsOf=function(Q,ha){Ib.todo("importsAndExportsOf")};ib.prototype.keyValueListOfVariablesInModule=function(Q,ha){Ib.todo("keyValueListOfVariablesInModule")};ib.prototype.moduleWrite=function(Q,ha){return this.moduleSourceChange(Q,ha)};Ib.AbstractCoreInterface=ib;var jb=function(){var Q=Ib.AbstractCoreInterface.call(this)||this;Q.currentEval=null;return Q};$jscomp.inherits(jb,Ib.AbstractCoreInterface);jb.prototype.runEval=
function(Q,ha){throw Error("Not yet implemented");};jb.prototype.runEvalAndStringify=function(Q,ha){var Ha=this;return this.currentEval?this.currentEval.then(function(){return Ha.runEvalAndStringify(Q,ha)}):this.currentEval=Promise.resolve().then(function(){var Pa,bc,ic,Ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tc){switch(tc.nextAddress){case 1:return tc.yield(Ha.runEval("\n        Promise.resolve((async "+Ib.transform.wrapInFunction(Q)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},ha)),2);case 2:if((Pa=tc.yieldResult)&&Pa.isError)throw Error(String(Pa.value||Pa.error));if(!Pa||!Pa.value)return tc.return(null);if(bc=Pa.promisedValue){tc.jumpTo(3);break}return tc.yield(Pa.value,4);case 4:bc=tc.yieldResult;case 3:ic=bc;if(!ic)return tc.return();if("undefined"===ic)return tc.return(void 0);if("null"===ic)return tc.return(null);if("true"===ic)return tc.return(!0);
if("false"===ic)return tc.return(!1);try{Ra=JSON.parse(ic)}catch(Qd){return tc.return(ic)}if(Ra&&Ra.isError)throw Error(String(Ra.value));return tc.return(Ra)}})}).then(function(Pa){delete Ha.currentEval;return Pa},function(Pa){delete Ha.currentEval;return Promise.reject(Pa)})};jb.prototype.dynamicCompletionsForPrefix=function(Q,ha,Ha){var Pa=this,bc,ic;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ra){bc=Ib.obj.isString(Ha.context)?Ha.context:!1;Ha=Ib.obj.dissoc(Ha,["systemInterface",
"System","context"]);ic="\n      var prefix = "+JSON.stringify(ha)+",\n          opts = "+JSON.stringify(Ha)+";\n      opts.context = "+bc+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return Ra.return(Pa.runEvalAndStringify(ic))})};jb.prototype.evalWithResource=function(Q,ha,Ha){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+Q+'").'+ha+"("+(Ha?JSON.stringify(Ha):"")+");\n    ")};jb.prototype.resourceExists=function(Q){return this.evalWithResource(Q,"exists")};jb.prototype.resourceEnsureExistance=function(Q,ha){return this.evalWithResource(Q,
"ensureExistance",ha)};jb.prototype.resourceMkdir=function(Q){return this.evalWithResource(Q,"mkdir")};jb.prototype.resourceRead=function(Q){return this.evalWithResource(Q,"read")};jb.prototype.resourceRemove=function(Q){return this.evalWithResource(Q,"remove")};jb.prototype.resourceWrite=function(Q,ha){return this.evalWithResource(Q,"write",ha)};jb.prototype.resourceCreateFiles=function(Q,ha){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
Q+'", '+JSON.stringify(ha)+")")};jb.prototype.resourceDirList=function(Q,ha,Ha){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+Q+'").dirList('+JSON.stringify(ha)+", "+JSON.stringify(Ha)+"))\n        .map(({url}) => ({url}))")};jb.prototype.livelySystemAccessor=function(Q){Q=void 0===Q?"livelySystem":Q;return"var "+Q+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
Q+') throw new Error("lively-system-interface not available!");'};jb.prototype.normalizeSync=function(Q,ha,Ha){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(Q)+", "+JSON.stringify(ha)+", "+Ha+")")};jb.prototype.normalize=function(Q,ha,Ha){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(Q)+", "+JSON.stringify(ha)+", "+JSON.stringify(Ha)+")")};jb.prototype.printSystemConfig=function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")};
jb.prototype.getConfig=function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')};jb.prototype.setConfig=function(Q){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(Q)+")")};jb.prototype.getPackages=function(Q){Q=Object.assign({excluded:[]},Q);Q.excluded=Q.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(Q)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')};jb.prototype.getPackageForModule=function(Q){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(Q)+")")};jb.prototype.isModuleLoaded=function(Q,ha){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+Q+'", '+ha+")")};jb.prototype.doesModuleExist=function(Q,ha){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+Q+'", '+ha+")")};jb.prototype.registerPackage=function(Q){var ha=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){return Ha.return(ha.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(Q)+")"))})};jb.prototype.importPackage=
function(Q){var ha=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){return Ha.return(ha.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(Q)+")"))})};jb.prototype.removePackage=function(Q){var ha=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){return Ha.return(ha.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(Q)+")"))})};jb.prototype.reloadPackage=function(Q,ha){var Ha=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){return Pa.return(Ha.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(Q)+", "+JSON.stringify(ha)+")"))})};jb.prototype.packageConfChange=function(Q,ha){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(Q)+", "+JSON.stringify(ha)+")")};jb.prototype.resourcesOfPackage=function(Q,ha){ha=void 0===ha?[".git","node_modules",".module_cache","lively.next-node_modules"]:ha;var Ha=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){Q.address&&(Q=
Q.address);return Pa.return(Ha.runEvalAndStringify("\n      "+Ha.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(Q)+", "+JSON.stringify(ha)+");"))})};jb.prototype.getModule=function(Q){var ha=this,Ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){if(1==Pa.nextAddress)return Pa.yield(ha.getModules(),2);Ha=Pa.yieldResult.find(function(bc){return bc.name===Q});return Pa.return(Ha?Ib.modules.module(Ha.name):null)})};jb.prototype.importModule=
function(Q){return this.runEvalAndStringify("lively.modules.System.import("+JSON.stringify(Q)+")")};jb.prototype.forgetModule=function(Q,ha){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").unload("+JSON.stringify(ha)+")")};jb.prototype.reloadModule=function(Q,ha){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").reload("+JSON.stringify(ha)+")")};jb.prototype.moduleFormat=function(Q){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(Q)+").format();")};jb.prototype.moduleRead=function(Q){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").source()")};jb.prototype.moduleSourceChange=function(Q,ha,Ha){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Q)+").changeSource("+JSON.stringify(ha)+", "+JSON.stringify(Ha)+")")};jb.prototype.keyValueListOfVariablesInModule=function(Q,ha){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+
JSON.stringify(Q)+", "+JSON.stringify(ha)+")")};jb.prototype.importsAndExportsOf=function(Q,ha){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(Q)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(Q)+").exports()})")};jb.prototype.exportsOfModules=function(Q){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(Q)+";\n      options.excludedPackages = ["+Q.excludedPackages.map(function(ha){return"function"===
typeof ha?ha.toString():JSON.stringify(ha)}).join(",")+"]\n      await livelySystem.localInterface.exportsOfModules(options)")};jb.prototype.searchInPackage=function(Q,ha,Ha){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(Q)+", "+JSON.stringify(ha)+", "+JSON.stringify(Ha)+")")};jb.prototype.loadMochaTestFile=function(Q,ha){ha=void 0===ha?[]:ha;var Ha=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){return Pa.return(Ha.runEvalAndStringify("\n      "+
Ha.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(Q)+", "+JSON.stringify(ha)+"), result;\n      result = {testsByFile}"))})};jb.prototype.runMochaTests=function(Q,ha,Ha,Pa){var bc=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ic){Q&&Q instanceof RegExp&&(Q={isRegExp:!0,value:String(Q).replace(/^\/|\/$/g,"")});return ic.return(bc.runEvalAndStringify("\n      var grep = "+JSON.stringify(Q)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
bc.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(ha||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})};
Ib.RemoteCoreInterface=jb;var Fb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");Fb.obj=ac;Fb.string=Mc;Fb.arr=Qb;Fb.resource=hc;Fb.createFiles=pd;Fb.ast=Bb;Fb.modules=ed;Fb.vm=Dd;Fb.loadMochaTestFile=qb;Fb.runMochaTests=uc;Fb.parseJsonLikeObj=jd;Fb.AbstractCoreInterface=ib;Fb.classToFunctionTransform=ke;ib=function(){return Fb.AbstractCoreInterface.apply(this,arguments)||this};$jscomp.inherits(ib,Fb.AbstractCoreInterface);ib.prototype.dynamicCompletionsForPrefix=
function(Q,ha,Ha){var Pa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(bc){if(1==bc.nextAddress)return bc.yield(Fb.vm.completions.getCompletions(function(ic){return Fb.vm.runEval(ic.replace("return ",""),Object.assign({targetModule:Q,classTransform:Fb.classToFunctionTransform},Ha))},ha),2);Pa=bc.yieldResult;if(Pa.isError)throw Pa.value;return bc.return({completions:Pa.completions,prefix:Pa.startLetters})})};ib.prototype.runEval=function(Q,ha){return Fb.vm.runEval(Q,Object.assign({classTransform:Fb.classToFunctionTransform},
ha))};ib.prototype.resourceExists=function(Q){return Fb.resource(Q).exists()};ib.prototype.resourceEnsureExistance=function(Q,ha){return Fb.resource(Q).ensureExistance(ha)};ib.prototype.resourceMkdir=function(Q){return Fb.resource(Q).mkdir()};ib.prototype.resourceRead=function(Q){return Fb.resource(Q).read()};ib.prototype.resourceRemove=function(Q){return Fb.resource(Q).remove()};ib.prototype.resourceWrite=function(Q,ha){return Fb.resource(Q).write(ha)};ib.prototype.resourceCreateFiles=function(Q,
ha){return Fb.createFiles(Q,ha)};ib.prototype.resourceDirList=function(Q,ha,Ha){return Fb.resource(Q).dirList(ha,Ha)};ib.prototype.normalizeSync=function(Q,ha,Ha){return System.decanonicalize(Q,ha,Ha)};ib.prototype.normalize=function(Q,ha,Ha){return System.normalize(Q,ha,Ha)};ib.prototype.printSystemConfig=function(){return Fb.modules.printSystemConfig()};ib.prototype.getConfig=function(){return System.getConfig()};ib.prototype.setConfig=function(Q){Fb.modules.System.config(Q)};ib.prototype.getPackages=
function(Q){Q=Object.assign({},Q);Q=void 0===Q.excluded?[]:Q.excluded;var ha=Q.filter(function(Pa){return"string"===typeof Pa}),Ha=Q.filter(function(Pa){return"function"===typeof Pa});ha=ha.concat(ha.map(function(Pa){return System.decanonicalize(Pa.replace(/\/?$/,"/")).replace(/\/$/,"")}));return Fb.modules.getPackages().filter(function(Pa){return!ha.includes(Pa.url)&&!Ha.some(function(bc){return bc(Pa.url)})})};ib.prototype.registerPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){return ha.return(Fb.modules.registerPackage(Q))})};
ib.prototype.importPackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){return ha.return(Fb.modules.importPackage(Q))})};ib.prototype.removePackage=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){return ha.return(Fb.modules.removePackage(Q))})};ib.prototype.reloadPackage=function(Q,ha){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){return Ha.return(Fb.modules.reloadPackage(Q,ha))})};ib.prototype.packageConfChange=function(Q,
ha){var Ha=this,Pa,bc,ic,Ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tc){if(1==tc.nextAddress)return Pa=Fb.modules.System,bc=Fb.parseJsonLikeObj(Q),ic=JSON.stringify(bc,null,2),tc.yield(Fb.modules.module(ha).changeSource(ic,{doEval:!1}),2);if(3!=tc.nextAddress)return Pa.set(ha,Pa.newModule(bc)),tc.yield(Ha.getPackageForModule(ha),3);(Ra=tc.yieldResult)&&Fb.modules.applyPackageConfig(bc,Ra.address);tc.jumpToEnd()})};ib.prototype.resourcesOfPackage=function(Q,ha){ha=void 0===ha?[".git",
"node_modules",".module_cache"]:ha;var Ha,Pa,bc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ic){if(1==ic.nextAddress)return ic.setCatchFinallyBlocks(2),Ha=Q.address?Q.address:Q,Pa=Fb.modules.getPackage(Ha),ic.yield(Pa.resources(void 0,ha),4);if(2!=ic.nextAddress)return ic.return(ic.yieldResult.map(function(Ra){return Object.assign(Ra,{package:Ra.package.url})}));bc=ic.enterCatchBlock();console.warn("resourcesOfPackage error for "+Q+": "+bc);return ic.return([])})};ib.prototype.getPackageForModule=
function(Q){return(Q=Fb.modules.getPackageOfModule(Q))?Q.asSpec():Q};ib.prototype.isModuleLoaded=function(Q,ha){return Fb.modules.isModuleLoaded(Q,ha)};ib.prototype.doesModuleExist=function(Q,ha){return Fb.modules.isModuleLoaded(Q,ha)};ib.prototype.getModule=function(Q){return Fb.modules.module(Q)};ib.prototype.importModule=function(Q){return Fb.modules.System.import(Q)};ib.prototype.forgetModule=function(Q,ha){return Fb.modules.module(Q).unload(ha)};ib.prototype.reloadModule=function(Q,ha){return Fb.modules.module(Q).reload(ha)};
ib.prototype.moduleFormat=function(Q){return Fb.modules.module(Q).format()};ib.prototype.moduleRead=function(Q){return Fb.modules.module(Q).source()};ib.prototype.moduleSourceChange=function(Q,ha,Ha){return Fb.modules.module(Q).changeSource(ha,Ha)};ib.prototype.keyValueListOfVariablesInModule=function(Q,ha){var Ha=this,Pa,bc,ic,Ra,tc,Qd,md,$c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){switch(Wa.nextAddress){case 1:if(ha){Wa.jumpTo(2);break}return Wa.yield(Ha.resourceRead(Q),3);
case 3:ha=Wa.yieldResult;case 2:return Pa="string"===typeof ha?Fb.ast.parse(ha):ha,bc=Ha.normalizeSync(Q),Ha.moduleFormat(bc),ic=Fb.modules.module(bc).env().recorder,Wa.yield(Ha.importsAndExportsOf(bc,Pa),4);case 4:return Ra=Wa.yieldResult,tc=Fb.ast.query.topLevelDeclsAndRefs(Pa),Qd=Fb.arr.sortByKey(Fb.ast.query.declarationsOfScope(tc.scope,!0),"start"),md=Fb.arr.pluck(tc.scope.importSpecifiers,"name"),$c=0,Wa.return(Qd.map(function(fd){var lb=fd.name.length,Hd=Ra.exports.find(function(rb){return rb.local===
fd.name}),db=Fb.arr.include(md,fd.name);Hd&&(lb+=9);db&&(lb+=9);$c=Math.max($c,lb);return{isExport:Hd,isImport:db,name:fd.name,value:ic[fd.name],node:fd,printedName:fd.name+(Hd?" [export]":"")+(db?" [import]":""),printedValue:Fb.obj.inspect(ic[fd.name],{maxDepth:1}).replace(/\n/g,"")}}).map(function(fd){return{isListItem:!0,value:fd,string:fd.printedName+Fb.string.indent(" = "+fd.printedValue," ",$c-fd.printedName.length)}}))}})};ib.prototype.importsAndExportsOf=function(Q,ha){var Ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){return 1==
Pa.nextAddress?Pa.yield(Fb.modules.module(Q).imports(ha),2):3!=Pa.nextAddress?(Ha=Pa.yieldResult,Pa.yield(Fb.modules.module(Q).exports(ha),3)):Pa.return({imports:Ha,exports:Pa.yieldResult})})};ib.prototype.exportsOfModules=function(Q){return Fb.modules.ExportLookup.run(System,Q)};ib.prototype.searchInPackage=function(Q,ha,Ha){return Fb.modules.getPackage(Q).search(ha,Ha)};ib.prototype.runMochaTests=function(Q,ha,Ha,Pa){return Fb.runMochaTests(Q,ha,Ha,Pa)};ib.prototype.loadMochaTestFile=function(Q,
ha){return Fb.loadMochaTestFile(Q,ha)};$jscomp.global.Object.defineProperties(ib.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"local"}}});Fb.LocalCoreInterface=ib;var rc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");rc.evalStrategies=Kd;rc.RemoteCoreInterface=jb;var Ic=function(Q){var ha=rc.RemoteCoreInterface.call(this)||this;ha.currentEval=null;ha.url=Q;ha.server=new rc.evalStrategies.HttpEvalStrategy(Q);return ha};$jscomp.inherits(Ic,
rc.RemoteCoreInterface);Ic.prototype.runEval=function(Q,ha){return this.server.runEval(Q,ha)};$jscomp.global.Object.defineProperties(Ic.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this.url}},description:{configurable:!0,enumerable:!0,get:function(){return this.url.replace(/^https?:\/\//,"")}}});rc.HTTPCoreInterface=Ic;var ec=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");ec.evalStrategies=Kd;ec.RemoteCoreInterface=jb;jb=function(Q,
ha){var Ha=ec.RemoteCoreInterface.call(this)||this;Ha.targetId=Q;Ha.peer=ha;return Ha};$jscomp.inherits(jb,ec.RemoteCoreInterface);jb.prototype.isConnected=function(){var Q=this,ha,Ha,Pa,bc,ic;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ra){if(1==Ra.nextAddress)return ha=Q,Ha=ha.client,Pa=ha.targetId,Ra.yield(Ha.sendToAndWait(Ha.trackerId,"getClients",{}),2);bc=Ra.yieldResult;ic=bc.data;return Ra.return(ic.some(function(tc){tc=$jscomp.makeIterator(tc).next().value;return Pa===tc}))})};
jb.prototype.runEval=function(Q,ha){var Ha=this,Pa,bc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ic){Pa=Ha.client;if(!Pa)throw Error("No lively.2lively default client available!");bc=new ec.evalStrategies.L2LEvalStrategy(Pa,Ha.targetId);return ic.return(bc.runEval(Q,ha))})};$jscomp.global.Object.defineProperties(jb.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"l2l "+this.targetId}},description:{configurable:!0,enumerable:!0,get:function(){var Q=this.peer,ha=
"l2l "+this.targetId.slice(0,5);if(Q){var Ha=Q.location,Pa=Q.type,bc=Q.user;Q=Q.world;Pa&&(ha+=", "+Pa);Ha&&(ha+=", "+Ha.replace(/^https?:\/\//,"")+(Q?"/"+Q:""));bc&&(ha+=", "+bc.name)}return ha}},client:{configurable:!0,enumerable:!0,get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}}});ec.L2LCoreInterface=jb;var Pc=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");Pc.systemInterfaceNamed=Hc;Pc.interactivelyCreatePackage=
cb;Pc.interactivelyLoadPackage=Ab;Pc.interactivelyReloadPackage=Yb;Pc.interactivelyUnloadPackage=gc;Pc.interactivelyRemovePackage=dd;Pc.showExportsAndImportsOf=Zd;Pc.shortModuleName=Wb;Pc.interactivelyChangeModule=oc;Pc.interactivelyReloadModule=Lb;Pc.interactivelyUnloadModule=Bc;Pc.interactivelyRemoveModule=Sc;Pc.interactivelyAddModule=Yc;Pc.modulesInPackage=Xb;Pc.LocalCoreInterface=ib;Pc.HTTPCoreInterface=Ic;Pc.L2LCoreInterface=jb;jb=function(Q){this.coreInterface=Q};jb.prototype.dynamicCompletionsForPrefix=
function(Q,ha,Ha){return this.coreInterface.dynamicCompletionsForPrefix(Q,ha,Ha)};jb.prototype.runEval=function(Q,ha){return this.coreInterface.runEval(Q,ha)};jb.prototype.printSystemConfig=function(Q,ha,Ha){return this.coreInterface.printSystemConfig(Q,ha,Ha)};jb.prototype.getConfig=function(Q,ha,Ha){return this.coreInterface.getConfig(Q,ha,Ha)};jb.prototype.getPackages=function(Q){return this.coreInterface.getPackages(Q)};jb.prototype.getModules=function(Q,ha,Ha){return this.coreInterface.getModules(Q,
ha,Ha)};jb.prototype.getModule=function(Q,ha,Ha){return this.coreInterface.getModule(Q,ha,Ha)};jb.prototype.getPackage=function(Q,ha,Ha){return this.coreInterface.getPackage(Q,ha,Ha)};jb.prototype.getPackageForModule=function(Q,ha,Ha){return this.coreInterface.getPackageForModule(Q,ha,Ha)};jb.prototype.resourcesOfPackage=function(Q,ha){return this.coreInterface.resourcesOfPackage(Q,ha)};jb.prototype.systemConfChange=function(Q,ha,Ha){return this.coreInterface.systemConfChange(Q,ha,Ha)};jb.prototype.registerPackage=
function(Q){return this.coreInterface.registerPackage(Q)};jb.prototype.importPackage=function(Q){return this.coreInterface.importPackage(Q)};jb.prototype.removePackage=function(Q){return this.coreInterface.removePackage(Q)};jb.prototype.reloadPackage=function(Q){return this.coreInterface.reloadPackage(Q)};jb.prototype.packageConfChange=function(Q,ha){return this.coreInterface.packageConfChange(Q,ha)};jb.prototype.keyValueListOfVariablesInModule=function(Q,ha){return this.coreInterface.keyValueListOfVariablesInModule(Q,
ha)};jb.prototype.interactivelyCreatePackage=function(Q){return Pc.interactivelyCreatePackage(this.coreInterface,Q)};jb.prototype.interactivelyLoadPackage=function(Q,ha){return Pc.interactivelyLoadPackage(this.coreInterface,Q,ha)};jb.prototype.interactivelyReloadPackage=function(Q,ha){return Pc.interactivelyReloadPackage(this.coreInterface,Q,ha)};jb.prototype.interactivelyUnloadPackage=function(Q,ha,Ha){return Pc.interactivelyUnloadPackage(this.coreInterface,Q,ha,Ha)};jb.prototype.interactivelyRemovePackage=
function(Q,ha){return Pc.interactivelyRemovePackage(this.coreInterface,Q,ha)};jb.prototype.isModuleLoaded=function(Q,ha){return this.coreInterface.isModuleLoaded(Q,ha)};jb.prototype.doesModuleExist=function(Q,ha){return this.coreInterface.doesModuleExist(Q,ha)};jb.prototype.importModule=function(Q){return this.coreInterface.importModule(Q)};jb.prototype.forgetModule=function(Q,ha){return this.coreInterface.forgetModule(Q,ha)};jb.prototype.reloadModule=function(Q,ha){return this.coreInterface.reloadModule(Q,
ha)};jb.prototype.moduleFormat=function(Q){return this.coreInterface.moduleFormat(Q)};jb.prototype.moduleRead=function(Q){return this.coreInterface.moduleRead(Q)};jb.prototype.moduleWrite=function(Q,ha){return this.coreInterface.moduleWrite(Q,ha)};jb.prototype.getModulesInPackage=function(Q){return Pc.modulesInPackage(this.coreInterface,Q)};jb.prototype.shortModuleName=function(Q,ha){return Pc.shortModuleName(this.coreInterface,Q,ha)};jb.prototype.interactivelyChangeModule=function(Q,ha,Ha){return Pc.interactivelyChangeModule(this.coreInterface,
Q,ha,Ha)};jb.prototype.interactivelyReloadModule=function(Q,ha){return Pc.interactivelyReloadModule(this.coreInterface,Q,ha)};jb.prototype.interactivelyUnloadModule=function(Q,ha){return Pc.interactivelyUnloadModule(this.coreInterface,Q,ha)};jb.prototype.interactivelyRemoveModule=function(Q,ha){return Pc.interactivelyRemoveModule(this.coreInterface,Q,ha)};jb.prototype.interactivelyAddModule=function(Q,ha){return Pc.interactivelyAddModule(this.coreInterface,Q,ha)};jb.prototype.showExportsAndImportsOf=
function(Q,ha){return Pc.showExportsAndImportsOf(this.coreInterface,Q,ha)};jb.prototype.exportsOfModules=function(Q){return this.coreInterface.exportsOfModules(Q)};jb.prototype.searchInPackage=function(Q,ha,Ha){return this.coreInterface.searchInPackage(Q,ha,Ha)};jb.prototype.searchInAllPackages=function(Q,ha){ha=void 0===ha?{}:ha;var Ha=this,Pa,bc,ic,Ra,tc,Qd,md,$c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){switch(Wa.nextAddress){case 1:return(Pa=ha.progress)&&Pa.step("Fetching Packages...",
0),Wa.yield(Ha.coreInterface.getPackages({excluded:ha.excludedPackages}),2);case 2:bc=Wa.yieldResult,ic=[],Pa&&Pa.step("Fetching Packages...",.1),Ra=0;case 3:if(!(Ra<bc.length)){Wa.jumpTo(5);break}tc=bc[Ra];Qd=tc.url;if(!Qd||"no group"===Qd){Wa.jumpTo(4);break}Pa&&Pa.step(Qd.replace(System.baseURL,"").slice(0,20),.1+Ra/bc.length*.9);Wa.setCatchFinallyBlocks(6);return Wa.yield(Ha.coreInterface.searchInPackage(Qd,Q,ha),8);case 8:md=Wa.yieldResult;ic=ic.concat(md);Wa.leaveTryBlock(4);break;case 6:$c=
Wa.enterCatchBlock(),console.error("Error searching in package "+Qd+":\n"+$c.stack);case 4:Ra++;Wa.jumpTo(3);break;case 5:return Wa.return(ic)}})};jb.prototype.loadMochaTestFile=function(Q,ha){return this.coreInterface.loadMochaTestFile(Q,ha)};jb.prototype.runMochaTests=function(Q,ha,Ha,Pa){return this.coreInterface.runMochaTests(Q,ha,Ha,Pa)};$jscomp.global.Object.defineProperties(jb.prototype,{isSystemInterface:{configurable:!0,enumerable:!0,get:function(){return!0}},name:{configurable:!0,enumerable:!0,
get:function(){return this.coreInterface.name}}});Da("Interface",jb);Pc.Interface=jb;Pc.systemInterfaceNamed=Hc;Pc.systemInterfaceNamed=Hc;jb=Da("localInterface",new Pc.Interface(new Pc.LocalCoreInterface));Pc.localInterface=jb;Pc.localInterface=jb;Pc.localInterface=jb;Pc.httpInterfaces={};jb=Da("serverInterfaceFor",function(Q){return Pc.httpInterfaces[Q]||(Pc.httpInterfaces[Q]=new Pc.Interface(new Pc.HTTPCoreInterface(Q)))});Pc.serverInterfaceFor=jb;Pc.serverInterfaceFor=jb;Pc.serverInterfaceFor=
jb;Pc.l2lInterfaces={};jb=Da("l2lInterfaceFor",function(Q,ha){return Pc.l2lInterfaces[Q]||(Pc.l2lInterfaces[Q]=new Pc.Interface(new Pc.L2LCoreInterface(Q,ha)))});Pc.l2lInterfaceFor=jb;Pc.l2lInterfaceFor=jb;Pc.l2lInterfaceFor=jb}}});