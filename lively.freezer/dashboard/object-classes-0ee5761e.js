System.register(["./__root_module__-f418f9fd.js","lively.collab","kld-intersections"],function(Ha){var tb,Ab,kc,ac,Ld,Tc,$d,Uc,Pc,Jd,pe,Ze,Ff,te,Bc;return{setters:[function(sd){tb=sd.a7;Ab=sd.P;kc=sd.a6;ac=sd.p;Ld=sd.bG;Tc=sd.t;$d=sd.bH;Uc=sd.r;Pc=sd.bd;Jd=sd.bI;pe=sd.bJ;Ze=sd.bK;Ff=sd.bL;te=sd.bM;Bc=sd.l},function(){},function(){}],execute:function(){function sd(Dc,Mc,bc,Gc){Gc=void 0===Gc?{}:Gc;Gc=Gc.package||jc.ObjectPackage.lookupPackageForObject(Dc,Gc);if(!Gc)throw Error("Object is not part of an object package: "+
Dc);return Gc.addScript(Dc,Mc,bc)}function le(Dc,Mc){Mc=jc.normalizeOptions(Mc).System;Dc=(Dc=Dc[Symbol.for("lively-module-meta")])?Dc.package.name:null;return(Mc=(Dc?jc.lookupPackage(Mc,Dc):{}).pkg)?!!jc.ObjectPackage.forSystemPackage(Mc):!1}Ha({addScript:sd,isObjectClass:le});var jc=lively.FreezerRuntime.recorderFor("lively.classes/object-classes.js");jc.normalizeOptions=function(Dc){Dc=Object.assign({baseURL:jc.defaultBaseURL,System:System},Dc);Dc.baseURL=Dc.baseURL.replace(/\/$/,"");return Dc};
jc.addScript=sd;jc.isObjectClass=le;jc.string=tb;jc.Path=Ab;jc.arr=kc;jc.parse=ac;jc.isValidIdentifier=Ld;jc.stringify=Tc;jc.parseFunction=$d;jc.resource=Uc;jc.runEval=Pc;jc.scripting=Jd;jc.ExportLookup=pe;var je=jc.scripting;jc.ensurePackage=je.ensurePackage;jc.registerPackage=je.registerPackage;jc.importPackage=je.importPackage;jc.lookupPackage=je.lookupPackage;jc.module=je.module;jc.ImportInjector=je.ImportInjector;jc.RuntimeSourceDescriptor=Ze;jc.toJsIdentifier=Ff;jc.adoptObject=te;jc.classToFunctionTransform=
Bc;jc.objectPackageSym=Symbol.for("lively-object-package-data");jc.defaultBaseURL="local://lively-object-modules";jc.globalClasses=Object.keys(System.global).map(function(Dc){Dc=System.global[Dc];return"function"===typeof Dc&&Dc.name&&Dc}).filter(Boolean);jc.addScript=sd;jc.addScript=sd;jc.isObjectClass=le;jc.isObjectClass=le;jc._packageStore=jc._packageStore||{};je=function(Dc,Mc){this._id=Dc;this.options=jc.normalizeOptions(Mc)};je.lookupPackageForObject=function(Dc,Mc){return this.lookupPackageForClass(Dc.constructor,
Mc)};je.lookupPackageForClass=function(Dc,Mc){Mc=jc.normalizeOptions(Mc).System;Dc=(Dc=Dc[Symbol.for("lively-module-meta")])?Dc.package.name:null;return(Mc=(Dc?jc.lookupPackage(Mc,Dc):{}).pkg)?jc.ObjectPackage.forSystemPackage(Mc):null};je.forSystemPackage=function(Dc){return this.packageStore[Dc.name]};je.withId=function(Dc,Mc){return this.packageStore[Dc]||(this.packageStore[Dc]=new this(Dc,Mc))};je.prototype.ensureSubModule=function(Dc){Dc=void 0===Dc?"index":Dc;var Mc=this,bc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gc){return 1==
Gc.nextAddress?(bc=new jc.ObjectModule(Dc,Mc),Gc.yield(bc.ensureExistance(),2)):Gc.return(bc)})};je.prototype.resource=function(Dc){Dc=void 0===Dc?"":Dc;return jc.resource(this.packageURL).join(Dc)};je.prototype.load=function(){return jc.importPackage(this.System,this.packageURL)};je.prototype.ensureExistance=function(){var Dc=this,Mc,bc,Gc,Zc,Rd,Kd,rb,ob;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bb){switch(Bb.nextAddress){case 1:return Mc=Dc.resource("/"),Bb.yield(Mc.exists(),2);
case 2:if(Bb.yieldResult)return Bb.return();bc=[{resource:Mc}];Gc=[{resource:Dc.resource("package.json"),content:JSON.stringify(Dc.config,null,2)}];return Bb.yield(Promise.all(bc.map(function(Va){return Va.resource.mkdir()})),3);case 3:return Bb.yield(Promise.all(Gc.map(function(Va){var Ta;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){switch(xa.nextAddress){case 1:return xa.yield(Va.resource.exists(),2);case 2:if(!(Ta=!xa.yieldResult)){xa.jumpTo(3);break}return xa.yield(Va.resource.write(Va.content),
4);case 4:Ta=xa.yieldResult;case 3:return xa.return(Ta)}})})),4);case 4:return Bb.yield(Dc.objectModule.ensureExistance(),5);case 5:return Zc=Dc,Rd=Zc.System,Kd=Zc.packageURL,rb=Zc.config,Bb.yield(jc.ensurePackage(Rd,Kd),6);case 6:return ob=Bb.yieldResult,ob.registerWithConfig(rb),console.log(Dc.packageURL+" REGISTERED"),Bb.return(Dc)}})};je.prototype.ensureObjectClass=function(Dc){var Mc=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(bc){return 1==bc.nextAddress?bc.yield(Mc.ensureExistance(),
2):bc.return(Mc.objectModule.ensureObjectClass(Dc))})};je.prototype.adoptObject=function(Dc){var Mc=this,bc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gc){if(1==Gc.nextAddress)return Mc.objectClass===Dc.constructor?Gc.return():Gc.yield(Mc.ensureObjectClass(Dc.constructor),2);bc=Gc.yieldResult;jc.adoptObject(Dc,bc);Gc.jumpToEnd()})};je.prototype.addScript=function(Dc,Mc,bc){return this.objectModule.addScript(Dc,Mc,bc)};je.prototype.remove=function(){this.systemPackage.remove();delete jc.ObjectPackage.packageStore[this.id];
return this.resource().remove()};je.prototype.renameObjectClass=function(Dc,Mc){Mc=void 0===Mc?[]:Mc;var bc=this,Gc,Zc,Rd,Kd,rb,ob,Bb,Va,Ta,xa,wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){if(1==Qa.nextAddress){Gc=bc;Zc=Gc.objectClass;Rd=Gc.System;if(!Zc||Zc[Symbol.for("__LivelyClassName__")]===Dc)return Qa.return(Zc);if(!jc.isValidIdentifier(Dc))throw Error(Dc+" is not a valid name for a class");rb=Kd=jc.RuntimeSourceDescriptor.for(Zc,Rd);ob=rb.source;Bb=rb.ast;Va=Bb.id;Ta=Va.start;
xa=Va.end;return Qa.yield(Kd.changeSource(ob.slice(0,Ta)+Dc+ob.slice(xa)),2)}wa=bc.objectClass;Mc.forEach(function(Eb){Eb.constructor=wa;Eb.__proto__=wa.prototype});return Qa.return(wa)})};je.prototype.fork=function(Dc,Mc){var bc=this,Gc,Zc,Rd,Kd,rb,ob,Bb,Va,Ta,xa,wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){switch(Qa.nextAddress){case 1:return Gc=bc,Zc=Gc.System,Rd=Gc.baseURL,Kd=Gc.objectClass,Mc=Object.assign({System:Zc,baseURL:Rd},Mc),rb=jc.RuntimeSourceDescriptor.for(Kd),
ob=rb._renamedSource(Dc),Bb=ob.moduleSource,Va=jc.ObjectPackage.withId(Dc,Mc),Qa.yield(Va.ensureExistance(),2);case 2:return Ta=Va,xa=Ta.objectModule,wa=xa.systemModule,Qa.yield(wa.load({format:"esm"}),3);case 3:return Qa.yield(wa.changeSource(Bb),4);case 4:return Qa.return(Va)}})};$jscomp.global.Object.defineProperties(je.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return this._id}},name:{configurable:!0,enumerable:!0,get:function(){return this.id}},System:{configurable:!0,enumerable:!0,
get:function(){return this.options.System}},baseURL:{configurable:!0,enumerable:!0,get:function(){return this.options.baseURL}},packageURL:{configurable:!0,enumerable:!0,get:function(){return this.baseURL+("/"+this.id)}},config:{configurable:!0,enumerable:!0,get:function(){return{name:this.name,version:"0.1.0",lively:{isObjectPackage:!0}}}},systemPackage:{configurable:!0,enumerable:!0,get:function(){return jc.lookupPackage(this.System,this.packageURL,!0).pkg}},objectModule:{configurable:!0,enumerable:!0,
get:function(){return this._objectModule||(this._objectModule=new jc.ObjectModule("index.js",this))}},objectClass:{configurable:!0,enumerable:!0,get:function(){return this.objectModule.objectClass}}});$jscomp.global.Object.defineProperties(je,{packageStore:{configurable:!0,enumerable:!0,get:function(){return this._packageStore||(this._packageStore=jc._packageStore)}}});Ha("default",je);jc.ObjectPackage=je;var Ae=function(Dc,Mc){if(!Dc)throw Error("ObjectModule needs package!");if(!Mc)throw Error("ObjectModule needs package!");
this._moduleName=Dc;this._objectPackage=Mc};Ae.prototype.read=function(){return this.resource.read()};Ae.prototype.write=function(Dc){return this.resource.write(Dc)};Ae.prototype.ensureExistance=function(){var Dc=this,Mc,bc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gc){switch(Gc.nextAddress){case 1:return Mc=Dc.resource,Gc.yield(Mc.exists(),2);case 2:if(Gc.yieldResult){Gc.jumpTo(3);break}return Gc.yield(Mc.write("'format esm';\n"),4);case 4:bc={},Dc.System.config({meta:(bc[Dc.url]=
{format:"esm"},bc)});case 3:return Gc.return(Dc)}})};Ae.prototype.adoptObject=function(Dc){var Mc=this,bc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gc){if(1==Gc.nextAddress)return Mc.objectClass===Dc.constructor?Gc.return():Gc.yield(Mc.ensureObjectClass(Dc.constructor),2);bc=Gc.yieldResult;jc.adoptObject(Dc,bc);Gc.jumpToEnd()})};Ae.prototype.ensureObjectClass=function(Dc){var Mc=this,bc=this.objectClass;return bc&&bc.prototype.__proto__===Dc.prototype?bc:Promise.resolve(this.ensureObjectClassSource(Dc)).then(function(Gc){var Zc=
Gc.source,Rd=Gc.moduleId,Kd=Gc.className,rb=Gc.bindings,ob=Mc.System;Gc=jc.module(ob,Rd);if(rb)for(var Bb in rb)Gc.define(Bb,rb[Bb]);Zc=jc.runEval(Zc,{classTransform:jc.classToFunctionTransform,sync:!0,targetModule:Rd,System:ob});if(Zc.isError)throw Zc.value;Zc=Gc.recorder[Kd];if(!Zc)throw Error("Failed to define class "+Kd+" in "+Rd);return Zc})};Ae.prototype.ensureObjectClassSource=function(Dc){return this.createDefaultClassDeclaration(Dc)};Ae.prototype.createDefaultClassDeclaration=function(Dc){Dc=
void 0===Dc?Object:Dc;var Mc=this,bc,Gc,Zc,Rd,Kd,rb,ob,Bb,Va,Ta,xa,wa,Qa,Eb,rc,qb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sb){switch(sb.nextAddress){case 1:bc=Mc;Gc=bc.System;Zc=bc.systemModule;Rd=bc.objectPackage;Kd=jc.string.capitalize(jc.toJsIdentifier(Rd.id));rb=Dc[Symbol.for("__LivelyClassName__")];ob=!rb;Bb=jc.globalClasses.includes(Dc);Va="";Ta=null;if(ob){rb="__anonymous_superclass__";xa={};Ta=(xa[rb]=Dc,xa);sb.jumpTo(2);break}if(Bb){sb.jumpTo(2);break}return sb.yield(jc.ExportLookup.findExportOfValue(Dc,
Gc),4);case 4:(wa=sb.yieldResult)?(Qa=jc.ImportInjector.run(Gc,Zc.id,Zc.package(),"",wa),Eb=Qa.standaloneImport,Va+=Eb+"\n\n"):(rc={},Ta=(rc[rb]=Dc,rc));case 2:return Kd===rb&&(Kd="Object"+Kd),qb="Object"===rb?"class "+Kd+" {}\n":"class "+Kd+" extends "+rb+" {}\n",Va+="export default "+qb+"\n",sb.yield(Zc.changeSource(Va),5);case 5:return sb.yield(Zc.load(),6);case 6:return sb.return({source:Va,className:Kd,moduleId:Mc.url,bindings:Ta})}})};Ae.prototype.addScript=function(Dc,Mc,bc){var Gc=this,Zc,
Rd,Kd,rb,ob,Bb,Va,Ta,xa,wa,Qa,Eb,rc,qb,sb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kb){switch(kb.nextAddress){case 1:if(Dc.constructor===Gc.objectClass){Zc=Dc.constructor;kb.jumpTo(2);break}return kb.yield(Gc.ensureObjectClass(Dc.constructor),3);case 3:Zc=kb.yieldResult;case 2:Rd=Zc;Kd="function"===typeof Mc?String(Mc):Mc;rb=jc.parseFunction(Kd);ob=jc.RuntimeSourceDescriptor.for(Rd,Gc.System);bc||(bc=jc.Path("id.name").get(rb));if(!bc)throw Error("No name, cannot add "+jc.string.truncate(Kd,
30).replace(/\n/g,"")+"!");Bb=jc.toJsIdentifier(bc);console.assert("FunctionExpression"===rb.type||"ArrowFunctionExpression"===rb.type,"not a function expression but: "+rb.type);Va=rb.params.map(function(ha){return Kd.slice(ha.start,ha.end)});Ta="BlockStatement"===rb.body.type?Kd.slice(rb.body.start,rb.body.end):"{ return "+Kd.slice(rb.body.start,rb.body.end)+" }";xa=Bb+"("+Va.join(",")+") "+Ta;"ArrowFunctionExpression"===rb.type&&(rb.type="FunctionExpression");wa=ob.source;Qa=ob.ast;if(!Qa)throw Error("cannot find class decl of "+
ob.module.id);(Eb=Qa.body.body.find(function(ha){return ha.key.name===Bb&&!ha.static}))?wa=wa.slice(0,Eb.start)+xa+wa.slice(Eb.end):(rc=wa.lastIndexOf("}"),qb=wa.slice(0,rc),sb=wa.slice(rc),/\n\s*$/m.test(qb)||(qb+="\n"),xa=jc.string.changeIndent(xa,"  ",1),/^[ ]*\n/m.test(sb)||(sb="\n"+sb),wa=qb+xa+sb);return kb.yield(ob.changeSource(wa),4);case 4:return kb.return({script:Rd.prototype[Bb],klass:Rd,module:ob.module.id,methodName:Bb})}})};$jscomp.global.Object.defineProperties(Ae.prototype,{objectPackage:{configurable:!0,
enumerable:!0,get:function(){return this._objectPackage}},objectClass:{configurable:!0,enumerable:!0,get:function(){var Dc=this.systemModule;return Dc.isLoaded()?Dc.System.get(Dc.id).default:null}},moduleName:{configurable:!0,enumerable:!0,get:function(){return this._moduleName}},systemModule:{configurable:!0,enumerable:!0,get:function(){return jc.module(this.System,this.url)}},System:{configurable:!0,enumerable:!0,get:function(){return this.objectPackage.System}},resource:{configurable:!0,enumerable:!0,
get:function(){return this.objectPackage.resource(this.moduleName)}},url:{configurable:!0,enumerable:!0,get:function(){return this.resource.url}}});jc.ObjectModule=Ae;jc.default=je}}});