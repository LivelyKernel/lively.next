System.register(["./__root_module__-64e296ea.js","kld-intersections"],function(Ba){var Ab,Qb,dc,Xb,Xd,ad,Nd,dd,Lc,rd,Gd,ke,Kd,Hc,fb;return{setters:[function(Db){Ab=Db.s;Qb=Db.P;dc=Db.a6;Xb=Db.p;Xd=Db.bH;ad=Db.D;Nd=Db.bI;dd=Db.r;Lc=Db.aT;rd=Db.bJ;Gd=Db.bK;ke=Db.bL;Kd=Db.bM;Hc=Db.bN;fb=Db.n},function(){}],execute:function(){function Db(oc,pc,Nb,Dc){Dc=void 0===Dc?{}:Dc;Dc=Dc.package||hc.ObjectPackage.lookupPackageForObject(oc,Dc);if(!Dc)throw Error("Object is not part of an object package: "+oc);
return Dc.addScript(oc,pc,Nb)}function mc(oc,pc){pc=hc.normalizeOptions(pc).System;oc=(oc=oc[Symbol.for("lively-module-meta")])?oc.package.name:null;return(pc=(oc?hc.lookupPackage(pc,oc):{}).pkg)?!!hc.ObjectPackage.forSystemPackage(pc):!1}Ba({addScript:Db,isObjectClass:mc});var hc=lively.FreezerRuntime.recorderFor("lively.classes/object-classes.js");hc.normalizeOptions=function(oc){oc=Object.assign({baseURL:hc.defaultBaseURL,System:System},oc);oc.baseURL=oc.baseURL.replace(/\/$/,"");return oc};hc.addScript=
Db;hc.isObjectClass=mc;hc.string=Ab;hc.Path=Qb;hc.arr=dc;hc.parse=Xb;hc.isValidIdentifier=Xd;hc.stringify=ad;hc.parseFunction=Nd;hc.resource=dd;hc.runEval=Lc;hc.scripting=rd;hc.ExportLookup=Gd;var Tc=hc.scripting;hc.ensurePackage=Tc.ensurePackage;hc.registerPackage=Tc.registerPackage;hc.importPackage=Tc.importPackage;hc.lookupPackage=Tc.lookupPackage;hc.module=Tc.module;hc.ImportInjector=Tc.ImportInjector;hc.RuntimeSourceDescriptor=ke;hc.toJsIdentifier=Kd;hc.adoptObject=Hc;hc.classToFunctionTransform=
fb;hc.objectPackageSym=Symbol.for("lively-object-package-data");hc.defaultBaseURL="local://lively-object-modules";hc.globalClasses=Object.keys(System.global).map(function(oc){oc=System.global[oc];return"function"===typeof oc&&oc.name&&oc}).filter(Boolean);hc.addScript=Db;hc.addScript=Db;hc.isObjectClass=mc;hc.isObjectClass=mc;hc._packageStore=hc._packageStore||{};Tc=function(oc,pc){this._id=oc;this.options=hc.normalizeOptions(pc)};Tc.lookupPackageForObject=function(oc,pc){return this.lookupPackageForClass(oc.constructor,
pc)};Tc.lookupPackageForClass=function(oc,pc){pc=hc.normalizeOptions(pc).System;oc=(oc=oc[Symbol.for("lively-module-meta")])?oc.package.name:null;return(pc=(oc?hc.lookupPackage(pc,oc):{}).pkg)?hc.ObjectPackage.forSystemPackage(pc):null};Tc.forSystemPackage=function(oc){return this.packageStore[oc.name]};Tc.withId=function(oc,pc){return this.packageStore[oc]||(this.packageStore[oc]=new this(oc,pc))};Tc.prototype.resource=function(oc){oc=void 0===oc?"":oc;return hc.resource(this.packageURL).join(oc)};
Tc.prototype.load=function(){return hc.importPackage(this.System,this.packageURL)};Tc.prototype.ensureExistance=function(){var oc=this,pc,Nb,Dc,Vc,Hd,Id,rb,Hb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Mc){switch(Mc.nextAddress){case 1:return pc=oc.resource("/"),Mc.yield(pc.exists(),2);case 2:if(Mc.yieldResult)return Mc.return();Nb=[{resource:pc}];Dc=[{resource:oc.resource("package.json"),content:JSON.stringify(oc.config,null,2)}];return Mc.yield(Promise.all(Nb.map(function(qb){return qb.resource.mkdir()})),
3);case 3:return Mc.yield(Promise.all(Dc.map(function(qb){var tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){switch(eb.nextAddress){case 1:return eb.yield(qb.resource.exists(),2);case 2:if(!(tb=!eb.yieldResult)){eb.jumpTo(3);break}return eb.yield(qb.resource.write(qb.content),4);case 4:tb=eb.yieldResult;case 3:return eb.return(tb)}})})),4);case 4:return Mc.yield(oc.objectModule.ensureExistance(),5);case 5:return Vc=oc,Hd=Vc.System,Id=Vc.packageURL,rb=Vc.config,Mc.yield(hc.ensurePackage(Hd,
Id),6);case 6:return Hb=Mc.yieldResult,Hb.registerWithConfig(rb),console.log(oc.packageURL+" REGISTERED"),Mc.return(oc)}})};Tc.prototype.ensureObjectClass=function(oc){var pc=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){return 1==Nb.nextAddress?Nb.yield(pc.ensureExistance(),2):Nb.return(pc.objectModule.ensureObjectClass(oc))})};Tc.prototype.adoptObject=function(oc){var pc=this,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Dc){if(1==Dc.nextAddress)return pc.objectClass===
oc.constructor?Dc.return():Dc.yield(pc.ensureObjectClass(oc.constructor),2);Nb=Dc.yieldResult;hc.adoptObject(oc,Nb);Dc.jumpToEnd()})};Tc.prototype.addScript=function(oc,pc,Nb){return this.objectModule.addScript(oc,pc,Nb)};Tc.prototype.remove=function(){this.systemPackage.remove();delete hc.ObjectPackage.packageStore[this.id];return this.resource().remove()};Tc.prototype.renameObjectClass=function(oc,pc){pc=void 0===pc?[]:pc;var Nb=this,Dc,Vc,Hd,Id,rb,Hb,Mc,qb,tb,eb,ob;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wb){if(1==
wb.nextAddress){Dc=Nb;Vc=Dc.objectClass;Hd=Dc.System;if(!Vc||Vc[Symbol.for("__LivelyClassName__")]===oc)return wb.return(Vc);if(!hc.isValidIdentifier(oc))throw Error(oc+" is not a valid name for a class");rb=Id=hc.RuntimeSourceDescriptor.for(Vc,Hd);Hb=rb.source;Mc=rb.ast;qb=Mc.id;tb=qb.start;eb=qb.end;return wb.yield(Id.changeSource(Hb.slice(0,tb)+oc+Hb.slice(eb)),2)}ob=Nb.objectClass;pc.forEach(function(cb){cb.constructor=ob;cb.__proto__=ob.prototype});return wb.return(ob)})};Tc.prototype.fork=function(oc,
pc){var Nb=this,Dc,Vc,Hd,Id,rb,Hb,Mc,qb,tb,eb,ob;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wb){switch(wb.nextAddress){case 1:return Dc=Nb,Vc=Dc.System,Hd=Dc.baseURL,Id=Dc.objectClass,pc=Object.assign({System:Vc,baseURL:Hd},pc),rb=hc.RuntimeSourceDescriptor.for(Id),Hb=rb._renamedSource(oc),Mc=Hb.moduleSource,qb=hc.ObjectPackage.withId(oc,pc),wb.yield(qb.ensureExistance(),2);case 2:return tb=qb,eb=tb.objectModule,ob=eb.systemModule,wb.yield(ob.load({format:"esm"}),3);case 3:return wb.yield(ob.changeSource(Mc),
4);case 4:return wb.return(qb)}})};$jscomp.global.Object.defineProperties(Tc.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return this._id}},name:{configurable:!0,enumerable:!0,get:function(){return this.id}},System:{configurable:!0,enumerable:!0,get:function(){return this.options.System}},baseURL:{configurable:!0,enumerable:!0,get:function(){return this.options.baseURL}},packageURL:{configurable:!0,enumerable:!0,get:function(){return this.baseURL+("/"+this.id)}},config:{configurable:!0,
enumerable:!0,get:function(){return{name:this.name,version:"0.1.0",lively:{isObjectPackage:!0}}}},systemPackage:{configurable:!0,enumerable:!0,get:function(){return hc.lookupPackage(this.System,this.packageURL,!0).pkg}},objectModule:{configurable:!0,enumerable:!0,get:function(){return this._objectModule||(this._objectModule=new hc.ObjectModule("index.js",this))}},objectClass:{configurable:!0,enumerable:!0,get:function(){return this.objectModule.objectClass}}});$jscomp.global.Object.defineProperties(Tc,
{packageStore:{configurable:!0,enumerable:!0,get:function(){return this._packageStore||(this._packageStore=hc._packageStore)}}});Ba("default",Tc);hc.ObjectPackage=Tc;var Ld=function(oc,pc){if(!oc)throw Error("ObjectModule needs package!");if(!pc)throw Error("ObjectModule needs package!");this._moduleName=oc;this._objectPackage=pc};Ld.prototype.read=function(){return this.resource.read()};Ld.prototype.write=function(oc){return this.resource.write(oc)};Ld.prototype.ensureExistance=function(){var oc=
this,pc,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Dc){switch(Dc.nextAddress){case 1:return pc=oc.resource,Dc.yield(pc.exists(),2);case 2:if(Dc.yieldResult){Dc.jumpTo(3);break}return Dc.yield(pc.write("'format esm';\n"),4);case 4:Nb={},oc.System.config({meta:(Nb[oc.url]={format:"esm"},Nb)});case 3:return Dc.return(oc)}})};Ld.prototype.ensureObjectClass=function(oc){var pc=this,Nb=this.objectClass;return Nb&&Nb.prototype.__proto__===oc.prototype?Nb:Promise.resolve(this.ensureObjectClassSource(oc)).then(function(Dc){var Vc=
Dc.source,Hd=Dc.moduleId,Id=Dc.className,rb=Dc.bindings,Hb=pc.System;Dc=hc.module(Hb,Hd);if(rb)for(var Mc in rb)Dc.define(Mc,rb[Mc]);Vc=hc.runEval(Vc,{classTransform:hc.classToFunctionTransform,sync:!0,targetModule:Hd,System:Hb});if(Vc.isError)throw Vc.value;Vc=Dc.recorder[Id];if(!Vc)throw Error("Failed to define class "+Id+" in "+Hd);return Vc})};Ld.prototype.ensureObjectClassSource=function(oc){return this.createDefaultClassDeclaration(oc)};Ld.prototype.createDefaultClassDeclaration=function(oc){oc=
void 0===oc?Object:oc;var pc=this,Nb,Dc,Vc,Hd,Id,rb,Hb,Mc,qb,tb,eb,ob,wb,cb,Oa,Gb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sc){switch(sc.nextAddress){case 1:Nb=pc;Dc=Nb.System;Vc=Nb.systemModule;Hd=Nb.objectPackage;Id=hc.string.capitalize(hc.toJsIdentifier(Hd.id));rb=oc[Symbol.for("__LivelyClassName__")];Hb=!rb;Mc=hc.globalClasses.includes(oc);qb="";tb=null;if(Hb){rb="__anonymous_superclass__";eb={};tb=(eb[rb]=oc,eb);sc.jumpTo(2);break}if(Mc){sc.jumpTo(2);break}return sc.yield(hc.ExportLookup.findExportOfValue(oc,
Dc),4);case 4:(ob=sc.yieldResult)?(wb=hc.ImportInjector.run(Dc,Vc.id,Vc.package(),"",ob),cb=wb.standaloneImport,qb+=cb+"\n\n"):(Oa={},tb=(Oa[rb]=oc,Oa));case 2:return Id===rb&&(Id="Object"+Id),Gb="Object"===rb?"class "+Id+" {}\n":"class "+Id+" extends "+rb+" {}\n",qb+="export default "+Gb+"\n",sc.yield(Vc.changeSource(qb),5);case 5:return sc.yield(Vc.load(),6);case 6:return sc.return({source:qb,className:Id,moduleId:pc.url,bindings:tb})}})};Ld.prototype.addScript=function(oc,pc,Nb){var Dc=this,Vc,
Hd,Id,rb,Hb,Mc,qb,tb,eb,ob,wb,cb,Oa,Gb,sc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vc){switch(vc.nextAddress){case 1:if(oc.constructor===Dc.objectClass){Vc=oc.constructor;vc.jumpTo(2);break}return vc.yield(Dc.ensureObjectClass(oc.constructor),3);case 3:Vc=vc.yieldResult;case 2:Hd=Vc;Id="function"===typeof pc?String(pc):pc;rb=hc.parseFunction(Id);Hb=hc.RuntimeSourceDescriptor.for(Hd,Dc.System);Nb||(Nb=hc.Path("id.name").get(rb));if(!Nb)throw Error("No name, cannot add "+hc.string.truncate(Id,
30).replace(/\n/g,"")+"!");Mc=hc.toJsIdentifier(Nb);console.assert("FunctionExpression"===rb.type||"ArrowFunctionExpression"===rb.type,"not a function expression but: "+rb.type);qb=rb.params.map(function(fc){return Id.slice(fc.start,fc.end)});tb="BlockStatement"===rb.body.type?Id.slice(rb.body.start,rb.body.end):"{ return "+Id.slice(rb.body.start,rb.body.end)+" }";eb=Mc+"("+qb.join(",")+") "+tb;"ArrowFunctionExpression"===rb.type&&(rb.type="FunctionExpression");ob=Hb.source;wb=Hb.ast;if(!wb)throw Error("cannot find class decl of "+
Hb.module.id);(cb=wb.body.body.find(function(fc){return fc.key.name===Mc&&!fc.static}))?ob=ob.slice(0,cb.start)+eb+ob.slice(cb.end):(Oa=ob.lastIndexOf("}"),Gb=ob.slice(0,Oa),sc=ob.slice(Oa),/\n\s*$/m.test(Gb)||(Gb+="\n"),eb=hc.string.changeIndent(eb,"  ",1),/^[ ]*\n/m.test(sc)||(sc="\n"+sc),ob=Gb+eb+sc);return vc.yield(Hb.changeSource(ob),4);case 4:return vc.return({script:Hd.prototype[Mc],klass:Hd,module:Hb.module.id,methodName:Mc})}})};$jscomp.global.Object.defineProperties(Ld.prototype,{objectPackage:{configurable:!0,
enumerable:!0,get:function(){return this._objectPackage}},objectClass:{configurable:!0,enumerable:!0,get:function(){var oc=this.systemModule;return oc.isLoaded()?oc.System.get(oc.id).default:null}},moduleName:{configurable:!0,enumerable:!0,get:function(){return this._moduleName}},systemModule:{configurable:!0,enumerable:!0,get:function(){return hc.module(this.System,this.url)}},System:{configurable:!0,enumerable:!0,get:function(){return this.objectPackage.System}},resource:{configurable:!0,enumerable:!0,
get:function(){return this.objectPackage.resource(this.moduleName)}},url:{configurable:!0,enumerable:!0,get:function(){return this.resource.url}}});hc.ObjectModule=Ld;hc.default=Tc}}});