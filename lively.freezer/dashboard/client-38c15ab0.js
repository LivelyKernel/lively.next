System.register(["./__root_module__-cd530690.js","kld-intersections"],function(Da){var zb,Rb,kc,dc,ke,hd,$d,md;return{setters:[function(Qc){zb=Qc.s;Rb=Qc._;kc=Qc.bk;dc=Qc.bl;ke=Qc.as;hd=Qc.a6;$d=Qc.bm;md=Qc.ao},function(){}],execute:function(){function Qc(){function Ba(tb,Db){var yc={};Db.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(sd,pd,nc){pd&&(yc[pd]=nc)});return yc}if(pb)return Rc;pb=!0;var rb=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
Bb="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");return Rc=function(tb){var Db=tb,yc=tb.indexOf("["),sd=tb.indexOf("]");-1!=yc&&-1!=sd&&(tb=tb.substring(0,yc)+tb.substring(yc,sd).replace(/:/g,";")+tb.substring(sd,tb.length));var pd=rb.exec(tb||"");tb={};for(var nc=14;nc--;)tb[Bb[nc]]=pd[nc]||"";-1!=yc&&-1!=sd&&(tb.source=Db,tb.host=tb.host.substring(1,tb.host.length-1).replace(/;/g,":"),tb.authority=tb.authority.replace("[","").replace("]",
"").replace(/;/g,":"),tb.ipv6uri=!0);Db=tb.path;yc=Db.replace(/\/{2,9}/g,"/").split("/");"/"!=Db.substr(0,1)&&0!==Db.length||yc.splice(0,1);"/"==Db.substr(Db.length-1,1)&&yc.splice(yc.length-1,1);tb.pathNames=yc;tb.queryKey=Ba(tb,tb.query);return tb}}function xd(){function Ba(Db){Db=String(Db);if(!(100<Db.length)&&(Db=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(Db))){var yc=parseFloat(Db[1]);switch((Db[2]||"ms").toLowerCase()){case "years":case "year":case "yrs":case "yr":case "y":return yc*
tb;case "days":case "day":case "d":return yc*Bb;case "hours":case "hour":case "hrs":case "hr":case "h":return 36E5*yc;case "minutes":case "minute":case "mins":case "min":case "m":return 6E4*yc;case "seconds":case "second":case "secs":case "sec":case "s":return 1E3*yc;case "milliseconds":case "millisecond":case "msecs":case "msec":case "ms":return yc}}}function rb(Db,yc,sd){if(!(Db<yc))return Db<1.5*yc?Math.floor(Db/yc)+" "+sd:Math.ceil(Db/yc)+" "+sd+"s"}if(hb)return eb;hb=!0;var Bb=864E5,tb=365.25*
Bb;return eb=function(Db,yc){yc=yc||{};var sd=typeof Db;if("string"===sd&&0<Db.length)return Ba(Db);if("number"===sd&&!1===isNaN(Db))return yc.long?rb(Db,Bb,"day")||rb(Db,36E5,"hour")||rb(Db,6E4,"minute")||rb(Db,1E3,"second")||Db+" ms":Db>=Bb?Math.round(Db/Bb)+"d":36E5<=Db?Math.round(Db/36E5)+"h":6E4<=Db?Math.round(Db/6E4)+"m":1E3<=Db?Math.round(Db/1E3)+"s":Db+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(Db));}}function Od(){function Ba(tb){var Db=0,yc;for(yc in tb)Db=
(Db<<5)-Db+tb.charCodeAt(yc),Db|=0;return ac.colors[Math.abs(Db)%ac.colors.length]}function rb(tb){function Db(){if(Db.enabled){var sd=+new Date;Db.diff=sd-(yc||sd);Db.prev=yc;yc=Db.curr=sd;var pd=Array(arguments.length);for(sd=0;sd<pd.length;sd++)pd[sd]=arguments[sd];pd[0]=ac.coerce(pd[0]);"string"!==typeof pd[0]&&pd.unshift("%O");var nc=0;pd[0]=pd[0].replace(/%([a-zA-Z%])/g,function(jc,Oc){if("%%"===jc)return jc;nc++;Oc=ac.formatters[Oc];"function"===typeof Oc&&(jc=Oc.call(Db,pd[nc]),pd.splice(nc,
1),nc--);return jc});ac.formatArgs.call(Db,pd);(Db.log||ac.log||console.log.bind(console)).apply(Db,pd)}}var yc;Db.namespace=tb;Db.enabled=ac.enabled(tb);Db.useColors=ac.useColors();Db.color=Ba(tb);Db.destroy=Bb;"function"===typeof ac.init&&ac.init(Db);ac.instances.push(Db);return Db}function Bb(){var tb=ac.instances.indexOf(this||Fd);return-1!==tb?(ac.instances.splice(tb,1),!0):!1}if(Wb)return ac;Wb=!0;ac=ac=rb.debug=rb["default"]=rb;ac.coerce=function(tb){return tb instanceof Error?tb.stack||tb.message:
tb};ac.disable=function(){ac.enable("")};ac.enable=function(tb){ac.save(tb);ac.names=[];ac.skips=[];var Db,yc=("string"===typeof tb?tb:"").split(/[\s,]+/),sd=yc.length;for(Db=0;Db<sd;Db++)yc[Db]&&(tb=yc[Db].replace(/\*/g,".*?"),"-"===tb[0]?ac.skips.push(new RegExp("^"+tb.substr(1)+"$")):ac.names.push(new RegExp("^"+tb+"$")));for(Db=0;Db<ac.instances.length;Db++)tb=ac.instances[Db],tb.enabled=ac.enabled(tb.namespace)};ac.enabled=function(tb){if("*"===tb[tb.length-1])return!0;var Db;var yc=0;for(Db=
ac.skips.length;yc<Db;yc++)if(ac.skips[yc].test(tb))return!1;yc=0;for(Db=ac.names.length;yc<Db;yc++)if(ac.names[yc].test(tb))return!0;return!1};ac.humanize=xd();ac.instances=[];ac.names=[];ac.skips=[];ac.formatters={};return ac}function ge(){function Ba(){try{var Db=Be.storage.debug}catch(yc){}!Db&&"undefined"!==typeof rb&&"env"in rb&&(Db=rb.env.DEBUG);return Db}if(Ie)return Be;Ie=!0;var rb=kc;Be=Be=Od();Be.log=function(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,
console,arguments)};Be.formatArgs=function(Db){var yc=(this||Lf).useColors;Db[0]=(yc?"%c":"")+(this||Lf).namespace+(yc?" %c":" ")+Db[0]+(yc?"%c ":" ")+"+"+Be.humanize((this||Lf).diff);if(yc){yc="color: "+(this||Lf).color;Db.splice(1,0,yc,"color: inherit");var sd=0,pd=0;Db[0].replace(/%[a-zA-Z%]/g,function(nc){"%%"!==nc&&(sd++,"%c"===nc&&(pd=sd))});Db.splice(pd,0,yc)}};Be.save=function(Db){try{null==Db?Be.storage.removeItem("debug"):Be.storage.debug=Db}catch(yc){}};Be.load=Ba;Be.useColors=function(){return"undefined"!==
typeof window&&window.process&&"renderer"===window.process.type?!0:"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:"undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&
31<=parseInt(RegExp.$1,10)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)};var Bb=Be;if("undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage)var tb=chrome.storage.local;else a:{try{tb=window.localStorage;break a}catch(Db){}tb=void 0}Bb.storage=tb;Be.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" ");
Be.formatters.j=function(Db){try{return JSON.stringify(Db)}catch(yc){return"[UnexpectedJSONParseError]: "+yc.message}};Be.enable(Ba());return Be}function Ud(){if(ue)return fd;ue=!0;var Ba=Qc(),rb=ge()("socket.io-client:url");return fd=function(Bb,tb){var Db=Bb;tb=tb||"undefined"!==typeof location&&location;null==Bb&&(Bb=tb.protocol+"//"+tb.host);"string"===typeof Bb&&("/"===Bb.charAt(0)&&(Bb="/"===Bb.charAt(1)?tb.protocol+Bb:tb.host+Bb),/^(https?|wss?):\/\//.test(Bb)||(rb("protocol-less url %s",Bb),
Bb="undefined"!==typeof tb?tb.protocol+"//"+Bb:"https://"+Bb),rb("parse %s",Bb),Db=Ba(Bb));Db.port||(/^(http|ws)$/.test(Db.protocol)?Db.port="80":/^(http|ws)s$/.test(Db.protocol)&&(Db.port="443"));Db.path=Db.path||"/";Bb=-1!==Db.host.indexOf(":")?"["+Db.host+"]":Db.host;Db.id=Db.protocol+"://"+Bb+":"+Db.port;Db.href=Db.protocol+"://"+Bb+(tb&&tb.port===Db.port?"":":"+Db.port);return Db}}function nd(){function Ba(rb){if(rb){for(var Bb in Ba.prototype)rb[Bb]=Ba.prototype[Bb];return rb}}if(Vb)return Md;
Vb=!0;Md=Ba;Ba.prototype.on=Ba.prototype.addEventListener=function(rb,Bb){(this||sa)._callbacks=(this||sa)._callbacks||{};((this||sa)._callbacks["$"+rb]=(this||sa)._callbacks["$"+rb]||[]).push(Bb);return this||sa};Ba.prototype.once=function(rb,Bb){function tb(){this.off(rb,tb);Bb.apply(this||sa,arguments)}tb.fn=Bb;this.on(rb,tb);return this||sa};Ba.prototype.off=Ba.prototype.removeListener=Ba.prototype.removeAllListeners=Ba.prototype.removeEventListener=function(rb,Bb){(this||sa)._callbacks=(this||
sa)._callbacks||{};if(0==arguments.length)return(this||sa)._callbacks={},this||sa;var tb=(this||sa)._callbacks["$"+rb];if(!tb)return this||sa;if(1==arguments.length)return delete (this||sa)._callbacks["$"+rb],this||sa;for(var Db,yc=0;yc<tb.length;yc++)if(Db=tb[yc],Db===Bb||Db.fn===Bb){tb.splice(yc,1);break}0===tb.length&&delete (this||sa)._callbacks["$"+rb];return this||sa};Ba.prototype.emit=function(rb){(this||sa)._callbacks=(this||sa)._callbacks||{};for(var Bb=Array(arguments.length-1),tb=(this||
sa)._callbacks["$"+rb],Db=1;Db<arguments.length;Db++)Bb[Db-1]=arguments[Db];if(tb){tb=tb.slice(0);Db=0;for(var yc=tb.length;Db<yc;++Db)tb[Db].apply(this||sa,Bb)}return this||sa};Ba.prototype.listeners=function(rb){(this||sa)._callbacks=(this||sa)._callbacks||{};return(this||sa)._callbacks["$"+rb]||[]};Ba.prototype.hasListeners=function(rb){return!!this.listeners(rb).length};return Md}function Za(){if(Kb)return Aa;Kb=!0;var Ba={}.toString;return Aa=Array.isArray||function(rb){return"[object Array]"==
Ba.call(rb)}}function Cb(){if(wa)return P;wa=!0;var Ba=dc.Buffer;P=function(tb){var Db;!(Db=rb&&Ba.isBuffer(tb))&&(Db=Bb)&&((Db=tb instanceof ArrayBuffer)||(Db="function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(tb):tb.buffer instanceof ArrayBuffer));return Db};var rb="function"===typeof Ba&&"function"===typeof Ba.isBuffer,Bb="function"===typeof ArrayBuffer;return P}function bc(){function Ba(pd,nc){if(!pd)return pd;if(tb(pd)){var jc={_placeholder:!0,num:nc.length};nc.push(pd);return jc}if(Bb(pd)){jc=
Array(pd.length);for(var Oc=0;Oc<pd.length;Oc++)jc[Oc]=Ba(pd[Oc],nc);return jc}if("object"===typeof pd&&!(pd instanceof Date)){jc={};for(Oc in pd)jc[Oc]=Ba(pd[Oc],nc);return jc}return pd}function rb(pd,nc){if(!pd)return pd;if(pd&&pd._placeholder)return nc[pd.num];if(Bb(pd))for(var jc=0;jc<pd.length;jc++)pd[jc]=rb(pd[jc],nc);else if("object"===typeof pd)for(jc in pd)pd[jc]=rb(pd[jc],nc);return pd}if(Hb)return Pa;Hb=!0;var Bb=Za(),tb=Cb(),Db=Object.prototype.toString,yc="function"===typeof Blob||"undefined"!==
typeof Blob&&"[object BlobConstructor]"===Db.call(Blob),sd="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===Db.call(File);Pa.deconstructPacket=function(pd){var nc=[];pd.data=Ba(pd.data,nc);pd.attachments=nc.length;return{packet:pd,buffers:nc}};Pa.reconstructPacket=function(pd,nc){pd.data=rb(pd.data,nc);pd.attachments=void 0;return pd};Pa.removeBlobs=function(pd,nc){function jc(ld,ne,bf){if(!ld)return ld;if(yc&&ld instanceof Blob||sd&&ld instanceof File){Oc++;var ee=
new FileReader;ee.onload=function(){bf?bf[ne]=(this||Nc).result:vb=(this||Nc).result;--Oc||nc(vb)};ee.readAsArrayBuffer(ld)}else if(Bb(ld))for(ee=0;ee<ld.length;ee++)jc(ld[ee],ee,ld);else if("object"===typeof ld&&!tb(ld))for(ee in ld)jc(ld[ee],ee,ld)}var Oc=0,vb=pd;jc(vb);Oc||nc(vb)};return Pa}function ic(){function Ba(){}function rb(vb){var ld=""+vb.type;if(Wc.BINARY_EVENT===vb.type||Wc.BINARY_ACK===vb.type)ld+=vb.attachments+"-";vb.nsp&&"/"!==vb.nsp&&(ld+=vb.nsp+",");null!=vb.id&&(ld+=vb.id);if(null!=
vb.data){try{var ne=JSON.stringify(vb.data)}catch(bf){ne=!1}if(!1!==ne)ld+=ne;else return Oc}yc("encoded %j as %s",vb,ld);return ld}function Bb(vb,ld){pd.removeBlobs(vb,function(ne){var bf=pd.deconstructPacket(ne);ne=rb(bf.packet);bf=bf.buffers;bf.unshift(ne);ld(bf)})}function tb(){(this||Rd).reconstructor=null}function Db(vb){(this||Rd).reconPack=vb;(this||Rd).buffers=[]}if(le)return Wc;le=!0;var yc=ge()("socket.io-parser"),sd=nd(),pd=bc(),nc=Za(),jc=Cb();Wc.protocol=4;Wc.types="CONNECT DISCONNECT EVENT ACK ERROR BINARY_EVENT BINARY_ACK".split(" ");
Wc.CONNECT=0;Wc.DISCONNECT=1;Wc.EVENT=2;Wc.ACK=3;Wc.ERROR=4;Wc.BINARY_EVENT=5;Wc.BINARY_ACK=6;Wc.Encoder=Ba;Wc.Decoder=tb;var Oc=Wc.ERROR+'"encode error"';Ba.prototype.encode=function(vb,ld){yc("encoding packet %j",vb);Wc.BINARY_EVENT===vb.type||Wc.BINARY_ACK===vb.type?Bb(vb,ld):(vb=rb(vb),ld([vb]))};sd(tb.prototype);tb.prototype.add=function(vb){if("string"===typeof vb){a:{var ld=0,ne={type:Number(vb.charAt(0))};if(null==Wc.types[ne.type])vb={type:Wc.ERROR,data:"parser error: unknown packet type "+
ne.type};else{if(Wc.BINARY_EVENT===ne.type||Wc.BINARY_ACK===ne.type){for(var bf="";"-"!==vb.charAt(++ld)&&(bf+=vb.charAt(ld),ld!=vb.length););if(bf!=Number(bf)||"-"!==vb.charAt(ld))throw Error("Illegal attachments");ne.attachments=Number(bf)}if("/"===vb.charAt(ld+1))for(ne.nsp="";++ld;){bf=vb.charAt(ld);if(","===bf)break;ne.nsp+=bf;if(ld===vb.length)break}else ne.nsp="/";bf=vb.charAt(ld+1);if(""!==bf&&Number(bf)==bf){for(ne.id="";++ld;){bf=vb.charAt(ld);if(null==bf||Number(bf)!=bf){--ld;break}ne.id+=
vb.charAt(ld);if(ld===vb.length)break}ne.id=Number(ne.id)}if(vb.charAt(++ld)){ld=vb.substr(ld);try{var ee=JSON.parse(ld)}catch(Re){ee=!1}if(!1===ee||ne.type!==Wc.ERROR&&!nc(ee)){vb={type:Wc.ERROR,data:"parser error: invalid payload"};break a}else ne.data=ee}yc("decoded %s as %j",vb,ne);vb=ne}}Wc.BINARY_EVENT===vb.type||Wc.BINARY_ACK===vb.type?((this||Rd).reconstructor=new Db(vb),0===(this||Rd).reconstructor.reconPack.attachments&&this.emit("decoded",vb)):this.emit("decoded",vb)}else if(jc(vb)||vb.base64)if((this||
Rd).reconstructor){if(vb=(this||Rd).reconstructor.takeBinaryData(vb))(this||Rd).reconstructor=null,this.emit("decoded",vb)}else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+vb);};tb.prototype.destroy=function(){(this||Rd).reconstructor&&(this||Rd).reconstructor.finishedReconstruction()};Db.prototype.takeBinaryData=function(vb){(this||Rd).buffers.push(vb);return(this||Rd).buffers.length===(this||Rd).reconPack.attachments?(vb=pd.reconstructPacket((this||
Rd).reconPack,(this||Rd).buffers),this.finishedReconstruction(),vb):null};Db.prototype.finishedReconstruction=function(){(this||Rd).reconPack=null;(this||Rd).buffers=[]};return Wc}function id(){if(Mf)return we;Mf=!0;return we="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")()}function fe(){if(rg)return Bf;rg=!0;if(!ce){ce=!0;try{jf="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Bb){jf=!1}}var Ba=jf;var rb=id();return Bf=function(Bb){var tb=
Bb.xdomain,Db=Bb.xscheme;Bb=Bb.enablesXDR;try{if("undefined"!==typeof XMLHttpRequest&&(!tb||Ba))return new XMLHttpRequest}catch(yc){}try{if("undefined"!==typeof XDomainRequest&&!Db&&Bb)return new XDomainRequest}catch(yc){}if(!tb)try{return new (rb[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(yc){}}}function Zb(){if(Vc)return Qf;Vc=!0;return Qf=Object.keys||function(Ba){var rb=[],Bb=Object.prototype.hasOwnProperty,tb;for(tb in Ba)Bb.call(Ba,tb)&&rb.push(tb);return rb}}function rc(){function Ba(sd){if(!sd||
"object"!==typeof sd)return!1;if(Bb(sd)){for(var pd=0,nc=sd.length;pd<nc;pd++)if(Ba(sd[pd]))return!0;return!1}if("function"===typeof rb&&rb.isBuffer&&rb.isBuffer(sd)||"function"===typeof ArrayBuffer&&sd instanceof ArrayBuffer||Db&&sd instanceof Blob||yc&&sd instanceof File)return!0;if(sd.toJSON&&"function"===typeof sd.toJSON&&1===arguments.length)return Ba(sd.toJSON(),!0);for(pd in sd)if(Object.prototype.hasOwnProperty.call(sd,pd)&&Ba(sd[pd]))return!0;return!1}if(Fg)return Rf;Fg=!0;var rb=dc.Buffer,
Bb=Za(),tb=Object.prototype.toString,Db="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===tb.call(Blob),yc="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===tb.call(File);return Rf=Ba}function Lb(){if(qf)return Hg;qf=!0;return Hg=function(Ba,rb,Bb){var tb=Ba.byteLength;rb=rb||0;Bb=Bb||tb;if(Ba.slice)return Ba.slice(rb,Bb);0>rb&&(rb+=tb);0>Bb&&(Bb+=tb);Bb>tb&&(Bb=tb);if(rb>=tb||rb>=Bb||0===tb)return new ArrayBuffer(0);Ba=new Uint8Array(Ba);
tb=new Uint8Array(Bb-rb);for(var Db=0;rb<Bb;rb++,Db++)tb[Db]=Ba[rb];return tb.buffer}}function Gc(){function Ba(){}if(bb)return Ga;bb=!0;return Ga=function(rb,Bb,tb){function Db(sd,pd){if(0>=Db.count)throw Error("after called too many times");--Db.count;sd?(yc=!0,Bb(sd),Bb=tb):0!==Db.count||yc||Bb(null,pd)}var yc=!1;tb=tb||Ba;Db.count=rb;return 0===rb?Bb():Db}}function $c(){function Ba(nc){for(var jc=[],Oc=0,vb=nc.length,ld,ne;Oc<vb;)ld=nc.charCodeAt(Oc++),55296<=ld&&56319>=ld&&Oc<vb?(ne=nc.charCodeAt(Oc++),
56320==(ne&64512)?jc.push(((ld&1023)<<10)+(ne&1023)+65536):(jc.push(ld),Oc--)):jc.push(ld);return jc}function rb(nc,jc){if(55296<=nc&&57343>=nc){if(jc)throw Error("Lone surrogate U+"+nc.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function Bb(){if(pd>=sd)throw Error("Invalid byte index");var nc=yc[pd]&255;pd++;if(128==(nc&192))return nc&63;throw Error("Invalid continuation byte");}function tb(nc){if(pd>sd)throw Error("Invalid byte index");if(pd==sd)return!1;var jc=yc[pd]&
255;pd++;if(0==(jc&128))return jc;if(192==(jc&224)){var Oc=Bb();jc=(jc&31)<<6|Oc;if(128<=jc)return jc;throw Error("Invalid continuation byte");}if(224==(jc&240)){Oc=Bb();var vb=Bb();jc=(jc&15)<<12|Oc<<6|vb;if(2048<=jc)return rb(jc,nc)?jc:65533;throw Error("Invalid continuation byte");}if(240==(jc&248)&&(Oc=Bb(),vb=Bb(),nc=Bb(),jc=(jc&7)<<18|Oc<<12|vb<<6|nc,65536<=jc&&1114111>=jc))return jc;throw Error("Invalid UTF-8 detected");}if(ba)return Gb;ba=!0;var Db=String.fromCharCode,yc,sd,pd;return Gb={version:"2.1.2",
encode:function(nc,jc){jc=jc||{};jc=!1!==jc.strict;nc=Ba(nc);for(var Oc=nc.length,vb=-1,ld,ne="";++vb<Oc;){ld=nc[vb];var bf=jc;if(0==(ld&4294967168))ld=Db(ld);else{var ee="";0==(ld&4294965248)?ee=Db(ld>>6&31|192):0==(ld&4294901760)?(rb(ld,bf)||(ld=65533),ee=Db(ld>>12&15|224),ee+=Db(ld>>6&63|128)):0==(ld&4292870144)&&(ee=Db(ld>>18&7|240),ee+=Db(ld>>12&63|128),ee+=Db(ld>>6&63|128));ld=ee+=Db(ld&63|128)}ne+=ld}return ne},decode:function(nc,jc){jc=jc||{};jc=!1!==jc.strict;yc=Ba(nc);sd=yc.length;pd=0;
nc=[];for(var Oc;!1!==(Oc=tb(jc));)nc.push(Oc);jc=nc.length;Oc=-1;for(var vb,ld="";++Oc<jc;)vb=nc[Oc],65535<vb&&(vb-=65536,ld+=Db(vb>>>10&1023|55296),vb=56320|vb&1023),ld+=Db(vb);return ld}}}function ed(){if(nb)return Ia;nb=!0;(function(Ba){Ia.encode=function(rb){rb=new Uint8Array(rb);var Bb,tb=rb.length,Db="";for(Bb=0;Bb<tb;Bb+=3)Db+=Ba[rb[Bb]>>2],Db+=Ba[(rb[Bb]&3)<<4|rb[Bb+1]>>4],Db+=Ba[(rb[Bb+1]&15)<<2|rb[Bb+2]>>6],Db+=Ba[rb[Bb+2]&63];2===tb%3?Db=Db.substring(0,Db.length-1)+"=":1===tb%3&&(Db=Db.substring(0,
Db.length-2)+"==");return Db};Ia.decode=function(rb){var Bb=.75*rb.length,tb=rb.length,Db=0;"="===rb[rb.length-1]&&(Bb--,"="===rb[rb.length-2]&&Bb--);var yc=new ArrayBuffer(Bb),sd=new Uint8Array(yc);for(Bb=0;Bb<tb;Bb+=4){var pd=Ba.indexOf(rb[Bb]);var nc=Ba.indexOf(rb[Bb+1]);var jc=Ba.indexOf(rb[Bb+2]);var Oc=Ba.indexOf(rb[Bb+3]);sd[Db++]=pd<<2|nc>>4;sd[Db++]=(nc&15)<<4|jc>>2;sd[Db++]=(jc&3)<<6|Oc&63}return yc}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/");return Ia}function $b(){function Ba(pd){return pd.map(function(nc){if(nc.buffer instanceof
ArrayBuffer){var jc=nc.buffer;if(nc.byteLength!==jc.byteLength){var Oc=new Uint8Array(nc.byteLength);Oc.set(new Uint8Array(jc,nc.byteOffset,nc.byteLength));jc=Oc.buffer}return jc}return nc})}function rb(pd,nc){nc=nc||{};var jc=new tb;Ba(pd).forEach(function(Oc){jc.append(Oc)});return nc.type?jc.getBlob(nc.type):jc.getBlob()}function Bb(pd,nc){return new Blob(Ba(pd),nc||{})}if(Ic)return xb;Ic=!0;var tb="undefined"!==typeof tb?tb:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!==
typeof MSBlobBuilder?MSBlobBuilder:"undefined"!==typeof MozBlobBuilder?MozBlobBuilder:!1;try{var Db=2===(new Blob(["hi"])).size}catch(pd){Db=!1}var yc;if(yc=Db)try{yc=2===(new Blob([new Uint8Array([1,2])])).size}catch(pd){yc=!1}var sd=tb&&tb.prototype.append&&tb.prototype.getBlob;"undefined"!==typeof Blob&&(rb.prototype=Blob.prototype,Bb.prototype=Blob.prototype);xb=Db?yc?Blob:Bb:sd?rb:void 0;return xb}function ob(){function Ba(ee,Re,kf){if(!Re)return wc.encodeBase64Packet(ee,kf);var Hf=new FileReader;
Hf.onload=function(){wc.encodePacket({type:ee.type,data:Hf.result},Re,!0,kf)};return Hf.readAsArrayBuffer(ee.data)}function rb(ee,Re,kf){var Hf=Array(ee.length);kf=yc(ee.length,kf);for(var Af=function(Ug,kh,Lj){Re(kh,function(ra,Oa){Hf[Ug]=Oa;Lj(ra,Hf)})},yg=0;yg<ee.length;yg++)Af(yg,ee[yg],kf)}if(Dd)return wc;Dd=!0;var Bb=Zb(),tb=rc(),Db=Lb(),yc=Gc(),sd=$c(),pd;"undefined"!==typeof ArrayBuffer&&(pd=ed());var nc="undefined"!==typeof navigator&&/Android/i.test(navigator.userAgent),jc="undefined"!==
typeof navigator&&/PhantomJS/i.test(navigator.userAgent),Oc=nc||jc;wc.protocol=3;var vb=wc.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},ld=Bb(vb),ne={type:"error",data:"parser error"},bf=$b();wc.encodePacket=function(ee,Re,kf,Hf){"function"===typeof Re&&(Hf=Re,Re=!1);"function"===typeof kf&&(Hf=kf,kf=null);var Af=void 0===ee.data?void 0:ee.data.buffer||ee.data;if("undefined"!==typeof ArrayBuffer&&Af instanceof ArrayBuffer){if(Re){kf=ee.data;Re=new Uint8Array(kf);kf=new Uint8Array(1+
kf.byteLength);kf[0]=vb[ee.type];for(ee=0;ee<Re.length;ee++)kf[ee+1]=Re[ee];ee=Hf(kf.buffer)}else ee=wc.encodeBase64Packet(ee,Hf);return ee}if("undefined"!==typeof bf&&Af instanceof bf)return Re?Oc?ee=Ba(ee,Re,Hf):(Re=new Uint8Array(1),Re[0]=vb[ee.type],ee=new bf([Re.buffer,ee.data]),ee=Hf(ee)):ee=wc.encodeBase64Packet(ee,Hf),ee;if(Af&&Af.base64)return Hf("b"+wc.packets[ee.type]+ee.data.data);Re=vb[ee.type];void 0!==ee.data&&(Re+=kf?sd.encode(String(ee.data),{strict:!1}):String(ee.data));return Hf(""+
Re)};wc.encodeBase64Packet=function(ee,Re){var kf="b"+wc.packets[ee.type];if("undefined"!==typeof bf&&ee.data instanceof bf){var Hf=new FileReader;Hf.onload=function(){var Ug=Hf.result.split(",")[1];Re(kf+Ug)};return Hf.readAsDataURL(ee.data)}try{var Af=String.fromCharCode.apply(null,new Uint8Array(ee.data))}catch(Ug){ee=new Uint8Array(ee.data);Af=Array(ee.length);for(var yg=0;yg<ee.length;yg++)Af[yg]=ee[yg];Af=String.fromCharCode.apply(null,Af)}kf+=btoa(Af);return Re(kf)};wc.decodePacket=function(ee,
Re,kf){if(void 0===ee)return ne;if("string"===typeof ee){if("b"===ee.charAt(0))return wc.decodeBase64Packet(ee.substr(1),Re);if(kf){a:{Re=ee;try{Re=sd.decode(Re,{strict:!1})}catch(Hf){ee=!1;break a}ee=Re}if(!1===ee)return ne}kf=ee.charAt(0);return Number(kf)==kf&&ld[kf]?1<ee.length?{type:ld[kf],data:ee.substring(1)}:{type:ld[kf]}:ne}kf=(new Uint8Array(ee))[0];ee=Db(ee,1);bf&&"blob"===Re&&(ee=new bf([ee]));return{type:ld[kf],data:ee}};wc.decodeBase64Packet=function(ee,Re){var kf=ld[ee.charAt(0)];if(!pd)return{type:kf,
data:{base64:!0,data:ee.substr(1)}};ee=pd.decode(ee.substr(1));"blob"===Re&&bf&&(ee=new bf([ee]));return{type:kf,data:ee}};wc.encodePayload=function(ee,Re,kf){"function"===typeof Re&&(kf=Re,Re=null);var Hf=tb(ee);if(Re&&Hf)return bf&&!Oc?wc.encodePayloadAsBlob(ee,kf):wc.encodePayloadAsArrayBuffer(ee,kf);if(!ee.length)return kf("0:");rb(ee,function(Af,yg){wc.encodePacket(Af,Hf?Re:!1,!1,function(Ug){yg(null,Ug.length+":"+Ug)})},function(Af,yg){return kf(yg.join(""))})};wc.decodePayload=function(ee,
Re,kf){if("string"!==typeof ee)return wc.decodePayloadAsBinary(ee,Re,kf);"function"===typeof Re&&(kf=Re,Re=null);if(""===ee)return kf(ne,0,1);var Hf="";for(var Af,yg,Ug=0,kh=ee.length;Ug<kh;Ug++)if(yg=ee.charAt(Ug),":"!==yg)Hf+=yg;else{if(""===Hf||Hf!=(Af=Number(Hf)))return kf(ne,0,1);yg=ee.substr(Ug+1,Af);if(Hf!=yg.length)return kf(ne,0,1);if(yg.length){Hf=wc.decodePacket(yg,Re,!1);if(ne.type===Hf.type&&ne.data===Hf.data)return kf(ne,0,1);if(!1===kf(Hf,Ug+Af,kh))return}Ug+=Af;Hf=""}if(""!==Hf)return kf(ne,
0,1)};wc.encodePayloadAsArrayBuffer=function(ee,Re){if(!ee.length)return Re(new ArrayBuffer(0));rb(ee,function(kf,Hf){wc.encodePacket(kf,!0,!0,function(Af){return Hf(null,Af)})},function(kf,Hf){kf=Hf.reduce(function(Ug,kh){kh="string"===typeof kh?kh.length:kh.byteLength;return Ug+kh.toString().length+kh+2},0);var Af=new Uint8Array(kf),yg=0;Hf.forEach(function(Ug){var kh="string"===typeof Ug,Lj=Ug;if(kh){Lj=new Uint8Array(Ug.length);for(var ra=0;ra<Ug.length;ra++)Lj[ra]=Ug.charCodeAt(ra);Lj=Lj.buffer}kh?
Af[yg++]=0:Af[yg++]=1;Ug=Lj.byteLength.toString();for(ra=0;ra<Ug.length;ra++)Af[yg++]=parseInt(Ug[ra]);Af[yg++]=255;Lj=new Uint8Array(Lj);for(ra=0;ra<Lj.length;ra++)Af[yg++]=Lj[ra]});return Re(Af.buffer)})};wc.encodePayloadAsBlob=function(ee,Re){rb(ee,function(kf,Hf){wc.encodePacket(kf,!0,!0,function(Af){var yg=new Uint8Array(1);yg[0]=1;if("string"===typeof Af){for(var Ug=new Uint8Array(Af.length),kh=0;kh<Af.length;kh++)Ug[kh]=Af.charCodeAt(kh);Af=Ug.buffer;yg[0]=0}Ug=(Af instanceof ArrayBuffer?Af.byteLength:
Af.size).toString();var Lj=new Uint8Array(Ug.length+1);for(kh=0;kh<Ug.length;kh++)Lj[kh]=parseInt(Ug[kh]);Lj[Ug.length]=255;bf&&(Af=new bf([yg.buffer,Lj.buffer,Af]),Hf(null,Af))})},function(kf,Hf){return Re(new bf(Hf))})};wc.decodePayloadAsBinary=function(ee,Re,kf){"function"===typeof Re&&(kf=Re,Re=null);for(var Hf=[];0<ee.byteLength;){for(var Af=new Uint8Array(ee),yg=0===Af[0],Ug="",kh=1;255!==Af[kh];kh++){if(310<Ug.length)return kf(ne,0,1);Ug+=Af[kh]}ee=Db(ee,2+Ug.length);Ug=parseInt(Ug);Af=Db(ee,
0,Ug);if(yg)try{Af=String.fromCharCode.apply(null,new Uint8Array(Af))}catch(ra){for(yg=new Uint8Array(Af),Af="",kh=0;kh<yg.length;kh++)Af+=String.fromCharCode(yg[kh])}Hf.push(Af);ee=Db(ee,Ug)}var Lj=Hf.length;Hf.forEach(function(ra,Oa){kf(wc.decodePacket(ra,Re,!0),Oa,Lj)})};return wc}function zc(){function Ba(tb){(this||He).path=tb.path;(this||He).hostname=tb.hostname;(this||He).port=tb.port;(this||He).secure=tb.secure;(this||He).query=tb.query;(this||He).timestampParam=tb.timestampParam;(this||He).timestampRequests=
tb.timestampRequests;(this||He).readyState="";(this||He).agent=tb.agent||!1;(this||He).socket=tb.socket;(this||He).enablesXDR=tb.enablesXDR;(this||He).withCredentials=tb.withCredentials;(this||He).pfx=tb.pfx;(this||He).key=tb.key;(this||He).passphrase=tb.passphrase;(this||He).cert=tb.cert;(this||He).ca=tb.ca;(this||He).ciphers=tb.ciphers;(this||He).rejectUnauthorized=tb.rejectUnauthorized;(this||He).forceNode=tb.forceNode;(this||He).isReactNative=tb.isReactNative;(this||He).extraHeaders=tb.extraHeaders;
(this||He).localAddress=tb.localAddress}if(zd)return yd;zd=!0;var rb=ob(),Bb=nd();yd=Ba;Bb(Ba.prototype);Ba.prototype.onError=function(tb,Db){tb=Error(tb);tb.type="TransportError";tb.description=Db;this.emit("error",tb);return this||He};Ba.prototype.open=function(){if("closed"===(this||He).readyState||""===(this||He).readyState)(this||He).readyState="opening",this.doOpen();return this||He};Ba.prototype.close=function(){if("opening"===(this||He).readyState||"open"===(this||He).readyState)this.doClose(),
this.onClose();return this||He};Ba.prototype.send=function(tb){if("open"===(this||He).readyState)this.write(tb);else throw Error("Transport not open");};Ba.prototype.onOpen=function(){(this||He).readyState="open";(this||He).writable=!0;this.emit("open")};Ba.prototype.onData=function(tb){tb=rb.decodePacket(tb,(this||He).socket.binaryType);this.onPacket(tb)};Ba.prototype.onPacket=function(tb){this.emit("packet",tb)};Ba.prototype.onClose=function(){(this||He).readyState="closed";this.emit("close")};
return yd}function Mc(){if(og)return df;og=!0;df.encode=function(Ba){var rb="",Bb;for(Bb in Ba)Ba.hasOwnProperty(Bb)&&(rb.length&&(rb+="&"),rb+=encodeURIComponent(Bb)+"="+encodeURIComponent(Ba[Bb]));return rb};df.decode=function(Ba){var rb={};Ba=Ba.split("&");for(var Bb=0,tb=Ba.length;Bb<tb;Bb++){var Db=Ba[Bb].split("=");rb[decodeURIComponent(Db[0])]=decodeURIComponent(Db[1])}return rb};return df}function Ja(){if(Oi)return Jh;Oi=!0;return Jh=function(Ba,rb){var Bb=function(){};Bb.prototype=rb.prototype;
Ba.prototype=new Bb;Ba.prototype.constructor=Ba}}function Ra(){function Ba(pd){var nc="";do nc=Bb[pd%64]+nc,pd=Math.floor(pd/64);while(0<pd);return nc}function rb(){var pd=Ba(+new Date);return pd!==sd?(Db=0,sd=pd):pd+"."+Ba(Db++)}if(Kj)return Th;Kj=!0;for(var Bb="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),tb={},Db=0,yc=0,sd;64>yc;yc++)tb[Bb[yc]]=yc;rb.encode=Ba;rb.decode=function(pd){var nc=0;for(yc=0;yc<pd.length;yc++)nc=64*nc+tb[pd.charAt(yc)];return nc};return Th=
rb}function ub(){function Ba(nc){var jc=nc&&nc.forceBase64;if(!pd||jc)(this||Kf).supportsBinary=!1;rb.call(this||Kf,nc)}if(gl)return Kh;gl=!0;var rb=zc(),Bb=Mc(),tb=ob(),Db=Ja(),yc=Ra(),sd=ge()("engine.io-client:polling");Kh=Ba;var pd=null!=(new (fe())({xdomain:!1})).responseType;Db(Ba,rb);Ba.prototype.name="polling";Ba.prototype.doOpen=function(){this.poll()};Ba.prototype.pause=function(nc){function jc(){sd("paused");Oc.readyState="paused";nc()}var Oc=this||Kf;(this||Kf).readyState="pausing";if((this||
Kf).polling||!(this||Kf).writable){var vb=0;(this||Kf).polling&&(sd("we are currently polling - waiting to pause"),vb++,this.once("pollComplete",function(){sd("pre-pause polling complete");--vb||jc()}));(this||Kf).writable||(sd("we are currently writing - waiting to pause"),vb++,this.once("drain",function(){sd("pre-pause writing complete");--vb||jc()}))}else jc()};Ba.prototype.poll=function(){sd("polling");(this||Kf).polling=!0;this.doPoll();this.emit("poll")};Ba.prototype.onData=function(nc){var jc=
this||Kf;sd("polling got data %s",nc);tb.decodePayload(nc,(this||Kf).socket.binaryType,function(Oc,vb,ld){if("opening"===jc.readyState)jc.onOpen();if("close"===Oc.type)return jc.onClose(),!1;jc.onPacket(Oc)});"closed"!==(this||Kf).readyState&&((this||Kf).polling=!1,this.emit("pollComplete"),"open"===(this||Kf).readyState?this.poll():sd('ignoring poll - transport state "%s"',(this||Kf).readyState))};Ba.prototype.doClose=function(){function nc(){sd("writing close packet");jc.write([{type:"close"}])}
var jc=this||Kf;"open"===(this||Kf).readyState?(sd("transport open - closing"),nc()):(sd("transport not open - deferring close"),this.once("open",nc))};Ba.prototype.write=function(nc){var jc=this||Kf;(this||Kf).writable=!1;var Oc=function(){jc.writable=!0;jc.emit("drain")};tb.encodePayload(nc,(this||Kf).supportsBinary,function(vb){jc.doWrite(vb,Oc)})};Ba.prototype.uri=function(){var nc=(this||Kf).query||{},jc=(this||Kf).secure?"https":"http",Oc="";!1!==(this||Kf).timestampRequests&&(nc[(this||Kf).timestampParam]=
yc());(this||Kf).supportsBinary||nc.sid||(nc.b64=1);nc=Bb.encode(nc);(this||Kf).port&&("https"===jc&&443!==Number((this||Kf).port)||"http"===jc&&80!==Number((this||Kf).port))&&(Oc=":"+(this||Kf).port);nc.length&&(nc="?"+nc);var vb=-1!==(this||Kf).hostname.indexOf(":");return jc+"://"+(vb?"["+(this||Kf).hostname+"]":(this||Kf).hostname)+Oc+(this||Kf).path+nc};return Kh}function Mb(){function Ba(){}function rb(Oc){yc.call(this||Ke,Oc);(this||Ke).requestTimeout=Oc.requestTimeout;(this||Ke).extraHeaders=
Oc.extraHeaders;if("undefined"!==typeof location){var vb="https:"===location.protocol,ld=location.port;ld||(ld=vb?443:80);(this||Ke).xd="undefined"!==typeof location&&Oc.hostname!==location.hostname||ld!==Oc.port;(this||Ke).xs=Oc.secure!==vb}}function Bb(Oc){(this||Ke).method=Oc.method||"GET";(this||Ke).uri=Oc.uri;(this||Ke).xd=!!Oc.xd;(this||Ke).xs=!!Oc.xs;(this||Ke).async=!1!==Oc.async;(this||Ke).data=void 0!==Oc.data?Oc.data:null;(this||Ke).agent=Oc.agent;(this||Ke).isBinary=Oc.isBinary;(this||
Ke).supportsBinary=Oc.supportsBinary;(this||Ke).enablesXDR=Oc.enablesXDR;(this||Ke).withCredentials=Oc.withCredentials;(this||Ke).requestTimeout=Oc.requestTimeout;(this||Ke).pfx=Oc.pfx;(this||Ke).key=Oc.key;(this||Ke).passphrase=Oc.passphrase;(this||Ke).cert=Oc.cert;(this||Ke).ca=Oc.ca;(this||Ke).ciphers=Oc.ciphers;(this||Ke).rejectUnauthorized=Oc.rejectUnauthorized;(this||Ke).extraHeaders=Oc.extraHeaders;this.create()}function tb(){for(var Oc in Bb.requests)Bb.requests.hasOwnProperty(Oc)&&Bb.requests[Oc].abort()}
if(oi)return Uj;oi=!0;var Db=fe(),yc=ub(),sd=nd(),pd=Ja(),nc=ge()("engine.io-client:polling-xhr"),jc=id();Uj=rb;Uj.Request=Bb;pd(rb,yc);rb.prototype.supportsBinary=!0;rb.prototype.request=function(Oc){Oc=Oc||{};Oc.uri=this.uri();Oc.xd=(this||Ke).xd;Oc.xs=(this||Ke).xs;Oc.agent=(this||Ke).agent||!1;Oc.supportsBinary=(this||Ke).supportsBinary;Oc.enablesXDR=(this||Ke).enablesXDR;Oc.withCredentials=(this||Ke).withCredentials;Oc.pfx=(this||Ke).pfx;Oc.key=(this||Ke).key;Oc.passphrase=(this||Ke).passphrase;
Oc.cert=(this||Ke).cert;Oc.ca=(this||Ke).ca;Oc.ciphers=(this||Ke).ciphers;Oc.rejectUnauthorized=(this||Ke).rejectUnauthorized;Oc.requestTimeout=(this||Ke).requestTimeout;Oc.extraHeaders=(this||Ke).extraHeaders;return new Bb(Oc)};rb.prototype.doWrite=function(Oc,vb){Oc=this.request({method:"POST",data:Oc,isBinary:"string"!==typeof Oc&&void 0!==Oc});var ld=this||Ke;Oc.on("success",vb);Oc.on("error",function(ne){ld.onError("xhr post error",ne)});(this||Ke).sendXhr=Oc};rb.prototype.doPoll=function(){nc("xhr poll");
var Oc=this.request(),vb=this||Ke;Oc.on("data",function(ld){vb.onData(ld)});Oc.on("error",function(ld){vb.onError("xhr poll error",ld)});(this||Ke).pollXhr=Oc};sd(Bb.prototype);Bb.prototype.create=function(){var Oc={agent:(this||Ke).agent,xdomain:(this||Ke).xd,xscheme:(this||Ke).xs,enablesXDR:(this||Ke).enablesXDR};Oc.pfx=(this||Ke).pfx;Oc.key=(this||Ke).key;Oc.passphrase=(this||Ke).passphrase;Oc.cert=(this||Ke).cert;Oc.ca=(this||Ke).ca;Oc.ciphers=(this||Ke).ciphers;Oc.rejectUnauthorized=(this||Ke).rejectUnauthorized;
var vb=(this||Ke).xhr=new Db(Oc),ld=this||Ke;try{nc("xhr open %s: %s",(this||Ke).method,(this||Ke).uri);vb.open((this||Ke).method,(this||Ke).uri,(this||Ke).async);try{if((this||Ke).extraHeaders){vb.setDisableHeaderCheck&&vb.setDisableHeaderCheck(!0);for(var ne in(this||Ke).extraHeaders)(this||Ke).extraHeaders.hasOwnProperty(ne)&&vb.setRequestHeader(ne,(this||Ke).extraHeaders[ne])}}catch(bf){}if("POST"===(this||Ke).method)try{(this||Ke).isBinary?vb.setRequestHeader("Content-type","application/octet-stream"):
vb.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(bf){}try{vb.setRequestHeader("Accept","*/*")}catch(bf){}"withCredentials"in vb&&(vb.withCredentials=(this||Ke).withCredentials);(this||Ke).requestTimeout&&(vb.timeout=(this||Ke).requestTimeout);this.hasXDR()?(vb.onload=function(){ld.onLoad()},vb.onerror=function(){ld.onError(vb.responseText)}):vb.onreadystatechange=function(){if(2===vb.readyState)try{var bf=vb.getResponseHeader("Content-Type");if(ld.supportsBinary&&"application/octet-stream"===
bf||"application/octet-stream; charset=UTF-8"===bf)vb.responseType="arraybuffer"}catch(ee){}if(4===vb.readyState)if(200===vb.status||1223===vb.status)ld.onLoad();else setTimeout(function(){ld.onError("number"===typeof vb.status?vb.status:0)},0)};nc("xhr data %s",(this||Ke).data);vb.send((this||Ke).data)}catch(bf){setTimeout(function(){ld.onError(bf)},0);return}"undefined"!==typeof document&&((this||Ke).index=Bb.requestsCount++,Bb.requests[(this||Ke).index]=this||Ke)};Bb.prototype.onSuccess=function(){this.emit("success");
this.cleanup()};Bb.prototype.onData=function(Oc){this.emit("data",Oc);this.onSuccess()};Bb.prototype.onError=function(Oc){this.emit("error",Oc);this.cleanup(!0)};Bb.prototype.cleanup=function(Oc){if("undefined"!==typeof(this||Ke).xhr&&null!==(this||Ke).xhr){this.hasXDR()?(this||Ke).xhr.onload=(this||Ke).xhr.onerror=Ba:(this||Ke).xhr.onreadystatechange=Ba;if(Oc)try{(this||Ke).xhr.abort()}catch(vb){}"undefined"!==typeof document&&delete Bb.requests[(this||Ke).index];(this||Ke).xhr=null}};Bb.prototype.onLoad=
function(){try{try{var Oc=(this||Ke).xhr.getResponseHeader("Content-Type")}catch(ld){}var vb="application/octet-stream"===Oc||"application/octet-stream; charset=UTF-8"===Oc?(this||Ke).xhr.response||(this||Ke).xhr.responseText:(this||Ke).xhr.responseText}catch(ld){this.onError(ld)}if(null!=vb)this.onData(vb)};Bb.prototype.hasXDR=function(){return"undefined"!==typeof XDomainRequest&&!(this||Ke).xs&&(this||Ke).enablesXDR};Bb.prototype.abort=function(){this.cleanup()};Bb.requestsCount=0;Bb.requests={};
"undefined"!==typeof document&&("function"===typeof attachEvent?attachEvent("onunload",tb):"function"===typeof addEventListener&&addEventListener("onpagehide"in jc?"pagehide":"unload",tb,!1));return Uj}function Ob(){function Ba(){}function rb(nc){Bb.call(this||ch,nc);(this||ch).query=(this||ch).query||{};pd||(pd=Db.___eio=Db.___eio||[]);(this||ch).index=pd.length;var jc=this||ch;pd.push(function(Oc){jc.onData(Oc)});(this||ch).query.j=(this||ch).index;"function"===typeof addEventListener&&addEventListener("beforeunload",
function(){jc.script&&(jc.script.onerror=Ba)},!1)}if(cm)return Kk;cm=!0;var Bb=ub(),tb=Ja(),Db=id();Kk=rb;var yc=/\n/g,sd=/\\n/g,pd;tb(rb,Bb);rb.prototype.supportsBinary=!1;rb.prototype.doClose=function(){(this||ch).script&&((this||ch).script.parentNode.removeChild((this||ch).script),(this||ch).script=null);(this||ch).form&&((this||ch).form.parentNode.removeChild((this||ch).form),(this||ch).form=null,(this||ch).iframe=null);Bb.prototype.doClose.call(this||ch)};rb.prototype.doPoll=function(){var nc=
this||ch,jc=document.createElement("script");(this||ch).script&&((this||ch).script.parentNode.removeChild((this||ch).script),(this||ch).script=null);jc.async=!0;jc.src=this.uri();jc.onerror=function(vb){nc.onError("jsonp poll error",vb)};var Oc=document.getElementsByTagName("script")[0];Oc?Oc.parentNode.insertBefore(jc,Oc):(document.head||document.body).appendChild(jc);(this||ch).script=jc;"undefined"!==typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var vb=document.createElement("iframe");
document.body.appendChild(vb);document.body.removeChild(vb)},100)};rb.prototype.doWrite=function(nc,jc){function Oc(){vb();jc()}function vb(){if(ld.iframe)try{ld.form.removeChild(ld.iframe)}catch(kf){ld.onError("jsonp polling iframe removal error",kf)}try{Re=document.createElement('<iframe src="javascript:0" name="'+ld.iframeId+'">')}catch(kf){Re=document.createElement("iframe"),Re.name=ld.iframeId,Re.src="javascript:0"}Re.id=ld.iframeId;ld.form.appendChild(Re);ld.iframe=Re}var ld=this||ch;if(!(this||
ch).form){var ne=document.createElement("form"),bf=document.createElement("textarea"),ee=(this||ch).iframeId="eio_iframe_"+(this||ch).index,Re;ne.className="socketio";ne.style.position="absolute";ne.style.top="-1000px";ne.style.left="-1000px";ne.target=ee;ne.method="POST";ne.setAttribute("accept-charset","utf-8");bf.name="d";ne.appendChild(bf);document.body.appendChild(ne);(this||ch).form=ne;(this||ch).area=bf}(this||ch).form.action=this.uri();vb();nc=nc.replace(sd,"\\\n");(this||ch).area.value=nc.replace(yc,
"\\n");try{(this||ch).form.submit()}catch(kf){}(this||ch).iframe.attachEvent?(this||ch).iframe.onreadystatechange=function(){"complete"===ld.iframe.readyState&&Oc()}:(this||ch).iframe.onload=Oc};return Kk}function kb(){if(Fl)return ok;Fl=!0;return ok=function(){throw Error("ws does not work in the browser. Browser clients must use the native WebSocket object");}}function ib(){function Ba(vb){vb&&vb.forceBase64&&((this||sg).supportsBinary=!1);(this||sg).perMessageDeflate=vb.perMessageDeflate;(this||
sg).usingBrowserWebSocket=nc&&!vb.forceNode;(this||sg).protocols=vb.protocols;(this||sg).usingBrowserWebSocket||(Oc=jc);Bb.call(this||sg,vb)}if(lk)return Gl;lk=!0;var rb=dc.Buffer,Bb=zc(),tb=ob(),Db=Mc(),yc=Ja(),sd=Ra(),pd=ge()("engine.io-client:websocket"),nc;"undefined"!==typeof WebSocket?nc=WebSocket:"undefined"!==typeof self&&(nc=self.WebSocket||self.MozWebSocket);if("undefined"===typeof window)try{var jc=kb()}catch(vb){}var Oc=nc||jc;Gl=Ba;yc(Ba,Bb);Ba.prototype.name="websocket";Ba.prototype.supportsBinary=
!0;Ba.prototype.doOpen=function(){if(this.check()){var vb=this.uri(),ld=(this||sg).protocols,ne={};(this||sg).isReactNative||(ne.agent=(this||sg).agent,ne.perMessageDeflate=(this||sg).perMessageDeflate,ne.pfx=(this||sg).pfx,ne.key=(this||sg).key,ne.passphrase=(this||sg).passphrase,ne.cert=(this||sg).cert,ne.ca=(this||sg).ca,ne.ciphers=(this||sg).ciphers,ne.rejectUnauthorized=(this||sg).rejectUnauthorized);(this||sg).extraHeaders&&(ne.headers=(this||sg).extraHeaders);(this||sg).localAddress&&(ne.localAddress=
(this||sg).localAddress);try{(this||sg).ws=(this||sg).usingBrowserWebSocket&&!(this||sg).isReactNative?ld?new Oc(vb,ld):new Oc(vb):new Oc(vb,ld,ne)}catch(bf){return this.emit("error",bf)}void 0===(this||sg).ws.binaryType&&((this||sg).supportsBinary=!1);(this||sg).ws.supports&&(this||sg).ws.supports.binary?((this||sg).supportsBinary=!0,(this||sg).ws.binaryType="nodebuffer"):(this||sg).ws.binaryType="arraybuffer";this.addEventListeners()}};Ba.prototype.addEventListeners=function(){var vb=this||sg;(this||
sg).ws.onopen=function(){vb.onOpen()};(this||sg).ws.onclose=function(){vb.onClose()};(this||sg).ws.onmessage=function(ld){vb.onData(ld.data)};(this||sg).ws.onerror=function(ld){vb.onError("websocket error",ld)}};Ba.prototype.write=function(vb){function ld(){ne.emit("flush");setTimeout(function(){ne.writable=!0;ne.emit("drain")},0)}var ne=this||sg;(this||sg).writable=!1;for(var bf=vb.length,ee=0,Re=bf;ee<Re;ee++)(function(kf){tb.encodePacket(kf,ne.supportsBinary,function(Hf){if(!ne.usingBrowserWebSocket){var Af=
{};kf.options&&(Af.compress=kf.options.compress);ne.perMessageDeflate&&("string"===typeof Hf?rb.byteLength(Hf):Hf.length)<ne.perMessageDeflate.threshold&&(Af.compress=!1)}try{ne.usingBrowserWebSocket?ne.ws.send(Hf):ne.ws.send(Hf,Af)}catch(yg){pd("websocket closed before onclose event")}--bf||ld()})})(vb[ee])};Ba.prototype.onClose=function(){Bb.prototype.onClose.call(this||sg)};Ba.prototype.doClose=function(){"undefined"!==typeof(this||sg).ws&&(this||sg).ws.close()};Ba.prototype.uri=function(){var vb=
(this||sg).query||{},ld=(this||sg).secure?"wss":"ws",ne="";(this||sg).port&&("wss"===ld&&443!==Number((this||sg).port)||"ws"===ld&&80!==Number((this||sg).port))&&(ne=":"+(this||sg).port);(this||sg).timestampRequests&&(vb[(this||sg).timestampParam]=sd());(this||sg).supportsBinary||(vb.b64=1);vb=Db.encode(vb);vb.length&&(vb="?"+vb);var bf=-1!==(this||sg).hostname.indexOf(":");return ld+"://"+(bf?"["+(this||sg).hostname+"]":(this||sg).hostname)+ne+(this||sg).path+vb};Ba.prototype.check=function(){return!!Oc&&
!("__initialize"in Oc&&(this||sg).name===Ba.prototype.name)};return Gl}function Jb(){if(Vm)return Wf;Vm=!0;var Ba=fe(),rb=Mb(),Bb=Ob(),tb=ib();Wf.polling=function(Db){var yc=!1,sd=!1,pd=!1!==Db.jsonp;"undefined"!==typeof location&&(sd="https:"===location.protocol,(yc=location.port)||(yc=sd?443:80),yc=Db.hostname!==location.hostname||yc!==Db.port,sd=Db.secure!==sd);Db.xdomain=yc;Db.xscheme=sd;if("open"in new Ba(Db)&&!Db.forceJSONP)return new rb(Db);if(!pd)throw Error("JSONP disabled");return new Bb(Db)};
Wf.websocket=tb;return Wf}function vc(){if(Ad)return Ub;Ad=!0;var Ba=[].indexOf;return Ub=function(rb,Bb){if(Ba)return rb.indexOf(Bb);for(var tb=0;tb<rb.length;++tb)if(rb[tb]===Bb)return tb;return-1}}function sc(){function Ba(nc,jc){if(!((this||kd)instanceof Ba))return new Ba(nc,jc);jc=jc||{};nc&&"object"===typeof nc&&(jc=nc,nc=null);nc?(nc=sd(nc),jc.hostname=nc.host,jc.secure="https"===nc.protocol||"wss"===nc.protocol,jc.port=nc.port,nc.query&&(jc.query=nc.query)):jc.host&&(jc.hostname=sd(jc.host).host);
(this||kd).secure=null!=jc.secure?jc.secure:"undefined"!==typeof location&&"https:"===location.protocol;jc.hostname&&!jc.port&&(jc.port=(this||kd).secure?"443":"80");(this||kd).agent=jc.agent||!1;(this||kd).hostname=jc.hostname||("undefined"!==typeof location?location.hostname:"localhost");(this||kd).port=jc.port||("undefined"!==typeof location&&location.port?location.port:(this||kd).secure?443:80);(this||kd).query=jc.query||{};"string"===typeof(this||kd).query&&((this||kd).query=pd.decode((this||
kd).query));(this||kd).upgrade=!1!==jc.upgrade;(this||kd).path=(jc.path||"/engine.io").replace(/\/$/,"")+"/";(this||kd).forceJSONP=!!jc.forceJSONP;(this||kd).jsonp=!1!==jc.jsonp;(this||kd).forceBase64=!!jc.forceBase64;(this||kd).enablesXDR=!!jc.enablesXDR;(this||kd).withCredentials=!1!==jc.withCredentials;(this||kd).timestampParam=jc.timestampParam||"t";(this||kd).timestampRequests=jc.timestampRequests;(this||kd).transports=jc.transports||["polling","websocket"];(this||kd).transportOptions=jc.transportOptions||
{};(this||kd).readyState="";(this||kd).writeBuffer=[];(this||kd).prevBufferLen=0;(this||kd).policyPort=jc.policyPort||843;(this||kd).rememberUpgrade=jc.rememberUpgrade||!1;(this||kd).binaryType=null;(this||kd).onlyBinaryUpgrades=jc.onlyBinaryUpgrades;(this||kd).perMessageDeflate=!1!==jc.perMessageDeflate?jc.perMessageDeflate||{}:!1;!0===(this||kd).perMessageDeflate&&((this||kd).perMessageDeflate={});(this||kd).perMessageDeflate&&null==(this||kd).perMessageDeflate.threshold&&((this||kd).perMessageDeflate.threshold=
1024);(this||kd).pfx=jc.pfx||null;(this||kd).key=jc.key||null;(this||kd).passphrase=jc.passphrase||null;(this||kd).cert=jc.cert||null;(this||kd).ca=jc.ca||null;(this||kd).ciphers=jc.ciphers||null;(this||kd).rejectUnauthorized=void 0===jc.rejectUnauthorized?!0:jc.rejectUnauthorized;(this||kd).forceNode=!!jc.forceNode;(this||kd).isReactNative="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();if("undefined"===typeof self||(this||kd).isReactNative)jc.extraHeaders&&
0<Object.keys(jc.extraHeaders).length&&((this||kd).extraHeaders=jc.extraHeaders),jc.localAddress&&((this||kd).localAddress=jc.localAddress);(this||kd).id=null;(this||kd).upgrades=null;(this||kd).pingInterval=null;(this||kd).pingTimeout=null;(this||kd).pingIntervalTimer=null;(this||kd).pingTimeoutTimer=null;this.open()}if(ze)return Kc;ze=!0;var rb=Jb(),Bb=nd(),tb=ge()("engine.io-client:socket"),Db=vc(),yc=ob(),sd=Qc(),pd=Mc();Kc=Ba;Ba.priorWebsocketSuccess=!1;Bb(Ba.prototype);Ba.protocol=yc.protocol;
Ba.Socket=Ba;Ba.Transport=zc();Ba.transports=Jb();Ba.parser=ob();Ba.prototype.createTransport=function(nc){tb('creating transport "%s"',nc);var jc=(this||kd).query,Oc={},vb;for(vb in jc)jc.hasOwnProperty(vb)&&(Oc[vb]=jc[vb]);Oc.EIO=yc.protocol;Oc.transport=nc;jc=(this||kd).transportOptions[nc]||{};(this||kd).id&&(Oc.sid=(this||kd).id);return new rb[nc]({query:Oc,socket:this||kd,agent:jc.agent||(this||kd).agent,hostname:jc.hostname||(this||kd).hostname,port:jc.port||(this||kd).port,secure:jc.secure||
(this||kd).secure,path:jc.path||(this||kd).path,forceJSONP:jc.forceJSONP||(this||kd).forceJSONP,jsonp:jc.jsonp||(this||kd).jsonp,forceBase64:jc.forceBase64||(this||kd).forceBase64,enablesXDR:jc.enablesXDR||(this||kd).enablesXDR,withCredentials:jc.withCredentials||(this||kd).withCredentials,timestampRequests:jc.timestampRequests||(this||kd).timestampRequests,timestampParam:jc.timestampParam||(this||kd).timestampParam,policyPort:jc.policyPort||(this||kd).policyPort,pfx:jc.pfx||(this||kd).pfx,key:jc.key||
(this||kd).key,passphrase:jc.passphrase||(this||kd).passphrase,cert:jc.cert||(this||kd).cert,ca:jc.ca||(this||kd).ca,ciphers:jc.ciphers||(this||kd).ciphers,rejectUnauthorized:jc.rejectUnauthorized||(this||kd).rejectUnauthorized,perMessageDeflate:jc.perMessageDeflate||(this||kd).perMessageDeflate,extraHeaders:jc.extraHeaders||(this||kd).extraHeaders,forceNode:jc.forceNode||(this||kd).forceNode,localAddress:jc.localAddress||(this||kd).localAddress,requestTimeout:jc.requestTimeout||(this||kd).requestTimeout,
protocols:jc.protocols||void 0,isReactNative:(this||kd).isReactNative})};Ba.prototype.open=function(){if((this||kd).rememberUpgrade&&Ba.priorWebsocketSuccess&&-1!==(this||kd).transports.indexOf("websocket"))var nc="websocket";else{if(0===(this||kd).transports.length){var jc=this||kd;setTimeout(function(){jc.emit("error","No transports available")},0);return}nc=(this||kd).transports[0]}(this||kd).readyState="opening";try{nc=this.createTransport(nc)}catch(Oc){(this||kd).transports.shift();this.open();
return}nc.open();this.setTransport(nc)};Ba.prototype.setTransport=function(nc){tb("setting transport %s",nc.name);var jc=this||kd;(this||kd).transport&&(tb("clearing existing transport %s",(this||kd).transport.name),(this||kd).transport.removeAllListeners());(this||kd).transport=nc;nc.on("drain",function(){jc.onDrain()}).on("packet",function(Oc){jc.onPacket(Oc)}).on("error",function(Oc){jc.onError(Oc)}).on("close",function(){jc.onClose("transport close")})};Ba.prototype.probe=function(nc){function jc(){if(Hf.onlyBinaryUpgrades){var Af=
!(this||kd).supportsBinary&&Hf.transport.supportsBinary;kf=kf||Af}kf||(tb('probe transport "%s" opened',nc),Re.send([{type:"ping",data:"probe"}]),Re.once("packet",function(yg){kf||("pong"===yg.type&&"probe"===yg.data?(tb('probe transport "%s" pong',nc),Hf.upgrading=!0,Hf.emit("upgrading",Re),Re&&(Ba.priorWebsocketSuccess="websocket"===Re.name,tb('pausing current transport "%s"',Hf.transport.name),Hf.transport.pause(function(){kf||"closed"===Hf.readyState||(tb("changing transport and sending upgrade packet"),
ee(),Hf.setTransport(Re),Re.send([{type:"upgrade"}]),Hf.emit("upgrade",Re),Re=null,Hf.upgrading=!1,Hf.flush())}))):(tb('probe transport "%s" failed',nc),yg=Error("probe error"),yg.transport=Re.name,Hf.emit("upgradeError",yg)))}))}function Oc(){kf||(kf=!0,ee(),Re.close(),Re=null)}function vb(Af){var yg=Error("probe error: "+Af);yg.transport=Re.name;Oc();tb('probe transport "%s" failed because of error: %s',nc,Af);Hf.emit("upgradeError",yg)}function ld(){vb("transport closed")}function ne(){vb("socket closed")}
function bf(Af){Re&&Af.name!==Re.name&&(tb('"%s" works - aborting "%s"',Af.name,Re.name),Oc())}function ee(){Re.removeListener("open",jc);Re.removeListener("error",vb);Re.removeListener("close",ld);Hf.removeListener("close",ne);Hf.removeListener("upgrading",bf)}tb('probing transport "%s"',nc);var Re=this.createTransport(nc,{probe:1}),kf=!1,Hf=this||kd;Ba.priorWebsocketSuccess=!1;Re.once("open",jc);Re.once("error",vb);Re.once("close",ld);this.once("close",ne);this.once("upgrading",bf);Re.open()};Ba.prototype.onOpen=
function(){tb("socket open");(this||kd).readyState="open";Ba.priorWebsocketSuccess="websocket"===(this||kd).transport.name;this.emit("open");this.flush();if("open"===(this||kd).readyState&&(this||kd).upgrade&&(this||kd).transport.pause){tb("starting upgrade probes");for(var nc=0,jc=(this||kd).upgrades.length;nc<jc;nc++)this.probe((this||kd).upgrades[nc])}};Ba.prototype.onPacket=function(nc){if("opening"===(this||kd).readyState||"open"===(this||kd).readyState||"closing"===(this||kd).readyState)switch(tb('socket receive: type "%s", data "%s"',
nc.type,nc.data),this.emit("packet",nc),this.emit("heartbeat"),nc.type){case "open":this.onHandshake(JSON.parse(nc.data));break;case "pong":this.setPing();this.emit("pong");break;case "error":var jc=Error("server error");jc.code=nc.data;this.onError(jc);break;case "message":this.emit("data",nc.data),this.emit("message",nc.data)}else tb('packet received with socket readyState "%s"',(this||kd).readyState)};Ba.prototype.onHandshake=function(nc){this.emit("handshake",nc);(this||kd).id=nc.sid;(this||kd).transport.query.sid=
nc.sid;(this||kd).upgrades=this.filterUpgrades(nc.upgrades);(this||kd).pingInterval=nc.pingInterval;(this||kd).pingTimeout=nc.pingTimeout;this.onOpen();"closed"!==(this||kd).readyState&&(this.setPing(),this.removeListener("heartbeat",(this||kd).onHeartbeat),this.on("heartbeat",(this||kd).onHeartbeat))};Ba.prototype.onHeartbeat=function(nc){clearTimeout((this||kd).pingTimeoutTimer);var jc=this||kd;jc.pingTimeoutTimer=setTimeout(function(){if("closed"!==jc.readyState)jc.onClose("ping timeout")},nc||
jc.pingInterval+jc.pingTimeout)};Ba.prototype.setPing=function(){var nc=this||kd;clearTimeout(nc.pingIntervalTimer);nc.pingIntervalTimer=setTimeout(function(){tb("writing ping packet - expecting pong within %sms",nc.pingTimeout);nc.ping();nc.onHeartbeat(nc.pingTimeout)},nc.pingInterval)};Ba.prototype.ping=function(){var nc=this||kd;this.sendPacket("ping",function(){nc.emit("ping")})};Ba.prototype.onDrain=function(){(this||kd).writeBuffer.splice(0,(this||kd).prevBufferLen);(this||kd).prevBufferLen=
0;0===(this||kd).writeBuffer.length?this.emit("drain"):this.flush()};Ba.prototype.flush=function(){"closed"!==(this||kd).readyState&&(this||kd).transport.writable&&!(this||kd).upgrading&&(this||kd).writeBuffer.length&&(tb("flushing %d packets in socket",(this||kd).writeBuffer.length),(this||kd).transport.send((this||kd).writeBuffer),(this||kd).prevBufferLen=(this||kd).writeBuffer.length,this.emit("flush"))};Ba.prototype.write=Ba.prototype.send=function(nc,jc,Oc){this.sendPacket("message",nc,jc,Oc);
return this||kd};Ba.prototype.sendPacket=function(nc,jc,Oc,vb){"function"===typeof jc&&(vb=jc,jc=void 0);"function"===typeof Oc&&(vb=Oc,Oc=null);if("closing"!==(this||kd).readyState&&"closed"!==(this||kd).readyState){Oc=Oc||{};Oc.compress=!1!==Oc.compress;nc={type:nc,data:jc,options:Oc};this.emit("packetCreate",nc);(this||kd).writeBuffer.push(nc);if(vb)this.once("flush",vb);this.flush()}};Ba.prototype.close=function(){function nc(){vb.onClose("forced close");tb("socket closing - telling transport to close");
vb.transport.close()}function jc(){vb.removeListener("upgrade",jc);vb.removeListener("upgradeError",jc);nc()}function Oc(){vb.once("upgrade",jc);vb.once("upgradeError",jc)}if("opening"===(this||kd).readyState||"open"===(this||kd).readyState){(this||kd).readyState="closing";var vb=this||kd;if((this||kd).writeBuffer.length)this.once("drain",function(){(this||kd).upgrading?Oc():nc()});else(this||kd).upgrading?Oc():nc()}return this||kd};Ba.prototype.onError=function(nc){tb("socket error %j",nc);Ba.priorWebsocketSuccess=
!1;this.emit("error",nc);this.onClose("transport error",nc)};Ba.prototype.onClose=function(nc,jc){if("opening"===(this||kd).readyState||"open"===(this||kd).readyState||"closing"===(this||kd).readyState){tb('socket close with reason: "%s"',nc);var Oc=this||kd;clearTimeout((this||kd).pingIntervalTimer);clearTimeout((this||kd).pingTimeoutTimer);(this||kd).transport.removeAllListeners("close");(this||kd).transport.close();(this||kd).transport.removeAllListeners();(this||kd).readyState="closed";(this||
kd).id=null;this.emit("close",nc,jc);Oc.writeBuffer=[];Oc.prevBufferLen=0}};Ba.prototype.filterUpgrades=function(nc){for(var jc=[],Oc=0,vb=nc.length;Oc<vb;Oc++)~Db((this||kd).transports,nc[Oc])&&jc.push(nc[Oc]);return jc};return Kc}function Uc(){if(Sm)return Cm;Sm=!0;return Cm=function(Ba,rb){for(var Bb=[],tb=(rb=rb||0)||0;tb<Ba.length;tb++)Bb[tb-rb]=Ba[tb];return Bb}}function Xc(){if(ao)return Vo;ao=!0;return Vo=function(Ba,rb,Bb){Ba.on(rb,Bb);return{destroy:function(){Ba.removeListener(rb,Bb)}}}}
function Q(){if(qk)return to;qk=!0;var Ba=[].slice;return to=function(rb,Bb){"string"==typeof Bb&&(Bb=rb[Bb]);if("function"!=typeof Bb)throw Error("bind() requires a function");var tb=Ba.call(arguments,2);return function(){return Bb.apply(rb,tb.concat(Ba.call(arguments)))}}}function fa(){function Ba(vb,ld,ne){(this||uf).io=vb;(this||uf).nsp=ld;(this||uf).json=this||uf;(this||uf).ids=0;(this||uf).acks={};(this||uf).receiveBuffer=[];(this||uf).sendBuffer=[];(this||uf).connected=!1;(this||uf).disconnected=
!0;(this||uf).flags={};ne&&ne.query&&((this||uf).query=ne.query);(this||uf).io.autoConnect&&this.open()}if(Tm)return om;Tm=!0;var rb=ic(),Bb=nd(),tb=Uc(),Db=Xc(),yc=Q(),sd=ge()("socket.io-client:socket"),pd=Mc(),nc=rc();om=om=Ba;var jc={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},Oc=Bb.prototype.emit;Bb(Ba.prototype);Ba.prototype.subEvents=function(){if(!(this||uf).subs){var vb=
(this||uf).io;(this||uf).subs=[Db(vb,"open",yc(this||uf,"onopen")),Db(vb,"packet",yc(this||uf,"onpacket")),Db(vb,"close",yc(this||uf,"onclose"))]}};Ba.prototype.open=Ba.prototype.connect=function(){if((this||uf).connected)return this||uf;this.subEvents();(this||uf).io.reconnecting||(this||uf).io.open();if("open"===(this||uf).io.readyState)this.onopen();this.emit("connecting");return this||uf};Ba.prototype.send=function(){var vb=tb(arguments);vb.unshift("message");(this||uf).emit.apply(this||uf,vb);
return this||uf};Ba.prototype.emit=function(vb){if(jc.hasOwnProperty(vb))return Oc.apply(this||uf,arguments),this||uf;var ld=tb(arguments),ne={type:(void 0!==(this||uf).flags.binary?(this||uf).flags.binary:nc(ld))?rb.BINARY_EVENT:rb.EVENT,data:ld,options:{}};ne.options.compress=!(this||uf).flags||!1!==(this||uf).flags.compress;"function"===typeof ld[ld.length-1]&&(sd("emitting packet with ack id %d",(this||uf).ids),(this||uf).acks[(this||uf).ids]=ld.pop(),ne.id=(this||uf).ids++);(this||uf).connected?
this.packet(ne):(this||uf).sendBuffer.push(ne);(this||uf).flags={};return this||uf};Ba.prototype.packet=function(vb){vb.nsp=(this||uf).nsp;(this||uf).io.packet(vb)};Ba.prototype.onopen=function(){sd("transport is open - connecting");if("/"!==(this||uf).nsp)if((this||uf).query){var vb="object"===typeof(this||uf).query?pd.encode((this||uf).query):(this||uf).query;sd("sending connect packet with query %s",vb);this.packet({type:rb.CONNECT,query:vb})}else this.packet({type:rb.CONNECT})};Ba.prototype.onclose=
function(vb){sd("close (%s)",vb);(this||uf).connected=!1;(this||uf).disconnected=!0;delete (this||uf).id;this.emit("disconnect",vb)};Ba.prototype.onpacket=function(vb){var ld=vb.type===rb.ERROR&&"/"===vb.nsp;if(vb.nsp===(this||uf).nsp||ld)switch(vb.type){case rb.CONNECT:this.onconnect();break;case rb.EVENT:this.onevent(vb);break;case rb.BINARY_EVENT:this.onevent(vb);break;case rb.ACK:this.onack(vb);break;case rb.BINARY_ACK:this.onack(vb);break;case rb.DISCONNECT:this.ondisconnect();break;case rb.ERROR:this.emit("error",
vb.data)}};Ba.prototype.onevent=function(vb){var ld=vb.data||[];sd("emitting event %j",ld);null!=vb.id&&(sd("attaching ack callback to event"),ld.push(this.ack(vb.id)));(this||uf).connected?Oc.apply(this||uf,ld):(this||uf).receiveBuffer.push(ld)};Ba.prototype.ack=function(vb){var ld=this||uf,ne=!1;return function(){if(!ne){ne=!0;var bf=tb(arguments);sd("sending ack %j",bf);ld.packet({type:nc(bf)?rb.BINARY_ACK:rb.ACK,id:vb,data:bf})}}};Ba.prototype.onack=function(vb){var ld=(this||uf).acks[vb.id];
"function"===typeof ld?(sd("calling ack %s with %j",vb.id,vb.data),ld.apply(this||uf,vb.data),delete (this||uf).acks[vb.id]):sd("bad ack %s",vb.id)};Ba.prototype.onconnect=function(){(this||uf).connected=!0;(this||uf).disconnected=!1;this.emit("connect");this.emitBuffered()};Ba.prototype.emitBuffered=function(){var vb;for(vb=0;vb<(this||uf).receiveBuffer.length;vb++)Oc.apply(this||uf,(this||uf).receiveBuffer[vb]);(this||uf).receiveBuffer=[];for(vb=0;vb<(this||uf).sendBuffer.length;vb++)this.packet((this||
uf).sendBuffer[vb]);(this||uf).sendBuffer=[]};Ba.prototype.ondisconnect=function(){sd("server disconnect (%s)",(this||uf).nsp);this.destroy();this.onclose("io server disconnect")};Ba.prototype.destroy=function(){if((this||uf).subs){for(var vb=0;vb<(this||uf).subs.length;vb++)(this||uf).subs[vb].destroy();(this||uf).subs=null}(this||uf).io.destroy(this||uf)};Ba.prototype.close=Ba.prototype.disconnect=function(){(this||uf).connected&&(sd("performing disconnect (%s)",(this||uf).nsp),this.packet({type:rb.DISCONNECT}));
this.destroy();if((this||uf).connected)this.onclose("io client disconnect");return this||uf};Ba.prototype.compress=function(vb){(this||uf).flags.compress=vb;return this||uf};Ba.prototype.binary=function(vb){(this||uf).flags.binary=vb;return this||uf};return om}function Ha(){function Ba(rb){rb=rb||{};(this||Tj).ms=rb.min||100;(this||Tj).max=rb.max||1E4;(this||Tj).factor=rb.factor||2;(this||Tj).jitter=0<rb.jitter&&1>=rb.jitter?rb.jitter:0;(this||Tj).attempts=0}if(bo)return pm;bo=!0;pm=Ba;Ba.prototype.duration=
function(){var rb=(this||Tj).ms*Math.pow((this||Tj).factor,(this||Tj).attempts++);if((this||Tj).jitter){var Bb=Math.random(),tb=Math.floor(Bb*(this||Tj).jitter*rb);rb=0==(Math.floor(10*Bb)&1)?rb-tb:rb+tb}return Math.min(rb,(this||Tj).max)|0};Ba.prototype.reset=function(){(this||Tj).attempts=0};Ba.prototype.setMin=function(rb){(this||Tj).ms=rb};Ba.prototype.setMax=function(rb){(this||Tj).max=rb};Ba.prototype.setJitter=function(rb){(this||Tj).jitter=rb};return pm}function Qa(){function Ba(vb,ld){if(!((this||
he)instanceof Ba))return new Ba(vb,ld);vb&&"object"===typeof vb&&(ld=vb,vb=void 0);ld=ld||{};ld.path=ld.path||"/socket.io";(this||he).nsps={};(this||he).subs=[];(this||he).opts=ld;this.reconnection(!1!==ld.reconnection);this.reconnectionAttempts(ld.reconnectionAttempts||Infinity);this.reconnectionDelay(ld.reconnectionDelay||1E3);this.reconnectionDelayMax(ld.reconnectionDelayMax||5E3);this.randomizationFactor(ld.randomizationFactor||.5);(this||he).backoff=new jc({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),
jitter:this.randomizationFactor()});this.timeout(null==ld.timeout?2E4:ld.timeout);(this||he).readyState="closed";(this||he).uri=vb;(this||he).connecting=[];(this||he).lastPing=null;(this||he).encoding=!1;(this||he).packetBuffer=[];vb=ld.parser||Db;(this||he).encoder=new vb.Encoder;(this||he).decoder=new vb.Decoder;(this||he).autoConnect=!1!==ld.autoConnect;(this||he).autoConnect&&this.open()}if(qm)return em;qm=!0;pk||(pk=!0,Wg=sc(),Wg.parser=ob());var rb=Wg;var Bb=fa(),tb=nd(),Db=ic(),yc=Xc(),sd=
Q(),pd=ge()("socket.io-client:manager"),nc=vc(),jc=Ha(),Oc=Object.prototype.hasOwnProperty;em=Ba;Ba.prototype.emitAll=function(){(this||he).emit.apply(this||he,arguments);for(var vb in(this||he).nsps)Oc.call((this||he).nsps,vb)&&(this||he).nsps[vb].emit.apply((this||he).nsps[vb],arguments)};Ba.prototype.updateSocketIds=function(){for(var vb in(this||he).nsps)Oc.call((this||he).nsps,vb)&&((this||he).nsps[vb].id=this.generateId(vb))};Ba.prototype.generateId=function(vb){return("/"===vb?"":vb+"#")+(this||
he).engine.id};tb(Ba.prototype);Ba.prototype.reconnection=function(vb){if(!arguments.length)return(this||he)._reconnection;(this||he)._reconnection=!!vb;return this||he};Ba.prototype.reconnectionAttempts=function(vb){if(!arguments.length)return(this||he)._reconnectionAttempts;(this||he)._reconnectionAttempts=vb;return this||he};Ba.prototype.reconnectionDelay=function(vb){if(!arguments.length)return(this||he)._reconnectionDelay;(this||he)._reconnectionDelay=vb;(this||he).backoff&&(this||he).backoff.setMin(vb);
return this||he};Ba.prototype.randomizationFactor=function(vb){if(!arguments.length)return(this||he)._randomizationFactor;(this||he)._randomizationFactor=vb;(this||he).backoff&&(this||he).backoff.setJitter(vb);return this||he};Ba.prototype.reconnectionDelayMax=function(vb){if(!arguments.length)return(this||he)._reconnectionDelayMax;(this||he)._reconnectionDelayMax=vb;(this||he).backoff&&(this||he).backoff.setMax(vb);return this||he};Ba.prototype.timeout=function(vb){if(!arguments.length)return(this||
he)._timeout;(this||he)._timeout=vb;return this||he};Ba.prototype.maybeReconnectOnOpen=function(){!(this||he).reconnecting&&(this||he)._reconnection&&0===(this||he).backoff.attempts&&this.reconnect()};Ba.prototype.open=Ba.prototype.connect=function(vb,ld){pd("readyState %s",(this||he).readyState);if(~(this||he).readyState.indexOf("open"))return this||he;pd("opening %s",(this||he).uri);(this||he).engine=rb((this||he).uri,(this||he).opts);var ne=(this||he).engine,bf=this||he;(this||he).readyState="opening";
(this||he).skipReconnect=!1;var ee=yc(ne,"open",function(){bf.onopen();vb&&vb()});ld=yc(ne,"error",function(Hf){pd("connect_error");bf.cleanup();bf.readyState="closed";bf.emitAll("connect_error",Hf);if(vb){var Af=Error("Connection error");Af.data=Hf;vb(Af)}else bf.maybeReconnectOnOpen()});if(!1!==(this||he)._timeout){var Re=(this||he)._timeout;pd("connect attempt will timeout after %d",Re);0===Re&&ee.destroy();var kf=setTimeout(function(){pd("connect attempt timed out after %d",Re);ee.destroy();ne.close();
ne.emit("error","timeout");bf.emitAll("connect_timeout",Re)},Re);(this||he).subs.push({destroy:function(){clearTimeout(kf)}})}(this||he).subs.push(ee);(this||he).subs.push(ld);return this||he};Ba.prototype.onopen=function(){pd("open");this.cleanup();(this||he).readyState="open";this.emit("open");var vb=(this||he).engine;(this||he).subs.push(yc(vb,"data",sd(this||he,"ondata")));(this||he).subs.push(yc(vb,"ping",sd(this||he,"onping")));(this||he).subs.push(yc(vb,"pong",sd(this||he,"onpong")));(this||
he).subs.push(yc(vb,"error",sd(this||he,"onerror")));(this||he).subs.push(yc(vb,"close",sd(this||he,"onclose")));(this||he).subs.push(yc((this||he).decoder,"decoded",sd(this||he,"ondecoded")))};Ba.prototype.onping=function(){(this||he).lastPing=new Date;this.emitAll("ping")};Ba.prototype.onpong=function(){this.emitAll("pong",new Date-(this||he).lastPing)};Ba.prototype.ondata=function(vb){(this||he).decoder.add(vb)};Ba.prototype.ondecoded=function(vb){this.emit("packet",vb)};Ba.prototype.onerror=function(vb){pd("error",
vb);this.emitAll("error",vb)};Ba.prototype.socket=function(vb,ld){function ne(){~nc(ee.connecting,bf)||ee.connecting.push(bf)}var bf=(this||he).nsps[vb];if(!bf){bf=new Bb(this||he,vb,ld);(this||he).nsps[vb]=bf;var ee=this||he;bf.on("connecting",ne);bf.on("connect",function(){bf.id=ee.generateId(vb)});(this||he).autoConnect&&ne()}return bf};Ba.prototype.destroy=function(vb){vb=nc((this||he).connecting,vb);~vb&&(this||he).connecting.splice(vb,1);(this||he).connecting.length||this.close()};Ba.prototype.packet=
function(vb){pd("writing packet %j",vb);var ld=this||he;vb.query&&0===vb.type&&(vb.nsp+="?"+vb.query);ld.encoding?ld.packetBuffer.push(vb):(ld.encoding=!0,(this||he).encoder.encode(vb,function(ne){for(var bf=0;bf<ne.length;bf++)ld.engine.write(ne[bf],vb.options);ld.encoding=!1;ld.processPacketQueue()}))};Ba.prototype.processPacketQueue=function(){if(0<(this||he).packetBuffer.length&&!(this||he).encoding){var vb=(this||he).packetBuffer.shift();this.packet(vb)}};Ba.prototype.cleanup=function(){pd("cleanup");
for(var vb=(this||he).subs.length,ld=0;ld<vb;ld++)(this||he).subs.shift().destroy();(this||he).packetBuffer=[];(this||he).encoding=!1;(this||he).lastPing=null;(this||he).decoder.destroy()};Ba.prototype.close=Ba.prototype.disconnect=function(){pd("disconnect");(this||he).skipReconnect=!0;(this||he).reconnecting=!1;"opening"===(this||he).readyState&&this.cleanup();(this||he).backoff.reset();(this||he).readyState="closed";(this||he).engine&&(this||he).engine.close()};Ba.prototype.onclose=function(vb){pd("onclose");
this.cleanup();(this||he).backoff.reset();(this||he).readyState="closed";this.emit("close",vb);(this||he)._reconnection&&!(this||he).skipReconnect&&this.reconnect()};Ba.prototype.reconnect=function(){if((this||he).reconnecting||(this||he).skipReconnect)return this||he;var vb=this||he;if((this||he).backoff.attempts>=(this||he)._reconnectionAttempts)pd("reconnect failed"),(this||he).backoff.reset(),this.emitAll("reconnect_failed"),(this||he).reconnecting=!1;else{var ld=(this||he).backoff.duration();
pd("will wait %dms before reconnect attempt",ld);(this||he).reconnecting=!0;var ne=setTimeout(function(){vb.skipReconnect||(pd("attempting reconnect"),vb.emitAll("reconnect_attempt",vb.backoff.attempts),vb.emitAll("reconnecting",vb.backoff.attempts),vb.skipReconnect||vb.open(function(bf){bf?(pd("reconnect attempt error"),vb.reconnecting=!1,vb.reconnect(),vb.emitAll("reconnect_error",bf.data)):(pd("reconnect success"),vb.onreconnect())}))},ld);(this||he).subs.push({destroy:function(){clearTimeout(ne)}})}};
Ba.prototype.onreconnect=function(){var vb=(this||he).backoff.attempts;(this||he).reconnecting=!1;(this||he).backoff.reset();this.updateSocketIds();this.emitAll("reconnect",vb)};return em}var fc=lively.FreezerRuntime.recorderFor("lively.2lively/interface.js");fc.nyi=function(Ba){throw Error("Not yet implemented: "+Ba);};fc.string=zb;fc.promise=Rb;fc.debugMessageOrder=!1;var Nb=function(Ba){this.id=fc.string.newUUID();this.actions={};this.options={ackTimeout:3500,debug:!1};this._incomingOrderNumberingBySenders=
new Map;this._outgoingOrderNumberingByTargets=new Map;this._outOfOrderCacheBySenders=new Map};Nb.prototype.isOnline=function(){fc.nyi("isOnline")};Nb.prototype.open=function(){fc.nyi("isOnline")};Nb.prototype.close=function(){fc.nyi("close")};Nb.prototype.remove=function(){fc.nyi("remove")};Nb.prototype.whenOnline=function(Ba){var rb=this;return fc.promise.waitFor(Ba,function(){return rb.isOnline()}).then(function(){return rb}).catch(function(Bb){return Promise.reject(/timeout/i.test(String(Bb))?
Error("Timeout in "+rb+".whenOnline"):Bb)})};Nb.prototype.onError=function(Ba){this.debug&&console.log("["+this+"] error: "+Ba)};Nb.prototype.removeService=function(Ba){delete this.actions[Ba]};Nb.prototype.removeServices=function(Ba){var rb=this;Ba.forEach(function(Bb){return rb.removeService(Bb)})};Nb.prototype.addService=function(Ba,rb){this.actions[Ba]=rb};Nb.prototype.addServices=function(Ba){var rb=this;Object.keys(Ba).forEach(function(Bb){return rb.addService(Bb,Ba[Bb])})};Nb.prototype.ping=
function(Ba){var rb=this,Bb,tb,Db,yc,sd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pd){if(1==pd.nextAddress)return Bb=Date.now(),pd.yield(rb.sendToAndWait(Ba,"l2l-ping",{timestamp:Bb}),2);tb=pd.yieldResult;Db=tb.data;yc=Db.timestamp;sd=Date.now();return pd.return({to:yc-Bb,from:sd-yc,roundtrip:sd-Bb})})};Nb.prototype.send=function(Ba,rb){fc.nyi("send")};Nb.prototype.sendAndWait=function(Ba){var rb=this,Bb,tb,Db,yc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sd){switch(sd.nextAddress){case 1:return Bb=
new Promise(function(pd,nc){return rb.send(Ba,pd)}),tb={},Db=rb.options.ackTimeout+400,"ackTimeout"in Ba&&(Db=!Ba.ackTimeout||0>Ba.ackTimeout?null:Ba.ackTimeout+400),Db?sd.yield(Promise.race([fc.promise.delay(Db,tb),Bb]),5):sd.yield(Bb,4);case 4:yc=sd.yieldResult;sd.jumpTo(3);break;case 5:yc=sd.yieldResult;case 3:if(yc===tb)throw Error("Timeout sending "+Ba.action);return sd.return(yc)}})};Nb.prototype.sendTo=function(Ba,rb,Bb,tb){return this.send({target:Ba,action:rb,data:Bb},tb)};Nb.prototype.sendToAndWait=
function(Ba,rb,Bb,tb){return this.sendAndWait(Object.assign({target:Ba,action:rb,data:Bb},tb))};Nb.prototype.prepareSend=function(Ba,rb){var Bb=Ba.target,tb=Ba.action,Db=Ba.messageId,yc=Ba.sender;if(!tb)throw Error("Trying to send a message without specifying action!");if(!Bb)throw Error("Trying to send message "+tb+" without specifying target!");Db||(Ba.messageId=fc.string.newUUID());yc||(Ba.sender=this.id);tb=Ba.n=this._outgoingOrderNumberingByTargets.get(Bb)||0;this._outgoingOrderNumberingByTargets.set(Bb,
tb+1);if("function"===typeof rb){yc=this;var sd=rb;rb=function(pd){var nc=yc._incomingOrderNumberingBySenders.get(pd.sender)||0;yc.debug&&fc.debugMessageOrder&&console.log("[MSG ORDER] "+yc+" received ack for "+pd.action+" as msg "+nc);try{sd.apply(null,arguments)}catch(jc){console.error("Error in ack fn of "+yc+": "+jc.stack)}yc._incomingOrderNumberingBySenders.set(pd.sender,nc+1);setTimeout(function(){return yc.invokeOutOfOrderMessages(pd.sender)},0)}}this.debug&&fc.debugMessageOrder&&console.log("[MSG ORDER] "+
this+" sending "+tb+" ("+Ba.action+") to "+Bb);return[Ba,rb]};Nb.prototype.prepareAnswerMessage=function(Ba,rb){return{action:Ba.action+"-response",inResponseTo:Ba.messageId,target:Ba.sender,data:rb,sender:this.id}};Nb.prototype.installEventToMessageTranslator=function(Ba){var rb=this,Bb=Ba.onevent;Ba.onevent=function(tb){var Db=tb.data||[];Bb.call(this,tb);tb.data=["*"].concat(Db);Bb.call(this,tb)};Ba.on("*",function(tb,Db){tb&&"object"===typeof tb&&tb.action&&(Db=tb,tb=Db.action);var yc=arguments[arguments.length-
1];yc="function"===typeof yc?yc:null;(Db=Db===yc?null:Db)&&Db.data&&("number"===typeof Db.n||Db.broadcast)&&Db.sender?rb.receive(Db,Ba,yc):(console.warn(rb+" received non-conformant message "+tb+":",arguments),"function"===typeof yc&&yc({data:{error:"invalid l2l message"}}))})};Nb.prototype.receive=function(Ba,rb,Bb){this.dispatchL2LMessageToSelf(Ba,rb,Bb)};Nb.prototype.dispatchL2LMessageToSelf=function(Ba,rb,Bb){var tb=this,Db=Ba.action;if(Ba.broadcast)this.safeInvokeServiceHandler(Db,Ba,Bb,rb);
else try{var yc=this._incomingOrderNumberingBySenders.get(Ba.sender)||0,sd="register"===Db||"unregister";if(!sd&&Ba.n<yc)console.error("[MSG ORDER] ["+this+"] received message no. "+Ba.n+" but expected >= "+yc+", dropping "+Db);else if(!sd&&Ba.n>yc){this.debug&&fc.debugMessageOrder&&console.log("[MSG ORDER] ["+this+"] storing out of order message "+Db+" ("+Ba.n+") for later invocation");var pd=this._outOfOrderCacheBySenders.get(Ba.sender);pd||(pd=[],this._outOfOrderCacheBySenders.set(Ba.sender,pd));
pd.push([Db,Ba,Bb,rb])}else this.safeInvokeServiceHandler(Db,Ba,Bb,rb),setTimeout(function(){return tb.invokeOutOfOrderMessages(Ba.sender)},0)}catch(nc){console.error("Error message ordering when handling "+Db+": "+(nc.stack||nc)),"function"===typeof Bb&&Bb(this.prepareAnswerMessage(Ba,{isError:!0,error:String(nc.stack||nc)}))}};Nb.prototype.invokeOutOfOrderMessages=function(Ba){var rb=this._outOfOrderCacheBySenders.get(Ba);if(rb&&rb.length){var Bb=this._incomingOrderNumberingBySenders.get(Ba)||0;
Ba=rb.findIndex(function(tb){tb=$jscomp.makeIterator(tb);tb.next();return tb.next().value.n===Bb});-1!==Ba&&(rb.splice(Ba,1),this.invokeServiceHandler.apply(this,rb[Ba]))}};Nb.prototype.renameTarget=function(Ba,rb){if(Ba!==rb){var Bb=this._outgoingOrderNumberingByTargets.get(Ba);this._outgoingOrderNumberingByTargets.delete(Ba);this._outgoingOrderNumberingByTargets.set(rb,Bb)}};Nb.prototype.safeInvokeServiceHandler=function(Ba,rb,Bb,tb){try{"function"===typeof this.actions[Ba]?this.invokeServiceHandler(Ba,
rb,Bb,tb):tb._events&&Object.keys(tb._events).includes(Ba)||(console.warn("WARNING ["+this+"] Unhandled message: "+Ba),"function"===typeof Bb&&Bb(this.prepareAnswerMessage(rb,{isError:!0,error:"message not understood: "+Ba})))}catch(Db){console.error("Error when handling "+Ba+": "+(Db.stack||Db)),"function"===typeof Bb&&Bb(this.prepareAnswerMessage(rb,{isError:!0,error:String(Db.stack||Db)}))}};Nb.prototype.invokeServiceHandler=function(Ba,rb,Bb,tb){var Db=this;this.debug&&fc.debugMessageOrder&&console.log("[MSG ORDER] "+
this+" received "+rb.n+" ("+rb.action+") from "+rb.sender);this._incomingOrderNumberingBySenders.set(rb.sender,rb.n+1);if("function"===typeof Bb){var yc=!1,sd=!1,pd="ackTimeout"in rb?rb.ackTimeout:this.options.ackTimeout,nc=this._outgoingOrderNumberingByTargets.get(rb.sender)||0;this._outgoingOrderNumberingByTargets.set(rb.sender,nc+1);var jc=function(Oc){sd?console.warn("["+Db+"] ackFn for "+rb.action+" called after it timed out, dropping answer!"):yc?console.warn("["+Db+"] ack function called repeatedly when handling "+
rb.action):(yc=!0,Bb(Db.prepareAnswerMessage(rb,Oc)),Db.debug&&fc.debugMessageOrder&&console.log("[MSG ORDER] "+Db+" sending "+nc+" (ack for "+rb.action+")"))};pd&&setTimeout(function(){yc||(jc({isError:!0,error:"Timeout error: "+Db+" did not send answer for "+rb.action+" after "+pd+"ms"}),sd=!0)},pd)}try{this.actions[Ba].call(this,this,rb,jc,tb)}catch(Oc){console.error("["+this+"] Error handling "+Ba+": "+(Oc.stack||Oc)),jc&&jc({error:Oc.stack})}};$jscomp.global.Object.defineProperties(Nb.prototype,
{debug:{configurable:!0,enumerable:!0,get:function(){return this.options.debug},set:function(Ba){this.options.debug=Ba}}});fc.L2LConnection=Nb;fc.default=Nb;var ab=lively.FreezerRuntime.recorderFor("lively.2lively/default-actions.js"),lc={"l2l-ping":function(Ba,rb,Bb,tb){tb=rb.sender;rb=rb.data.timestamp;var Db=Date.now();"function"===typeof Bb&&Bb({timestamp:Db});Ba.debug&&console.log("[undefined] got ping from "+tb+", time: "+(Db-rb)+"ms")},"remote-eval":function(Ba,rb,Bb,tb){var Db=rb.data.source;
Promise.resolve().then(function(){return eval(Db)}).then(function(yc){return Bb({value:yc})}).catch(function(yc){yc.originalErr&&(yc=yc.originalErr);console.error("eval error: "+yc);"function"===typeof Bb&&Bb({isError:!0,value:String(yc.stack||yc)})})},"remote-eval-2":function(Ba,rb,Bb,tb){var Db=rb.data.source;Promise.resolve().then(function(){var yc=eval(Db);if(!(yc instanceof Promise))throw console.error("unexpected eval result:"+yc),Error("unexpected eval result:"+yc);return yc}).then(function(yc){return Bb(yc)}).catch(function(yc){console.error("eval error: "+
yc);yc.originalErr&&(yc=yc.originalErr);"function"===typeof Bb&&Bb({isError:!0,value:String(yc.stack||yc)})})}};ab.defaultActions=lc;ab.defaultActions=lc;ab.defaultActions=lc;var rd={},Bd=(rd["[broadcast] send"]=function(Ba,rb,Bb,tb){var Db=rb.sender,yc=rb.data,sd,pd,nc,jc,Oc,vb,ld,ne,bf,ee,Re,kf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Hf){sd=yc;pd=sd.action;nc=sd.broadcast;jc=sd.room;Oc=sd.namespace;vb=sd.isSystemBroadcast;ld=sd.isMultiServerBroadcast;ne=[];ld?(console.log(".......isMultiServerBroadcast"),
bf=Ba,ee=bf.id,Re=Ba.getTrackerList(),console.log(Re),ne=Re.map(function(Af){return Af.id!=ee?Af.io.nsps["/"+Af.namespace]:tb.broadcast})):(vb&&(Oc=Ba.namespace),ne.push(Oc?Ba.io.nsps["/"+Oc]:tb.broadcast));ne.forEach(function(Af){return Af.to(jc).emit({action:pd,sender:Db,broadcast:!0,data:nc})});Bb&&"function"===typeof Bb&&(kf="message broadcasted to "+jc,Oc&&(kf+=" in namespace "+Oc),1<ne.length&&(kf+=" "+ne.length+" trackers"),console.log(kf),Bb({status:kf}));Hf.jumpToEnd()})},rd["[broadcast] join room"]=
function(Ba,rb,Bb,tb){var Db=rb.sender,yc=rb.data.room,sd,pd,nc,jc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Oc){if(1==Oc.nextAddress)return pd=!1,nc=Ba.io.nsps["/"+Ba.namespace].adapter.rooms,(jc=nc[yc]&&nc[yc].sockets&&nc[yc].sockets[tb.id])?(sd=Db+" already in "+yc,Oc.jumpTo(2)):Oc.yield(new Promise(function(vb,ld){return tb.join(yc,function(ne){return ne?ld(ne):vb()})}),3);2!=Oc.nextAddress&&(sd=Db+" joined "+yc,pd=!0);Bb&&"function"===typeof Bb&&Bb({status:sd,joined:pd});Oc.jumpToEnd()})},
rd["[broadcast] leave room"]=function(Ba,rb,Bb,tb){var Db=rb.sender,yc=rb.data.room,sd,pd,nc,jc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Oc){if(1==Oc.nextAddress)return pd=!1,nc=Ba.io.nsps["/"+Ba.namespace].adapter.rooms,jc=nc[yc]&&nc[yc].sockets&&nc[yc].sockets[tb.id],jc?Oc.yield(new Promise(function(vb,ld){return tb.leave(yc,function(ne){return ne?ld(ne):vb()})}),3):(sd=Db+" not in "+yc,Oc.jumpTo(2));2!=Oc.nextAddress&&(sd=Db+" left room "+yc,pd=!0);console.log(sd);Bb&&"function"===
typeof Bb&&Bb({left:pd,status:sd});Oc.jumpToEnd()})},rd["[broadcast] my rooms"]=function(Ba,rb,Bb,tb){Bb(tb.rooms)},rd["[broadcast] all rooms"]=function(Ba,rb,Bb,tb){Bb(Ba.io.nsps["/"+Ba.namespace].adapter.rooms)},rd["[broadcast] list room members"]=function(Ba,rb,Bb,tb){rb=rb.data.room;tb=Ba.io;rb?(Ba=tb.nsps["/"+Ba.namespace].adapter.rooms[rb],Bb({room:rb,sockets:Ba?Ba.sockets:{},length:Ba?Ba.length:0})):Bb({isError:!0,error:"`room` paramerter missing!"})},rd.getClients=function(Ba,rb,Bb){Ba.removeDisconnectedClients();
Bb(Array.from(Ba.clients))},rd);ab.defaultTrackerActions=Bd;ab.defaultTrackerActions=Bd;ab.defaultTrackerActions=Bd;var ad={},Xa=(ad.getRoomList=function(Ba){var rb=Ba.client,Bb=Ba.ackFn,tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Db){tb=rb._socketioClient.rooms;Bb(tb);Db.jumpToEnd()})},ad["ask for"]=function(Ba,rb,Bb,tb){var Db=rb.sender,yc=rb.data.query,sd=this,pd,nc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(jc){if(1==jc.nextAddress)return pd=yc.match(/password|sudo/i)?
"passwordPrompt":"prompt",jc.yield($world[pd](yc),2);nc=jc.yieldResult;"function"===typeof Bb&&Bb({answer:nc});Ba.debug&&console.log("["+sd+"] message 'ask for' from "+Db+", query: "+yc);jc.jumpToEnd()})},ad["open editor"]=function(Ba,rb,Bb,tb){var Db=rb.data.args,yc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sd){if(1==sd.nextAddress)return Db.length?sd.yield($world.execCommand("open file for EDITOR",{url:Db[0]}),2):(Bb({error:"no file specified"}),sd.return());yc=sd.yieldResult;
"function"===typeof Bb&&Bb("aborted"===yc?{error:String(yc)}:{status:yc});sd.jumpToEnd()})},ad.changeWorkingDirectory=function(Ba,rb,Bb,tb){var Db=rb.data.args,yc,sd,pd,nc,jc,Oc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){yc=$jscomp.makeIterator(Db||[]);sd=yc.next().value;pd=yc.next().value;nc="OK";try{if(sd)if(pd){if(jc=$world.getMorphWithId(pd))if(jc.__lookupSetter__("cwd"))jc.cwd=sd;else if("function"===typeof jc.changeWorkingDirectory)jc.changeWorkingDirectory(sd);else if("function"===
typeof jc.pluginFind){if(Oc=jc.pluginFind(function(ld){return ld.isShellEditorPlugin}))Oc.cwd=sd}else nc="[changeWorkingDirectory] cannot figure pout how to set dir"}else nc="[changeWorkingDirectory] No command morph";else nc="[changeWorkingDirectory] No directory received"}catch(ld){nc=String(ld)}"OK"!==nc&&console.warn(nc);"function"===typeof Bb&&Bb(nc);vb.jumpToEnd()})},ad);ab.defaultClientActions=Xa;ab.defaultClientActions=Xa;ab.defaultClientActions=Xa;var Rc={},pb=!1,eb={},hb=!1,ac={},Wb=!1,
Fd="undefined"!==typeof self?self:global,Be={},Ie=!1,Lf="undefined"!==typeof self?self:global,fd={},ue=!1,Md={},Vb=!1,sa="undefined"!==typeof self?self:global,Aa={},Kb=!1,P={},wa=!1,Pa={},Hb=!1,Nc="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Wc={},le=!1,Rd="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,jf={},ce=!1,we={},Mf=!1,Bf={},rg=!1,Qf={},Vc=!1,Rf={},Fg=!1,Hg={},qf=!1,Ga={},bb=!1,Gb={},ba=!1,Ia={},nb=!1,xb={},Ic=!1,wc={},Dd=
!1,yd={},zd=!1,He="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,df={},og=!1,Jh={},Oi=!1,Th={},Kj=!1,Kh={},gl=!1,Kf="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Uj={},oi=!1,Ke="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Kk={},cm=!1,ch="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,ok={},Fl=!1,Gl={},lk=!1,sg="undefined"!==typeof globalThis?globalThis:"undefined"!==
typeof self?self:global,Wf={},Vm=!1,Ub={},Ad=!1,Kc={},ze=!1,kd="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Wg={},pk=!1,Cm={},Sm=!1,Vo={},ao=!1,to={},qk=!1,om={},Tm=!1,uf="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,pm={},bo=!1,Tj="undefined"!==typeof self?self:global,em={},qm=!1,he="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,rk={},fl=!1,Um=function(){function Ba(sd,pd){"object"===typeof sd&&
(pd=sd,sd=void 0);pd=pd||{};sd=rb(sd);var nc=sd.source,jc=sd.id,Oc=sd.path;Oc=yc[jc]&&Oc in yc[jc].nsps;pd.forceNew||pd["force new connection"]||!1===pd.multiplex||Oc?(Db("ignoring socket cache for %s",nc),nc=tb(nc,pd)):(yc[jc]||(Db("new io instance for %s",nc),yc[jc]=tb(nc,pd)),nc=yc[jc]);sd.query&&!pd.query&&(pd.query=sd.query);return nc.socket(sd.path,pd)}if(fl)return rk;fl=!0;var rb=Ud(),Bb=ic(),tb=Qa(),Db=ge()("socket.io-client");rk=rk=Ba;var yc=rk.managers={};rk.protocol=Bb.protocol;rk.connect=
Ba;rk.Manager=Qa();rk.Socket=fa();return rk}(),Eg=lively.FreezerRuntime.recorderFor("lively.2lively/client.js");Eg.determineLocation=function(){return"undefined"!==typeof document&&document.location?document.location.origin:Eg.isNode?System._nodeRequire("os").hostname():System.baseURL};Eg.promise=Rb;Eg.fun=ke;Eg.obj=hd;Eg.events=$d;Eg.num=md;Eg.L2LConnection=Nb;Eg.defaultActions=lc;Eg.defaultClientActions=Xa;Eg.isNode="undefined"!==typeof System?System.get("@system-env").node:"undefined"!==typeof process&&
process.env;Eg._ioClient=Um;Eg.ioClient=Eg.ioClient||void 0;Eg.isNode?(Eg.require=System._nodeRequire("module")._load,Eg.ioClient=Eg.require("socket.io-client")):Eg.ioClient=Eg._ioClient;Eg.urlHelper={isRoot:function(Ba){return"/"===Eg.urlHelper.path(Ba)},root:function(Ba){return Eg.urlHelper.isRoot(Ba)?Ba:Ba.slice(0,-Eg.urlHelper.path(Ba).length)+"/"},path:function(){var Ba=/^[a-z0-9-_\.]+:/,rb=/^\/\/[^\/]+/;return function(Bb){Bb=Bb.replace(Ba,"").replace(rb,"");return""===Bb?"/":Bb}}(),join:function(Ba,
rb){Ba.endsWith("/")&&(Ba=Ba.slice(0,-1));rb.startsWith("/")&&(rb=rb.slice(1));return Ba+"/"+rb}};var Ni=function(Ba,rb,Bb,tb){var Db=Eg.L2LConnection.call(this)||this;Eg.events.makeEmitter(Db);Db.info=tb;Db.origin=Ba;Db.path=rb;Db.namespace=Bb.replace(/^\/?/,"/");Db.trackerId=null;Db._socketioClient=null;Db._reconnectState={closed:!1,autoReconnect:!0,isReconnecting:!1,isReconnectingViaSocketio:!1,registerAttempt:0,registerProcess:null,isOpening:!1};Object.keys(Eg.defaultActions).forEach(function(yc){return Db.addService(yc,
Eg.defaultActions[yc])});Object.keys(Eg.defaultClientActions).forEach(function(yc){return Db.addService(yc,Eg.defaultClientActions[yc])});return Db};$jscomp.inherits(Ni,Eg.L2LConnection);Ni.clientKey=function(Ba,rb,Bb){Ba=Ba.replace(/\/$/,"");rb=rb.replace(/^\//,"");Bb=Bb.replace(/^\//,"");return Ba+"-"+rb+"-"+Bb};Ni.forLivelyInBrowser=function(Ba){var rb=!!Ba;Ba=Object.assign({type:"lively.morphic browser"},Ba);var Bb=this.default();if(!Bb)return Eg.L2LClient.ensure({url:document.location.origin+
"/lively-socket.io",namespace:"l2l",info:Ba});rb&&!Eg.obj.equals(Bb.info,Ba)&&Bb.isRegistered()&&(Bb.info=Ba,Bb.unregister().then(function(){return Bb.register()}).catch(function(tb){return console.error("l2l re-register on info change errored: "+tb)}));return Bb};Ni.default=function(){var Ba=Eg.L2LClient.clients.keys().next().value;return Eg.L2LClient.clients.get(Ba)};Ni.create=function(Ba){var rb=Ba=void 0===Ba?{}:Ba;Ba=void 0===rb.debug?!1:rb.debug;var Bb=rb.url,tb=rb.namespace,Db=void 0===rb.autoOpen?
!0:rb.autoOpen;rb=void 0===rb.info?{}:rb.info;if(!Bb)throw Error("L2LClient needs server url!");var yc=Eg.urlHelper.root(Bb).replace(/\/+$/,"");Bb=Eg.urlHelper.path(Bb);tb=new this(yc,Bb,tb||"",rb);Db&&tb.register();tb.debug=Ba;return tb};Ni.ensure=function(Ba){var rb=Ba=void 0===Ba?{}:Ba,Bb=rb.url;rb=rb.namespace;if(!Bb)throw Error("L2LClient needs server url!");var tb=Eg.urlHelper.root(Bb).replace(/\/+$/,""),Db=Eg.urlHelper.path(Bb);tb=this.clientKey(tb,Db,rb||"");(Db=this.clients.get(tb))||this.clients.set(tb,
Db=this.create(Object.assign({},Ba,{url:Bb,namespace:rb})));return Db};Ni.prototype.isOnline=function(){return this.socket&&this.socket.connected};Ni.prototype.isRegistered=function(){return this.isOnline()&&!!this.trackerId};Ni.prototype.open=function(){var Ba=this,rb,Bb,tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Db){if(1==Db.nextAddress)return Ba.isOnline()||Ba._reconnectState.isOpening?Db.return(Ba):Db.yield(Ba.close(),2);Ba._reconnectState.closed=!1;rb=Eg.urlHelper.join(Ba.origin,
Ba.namespace);Bb={path:Ba.path,transports:["websocket","polling"]};tb=Ba._socketioClient=Eg.ioClient(rb,Bb);Ba.debug&&console.log("["+Ba+"] connecting");tb.on("error",function(yc){Ba._reconnectState.isOpening=!1;Ba.debug&&console.log("["+Ba+"] errored: "+yc)});tb.on("close",function(yc){return Ba.debug&&console.log("["+Ba+"] closed: "+yc)});tb.on("reconnect_failed",function(){return Ba.debug&&console.log("["+Ba+"] could not reconnect")});tb.on("reconnect_error",function(yc){return Ba.debug&&console.log("["+
Ba+"] reconnect error "+yc)});tb.on("connect",function(){Ba.debug&&console.log("["+Ba+"] connected");Ba.emit("connected",Ba);Ba._reconnectState.isOpening=!1;Ba._reconnectState.isReconnecting=!1;Ba._reconnectState.isReconnectingViaSocketio=!1});tb.on("disconnect",function(){Ba._reconnectState.isOpening=!1;Ba.debug&&console.log("["+Ba+"] disconnected");Ba.emit("disconnected",Ba);Ba.trackerId?("tracker"!==Ba.trackerId&&(Ba.renameTarget(Ba.trackerId,"tracker"),Ba.trackerId=null),Ba._reconnectState.closed?
Ba.debug&&console.log("["+Ba+"] won't reconnect b/c client is marked as closed"):Ba._reconnectState.autoReconnect?(Ba._reconnectState.isReconnecting=!0,setTimeout(function(){Ba._reconnectState.closed?Ba.debug&&console.log("["+Ba+"] won't reconnect b/c client is marked as closed 2"):Ba._reconnectState.isReconnectingViaSocketio?Ba.debug&&console.log("["+Ba+"] won't reconnect again, client already reconnecting"):(Ba.debug&&console.log("["+Ba+"] initiating reconnection to tracker"),Ba.register())},20)):
Ba.debug&&console.log("["+Ba+"] won't reconnect b/c client has reconnection disabled")):(Ba.debug&&console.log("["+Ba+"] disconnect: don't have a tracker id, won't try reconnect"),Ba.trackerId="tracker")});tb.on("reconnecting",function(){Ba.debug&&console.log("["+Ba+"] reconnecting",Ba._reconnectState);Ba.emit("reconnecting",Ba);Ba._reconnectState.closed?(Ba._reconnectState.isReconnecting=!1,Ba._reconnectState.isReconnectingViaSocketio=!1,tb.close(),Ba.close()):(Ba._reconnectState.isReconnecting=
!0,Ba._reconnectState.isReconnectingViaSocketio=!0)});tb.on("reconnect",function(){Ba.debug&&console.log("["+Ba+"] reconnected");Ba._reconnectState.isReconnecting=!1;Ba._reconnectState.isReconnectingViaSocketio=!1;Ba.register()});Ba.installEventToMessageTranslator(tb);Ba._reconnectState.isOpening=!0;return Db.return((new Promise(function(yc,sd){tb.once("error",sd);tb.once("connect",yc)})).then(function(){return Ba}))})};Ni.prototype.close=function(){var Ba=this,rb,Bb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tb){if(1==
tb.nextAddress){Ba._reconnectState.closed=!0;if(rb=Ba.socket)rb.removeAllListeners("reconnect"),rb.removeAllListeners("reconnecting"),rb.removeAllListeners("disconnect"),rb.removeAllListeners("connect"),rb.removeAllListeners("reconnect_error"),rb.removeAllListeners("reconnect_failed"),rb.removeAllListeners("close"),rb.removeAllListeners("error"),rb.close();Ba.debug&&console.log("["+Ba+"] closing...");return Ba.isRegistered()?tb.yield(Ba.unregister(),2):tb.jumpTo(2)}return Ba.isOnline()||Ba.socket?
rb&&!rb.connected?(Ba.debug&&console.log("["+Ba+"] socket not connected, considering client closed"),tb.return(Ba)):tb.return(Promise.race([Eg.promise.delay(2E3).then(function(){return rb.removeAllListeners("disconnect")}),new Promise(function(Db){return rb.once("disconnect",Db)})]).then(function(){Ba.debug&&console.log("["+Ba+"] closed");return Ba})):(Ba.debug&&(Bb=Ba.isOnline()?"no socket":"not online",Ba.debug&&console.log("["+Ba+"] cannot close: "+Bb)),tb.return(Ba))})};Ni.prototype.remove=function(){var Ba=
this.constructor.clientKey(this.origin,this.path,this.namespace);this.constructor.clients.delete(Ba);return this.close()};Ni.prototype.register=function(){var Ba=this,rb,Bb,tb,Db,yc,sd,pd,nc,jc,Oc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){switch(vb.nextAddress){case 1:if(Ba.isRegistered())return vb.return();if(Ba._reconnectState.closed)return Ba.debug&&console.log("["+Ba+"] not registering this b/c closed"),Ba._reconnectState.registerAttempt=0,vb.return();if(Ba._reconnectState.registerProcess)return Ba.debug&&
console.log("["+Ba+"] not registering this b/c register process exists"),vb.return();vb.setCatchFinallyBlocks(2);if(Ba.isOnline()){vb.jumpTo(4);break}return vb.yield(Ba.open(),4);case 4:return Ba.debug&&console.log("["+Ba+"] register"),vb.yield(Ba.sendToAndWait("tracker","register",Object.assign({userName:"unknown",type:"l2l "+(Eg.isNode?"node":"browser"),location:Eg.determineLocation()},Ba.info)),6);case 6:rb=vb.yieldResult;if(!rb.data)throw Bb=Error("Register answer is empty!"),Ba.emit("error",
Bb),Bb;if(rb.data.isError)throw tb=Error(rb.data.error),Ba.emit("error",tb),tb;Ba._reconnectState.registerAttempt=0;Db=rb;yc=Db.data;sd=yc.trackerId;pd=yc.messageNumber;Ba.trackerId=sd;Ba._incomingOrderNumberingBySenders.set(sd,pd||0);Ba.emit("registered",{trackerId:sd});vb.leaveTryBlock(0);break;case 2:nc=vb.enterCatchBlock(),console.error("Error in register request of "+Ba+": "+nc),jc=Ba._reconnectState.registerAttempt++,Oc=Eg.num.backoff(jc,4,3E5),Ba._reconnectState.registerProcess=setTimeout(function(){Ba._reconnectState.registerProcess=
null;Ba.register()},Oc),vb.jumpToEnd()}})};Ni.prototype.unregister=function(){var Ba=this,rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bb){switch(Bb.nextAddress){case 1:if(!Ba.isRegistered())return Bb.return();Ba.debug&&console.log("["+Ba+"] unregister");rb=Ba.trackerId;Bb.setCatchFinallyBlocks(2);return Bb.yield(Ba.sendToAndWait(Ba.trackerId,"unregister",{}),4);case 4:Bb.leaveTryBlock(3);break;case 2:Bb.enterCatchBlock();case 3:Ba.renameTarget(rb,"tracker"),Ba.trackerId=null,Ba.emit("unregistered",
Ba),Bb.jumpToEnd()}})};Ni.prototype.whenRegistered=function(Ba){var rb=this;return Eg.promise.waitFor(Ba,function(){return rb.isRegistered()}).catch(function(Bb){return Promise.reject(/timeout/i.test(String(Bb))?Error("Timeout in "+rb+".whenRegistered"):Bb)})};Ni.prototype.send=function(Ba,rb){var Bb=this,tb=$jscomp.makeIterator(this.prepareSend(Ba,rb));Ba=tb.next().value;rb=tb.next().value;this.whenOnline().then(function(){var Db=Bb.socket,yc=Ba,sd=yc.action;yc=yc.target;if(!Db)throw Error("Trying to send message "+
sd+" to "+yc+" but cannot find a connection to it!");"function"===typeof rb?Db.emit(sd,Ba,rb):Db.emit(sd,Ba)})};Ni.prototype.joinRoom=function(Ba){var rb=this;return this.whenOnline().then(function(){return rb.sendToAndWait(rb.trackerId,"[broadcast] join room",{room:Ba})})};Ni.prototype.leaveRoom=function(Ba){var rb=this;return this.whenOnline().then(function(){return rb.sendToAndWait(rb.trackerId,"[broadcast] leave room",{room:Ba})})};Ni.prototype.broadcast=function(Ba,rb,Bb,tb,Db){var yc=this,sd=
{action:rb,room:Ba,broadcast:Bb};if(void 0===tb?0:tb)sd.isSystemBroadcast=!0;if(void 0===Db?0:Db)sd.isMultiServerBroadcast=!0;return this.whenOnline().then(function(){return yc.sendToAndWait(yc.trackerId,"[broadcast] send",sd)})};Ni.prototype.listRoomMembers=function(Ba){var rb=this,Bb,tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Db){if(1==Db.nextAddress)return Db.yield(rb.sendToAndWait(rb.trackerId,"[broadcast] list room members",{room:Ba}),2);Bb=Db.yieldResult;tb=Bb.data;return Db.return(tb)})};
Ni.prototype.joinedRooms=function(){var Ba=this,rb,Bb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tb){if(1==tb.nextAddress)return tb.yield(Ba.sendToAndWait(Ba.trackerId,"[broadcast] my rooms",{}),2);rb=tb.yieldResult;Bb=rb.data;return tb.return(Bb)})};Ni.prototype.listRooms=function(){var Ba=this,rb,Bb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tb){if(1==tb.nextAddress)return tb.yield(Ba.sendToAndWait(Ba.trackerId,"[broadcast] all rooms",{}),2);rb=tb.yieldResult;Bb=
rb.data;return tb.return(Bb)})};Ni.prototype.listPeers=function(Ba){Ba=void 0===Ba?!1:Ba;var rb=this,Bb,tb,Db,yc,sd,pd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nc){if(1==nc.nextAddress)return Bb=rb,tb=Bb._peersCached,Db=Date.now(),!Ba&&tb&&1E3>Db-tb.timestamp?nc.return(rb._peersCached.sessions):rb.isOnline()?nc.yield(rb.sendToAndWait(rb.trackerId,"getClients",{}),2):nc.return([]);yc=nc.yieldResult;sd=yc.data;pd=sd.map(function(jc){var Oc=$jscomp.makeIterator(jc);jc=Oc.next().value;
var vb=Oc.next().value,ld=vb.info||{};Oc=ld.userRealm;var ne=ld.userToken,bf=ld.l2lUserToken,ee=ld.location,Re=ld.type;ld=ld.world;jc=Object.assign({},Eg.obj.dissoc(vb,["info"]),{id:jc,world:ld,location:ee,type:Re});(ne=ne||bf)&&"null"!==ne&&(lively.user?jc.user=lively.user.ClientUser.fromToken(ne,Oc):(jc.userToken=ne,jc.userRealm=Oc));return jc});rb._peersCached={timestamp:Db,sessions:pd};return nc.return(pd)})};Ni.prototype.toString=function(){var Ba=this.origin,rb=this.path,Bb=this.namespace,tb=
this.id,Db=this.isOnline()?this.isRegistered()?"registered":"unregistered":"disconnected";return"L2LClient("+(tb||"").slice(0,5)+" "+Ba+rb+" - "+Bb+" "+Db+")"};$jscomp.global.Object.defineProperties(Ni.prototype,{socket:{configurable:!0,enumerable:!0,get:function(){return this._socketioClient}},socketId:{configurable:!0,enumerable:!0,get:function(){return this.socket?this.socket.id:null}}});$jscomp.global.Object.defineProperties(Ni,{clients:{configurable:!0,enumerable:!0,get:function(){return this._clients||
(this._clients=new Map)}}});Da("default",Ni);Eg.L2LClient=Ni;Eg.default=Ni}}});