System.register(["./__root_module__-7cbd94df.js","kld-intersections","./client-command-e01b02a6.js"],function(Da){var Ab,Rb,jc,cc,je,fd;return{setters:[function(Yd){Ab=Yd.s;Rb=Yd.$;jc=Yd.a6;cc=Yd.bF;je=Yd.a7},function(){},function(Yd){fd=Yd.runCommand}],execute:function(){function Yd(Za,Db){var ac,ic,gd,fe,Yb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qc){if(1==qc.nextAddress)return ac=Ld.fileInfoCommandString(Za,Db),ic=Ld.runCommand(ac,Db),qc.yield(ic.whenDone(),2);if(gd=0!=
ic.exitCode?ic.output:null)throw gd;fe=$jscomp.makeIterator(Ld.parseDirectoryListFromLs(ic.stdout,Db.rootDirectory||"."));Yb=fe.next().value;return qc.return(Yb)})}function jd(Za,Db){return Ld.string.lines(Za).map(function(ac){return ac.trim().length?(new Ld.FileInfo(Db)).readFromDirectoryListLine(ac):null}).filter(Boolean)}function Pc(Za,Db){var ac,ic,gd,fe,Yb,qc,Ob,Hc,Yc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cd){ac=Object.assign({findFilesGroup:"default-find-files-process"},
Db);ic=ac.findFilesGroup;gd=ac.rootDirectory;Yb=fe=Ld.findFilesProcesses[ic]||(Ld.findFilesProcesses[ic]={promiseState:null,commands:[]});qc=Yb.commands;Ob=Yb.promiseState;Ob||(fe.promiseState=Ob=Ld.promise.deferred());Hc=Ld.findFilesCommandString(Za,Db);qc.forEach(function($b){return $b.kill()});Yc=Ld.runCommand(Hc,Db);qc.push(Yc);Yc.whenDone().then(function(){Ld.arr.remove(qc,Yc);if(qc.some(function(pb){return pb.startTime>Yc.startTime}))console.log("[findFiles] command "+Yc+" exited but a newer findFiles command was started for group "+
ic+", discarding output");else{var $b=0!=Yc.exitCode?Yc.output:null;$b&&console.warn($b);$b=$b?[]:Ld.parseDirectoryListFromLs(Yc.stdout,gd)||[];Ob.resolve($b);Object.assign(fe,{promiseState:null,commands:[]})}}).catch(function($b){return console.error($b)});return cd.return(Ob.promise)})}function vd(Za){function Db(ac){return Array.prototype.concat.apply([ac],ac.children?ac.children.map(Db):[])}return Db(Za).map(function(ac){var ic=ac.fullPath.replace(/^\//,"");return{fileName:ic,path:ic,rootDirectory:"./",
isDirectory:ac.isDirectory,isLink:void 0,lastModified:void 0,linkCount:void 0,mode:void 0,size:void 0,group:void 0,user:void 0}})}var Ld=lively.FreezerRuntime.recorderFor("lively.shell/client-fs-helper.js");Ld.fileInfo=Yd;Ld.fileInfoCommandString=function(Za,Db){var ac=Db=void 0===Db?{}:Db;Db=ac.rootDirectory;ac=ac.platform;Db=Db||".";var ic="win32"===ac?"\\":"/";"win32"===ac||Db.endsWith(ic)||(Db+=ic);return"win32"===ac?"cd "+Db+' && ls -lLd --time-style=locale "'+Za+'"':'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && env TZ=GMT LANG=en_US.UTF-8 cd '+
(Db+' && ls -lLd "$timeformat" "'+Za+'"')};Ld.parseDirectoryListFromLs=jd;Ld.findFiles=Pc;Ld.findFilesCommandString=function(Za,Db){var ac=Db=void 0===Db?{}:Db,ic=ac.rootDirectory,gd=ac.exclude,fe=ac.depth;ac=ac.platform;ic=ic||".";gd=gd||"-iname "+Ld.defaultExcludes.map(Ld.string.print).join(" -o -iname ");var Yb="win32"===ac?"\\":"/";"win32"===ac||ic.endsWith(Yb)||(ic+=Yb);Za=Ld.string.format('%s "%s"',Db.re?"-iregex":Db.matchPath?"-ipath":"-iname",Za);fe="number"===typeof fe?" -maxdepth "+fe:"";
return"win32"===ac?Ld.string.format("find %s %s ( %s ) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd --time-style=locale {}",ic,Db.re?"-E ":"",gd.replace(/"/g,""),Za.replace(/"/g,""),fe):'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && '+Ld.string.format('env TZ=GMT LANG=en_US.UTF-8 find %s %s \\( %s \\) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd "$timeformat" "{}"',ic,Db.re?"-E ":"",gd,Za,fe)};Ld.convertDirectoryUploadEntriesToFileInfos=
vd;Ld.runCommand=fd;Ld.string=Ab;Ld.promise=Rb;Ld.arr=jc;Ld.fileInfo=Yd;Ld.fileInfo=Yd;Ld.parseDirectoryListFromLs=jd;Ld.parseDirectoryListFromLs=jd;var ge=function(Za){this.rootDirectory=Za;this.fileName=this.path="";this.isDirectory=!1;this.lastModified=null;this.mode="";this.isLink=!1;this.linkCount=0;this.group=this.user="";this.size=0;this.rootDirectory=null};ge.prototype.readFromDirectoryListLine=function(Za){var Db=this;if(!Za.trim().length)return null;var ac=Za;this.reader.forEach(function(ic){return ac=
ic(ac,Db)});return this};ge.prototype.toString=function(){return this.path};$jscomp.global.Object.defineProperties(ge.prototype,{reader:{configurable:!0,enumerable:!0,get:function(){return[function(Za,Db){var ac=Za.indexOf(" ");Db.mode=Za.slice(0,ac);Db.isDirectory="d"===Db.mode[0];return Za.slice(ac+1).trim()},function(Za,Db){var ac=Za.indexOf(" ");Db.linkCount=Number(Za.slice(0,ac));return Za.slice(ac+1).trim()},function(Za,Db){var ac=Za.indexOf(" ");Db.user=Za.slice(0,ac);return Za.slice(ac+1).trim()},
function(Za,Db){var ac=Ld.string.peekRight(Za,0,/\s+[0-9]/);Db.group=Za.slice(0,ac).trim();return Za.slice(ac).trim()},function(Za,Db){var ac=Za.indexOf(" ");Db.size=Number(Za.slice(0,ac));return Za.slice(ac+1).trim()},function(Za,Db){var ac=Ld.string.reMatches(Za,/[^s]+\s+[0-9:\s]+/);if(!ac||!ac[0])return Za;Db.lastModified=new Date(ac[0].match+" GMT");return Za.slice(ac[0].end).trim()},function(Za,Db){var ac=(Za=Za.replace(/^\.\/+/g,"").replace(/\/\//g,"/"))&&Za.split(" -> "),ic=""===Za?!1:Za&&
2===ac.length,gd=(ac=ic?ac[0]:Za)&&0===ac.indexOf(Db.rootDirectory)?ac.slice(Db.rootDirectory.length):ac;Db.fileName=""===Za?".":gd;Db.path=ac;Db.isLink=ic;return gd}]}}});Ld.FileInfo=ge;Ld.findFilesProcesses={};Ld.findFiles=Pc;Ld.findFiles=Pc;Ld.defaultExcludes=[".svn",".git","node_modules",".module_cache"];Ld.convertDirectoryUploadEntriesToFileInfos=vd;Ld.convertDirectoryUploadEntriesToFileInfos=vd;var Td=lively.FreezerRuntime.recorderFor("lively.shell/client-resource.js");Td.Resource=cc;Td.runCommand=
fd;Td.fileInfo=Yd;Td.findFiles=Pc;Td.string=Ab;Td.promise=Rb;Td.arr=jc;Td.obj=je;ge=function(Za,Db,ac){ac=void 0===ac?{}:ac;Za=Td.Resource.call(this,Za)||this;Za.options=Object.assign({},ac,{l2lClient:Db||Za.constructor.defaultL2lClient});return Za};$jscomp.inherits(ge,Td.Resource);ge.prototype.newResource=function(Za){return new this.constructor(Za,this.options.l2lClient,this.options)};ge.prototype.read=function(){var Za=this,Db=Td.runCommand('cat "'+this.url+'"',this.options);return Db.whenDone().then(function(){if(Db.exitCode)throw Error("Read "+
Za.url+" failed: "+Db.stderr);return Db.output})};ge.prototype.write=function(Za){var Db=this,ac,ic;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gd){switch(gd.nextAddress){case 1:return Za?gd.yield(Td.runCommand('touch "'+Db.url+'" && tee "'+Db.url+'"',Object.assign({stdin:String(Za)},Db.options)).whenDone(),4):gd.yield(Td.runCommand('echo -n > "'+Db.url+'"',Object.assign({},Db.options)).whenDone(),5);case 4:ac=gd.yieldResult;gd.jumpTo(3);break;case 5:ac=gd.yieldResult;case 3:ic=ac;
if(ic.exitCode)throw Error("Write "+Db.url+" failed: "+ic.stderr);return gd.return(Db)}})};ge.prototype.mkdir=function(){var Za=this,Db;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ac){if(1==ac.nextAddress)return ac.yield(Td.runCommand('mkdir -p "'+Za.url+'"',Za.options).whenDone(),2);Db=ac.yieldResult;if(Db.exitCode)throw Error(Za+" cannot create directory: "+Db.stderr);return ac.return(Za)})};ge.prototype.exists=function(){var Za=Td.runCommand('test -d "'+this.url+'" || test -f "'+
this.url+'"',this.options);return Za.whenDone().then(function(){return 0===Za.exitCode})};ge.prototype.remove=function(){var Za=this,Db=Td.runCommand('rm -rf "'+this.url+'"',this.options);return Db.whenDone().then(function(){if(Db.exitCode)throw Error("Remove of "+Za.url+" failed: "+Db.stderr);return Za})};ge.prototype.gzip=function(Za){var Db=this,ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ic){ac=Td.runCommand('gzip > "'+Db.url+'"',Object.assign({stdin:String(Za)},Db.options));
return ic.return(ac.whenDone().then(function(){if(ac.exitCode)throw Error("Gzip compression of "+Db.url+" failed: "+ac.stderr);return Db}))})};ge.prototype.brotli=function(Za){var Db=this,ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ic){ac=Td.runCommand('brotli > "'+Db.url+'"',Object.assign({stdin:String(Za)},Db.options));return ic.return(ac.whenDone().then(function(){if(ac.exitCode)throw Error("Brotli compression of "+Db.url+" failed: "+ac.stderr);return Db}))})};ge.prototype.readProperties=
function(){var Za=this,Db;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ac){if(1==ac.nextAddress)return ac.yield(Td.fileInfo(Za.url,Za.options),2);Db=ac.yieldResult;Za.assignProperties(Td.obj.dissoc(Db,["fileName","path","rootDirectory"]));return ac.return(Za)})};ge.prototype.dirList=function(Za,Db){Za=void 0===Za?1:Za;Db=void 0===Db?{}:Db;var ac=this,ic,gd,fe,Yb,qc,Ob,Hc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yc){if(1==Yc.nextAddress)return ic=Db,gd=ic.exclude,
Array.isArray(gd)&&(gd="-iname "+gd.map(Td.string.print).join(" -o -iname ")),fe=ac,Yb=fe.url,qc=fe.options,Ob=qc.l2lClient,Yc.yield(Td.findFiles("*",{exclude:gd,depth:Za,rootDirectory:Yb,l2lClient:Ob}),2);Hc=Yc.yieldResult;Hc[0].path.replace(/\/$/,"")===ac.url.replace(/\/$/,"")&&Hc.shift();return Yc.return(Hc.map(function(cd){var $b=cd.path;cd.isDirectory&&($b=$b.replace(/\/?$/,"/"));$b=new ac.constructor($b,Ob,ac.options);$b.assignProperties(Td.obj.dissoc(cd,["fileName","path","rootDirectory"]));
return $b}))})};$jscomp.global.Object.defineProperties(ge,{defaultL2lClient:{configurable:!0,enumerable:!0,get:function(){return this._defaultL2lClient||Td._defaultL2LClient},set:function(Za){this._defaultL2lClient=Td._defaultL2LClient=Za}}});Da("default",ge);Td.ShellClientResource=ge;Td._defaultL2LClient=Td._defaultL2LClient||void 0;var md=Da("resourceExtension",{name:"shell-client",matches:function(Za){return Za.startsWith("/")||Za.match(/[a-z]:\\/i)},resourceClass:Td.ShellClientResource});Td.resourceExtension=
md;Td.resourceExtension=md;Td.resourceExtension=md;Td.default=ge}}});